{"sha": "c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzNjM2RkYmJjYzhjMjgzMGVlNzZkNmVkNzYwZjUzNDNjOTgzZjkxNg==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2018-07-03T19:37:41Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2018-07-03T19:37:41Z"}, "message": "h8300.c (h8300_insn_length_from_table): Consolidate ADDB...\n\n\t* config/h8300/h8300.c (h8300_insn_length_from_table): Consolidate\n\tADDB, ADDW and ADDL into a single ADD attribute which selects the\n\tright table based on the size of the operand.\n\t* config/h8300/h8300.md (length_table): Corresponding changes. All\n\treferences to \"addb\", \"addw\" and \"addl\" changed to \"add\".\n\t(btst patterns): Merge two variants into a single pattern.\n\t(tstqi, tsthi): Likewise.\n\t(addhi3_incdec, addsi3_incdec): Likewise.\n\t(subhi3_h8300hs, subsi3_h8300hs): Likewise.\n\t(mulhi3, mulsi3): Likewise.\n\t(udivhi3, udivsi3): Likewise.\n\t(divhi3, divsi3): Likewise.\n\t(andorqi3, andorhi3, andorsi3): Likewise.\n\nFrom-SVN: r262357", "tree": {"sha": "1d354d0a767a047ef9c45b6fb002ac84846548f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d354d0a767a047ef9c45b6fb002ac84846548f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/comments", "author": null, "committer": null, "parents": [{"sha": "15333be70addf4eb750d82d5e298cd3ad33b711a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15333be70addf4eb750d82d5e298cd3ad33b711a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15333be70addf4eb750d82d5e298cd3ad33b711a"}], "stats": {"total": 278, "additions": 119, "deletions": 159}, "files": [{"sha": "760ad5993153010e7620247e71234e9420d83281", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "patch": "@@ -1,3 +1,19 @@\n+2018-07-03  Jeff Law  <law@redhat.com>\n+\n+\t* config/h8300/h8300.c (h8300_insn_length_from_table): Consolidate\n+\tADDB, ADDW and ADDL into a single ADD attribute which selects the\n+\tright table based on the size of the operand.\n+\t* config/h8300/h8300.md (length_table): Corresponding changes. All\n+\treferences to \"addb\", \"addw\" and \"addl\" changed to \"add\".\n+\t(btst patterns): Merge two variants into a single pattern.\n+\t(tstqi, tsthi): Likewise.\n+\t(addhi3_incdec, addsi3_incdec): Likewise.\n+\t(subhi3_h8300hs, subsi3_h8300hs): Likewise.\n+\t(mulhi3, mulsi3): Likewise.\n+\t(udivhi3, udivsi3): Likewise.\n+\t(divhi3, divsi3): Likewise.\n+\t(andorqi3, andorhi3, andorsi3): Likewise.\n+\n 2018-07-03  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/85694"}, {"sha": "01c765dbc09c21a711b4430e7b38d5217ac4621c", "filename": "gcc/config/h8300/h8300.c", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/gcc%2Fconfig%2Fh8300%2Fh8300.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/gcc%2Fconfig%2Fh8300%2Fh8300.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fh8300.c?ref=c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "patch": "@@ -2551,14 +2551,14 @@ h8300_insn_length_from_table (rtx_insn *insn, rtx * operands)\n     case LENGTH_TABLE_NONE:\n       gcc_unreachable ();\n \n-    case LENGTH_TABLE_ADDB:\n-      return h8300_binary_length (insn, &addb_length_table);\n-\n-    case LENGTH_TABLE_ADDW:\n-      return h8300_binary_length (insn, &addw_length_table);\n-\n-    case LENGTH_TABLE_ADDL:\n-      return h8300_binary_length (insn, &addl_length_table);\n+    case LENGTH_TABLE_ADD:\n+      if (GET_MODE (operands[0]) == QImode)\n+        return h8300_binary_length (insn, &addb_length_table);\n+      else if (GET_MODE (operands[0]) == HImode)\n+        return h8300_binary_length (insn, &addw_length_table);\n+      else if (GET_MODE (operands[0]) == SImode)\n+        return h8300_binary_length (insn, &addl_length_table);\n+      gcc_unreachable ();\n \n     case LENGTH_TABLE_LOGICB:\n       return h8300_binary_length (insn, &logicb_length_table);"}, {"sha": "5014fd596ad4ea48f2c47be83c0c322564766b64", "filename": "gcc/config/h8300/h8300.md", "status": "modified", "additions": 95, "deletions": 151, "changes": 246, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/gcc%2Fconfig%2Fh8300%2Fh8300.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3c3ddbbcc8c2830ee76d6ed760f5343c983f916/gcc%2Fconfig%2Fh8300%2Fh8300.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fh8300.md?ref=c3c3ddbbcc8c2830ee76d6ed760f5343c983f916", "patch": "@@ -77,7 +77,7 @@\n (define_attr \"type\" \"branch,arith,bitbranch,call\"\n   (const_string \"arith\"))\n \n-(define_attr \"length_table\" \"none,addb,addw,addl,logicb,movb,movw,movl,mova_zero,mova,unary,mov_imm4,short_immediate,bitfield,bitbranch\"\n+(define_attr \"length_table\" \"none,add,logicb,movb,movw,movl,mova_zero,mova,unary,mov_imm4,short_immediate,bitfield,bitbranch\"\n   (const_string \"none\"))\n \n ;; The size of instructions in bytes.\n@@ -824,17 +824,6 @@\n   [(set_attr \"length\" \"2,4\")\n    (set_attr \"cc\" \"set_zn,set_zn\")])\n \n-(define_insn \"\"\n-  [(set (cc0)\n-\t(compare (zero_extract:HI (match_operand:HI 0 \"register_operand\" \"r\")\n-\t\t\t\t  (const_int 1)\n-\t\t\t\t  (match_operand 1 \"const_int_operand\" \"n\"))\n-\t\t (const_int 0)))]\n-  \"TARGET_H8300\"\n-  \"btst\t%Z1,%Y0\"\n-  [(set_attr \"length\" \"2\")\n-   (set_attr \"cc\" \"set_zn\")])\n-\n (define_insn_and_split \"*tst_extzv_1_n\"\n   [(set (cc0)\n \t(compare (zero_extract:SI (match_operand:QI 0 \"general_operand_src\" \"r,U,mn>\")\n@@ -862,11 +851,11 @@\n \n (define_insn \"\"\n   [(set (cc0)\n-\t(compare (zero_extract:SI (match_operand:SI 0 \"register_operand\" \"r\")\n-\t\t\t\t  (const_int 1)\n-\t\t\t\t  (match_operand 1 \"const_int_operand\" \"n\"))\n+\t(compare (zero_extract:HSI (match_operand:HSI 0 \"register_operand\" \"r\")\n+\t\t\t\t   (const_int 1)\n+\t\t\t\t   (match_operand 1 \"const_int_operand\" \"n\"))\n \t\t (const_int 0)))]\n-  \"(TARGET_H8300H || TARGET_H8300S)\n+  \"(TARGET_H8300 || TARGET_H8300H || TARGET_H8300S)\n     && INTVAL (operands[1]) <= 15\"\n   \"btst\t%Z1,%Y0\"\n   [(set_attr \"length\" \"2\")\n@@ -937,21 +926,18 @@\n   [(set_attr \"length\" \"2,8,10\")\n    (set_attr \"cc\" \"set_zn,set_zn,set_zn\")])\n \n-(define_insn \"*tstqi\"\n-  [(set (cc0)\n-\t(compare (match_operand:QI 0 \"register_operand\" \"r\")\n-\t\t (const_int 0)))]\n-  \"\"\n-  \"mov.b\t%X0,%X0\"\n-  [(set_attr \"length\" \"2\")\n-   (set_attr \"cc\" \"set_znv\")])\n-\n-(define_insn \"*tsthi\"\n+(define_insn \"*tst<mode>\"\n   [(set (cc0)\n-\t(compare (match_operand:HI 0 \"register_operand\" \"r\")\n+\t(compare (match_operand:QHI 0 \"register_operand\" \"r\")\n \t\t (const_int 0)))]\n   \"\"\n-  \"mov.w\t%T0,%T0\"\n+  {\n+    if (<MODE>mode == QImode)\n+      return \"mov.b\t%X0,%X0\";\n+    else if (<MODE>mode == HImode)\n+      return \"mov.w\t%T0,%T0\";\n+    gcc_unreachable ();\n+  }\n   [(set_attr \"length\" \"2\")\n    (set_attr \"cc\" \"set_znv\")])\n \n@@ -990,7 +976,7 @@\n \t\t (match_operand:QI 1 \"h8300_src_operand\" \"rQi\")))]\n   \"\"\n   \"cmp.b\t%X1,%X0\"\n-  [(set_attr \"length_table\" \"addb\")\n+  [(set_attr \"length_table\" \"add\")\n    (set_attr \"cc\" \"compare\")])\n \n (define_insn \"*cmphi_h8300_znvc\"\n@@ -1021,7 +1007,7 @@\n       gcc_unreachable ();\n       }\n }\n-  [(set_attr \"length_table\" \"short_immediate,addw\")\n+  [(set_attr \"length_table\" \"short_immediate,add\")\n    (set_attr \"cc\" \"compare,compare\")])\n \n (define_insn \"cmpsi\"\n@@ -1044,7 +1030,7 @@\n     }\n }\n   [(set_attr \"length\" \"2,*\")\n-   (set_attr \"length_table\" \"*,addl\")\n+   (set_attr \"length_table\" \"*,add\")\n    (set_attr \"cc\" \"compare,compare\")])\n \f\n ;; ----------------------------------------------------------------------\n@@ -1064,7 +1050,7 @@\n \t\t (match_operand:QI 2 \"h8300_src_operand\" \"rQi\")))]\n   \"h8300_operands_match_p (operands)\"\n   \"add.b\t%X2,%X0\"\n-  [(set_attr \"length_table\" \"addb\")\n+  [(set_attr \"length_table\" \"add\")\n    (set_attr \"cc\" \"set_zn\")])\n \n (define_insn \"*addhi3_h8300\"\n@@ -1127,15 +1113,19 @@\n   [(set_attr \"length\" \"2,2,2,4,2\")\n    (set_attr \"cc\" \"none_0hit,none_0hit,clobber,set_zn,set_zn\")])\n \n-(define_insn \"*addhi3_incdec\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r,r\")\n-\t(unspec:HI [(match_operand:HI 1 \"register_operand\" \"0,0\")\n-\t\t    (match_operand:HI 2 \"incdec_operand\" \"M,O\")]\n-\t\t   UNSPEC_INCDEC))]\n+(define_insn \"*add<mode>3_incdec\"\n+  [(set (match_operand:HSI 0 \"register_operand\" \"=r,r\")\n+\t(unspec:HSI [(match_operand:HSI 1 \"register_operand\" \"0,0\")\n+\t\t     (match_operand:HSI 2 \"incdec_operand\" \"M,O\")]\n+\t\t    UNSPEC_INCDEC))]\n   \"TARGET_H8300H || TARGET_H8300S\"\n-  \"@\n-   inc.w\t%2,%T0\n-   dec.w\t%G2,%T0\"\n+  {\n+    if (which_alternative == 0)\n+      return <MODE>mode == HImode ? \"inc.w\\t%2,%T0\" : \"inc.l\\t%2,%S0\";\n+    else if (which_alternative == 1)\n+      return <MODE>mode == HImode ? \"dec.w\\t%G2,%T0\" : \"dec.l\\t%G2,%S0\";\n+    gcc_unreachable ();\n+   }\n   [(set_attr \"length\" \"2,2\")\n    (set_attr \"cc\" \"set_zn,set_zn\")])\n \n@@ -1149,7 +1139,7 @@\n    sub.w\t%G2:3,%T0\n    add.b\t%t2,%t0\n    add.w\t%T2,%T0\"\n-  [(set_attr \"length_table\" \"short_immediate,short_immediate,*,addw\")\n+  [(set_attr \"length_table\" \"short_immediate,short_immediate,*,add\")\n    (set_attr \"length\" \"*,*,2,*\")\n    (set_attr \"cc\" \"set_zn\")])\n \n@@ -1191,18 +1181,6 @@\n    (set (attr \"cc\")\n \t(symbol_ref \"compute_plussi_cc (operands)\"))])\n \n-(define_insn \"*addsi3_incdec\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n-\t(unspec:SI [(match_operand:SI 1 \"register_operand\" \"0,0\")\n-\t\t    (match_operand:SI 2 \"incdec_operand\" \"M,O\")]\n-\t\t   UNSPEC_INCDEC))]\n-  \"TARGET_H8300H || TARGET_H8300S\"\n-  \"@\n-   inc.l\t%2,%S0\n-   dec.l\t%G2,%S0\"\n-  [(set_attr \"length\" \"2,2\")\n-   (set_attr \"cc\" \"set_zn,set_zn\")])\n-\n (define_split\n   [(set (match_operand:SI 0 \"register_operand\" \"\")\n \t(plus:SI (match_dup 0)\n@@ -1234,7 +1212,7 @@\n \t\t  (match_operand:QI 2 \"h8300_dst_operand\" \"rQ\")))]\n   \"h8300_operands_match_p (operands)\"\n   \"sub.b\t%X2,%X0\"\n-  [(set_attr \"length_table\" \"addb\")\n+  [(set_attr \"length_table\" \"add\")\n    (set_attr \"cc\" \"set_zn\")])\n \n (define_insn \"*subhi3_h8300\"\n@@ -1248,15 +1226,19 @@\n   [(set_attr \"length\" \"2,4\")\n    (set_attr \"cc\" \"set_zn,clobber\")])\n \n-(define_insn \"*subhi3_h8300hs\"\n-  [(set (match_operand:HI 0 \"h8300_dst_operand\" \"=rQ,rQ\")\n-\t(minus:HI (match_operand:HI 1 \"h8300_dst_operand\" \"0,0\")\n-\t\t  (match_operand:HI 2 \"h8300_src_operand\" \"rQ,i\")))]\n+(define_insn \"*sub<mode>3_h8300hs\"\n+  [(set (match_operand:HSI 0 \"h8300_dst_operand\" \"=rQ,rQ\")\n+\t(minus:HSI (match_operand:HSI 1 \"h8300_dst_operand\" \"0,0\")\n+\t\t   (match_operand:HSI 2 \"h8300_src_operand\" \"rQ,i\")))]\n   \"(TARGET_H8300H || TARGET_H8300S) && h8300_operands_match_p (operands)\"\n-  \"@\n-   sub.w\t%T2,%T0\n-   sub.w\t%T2,%T0\"\n-  [(set_attr \"length_table\" \"addw\")\n+  { \n+    if (<MODE>mode == HImode)\n+      return \"sub.w\t%T2,%T0\";\n+    else if (<MODE>mode == SImode)\n+      return \"sub.l\t%S2,%S0\";\n+    gcc_unreachable ();\n+  }\n+  [(set_attr \"length_table\" \"add\")\n    (set_attr \"cc\" \"set_zn\")])\n \n (define_insn \"*subsi3_h8300\"\n@@ -1267,16 +1249,6 @@\n   \"sub.w\t%f2,%f0\\;subx\t%y2,%y0\\;subx\t%z2,%z0\"\n   [(set_attr \"length\" \"6\")])\n \n-(define_insn \"*subsi3_h8300hs\"\n-  [(set (match_operand:SI 0 \"h8300_dst_operand\" \"=rQ,rQ\")\n-\t(minus:SI (match_operand:SI 1 \"h8300_dst_operand\" \"0,0\")\n-\t\t  (match_operand:SI 2 \"h8300_src_operand\" \"rQ,i\")))]\n-  \"(TARGET_H8300H || TARGET_H8300S) && h8300_operands_match_p (operands)\"\n-  \"@\n-   sub.l\t%S2,%S0\n-   sub.l\t%S2,%S0\"\n-  [(set_attr \"length_table\" \"addl\")\n-   (set_attr \"cc\" \"set_zn\")])\n \f\n ;; ----------------------------------------------------------------------\n ;; MULTIPLY INSTRUCTIONS\n@@ -1404,21 +1376,12 @@\n ;; on a H8SX with a multiplier, whereas muls.w seems to be available\n ;; on all H8SX variants.\n \n-(define_insn \"mulhi3\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n-        (mult:HI (match_operand:HI 1 \"register_operand\" \"%0\")\n-\t\t (match_operand:HI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n+(define_insn \"mul<mode>3\"\n+  [(set (match_operand:HSI 0 \"register_operand\" \"=r\")\n+        (mult:HSI (match_operand:HSI 1 \"register_operand\" \"%0\")\n+\t\t  (match_operand:HSI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n   \"TARGET_H8300SX\"\n-  \"muls.w\\\\t%T2,%T0\"\n-  [(set_attr \"length\" \"2\")\n-   (set_attr \"cc\" \"set_zn\")])\n-\n-(define_insn \"mulsi3\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-        (mult:SI (match_operand:SI 1 \"register_operand\" \"%0\")\n-\t\t (match_operand:SI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n-  \"TARGET_H8300SX\"\n-  \"muls.l\\\\t%S2,%S0\"\n+  { return <MODE>mode == HImode ? \"muls.w\\\\t%T2,%T0\" : \"muls.l\\\\t%S2,%S0\"; }\n   [(set_attr \"length\" \"2\")\n    (set_attr \"cc\" \"set_zn\")])\n \n@@ -1485,36 +1448,20 @@\n ;; DIVIDE/MOD INSTRUCTIONS\n ;; ----------------------------------------------------------------------\n \n-(define_insn \"udivhi3\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n-\t(udiv:HI (match_operand:HI 1 \"register_operand\" \"0\")\n-\t\t (match_operand:HI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n+(define_insn \"udiv<mode>3\"\n+  [(set (match_operand:HSI 0 \"register_operand\" \"=r\")\n+\t(udiv:HSI (match_operand:HSI 1 \"register_operand\" \"0\")\n+\t\t  (match_operand:HSI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n   \"TARGET_H8300SX\"\n-  \"divu.w\\\\t%T2,%T0\"\n+  { return <MODE>mode == HImode ? \"divu.w\\\\t%T2,%T0\" : \"divu.l\\\\t%S2,%S0\"; }\n   [(set_attr \"length\" \"2\")])\n \n-(define_insn \"divhi3\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n-\t(div:HI (match_operand:HI 1 \"register_operand\" \"0\")\n-\t\t(match_operand:HI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n+(define_insn \"div<mode>3\"\n+  [(set (match_operand:HSI 0 \"register_operand\" \"=r\")\n+\t(div:HSI (match_operand:HSI 1 \"register_operand\" \"0\")\n+\t\t (match_operand:HSI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n   \"TARGET_H8300SX\"\n-  \"divs.w\\\\t%T2,%T0\"\n-  [(set_attr \"length\" \"2\")])\n-\n-(define_insn \"udivsi3\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(udiv:SI (match_operand:SI 1 \"register_operand\" \"0\")\n-\t\t (match_operand:SI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n-  \"TARGET_H8300SX\"\n-  \"divu.l\\\\t%S2,%S0\"\n-  [(set_attr \"length\" \"2\")])\n-\n-(define_insn \"divsi3\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(div:SI (match_operand:SI 1 \"register_operand\" \"0\")\n-\t\t(match_operand:SI 2 \"reg_or_nibble_operand\" \"r IP4>X\")))]\n-  \"TARGET_H8300SX\"\n-  \"divs.l\\\\t%S2,%S0\"\n+  { return <MODE>mode == HImode ? \"divs.w\\\\t%T2,%T0\" : \"divs.l\\\\t%S2,%S0\"; }\n   [(set_attr \"length\" \"2\")])\n \n (define_insn \"udivmodqi4\"\n@@ -1671,47 +1618,44 @@\n   \"\"\n   \"\")\n \n-(define_insn \"*andorqi3\"\n-  [(set (match_operand:QI 0 \"register_operand\" \"=r\")\n-\t(ior:QI (and:QI (match_operand:QI 2 \"register_operand\" \"r\")\n-\t\t\t(match_operand:QI 3 \"single_one_operand\" \"n\"))\n-\t\t(match_operand:QI 1 \"register_operand\" \"0\")))]\n-  \"\"\n-  \"bld\\\\t%V3,%X2\\;bor\\\\t%V3,%X0\\;bst\\\\t%V3,%X0\"\n-  [(set_attr \"length\" \"6\")])\n+(define_insn \"*andor<mode>3\"\n+  [(set (match_operand:QHSI 0 \"register_operand\" \"=r\")\n+\t(ior:QHSI (and:QHSI (match_operand:QHSI 2 \"register_operand\" \"r\")\n+\t\t\t    (match_operand:QHSI 3 \"single_one_operand\" \"n\"))\n+\t\t  (match_operand:QHSI 1 \"register_operand\" \"0\")))]\n+  \"(<MODE>mode == QImode\n+    || <MODE>mode == HImode\n+    || (<MODE>mode == SImode\n+\t&& (INTVAL (operands[3]) & 0xffff) != 0))\"\n+  {\n+    if (<MODE>mode == QImode)\n+      return \"bld\\\\t%V3,%X2\\;bor\\\\t%V3,%X0\\;bst\\\\t%V3,%X0\";\n \n-(define_insn \"*andorhi3\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r\")\n-\t(ior:HI (and:HI (match_operand:HI 2 \"register_operand\" \"r\")\n-\t\t\t(match_operand:HI 3 \"single_one_operand\" \"n\"))\n-\t\t(match_operand:HI 1 \"register_operand\" \"0\")))]\n-  \"\"\n-{\n-  operands[3] = GEN_INT (INTVAL (operands[3]) & 0xffff);\n-  if (INTVAL (operands[3]) > 128)\n-    {\n-      operands[3] = GEN_INT (INTVAL (operands[3]) >> 8);\n-      return \"bld\\\\t%V3,%t2\\;bor\\\\t%V3,%t0\\;bst\\\\t%V3,%t0\";\n-    }\n-  return \"bld\\\\t%V3,%s2\\;bor\\\\t%V3,%s0\\;bst\\\\t%V3,%s0\";\n-}\n-  [(set_attr \"length\" \"6\")])\n+    if (<MODE>mode == HImode)\n+      {\n+\toperands[3] = GEN_INT (INTVAL (operands[3]) & 0xffff);\n+\tif (INTVAL (operands[3]) > 128)\n+\t  {\n+\t    operands[3] = GEN_INT (INTVAL (operands[3]) >> 8);\n+\t    return \"bld\\\\t%V3,%t2\\;bor\\\\t%V3,%t0\\;bst\\\\t%V3,%t0\";\n+\t  }\n+\treturn \"bld\\\\t%V3,%s2\\;bor\\\\t%V3,%s0\\;bst\\\\t%V3,%s0\";\n+      }\n \n-(define_insn \"*andorsi3\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(ior:SI (and:SI (match_operand:SI 2 \"register_operand\" \"r\")\n-\t\t\t(match_operand:SI 3 \"single_one_operand\" \"n\"))\n-\t\t(match_operand:SI 1 \"register_operand\" \"0\")))]\n-  \"(INTVAL (operands[3]) & 0xffff) != 0\"\n-{\n-  operands[3] = GEN_INT (INTVAL (operands[3]) & 0xffff);\n-  if (INTVAL (operands[3]) > 128)\n-    {\n-      operands[3] = GEN_INT (INTVAL (operands[3]) >> 8);\n-      return \"bld\\\\t%V3,%x2\\;bor\\\\t%V3,%x0\\;bst\\\\t%V3,%x0\";\n-    }\n-  return \"bld\\\\t%V3,%w2\\;bor\\\\t%V3,%w0\\;bst\\\\t%V3,%w0\";\n-}\n+    if (<MODE>mode == SImode)\n+      {\n+\toperands[3] = GEN_INT (INTVAL (operands[3]) & 0xffff);\n+\tif (INTVAL (operands[3]) > 128)\n+\t  {\n+\t    operands[3] = GEN_INT (INTVAL (operands[3]) >> 8);\n+\t    return \"bld\\\\t%V3,%x2\\;bor\\\\t%V3,%x0\\;bst\\\\t%V3,%x0\";\n+\t  }\n+\treturn \"bld\\\\t%V3,%w2\\;bor\\\\t%V3,%w0\\;bst\\\\t%V3,%w0\";\n+      }\n+\n+    gcc_unreachable ();\n+\t\n+  }\n   [(set_attr \"length\" \"6\")])\n \n (define_insn \"*andorsi3_shift_8\""}]}