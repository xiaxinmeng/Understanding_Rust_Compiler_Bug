{"sha": "c8338173d725ca0690f25f54e04171ed6cad6be9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzgzMzgxNzNkNzI1Y2EwNjkwZjI1ZjU0ZTA0MTcxZWQ2Y2FkNmJlOQ==", "commit": {"author": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2015-09-15T19:30:32Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gcc.gnu.org", "date": "2015-09-15T19:30:32Z"}, "message": "xtensa: fix xtensa_fallback_frame_state for call0 ABI\n\n2015-09-15  Max Filippov  <jcmvbkbc@gmail.com>\ngcc/\n\t* config/xtensa/xtensa.h (DWARF_ALT_FRAME_RETURN_COLUMN): New\n\tdefinition.\n\t(DWARF_FRAME_REGISTERS): Reserve space for one extra register in\n\tcall0 ABI.\n\nlibgcc/\n\t* config/xtensa/linux-unwind.h (xtensa_fallback_frame_state):\n\tAdd support for call0 ABI.\n\nFrom-SVN: r227809", "tree": {"sha": "803610303e599bef8722a38ee06d5bb81ced922e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/803610303e599bef8722a38ee06d5bb81ced922e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c8338173d725ca0690f25f54e04171ed6cad6be9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8338173d725ca0690f25f54e04171ed6cad6be9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8338173d725ca0690f25f54e04171ed6cad6be9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8338173d725ca0690f25f54e04171ed6cad6be9/comments", "author": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e1b8828bc8c162f376cd2ede28de3064673519e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1b8828bc8c162f376cd2ede28de3064673519e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1b8828bc8c162f376cd2ede28de3064673519e9"}], "stats": {"total": 46, "additions": 43, "deletions": 3}, "files": [{"sha": "6805c03973bd993d0351e3a6697846a974d76c00", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8338173d725ca0690f25f54e04171ed6cad6be9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8338173d725ca0690f25f54e04171ed6cad6be9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c8338173d725ca0690f25f54e04171ed6cad6be9", "patch": "@@ -1,3 +1,10 @@\n+2015-09-15  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* config/xtensa/xtensa.h (DWARF_ALT_FRAME_RETURN_COLUMN): New\n+\tdefinition.\n+\t(DWARF_FRAME_REGISTERS): Reserve space for one extra register in\n+\tcall0 ABI.\n+\n 2015-09-15  Max Filippov  <jcmvbkbc@gmail.com>\n \n \t* config/xtensa/xtensa.c (xtensa_call_tls_desc): Use a10 or a2"}, {"sha": "01d93e98b6c50731066a9b0519824f188ac6752a", "filename": "gcc/config/xtensa/xtensa.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8338173d725ca0690f25f54e04171ed6cad6be9/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8338173d725ca0690f25f54e04171ed6cad6be9/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.h?ref=c8338173d725ca0690f25f54e04171ed6cad6be9", "patch": "@@ -813,7 +813,9 @@ typedef struct xtensa_args\n    for debugging.  */\n #define INCOMING_RETURN_ADDR_RTX gen_rtx_REG (Pmode, 0)\n #define DWARF_FRAME_RETURN_COLUMN DWARF_FRAME_REGNUM (0)\n-#define DWARF_FRAME_REGISTERS 16\n+#define DWARF_ALT_FRAME_RETURN_COLUMN 16\n+#define DWARF_FRAME_REGISTERS (DWARF_ALT_FRAME_RETURN_COLUMN\t\t\\\n+\t\t\t       + (TARGET_WINDOWED_ABI ? 0 : 1))\n #define EH_RETURN_DATA_REGNO(N) ((N) < 2 ? (N) + 2 : INVALID_REGNUM)\n #define ASM_PREFERRED_EH_DATA_FORMAT(CODE, GLOBAL)\t\t\t\\\n   (flag_pic\t\t\t\t\t\t\t\t\\"}, {"sha": "472dd78c2c6a560e27cc4d61ccd14e6521ede1ce", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8338173d725ca0690f25f54e04171ed6cad6be9/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8338173d725ca0690f25f54e04171ed6cad6be9/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=c8338173d725ca0690f25f54e04171ed6cad6be9", "patch": "@@ -1,3 +1,8 @@\n+2015-09-15  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* config/xtensa/linux-unwind.h (xtensa_fallback_frame_state):\n+\tAdd support for call0 ABI.\n+\n 2015-09-13  John David Anglin  <danglin@gcc.gnu.org>\n \n \t* config/pa/fptr.c (SIGN_EXTEND): Cast -1 to unsigned."}, {"sha": "9a67b5d2b4614e9a09d4802f4111a2c148d59d20", "filename": "libgcc/config/xtensa/linux-unwind.h", "status": "modified", "additions": 28, "deletions": 2, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8338173d725ca0690f25f54e04171ed6cad6be9/libgcc%2Fconfig%2Fxtensa%2Flinux-unwind.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8338173d725ca0690f25f54e04171ed6cad6be9/libgcc%2Fconfig%2Fxtensa%2Flinux-unwind.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fxtensa%2Flinux-unwind.h?ref=c8338173d725ca0690f25f54e04171ed6cad6be9", "patch": "@@ -52,7 +52,6 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #define ENTRY_BYTE 0x36\n #endif\n \n-#ifdef __XTENSA_WINDOWED_ABI__\n #define MD_FALLBACK_FRAME_STATE_FOR xtensa_fallback_frame_state\n \n static _Unwind_Reason_Code\n@@ -61,6 +60,10 @@ xtensa_fallback_frame_state (struct _Unwind_Context *context,\n {\n   unsigned char *pc = context->ra;\n   struct sigcontext *sc;\n+#if defined(__XTENSA_CALL0_ABI__)\n+  _Unwind_Ptr new_cfa;\n+  int i;\n+#endif\n \n   struct rt_sigframe {\n     siginfo_t info;\n@@ -76,6 +79,7 @@ xtensa_fallback_frame_state (struct _Unwind_Context *context,\n       || pc[5] != SYSC_BYTE2)\n     return _URC_END_OF_STACK;\n \n+#if defined(__XTENSA_WINDOWED_ABI__)\n   rt_ = context->sp;\n   sc = &rt_->uc.uc_mcontext;\n   fs->signal_regs = (_Unwind_Word *) sc->sc_a;\n@@ -90,11 +94,33 @@ xtensa_fallback_frame_state (struct _Unwind_Context *context,\n    }\n   else\n     fs->signal_ra = sc->sc_pc;\n+#elif defined(__XTENSA_CALL0_ABI__)\n+  rt_ = context->cfa;\n+  sc = &rt_->uc.uc_mcontext;\n+\n+  new_cfa = (_Unwind_Ptr) sc;\n+  fs->regs.cfa_how = CFA_REG_OFFSET;\n+  fs->regs.cfa_reg = __LIBGCC_STACK_POINTER_REGNUM__;\n+  fs->regs.cfa_offset = new_cfa - (_Unwind_Ptr) context->cfa;\n+\n+  for (i = 0; i < 16; i++)\n+    {\n+      fs->regs.reg[i].how = REG_SAVED_OFFSET;\n+      fs->regs.reg[i].loc.offset = (_Unwind_Ptr) &(sc->sc_a[i]) - new_cfa;\n+    }\n+\n+  fs->regs.reg[__LIBGCC_DWARF_ALT_FRAME_RETURN_COLUMN__].how =\n+    REG_SAVED_VAL_OFFSET;\n+  fs->regs.reg[__LIBGCC_DWARF_ALT_FRAME_RETURN_COLUMN__].loc.offset =\n+    (_Unwind_Ptr) (sc->sc_pc) - new_cfa;\n+  fs->retaddr_column = __LIBGCC_DWARF_ALT_FRAME_RETURN_COLUMN__;\n+#else\n+#error Unsupported Xtensa ABI\n+#endif\n \n   fs->signal_frame = 1;\n   return _URC_NO_REASON;\n }\n \n-#endif /* __XTENSA_WINDOWED_ABI__ */\n \n #endif /* ifdef inhibit_libc  */"}]}