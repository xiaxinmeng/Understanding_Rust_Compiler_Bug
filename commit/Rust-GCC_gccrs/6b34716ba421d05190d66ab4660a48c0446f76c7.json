{"sha": "6b34716ba421d05190d66ab4660a48c0446f76c7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmIzNDcxNmJhNDIxZDA1MTkwZDY2YWI0NjYwYTQ4YzA0NDZmNzZjNw==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-07-13T15:33:27Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-07-13T15:33:27Z"}, "message": "[PR c++/86374] Name lookup failure in enclosing template\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-07/msg00701.html\n\tPR c++/86374\n\t* pt.c (lookup_template_class_1): Use tsubst_aggr_type for\n\tcontexts that are classes.\n\t* parser.c (cp_parser_template_id): Combine entering_scope decl &\n\tinitializer.\n\n\tPR c++/86374\n\t* g++.dg/pr86374.C: New.\n\nFrom-SVN: r262637", "tree": {"sha": "10a7cb12aede7c35ae3a03774338d1323e23b47b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10a7cb12aede7c35ae3a03774338d1323e23b47b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6b34716ba421d05190d66ab4660a48c0446f76c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b34716ba421d05190d66ab4660a48c0446f76c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b34716ba421d05190d66ab4660a48c0446f76c7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b34716ba421d05190d66ab4660a48c0446f76c7/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b2272b138c1e7f6a1cb867d614951d516f88a9f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2272b138c1e7f6a1cb867d614951d516f88a9f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2272b138c1e7f6a1cb867d614951d516f88a9f1"}], "stats": {"total": 51, "additions": 45, "deletions": 6}, "files": [{"sha": "1d5d66946f61cbd80333fc90882b0b231c911899", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=6b34716ba421d05190d66ab4660a48c0446f76c7", "patch": "@@ -1,3 +1,11 @@\n+2018-07-13  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/86374\n+\t* pt.c (lookup_template_class_1): Use tsubst_aggr_type for\n+\tcontexts that are classes.\n+\t* parser.c (cp_parser_template_id): Combine entering_scope decl &\n+\tinitializer.\n+\n 2018-07-12  Jakub Jelinek  <jakub@redhat.com>\n \n \t* decl2.c (cplus_decl_attributes): Don't diagnose vars without mappable"}, {"sha": "d0f1e1e97014ffaad3c04b87e57a5d1f79ce22d3", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=6b34716ba421d05190d66ab4660a48c0446f76c7", "patch": "@@ -15973,15 +15973,14 @@ cp_parser_template_id (cp_parser *parser,\n   else if (DECL_TYPE_TEMPLATE_P (templ)\n \t   || DECL_TEMPLATE_TEMPLATE_PARM_P (templ))\n     {\n-      bool entering_scope;\n       /* In \"template <typename T> ... A<T>::\", A<T> is the abstract A\n \t template (rather than some instantiation thereof) only if\n \t is not nested within some other construct.  For example, in\n \t \"template <typename T> void f(T) { A<T>::\", A<T> is just an\n \t instantiation of A.  */\n-      entering_scope = (template_parm_scope_p ()\n-\t\t\t&& cp_lexer_next_token_is (parser->lexer,\n-\t\t\t\t\t\t   CPP_SCOPE));\n+      bool entering_scope\n+\t= (template_parm_scope_p ()\n+\t   && cp_lexer_next_token_is (parser->lexer, CPP_SCOPE));\n       template_id\n \t= finish_template_type (templ, arguments, entering_scope);\n     }"}, {"sha": "9de9f500e2a81a4b840144d6c3babdc42ac00e78", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=6b34716ba421d05190d66ab4660a48c0446f76c7", "patch": "@@ -9368,8 +9368,15 @@ lookup_template_class_1 (tree d1, tree arglist, tree in_decl, tree context,\n \t  return found;\n \t}\n \n-      context = tsubst (DECL_CONTEXT (gen_tmpl), arglist,\n-\t\t\tcomplain, in_decl);\n+      context = DECL_CONTEXT (gen_tmpl);\n+      if (context && TYPE_P (context))\n+\t{\n+\t  context = tsubst_aggr_type (context, arglist, complain, in_decl, true);\n+\t  context = complete_type (context);\n+\t}\n+      else\n+\tcontext = tsubst (context, arglist, complain, in_decl);\n+\n       if (context == error_mark_node)\n \treturn error_mark_node;\n "}, {"sha": "1780ca0074ae0d60d6d97be2f74c13fc83f2e063", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6b34716ba421d05190d66ab4660a48c0446f76c7", "patch": "@@ -1,3 +1,8 @@\n+2018-07-13  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/86374\n+\t* g++.dg/pr86374.C: New.\n+\n 2018-07-13  Qing Zhao  <qing.zhao@oracle.com>\n \n \tPR middle-end/78809"}, {"sha": "fd7115626e10ea7ae5808cc82820449ffefc3b8c", "filename": "gcc/testsuite/g++.dg/pr86374.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr86374.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b34716ba421d05190d66ab4660a48c0446f76c7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr86374.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr86374.C?ref=6b34716ba421d05190d66ab4660a48c0446f76c7", "patch": "@@ -0,0 +1,20 @@\n+// pr C++/86374\n+// bogus lookup error\n+template<typename LIST>\n+struct list {\n+  static const int index = 1;\n+  template <typename> struct addWithChecking {};\n+};\n+\n+template<typename container, int ix = container::index>\n+struct find {\n+  static const int result = 0;\n+};\n+\n+template <class LIST>\n+template<class O>\n+struct list<LIST>::addWithChecking<O*>\n+{\n+  static const int xres =\n+    find<list<LIST> >::result; // bogus error about index here.\n+};"}]}