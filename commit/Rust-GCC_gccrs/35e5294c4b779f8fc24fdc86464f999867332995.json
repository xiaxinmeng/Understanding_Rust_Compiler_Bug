{"sha": "35e5294c4b779f8fc24fdc86464f999867332995", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzVlNTI5NGM0Yjc3OWY4ZmMyNGZkYzg2NDY0Zjk5OTg2NzMzMjk5NQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-08-11T15:16:21Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-08-11T15:16:21Z"}, "message": "libstdc++: Fix <stop_token> to compile without gthreads\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/stop_token: Check _GLIBCXX_HAS_GTHREADS using\n\t#ifdef instead of #if.\n\t(stop_token::_S_yield()): Check _GLIBCXX_HAS_GTHREADS before\n\tusing __gthread_yield.", "tree": {"sha": "d4eea7286c05c275e55e0ef6d11723068128fcf2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d4eea7286c05c275e55e0ef6d11723068128fcf2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35e5294c4b779f8fc24fdc86464f999867332995", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35e5294c4b779f8fc24fdc86464f999867332995", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35e5294c4b779f8fc24fdc86464f999867332995", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35e5294c4b779f8fc24fdc86464f999867332995/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5bbb1f3000c57fd4d95969b30fa0e35be6d54ffb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5bbb1f3000c57fd4d95969b30fa0e35be6d54ffb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5bbb1f3000c57fd4d95969b30fa0e35be6d54ffb"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "ccec6fab15cf648e401cc687c70130f765fbd060", "filename": "libstdc++-v3/include/std/stop_token", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35e5294c4b779f8fc24fdc86464f999867332995/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstop_token", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35e5294c4b779f8fc24fdc86464f999867332995/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstop_token", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstop_token?ref=35e5294c4b779f8fc24fdc86464f999867332995", "patch": "@@ -105,7 +105,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     {\n #if defined __i386__ || defined __x86_64__\n       __builtin_ia32_pause();\n-#elif defined _GLIBCXX_USE_SCHED_YIELD\n+#elif defined _GLIBCXX_HAS_GTHREADS && defined _GLIBCXX_USE_SCHED_YIELD\n       __gthread_yield();\n #endif\n     }\n@@ -162,7 +162,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       std::atomic<value_type> _M_owners{1};\n       std::atomic<value_type> _M_value{_S_ssrc_counter_inc};\n       _Stop_cb* _M_head = nullptr;\n-#if _GLIBCXX_HAS_GTHREADS\n+#ifdef _GLIBCXX_HAS_GTHREADS\n       __gthread_t _M_requester;\n #endif\n \n@@ -237,7 +237,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  }\n \twhile (!_M_try_lock_and_stop(__old));\n \n-#if _GLIBCXX_HAS_GTHREADS\n+#ifdef _GLIBCXX_HAS_GTHREADS\n \t_M_requester = __gthread_self();\n #endif\n \n@@ -266,7 +266,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t    if (!__destroyed)\n \t      {\n \t\t__cb->_M_destroyed = nullptr;\n-#if _GLIBCXX_HAS_GTHREADS\n+#ifdef _GLIBCXX_HAS_GTHREADS\n \t\t// synchronize with destructor of stop_callback that owns *__cb\n \t\t__cb->_M_done.release();\n #endif\n@@ -343,7 +343,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t// Callback is not in the list, so must have been removed by a call to\n \t// _M_request_stop.\n \n-#if _GLIBCXX_HAS_GTHREADS\n+#ifdef _GLIBCXX_HAS_GTHREADS\n \t// Despite appearances there is no data race on _M_requester. The only\n \t// write to it happens before the callback is removed from the list,\n \t// and removing it from the list happens before this read."}]}