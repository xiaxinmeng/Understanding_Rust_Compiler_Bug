{"sha": "2be9064dedcf93581e0596151454573d8c37f8be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmJlOTA2NGRlZGNmOTM1ODFlMDU5NjE1MTQ1NDU3M2Q4YzM3ZjhiZQ==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2012-09-28T12:21:33Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2012-09-28T12:21:33Z"}, "message": "PR c++/53551 - -Wunused-local-typedefs misses uses\n\nWe don't record the use of a typedef when it's used through a\ntypename.  Fixed thus.\n\nTested on x86_64-unknown-linux-gnu against trunk.\n\ngcc/cp/\n\n\t* decl.c (make_typename_type): Record the use of typedefs.\n\ngcc/testsuite/\n\n\t* g++.dg/warn/Wunused-local-typedefs-2.C: New test.\n\nFrom-SVN: r191828", "tree": {"sha": "40e84a8147b996e9dd05c89c447b2b45ebe33990", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/40e84a8147b996e9dd05c89c447b2b45ebe33990"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2be9064dedcf93581e0596151454573d8c37f8be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2be9064dedcf93581e0596151454573d8c37f8be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2be9064dedcf93581e0596151454573d8c37f8be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2be9064dedcf93581e0596151454573d8c37f8be/comments", "author": null, "committer": null, "parents": [{"sha": "42bace41fde0f50013e0522a3a00f8ae89313d65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42bace41fde0f50013e0522a3a00f8ae89313d65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42bace41fde0f50013e0522a3a00f8ae89313d65"}], "stats": {"total": 34, "additions": 33, "deletions": 1}, "files": [{"sha": "78325900c8943c1557c2fbd081d277e5dc2e98da", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2be9064dedcf93581e0596151454573d8c37f8be", "patch": "@@ -1,3 +1,8 @@\n+2012-09-25  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/53551 - -Wunused-local-typedefs misses uses\n+\t* decl.c (make_typename_type): Record the use of typedefs.\n+\n 2012-09-27  Jakub Jelinek  <jakub@redhat.com>\n \n \t* init.c (build_new_1): Don't test TREE_CONSTANT"}, {"sha": "a7bb9379c3626ad3a07c5c57bc15aa4f4e66fae5", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=2be9064dedcf93581e0596151454573d8c37f8be", "patch": "@@ -3326,7 +3326,9 @@ make_typename_type (tree context, tree name, enum tag_types tag_type,\n   \n   if (DECL_ARTIFICIAL (t) || !(complain & tf_keep_type_decl))\n     t = TREE_TYPE (t);\n-  \n+\n+  maybe_record_typedef_use (t);\n+\n   return t;\n }\n "}, {"sha": "e9bd0b3f0724b1b869a8fc7a590bcbeb6f199323", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2be9064dedcf93581e0596151454573d8c37f8be", "patch": "@@ -1,3 +1,8 @@\n+2012-09-25  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/53551 - -Wunused-local-typedefs misses uses\n+\t* g++.dg/warn/Wunused-local-typedefs-2.C: New test.\n+\n 2012-09-28  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/54716"}, {"sha": "073e253c98ca580843b8cc34a7cfd8dd33620552", "filename": "gcc/testsuite/g++.dg/warn/Wunused-local-typedefs-2.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-local-typedefs-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2be9064dedcf93581e0596151454573d8c37f8be/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-local-typedefs-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-local-typedefs-2.C?ref=2be9064dedcf93581e0596151454573d8c37f8be", "patch": "@@ -0,0 +1,20 @@\n+// Origin PR c++/33255\n+// { dg-options \"-Wunused\" } <-- should trigger -Wunused-local-typedefs\n+// { dg-do compile { target c++11 } }\n+\n+template <typename C>\n+struct structure\n+{\n+    typename C::type val;\n+};\n+\n+int\n+main()\n+{\n+  struct context\n+  {\n+      using type = int;\n+  };\n+\n+  return structure<context>{42}.val;\n+}"}]}