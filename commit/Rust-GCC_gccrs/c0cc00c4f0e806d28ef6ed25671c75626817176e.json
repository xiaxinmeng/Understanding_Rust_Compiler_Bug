{"sha": "c0cc00c4f0e806d28ef6ed25671c75626817176e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzBjYzAwYzRmMGU4MDZkMjhlZjZlZDI1NjcxYzc1NjI2ODE3MTc2ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-12-21T09:11:29Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-12-21T09:11:29Z"}, "message": "re PR rtl-optimization/82973 (ICE in output_constant_pool_2, at varasm.c:3896 on aarch64)\n\n\tPR rtl-optimization/82973\n\t* emit-rtl.h (valid_for_const_vec_duplicate_p): Rename to ...\n\t(valid_for_const_vector_p): ... this.\n\t* emit-rtl.c (valid_for_const_vec_duplicate_p): Rename to ...\n\t(valid_for_const_vector_p): ... this.  Adjust function comment.\n\t(gen_vec_duplicate): Adjust caller.\n\t* optabs.c (expand_vector_broadcast): Likewise.\n\t* simplify-rtx.c (simplify_const_unary_operation): Don't optimize into\n\tCONST_VECTOR if some element isn't simplified valid_for_const_vector_p\n\tconstant.\n\t(simplify_const_binary_operation): Likewise.  Use CONST_FIXED_P macro\n\tinstead of GET_CODE == CONST_FIXED.\n\t(simplify_subreg): Use CONST_FIXED_P macro instead of\n\tGET_CODE == CONST_FIXED.\n\n\t* gfortran.dg/pr82973.f90: New test.\n\nFrom-SVN: r255938", "tree": {"sha": "96de9ce0a7aa2e5bdfd3caba7293470f524e76d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96de9ce0a7aa2e5bdfd3caba7293470f524e76d6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c0cc00c4f0e806d28ef6ed25671c75626817176e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0cc00c4f0e806d28ef6ed25671c75626817176e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0cc00c4f0e806d28ef6ed25671c75626817176e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0cc00c4f0e806d28ef6ed25671c75626817176e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b1ccd09a7786c047a02f6eae42d431483be6a0ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1ccd09a7786c047a02f6eae42d431483be6a0ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1ccd09a7786c047a02f6eae42d431483be6a0ea"}], "stats": {"total": 40, "additions": 29, "deletions": 11}, "files": [{"sha": "c411e4906db0079ff6e5d35f31e8bf5dfc1496b5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c0cc00c4f0e806d28ef6ed25671c75626817176e", "patch": "@@ -1,5 +1,20 @@\n 2017-12-21  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR rtl-optimization/82973\n+\t* emit-rtl.h (valid_for_const_vec_duplicate_p): Rename to ...\n+\t(valid_for_const_vector_p): ... this.\n+\t* emit-rtl.c (valid_for_const_vec_duplicate_p): Rename to ...\n+\t(valid_for_const_vector_p): ... this.  Adjust function comment.\n+\t(gen_vec_duplicate): Adjust caller.\n+\t* optabs.c (expand_vector_broadcast): Likewise.\n+\t* simplify-rtx.c (simplify_const_unary_operation): Don't optimize into\n+\tCONST_VECTOR if some element isn't simplified valid_for_const_vector_p\n+\tconstant.\n+\t(simplify_const_binary_operation): Likewise.  Use CONST_FIXED_P macro\n+\tinstead of GET_CODE == CONST_FIXED.\n+\t(simplify_subreg): Use CONST_FIXED_P macro instead of\n+\tGET_CODE == CONST_FIXED.\n+\n \tPR target/83488\n \t* config/i386/i386.c (ix86_target_string): Move -mavx512vbmi2 and\n \t-mshstk entries from isa_opts2 to isa_opts and -mhle, -mmovbe,"}, {"sha": "53693bdfa742935466907ba2dd23118c2e98c3a7", "filename": "gcc/emit-rtl.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Femit-rtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Femit-rtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Femit-rtl.c?ref=c0cc00c4f0e806d28ef6ed25671c75626817176e", "patch": "@@ -5861,11 +5861,11 @@ init_emit (void)\n #endif\n }\n \n-/* Return true if X is a valid element for a duplicated vector constant\n-   of the given mode.  */\n+/* Return true if X is a valid element for a CONST_VECTOR of the given\n+  mode.  */\n \n bool\n-valid_for_const_vec_duplicate_p (machine_mode, rtx x)\n+valid_for_const_vector_p (machine_mode, rtx x)\n {\n   return (CONST_SCALAR_INT_P (x)\n \t  || CONST_DOUBLE_AS_FLOAT_P (x)\n@@ -5907,7 +5907,7 @@ gen_const_vec_duplicate (machine_mode mode, rtx elt)\n rtx\n gen_vec_duplicate (machine_mode mode, rtx x)\n {\n-  if (valid_for_const_vec_duplicate_p (mode, x))\n+  if (valid_for_const_vector_p (mode, x))\n     return gen_const_vec_duplicate (mode, x);\n   return gen_rtx_VEC_DUPLICATE (mode, x);\n }"}, {"sha": "b8c2f8cbe2e4c92f41af2ba3c52bb3f5d43e89df", "filename": "gcc/emit-rtl.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Femit-rtl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Femit-rtl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Femit-rtl.h?ref=c0cc00c4f0e806d28ef6ed25671c75626817176e", "patch": "@@ -439,7 +439,7 @@ get_max_uid (void)\n   return crtl->emit.x_cur_insn_uid;\n }\n \n-extern bool valid_for_const_vec_duplicate_p (machine_mode, rtx);\n+extern bool valid_for_const_vector_p (machine_mode, rtx);\n extern rtx gen_const_vec_duplicate (machine_mode, rtx);\n extern rtx gen_vec_duplicate (machine_mode, rtx);\n "}, {"sha": "225e9558bc3256bf0fabe4419a4328e4b0427fdb", "filename": "gcc/optabs.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Foptabs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Foptabs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs.c?ref=c0cc00c4f0e806d28ef6ed25671c75626817176e", "patch": "@@ -377,7 +377,7 @@ expand_vector_broadcast (machine_mode vmode, rtx op)\n \n   gcc_checking_assert (VECTOR_MODE_P (vmode));\n \n-  if (valid_for_const_vec_duplicate_p (vmode, op))\n+  if (valid_for_const_vector_p (vmode, op))\n     return gen_const_vec_duplicate (vmode, op);\n \n   icode = optab_handler (vec_duplicate_optab, vmode);"}, {"sha": "4f9796c7c84bede12550c8492a38bf502ba4248f", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=c0cc00c4f0e806d28ef6ed25671c75626817176e", "patch": "@@ -1768,7 +1768,7 @@ simplify_const_unary_operation (enum rtx_code code, machine_mode mode,\n \t  rtx x = simplify_unary_operation (code, GET_MODE_INNER (mode),\n \t\t\t\t\t    CONST_VECTOR_ELT (op, i),\n \t\t\t\t\t    GET_MODE_INNER (opmode));\n-\t  if (!x)\n+\t  if (!x || !valid_for_const_vector_p (mode, x))\n \t    return 0;\n \t  RTVEC_ELT (v, i) = x;\n \t}\n@@ -4030,7 +4030,7 @@ simplify_const_binary_operation (enum rtx_code code, machine_mode mode,\n \t  rtx x = simplify_binary_operation (code, GET_MODE_INNER (mode),\n \t\t\t\t\t     CONST_VECTOR_ELT (op0, i),\n \t\t\t\t\t     CONST_VECTOR_ELT (op1, i));\n-\t  if (!x)\n+\t  if (!x || !valid_for_const_vector_p (mode, x))\n \t    return 0;\n \t  RTVEC_ELT (v, i) = x;\n \t}\n@@ -4041,11 +4041,11 @@ simplify_const_binary_operation (enum rtx_code code, machine_mode mode,\n   if (VECTOR_MODE_P (mode)\n       && code == VEC_CONCAT\n       && (CONST_SCALAR_INT_P (op0)\n-\t  || GET_CODE (op0) == CONST_FIXED\n+\t  || CONST_FIXED_P (op0)\n \t  || CONST_DOUBLE_AS_FLOAT_P (op0))\n       && (CONST_SCALAR_INT_P (op1)\n \t  || CONST_DOUBLE_AS_FLOAT_P (op1)\n-\t  || GET_CODE (op1) == CONST_FIXED))\n+\t  || CONST_FIXED_P (op1)))\n     {\n       unsigned n_elts = GET_MODE_NUNITS (mode);\n       rtvec v = rtvec_alloc (n_elts);\n@@ -6268,7 +6268,7 @@ simplify_subreg (machine_mode outermode, rtx op,\n \n   if (CONST_SCALAR_INT_P (op)\n       || CONST_DOUBLE_AS_FLOAT_P (op)\n-      || GET_CODE (op) == CONST_FIXED\n+      || CONST_FIXED_P (op)\n       || GET_CODE (op) == CONST_VECTOR)\n     {\n       /* simplify_immed_subreg deconstructs OP into bytes and constructs"}, {"sha": "932ff87b7ff9dbc6a885f818ca674c7742d8d9d2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc00c4f0e806d28ef6ed25671c75626817176e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c0cc00c4f0e806d28ef6ed25671c75626817176e", "patch": "@@ -1,5 +1,8 @@\n 2017-12-21  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR rtl-optimization/82973\n+\t* gfortran.dg/pr82973.f90: New test.\n+\n \tPR target/83488\n \t* gcc.target/i386/pr83488.c: New test.\n "}]}