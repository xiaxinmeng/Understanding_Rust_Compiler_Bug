{"sha": "e79bde6ada42a47b0a266f1cc85efb2eed44e45a", "node_id": "C_kwDOANBUbNoAKGU3OWJkZTZhZGE0MmE0N2IwYTI2NmYxY2M4NWVmYjJlZWQ0NGU0NWE", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-05-13T13:30:26Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-10-01T19:36:55Z"}, "message": "libstdc++: Implement LWG 3529 for std::priority_queue\n\nThe LWG 3529 issue changes to use two overloads instead of one with a\ndefault argument, so that the sequence can be initialized directly with\nthe iterator range when no sequence argument is provided.\n\nSigned-off-by: Jonathan Wakely <jwakely@redhat.com>\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/bits/stl_queue.h (priority_queue): Construct sequence\n\tfrom iterators when no sequence argument is present (LWG 3529).\n\t* testsuite/23_containers/priority_queue/lwg3529.cc: New test.", "tree": {"sha": "650c70d3f9b92e4aa619f2abf7e968ff009ee927", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/650c70d3f9b92e4aa619f2abf7e968ff009ee927"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e79bde6ada42a47b0a266f1cc85efb2eed44e45a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e79bde6ada42a47b0a266f1cc85efb2eed44e45a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e79bde6ada42a47b0a266f1cc85efb2eed44e45a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e79bde6ada42a47b0a266f1cc85efb2eed44e45a/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e5c093e515c4d1745ea3887da21a49d196475da6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5c093e515c4d1745ea3887da21a49d196475da6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5c093e515c4d1745ea3887da21a49d196475da6"}], "stats": {"total": 28, "additions": 24, "deletions": 4}, "files": [{"sha": "f801ebda77f2ccb49874949a9f61185ae545baea", "filename": "libstdc++-v3/include/bits/stl_queue.h", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e79bde6ada42a47b0a266f1cc85efb2eed44e45a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_queue.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e79bde6ada42a47b0a266f1cc85efb2eed44e45a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_queue.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_queue.h?ref=e79bde6ada42a47b0a266f1cc85efb2eed44e45a", "patch": "@@ -594,13 +594,21 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  std::make_heap(c.begin(), c.end(), comp);\n \t}\n #else\n+      // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+      // 3529. priority_queue(first, last) should construct c with (first, last)\n+      template<typename _InputIterator,\n+\t       typename = std::_RequireInputIter<_InputIterator>>\n+\tpriority_queue(_InputIterator __first, _InputIterator __last,\n+\t\t       const _Compare& __x = _Compare())\n+\t: c(__first, __last), comp(__x)\n+\t{ std::make_heap(c.begin(), c.end(), comp); }\n+\n       // _GLIBCXX_RESOLVE_LIB_DEFECTS\n       // 3522. Missing requirement on InputIterator template parameter\n       template<typename _InputIterator,\n \t       typename = std::_RequireInputIter<_InputIterator>>\n \tpriority_queue(_InputIterator __first, _InputIterator __last,\n-\t\t       const _Compare& __x,\n-\t\t       const _Sequence& __s)\n+\t\t       const _Compare& __x, const _Sequence& __s)\n \t: c(__s), comp(__x)\n \t{\n \t  __glibcxx_requires_valid_range(__first, __last);\n@@ -611,8 +619,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       template<typename _InputIterator,\n \t       typename = std::_RequireInputIter<_InputIterator>>\n \tpriority_queue(_InputIterator __first, _InputIterator __last,\n-\t\t       const _Compare& __x = _Compare(),\n-\t\t       _Sequence&& __s = _Sequence())\n+\t\t       const _Compare& __x, _Sequence&& __s)\n \t: c(std::move(__s)), comp(__x)\n \t{\n \t  __glibcxx_requires_valid_range(__first, __last);"}, {"sha": "014b5aa0f350ab294a37daf1b5688e09cb5e9ab7", "filename": "libstdc++-v3/testsuite/23_containers/priority_queue/lwg3529.cc", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e79bde6ada42a47b0a266f1cc85efb2eed44e45a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fpriority_queue%2Flwg3529.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e79bde6ada42a47b0a266f1cc85efb2eed44e45a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fpriority_queue%2Flwg3529.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fpriority_queue%2Flwg3529.cc?ref=e79bde6ada42a47b0a266f1cc85efb2eed44e45a", "patch": "@@ -0,0 +1,13 @@\n+// { dg-do compile { target c++11 } }\n+\n+#include <queue>\n+\n+struct C : std::vector<int>\n+{\n+  C(int*, int*) { }\n+};\n+\n+int i;\n+\n+// LWG 3529. priority_queue(first, last) should construct c with (first, last)\n+std::priority_queue<int, C> q(&i, &i);"}]}