{"sha": "6ef1366a5516de64a6fcf35014359aba9d631c9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmVmMTM2NmE1NTE2ZGU2NGE2ZmNmMzUwMTQzNTlhYmE5ZDYzMWM5YQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-02-25T09:02:32Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-02-25T09:02:32Z"}, "message": "re PR fortran/78238 ([OOP] ICE: verify_gimple failed, with -fdefault-integer-8)\n\n2018-02-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/78238\n\t* gfortran.h (gfc_integer_4_kind): Define.\n\t* resolve.c (resolve_select_type): Make sure that the\n\tkind of c->high is gfc_integer_4_kind.\n\n2018-02-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/78238\n\t* gfortran.dg/select_type_40.f90: New test.\n\nFrom-SVN: r257968", "tree": {"sha": "befc8dea5057c1f1971a4e3fae6cb2061f649b52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/befc8dea5057c1f1971a4e3fae6cb2061f649b52"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ef1366a5516de64a6fcf35014359aba9d631c9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef1366a5516de64a6fcf35014359aba9d631c9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ef1366a5516de64a6fcf35014359aba9d631c9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef1366a5516de64a6fcf35014359aba9d631c9a/comments", "author": null, "committer": null, "parents": [{"sha": "c7aff3bc8b277abc714f03772ad79e37c85cdaae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7aff3bc8b277abc714f03772ad79e37c85cdaae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7aff3bc8b277abc714f03772ad79e37c85cdaae"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "78e3c2e164de1b8b5877f31774d424a3dd4d5e96", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=6ef1366a5516de64a6fcf35014359aba9d631c9a", "patch": "@@ -1,3 +1,10 @@\n+2018-02-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/78238\n+\t* gfortran.h (gfc_integer_4_kind): Define.\n+\t* resolve.c (resolve_select_type): Make sure that the\n+\tkind of c->high is gfc_integer_4_kind.\n+\n 2018-02-24  Steven G. Kargl <kargl@gcc.gnu.org>\n \n \tPR fortran/30792"}, {"sha": "94f7399885ac09758bd13f0ac150c4383f3c456d", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=6ef1366a5516de64a6fcf35014359aba9d631c9a", "patch": "@@ -2921,6 +2921,7 @@ extern int gfc_numeric_storage_size;\n extern int gfc_character_storage_size;\n \n #define gfc_logical_4_kind 4\n+#define gfc_integer_4_kind 4\n \n /* symbol.c */\n void gfc_clear_new_implicit (void);"}, {"sha": "6869bce2edb735a078b95a93b9730e7961e7fcc7", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=6ef1366a5516de64a6fcf35014359aba9d631c9a", "patch": "@@ -8961,7 +8961,7 @@ resolve_select_type (gfc_code *code, gfc_namespace *old_ns)\n \t    {\n \t      vtab = gfc_find_derived_vtab (c->ts.u.derived);\n \t      gcc_assert (vtab);\n-\t      c->high = gfc_get_int_expr (gfc_default_integer_kind, NULL,\n+\t      c->high = gfc_get_int_expr (gfc_integer_4_kind, NULL,\n \t\t\t\t\t  c->ts.u.derived->hash_value);\n \t    }\n \t  else\n@@ -8970,6 +8970,13 @@ resolve_select_type (gfc_code *code, gfc_namespace *old_ns)\n \t      gcc_assert (vtab && CLASS_DATA (vtab)->initializer);\n \t      e = CLASS_DATA (vtab)->initializer;\n \t      c->high = gfc_copy_expr (e);\n+\t      if (c->high->ts.kind != gfc_integer_4_kind)\n+\t\t{\n+\t\t  gfc_typespec ts;\n+\t\t  ts.kind = gfc_integer_4_kind;\n+\t\t  ts.type = BT_INTEGER;\n+\t\t  gfc_convert_type_warn (c->high, &ts, 2, 0);\n+\t\t}\n \t    }\n \n \t  e = gfc_lval_expr_from_sym (vtab);"}, {"sha": "0f8219d0717d254aaf5799050ea1cccda85853c8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6ef1366a5516de64a6fcf35014359aba9d631c9a", "patch": "@@ -1,3 +1,8 @@\n+2018-02-25  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/78238\n+\t* gfortran.dg/select_type_40.f90: New test.\n+\n 2018-02-24  Steven G. Kargl <kargl@gcc.gnu.org>\n \n \tPR fortran/30792"}, {"sha": "4bfa1c7e848a426bff0d52f8a9a70ce7e2a47c9e", "filename": "gcc/testsuite/gfortran.dg/select_type_40.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_type_40.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef1366a5516de64a6fcf35014359aba9d631c9a/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_type_40.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_type_40.f90?ref=6ef1366a5516de64a6fcf35014359aba9d631c9a", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+! { dg-additional-options \"-fdefault-integer-8\" }\n+! PR 78238 - this used to cause an ICE.\n+! Original test cae by Gerhard Steinmetz\n+class(*), allocatable :: q\n+select type (x => q)\n+type is (real)\n+end select\n+end"}]}