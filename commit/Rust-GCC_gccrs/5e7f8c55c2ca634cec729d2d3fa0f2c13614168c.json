{"sha": "5e7f8c55c2ca634cec729d2d3fa0f2c13614168c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWU3ZjhjNTVjMmNhNjM0Y2VjNzI5ZDJkM2ZhMGYyYzEzNjE0MTY4Yw==", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2020-04-27T00:09:43Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2020-04-27T00:47:27Z"}, "message": "libphobos: Remove AC_CACHE_CHECK from network library tests.\n\nlibphobos/ChangeLog:\n\n\t* configure: Regenerate.\n\t* m4/druntime/libraries.m4 (DRUNTIME_LIBRARIES_NET): Remove\n\tAC_CACHE_CHECK, simplify by setting LIBS directly.", "tree": {"sha": "7d4caa43c42855c73bb46372b810b4d726dfd7e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7d4caa43c42855c73bb46372b810b4d726dfd7e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "873b5de87c3186d85bb497b0f9c13b8c5e425712", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/873b5de87c3186d85bb497b0f9c13b8c5e425712", "html_url": "https://github.com/Rust-GCC/gccrs/commit/873b5de87c3186d85bb497b0f9c13b8c5e425712"}], "stats": {"total": 154, "additions": 72, "deletions": 82}, "files": [{"sha": "98d8dc255c1fead651acbac82481fd9281ec83ed", "filename": "libphobos/configure", "status": "modified", "additions": 48, "deletions": 55, "changes": 103, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c/libphobos%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c/libphobos%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fconfigure?ref=5e7f8c55c2ca634cec729d2d3fa0f2c13614168c", "patch": "@@ -14932,120 +14932,113 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n fi\n \n \n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for socket libraries\" >&5\n-$as_echo_n \"checking for socket libraries... \" >&6; }\n-if ${druntime_cv_lib_sockets+:} false; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-  druntime_cv_lib_sockets=\n-     druntime_check_both=no\n-     ac_fn_c_check_func \"$LINENO\" \"connect\" \"ac_cv_func_connect\"\n+                            druntime_check_both=no\n+  ac_fn_c_check_func \"$LINENO\" \"connect\" \"ac_cv_func_connect\"\n if test \"x$ac_cv_func_connect\" = xyes; then :\n-  druntime_check_socket=no\n-else\n-  druntime_check_socket=yes\n-fi\n \n-     if test \"$druntime_check_socket\" = \"yes\"; then\n-       unset ac_cv_func_connect\n-       { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for main in -lsocket\" >&5\n-$as_echo_n \"checking for main in -lsocket... \" >&6; }\n-if ${ac_cv_lib_socket_main+:} false; then :\n+else\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for connect in -lsocket\" >&5\n+$as_echo_n \"checking for connect in -lsocket... \" >&6; }\n+if ${ac_cv_lib_socket_connect+:} false; then :\n   $as_echo_n \"(cached) \" >&6\n else\n   ac_check_lib_save_LIBS=$LIBS\n LIBS=\"-lsocket  $LIBS\"\n cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n /* end confdefs.h.  */\n \n-\n+/* Override any GCC internal prototype to avoid an error.\n+   Use char because int might match the return type of a GCC\n+   builtin and then its argument prototype would still apply.  */\n+#ifdef __cplusplus\n+extern \"C\"\n+#endif\n+char connect ();\n int\n main ()\n {\n-return main ();\n+return connect ();\n   ;\n   return 0;\n }\n _ACEOF\n if ac_fn_c_try_link \"$LINENO\"; then :\n-  ac_cv_lib_socket_main=yes\n+  ac_cv_lib_socket_connect=yes\n else\n-  ac_cv_lib_socket_main=no\n+  ac_cv_lib_socket_connect=no\n fi\n rm -f core conftest.err conftest.$ac_objext \\\n     conftest$ac_exeext conftest.$ac_ext\n LIBS=$ac_check_lib_save_LIBS\n fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_main\" >&5\n-$as_echo \"$ac_cv_lib_socket_main\" >&6; }\n-if test \"x$ac_cv_lib_socket_main\" = xyes; then :\n-  druntime_cv_lib_sockets=\"-lsocket\"\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_socket_connect\" >&5\n+$as_echo \"$ac_cv_lib_socket_connect\" >&6; }\n+if test \"x$ac_cv_lib_socket_connect\" = xyes; then :\n+  LIBS=\"$LIBS -lsocket\"\n else\n   druntime_check_both=yes\n fi\n \n-     fi\n-     if test \"$druntime_check_both\" = \"yes\"; then\n-       druntime_old_libs=$LIBS\n-       LIBS=\"$LIBS -lsocket -lnsl\"\n-       unset ac_cv_func_accept\n-       ac_fn_c_check_func \"$LINENO\" \"accept\" \"ac_cv_func_accept\"\n+fi\n+\n+  if test \"$druntime_check_both\" = \"yes\"; then\n+    druntime_old_libs=$LIBS\n+    LIBS=\"$LIBS -lsocket -lnsl\"\n+    ac_fn_c_check_func \"$LINENO\" \"accept\" \"ac_cv_func_accept\"\n if test \"x$ac_cv_func_accept\" = xyes; then :\n-  druntime_check_nsl=no\n-\t\t      druntime_cv_lib_sockets=\"-lsocket -lnsl\"\n+\n+else\n+  LIBS=$druntime_old_libs\n fi\n \n-       unset ac_cv_func_accept\n-       LIBS=$druntime_old_libs\n-     fi\n-     unset ac_cv_func_gethostbyname\n-     druntime_old_libs=\"$LIBS\"\n-     ac_fn_c_check_func \"$LINENO\" \"gethostbyname\" \"ac_cv_func_gethostbyname\"\n+  fi\n+  ac_fn_c_check_func \"$LINENO\" \"gethostbyname\" \"ac_cv_func_gethostbyname\"\n if test \"x$ac_cv_func_gethostbyname\" = xyes; then :\n \n else\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for main in -lnsl\" >&5\n-$as_echo_n \"checking for main in -lnsl... \" >&6; }\n-if ${ac_cv_lib_nsl_main+:} false; then :\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for gethostbyname in -lnsl\" >&5\n+$as_echo_n \"checking for gethostbyname in -lnsl... \" >&6; }\n+if ${ac_cv_lib_nsl_gethostbyname+:} false; then :\n   $as_echo_n \"(cached) \" >&6\n else\n   ac_check_lib_save_LIBS=$LIBS\n LIBS=\"-lnsl  $LIBS\"\n cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n /* end confdefs.h.  */\n \n-\n+/* Override any GCC internal prototype to avoid an error.\n+   Use char because int might match the return type of a GCC\n+   builtin and then its argument prototype would still apply.  */\n+#ifdef __cplusplus\n+extern \"C\"\n+#endif\n+char gethostbyname ();\n int\n main ()\n {\n-return main ();\n+return gethostbyname ();\n   ;\n   return 0;\n }\n _ACEOF\n if ac_fn_c_try_link \"$LINENO\"; then :\n-  ac_cv_lib_nsl_main=yes\n+  ac_cv_lib_nsl_gethostbyname=yes\n else\n-  ac_cv_lib_nsl_main=no\n+  ac_cv_lib_nsl_gethostbyname=no\n fi\n rm -f core conftest.err conftest.$ac_objext \\\n     conftest$ac_exeext conftest.$ac_ext\n LIBS=$ac_check_lib_save_LIBS\n fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl_main\" >&5\n-$as_echo \"$ac_cv_lib_nsl_main\" >&6; }\n-if test \"x$ac_cv_lib_nsl_main\" = xyes; then :\n-  druntime_cv_lib_sockets=\"$druntime_cv_lib_sockets -lnsl\"\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_nsl_gethostbyname\" >&5\n+$as_echo \"$ac_cv_lib_nsl_gethostbyname\" >&6; }\n+if test \"x$ac_cv_lib_nsl_gethostbyname\" = xyes; then :\n+  LIBS=\"$LIBS -lnsl\"\n fi\n \n fi\n \n \n-fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $druntime_cv_lib_sockets\" >&5\n-$as_echo \"$druntime_cv_lib_sockets\" >&6; }\n-  LIBS=\"$LIBS $druntime_cv_lib_sockets\"\n-\n \n   # Keep this in sync with core/thread.d, set druntime_fiber_asm_external to\n   # \"yes\" for targets that have 'version = AsmExternal'."}, {"sha": "743d3e3e17c776ff540d0010097c62f5ba70eab5", "filename": "libphobos/m4/druntime/libraries.m4", "status": "modified", "additions": 24, "deletions": 27, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c/libphobos%2Fm4%2Fdruntime%2Flibraries.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5e7f8c55c2ca634cec729d2d3fa0f2c13614168c/libphobos%2Fm4%2Fdruntime%2Flibraries.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fm4%2Fdruntime%2Flibraries.m4?ref=5e7f8c55c2ca634cec729d2d3fa0f2c13614168c", "patch": "@@ -21,33 +21,30 @@ AC_DEFUN([DRUNTIME_LIBRARIES_DLOPEN],\n # Autodetect and add networking library to LIBS if necessary.\n AC_DEFUN([DRUNTIME_LIBRARIES_NET],\n [\n-  dnl Test for -lsocket and -lnsl.  Copied from libjava/configure.ac.\n-  AC_CACHE_CHECK([for socket libraries], druntime_cv_lib_sockets,\n-    [druntime_cv_lib_sockets=\n-     druntime_check_both=no\n-     AC_CHECK_FUNC(connect, druntime_check_socket=no, druntime_check_socket=yes)\n-     if test \"$druntime_check_socket\" = \"yes\"; then\n-       unset ac_cv_func_connect\n-       AC_CHECK_LIB(socket, main, druntime_cv_lib_sockets=\"-lsocket\",\n-\t\t    druntime_check_both=yes)\n-     fi\n-     if test \"$druntime_check_both\" = \"yes\"; then\n-       druntime_old_libs=$LIBS\n-       LIBS=\"$LIBS -lsocket -lnsl\"\n-       unset ac_cv_func_accept\n-       AC_CHECK_FUNC(accept,\n-\t\t     [druntime_check_nsl=no\n-\t\t      druntime_cv_lib_sockets=\"-lsocket -lnsl\"])\n-       unset ac_cv_func_accept\n-       LIBS=$druntime_old_libs\n-     fi\n-     unset ac_cv_func_gethostbyname\n-     druntime_old_libs=\"$LIBS\"\n-     AC_CHECK_FUNC(gethostbyname, ,\n-\t\t   [AC_CHECK_LIB(nsl, main,\n-\t\t    [druntime_cv_lib_sockets=\"$druntime_cv_lib_sockets -lnsl\"])])\n-  ])\n-  LIBS=\"$LIBS $druntime_cv_lib_sockets\"\n+  dnl Check for the existence of the -lsocket and -lnsl libraries.\n+  dnl The order here is important, so that they end up in the right\n+  dnl order in the command line generated by make.  Here are some\n+  dnl special considerations:\n+  dnl 1. Use \"connect\" and \"accept\" to check for -lsocket, and\n+  dnl    \"gethostbyname\" to check for -lnsl.\n+  dnl 2. Use each function name only once:  can't redo a check because\n+  dnl    autoconf caches the results of the last check and won't redo it.\n+  dnl 3. Use -lnsl and -lsocket only if they supply procedures that\n+  dnl    aren't already present in the normal libraries.\n+  dnl 4. On some systems, can't use -lsocket without -lnsl too.\n+  dnl    To get around this problem, check for both libraries together\n+  dnl    if -lsocket doesn't work by itself.\n+  druntime_check_both=no\n+  AC_CHECK_FUNC(connect, ,\n+\t[AC_CHECK_LIB(socket, connect,\n+\t LIBS=\"$LIBS -lsocket\", druntime_check_both=yes)])\n+  if test \"$druntime_check_both\" = \"yes\"; then\n+    druntime_old_libs=$LIBS\n+    LIBS=\"$LIBS -lsocket -lnsl\"\n+    AC_CHECK_FUNC(accept, , LIBS=$druntime_old_libs)\n+  fi\n+  AC_CHECK_FUNC(gethostbyname, ,\n+\t[AC_CHECK_LIB(nsl, gethostbyname, LIBS=\"$LIBS -lnsl\")])\n ])\n \n # DRUNTIME_LIBRARIES_ZLIB"}]}