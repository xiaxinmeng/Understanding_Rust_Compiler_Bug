{"sha": "f3665bd1111c1799c0421490b5e655f977570354", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjM2NjViZDExMTFjMTc5OWMwNDIxNDkwYjVlNjU1Zjk3NzU3MDM1NA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-07-28T15:57:36Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-07-28T16:01:32Z"}, "message": "c++: Set more DECL_CONTEXTs\n\nI discovered we were not setting DECL_CONTEXT in a few cases, and\ngrokfndecl's control flow wasn't making it clear that we were doing it\nin all cases.\n\n\tgcc/cp/\n\t* cp-gimplify.c (cp_genericize_r): Set IMPORTED_DECL's context.\n\t* cp-objcp-common.c (cp_pushdecl): Set decl's context.\n\t* decl.c (grokfndecl): Make DECL_CONTEXT setting clearer.", "tree": {"sha": "57a656ea045c750c559b5af198cc0301b2275ad4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/57a656ea045c750c559b5af198cc0301b2275ad4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f3665bd1111c1799c0421490b5e655f977570354", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3665bd1111c1799c0421490b5e655f977570354", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f3665bd1111c1799c0421490b5e655f977570354", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3665bd1111c1799c0421490b5e655f977570354/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0cd58a9f091b39c5e41b7954d6c4bd88f3567d49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cd58a9f091b39c5e41b7954d6c4bd88f3567d49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0cd58a9f091b39c5e41b7954d6c4bd88f3567d49"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "f8695835684ce6a6e2adf0245fd0ce5a520d08d9", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3665bd1111c1799c0421490b5e655f977570354/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3665bd1111c1799c0421490b5e655f977570354/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=f3665bd1111c1799c0421490b5e655f977570354", "patch": "@@ -1495,6 +1495,7 @@ cp_genericize_r (tree *stmt_p, int *walk_subtrees, void *data)\n \t      {\n \t\ttree using_directive = make_node (IMPORTED_DECL);\n \t\tTREE_TYPE (using_directive) = void_type_node;\n+\t\tDECL_CONTEXT (using_directive) = current_function_decl;\n \n \t\tIMPORTED_DECL_ASSOCIATED_DECL (using_directive) = decl;\n \t\tDECL_CHAIN (using_directive) = BLOCK_VARS (block);"}, {"sha": "fecf866988047136e293c2f27cb8697e3963ae05", "filename": "gcc/cp/cp-objcp-common.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3665bd1111c1799c0421490b5e655f977570354/gcc%2Fcp%2Fcp-objcp-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3665bd1111c1799c0421490b5e655f977570354/gcc%2Fcp%2Fcp-objcp-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-objcp-common.c?ref=f3665bd1111c1799c0421490b5e655f977570354", "patch": "@@ -332,11 +332,12 @@ cp_get_global_decls ()\n   return NAMESPACE_LEVEL (global_namespace)->names;\n }\n \n-/* Push DECL into the current scope.  */\n+/* Push DECL into the current (namespace) scope.  */\n \n tree\n cp_pushdecl (tree decl)\n {\n+  DECL_CONTEXT (decl) = FROB_CONTEXT (current_namespace);\n   return pushdecl (decl);\n }\n "}, {"sha": "b4beaa94257bc1818dae6f72ea95757d21adc0d4", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3665bd1111c1799c0421490b5e655f977570354/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3665bd1111c1799c0421490b5e655f977570354/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=f3665bd1111c1799c0421490b5e655f977570354", "patch": "@@ -9560,7 +9560,9 @@ grokfndecl (tree ctype,\n   /* If this decl has namespace scope, set that up.  */\n   if (in_namespace)\n     set_decl_namespace (decl, in_namespace, friendp);\n-  else if (!ctype)\n+  else if (ctype)\n+    DECL_CONTEXT (decl) = ctype;\n+  else\n     DECL_CONTEXT (decl) = FROB_CONTEXT (current_decl_namespace ());\n \n   /* `main' and builtins have implicit 'C' linkage.  */\n@@ -9588,12 +9590,8 @@ grokfndecl (tree ctype,\n   if (deletedp)\n     DECL_DELETED_FN (decl) = 1;\n \n-  if (ctype)\n-    {\n-      DECL_CONTEXT (decl) = ctype;\n-      if (funcdef_flag)\n-\tcheck_class_member_definition_namespace (decl);\n-    }\n+  if (ctype && funcdef_flag)\n+    check_class_member_definition_namespace (decl);\n \n   if (ctype == NULL_TREE && DECL_MAIN_P (decl))\n     {"}]}