{"sha": "e4dc7c6572d50dd9de2331521b8e8ac39d905527", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTRkYzdjNjU3MmQ1MGRkOWRlMjMzMTUyMWI4ZThhYzM5ZDkwNTUyNw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2019-09-13T05:41:01Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2019-09-13T05:41:01Z"}, "message": "re PR fortran/91717 (ICE on concatenating deferred-length character and character literal)\n\n2019-09-13  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/91717\n\t* dependency.c (gfc_dep_resolver): Flag identical components\n\tand exit with return value 1 if set and no array refs.\n\n2019-09-13  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/91717\n\t* gfortran.dg/dependency_55.f90 : New test.\n\nFrom-SVN: r275696", "tree": {"sha": "d0b22c7addbf9d5be31b672e7444714a188f4c6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d0b22c7addbf9d5be31b672e7444714a188f4c6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e4dc7c6572d50dd9de2331521b8e8ac39d905527", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4dc7c6572d50dd9de2331521b8e8ac39d905527", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e4dc7c6572d50dd9de2331521b8e8ac39d905527", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4dc7c6572d50dd9de2331521b8e8ac39d905527/comments", "author": null, "committer": null, "parents": [{"sha": "e5b3c74bf0686faf3932249a9756c6d3145a1531", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5b3c74bf0686faf3932249a9756c6d3145a1531", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5b3c74bf0686faf3932249a9756c6d3145a1531"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "bf721c7d43e832d22852a64d67899f454c3e764c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=e4dc7c6572d50dd9de2331521b8e8ac39d905527", "patch": "@@ -1,3 +1,9 @@\n+2019-09-13  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/91717\n+\t* dependency.c (gfc_dep_resolver): Flag identical components\n+\tand exit with return value 1 if set and no array refs.\n+\n 2019-09-11  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/91553"}, {"sha": "51148709766fb9261dc2c9d95299644fe9390265", "filename": "gcc/fortran/dependency.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ffortran%2Fdependency.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ffortran%2Fdependency.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdependency.c?ref=e4dc7c6572d50dd9de2331521b8e8ac39d905527", "patch": "@@ -2096,6 +2096,7 @@ gfc_dep_resolver (gfc_ref *lref, gfc_ref *rref, gfc_reverse *reverse,\n   int m;\n   gfc_dependency fin_dep;\n   gfc_dependency this_dep;\n+  bool same_component = false;\n \n   this_dep = GFC_DEP_ERROR;\n   fin_dep = GFC_DEP_ERROR;\n@@ -2115,6 +2116,8 @@ gfc_dep_resolver (gfc_ref *lref, gfc_ref *rref, gfc_reverse *reverse,\n \t     components.  */\n \t  if (lref->u.c.component != rref->u.c.component)\n \t    return 0;\n+\n+\t  same_component = true;\n \t  break;\n \n \tcase REF_SUBSTRING:\n@@ -2280,6 +2283,10 @@ gfc_dep_resolver (gfc_ref *lref, gfc_ref *rref, gfc_reverse *reverse,\n   if (lref || rref)\n     return 1;\n \n+  /* This can result from concatenation of assumed length string components.  */\n+  if (same_component && fin_dep == GFC_DEP_ERROR)\n+    return 1;\n+\n   /* If we haven't seen any array refs then something went wrong.  */\n   gcc_assert (fin_dep != GFC_DEP_ERROR);\n "}, {"sha": "ab1d7bc9312fc719b78d1e3844ce22d1a94d46d3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e4dc7c6572d50dd9de2331521b8e8ac39d905527", "patch": "@@ -1,3 +1,8 @@\n+2019-09-13  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/91717\n+\t* gfortran.dg/dependency_55.f90 : New test.\n+\n 2019-09-12  Uro\u0161 Bizjak  <ubizjak@gmail.com>\n \n \tPR tree-optimization/89386"}, {"sha": "53898b3a34d7ed09a3a7014bd7e1e67bbdfde2db", "filename": "gcc/testsuite/gfortran.dg/dependency_55.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_55.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4dc7c6572d50dd9de2331521b8e8ac39d905527/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_55.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_55.f90?ref=e4dc7c6572d50dd9de2331521b8e8ac39d905527", "patch": "@@ -0,0 +1,18 @@\n+! { dg-do run }\n+!\n+! Test the fix for PR91717 in which the concatenation operation ICEd.\n+!\n+! Contributed by Damian Rouson  <damian@sourceryinstitute.org>\n+!\n+  type core\n+    character (len=:), allocatable :: msg\n+  end type\n+\n+  type(core) :: my_core\n+\n+  my_core%msg = \"\"\n+  my_core%msg = my_core%msg//\"my message is: \"\n+  my_core%msg = my_core%msg//\"Hello!\"\n+\n+  if (my_core%msg .ne. \"my message is: Hello!\") stop 1\n+end"}]}