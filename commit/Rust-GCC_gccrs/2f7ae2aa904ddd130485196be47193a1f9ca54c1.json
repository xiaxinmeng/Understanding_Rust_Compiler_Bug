{"sha": "2f7ae2aa904ddd130485196be47193a1f9ca54c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmY3YWUyYWE5MDRkZGQxMzA0ODUxOTZiZTQ3MTkzYTFmOWNhNTRjMQ==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2015-10-26T12:05:58Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-10-26T12:05:58Z"}, "message": "s-rident.ads (No_Dynamic_Sized_Objects): New restriction name.\n\n2015-10-26  Bob Duff  <duff@adacore.com>\n\n\t* s-rident.ads (No_Dynamic_Sized_Objects): New restriction name.\n\t* sem_util.ads, sem_util.adb (All_Composite_Constraints_Static):\n\tNew function to check that all relevant constraints are static.\n\t* sem_aggr.adb (Resolve_Array_Aggregate): Call\n\tAll_Composite_Constraints_Static on the bounds of named array\n\taggregates.\n\t* sem_ch3.adb (Analyze_Subtype_Declaration): Call\n\tAll_Composite_Constraints_Static if the type is composite and\n\tthe subtype is constrained.\n\nFrom-SVN: r229351", "tree": {"sha": "1d95cc7a4d666d55d629f1669ea80884b40a163b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d95cc7a4d666d55d629f1669ea80884b40a163b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f7ae2aa904ddd130485196be47193a1f9ca54c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f7ae2aa904ddd130485196be47193a1f9ca54c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f7ae2aa904ddd130485196be47193a1f9ca54c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f7ae2aa904ddd130485196be47193a1f9ca54c1/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "638f50548143c46e32bca3b9e38bfc8e9251672b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/638f50548143c46e32bca3b9e38bfc8e9251672b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/638f50548143c46e32bca3b9e38bfc8e9251672b"}], "stats": {"total": 131, "additions": 131, "deletions": 0}, "files": [{"sha": "47f60b5201b2220c8462843d11ed05f19c9a9777", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2f7ae2aa904ddd130485196be47193a1f9ca54c1", "patch": "@@ -1,3 +1,15 @@\n+2015-10-26  Bob Duff  <duff@adacore.com>\n+\n+\t* s-rident.ads (No_Dynamic_Sized_Objects): New restriction name.\n+\t* sem_util.ads, sem_util.adb (All_Composite_Constraints_Static):\n+\tNew function to check that all relevant constraints are static.\n+\t* sem_aggr.adb (Resolve_Array_Aggregate): Call\n+\tAll_Composite_Constraints_Static on the bounds of named array\n+\taggregates.\n+\t* sem_ch3.adb (Analyze_Subtype_Declaration): Call\n+\tAll_Composite_Constraints_Static if the type is composite and\n+\tthe subtype is constrained.\n+\n 2015-10-26  Javier Miranda  <miranda@adacore.com>\n \n \t* exp_ch6.adb (Expand_N_Subprogram_Declaration): Skip the frontend"}, {"sha": "446ddb9f4121b50d27f6ca210ff99c253533d8e9", "filename": "gcc/ada/s-rident.ads", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fs-rident.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fs-rident.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-rident.ads?ref=2f7ae2aa904ddd130485196be47193a1f9ca54c1", "patch": "@@ -171,6 +171,7 @@ package System.Rident is\n       --  units, it applies to all units in this extended main source.\n \n       Immediate_Reclamation,                     -- (RM H.4(10))\n+      No_Dynamic_Sized_Objects,                  -- GNAT\n       No_Implementation_Aspect_Specifications,   -- Ada 2012 AI-241\n       No_Implementation_Attributes,              -- Ada 2005 AI-257\n       No_Implementation_Identifiers,             -- Ada 2012 AI-246"}, {"sha": "60cd131987254729c43c30ca9b6b1021d5e53ad8", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=2f7ae2aa904ddd130485196be47193a1f9ca54c1", "patch": "@@ -42,6 +42,7 @@ with Nmake;    use Nmake;\n with Nlists;   use Nlists;\n with Opt;      use Opt;\n with Restrict; use Restrict;\n+with Rident;   use Rident;\n with Sem;      use Sem;\n with Sem_Aux;  use Sem_Aux;\n with Sem_Cat;  use Sem_Cat;\n@@ -1967,6 +1968,14 @@ package body Sem_Aggr is\n                      return Failure;\n                   end if;\n \n+                  if not (All_Composite_Constraints_Static (Low)\n+                            and then All_Composite_Constraints_Static (High)\n+                            and then All_Composite_Constraints_Static (S_Low)\n+                            and then All_Composite_Constraints_Static (S_High))\n+                  then\n+                     Check_Restriction (No_Dynamic_Sized_Objects, Choice);\n+                  end if;\n+\n                   Nb_Discrete_Choices := Nb_Discrete_Choices + 1;\n                   Table (Nb_Discrete_Choices).Lo := Low;\n                   Table (Nb_Discrete_Choices).Hi := High;"}, {"sha": "be4373678f3bd56f9853078e1ce3448b96c68cc2", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=2f7ae2aa904ddd130485196be47193a1f9ca54c1", "patch": "@@ -5227,6 +5227,31 @@ package body Sem_Ch3 is\n       end if;\n \n       Analyze_Dimension (N);\n+\n+      --  Check No_Dynamic_Sized_Objects restriction, which disallows subtype\n+      --  indications on composite types where the constraints are dynamic.\n+      --  Note that object declarations and aggregates generate implicit\n+      --  subtype declarations, which this covers. One special case is that the\n+      --  implicitly generated \"=\" for discriminated types includes an\n+      --  offending subtype declaration, which is harmless, so we ignore it\n+      --  here.\n+\n+      if Nkind (Subtype_Indication (N)) = N_Subtype_Indication then\n+         declare\n+            Cstr : constant Node_Id := Constraint (Subtype_Indication (N));\n+         begin\n+            if Nkind (Cstr) = N_Index_Or_Discriminant_Constraint\n+              and then not (Is_Internal (Defining_Identifier (N))\n+                              and then Is_TSS (Scope (Defining_Identifier (N)),\n+                                               TSS_Composite_Equality))\n+              and then not Within_Init_Proc\n+            then\n+               if not All_Composite_Constraints_Static (Cstr) then\n+                  Check_Restriction (No_Dynamic_Sized_Objects, Cstr);\n+               end if;\n+            end if;\n+         end;\n+      end if;\n    end Analyze_Subtype_Declaration;\n \n    --------------------------------"}, {"sha": "f27b855437e3cd3e955e37ca00ff3f6377e94a66", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 71, "deletions": 0, "changes": 71, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=2f7ae2aa904ddd130485196be47193a1f9ca54c1", "patch": "@@ -434,6 +434,77 @@ package body Sem_Util is\n       return Alignment (E) * System_Storage_Unit;\n    end Alignment_In_Bits;\n \n+   --------------------------------------\n+   -- All_Composite_Constraints_Static --\n+   --------------------------------------\n+\n+   function All_Composite_Constraints_Static\n+     (Constr : Node_Id) return Boolean\n+   is\n+   begin\n+      if No (Constr) or else Error_Posted (Constr) then\n+         return True;\n+      end if;\n+\n+      case Nkind (Constr) is\n+         when N_Subexpr =>\n+            if Nkind (Constr) in N_Has_Entity\n+              and then Present (Entity (Constr))\n+            then\n+               if Is_Type (Entity (Constr)) then\n+                  return not Is_Discrete_Type (Entity (Constr))\n+                    or else Is_OK_Static_Subtype (Entity (Constr));\n+               end if;\n+\n+            elsif Nkind (Constr) = N_Range then\n+               return Is_OK_Static_Expression (Low_Bound (Constr))\n+                 and then Is_OK_Static_Expression (High_Bound (Constr));\n+\n+            elsif Nkind (Constr) = N_Attribute_Reference\n+              and then Attribute_Name (Constr) = Name_Range\n+            then\n+               return Is_OK_Static_Expression\n+                   (Type_Low_Bound  (Etype (Prefix (Constr))))\n+                 and then Is_OK_Static_Expression\n+                   (Type_High_Bound (Etype (Prefix (Constr))));\n+            end if;\n+\n+            return not Present (Etype (Constr)) -- previous error\n+              or else not Is_Discrete_Type (Etype (Constr))\n+              or else Is_OK_Static_Expression (Constr);\n+\n+         when N_Discriminant_Association =>\n+            return All_Composite_Constraints_Static (Expression (Constr));\n+\n+         when N_Range_Constraint =>\n+            return All_Composite_Constraints_Static\n+              (Range_Expression (Constr));\n+\n+         when N_Index_Or_Discriminant_Constraint =>\n+            declare\n+               One_Cstr : Entity_Id;\n+            begin\n+               One_Cstr := First (Constraints (Constr));\n+               while Present (One_Cstr) loop\n+                  if not All_Composite_Constraints_Static (One_Cstr) then\n+                     return False;\n+                  end if;\n+\n+                  Next (One_Cstr);\n+               end loop;\n+            end;\n+\n+            return True;\n+\n+         when N_Subtype_Indication =>\n+            return All_Composite_Constraints_Static (Subtype_Mark (Constr))\n+              and then All_Composite_Constraints_Static (Constraint (Constr));\n+\n+         when others =>\n+            raise Program_Error;\n+      end case;\n+   end All_Composite_Constraints_Static;\n+\n    ---------------------------------\n    -- Append_Inherited_Subprogram --\n    ---------------------------------"}, {"sha": "c68eb086b5ad1d57151d76ffef20ba917edb4478", "filename": "gcc/ada/sem_util.ads", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_util.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f7ae2aa904ddd130485196be47193a1f9ca54c1/gcc%2Fada%2Fsem_util.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.ads?ref=2f7ae2aa904ddd130485196be47193a1f9ca54c1", "patch": "@@ -85,6 +85,19 @@ package Sem_Util is\n    --  Otherwise Uint_0 is returned, indicating that the alignment of the\n    --  entity is not yet known to the compiler.\n \n+   function All_Composite_Constraints_Static (Constr : Node_Id) return Boolean;\n+   --  Used to implement pragma Restrictions (No_Dynamic_Sized_Objects).\n+   --  Given a constraint or subtree of a constraint on a composite\n+   --  subtype/object, returns True if there are no nonstatic constraints,\n+   --  which might cause objects to be created with dynamic size.\n+   --  Called for subtype declarations (including implicit ones created for\n+   --  subtype indications in object declarations, as well as discriminated\n+   --  record aggregate cases). For record aggregates, only records containing\n+   --  discriminant-dependent arrays matter, because the discriminants must be\n+   --  static when governing a variant part. Access discriminants are\n+   --  irrelevant. Also called for array aggregates, but only named notation,\n+   --  because those are the only dynamic cases.\n+\n    procedure Append_Inherited_Subprogram (S : Entity_Id);\n    --  If the parent of the operation is declared in the visible part of\n    --  the current scope, the inherited operation is visible even though the"}]}