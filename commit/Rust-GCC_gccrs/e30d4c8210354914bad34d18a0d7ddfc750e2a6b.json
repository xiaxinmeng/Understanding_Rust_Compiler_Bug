{"sha": "e30d4c8210354914bad34d18a0d7ddfc750e2a6b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTMwZDRjODIxMDM1NDkxNGJhZDM0ZDE4YTBkN2RkZmM3NTBlMmE2Yg==", "commit": {"author": {"name": "Nicola Pero", "email": "n.pero@mi.flashnet.it", "date": "2002-09-06T15:25:35Z"}, "committer": {"name": "Nicola Pero", "email": "nicola@gcc.gnu.org", "date": "2002-09-06T15:25:35Z"}, "message": "Fixed bugs in the ObjC -gen-decls option\n\nFrom-SVN: r56884", "tree": {"sha": "462cd10569e2889ff9910939e125a0a5fe8c3ccf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/462cd10569e2889ff9910939e125a0a5fe8c3ccf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e30d4c8210354914bad34d18a0d7ddfc750e2a6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e30d4c8210354914bad34d18a0d7ddfc750e2a6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e30d4c8210354914bad34d18a0d7ddfc750e2a6b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e30d4c8210354914bad34d18a0d7ddfc750e2a6b/comments", "author": null, "committer": null, "parents": [{"sha": "fcd5374808d93c9f009df243712f8c431a9f5b0c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcd5374808d93c9f009df243712f8c431a9f5b0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcd5374808d93c9f009df243712f8c431a9f5b0c"}], "stats": {"total": 57, "additions": 46, "deletions": 11}, "files": [{"sha": "b7bbfa1b413563e995f67b1216e46bbcd28e2fd5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e30d4c8210354914bad34d18a0d7ddfc750e2a6b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e30d4c8210354914bad34d18a0d7ddfc750e2a6b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e30d4c8210354914bad34d18a0d7ddfc750e2a6b", "patch": "@@ -1,3 +1,13 @@\n+Fri Sep  6 16:17:33 2002  Nicola Pero  <n.pero@mi.flashnet.it>\n+\n+\t* objc/objc-act.c (dump_interface): Enlarged the char * buffer to\n+\t10k.  Fixed category dumping - print out category names with the\n+\tproper syntax.  Print '@end\\n' and not '\\n@end' at the end of the\n+\tinterface.\n+        (finish_objc): Fixed the -gen-decls option.  It was printing out\n+\tonly the last class.  Dump an interface declaration of all classes\n+\tbeing compiled instead.\n+\n 2002-09-06  Jason Thorpe  <thorpej@wasabisystems.com>\n \n \t* config/arm/arm-protos.h (arm_gen_return_addr_mask): New "}, {"sha": "a9e02d9585be4c67747d7fb6b2ed2929b73f8a5e", "filename": "gcc/objc/objc-act.c", "status": "modified", "additions": 36, "deletions": 11, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e30d4c8210354914bad34d18a0d7ddfc750e2a6b/gcc%2Fobjc%2Fobjc-act.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e30d4c8210354914bad34d18a0d7ddfc750e2a6b/gcc%2Fobjc%2Fobjc-act.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-act.c?ref=e30d4c8210354914bad34d18a0d7ddfc750e2a6b", "patch": "@@ -7836,27 +7836,48 @@ gen_method_decl (method, buf)\n \f\n /* Debug info.  */\n \n+\n+/* Dump an @interface declaration of the supplied class CHAIN to the\n+   supplied file FP.  Used to implement the -gen-decls option (which\n+   prints out an @interface declaration of all classes compiled in\n+   this run); potentially useful for debugging the compiler too.  */\n static void\n dump_interface (fp, chain)\n      FILE *fp;\n      tree chain;\n {\n-  char *buf = (char *) xmalloc (256);\n+  /* FIXME: A heap overflow here whenever a method (or ivar)\n+     declaration is so long that it doesn't fit in the buffer.  The\n+     code and all the related functions should be rewritten to avoid\n+     using fixed size buffers.  */\n+  char *buf = (char *) xmalloc (1024 * 10);\n   const char *my_name = IDENTIFIER_POINTER (CLASS_NAME (chain));\n   tree ivar_decls = CLASS_RAW_IVARS (chain);\n   tree nst_methods = CLASS_NST_METHODS (chain);\n   tree cls_methods = CLASS_CLS_METHODS (chain);\n \n   fprintf (fp, \"\\n@interface %s\", my_name);\n \n+  /* CLASS_SUPER_NAME is used to store the superclass name for \n+     classes, and the category name for categories.  */\n   if (CLASS_SUPER_NAME (chain))\n     {\n-      const char *super_name = IDENTIFIER_POINTER (CLASS_SUPER_NAME (chain));\n-      fprintf (fp, \" : %s\\n\", super_name);\n+      const char *name = IDENTIFIER_POINTER (CLASS_SUPER_NAME (chain));\n+      \n+      if (TREE_CODE (chain) == CATEGORY_IMPLEMENTATION_TYPE \n+\t  || TREE_CODE (chain) == CATEGORY_INTERFACE_TYPE)\n+\t{\n+\t  fprintf (fp, \" (%s)\\n\", name);\n+\t}\n+      else\n+\t{\n+\t  fprintf (fp, \" : %s\\n\", name);\n+\t}\n     }\n   else\n     fprintf (fp, \"\\n\");\n \n+  /* FIXME - the following doesn't seem to work at the moment.  */\n   if (ivar_decls)\n     {\n       fprintf (fp, \"{\\n\");\n@@ -7880,7 +7901,8 @@ dump_interface (fp, chain)\n       fprintf (fp, \"+ %s;\\n\", gen_method_decl (cls_methods, buf));\n       cls_methods = TREE_CHAIN (cls_methods);\n     }\n-  fprintf (fp, \"\\n@end\");\n+\n+  fprintf (fp, \"@end\\n\");\n }\n \n /* Demangle function for Objective-C */\n@@ -8000,7 +8022,16 @@ finish_objc ()\n \n       UOBJC_CLASS_decl = impent->class_decl;\n       UOBJC_METACLASS_decl = impent->meta_decl;\n-\n+      \n+      /* Dump the @interface of each class as we compile it, if the\n+\t -gen-decls option is in use.  TODO: Dump the classes in the\n+         order they were found, rather than in reverse order as we\n+         are doing now.  */\n+      if (flag_gen_declaration)\n+\t{\n+\t  dump_interface (gen_declaration_file, objc_implementation_context);\n+\t}\n+      \n       if (TREE_CODE (objc_implementation_context) == CLASS_IMPLEMENTATION_TYPE)\n \t{\n \t  /* all of the following reference the string pool...  */\n@@ -8051,12 +8082,6 @@ finish_objc ()\n \n   generate_strings ();\n \n-  if (flag_gen_declaration)\n-    {\n-      add_class (objc_implementation_context);\n-      dump_interface (gen_declaration_file, objc_implementation_context);\n-    }\n-\n   if (warn_selector)\n     {\n       int slot;"}]}