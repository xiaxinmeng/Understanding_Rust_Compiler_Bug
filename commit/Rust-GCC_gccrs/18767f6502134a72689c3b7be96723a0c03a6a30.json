{"sha": "18767f6502134a72689c3b7be96723a0c03a6a30", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg3NjdmNjUwMjEzNGE3MjY4OWMzYjdiZTk2NzIzYTBjMDNhNmEzMA==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2014-08-20T23:07:29Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2014-08-20T23:07:29Z"}, "message": "re PR fortran/44054 (Handle -Werror, -Werror=, -fdiagnostics-show-option, !GCC$ diagnostic (pragmas) and color)\n\ngcc/ChangeLog:\n\n2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/44054\n\t* diagnostic.c (default_diagnostic_finalizer): Move caret printing\n\t to here ...\n\t(diagnostic_report_diagnostic): ... from here.\n\t* toplev.c (general_init): Move code to c-family.\n\ngcc/cp/ChangeLog:\n\n2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/44054\n\t* error.c (cp_diagnostic_finalizer): Delete.\n\t(init_error): Do not set diagnostic_finalizer here.\n\ngcc/c-family/ChangeLog:\n\n2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/44054\n\t* c-opts.c: Include tree-diagnostics.h.\n\t(c_diagnostic_finalizer): New.\n\t(c_common_initialize_diagnostics): Use it.\n\ngcc/fortran/ChangeLog:\n\n2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/44054\n\t* error.c (gfc_diagnostic_finalizer): Call default finalizer.\n\nFrom-SVN: r214245", "tree": {"sha": "3f03556a5974697ffb4bafd96217230d8739848a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3f03556a5974697ffb4bafd96217230d8739848a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18767f6502134a72689c3b7be96723a0c03a6a30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18767f6502134a72689c3b7be96723a0c03a6a30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18767f6502134a72689c3b7be96723a0c03a6a30", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18767f6502134a72689c3b7be96723a0c03a6a30/comments", "author": null, "committer": null, "parents": [{"sha": "22e6bd6f6c83773aad53732b5880eb07d9100499", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22e6bd6f6c83773aad53732b5880eb07d9100499", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22e6bd6f6c83773aad53732b5880eb07d9100499"}], "stats": {"total": 73, "additions": 50, "deletions": 23}, "files": [{"sha": "03599dfff0e51b4f3241488698fe60c0e7adc434", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -1,3 +1,11 @@\n+2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/44054\n+\t* diagnostic.c (default_diagnostic_finalizer): Move caret printing\n+\t to here ...\n+\t(diagnostic_report_diagnostic): ... from here.\n+\t* toplev.c (general_init): Move code to c-family.\n+\n 2014-08-20  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* df.h (web_entry_base): Replace existing struct web_entry with a"}, {"sha": "e8673b54d28775b3494c7d70d47962f232d97b55", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -1,3 +1,10 @@\n+2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/44054\n+\t* c-opts.c: Include tree-diagnostics.h.\n+\t(c_diagnostic_finalizer): New.\n+\t(c_common_initialize_diagnostics): Use it.\n+\n 2014-08-20  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n \n \tPR preprocessor/51303"}, {"sha": "5cae2b8e8d146e056111c3b7c1eddd9a48afac80", "filename": "gcc/c-family/c-opts.c", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fc-family%2Fc-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fc-family%2Fc-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-opts.c?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -28,6 +28,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"toplev.h\"\n #include \"langhooks.h\"\n #include \"diagnostic.h\"\n+#include \"tree-diagnostic.h\" /* for virt_loc_aware_diagnostic_finalizer */\n #include \"intl.h\"\n #include \"cppdefault.h\"\n #include \"incpath.h\"\n@@ -164,6 +165,19 @@ c_common_option_lang_mask (void)\n   return lang_flags[c_language];\n }\n \n+/* Diagnostic finalizer for C/C++/Objective-C/Objective-C++.  */\n+static void\n+c_diagnostic_finalizer (diagnostic_context *context,\n+\t\t\tdiagnostic_info *diagnostic)\n+{\n+  diagnostic_show_locus (context, diagnostic);\n+  /* By default print macro expansion contexts in the diagnostic\n+     finalizer -- for tokens resulting from macro expansion.  */\n+  virt_loc_aware_diagnostic_finalizer (context, diagnostic);\n+  pp_destroy_prefix (context->printer);\n+  pp_newline_and_flush (context->printer);\n+}\n+\n /* Common diagnostics initialization.  */\n void\n c_common_initialize_diagnostics (diagnostic_context *context)\n@@ -179,7 +193,7 @@ c_common_initialize_diagnostics (diagnostic_context *context)\n \t diagnostic message.  */\n       diagnostic_prefixing_rule (context) = DIAGNOSTICS_SHOW_PREFIX_ONCE;\n     }\n-\n+  diagnostic_finalizer (context) = c_diagnostic_finalizer;\n   context->opt_permissive = OPT_fpermissive;\n }\n "}, {"sha": "27e22497357757a24a3ac36345b476893c2bfc49", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -1,3 +1,9 @@\n+2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/44054\n+\t* error.c (cp_diagnostic_finalizer): Delete.\n+\t(init_error): Do not set diagnostic_finalizer here.\n+\n 2014-08-19  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/62153"}, {"sha": "9f0498dbb9900145f5f0409743cac87649006190", "filename": "gcc/cp/error.c", "status": "modified", "additions": 1, "deletions": 10, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fcp%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fcp%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ferror.c?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -99,7 +99,6 @@ static void print_instantiation_partial_context (diagnostic_context *,\n \t\t\t\t\t\t struct tinst_level *,\n \t\t\t\t\t\t location_t);\n static void cp_diagnostic_starter (diagnostic_context *, diagnostic_info *);\n-static void cp_diagnostic_finalizer (diagnostic_context *, diagnostic_info *);\n static void cp_print_error_function (diagnostic_context *, diagnostic_info *);\n \n static bool cp_printer (pretty_printer *, text_info *, const char *,\n@@ -109,7 +108,7 @@ void\n init_error (void)\n {\n   diagnostic_starter (global_dc) = cp_diagnostic_starter;\n-  diagnostic_finalizer (global_dc) = cp_diagnostic_finalizer;\n+  /* diagnostic_finalizer is already c_diagnostic_finalizer.  */\n   diagnostic_format_decoder (global_dc) = cp_printer;\n \n   new (cxx_pp) cxx_pretty_printer ();\n@@ -3041,14 +3040,6 @@ cp_diagnostic_starter (diagnostic_context *context,\n \t\t\t\t\t\t\t\t diagnostic));\n }\n \n-static void\n-cp_diagnostic_finalizer (diagnostic_context *context,\n-\t\t\t diagnostic_info *diagnostic)\n-{\n-  virt_loc_aware_diagnostic_finalizer (context, diagnostic);\n-  pp_destroy_prefix (context->printer);\n-}\n-\n /* Print current function onto BUFFER, in the process of reporting\n    a diagnostic message.  Called from cp_diagnostic_starter.  */\n static void"}, {"sha": "9e6bfe52bffb7cee1147fe6216c0c1936b59f52e", "filename": "gcc/diagnostic.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fdiagnostic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Fdiagnostic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.c?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -554,9 +554,12 @@ default_diagnostic_starter (diagnostic_context *context,\n }\n \n void\n-default_diagnostic_finalizer (diagnostic_context *context ATTRIBUTE_UNUSED,\n-\t\t\t      diagnostic_info *diagnostic ATTRIBUTE_UNUSED)\n+default_diagnostic_finalizer (diagnostic_context *context,\n+\t\t\t      diagnostic_info *diagnostic)\n {\n+  diagnostic_show_locus (context, diagnostic);\n+  pp_destroy_prefix (context->printer);\n+  pp_newline_and_flush (context->printer);\n }\n \n /* Interface to specify diagnostic kind overrides.  Returns the\n@@ -805,10 +808,7 @@ diagnostic_report_diagnostic (diagnostic_context *context,\n   pp_format (context->printer, &diagnostic->message);\n   (*diagnostic_starter (context)) (context, diagnostic);\n   pp_output_formatted_text (context->printer);\n-  diagnostic_show_locus (context, diagnostic);\n   (*diagnostic_finalizer (context)) (context, diagnostic);\n-  pp_destroy_prefix (context->printer);\n-  pp_newline_and_flush (context->printer);\n   diagnostic_action_after_output (context, diagnostic);\n   diagnostic->message.format_spec = saved_format_spec;\n   diagnostic->x_data = NULL;"}, {"sha": "d47bffc2a7fc3355b2e14cd3079f08d1ea8feee2", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -1,3 +1,8 @@\n+2014-08-21  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/44054\n+\t* error.c (gfc_diagnostic_finalizer): Call default finalizer.\n+\n 2014-08-20  Joost VandeVondele  <Joost.VandeVondele@mat.ethz.ch>\n \n \t* options.c (gfc_init_options_struct): assert that the frontend sets"}, {"sha": "7aab46d4311aa728174b5144f2914546bd22ccd5", "filename": "gcc/fortran/error.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Ffortran%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Ffortran%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ferror.c?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -1016,9 +1016,10 @@ gfc_diagnostic_starter (diagnostic_context *context,\n }\n \n static void\n-gfc_diagnostic_finalizer (diagnostic_context *context ATTRIBUTE_UNUSED,\n-\t\t\t  diagnostic_info *diagnostic ATTRIBUTE_UNUSED)\n+gfc_diagnostic_finalizer (diagnostic_context *context,\n+\t\t\t  diagnostic_info *diagnostic)\n {\n+  default_diagnostic_finalizer(context, diagnostic);\n }\n \n /* Give a warning about the command-line.  */"}, {"sha": "a7f4b581f42060dd426032e12d7b6774e0835dae", "filename": "gcc/toplev.c", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18767f6502134a72689c3b7be96723a0c03a6a30/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=18767f6502134a72689c3b7be96723a0c03a6a30", "patch": "@@ -1115,11 +1115,6 @@ general_init (const char *argv0)\n   /* Set a default printer.  Language specific initializations will\n      override it later.  */\n   tree_diagnostics_defaults (global_dc);\n-  /* FIXME: This should probably be moved to C-family\n-     language-specific initializations.  */\n-  /* By default print macro expansion contexts in the diagnostic\n-     finalizer -- for tokens resulting from macro expansion.  */\n-  diagnostic_finalizer (global_dc) = virt_loc_aware_diagnostic_finalizer;\n \n   global_dc->show_caret\n     = global_options_init.x_flag_diagnostics_show_caret;"}]}