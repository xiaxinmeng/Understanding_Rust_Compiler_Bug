{"sha": "ec5e99e95954fd629283a9c9572193dd95471fea", "node_id": "C_kwDOANBUbNoAKGVjNWU5OWU5NTk1NGZkNjI5MjgzYTljOTU3MjE5M2RkOTU0NzFmZWE", "commit": {"author": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2023-01-25T16:13:23Z"}, "committer": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2023-01-27T14:32:42Z"}, "message": "Do not try to logical fold floating point relations.\n\nrelation_fold_and_or looks for relations among common operands feeding\nlogical ands and ors.  With no knowledge of NANs, it should not attempt\nto do this with floating point ssa names.\n\n\tPR tree-optimization/108447\n\tgcc/\n\t* gimple-range-fold.cc (old_using_range::relation_fold_and_or):\n\tDo not attempt to fold HONOR_NAN types.\n\n\tgcc/testsuite/\n\t* gcc.dg/pr108447.c: New.", "tree": {"sha": "1f804bcdb9b53f05378f6e55acb7de69360e44a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f804bcdb9b53f05378f6e55acb7de69360e44a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ec5e99e95954fd629283a9c9572193dd95471fea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec5e99e95954fd629283a9c9572193dd95471fea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec5e99e95954fd629283a9c9572193dd95471fea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec5e99e95954fd629283a9c9572193dd95471fea/comments", "author": null, "committer": null, "parents": [{"sha": "3caa3a3f1a0dbf347d38eadf27f00a209f3030c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3caa3a3f1a0dbf347d38eadf27f00a209f3030c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3caa3a3f1a0dbf347d38eadf27f00a209f3030c4"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "9c5359a3fc6ea61ec4298650e4282f364e433e6f", "filename": "gcc/gimple-range-fold.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec5e99e95954fd629283a9c9572193dd95471fea/gcc%2Fgimple-range-fold.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec5e99e95954fd629283a9c9572193dd95471fea/gcc%2Fgimple-range-fold.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-range-fold.cc?ref=ec5e99e95954fd629283a9c9572193dd95471fea", "patch": "@@ -1039,6 +1039,9 @@ fold_using_range::relation_fold_and_or (irange& lhs_range, gimple *s,\n   if (!ssa1_dep1 || !ssa1_dep2 || !ssa2_dep1 || !ssa2_dep2)\n     return;\n \n+  if (HONOR_NANS (TREE_TYPE (ssa1_dep1)))\n+    return;\n+\n   // Make sure they are the same dependencies, and detect the order of the\n   // relationship.\n   bool reverse_op2 = true;"}, {"sha": "cfbaba6d0aaa98b4c6d2a12dd7ec89eea811d536", "filename": "gcc/testsuite/gcc.dg/pr108447.c", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec5e99e95954fd629283a9c9572193dd95471fea/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108447.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec5e99e95954fd629283a9c9572193dd95471fea/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108447.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108447.c?ref=ec5e99e95954fd629283a9c9572193dd95471fea", "patch": "@@ -0,0 +1,33 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O2\" } */\n+\n+__attribute__((noipa)) int\n+foo (float x, float y)\n+{\n+  _Bool cmp1 = x <= y;\n+  _Bool cmp2 = x >= y;\n+  if (cmp1 && cmp2)\n+    return 1;\n+  else if (!cmp1 && !cmp2)\n+    return -1;\n+  return 0;\n+}\n+\n+int\n+main ()\n+{\n+  if (foo (0.0f, __builtin_nanf (\"\")) != -1)\n+    __builtin_abort ();\n+  if (foo (__builtin_nanf (\"\"), -42.0f) != -1)\n+    __builtin_abort ();\n+  if (foo (0.0f, -0.0f) != 1)\n+    __builtin_abort ();\n+  if (foo (42.0f, 42.0f) != 1)\n+    __builtin_abort ();\n+  if (foo (42.0f, -0.0f) != 0)\n+    __builtin_abort ();\n+  if (foo (0.0f, -42.0f) != 0)\n+    __builtin_abort ();\n+  return 0;\n+}\n+"}]}