{"sha": "5d6358a57d44dbb7f07455124f463fcb8fab28fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWQ2MzU4YTU3ZDQ0ZGJiN2YwNzQ1NTEyNGY0NjNmY2I4ZmFiMjhmYw==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2011-04-28T23:28:56Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2011-04-28T23:28:56Z"}, "message": "rs6000.c (rs6000_delegitimize_address): Handle unspec plus offset.\n\n\t* config/rs6000/rs6000.c (rs6000_delegitimize_address): Handle\n\tunspec plus offset.  Tidy macho code.\n\nFrom-SVN: r173141", "tree": {"sha": "b327feacc699769b8c5ea296878a30467649e828", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b327feacc699769b8c5ea296878a30467649e828"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5d6358a57d44dbb7f07455124f463fcb8fab28fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d6358a57d44dbb7f07455124f463fcb8fab28fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d6358a57d44dbb7f07455124f463fcb8fab28fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d6358a57d44dbb7f07455124f463fcb8fab28fc/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "85ad2ef57fb2c016b0944e2d685e0c57a8018671", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85ad2ef57fb2c016b0944e2d685e0c57a8018671", "html_url": "https://github.com/Rust-GCC/gccrs/commit/85ad2ef57fb2c016b0944e2d685e0c57a8018671"}], "stats": {"total": 20, "additions": 18, "deletions": 2}, "files": [{"sha": "794c496a796db50c6ab52f9e1e25f6959761193d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d6358a57d44dbb7f07455124f463fcb8fab28fc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d6358a57d44dbb7f07455124f463fcb8fab28fc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5d6358a57d44dbb7f07455124f463fcb8fab28fc", "patch": "@@ -1,3 +1,8 @@\n+2011-04-29  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_delegitimize_address): Handle\n+\tunspec plus offset.  Tidy macho code.\n+\n 2011-04-29  Martin Jambor  <mjambor@suse.cz>\n \n \t* cgraphunit.c (cgraph_preserve_function_body_p): Accept a cgraph"}, {"sha": "899699f8aa1210257cfa4c3f56461cef13fa2f56", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5d6358a57d44dbb7f07455124f463fcb8fab28fc/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5d6358a57d44dbb7f07455124f463fcb8fab28fc/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=5d6358a57d44dbb7f07455124f463fcb8fab28fc", "patch": "@@ -6380,7 +6380,16 @@ rs6000_delegitimize_address (rtx orig_x)\n   if (GET_CODE (x) == (TARGET_CMODEL != CMODEL_SMALL ? LO_SUM : PLUS)\n       && GET_CODE (XEXP (x, 1)) == CONST)\n     {\n+      rtx offset = NULL_RTX;\n+\n       y = XEXP (XEXP (x, 1), 0);\n+      if (GET_CODE (y) == PLUS\n+\t  && GET_MODE (y) == Pmode\n+\t  && CONST_INT_P (XEXP (y, 1)))\n+\t{\n+\t  offset = XEXP (y, 1);\n+\t  y = XEXP (y, 0);\n+\t}\n       if (GET_CODE (y) == UNSPEC\n           && XINT (y, 1) == UNSPEC_TOCREL\n \t  && ((GET_CODE (XEXP (x, 0)) == REG\n@@ -6396,6 +6405,8 @@ rs6000_delegitimize_address (rtx orig_x)\n \t\t\t\t  XEXP (XEXP (XEXP (x, 0), 1), 0)))))\n \t{\n \t  y = XVECEXP (y, 0, 0);\n+\t  if (offset != NULL_RTX)\n+\t    y = gen_rtx_PLUS (Pmode, y, offset);\n \t  if (!MEM_P (orig_x))\n \t    return y;\n \t  else\n@@ -6405,9 +6416,9 @@ rs6000_delegitimize_address (rtx orig_x)\n \n   if (TARGET_MACHO\n       && GET_CODE (orig_x) == LO_SUM\n-      && GET_CODE (XEXP (x, 1)) == CONST)\n+      && GET_CODE (XEXP (orig_x, 1)) == CONST)\n     {\n-      y = XEXP (XEXP (x, 1), 0);\n+      y = XEXP (XEXP (orig_x, 1), 0);\n       if (GET_CODE (y) == UNSPEC\n \t  && XINT (y, 1) == UNSPEC_MACHOPIC_OFFSET)\n \treturn XVECEXP (y, 0, 0);"}]}