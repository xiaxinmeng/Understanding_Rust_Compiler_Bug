{"sha": "25a2c75d49ab2bebbae48b3640c999c43c8375bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjVhMmM3NWQ0OWFiMmJlYmJhZTQ4YjM2NDBjOTk5YzQzYzgzNzViZg==", "commit": {"author": {"name": "Yuri Rumyantsev", "email": "ysrumyan@gmail.com", "date": "2015-10-08T14:28:53Z"}, "committer": {"name": "Ilya Enkovich", "email": "ienkovich@gcc.gnu.org", "date": "2015-10-08T14:28:53Z"}, "message": "tree-vect-loop.c (vect_analyze_loop_operations): Skip virtual phi in the tail of outer-loop.\n\ngcc/\n\n\t* tree-vect-loop.c (vect_analyze_loop_operations): Skip virtual phi\n\tin the tail of outer-loop.\n\ngcc/testsuite/\n\n\t* gcc.dg/vect/vect-outer-simd-3.c: New test.\n\nFrom-SVN: r228601", "tree": {"sha": "63c88a1f671439526f14aa51e539f23c73d25c8c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/63c88a1f671439526f14aa51e539f23c73d25c8c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/25a2c75d49ab2bebbae48b3640c999c43c8375bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25a2c75d49ab2bebbae48b3640c999c43c8375bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25a2c75d49ab2bebbae48b3640c999c43c8375bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25a2c75d49ab2bebbae48b3640c999c43c8375bf/comments", "author": {"login": "ysrumyan", "id": 44425612, "node_id": "MDQ6VXNlcjQ0NDI1NjEy", "avatar_url": "https://avatars.githubusercontent.com/u/44425612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ysrumyan", "html_url": "https://github.com/ysrumyan", "followers_url": "https://api.github.com/users/ysrumyan/followers", "following_url": "https://api.github.com/users/ysrumyan/following{/other_user}", "gists_url": "https://api.github.com/users/ysrumyan/gists{/gist_id}", "starred_url": "https://api.github.com/users/ysrumyan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ysrumyan/subscriptions", "organizations_url": "https://api.github.com/users/ysrumyan/orgs", "repos_url": "https://api.github.com/users/ysrumyan/repos", "events_url": "https://api.github.com/users/ysrumyan/events{/privacy}", "received_events_url": "https://api.github.com/users/ysrumyan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a5220d61fa4aaff695962c0b96733997fab202b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5220d61fa4aaff695962c0b96733997fab202b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5220d61fa4aaff695962c0b96733997fab202b2"}], "stats": {"total": 89, "additions": 89, "deletions": 0}, "files": [{"sha": "7ae4f39fb7df906c8e929c47ccf6b17f501b7209", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=25a2c75d49ab2bebbae48b3640c999c43c8375bf", "patch": "@@ -1,3 +1,8 @@\n+2015-10-08  Yuri Rumyantsev  <ysrumyan@gmail.com>\n+\n+\t* tree-vect-loop.c (vect_analyze_loop_operations): Skip virtual phi\n+\tin the tail of outer-loop.\n+\n 2015-10-08  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* config/rs6000/rs6000.c (rs6000_xcoff_debug_unwind_info): Always"}, {"sha": "638751eaf931db6a90dbd778efde9709e8c91496", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=25a2c75d49ab2bebbae48b3640c999c43c8375bf", "patch": "@@ -1,3 +1,7 @@\n+2015-10-08  Yuri Rumyantsev  <ysrumyan@gmail.com>\n+\n+\t* gcc.dg/vect/vect-outer-simd-3.c: New test.\n+\n 2015-10-08  Yuri Rumyantsev  <ysrumyan@gmail.com>\n \n \t* gcc.dg/loop-unswitch-2.c: New test."}, {"sha": "59e54db075254498b34f673198f8f4f373b728a5", "filename": "gcc/testsuite/gcc.dg/vect/vect-outer-simd-3.c", "status": "added", "additions": 78, "deletions": 0, "changes": 78, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-outer-simd-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-outer-simd-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-outer-simd-3.c?ref=25a2c75d49ab2bebbae48b3640c999c43c8375bf", "patch": "@@ -0,0 +1,78 @@\n+/* { dg-require-effective-target vect_simd_clones } */\n+/* { dg-additional-options \"-O3 -fopenmp-simd -ffast-math\" } */\n+#include <stdlib.h>\n+#include \"tree-vect.h\"\n+#define N 64\n+\n+float *px, *py;\n+float *tx, *ty;\n+float *x1, *z1, *t1, *t2;\n+int bound[N];\n+\n+static void inline bar(const float cx, float cy,\n+                         float *vx, float *vy, int n)\n+{\n+  int j;\n+    for (j = 0; j < n; ++j)\n+    {\n+        const float dx  = cx - px[j];\n+        const float dy  = cy - py[j];\n+        *vx               -= dx * tx[j];\n+        *vy               -= dy * ty[j];\n+    }\n+}\n+\n+__attribute__((noinline, noclone)) void foo1 ()\n+{\n+  int i;\n+  int n = bound[63];\n+#pragma omp simd\n+  for (i=0; i<N; i++)\n+    bar(px[i], py[i], x1+i, z1+i, n);\n+}\n+\n+__attribute__((noinline, noclone)) void foo2 ()\n+{\n+  volatile int i;\n+  int n = bound[63];\n+  for (i=0; i<N; i++)\n+    bar(px[i], py[i], x1+i, z1+i, n);\n+}\n+\n+\n+int main()\n+{\n+  float *X = (float*)malloc(N * 8 * sizeof (float));\n+  int i;\n+  /* check_vect (); */\n+  px = &X[0];\n+  py = &X[N * 1];\n+  tx = &X[N * 2];\n+  ty = &X[N * 3];\n+  x1 = &X[N * 4];\n+  z1 = &X[N * 5];\n+  t1 = &X[N * 6];\n+  t2 = &X[N * 7];\n+\n+  for (i=0; i<N; i++)\n+    {\n+      px[i] = (float) (i+2);\n+      tx[i] = (float) (i+1);\n+      py[i] = (float) (i+4);\n+      ty[i] = (float) (i+3);\n+      x1[i] = z1[i] = 1.0f;\n+      bound[i] = i + 1;\n+    }\n+  foo1 ();  /* vector variant.  */\n+  for (i=0; i<N;i++)\n+    {\n+      t1[i] = x1[i]; x1[i] = 1.0f;\n+      t2[i] = z1[i]; z1[i] = 1.0f;\n+    }\n+  foo2 ();  /* scalar variant.  */\n+  for (i=0; i<N; i++)\n+    if (x1[i] != t1[i] || z1[i] != t2[i])\n+      abort ();\n+  return 0;\n+}\n+/* { dg-final { scan-tree-dump \"OUTER LOOP VECTORIZED\" \"vect\" } } */"}, {"sha": "8ab1cdf3ac7319babbdf7cf70d5497925dfc911b", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25a2c75d49ab2bebbae48b3640c999c43c8375bf/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=25a2c75d49ab2bebbae48b3640c999c43c8375bf", "patch": "@@ -1463,6 +1463,8 @@ vect_analyze_loop_operations (loop_vec_info loop_vinfo)\n               dump_gimple_stmt (MSG_NOTE, TDF_SLIM, phi, 0);\n               dump_printf (MSG_NOTE, \"\\n\");\n             }\n+\t  if (virtual_operand_p (gimple_phi_result (phi)))\n+\t    continue;\n \n           /* Inner-loop loop-closed exit phi in outer-loop vectorization\n              (i.e., a phi in the tail of the outer-loop).  */"}]}