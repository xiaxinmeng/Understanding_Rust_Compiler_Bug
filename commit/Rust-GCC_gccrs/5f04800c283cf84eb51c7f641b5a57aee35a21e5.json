{"sha": "5f04800c283cf84eb51c7f641b5a57aee35a21e5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWYwNDgwMGMyODNjZjg0ZWI1MWM3ZjY0MWI1YTU3YWVlMzVhMjFlNQ==", "commit": {"author": {"name": "Kriang Lerdsuwanakij", "email": "lerdsuwa@users.sourceforge.net", "date": "2003-10-18T17:35:47Z"}, "committer": {"name": "Kriang Lerdsuwanakij", "email": "lerdsuwa@gcc.gnu.org", "date": "2003-10-18T17:35:47Z"}, "message": "re PR c++/12495 (ICE in cp/typeck.c:907)\n\n\tPR c++/12495\n\t* pt.c (lookup_template_class): Handle when current_class_type\n\tis a local class.\n\n\t* g++.dg/template/crash21.C: New test.\n\nFrom-SVN: r72643", "tree": {"sha": "e0d0d5427e19b9b6f74ebbf6a9d080c7173eebcb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e0d0d5427e19b9b6f74ebbf6a9d080c7173eebcb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f04800c283cf84eb51c7f641b5a57aee35a21e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f04800c283cf84eb51c7f641b5a57aee35a21e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f04800c283cf84eb51c7f641b5a57aee35a21e5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f04800c283cf84eb51c7f641b5a57aee35a21e5/comments", "author": null, "committer": null, "parents": [{"sha": "3a198a72d26f430283d2906181315eb9ed622f8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a198a72d26f430283d2906181315eb9ed622f8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a198a72d26f430283d2906181315eb9ed622f8a"}], "stats": {"total": 41, "additions": 33, "deletions": 8}, "files": [{"sha": "344083acb49c42c50bae58baf895edc2a04d2b26", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5f04800c283cf84eb51c7f641b5a57aee35a21e5", "patch": "@@ -1,3 +1,9 @@\n+2003-10-18  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n+\n+\tPR c++/12495\n+\t* pt.c (lookup_template_class): Handle when current_class_type\n+\tis a local class.\n+\n 2003-10-17  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n \n \tPR c++/2513"}, {"sha": "32b146f5294bffcb5ee3f87ddf1ed40b4a109e54", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 6, "deletions": 8, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=5f04800c283cf84eb51c7f641b5a57aee35a21e5", "patch": "@@ -4163,14 +4163,12 @@ lookup_template_class (tree d1,\n \t      tree ctx;\n \t      \n \t      for (ctx = current_class_type; \n-\t\t   ctx; \n-\t\t   ctx = TYPE_CONTEXT (ctx))\n-\t\t{\n-\t\t  if (TREE_CODE (ctx) == NAMESPACE_DECL)\n-\t\t    break;\n-\t\t  if (same_type_p (ctx, template_type))\n-\t\t    goto found_ctx;\n-\t\t}\n+\t\t   ctx && TREE_CODE (ctx) != NAMESPACE_DECL;\n+\t\t   ctx = (TYPE_P (ctx)\n+\t\t\t  ? TYPE_CONTEXT (ctx)\n+\t\t\t  : DECL_CONTEXT (ctx)))\n+\t\tif (TYPE_P (ctx) && same_type_p (ctx, template_type))\n+\t\t  goto found_ctx;\n \t      \n \t      /* We're not in the scope of the class, so the\n \t\t TEMPLATE_TYPE is not the type we want after all.  */"}, {"sha": "41e3d856912887f259da49f4658768656e9bfc55", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5f04800c283cf84eb51c7f641b5a57aee35a21e5", "patch": "@@ -1,3 +1,8 @@\n+2003-10-18  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n+\n+\tPR c++/12495\n+\t* g++.dg/template/crash21.C: New test.\n+\n 2003-10-17  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n \n \tPR c++/2513"}, {"sha": "e2231e06b9174d8bb27da1c30ad45a5ef2f4c1d6", "filename": "gcc/testsuite/g++.dg/template/crash12.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f04800c283cf84eb51c7f641b5a57aee35a21e5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash12.C?ref=5f04800c283cf84eb51c7f641b5a57aee35a21e5", "patch": "@@ -0,0 +1,16 @@\n+// { dg-do compile }\n+\n+// Origin: rmerkert@alphatech.com\n+//         Volker Reichelt <reichelt@gcc.gnu.org>\n+\n+// PR c++/12495: ICE looking up class template in local class.\n+\n+template <typename> struct A {};\n+\n+template <typename T> void foo()\n+{\n+    struct B\n+    {\n+        B (const A<T>&);\n+    };\n+}"}]}