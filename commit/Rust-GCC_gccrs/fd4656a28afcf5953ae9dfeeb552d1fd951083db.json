{"sha": "fd4656a28afcf5953ae9dfeeb552d1fd951083db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmQ0NjU2YTI4YWZjZjU5NTNhZTlkZmVlYjU1MmQxZmQ5NTEwODNkYg==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2019-11-14T13:38:13Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-11-14T13:38:13Z"}, "message": "ipa-fnsummary.c (ipa_call_context::estimate_size_and_time, [...]): Micro optimize.\n\n\t* ipa-fnsummary.c (ipa_call_context::estimate_size_and_time,\n\tipa_merge_fn_summary_after_inlining): Micro optimize.\n\nFrom-SVN: r278222", "tree": {"sha": "a395f8c8546bc04cdc100e1c2fcae299081fe097", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a395f8c8546bc04cdc100e1c2fcae299081fe097"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd4656a28afcf5953ae9dfeeb552d1fd951083db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd4656a28afcf5953ae9dfeeb552d1fd951083db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd4656a28afcf5953ae9dfeeb552d1fd951083db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd4656a28afcf5953ae9dfeeb552d1fd951083db/comments", "author": null, "committer": null, "parents": [{"sha": "79f1d8521882de51480866fd7037199d670316bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79f1d8521882de51480866fd7037199d670316bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79f1d8521882de51480866fd7037199d670316bd"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "c96683b1d1b739574ff3b9d6afe35beb06eecff2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd4656a28afcf5953ae9dfeeb552d1fd951083db/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd4656a28afcf5953ae9dfeeb552d1fd951083db/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fd4656a28afcf5953ae9dfeeb552d1fd951083db", "patch": "@@ -1,3 +1,8 @@\n+2019-11-14  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-fnsummary.c (ipa_call_context::estimate_size_and_time,\n+\tipa_merge_fn_summary_after_inlining): Micro optimize.\n+\n 2019-11-14  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* params.opt (max-inline-insns-single-O2): Set to 70 (instead of 30)."}, {"sha": "a88f300d67d47360d121e2610d67d27365599d3e", "filename": "gcc/ipa-fnsummary.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd4656a28afcf5953ae9dfeeb552d1fd951083db/gcc%2Fipa-fnsummary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd4656a28afcf5953ae9dfeeb552d1fd951083db/gcc%2Fipa-fnsummary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-fnsummary.c?ref=fd4656a28afcf5953ae9dfeeb552d1fd951083db", "patch": "@@ -3353,7 +3353,10 @@ ipa_call_context::estimate_size_and_time (int *ret_size,\n \t\t\t\t\t        m_inline_param_summary);\n \t      gcc_checking_assert (prob >= 0);\n \t      gcc_checking_assert (prob <= REG_BR_PROB_BASE);\n-\t      time += e->time * prob / REG_BR_PROB_BASE;\n+\t      if (prob == REG_BR_PROB_BASE)\n+\t        time += e->time;\n+\t      else\n+\t        time += e->time * prob / REG_BR_PROB_BASE;\n \t    }\n \t  gcc_checking_assert (time >= 0);\n         }\n@@ -3707,7 +3710,8 @@ ipa_merge_fn_summary_after_inlining (struct cgraph_edge *edge)\n \t  sreal add_time = ((sreal)e->time * freq);\n \t  int prob = e->nonconst_predicate.probability (callee_info->conds,\n \t\t\t\t\t\t\tclause, es->param);\n-\t  add_time = add_time * prob / REG_BR_PROB_BASE;\n+\t  if (prob != REG_BR_PROB_BASE)\n+\t    add_time = add_time * prob / REG_BR_PROB_BASE;\n \t  if (prob != REG_BR_PROB_BASE\n \t      && dump_file && (dump_flags & TDF_DETAILS))\n \t    {"}]}