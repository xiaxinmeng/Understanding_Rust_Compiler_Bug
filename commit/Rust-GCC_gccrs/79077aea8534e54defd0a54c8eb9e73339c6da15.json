{"sha": "79077aea8534e54defd0a54c8eb9e73339c6da15", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzkwNzdhZWE4NTM0ZTU0ZGVmZDBhNTRjOGViOWU3MzMzOWM2ZGExNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-03-19T23:26:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-03-19T23:26:14Z"}, "message": "re PR c/30762 (IMA messes up with inlining)\n\n\tPR c/30762\n\t* c-typeck.c (convert_for_assignment): Call comptypes for\n\tRECORD_TYPE or UNION_TYPE.\n\n\t* gcc.dg/pr30762-1.c: New test.\n\t* gcc.dg/pr30762-2.c: New test.\n\nFrom-SVN: r123073", "tree": {"sha": "3a1029b66d21f2d28e973b73a24decf8050a2d9a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a1029b66d21f2d28e973b73a24decf8050a2d9a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79077aea8534e54defd0a54c8eb9e73339c6da15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79077aea8534e54defd0a54c8eb9e73339c6da15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79077aea8534e54defd0a54c8eb9e73339c6da15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79077aea8534e54defd0a54c8eb9e73339c6da15/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5d8a54345abbbb4dcf013a03bf6e6742414c389d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d8a54345abbbb4dcf013a03bf6e6742414c389d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d8a54345abbbb4dcf013a03bf6e6742414c389d"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "849ab9045559bebbee5c27501e6c564e5294b4e7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=79077aea8534e54defd0a54c8eb9e73339c6da15", "patch": "@@ -1,5 +1,9 @@\n 2007-03-20  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c/30762\n+\t* c-typeck.c (convert_for_assignment): Call comptypes for\n+\tRECORD_TYPE or UNION_TYPE.\n+\n \tPR inline-asm/30505\n \t* reload1.c (reload): Do invalid ASM checking after\n \tcleanup_subreg_operands."}, {"sha": "5976cb26309fa1e4c6a14524a5bff56c642f5a6a", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=79077aea8534e54defd0a54c8eb9e73339c6da15", "patch": "@@ -3896,10 +3896,16 @@ convert_for_assignment (tree type, tree rhs, enum impl_conv errtype,\n \t       || coder == BOOLEAN_TYPE))\n     return convert_and_check (type, rhs);\n \n+  /* Aggregates in different TUs might need conversion.  */\n+  if ((codel == RECORD_TYPE || codel == UNION_TYPE)\n+      && codel == coder\n+      && comptypes (type, rhstype))\n+    return convert_and_check (type, rhs);\n+\n   /* Conversion to a transparent union from its member types.\n      This applies only to function arguments.  */\n-  else if (codel == UNION_TYPE && TYPE_TRANSPARENT_UNION (type)\n-\t   && (errtype == ic_argpass || errtype == ic_argpass_nonproto))\n+  if (codel == UNION_TYPE && TYPE_TRANSPARENT_UNION (type)\n+      && (errtype == ic_argpass || errtype == ic_argpass_nonproto))\n     {\n       tree memb, marginal_memb = NULL_TREE;\n "}, {"sha": "0e772e49a86e0cdf5865228c66fcc3e29b0d3d4f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=79077aea8534e54defd0a54c8eb9e73339c6da15", "patch": "@@ -1,5 +1,9 @@\n 2007-03-20  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c/30762\n+\t* gcc.dg/pr30762-1.c: New test.\n+\t* gcc.dg/pr30762-2.c: New test.\n+\n \tPR inline-asm/30505\n \t* gcc.target/i386/pr30505.c: New test.\n "}, {"sha": "97dca8c020e5e559143125cebf2fa89e7e9e1e62", "filename": "gcc/testsuite/gcc.dg/pr30762-1.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Ftestsuite%2Fgcc.dg%2Fpr30762-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Ftestsuite%2Fgcc.dg%2Fpr30762-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr30762-1.c?ref=79077aea8534e54defd0a54c8eb9e73339c6da15", "patch": "@@ -0,0 +1,15 @@\n+/* PR c/30762 */\n+/* { dg-do compile } */\n+/* { dg-options \"--combine -O3\" } */\n+/* { dg-additional-sources pr30762-2.c } */\n+\n+typedef struct { int i; } D;\n+extern void foo (D);\n+\n+void\n+bar (void)\n+{\n+  D d;\n+  d.i = 1;\n+  foo (d);\n+}"}, {"sha": "7e914ebfa86f982ebc063a987f023eaf7bfa8c75", "filename": "gcc/testsuite/gcc.dg/pr30762-2.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Ftestsuite%2Fgcc.dg%2Fpr30762-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79077aea8534e54defd0a54c8eb9e73339c6da15/gcc%2Ftestsuite%2Fgcc.dg%2Fpr30762-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr30762-2.c?ref=79077aea8534e54defd0a54c8eb9e73339c6da15", "patch": "@@ -0,0 +1,9 @@\n+/* PR c/30762 */\n+/* { dg-do compile } */\n+\n+typedef struct { int i; } D;\n+\n+void\n+foo (D x)\n+{\n+}"}]}