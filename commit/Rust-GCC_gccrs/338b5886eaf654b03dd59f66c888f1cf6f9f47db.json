{"sha": "338b5886eaf654b03dd59f66c888f1cf6f9f47db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM4YjU4ODZlYWY2NTRiMDNkZDU5ZjY2Yzg4OGYxY2Y2ZjlmNDdkYg==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@codesourcery.com", "date": "2005-12-20T14:47:07Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2005-12-20T14:47:07Z"}, "message": "re PR tree-optimization/25501 (Segfault)\n\ngcc/\n\tPR tree-optimization/25501\n\t* tree-cfgcleanup.c (merge_phi_nodes): Check that RESULT is\n\tused in the PHI argument corresponding to the edge from BB to\n\tDEST.\n\ngcc/testsuite/\n\tPR tree-optimization/25501\n\t* testsuite/gcc.dg/tree-ssa/pr25501.c: New.\n\nFrom-SVN: r108853", "tree": {"sha": "f4ca00ba23ba711cd266b66efd44af31919b3ed3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f4ca00ba23ba711cd266b66efd44af31919b3ed3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/338b5886eaf654b03dd59f66c888f1cf6f9f47db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/338b5886eaf654b03dd59f66c888f1cf6f9f47db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/338b5886eaf654b03dd59f66c888f1cf6f9f47db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/338b5886eaf654b03dd59f66c888f1cf6f9f47db/comments", "author": null, "committer": null, "parents": [{"sha": "bd989e4c102a3e390825e8256f45ac56c5262650", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd989e4c102a3e390825e8256f45ac56c5262650", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd989e4c102a3e390825e8256f45ac56c5262650"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "021b23a02b3f23372e111816fedda0a831cbb140", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=338b5886eaf654b03dd59f66c888f1cf6f9f47db", "patch": "@@ -1,3 +1,10 @@\n+2005-12-20  Kazu Hirata  <kazu@codesourcery.com>\n+\n+\tPR tree-optimization/25501\n+\t* tree-cfgcleanup.c (merge_phi_nodes): Check that RESULT is\n+\tused in the PHI argument corresponding to the edge from BB to\n+\tDEST.\n+\n 2005-12-20  Richard Guenther  <rguenther@suse.de>\n \n \tRevert"}, {"sha": "3fec3a6f1eba434182df1c5c4ff50a625fbfc497", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=338b5886eaf654b03dd59f66c888f1cf6f9f47db", "patch": "@@ -1,3 +1,8 @@\n+2005-12-20  Kazu Hirata  <kazu@codesourcery.com>\n+\n+\tPR tree-optimization/25501\n+\t* testsuite/gcc.dg/tree-ssa/pr25501.c: New.\n+\n 2005-12-20  Richard Guenther  <rguenther@suse.de>\n \n \tRevert"}, {"sha": "aa70994756c520ec8a16519f3369c06eeb96c3a6", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr25501.c", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr25501.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr25501.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr25501.c?ref=338b5886eaf654b03dd59f66c888f1cf6f9f47db", "patch": "@@ -0,0 +1,36 @@\n+/* PR tree-optimization/25501\n+   The PHI merge pass used to try to merge PHI nodes that cannot\n+   actually merged, causing a segfault later.  Make sure that does not\n+   happen any more.  */\n+\n+/* { dg-options \"-O1 -fdump-tree-mergephi\" } */\n+\n+int\n+foo (int a)\n+{\n+  int b;\n+  int c;\n+  int d;\n+\n+  if (a == 2)\n+    b = 3;\n+  else\n+    b = 5;\n+\n+  c = 7;\n+\n+  d = 11;\n+\n+  for (;;)\n+    {\n+      if (d == 5)\n+\tbreak;\n+\n+      d = b;\n+    }\n+\n+  return 13;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"Removing basic block\" 0 \"mergephi\"} } */\n+/* { dg-final { cleanup-tree-dump \"mergephi\" } } */"}, {"sha": "836a14d7772fb90179c5b1bfaca470a8fd389286", "filename": "gcc/tree-cfgcleanup.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2Ftree-cfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/338b5886eaf654b03dd59f66c888f1cf6f9f47db/gcc%2Ftree-cfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfgcleanup.c?ref=338b5886eaf654b03dd59f66c888f1cf6f9f47db", "patch": "@@ -746,6 +746,7 @@ merge_phi_nodes (void)\n       else\n \t{\n \t  tree phi;\n+\t  unsigned int dest_idx = single_succ_edge (bb)->dest_idx;\n \n \t  /* BB dominates DEST.  There may be many users of the PHI\n \t     nodes in BB.  However, there is still a trivial case we\n@@ -767,7 +768,8 @@ merge_phi_nodes (void)\n \t      /* Get the single use of the result of this PHI node.  */\n   \t      if (!single_imm_use (result, &imm_use, &use_stmt)\n \t\t  || TREE_CODE (use_stmt) != PHI_NODE\n-\t\t  || bb_for_stmt (use_stmt) != dest)\n+\t\t  || bb_for_stmt (use_stmt) != dest\n+\t\t  || PHI_ARG_DEF (use_stmt, dest_idx) != result)\n \t\tbreak;\n \t    }\n "}]}