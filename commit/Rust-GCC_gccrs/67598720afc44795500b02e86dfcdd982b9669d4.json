{"sha": "67598720afc44795500b02e86dfcdd982b9669d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Njc1OTg3MjBhZmM0NDc5NTUwMGIwMmU4NmRmY2RkOTgyYjk2NjlkNA==", "commit": {"author": {"name": "Teresa Johnson", "email": "tejohnson@google.com", "date": "2013-08-20T13:29:53Z"}, "committer": {"name": "Teresa Johnson", "email": "tejohnson@gcc.gnu.org", "date": "2013-08-20T13:29:53Z"}, "message": "re PR rtl-optimization/57451 (Incorrect debug ranges emitted for -freorder-blocks-and-partition -g)\n\n2013-08-20  Teresa Johnson  <tejohnson@google.com>\n\n\tPR rtl-optimizations/57451\n\t* final.c (reemit_insn_block_notes): Prevent lexical blocks\n\tfrom crossing split section boundaries.\n\n\t* testsuite/g++.dg/tree-prof/pr57451.C: New test.\n\nFrom-SVN: r201883", "tree": {"sha": "d7ed91c64916897863742efb289c1ae31a67af93", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d7ed91c64916897863742efb289c1ae31a67af93"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/67598720afc44795500b02e86dfcdd982b9669d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67598720afc44795500b02e86dfcdd982b9669d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67598720afc44795500b02e86dfcdd982b9669d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67598720afc44795500b02e86dfcdd982b9669d4/comments", "author": {"login": "teresajohnson", "id": 20446403, "node_id": "MDQ6VXNlcjIwNDQ2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/20446403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teresajohnson", "html_url": "https://github.com/teresajohnson", "followers_url": "https://api.github.com/users/teresajohnson/followers", "following_url": "https://api.github.com/users/teresajohnson/following{/other_user}", "gists_url": "https://api.github.com/users/teresajohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/teresajohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teresajohnson/subscriptions", "organizations_url": "https://api.github.com/users/teresajohnson/orgs", "repos_url": "https://api.github.com/users/teresajohnson/repos", "events_url": "https://api.github.com/users/teresajohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/teresajohnson/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c5918c2199ee193f86cfafb9ad9fb040d7a60a14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5918c2199ee193f86cfafb9ad9fb040d7a60a14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5918c2199ee193f86cfafb9ad9fb040d7a60a14"}], "stats": {"total": 58, "additions": 55, "deletions": 3}, "files": [{"sha": "208b291a9c6c66bc2c4705bc3e484abc0fafb692", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=67598720afc44795500b02e86dfcdd982b9669d4", "patch": "@@ -1,3 +1,9 @@\n+2013-08-20  Teresa Johnson  <tejohnson@google.com>\n+\n+\tPR rtl-optimizations/57451\n+\t* final.c (reemit_insn_block_notes): Prevent lexical blocks\n+\tfrom crossing split section boundaries.\n+\n 2013-08-20  Matthew Gretton-Dann  <matthew.gretton-dann@linaro.org>\n \n \t* config/arm/linux-elf.h (MULTILIB_DEFAULTS): Remove definition."}, {"sha": "4eaae0f2bc3a62f47fa428d88d28b40e6071c9a6", "filename": "gcc/final.c", "status": "modified", "additions": 17, "deletions": 3, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=67598720afc44795500b02e86dfcdd982b9669d4", "patch": "@@ -1650,12 +1650,26 @@ reemit_insn_block_notes (void)\n   rtx insn, note;\n \n   insn = get_insns ();\n-  if (!active_insn_p (insn))\n-    insn = next_active_insn (insn);\n-  for (; insn; insn = next_active_insn (insn))\n+  for (; insn; insn = next_insn (insn))\n     {\n       tree this_block;\n \n+      /* Prevent lexical blocks from straddling section boundaries.  */\n+      if (NOTE_P (insn) && NOTE_KIND (insn) == NOTE_INSN_SWITCH_TEXT_SECTIONS)\n+        {\n+          for (tree s = cur_block; s != DECL_INITIAL (cfun->decl);\n+               s = BLOCK_SUPERCONTEXT (s))\n+            {\n+              rtx note = emit_note_before (NOTE_INSN_BLOCK_END, insn);\n+              NOTE_BLOCK (note) = s;\n+              note = emit_note_after (NOTE_INSN_BLOCK_BEG, insn);\n+              NOTE_BLOCK (note) = s;\n+            }\n+        }\n+\n+      if (!active_insn_p (insn))\n+        continue;\n+\n       /* Avoid putting scope notes between jump table and its label.  */\n       if (JUMP_TABLE_DATA_P (insn))\n \tcontinue;"}, {"sha": "f05e06808b010f20d8f823c51e23f3f20680e0d1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=67598720afc44795500b02e86dfcdd982b9669d4", "patch": "@@ -1,3 +1,8 @@\n+2013-08-20  Teresa Johnson  <tejohnson@google.com>\n+\n+\tPR rtl-optimizations/57451\n+\t* g++.dg/tree-prof/pr57451.C: New test.\n+\n 2013-08-20  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/58190"}, {"sha": "c69c13037f5fa3a1b94cb59910281aa250768f8b", "filename": "gcc/testsuite/g++.dg/tree-prof/pr57451.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-prof%2Fpr57451.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67598720afc44795500b02e86dfcdd982b9669d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-prof%2Fpr57451.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-prof%2Fpr57451.C?ref=67598720afc44795500b02e86dfcdd982b9669d4", "patch": "@@ -0,0 +1,27 @@\n+// { dg-do run }\n+// { dg-require-effective-target freorder }\n+// { dg-options \"-O2 -freorder-blocks-and-partition -g\" }\n+\n+extern \"C\" void abort (void);\n+struct MyException {};\n+struct Data {\n+    int nr;\n+    Data() : nr(66) {}\n+};\n+Data __attribute__((noinline,noclone)) getData(int i)\n+{\n+  if (i) throw MyException();\n+  Data data;\n+  data.nr = i;\n+  return data;\n+}\n+int main(int, char **)\n+{\n+  Data data;\n+  try {\n+      data = getData(1);\n+  } catch (MyException& e) {\n+      if (data.nr != 66)\n+\tabort ();\n+  }\n+}"}]}