{"sha": "8e2fc0551b547d1ecb498d18fc599bc73289629f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGUyZmMwNTUxYjU0N2QxZWNiNDk4ZDE4ZmM1OTliYzczMjg5NjI5Zg==", "commit": {"author": {"name": "Igor Tsimbalist", "email": "igor.v.tsimbalist@intel.com", "date": "2017-11-17T22:29:19Z"}, "committer": {"name": "Igor Tsimbalist", "email": "itsimbal@gcc.gnu.org", "date": "2017-11-17T22:29:19Z"}, "message": "Enable building libvtv with Intel CET\n\nlibvtv/\n\t* acinclude.m4: Add enable.m4 and cet.m4.\n\t* Makefile.in: Regenerate.\n\t* testsuite/Makefile.in: Likewise.\n\t* configure: Likewise.\n\t* configure.ac: Set CET_FLAGS. Update XCFLAGS.\n\t* testsuite/libvtv.cc/vtv.exp: Add scanlang.exp.\n\nFrom-SVN: r254897", "tree": {"sha": "30478846e0e4a47467f33366105d7a31735b75cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/30478846e0e4a47467f33366105d7a31735b75cd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8e2fc0551b547d1ecb498d18fc599bc73289629f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e2fc0551b547d1ecb498d18fc599bc73289629f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e2fc0551b547d1ecb498d18fc599bc73289629f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e2fc0551b547d1ecb498d18fc599bc73289629f/comments", "author": {"login": "itsimbal", "id": 29258612, "node_id": "MDQ6VXNlcjI5MjU4NjEy", "avatar_url": "https://avatars.githubusercontent.com/u/29258612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itsimbal", "html_url": "https://github.com/itsimbal", "followers_url": "https://api.github.com/users/itsimbal/followers", "following_url": "https://api.github.com/users/itsimbal/following{/other_user}", "gists_url": "https://api.github.com/users/itsimbal/gists{/gist_id}", "starred_url": "https://api.github.com/users/itsimbal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itsimbal/subscriptions", "organizations_url": "https://api.github.com/users/itsimbal/orgs", "repos_url": "https://api.github.com/users/itsimbal/repos", "events_url": "https://api.github.com/users/itsimbal/events{/privacy}", "received_events_url": "https://api.github.com/users/itsimbal/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9069eb28d45baaa8baf5e3790b03b0e2cc5b49b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9069eb28d45baaa8baf5e3790b03b0e2cc5b49b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9069eb28d45baaa8baf5e3790b03b0e2cc5b49b3"}], "stats": {"total": 100, "additions": 96, "deletions": 4}, "files": [{"sha": "64fcafe2a6fae64ed922bd6453dadb615ef53412", "filename": "libvtv/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2FChangeLog?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -1,3 +1,12 @@\n+2017-11-17  Igor Tsimbalist  <igor.v.tsimbalist@intel.com>\n+\n+\t* acinclude.m4: Add enable.m4 and cet.m4.\n+\t* Makefile.in: Regenerate.\n+\t* testsuite/Makefile.in: Likewise.\n+\t* configure: Likewise.\n+\t* configure.ac: Set CET_FLAGS. Update XCFLAGS.\n+\t* testsuite/libvtv.cc/vtv.exp: Add scanlang.exp.\n+\n 2017-01-21  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR other/79046"}, {"sha": "606b7c0ce7e97a59a9ec8b3116526d1be78c1388", "filename": "libvtv/Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2FMakefile.in?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -71,7 +71,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../ltoptions.m4 $(top_srcdir)/../ltsugar.m4 \\\n \t$(top_srcdir)/../ltversion.m4 $(top_srcdir)/../lt~obsolete.m4 \\\n \t$(top_srcdir)/acinclude.m4 $(top_srcdir)/../libtool.m4 \\\n-\t$(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../config/enable.m4 \\\n+\t$(top_srcdir)/../config/cet.m4 $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \\"}, {"sha": "1113a3fe46c89a374dca507c0b1d6a96a8f0619b", "filename": "libvtv/acinclude.m4", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2Facinclude.m4?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -2,6 +2,8 @@ dnl ----------------------------------------------------------------------\n dnl This whole bit snagged from libgfortran.\n \n sinclude(../libtool.m4)\n+sinclude(../config/enable.m4)\n+sinclude(../config/cet.m4)\n dnl The lines below arrange for aclocal not to bring an installed\n dnl libtool.m4 into aclocal.m4, while still arranging for automake to\n dnl add a definition of LIBTOOL to Makefile.in."}, {"sha": "aa8a30133adf15b74570613ea95f013222470257", "filename": "libvtv/configure", "status": "modified", "additions": 75, "deletions": 2, "changes": 77, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2Fconfigure?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -760,6 +760,7 @@ with_pic\n enable_fast_install\n with_gnu_ld\n enable_libtool_lock\n+enable_cet\n with_gcc_major_version_only\n '\n       ac_precious_vars='build_alias\n@@ -1404,6 +1405,8 @@ Optional Features:\n   --enable-fast-install[=PKGS]\n                           optimize for fast installation [default=yes]\n   --disable-libtool-lock  avoid locking (might break parallel builds)\n+  --enable-cet            enable Intel CET in target libraries\n+                          [default=default]\n \n Optional Packages:\n   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]\n@@ -12066,7 +12069,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12069 \"configure\"\n+#line 12072 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -12172,7 +12175,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12175 \"configure\"\n+#line 12178 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -15456,6 +15459,76 @@ libtool_VERSION=1:0:0\n \n XCFLAGS=\"-D_GNU_SOURCE -Wall -Wextra -fno-exceptions\"\n \n+# Add CET specific flags if Intel CET is enabled.\n+ # Check whether --enable-cet was given.\n+if test \"${enable_cet+set}\" = set; then :\n+  enableval=$enable_cet;\n+      case \"$enableval\" in\n+       yes|no|default) ;;\n+       *) as_fn_error \"Unknown argument to enable/disable cet\" \"$LINENO\" 5 ;;\n+                          esac\n+\n+else\n+  enable_cet=default\n+fi\n+\n+\n+case \"$host\" in\n+  i[34567]86-*-linux* | x86_64-*-linux*)\n+    case \"$enable_cet\" in\n+      default)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  enable_cet=yes\n+else\n+  enable_cet=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+      yes)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+\n+else\n+  as_fn_error \"assembler with CET support is required for --enable-cet\" \"$LINENO\" 5\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+    esac\n+    ;;\n+  *)\n+    enable_cet=no\n+    ;;\n+esac\n+if test x$enable_cet = xyes; then\n+  CET_FLAGS=\"-fcf-protection -mcet\"\n+fi\n+\n+XCFLAGS=\"$XCFLAGS $CET_FLAGS\"\n+\n+\n \n if test \"${multilib}\" = \"yes\"; then\n   multilib_arg=\"--enable-multilib\""}, {"sha": "ba3009ee3fb6617b0913eb9b80da9ba429663755", "filename": "libvtv/configure.ac", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2Fconfigure.ac?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -151,6 +151,11 @@ libtool_VERSION=1:0:0\n AC_SUBST(libtool_VERSION)\n \n XCFLAGS=\"-D_GNU_SOURCE -Wall -Wextra -fno-exceptions\"\n+\n+# Add CET specific flags if Intel CET is enabled.\n+GCC_CET_FLAGS(CET_FLAGS)\n+XCFLAGS=\"$XCFLAGS $CET_FLAGS\"\n+\n AC_SUBST(XCFLAGS)\n \n if test \"${multilib}\" = \"yes\"; then"}, {"sha": "f6314708e9f79d83e7102ffa8047ba3de46b0d65", "filename": "libvtv/testsuite/Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2Ftestsuite%2FMakefile.in?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -64,7 +64,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../ltoptions.m4 $(top_srcdir)/../ltsugar.m4 \\\n \t$(top_srcdir)/../ltversion.m4 $(top_srcdir)/../lt~obsolete.m4 \\\n \t$(top_srcdir)/acinclude.m4 $(top_srcdir)/../libtool.m4 \\\n-\t$(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../config/enable.m4 \\\n+\t$(top_srcdir)/../config/cet.m4 $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs"}, {"sha": "2024fba5f25ef8d5dd1268e2751f92ed66c9c18d", "filename": "libvtv/testsuite/libvtv.cc/vtv.exp", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Ftestsuite%2Flibvtv.cc%2Fvtv.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2fc0551b547d1ecb498d18fc599bc73289629f/libvtv%2Ftestsuite%2Flibvtv.cc%2Fvtv.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libvtv%2Ftestsuite%2Flibvtv.cc%2Fvtv.exp?ref=8e2fc0551b547d1ecb498d18fc599bc73289629f", "patch": "@@ -1,4 +1,5 @@\n load_lib libvtv-dg.exp\n+load_gcc_lib scanlang.exp\n load_gcc_lib gcc-dg.exp\n \n global VTV_FLAGS"}]}