{"sha": "cc2a64dd80513c1155fad3370bc639daa97b7404", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2MyYTY0ZGQ4MDUxM2MxMTU1ZmFkMzM3MGJjNjM5ZGFhOTdiNzQwNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-10-09T08:14:45Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-10-09T08:14:45Z"}, "message": "tree-ssa-live.c (remove_unused_locals): Mark all edge's goto_block as used.\n\n\t* tree-ssa-live.c (remove_unused_locals): Mark all edge's goto_block\n\tas used.\n\t* gimple-low.c (lower_function_body, lower_gimple_return,\n\tlower_builtin_setjmp): Set gimple_block on the newly created stmts.\n\t* tree-cfg.c (make_cond_expr_edges, make_goto_expr_edges): Only set\n\tgoto_block on edges if goto_locus is known.\n\nFrom-SVN: r141002", "tree": {"sha": "1599f2d75e2a457f0aed00567cfc9d802c798435", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1599f2d75e2a457f0aed00567cfc9d802c798435"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc2a64dd80513c1155fad3370bc639daa97b7404", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc2a64dd80513c1155fad3370bc639daa97b7404", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc2a64dd80513c1155fad3370bc639daa97b7404", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc2a64dd80513c1155fad3370bc639daa97b7404/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a3d3c0f5fa9cd88e6285f60c593cb753cc53d4c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3d3c0f5fa9cd88e6285f60c593cb753cc53d4c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3d3c0f5fa9cd88e6285f60c593cb753cc53d4c2"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "c6053c4cc4e64defc96479788a180e03257ef79a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cc2a64dd80513c1155fad3370bc639daa97b7404", "patch": "@@ -1,3 +1,12 @@\n+2008-10-09  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* tree-ssa-live.c (remove_unused_locals): Mark all edge's goto_block\n+\tas used.\n+\t* gimple-low.c (lower_function_body, lower_gimple_return,\n+\tlower_builtin_setjmp): Set gimple_block on the newly created stmts.\n+\t* tree-cfg.c (make_cond_expr_edges, make_goto_expr_edges): Only set\n+\tgoto_block on edges if goto_locus is known.\n+\n 2008-10-08  Jakub Jelinek  <jakub@redhat.com>\n \n \t* graphite.c (gloog): Don't call find_unreachable_blocks"}, {"sha": "197ba352b45cdb6801c05db87c69848a31dd21d7", "filename": "gcc/gimple-low.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2Fgimple-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2Fgimple-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-low.c?ref=cc2a64dd80513c1155fad3370bc639daa97b7404", "patch": "@@ -133,6 +133,7 @@ lower_function_body (void)\n     {\n       x = gimple_build_return (NULL);\n       gimple_set_location (x, cfun->function_end_locus);\n+      gimple_set_block (x, DECL_INITIAL (current_function_decl));\n       gsi_insert_after (&i, x, GSI_CONTINUE_LINKING);\n     }\n \n@@ -659,6 +660,7 @@ lower_gimple_return (gimple_stmt_iterator *gsi, struct lower_data *data)\n  found:\n   t = gimple_build_goto (tmp_rs.label);\n   gimple_set_location (t, gimple_location (stmt));\n+  gimple_set_block (t, gimple_block (stmt));\n   gsi_insert_before (gsi, t, GSI_SAME_STMT);\n   gsi_remove (gsi, false);\n }\n@@ -736,6 +738,7 @@ lower_builtin_setjmp (gimple_stmt_iterator *gsi)\n   t = implicit_built_in_decls[BUILT_IN_SETJMP_SETUP];\n   g = gimple_build_call (t, 2, gimple_call_arg (stmt, 0), arg);\n   gimple_set_location (g, gimple_location (stmt));\n+  gimple_set_block (g, gimple_block (stmt));\n   gsi_insert_before (gsi, g, GSI_SAME_STMT);\n \n   /* Build 'DEST = 0' and insert.  */\n@@ -744,6 +747,7 @@ lower_builtin_setjmp (gimple_stmt_iterator *gsi)\n       g = gimple_build_assign (dest, fold_convert (TREE_TYPE (dest),\n \t\t\t\t\t\t   integer_zero_node));\n       gimple_set_location (g, gimple_location (stmt));\n+      gimple_set_block (g, gimple_block (stmt));\n       gsi_insert_before (gsi, g, GSI_SAME_STMT);\n     }\n \n@@ -760,6 +764,7 @@ lower_builtin_setjmp (gimple_stmt_iterator *gsi)\n   t = implicit_built_in_decls[BUILT_IN_SETJMP_RECEIVER];\n   g = gimple_build_call (t, 1, arg);\n   gimple_set_location (g, gimple_location (stmt));\n+  gimple_set_block (g, gimple_block (stmt));\n   gsi_insert_before (gsi, g, GSI_SAME_STMT);\n \n   /* Build 'DEST = 1' and insert.  */\n@@ -768,6 +773,7 @@ lower_builtin_setjmp (gimple_stmt_iterator *gsi)\n       g = gimple_build_assign (dest, fold_convert (TREE_TYPE (dest),\n \t\t\t\t\t\t   integer_one_node));\n       gimple_set_location (g, gimple_location (stmt));\n+      gimple_set_block (g, gimple_block (stmt));\n       gsi_insert_before (gsi, g, GSI_SAME_STMT);\n     }\n "}, {"sha": "28ee8ef40c4ff5a37fc94df621f2ff54b3c7d99e", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=cc2a64dd80513c1155fad3370bc639daa97b7404", "patch": "@@ -658,12 +658,14 @@ make_cond_expr_edges (basic_block bb)\n \n   e = make_edge (bb, then_bb, EDGE_TRUE_VALUE);\n   e->goto_locus = gimple_location (then_stmt);\n-  e->goto_block = gimple_block (then_stmt);\n+  if (e->goto_locus)\n+    e->goto_block = gimple_block (then_stmt);\n   e = make_edge (bb, else_bb, EDGE_FALSE_VALUE);\n   if (e)\n     {\n       e->goto_locus = gimple_location (else_stmt);\n-      e->goto_block = gimple_block (else_stmt);\n+      if (e->goto_locus)\n+\te->goto_block = gimple_block (else_stmt);\n     }\n \n   /* We do not need the labels anymore.  */\n@@ -853,7 +855,8 @@ make_goto_expr_edges (basic_block bb)\n       tree dest = gimple_goto_dest (goto_t);\n       edge e = make_edge (bb, label_to_block (dest), EDGE_FALLTHRU);\n       e->goto_locus = gimple_location (goto_t);\n-      e->goto_block = gimple_block (goto_t);\n+      if (e->goto_locus)\n+\te->goto_block = gimple_block (goto_t);\n       gsi_remove (&last, true);\n       return;\n     }"}, {"sha": "47315184f9a1631c0ecfd5221f970275876988f6", "filename": "gcc/tree-ssa-live.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2Ftree-ssa-live.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc2a64dd80513c1155fad3370bc639daa97b7404/gcc%2Ftree-ssa-live.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.c?ref=cc2a64dd80513c1155fad3370bc639daa97b7404", "patch": "@@ -600,6 +600,8 @@ remove_unused_locals (void)\n     {\n       gimple_stmt_iterator gsi;\n       size_t i;\n+      edge_iterator ei;\n+      edge e;\n \n       /* Walk the statements.  */\n       for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&gsi))\n@@ -634,6 +636,10 @@ remove_unused_locals (void)\n \t      mark_all_vars_used (&arg, NULL);\n             }\n         }\n+\n+      FOR_EACH_EDGE (e, ei, bb->succs)\n+\tif (e->goto_locus)\n+\t  TREE_USED (e->goto_block) = true;\n     }\n \n   /* Remove unmarked local vars from local_decls.  */"}]}