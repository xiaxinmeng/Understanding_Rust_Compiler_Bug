{"sha": "6f748bc1e7fbae876ff47e3abe477253a0e70c09", "node_id": "C_kwDOANBUbNoAKDZmNzQ4YmMxZTdmYmFlODc2ZmY0N2UzYWJlNDc3MjUzYTBlNzBjMDk", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2022-03-02T15:48:26Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2022-03-08T21:15:55Z"}, "message": "c++: Attribute deprecated/unavailable divergence\n\nAttributes deprecated and unavailable are largely the same, except\nthat the former produces a warning whereas the latter produces an error.\nSo is_late_template_attribute should treat them the same.  Confirmed by\nIain that this divergence is not intentional:\n<https://gcc.gnu.org/pipermail/gcc-patches/2022-February/591007.html>.\n\ngcc/cp/ChangeLog:\n\n\t* decl2.cc (is_late_template_attribute): Do not defer attribute\n\tunavailable.\n\t* pt.cc (tsubst_enum): Set TREE_UNAVAILABLE.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/ext/attr-unavailable-9.C: Add dg-error.", "tree": {"sha": "4e3f54eccbabfaa9f819d3137443600d6a551c76", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4e3f54eccbabfaa9f819d3137443600d6a551c76"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6f748bc1e7fbae876ff47e3abe477253a0e70c09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f748bc1e7fbae876ff47e3abe477253a0e70c09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f748bc1e7fbae876ff47e3abe477253a0e70c09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f748bc1e7fbae876ff47e3abe477253a0e70c09/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3e369dad6cbecb1b490b3f3b154c600fba5a6f3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3e369dad6cbecb1b490b3f3b154c600fba5a6f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3e369dad6cbecb1b490b3f3b154c600fba5a6f3"}], "stats": {"total": 9, "additions": 4, "deletions": 5}, "files": [{"sha": "c53acf4546dda10dffe2ff01e9c8576f2407180a", "filename": "gcc/cp/decl2.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f748bc1e7fbae876ff47e3abe477253a0e70c09/gcc%2Fcp%2Fdecl2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f748bc1e7fbae876ff47e3abe477253a0e70c09/gcc%2Fcp%2Fdecl2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.cc?ref=6f748bc1e7fbae876ff47e3abe477253a0e70c09", "patch": "@@ -1314,6 +1314,7 @@ is_late_template_attribute (tree attr, tree decl)\n \t       /* But some attributes specifically apply to templates.  */\n \t       && !is_attribute_p (\"abi_tag\", name)\n \t       && !is_attribute_p (\"deprecated\", name)\n+\t       && !is_attribute_p (\"unavailable\", name)\n \t       && !is_attribute_p (\"visibility\", name))\n \treturn true;\n       else"}, {"sha": "c350ebb0a799cef9eaab3219ff6e8bd42474167e", "filename": "gcc/cp/pt.cc", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f748bc1e7fbae876ff47e3abe477253a0e70c09/gcc%2Fcp%2Fpt.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f748bc1e7fbae876ff47e3abe477253a0e70c09/gcc%2Fcp%2Fpt.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.cc?ref=6f748bc1e7fbae876ff47e3abe477253a0e70c09", "patch": "@@ -26976,9 +26976,7 @@ tsubst_enum (tree tag, tree newtag, tree args)\n   DECL_SOURCE_LOCATION (TYPE_NAME (newtag))\n     = DECL_SOURCE_LOCATION (TYPE_NAME (tag));\n   TREE_DEPRECATED (newtag) = TREE_DEPRECATED (tag);\n-  /* We don't need to propagate TREE_UNAVAILABLE here, because it is, unlike\n-     deprecated, applied at instantiation time rather than template\n-     definition time.  */\n+  TREE_UNAVAILABLE (newtag) = TREE_UNAVAILABLE (tag);\n }\n \n /* DECL is a FUNCTION_DECL that is a template specialization.  Return"}, {"sha": "6df55d534f85a3a0a1317764ce3bad6468352827", "filename": "gcc/testsuite/g++.dg/ext/attr-unavailable-9.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6f748bc1e7fbae876ff47e3abe477253a0e70c09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattr-unavailable-9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6f748bc1e7fbae876ff47e3abe477253a0e70c09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattr-unavailable-9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattr-unavailable-9.C?ref=6f748bc1e7fbae876ff47e3abe477253a0e70c09", "patch": "@@ -3,10 +3,10 @@\n /* { dg-options \"\" } */\n \n template<typename T> struct __attribute__ ((unavailable)) S {};\n-S<int> s;\n+S<int> s;\t\t\t// { dg-error \"unavailable\" }\n \n template <template <class> class T> struct A { };\n-A<S> a;\n+A<S> a;\t\t\t\t// { dg-error \"unavailable\" }\n \n template <class T> void f() __attribute__ ((unavailable));\n "}]}