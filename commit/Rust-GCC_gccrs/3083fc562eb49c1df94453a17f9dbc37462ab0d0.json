{"sha": "3083fc562eb49c1df94453a17f9dbc37462ab0d0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzA4M2ZjNTYyZWI0OWMxZGY5NDQ1M2ExN2Y5ZGJjMzc0NjJhYjBkMA==", "commit": {"author": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2017-01-18T18:35:41Z"}, "committer": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2017-01-18T18:35:41Z"}, "message": "re PR fortran/70696 ([Coarray] ICE on EVENT POST of host-associated EVENT_TYPE coarray)\n\ngcc/fortran/ChangeLog:\n\n2017-01-17  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/70696\n\tMissed some parts, here they are:\n\t* trans-decl.c (gfc_build_qualified_array): Add static tokens to the\n\tparent function's scope.\n\t* trans-expr.c (gfc_get_tree_for_caf_expr): Shorten code.  Remove\n\tunnecessary assert.\n\ngcc/testsuite/ChangeLog:\n\n2017-01-17  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/70696\n\t* gfortran.dg/coarray_event_1.f08: New test.\n\nFrom-SVN: r244587", "tree": {"sha": "7617d8af5a4812df06b8c844823c10cd509ae737", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7617d8af5a4812df06b8c844823c10cd509ae737"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3083fc562eb49c1df94453a17f9dbc37462ab0d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3083fc562eb49c1df94453a17f9dbc37462ab0d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3083fc562eb49c1df94453a17f9dbc37462ab0d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3083fc562eb49c1df94453a17f9dbc37462ab0d0/comments", "author": null, "committer": null, "parents": [{"sha": "9bca63d44bf10ac1341f44b86b1c0f5b1ca5bc1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bca63d44bf10ac1341f44b86b1c0f5b1ca5bc1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9bca63d44bf10ac1341f44b86b1c0f5b1ca5bc1b"}], "stats": {"total": 40, "additions": 35, "deletions": 5}, "files": [{"sha": "a10444c8c0b6a8bda49d1e8c3f9a58ad68f06454", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3083fc562eb49c1df94453a17f9dbc37462ab0d0", "patch": "@@ -1,3 +1,12 @@\n+2017-01-17  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/70696\n+\tMissed some cases, here they are:\n+\t* trans-decl.c (gfc_build_qualified_array): Add static tokens to the\n+\tparent function's scope.\n+\t* trans-expr.c (gfc_get_tree_for_caf_expr): Shorten code.  Remove\n+\tunnecessary assert.\n+\n 2017-01-13  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/70697"}, {"sha": "51c23e8c5df910f01c5098f2e3a15f8ed82d1657", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=3083fc562eb49c1df94453a17f9dbc37462ab0d0", "patch": "@@ -971,6 +971,8 @@ gfc_build_qualified_array (tree decl, gfc_symbol * sym)\n \t  DECL_CONTEXT (token) = sym->ns->proc_name->backend_decl;\n \t  gfc_module_add_decl (cur_module, token);\n \t}\n+      else if (sym->attr.host_assoc)\n+\tgfc_add_decl_to_parent_function (token);\n       else\n \tgfc_add_decl_to_function (token);\n     }"}, {"sha": "ee8e15d17538f1a8dee526191aa12634ad57ea6a", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=3083fc562eb49c1df94453a17f9dbc37462ab0d0", "patch": "@@ -1839,11 +1839,10 @@ gfc_get_tree_for_caf_expr (gfc_expr *expr)\n       }\n \n   /* Make sure the backend_decl is present before accessing it.  */\n-  if (expr->symtree->n.sym->backend_decl == NULL_TREE)\n-    expr->symtree->n.sym->backend_decl\n-\t= gfc_get_symbol_decl (expr->symtree->n.sym);\n-  caf_decl = expr->symtree->n.sym->backend_decl;\n-  gcc_assert (caf_decl);\n+  caf_decl = expr->symtree->n.sym->backend_decl == NULL_TREE\n+      ? gfc_get_symbol_decl (expr->symtree->n.sym)\n+      : expr->symtree->n.sym->backend_decl;\n+\n   if (expr->symtree->n.sym->ts.type == BT_CLASS)\n     {\n       if (expr->ref && expr->ref->type == REF_ARRAY)"}, {"sha": "01e71827258c03c49d905681b91c0f9339b44980", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3083fc562eb49c1df94453a17f9dbc37462ab0d0", "patch": "@@ -1,3 +1,8 @@\n+2017-01-17  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/70696\n+\t* gfortran.dg/coarray_event_1.f08: New test.\n+\n 2017-01-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/77416"}, {"sha": "51fc54c162a82deb6009079b0ebde2436b3c5b1c", "filename": "gcc/testsuite/gfortran.dg/coarray_event_1.f08", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_event_1.f08", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3083fc562eb49c1df94453a17f9dbc37462ab0d0/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_event_1.f08", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_event_1.f08?ref=3083fc562eb49c1df94453a17f9dbc37462ab0d0", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do compile }\n+! { dg-options \"-fcoarray=lib -lcaf_single\" }\n+\n+! Check that pr70696 is really fixed.\n+\n+  use iso_fortran_env\n+  type(event_type) :: x[*]\n+\n+  ! exchange must not be called or the link problem before the patch\n+  ! does not occur.\n+contains\n+  subroutine exchange\n+    event post (x[1])\n+  end subroutine\n+end "}]}