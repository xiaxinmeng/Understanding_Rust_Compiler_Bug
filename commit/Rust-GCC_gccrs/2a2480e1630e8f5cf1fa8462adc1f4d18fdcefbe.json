{"sha": "2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmEyNDgwZTE2MzBlOGY1Y2YxZmE4NDYyYWRjMWY0ZDE4ZmRjZWZiZQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@yorick.cygnus.com", "date": "1998-10-28T03:36:56Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "1998-10-28T03:36:56Z"}, "message": "init.c (build_delete): Reset TYPE_HAS_DESTRUCTOR here.\n\n\t* init.c (build_delete): Reset TYPE_HAS_DESTRUCTOR here.\n\t* decl.c (finish_function): Not here.\n\t(start_function): Do set DECL_INITIAL.\n\nFrom-SVN: r23392", "tree": {"sha": "ec69e5f4f4bfd9e8dd380c0b59682a4490093f6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ec69e5f4f4bfd9e8dd380c0b59682a4490093f6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/comments", "author": null, "committer": null, "parents": [{"sha": "a554186cb8acf21a9ebe94fa36319b327842c3ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a554186cb8acf21a9ebe94fa36319b327842c3ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a554186cb8acf21a9ebe94fa36319b327842c3ef"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "0c520b5d5c32615cb458c3a9cd2acf14a5ccdac8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "patch": "@@ -1,5 +1,9 @@\n 1998-10-28  Jason Merrill  <jason@yorick.cygnus.com>\n \n+\t* init.c (build_delete): Reset TYPE_HAS_DESTRUCTOR here.\n+\t* decl.c (finish_function): Not here.\n+\t(start_function): Do set DECL_INITIAL.\n+\t\n \t* pt.c (push_template_decl_real): Complain about default template\n \targs for enclosing classes.\n "}, {"sha": "a263acd709dd65fee61b90f7490198fcbcfb963b", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "patch": "@@ -12516,6 +12516,10 @@ start_function (declspecs, declarator, attrs, pre_parsed_p)\n       && TREE_CODE (TREE_TYPE (fntype)) == VOID_TYPE)\n     cp_warning (\"`operator=' should return a reference to `*this'\");\n \n+  /* Make the init_value nonzero so pushdecl knows this is not tentative.\n+     error_mark_node is replaced below (in poplevel) with the BLOCK.  */\n+  DECL_INITIAL (decl1) = error_mark_node;\n+\n #ifdef SET_DEFAULT_DECL_ATTRIBUTES\n   SET_DEFAULT_DECL_ATTRIBUTES (decl1, attrs);\n #endif\n@@ -13074,7 +13078,8 @@ finish_function (lineno, call_poplevel, nested)\n \t     pointer to represent the type of our base class.  */\n \n \t  /* This side-effect makes call to `build_delete' generate the\n-\t     code we have to have at the end of this destructor.  */\n+\t     code we have to have at the end of this destructor.\n+\t     `build_delete' will set the flag again.  */\n \t  TYPE_HAS_DESTRUCTOR (current_class_type) = 0;\n \n \t  /* These are two cases where we cannot delegate deletion.  */\n@@ -13133,8 +13138,6 @@ finish_function (lineno, call_poplevel, nested)\n \t\texpand_end_cond ();\n \t    }\n \n-\t  TYPE_HAS_DESTRUCTOR (current_class_type) = 1;\n-\n \t  virtual_size = c_sizeof (current_class_type);\n \n \t  /* At the end, call delete if that's what's requested.  */"}, {"sha": "2438e079d4cebb8c220252da78c809aad560da41", "filename": "gcc/cp/init.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=2a2480e1630e8f5cf1fa8462adc1f4d18fdcefbe", "patch": "@@ -3079,6 +3079,10 @@ build_delete (type, addr, auto_delete, flags, use_global_delete)\n       tree parent_auto_delete = auto_delete;\n       tree cond;\n \n+      /* Set this again before we call anything, as we might get called\n+\t recursively.  */\n+      TYPE_HAS_DESTRUCTOR (type) = 1;\n+\n       /* If we have member delete or vbases, we call delete in\n \t finish_function.  */\n       if (auto_delete == integer_zero_node)"}]}