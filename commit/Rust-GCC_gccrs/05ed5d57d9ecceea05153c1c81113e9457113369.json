{"sha": "05ed5d57d9ecceea05153c1c81113e9457113369", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDVlZDVkNTdkOWVjY2VlYTA1MTUzYzFjODExMTNlOTQ1NzExMzM2OQ==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-01-29T00:19:59Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-01-29T00:19:59Z"}, "message": "(find_auto_inc): Check for increment using single_set.\n\nFrom-SVN: r6436", "tree": {"sha": "5501cd029e1d40250d7c1a5f7ffa9e9e3795fff6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5501cd029e1d40250d7c1a5f7ffa9e9e3795fff6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/05ed5d57d9ecceea05153c1c81113e9457113369", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05ed5d57d9ecceea05153c1c81113e9457113369", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05ed5d57d9ecceea05153c1c81113e9457113369", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05ed5d57d9ecceea05153c1c81113e9457113369/comments", "author": null, "committer": null, "parents": [{"sha": "b77dfefc0c8ec4eb62549727fd64033ba8ee9c32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b77dfefc0c8ec4eb62549727fd64033ba8ee9c32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b77dfefc0c8ec4eb62549727fd64033ba8ee9c32"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "22580d42c857772ea3458b3f268cf60cfe9d5950", "filename": "gcc/flow.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05ed5d57d9ecceea05153c1c81113e9457113369/gcc%2Fflow.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05ed5d57d9ecceea05153c1c81113e9457113369/gcc%2Fflow.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fflow.c?ref=05ed5d57d9ecceea05153c1c81113e9457113369", "patch": "@@ -1,5 +1,5 @@\n /* Data flow analysis for GNU compiler.\n-   Copyright (C) 1987, 1988, 1992, 1993 Free Software Foundation, Inc.\n+   Copyright (C) 1987, 1988, 1992, 1993, 1994 Free Software Foundation, Inc.\n \n This file is part of GNU CC.\n \n@@ -1969,6 +1969,7 @@ find_auto_inc (needed, x, insn)\n {\n   rtx addr = XEXP (x, 0);\n   int offset = 0;\n+  rtx set;\n \n   /* Here we detect use of an index register which might be good for\n      postincrement, postdecrement, preincrement, or predecrement.  */\n@@ -1985,13 +1986,14 @@ find_auto_inc (needed, x, insn)\n       int regno = REGNO (addr);\n \n       /* Is the next use an increment that might make auto-increment? */\n-      incr = reg_next_use[regno];\n-      if (incr && GET_CODE (PATTERN (incr)) == SET\n+      if ((incr = reg_next_use[regno]) != 0\n+\t  && (set = single_set (incr)) != 0\n+\t  && GET_CODE (set) == SET\n \t  && BLOCK_NUM (incr) == BLOCK_NUM (insn)\n \t  /* Can't add side effects to jumps; if reg is spilled and\n \t     reloaded, there's no way to store back the altered value.  */\n \t  && GET_CODE (insn) != JUMP_INSN\n-\t  && (y = SET_SRC (PATTERN (incr)), GET_CODE (y) == PLUS)\n+\t  && (y = SET_SRC (set), GET_CODE (y) == PLUS)\n \t  && XEXP (y, 0) == addr\n \t  && GET_CODE (XEXP (y, 1)) == CONST_INT\n \t  && (0\n@@ -2013,7 +2015,7 @@ find_auto_inc (needed, x, insn)\n \t      use != 0 && use != (rtx) 1))\n \t{\n \t  int win = 0;\n-\t  rtx q = SET_DEST (PATTERN (incr));\n+\t  rtx q = SET_DEST (set);\n \n \t  if (dead_or_set_p (incr, addr))\n \t    win = 1;\n@@ -2097,14 +2099,14 @@ find_auto_inc (needed, x, insn)\n \n \t      /* Modify the old increment-insn to simply copy\n \t\t the already-incremented value of our register.  */\n-\t      SET_SRC (PATTERN (incr)) = addr;\n+\t      SET_SRC (set) = addr;\n \t      /* Indicate insn must be re-recognized.  */\n \t      INSN_CODE (incr) = -1;\n \n \t      /* If that makes it a no-op (copying the register into itself)\n \t\t then delete it so it won't appear to be a \"use\" and a \"set\"\n \t\t of this register.  */\n-\t      if (SET_DEST (PATTERN (incr)) == addr)\n+\t      if (SET_DEST (set) == addr)\n \t\t{\n \t\t  PUT_CODE (incr, NOTE);\n \t\t  NOTE_LINE_NUMBER (incr) = NOTE_INSN_DELETED;"}]}