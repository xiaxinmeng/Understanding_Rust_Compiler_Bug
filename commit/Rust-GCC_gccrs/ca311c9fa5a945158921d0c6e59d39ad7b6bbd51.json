{"sha": "ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2EzMTFjOWZhNWE5NDUxNTg5MjFkMGM2ZTU5ZDM5YWQ3YjZiYmQ1MQ==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2008-07-31T12:37:42Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2008-07-31T12:37:42Z"}, "message": "prj-part.adb, [...]: Move back spec of Parse_Single_Project to body...\n\n2008-07-31  Vincent Celier  <celier@adacore.com>\n\n\t* prj-part.adb, prj-part.ads, prj.adb, prj.ads, prj-env.adb:\n\tMove back spec of Parse_Single_Project to body, as it is not called\n\toutside of package Prj.Part.\n\t(Project_Data): Remove components Linker_Name, Linker_Path and\n\tMinimum_Linker_Options as they are no longer set.\n\tRemove function There_Are_Ada_Sources from package Prj and move code\n\tin the only place it was used, in Prj.Env.Set_Ada_Paths.\n\nFrom-SVN: r138394", "tree": {"sha": "111f450ff499447e2cacdf94ccfe431bde98835a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/111f450ff499447e2cacdf94ccfe431bde98835a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "58fda84daa95719faf5305ad44f09816d1de280a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58fda84daa95719faf5305ad44f09816d1de280a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58fda84daa95719faf5305ad44f09816d1de280a"}], "stats": {"total": 130, "additions": 52, "deletions": 78}, "files": [{"sha": "041a5e3cb77e4837297d80525d1c079653dadaf4", "filename": "gcc/ada/prj-env.adb", "status": "modified", "additions": 27, "deletions": 7, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj-env.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj-env.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.adb?ref=ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "patch": "@@ -2355,16 +2355,36 @@ package body Prj.Env is\n \n                         --  For a non-library project, add the object\n                         --  directory, if it is not a virtual project, and if\n-                        --  there are Ada sources or if the project is an\n-                        --  extending project. If there are no Ada sources,\n+                        --  there are Ada sources in the project or one of the\n+                        --  projects it extends. If there are no Ada sources,\n                         --  adding the object directory could disrupt the order\n                         --  of the object dirs in the path.\n \n-                        elsif not Data.Virtual\n-                          and then There_Are_Ada_Sources (In_Tree, Project)\n-                        then\n-                           Add_To_Object_Path\n-                             (Data.Object_Directory.Name, In_Tree);\n+                        elsif not Data.Virtual then\n+                           declare\n+                              Add_Object_Dir : Boolean := False;\n+                              Prj            : Project_Id := Project;\n+\n+                           begin\n+                              while not Add_Object_Dir\n+                                and then Prj /= No_Project\n+                              loop\n+                                 if In_Tree.Projects.Table\n+                                      (Prj).Ada_Sources /= Nil_String\n+                                 then\n+                                    Add_Object_Dir := True;\n+\n+                                 else\n+                                    Prj :=\n+                                      In_Tree.Projects.Table (Prj).Extends;\n+                                 end if;\n+                              end loop;\n+\n+                              if Add_Object_Dir then\n+                                 Add_To_Object_Path\n+                                   (Data.Object_Directory.Name, In_Tree);\n+                              end if;\n+                           end;\n                         end if;\n                      end if;\n                   end if;"}, {"sha": "901875ad204065aa6a33e908cfb787130771c0c3", "filename": "gcc/ada/prj-part.adb", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj-part.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj-part.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-part.adb?ref=ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "patch": "@@ -149,6 +149,30 @@ package body Prj.Part is\n    --  does not (because it is already extended), but other projects that it\n    --  imports may need to be virtually extended.\n \n+   type Extension_Origin is (None, Extending_Simple, Extending_All);\n+   --  Type of parameter From_Extended for procedures Parse_Single_Project and\n+   --  Post_Parse_Context_Clause. Extending_All means that we are parsing the\n+   --  tree rooted at an extending all project.\n+\n+   procedure Parse_Single_Project\n+     (In_Tree           : Project_Node_Tree_Ref;\n+      Project           : out Project_Node_Id;\n+      Extends_All       : out Boolean;\n+      Path_Name         : String;\n+      Extended          : Boolean;\n+      From_Extended     : Extension_Origin;\n+      In_Limited        : Boolean;\n+      Packages_To_Check : String_List_Access;\n+      Depth             : Natural;\n+      Current_Dir       : String);\n+   --  Parse a project file.\n+   --  Recursive procedure: it calls itself for imported and extended\n+   --  projects. When From_Extended is not None, if the project has already\n+   --  been parsed and is an extended project A, return the ultimate\n+   --  (not extended) project that extends A. When In_Limited is True,\n+   --  the importing path includes at least one \"limited with\".\n+   --  When parsing configuration projects, do not allow a depth > 1.\n+\n    procedure Pre_Parse_Context_Clause\n      (In_Tree        : Project_Node_Tree_Ref;\n       Context_Clause : out With_Id);"}, {"sha": "e1c69c5ab831932cb3ab40b8d0a123f298b42e46", "filename": "gcc/ada/prj-part.ads", "status": "modified", "additions": 1, "deletions": 25, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj-part.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj-part.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-part.ads?ref=ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2000-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2000-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -49,28 +49,4 @@ package Prj.Part is\n    --  Current_Directory is used for optimization purposes only, avoiding extra\n    --  system calls.\n \n-   type Extension_Origin is (None, Extending_Simple, Extending_All);\n-   --  Type of parameter From_Extended for procedures Parse_Single_Project and\n-   --  Post_Parse_Context_Clause. Extending_All means that we are parsing the\n-   --  tree rooted at an extending all project.\n-\n-   procedure Parse_Single_Project\n-     (In_Tree           : Project_Node_Tree_Ref;\n-      Project           : out Project_Node_Id;\n-      Extends_All       : out Boolean;\n-      Path_Name         : String;\n-      Extended          : Boolean;\n-      From_Extended     : Extension_Origin;\n-      In_Limited        : Boolean;\n-      Packages_To_Check : String_List_Access;\n-      Depth             : Natural;\n-      Current_Dir       : String);\n-   --  Parse a project file.\n-   --  Recursive procedure: it calls itself for imported and extended\n-   --  projects. When From_Extended is not None, if the project has already\n-   --  been parsed and is an extended project A, return the ultimate\n-   --  (not extended) project that extends A. When In_Limited is True,\n-   --  the importing path includes at least one \"limited with\".\n-   --  When parsing configuration projects, do not allow a depth > 1.\n-\n end Prj.Part;"}, {"sha": "23623f5fedafeef52086390f2a389216b06530fd", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 0, "deletions": 26, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "patch": "@@ -143,9 +143,6 @@ package body Prj is\n                       Objects_Path_File_Without_Libs => No_Path,\n                       Config_File_Name               => No_Path,\n                       Config_File_Temp               => False,\n-                      Linker_Name                    => No_File,\n-                      Linker_Path                    => No_Path,\n-                      Minimum_Linker_Options         => No_Name_List,\n                       Config_Checked                 => False,\n                       Checked                        => False,\n                       Seen                           => False,\n@@ -1155,29 +1152,6 @@ package body Prj is\n       return Extend_Name (Source_File_Name, Switches_Dependency_Suffix);\n    end Switches_Name;\n \n-   ---------------------------\n-   -- There_Are_Ada_Sources --\n-   ---------------------------\n-\n-   function There_Are_Ada_Sources\n-     (In_Tree : Project_Tree_Ref;\n-      Project : Project_Id) return Boolean\n-   is\n-      Prj : Project_Id;\n-\n-   begin\n-      Prj := Project;\n-      while Prj /= No_Project loop\n-         if In_Tree.Projects.Table (Prj).Ada_Sources /= Nil_String then\n-            return True;\n-         end if;\n-\n-         Prj := In_Tree.Projects.Table (Prj).Extends;\n-      end loop;\n-\n-      return False;\n-   end There_Are_Ada_Sources;\n-\n    -----------\n    -- Value --\n    -----------"}, {"sha": "9af43b388cebba5adda72742e895e47c9c788183", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca311c9fa5a945158921d0c6e59d39ad7b6bbd51/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=ca311c9fa5a945158921d0c6e59d39ad7b6bbd51", "patch": "@@ -1289,20 +1289,6 @@ package Prj is\n       --  use this field directly outside of the project manager, use\n       --  Prj.Env.Ada_Include_Path instead.\n \n-      -------------\n-      -- Linking --\n-      -------------\n-\n-      Linker_Name : File_Name_Type  := No_File;\n-      --  Value of attribute Language_Processing'Linker in the project file\n-\n-      Linker_Path : Path_Name_Type  := No_Path;\n-      --  Path of linker when attribute Language_Processing'Linker is specified\n-\n-      Minimum_Linker_Options : Name_List_Index := No_Name_List;\n-      --  List of options specified in attribute\n-      --  Language_Processing'Minimum_Linker_Options.\n-\n       -------------------\n       -- Miscellaneous --\n       -------------------\n@@ -1372,12 +1358,6 @@ package Prj is\n    --  Return True when Language_Name (which must be lower case) is one of the\n    --  languages used for the project.\n \n-   function There_Are_Ada_Sources\n-     (In_Tree : Project_Tree_Ref;\n-      Project : Project_Id) return Boolean;\n-   --  ??? needs comment\n-   --  ??? Name sounds strange, suggested replacement: Ada_Sources_Present\n-\n    Project_Error : exception;\n    --  Raised by some subprograms in Prj.Attr\n "}]}