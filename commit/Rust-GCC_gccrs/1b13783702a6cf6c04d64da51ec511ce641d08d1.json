{"sha": "1b13783702a6cf6c04d64da51ec511ce641d08d1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWIxMzc4MzcwMmE2Y2Y2YzA0ZDY0ZGE1MWVjNTExY2U2NDFkMDhkMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-07-07T21:16:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-07-07T21:16:28Z"}, "message": "lto-elf.c (ELFOSABI_NONE, [...]): Define if not defined.\n\n\t* lto-elf.c (ELFOSABI_NONE, ELFOSABI_LINUX): Define if not defined.\n\t(validate_file): Allow merging of ELFOSABI_NONE with ELFOSABI_LINUX\n\tobjects.\n\nFrom-SVN: r161935", "tree": {"sha": "0147709eb7e573be050ae4f185526d409bcfb85f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0147709eb7e573be050ae4f185526d409bcfb85f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b13783702a6cf6c04d64da51ec511ce641d08d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b13783702a6cf6c04d64da51ec511ce641d08d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b13783702a6cf6c04d64da51ec511ce641d08d1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b13783702a6cf6c04d64da51ec511ce641d08d1/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fc0f0c8bd3773ca921c1d8690bf6e0344ab630ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc0f0c8bd3773ca921c1d8690bf6e0344ab630ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc0f0c8bd3773ca921c1d8690bf6e0344ab630ad"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "40886c4b162c65b401f2a8664745fe5fb952430b", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b13783702a6cf6c04d64da51ec511ce641d08d1/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b13783702a6cf6c04d64da51ec511ce641d08d1/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=1b13783702a6cf6c04d64da51ec511ce641d08d1", "patch": "@@ -1,3 +1,9 @@\n+2010-07-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* lto-elf.c (ELFOSABI_NONE, ELFOSABI_LINUX): Define if not defined.\n+\t(validate_file): Allow merging of ELFOSABI_NONE with ELFOSABI_LINUX\n+\tobjects.\n+\n 2010-07-05  Jan Hubicka  <jh@suse.cz>\n \n \t* lto.c (add_cgraph_node_to_partition): Forward declare; walk also"}, {"sha": "55a3db2228c95783480c9b8b5bc3929a8d43a023", "filename": "gcc/lto/lto-elf.c", "status": "modified", "additions": 28, "deletions": 3, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b13783702a6cf6c04d64da51ec511ce641d08d1/gcc%2Flto%2Flto-elf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b13783702a6cf6c04d64da51ec511ce641d08d1/gcc%2Flto%2Flto-elf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-elf.c?ref=1b13783702a6cf6c04d64da51ec511ce641d08d1", "patch": "@@ -38,6 +38,13 @@ along with GCC; see the file COPYING3.  If not see\n # define EM_SPARC32PLUS 18\n #endif\n \n+#ifndef ELFOSABI_NONE\n+# define ELFOSABI_NONE 0\n+#endif\n+#ifndef ELFOSABI_LINUX\n+# define ELFOSABI_LINUX 3\n+#endif\n+\n \n /* Handle opening elf files on hosts, such as Windows, that may use \n    text file handling that will break binary access.  */\n@@ -519,10 +526,28 @@ validate_file (lto_elf_file *elf_file)\n       memcpy (cached_file_attrs.elf_ident, elf_ident,\n \t      sizeof cached_file_attrs.elf_ident);\n     }\n+  else\n+    {\n+      char elf_ident_buf[EI_NIDENT];\n+\n+      memcpy (elf_ident_buf, elf_ident, sizeof elf_ident_buf);\n \n-  if (memcmp (elf_ident, cached_file_attrs.elf_ident,\n-\t      sizeof cached_file_attrs.elf_ident))\n-    return false;\n+      if (elf_ident_buf[EI_OSABI] != cached_file_attrs.elf_ident[EI_OSABI])\n+\t{\n+\t  /* Allow mixing ELFOSABI_NONE with ELFOSABI_LINUX, with the result\n+\t     ELFOSABI_LINUX.  */\n+\t  if (elf_ident_buf[EI_OSABI] == ELFOSABI_NONE\n+\t      && cached_file_attrs.elf_ident[EI_OSABI] == ELFOSABI_LINUX)\n+\t    elf_ident_buf[EI_OSABI] = cached_file_attrs.elf_ident[EI_OSABI];\n+\t  else if (elf_ident_buf[EI_OSABI] == ELFOSABI_LINUX\n+\t\t   && cached_file_attrs.elf_ident[EI_OSABI] == ELFOSABI_NONE)\n+\t    cached_file_attrs.elf_ident[EI_OSABI] = elf_ident_buf[EI_OSABI];\n+\t}\n+\n+      if (memcmp (elf_ident_buf, cached_file_attrs.elf_ident,\n+\t\t  sizeof cached_file_attrs.elf_ident))\n+\treturn false;\n+    }\n \n   /* Check that the input file is a relocatable object file with the correct\n      architecture.  */"}]}