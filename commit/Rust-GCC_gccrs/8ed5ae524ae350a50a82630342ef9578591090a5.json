{"sha": "8ed5ae524ae350a50a82630342ef9578591090a5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGVkNWFlNTI0YWUzNTBhNTBhODI2MzAzNDJlZjk1Nzg1OTEwOTBhNQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-03-09T14:10:17Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-03-09T14:10:17Z"}, "message": "re PR fortran/71203 (ICE in add_init_expr_to_sym, at fortran/decl.c:1512 and :1564)\n\n2019-03-09  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/71203\n\t* decl.c (add_init_expr_to_sym):  Add shape if init has none.  Add\n\tassert that it has to be an EXPR_ARRAY in this case.\n\n2019-03-09  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/71203\n\t* gfortran.dg/array_simplify_3.f90: New test case.\n\nFrom-SVN: r269526", "tree": {"sha": "5378b67d3a528243b31abcd67acffdc1a2766a28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5378b67d3a528243b31abcd67acffdc1a2766a28"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ed5ae524ae350a50a82630342ef9578591090a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ed5ae524ae350a50a82630342ef9578591090a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ed5ae524ae350a50a82630342ef9578591090a5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ed5ae524ae350a50a82630342ef9578591090a5/comments", "author": null, "committer": null, "parents": [{"sha": "3568d2d5fa77f5c8798c1dca46b1f738d2097202", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3568d2d5fa77f5c8798c1dca46b1f738d2097202", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3568d2d5fa77f5c8798c1dca46b1f738d2097202"}], "stats": {"total": 30, "additions": 28, "deletions": 2}, "files": [{"sha": "48ab06b0a185bf04da41096b813afe6059367e3c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=8ed5ae524ae350a50a82630342ef9578591090a5", "patch": "@@ -1,3 +1,9 @@\n+2019-03-09  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/71203\n+\t* decl.c (add_init_expr_to_sym):  Add shape if init has none.  Add\n+\tasserts that it has to be an EXPR_ARRAY in this case.\n+\n 2019-03-08  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR other/80058"}, {"sha": "31c7fb6325ce43c60f3e68fe258ad729f85ec91e", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=8ed5ae524ae350a50a82630342ef9578591090a5", "patch": "@@ -1983,8 +1983,14 @@ add_init_expr_to_sym (const char *name, gfc_expr **initp, locus *var_locus)\n \t      return false;\n \t    }\n \n-\t  /* Shape should be present, we get an initialization expression.  */\n-\t  gcc_assert (init->shape);\n+\t  /* The shape may be NULL for EXPR_ARRAY, set it.  */\n+\t  if (init->shape == NULL)\n+\t    {\n+\t      gcc_assert (init->expr_type == EXPR_ARRAY);\n+\t      init->shape = gfc_get_shape (1);\n+\t      if (!gfc_array_size (init, &init->shape[0]))\n+\t\t  gfc_internal_error (\"gfc_array_size failed\");\n+\t    }\n \n \t  for (dim = 0; dim < sym->as->rank; ++dim)\n \t    {"}, {"sha": "d100f1bcdcd58580e52c293817d01bc1040d057a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8ed5ae524ae350a50a82630342ef9578591090a5", "patch": "@@ -1,3 +1,8 @@\n+2019-03-09  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/71203\n+\t* gfortran.dg/array_simplify_3.f90: New test case.\n+\n 2019-03-09  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/88568"}, {"sha": "31183b06990f20f135d65416684404357e028ab9", "filename": "gcc/testsuite/gfortran.dg/array_simplify_3.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_simplify_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ed5ae524ae350a50a82630342ef9578591090a5/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_simplify_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_simplify_3.f90?ref=8ed5ae524ae350a50a82630342ef9578591090a5", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do  run }\n+! PR 71203 - this used to ICE\n+program p\n+   integer :: i\n+   integer, parameter :: x(2) = 0\n+   integer, parameter :: y(*) = [(x(i:i), i=1,2)]\n+   if (size(y,1) /= 2) stop 1\n+   if (any(y /= 0)) stop 2\n+end"}]}