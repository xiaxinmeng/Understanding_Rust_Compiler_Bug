{"sha": "4460c638fafddef1df1d35efc52ca1e339b54342", "node_id": "C_kwDOANBUbNoAKDQ0NjBjNjM4ZmFmZGRlZjFkZjFkMzVlZmM1MmNhMWUzMzliNTQzNDI", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-01-17T10:27:59Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-01-17T10:28:47Z"}, "message": "Add check_effective_target_pytest3.\n\ngcc/testsuite/ChangeLog:\n\n\t* lib/gcov.exp: Use check_effective_target_pytest3.\n\t* lib/target-supports.exp: Add check_effective_target_pytest3.", "tree": {"sha": "b1a06b98849c5d58bf977edbb2d1c63b6733e8ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1a06b98849c5d58bf977edbb2d1c63b6733e8ec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4460c638fafddef1df1d35efc52ca1e339b54342", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4460c638fafddef1df1d35efc52ca1e339b54342", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4460c638fafddef1df1d35efc52ca1e339b54342", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4460c638fafddef1df1d35efc52ca1e339b54342/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84eb13b9d6a9979825f5deaa1c17762bf8c8ef9f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84eb13b9d6a9979825f5deaa1c17762bf8c8ef9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84eb13b9d6a9979825f5deaa1c17762bf8c8ef9f"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "6c57515e229efbf19fdcfb2c403cdd3babe4190f", "filename": "gcc/testsuite/lib/gcov.exp", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4460c638fafddef1df1d35efc52ca1e339b54342/gcc%2Ftestsuite%2Flib%2Fgcov.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4460c638fafddef1df1d35efc52ca1e339b54342/gcc%2Ftestsuite%2Flib%2Fgcov.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcov.exp?ref=4460c638fafddef1df1d35efc52ca1e339b54342", "patch": "@@ -17,6 +17,8 @@\n # Verify various kinds of gcov output: line counts, branch percentages,\n # and call return percentages.  None of this is language-specific.\n \n+load_lib \"target-supports.exp\"\n+\n global GCOV\n \n #\n@@ -274,11 +276,8 @@ proc run-gcov-pytest { args } {\n     set testcase [remote_download host $testcase]\n     set result [remote_exec host $GCOV \"$testcase -i\"]\n \n-    set pytest_cmd \"python3 -m pytest --color=no -rap -s --tb=no\"\n-    set result [remote_exec host \"$pytest_cmd --version\"]\n-    set status [lindex $result 0]\n-    if { $status != 0 } then {\n-      unsupported \"$subdir/$testcase run-gcov-pytest python3 pytest missing\"\n+    if { ![check_effective_target_pytest3] } {\n+      unsupported \"$script pytest python3 is missing\"\n       return\n     }\n "}, {"sha": "fd48475a57c98f553d0b1b8685a2cf07521c4b4f", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4460c638fafddef1df1d35efc52ca1e339b54342/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4460c638fafddef1df1d35efc52ca1e339b54342/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=4460c638fafddef1df1d35efc52ca1e339b54342", "patch": "@@ -11734,3 +11734,15 @@ proc check_effective_target_python3 { } {\n         return 0;\n     }\n }\n+\n+# Return 1 if pytest module is available for python3.\n+\n+proc check_effective_target_pytest3 { } {\n+    set result [remote_exec host \"python3 -m pytest --color=no -rap -s --tb=no --version\"]\n+    set status [lindex $result 0]\n+    if { $status == 0 } then {\n+        return 1;\n+    } else {\n+        return 0;\n+    }\n+}"}]}