{"sha": "74580e1b05a04184bd23ad115f10d09428535182", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQ1ODBlMWIwNWEwNDE4NGJkMjNhZDExNWYxMGQwOTQyODUzNTE4Mg==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2020-08-06T20:19:18Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-10-21T07:22:48Z"}, "message": "[Ada] Refactor repeated calls to Etype in aggregate expansion\n\ngcc/ada/\n\n\t* exp_aggr.adb (Expand_N_Aggregate): Refactor repeated calls to\n\tEtype (N).\n\t(Build_Array_Aggr_Code): Fix whitespace.", "tree": {"sha": "b71dda127b29b1107da045046d32c4852dc44e7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b71dda127b29b1107da045046d32c4852dc44e7c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/74580e1b05a04184bd23ad115f10d09428535182", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74580e1b05a04184bd23ad115f10d09428535182", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74580e1b05a04184bd23ad115f10d09428535182", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74580e1b05a04184bd23ad115f10d09428535182/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3c2d338129a5c77a95b1b6d165db0ec328fb1938", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c2d338129a5c77a95b1b6d165db0ec328fb1938", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c2d338129a5c77a95b1b6d165db0ec328fb1938"}], "stats": {"total": 18, "additions": 9, "deletions": 9}, "files": [{"sha": "bbb4f889454796a3822cf8d69dd4da096cc85aab", "filename": "gcc/ada/exp_aggr.adb", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74580e1b05a04184bd23ad115f10d09428535182/gcc%2Fada%2Fexp_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74580e1b05a04184bd23ad115f10d09428535182/gcc%2Fada%2Fexp_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_aggr.adb?ref=74580e1b05a04184bd23ad115f10d09428535182", "patch": "@@ -2334,7 +2334,7 @@ package body Exp_Aggr is\n             Sort_Case_Table (Table);\n          end if;\n \n-         --  STEP 1 (b):  take care of the whole set of discrete choices\n+         --  STEP 1 (b): take care of the whole set of discrete choices\n \n          for J in 1 .. Nb_Choices loop\n             Low  := Table (J).Choice_Lo;\n@@ -6755,15 +6755,16 @@ package body Exp_Aggr is\n    ------------------------\n \n    procedure Expand_N_Aggregate (N : Node_Id) is\n+      T : constant Entity_Id := Etype (N);\n    begin\n       --  Record aggregate case\n \n-      if Is_Record_Type (Etype (N))\n-        and then not Is_Private_Type (Etype (N))\n+      if Is_Record_Type (T)\n+        and then not Is_Private_Type (T)\n       then\n          Expand_Record_Aggregate (N);\n \n-      elsif Has_Aspect (Etype (N), Aspect_Aggregate) then\n+      elsif Has_Aspect (T, Aspect_Aggregate) then\n          Expand_Container_Aggregate (N);\n \n       --  Array aggregate case\n@@ -6811,11 +6812,10 @@ package body Exp_Aggr is\n                  and then No (Expressions (N))\n                then\n                   declare\n-                     T  : constant Entity_Id := Etype (N);\n-                     X  : constant Node_Id   := First_Index (T);\n-                     EC : constant Node_Id   := Expression (CA);\n-                     CV : constant Uint      := Char_Literal_Value (EC);\n-                     CC : constant Int       := UI_To_Int (CV);\n+                     X  : constant Node_Id := First_Index (T);\n+                     EC : constant Node_Id := Expression (CA);\n+                     CV : constant Uint    := Char_Literal_Value (EC);\n+                     CC : constant Int     := UI_To_Int (CV);\n \n                   begin\n                      if Nkind (X) = N_Range"}]}