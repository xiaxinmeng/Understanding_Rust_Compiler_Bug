{"sha": "35d6801ebe76223839d318e66696d28fe903c739", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzVkNjgwMWViZTc2MjIzODM5ZDMxOGU2NjY5NmQyOGZlOTAzYzczOQ==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2003-12-10T17:37:25Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2003-12-10T17:37:25Z"}, "message": "re PR libstdc++/10063 (stdio_filebuf broken)\n\n\n2003-12-10  Benjamin Kosnik  <bkoz@redhat.com>\n\n\tPR libstdc++/10063\n\t* config/io/basic_file_stdio.cc (__basic_file::sys_open): Sync.\n\t* testsuite/ext/stdio_filebuf/char/10063-1.cc: New.\n\t* testsuite/ext/stdio_filebuf/char/10063-2.cc: New.\n\nFrom-SVN: r74505", "tree": {"sha": "2a2910ad8f33a15a4bfda984ed7d92eb00f023af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a2910ad8f33a15a4bfda984ed7d92eb00f023af"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35d6801ebe76223839d318e66696d28fe903c739", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35d6801ebe76223839d318e66696d28fe903c739", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35d6801ebe76223839d318e66696d28fe903c739", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35d6801ebe76223839d318e66696d28fe903c739/comments", "author": null, "committer": null, "parents": [{"sha": "da5cafa77442b390371d8d6278746862cabea482", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da5cafa77442b390371d8d6278746862cabea482", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da5cafa77442b390371d8d6278746862cabea482"}], "stats": {"total": 121, "additions": 120, "deletions": 1}, "files": [{"sha": "39dfb089a7dc1f500f3ca843fa73480c458d8805", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=35d6801ebe76223839d318e66696d28fe903c739", "patch": "@@ -1,3 +1,10 @@\n+2003-12-10  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\tPR libstdc++/10063\n+\t* config/io/basic_file_stdio.cc (__basic_file::sys_open): Sync.\n+\t* testsuite/ext/stdio_filebuf/char/10063-1.cc: New.\n+\t* testsuite/ext/stdio_filebuf/char/10063-2.cc: New.\n+\t\n 2003-12-10  Paolo Carlini  <pcarlini@suse.de>\n \n \t* include/bits/locale_facets.tcc (num_put::do_put(void*)):"}, {"sha": "7d014e448b4a03ca1fda33f82e1af9ec33ea12b4", "filename": "libstdc++-v3/config/io/basic_file_stdio.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2Fconfig%2Fio%2Fbasic_file_stdio.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2Fconfig%2Fio%2Fbasic_file_stdio.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fio%2Fbasic_file_stdio.cc?ref=35d6801ebe76223839d318e66696d28fe903c739", "patch": "@@ -134,6 +134,7 @@ namespace std\n       {\n  \t_M_cfile = __file;\n  \t_M_cfile_created = false;\n+\tthis->sync();\n   \t__ret = this;\n       }\n     return __ret;\n@@ -201,7 +202,7 @@ namespace std\n \tif (_M_cfile_created)\n \t  fclose(_M_cfile);\n \telse\n-\t  fflush(_M_cfile);\n+\t  this->sync();\n \t_M_cfile = 0;\n \t__ret = this;\n       }"}, {"sha": "3a60293164cdeccef563f013492f876201179ec9", "filename": "libstdc++-v3/testsuite/ext/stdio_filebuf/char/10063-1.cc", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fstdio_filebuf%2Fchar%2F10063-1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fstdio_filebuf%2Fchar%2F10063-1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fstdio_filebuf%2Fchar%2F10063-1.cc?ref=35d6801ebe76223839d318e66696d28fe903c739", "patch": "@@ -0,0 +1,54 @@\n+// Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 2, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING.  If not, write to the Free\n+// Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307,\n+// USA.\n+\n+#include <cstdio>\n+#include <fstream>\n+#include <ext/stdio_filebuf.h>\n+#include <testsuite_hooks.h>\n+\n+void test1()\n+{\n+  using namespace std;\n+  bool test __attribute__((unused)) = true;\n+\n+  FILE* file = fopen(\"tmp_10063-1\", \"w\");\n+  putc('0', file);\n+  putc('1', file);\n+  {\n+    __gnu_cxx::stdio_filebuf<char> sbuf(file, ios_base::out);\n+    sbuf.sputc('2');\n+    sbuf.sputc('3');\n+  }\n+  putc('4', file);\t\n+  fclose(file);\n+\n+  filebuf fbuf;\n+  fbuf.open(\"tmp_10063-1\", ios_base::in);\t\n+  char buf[10];\n+  streamsize n = fbuf.sgetn(buf, sizeof(buf));\t\t\n+  fbuf.close();\n+\n+  VERIFY(n == 5);\n+  VERIFY(!memcmp(buf, \"01234\", 5)); \n+}\n+\n+int main()\n+{\n+  test1();\n+  return 0;\n+}"}, {"sha": "9786d7090284df16e5fa01b2b69b040e306d6540", "filename": "libstdc++-v3/testsuite/ext/stdio_filebuf/char/10063-2.cc", "status": "added", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fstdio_filebuf%2Fchar%2F10063-2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35d6801ebe76223839d318e66696d28fe903c739/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fstdio_filebuf%2Fchar%2F10063-2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fext%2Fstdio_filebuf%2Fchar%2F10063-2.cc?ref=35d6801ebe76223839d318e66696d28fe903c739", "patch": "@@ -0,0 +1,57 @@\n+// Copyright (C) 2000, 2001, 2002, 2003 Free Software Foundation\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 2, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING.  If not, write to the Free\n+// Software Foundation, 59 Temple Place - Suite 330, Boston, MA 02111-1307,\n+// USA.\n+\n+#include <cstdio>\n+#include <fstream>\n+#include <ext/stdio_filebuf.h>\n+#include <testsuite_hooks.h>\n+\n+void test2()\n+{\n+  using namespace std;\n+  bool test __attribute__((unused)) = true;\n+\n+  filebuf fbuf;\n+  fbuf.open(\"tmp_10063-2\", ios_base::out | ios_base::trunc);\n+  fbuf.sputn(\"01234\", 5);\n+  fbuf.close();\n+\n+  FILE* file = fopen(\"tmp_10063-2\", \"r\");\n+  int c = getc(file);\n+  VERIFY(c == '0');\n+  c = getc(file);\n+  VERIFY(c == '1');\n+  {\n+    __gnu_cxx::stdio_filebuf<char> sbuf(file, ios_base::in);\n+    c = sbuf.sbumpc();\n+    VERIFY(c == '2');\n+    c = sbuf.sbumpc();\n+    VERIFY(c == '3');\n+    c = sbuf.sbumpc();\n+    VERIFY(c == '4');\n+    c = sbuf.sgetc();\n+    VERIFY(c == EOF);\n+  }\n+  fclose(file);\n+}\n+\n+int main()\n+{\n+  test2();\n+  return 0;\n+}"}]}