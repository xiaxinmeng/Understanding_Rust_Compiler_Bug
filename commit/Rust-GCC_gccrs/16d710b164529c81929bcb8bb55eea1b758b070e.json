{"sha": "16d710b164529c81929bcb8bb55eea1b758b070e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZkNzEwYjE2NDUyOWM4MTkyOWJjYjhiYjU1ZWVhMWI3NThiMDcwZQ==", "commit": {"author": {"name": "Caroline Tice", "email": "cmtice@google.com", "date": "2015-04-27T16:44:35Z"}, "committer": {"name": "Caroline Tice", "email": "ctice@gcc.gnu.org", "date": "2015-04-27T16:44:35Z"}, "message": "Give proper type and size to named cold partitions.\n\n2015-04-27  Caroline Tice  <cmtice@google.com>\n\n\t* final.c (final_scan_insn):  Output cold_function_nmae as function\n\ttype.\n\t* varasm.c (cold_function_name):  Make gloval.\n\t(assemble_start_function):  Re-set cold_function_name.\n\t(assemble_end_function): Output cold partition size.\n\t* varasm.h (cold_fun ction_name):  Declare global.\n\n2015-04-27  Caroline Tice  <cmtice@google.com>\n\n\t* gcc.dg/tree-prof/cold_partition_label.c (main): Check for cold\n\tpartition size.\n\nFrom-SVN: r222473", "tree": {"sha": "df19ff6f9889f28dc41876292756363a07ed31ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/df19ff6f9889f28dc41876292756363a07ed31ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16d710b164529c81929bcb8bb55eea1b758b070e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16d710b164529c81929bcb8bb55eea1b758b070e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16d710b164529c81929bcb8bb55eea1b758b070e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16d710b164529c81929bcb8bb55eea1b758b070e/comments", "author": {"login": "cmtice", "id": 5561162, "node_id": "MDQ6VXNlcjU1NjExNjI=", "avatar_url": "https://avatars.githubusercontent.com/u/5561162?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cmtice", "html_url": "https://github.com/cmtice", "followers_url": "https://api.github.com/users/cmtice/followers", "following_url": "https://api.github.com/users/cmtice/following{/other_user}", "gists_url": "https://api.github.com/users/cmtice/gists{/gist_id}", "starred_url": "https://api.github.com/users/cmtice/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cmtice/subscriptions", "organizations_url": "https://api.github.com/users/cmtice/orgs", "repos_url": "https://api.github.com/users/cmtice/repos", "events_url": "https://api.github.com/users/cmtice/events{/privacy}", "received_events_url": "https://api.github.com/users/cmtice/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0a48088a0b7339e8f1d000aee282cfb7e394938d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a48088a0b7339e8f1d000aee282cfb7e394938d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a48088a0b7339e8f1d000aee282cfb7e394938d"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "b36391e029f1ba2cd3af7fa1a03b0c29db1061e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=16d710b164529c81929bcb8bb55eea1b758b070e", "patch": "@@ -1,3 +1,12 @@\n+2015-04-27  Caroline Tice  <cmtice@google.com>\n+\n+\t* final.c (final_scan_insn):  Output cold_function_nmae as function\n+\ttype.\n+\t* varasm.c (cold_function_name):  Make gloval.\n+\t(assemble_start_function):  Re-set cold_function_name.\n+\t(assemble_end_function): Output cold partition size.\n+\t* varasm.h (cold_fun ction_name):  Declare global.\n+\n 2015-04-27  Ilya Tocar  <ilya.tocar@intel.com>\n \n \t* config/i386/i386.h (EXT_REX_SSE_REG_P): New."}, {"sha": "968e52594b3d0b782f898f2d2a78264e8cb72894", "filename": "gcc/final.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=16d710b164529c81929bcb8bb55eea1b758b070e", "patch": "@@ -2233,10 +2233,16 @@ final_scan_insn (rtx_insn *insn, FILE *file, int optimize_p ATTRIBUTE_UNUSED,\n \t     suffixing \"cold\" to the original function's name.  */\n \t  if (in_cold_section_p)\n \t    {\n-\t      tree cold_function_name\n+\t      cold_function_name\n \t\t= clone_function_name (current_function_decl, \"cold\");\n+#ifdef ASM_DECLARE_FUNCTION_NAME\n+\t      ASM_DECLARE_FUNCTION_NAME (asm_out_file,\n+\t\t\t\t\t IDENTIFIER_POINTER (cold_function_name),\n+\t\t\t\t\t current_function_decl);\n+#else\n \t      ASM_OUTPUT_LABEL (asm_out_file,\n \t\t\t\tIDENTIFIER_POINTER (cold_function_name));\n+#endif\n \t    }\n \t  break;\n "}, {"sha": "21e4174b5e6a63a7c43791b675bfe99c677bcd63", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=16d710b164529c81929bcb8bb55eea1b758b070e", "patch": "@@ -1,3 +1,8 @@\n+2015-04-27  Caroline Tice  <cmtice@google.com>\n+\n+\t* gcc.dg/tree-prof/cold_partition_label.c (main): Check for cold\n+\tpartition size.\n+\n 2015-04-27  Peter Bergner  <bergner@vnet.ibm.com>\n \n \tPR target/64579"}, {"sha": "643707f75f851ffc848f3dee5a100bff04105a7d", "filename": "gcc/testsuite/gcc.dg/tree-prof/cold_partition_label.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fcold_partition_label.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fcold_partition_label.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fcold_partition_label.c?ref=16d710b164529c81929bcb8bb55eea1b758b070e", "patch": "@@ -35,4 +35,6 @@ main (int argc, char *argv[])\n   return 0;\n }\n \n+/* { dg-final-use { scan-assembler \"foo\\[._\\]+cold\\[\\._\\]+0\" } } */\n+/* { dg-final-use { scan-assembler \"size\\[ \\ta-zA-Z0-0\\]+foo\\[._\\]+cold\\[\\._\\]+0\" } } */\n /* { dg-final-use { cleanup-saved-temps } } */"}, {"sha": "eab937f051eb3758658fc180e7c8a74b0d24f0dd", "filename": "gcc/varasm.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=16d710b164529c81929bcb8bb55eea1b758b070e", "patch": "@@ -187,6 +187,13 @@ section *in_section;\n    at the cold section.  */\n bool in_cold_section_p;\n \n+/* The following global holds the \"function name\" for the code in the\n+   cold section of a function, if hot/cold function splitting is enabled\n+   and there was actually code that went into the cold section.  A\n+   pseudo function name is needed for the cold section of code for some\n+   debugging tools that perform symbolization. */\n+tree cold_function_name = NULL_TREE;\n+\n /* A linked list of all the unnamed sections.  */\n static GTY(()) section *unnamed_sections;\n \n@@ -1719,6 +1726,7 @@ assemble_start_function (tree decl, const char *fnname)\n       ASM_GENERATE_INTERNAL_LABEL (tmp_label, \"LCOLDE\", const_labelno);\n       crtl->subsections.cold_section_end_label = ggc_strdup (tmp_label);\n       const_labelno++;\n+      cold_function_name = NULL_TREE;\n     }\n   else\n     {\n@@ -1856,6 +1864,10 @@ assemble_end_function (tree decl, const char *fnname ATTRIBUTE_UNUSED)\n \n       save_text_section = in_section;\n       switch_to_section (unlikely_text_section ());\n+      if (cold_function_name != NULL_TREE)\n+\tASM_DECLARE_FUNCTION_SIZE (asm_out_file,\n+\t\t\t\t   IDENTIFIER_POINTER (cold_function_name),\n+\t\t\t\t   decl);\n       ASM_OUTPUT_LABEL (asm_out_file, crtl->subsections.cold_section_end_label);\n       if (first_function_block_is_cold)\n \tswitch_to_section (text_section);"}, {"sha": "0d7d5638f2a2792867aad7201a83618dd333eb70", "filename": "gcc/varasm.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Fvarasm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16d710b164529c81929bcb8bb55eea1b758b070e/gcc%2Fvarasm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.h?ref=16d710b164529c81929bcb8bb55eea1b758b070e", "patch": "@@ -20,6 +20,13 @@ along with GCC; see the file COPYING3.  If not see\n #ifndef GCC_VARASM_H\n #define GCC_VARASM_H\n \n+/* The following global holds the \"function name\" for the code in the\n+   cold section of a function, if hot/cold function splitting is enabled\n+   and there was actually code that went into the cold section.  A\n+   pseudo function name is needed for the cold section of code for some\n+   debugging tools that perform symbolization. */\n+extern tree cold_function_name;\n+\n extern tree tree_output_constant_def (tree);\n extern void make_decl_rtl (tree);\n extern rtx make_decl_rtl_for_debug (tree);"}]}