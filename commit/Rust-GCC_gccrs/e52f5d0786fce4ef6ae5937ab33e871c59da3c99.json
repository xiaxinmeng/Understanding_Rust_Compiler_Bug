{"sha": "e52f5d0786fce4ef6ae5937ab33e871c59da3c99", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTUyZjVkMDc4NmZjZTRlZjZhZTU5MzdhYjMzZTg3MWM1OWRhM2M5OQ==", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2020-06-23T16:08:54Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2020-06-25T15:02:46Z"}, "message": "d: Remove another dependency on the front-end OutBuffer type.\n\nAs the DMD front-end never frees allocated memory, the glue layer\nbetween the DMD front-end and GCC should generally avoid using DMD types\nand interfaces if the purpose is internal only.\n\ngcc/d/ChangeLog:\n\n\t* d-lang.cc (d_parse_file): Replace OutBuffer with obstack.", "tree": {"sha": "f3265654eb4df5a4fbb8fc5ea750e01f78fce9be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3265654eb4df5a4fbb8fc5ea750e01f78fce9be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e52f5d0786fce4ef6ae5937ab33e871c59da3c99", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e52f5d0786fce4ef6ae5937ab33e871c59da3c99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e52f5d0786fce4ef6ae5937ab33e871c59da3c99", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e52f5d0786fce4ef6ae5937ab33e871c59da3c99/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d103f336bdc3144e756c7634b8914830c867896d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d103f336bdc3144e756c7634b8914830c867896d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d103f336bdc3144e756c7634b8914830c867896d"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "2c474f8adea3a785e95a3de7f8ea56e78f2fe1fa", "filename": "gcc/d/d-lang.cc", "status": "modified", "additions": 10, "deletions": 8, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e52f5d0786fce4ef6ae5937ab33e871c59da3c99/gcc%2Fd%2Fd-lang.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e52f5d0786fce4ef6ae5937ab33e871c59da3c99/gcc%2Fd%2Fd-lang.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fd-lang.cc?ref=e52f5d0786fce4ef6ae5937ab33e871c59da3c99", "patch": "@@ -1032,18 +1032,20 @@ d_parse_file (void)\n       message (\"binary    %s\", global.params.argv0.ptr);\n       message (\"version   %s\", global.version.ptr);\n \n-      if (global.params.versionids)\n+      if (global.versionids)\n \t{\n-\t  OutBuffer buf;\n-\t  buf.writestring (\"predefs  \");\n-\t  for (size_t i = 0; i < global.params.versionids->length; i++)\n+\t  obstack buffer;\n+\t  gcc_obstack_init (&buffer);\n+\t  obstack_grow (&buffer, \"predefs  \", 9);\n+\t  for (size_t i = 0; i < global.versionids->length; i++)\n \t    {\n-\t      const char *s = (*global.params.versionids)[i];\n-\t      buf.writestring (\" \");\n-\t      buf.writestring (s);\n+\t      Identifier *id = (*global.versionids)[i];\n+\t      const char *str = id->toChars ();\n+\t      obstack_1grow (&buffer, ' ');\n+\t      obstack_grow (&buffer, str, strlen (str));\n \t    }\n \n-\t  message (\"%s\", buf.peekChars ());\n+\t  message (\"%s\", (char *) obstack_finish (&buffer));\n \t}\n     }\n "}]}