{"sha": "ce66b6f6cad2c071176d903486fdaea96796b31a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2U2NmI2ZjZjYWQyYzA3MTE3NmQ5MDM0ODZmZGFlYTk2Nzk2YjMxYQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2010-11-04T19:29:28Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2010-11-04T19:29:28Z"}, "message": "PR 44931 Move struct unix_stream to unix.c\n\nFrom-SVN: r166325", "tree": {"sha": "f69d8dda9791d56ef2baca9e9c0a428cd528ab0b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f69d8dda9791d56ef2baca9e9c0a428cd528ab0b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce66b6f6cad2c071176d903486fdaea96796b31a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce66b6f6cad2c071176d903486fdaea96796b31a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce66b6f6cad2c071176d903486fdaea96796b31a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce66b6f6cad2c071176d903486fdaea96796b31a/comments", "author": null, "committer": null, "parents": [{"sha": "269c80f2a6b982cdc8364e1d2885c7ce5e8d6b9a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/269c80f2a6b982cdc8364e1d2885c7ce5e8d6b9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/269c80f2a6b982cdc8364e1d2885c7ce5e8d6b9a"}], "stats": {"total": 63, "additions": 38, "deletions": 25}, "files": [{"sha": "f7fe9e1d39128199e0d1a9f2fcf2d291c3378ada", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=ce66b6f6cad2c071176d903486fdaea96796b31a", "patch": "@@ -1,3 +1,12 @@\n+2010-11-04  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR libfortran/44931\n+\t* io/inquire.c (inquire_via_unit): Use stream_ttyname() instead of\n+\tcalling ttyname() directly.\n+\t* io/unix.h (unix_stream): Move struct to unix.c.\n+\t* io/unix.c: Move struct unix_stream here.\n+\t(stream_ttyname): Don't mark the argument as unused if it is used.\n+\n 2010-11-04  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \t* io/unix.h (struct unix_stream): Remove prot member."}, {"sha": "24481ccccbe7773df290068420cd7752eb934e32", "filename": "libgfortran/io/inquire.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2Fio%2Finquire.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2Fio%2Finquire.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Finquire.c?ref=ce66b6f6cad2c071176d903486fdaea96796b31a", "patch": "@@ -73,7 +73,7 @@ inquire_via_unit (st_parameter_inquire *iqp, gfc_unit * u)\n \t  || u->unit_number == options.stdout_unit\n \t  || u->unit_number == options.stderr_unit)\n \t{\n-\t  char * tmp = ttyname (((unix_stream *) u->s)->fd);\n+\t  char * tmp = stream_ttyname (u->s);\n \t  if (tmp != NULL)\n \t    {\n \t      int tmplen = strlen (tmp);"}, {"sha": "e55af18a1bfe958ca9f9e880d12dd8a93ee795f6", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 28, "deletions": 3, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=ce66b6f6cad2c071176d903486fdaea96796b31a", "patch": "@@ -167,6 +167,27 @@ fallback_access (const char *path, int mode)\n \n static const int BUFFER_SIZE = 8192;\n \n+typedef struct\n+{\n+  stream st;\n+\n+  gfc_offset buffer_offset;\t/* File offset of the start of the buffer */\n+  gfc_offset physical_offset;\t/* Current physical file offset */\n+  gfc_offset logical_offset;\t/* Current logical file offset */\n+  gfc_offset file_length;\t/* Length of the file, -1 if not seekable. */\n+\n+  char *buffer;                 /* Pointer to the buffer.  */\n+  int fd;                       /* The POSIX file descriptor.  */\n+\n+  int active;\t\t\t/* Length of valid bytes in the buffer */\n+\n+  int ndirty;\t\t\t/* Dirty bytes starting at buffer_offset */\n+\n+  int special_file;\t\t/* =1 if the fd refers to a special file */\n+}\n+unix_stream;\n+\n+\n /* fix_fd()-- Given a file descriptor, make sure it is not one of the\n  * standard descriptors, returning a non-standard descriptor.  If the\n  * user specifies that system errors should go to standard output,\n@@ -1786,14 +1807,18 @@ stream_isatty (stream *s)\n }\n \n char *\n-stream_ttyname (stream *s __attribute__ ((unused)))\n-{\n #ifdef HAVE_TTYNAME\n+stream_ttyname (stream *s)\n+{\n   return ttyname (((unix_stream *) s)->fd);\n+}\n #else\n+stream_ttyname (stream *s __attribute__ ((unused)))\n+{\n   return NULL;\n-#endif\n }\n+#endif\n+\n \n \n /* How files are stored:  This is an operating-system specific issue,"}, {"sha": "0e147aab565c2aa3bae795f3969a2e65ff9ca013", "filename": "libgfortran/io/unix.h", "status": "modified", "additions": 0, "deletions": 21, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2Fio%2Funix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce66b6f6cad2c071176d903486fdaea96796b31a/libgfortran%2Fio%2Funix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.h?ref=ce66b6f6cad2c071176d903486fdaea96796b31a", "patch": "@@ -42,27 +42,6 @@ struct stream\n };\n \n \n-typedef struct\n-{\n-  stream st;\n-\n-  gfc_offset buffer_offset;\t/* File offset of the start of the buffer */\n-  gfc_offset physical_offset;\t/* Current physical file offset */\n-  gfc_offset logical_offset;\t/* Current logical file offset */\n-  gfc_offset file_length;\t/* Length of the file, -1 if not seekable. */\n-\n-  char *buffer;                 /* Pointer to the buffer.  */\n-  int fd;                       /* The POSIX file descriptor.  */\n-\n-  int active;\t\t\t/* Length of valid bytes in the buffer */\n-\n-  int ndirty;\t\t\t/* Dirty bytes starting at buffer_offset */\n-\n-  int special_file;\t\t/* =1 if the fd refers to a special file */\n-}\n-unix_stream;\n-\n-\n /* Inline functions for doing file I/O given a stream.  */\n static inline ssize_t\n sread (stream * s, void * buf, ssize_t nbyte)"}]}