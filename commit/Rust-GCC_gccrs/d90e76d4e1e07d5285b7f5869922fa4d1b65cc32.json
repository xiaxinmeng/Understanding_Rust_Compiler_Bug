{"sha": "d90e76d4e1e07d5285b7f5869922fa4d1b65cc32", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDkwZTc2ZDRlMWUwN2Q1Mjg1YjdmNTg2OTkyMmZhNGQxYjY1Y2MzMg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2013-05-02T17:24:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-05-02T17:24:26Z"}, "message": "tree-eh.c (cleanup_empty_eh_merge_phis): Remove rename_virts bitmap and its handling.\n\n\t* tree-eh.c (cleanup_empty_eh_merge_phis): Remove rename_virts\n\tbitmap and its handling.\n\t(pass_cleanup_eh): Set todo_flags_finish to TODO_verify_ssa.\n\nFrom-SVN: r198552", "tree": {"sha": "34dc0b03b6e1526c84ef3b552762fc7bc22a3e5e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34dc0b03b6e1526c84ef3b552762fc7bc22a3e5e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1634e53f83e6867eee8a0e88ac8869bec5af1f82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1634e53f83e6867eee8a0e88ac8869bec5af1f82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1634e53f83e6867eee8a0e88ac8869bec5af1f82"}], "stats": {"total": 36, "additions": 8, "deletions": 28}, "files": [{"sha": "9e3d7838d25945de47a715f92451eae29ca23df8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d90e76d4e1e07d5285b7f5869922fa4d1b65cc32", "patch": "@@ -1,3 +1,9 @@\n+2013-05-02  Richard Biener  <rguenther@suse.de>\n+\n+\t* tree-eh.c (cleanup_empty_eh_merge_phis): Remove rename_virts\n+\tbitmap and its handling.\n+\t(pass_cleanup_eh): Set todo_flags_finish to TODO_verify_ssa.\n+\n 2013-05-02  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/57140"}, {"sha": "cbd878ce34a917e38b3739e172324529572fe306", "filename": "gcc/tree-eh.c", "status": "modified", "additions": 2, "deletions": 28, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32/gcc%2Ftree-eh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d90e76d4e1e07d5285b7f5869922fa4d1b65cc32/gcc%2Ftree-eh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-eh.c?ref=d90e76d4e1e07d5285b7f5869922fa4d1b65cc32", "patch": "@@ -3949,7 +3949,6 @@ cleanup_empty_eh_merge_phis (basic_block new_bb, basic_block old_bb,\n   gimple_stmt_iterator ngsi, ogsi;\n   edge_iterator ei;\n   edge e;\n-  bitmap rename_virts;\n   bitmap ophi_handled;\n \n   /* The destination block must not be a regular successor for any\n@@ -3972,7 +3971,6 @@ cleanup_empty_eh_merge_phis (basic_block new_bb, basic_block old_bb,\n     redirect_edge_var_map_clear (e);\n \n   ophi_handled = BITMAP_ALLOC (NULL);\n-  rename_virts = BITMAP_ALLOC (NULL);\n \n   /* First, iterate through the PHIs on NEW_BB and set up the edge_var_map\n      for the edges we're going to move.  */\n@@ -4025,11 +4023,7 @@ cleanup_empty_eh_merge_phis (basic_block new_bb, basic_block old_bb,\n \t      redirect_edge_var_map_add (e, nresult, oop, oloc);\n \t    }\n \t}\n-      /* If we didn't find the PHI, but it's a VOP, remember to rename\n-\t it later, assuming all other tests succeed.  */\n-      else if (virtual_operand_p (nresult))\n-\tbitmap_set_bit (rename_virts, SSA_NAME_VERSION (nresult));\n-      /* If we didn't find the PHI, and it's a real variable, we know\n+      /* If we didn't find the PHI, if it's a real variable or a VOP, we know\n \t from the fact that OLD_BB is tree_empty_eh_handler_p that the\n \t variable is unchanged from input to the block and we can simply\n \t re-use the input to NEW_BB from the OLD_BB_OUT edge.  */\n@@ -4052,24 +4046,6 @@ cleanup_empty_eh_merge_phis (basic_block new_bb, basic_block old_bb,\n \tgoto fail;\n     }\n \n-  /* At this point we know that the merge will succeed.  Remove the PHI\n-     nodes for the virtuals that we want to rename.  */\n-  if (!bitmap_empty_p (rename_virts))\n-    {\n-      for (ngsi = gsi_start_phis (new_bb); !gsi_end_p (ngsi); )\n-\t{\n-\t  gimple nphi = gsi_stmt (ngsi);\n-\t  tree nresult = gimple_phi_result (nphi);\n-\t  if (bitmap_bit_p (rename_virts, SSA_NAME_VERSION (nresult)))\n-\t    {\n-\t      mark_virtual_phi_result_for_renaming (nphi);\n-\t      remove_phi_node (&ngsi, true);\n-\t    }\n-\t  else\n-\t    gsi_next (&ngsi);\n-\t}\n-    }\n-\n   /* Finally, move the edges and update the PHIs.  */\n   for (ei = ei_start (old_bb->preds); (e = ei_safe_edge (ei)); )\n     if (e->flags & EDGE_EH)\n@@ -4097,14 +4073,12 @@ cleanup_empty_eh_merge_phis (basic_block new_bb, basic_block old_bb,\n       ei_next (&ei);\n \n   BITMAP_FREE (ophi_handled);\n-  BITMAP_FREE (rename_virts);\n   return true;\n \n  fail:\n   FOR_EACH_EDGE (e, ei, old_bb->preds)\n     redirect_edge_var_map_clear (e);\n   BITMAP_FREE (ophi_handled);\n-  BITMAP_FREE (rename_virts);\n   return false;\n }\n \n@@ -4467,7 +4441,7 @@ struct gimple_opt_pass pass_cleanup_eh = {\n    0,\t\t\t\t/* properties_provided */\n    0,\t\t\t\t/* properties_destroyed */\n    0,\t\t\t\t/* todo_flags_start */\n-   0             \t\t/* todo_flags_finish */\n+   TODO_verify_ssa    \t\t/* todo_flags_finish */\n    }\n };\n \f"}]}