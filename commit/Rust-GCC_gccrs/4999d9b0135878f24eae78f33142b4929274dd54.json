{"sha": "4999d9b0135878f24eae78f33142b4929274dd54", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDk5OWQ5YjAxMzU4NzhmMjRlYWU3OGYzMzE0MmI0OTI5Mjc0ZGQ1NA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2011-03-10T15:21:00Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-03-10T15:21:00Z"}, "message": "re PR c++/47198 ([C++0x] ICE: tree check: expected var_decl or function_decl, have template_decl in check_bases_and_members, at cp/class.c:4654 on invalid code)\n\n\tPR c++/47198\n\t* parser.c (cp_parser_single_declaration): Just return if\n\tcp_parser_parse_and_diagnose_invalid_type_name complained.\n\nFrom-SVN: r170847", "tree": {"sha": "be33bedd89aa2d35e4d9b0c5180f1296a13dc3b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be33bedd89aa2d35e4d9b0c5180f1296a13dc3b6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4999d9b0135878f24eae78f33142b4929274dd54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4999d9b0135878f24eae78f33142b4929274dd54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4999d9b0135878f24eae78f33142b4929274dd54", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4999d9b0135878f24eae78f33142b4929274dd54/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "392426866e8caa70e52ad562423c13191a5667a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/392426866e8caa70e52ad562423c13191a5667a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/392426866e8caa70e52ad562423c13191a5667a3"}], "stats": {"total": 55, "additions": 43, "deletions": 12}, "files": [{"sha": "a3a5bf7c66d5e2d0cbd7e0845eb23f0baa54e98b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -1,3 +1,9 @@\n+2011-03-10  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/47198\n+\t* parser.c (cp_parser_single_declaration): Just return if\n+\tcp_parser_parse_and_diagnose_invalid_type_name complained.\n+\n 2011-03-09  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/44629"}, {"sha": "7e9b286c0ae50bd0fe34646054e4a8caf7a0fac1", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -20102,8 +20102,15 @@ cp_parser_single_declaration (cp_parser* parser,\n     }\n \n   /* Complain about missing 'typename' or other invalid type names.  */\n-  if (!decl_specifiers.any_type_specifiers_p)\n-    cp_parser_parse_and_diagnose_invalid_type_name (parser);\n+  if (!decl_specifiers.any_type_specifiers_p\n+      && cp_parser_parse_and_diagnose_invalid_type_name (parser))\n+    {\n+      /* cp_parser_parse_and_diagnose_invalid_type_name calls\n+\t cp_parser_skip_to_end_of_block_or_statement, so don't try to parse\n+\t the rest of this declaration.  */\n+      decl = error_mark_node;\n+      goto out;\n+    }\n \n   /* If it's not a template class, try for a template function.  If\n      the next token is a `;', then this declaration does not declare\n@@ -20137,18 +20144,20 @@ cp_parser_single_declaration (cp_parser* parser,\n       }\n     }\n \n+  /* Look for a trailing `;' after the declaration.  */\n+  if (!function_definition_p\n+      && (decl == error_mark_node\n+\t  || !cp_parser_require (parser, CPP_SEMICOLON, RT_SEMICOLON)))\n+    cp_parser_skip_to_end_of_block_or_statement (parser);\n+\n+ out:\n   pop_deferring_access_checks ();\n \n   /* Clear any current qualification; whatever comes next is the start\n      of something new.  */\n   parser->scope = NULL_TREE;\n   parser->qualifying_scope = NULL_TREE;\n   parser->object_scope = NULL_TREE;\n-  /* Look for a trailing `;' after the declaration.  */\n-  if (!function_definition_p\n-      && (decl == error_mark_node\n-\t  || !cp_parser_require (parser, CPP_SEMICOLON, RT_SEMICOLON)))\n-    cp_parser_skip_to_end_of_block_or_statement (parser);\n \n   return decl;\n }"}, {"sha": "9739ac855b1eada1d0aad1a08f6989bf77a8aabc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -1,3 +1,12 @@\n+2011-03-10  Jason Merrill  <jason@redhat.com>\n+\n+\t* g++.dg/cpp0x/syntax-err1.C: New.\n+\t* g++.dg/parse/error36.C: Adjust expected errors.\n+\t* g++.old-deja/g++.pt/ctor2.C: Likewise.\n+\t* g++.old-deja/g++.pt/typename3.C: Likewise.\n+\t* g++.old-deja/g++.pt/typename4.C: Likewise.\n+\t* g++.old-deja/g++.pt/typename6.C: Likewise.\n+\n 2011-03-09  Jason Merrill  <jason@redhat.com>\n \n \t* g++.dg/template/nontype22.C: New."}, {"sha": "ce1c9eea5344b9b432dea795a56fdff52e7dd2fe", "filename": "gcc/testsuite/g++.dg/cpp0x/syntax-err1.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fsyntax-err1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fsyntax-err1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fsyntax-err1.C?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/47198\n+// { dg-options -std=c++0x }\n+\n+struct S\n+{\n+  template < int > sometype foo (); // { dg-error \"sometype. does not name a type\" }\n+  S () = default;\n+};"}, {"sha": "8fcaa2fb232b156916fd7ebf2f2c4026f1c166c5", "filename": "gcc/testsuite/g++.dg/parse/error36.C", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror36.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror36.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror36.C?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -30,4 +30,3 @@ void g(const A<T>::type &t);\t// { dg-error \"typename\" }\n \n // PR c++/18451\n template <class T> A<T>::B A<T>::b; // { dg-error \"typename\" }\n-// { dg-error \"expected\" \"\" { target *-*-* } 32 }"}, {"sha": "a8be91ddbb917f12fb01650045a01b24112115ef", "filename": "gcc/testsuite/g++.old-deja/g++.pt/ctor2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fctor2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fctor2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fctor2.C?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -10,4 +10,4 @@ struct A {\n template <class T>\n A<T>::A<T>()   // { dg-error \"constructor|qualified name\" }\n {\n-} // { dg-error \"end of input\" }\n+}"}, {"sha": "ad026a770703fc3c3d1745faa89954c7d8ebe597", "filename": "gcc/testsuite/g++.old-deja/g++.pt/typename3.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename3.C?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -18,4 +18,4 @@ struct B : public A<U>\n \n template <class U>\n B<U>::A_Type B<U>::Func() { // { dg-error \"typename\" } implicit typename\n-}\t\t\t    // { dg-error \"expected\" }\n+}"}, {"sha": "47fb250a9a808484891eadfed364be1b0f2a71e0", "filename": "gcc/testsuite/g++.old-deja/g++.pt/typename4.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename4.C?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -23,4 +23,4 @@ struct C : public B<U>\n \n template <class U>\n C<U>::A_Type C<U>::Func() { // { dg-error \"typename\" } implicit typename\n-}\t\t\t    // { dg-error \"expected\" }\n+}"}, {"sha": "734781202f160ec63cb65d59a7adcedbafd9a931", "filename": "gcc/testsuite/g++.old-deja/g++.pt/typename6.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4999d9b0135878f24eae78f33142b4929274dd54/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ftypename6.C?ref=4999d9b0135878f24eae78f33142b4929274dd54", "patch": "@@ -17,4 +17,4 @@ struct B : public A<U>\n template <class U>\n A<U>::A_Type B<U>::Func()       // { dg-error \"typename\" } function\n {\t\t\t\t\n-} // { dg-error \"expected\" }\n+}"}]}