{"sha": "fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae", "node_id": "C_kwDOANBUbNoAKGZjNGNkZTJlNmFhNGQ2ZWJkZjdmNzBiN2I0MzU5ZmI1OWExOTE1YWU", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2023-03-30T07:44:23Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2023-04-01T03:57:15Z"}, "message": "c++,coroutines: Stabilize names of promoted slot vars [PR101118].\n\nWhen we need to 'promote' a value (i.e. store it in the coroutine frame) it\nis given a frame entry name.  This was based on the DECL_UID for slot vars.\nHowever, when LTO is used, the names from multiple TUs become visible at the\nsame time, and the DECL_UIDs usually differ between units.  This leads to a\n\"ODR mismatch\" warning for the frame type.\n\nThe fix here is to use the current promoted temporaries count to produce\nthe name, this is stable between TUs and computed per coroutine.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\n\tPR c++/101118\n\ngcc/cp/ChangeLog:\n\n\t* coroutines.cc (flatten_await_stmt): Use the current count of\n\tpromoted temporaries to build a unique name for the frame entries.", "tree": {"sha": "10e6bf37e841f7704ce98d5ac374432d0015b558", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10e6bf37e841f7704ce98d5ac374432d0015b558"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e11cde0381c528323abd0d57ed11ac8dae56ae31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e11cde0381c528323abd0d57ed11ac8dae56ae31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e11cde0381c528323abd0d57ed11ac8dae56ae31"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "b307c8ca8b64aa7c45df1dd38ff02ae7d9aa5beb", "filename": "gcc/cp/coroutines.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae/gcc%2Fcp%2Fcoroutines.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae/gcc%2Fcp%2Fcoroutines.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcoroutines.cc?ref=fc4cde2e6aa4d6ebdf7f70b7b4359fb59a1915ae", "patch": "@@ -2889,7 +2889,7 @@ flatten_await_stmt (var_nest_node *n, hash_set<tree> *promoted,\n \t  tree init = t;\n \t  temps_used->add (init);\n \t  tree var_type = TREE_TYPE (init);\n-\t  char *buf = xasprintf (\"D.%d\", DECL_UID (TREE_OPERAND (init, 0)));\n+\t  char *buf = xasprintf (\"T%03u\", (unsigned) temps_used->elements ());\n \t  tree var = build_lang_decl (VAR_DECL, get_identifier (buf), var_type);\n \t  DECL_ARTIFICIAL (var) = true;\n \t  free (buf);"}]}