{"sha": "72e3d92178b44a3722519ec68e72e307443bda70", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzJlM2Q5MjE3OGI0NGEzNzIyNTE5ZWM2OGU3MmUzMDc0NDNiZGE3MA==", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-06-16T19:54:16Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-06-16T19:54:16Z"}, "message": "Fortran - ICE in gfc_check_do_variable, at fortran/parse.c:4446\n\nAvoid NULL pointer dereferences during error recovery.\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/95501\n\tPR fortran/95502\n\t* expr.c (gfc_check_pointer_assign): Avoid NULL pointer\n\tdereference.\n\t* match.c (gfc_match_pointer_assignment): Likewise.\n\t* parse.c (gfc_check_do_variable): Avoid comparison with NULL\n\tsymtree.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/95501\n\tPR fortran/95502\n\t* gfortran.dg/pr95502.f90: New test.", "tree": {"sha": "21602429347a4bf78605b5bd747694e23406c493", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21602429347a4bf78605b5bd747694e23406c493"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72e3d92178b44a3722519ec68e72e307443bda70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72e3d92178b44a3722519ec68e72e307443bda70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72e3d92178b44a3722519ec68e72e307443bda70", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72e3d92178b44a3722519ec68e72e307443bda70/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bdfc1207bd20cf1ad81fca121e4f7df4995cc0d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdfc1207bd20cf1ad81fca121e4f7df4995cc0d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdfc1207bd20cf1ad81fca121e4f7df4995cc0d6"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "6e663b4b828d2b2ab5573b75b4f57e1f890c50c8", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=72e3d92178b44a3722519ec68e72e307443bda70", "patch": "@@ -1683,10 +1683,21 @@ find_array_section (gfc_expr *expr, gfc_ref *ref)\n \t  return false;\n \t}\n \n+#if 1\n       cons = gfc_constructor_lookup (base, limit);\n       gcc_assert (cons);\n       gfc_constructor_append_expr (&expr->value.constructor,\n \t\t\t\t   gfc_copy_expr (cons->expr), NULL);\n+#else\n+      cons = gfc_constructor_lookup (base, limit);\n+      if (cons)\n+\tgfc_constructor_append_expr (&expr->value.constructor,\n+\t\t\t\t     gfc_copy_expr (cons->expr), NULL);\n+      else\n+\t{\n+\t  t = false;\n+\t}\n+#endif\n     }\n \n   mpz_clear (ptr);\n@@ -3476,6 +3487,7 @@ gfc_specification_expr (gfc_expr *e)\n     {\n       gfc_error (\"Expression at %L must be of INTEGER type, found %s\",\n \t\t &e->where, gfc_basic_typename (e->ts.type));\n+      gfc_clear_ts (&e->ts);\n       return false;\n     }\n \n@@ -3815,6 +3827,9 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue,\n   int proc_pointer;\n   bool same_rank;\n \n+  if (!lvalue->symtree)\n+    return false;\n+\n   lhs_attr = gfc_expr_attr (lvalue);\n   if (lvalue->ts.type == BT_UNKNOWN && !lhs_attr.proc_pointer)\n     {"}, {"sha": "d148de3e3b53dfd4814a7a589fbed37752b762d9", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=72e3d92178b44a3722519ec68e72e307443bda70", "patch": "@@ -1409,7 +1409,7 @@ gfc_match_pointer_assignment (void)\n   gfc_matching_procptr_assignment = 0;\n \n   m = gfc_match (\" %v =>\", &lvalue);\n-  if (m != MATCH_YES)\n+  if (m != MATCH_YES || !lvalue->symtree)\n     {\n       m = MATCH_NO;\n       goto cleanup;"}, {"sha": "6d7845e8517b0b99081d016e988410e2592b72f7", "filename": "gcc/fortran/parse.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ffortran%2Fparse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ffortran%2Fparse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.c?ref=72e3d92178b44a3722519ec68e72e307443bda70", "patch": "@@ -4588,6 +4588,9 @@ gfc_check_do_variable (gfc_symtree *st)\n {\n   gfc_state_data *s;\n \n+  if (!st)\n+    return 0;\n+\n   for (s=gfc_state_stack; s; s = s->previous)\n     if (s->do_variable == st)\n       {"}, {"sha": "d40fd9a55080539ee80fe74ba72f23de05950167", "filename": "gcc/testsuite/gfortran.dg/pr95502.f90", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95502.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72e3d92178b44a3722519ec68e72e307443bda70/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95502.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr95502.f90?ref=72e3d92178b44a3722519ec68e72e307443bda70", "patch": "@@ -0,0 +1,8 @@\n+! { dg-do compile }\n+! PR fortran/95502 - ICE in gfc_check_do_variable, at fortran/parse.c:4446\n+\n+program p\n+  integer, pointer :: z\n+  nullify (z%kind)  ! { dg-error \"in variable definition context\" }\n+  z%kind => NULL()  ! { dg-error \"constant expression\" }\n+end"}]}