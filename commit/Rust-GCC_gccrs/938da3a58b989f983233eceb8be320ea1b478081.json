{"sha": "938da3a58b989f983233eceb8be320ea1b478081", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTM4ZGEzYTU4Yjk4OWY5ODMyMzNlY2ViOGJlMzIwZWExYjQ3ODA4MQ==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-08-04T18:11:08Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-08-04T18:11:08Z"}, "message": "Designate the widest case label to be the default label\n\ngcc/ChangeLog:\n\n\t* gimple.c (preprocess_case_label_vec_for_gimple): When the case\n\tlabels are exhaustive, designate the label with the widest\n\trange to be the default label.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.dg/switch-10.c: New test.\n\nFrom-SVN: r239146", "tree": {"sha": "8ee303ad04827e9a987b5e6b3b38386d5180a6c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8ee303ad04827e9a987b5e6b3b38386d5180a6c6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/938da3a58b989f983233eceb8be320ea1b478081", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/938da3a58b989f983233eceb8be320ea1b478081", "html_url": "https://github.com/Rust-GCC/gccrs/commit/938da3a58b989f983233eceb8be320ea1b478081", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/938da3a58b989f983233eceb8be320ea1b478081/comments", "author": null, "committer": null, "parents": [{"sha": "42183d034d47e05814c971b2911c847e2a700941", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42183d034d47e05814c971b2911c847e2a700941", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42183d034d47e05814c971b2911c847e2a700941"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "6c1e81692a9e0e6983e974f814b72602070345d6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/938da3a58b989f983233eceb8be320ea1b478081/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/938da3a58b989f983233eceb8be320ea1b478081/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=938da3a58b989f983233eceb8be320ea1b478081", "patch": "@@ -1,3 +1,9 @@\n+2016-08-04  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\t* gimple.c (preprocess_case_label_vec_for_gimple): When the case\n+\tlabels are exhaustive, designate the label with the widest\n+\trange to be the default label.\n+\n 2016-08-04  Andrew Pinski  <apinski@cavium.com>\n \n \t* config/aarch64/aarch64.c (thunderx_vector_cost): New variable."}, {"sha": "fc81e52e776f8f2ea234baadc4e9f0f389560ab9", "filename": "gcc/gimple.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/938da3a58b989f983233eceb8be320ea1b478081/gcc%2Fgimple.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/938da3a58b989f983233eceb8be320ea1b478081/gcc%2Fgimple.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple.c?ref=938da3a58b989f983233eceb8be320ea1b478081", "patch": "@@ -2946,18 +2946,30 @@ preprocess_case_label_vec_for_gimple (vec<tree> labels,\n \t    high = CASE_LOW (labels[len - 1]);\n \t  if (tree_int_cst_equal (high, TYPE_MAX_VALUE (index_type)))\n \t    {\n+\t      tree widest_label = labels[0];\n \t      for (i = 1; i < len; i++)\n \t\t{\n \t\t  high = CASE_LOW (labels[i]);\n \t\t  low = CASE_HIGH (labels[i - 1]);\n \t\t  if (!low)\n \t\t    low = CASE_LOW (labels[i - 1]);\n+\n+\t\t  if (CASE_HIGH (labels[i]) != NULL_TREE\n+\t\t      && (CASE_HIGH (widest_label) == NULL_TREE\n+\t\t\t  || wi::gtu_p (wi::sub (CASE_HIGH (labels[i]),\n+\t\t\t\t\t\t CASE_LOW (labels[i])),\n+\t\t\t\t\twi::sub (CASE_HIGH (widest_label),\n+\t\t\t\t\t\t CASE_LOW (widest_label)))))\n+\t\t    widest_label = labels[i];\n+\n \t\t  if (wi::add (low, 1) != high)\n \t\t    break;\n \t\t}\n \t      if (i == len)\n \t\t{\n-\t\t  tree label = CASE_LABEL (labels[0]);\n+\t\t  /* Designate the label with the widest range to be the\n+\t\t     default label.  */\n+\t\t  tree label = CASE_LABEL (widest_label);\n \t\t  default_case = build_case_label (NULL_TREE, NULL_TREE,\n \t\t\t\t\t\t   label);\n \t\t}"}, {"sha": "58672ba83a05c8f7cfdb04f67a8eb15ffb1a2f5a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/938da3a58b989f983233eceb8be320ea1b478081/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/938da3a58b989f983233eceb8be320ea1b478081/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=938da3a58b989f983233eceb8be320ea1b478081", "patch": "@@ -1,3 +1,7 @@\n+2016-08-04  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\t* gcc.dg/switch-10.c: New test.\n+\n 2016-08-04  James Greenhalgh  <james.greenhalgh@arm.com>\n \n \t* gcc.c-torture/execute/pr70903.c: Remove duplicate test body."}, {"sha": "0ffc9eb5757162186feb1ac5c9f735e3f96fe4bc", "filename": "gcc/testsuite/gcc.dg/switch-10.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/938da3a58b989f983233eceb8be320ea1b478081/gcc%2Ftestsuite%2Fgcc.dg%2Fswitch-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/938da3a58b989f983233eceb8be320ea1b478081/gcc%2Ftestsuite%2Fgcc.dg%2Fswitch-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fswitch-10.c?ref=938da3a58b989f983233eceb8be320ea1b478081", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-options \"-O2 -fdump-tree-cfg\" }  */\n+/* { dg-final { scan-tree-dump \"case 0:\" \"cfg\" } }  */\n+/* { dg-final { scan-tree-dump-not \"case 1 ... 255:\" \"cfg\" } }  */\n+#include <stdint.h>\n+\n+void foo (void);\n+void bar (void);\n+\n+void\n+test (uint8_t ch)\n+{\n+  switch (ch)\n+   {\n+   case 0:\n+     foo ();\n+     break;\n+\n+   case 1 ... 255:\n+     bar ();\n+     break;\n+   }\n+}"}]}