{"sha": "bef3c57babac2e7ff368cb226a962644575c22e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmVmM2M1N2JhYmFjMmU3ZmYzNjhjYjIyNmE5NjI2NDQ1NzVjMjJlMA==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2009-01-28T07:58:07Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2009-01-28T07:58:07Z"}, "message": "re PR target/38988 (Cannot build crtstuff.c with -mcmodel=large -fPIC -O2)\n\n\tPR target/38988\n\t* config/i386/i386.md (set_rip_rex64): Wrap operand 1 in label_ref.\n\t(set_got_offset_rex64): Ditto.\n\nFrom-SVN: r143720", "tree": {"sha": "22d772700f3757151c7b5371beb5830a588089c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/22d772700f3757151c7b5371beb5830a588089c2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bef3c57babac2e7ff368cb226a962644575c22e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bef3c57babac2e7ff368cb226a962644575c22e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bef3c57babac2e7ff368cb226a962644575c22e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bef3c57babac2e7ff368cb226a962644575c22e0/comments", "author": null, "committer": null, "parents": [{"sha": "0c6390fae9478618548c4d4c64483b85ae9f28ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c6390fae9478618548c4d4c64483b85ae9f28ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c6390fae9478618548c4d4c64483b85ae9f28ac"}], "stats": {"total": 39, "additions": 36, "deletions": 3}, "files": [{"sha": "5300a8627bc7cb5c3cf14d1952bdc6e5220b2d75", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef3c57babac2e7ff368cb226a962644575c22e0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef3c57babac2e7ff368cb226a962644575c22e0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bef3c57babac2e7ff368cb226a962644575c22e0", "patch": "@@ -1,3 +1,9 @@\n+2009-01-28  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/38988\n+\t* config/i386/i386.md (set_rip_rex64): Wrap operand 1 in label_ref.\n+\t(set_got_offset_rex64): Ditto.\n+\n 2009-01-27  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/38941\n@@ -511,7 +517,8 @@\n \tused to index the memory access.  Do not pass loop_p.\n \tFix comment.  Stop recursion on tcc_constant or tcc_declaration.\n \t(expand_scalar_variables_stmt): Pass to expand_scalar_variables_expr\n-\tthe gimple_stmt_iterator where it inserts new code.  Do not pass loop_p.\n+\tthe gimple_stmt_iterator where it inserts new code.\n+\tDo not pass loop_p.\n \t(copy_bb_and_scalar_dependences): Do not pass loop_p.\n \t(translate_clast): Update call to copy_bb_and_scalar_dependences.\n "}, {"sha": "89a3b17607b06e823e28f06acc0f0f0529f42fc4", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef3c57babac2e7ff368cb226a962644575c22e0/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef3c57babac2e7ff368cb226a962644575c22e0/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=bef3c57babac2e7ff368cb226a962644575c22e0", "patch": "@@ -15299,15 +15299,17 @@\n \n (define_insn \"set_rip_rex64\"\n   [(set (match_operand:DI 0 \"register_operand\" \"=r\")\n-\t(unspec:DI [(match_operand:DI 1 \"\" \"\")] UNSPEC_SET_RIP))]\n+\t(unspec:DI [(label_ref (match_operand 1 \"\" \"\"))] UNSPEC_SET_RIP))]\n   \"TARGET_64BIT\"\n   \"lea{q}\\t{%l1(%%rip), %0|%0, %l1[rip]}\"\n   [(set_attr \"type\" \"lea\")\n    (set_attr \"length\" \"6\")])\n \n (define_insn \"set_got_offset_rex64\"\n   [(set (match_operand:DI 0 \"register_operand\" \"=r\")\n-\t(unspec:DI [(match_operand:DI 1 \"\" \"\")] UNSPEC_SET_GOT_OFFSET))]\n+\t(unspec:DI\n+\t  [(label_ref (match_operand 1 \"\" \"\"))]\n+\t  UNSPEC_SET_GOT_OFFSET))]\n   \"TARGET_64BIT\"\n   \"movabs{q}\\t{$_GLOBAL_OFFSET_TABLE_-%l1, %0|%0, OFFSET FLAT:_GLOBAL_OFFSET_TABLE_-%l1}\"\n   [(set_attr \"type\" \"imov\")"}, {"sha": "8e2c8eaa67b88d3dd9f934fe503e85390f8368c6", "filename": "gcc/testsuite/gcc.target/i386/pr38988.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef3c57babac2e7ff368cb226a962644575c22e0/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr38988.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef3c57babac2e7ff368cb226a962644575c22e0/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr38988.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr38988.c?ref=bef3c57babac2e7ff368cb226a962644575c22e0", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target lp64 } */\n+/* { dg-require-effective-target fpic } */\n+/* { dg-options \"-O2 -fpic -mcmodel=large\" } */\n+\n+typedef long unsigned int size_t;\n+typedef void (*func_ptr) (void);\n+\n+static func_ptr __DTOR_LIST__[1] = { (func_ptr) (-1) };\n+\n+void\n+__do_global_dtors_aux (void)\n+{\n+  extern func_ptr __DTOR_END__[];\n+  size_t dtor_idx = 0;\n+  const size_t max_idx = __DTOR_END__ - __DTOR_LIST__ - 1;\n+  func_ptr f;\n+\n+  while (dtor_idx < max_idx)\n+    {\n+      f = __DTOR_LIST__[++dtor_idx];\n+      f ();\n+    }\n+}"}]}