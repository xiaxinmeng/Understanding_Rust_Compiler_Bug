{"sha": "12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4", "node_id": "C_kwDOANBUbNoAKDEyZmE3NjQxY2VlZDljOTEzOWUyZWE3YjYyYzExZjNkYzViNmY2ZjQ", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-03-03T08:21:04Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-03-03T09:43:34Z"}, "message": "[nvptx] Use --no-verify for sm_30\n\nIn PR97348, we ran into the problem that recent CUDA dropped support for\nsm_30, which inhibited the build when building with CUDA bin in the path,\nbecause the nvptx-tools assembler uses CUDA's ptxas to do ptx verification.\n\nTo fix this, in gcc-11 the default sm_xx was moved from sm_30 to sm_35.\n\nThis however broke support for sm_30 boards: an executable build for sm_30\nmight contain sm_35 code from the libraries, which are build with the default\nsm_xx (PR104758).\n\nWe want to fix this by going back to having the libraries build with sm_30, as\nwas the case for gcc-5 to gcc-10.  That however reintroduces the problem from\nPR97348.\n\nDeal with PR97348 in the simplest way possible: when calling the assembler for\nsm_30, specify --no-verify.\n\nThis has the unfortunate effect that after fixing PR104758 by building\nlibraries with sm_30, the libraries are no longer verified.  This can be\nimproved upon by:\n- adding a configure test in gcc that tests if CUDA supports sm_30, and\n  if so disabling this patch\n- dealing with this in nvptx-tools somehow, either:\n  - detect at ptxas execution time that it doesn't support sm_30, or\n  - detect this at nvptx-tool configure time.\n\ngcc/ChangeLog:\n\n2022-03-03  Tom de Vries  <tdevries@suse.de>\n\n\t* config/nvptx/nvptx.h (ASM_SPEC): Add %{misa=sm_30:--no-verify}.", "tree": {"sha": "97b475f6a73b164207be2b3c1f0aa2ad2f6ad8df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/97b475f6a73b164207be2b3c1f0aa2ad2f6ad8df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5065d69fca535eeb869ba209cdf605f3ecf8b18d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5065d69fca535eeb869ba209cdf605f3ecf8b18d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5065d69fca535eeb869ba209cdf605f3ecf8b18d"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "3ca22a595d201e75d1da40550bb1912b1ea48b85", "filename": "gcc/config/nvptx/nvptx.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4/gcc%2Fconfig%2Fnvptx%2Fnvptx.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4/gcc%2Fconfig%2Fnvptx%2Fnvptx.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.h?ref=12fa7641ceed9c9139e2ea7b62c11f3dc5b6f6f4", "patch": "@@ -32,7 +32,7 @@\n /* Default needs to be in sync with default for misa in nvptx.opt.\n    We add a default here to work around a hard-coded sm_30 default in\n    nvptx-as.  */\n-#define ASM_SPEC \"%{misa=*:-m %*; :-m sm_35}\"\n+#define ASM_SPEC \"%{misa=*:-m %*; :-m sm_35}%{misa=sm_30:--no-verify}\"\n \n #define TARGET_CPU_CPP_BUILTINS() nvptx_cpu_cpp_builtins ()\n "}]}