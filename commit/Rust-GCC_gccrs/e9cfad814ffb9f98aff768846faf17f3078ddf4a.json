{"sha": "e9cfad814ffb9f98aff768846faf17f3078ddf4a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTljZmFkODE0ZmZiOWY5OGFmZjc2ODg0NmZhZjE3ZjMwNzhkZGY0YQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1992-09-11T16:39:13Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1992-09-11T16:39:13Z"}, "message": "pa.md (non-[cf]branch define_delay): Use a single delay description for the delay slots in \"branch\"...\n\n\t* pa.md\t(non-[cf]branch define_delay): Use a single delay description\n\tfor the delay slots in \"branch\", \"call\", and \"milli\" insns.\n\t(fbranch define_delay): fbranches have a single delay slot which\n\tmay be nullified when the branch is taken (regardless of direction\n\tor distance to the target.)\n\t(in_branch_delay attribute): Disallow fbranch insns explicitly.\n\t(floating point branches): Use \"fbranch\" attribute for these insns.\n\tUpdate output template to properly handle nullification.\n\nFrom-SVN: r2107", "tree": {"sha": "c303a6c2ee561d642f9dad8812a638574f9d92de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c303a6c2ee561d642f9dad8812a638574f9d92de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e9cfad814ffb9f98aff768846faf17f3078ddf4a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9cfad814ffb9f98aff768846faf17f3078ddf4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9cfad814ffb9f98aff768846faf17f3078ddf4a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9cfad814ffb9f98aff768846faf17f3078ddf4a/comments", "author": null, "committer": null, "parents": [{"sha": "17651386eecee506fb6ea2e15c0bb9171464cf43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17651386eecee506fb6ea2e15c0bb9171464cf43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17651386eecee506fb6ea2e15c0bb9171464cf43"}], "stats": {"total": 40, "additions": 27, "deletions": 13}, "files": [{"sha": "dc0d70040778c343cfaab08e2273d4ffc013b7b4", "filename": "gcc/config/pa/pa.md", "status": "modified", "additions": 27, "deletions": 13, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9cfad814ffb9f98aff768846faf17f3078ddf4a/gcc%2Fconfig%2Fpa%2Fpa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9cfad814ffb9f98aff768846faf17f3078ddf4a/gcc%2Fconfig%2Fpa%2Fpa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.md?ref=e9cfad814ffb9f98aff768846faf17f3078ddf4a", "patch": "@@ -30,7 +30,7 @@\n ;; type \"binary\" insns have two input operands (1,2) and one output (0)\n \n (define_attr \"type\"\n-  \"move,unary,binary,compare,load,store,branch,cbranch,call,dyncall,fpload,fpstore,fpalu,fpcc,fpmul,fpdivsgl,fpdivdbl,fpsqrtsgl,fpsqrtdbl,multi,misc,milli\"\n+  \"move,unary,binary,compare,load,store,branch,cbranch,fbranch,call,dyncall,fpload,fpstore,fpalu,fpcc,fpmul,fpdivsgl,fpdivdbl,fpsqrtsgl,fpsqrtdbl,multi,misc,milli\"\n   (const_string \"binary\"))\n \n ;; Length (in # of insns).\n@@ -59,22 +59,24 @@\n \n ;; Attributes for instruction and branch scheduling\n \n-(define_delay (eq_attr \"type\" \"call\")\n-  [(eq_attr \"in_branch_delay\" \"true\") (nil) (nil)])\n-\n (define_attr \"in_branch_delay\" \"false,true\"\n-  (if_then_else (and (eq_attr \"type\" \"!branch,cbranch,call,dyncall,multi,milli\")\n+  (if_then_else (and (eq_attr \"type\" \"!branch,cbranch,fbranch,call,dyncall,multi,milli\")\n \t\t     (eq_attr \"length\" \"1\"))\n \t\t(const_string \"true\")\n \t\t(const_string \"false\")))\n \n-(define_delay (eq_attr \"type\" \"branch\")\n+;; Unconditional branch, call, and millicode call delay slot description.\n+(define_delay (eq_attr \"type\" \"branch,call,milli\")\n   [(eq_attr \"in_branch_delay\" \"true\") (nil) (nil)])\n \n-(define_delay (eq_attr \"type\" \"cbranch\")\n-  [(eq_attr \"in_branch_delay\" \"true\") (nil) (nil)])\n+;; Floating point conditional branch delay slot description.\n+(define_delay (eq_attr \"type\" \"fbranch\")\n+  [(eq_attr \"in_branch_delay\" \"true\") \n+   (eq_attr \"in_branch_delay\" \"true\") \n+   (nil)])\n \n-(define_delay (eq_attr \"type\" \"milli\")\n+;; Integer conditional branch delay slot description.\n+(define_delay (eq_attr \"type\" \"cbranch\")\n   [(eq_attr \"in_branch_delay\" \"true\") (nil) (nil)])\n \n ;; Function units of the HPPA. The following data is for the \"Snake\"\n@@ -627,17 +629,29 @@\n \t\t\t   (label_ref (match_operand 0 \"\" \"\"))\n \t\t\t   (pc)))]\n   \"\"\n-  \"ftest\\;bl%* %0,0\"\n-  [(set_attr \"type\" \"cbranch\")\n+  \"*\n+{\n+  if (INSN_ANNULLED_BRANCH_P (insn))\n+    return \\\"ftest\\;bl,n %0,0\\\";\n+  else\n+    return \\\"ftest\\;bl%* %0,0\\\";\n+}\"\n+  [(set_attr \"type\" \"fbranch\")\n    (set_attr \"length\" \"2\")])\n \n (define_insn \"\"\n   [(set (pc) (if_then_else (ne (reg:CCFP 0) (const_int 0))\n \t\t\t   (pc)\n \t\t\t   (label_ref (match_operand 0 \"\" \"\"))))]\n   \"\"\n-  \"ftest\\;add,tr 0,0,0\\;bl%* %0,0\"\n-  [(set_attr \"type\" \"cbranch\")\n+  \"*\n+{\n+  if (INSN_ANNULLED_BRANCH_P (insn))\n+    return \\\"ftest\\;add,tr 0,0,0\\;bl,n %0,0\\\";\n+  else\n+    return \\\"ftest\\;add,tr 0,0,0\\;bl%* %0,0\\\";\n+}\"\n+  [(set_attr \"type\" \"fbranch\")\n    (set_attr \"length\" \"3\")])\n \n ;; Move instructions"}]}