{"sha": "cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2M1NWY5YmVlNWYwZmMyZjcwNWVlMjdmZDk1YzEzMzkxODViMDc3YQ==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2014-01-23T16:52:00Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-01-23T16:52:00Z"}, "message": "prj-conf.adb (Get_Or_Create_Configuration_File): Do not attempt to find a configuration project file when...\n\n2014-01-23  Vincent Celier  <celier@adacore.com>\n\n\t* prj-conf.adb (Get_Or_Create_Configuration_File): Do not attempt\n\tto find a configuration project file when Config_File_Name is\n\tNo_Configuration_File.\n\t* prj-conf.ads (No_Configuration_File): New constant String.\n\t* prj-pars.adb (Parse): Call Get_Or_Create_Configuration_File\n\twith Config_File_Name set to No_Configuration_File, so that\n\tno existing configuration project file will be used, and the\n\tconfiguration project will be only created in memory when\n\tAdd_Default_GNAT_Naming_Scheme is called.\n\t* projects.texi: Minor reformatting.\n\nFrom-SVN: r206985", "tree": {"sha": "24c325e6db8e4bf942e361bc87eb190c7bb74045", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/24c325e6db8e4bf942e361bc87eb190c7bb74045"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "225a0c5c56d59d37dc06f98e8388a21c9bc6d02f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/225a0c5c56d59d37dc06f98e8388a21c9bc6d02f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/225a0c5c56d59d37dc06f98e8388a21c9bc6d02f"}], "stats": {"total": 71, "additions": 49, "deletions": 22}, "files": [{"sha": "556cc9d159c2a56a9ae43a9c84e4dc240e581846", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "patch": "@@ -1,3 +1,16 @@\n+2014-01-23  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-conf.adb (Get_Or_Create_Configuration_File): Do not attempt\n+\tto find a configuration project file when Config_File_Name is\n+\tNo_Configuration_File.\n+\t* prj-conf.ads (No_Configuration_File): New constant String.\n+\t* prj-pars.adb (Parse): Call Get_Or_Create_Configuration_File\n+\twith Config_File_Name set to No_Configuration_File, so that\n+\tno existing configuration project file will be used, and the\n+\tconfiguration project will be only created in memory when\n+\tAdd_Default_GNAT_Naming_Scheme is called.\n+\t* projects.texi: Minor reformatting.\n+\n 2014-01-23  Vincent Celier  <celier@adacore.com>\n \n \t* prj-conf.adb (Get_Or_Create_Configuration_File): Never parse"}, {"sha": "dc569627b887aeaf3ded5756809849eb30df6ebc", "filename": "gcc/ada/prj-conf.adb", "status": "modified", "additions": 23, "deletions": 19, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprj-conf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprj-conf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.adb?ref=cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "patch": "@@ -1372,19 +1372,27 @@ package body Prj.Conf is\n       Get_Project_Target;\n       Check_Builder_Switches;\n \n-      if Conf_File_Name'Length > 0 then\n-         Config_File_Path := Locate_Config_File (Conf_File_Name.all);\n+      --  Do not attempt to find a configuration project file when\n+      --  Config_File_Name is No_Configuration_File.\n+\n+      if Config_File_Name = No_Configuration_File then\n+         Config_File_Path := null;\n+\n       else\n-         Config_File_Path := Locate_Config_File (Default_File_Name);\n-      end if;\n+         if Conf_File_Name'Length > 0 then\n+            Config_File_Path := Locate_Config_File (Conf_File_Name.all);\n+         else\n+            Config_File_Path := Locate_Config_File (Default_File_Name);\n+         end if;\n \n-      if Config_File_Path = null then\n-         if not Allow_Automatic_Generation\n-           and then Conf_File_Name'Length > 0\n-         then\n-            Raise_Invalid_Config\n-              (\"could not locate main configuration project \"\n-               & Conf_File_Name.all);\n+         if Config_File_Path = null then\n+            if not Allow_Automatic_Generation\n+              and then Conf_File_Name'Length > 0\n+            then\n+               Raise_Invalid_Config\n+                 (\"could not locate main configuration project \"\n+                  & Conf_File_Name.all);\n+            end if;\n          end if;\n       end if;\n \n@@ -1415,22 +1423,18 @@ package body Prj.Conf is\n         and then On_Load_Config = null\n       then\n          Write_Line\n-           (\"warning: --RTS is taken into account only in auto-configuration\");\n+           (\"warning: \" &\n+              \"--RTS is taken into account only in auto-configuration\");\n       end if;\n \n       --  Parse the configuration file\n \n-      if Verbose_Mode\n-        and then Config_File_Path /= null\n-        and then On_Load_Config = null\n-      then\n+      if Verbose_Mode and then Config_File_Path /= null then\n          Write_Str  (\"Checking configuration \");\n          Write_Line (Config_File_Path.all);\n       end if;\n \n-      --  Add comment for On_Load_Config test ???\n-\n-      if Config_File_Path /= null and then On_Load_Config = null then\n+      if Config_File_Path /= null then\n          Prj.Part.Parse\n            (In_Tree           => Project_Node_Tree,\n             Project           => Config_Project_Node,"}, {"sha": "467d9741e03c47c2338273d0d391eec24b5f9e3a", "filename": "gcc/ada/prj-conf.ads", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprj-conf.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprj-conf.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.ads?ref=cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "patch": "@@ -40,6 +40,12 @@ package Prj.Conf is\n    --  is set to Empty_Node when this procedure is called. You can then decide\n    --  to create a new config file if you need.\n \n+   No_Configuration_File : constant String := \"/\";\n+   --  When specified as a parameter Config_File_Name in the procedures below,\n+   --  no existing configuration project file is parsed. This is used by\n+   --  gnatmake, gnatclean and the GNAT driver to avoid parsing an existing\n+   --  default configuration project file.\n+\n    procedure Parse_Project_And_Apply_Config\n      (Main_Project               : out Prj.Project_Id;\n       User_Project_Node          : out Prj.Tree.Project_Node_Id;\n@@ -68,6 +74,10 @@ package Prj.Conf is\n    --  happened while parsing the project itself (i.e. creating the tree),\n    --  User_Project_Node is also set to Empty_Node.\n    --\n+   --  If Config_File_Name is No_Configuration_File, then no configuration\n+   --  project file is parsed. Normally, in this case On_Load_Config is not\n+   --  null, and it is used to create a configuration project file in memory.\n+   --\n    --  Autoconf_Specified indicates whether the user has specified --autoconf.\n    --  If this is the case, the config file might be (re)generated, as\n    --  appropriate, to match languages and target if the one specified doesn't"}, {"sha": "7fbce49fa9affa2198426b895b90320cd3712760", "filename": "gcc/ada/prj-pars.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprj-pars.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprj-pars.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-pars.adb?ref=cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "patch": "@@ -86,7 +86,7 @@ package body Prj.Pars is\n             Process_Project_And_Apply_Config\n               (Main_Project               => The_Project,\n                User_Project_Node          => Project_Node,\n-               Config_File_Name           => \"\",\n+               Config_File_Name           => No_Configuration_File,\n                Autoconf_Specified         => False,\n                Project_Tree               => In_Tree,\n                Project_Node_Tree          => Project_Node_Tree,"}, {"sha": "0236ba2dc3a2fa0637ba5c39a9a2a1031d5d3362", "filename": "gcc/ada/projects.texi", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprojects.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc55f9bee5f0fc2f705ee27fd95c1339185b077a/gcc%2Fada%2Fprojects.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprojects.texi?ref=cc55f9bee5f0fc2f705ee27fd95c1339185b077a", "patch": "@@ -4384,11 +4384,11 @@ Index is a language name. Indicates the kind of the language, either file based\n or unit based. Only authorized case-insensitive values are \"unit_based\" and\n \"file_based\" (the default).\n \n-@item @b{Dependency_Kind}: : single, indexed, case-insensitive index\n+@item @b{Dependency_Kind}: single, indexed, case-insensitive index\n \n Index is a language name. Indicates how the dependencies are handled for the\n language. Only authorized case-insensitive values are \"makefile\", \"ali_file\",\n-\"ali_closure\" or \"none\" (the default.\n+\"ali_closure\" or \"none\" (the default).\n \n @item @b{Required_Switches}: list, indexed, case-insensitive index\n "}]}