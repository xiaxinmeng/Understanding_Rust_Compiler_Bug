{"sha": "b11465f1150a11d6a9b186417c468c8191ae41a1", "node_id": "C_kwDOANBUbNoAKGIxMTQ2NWYxMTUwYTExZDZhOWIxODY0MTdjNDY4YzgxOTFhZTQxYTE", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2022-03-01T23:56:06Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2022-03-01T23:56:06Z"}, "message": "Add a test for true positives related to PR104715.\n\nRelated to:\nPR tree-optimization/104715 - false dangling pointer with strstr\n\ngcc/testsuite/ChangeLog:\n\tPR tree-optimization/104715\n\t* gcc.dg/Wdangling-pointer-3.c: New test.", "tree": {"sha": "b7ceff976b278cd510de8e0a552ea2b3132cf6d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b7ceff976b278cd510de8e0a552ea2b3132cf6d7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b11465f1150a11d6a9b186417c468c8191ae41a1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b11465f1150a11d6a9b186417c468c8191ae41a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b11465f1150a11d6a9b186417c468c8191ae41a1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b11465f1150a11d6a9b186417c468c8191ae41a1/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a0e3bba4b735fa8e4463d52950d0ce9c30c16c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a0e3bba4b735fa8e4463d52950d0ce9c30c16c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a0e3bba4b735fa8e4463d52950d0ce9c30c16c7"}], "stats": {"total": 92, "additions": 92, "deletions": 0}, "files": [{"sha": "01859303fcfad92057e443b98fda9fa420d1c6a6", "filename": "gcc/testsuite/gcc.dg/Wdangling-pointer-3.c", "status": "added", "additions": 92, "deletions": 0, "changes": 92, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b11465f1150a11d6a9b186417c468c8191ae41a1/gcc%2Ftestsuite%2Fgcc.dg%2FWdangling-pointer-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b11465f1150a11d6a9b186417c468c8191ae41a1/gcc%2Ftestsuite%2Fgcc.dg%2FWdangling-pointer-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWdangling-pointer-3.c?ref=b11465f1150a11d6a9b186417c468c8191ae41a1", "patch": "@@ -0,0 +1,92 @@\n+/* PR tree-optimization/104715 - false dangling pointer with strstr\n+   Vertify that using pointers that have become dangling after they were\n+   passed to and returned from strstr is diagnosed.\n+  { dg-do compile }\n+  { dg-options \"-Wall\" } */\n+\n+extern char* strstr (const char*, const char*);\n+\n+void sink (const void*);\n+\n+void nowarn_strstr_static (const char *s)\n+{\n+  char *t1;\n+\n+  {\n+    static const char a[] = \"abc\";\n+    t1 = strstr (a, s);\n+    sink (t1);\n+  }\n+\n+  sink (t1);\n+}\n+\n+\n+void nowarn_strstr_lit (const char *s)\n+{\n+  char *t2;\n+\n+  {\n+    t2 = strstr (\"def\", s);\n+    sink (t2);\n+  }\n+\n+  sink (t2);\n+}\n+\n+\n+void warn_strstr_comp_lit (const char *s)\n+{\n+  char *t3;\n+\n+  {\n+    const char *a =\n+      (char[]){ '1', '\\0' };  // { dg-message \"unnamed temporary defined here\" }\n+    t3 = strstr (a, s);\n+    sink (t3);\n+  }\n+\n+  sink (t3);            // { dg-warning \"using dangling pointer 't3' to an unnamed temporary\" }\n+}\n+\n+\n+void warn_strstr_arg (const char *s)\n+{\n+  char *t4;\n+\n+  {\n+    char a[] = \"1\";     // { dg-message \"'a' declared here\" }\n+    t4 = strstr (a, s);\n+    sink (t4);\n+  }\n+\n+  sink (t4);            // { dg-warning \"using dangling pointer 't4' to 'a'\" }\n+}\n+\n+\n+void warn_strstr_arg_plus_cst (const char *s)\n+{\n+  char *t5;\n+\n+  {\n+    char a[] = \"12\";    // { dg-message \"'a' declared here\" }\n+    t5 = strstr (a + 1, s);\n+    sink (t5);\n+  }\n+\n+  sink (t5);            // { dg-warning \"using dangling pointer 't5' to 'a'\" }\n+}\n+\n+\n+void warn_strstr_arg_plus_var (const char *s, int i)\n+{\n+  char *t6;\n+\n+  {\n+    char a[] = \"123\";   // { dg-message \"'a' declared here\" }\n+    t6 = strstr (a + i, s);\n+    sink (t6++);\n+  }\n+\n+  sink (t6);            // { dg-warning \"using dangling pointer 't6' to 'a'\" }\n+}"}]}