{"sha": "1665db4dbd2b04ed42f094b399db251bb2f8b839", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTY2NWRiNGRiZDJiMDRlZDQyZjA5NGIzOTlkYjI1MWJiMmY4YjgzOQ==", "commit": {"author": {"name": "Christophe Lyon", "email": "christophe.lyon@linaro.org", "date": "2014-10-11T11:33:37Z"}, "committer": {"name": "Christophe Lyon", "email": "clyon@gcc.gnu.org", "date": "2014-10-11T11:33:37Z"}, "message": "target-supports.exp (check_effective_target_shared): New function.\n\n2014-10-11  Christophe Lyon  <christophe.lyon@linaro.org>\n\n\tgcc/testsuite/\n\t* lib/target-supports.exp (check_effective_target_shared): New\n\tfunction.\n        * g++.dg/ipa/devirt-28a.C: Check if -shared is supported.\n\nFrom-SVN: r216117", "tree": {"sha": "9394ce08af649aa73724e4bc6e984408bfc14bb8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9394ce08af649aa73724e4bc6e984408bfc14bb8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1665db4dbd2b04ed42f094b399db251bb2f8b839", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1665db4dbd2b04ed42f094b399db251bb2f8b839", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1665db4dbd2b04ed42f094b399db251bb2f8b839", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1665db4dbd2b04ed42f094b399db251bb2f8b839/comments", "author": null, "committer": null, "parents": [{"sha": "51115027530f64fe29b5c755a161581658a32c38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51115027530f64fe29b5c755a161581658a32c38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51115027530f64fe29b5c755a161581658a32c38"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "b038c828d38fc55f36374eb196bfdd41f4a19d6d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1665db4dbd2b04ed42f094b399db251bb2f8b839/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1665db4dbd2b04ed42f094b399db251bb2f8b839/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1665db4dbd2b04ed42f094b399db251bb2f8b839", "patch": "@@ -1,3 +1,9 @@\n+2014-10-11  Christophe Lyon  <christophe.lyon@linaro.org>\n+\n+\t* lib/target-supports.exp (check_effective_target_shared): New\n+\tfunction.\n+        * g++.dg/ipa/devirt-28a.C: Check if -shared is supported.\n+\n 2014-10-10  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/63495"}, {"sha": "65d5fcdf3e2bd5e99dad4406ed561f24e8942029", "filename": "gcc/testsuite/g++.dg/ipa/devirt-28a.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1665db4dbd2b04ed42f094b399db251bb2f8b839/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-28a.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1665db4dbd2b04ed42f094b399db251bb2f8b839/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-28a.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fdevirt-28a.C?ref=1665db4dbd2b04ed42f094b399db251bb2f8b839", "patch": "@@ -1,6 +1,6 @@\n // PR c++/58678\n // { dg-options \"-O3 -flto -shared -fPIC -Wl,--no-undefined\" }\n-// { dg-do link { target { gld && fpic } } }\n+// { dg-do link { target { { gld && fpic } && shared } } }\n \n struct A {\n   virtual ~A();"}, {"sha": "4398345eb8a55f2344798ab8a1f809f162477d0b", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1665db4dbd2b04ed42f094b399db251bb2f8b839/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1665db4dbd2b04ed42f094b399db251bb2f8b839/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=1665db4dbd2b04ed42f094b399db251bb2f8b839", "patch": "@@ -840,6 +840,19 @@ proc check_effective_target_fpic { } {\n     return 0\n }\n \n+# Return 1 if -shared is supported, as in no warnings or errors\n+# emitted, 0 otherwise.\n+\n+proc check_effective_target_shared { } {\n+    # Note that M68K has a multilib that supports -fpic but not\n+    # -fPIC, so we need to check both.  We test with a program that\n+    # requires GOT references.\n+    return [check_no_compiler_messages shared executable {\n+\textern int foo (void); extern int bar;\n+\tint baz (void) { return foo () + bar; }\n+    } \"-shared -fpic\"]\n+}\n+\n # Return 1 if -pie, -fpie and -fPIE are supported, 0 otherwise.\n \n proc check_effective_target_pie { } {"}]}