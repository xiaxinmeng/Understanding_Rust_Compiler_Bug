{"sha": "238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM4MDY1YTczYmQyYmFiNmMzZWI2OWU2ZDQzY2Q4MTE1YTViNDI0NQ==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-07-09T18:53:35Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-07-09T18:53:35Z"}, "message": "re PR middle-end/53887 (ICE in hoist_edge_and_branch_if_true, at tree-switch-conversion.c:79)\n\ngcc/\n\tPR tree-optimization/53887\n\t* tree-cfg.c (group_case_labels_stmt): Make non-static.\n\t* tree-flow.h (group_case_labels_stmt): Add prototype.\n\t* tree-switch-conversion.c (process_switch): Use group_case_labels_stmt\n\tto pre-process every switch.\n\ntestsuite/\n\tPR tree-optimization/53887\n\t* gcc.dg/pr53887.c: New test.\n\nFrom-SVN: r189389", "tree": {"sha": "d7f84fe48d87db0df890f2f77c86736581a54e5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d7f84fe48d87db0df890f2f77c86736581a54e5d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "html_url": "https://github.com/Rust-GCC/gccrs/commit/238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/comments", "author": null, "committer": null, "parents": [{"sha": "06e3e32bcd55600300f4a393a77bb582ff68cdf9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06e3e32bcd55600300f4a393a77bb582ff68cdf9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06e3e32bcd55600300f4a393a77bb582ff68cdf9"}], "stats": {"total": 51, "additions": 47, "deletions": 4}, "files": [{"sha": "d8edad09b3c000557edfc14b7a576cc10073ef12", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "patch": "@@ -1,3 +1,11 @@\n+2012-07-09  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\tPR tree-optimization/53887\n+\t* tree-cfg.c (group_case_labels_stmt): Make non-static.\n+\t* tree-flow.h (group_case_labels_stmt): Add prototype.\n+\t* tree-switch-conversion.c (process_switch): Use group_case_labels_stmt\n+\tto pre-process every switch.\n+\n 2012-07-09  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/53882"}, {"sha": "5777c5f9fb4eeb871375519db4d31068b779170d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "patch": "@@ -1,3 +1,8 @@\n+2012-07-09  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\tPR tree-optimization/53887\n+\t* gcc.dg/pr53887.c: New test.\n+\n 2012-07-09  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/53882"}, {"sha": "b46126cd2ac8f4f45fc3e4d7eff563d6db60a7f8", "filename": "gcc/testsuite/gcc.dg/pr53887.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftestsuite%2Fgcc.dg%2Fpr53887.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftestsuite%2Fgcc.dg%2Fpr53887.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr53887.c?ref=238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+enum\n+{ Failed, NoError, NoDiskette }\n+a;\n+int b, c;\n+void\n+fn1 ()\n+{\n+    if (c)\n+        a << 1;\n+    switch (b)\n+    {\n+    default:\n+        a << 1;\n+    case 0:\n+        b = 0;\n+    case 1:\n+    case NoDiskette:\n+        ;\n+    }\n+}\n+"}, {"sha": "bdcf7c3af9dcb53d5fbb511d46856eab0aa073ce", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "patch": "@@ -125,7 +125,6 @@ static edge find_taken_edge_computed_goto (basic_block, tree);\n static edge find_taken_edge_cond_expr (basic_block, tree);\n static edge find_taken_edge_switch_expr (basic_block, tree);\n static tree find_case_label_for_value (gimple, tree);\n-static void group_case_labels_stmt (gimple);\n \n void\n init_empty_tree_cfg_for_function (struct function *fn)\n@@ -1331,7 +1330,7 @@ cleanup_dead_labels (void)\n    the ones jumping to the same label.\n    Eg. three separate entries 1: 2: 3: become one entry 1..3:  */\n \n-static void\n+void\n group_case_labels_stmt (gimple stmt)\n {\n   int old_size = gimple_switch_num_labels (stmt);"}, {"sha": "8f7d336037e77c42ceb363057fe37443342bbe7e", "filename": "gcc/tree-flow.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftree-flow.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftree-flow.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-flow.h?ref=238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "patch": "@@ -428,6 +428,7 @@ extern void debug_loop_num (unsigned, int);\n extern void print_loops (FILE *, int);\n extern void print_loops_bb (FILE *, basic_block, int, int);\n extern void cleanup_dead_labels (void);\n+extern void group_case_labels_stmt (gimple);\n extern void group_case_labels (void);\n extern gimple first_stmt (basic_block);\n extern gimple last_stmt (basic_block);"}, {"sha": "80457989a476f897ebcea486854243dd07bbfa9d", "filename": "gcc/tree-switch-conversion.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftree-switch-conversion.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/238065a73bd2bab6c3eb69e6d43cd8115a5b4245/gcc%2Ftree-switch-conversion.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-switch-conversion.c?ref=238065a73bd2bab6c3eb69e6d43cd8115a5b4245", "patch": "@@ -1339,8 +1339,14 @@ process_switch (gimple swtch)\n {\n   struct switch_conv_info info;\n \n-  /* Degenerate case with only a default label should never happen.  */\n-  gcc_checking_assert (gimple_switch_num_labels (swtch) > 1);\n+  /* Group case labels so that we get the right results from the heuristics\n+     that decide on the code generation approach for this switch.  */\n+  group_case_labels_stmt (swtch);\n+\n+  /* If this switch is now a degenerate case with only a default label,\n+     there is nothing left for us to do.   */\n+  if (gimple_switch_num_labels (swtch) < 2)\n+    return \"switch is a degenerate case\";\n \n   collect_switch_conv_info (swtch, &info);\n "}]}