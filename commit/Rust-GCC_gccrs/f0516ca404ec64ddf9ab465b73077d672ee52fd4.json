{"sha": "f0516ca404ec64ddf9ab465b73077d672ee52fd4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjA1MTZjYTQwNGVjNjRkZGY5YWI0NjViNzMwNzdkNjcyZWU1MmZkNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-02-15T22:05:12Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-02-15T22:05:12Z"}, "message": "re PR c++/69658 (Bogus \"C99 designator outside aggregate initializer\" error)\n\n\tPR c++/69658\n\t* init.c (expand_default_init): Only call reshape_init\n\tin the direct-initialization from an initializer list case.\n\n\t* g++.dg/init/pr69658.C: New test.\n\nFrom-SVN: r233435", "tree": {"sha": "e6cf6cc5c66bd98f21ac96313f328ee00a993f03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e6cf6cc5c66bd98f21ac96313f328ee00a993f03"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f0516ca404ec64ddf9ab465b73077d672ee52fd4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0516ca404ec64ddf9ab465b73077d672ee52fd4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0516ca404ec64ddf9ab465b73077d672ee52fd4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0516ca404ec64ddf9ab465b73077d672ee52fd4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ba6b3795d4d7fe18b27a467f7d96051b5b55ace2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba6b3795d4d7fe18b27a467f7d96051b5b55ace2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba6b3795d4d7fe18b27a467f7d96051b5b55ace2"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "51c99e1759889624895e1d29eb5ec90ead8a0413", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f0516ca404ec64ddf9ab465b73077d672ee52fd4", "patch": "@@ -1,3 +1,9 @@\n+2016-02-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/69658\n+\t* init.c (expand_default_init): Only call reshape_init\n+\tin the direct-initialization from an initializer list case.\n+\n 2016-02-15  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/69753"}, {"sha": "9f9c7292d2d470aa19d23782044b2ccee20766ca", "filename": "gcc/cp/init.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=f0516ca404ec64ddf9ab465b73077d672ee52fd4", "patch": "@@ -1636,16 +1636,17 @@ expand_default_init (tree binfo, tree true_exp, tree exp, tree init, int flags,\n       gcc_checking_assert ((flags & LOOKUP_ONLYCONVERTING) == 0\n \t\t\t   && TREE_CHAIN (init) == NULL_TREE);\n       init = TREE_VALUE (init);\n+      /* Only call reshape_init if it has not been called earlier\n+\t by the callers.  */\n+      if (BRACE_ENCLOSED_INITIALIZER_P (init) && CP_AGGREGATE_TYPE_P (type))\n+\tinit = reshape_init (type, init, complain);\n     }\n \n   if (init && BRACE_ENCLOSED_INITIALIZER_P (init)\n       && CP_AGGREGATE_TYPE_P (type))\n     /* A brace-enclosed initializer for an aggregate.  In C++0x this can\n        happen for direct-initialization, too.  */\n-    {\n-      init = reshape_init (type, init, complain);\n-      init = digest_init (type, init, complain);\n-    }\n+    init = digest_init (type, init, complain);\n \n   /* A CONSTRUCTOR of the target's type is a previously digested\n      initializer, whether that happened just above or in"}, {"sha": "8987be19d3e9314f8d7020939ef6e395685ef924", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f0516ca404ec64ddf9ab465b73077d672ee52fd4", "patch": "@@ -1,5 +1,8 @@\n 2016-02-15  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/69658\n+\t* g++.dg/init/pr69658.C: New test.\n+\n \tPR c++/69797\n \t* c-c++-common/pr69797.c: New test.\n "}, {"sha": "976f79d92d33c59e3e385c7de6b47c91ab72e2b1", "filename": "gcc/testsuite/g++.dg/init/pr69658.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fpr69658.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0516ca404ec64ddf9ab465b73077d672ee52fd4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fpr69658.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fpr69658.C?ref=f0516ca404ec64ddf9ab465b73077d672ee52fd4", "patch": "@@ -0,0 +1,6 @@\n+// PR c++/69658\n+// { dg-do compile }\n+\n+struct S { S (int); };\n+struct T { char n[6]; S s; };\n+T t[1] = { { \"foo\", 1 } };\t// { dg-bogus \"C99 designator\" }"}]}