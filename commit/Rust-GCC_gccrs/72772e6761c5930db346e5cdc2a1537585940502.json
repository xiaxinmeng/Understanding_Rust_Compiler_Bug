{"sha": "72772e6761c5930db346e5cdc2a1537585940502", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzI3NzJlNjc2MWM1OTMwZGIzNDZlNWNkYzJhMTUzNzU4NTk0MDUwMg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-03-10T07:55:00Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-03-10T07:55:00Z"}, "message": "re PR tree-optimization/79972 (ICE in tree check: expected ssa_name, have var_decl in get_range_info, at tree-ssanames.c:377 w/ -Walloca -Wvla-larger-than=364854541)\n\n\tPR tree-optimization/79972\n\t* gimple-ssa-warn-alloca.c (alloca_call_type): Only call\n\tget_range_info on SSA_NAMEs.  Formatting fixes.\n\n\t* gcc.dg/pr79972.c: New test.\n\nFrom-SVN: r246022", "tree": {"sha": "3b1b43eaa52fe7c979ccc7ca4b843381b7b23f9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3b1b43eaa52fe7c979ccc7ca4b843381b7b23f9c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72772e6761c5930db346e5cdc2a1537585940502", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72772e6761c5930db346e5cdc2a1537585940502", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72772e6761c5930db346e5cdc2a1537585940502", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72772e6761c5930db346e5cdc2a1537585940502/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5558f089e39350824d7bc3d5467f72e1e90b2fae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5558f089e39350824d7bc3d5467f72e1e90b2fae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5558f089e39350824d7bc3d5467f72e1e90b2fae"}], "stats": {"total": 32, "additions": 28, "deletions": 4}, "files": [{"sha": "9a4844e2aac0fa6d060b843a44933478d1499292", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72772e6761c5930db346e5cdc2a1537585940502/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72772e6761c5930db346e5cdc2a1537585940502/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=72772e6761c5930db346e5cdc2a1537585940502", "patch": "@@ -1,3 +1,9 @@\n+2017-03-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/79972\n+\t* gimple-ssa-warn-alloca.c (alloca_call_type): Only call\n+\tget_range_info on SSA_NAMEs.  Formatting fixes.\n+\n 2017-03-10  Richard Biener  <rguenther@suse.de>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "b940efa910cdda41ee6806b9d7d4701e8f01ffdc", "filename": "gcc/gimple-ssa-warn-alloca.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72772e6761c5930db346e5cdc2a1537585940502/gcc%2Fgimple-ssa-warn-alloca.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72772e6761c5930db346e5cdc2a1537585940502/gcc%2Fgimple-ssa-warn-alloca.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-alloca.c?ref=72772e6761c5930db346e5cdc2a1537585940502", "patch": "@@ -300,8 +300,9 @@ alloca_call_type (gimple *stmt, bool is_vla, tree *invalid_casted_type)\n       ret = alloca_type_and_limit (ALLOCA_OK);\n     }\n   // Check the range info if available.\n-  else if (value_range_type range_type = get_range_info (len, &min, &max))\n+  else if (TREE_CODE (len) == SSA_NAME)\n     {\n+      value_range_type range_type = get_range_info (len, &min, &max);\n       if (range_type == VR_RANGE)\n \t{\n \t  if (wi::leu_p (max, max_size))\n@@ -328,7 +329,6 @@ alloca_call_type (gimple *stmt, bool is_vla, tree *invalid_casted_type)\n \t      gimple *def = SSA_NAME_DEF_STMT (len);\n \t      if (gimple_assign_cast_p (def)\n \t\t  && TYPE_UNSIGNED (TREE_TYPE (gimple_assign_rhs1 (def))))\n-\n \t\t{\n \t\t  len_casted = gimple_assign_rhs1 (def);\n \t\t  range_type = get_range_info (len_casted, &min, &max);\n@@ -344,8 +344,7 @@ alloca_call_type (gimple *stmt, bool is_vla, tree *invalid_casted_type)\n \t      else if (range_type == VR_ANTI_RANGE)\n \t\treturn alloca_type_and_limit (ALLOCA_UNBOUNDED);\n \t      else if (range_type != VR_VARYING)\n-\t\treturn\n-\t\t  alloca_type_and_limit (ALLOCA_BOUND_MAYBE_LARGE, max);\n+\t\treturn alloca_type_and_limit (ALLOCA_BOUND_MAYBE_LARGE, max);\n \t    }\n \t}\n       else if (range_type == VR_ANTI_RANGE)"}, {"sha": "b60d750a062ffdffeb91c04ad2b7bd274b45d144", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72772e6761c5930db346e5cdc2a1537585940502/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72772e6761c5930db346e5cdc2a1537585940502/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=72772e6761c5930db346e5cdc2a1537585940502", "patch": "@@ -1,5 +1,8 @@\n 2017-03-10  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/79972\n+\t* gcc.dg/pr79972.c: New test.\n+\n \tPR tree-optimization/77975\n \t* gcc.dg/pr77975.c: New test.\n "}, {"sha": "1d2b8befb26aaf68e290d09e4f53c052590c4880", "filename": "gcc/testsuite/gcc.dg/pr79972.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72772e6761c5930db346e5cdc2a1537585940502/gcc%2Ftestsuite%2Fgcc.dg%2Fpr79972.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72772e6761c5930db346e5cdc2a1537585940502/gcc%2Ftestsuite%2Fgcc.dg%2Fpr79972.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr79972.c?ref=72772e6761c5930db346e5cdc2a1537585940502", "patch": "@@ -0,0 +1,16 @@\n+/* PR tree-optimization/79972 */\n+/* { dg-do compile } */\n+/* { dg-require-effective-target alloca } */\n+/* { dg-options \"-Walloca -Wvla-larger-than=10000\" } */\n+\n+int\n+f (int dim, int *b, int *c)\n+{\n+  int newcentroid[3][dim];\t/* { dg-warning \"unbounded use of variable-length array\" } */\n+  int *a = newcentroid[2];\n+  int i, dist = 0;\n+  __builtin_memcpy (newcentroid, c, sizeof (newcentroid));\n+  for (i = 0; i < dim; i++)\n+    dist += (a[i] - b[i]) * (a[i] - b[i]);\n+  return dist;\n+}"}]}