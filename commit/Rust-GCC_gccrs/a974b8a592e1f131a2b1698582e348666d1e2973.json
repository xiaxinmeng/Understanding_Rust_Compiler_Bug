{"sha": "a974b8a592e1f131a2b1698582e348666d1e2973", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTk3NGI4YTU5MmUxZjEzMWEyYjE2OTg1ODJlMzQ4NjY2ZDFlMjk3Mw==", "commit": {"author": {"name": "Ilya Leoshkevich", "email": "iii@linux.ibm.com", "date": "2021-02-17T15:15:42Z"}, "committer": {"name": "Ilya Leoshkevich", "email": "iii@linux.ibm.com", "date": "2021-02-20T00:49:35Z"}, "message": "IBM Z: Improve FPRX2 <-> TF conversions\n\ngcc/ChangeLog:\n\n\t* config/s390/vector.md (*fprx2_to_tf): Rename to fprx2_to_tf,\n\tadd memory alternative.\n\t(tf_to_fprx2): New pattern.", "tree": {"sha": "388703fd0a33dc4f74222cd41ab1a8a2c5c32a26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/388703fd0a33dc4f74222cd41ab1a8a2c5c32a26"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a974b8a592e1f131a2b1698582e348666d1e2973", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a974b8a592e1f131a2b1698582e348666d1e2973", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a974b8a592e1f131a2b1698582e348666d1e2973", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a974b8a592e1f131a2b1698582e348666d1e2973/comments", "author": {"login": "iii-i", "id": 45998171, "node_id": "MDQ6VXNlcjQ1OTk4MTcx", "avatar_url": "https://avatars.githubusercontent.com/u/45998171?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iii-i", "html_url": "https://github.com/iii-i", "followers_url": "https://api.github.com/users/iii-i/followers", "following_url": "https://api.github.com/users/iii-i/following{/other_user}", "gists_url": "https://api.github.com/users/iii-i/gists{/gist_id}", "starred_url": "https://api.github.com/users/iii-i/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iii-i/subscriptions", "organizations_url": "https://api.github.com/users/iii-i/orgs", "repos_url": "https://api.github.com/users/iii-i/repos", "events_url": "https://api.github.com/users/iii-i/events{/privacy}", "received_events_url": "https://api.github.com/users/iii-i/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iii-i", "id": 45998171, "node_id": "MDQ6VXNlcjQ1OTk4MTcx", "avatar_url": "https://avatars.githubusercontent.com/u/45998171?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iii-i", "html_url": "https://github.com/iii-i", "followers_url": "https://api.github.com/users/iii-i/followers", "following_url": "https://api.github.com/users/iii-i/following{/other_user}", "gists_url": "https://api.github.com/users/iii-i/gists{/gist_id}", "starred_url": "https://api.github.com/users/iii-i/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iii-i/subscriptions", "organizations_url": "https://api.github.com/users/iii-i/orgs", "repos_url": "https://api.github.com/users/iii-i/repos", "events_url": "https://api.github.com/users/iii-i/events{/privacy}", "received_events_url": "https://api.github.com/users/iii-i/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50352c6cd2d2237572bfa53c0ba693f4c8eff1ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50352c6cd2d2237572bfa53c0ba693f4c8eff1ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50352c6cd2d2237572bfa53c0ba693f4c8eff1ee"}], "stats": {"total": 36, "additions": 31, "deletions": 5}, "files": [{"sha": "e48c965db0024454f248290713ead5f59df586eb", "filename": "gcc/config/s390/vector.md", "status": "modified", "additions": 31, "deletions": 5, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a974b8a592e1f131a2b1698582e348666d1e2973/gcc%2Fconfig%2Fs390%2Fvector.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a974b8a592e1f131a2b1698582e348666d1e2973/gcc%2Fconfig%2Fs390%2Fvector.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fvector.md?ref=a974b8a592e1f131a2b1698582e348666d1e2973", "patch": "@@ -616,12 +616,23 @@\n    vlvgp\\t%v0,%1,%N1\"\n   [(set_attr \"op_type\" \"VRR,VRX,VRX,VRI,VRR\")])\n \n-(define_insn \"*fprx2_to_tf\"\n-  [(set (match_operand:TF               0 \"nonimmediate_operand\" \"=v\")\n-\t(subreg:TF (match_operand:FPRX2 1 \"general_operand\"       \"f\") 0))]\n+(define_insn_and_split \"fprx2_to_tf\"\n+  [(set (match_operand:TF               0 \"nonimmediate_operand\" \"=v,AR\")\n+\t(subreg:TF (match_operand:FPRX2 1 \"general_operand\"       \"f,f\") 0))]\n   \"TARGET_VXE\"\n-  \"vmrhg\\t%v0,%1,%N1\"\n-  [(set_attr \"op_type\" \"VRR\")])\n+  \"@\n+   vmrhg\\t%v0,%1,%N1\n+   #\"\n+  \"!(MEM_P (operands[0]) && MEM_VOLATILE_P (operands[0]))\"\n+  [(set (match_dup 2) (match_dup 3))\n+   (set (match_dup 4) (match_dup 5))]\n+{\n+  operands[2] = simplify_gen_subreg (DFmode, operands[0], TFmode, 0);\n+  operands[3] = simplify_gen_subreg (DFmode, operands[1], FPRX2mode, 0);\n+  operands[4] = simplify_gen_subreg (DFmode, operands[0], TFmode, 8);\n+  operands[5] = simplify_gen_subreg (DFmode, operands[1], FPRX2mode, 8);\n+}\n+  [(set_attr \"op_type\" \"VRR,*\")])\n \n (define_insn \"*vec_ti_to_v1ti\"\n   [(set (match_operand:V1TI                   0 \"nonimmediate_operand\" \"=v,v,R,  v,  v,v\")\n@@ -753,6 +764,21 @@\n   \"vpdi\\t%V0,%v1,%V0,5\"\n   [(set_attr \"op_type\" \"VRR\")])\n \n+(define_insn_and_split \"tf_to_fprx2\"\n+  [(set (match_operand:FPRX2            0 \"nonimmediate_operand\" \"=f,f\")\n+\t(subreg:FPRX2 (match_operand:TF 1 \"general_operand\"       \"v,AR\") 0))]\n+  \"TARGET_VXE\"\n+  \"#\"\n+  \"!(MEM_P (operands[1]) && MEM_VOLATILE_P (operands[1]))\"\n+  [(set (match_dup 2) (match_dup 3))\n+   (set (match_dup 4) (match_dup 5))]\n+{\n+  operands[2] = simplify_gen_subreg (DFmode, operands[0], FPRX2mode, 0);\n+  operands[3] = simplify_gen_subreg (DFmode, operands[1], TFmode, 0);\n+  operands[4] = simplify_gen_subreg (DFmode, operands[0], FPRX2mode, 8);\n+  operands[5] = simplify_gen_subreg (DFmode, operands[1], TFmode, 8);\n+})\n+\n ; vec_perm_const for V2DI using vpdi?\n \n ;;"}]}