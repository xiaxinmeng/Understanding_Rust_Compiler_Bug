{"sha": "d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZmN2MxMjVkODVmN2IyZmI1Zjg2MjVkNDk5MmZiZTQ4ZjQ1NDdkNA==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2016-07-12T15:00:28Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2016-07-12T15:00:28Z"}, "message": "[expr.c] PR middle-end/71700: zero-extend sub-word value when widening constructor element\n\n\tPR middle-end/71700\n\t* expr.c (store_constructor): Mask sign-extended bits when widening\n\tsub-word constructor element at the start of a word.\n\n\t* gcc.c-torture/execute/pr71700.c: New test.\n\nFrom-SVN: r238248", "tree": {"sha": "277c9334e6c15f3d94d37021a3b0b7007827c8eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/277c9334e6c15f3d94d37021a3b0b7007827c8eb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5548d9cd190fae2112e410b8ff91b09ec03f19e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5548d9cd190fae2112e410b8ff91b09ec03f19e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5548d9cd190fae2112e410b8ff91b09ec03f19e9"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "ac411d5c3cb5a88988062f08d14e37ed27f05ea9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "patch": "@@ -1,3 +1,9 @@\n+2016-07-12  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR middle-end/71700\n+\t* expr.c (store_constructor): Mask sign-extended bits when widening\n+\tsub-word constructor element at the start of a word.\n+\n 2016-07-12  Martin Liska  <mliska@suse.cz>\n \n \t* ira-build.c (mark_loops_for_removal): Properly iterate"}, {"sha": "4073a989d96edb5694cdae9fe50e161843d645c1", "filename": "gcc/expr.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "patch": "@@ -6281,6 +6281,13 @@ store_constructor (tree exp, rtx target, int cleared, HOST_WIDE_INT size,\n \t\t    type = lang_hooks.types.type_for_mode\n \t\t      (word_mode, TYPE_UNSIGNED (type));\n \t\t    value = fold_convert (type, value);\n+\t\t    /* Make sure the bits beyond the original bitsize are zero\n+\t\t       so that we can correctly avoid extra zeroing stores in\n+\t\t       later constructor elements.  */\n+\t\t    tree bitsize_mask\n+\t\t      = wide_int_to_tree (type, wi::mask (bitsize, false,\n+\t\t\t\t\t\t\t   BITS_PER_WORD));\n+\t\t    value = fold_build2 (BIT_AND_EXPR, type, value, bitsize_mask);\n \t\t  }\n \n \t\tif (BYTES_BIG_ENDIAN)"}, {"sha": "71b52273b681d2df749f3ba1d7baaa79b6e055d3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "patch": "@@ -1,3 +1,8 @@\n+2016-07-12  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR middle-end/71700\n+\t* gcc.c-torture/execute/pr71700.c: New test.\n+\n 2016-07-12  Steven Bosscher  <steven@gcc.gnu.org>\n \tRichard Biener  <rguenther@suse.de>\n "}, {"sha": "80afd3809c3abd24135fb36b757ace9f41ba3112", "filename": "gcc/testsuite/gcc.c-torture/execute/pr71700.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr71700.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr71700.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr71700.c?ref=d6f7c125d85f7b2fb5f8625d4992fbe48f4547d4", "patch": "@@ -0,0 +1,19 @@\n+struct S\n+{\n+  signed f0 : 16;\n+  unsigned f1 : 1;\n+};\n+\n+int b;\n+static struct S c[] = {{-1, 0}, {-1, 0}};\n+struct S d;\n+\n+int\n+main ()\n+{\n+  struct S e = c[0];\n+  d = e;\n+  if (d.f1 != 0)\n+    __builtin_abort ();\n+  return 0;\n+}"}]}