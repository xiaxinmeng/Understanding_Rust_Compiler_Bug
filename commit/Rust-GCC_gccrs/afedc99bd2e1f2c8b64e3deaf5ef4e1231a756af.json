{"sha": "afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWZlZGM5OWJkMmUxZjJjOGI2NGUzZGVhZjVlZjRlMTIzMWE3NTZhZg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2018-02-22T18:52:33Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2018-02-22T18:52:33Z"}, "message": "runtime: funcfileline: get missing function name from symbol table\n    \n    Copy the idea of https://golang.org/cl/92756 to funcfileline, which is\n    used by runtime.FuncForPC, runtime.(*Frames).Next, and others.\n    \n    Reviewed-on: https://go-review.googlesource.com/96175\n\nFrom-SVN: r257913", "tree": {"sha": "5eca75e24abe6155adb44ab8c29ea40cb0bea840", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5eca75e24abe6155adb44ab8c29ea40cb0bea840"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/comments", "author": null, "committer": null, "parents": [{"sha": "35e7db41cab1a2b134b8ccd4407675ab20fde578", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35e7db41cab1a2b134b8ccd4407675ab20fde578", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35e7db41cab1a2b134b8ccd4407675ab20fde578"}], "stats": {"total": 38, "additions": 24, "deletions": 14}, "files": [{"sha": "b708cb7c603dee203160a5654e04e20a5c3817a5", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "patch": "@@ -1,4 +1,4 @@\n-b4d61f028dd1623142df4130b6c660bb77474b7b\n+ed8647cc99652db2d689215c05f31ad038438a7e\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "6b26ddccbcf2e6bbe0942f1ce984d0302f2e72b7", "filename": "libgo/runtime/go-caller.c", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/libgo%2Fruntime%2Fgo-caller.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/libgo%2Fruntime%2Fgo-caller.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fgo-caller.c?ref=afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "patch": "@@ -129,18 +129,26 @@ __go_get_backtrace_state ()\n    is the entry on the stack of inlined functions; -1 means the last\n    one.  */\n \n-_Bool\n+static _Bool\n __go_file_line (uintptr pc, int index, String *fn, String *file, intgo *line)\n {\n   struct caller c;\n+  struct backtrace_state *state;\n \n   runtime_memclr (&c, sizeof c);\n   c.index = index;\n-  backtrace_pcinfo (__go_get_backtrace_state (), pc, callback,\n-\t\t    error_callback, &c);\n+  state = __go_get_backtrace_state ();\n+  backtrace_pcinfo (state, pc, callback, error_callback, &c);\n   *fn = c.fn;\n   *file = c.file;\n   *line = c.line;\n+\n+  // If backtrace_pcinfo didn't get the function name from the debug\n+  // info, try to get it from the symbol table.\n+  if (fn->len == 0)\n+    backtrace_syminfo (state, pc, __go_syminfo_fnname_callback,\n+\t\t       error_callback, fn);\n+\n   return c.file.len > 0;\n }\n "}, {"sha": "b16ae0c40368c0a4af914e4e3f7b7beaaad08eae", "filename": "libgo/runtime/go-callers.c", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/libgo%2Fruntime%2Fgo-callers.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/libgo%2Fruntime%2Fgo-callers.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fgo-callers.c?ref=afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "patch": "@@ -145,16 +145,17 @@ callback (void *data, uintptr_t pc, const char *filename, int lineno,\n \n /* Syminfo callback.  */\n \n-static void\n-syminfo_fnname_callback (void *data, uintptr_t pc __attribute__ ((unused)),\n-\t\t\t const char *symname,\n-\t\t\t uintptr_t address __attribute__ ((unused)),\n-\t\t\t uintptr_t size __attribute__ ((unused)))\n+void\n+__go_syminfo_fnname_callback (void *data,\n+\t\t\t      uintptr_t pc __attribute__ ((unused)),\n+\t\t\t      const char *symname,\n+\t\t\t      uintptr_t address __attribute__ ((unused)),\n+\t\t\t      uintptr_t size __attribute__ ((unused)))\n {\n-  Location* locptr = (Location*) data;\n+  String* strptr = (String*) data;\n \n   if (symname != NULL)\n-    locptr->function = runtime_gostringnocopy ((const byte *) symname);\n+    *strptr = runtime_gostringnocopy ((const byte *) symname);\n }\n \n /* Error callback.  */\n@@ -228,8 +229,8 @@ runtime_callers (int32 skip, Location *locbuf, int32 m, bool keep_thunks)\n   for (i = 0; i < data.index; ++i)\n     {\n       if (locbuf[i].function.len == 0 && locbuf[i].pc != 0)\n-\tbacktrace_syminfo (state, locbuf[i].pc, syminfo_fnname_callback,\n-\t\t\t   error_callback, &locbuf[i]);\n+\tbacktrace_syminfo (state, locbuf[i].pc, __go_syminfo_fnname_callback,\n+\t\t\t   error_callback, &locbuf[i].function);\n     }\n \n   return data.index;"}, {"sha": "0ffcf4bde9e92cb6e79ea17ae22e0d55ebb1dd3d", "filename": "libgo/runtime/runtime.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/libgo%2Fruntime%2Fruntime.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af/libgo%2Fruntime%2Fruntime.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fruntime.h?ref=afedc99bd2e1f2c8b64e3deaf5ef4e1231a756af", "patch": "@@ -456,7 +456,8 @@ extern uintptr runtime_stacks_sys;\n \n struct backtrace_state;\n extern struct backtrace_state *__go_get_backtrace_state(void);\n-extern _Bool __go_file_line(uintptr, int, String*, String*, intgo *);\n+extern void __go_syminfo_fnname_callback(void*, uintptr_t, const char*,\n+\t\t\t\t\t uintptr_t, uintptr_t);\n extern void runtime_main(void*)\n   __asm__(GOSYM_PREFIX \"runtime.main\");\n "}]}