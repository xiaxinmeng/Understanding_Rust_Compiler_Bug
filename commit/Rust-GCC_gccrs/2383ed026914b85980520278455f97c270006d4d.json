{"sha": "2383ed026914b85980520278455f97c270006d4d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM4M2VkMDI2OTE0Yjg1OTgwNTIwMjc4NDU1Zjk3YzI3MDAwNmQ0ZA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-08-13T18:54:38Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-08-13T18:54:38Z"}, "message": "Minor optimisations in operator new(size_t, align_val_t)\n\n\t* libsupc++/new_opa.cc (operator new(size_t, align_val_t)): Use\n\t__is_pow2 to check for valid alignment. Avoid branching when rounding\n\tsize to multiple of alignment.\n\nFrom-SVN: r263515", "tree": {"sha": "62ef9e0c82e2e10010b35153162acaf010635c9f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/62ef9e0c82e2e10010b35153162acaf010635c9f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2383ed026914b85980520278455f97c270006d4d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2383ed026914b85980520278455f97c270006d4d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2383ed026914b85980520278455f97c270006d4d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2383ed026914b85980520278455f97c270006d4d/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7997ede243f459020ec756905749dea47187e0a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7997ede243f459020ec756905749dea47187e0a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7997ede243f459020ec756905749dea47187e0a8"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "5f4e8221ab3aabf4e7c791af62da9343456aae4c", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2383ed026914b85980520278455f97c270006d4d/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2383ed026914b85980520278455f97c270006d4d/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=2383ed026914b85980520278455f97c270006d4d", "patch": "@@ -1,5 +1,9 @@\n 2018-08-13  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* libsupc++/new_opa.cc (operator new(size_t, align_val_t)): Use\n+\t__is_pow2 to check for valid alignment. Avoid branching when rounding\n+\tsize to multiple of alignment.\n+\n \t* include/Makefile.am: Install <bit> and <version> for freestanding.\n \t* include/Makefile.in: Regenerate.\n \t* testsuite/17_intro/freestanding.cc: Check for <bit> and <version>."}, {"sha": "abb7451fafeca9ff2c39c8b81f0047de75afa0b9", "filename": "libstdc++-v3/libsupc++/new_opa.cc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2383ed026914b85980520278455f97c270006d4d/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fnew_opa.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2383ed026914b85980520278455f97c270006d4d/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fnew_opa.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fnew_opa.cc?ref=2383ed026914b85980520278455f97c270006d4d", "patch": "@@ -27,6 +27,7 @@\n #include <stdlib.h>\n #include <stdint.h>\n #include <bits/exception_defines.h>\n+#include <bit>\n #include \"new\"\n \n #if !_GLIBCXX_HAVE_ALIGNED_ALLOC && !_GLIBCXX_HAVE__ALIGNED_MALLOC \\\n@@ -105,7 +106,7 @@ operator new (std::size_t sz, std::align_val_t al)\n \n   /* Alignment must be a power of two.  */\n   /* XXX This should be checked by the compiler (PR 86878).  */\n-  if (__builtin_expect (align & (align - 1), false))\n+  if (__builtin_expect (!std::__ispow2(align), false))\n     _GLIBCXX_THROW_OR_ABORT(bad_alloc());\n \n   /* malloc (0) is unpredictable; avoid it.  */\n@@ -120,8 +121,7 @@ operator new (std::size_t sz, std::align_val_t al)\n     align = sizeof(void*);\n # endif\n   /* C11: the value of size shall be an integral multiple of alignment.  */\n-  if (std::size_t rem = sz & (align - 1))\n-    sz += align - rem;\n+  sz = (sz + align - 1) & ~(align - 1);\n #endif\n \n   void *p;"}]}