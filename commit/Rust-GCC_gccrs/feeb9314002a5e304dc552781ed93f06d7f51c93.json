{"sha": "feeb9314002a5e304dc552781ed93f06d7f51c93", "node_id": "C_kwDOANBUbNoAKGZlZWI5MzE0MDAyYTVlMzA0ZGM1NTI3ODFlZDkzZjA2ZDdmNTFjOTM", "commit": {"author": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-08-24T11:34:47Z"}, "committer": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-08-29T10:56:56Z"}, "message": "LoongArch: testsuite: refine __tls_get_addr tests with tls_native\n\nIf GCC is not built with a working linker for the target (developers\noccansionally build such a \"minimal\" GCC for testing and debugging),\nTLS will be emulated and __tls_get_addr won't be used.  Refine those\ntests depending on __tls_get_addr with tls_native to avoid test\nfailures.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/loongarch/func-call-medium-1.c: Refine test\n\tdepending on __tls_get_addr with { target tls_native }.\n\t* gcc.target/loongarch/func-call-medium-2.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-3.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-4.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-5.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-6.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-7.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-8.c: Likewise.\n\t* gcc.target/loongarch/tls-gd-noplt.c: Likewise.", "tree": {"sha": "3dbba329b9f56be0005a76bd8fbd90f9c2aed291", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3dbba329b9f56be0005a76bd8fbd90f9c2aed291"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/feeb9314002a5e304dc552781ed93f06d7f51c93", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQSR0PV2MB+STX3t3OisqtIOGecQ4wUCYwybeAAKCRCsqtIOGecQ\n4zvBAQD+cg+EyNHOzP98q4yJJDp+xFu400kxM3ZKbp2XRwCKWgEAqdkiNVmUAcXA\n7MslySaUamFoc3eaGm0wWQiiHkalCwk=\n=Ih73\n-----END PGP SIGNATURE-----", "payload": "tree 3dbba329b9f56be0005a76bd8fbd90f9c2aed291\nparent 1930c5d05ceff2173a32f23e5dbd0738460f521e\nauthor Xi Ruoyao <xry111@xry111.site> 1661340887 +0800\ncommitter Xi Ruoyao <xry111@xry111.site> 1661770616 +0800\n\nLoongArch: testsuite: refine __tls_get_addr tests with tls_native\n\nIf GCC is not built with a working linker for the target (developers\noccansionally build such a \"minimal\" GCC for testing and debugging),\nTLS will be emulated and __tls_get_addr won't be used.  Refine those\ntests depending on __tls_get_addr with tls_native to avoid test\nfailures.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/loongarch/func-call-medium-1.c: Refine test\n\tdepending on __tls_get_addr with { target tls_native }.\n\t* gcc.target/loongarch/func-call-medium-2.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-3.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-4.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-5.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-6.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-7.c: Likewise.\n\t* gcc.target/loongarch/func-call-medium-8.c: Likewise.\n\t* gcc.target/loongarch/tls-gd-noplt.c: Likewise.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/feeb9314002a5e304dc552781ed93f06d7f51c93", "html_url": "https://github.com/Rust-GCC/gccrs/commit/feeb9314002a5e304dc552781ed93f06d7f51c93", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/feeb9314002a5e304dc552781ed93f06d7f51c93/comments", "author": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1930c5d05ceff2173a32f23e5dbd0738460f521e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1930c5d05ceff2173a32f23e5dbd0738460f521e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1930c5d05ceff2173a32f23e5dbd0738460f521e"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "6339e832fe5875b044dfd7771453acfad674468b", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-1.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*la\\.global\\t.*g\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test1:.*la\\.global\\t.*f\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test2:.*la\\.local\\t.*l\\n\\tjirl\" } } */\n-/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" } } */\n+/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" { target tls_native } } } */\n \n extern void g (void);\n void"}, {"sha": "a53e75e0bf92dabd5cff22d1f2a32720aa2f3c02", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-2.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*la\\.global\\t.*g\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test1:.*la\\.local\\t.*f\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test2:.*la\\.local\\t.*l\\n\\tjirl\" } } */\n-/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" } } */\n+/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" { target tls_native } } } */\n \n extern void g (void);\n void"}, {"sha": "0da7bf98e3c27909f60da59bc03b7cc220720d9a", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-3.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-3.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*la\\.global\\t.*g\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test1:.*la\\.global\\t.*f\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test2:.*la\\.local\\t.*l\\n\\tjirl\" } } */\n-/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" } } */\n+/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" { target tls_native } } } */\n \n extern void g (void);\n void"}, {"sha": "0219688ae8041a34d28a8504c1ebbf2e68549a27", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-4.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*la\\.global\\t.*g\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test1:.*la\\.local\\t.*f\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test2:.*la\\.local\\t.*l\\n\\tjirl\" } } */\n-/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" } } */\n+/* { dg-final { scan-assembler \"test3:.*la\\.global\\t.*\\_\\_tls\\_get\\_addr\" { target tls_native } } } */\n \n extern void g (void);\n void"}, {"sha": "8a47b5afcba75a02750b483f6b8b52d7e924ca2d", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-5.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-5.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*pcalau12i.*%pc_hi20\\\\(g\\\\)\\n\\tjirl.*pc_lo12\\\\(g\\\\)\" } } */\n /* { dg-final { scan-assembler \"test1:.*pcalau12i.*%pc_hi20\\\\(f\\\\)\\n\\tjirl.*%pc_lo12\\\\(f\\\\)\" } } */\n /* { dg-final { scan-assembler \"test2:.*pcalau12i.*%pc_hi20\\\\(l\\\\)\\n\\tjirl.*%pc_lo12\\\\(l\\\\)\" } } */\n-/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%pc_hi20\\\\(__tls_get_addr\\\\)\\n\\t.*\\n\\tjirl.*%pc_lo12\\\\(__tls_get_addr\\\\)\" } } */\n+/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%pc_hi20\\\\(__tls_get_addr\\\\)\\n\\t.*\\n\\tjirl.*%pc_lo12\\\\(__tls_get_addr\\\\)\" { target tls_native } } } */\n \n extern void g (void);\n "}, {"sha": "1e75e60e01ae71979f437c52338e6937246baeaf", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-6.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-6.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*pcalau12i.*%pc_hi20\\\\(g\\\\)\\n\\tjirl.*pc_lo12\\\\(g\\\\)\" } } */\n /* { dg-final { scan-assembler \"test1:.*pcalau12i.*%pc_hi20\\\\(f\\\\)\\n\\tjirl.*%pc_lo12\\\\(f\\\\)\" } } */\n /* { dg-final { scan-assembler \"test2:.*pcalau12i.*%pc_hi20\\\\(l\\\\)\\n\\tjirl.*%pc_lo12\\\\(l\\\\)\" } } */\n-/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%pc_hi20\\\\(__tls_get_addr\\\\)\\n\\t.*\\n\\tjirl.*%pc_lo12\\\\(__tls_get_addr\\\\)\" } } */\n+/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%pc_hi20\\\\(__tls_get_addr\\\\)\\n\\t.*\\n\\tjirl.*%pc_lo12\\\\(__tls_get_addr\\\\)\" { target tls_native } } } */\n \n extern void g (void);\n "}, {"sha": "9e89085ca19f176fb5edad1804fce5e1397cee85", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-7.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-7.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,7 @@\n /* { dg-final { scan-assembler \"test:.*pcalau12i\\t.*%got_pc_hi20\\\\(g\\\\)\\n\\tld\\.d\\t.*%got_pc_lo12\\\\(g\\\\)\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test1:.*pcalau12i\\t.*%got_pc_hi20\\\\(f\\\\)\\n\\tld\\.d\\t.*%got_pc_lo12\\\\(f\\\\)\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test2:.*pcalau12i\\t.*%pc_hi20\\\\(l\\\\)\\n\\tjirl.*%pc_lo12\\\\(l\\\\)\" } } */\n-/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" } } */\n+/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" { target tls_native } } } */\n \n \n extern void g (void);"}, {"sha": "fde9c6e0ef49ef086fae7baf572821f1a717be2e", "filename": "gcc/testsuite/gcc.target/loongarch/func-call-medium-8.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ffunc-call-medium-8.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -3,7 +3,8 @@\n /* { dg-final { scan-assembler \"test:.*pcalau12i\\t.*%got_pc_hi20\\\\(g\\\\)\\n\\tld\\.d\\t.*%got_pc_lo12\\\\(g\\\\)\\n\\tjirl\" } } */\n /* { dg-final { scan-assembler \"test1:.*pcalau12i\\t.*%pc_hi20\\\\(f\\\\)\\n\\tjirl.*%pc_lo12\\\\(f\\\\)\" } } */\n /* { dg-final { scan-assembler \"test2:.*pcalau12i\\t.*%pc_hi20\\\\(l\\\\)\\n\\tjirl.*%pc_lo12\\\\(l\\\\)\" } } */\n-/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" } } */\n+/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" { target tls_native } } } */\n+/* { dg-final { scan-assembler \"test3:.*pcalau12i.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" { target tls_native } } } */\n \n extern void g (void);\n "}, {"sha": "9432c477e9d64fc25f3d0d0116d8e0176a4d6cf5", "filename": "gcc/testsuite/gcc.target/loongarch/tls-gd-noplt.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ftls-gd-noplt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/feeb9314002a5e304dc552781ed93f06d7f51c93/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ftls-gd-noplt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Floongarch%2Ftls-gd-noplt.c?ref=feeb9314002a5e304dc552781ed93f06d7f51c93", "patch": "@@ -1,6 +1,6 @@\n /* { dg-do compile } */\n /* { dg-options \"-O0 -fno-plt -mcmodel=normal -mexplicit-relocs\" } */\n-/* { dg-final { scan-assembler \"pcalau12i\\t.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" } } */\n+/* { dg-final { scan-assembler \"pcalau12i\\t.*%got_pc_hi20\\\\(__tls_get_addr\\\\)\\n\\tld\\.d.*%got_pc_lo12\\\\(__tls_get_addr\\\\)\" { target tls_native } } } */\n \n __attribute__ ((tls_model (\"global-dynamic\"))) __thread int a;\n "}]}