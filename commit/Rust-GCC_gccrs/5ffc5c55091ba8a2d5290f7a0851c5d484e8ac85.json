{"sha": "5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWZmYzVjNTUwOTFiYThhMmQ1MjkwZjdhMDg1MWM1ZDQ4NGU4YWM4NQ==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2018-07-17T08:06:04Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-17T08:06:04Z"}, "message": "[Ada] Fix Next_Actual when used on calls \"inlined for proof\"\n\nThe GNATprove backend needs to apply antialiasing checks to subprogram\ncalls that have been rewritten into null statements while \"inlining for\nproof\". This requires the First_Actual/Next_Actual to use the Original_Node\nand not the N_Null_Statement that rewriting leaves as a parent.\n\nOnly effective in GNATprove mode, so no frontend test provided.\n\n2018-07-17  Piotr Trojanek  <trojanek@adacore.com>\n\ngcc/ada/\n\n\t* sem_util.adb (Next_Actual): If the parent is a N_Null_Statement,\n\twhich happens for inlined calls, then fetch the next actual from the\n\toriginal AST.\n\nFrom-SVN: r262773", "tree": {"sha": "a68dd8dd6acbea5a39db1a660cf6a4183f4b0545", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a68dd8dd6acbea5a39db1a660cf6a4183f4b0545"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c70f758353d78fe242253031ab9764c419862ce2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c70f758353d78fe242253031ab9764c419862ce2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c70f758353d78fe242253031ab9764c419862ce2"}], "stats": {"total": 28, "additions": 23, "deletions": 5}, "files": [{"sha": "2be7d3be5dffb28944f0abd2abf2b5ff1b5249aa", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85", "patch": "@@ -1,3 +1,9 @@\n+2018-07-17  Piotr Trojanek  <trojanek@adacore.com>\n+\n+\t* sem_util.adb (Next_Actual): If the parent is a N_Null_Statement,\n+\twhich happens for inlined calls, then fetch the next actual from the\n+\toriginal AST.\n+\n 2018-07-17  Ed Schonberg  <schonberg@adacore.com>\n \n \t* einfo.ads: Update documentation for Scalar_Range."}, {"sha": "fa24d4a39bebcaa725887d038c8e0bdf175ba97d", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=5ffc5c55091ba8a2d5290f7a0851c5d484e8ac85", "patch": "@@ -21033,7 +21033,8 @@ package body Sem_Util is\n    -----------------\n \n    function Next_Actual (Actual_Id : Node_Id) return Node_Id is\n-      N  : Node_Id;\n+      N   : Node_Id;\n+      Par : constant Node_Id := Parent (Actual_Id);\n \n    begin\n       --  If we are pointing at a positional parameter, it is a member of a\n@@ -21053,11 +21054,22 @@ package body Sem_Util is\n             --  In case of a build-in-place call, the call will no longer be a\n             --  call; it will have been rewritten.\n \n-            if Nkind_In (Parent (Actual_Id), N_Entry_Call_Statement,\n-                                             N_Function_Call,\n-                                             N_Procedure_Call_Statement)\n+            if Nkind_In (Par, N_Entry_Call_Statement,\n+                              N_Function_Call,\n+                              N_Procedure_Call_Statement)\n             then\n-               return First_Named_Actual (Parent (Actual_Id));\n+               return First_Named_Actual (Par);\n+\n+            --  In case of a call rewritten in GNATprove mode while \"inlining\n+            --  for proof\" go to the original call.\n+\n+            elsif Nkind (Par) = N_Null_Statement then\n+               pragma Assert\n+                 (GNATprove_Mode\n+                    and then\n+                  Nkind (Original_Node (Par)) in N_Subprogram_Call);\n+\n+               return First_Named_Actual (Original_Node (Par));\n             else\n                return Empty;\n             end if;"}]}