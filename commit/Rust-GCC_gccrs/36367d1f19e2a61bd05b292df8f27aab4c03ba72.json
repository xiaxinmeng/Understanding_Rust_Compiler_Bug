{"sha": "36367d1f19e2a61bd05b292df8f27aab4c03ba72", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzYzNjdkMWYxOWUyYTYxYmQwNWIyOTJkZjhmMjdhYWI0YzAzYmE3Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-12-21T23:09:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-12-21T23:09:14Z"}, "message": "re PR c/83448 (ice in get_source_location_for_substring, at input.c:1507)\n\n\tPR c/83448\n\t* gimple-ssa-sprintf.c (maybe_warn): Don't call set_caret_index\n\tif navail is >= dir.len.\n\n\t* gcc.c-torture/compile/pr83448.c: New test.\n\t* gcc.dg/tree-ssa/builtin-snprintf-warn-4.c: New test.\n\nFrom-SVN: r255960", "tree": {"sha": "34152cd9bf0ba05802d8679649d10651b48d7274", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/34152cd9bf0ba05802d8679649d10651b48d7274"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36367d1f19e2a61bd05b292df8f27aab4c03ba72", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36367d1f19e2a61bd05b292df8f27aab4c03ba72", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36367d1f19e2a61bd05b292df8f27aab4c03ba72", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36367d1f19e2a61bd05b292df8f27aab4c03ba72/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2428b0351bc07f2c14c299022bdae4bf01722031", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2428b0351bc07f2c14c299022bdae4bf01722031", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2428b0351bc07f2c14c299022bdae4bf01722031"}], "stats": {"total": 79, "additions": 77, "deletions": 2}, "files": [{"sha": "082223d5e591d78f6d8c49d6efc2d26e5071f844", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=36367d1f19e2a61bd05b292df8f27aab4c03ba72", "patch": "@@ -1,3 +1,9 @@\n+2017-12-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/83448\n+\t* gimple-ssa-sprintf.c (maybe_warn): Don't call set_caret_index\n+\tif navail is >= dir.len.\n+\n 2017-12-21  Steve Ellcey  <sellcey@cavium.com>\n \n \t* config/aarch64/t-aarch64-linux (MULTILIB_OSDIRNAMES): Fix"}, {"sha": "14b12191d9b16699b28541cb24914fa9f8d8fea9", "filename": "gcc/gimple-ssa-sprintf.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Fgimple-ssa-sprintf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Fgimple-ssa-sprintf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-sprintf.c?ref=36367d1f19e2a61bd05b292df8f27aab4c03ba72", "patch": "@@ -2466,7 +2466,8 @@ maybe_warn (substring_loc &dirloc, location_t argloc,\n \t  /* For plain character directives (i.e., the format string itself)\n \t     but not others, point the caret at the first character that's\n \t     past the end of the destination.  */\n-\t  dirloc.set_caret_index (dirloc.get_caret_idx () + navail);\n+\t  if (navail < dir.len)\n+\t    dirloc.set_caret_index (dirloc.get_caret_idx () + navail);\n \t}\n \n       if (*dir.beg == '\\0')\n@@ -2594,7 +2595,8 @@ maybe_warn (substring_loc &dirloc, location_t argloc,\n       /* For plain character directives (i.e., the format string itself)\n \t but not others, point the caret at the first character that's\n \t past the end of the destination.  */\n-      dirloc.set_caret_index (dirloc.get_caret_idx () + navail);\n+      if (navail < dir.len)\n+\tdirloc.set_caret_index (dirloc.get_caret_idx () + navail);\n     }\n \n   if (*dir.beg == '\\0')"}, {"sha": "2f5fd089be86487aab0b94141f65cf8652c43813", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=36367d1f19e2a61bd05b292df8f27aab4c03ba72", "patch": "@@ -1,3 +1,9 @@\n+2017-12-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/83448\n+\t* gcc.c-torture/compile/pr83448.c: New test.\n+\t* gcc.dg/tree-ssa/builtin-snprintf-warn-4.c: New test.\n+\n 2017-12-21  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/atomic9.adb: New test."}, {"sha": "9f0d9aca4ebe634390a347d108f4aaa27a31130a", "filename": "gcc/testsuite/gcc.c-torture/compile/pr83448.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr83448.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr83448.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr83448.c?ref=36367d1f19e2a61bd05b292df8f27aab4c03ba72", "patch": "@@ -0,0 +1,15 @@\n+/* PR c/83448 */\n+\n+char *a;\n+int b;\n+\n+void\n+foo (void)\n+{\n+  for (;;)\n+    {\n+      if (b < 0)\n+\tfoo ();\n+      __builtin_snprintf (a, b, \"%*s\", b, \"\");\n+    }\n+}"}, {"sha": "e6abf24c672bdd21b62f6ac60a6e46633007d9b0", "filename": "gcc/testsuite/gcc.dg/tree-ssa/builtin-snprintf-warn-4.c", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fbuiltin-snprintf-warn-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36367d1f19e2a61bd05b292df8f27aab4c03ba72/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fbuiltin-snprintf-warn-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fbuiltin-snprintf-warn-4.c?ref=36367d1f19e2a61bd05b292df8f27aab4c03ba72", "patch": "@@ -0,0 +1,46 @@\n+/* PR c/83448 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wformat-truncation -fdiagnostics-show-caret\" } */\n+\n+extern int snprintf (char *, __SIZE_TYPE__, const char *, ...);\n+\n+void\n+foo (char *a, char *b, char *c, int d, int e)\n+{\n+  snprintf (a, 7, \"abc\\\\\\123 efg\");\n+  /* { dg-warning \"directive output truncated writing 9 bytes into a region of size 7\" \"\" { target *-*-* } .-1 }\n+     { dg-message \".snprintf. output 10 bytes into a destination of size 7\" \"note\" { target *-*-* } .-2 }\n+     { dg-begin-multiline-output \"\" }\n+   snprintf (a, 7, \"abc\\\\\\123 efg\");\n+                    ~~~~~~~~~~~^~\n+     { dg-end-multiline-output \"\" }\n+     { dg-begin-multiline-output \"note\" }\n+   snprintf (a, 7, \"abc\\\\\\123 efg\");\n+   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+     { dg-end-multiline-output \"\" } */\n+  d &= 63;\n+  d += 10;\n+  snprintf (b, 7, \"a%dbcdefg\", d);\n+  /* { dg-warning \"'bcdefg' directive output truncated writing 6 bytes into a region of size 4\" \"\" { target *-*-* } .-1 }\n+     { dg-message \".snprintf. output 10 bytes into a destination of size 7\" \"note\" { target *-*-* } .-2 }\n+     { dg-begin-multiline-output \"\" }\n+   snprintf (b, 7, \"a%dbcdefg\", d);\n+                       ~~~~^~\n+     { dg-end-multiline-output \"\" }\n+     { dg-begin-multiline-output \"note\" }\n+   snprintf (b, 7, \"a%dbcdefg\", d);\n+   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+     { dg-end-multiline-output \"\" } */\n+  e &= 127;\n+  snprintf (c, 7, \"a%dbcdefgh\", e);\n+  /* { dg-warning \"'bcdefgh' directive output truncated writing 7 bytes into a region of size between 3 and 5\" \"\" { target *-*-* } .-1 }\n+     { dg-message \".snprintf. output between 10 and 12 bytes into a destination of size 7\" \"note\" { target *-*-* } .-2 }\n+     { dg-begin-multiline-output \"\" }\n+   snprintf (c, 7, \"a%dbcdefgh\", e);\n+                       ~~~~~^~\n+     { dg-end-multiline-output \"\" }\n+     { dg-begin-multiline-output \"note\" }\n+   snprintf (c, 7, \"a%dbcdefgh\", e);\n+   ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+     { dg-end-multiline-output \"\" } */\n+}"}]}