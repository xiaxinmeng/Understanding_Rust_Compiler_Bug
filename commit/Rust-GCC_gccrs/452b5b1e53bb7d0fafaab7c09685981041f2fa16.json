{"sha": "452b5b1e53bb7d0fafaab7c09685981041f2fa16", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDUyYjViMWU1M2JiN2QwZmFmYWFiN2MwOTY4NTk4MTA0MWYyZmExNg==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2005-11-19T17:24:33Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2005-11-19T17:24:33Z"}, "message": "re PR ada/23717 ([Ada] Wrong ICE diagnostic formatting)\n\n2005-11-19  Richard Guenther  <rguenther@suse.de>\n\tRoger Sayle  <roger@eyesopen.com>\n\n        PR ada/23717\n\t* misc.c (internal_error_function): Don't use vsprintf to format\n\tthe error message text, instead use pp_format_text and the new\n\tpretty printer APIs.  This allows handling of %qs, %w, etc.\n\nCo-Authored-By: Roger Sayle <roger@eyesopen.com>\n\nFrom-SVN: r107223", "tree": {"sha": "1df2987ac2d6ce55215925a440abb6e64d6806f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1df2987ac2d6ce55215925a440abb6e64d6806f4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/452b5b1e53bb7d0fafaab7c09685981041f2fa16", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/452b5b1e53bb7d0fafaab7c09685981041f2fa16", "html_url": "https://github.com/Rust-GCC/gccrs/commit/452b5b1e53bb7d0fafaab7c09685981041f2fa16", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/452b5b1e53bb7d0fafaab7c09685981041f2fa16/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "756191b7c51263603b91b45f60d5d6acf7250711", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/756191b7c51263603b91b45f60d5d6acf7250711", "html_url": "https://github.com/Rust-GCC/gccrs/commit/756191b7c51263603b91b45f60d5d6acf7250711"}], "stats": {"total": 29, "additions": 25, "deletions": 4}, "files": [{"sha": "60ed170784f1de2b11a92a079eef439011ba1ada", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/452b5b1e53bb7d0fafaab7c09685981041f2fa16/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/452b5b1e53bb7d0fafaab7c09685981041f2fa16/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=452b5b1e53bb7d0fafaab7c09685981041f2fa16", "patch": "@@ -1,3 +1,11 @@\n+2005-11-19  Richard Guenther  <rguenther@suse.de>\n+\tRoger Sayle  <roger@eyesopen.com>\n+\n+\tPR ada/23717\n+\t* misc.c (internal_error_function): Don't use vsprintf to format\n+\tthe error message text, instead use pp_format_text and the new\n+\tpretty printer APIs.  This allows handling of %qs, %w, etc.\n+\n 2005-11-18  Laurent GUERBY  <laurent@guerby.net>\n \n         PR ada/24857"}, {"sha": "0971808712c887428928c47f538688ef2444362d", "filename": "gcc/ada/misc.c", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/452b5b1e53bb7d0fafaab7c09685981041f2fa16/gcc%2Fada%2Fmisc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/452b5b1e53bb7d0fafaab7c09685981041f2fa16/gcc%2Fada%2Fmisc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmisc.c?ref=452b5b1e53bb7d0fafaab7c09685981041f2fa16", "patch": "@@ -364,12 +364,23 @@ gnat_post_options (const char **pfilename ATTRIBUTE_UNUSED)\n static void\n internal_error_function (const char *msgid, va_list *ap)\n {\n-  char buffer[1000];\t\t/* Assume this is big enough.  */\n+  text_info tinfo;\n+  char *buffer;\n   char *p;\n   String_Template temp;\n   Fat_Pointer fp;\n \n-  vsprintf (buffer, msgid, *ap);\n+  /* Reset the pretty-printer.  */\n+  pp_clear_output_area (global_dc->printer);\n+\n+  /* Format the message into the pretty-printer.  */\n+  tinfo.format_spec = msgid;\n+  tinfo.args_ptr = ap;\n+  tinfo.err_no = errno;\n+  pp_format_verbatim (global_dc->printer, &tinfo);\n+\n+  /* Extract a (writable) pointer to the formatted text.  */\n+  buffer = (char*) pp_formatted_text (global_dc->printer);\n \n   /* Go up to the first newline.  */\n   for (p = buffer; *p; p++)\n@@ -379,8 +390,10 @@ internal_error_function (const char *msgid, va_list *ap)\n \tbreak;\n       }\n \n-  temp.Low_Bound = 1, temp.High_Bound = strlen (buffer);\n-  fp.Array = buffer, fp.Bounds = &temp;\n+  temp.Low_Bound = 1;\n+  temp.High_Bound = p - buffer;\n+  fp.Bounds = &temp;\n+  fp.Array = buffer;\n \n   Current_Error_Node = error_gnat_node;\n   Compiler_Abort (fp, -1);"}]}