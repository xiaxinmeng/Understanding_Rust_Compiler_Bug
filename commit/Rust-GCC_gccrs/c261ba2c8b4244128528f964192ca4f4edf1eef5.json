{"sha": "c261ba2c8b4244128528f964192ca4f4edf1eef5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzI2MWJhMmM4YjQyNDQxMjg1MjhmOTY0MTkyY2E0ZjRlZGYxZWVmNQ==", "commit": {"author": {"name": "Marc Glisse", "email": "marc.glisse@inria.fr", "date": "2017-11-16T23:51:20Z"}, "committer": {"name": "Marc Glisse", "email": "glisse@gcc.gnu.org", "date": "2017-11-16T23:51:20Z"}, "message": "Tweak vector::_M_realloc_insert for code size\n\n2017-11-17  Marc Glisse  <marc.glisse@inria.fr>\n\n\t* include/bits/vector.tcc (vector::_M_realloc_insert): Cache old\n\tvalues before the allocation.\n\nFrom-SVN: r254849", "tree": {"sha": "1b4cc99a3d7117b0c5547e6c1ed8ca8382d586e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b4cc99a3d7117b0c5547e6c1ed8ca8382d586e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c261ba2c8b4244128528f964192ca4f4edf1eef5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c261ba2c8b4244128528f964192ca4f4edf1eef5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c261ba2c8b4244128528f964192ca4f4edf1eef5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c261ba2c8b4244128528f964192ca4f4edf1eef5/comments", "author": {"login": "mglisse", "id": 10097863, "node_id": "MDQ6VXNlcjEwMDk3ODYz", "avatar_url": "https://avatars.githubusercontent.com/u/10097863?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mglisse", "html_url": "https://github.com/mglisse", "followers_url": "https://api.github.com/users/mglisse/followers", "following_url": "https://api.github.com/users/mglisse/following{/other_user}", "gists_url": "https://api.github.com/users/mglisse/gists{/gist_id}", "starred_url": "https://api.github.com/users/mglisse/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mglisse/subscriptions", "organizations_url": "https://api.github.com/users/mglisse/orgs", "repos_url": "https://api.github.com/users/mglisse/repos", "events_url": "https://api.github.com/users/mglisse/events{/privacy}", "received_events_url": "https://api.github.com/users/mglisse/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b1e35f49e89151ac2b4263e151a2a65d3b45a479", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1e35f49e89151ac2b4263e151a2a65d3b45a479", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1e35f49e89151ac2b4263e151a2a65d3b45a479"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "3c9f3e7569af5c109c00a41322fa82efed770799", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c261ba2c8b4244128528f964192ca4f4edf1eef5/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c261ba2c8b4244128528f964192ca4f4edf1eef5/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=c261ba2c8b4244128528f964192ca4f4edf1eef5", "patch": "@@ -1,3 +1,8 @@\n+2017-11-17  Marc Glisse  <marc.glisse@inria.fr>\n+\n+\t* include/bits/vector.tcc (vector::_M_realloc_insert): Cache old\n+\tvalues before the allocation.\n+\n 2017-11-16  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* include/std/future (shared_future): Add noexcept to copy constructor"}, {"sha": "eadce3c75da8959c558d9a757e0c12d380e8caac", "filename": "libstdc++-v3/include/bits/vector.tcc", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c261ba2c8b4244128528f964192ca4f4edf1eef5/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvector.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c261ba2c8b4244128528f964192ca4f4edf1eef5/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvector.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvector.tcc?ref=c261ba2c8b4244128528f964192ca4f4edf1eef5", "patch": "@@ -421,6 +421,8 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n     {\n       const size_type __len =\n \t_M_check_len(size_type(1), \"vector::_M_realloc_insert\");\n+      pointer __old_start = this->_M_impl._M_start;\n+      pointer __old_finish = this->_M_impl._M_finish;\n       const size_type __elems_before = __position - begin();\n       pointer __new_start(this->_M_allocate(__len));\n       pointer __new_finish(__new_start);\n@@ -442,14 +444,14 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \n \t  __new_finish\n \t    = std::__uninitialized_move_if_noexcept_a\n-\t    (this->_M_impl._M_start, __position.base(),\n+\t    (__old_start, __position.base(),\n \t     __new_start, _M_get_Tp_allocator());\n \n \t  ++__new_finish;\n \n \t  __new_finish\n \t    = std::__uninitialized_move_if_noexcept_a\n-\t    (__position.base(), this->_M_impl._M_finish,\n+\t    (__position.base(), __old_finish,\n \t     __new_finish, _M_get_Tp_allocator());\n \t}\n       __catch(...)\n@@ -463,10 +465,9 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \t  __throw_exception_again;\n \t}\n       _GLIBCXX_ASAN_ANNOTATE_REINIT;\n-      std::_Destroy(this->_M_impl._M_start, this->_M_impl._M_finish,\n-\t\t    _M_get_Tp_allocator());\n-      _M_deallocate(this->_M_impl._M_start,\n-\t\t    this->_M_impl._M_end_of_storage - this->_M_impl._M_start);\n+      std::_Destroy(__old_start, __old_finish, _M_get_Tp_allocator());\n+      _M_deallocate(__old_start,\n+\t\t    this->_M_impl._M_end_of_storage - __old_start);\n       this->_M_impl._M_start = __new_start;\n       this->_M_impl._M_finish = __new_finish;\n       this->_M_impl._M_end_of_storage = __new_start + __len;"}]}