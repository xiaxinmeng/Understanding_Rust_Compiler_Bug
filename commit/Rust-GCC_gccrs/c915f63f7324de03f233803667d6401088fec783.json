{"sha": "c915f63f7324de03f233803667d6401088fec783", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzkxNWY2M2Y3MzI0ZGUwM2YyMzM4MDM2NjdkNjQwMTA4OGZlYzc4Mw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-12-13T22:25:30Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-12-13T22:25:30Z"}, "message": "mksysinfo.sh: Ensure that IPV6 constants and types are defined.\n\nFrom-SVN: r182314", "tree": {"sha": "c0130cd10550a0fc877a4c24987f6877ba97484e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c0130cd10550a0fc877a4c24987f6877ba97484e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c915f63f7324de03f233803667d6401088fec783", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c915f63f7324de03f233803667d6401088fec783", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c915f63f7324de03f233803667d6401088fec783", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c915f63f7324de03f233803667d6401088fec783/comments", "author": null, "committer": null, "parents": [{"sha": "de05aad6833ce65a439fbeb2994df169112cba5e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de05aad6833ce65a439fbeb2994df169112cba5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de05aad6833ce65a439fbeb2994df169112cba5e"}], "stats": {"total": 24, "additions": 17, "deletions": 7}, "files": [{"sha": "a5e8144cd77e964e600ba978ebdabebb26d7c366", "filename": "libgo/mksysinfo.sh", "status": "modified", "additions": 17, "deletions": 7, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c915f63f7324de03f233803667d6401088fec783/libgo%2Fmksysinfo.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c915f63f7324de03f233803667d6401088fec783/libgo%2Fmksysinfo.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fmksysinfo.sh?ref=c915f63f7324de03f233803667d6401088fec783", "patch": "@@ -183,10 +183,12 @@ grep '^const _SOMAXCONN' gen-sysinfo.go |\n grep '^const _SHUT_' gen-sysinfo.go |\n   sed -e 's/^\\(const \\)_\\(SHUT[^= ]*\\)\\(.*\\)$/\\1\\2 = _\\2/' >> ${OUT}\n \n-# The net package requires a definition for IPV6ONLY.\n-if ! grep '^const IPV6_V6ONLY ' ${OUT} >/dev/null 2>&1; then\n-  echo \"const IPV6_V6ONLY = 0\" >> ${OUT}\n-fi\n+# The net package requires some const definitions.\n+for m in IPV6_V6ONLY IPPROTO_IPV6 IPV6_JOIN_GROUP IPV6_LEAVE_GROUP; do\n+  if ! grep \"^const $m \" ${OUT} >/dev/null 2>&1; then\n+    echo \"const $m = 0\" >> ${OUT}\n+  fi\n+done\n \n # pathconf constants.\n grep '^const __PC' gen-sysinfo.go |\n@@ -474,11 +476,14 @@ grep '^type _ip_mreq ' gen-sysinfo.go | \\\n       -e 's/_in_addr/[4]byte/g' \\\n     >> ${OUT}\n \n-# The size of the ip_mreq struct.\n-if grep 'type IPMreq ' ${OUT} > /dev/null 2>&1; then\n-  echo 'var SizeofIPMreq = int(unsafe.Sizeof(IPMreq{}))' >> ${OUT}\n+# We need IPMreq to compile the net package.\n+if ! grep 'type IPMreq ' ${OUT} >/dev/null 2>&1; then\n+  echo 'type IPMreq struct { Multiaddr [4]byte; Interface [4]byte; }' >> ${OUT}\n fi\n \n+# The size of the ip_mreq struct.\n+echo 'var SizeofIPMreq = int(unsafe.Sizeof(IPMreq{}))' >> ${OUT}\n+\n # The ipv6_mreq struct.\n grep '^type _ipv6_mreq ' gen-sysinfo.go | \\\n     sed -e 's/_ipv6_mreq/IPv6Mreq/' \\\n@@ -487,6 +492,11 @@ grep '^type _ipv6_mreq ' gen-sysinfo.go | \\\n       -e 's/_in6_addr/[16]byte/' \\\n     >> ${OUT}\n \n+# We need IPv6Mreq to compile the net package.\n+if ! grep 'type IPv6Mreq ' ${OUT} >/dev/null 2>&1; then\n+  echo 'type IPv6Mreq struct { Multiaddr [16]byte; Interface uint32; }' >> ${OUT}\n+fi\n+\n # Try to guess the type to use for fd_set.\n fd_set=`grep '^type _fd_set ' gen-sysinfo.go || true`\n fds_bits_type=\"_C_long\""}]}