{"sha": "2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "node_id": "C_kwDOANBUbNoAKDJjYmU1ZGQ1NGYxNWU4OGUwYjQyNTY3MzE5YWE5YzhlN2JhZDc5NDY", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-01-31T19:08:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-01-31T19:08:18Z"}, "message": "rs6000: Fix up build of non-glibc/aix/darwin powerpc* targets [PR104298]\n\nAs reported by Martin, while David has added OPTION_GLIBC define to aix\nand Iain to darwin, all the other non-linux targets now fail because\nrs6000.md macro isn't defined.\n\nOne possibility is to define this macro in option-defaults.h which on rs6000\ntargets is included last, then we don't need to define it in aix/darwin\nheaders and for targets using linux.h or linux64.h it will DTRT too.\n\nThe other option is the first 2 hunks + changing the 3\n   if (!OPTION_GLIBC)\n     FAIL;\ncases in rs6000.md to e.g.\n #ifdef OPTION_GLIBC\n   if (!OPTION_GLIBC)\n #endif\n     FAIL;\nor to:\n #ifdef OPTION_GLIBC\n   if (!OPTION_GLIBC)\n #else\n   if (true)\n #endif\n     FAIL;\n(the latter case if Richi wants to push the -Wunreachable-code changes for\nGCC 13).\n\n2022-01-31  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/104298\n\t* config/rs6000/aix.h (OPTION_GLIBC): Remove.\n\t* config/rs6000/darwin.h (OPTION_GLIBC): Likewise.\n\t* config/rs6000/option-defaults.h (OPTION_GLIBC): Define to 0\n\tif not already defined.", "tree": {"sha": "b217e99a6c0f40be6b4c014ea522a082fcd96656", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b217e99a6c0f40be6b4c014ea522a082fcd96656"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "48d3191e7bd6245bd2df625731f1ad9207a26655", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48d3191e7bd6245bd2df625731f1ad9207a26655", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48d3191e7bd6245bd2df625731f1ad9207a26655"}], "stats": {"total": 9, "additions": 6, "deletions": 3}, "files": [{"sha": "ad3238bf09ae7c0be2ffdfe9f0a17da388f26130", "filename": "gcc/config/rs6000/aix.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/gcc%2Fconfig%2Frs6000%2Faix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/gcc%2Fconfig%2Frs6000%2Faix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Faix.h?ref=2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "patch": "@@ -23,7 +23,6 @@\n #define DEFAULT_ABI ABI_AIX\n #undef  TARGET_AIX\n #define TARGET_AIX 1\n-#define OPTION_GLIBC 0\n \n /* Linux64.h wants to redefine TARGET_AIX based on -m64, but it can't be used\n    in the #if conditional in options-default.h, so provide another macro.  */"}, {"sha": "b5cef42610f7645762ad8cd2866e0b727b7a97c4", "filename": "gcc/config/rs6000/darwin.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/gcc%2Fconfig%2Frs6000%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin.h?ref=2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "patch": "@@ -34,8 +34,6 @@\n #endif\n #endif\n \n-#define OPTION_GLIBC 0\n-\n /* The object file format is Mach-O.  */\n \n #define TARGET_OBJECT_FORMAT OBJECT_MACHO"}, {"sha": "2123bfdd53953727af0769686f903a99b58e9487", "filename": "gcc/config/rs6000/option-defaults.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/gcc%2Fconfig%2Frs6000%2Foption-defaults.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2cbe5dd54f15e88e0b42567319aa9c8e7bad7946/gcc%2Fconfig%2Frs6000%2Foption-defaults.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Foption-defaults.h?ref=2cbe5dd54f15e88e0b42567319aa9c8e7bad7946", "patch": "@@ -62,3 +62,9 @@\n   {\"cpu_32\", \"%{\" OPT_ARCH32 \":%{!mcpu=*:-mcpu=%(VALUE)}}\" }, \\\n   {\"cpu_64\", \"%{\" OPT_ARCH64 \":%{!mcpu=*:-mcpu=%(VALUE)}}\" }, \\\n   {\"float\", \"%{!msoft-float:%{!mhard-float:-m%(VALUE)-float}}\" }\n+\n+/* rs6000.md uses OPTION_GLIBC unconditionally, while it is defined only in\n+   linux{,64}.h.  Define fallback for other targets here.  */\n+#ifndef OPTION_GLIBC\n+#define OPTION_GLIBC 0\n+#endif"}]}