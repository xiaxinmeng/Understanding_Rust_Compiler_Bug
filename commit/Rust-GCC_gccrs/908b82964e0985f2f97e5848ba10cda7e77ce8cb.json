{"sha": "908b82964e0985f2f97e5848ba10cda7e77ce8cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTA4YjgyOTY0ZTA5ODVmMmY5N2U1ODQ4YmExMGNkYTdlNzdjZThjYg==", "commit": {"author": {"name": "Fritz Reese", "email": "fritzoreese@gmail.com", "date": "2016-10-05T20:24:48Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2016-10-05T20:24:48Z"}, "message": "Fix ICE due to comparison between UNION components.\n\n2016-10-05  Fritz Reese  <fritzoreese@gmail.com>\n\nFix ICE due to comparison between UNION components.\n\n\tgcc/fortran/\n\t* interface.c (gfc_compare_types): Don't compare BT_UNION components\n\tuntil we know they're both UNIONs.\n\t* interface.c (gfc_compare_union_types): Guard against empty\n\tcomponents.\n\n\tgcc/testsuite/gfortran.dg/\n\t* dec_union_9.f90: New testcase.\n\t* dec_union_10.f90: New testcase.\n\nFrom-SVN: r240810", "tree": {"sha": "cfed710cce62e264fecedd6ec5bb21f948f6c83a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cfed710cce62e264fecedd6ec5bb21f948f6c83a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/908b82964e0985f2f97e5848ba10cda7e77ce8cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/908b82964e0985f2f97e5848ba10cda7e77ce8cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/908b82964e0985f2f97e5848ba10cda7e77ce8cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/908b82964e0985f2f97e5848ba10cda7e77ce8cb/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3bd034d0181e3f8ed26baac2e69c6b3bba2eb05c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bd034d0181e3f8ed26baac2e69c6b3bba2eb05c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3bd034d0181e3f8ed26baac2e69c6b3bba2eb05c"}], "stats": {"total": 82, "additions": 77, "deletions": 5}, "files": [{"sha": "f7156a1a9a0678c8d9e03aed20603809dfa3f461", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=908b82964e0985f2f97e5848ba10cda7e77ce8cb", "patch": "@@ -1,3 +1,10 @@\n+2016-10-05  Fritz Reese  <fritzoreese@gmail.com>\n+\n+\t* interface.c (gfc_compare_types): Don't compare BT_UNION components\n+\tuntil we know they're both UNIONs.\n+\t* interface.c (gfc_compare_union_types): Guard against empty\n+\tcomponents.\n+\n 2016-10-05  Louis Krupp  <louis.krupp@zoho.com>\n \n \tPR fortran/67524"}, {"sha": "e7f187857835fda7e4884567fa6d72abc00b7807", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=908b82964e0985f2f97e5848ba10cda7e77ce8cb", "patch": "@@ -531,6 +531,12 @@ gfc_compare_union_types (gfc_symbol *un1, gfc_symbol *un2)\n   if (un1->attr.flavor != FL_UNION || un2->attr.flavor != FL_UNION)\n     return 0;\n \n+  if (un1->attr.zero_comp != un2->attr.zero_comp)\n+    return 0;\n+\n+  if (un1->attr.zero_comp)\n+    return 1;\n+\n   map1 = un1->components;\n   map2 = un2->components;\n \n@@ -694,13 +700,14 @@ gfc_compare_types (gfc_typespec *ts1, gfc_typespec *ts2)\n       && (ts1->u.derived->attr.sequence || ts1->u.derived->attr.is_bind_c))\n     return 1;\n \n-  if (ts1->type == BT_UNION && ts2->type == BT_UNION)\n-    return gfc_compare_union_types (ts1->u.derived, ts2->u.derived);\n-\n   if (ts1->type != ts2->type\n-      && ((!gfc_bt_struct (ts1->type) && ts1->type != BT_CLASS)\n-\t  || (!gfc_bt_struct (ts2->type) && ts2->type != BT_CLASS)))\n+      && ((ts1->type != BT_DERIVED && ts1->type != BT_CLASS)\n+\t  || (ts2->type != BT_DERIVED && ts2->type != BT_CLASS)))\n     return 0;\n+\n+  if (ts1->type == BT_UNION)\n+    return gfc_compare_union_types (ts1->u.derived, ts2->u.derived);\n+\n   if (ts1->type != BT_DERIVED && ts1->type != BT_CLASS)\n     return (ts1->kind == ts2->kind);\n "}, {"sha": "3d96a06609d38870affe6e89ed19223f29883b22", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=908b82964e0985f2f97e5848ba10cda7e77ce8cb", "patch": "@@ -1,3 +1,8 @@\n+2016-10-05  Fritz Reese  <fritzoreese@gmail.com>\n+\n+\t* gfortran.dg/dec_union_9.f90: New testcase.\n+\t* gfortran.dg/dec_union_10.f90: New testcase.\n+\n 2016-10-05  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR sanitizer/66343"}, {"sha": "8c91aedb4972ddbe1d74d10495c810d09b199ef3", "filename": "gcc/testsuite/gfortran.dg/dec_union_10.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_10.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_10.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_10.f90?ref=908b82964e0985f2f97e5848ba10cda7e77ce8cb", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do compile }\n+! { dg-options \"-fdec-structure\" }\n+!\n+! Check for regression where gfc_compare_union_types wasn't properly guarded\n+! against empty unions.\n+!\n+\n+subroutine sub1(r)\n+  structure /s/\n+    union\n+    end union\n+  end structure\n+  record /s/ r\n+end subroutine\n+\n+subroutine sub2()\n+  structure /s/\n+    union\n+    end union\n+  end structure\n+  record /s/ r\n+  call sub1(r)\n+end subroutine\n+\n+call sub2()\n+\n+end"}, {"sha": "2cb38fca0fa1ee3e46bf36ce867295e193ec2e1f", "filename": "gcc/testsuite/gfortran.dg/dec_union_9.f90", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_9.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/908b82964e0985f2f97e5848ba10cda7e77ce8cb/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_9.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_9.f90?ref=908b82964e0985f2f97e5848ba10cda7e77ce8cb", "patch": "@@ -0,0 +1,26 @@\n+! { dg-do compile }\n+! { dg-options \"-fdec-structure\" }\n+!\n+! Test a regression where union components could compare equal to structure/map\n+! components, causing an ICE in gfc_conv_component_ref.\n+!\n+\n+implicit none\n+\n+structure /s1/\n+  integer(4) i\n+end structure\n+\n+structure /s2/\n+  union\n+    map\n+      record /s1/ r\n+    end map\n+  end union\n+end structure\n+\n+record /s2/ x\n+\n+x.r.i = 0\n+\n+end"}]}