{"sha": "5f7cdea34e118776d0ccd2ff3dda0f5acab18a94", "node_id": "C_kwDOANBUbNoAKDVmN2NkZWEzNGUxMTg3NzZkMGNjZDJmZjNkZGEwZjVhY2FiMThhOTQ", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-12-07T22:06:41Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-12-08T18:34:57Z"}, "message": "Fortran: dimensions of an array have to be non-negative\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/103610\n\t* array.c (spec_dimen_size): Fix simplification of SHAPE:\n\tdimensions must be non-negative.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/103610\n\t* gfortran.dg/shape_11.f90: New test.", "tree": {"sha": "c1c4e20bb830a588f1acac99944635df91bb5014", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1c4e20bb830a588f1acac99944635df91bb5014"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "df704591a2cad3526456aa77be403d21c822724d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df704591a2cad3526456aa77be403d21c822724d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df704591a2cad3526456aa77be403d21c822724d"}], "stats": {"total": 22, "additions": 20, "deletions": 2}, "files": [{"sha": "e4891dfef775e346ea8d7afd655596a6859631a3", "filename": "gcc/fortran/array.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94/gcc%2Ffortran%2Farray.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94/gcc%2Ffortran%2Farray.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Farray.c?ref=5f7cdea34e118776d0ccd2ff3dda0f5acab18a94", "patch": "@@ -2296,8 +2296,7 @@ gfc_copy_iterator (gfc_iterator *src)\n /********* Subroutines for determining the size of an array *********/\n \n /* These are needed just to accommodate RESHAPE().  There are no\n-   diagnostics here, we just return a negative number if something\n-   goes wrong.  */\n+   diagnostics here, we just return false if something goes wrong.  */\n \n \n /* Get the size of single dimension of an array specification.  The\n@@ -2330,6 +2329,9 @@ spec_dimen_size (gfc_array_spec *as, int dimen, mpz_t *result)\n \n   mpz_add_ui (*result, *result, 1);\n \n+  if (mpz_cmp_si (*result, 0) < 0)\n+    mpz_set_si (*result, 0);\n+\n   return true;\n }\n "}, {"sha": "127d221e7107b4d739b19b635e43558347b9b601", "filename": "gcc/testsuite/gfortran.dg/shape_11.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94/gcc%2Ftestsuite%2Fgfortran.dg%2Fshape_11.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f7cdea34e118776d0ccd2ff3dda0f5acab18a94/gcc%2Ftestsuite%2Fgfortran.dg%2Fshape_11.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fshape_11.f90?ref=5f7cdea34e118776d0ccd2ff3dda0f5acab18a94", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do compile }\n+! { dg-options \"-fdump-tree-original\" }\n+! PR fortran/103610 - ICE while simplifying SHAPE\n+! Contributed by G.Steinmetz\n+\n+program p\n+  integer, parameter :: a(-1) = 1\n+  integer, parameter :: b(1)  = maskl(shape(a))\n+  integer, parameter :: c(1)  = shape(a)\n+  integer, parameter :: d(1)  = maskr(shape(a))\n+  if (b(1) /= 0) stop 1\n+  if (c(1) /= 0) stop 2\n+  if (d(1) /= 0) stop 3\n+end\n+\n+! { dg-final { scan-tree-dump-not \"_gfortran_stop_numeric\" \"original\" } }"}]}