{"sha": "53836c887a05db23ff3b9fc06f64e0ba78810ece", "node_id": "C_kwDOANBUbNoAKDUzODM2Yzg4N2EwNWRiMjNmZjNiOWZjMDZmNjRlMGJhNzg4MTBlY2U", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-01-19T08:28:25Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-01-19T08:28:25Z"}, "message": "gimple-ssa-warn-access: Fix up asan_test.C -Wdangling-pointer regression [PR104103]\n\nAs reported in the PR or as I've seen since the weekend, asan_test.C fails\nbecause of many warnings like:\ngcc/testsuite/g++.dg/asan/asan_test.cc:1157:10: error: using a dangling pointer to an unnamed temporary [-Werror=dangling-pointer=]\ngcc/testsuite/g++.dg/asan/asan_test.cc:1157:10: error: using a dangling pointer to an unnamed temporary [-Werror=dangling-pointer=]\ngcc/testsuite/g++.dg/asan/asan_test.cc:1162:27: error: using a dangling pointer to an unnamed temporary [-Werror=dangling-pointer=]\n...\n(lots of them).\nThere are no dangling pointers though, the warning pass sees:\n  some_automatic_var ={v} {CLOBBER};\n  .ASAN_MARK (POISON, &some_automatic_var, 8);\nand warns on that (both on user vars and on e.g. TARGET_EXPR temporaries).\nThere is nothing wrong on that, .ASAN_MARK is compiler instrumentation,\nwhich doesn't even touch the variable in any way nor make it escaped.\nWhat it instead does is change bytes in the shadow memory corresponding\nto the variable to reflect that the variable is out of scope and make\nsure that access to it would be diagnosed at runtime.\nSo, for all purposes of the -Wdangling-pointer and -Wuse-after-free\nwarnings, we should ignore this internal call.\n\n2022-01-19  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR middle-end/104103\n\t* gimple-ssa-warn-access.cc (pass_waccess::check_call): Don't check\n\t.ASAN_MARK calls.", "tree": {"sha": "796c3f091ff9a2ab19f69038c2cb7e9d09ec5edb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/796c3f091ff9a2ab19f69038c2cb7e9d09ec5edb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/53836c887a05db23ff3b9fc06f64e0ba78810ece", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53836c887a05db23ff3b9fc06f64e0ba78810ece", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53836c887a05db23ff3b9fc06f64e0ba78810ece", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53836c887a05db23ff3b9fc06f64e0ba78810ece/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b834435c8fa4cb9424787fe3044a49fef7992de8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b834435c8fa4cb9424787fe3044a49fef7992de8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b834435c8fa4cb9424787fe3044a49fef7992de8"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "c36cd5d45d487094524d6c2b29f10d5d888f1029", "filename": "gcc/gimple-ssa-warn-access.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/53836c887a05db23ff3b9fc06f64e0ba78810ece/gcc%2Fgimple-ssa-warn-access.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/53836c887a05db23ff3b9fc06f64e0ba78810ece/gcc%2Fgimple-ssa-warn-access.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-warn-access.cc?ref=53836c887a05db23ff3b9fc06f64e0ba78810ece", "patch": "@@ -4234,6 +4234,11 @@ pass_waccess::check_call (gcall *stmt)\n   if (gimple_call_builtin_p (stmt, BUILT_IN_NORMAL))\n     check_builtin (stmt);\n \n+  /* .ASAN_MARK doesn't access any vars, only modifies shadow memory.  */\n+  if (gimple_call_internal_p (stmt)\n+      && gimple_call_internal_fn (stmt) == IFN_ASAN_MARK)\n+    return;\n+\n   if (!m_early_checks_p)\n     if (tree callee = gimple_call_fndecl (stmt))\n       {"}]}