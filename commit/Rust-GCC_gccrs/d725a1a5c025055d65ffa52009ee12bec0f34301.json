{"sha": "d725a1a5c025055d65ffa52009ee12bec0f34301", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDcyNWExYTVjMDI1MDU1ZDY1ZmZhNTIwMDllZTEyYmVjMGYzNDMwMQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-06-11T14:33:28Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-06-11T14:33:28Z"}, "message": "df-problems.c (df_live_scratch): Convert to bitmap_head.\n\n\t* df-problems.c (df_live_scratch): Convert to bitmap_head.\n\t(df_live_alloc): Initialize df_live_scratch when initializing\n\tproblem_data.\n\t(df_live_transfer_function): Update uses of df_live_scratch.\n\t(df_live_free): Free problem_data; clear df_live_scratch before\n\treleasing the obstack.\n\t(df_md_free): Free problem data.\n\nFrom-SVN: r160612", "tree": {"sha": "dd94681192eade6721a1a0efec509ae9594d65ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dd94681192eade6721a1a0efec509ae9594d65ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d725a1a5c025055d65ffa52009ee12bec0f34301", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d725a1a5c025055d65ffa52009ee12bec0f34301", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d725a1a5c025055d65ffa52009ee12bec0f34301", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d725a1a5c025055d65ffa52009ee12bec0f34301/comments", "author": null, "committer": null, "parents": [{"sha": "7ea6b6cf97363a0f4dfb1a72a7cda31c59350bbc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ea6b6cf97363a0f4dfb1a72a7cda31c59350bbc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ea6b6cf97363a0f4dfb1a72a7cda31c59350bbc"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "d564d3639f47262dbf4ed847699bc606c6287b62", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d725a1a5c025055d65ffa52009ee12bec0f34301/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d725a1a5c025055d65ffa52009ee12bec0f34301/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d725a1a5c025055d65ffa52009ee12bec0f34301", "patch": "@@ -1,3 +1,13 @@\n+2010-06-11  Jan Hubicka  <jh@suse.cz>\n+\n+\t* df-problems.c (df_live_scratch): Convert to bitmap_head.\n+\t(df_live_alloc): Initialize df_live_scratch when initializing\n+\tproblem_data.\n+\t(df_live_transfer_function): Update uses of df_live_scratch.\n+\t(df_live_free): Free problem_data; clear df_live_scratch before\n+\treleasing the obstack.\n+\t(df_md_free): Free problem data.\n+\n 2010-06-11  Jan Hubicka  <jh@suse.cz>\n \n \t* doc/invoke.texi (Wsuggest-attribute): Document."}, {"sha": "1a28e9de434bcc7e6ff314c50ac0f3d62360b69e", "filename": "gcc/df-problems.c", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d725a1a5c025055d65ffa52009ee12bec0f34301/gcc%2Fdf-problems.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d725a1a5c025055d65ffa52009ee12bec0f34301/gcc%2Fdf-problems.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-problems.c?ref=d725a1a5c025055d65ffa52009ee12bec0f34301", "patch": "@@ -1368,7 +1368,7 @@ struct df_live_problem_data\n /* Scratch var used by transfer functions.  This is used to implement\n    an optimization to reduce the amount of space used to compute the\n    combined lr and live analysis.  */\n-static bitmap df_live_scratch;\n+static bitmap_head df_live_scratch;\n \n /* Set basic block info.  */\n \n@@ -1423,9 +1423,8 @@ df_live_alloc (bitmap all_blocks ATTRIBUTE_UNUSED)\n       problem_data->out = NULL;\n       problem_data->in = NULL;\n       bitmap_obstack_initialize (&problem_data->live_bitmaps);\n+      bitmap_initialize (&df_live_scratch, &problem_data->live_bitmaps);\n     }\n-  if (!df_live_scratch)\n-    df_live_scratch = BITMAP_ALLOC (&problem_data->live_bitmaps);\n \n   df_grow_bb_info (df_live);\n \n@@ -1595,12 +1594,12 @@ df_live_transfer_function (int bb_index)\n   /* We need to use a scratch set here so that the value returned from this\n      function invocation properly reflects whether the sets changed in a\n      significant way; i.e. not just because the lr set was anded in.  */\n-  bitmap_and (df_live_scratch, gen, &bb_lr_info->out);\n+  bitmap_and (&df_live_scratch, gen, &bb_lr_info->out);\n   /* No register may reach a location where it is not used.  Thus\n      we trim the rr result to the places where it is used.  */\n   bitmap_and_into (in, &bb_lr_info->in);\n \n-  return bitmap_ior_and_compl (out, df_live_scratch, in, kill);\n+  return bitmap_ior_and_compl (out, &df_live_scratch, in, kill);\n }\n \n \n@@ -1643,10 +1642,10 @@ df_live_free (void)\n       free_alloc_pool (df_live->block_pool);\n       df_live->block_info_size = 0;\n       free (df_live->block_info);\n+      bitmap_clear (&df_live_scratch);\n       bitmap_obstack_release (&problem_data->live_bitmaps);\n-\n-      if (df_live_scratch)\n-\tBITMAP_FREE (df_live_scratch);\n+      free (problem_data);\n+      df_live->problem_data = NULL;\n     }\n   BITMAP_FREE (df_live->out_of_date_transfer_functions);\n   free (df_live);\n@@ -4545,6 +4544,8 @@ df_md_free (void)\n \n   bitmap_obstack_release (&problem_data->md_bitmaps);\n   free_alloc_pool (df_md->block_pool);\n+  free (problem_data);\n+  df_md->problem_data = NULL;\n \n   df_md->block_info_size = 0;\n   free (df_md->block_info);"}]}