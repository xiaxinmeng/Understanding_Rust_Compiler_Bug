{"sha": "2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmYyYjhlNDA1NGY1Yjg0NTk0YTliMTEzZTQwOWU3MzQ4MGYyZWJkZg==", "commit": {"author": {"name": "Maya Rashish", "email": "coypu@sdf.org", "date": "2019-02-14T21:25:39Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gcc.gnu.org", "date": "2019-02-14T21:25:39Z"}, "message": "Add netbsd support for D compiler and runtime\n\nMerges upstream druntime fb4bda91.\n\n2019-02-14  Maya Rashish  <coypu@sdf.org>\n\ngcc/ChangeLog:\n\n\t* config.gcc (*-*-netbsd*): Add netbsd-d.o\n\t* config/netbsd-d.c: New file.\n\t* config/t-netbsd: Add netbsd-d.o\n\ngcc/d/ChangeLog:\n\n\t* d-system.h: NetBSD is POSIX.\n\nlibphobos/ChangeLog:\n\n\t* configure.tgt: Add netbsd/x86 as supported target.\n\nFrom-SVN: r268905", "tree": {"sha": "4363f9b841561fc326988db52935c42a19bc155f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4363f9b841561fc326988db52935c42a19bc155f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/comments", "author": {"login": "coypoop", "id": 14857674, "node_id": "MDQ6VXNlcjE0ODU3Njc0", "avatar_url": "https://avatars.githubusercontent.com/u/14857674?v=4", "gravatar_id": "", "url": "https://api.github.com/users/coypoop", "html_url": "https://github.com/coypoop", "followers_url": "https://api.github.com/users/coypoop/followers", "following_url": "https://api.github.com/users/coypoop/following{/other_user}", "gists_url": "https://api.github.com/users/coypoop/gists{/gist_id}", "starred_url": "https://api.github.com/users/coypoop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/coypoop/subscriptions", "organizations_url": "https://api.github.com/users/coypoop/orgs", "repos_url": "https://api.github.com/users/coypoop/repos", "events_url": "https://api.github.com/users/coypoop/events{/privacy}", "received_events_url": "https://api.github.com/users/coypoop/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a6c723e202ebd5ae388ca04b7be5ff6fbe70439f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6c723e202ebd5ae388ca04b7be5ff6fbe70439f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6c723e202ebd5ae388ca04b7be5ff6fbe70439f"}], "stats": {"total": 153, "additions": 121, "deletions": 32}, "files": [{"sha": "e2c7b8ef3530f7a4db8ffba912e0007e02aef0f2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -1,3 +1,9 @@\n+2019-02-14  Maya Rashish  <coypu@sdf.org>\n+\n+\t* config.gcc (*-*-netbsd*): Add netbsd-d.o\n+\t* config/netbsd-d.c: New file.\n+\t* config/t-netbsd: Add netbsd-d.o\n+\n 2018-02-14  Steve Ellcey  <sellcey@marvell.com>\n \n \t* config/aarch64/aarch64.c (aarch64_attribute_table): Change"}, {"sha": "3ee31c5993df3065e1cc183eb8478a2c8a72d443", "filename": "gcc/config.gcc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -839,6 +839,7 @@ case ${target} in\n   tm_p_file=\"${tm_p_file} netbsd-protos.h\"\n   tmake_file=\"t-netbsd t-slibgcc\"\n   extra_objs=\"${extra_objs} netbsd.o\"\n+  d_target_objs=\"${d_target_objs} netbsd-d.o\"\n   gas=yes\n   gnu_ld=yes\n   use_gcc_stdint=wrap\n@@ -847,6 +848,7 @@ case ${target} in\n   esac\n   nbsd_tm_file=\"netbsd.h netbsd-stdint.h netbsd-elf.h\"\n   default_use_cxa_atexit=yes\n+  target_has_targetdm=yes\n   ;;\n *-*-openbsd*)\n   tmake_file=\"t-openbsd\""}, {"sha": "76342aacae3578199668e504b1d1afc8d46a3918", "filename": "gcc/config/netbsd-d.c", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fconfig%2Fnetbsd-d.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fconfig%2Fnetbsd-d.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnetbsd-d.c?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -0,0 +1,41 @@\n+/* Functions for generic NetBSD as target machine for GNU D compiler.\n+   Copyright (C) 2019 Free Software Foundation, Inc.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 3, or (at your option)\n+any later version.\n+\n+GCC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GCC; see the file COPYING3.  If not see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#include \"config.h\"\n+#include \"system.h\"\n+#include \"coretypes.h\"\n+#include \"tm.h\"\n+#include \"tree.h\"\n+#include \"varasm.h\"\n+#include \"netbsd-protos.h\"\n+#include \"tm_p.h\"\n+#include \"d/d-target.h\"\n+#include \"d/d-target-def.h\"\n+\n+static void\n+netbsd_d_os_builtins (void)\n+{\n+  d_add_builtin_version (\"Posix\");\n+  d_add_builtin_version (\"NetBSD\");\n+}\n+\n+#undef TARGET_D_OS_VERSIONS\n+#define TARGET_D_OS_VERSIONS netbsd_d_os_builtins\n+\n+struct gcc_targetdm targetdm = TARGETDM_INITIALIZER;"}, {"sha": "716a94f86c63dd81c6b507b439274790727ca1b0", "filename": "gcc/config/t-netbsd", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fconfig%2Ft-netbsd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fconfig%2Ft-netbsd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ft-netbsd?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -19,3 +19,7 @@\n netbsd.o: $(srcdir)/config/netbsd.c\n \t$(COMPILE) $<\n \t$(POSTCOMPILE)\n+\n+netbsd-d.o: $(srcdir)/config/netbsd-d.c\n+\t$(COMPILE) $<\n+\t$(POSTCOMPILE)"}, {"sha": "4bf2e95805d1b16876d970d382bc204e83739c83", "filename": "gcc/d/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fd%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fd%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2FChangeLog?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -1,3 +1,7 @@\n+2019-02-14  Maya Rashish  <coypu@sdf.org>\n+\n+\t* d-system.h: NetBSD is POSIX.\n+\n 2019-02-14  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR d/87864"}, {"sha": "c32825d4ad1139a67ff900a306bd1d84a08b4b38", "filename": "gcc/d/d-system.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fd%2Fd-system.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/gcc%2Fd%2Fd-system.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fd-system.h?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -24,7 +24,8 @@\n \n /* Used by the dmd front-end to determine if we have POSIX-style IO.  */\n #define POSIX (__linux__ || __GLIBC__ || __gnu_hurd__ || __APPLE__ \\\n-\t       || __FreeBSD__ || __OpenBSD__ || __DragonFly__ || __sun)\n+\t       || __FreeBSD__ || __NetBSD__ || __OpenBSD__ || __DragonFly__ \\\n+\t       || __sun)\n \n /* Forward assert invariants to gcc_assert.  */\n #undef assert"}, {"sha": "22766a2d52aa6e284a94b339c51991b9d846250f", "filename": "libphobos/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2FChangeLog?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -1,3 +1,7 @@\n+2019-02-14  Maya Rashish  <coypu@sdf.org>\n+\n+\t* configure.tgt: Add netbsd/x86 as supported target.\n+\n 2019-02-14  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR d/87864"}, {"sha": "0471bfd816b151d6164ecbc5dfb64e983a16c2ae", "filename": "libphobos/configure.tgt", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Fconfigure.tgt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Fconfigure.tgt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fconfigure.tgt?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -30,6 +30,8 @@ case \"${target}\" in\n \t;;\n   x86_64-*-linux* | i?86-*-linux*)\n \t;;\n+  x86_64-*-netbsd* | i?86-*-netbsd*)\n+\t;;\n   *)\n \tUNSUPPORTED=1\n \t;;"}, {"sha": "09ce8d03566a29036e81a962fa403e4c57d3a65c", "filename": "libphobos/libdruntime/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2FMERGE?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -1,4 +1,4 @@\n-2fd957307d94b5ce89eb173910cc7f1995d99031\n+fb4bda91b0b43b5a18e1c143943c101ad4e17667\n \n The first line of this file holds the git revision number of the last\n merge done from the dlang/druntime repository."}, {"sha": "ca7afe93b1e7c34702323405c81069a6f0c690bb", "filename": "libphobos/libdruntime/core/stdc/assert_.d", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fassert_.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fassert_.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fassert_.d?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -53,6 +53,13 @@ else version (FreeBSD)\n      */\n     void __assert(const(char)* exp, const(char)* file, uint line);\n }\n+else version (NetBSD)\n+{\n+    /***\n+     * Assert failure function in the NetBSD C library.\n+     */\n+    void __assert(const(char)* file, int line, const(char)* exp);\n+}\n else version (DragonFlyBSD)\n {\n     /***"}, {"sha": "c04b9c41228044de87754a9907ceb0ec50ffd79b", "filename": "libphobos/libdruntime/core/stdc/stdio.d", "status": "modified", "additions": 5, "deletions": 29, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fstdio.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fstdio.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fstdio.d?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -198,12 +198,6 @@ else version (FreeBSD)\n         ubyte *_base;\n         int _size;\n     }\n-\n-    union __mbstate_t // <sys/_types.h>\n-    {\n-        char[128]   _mbstate8;\n-        long        _mbstateL;\n-    }\n }\n else version (NetBSD)\n {\n@@ -228,12 +222,6 @@ else version (NetBSD)\n         ubyte *_base;\n         int _size;\n     }\n-\n-    union __mbstate_t // <sys/_types.h>\n-    {\n-        char[128]   _mbstate8;\n-        long        _mbstateL;\n-    }\n }\n else version (OpenBSD)\n {\n@@ -258,12 +246,6 @@ else version (OpenBSD)\n         ubyte *_base;\n         int _size;\n     }\n-\n-    union __mbstate_t // <sys/_types.h>\n-    {\n-        char[128]   __mbstate8;\n-        long        __mbstateL;\n-    }\n }\n else version (DragonFlyBSD)\n {\n@@ -297,12 +279,6 @@ else version (DragonFlyBSD)\n         SBUF_DYNSTRUCT  = 0x00080000,   // sbuf must be freed\n         SBUF_INSECTION  = 0x00100000,   // set by sbuf_start_section()\n     }\n-\n-    union __mbstate_t                   // <sys/stdint.h>\n-    {\n-        char[128]   _mbstate8;\n-        long        _mbstateL;\n-    }\n }\n else version (Solaris)\n {\n@@ -518,6 +494,9 @@ else version (Darwin)\n }\n else version (FreeBSD)\n {\n+    // Need to import wchar_ now since __mbstate_t now resides there\n+    import core.stdc.wchar_ : mbstate_t;\n+\n     ///\n     alias off_t fpos_t;\n \n@@ -554,7 +533,7 @@ else version (FreeBSD)\n         pthread_t       _fl_owner;\n         int             _fl_count;\n         int             _orientation;\n-        __mbstate_t     _mbstate;\n+        mbstate_t       _mbstate;\n     }\n \n     ///\n@@ -664,10 +643,7 @@ else version (DragonFlyBSD)\n }\n else version (Solaris)\n {\n-    import core.stdc.wchar_ : __mbstate_t;\n-\n-    ///\n-    alias mbstate_t = __mbstate_t;\n+    import core.stdc.wchar_ : mbstate_t;\n \n     ///\n     alias c_long fpos_t;"}, {"sha": "05c3ad862bc09f1df80a7f11a1a915902ae6fabb", "filename": "libphobos/libdruntime/core/stdc/wchar_.d", "status": "modified", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fwchar_.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fwchar_.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Fcore%2Fstdc%2Fwchar_.d?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -43,13 +43,52 @@ version (CRuntime_Glibc)\n         ___value __value;\n     }\n }\n+else version (FreeBSD)\n+{\n+    ///\n+    union __mbstate_t // <sys/_types.h>\n+    {\n+        char[128]   _mbstate8 = 0;\n+        long        _mbstateL;\n+    }\n+\n+    ///\n+    alias mbstate_t = __mbstate_t;\n+}\n+else version (NetBSD)\n+{\n+    ///\n+    union __mbstate_t\n+    {\n+        int64_t   __mbstateL;\n+        char[128] __mbstate8;\n+    }\n+\n+    ///\n+    alias mbstate_t = __mbstate_t;\n+}\n else version (OpenBSD)\n {\n+    ///\n     union __mbstate_t\n     {\n         char[128] __mbstate8;\n         int64_t   __mbstateL;\n     }\n+\n+    ///\n+    alias mbstate_t = __mbstate_t;\n+}\n+else version (DragonFlyBSD)\n+{\n+    ///\n+    union __mbstate_t                   // <sys/stdint.h>\n+    {\n+        char[128]   _mbstate8 = 0;\n+        long        _mbstateL;\n+    }\n+\n+    ///\n     alias mbstate_t = __mbstate_t;\n }\n else version (Solaris)\n@@ -66,6 +105,9 @@ else version (Solaris)\n             int[6] __filler;\n         }\n     }\n+\n+    ///\n+    alias mbstate_t = __mbstate_t;\n }\n else version (CRuntime_UClibc)\n {"}, {"sha": "88eb94bf20e3634c942ff48cbb66829af2a05d26", "filename": "libphobos/libdruntime/core/sys/netbsd/dlfcn.d", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fsys%2Fnetbsd%2Fdlfcn.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f2b8e4054f5b84594a9b113e409e73480f2ebdf/libphobos%2Flibdruntime%2Fcore%2Fsys%2Fnetbsd%2Fdlfcn.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Fcore%2Fsys%2Fnetbsd%2Fdlfcn.d?ref=2f2b8e4054f5b84594a9b113e409e73480f2ebdf", "patch": "@@ -103,7 +103,7 @@ static if (__BSD_VISIBLE)\n     //void*    fdlopen(int, int);\n     int      dladdr(const(void)*, Dl_info*);\n     //dlfunc_t dlfunc(void*, const(char)*);\n-    //int      dlinfo(void*, int, void*);\n+    int      dlinfo(void*, int, void*);\n     /+void     dllockinit(void* _context,\n         void* function(void* _context) _lock_create,\n         void  function(void* _lock)    _rlock_acquire,"}]}