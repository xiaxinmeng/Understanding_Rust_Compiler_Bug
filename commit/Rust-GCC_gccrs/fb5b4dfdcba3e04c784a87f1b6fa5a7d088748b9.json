{"sha": "fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmI1YjRkZmRjYmEzZTA0Yzc4NGE4N2YxYjZmYTVhN2QwODg3NDhiOQ==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2002-05-15T13:15:17Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2002-05-15T13:15:17Z"}, "message": "re PR libstdc++/6594 (strstreambuf leaks 16 bytes - gcc 3.0.x)\n\n\n2002-05-15  Benjamin Kosnik  <bkoz@redhat.com>\n\n\tPR libstdc++/6594\n\t* src/strstream.cc (strstreambuf): Fix leak.\n\nFrom-SVN: r53486", "tree": {"sha": "d56638b81fddc1100b68993d28c9cb43e8645e99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d56638b81fddc1100b68993d28c9cb43e8645e99"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9/comments", "author": null, "committer": null, "parents": [{"sha": "bf6f276b01d364d1fe300732d39a56f4a6f4ee34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf6f276b01d364d1fe300732d39a56f4a6f4ee34", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf6f276b01d364d1fe300732d39a56f4a6f4ee34"}], "stats": {"total": 40, "additions": 26, "deletions": 14}, "files": [{"sha": "40181511bb04bc67476e97efd113f149ea7d4a0b", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9", "patch": "@@ -1,3 +1,8 @@\n+2002-05-15  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\tPR libstdc++/6594\n+\t* src/strstream.cc (strstreambuf): Fix leak.\n+\n 2002-05-15  Paolo Carlini  <pcarlini@unitus.it>\n \n \tPR libstdc++/6648"}, {"sha": "7bd8d9c33a60253c37fdd40eaef16b9c326c4c4a", "filename": "libstdc++-v3/src/strstream.cc", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9/libstdc%2B%2B-v3%2Fsrc%2Fstrstream.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9/libstdc%2B%2B-v3%2Fsrc%2Fstrstream.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fstrstream.cc?ref=fb5b4dfdcba3e04c784a87f1b6fa5a7d088748b9", "patch": "@@ -64,26 +64,26 @@ strstreambuf::strstreambuf(streamsize initial_capacity)\n     _M_alloc_fun(0), _M_free_fun(0),\n     _M_dynamic(true), _M_frozen(false), _M_constant(false)\n {\n-  streamsize n = max(initial_capacity, streamsize(16));\n-\n-  char* buf = _M_alloc(n);\n-  if (buf) {\n-    setp(buf, buf + n);\n-    setg(buf, buf, buf);\n-  }\n+  _M_buf_size = _M_buf_size_opt = max(initial_capacity, streamsize(16));\n+  _M_buf = _M_alloc(_M_buf_size);\n+  if (_M_buf) \n+    {\n+      setp(_M_buf, _M_buf + _M_buf_size);\n+      setg(_M_buf, _M_buf, _M_buf);\n+    }\n }\n \n strstreambuf::strstreambuf(void* (*alloc_f)(size_t), void (*free_f)(void*))\n   : _Base(),\n     _M_alloc_fun(alloc_f), _M_free_fun(free_f),\n     _M_dynamic(true), _M_frozen(false), _M_constant(false)\n {\n-  streamsize n = 16;\n-\n-  char* buf = _M_alloc(n);\n-  if (buf) {\n-    setp(buf, buf + n);\n-    setg(buf, buf, buf);\n+  _M_buf_size = _M_buf_size_opt = 16;\n+  _M_buf = _M_alloc(_M_buf_size);\n+  if (_M_buf) \n+    {\n+      setp(_M_buf, _M_buf + _M_buf_size);\n+      setg(_M_buf, _M_buf, _M_buf);\n   }\n }\n \n@@ -139,7 +139,14 @@ strstreambuf::strstreambuf(const unsigned char* get, streamsize n)\n strstreambuf::~strstreambuf()\n {\n   if (_M_dynamic && !_M_frozen)\n-    _M_free(eback());\n+    {\n+      char* p = this->eback();\n+      _M_free(p);\n+      if (p == _M_buf)\n+\t_M_buf = 0;\n+    }\n+  if (_M_buf)\n+    _M_free(_M_buf);\n }\n \n void strstreambuf::freeze(bool frozenflag)"}]}