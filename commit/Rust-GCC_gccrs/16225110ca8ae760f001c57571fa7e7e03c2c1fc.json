{"sha": "16225110ca8ae760f001c57571fa7e7e03c2c1fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTYyMjUxMTBjYThhZTc2MGYwMDFjNTc1NzFmYTdlN2UwM2MyYzFmYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-03-02T16:19:43Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-03-02T16:19:43Z"}, "message": "re PR ipa/84628 (attribute(warning/error) functions should not be merged together)\n\n\tPR ipa/84628\n\t* expr.c (expand_expr_real_1) <case CALL_EXPR>: Don't emit diagnostics\n\tfor error or warning attributes if CALL_FROM_THUNK_P is set.\n\tFormatting fixes.\n\n\t* gcc.dg/pr84628.c: New test.\n\nCo-Authored-By: Richard Biener <rguenther@suse.de>\n\nFrom-SVN: r258140", "tree": {"sha": "507c8717f341392d7b3c7b820b83416ffbd72560", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/507c8717f341392d7b3c7b820b83416ffbd72560"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16225110ca8ae760f001c57571fa7e7e03c2c1fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16225110ca8ae760f001c57571fa7e7e03c2c1fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16225110ca8ae760f001c57571fa7e7e03c2c1fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16225110ca8ae760f001c57571fa7e7e03c2c1fc/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e3a72bc5dba4df94f74e6c49849e7b1b0c45ac11", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3a72bc5dba4df94f74e6c49849e7b1b0c45ac11", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3a72bc5dba4df94f74e6c49849e7b1b0c45ac11"}], "stats": {"total": 45, "additions": 38, "deletions": 7}, "files": [{"sha": "447d56342f9e74e4f357108d2afe8d16ebe6c4a3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=16225110ca8ae760f001c57571fa7e7e03c2c1fc", "patch": "@@ -1,3 +1,11 @@\n+2018-03-02  Jakub Jelinek  <jakub@redhat.com>\n+\t    Richard Biener  <rguenther@suse.de>\n+\n+\tPR ipa/84628\n+\t* expr.c (expand_expr_real_1) <case CALL_EXPR>: Don't emit diagnostics\n+\tfor error or warning attributes if CALL_FROM_THUNK_P is set.\n+\tFormatting fixes.\n+\n 2018-03-02  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/56540"}, {"sha": "00660293f72e5441a6421a280b04c57fca2922b8", "filename": "gcc/expr.c", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=16225110ca8ae760f001c57571fa7e7e03c2c1fc", "patch": "@@ -10963,18 +10963,30 @@ expand_expr_real_1 (tree exp, rtx target, machine_mode tmode,\n \ttree fndecl = get_callee_fndecl (exp), attr;\n \n \tif (fndecl\n+\t    /* Don't diagnose the error attribute in thunks, those are\n+\t       artificially created.  */\n+\t    && !CALL_FROM_THUNK_P (exp)\n \t    && (attr = lookup_attribute (\"error\",\n \t\t\t\t\t DECL_ATTRIBUTES (fndecl))) != NULL)\n-\t  error (\"%Kcall to %qs declared with attribute error: %s\",\n-\t\t exp, identifier_to_locale (lang_hooks.decl_printable_name (fndecl, 1)),\n-\t\t TREE_STRING_POINTER (TREE_VALUE (TREE_VALUE (attr))));\n+\t  {\n+\t    const char *ident = lang_hooks.decl_printable_name (fndecl, 1);\n+\t    error (\"%Kcall to %qs declared with attribute error: %s\", exp,\n+\t\t   identifier_to_locale (ident),\n+\t\t   TREE_STRING_POINTER (TREE_VALUE (TREE_VALUE (attr))));\n+\t  }\n \tif (fndecl\n+\t    /* Don't diagnose the warning attribute in thunks, those are\n+\t       artificially created.  */\n+\t    && !CALL_FROM_THUNK_P (exp)\n \t    && (attr = lookup_attribute (\"warning\",\n \t\t\t\t\t DECL_ATTRIBUTES (fndecl))) != NULL)\n-\t  warning_at (tree_nonartificial_location (exp),\n-\t\t      0, \"%Kcall to %qs declared with attribute warning: %s\",\n-\t\t      exp, identifier_to_locale (lang_hooks.decl_printable_name (fndecl, 1)),\n-\t\t      TREE_STRING_POINTER (TREE_VALUE (TREE_VALUE (attr))));\n+\t  {\n+\t    const char *ident = lang_hooks.decl_printable_name (fndecl, 1);\n+\t    warning_at (tree_nonartificial_location (exp), 0,\n+\t\t\t\"%Kcall to %qs declared with attribute warning: %s\",\n+\t\t\texp, identifier_to_locale (ident),\n+\t\t\tTREE_STRING_POINTER (TREE_VALUE (TREE_VALUE (attr))));\n+\t  }\n \n \t/* Check for a built-in function.  */\n \tif (fndecl && DECL_BUILT_IN (fndecl))"}, {"sha": "84ebf2e694c8343fbce66ce8a5259873c9213ce8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=16225110ca8ae760f001c57571fa7e7e03c2c1fc", "patch": "@@ -1,5 +1,8 @@\n 2018-03-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR ipa/84628\n+\t* gcc.dg/pr84628.c: New test.\n+\n \tPR target/56540\n \t* gcc.target/ia64/pr56540.c: New test.\n "}, {"sha": "b8eb53c7dc032cd69adf2257589344c20e661e0b", "filename": "gcc/testsuite/gcc.dg/pr84628.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84628.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16225110ca8ae760f001c57571fa7e7e03c2c1fc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84628.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84628.c?ref=16225110ca8ae760f001c57571fa7e7e03c2c1fc", "patch": "@@ -0,0 +1,8 @@\n+/* PR ipa/84628 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+int f0 (void);\n+__attribute__((error (\"err\"))) void f1 (void) { f0 (); f0 (); }\n+__attribute__((error (\"err\"))) void f2 (void) { f0 (); f0 (); }\n+/* { dg-bogus \"declared with attribute error\" \"\" { target *-*-* } 0 } */"}]}