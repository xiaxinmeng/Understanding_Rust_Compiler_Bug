{"sha": "a5768d38a66fc4136208bc8442a4118df2bd588f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTU3NjhkMzhhNjZmYzQxMzYyMDhiYzg0NDJhNDExOGRmMmJkNTg4Zg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-05-15T23:48:39Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-05-15T23:48:39Z"}, "message": "re PR libfortran/80727 (Crash of runtime gfortran library during integer transformation)\n\n2017-05-15  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libgfortran/80727\n\t* transfer.c (read_sf_internal): Remove bogus code to detect EOR.\n\t(read_block_form): For internal units, generate EOR if no more\n\tbytes left in unit and we are trying to read with ADVANCE='NO'.\n\n\t* gfortran.dg/read_3.f90: New test.\n\nFrom-SVN: r248080", "tree": {"sha": "aae6a5d219e2a2328d5b0eca6f9178cbe3e6fd86", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aae6a5d219e2a2328d5b0eca6f9178cbe3e6fd86"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a5768d38a66fc4136208bc8442a4118df2bd588f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5768d38a66fc4136208bc8442a4118df2bd588f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5768d38a66fc4136208bc8442a4118df2bd588f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5768d38a66fc4136208bc8442a4118df2bd588f/comments", "author": null, "committer": null, "parents": [{"sha": "b2954e124bc411b0b9d8f5f7b4fe2e50f241bbd0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2954e124bc411b0b9d8f5f7b4fe2e50f241bbd0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2954e124bc411b0b9d8f5f7b4fe2e50f241bbd0"}], "stats": {"total": 52, "additions": 42, "deletions": 10}, "files": [{"sha": "1aceb818d9d74c7f7e146d53c4feeef4673f931c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5768d38a66fc4136208bc8442a4118df2bd588f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5768d38a66fc4136208bc8442a4118df2bd588f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a5768d38a66fc4136208bc8442a4118df2bd588f", "patch": "@@ -1,3 +1,8 @@\n+2017-05-15  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/80727\n+\t* gfortran.dg/read_3.f90: New test.\n+\n 2017-05-15  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/79369"}, {"sha": "630666e2938bcb2061f98829bb7cc0352138e4c7", "filename": "gcc/testsuite/gfortran.dg/read_3.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5768d38a66fc4136208bc8442a4118df2bd588f/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5768d38a66fc4136208bc8442a4118df2bd588f/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_3.f90?ref=a5768d38a66fc4136208bc8442a4118df2bd588f", "patch": "@@ -0,0 +1,13 @@\n+! { dg-do run }\n+! PR80727 Crash of runtime gfortran library during integer transformation\n+! Note: before the patch this was giving an incorrect EOR error on READ.\n+program    gfortran_710_io_bug\n+  character  str*4\n+  integer(4) :: i4\n+  str =''\n+  i = 256\n+  write(str,fmt='(a)') i\n+  i = 0\n+  read ( unit=str(1:4), fmt='(a)' ) i4\n+  if (i4.ne.256) call abort\n+end  program  gfortran_710_io_bug "}, {"sha": "b604147ffee29d3f375e88d6df012bbcd91e5865", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5768d38a66fc4136208bc8442a4118df2bd588f/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5768d38a66fc4136208bc8442a4118df2bd588f/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=a5768d38a66fc4136208bc8442a4118df2bd588f", "patch": "@@ -1,3 +1,10 @@\n+2017-05-15  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/80727\n+\t* transfer.c (read_sf_internal): Remove bogus code to detect EOR.\n+\t(read_block_form): For internal units, generate EOR if no more\n+\tbytes left in unit and we are trying to read with ADVANCE='NO'.\n+\n 2017-05-15  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/80765"}, {"sha": "928a448f74cf93121dc4e09912f023b20b094e51", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 17, "deletions": 10, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5768d38a66fc4136208bc8442a4118df2bd588f/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5768d38a66fc4136208bc8442a4118df2bd588f/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=a5768d38a66fc4136208bc8442a4118df2bd588f", "patch": "@@ -272,12 +272,6 @@ read_sf_internal (st_parameter_dt *dtp, int *length)\n       return NULL;\n     }\n \n-  if (base && *base == 0)\n-    {\n-      generate_error (&dtp->common, LIBERROR_EOR, NULL);\n-      return NULL;\n-    }\n-\n   dtp->u.p.current_unit->bytes_left -= *length;\n \n   if (((dtp->common.flags & IOPARM_DT_HAS_SIZE) != 0) ||\n@@ -470,11 +464,24 @@ read_block_form (st_parameter_dt *dtp, int *nbytes)\n \t\t}\n \t    }\n \n-\t  if (unlikely (dtp->u.p.current_unit->bytes_left == 0\n-\t      && !is_internal_unit(dtp)))\n+\t  if (is_internal_unit(dtp))\n \t    {\n-\t      hit_eof (dtp);\n-\t      return NULL;\n+\t      if (*nbytes > 0 && dtp->u.p.current_unit->bytes_left == 0)\n+\t        {\n+\t\t  if (dtp->u.p.advance_status == ADVANCE_NO)\n+\t\t    {\n+\t\t      generate_error (&dtp->common, LIBERROR_EOR, NULL);\n+\t\t      return NULL;\n+\t\t    }\n+\t\t}\n+\t    }\n+\t  else\n+\t    {\n+\t      if (unlikely (dtp->u.p.current_unit->bytes_left == 0))\n+\t\t{\n+\t\t  hit_eof (dtp);\n+\t\t  return NULL;\n+\t\t}\n \t    }\n \n \t  *nbytes = dtp->u.p.current_unit->bytes_left;"}]}