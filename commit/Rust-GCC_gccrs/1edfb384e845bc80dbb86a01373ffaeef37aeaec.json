{"sha": "1edfb384e845bc80dbb86a01373ffaeef37aeaec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWVkZmIzODRlODQ1YmM4MGRiYjg2YTAxMzczZmZhZWVmMzdhZWFlYw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2015-05-31T21:47:28Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2015-05-31T21:47:28Z"}, "message": "c-ada-spec.c (is_tagged_type): Test for TYPE_METHODS on main variant.\n\n\t* c-ada-spec.c (is_tagged_type): Test for TYPE_METHODS on main variant.\n\t(has_nontrivial_methods): Likewise.\n\nFrom-SVN: r223905", "tree": {"sha": "4312a75694ade877696a8a80780473b127951ff5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4312a75694ade877696a8a80780473b127951ff5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1edfb384e845bc80dbb86a01373ffaeef37aeaec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1edfb384e845bc80dbb86a01373ffaeef37aeaec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1edfb384e845bc80dbb86a01373ffaeef37aeaec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1edfb384e845bc80dbb86a01373ffaeef37aeaec/comments", "author": null, "committer": null, "parents": [{"sha": "255a48d6419c185cd9daac578a97b22e2c71b596", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/255a48d6419c185cd9daac578a97b22e2c71b596", "html_url": "https://github.com/Rust-GCC/gccrs/commit/255a48d6419c185cd9daac578a97b22e2c71b596"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "abcc2a746744fbc492882893a353481c4811151c", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=1edfb384e845bc80dbb86a01373ffaeef37aeaec", "patch": "@@ -1,3 +1,8 @@\n+2015-05-31  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* c-ada-spec.c (is_tagged_type): Test for TYPE_METHODS on main variant.\n+\t(has_nontrivial_methods): Likewise.\n+\n 2015-05-25  Marek Polacek  <polacek@redhat.com>\n \n \t* c-ubsan.c (ubsan_instrument_shift): Use type0."}, {"sha": "9bef52256c7bfa2b1a8378e31ed6681639b80413", "filename": "gcc/c-family/c-ada-spec.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Fc-family%2Fc-ada-spec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Fc-family%2Fc-ada-spec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-ada-spec.c?ref=1edfb384e845bc80dbb86a01373ffaeef37aeaec", "patch": "@@ -960,6 +960,9 @@ is_tagged_type (const_tree type)\n   if (!type || !RECORD_OR_UNION_TYPE_P (type))\n     return false;\n \n+  /* TYPE_METHODS is only set on the main variant.  */\n+  type = TYPE_MAIN_VARIANT (type);\n+\n   for (tmp = TYPE_METHODS (type); tmp; tmp = TREE_CHAIN (tmp))\n     if (TREE_CODE (tmp) == FUNCTION_DECL && DECL_VINDEX (tmp))\n       return true;\n@@ -988,6 +991,9 @@ has_nontrivial_methods (tree type)\n   if (!cpp_check (type, IS_TRIVIAL))\n     return true;\n \n+  /* TYPE_METHODS is only set on the main variant.  */\n+  type = TYPE_MAIN_VARIANT (type);\n+\n   /* If there are user-defined methods, they are deemed non-trivial.  */\n   for (tmp = TYPE_METHODS (type); tmp; tmp = TREE_CHAIN (tmp))\n     if (!DECL_ARTIFICIAL (tmp))"}, {"sha": "7d9e46da773a6a08acef568c83e046fc06fa3940", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1edfb384e845bc80dbb86a01373ffaeef37aeaec", "patch": "@@ -1,3 +1,7 @@\n+2015-05-31  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t  * g++.dg/other/dump-ada-spec-4.C: New test.\n+\n 2015-05-30  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.dg/alias-8.c: Fix dg-warning."}, {"sha": "bdbbda4f828b2ac7e304700abddbe8ae5f97fc2f", "filename": "gcc/testsuite/g++.dg/other/dump-ada-spec-4.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdump-ada-spec-4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1edfb384e845bc80dbb86a01373ffaeef37aeaec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdump-ada-spec-4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdump-ada-spec-4.C?ref=1edfb384e845bc80dbb86a01373ffaeef37aeaec", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fdump-ada-spec\" } */\n+\n+class Root  {\n+public:\n+   virtual void copyFrom(const Root& property) = 0;\n+};\n+\n+class DT : Root {\n+   virtual void copyFrom (const Root& property);\n+   /* Although in C++ the type of argument Root is the parent type\n+      \"Root\", in order to properly override this primitive in Ada\n+      the profile of the generated function must be the derived\n+      type \"DT\" */\n+};\n+\n+/* { dg-final { scan-ada-spec \"Root'Class\" } } */\n+/* { dg-final { cleanup-ada-spec } } */"}]}