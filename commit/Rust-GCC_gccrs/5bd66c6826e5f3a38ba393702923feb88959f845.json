{"sha": "5bd66c6826e5f3a38ba393702923feb88959f845", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWJkNjZjNjgyNmU1ZjNhMzhiYTM5MzcwMjkyM2ZlYjg4OTU5Zjg0NQ==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2021-05-13T18:33:35Z"}, "committer": {"name": "Bill Schmidt", "email": "wschmidt@linux.ibm.com", "date": "2021-05-15T19:05:12Z"}, "message": "rs6000: Add ROP tests\n\n2021-05-13  Bill Schmidt  <wschmidt@linux.ibm.com>\n\ngcc/testsuite/\n\t* gcc.target/powerpc/rop-1.c: New.\n\t* gcc.target/powerpc/rop-2.c: New.\n\t* gcc.target/powerpc/rop-3.c: New.\n\t* gcc.target/powerpc/rop-4.c: New.\n\t* gcc.target/powerpc/rop-5.c: New.", "tree": {"sha": "3978dc6d467d6bb4326c24f0601949901081164d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3978dc6d467d6bb4326c24f0601949901081164d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5bd66c6826e5f3a38ba393702923feb88959f845", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5bd66c6826e5f3a38ba393702923feb88959f845", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5bd66c6826e5f3a38ba393702923feb88959f845", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5bd66c6826e5f3a38ba393702923feb88959f845/comments", "author": null, "committer": null, "parents": [{"sha": "3ec3a9feb83d98715c97c0df4ae751a4eb582956", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ec3a9feb83d98715c97c0df4ae751a4eb582956", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ec3a9feb83d98715c97c0df4ae751a4eb582956"}], "stats": {"total": 80, "additions": 80, "deletions": 0}, "files": [{"sha": "8cedcb6668aa039bcccaf8f13b2ac11e058a104f", "filename": "gcc/testsuite/gcc.target/powerpc/rop-1.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-1.c?ref=5bd66c6826e5f3a38ba393702923feb88959f845", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mdejagnu-cpu=power10 -mrop-protect\" } */\n+/* { dg-require-effective-target powerpc_elfv2 } */\n+\n+/* Verify that ROP-protect instructions are inserted when a\n+   call is present.  */\n+\n+extern void foo (void);\n+\n+int bar ()\n+{\n+  foo ();\n+  return 5;\n+}\n+\n+/* { dg-final { scan-assembler-times {\\mhashst\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mhashchk\\M} 1 } } */"}, {"sha": "c556952aec1b277397cdd0f004e272058aa9d134", "filename": "gcc/testsuite/gcc.target/powerpc/rop-2.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-2.c?ref=5bd66c6826e5f3a38ba393702923feb88959f845", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mdejagnu-cpu=power10 -mrop-protect -mprivileged\" } */\n+/* { dg-require-effective-target powerpc_elfv2 } */\n+\n+/* Verify that privileged ROP-protect instructions are inserted when a\n+   call is present.  */\n+\n+extern void foo (void);\n+\n+int bar ()\n+{\n+  foo ();\n+  return 5;\n+}\n+\n+/* { dg-final { scan-assembler-times {\\mhashstp\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mhashchkp\\M} 1 } } */"}, {"sha": "8d03792e3e5e16b352dbe184a1a7433fc5980449", "filename": "gcc/testsuite/gcc.target/powerpc/rop-3.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-3.c?ref=5bd66c6826e5f3a38ba393702923feb88959f845", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do run { target { power10_hw } } } */\n+/* { dg-require-effective-target powerpc_elfv2 } */\n+/* { dg-options \"-O2 -mdejagnu-cpu=power10 -mrop-protect\" } */\n+\n+/* Verify that ROP-protect instructions execute correctly when a\n+   call is present.  */\n+\n+void __attribute__((noipa)) foo ()\n+{\n+  asm (\"\");\n+}\n+\n+int main ()\n+{\n+  foo ();\n+  return 0;\n+}\n+"}, {"sha": "dcf47c63fb794e6736e6005e711cd70fbd549114", "filename": "gcc/testsuite/gcc.target/powerpc/rop-4.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-4.c?ref=5bd66c6826e5f3a38ba393702923feb88959f845", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mdejagnu-cpu=power10 -mrop-protect\" } */\n+/* { dg-require-effective-target powerpc_elfv2 } */\n+\n+/* Verify that no ROP-protect instructions are inserted when no\n+   call is present.  */\n+\n+\n+int bar ()\n+{\n+  return 5;\n+}\n+\n+/* { dg-final { scan-assembler-not {\\mhashst\\M} } } */\n+/* { dg-final { scan-assembler-not {\\mhashchk\\M} } } */"}, {"sha": "cf04ea90eeb43ac60687e3f2124d21de22a34fef", "filename": "gcc/testsuite/gcc.target/powerpc/rop-5.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5bd66c6826e5f3a38ba393702923feb88959f845/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Frop-5.c?ref=5bd66c6826e5f3a38ba393702923feb88959f845", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -mdejagnu-cpu=power10 -mrop-protect\" } */\n+\n+/* Verify that __ROP_PROTECT__ is predefined for -mrop-protect.  */\n+\n+int foo ()\n+{\n+#ifndef __ROP_PROTECT__\n+  __ROP_PROTECT__ macro is not defined when it should be\n+#endif\n+  return 0;\n+}\n+"}]}