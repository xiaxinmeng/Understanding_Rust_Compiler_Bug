{"sha": "17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTdkZWZhNmExM2VmNGYzMTdlMjJkY2IzODI3YjRlOGVhMWIzNzU0MQ==", "commit": {"author": {"name": "Zack Weinberg", "email": "zackw@panix.com", "date": "2007-03-26T21:00:20Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2007-03-26T21:00:20Z"}, "message": "gengtype-lex.l: Distinguish unions from structures in the token type.\n\n\t* gengtype-lex.l: Distinguish unions from structures in the\n\ttoken type.  Don't call find_structure; return the tag as a string.\n\t* gengtype-yacc.y: Add new token types ENT_TYPEDEF_UNION and ENT_UNION.\n\tType of these, ENT_TYPEDEF_STRUCT, and ENT_STRUCT is string.\n\tReorganize typedef_struct production accordingly.\n\tUse create_nested_ptr_option.\n\t* gengtype.c (create_nested_ptr_option): New function.\n\t* gengtype.h: Declare it.\n\nFrom-SVN: r123232", "tree": {"sha": "bc7cc4d9040d552a301d8fe6061ec59da8a396fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc7cc4d9040d552a301d8fe6061ec59da8a396fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/comments", "author": {"login": "zackw", "id": 325899, "node_id": "MDQ6VXNlcjMyNTg5OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/325899?v=4", "gravatar_id": "", "url": "https://api.github.com/users/zackw", "html_url": "https://github.com/zackw", "followers_url": "https://api.github.com/users/zackw/followers", "following_url": "https://api.github.com/users/zackw/following{/other_user}", "gists_url": "https://api.github.com/users/zackw/gists{/gist_id}", "starred_url": "https://api.github.com/users/zackw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/zackw/subscriptions", "organizations_url": "https://api.github.com/users/zackw/orgs", "repos_url": "https://api.github.com/users/zackw/repos", "events_url": "https://api.github.com/users/zackw/events{/privacy}", "received_events_url": "https://api.github.com/users/zackw/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "95161faf6d635df17a7792840aa73600624b11fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95161faf6d635df17a7792840aa73600624b11fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95161faf6d635df17a7792840aa73600624b11fb"}], "stats": {"total": 74, "additions": 50, "deletions": 24}, "files": [{"sha": "385247107fbfdebcf33d2679a87b8b3d74a940d3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "patch": "@@ -1,5 +1,14 @@\n 2007-03-26  Zack Weinberg  <zackw@panix.com>\n \n+\t* gengtype-lex.l: Distinguish unions from structures in the\n+\ttoken type.  Don't call find_structure; return the tag as a string.\n+\t* gengtype-yacc.y: Add new token types ENT_TYPEDEF_UNION and ENT_UNION.\n+\tType of these, ENT_TYPEDEF_STRUCT, and ENT_STRUCT is string.\n+\tReorganize typedef_struct production accordingly.\n+\tUse create_nested_ptr_option.\n+\t* gengtype.c (create_nested_ptr_option): New function.\n+\t* gengtype.h: Declare it.\n+\n \t* gengtype.h (struct type): Replace 'sc' with boolean, scalar_is_char.\n \t(string_type): Don't declare.\n \t(do_scalar_typedef): Declare."}, {"sha": "baf09bcd5fe038d09b0a23c7933928eefcc9d4d3", "filename": "gcc/gengtype-lex.l", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype-lex.l", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype-lex.l", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgengtype-lex.l?ref=17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "patch": "@@ -171,12 +171,12 @@ ITYPE\t{IWORD}({WS}{IWORD})*\n   for (taglen = 1; ISIDNUM (tagstart[taglen]); taglen++)\n     ;\n \n-  yylval.t = find_structure ((const char *) xmemdup (tagstart, taglen,\n-\t\t\t\t\t\t     taglen + 1),\n-\t\t\t     union_p);\n+  yylval.s = (const char *) xmemdup (tagstart, taglen, taglen + 1);\n+\n   BEGIN(in_struct);\n   update_lineno (yytext, yyleng);\n-  return typedef_p ? ENT_TYPEDEF_STRUCT : ENT_STRUCT;\n+  return union_p ? (typedef_p ? ENT_TYPEDEF_UNION : ENT_UNION)\n+                 : (typedef_p ? ENT_TYPEDEF_STRUCT : ENT_STRUCT);\n }\n \n [^[:alnum:]_](extern|static){WS}/\"GTY\" {"}, {"sha": "758bcaae327d029f6a9c262f74d9b59a19835b61", "filename": "gcc/gengtype-yacc.y", "status": "modified", "additions": 23, "deletions": 20, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype-yacc.y", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype-yacc.y", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgengtype-yacc.y?ref=17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "patch": "@@ -35,8 +35,10 @@ Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA\n   const char *s;\n }\n \n-%token <t>ENT_TYPEDEF_STRUCT\n-%token <t>ENT_STRUCT\n+%token <s>ENT_TYPEDEF_STRUCT\n+%token <s>ENT_STRUCT\n+%token <s>ENT_TYPEDEF_UNION\n+%token <s>ENT_UNION\n %token ENT_EXTERNSTATIC\n %token GTY_TOKEN\n %token VEC_TOKEN\n@@ -68,21 +70,30 @@ start: /* empty */\n \n typedef_struct: ENT_TYPEDEF_STRUCT options '{' struct_fields '}' ID\n \t\t   {\n-\t\t     new_structure ($1->u.s.tag, UNION_P ($1), &lexer_line,\n-\t\t\t\t    $4, $2);\n-\t\t     do_typedef ($6, $1, &lexer_line);\n+\t\t     type_p t = new_structure ($1, false, &lexer_line, $4, $2);\n+\t\t     do_typedef ($6, t, &lexer_line);\n \t\t     lexer_toplevel_done = 1;\n \t\t   }\n-\t\t ';'\n-\t\t   {}\n+\t\t  ';'\n+\t\t| ENT_TYPEDEF_UNION options '{' struct_fields '}' ID\n+\t\t   {\n+\t\t     type_p t = new_structure ($1, true, &lexer_line, $4, $2);\n+\t\t     do_typedef ($6, t, &lexer_line);\n+\t\t     lexer_toplevel_done = 1;\n+\t\t   }\n+\t\t  ';'\n \t\t| ENT_STRUCT options '{' struct_fields '}'\n \t\t   {\n-\t\t     new_structure ($1->u.s.tag, UNION_P ($1), &lexer_line,\n-\t\t\t\t    $4, $2);\n+\t\t     new_structure ($1, false, &lexer_line, $4, $2);\n \t\t     lexer_toplevel_done = 1;\n \t\t   }\n-\t\t ';'\n-\t\t   {}\n+\t\t  ';'\n+\t\t| ENT_UNION options '{' struct_fields '}'\n+\t\t   {\n+\t\t     new_structure ($1, true, &lexer_line, $4, $2);\n+\t\t     lexer_toplevel_done = 1;\n+\t\t   }\n+\t\t  ';'\n \t\t;\n \n externstatic: ENT_EXTERNSTATIC options lasttype ID semiequal\n@@ -210,15 +221,7 @@ option:   ID\n \t| type_option '(' type ')'\n \t    { $$ = create_option (NULL, $1, adjust_field_type ($3, NULL)); }\n \t| NESTED_PTR '(' type ',' stringseq ',' stringseq ')'\n-\t    {\n-\t      struct nested_ptr_data d;\n-\n-\t      d.type = adjust_field_type ($3, NULL);\n-\t      d.convert_to = $5;\n-\t      d.convert_from = $7;\n-\t      $$ = create_option (NULL, \"nested_ptr\",\n-\t\t\t\t  xmemdup (&d, sizeof (d), sizeof (d)));\n-\t    }\n+\t    { $$ = create_nested_ptr_option ($3, $5, $7); }\n \t;\n \n optionseq: option"}, {"sha": "86d72d8f0d7a60bf9b3b539ff8c64cb32ff3934f", "filename": "gcc/gengtype.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgengtype.c?ref=17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "patch": "@@ -330,6 +330,18 @@ create_option (options_p next, const char *name, const void *info)\n   return o;\n }\n \n+/* Return an options structure for a \"nested_ptr\" option.  */\n+options_p\n+create_nested_ptr_option (type_p t, const char *to, const char *from)\n+{\n+  struct nested_ptr_data *d = XNEW (struct nested_ptr_data);\n+\n+  d->type = adjust_field_type (t, 0);\n+  d->convert_to = to;\n+  d->convert_from = from;\n+  return create_option (NULL, \"nested_ptr\", d);\n+}\n+\n /* Add a variable named S of type T with options O defined at POS,\n    to `variables'.  */\n "}, {"sha": "f803ad3c1ee0d7c4dd1bd1072324526dd04e24ed", "filename": "gcc/gengtype.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17defa6a13ef4f317e22dcb3827b4e8ea1b37541/gcc%2Fgengtype.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgengtype.h?ref=17defa6a13ef4f317e22dcb3827b4e8ea1b37541", "patch": "@@ -139,6 +139,8 @@ extern type_p create_scalar_type (const char *name);\n extern type_p create_pointer (type_p t);\n extern type_p create_array (type_p t, const char *len);\n extern options_p create_option (options_p, const char *name, const void *info);\n+extern options_p create_nested_ptr_option (type_p t, const char *from,\n+\t\t\t\t\t   const char *to);\n extern type_p adjust_field_type (type_p, options_p);\n extern void note_variable (const char *s, type_p t, options_p o,\n \t\t\t   struct fileloc *pos);"}]}