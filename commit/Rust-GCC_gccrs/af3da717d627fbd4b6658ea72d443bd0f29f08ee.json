{"sha": "af3da717d627fbd4b6658ea72d443bd0f29f08ee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWYzZGE3MTdkNjI3ZmJkNGI2NjU4ZWE3MmQ0NDNiZDBmMjlmMDhlZQ==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2019-02-09T11:11:33Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2019-02-09T11:11:33Z"}, "message": "re PR fortran/89200 (Erroneous copying of a derived type with a deferred-length character array component)\n\n2019-02-09  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/89200\n\t* trans-array.c (gfc_trans_create_temp_array): Set the 'span'\n\tfield for derived types.\n\n2019-02-09  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/89200\n\t* gfortran.dg/array_reference_2.f90 : New test.\n\nFrom-SVN: r268721", "tree": {"sha": "4ff484a0d027d11806d4d9c352ea111013ab7eb4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4ff484a0d027d11806d4d9c352ea111013ab7eb4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/af3da717d627fbd4b6658ea72d443bd0f29f08ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af3da717d627fbd4b6658ea72d443bd0f29f08ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af3da717d627fbd4b6658ea72d443bd0f29f08ee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af3da717d627fbd4b6658ea72d443bd0f29f08ee/comments", "author": null, "committer": null, "parents": [{"sha": "de3ed9259f3b3cda69d44332b194c1c29666c719", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de3ed9259f3b3cda69d44332b194c1c29666c719", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de3ed9259f3b3cda69d44332b194c1c29666c719"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "96cb70e51a99d678d74a53aed496a26642cf1cce", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=af3da717d627fbd4b6658ea72d443bd0f29f08ee", "patch": "@@ -1,3 +1,9 @@\n+2019-02-09  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/89200\n+\t* trans-array.c (gfc_trans_create_temp_array): Set the 'span'\n+\tfield for derived types.\n+\n 2019-02-04  Harald Anlauf  <anlauf@gmx.de>\n \n \tPR fortran/89077"}, {"sha": "f15d3a379378a6c1c80cf3c0e0430285931d1c21", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=af3da717d627fbd4b6658ea72d443bd0f29f08ee", "patch": "@@ -1293,6 +1293,15 @@ gfc_trans_create_temp_array (stmtblock_t * pre, stmtblock_t * post, gfc_ss * ss,\n   tmp = gfc_conv_descriptor_dtype (desc);\n   gfc_add_modify (pre, tmp, gfc_get_dtype (TREE_TYPE (desc)));\n \n+  /* Also set the span for derived types, since they can be used in\n+     component references to arrays of this type.  */\n+  if (TREE_CODE (eltype) == RECORD_TYPE)\n+    {\n+      tmp = TYPE_SIZE_UNIT (eltype);\n+      tmp = fold_convert (gfc_array_index_type, tmp);\n+      gfc_conv_descriptor_span_set (pre, desc, tmp);\n+    }\n+\n   /*\n      Fill in the bounds and stride.  This is a packed array, so:\n "}, {"sha": "d9b9ccbfcceea7417c532fa3f13e2d335a716b9d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=af3da717d627fbd4b6658ea72d443bd0f29f08ee", "patch": "@@ -1,3 +1,8 @@\n+2019-02-09  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/89200\n+\t* gfortran.dg/array_reference_2.f90 : New test.\n+\n 2019-02-09  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/89246"}, {"sha": "6ec65ebb541667ae332417b40ac2207855062a8c", "filename": "gcc/testsuite/gfortran.dg/array_reference_2.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_reference_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af3da717d627fbd4b6658ea72d443bd0f29f08ee/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_reference_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_reference_2.f90?ref=af3da717d627fbd4b6658ea72d443bd0f29f08ee", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do run }\n+!\n+! Test the fix for PR89200, in which the indexing did not work in\n+! the write statement below.\n+!\n+! Contributed by Damian Rouson  <damian@sourceryinstitute.org>\n+!\n+  type foo\n+    character(len=:), allocatable :: string\n+  end type\n+  type foo_list\n+    type(foo), allocatable :: entry(:)\n+  end type\n+  type(foo_list) list\n+  character(4) :: buffer\n+  list = foo_list([foo('12'), foo('34')])\n+  write(buffer, '(2a2)') list%entry(1)%string, list%entry(2)%string\n+  if (buffer .ne. '1234') stop 1\n+  deallocate (list%entry)\n+end"}]}