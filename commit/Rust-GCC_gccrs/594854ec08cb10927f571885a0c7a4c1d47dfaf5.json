{"sha": "594854ec08cb10927f571885a0c7a4c1d47dfaf5", "node_id": "C_kwDOANBUbNoAKDU5NDg1NGVjMDhjYjEwOTI3ZjU3MTg4NWEwYzdhNGMxZDQ3ZGZhZjU", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-06-16T03:05:53Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-06-17T07:43:07Z"}, "message": "parser: Build ConstGenericParam properly", "tree": {"sha": "581cf6e399375e3c26fe502bbec488f8a9dbb6b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/581cf6e399375e3c26fe502bbec488f8a9dbb6b2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/594854ec08cb10927f571885a0c7a4c1d47dfaf5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/594854ec08cb10927f571885a0c7a4c1d47dfaf5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/594854ec08cb10927f571885a0c7a4c1d47dfaf5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/594854ec08cb10927f571885a0c7a4c1d47dfaf5/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9fb7d06ca79e8c0f784da02696b436bc50e2f49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9fb7d06ca79e8c0f784da02696b436bc50e2f49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9fb7d06ca79e8c0f784da02696b436bc50e2f49"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "b9f031d00490e18be6344e7319689e3fbffccdd1", "filename": "gcc/rust/parse/rust-parse-impl.h", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/594854ec08cb10927f571885a0c7a4c1d47dfaf5/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/594854ec08cb10927f571885a0c7a4c1d47dfaf5/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fparse%2Frust-parse-impl.h?ref=594854ec08cb10927f571885a0c7a4c1d47dfaf5", "patch": "@@ -2868,24 +2868,22 @@ Parser<ManagedTokenSource>::parse_generic_param (EndTokenPred is_end_token)\n       case CONST: {\n \tlexer.skip_token ();\n \n-\tauto name = expect_token (IDENTIFIER);\n+\tauto name_token = expect_token (IDENTIFIER);\n \n-\tif (!name || !expect_token (COLON))\n+\tif (!name_token || !expect_token (COLON))\n \t  return nullptr;\n \n \tauto type = parse_type ();\n \tif (!type)\n \t  return nullptr;\n \n-\t// FIXME: instantiate proper AST::ConstGeneric class here\n-\t// auto const_generic = new ...\n-\n \t// optional default value\n+\tstd::unique_ptr<AST::Expr> default_expr = nullptr;\n \tif (lexer.peek_token ()->get_id () == EQUAL)\n \t  {\n \t    lexer.skip_token ();\n \t    auto tok = lexer.peek_token ();\n-\t    auto default_expr = parse_const_generic_expression ();\n+\t    default_expr = parse_const_generic_expression ();\n \n \t    if (!default_expr)\n \t      rust_error_at (tok->get_locus (),\n@@ -2895,7 +2893,11 @@ Parser<ManagedTokenSource>::parse_generic_param (EndTokenPred is_end_token)\n \t\t\t     token_id_to_str (tok->get_id ()));\n \t  }\n \n-\t// param = std::unique_ptr<AST::GenericParam> (const_generic)\n+\tparam = std::unique_ptr<AST::ConstGenericParam> (\n+\t  new AST::ConstGenericParam (name_token->get_str (), std::move (type),\n+\t\t\t\t      std::move (default_expr),\n+\t\t\t\t      std::move (outer_attrs),\n+\t\t\t\t      token->get_locus ()));\n \n \tbreak;\n       }"}]}