{"sha": "44fca83228acc96c19c51e52b5c0448e09329170", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRmY2E4MzIyOGFjYzk2YzE5YzUxZTUyYjVjMDQ0OGUwOTMyOTE3MA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2019-12-19T08:20:09Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-12-19T08:20:09Z"}, "message": "ipa: duplicate ipa_size_summary for cloned nodes\n\n\t* ipa-fnsummary.h (ipa_size_summary): Remove copy consturctor.\n\t(ipa_size_summary_t): Add duplicate method; move to heap.\n\t* ipa-fnsumary.c (ipa_fn_summary_alloc): Fix allocation.\n\nFrom-SVN: r279563", "tree": {"sha": "bfe0552c058c7e746f11c67c4516ecb3a1184026", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bfe0552c058c7e746f11c67c4516ecb3a1184026"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44fca83228acc96c19c51e52b5c0448e09329170", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44fca83228acc96c19c51e52b5c0448e09329170", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44fca83228acc96c19c51e52b5c0448e09329170", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44fca83228acc96c19c51e52b5c0448e09329170/comments", "author": null, "committer": null, "parents": [{"sha": "951e27f58ca5c7f33124407079c383706e99c68d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/951e27f58ca5c7f33124407079c383706e99c68d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/951e27f58ca5c7f33124407079c383706e99c68d"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "3b703386dddac68f4bd31854ec4561296f87c950", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44fca83228acc96c19c51e52b5c0448e09329170/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44fca83228acc96c19c51e52b5c0448e09329170/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=44fca83228acc96c19c51e52b5c0448e09329170", "patch": "@@ -1,3 +1,10 @@\n+2019-12-19  Jan Hubicka  <hubicka@ucw.cz>\n+\t    Luo Xiong Hu  <luoxhu@linux.ibm.com\n+\n+\t* ipa-fnsummary.h (ipa_size_summary): Remove copy consturctor.\n+\t(ipa_size_summary_t): Add duplicate method; move to heap.\n+\t* ipa-fnsumary.c (ipa_fn_summary_alloc): Fix allocation.\n+\n 2019-12-19  Feng Xue  <fxue@os.amperecomputing.com>\n \n \tPR ipa/92794"}, {"sha": "5486f6496bde903d42f1f39234fb4f2aff2e33dd", "filename": "gcc/ipa-fnsummary.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44fca83228acc96c19c51e52b5c0448e09329170/gcc%2Fipa-fnsummary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44fca83228acc96c19c51e52b5c0448e09329170/gcc%2Fipa-fnsummary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-fnsummary.c?ref=44fca83228acc96c19c51e52b5c0448e09329170", "patch": "@@ -672,8 +672,7 @@ static void\n ipa_fn_summary_alloc (void)\n {\n   gcc_checking_assert (!ipa_fn_summaries);\n-  ipa_size_summaries = new fast_function_summary <ipa_size_summary *, va_heap>\n-\t\t\t\t\t\t\t (symtab);\n+  ipa_size_summaries = new ipa_size_summary_t (symtab);\n   ipa_fn_summaries = ipa_fn_summary_t::create_ggc (symtab);\n   ipa_call_summaries = new ipa_call_summary_t (symtab);\n }"}, {"sha": "a0ac0b7d55603661c4b5547eb545db0eabd64a06", "filename": "gcc/ipa-fnsummary.h", "status": "modified", "additions": 9, "deletions": 12, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44fca83228acc96c19c51e52b5c0448e09329170/gcc%2Fipa-fnsummary.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44fca83228acc96c19c51e52b5c0448e09329170/gcc%2Fipa-fnsummary.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-fnsummary.h?ref=44fca83228acc96c19c51e52b5c0448e09329170", "patch": "@@ -99,11 +99,6 @@ class ipa_size_summary\n   : estimated_self_stack_size (0), self_size (0), size (0)\n   {\n   }\n-  /* Copy constructor.  */\n-  ipa_size_summary (const ipa_size_summary &s)\n-  : estimated_self_stack_size (0), self_size (s.self_size), size (s.size)\n-  {\n-  }\n };\n \n /* Function inlining information.  */\n@@ -226,18 +221,20 @@ extern GTY(()) fast_function_summary <ipa_fn_summary *, va_gc>\n   *ipa_fn_summaries;\n \n class ipa_size_summary_t:\n-  public fast_function_summary <ipa_size_summary *, va_gc>\n+  public fast_function_summary <ipa_size_summary *, va_heap>\n {\n public:\n   ipa_size_summary_t (symbol_table *symtab):\n-    fast_function_summary <ipa_size_summary *, va_gc> (symtab) {}\n+    fast_function_summary <ipa_size_summary *, va_heap> (symtab)\n+  {\n+    disable_insertion_hook ();\n+  }\n \n-  static ipa_size_summary_t *create_ggc (symbol_table *symtab)\n+  virtual void duplicate (cgraph_node *, cgraph_node *,\n+\t\t\t  ipa_size_summary *src_data,\n+\t\t\t  ipa_size_summary *dst_data)\n   {\n-    class ipa_size_summary_t *summary = new (ggc_alloc <ipa_size_summary_t> ())\n-      ipa_size_summary_t (symtab);\n-    summary->disable_insertion_hook ();\n-    return summary;\n+    *dst_data = *src_data;\n   }\n };\n extern fast_function_summary <ipa_size_summary *, va_heap>"}]}