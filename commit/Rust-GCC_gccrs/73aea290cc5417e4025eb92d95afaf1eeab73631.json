{"sha": "73aea290cc5417e4025eb92d95afaf1eeab73631", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzNhZWEyOTBjYzU0MTdlNDAyNWViOTJkOTVhZmFmMWVlYWI3MzYzMQ==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2005-02-03T02:21:10Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2005-02-03T02:21:10Z"}, "message": "re PR c/17807 (No warning/error for undefined local function.)\n\n\tPR c/17807\n\t* c-decl.c (undef_nested_function): New variable.\n\t(pop_scope): Diagnose undefined nested functions.\n\t(finish_function): Don't attempt cgraph processing or genericizing\n\tif current top-level function contained an undefined nested\n\tfunction.  Reset undef_nested_function at the end of a top-level\n\tfunction.\n\ntestsuite:\n\t* gcc.dg/nested-func-3.c: New test.\n\t* gcc.dg/pr18596-3.c: Expect error for undefined nested function.\n\nFrom-SVN: r94645", "tree": {"sha": "364e34ebace79fcfdc6374fb770c5ba7d7e4e33e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/364e34ebace79fcfdc6374fb770c5ba7d7e4e33e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/73aea290cc5417e4025eb92d95afaf1eeab73631", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73aea290cc5417e4025eb92d95afaf1eeab73631", "html_url": "https://github.com/Rust-GCC/gccrs/commit/73aea290cc5417e4025eb92d95afaf1eeab73631", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73aea290cc5417e4025eb92d95afaf1eeab73631/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f732f61ea2ac643e30b8068ee3f6737f07de271", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f732f61ea2ac643e30b8068ee3f6737f07de271", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f732f61ea2ac643e30b8068ee3f6737f07de271"}], "stats": {"total": 54, "additions": 53, "deletions": 1}, "files": [{"sha": "ee74a41e9567ee670a5c5e26a2ca585c22f67a69", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=73aea290cc5417e4025eb92d95afaf1eeab73631", "patch": "@@ -1,3 +1,13 @@\n+2005-02-03  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/17807\n+\t* c-decl.c (undef_nested_function): New variable.\n+\t(pop_scope): Diagnose undefined nested functions.\n+\t(finish_function): Don't attempt cgraph processing or genericizing\n+\tif current top-level function contained an undefined nested\n+\tfunction.  Reset undef_nested_function at the end of a top-level\n+\tfunction.\n+\n 2005-02-02  Zdenek Dvorak  <dvorakz@suse.cz>\n \n \t* tree.c (build_int_cst_type): Take sign of the value into account"}, {"sha": "0b7b97ede23bf624f6b421f36322b679d5fb4ee5", "filename": "gcc/c-decl.c", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=73aea290cc5417e4025eb92d95afaf1eeab73631", "patch": "@@ -149,6 +149,11 @@ static int warn_about_return_type;\n \n static int current_extern_inline;\n \n+/* Nonzero when the current toplevel function contains a declaration\n+   of a nested function which is never defined.  */\n+\n+static bool undef_nested_function;\n+\n /* True means global_bindings_p should return false even if the scope stack\n    says we are in file scope.  */\n bool c_override_global_bindings_to_false;\n@@ -759,6 +764,12 @@ pop_scope (void)\n \t      && DECL_ABSTRACT_ORIGIN (p) != 0\n \t      && DECL_ABSTRACT_ORIGIN (p) != p)\n \t    TREE_ADDRESSABLE (DECL_ABSTRACT_ORIGIN (p)) = 1;\n+\t  if (!DECL_EXTERNAL (p)\n+\t      && DECL_INITIAL (p) == 0)\n+\t    {\n+\t      error (\"%Jnested function %qD declared but never defined\", p, p);\n+\t      undef_nested_function = true;\n+\t    }\n \t  goto common_symbol;\n \n \tcase VAR_DECL:\n@@ -6376,7 +6387,8 @@ finish_function (void)\n      until their parent function is genericized.  Since finalizing\n      requires GENERIC, delay that as well.  */\n \n-  if (DECL_INITIAL (fndecl) && DECL_INITIAL (fndecl) != error_mark_node)\n+  if (DECL_INITIAL (fndecl) && DECL_INITIAL (fndecl) != error_mark_node\n+      && !undef_nested_function)\n     {\n       if (!decl_function_context (fndecl))\n         {\n@@ -6402,6 +6414,9 @@ finish_function (void)\n         }\n     }\n \n+  if (!decl_function_context (fndecl))\n+    undef_nested_function = false;\n+\n   /* We're leaving the context of this function, so zap cfun.\n      It's still in DECL_STRUCT_FUNCTION, and we'll restore it in\n      tree_rest_of_compilation.  */"}, {"sha": "1d80350306aee0630f956c5962913f57f9419003", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=73aea290cc5417e4025eb92d95afaf1eeab73631", "patch": "@@ -1,3 +1,9 @@\n+2005-02-03  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/17807\n+\t* gcc.dg/nested-func-3.c: New test.\n+\t* gcc.dg/pr18596-3.c: Expect error for undefined nested function.\n+\n 2005-02-02  Janis Johnson  <janis187@us.ibm.com>\n \n \t* gcc.test-framework/gen_directive_tests: Generate tests for"}, {"sha": "c4c016cfc4b79ba71b087564ece221213197eb44", "filename": "gcc/testsuite/gcc.dg/nested-func-3.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Ftestsuite%2Fgcc.dg%2Fnested-func-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Ftestsuite%2Fgcc.dg%2Fnested-func-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fnested-func-3.c?ref=73aea290cc5417e4025eb92d95afaf1eeab73631", "patch": "@@ -0,0 +1,20 @@\n+/* Undefined nested function should be a error, whether or not the\n+   function is called.  Bug 17807.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+void\n+f (void)\n+{\n+  auto int fn (int); /* { dg-error \"error: nested function 'fn' declared but never defined\" } */\n+  auto int fn2 (int); /* { dg-error \"error: nested function 'fn2' declared but never defined\" } */\n+  sizeof(fn(1));\n+}\n+\n+void\n+h (void)\n+{\n+  auto int hn (int); /* { dg-error \"error: nested function 'hn' declared but never defined\" } */\n+  hn (1);\n+}"}, {"sha": "74a6e63b56a0d7e20f1e5a5eda8afdc4d0329f41", "filename": "gcc/testsuite/gcc.dg/pr18596-3.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Ftestsuite%2Fgcc.dg%2Fpr18596-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73aea290cc5417e4025eb92d95afaf1eeab73631/gcc%2Ftestsuite%2Fgcc.dg%2Fpr18596-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr18596-3.c?ref=73aea290cc5417e4025eb92d95afaf1eeab73631", "patch": "@@ -6,6 +6,7 @@ int foo ()\n   static g () = 0; /* { dg-error \"invalid storage class\" } */\n   static int f () = 1; /* { dg-error \"invalid storage class\" } */\n   auto int h () = 0; /* { dg-error \"initialized like a variable\" } */\n+  /* { dg-error \"declared but never defined\" \"nested\" { target *-*-* } 8 } */\n   static int i () = { 0 }; /* { dg-error \"invalid storage class\" } */\n   static int j () = /* { dg-error \"invalid storage class\" } */\n \t{ 0, 0.0 };"}]}