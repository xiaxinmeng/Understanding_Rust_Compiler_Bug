{"sha": "d07f74faa60a3604b14e1ad7c25ac983731f0394", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDA3Zjc0ZmFhNjBhMzYwNGIxNGUxYWQ3YzI1YWM5ODM3MzFmMDM5NA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2019-11-10T18:10:51Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-11-10T18:10:51Z"}, "message": "* cgraph.c (cgraph_edge::maybe_hot_p): Do not use sreal_frequency.\n\nFrom-SVN: r278021", "tree": {"sha": "74341a584cf3a0993cf76bdbd761394bdc84523a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74341a584cf3a0993cf76bdbd761394bdc84523a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d07f74faa60a3604b14e1ad7c25ac983731f0394", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d07f74faa60a3604b14e1ad7c25ac983731f0394", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d07f74faa60a3604b14e1ad7c25ac983731f0394", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d07f74faa60a3604b14e1ad7c25ac983731f0394/comments", "author": null, "committer": null, "parents": [{"sha": "d40e2362bb6dcff1ec3905cd8db1ad7e5ee4a1dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d40e2362bb6dcff1ec3905cd8db1ad7e5ee4a1dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d40e2362bb6dcff1ec3905cd8db1ad7e5ee4a1dd"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "bdc3067e63cdd88d8434972d75b72945db8af13f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d07f74faa60a3604b14e1ad7c25ac983731f0394/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d07f74faa60a3604b14e1ad7c25ac983731f0394/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d07f74faa60a3604b14e1ad7c25ac983731f0394", "patch": "@@ -1,3 +1,7 @@\n+2019-11-10  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* cgraph.c (cgraph_edge::maybe_hot_p): Do not use sreal_frequency.\n+\n 2019-11-10  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-prop.c (ipa_propagate_indirect_call_infos): Remove ipa edge"}, {"sha": "aa54e955c76c4958b73f29628610ab65b87bfcaf", "filename": "gcc/cgraph.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d07f74faa60a3604b14e1ad7c25ac983731f0394/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d07f74faa60a3604b14e1ad7c25ac983731f0394/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=d07f74faa60a3604b14e1ad7c25ac983731f0394", "patch": "@@ -2697,14 +2697,18 @@ cgraph_edge::maybe_hot_p (void)\n     return false;\n   if (caller->frequency == NODE_FREQUENCY_HOT)\n     return true;\n-  /* If profile is now known yet, be conservative.\n-     FIXME: this predicate is used by early inliner and can do better there.  */\n-  if (symtab->state < IPA_SSA)\n+  if (!count.initialized_p ())\n     return true;\n-  if (caller->frequency == NODE_FREQUENCY_EXECUTED_ONCE\n-      && sreal_frequency () * 2 < 3)\n+  cgraph_node *where = caller->inlined_to ? caller->inlined_to : caller;\n+  if (!where->count.initialized_p ())\n     return false;\n-  if (sreal_frequency () * PARAM_VALUE (HOT_BB_FREQUENCY_FRACTION) <= 1)\n+  if (caller->frequency == NODE_FREQUENCY_EXECUTED_ONCE)\n+    {\n+      if (count.apply_scale (2, 1) < where->count.apply_scale (3, 1))\n+\treturn false;\n+    }\n+  else if (count.apply_scale (PARAM_VALUE (HOT_BB_FREQUENCY_FRACTION), 1)\n+\t   < where->count)\n     return false;\n   return true;\n }"}]}