{"sha": "5057f9e00f35616b7739680d0838bbb76a1e331b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTA1N2Y5ZTAwZjM1NjE2Yjc3Mzk2ODBkMDgzOGJiYjc2YTFlMzMxYg==", "commit": {"author": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2017-05-08T23:53:14Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gcc.gnu.org", "date": "2017-05-08T23:53:14Z"}, "message": "xtensa: add support for SSP\n\ngcc/\n2017-05-08  Max Filippov  <jcmvbkbc@gmail.com>\n\n\t* config/xtensa/xtensa-protos.h\n       \t(xtensa_initial_elimination_offset): New declaration.\n\t* config/xtensa/xtensa.c (xtensa_initial_elimination_offset):\n\tNew function. Move its body from the INITIAL_ELIMINATION_OFFSET\n\tmacro definition, add case for FRAME_POINTER_REGNUM when\n\tFRAME_GROWS_DOWNWARD.\n\t* config/xtensa/xtensa.h (FRAME_GROWS_DOWNWARD): New macro\n\tdefinition.\n\t(INITIAL_ELIMINATION_OFFSET): Replace body with call to\n\txtensa_initial_elimination_offset.\n\nFrom-SVN: r247771", "tree": {"sha": "80b16fbd3ca779686cd1e7482ba8b3bf6fb38b2c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/80b16fbd3ca779686cd1e7482ba8b3bf6fb38b2c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5057f9e00f35616b7739680d0838bbb76a1e331b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5057f9e00f35616b7739680d0838bbb76a1e331b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5057f9e00f35616b7739680d0838bbb76a1e331b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5057f9e00f35616b7739680d0838bbb76a1e331b/comments", "author": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "26ffe6942c8d5c38600e3385fc1b1ba9c3ea78ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26ffe6942c8d5c38600e3385fc1b1ba9c3ea78ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26ffe6942c8d5c38600e3385fc1b1ba9c3ea78ee"}], "stats": {"total": 57, "additions": 42, "deletions": 15}, "files": [{"sha": "2bfe7043ec71546ea2a17856519a86abf9093615", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5057f9e00f35616b7739680d0838bbb76a1e331b", "patch": "@@ -1,3 +1,16 @@\n+2017-05-08  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* config/xtensa/xtensa-protos.h\n+       \t(xtensa_initial_elimination_offset): New declaration.\n+\t* config/xtensa/xtensa.c (xtensa_initial_elimination_offset):\n+\tNew function. Move its body from the INITIAL_ELIMINATION_OFFSET\n+\tmacro definition, add case for FRAME_POINTER_REGNUM when\n+\tFRAME_GROWS_DOWNWARD.\n+\t* config/xtensa/xtensa.h (FRAME_GROWS_DOWNWARD): New macro\n+\tdefinition.\n+\t(INITIAL_ELIMINATION_OFFSET): Replace body with call to\n+\txtensa_initial_elimination_offset.\n+\n 2017-05-08  Nathan Sidwell  <nathan@acm.org>\n \n \t* doc/invoke.texi: Alphabetize -fdump options."}, {"sha": "dac5657948e5ae684cae4dc61eef9f1c91d4acfd", "filename": "gcc/config/xtensa/xtensa-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2Fconfig%2Fxtensa%2Fxtensa-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2Fconfig%2Fxtensa%2Fxtensa-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa-protos.h?ref=5057f9e00f35616b7739680d0838bbb76a1e331b", "patch": "@@ -73,5 +73,6 @@ extern void xtensa_expand_prologue (void);\n extern void xtensa_expand_epilogue (void);\n extern void order_regs_for_local_alloc (void);\n extern enum reg_class xtensa_regno_to_class (int regno);\n+extern HOST_WIDE_INT xtensa_initial_elimination_offset (int from, int to);\n \n #endif /* !__XTENSA_PROTOS_H__ */"}, {"sha": "015dd1049fb23b0ebace45e4e0bdcdc21a6088d6", "filename": "gcc/config/xtensa/xtensa.c", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2Fconfig%2Fxtensa%2Fxtensa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.c?ref=5057f9e00f35616b7739680d0838bbb76a1e331b", "patch": "@@ -2676,6 +2676,30 @@ xtensa_frame_pointer_required (void)\n   return false;\n }\n \n+HOST_WIDE_INT\n+xtensa_initial_elimination_offset (int from, int to)\n+{\n+  long frame_size = compute_frame_size (get_frame_size ());\n+  HOST_WIDE_INT offset;\n+\n+  switch (from)\n+    {\n+    case FRAME_POINTER_REGNUM:\n+      if (FRAME_GROWS_DOWNWARD)\n+\toffset = frame_size - (WINDOW_SIZE * UNITS_PER_WORD)\n+\t  - cfun->machine->callee_save_size;\n+      else\n+\toffset = 0;\n+      break;\n+    case ARG_POINTER_REGNUM:\n+      offset = frame_size;\n+      break;\n+    default:\n+      gcc_unreachable ();\n+    }\n+\n+  return offset;\n+}\n \n /* minimum frame = reg save area (4 words) plus static chain (1 word)\n    and the total number of words must be a multiple of 128 bits.  */"}, {"sha": "08457a435a26f1cd7f6f211cf4717e4a46b43f0a", "filename": "gcc/config/xtensa/xtensa.h", "status": "modified", "additions": 4, "deletions": 15, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5057f9e00f35616b7739680d0838bbb76a1e331b/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.h?ref=5057f9e00f35616b7739680d0838bbb76a1e331b", "patch": "@@ -460,9 +460,11 @@ enum reg_class\n \n #define STACK_GROWS_DOWNWARD 1\n \n+#define FRAME_GROWS_DOWNWARD flag_stack_protect\n+\n /* Offset within stack frame to start allocating local variables at.  */\n #define STARTING_FRAME_OFFSET\t\t\t\t\t\t\\\n-  crtl->outgoing_args_size\n+  (FRAME_GROWS_DOWNWARD ? 0 : crtl->outgoing_args_size)\n \n /* The ARG_POINTER and FRAME_POINTER are not real Xtensa registers, so\n    they are eliminated to either the stack pointer or hard frame pointer.  */\n@@ -474,20 +476,7 @@ enum reg_class\n \n /* Specify the initial difference between the specified pair of registers.  */\n #define INITIAL_ELIMINATION_OFFSET(FROM, TO, OFFSET)\t\t\t\\\n-  do {\t\t\t\t\t\t\t\t\t\\\n-    long frame_size = compute_frame_size (get_frame_size ());\t\t\\\n-    switch (FROM)\t\t\t\t\t\t\t\\\n-      {\t\t\t\t\t\t\t\t\t\\\n-      case FRAME_POINTER_REGNUM:\t\t\t\t\t\\\n-        (OFFSET) = 0;\t\t\t\t\t\t\t\\\n-\tbreak;\t\t\t\t\t\t\t\t\\\n-      case ARG_POINTER_REGNUM:\t\t\t\t\t\t\\\n-        (OFFSET) = frame_size;\t\t\t\t\t\t\\\n-\tbreak;\t\t\t\t\t\t\t\t\\\n-      default:\t\t\t\t\t\t\t\t\\\n-\tgcc_unreachable ();\t\t\t\t\t\t\\\n-      }\t\t\t\t\t\t\t\t\t\\\n-  } while (0)\n+  (OFFSET) = xtensa_initial_elimination_offset ((FROM), (TO))\n \n /* If defined, the maximum amount of space required for outgoing\n    arguments will be computed and placed into the variable"}]}