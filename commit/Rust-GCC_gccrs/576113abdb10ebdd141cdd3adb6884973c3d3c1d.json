{"sha": "576113abdb10ebdd141cdd3adb6884973c3d3c1d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTc2MTEzYWJkYjEwZWJkZDE0MWNkZDNhZGI2ODg0OTczYzNkM2MxZA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2019-09-27T19:23:39Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-09-27T19:23:39Z"}, "message": "[Darwin, PPC, Mode Iterators 3/n] Update macho_correct_pic.\n\nDrop the expander and use a mode expander on the define_insn\nfor macho_correct_pic instead.\n\ngcc/ChangeLog:\n\n2019-09-27  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config/rs6000/darwin.md (@macho_correct_pic_<mode>): New,\n\treplaces the expander and two define_insn entries.\n\t(@reload_macho_picbase_<mode>): Update gen_macho_correct_pic\n\tcall.\n\t* config/rs6000/rs6000.md (builtin_setjmp_receiver): Likewise.\n\nFrom-SVN: r276196", "tree": {"sha": "58ed47b06f6ae9e8491a872abbff1ab4d8579e47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/58ed47b06f6ae9e8491a872abbff1ab4d8579e47"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/576113abdb10ebdd141cdd3adb6884973c3d3c1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/576113abdb10ebdd141cdd3adb6884973c3d3c1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/576113abdb10ebdd141cdd3adb6884973c3d3c1d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/576113abdb10ebdd141cdd3adb6884973c3d3c1d/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26a23d11ed473563344d16a5b643795628e1b990", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26a23d11ed473563344d16a5b643795628e1b990", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26a23d11ed473563344d16a5b643795628e1b990"}], "stats": {"total": 62, "additions": 22, "deletions": 40}, "files": [{"sha": "c935cf3d3d462999625c17a47c03aa0ab0f320dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/576113abdb10ebdd141cdd3adb6884973c3d3c1d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/576113abdb10ebdd141cdd3adb6884973c3d3c1d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=576113abdb10ebdd141cdd3adb6884973c3d3c1d", "patch": "@@ -1,3 +1,11 @@\n+2019-09-27  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/rs6000/darwin.md (@macho_correct_pic_<mode>): New,\n+\treplaces the expander and two define_insn entries.\n+\t(@reload_macho_picbase_<mode>): Update gen_macho_correct_pic\n+\tcall.\n+\t* config/rs6000/rs6000.md (builtin_setjmp_receiver): Likewise.\n+\n 2019-09-27  David Malcolm  <dmalcolm@redhat.com>\n \n \t* fibonacci_heap.h (fibonacci_heap::empty): Make const."}, {"sha": "b2a52d81b3f42e897e7f51fe81cb5292026d8346", "filename": "gcc/config/rs6000/darwin.md", "status": "modified", "additions": 12, "deletions": 39, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/576113abdb10ebdd141cdd3adb6884973c3d3c1d/gcc%2Fconfig%2Frs6000%2Fdarwin.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/576113abdb10ebdd141cdd3adb6884973c3d3c1d/gcc%2Fconfig%2Frs6000%2Fdarwin.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdarwin.md?ref=576113abdb10ebdd141cdd3adb6884973c3d3c1d", "patch": "@@ -216,6 +216,16 @@ You should have received a copy of the GNU General Public License\n \t(match_dup 2))]\n   \"\")\n \n+(define_insn \"@macho_correct_pic_<mode>\"\n+  [(set (match_operand:P 0 \"gpc_reg_operand\" \"=r\")\n+\t(plus:P (match_operand:P 1 \"gpc_reg_operand\" \"r\")\n+\t\t (unspec:P [(match_operand:P 2 \"immediate_operand\" \"s\")\n+\t\t\t     (match_operand:P 3 \"immediate_operand\" \"s\")]\n+\t\t\t    UNSPEC_MPIC_CORRECT)))]\n+  \"DEFAULT_ABI == ABI_DARWIN\"\n+  \"addis %0,%1,ha16(%2-%3)\\n\\taddi %0,%0,lo16(%2-%3)\"\n+  [(set_attr \"length\" \"8\")])\n+\n (define_insn \"@load_macho_picbase_<mode>\"\n   [(set (reg:P LR_REGNO)\n \t(unspec:P [(match_operand:P 0 \"immediate_operand\" \"s\")\n@@ -232,44 +242,6 @@ You should have received a copy of the GNU General Public License\n   [(set_attr \"type\" \"branch\")\n    (set_attr \"cannot_copy\" \"yes\")])\n \n-(define_expand \"macho_correct_pic\"\n-  [(set (match_operand 0 \"\")\n-\t(plus (match_operand 1 \"\")\n-\t\t (unspec [(match_operand 2 \"\")\n-\t\t\t     (match_operand 3 \"\")]\n-\t\t\t    UNSPEC_MPIC_CORRECT)))]\n-  \"DEFAULT_ABI == ABI_DARWIN\"\n-{\n-  if (TARGET_32BIT)\n-    emit_insn (gen_macho_correct_pic_si (operands[0], operands[1], operands[2],\n-\t       operands[3]));\n-  else\n-    emit_insn (gen_macho_correct_pic_di (operands[0], operands[1], operands[2],\n-\t       operands[3]));\n-\n-  DONE;\n-})\n-\n-(define_insn \"macho_correct_pic_si\"\n-  [(set (match_operand:SI 0 \"gpc_reg_operand\" \"=r\")\n-\t(plus:SI (match_operand:SI 1 \"gpc_reg_operand\" \"r\")\n-\t\t (unspec:SI [(match_operand:SI 2 \"immediate_operand\" \"s\")\n-\t\t\t     (match_operand:SI 3 \"immediate_operand\" \"s\")]\n-\t\t\t    UNSPEC_MPIC_CORRECT)))]\n-  \"DEFAULT_ABI == ABI_DARWIN\"\n-  \"addis %0,%1,ha16(%2-%3)\\n\\taddi %0,%0,lo16(%2-%3)\"\n-  [(set_attr \"length\" \"8\")])\n-\n-(define_insn \"macho_correct_pic_di\"\n-  [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=r\")\n-\t(plus:DI (match_operand:DI 1 \"gpc_reg_operand\" \"r\")\n-\t\t (unspec:DI [(match_operand:DI 2 \"immediate_operand\" \"s\")\n-\t\t\t     (match_operand:DI 3 \"immediate_operand\" \"s\")]\n-\t\t\t    16)))]\n-  \"DEFAULT_ABI == ABI_DARWIN && TARGET_64BIT\"\n-  \"addis %0,%1,ha16(%2-%3)\\n\\taddi %0,%0,lo16(%2-%3)\"\n-  [(set_attr \"length\" \"8\")])\n-\n (define_insn \"@reload_macho_picbase_<mode>\"\n   [(set (reg:P LR_REGNO)\n         (unspec:P [(match_operand:P 0 \"immediate_operand\" \"s\")\n@@ -316,7 +288,8 @@ You should have received a copy of the GNU General Public License\n \n       emit_insn (gen_reload_macho_picbase (Pmode, tmplrtx));\n       emit_move_insn (picreg, gen_rtx_REG (Pmode, LR_REGNO));\n-      emit_insn (gen_macho_correct_pic (picreg, picreg, picrtx, tmplrtx));\n+      emit_insn (gen_macho_correct_pic (Pmode, picreg, picreg,\n+\t\t\t\t\tpicrtx, tmplrtx));\n     }\n   else\n     /* Not using PIC reg, no reload needed.  */"}, {"sha": "46167e5f20fb3469a11b60241c905e5aae1f0a40", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/576113abdb10ebdd141cdd3adb6884973c3d3c1d/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/576113abdb10ebdd141cdd3adb6884973c3d3c1d/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=576113abdb10ebdd141cdd3adb6884973c3d3c1d", "patch": "@@ -10055,7 +10055,8 @@\n \n       emit_insn (gen_load_macho_picbase (Pmode, tmplabrtx));\n       emit_move_insn (picreg, gen_rtx_REG (Pmode, LR_REGNO));\n-      emit_insn (gen_macho_correct_pic (picreg, picreg, picrtx, tmplabrtx));\n+      emit_insn (gen_macho_correct_pic (Pmode, picreg, picreg,\n+\t\t\t\t\tpicrtx, tmplabrtx));\n     }\n   else\n #endif"}]}