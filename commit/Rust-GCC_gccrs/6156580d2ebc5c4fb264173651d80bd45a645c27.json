{"sha": "6156580d2ebc5c4fb264173651d80bd45a645c27", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjE1NjU4MGQyZWJjNWM0ZmIyNjQxNzM2NTFkODBiZDQ1YTY0NWMyNw==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1995-11-30T03:03:54Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1995-11-30T03:03:54Z"}, "message": "(_mcleanup): Add support for PROFDIR environment variable.\n\nFrom-SVN: r10637", "tree": {"sha": "9e772bf93f8bac90e34404ea2bb4d96755760af9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e772bf93f8bac90e34404ea2bb4d96755760af9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6156580d2ebc5c4fb264173651d80bd45a645c27", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6156580d2ebc5c4fb264173651d80bd45a645c27", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6156580d2ebc5c4fb264173651d80bd45a645c27", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6156580d2ebc5c4fb264173651d80bd45a645c27/comments", "author": null, "committer": null, "parents": [{"sha": "8b8def46d617422f5704092a2c92bbbbe2d3b629", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b8def46d617422f5704092a2c92bbbbe2d3b629", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b8def46d617422f5704092a2c92bbbbe2d3b629"}], "stats": {"total": 37, "additions": 31, "deletions": 6}, "files": [{"sha": "9b41c6492971a44d01ef3cbddab6dbbac7131a5e", "filename": "gcc/config/sparc/gmon-sol2.c", "status": "modified", "additions": 31, "deletions": 6, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6156580d2ebc5c4fb264173651d80bd45a645c27/gcc%2Fconfig%2Fsparc%2Fgmon-sol2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6156580d2ebc5c4fb264173651d80bd45a645c27/gcc%2Fconfig%2Fsparc%2Fgmon-sol2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fgmon-sol2.c?ref=6156580d2ebc5c4fb264173651d80bd45a645c27", "patch": "@@ -39,11 +39,11 @@\n static char sccsid[] = \"@(#)gmon.c\t5.3 (Berkeley) 5/22/91\";\n #endif /* not lint */\n \n-#include <unistd.h>\n-\n-#ifdef DEBUG\n #include <stdio.h>\n-#endif\n+#include <stdlib.h>\n+#include <string.h>\n+#include <limits.h>\n+#include <unistd.h>\n \n #if 0\n #include \"sparc/gmon.h\"\n@@ -172,6 +172,7 @@ monstartup(lowpc, highpc)\n     moncontrol(1);\n }\n \n+void\n _mcleanup()\n {\n     int\t\t\tfd;\n@@ -180,11 +181,35 @@ _mcleanup()\n     char\t\t*frompc;\n     int\t\t\ttoindex;\n     struct rawarc\trawarc;\n+    char\t\t*profdir;\n+    char\t\t*proffile;\n+    char\t\t*progname;\n+    char\t\t buf[PATH_MAX];\n+    extern char\t       **___Argv;\n \n     moncontrol(0);\n-    fd = creat( \"gmon.out\" , 0666 );\n+\n+    if ((profdir = getenv(\"PROFDIR\")) != NULL) {\n+\t/* If PROFDIR contains a null value, no profiling output is produced */\n+\tif (*profdir == '\\0') {\n+\t    return;\n+\t}\n+\n+\tprogname=strrchr(___Argv[0], '/');\n+\tif (progname == NULL)\n+\t    progname=___Argv[0];\n+\telse\n+\t    progname++;\n+\n+\tsprintf(buf, \"%s/%d.%s\", profdir, getpid(), progname);\n+\tproffile = buf;\n+    } else {\n+\tproffile = \"gmon.out\";\n+    }\n+\n+    fd = creat( proffile, 0666 );\n     if ( fd < 0 ) {\n-\tperror( \"mcount: gmon.out\" );\n+\tperror( proffile );\n \treturn;\n     }\n #   ifdef DEBUG"}]}