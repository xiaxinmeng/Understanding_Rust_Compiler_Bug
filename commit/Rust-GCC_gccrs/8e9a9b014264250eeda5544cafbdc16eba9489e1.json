{"sha": "8e9a9b014264250eeda5544cafbdc16eba9489e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGU5YTliMDE0MjY0MjUwZWVkYTU1NDRjYWZiZGMxNmViYTk0ODllMQ==", "commit": {"author": {"name": "Andrey Belevantsev", "email": "abel@ispras.ru", "date": "2018-04-09T09:42:25Z"}, "committer": {"name": "Andrey Belevantsev", "email": "abel@gcc.gnu.org", "date": "2018-04-09T09:42:25Z"}, "message": "re PR rtl-optimization/83913 (Compile time and memory hog w/ selective scheduling)\n\n       PR rtl-optimization/83913\n\n       * sel-sched-ir.c (merge_expr_data): Choose the middle between two\n       different sched-times when merging exprs.\n\n       * gcc.dg/pr83913.c: New test.\n\nFrom-SVN: r259230", "tree": {"sha": "084a26bd36d6ca02b7525caa82303dee556aede0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/084a26bd36d6ca02b7525caa82303dee556aede0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8e9a9b014264250eeda5544cafbdc16eba9489e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e9a9b014264250eeda5544cafbdc16eba9489e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e9a9b014264250eeda5544cafbdc16eba9489e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e9a9b014264250eeda5544cafbdc16eba9489e1/comments", "author": {"login": "abonzo", "id": 20396542, "node_id": "MDQ6VXNlcjIwMzk2NTQy", "avatar_url": "https://avatars.githubusercontent.com/u/20396542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonzo", "html_url": "https://github.com/abonzo", "followers_url": "https://api.github.com/users/abonzo/followers", "following_url": "https://api.github.com/users/abonzo/following{/other_user}", "gists_url": "https://api.github.com/users/abonzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonzo/subscriptions", "organizations_url": "https://api.github.com/users/abonzo/orgs", "repos_url": "https://api.github.com/users/abonzo/repos", "events_url": "https://api.github.com/users/abonzo/events{/privacy}", "received_events_url": "https://api.github.com/users/abonzo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ab6dceab101d62684d93655217f0ff5840c6ef5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab6dceab101d62684d93655217f0ff5840c6ef5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab6dceab101d62684d93655217f0ff5840c6ef5b"}], "stats": {"total": 46, "additions": 44, "deletions": 2}, "files": [{"sha": "a22c610bab7fa8804c783cee3d3647fb84950c42", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8e9a9b014264250eeda5544cafbdc16eba9489e1", "patch": "@@ -1,3 +1,10 @@\n+2018-04-09  Andrey Belevantsev  <abel@ispras.ru>\n+\n+\tPR rtl-optimization/83913\n+\n+\t* sel-sched-ir.c (merge_expr_data): Choose the middle between two\n+\tdifferent sched-times when merging exprs.\n+\n 2018-04-09  Andrey Belevantsev  <abel@ispras.ru>\n \n \tPR rtl-optimization/83962"}, {"sha": "6f1e5a1f90dae216897e29c0a245536fffc5dc35", "filename": "gcc/sel-sched-ir.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2Fsel-sched-ir.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2Fsel-sched-ir.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsel-sched-ir.c?ref=8e9a9b014264250eeda5544cafbdc16eba9489e1", "patch": "@@ -1837,8 +1837,12 @@ merge_expr_data (expr_t to, expr_t from, insn_t split_point)\n   if (EXPR_PRIORITY (to) < EXPR_PRIORITY (from))\n     EXPR_PRIORITY (to) = EXPR_PRIORITY (from);\n \n-  if (EXPR_SCHED_TIMES (to) > EXPR_SCHED_TIMES (from))\n-    EXPR_SCHED_TIMES (to) = EXPR_SCHED_TIMES (from);\n+  /* We merge sched-times half-way to the larger value to avoid the endless\n+     pipelining of unneeded insns.  The average seems to be good compromise\n+     between pipelining opportunities and avoiding extra work.  */\n+  if (EXPR_SCHED_TIMES (to) != EXPR_SCHED_TIMES (from))\n+    EXPR_SCHED_TIMES (to) = ((EXPR_SCHED_TIMES (from) + EXPR_SCHED_TIMES (to)\n+                             + 1) / 2);\n \n   if (EXPR_ORIG_BB_INDEX (to) != EXPR_ORIG_BB_INDEX (from))\n     EXPR_ORIG_BB_INDEX (to) = 0;"}, {"sha": "2de94af83e2ecf7c6fae53087b10cfc7f4dcf89a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8e9a9b014264250eeda5544cafbdc16eba9489e1", "patch": "@@ -1,3 +1,8 @@\n+2018-04-09  Andrey Belevantsev  <abel@ispras.ru>\n+\n+\tPR rtl-optimization/83913\n+\t* gcc.dg/pr83913.c: New test.\n+\n 2018-04-09  Andrey Belevantsev  <abel@ispras.ru>\n \n \tPR rtl-optimization/83962"}, {"sha": "c898d71a261dd8f0d4a668c9f4d303a0c027b3c4", "filename": "gcc/testsuite/gcc.dg/pr83913.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83913.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e9a9b014264250eeda5544cafbdc16eba9489e1/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83913.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83913.c?ref=8e9a9b014264250eeda5544cafbdc16eba9489e1", "patch": "@@ -0,0 +1,26 @@\n+/* { dg-do compile { target powerpc*-*-* ia64-*-* i?86-*-* x86_64-*-* } } */\n+/* { dg-options \"-O2 -funroll-all-loops -fselective-scheduling -fsel-sched-pipelining -fschedule-insns -fno-dce -fno-forward-propagate -fno-rerun-cse-after-loop -fno-web\" } */\n+\n+int jo, z4;\n+\n+int\n+be (long unsigned int l7, int nt)\n+{\n+  int en;\n+\n+  jo = l7;\n+  for (en = 0; en < 24; ++en)\n+    {\n+      jo = (jo / z4) * (!!jo >= ((!!nt) & 2));\n+      if (jo == 0)\n+        nt = 0;\n+      else\n+        {\n+          nt = z4;\n+          ++z4;\n+          nt = (long unsigned int) nt == (l7 + 1);\n+        }\n+    }\n+\n+  return nt;\n+}"}]}