{"sha": "642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjQyZDk3ZmYwMGFhYTJkODZkOTM3N2JmNjIxN2JkOGRlMjQzZDhlNQ==", "commit": {"author": {"name": "Adam Nemet", "email": "anemet@caviumnetworks.com", "date": "2009-05-20T21:47:57Z"}, "committer": {"name": "Adam Nemet", "email": "nemet@gcc.gnu.org", "date": "2009-05-20T21:47:57Z"}, "message": "* config/mips/mips.md (*extenddi_truncate<mode>,\n\n\t*extendsi_truncate<mode>): Emit exts if supported.  Add attribute\n\tdefintions.\n\t(*extendhi_truncateqi): New define_insn_and_sptit.\n\ntestsuite/\n\t* gcc.target/mips/octeon-exts-6.c: New test.\n\t* gcc.target/mips/extend-1.c: New test.\n\t* gcc.target/mips/octeon-exts-2.c: Adjust to not match sign-extension\n\tEXTS.\n\t* gcc.target/mips/octeon-exts-5.c: Likewise.\n\nFrom-SVN: r147751", "tree": {"sha": "c79db831e242d0d4c4fe9824f85e4ad48c144663", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c79db831e242d0d4c4fe9824f85e4ad48c144663"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/comments", "author": null, "committer": null, "parents": [{"sha": "776248b87e53e18386405561ca260c665ca6bdb7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/776248b87e53e18386405561ca260c665ca6bdb7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/776248b87e53e18386405561ca260c665ca6bdb7"}], "stats": {"total": 100, "additions": 90, "deletions": 10}, "files": [{"sha": "fcc619c4c88cc888984208cf6b3d9e6fe82e1d63", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -1,3 +1,10 @@\n+2009-05-20  Adam Nemet  <anemet@caviumnetworks.com>\n+\n+\t* config/mips/mips.md (*extenddi_truncate<mode>,\n+\t*extendsi_truncate<mode>): Emit exts if supported.  Add attribute\n+\tdefintions.\n+\t(*extendhi_truncateqi): New define_insn_and_sptit.\n+\n 2009-05-20  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/40204"}, {"sha": "81ed584e4fcc6d8502c66e46ffa24c14e0de9864", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 41, "deletions": 6, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -3017,8 +3017,13 @@\n \t(sign_extend:DI\n \t    (truncate:SHORT (match_operand:DI 1 \"register_operand\" \"d\"))))]\n   \"TARGET_64BIT && !TARGET_MIPS16\"\n-  \"#\"\n-  \"&& reload_completed\"\n+{\n+  if (!ISA_HAS_EXTS)\n+    return \"#\";\n+  operands[2] = GEN_INT (GET_MODE_BITSIZE (<SHORT:MODE>mode));\n+  return \"exts\\t%0,%1,0,%m2\";\n+}\n+  \"&& reload_completed && !ISA_HAS_EXTS\"\n   [(set (match_dup 2)\n \t(ashift:DI (match_dup 1)\n \t\t   (match_dup 3)))\n@@ -3028,15 +3033,22 @@\n {\n   operands[2] = gen_lowpart (DImode, operands[0]);\n   operands[3] = GEN_INT (BITS_PER_WORD - GET_MODE_BITSIZE (<MODE>mode));\n-})\n+}\n+  [(set_attr \"type\" \"arith\")\n+   (set_attr \"mode\" \"DI\")])\n \n (define_insn_and_split \"*extendsi_truncate<mode>\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=d\")\n \t(sign_extend:SI\n \t    (truncate:SHORT (match_operand:DI 1 \"register_operand\" \"d\"))))]\n   \"TARGET_64BIT && !TARGET_MIPS16\"\n-  \"#\"\n-  \"&& reload_completed\"\n+{\n+  if (!ISA_HAS_EXTS)\n+    return \"#\";\n+  operands[2] = GEN_INT (GET_MODE_BITSIZE (<SHORT:MODE>mode));\n+  return \"exts\\t%0,%1,0,%m2\";\n+}\n+  \"&& reload_completed && !ISA_HAS_EXTS\"\n   [(set (match_dup 2)\n \t(ashift:DI (match_dup 1)\n \t\t   (match_dup 3)))\n@@ -3046,7 +3058,30 @@\n {\n   operands[2] = gen_lowpart (DImode, operands[0]);\n   operands[3] = GEN_INT (BITS_PER_WORD - GET_MODE_BITSIZE (<MODE>mode));\n-})\n+}\n+  [(set_attr \"type\" \"arith\")\n+   (set_attr \"mode\" \"SI\")])\n+\n+(define_insn_and_split \"*extendhi_truncateqi\"\n+  [(set (match_operand:HI 0 \"register_operand\" \"=d\")\n+\t(sign_extend:HI\n+\t    (truncate:QI (match_operand:DI 1 \"register_operand\" \"d\"))))]\n+  \"TARGET_64BIT && !TARGET_MIPS16\"\n+{\n+  return ISA_HAS_EXTS ? \"exts\\t%0,%1,0,7\" : \"#\";\n+}\n+  \"&& reload_completed && !ISA_HAS_EXTS\"\n+  [(set (match_dup 2)\n+\t(ashift:DI (match_dup 1)\n+\t\t   (const_int 56)))\n+   (set (match_dup 0)\n+\t(truncate:HI (ashiftrt:DI (match_dup 2)\n+\t\t\t\t  (const_int 56))))]\n+{\n+  operands[2] = gen_lowpart (DImode, operands[0]);\n+}\n+  [(set_attr \"type\" \"arith\")\n+   (set_attr \"mode\" \"SI\")])\n \n (define_insn \"extendsfdf2\"\n   [(set (match_operand:DF 0 \"register_operand\" \"=f\")"}, {"sha": "6c693b8f36a08687978f964a7a46bd94d3d5a78a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -1,3 +1,11 @@\n+2009-05-20  Adam Nemet  <anemet@caviumnetworks.com>\n+\n+\t* gcc.target/mips/octeon-exts-6.c: New test.\n+\t* gcc.target/mips/extend-1.c: New test.\n+\t* gcc.target/mips/octeon-exts-2.c: Adjust to not match sign-extension\n+\tEXTS.\n+\t* gcc.target/mips/octeon-exts-5.c: Likewise.\n+\n 2009-05-20  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/40204"}, {"sha": "952d4a0932cb654cc017672eccb0125344b04aff", "filename": "gcc/testsuite/gcc.target/mips/extend-1.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fextend-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fextend-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fextend-1.c?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-options \"-O -mgp64 isa=!octeon\" } */\n+/* { dg-final { scan-assembler-times \"\\tdsll\\t\" 5 } } */\n+/* { dg-final { scan-assembler-times \"\\tdsra\\t\" 5 } } */\n+/* { dg-final { scan-assembler-not \"\\tsll\\t\" } } */\n+\n+#define TEST_CHAR(T, N)\t\\\n+  NOMIPS16 T f##N (long long d, T *a, T *r) { T b = (char) d;  *r = b + *a; }\n+#define TEST_SHORT(T, N) \\\n+  NOMIPS16 T g##N (long long d, T *a, T *r) { T b = (short) d; *r = b + *a; }\n+#define TEST(T, N) TEST_CHAR (T, N) TEST_SHORT (T, N)\n+\n+TEST (int, 1);\n+TEST (long long, 2);\n+TEST_CHAR (short, 3);"}, {"sha": "42f2a3f8586293628fa31377532dd916496442b7", "filename": "gcc/testsuite/gcc.target/mips/octeon-exts-2.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-2.c?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -1,6 +1,7 @@\n /* { dg-do compile } */\n-/* { dg-options \"-O -march=octeon -meb\" } */\n-/* { dg-final { scan-assembler-times \"\\texts\\t\" 4 } } */\n+/* { dg-options \"-O -march=octeon -meb -dp\" } */\n+/* Don't match exts in sign-extension.  */\n+/* { dg-final { scan-assembler-times \"\\texts\\t\\[^\\\\n\\]*extv\" 4 } } */\n \n struct bar\n {"}, {"sha": "6ec7ac7296fe637c81c676850f44d6bbe9ba10e3", "filename": "gcc/testsuite/gcc.target/mips/octeon-exts-5.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-5.c?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -1,7 +1,8 @@\n /* -mel version of octeon-exts-2.c.  */\n /* { dg-do compile } */\n-/* { dg-options \"-O -march=octeon -mel\" } */\n-/* { dg-final { scan-assembler-times \"\\texts\\t\" 4 } } */\n+/* { dg-options \"-O -march=octeon -mel -dp\" } */\n+/* Don't match exts in sign-extension.  */\n+/* { dg-final { scan-assembler-times \"\\texts\\t\\[^\\\\n\\]*extv\" 4 } } */\n \n struct bar\n {"}, {"sha": "d04e27331d94c17224b72d14fc450d5f21f2ed1b", "filename": "gcc/testsuite/gcc.target/mips/octeon-exts-6.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d97ff00aaa2d86d9377bf6217bd8de243d8e5/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Focteon-exts-6.c?ref=642d97ff00aaa2d86d9377bf6217bd8de243d8e5", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-options \"-O -march=octeon -mgp64\" } */\n+/* { dg-final { scan-assembler-times \"\\texts\\t\" 5 } } */\n+/* { dg-final { scan-assembler-not \"\\t(dsll|dsra)\\t\" } } */\n+/* { dg-final { scan-assembler-not \"\\tsll\\t\" } } */\n+\n+#define TEST_CHAR(T, N)\t\\\n+  NOMIPS16 T f##N (long long d, T *a, T *r) { T b = (char) d;  *r = b + *a; }\n+#define TEST_SHORT(T, N) \\\n+  NOMIPS16 T g##N (long long d, T *a, T *r) { T b = (short) d; *r = b + *a; }\n+#define TEST(T, N) TEST_CHAR (T, N) TEST_SHORT (T, N)\n+\n+TEST (int, 1);\n+TEST (long long, 2);\n+TEST_CHAR (short, 3);"}]}