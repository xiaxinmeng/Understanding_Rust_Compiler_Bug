{"sha": "e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTA3NTU0ZWIxNzQ3YWY3YTZmZDY0NzllZTM4ZGIzYTA0YWEwOGUyZA==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@unitus.it", "date": "2002-02-05T11:35:48Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2002-02-05T11:35:48Z"}, "message": "locale_facets.tcc (money_get::do_get(string)): First construct a tentative returned string...\n\n2002-02-05  Paolo Carlini  <pcarlini@unitus.it>\n\n\t* include/bits/locale_facets.tcc (money_get::do_get(string)):\n\tFirst construct a tentative returned string, then, only if the\n\tparsing succeeds, copy it into the string passed by reference.\n\t* testsuite/22_locale/money_get_members_char.cc: Add test06.\n\t* testsuite/22_locale/money_get_members_wchar_t.cc: Add test06.\n\nFrom-SVN: r49523", "tree": {"sha": "dc15baef8496d5588c6b2c353f1b467628ccaa0f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dc15baef8496d5588c6b2c353f1b467628ccaa0f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/comments", "author": null, "committer": null, "parents": [{"sha": "4505024e9e20966e5cf59625bdf15467701d7732", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4505024e9e20966e5cf59625bdf15467701d7732", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4505024e9e20966e5cf59625bdf15467701d7732"}], "stats": {"total": 99, "additions": 94, "deletions": 5}, "files": [{"sha": "835da3319f5c7271a1bb748e6828d3184885330b", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "patch": "@@ -1,3 +1,11 @@\n+2002-02-05  Paolo Carlini  <pcarlini@unitus.it>\n+\n+\t* include/bits/locale_facets.tcc (money_get::do_get(string)):\n+\tFirst construct a tentative returned string, then, only if the\n+\tparsing succeeds, copy it into the string passed by reference.\n+\t* testsuite/22_locale/money_get_members_char.cc: Add test06.\n+\t* testsuite/22_locale/money_get_members_wchar_t.cc: Add test06.\n+\n 2002-02-04  Phil Edwards  <pme@gcc.gnu.org>\n \n \t* docs/doxygen/TODO:  Impl-defined behavior now documented..."}, {"sha": "3a35139cece62045336ead77f35b9fc803a733dd", "filename": "libstdc++-v3/include/bits/locale_facets.tcc", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc?ref=e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "patch": "@@ -930,6 +930,9 @@ namespace std\n       // Flag marking when a decimal point is found.\n       bool __testdecfound = false; \n \n+      // The tentative returned string is stored here.\n+      string_type __temp_units;\n+\n       char_type __c = *__beg;\n       char_type __eof = static_cast<char_type>(char_traits<char_type>::eof());\n       for (int __i = 0; __beg != __end && __i < 4 && __testvalid; ++__i)\n@@ -1019,7 +1022,7 @@ namespace std\n \t\t\t}\n \t\t      else\n \t\t\t{\n-\t\t\t  __units += __c;\n+\t\t\t  __temp_units += __c;\n \t\t\t  ++__sep_pos;\n \t\t\t}\n \t\t      __c = *(++__beg);\n@@ -1050,11 +1053,11 @@ namespace std\n \t}\n \n       // Strip leading zeros.\n-      while (__units[0] == __ctype.widen('0'))\n-\t__units.erase(__units.begin());\n+      while (__temp_units[0] == __ctype.widen('0'))\n+\t__temp_units.erase(__temp_units.begin());\n \n       if (__sign.size() && __sign == __neg_sign)\n-\t__units.insert(__units.begin(), __ctype.widen('-'));\n+\t__temp_units.insert(__temp_units.begin(), __ctype.widen('-'));\n \n       // Test for grouping fidelity.\n       if (__grouping.size() && __grouping_tmp.size())\n@@ -1068,8 +1071,12 @@ namespace std\n \t__err |= ios_base::eofbit;\n \n       // Iff valid sequence is not recognized.\n-      if (!__testvalid || !__units.size())\n+      if (!__testvalid || !__temp_units.size())\n \t__err |= ios_base::failbit;\n+      else\n+\t// Use the \"swap trick\" to copy __temp_units into __units.\n+\t__temp_units.swap(__units);\n+\n       return __beg; \n     }\n "}, {"sha": "249e8b20f00c350b990ddab0bbe88162a23eeec0", "filename": "libstdc++-v3/testsuite/22_locale/money_get_members_char.cc", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fmoney_get_members_char.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fmoney_get_members_char.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fmoney_get_members_char.cc?ref=e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "patch": "@@ -383,12 +383,49 @@ void test05()\n   VERIFY( valn_ns == \"-123456\" );\n }\n \n+void test06()\n+{\n+  using namespace std;\n+\n+  typedef istreambuf_iterator<char> InIt;\n+  InIt iend1, iend2, iend3;\n+\n+  locale loc;\n+  string buffer1(\"123\");\n+  string buffer2(\"456\");\n+  string buffer3(\"Golgafrincham\"); // From Nathan's original idea.\n+\n+  string val;\n+\n+  ios_base::iostate err;\n+\n+  const money_get<char,InIt>& mg =\n+    use_facet<money_get<char, InIt> >(loc);\n+\n+  istringstream fmt1(buffer1);\n+  InIt ibeg1(fmt1);\n+  mg.get(ibeg1,iend1,false,fmt1,err,val);\n+  VERIFY( val == buffer1 );\n+\n+  istringstream fmt2(buffer2);\n+  InIt ibeg2(fmt2);\n+  mg.get(ibeg2,iend2,false,fmt2,err,val);\n+  VERIFY( val == buffer2 );\n+\n+  val = buffer3;\n+  istringstream fmt3(buffer3);\n+  InIt ibeg3(fmt3);\n+  mg.get(ibeg3,iend3,false,fmt3,err,val);\n+  VERIFY( val == buffer3 );\n+}\n+\n int main()\n {\n   test01();\n   test02();\n   test03();\n   test04();\n   test05();\n+  test06();\n   return 0;\n }"}, {"sha": "798f4a8dabbaf66635bd3f44e1c4156062edfbb2", "filename": "libstdc++-v3/testsuite/22_locale/money_get_members_wchar_t.cc", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fmoney_get_members_wchar_t.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e07554eb1747af7a6fd6479ee38db3a04aa08e2d/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fmoney_get_members_wchar_t.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F22_locale%2Fmoney_get_members_wchar_t.cc?ref=e07554eb1747af7a6fd6479ee38db3a04aa08e2d", "patch": "@@ -384,6 +384,42 @@ void test05()\n   mg.get(ibegn_ns,iendn_ns,intl,fmtn_ns,err,valn_ns);\n   VERIFY( valn_ns == L\"-123456\" );\n }\n+\n+void test06()\n+{\n+  using namespace std;\n+\n+  typedef istreambuf_iterator<wchar_t> InIt;\n+  InIt iend1, iend2, iend3;\n+\n+  locale loc;\n+  wstring buffer1(L\"123\");\n+  wstring buffer2(L\"456\");\n+  wstring buffer3(L\"Golgafrincham\");\n+\n+  wstring val;\n+\n+  ios_base::iostate err;\n+\n+  const money_get<wchar_t,InIt>& mg =\n+    use_facet<money_get<wchar_t, InIt> >(loc);\n+\n+  wistringstream fmt1(buffer1);\n+  InIt ibeg1(fmt1);\n+  mg.get(ibeg1,iend1,false,fmt1,err,val);\n+  VERIFY( val == buffer1 );\n+\n+  wistringstream fmt2(buffer2);\n+  InIt ibeg2(fmt2);\n+  mg.get(ibeg2,iend2,false,fmt2,err,val);\n+  VERIFY( val == buffer2 );\n+\n+  val = buffer3;\n+  wistringstream fmt3(buffer3);\n+  InIt ibeg3(fmt3);\n+  mg.get(ibeg3,iend3,false,fmt3,err,val);\n+  VERIFY( val == buffer3 );\n+}\n #endif\n \n int main()\n@@ -394,6 +430,7 @@ int main()\n   test03();\n   test04();\n   test05();\n+  test06();\n #endif\n   return 0;\n }"}]}