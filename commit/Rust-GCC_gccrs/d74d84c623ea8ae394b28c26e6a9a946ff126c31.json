{"sha": "d74d84c623ea8ae394b28c26e6a9a946ff126c31", "node_id": "C_kwDOANBUbNoAKGQ3NGQ4NGM2MjNlYThhZTM5NGIyOGMyNmU2YTlhOTQ2ZmYxMjZjMzE", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-01-17T11:47:11Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-01-17T14:15:13Z"}, "message": "libstdc++: Fix configuration of default zoneinfo dir on linux\n\nThe config for --with-libstdcxx-zoneinfo=yes was comparing the target\ntriplet to \"gnu* | linux* | kfreebsd*-gnu | knetbsd*-gnu\" which is only\nthe last component of the triplet, so failed to match and always used\nthe zoneinfo_dir=none default. Check $target_os instead.\n\nThere was also an error in the check for native builds that tzdata.zi is\nactually present in the configured directory. That meant a warning was\nprinted even when the file was present:\n\nconfigure: zoneinfo data directory: /usr/share/zoneinfo\nconfigure: WARNING: \"/usr/share/zoneinfo does not contain tzdata.zi file\"\nconfigure: static tzdata.zi file will be compiled into the library\n\nlibstdc++-v3/ChangeLog:\n\n\t* acinclude.m4 (GLIBCXX_ZONEINFO_DIR): Check $target_os instead\n\tof $host. Fix check for file being present during native build.\n\t* configure: Regenerate.", "tree": {"sha": "3e9b1ce1af1845aef6bd2c72fcef3d7af8a21781", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3e9b1ce1af1845aef6bd2c72fcef3d7af8a21781"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d74d84c623ea8ae394b28c26e6a9a946ff126c31", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d74d84c623ea8ae394b28c26e6a9a946ff126c31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d74d84c623ea8ae394b28c26e6a9a946ff126c31", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d74d84c623ea8ae394b28c26e6a9a946ff126c31/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a121c06f3cff8206883dea526bec4569876b059", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a121c06f3cff8206883dea526bec4569876b059", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a121c06f3cff8206883dea526bec4569876b059"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "982e979a840b6c42521fe0a851357aee2ad4e447", "filename": "libstdc++-v3/acinclude.m4", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d74d84c623ea8ae394b28c26e6a9a946ff126c31/libstdc%2B%2B-v3%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d74d84c623ea8ae394b28c26e6a9a946ff126c31/libstdc%2B%2B-v3%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Facinclude.m4?ref=d74d84c623ea8ae394b28c26e6a9a946ff126c31", "patch": "@@ -5180,17 +5180,17 @@ AC_DEFUN([GLIBCXX_ZONEINFO_DIR], [\n \n   if test \"x${with_libstdcxx_zoneinfo}\" = xyes; then\n     # Pick a default when no specific path is set.\n-    case \"$host\" in\n+    case \"$target_os\" in\n       gnu* | linux* | kfreebsd*-gnu | knetbsd*-gnu)\n \t# Not all distros ship tzdata.zi in this dir.\n \tzoneinfo_dir=\"/usr/share/zoneinfo\"\n \t;;\n-      *-*-aix*)\n+      aix*)\n \t# Binary tzfile files are in /usr/share/lib/zoneinfo\n \t# but tzdata.zi is not present there.\n \tzoneinfo_dir=none\n \t;;\n-      *-*-darwin2*)\n+      darwin2*)\n \t# Binary tzfile files are in /usr/share/lib/zoneinfo.default\n \t# but tzdata.zi is not present there.\n \tzoneinfo_dir=none\n@@ -5230,7 +5230,7 @@ AC_DEFUN([GLIBCXX_ZONEINFO_DIR], [\n   if test \"x${zoneinfo_dir}\" != xnone; then\n     AC_DEFINE_UNQUOTED(_GLIBCXX_ZONEINFO_DIR, \"${zoneinfo_dir}\",\n       [Define if a directory should be searched for tzdata files.])\n-    if $GLIBCXX_IS_NATIVE -a ! test -f \"$zoneinfo_dir/tzdata.zi\"; then\n+    if $GLIBCXX_IS_NATIVE && ! test -f \"$zoneinfo_dir/tzdata.zi\"; then\n       AC_MSG_WARN(\"$zoneinfo_dir does not contain tzdata.zi file\")\n     fi\n   fi"}, {"sha": "a298cbd45a0a2c03b5d1837e55644858001e48fd", "filename": "libstdc++-v3/configure", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d74d84c623ea8ae394b28c26e6a9a946ff126c31/libstdc%2B%2B-v3%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d74d84c623ea8ae394b28c26e6a9a946ff126c31/libstdc%2B%2B-v3%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfigure?ref=d74d84c623ea8ae394b28c26e6a9a946ff126c31", "patch": "@@ -71536,17 +71536,17 @@ fi\n \n   if test \"x${with_libstdcxx_zoneinfo}\" = xyes; then\n     # Pick a default when no specific path is set.\n-    case \"$host\" in\n+    case \"$target_os\" in\n       gnu* | linux* | kfreebsd*-gnu | knetbsd*-gnu)\n \t# Not all distros ship tzdata.zi in this dir.\n \tzoneinfo_dir=\"/usr/share/zoneinfo\"\n \t;;\n-      *-*-aix*)\n+      aix*)\n \t# Binary tzfile files are in /usr/share/lib/zoneinfo\n \t# but tzdata.zi is not present there.\n \tzoneinfo_dir=none\n \t;;\n-      *-*-darwin2*)\n+      darwin2*)\n \t# Binary tzfile files are in /usr/share/lib/zoneinfo.default\n \t# but tzdata.zi is not present there.\n \tzoneinfo_dir=none\n@@ -71590,7 +71590,7 @@ cat >>confdefs.h <<_ACEOF\n #define _GLIBCXX_ZONEINFO_DIR \"${zoneinfo_dir}\"\n _ACEOF\n \n-    if $GLIBCXX_IS_NATIVE -a ! test -f \"$zoneinfo_dir/tzdata.zi\"; then\n+    if $GLIBCXX_IS_NATIVE && ! test -f \"$zoneinfo_dir/tzdata.zi\"; then\n       { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: \\\"$zoneinfo_dir does not contain tzdata.zi file\\\"\" >&5\n $as_echo \"$as_me: WARNING: \\\"$zoneinfo_dir does not contain tzdata.zi file\\\"\" >&2;}\n     fi"}]}