{"sha": "934a54180541d27139aecbd19e7f50cb73552c7c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTM0YTU0MTgwNTQxZDI3MTM5YWVjYmQxOWU3ZjUwY2I3MzU1MmM3Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-12-01T08:39:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-12-01T08:39:04Z"}, "message": "driver: Don't imply -dD for -g3 -g0 [PR97989]\n\nThe driver enables -dD when preprocessing when -g3 is specified, for obvious reasons\nthat we need the macros to be preserved somewhere for them to make up the debug\ninfo.  But it enables it even if -g3 is later overridden to -g2, -g1 or -g0,\nwhere we in the end don't emit .debug_mac{ros,info}.\n\nThe following patch passes -dD only if we'll need it.\n\n2020-12-01  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR debug/97989\n\t* gcc.c (cpp_unique_options): Add -dD if %:debug-level-gt(2)\n\trather than g3|ggdb3|gstabs3|gxcoff3|gvms3.\n\n\t* gcc.dg/cpp/pr97989-1.c: New test.\n\t* gcc.dg/cpp/pr97989-2.c: New test.", "tree": {"sha": "2c9f8d88626b66c0f0343fcf0239bb9ee5f76a78", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c9f8d88626b66c0f0343fcf0239bb9ee5f76a78"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/934a54180541d27139aecbd19e7f50cb73552c7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/934a54180541d27139aecbd19e7f50cb73552c7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/934a54180541d27139aecbd19e7f50cb73552c7c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/934a54180541d27139aecbd19e7f50cb73552c7c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "76ab0317cfb3201b9b68db9e8a0ced4f4e9f6cd4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76ab0317cfb3201b9b68db9e8a0ced4f4e9f6cd4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76ab0317cfb3201b9b68db9e8a0ced4f4e9f6cd4"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "1d32375f64885c7e5acccbcc336acebea0aa2f5c", "filename": "gcc/gcc.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/934a54180541d27139aecbd19e7f50cb73552c7c/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/934a54180541d27139aecbd19e7f50cb73552c7c/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=934a54180541d27139aecbd19e7f50cb73552c7c", "patch": "@@ -1233,7 +1233,7 @@ static const char *cpp_unique_options =\n  %{MMD:-MMD %{!o:%b.d}%{o*:%.d%*}}\\\n  %{M} %{MM} %{MF*} %{MG} %{MP} %{MQ*} %{MT*}\\\n  %{!E:%{!M:%{!MM:%{!MT:%{!MQ:%{MD|MMD:%{o*:-MQ %*}}}}}}}\\\n- %{remap} %{g3|ggdb3|gstabs3|gxcoff3|gvms3:-dD}\\\n+ %{remap} %{%:debug-level-gt(2):-dD}\\\n  %{!iplugindir*:%{fplugin*:%:find-plugindir()}}\\\n  %{H} %C %{D*&U*&A*} %{i*} %Z %i\\\n  %{E|M|MM:%W{o*}}\";"}, {"sha": "108dcbacc693cf8228bb63e7f5f409063a265159", "filename": "gcc/testsuite/gcc.dg/cpp/pr97989-1.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/934a54180541d27139aecbd19e7f50cb73552c7c/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr97989-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/934a54180541d27139aecbd19e7f50cb73552c7c/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr97989-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr97989-1.c?ref=934a54180541d27139aecbd19e7f50cb73552c7c", "patch": "@@ -0,0 +1,8 @@\n+/* PR debug/97989 */\n+/* { dg-do preprocess } */\n+/* { dg-options \"-g3 -g2 -P\" } */\n+\n+#define foo bar\n+int i;\n+\n+/* { dg-final { scan-file-not pr97989-1.i \"(^|\\\\n)#define foo bar($|\\\\n)\" } } */"}, {"sha": "77a295ab15a380033ea2eeac7755625ee51677e9", "filename": "gcc/testsuite/gcc.dg/cpp/pr97989-2.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/934a54180541d27139aecbd19e7f50cb73552c7c/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr97989-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/934a54180541d27139aecbd19e7f50cb73552c7c/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr97989-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fpr97989-2.c?ref=934a54180541d27139aecbd19e7f50cb73552c7c", "patch": "@@ -0,0 +1,8 @@\n+/* PR debug/97989 */\n+/* { dg-do preprocess } */\n+/* { dg-options \"-g2 -g3 -P\" } */\n+\n+#define foo bar\n+int i;\n+\n+/* { dg-final { scan-file pr97989-2.i \"(^|\\\\n)#define foo bar($|\\\\n)\" } } */"}]}