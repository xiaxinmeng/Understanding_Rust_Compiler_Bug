{"sha": "de55efd5a26ac59b22099af9384d9014ca522576", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGU1NWVmZDVhMjZhYzU5YjIyMDk5YWY5Mzg0ZDkwMTRjYTUyMjU3Ng==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2016-05-04T13:46:15Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2016-05-04T13:46:15Z"}, "message": "re PR c/48778 (gcc 4.6 -Waddress adds unhelpful new warning case when using from a macro)\n\n\tPR c/48778\n\t* c-typeck.c (build_binary_op): Don't issue -Waddress warnings\n\tfor macro expansions.\n\n\t* gcc.dg/Waddress-2.c: New test.\n\nFrom-SVN: r235878", "tree": {"sha": "497a6cd6c5659738c48cd499a417ed9968eae538", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/497a6cd6c5659738c48cd499a417ed9968eae538"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de55efd5a26ac59b22099af9384d9014ca522576", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de55efd5a26ac59b22099af9384d9014ca522576", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de55efd5a26ac59b22099af9384d9014ca522576", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de55efd5a26ac59b22099af9384d9014ca522576/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ec6be46228e05303e920886d1baf66323457738b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec6be46228e05303e920886d1baf66323457738b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec6be46228e05303e920886d1baf66323457738b"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "517a8c6c02ec3fbe4c3790bf94cdcdcfa9490eaa", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=de55efd5a26ac59b22099af9384d9014ca522576", "patch": "@@ -1,3 +1,9 @@\n+2016-05-04  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/48778\n+\t* c-typeck.c (build_binary_op): Don't issue -Waddress warnings\n+\tfor macro expansions.\n+\n 2016-05-03  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/70859"}, {"sha": "861aa12ae2de5c2c9a4d33d0083ee9c0fe015092", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=de55efd5a26ac59b22099af9384d9014ca522576", "patch": "@@ -11067,7 +11067,8 @@ build_binary_op (location_t location, enum tree_code code,\n       else if (code0 == POINTER_TYPE && null_pointer_constant_p (orig_op1))\n \t{\n \t  if (TREE_CODE (op0) == ADDR_EXPR\n-\t      && decl_with_nonnull_addr_p (TREE_OPERAND (op0, 0)))\n+\t      && decl_with_nonnull_addr_p (TREE_OPERAND (op0, 0))\n+\t      && !from_macro_expansion_at (location))\n \t    {\n \t      if (code == EQ_EXPR)\n \t\twarning_at (location,\n@@ -11087,7 +11088,8 @@ build_binary_op (location_t location, enum tree_code code,\n       else if (code1 == POINTER_TYPE && null_pointer_constant_p (orig_op0))\n \t{\n \t  if (TREE_CODE (op1) == ADDR_EXPR\n-\t      && decl_with_nonnull_addr_p (TREE_OPERAND (op1, 0)))\n+\t      && decl_with_nonnull_addr_p (TREE_OPERAND (op1, 0))\n+\t      && !from_macro_expansion_at (location))\n \t    {\n \t      if (code == EQ_EXPR)\n \t\twarning_at (location,"}, {"sha": "ddde8776f6b4067826feeca2e62d8fea4ba5e689", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=de55efd5a26ac59b22099af9384d9014ca522576", "patch": "@@ -1,3 +1,8 @@\n+2016-05-04  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/48778\n+\t* gcc.dg/Waddress-2.c: New test.\n+\n 2016-05-04  Alan Modra  <amodra@gmail.com>\n \n \t* gcc.target/powerpc/pr70866.c: New."}, {"sha": "4d927f67694302f4570af54e3505f057d5a304ee", "filename": "gcc/testsuite/gcc.dg/Waddress-2.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Ftestsuite%2Fgcc.dg%2FWaddress-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de55efd5a26ac59b22099af9384d9014ca522576/gcc%2Ftestsuite%2Fgcc.dg%2FWaddress-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWaddress-2.c?ref=de55efd5a26ac59b22099af9384d9014ca522576", "patch": "@@ -0,0 +1,24 @@\n+/* PR c/48778 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Waddress\" } */\n+\n+#define NULL ((void *) 0)\n+\n+#define M1(b) ((b) != NULL ? 0 : (b))\n+#define M2(b) ((b) == NULL ? 0 : (b))\n+#define M3(b) (NULL != (b) ? 0 : (b))\n+#define M4(b) (NULL == (b) ? 0 : (b))\n+\n+int\n+func (int b)\n+{\n+  if (M1 (&b) > 0)\n+    return 1;\n+  if (M2 (&b) > 0)\n+    return 2;\n+  if (M3 (&b) > 0)\n+    return 3;\n+  if (M4 (&b) > 0)\n+    return 4;\n+  return 0;\n+}"}]}