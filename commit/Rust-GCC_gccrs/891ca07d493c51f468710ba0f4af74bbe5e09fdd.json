{"sha": "891ca07d493c51f468710ba0f4af74bbe5e09fdd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODkxY2EwN2Q0OTNjNTFmNDY4NzEwYmEwZjRhZjc0YmJlNWUwOWZkZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2012-06-12T07:52:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2012-06-12T07:52:47Z"}, "message": "re PR rtl-optimization/53589 (ICE in maybe_record_trace_start with asm goto)\n\n\tPR rtl-optimization/53589\n\t* cfgrtl.c (force_nonfallthru_and_redirect): Do asm_goto_edge\n\tdiscovery even when e->dest != target.  If any LABEL_REF points\n\tto e->dest label, redirect it to target's label.\n\n\t* gcc.dg/torture/pr53589.c: New test.\n\nFrom-SVN: r188428", "tree": {"sha": "a98e47f2089f21dfa76a5978eefa408198dace25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a98e47f2089f21dfa76a5978eefa408198dace25"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/891ca07d493c51f468710ba0f4af74bbe5e09fdd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/891ca07d493c51f468710ba0f4af74bbe5e09fdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/891ca07d493c51f468710ba0f4af74bbe5e09fdd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/891ca07d493c51f468710ba0f4af74bbe5e09fdd/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ed6a1ff9879de13a0458ff31a3cb50db7a207881", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed6a1ff9879de13a0458ff31a3cb50db7a207881", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed6a1ff9879de13a0458ff31a3cb50db7a207881"}], "stats": {"total": 39, "additions": 33, "deletions": 6}, "files": [{"sha": "aa50728f57bde7fd2274ad9b8927ee771c2b9435", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=891ca07d493c51f468710ba0f4af74bbe5e09fdd", "patch": "@@ -1,3 +1,10 @@\n+2012-06-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/53589\n+\t* cfgrtl.c (force_nonfallthru_and_redirect): Do asm_goto_edge\n+\tdiscovery even when e->dest != target.  If any LABEL_REF points\n+\tto e->dest label, redirect it to target's label.\n+\n 2012-06-12  Chung-Lin Tang  <cltang@codesourcery.com>\n \n \t* config/sh/sh.c (output_stack_adjust): Remove !epilogue_p"}, {"sha": "3e4b65ec95b93b097d08be74006790da4f58f8c8", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=891ca07d493c51f468710ba0f4af74bbe5e09fdd", "patch": "@@ -1293,21 +1293,21 @@ force_nonfallthru_and_redirect (edge e, basic_block target, rtx jump_label)\n     }\n \n   /* If e->src ends with asm goto, see if any of the ASM_OPERANDS_LABELs\n-     don't point to target label.  */\n+     don't point to the target or fallthru label.  */\n   if (JUMP_P (BB_END (e->src))\n       && target != EXIT_BLOCK_PTR\n-      && e->dest == target\n       && (e->flags & EDGE_FALLTHRU)\n       && (note = extract_asm_operands (PATTERN (BB_END (e->src)))))\n     {\n       int i, n = ASM_OPERANDS_LABEL_LENGTH (note);\n \n       for (i = 0; i < n; ++i)\n-\tif (XEXP (ASM_OPERANDS_LABEL (note, i), 0) == BB_HEAD (target))\n-\t  {\n+\t{\n+\t  if (XEXP (ASM_OPERANDS_LABEL (note, i), 0) == BB_HEAD (e->dest))\n+\t    XEXP (ASM_OPERANDS_LABEL (note, i), 0) = block_label (target);\n+\t  if (XEXP (ASM_OPERANDS_LABEL (note, i), 0) == BB_HEAD (target))\n \t    asm_goto_edge = true;\n-\t    break;\n-\t  }\n+\t}\n     }\n \n   if (EDGE_COUNT (e->src->succs) >= 2 || abnormal_edge_flags || asm_goto_edge)"}, {"sha": "2954f59f1462c01825141d7db932503e99359dd4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=891ca07d493c51f468710ba0f4af74bbe5e09fdd", "patch": "@@ -1,3 +1,8 @@\n+2012-06-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/53589\n+\t* gcc.dg/torture/pr53589.c: New test.\n+\n 2012-06-12  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/50749"}, {"sha": "5ab78907f9803111da0ddcbbf8fa0ed2a89ab019", "filename": "gcc/testsuite/gcc.dg/torture/pr53589.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr53589.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/891ca07d493c51f468710ba0f4af74bbe5e09fdd/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr53589.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr53589.c?ref=891ca07d493c51f468710ba0f4af74bbe5e09fdd", "patch": "@@ -0,0 +1,15 @@\n+/* PR rtl-optimization/53589 */\n+/* { dg-do compile } */\n+\n+extern void foo (void) __attribute__ ((__noreturn__));\n+\n+void\n+bar (int x)\n+{\n+  if (x < 0)\n+    foo ();\n+  if (x == 0)\n+    return;\n+  __asm goto (\"# %l[lab]\" : : : : lab);\n+lab:;\n+}"}]}