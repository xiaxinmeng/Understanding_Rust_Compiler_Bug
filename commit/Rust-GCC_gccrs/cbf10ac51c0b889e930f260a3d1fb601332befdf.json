{"sha": "cbf10ac51c0b889e930f260a3d1fb601332befdf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2JmMTBhYzUxYzBiODg5ZTkzMGYyNjBhM2QxZmI2MDEzMzJiZWZkZg==", "commit": {"author": {"name": "Sergei Trofimovich", "email": "siarheit@google.com", "date": "2020-07-25T18:26:50Z"}, "committer": {"name": "Sergei Trofimovich", "email": "siarheit@google.com", "date": "2020-07-28T22:19:00Z"}, "message": "ipa/96291: don't crash on unoptimized lto functions\n\nIn PR ipa/96291 the test contained an SCC with one\nunoptimized function. This tricked ipa-cp into NULL dereference.\n\nhas_undead_caller_from_outside_scc_p() did not take into account\nthat unoptimized funtions don't have IPA summary analysis. And\ndereferenced NULL pointer causing an ICE.\n\ngcc/\n\tPR ipa/96291\n\t* ipa-cp.c (has_undead_caller_from_outside_scc_p): Consider\n\tunoptimized callers as undead.\n\ngcc/testsuite/\n\tPR ipa/96291\n\t* gcc.dg/lto/pr96291_0.c: New testcase.\n\t* gcc.dg/lto/pr96291_1.c: Support file.\n\t* gcc.dg/lto/pr96291_2.c: Likewise.\n\t* gcc.dg/lto/pr96291.h: Likewise.", "tree": {"sha": "95169b2eda2b244bf69ce24ce299b1da4cec89c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95169b2eda2b244bf69ce24ce299b1da4cec89c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cbf10ac51c0b889e930f260a3d1fb601332befdf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbf10ac51c0b889e930f260a3d1fb601332befdf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbf10ac51c0b889e930f260a3d1fb601332befdf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbf10ac51c0b889e930f260a3d1fb601332befdf/comments", "author": {"login": "trofi", "id": 226650, "node_id": "MDQ6VXNlcjIyNjY1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/226650?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trofi", "html_url": "https://github.com/trofi", "followers_url": "https://api.github.com/users/trofi/followers", "following_url": "https://api.github.com/users/trofi/following{/other_user}", "gists_url": "https://api.github.com/users/trofi/gists{/gist_id}", "starred_url": "https://api.github.com/users/trofi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trofi/subscriptions", "organizations_url": "https://api.github.com/users/trofi/orgs", "repos_url": "https://api.github.com/users/trofi/repos", "events_url": "https://api.github.com/users/trofi/events{/privacy}", "received_events_url": "https://api.github.com/users/trofi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "trofi", "id": 226650, "node_id": "MDQ6VXNlcjIyNjY1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/226650?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trofi", "html_url": "https://github.com/trofi", "followers_url": "https://api.github.com/users/trofi/followers", "following_url": "https://api.github.com/users/trofi/following{/other_user}", "gists_url": "https://api.github.com/users/trofi/gists{/gist_id}", "starred_url": "https://api.github.com/users/trofi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trofi/subscriptions", "organizations_url": "https://api.github.com/users/trofi/orgs", "repos_url": "https://api.github.com/users/trofi/repos", "events_url": "https://api.github.com/users/trofi/events{/privacy}", "received_events_url": "https://api.github.com/users/trofi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33bf56ddc6a757d2066a50dd9ce8323b379a2a0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33bf56ddc6a757d2066a50dd9ce8323b379a2a0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33bf56ddc6a757d2066a50dd9ce8323b379a2a0a"}], "stats": {"total": 30, "additions": 28, "deletions": 2}, "files": [{"sha": "fe010ff457cca5c18039b76c478302433328fb69", "filename": "gcc/ipa-cp.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Fipa-cp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Fipa-cp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-cp.c?ref=cbf10ac51c0b889e930f260a3d1fb601332befdf", "patch": "@@ -5667,8 +5667,9 @@ has_undead_caller_from_outside_scc_p (struct cgraph_node *node,\n \t  (has_undead_caller_from_outside_scc_p, NULL, true))\n       return true;\n     else if (!ipa_edge_within_scc (cs)\n-\t     && !IPA_NODE_REF (cs->caller)->node_dead)\n-      return true;\n+\t     && (!IPA_NODE_REF (cs->caller) /* Unoptimized caller.  */\n+\t\t || !IPA_NODE_REF (cs->caller)->node_dead))\n+\t  return true;\n   return false;\n }\n "}, {"sha": "70eb3cb71b862139e856155edd3371c4252a649c", "filename": "gcc/testsuite/gcc.dg/lto/pr96291.h", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291.h?ref=cbf10ac51c0b889e930f260a3d1fb601332befdf", "patch": "@@ -0,0 +1,4 @@\n+void e(void);\n+void f(void);\n+void a(void *, void *);\n+void c(int);"}, {"sha": "07e63038e03c429ef5951607a95912a91e7ac824", "filename": "gcc/testsuite/gcc.dg/lto/pr96291_0.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_0.c?ref=cbf10ac51c0b889e930f260a3d1fb601332befdf", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-lto-do link } */\n+\n+#include \"pr96291.h\"\n+\n+static void * b;\n+void c(int d) {\n+  f();\n+  a(b, b);\n+}\n+\n+void e(void) { c(0); }"}, {"sha": "44744a949417f0f608c621675377545187ff8f18", "filename": "gcc/testsuite/gcc.dg/lto/pr96291_1.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_1.c?ref=cbf10ac51c0b889e930f260a3d1fb601332befdf", "patch": "@@ -0,0 +1,3 @@\n+#include \"pr96291.h\"\n+\n+void f(void) { c(0); }"}, {"sha": "5febffbb00ce9b7e3b88f92eb0d04915db6f5e10", "filename": "gcc/testsuite/gcc.dg/lto/pr96291_2.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbf10ac51c0b889e930f260a3d1fb601332befdf/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr96291_2.c?ref=cbf10ac51c0b889e930f260a3d1fb601332befdf", "patch": "@@ -0,0 +1,7 @@\n+/* { dg-options {-O0} } */\n+\n+#include \"pr96291.h\"\n+\n+void a(void * a1, void * a2) { e(); }\n+\n+int main(){}"}]}