{"sha": "90a9fff2b07b27a3d6fae98f3565ab0536f981c6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTBhOWZmZjJiMDdiMjdhM2Q2ZmFlOThmMzU2NWFiMDUzNmY5ODFjNg==", "commit": {"author": {"name": "Pascal Obry", "email": "obry@gnat.com", "date": "2001-10-25T23:23:44Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-10-25T23:23:44Z"}, "message": "osint.adb (Read_Default_Search_Dirs): correctly detect relative pathnames in UNIX and DOS style with drive letter.\n\n\t* osint.adb (Read_Default_Search_Dirs): correctly detect relative\n        pathnames in UNIX and DOS style with drive letter.\n\t(Is_Relative): new routine.\n\n\t* osint.adb: Minor reformatting\n\n\t* osint.adb (Is_Relative): implementation using\n        GNAT.OS_Lib.Is_Absolute_Path. Better fix for 8121-009.\n\nFrom-SVN: r46503", "tree": {"sha": "7d2e6f3845308cbd2c3275b30397d7ebd1563dea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7d2e6f3845308cbd2c3275b30397d7ebd1563dea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/90a9fff2b07b27a3d6fae98f3565ab0536f981c6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90a9fff2b07b27a3d6fae98f3565ab0536f981c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90a9fff2b07b27a3d6fae98f3565ab0536f981c6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90a9fff2b07b27a3d6fae98f3565ab0536f981c6/comments", "author": null, "committer": null, "parents": [{"sha": "5c1ba4cc9cd83595d4f327fe2e5fc0ab1f1222cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c1ba4cc9cd83595d4f327fe2e5fc0ab1f1222cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c1ba4cc9cd83595d4f327fe2e5fc0ab1f1222cf"}], "stats": {"total": 65, "additions": 56, "deletions": 9}, "files": [{"sha": "58187a09c8496de3fe20fc0d3776bf18f015ffd4", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90a9fff2b07b27a3d6fae98f3565ab0536f981c6/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90a9fff2b07b27a3d6fae98f3565ab0536f981c6/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=90a9fff2b07b27a3d6fae98f3565ab0536f981c6", "patch": "@@ -1,3 +1,14 @@\n+2001-10-25  Pascal Obry <obry@gnat.com>\n+\n+\t* osint.adb (Read_Default_Search_Dirs): correctly detect relative \n+        pathnames in UNIX and DOS style with drive letter.\n+\t(Is_Relative): new routine.\n+\t\n+\t* osint.adb: Minor reformatting\n+\t\n+\t* osint.adb (Is_Relative): implementation using \n+        GNAT.OS_Lib.Is_Absolute_Path. Better fix for 8121-009.\n+\n 2001-10-25  Pascal Obry <obry@gnat.com>\n \n \t* g-dirope.adb (Basename): correctly compute offset between the "}, {"sha": "b43f2d7f6406a85643c57de9d5594941cc156204", "filename": "gcc/ada/osint.adb", "status": "modified", "additions": 45, "deletions": 9, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90a9fff2b07b27a3d6fae98f3565ab0536f981c6/gcc%2Fada%2Fosint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90a9fff2b07b27a3d6fae98f3565ab0536f981c6/gcc%2Fada%2Fosint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint.adb?ref=90a9fff2b07b27a3d6fae98f3565ab0536f981c6", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                            $Revision: 1.258 $\n+--                            $Revision$\n --                                                                          --\n --          Copyright (C) 1992-2001 Free Software Foundation, Inc.          --\n --                                                                          --\n@@ -1676,11 +1676,31 @@ package body Osint is\n    ------------------------------\n \n    function Read_Default_Search_Dirs\n-     (Search_Dir_Prefix : String_Access;\n-      Search_File : String_Access;\n+     (Search_Dir_Prefix       : String_Access;\n+      Search_File             : String_Access;\n       Search_Dir_Default_Name : String_Access)\n-     return String_Access\n+      return                  String_Access\n    is\n+      function Is_Relative (S : String; K : Positive) return Boolean;\n+      --  Returns True if a relative directory specification is found in S at\n+      --  position K.\n+\n+      function Is_Relative (S : String; K : Positive) return Boolean is\n+      begin\n+         return\n+           not (Is_Directory_Separator (S (K)) -- Unix style absolute pathname\n+\n+                or else -- DOS style absolute pathname with drive letter\n+\n+                (S'Last > K + 2\n+                    and then\n+                 (S (K) in 'a' .. 'z' or else S (K) in 'A' .. 'Z')\n+                    and then\n+                 S (K + 1) = ':'\n+                    and then\n+                 Is_Directory_Separator (S (K + 2))));\n+      end Is_Relative;\n+\n       Prefix_Len : constant Integer := Search_Dir_Prefix.all'Length;\n       Buffer     : String (1 .. Prefix_Len + Search_File.all'Length + 1);\n       File_FD    : File_Descriptor;\n@@ -1693,8 +1713,23 @@ package body Osint is\n       Prev_Was_Separator : Boolean;\n       Nb_Relative_Dir    : Integer;\n \n-   begin\n+      function Is_Relative (S : String; K : Positive) return Boolean;\n+      pragma Inline (Is_Relative);\n+      --  Returns True if a relative directory specification is found\n+      --  in S at position K, False otherwise.\n \n+      -----------------\n+      -- Is_Relative --\n+      -----------------\n+\n+      function Is_Relative (S : String; K : Positive) return Boolean is\n+      begin\n+         return not Is_Absolute_Path (S (K .. S'Last));\n+      end Is_Relative;\n+\n+   --  Start of processing for Read_Default_Search_Dirs\n+\n+   begin\n       --  Construct a C compatible character string buffer.\n \n       Buffer (1 .. Search_Dir_Prefix.all'Length)\n@@ -1737,12 +1772,13 @@ package body Osint is\n             S (J) := Path_Separator;\n          end if;\n \n-         if  S (J) = Path_Separator then\n+         if S (J) = Path_Separator then\n             Prev_Was_Separator := True;\n          else\n-            if Prev_Was_Separator and S (J) /= Directory_Separator then\n+            if Prev_Was_Separator and then Is_Relative (S.all, J) then\n                Nb_Relative_Dir := Nb_Relative_Dir + 1;\n             end if;\n+\n             Prev_Was_Separator := False;\n          end if;\n       end loop;\n@@ -1757,11 +1793,11 @@ package body Osint is\n       J1 := 1;\n       Prev_Was_Separator := True;\n       for J in 1 .. Len + 1 loop\n-         if  S (J) = Path_Separator then\n+         if S (J) = Path_Separator then\n             Prev_Was_Separator := True;\n \n          else\n-            if Prev_Was_Separator and S (J) /= Directory_Separator then\n+            if Prev_Was_Separator and then Is_Relative (S.all, J) then\n                S1 (J1 .. J1 + Prefix_Len) := Search_Dir_Prefix.all;\n                J1 := J1 + Prefix_Len;\n             end if;"}]}