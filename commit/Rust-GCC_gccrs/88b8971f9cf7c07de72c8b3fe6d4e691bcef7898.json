{"sha": "88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODhiODk3MWY5Y2Y3YzA3ZGU3MmM4YjNmZTZkNGU2OTFiY2VmNzg5OA==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2016-08-24T19:33:14Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2016-08-24T19:33:14Z"}, "message": "re PR fortran/77358 ([F08] deferred-length character function returns zero-length string)\n\n2016-08-24  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/77358\n\t* resolve.c (resolve_fl_procedure): Use the correct gfc_charlen\n\tfor deferred character length module procedures.\n\n2016-08-24  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/77358\n\t* gfortran.dg/submodule_17.f08: New test.\n\nFrom-SVN: r239740", "tree": {"sha": "154f472512471b0925cc1dc3f83fe8d137847510", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/154f472512471b0925cc1dc3f83fe8d137847510"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/comments", "author": null, "committer": null, "parents": [{"sha": "c8cd4696473a9c803b9454adeee57c90565c2fad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8cd4696473a9c803b9454adeee57c90565c2fad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8cd4696473a9c803b9454adeee57c90565c2fad"}], "stats": {"total": 45, "additions": 45, "deletions": 0}, "files": [{"sha": "93eb48ad52bc1fe1bafe66e140f067ba40aba21f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "patch": "@@ -1,3 +1,9 @@\n+2016-08-24  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/77358\n+\t* resolve.c (resolve_fl_procedure): Use the correct gfc_charlen\n+\tfor deferred character length module procedures.\n+\n 2016-08-23  Fritz Reese  <fritzoreese@gmail.com>\n \n \t* decl.c (gfc_match_structure_decl): Make gfc_structure_id static."}, {"sha": "0a92efe7784fe8103bf958310ab045f3a2cafe3d", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "patch": "@@ -11884,6 +11884,13 @@ resolve_fl_procedure (gfc_symbol *sym, int mp_flag)\n       iface = sym->ts.interface;\n       sym->ts.interface = NULL;\n \n+      /* Make sure that the result uses the correct charlen for deferred\n+\t length results.  */\n+      if (iface && sym->result\n+\t  && iface->ts.type == BT_CHARACTER\n+\t  && iface->ts.deferred)\n+\tsym->result->ts.u.cl = iface->ts.u.cl;\n+\n       if (iface == NULL)\n \tgoto check_formal;\n "}, {"sha": "527f2011ac7569daa906b4396d3564242e4783d6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "patch": "@@ -1,3 +1,8 @@\n+2016-08-24  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/77358\n+\t* gfortran.dg/submodule_17.f08: New test.\n+\n 2016-08-24  Michael Collison <michael.collison@linaro.org>\n \t    Michael Collison <michael.collison@arm.com>\n "}, {"sha": "8effef4b4178eed3183da7574618c2c82a6fec8b", "filename": "gcc/testsuite/gfortran.dg/submodule_17.f08", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_17.f08", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88b8971f9cf7c07de72c8b3fe6d4e691bcef7898/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_17.f08", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_17.f08?ref=88b8971f9cf7c07de72c8b3fe6d4e691bcef7898", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do run }\n+!\n+! Tests the fix for PR77358, in which the wrong gfc_charlen was\n+! being used for the result of 'get'.\n+!\n+! Contributed by Damian Rouson  <damian@sourceryinstitute.org>\n+!\n+module hello_interface\n+  character(len=13) :: string=\"Hello, world!\"\n+  interface\n+    module function get() result(result_string)\n+      character(:), allocatable :: result_string\n+    end function\n+  end interface\n+end module\n+\n+submodule(hello_interface) hello_implementation\n+contains\n+  module function get() result(result_string)\n+    character(:), allocatable :: result_string\n+    result_string = string\n+  end function\n+end submodule\n+\n+  use hello_interface\n+  if (get() .ne. string) call abort\n+end"}]}