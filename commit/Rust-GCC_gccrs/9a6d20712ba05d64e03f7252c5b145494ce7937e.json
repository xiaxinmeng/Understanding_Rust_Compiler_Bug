{"sha": "9a6d20712ba05d64e03f7252c5b145494ce7937e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWE2ZDIwNzEyYmEwNWQ2NGUwM2Y3MjUyYzViMTQ1NDk0Y2U3OTM3ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2002-09-05T07:51:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2002-09-05T07:51:16Z"}, "message": "monetary_members.cc (moneypunct<wchar_t, [...]): Use __uselocale instead of setlocale for glibc 2.3.\n\n\t* config/locale/gnu/monetary_members.cc\n\t(moneypunct<wchar_t, true>::_M_initialize_moneypunct,\n\tmoneypunct<wchar_t, false>::_M_initialize_moneypunct): Use\n\t__uselocale instead of setlocale for glibc 2.3.\n\nFrom-SVN: r56839", "tree": {"sha": "d46938e5d719510f6d041d816b8a76e105b9fd11", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d46938e5d719510f6d041d816b8a76e105b9fd11"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a6d20712ba05d64e03f7252c5b145494ce7937e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a6d20712ba05d64e03f7252c5b145494ce7937e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a6d20712ba05d64e03f7252c5b145494ce7937e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a6d20712ba05d64e03f7252c5b145494ce7937e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "89671b70677af6d2f66c48cd9e2f703fc8e0444b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89671b70677af6d2f66c48cd9e2f703fc8e0444b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89671b70677af6d2f66c48cd9e2f703fc8e0444b"}], "stats": {"total": 29, "additions": 25, "deletions": 4}, "files": [{"sha": "06cf2a0ba7ab91202929eaff93b2a9c41046d250", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a6d20712ba05d64e03f7252c5b145494ce7937e/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a6d20712ba05d64e03f7252c5b145494ce7937e/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=9a6d20712ba05d64e03f7252c5b145494ce7937e", "patch": "@@ -1,3 +1,10 @@\n+2002-09-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* config/locale/gnu/monetary_members.cc\n+\t(moneypunct<wchar_t, true>::_M_initialize_moneypunct,\n+\tmoneypunct<wchar_t, false>::_M_initialize_moneypunct): Use\n+\t__uselocale instead of setlocale for glibc 2.3.\n+\n 2002-09-05  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config/locale/generic/c++locale_internal.h: New header."}, {"sha": "68b154bdc7ceb80f9fe656533e153217e82accbf", "filename": "libstdc++-v3/config/locale/gnu/monetary_members.cc", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a6d20712ba05d64e03f7252c5b145494ce7937e/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmonetary_members.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a6d20712ba05d64e03f7252c5b145494ce7937e/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmonetary_members.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Flocale%2Fgnu%2Fmonetary_members.cc?ref=9a6d20712ba05d64e03f7252c5b145494ce7937e", "patch": "@@ -335,9 +335,13 @@ namespace std\n       else\n \t{\n \t  // Named locale.\n-\t  // XXX Fix me. Switch to named locale so that mbsrtowcs will work.\n+#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2)\n+\t  __c_locale __old = __uselocale(__cloc);\n+#else\n+\t  // Switch to named locale so that mbsrtowcs will work.\n \t  char* __old = strdup(setlocale(LC_ALL, NULL));\n \t  setlocale(LC_ALL, __name);\n+#endif\n \n \t  _M_decimal_point = static_cast<wchar_t>(((union { const char *__s; unsigned int __w; }){ __s: __nl_langinfo_l(_NL_NUMERIC_DECIMAL_POINT_WC, __cloc)}).__w);\n \n@@ -400,9 +404,12 @@ namespace std\n \t  char __nspace = *(__nl_langinfo_l(__INT_N_SEP_BY_SPACE, __cloc));\n \t  _M_neg_format = _S_construct_pattern(__nprecedes, __nspace, __nposn);\n \n-\t  // XXX\n+#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2)\n+\t  __uselocale(__old);\n+#else\n \t  setlocale(LC_ALL, __old);\n \t  free(__old);\n+#endif\n \t}\n     }\n \n@@ -427,9 +434,13 @@ namespace std\n       else\n \t{\n \t  // Named locale.\n-\t  // XXX Fix me. Switch to named locale so that mbsrtowcs will work.\n+#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2)\n+\t  __c_locale __old = __uselocale(__cloc);\n+#else\n+\t  // Switch to named locale so that mbsrtowcs will work.\n \t  char* __old = strdup(setlocale(LC_ALL, NULL));\n \t  setlocale(LC_ALL, __name);\n+#endif\n \n \t  _M_decimal_point = static_cast<wchar_t>(((union { const char *__s; unsigned int __w; }){ __s: __nl_langinfo_l(_NL_NUMERIC_DECIMAL_POINT_WC, __cloc)}).__w);\n \t  _M_thousands_sep = static_cast<wchar_t>(((union { const char *__s; unsigned int __w; }){ __s: __nl_langinfo_l(_NL_NUMERIC_THOUSANDS_SEP_WC, __cloc)}).__w);\n@@ -491,9 +502,12 @@ namespace std\n \t  char __nspace = *(__nl_langinfo_l(__N_SEP_BY_SPACE, __cloc));\n \t  _M_neg_format = _S_construct_pattern(__nprecedes, __nspace, __nposn);\n \n-\t  // XXX\n+#if __GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2)\n+\t  __uselocale(__old);\n+#else\n \t  setlocale(LC_ALL, __old);\n \t  free(__old);\n+#endif\n \t}\n     }\n "}]}