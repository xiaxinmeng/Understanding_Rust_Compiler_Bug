{"sha": "ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWUzZDg4MzdiZDRlNjRiM2UwZmZjNDNiMmI5OTcyNDhlZDVjNjZlMg==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2016-04-20T09:00:58Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2016-04-20T09:00:58Z"}, "message": "sem_ch13.adb (Build_Invariant_Procedure): Reimplement the invariant procedure spec and body insertion.\n\n2016-04-20  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* sem_ch13.adb (Build_Invariant_Procedure):\n\tReimplement the invariant procedure spec and body insertion.\n\nFrom-SVN: r235239", "tree": {"sha": "9bda9fccef16478079d523d1a7ba286a160aed03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9bda9fccef16478079d523d1a7ba286a160aed03"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "776fbb7478011611c58ba664a4c8ef3a0df8f75f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/776fbb7478011611c58ba664a4c8ef3a0df8f75f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/776fbb7478011611c58ba664a4c8ef3a0df8f75f"}], "stats": {"total": 55, "additions": 27, "deletions": 28}, "files": [{"sha": "93e1eeb7f74615b9674de9f51f0ac5eeb1cc7156", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2", "patch": "@@ -1,3 +1,8 @@\n+2016-04-20  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* sem_ch13.adb (Build_Invariant_Procedure):\n+\tReimplement the invariant procedure spec and body insertion.\n+\n 2016-04-20  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* sem_ch13.adb (Add_Invariant): Do not replace"}, {"sha": "5fc8304de28e19a5098dc88061374064250bf025", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 22, "deletions": 28, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=ae3d8837bd4e64b3e0ffc43b2b997248ed5c66e2", "patch": "@@ -8335,46 +8335,40 @@ package body Sem_Ch13 is\n                Make_Handled_Sequence_Of_Statements (Loc,\n                  Statements => Stmts));\n \n-         --  Insert procedure declaration and spec at the appropriate points.\n-         --  If declaration is already analyzed, it was processed by the\n-         --  generated pragma.\n+         --  The processing of an invariant pragma immediately generates the\n+         --  invariant procedure spec, inserts it into the tree and analyzes\n+         --  it. If the spec has not been analyzed, then the invariant pragma\n+         --  is being inherited and requires manual insertion and analysis.\n \n-         if Present (Priv_Decls) then\n-\n-            --  The spec goes at the end of visible declarations, but they have\n-            --  already been analyzed, so we need to explicitly do the analyze.\n-\n-            if not Analyzed (PDecl) then\n-               Append_To (Vis_Decls, PDecl);\n-               Analyze (PDecl);\n-            end if;\n+         if not Analyzed (PDecl) then\n+            Append_To (Vis_Decls, PDecl);\n+            Analyze (PDecl);\n+         end if;\n \n-            --  The body goes at the end of the private declarations, which we\n-            --  have not analyzed yet, so we do not need to perform an explicit\n-            --  analyze call. We skip this if there are no private declarations\n-            --  (this is an error that will be caught elsewhere);\n+         --  The invariant procedure body is inserted at the end of the private\n+         --  declarations.\n \n+         if Present (Priv_Decls) then\n             Append_To (Priv_Decls, PBody);\n \n-            --  If the invariant appears on the full view of a type, the\n-            --  analysis of the private part is complete, and we must\n-            --  analyze the new body explicitly.\n+            --  If the invariant appears on the full view of a private type,\n+            --  then the analysis of the private part is already completed.\n+            --  Manually analyze the new body in this case, otherwise wait\n+            --  for the analysis of the private declarations to process the\n+            --  body.\n \n             if In_Private_Part (Current_Scope) then\n                Analyze (PBody);\n             end if;\n \n-         --  If there are no private declarations this may be an error that\n-         --  will be diagnosed elsewhere. However, if this is a non-private\n-         --  type that inherits invariants, it needs no completion and there\n-         --  may be no private part. In this case insert invariant procedure\n-         --  at end of current declarative list, and analyze at once, given\n-         --  that the type is about to be frozen.\n+         --  Otherwise there are no private declarations. This is either an\n+         --  error or the related type is a private extension in which case\n+         --  it does not need a completion in a private part. Insert the body\n+         --  and the end of the visible declarations and analyze immediately\n+         --  because the related type is about to be frozen.\n \n-         elsif not Is_Private_Type (Typ) then\n-            Append_To (Vis_Decls, PDecl);\n+         else\n             Append_To (Vis_Decls, PBody);\n-            Analyze (PDecl);\n             Analyze (PBody);\n          end if;\n       end if;"}]}