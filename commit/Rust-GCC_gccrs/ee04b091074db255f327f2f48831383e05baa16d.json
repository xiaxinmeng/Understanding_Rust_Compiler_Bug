{"sha": "ee04b091074db255f327f2f48831383e05baa16d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWUwNGIwOTEwNzRkYjI1NWYzMjdmMmY0ODgzMTM4M2UwNWJhYTE2ZA==", "commit": {"author": {"name": "Oleg Endo", "email": "olegendo@gcc.gnu.org", "date": "2012-07-18T07:51:36Z"}, "committer": {"name": "Oleg Endo", "email": "olegendo@gcc.gnu.org", "date": "2012-07-18T07:51:36Z"}, "message": "sh.md (mulsidi3, umulsidi3): Remove constraints in expander.\n\n\t* config/sh/sh.md (mulsidi3, umulsidi3): Remove constraints in\n\texpander.  Use arith_reg_dest predicate.\n\t(rotldi3, rotrdi3): Remove constraints in expander.\n\t(adddi3_compact, subdi3_compact, mulsidi3_compact, umulsidi3_compact,\n\tashlsi3_n, *ashlhi3_n, ashrsi2_16, ashrsi2_31, lshrsi3_n): Convert to\n\tinsn_and_split.\n\nFrom-SVN: r189603", "tree": {"sha": "635f50b40517571f740b93e6ad493e7f2b55c020", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/635f50b40517571f740b93e6ad493e7f2b55c020"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee04b091074db255f327f2f48831383e05baa16d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee04b091074db255f327f2f48831383e05baa16d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee04b091074db255f327f2f48831383e05baa16d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee04b091074db255f327f2f48831383e05baa16d/comments", "author": null, "committer": null, "parents": [{"sha": "13f1f50857edf803798ee6ab9f42a2ec79f56c57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13f1f50857edf803798ee6ab9f42a2ec79f56c57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13f1f50857edf803798ee6ab9f42a2ec79f56c57"}], "stats": {"total": 181, "additions": 65, "deletions": 116}, "files": [{"sha": "ce9cea0c98ffb714b19c5a916c19ff8b0d81b4e1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee04b091074db255f327f2f48831383e05baa16d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee04b091074db255f327f2f48831383e05baa16d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ee04b091074db255f327f2f48831383e05baa16d", "patch": "@@ -1,3 +1,12 @@\n+2012-07-18  Oleg Endo  <olegendo@gcc.gnu.org>\n+\n+\t* config/sh/sh.md (mulsidi3, umulsidi3): Remove constraints in\n+\texpander.  Use arith_reg_dest predicate.\n+\t(rotldi3, rotrdi3): Remove constraints in expander.\n+\t(adddi3_compact, subdi3_compact, mulsidi3_compact, umulsidi3_compact,\n+\tashlsi3_n, *ashlhi3_n, ashrsi2_16, ashrsi2_31, lshrsi3_n): Convert to\n+\tinsn_and_split.\n+\n 2012-07-18  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/33135"}, {"sha": "823738947f28755a951eed6338b20f0d10b6bde6", "filename": "gcc/config/sh/sh.md", "status": "modified", "additions": 56, "deletions": 116, "changes": 172, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee04b091074db255f327f2f48831383e05baa16d/gcc%2Fconfig%2Fsh%2Fsh.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee04b091074db255f327f2f48831383e05baa16d/gcc%2Fconfig%2Fsh%2Fsh.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.md?ref=ee04b091074db255f327f2f48831383e05baa16d", "patch": "@@ -1431,21 +1431,14 @@\n   [(set_attr \"type\" \"arith_media\")\n    (set_attr \"highpart\" \"ignore\")])\n \n-(define_insn \"adddi3_compact\"\n+(define_insn_and_split \"adddi3_compact\"\n   [(set (match_operand:DI 0 \"arith_reg_dest\" \"=&r\")\n \t(plus:DI (match_operand:DI 1 \"arith_reg_operand\" \"%0\")\n \t\t (match_operand:DI 2 \"arith_reg_operand\" \"r\")))\n    (clobber (reg:SI T_REG))]\n   \"TARGET_SH1\"\n   \"#\"\n-  [(set_attr \"length\" \"6\")])\n-\n-(define_split\n-  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n-\t(plus:DI (match_operand:DI 1 \"arith_reg_operand\" \"\")\n-\t\t (match_operand:DI 2 \"arith_reg_operand\" \"\")))\n-   (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1 && reload_completed\"\n+  \"&& reload_completed\"\n   [(const_int 0)]\n {\n   rtx high0 = gen_highpart (SImode, operands[0]);\n@@ -1556,21 +1549,14 @@\n   [(set_attr \"type\" \"arith_media\")\n    (set_attr \"highpart\" \"ignore\")])\n \n-(define_insn \"subdi3_compact\"\n+(define_insn_and_split \"subdi3_compact\"\n   [(set (match_operand:DI 0 \"arith_reg_dest\" \"=&r\")\n \t(minus:DI (match_operand:DI 1 \"arith_reg_operand\" \"0\")\n \t\t (match_operand:DI 2 \"arith_reg_operand\" \"r\")))\n    (clobber (reg:SI T_REG))]\n   \"TARGET_SH1\"\n   \"#\"\n-  [(set_attr \"length\" \"6\")])\n-\n-(define_split\n-  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n-\t(minus:DI (match_operand:DI 1 \"arith_reg_operand\" \"\")\n-\t\t  (match_operand:DI 2 \"arith_reg_operand\" \"\")))\n-   (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1 && reload_completed\"\n+  \"&& reload_completed\"\n   [(const_int 0)]\n {\n   rtx high0 = gen_highpart (SImode, operands[0]);\n@@ -2861,9 +2847,9 @@ label:\n   [(set_attr \"type\" \"dmpy\")])\n \n (define_expand \"mulsidi3\"\n-  [(set (match_operand:DI 0 \"arith_reg_operand\" \"=r\")\n-\t(mult:DI (sign_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"r\"))\n-\t\t (sign_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"r\"))))]\n+  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n+\t(mult:DI (sign_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"\"))\n+\t\t (sign_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"\"))))]\n   \"TARGET_SH2 || TARGET_SHMEDIA\"\n {\n   if (TARGET_SH2)\n@@ -2882,24 +2868,16 @@ label:\n   [(set_attr \"type\" \"dmpy_media\")\n    (set_attr \"highpart\" \"ignore\")])\n \n-(define_insn \"mulsidi3_compact\"\n+(define_insn_and_split \"mulsidi3_compact\"\n   [(set (match_operand:DI 0 \"arith_reg_dest\" \"=r\")\n \t(mult:DI\n \t (sign_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"r\"))\n \t (sign_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"r\"))))\n    (clobber (reg:SI MACH_REG))\n    (clobber (reg:SI MACL_REG))]\n   \"TARGET_SH2\"\n-  \"#\")\n-\n-(define_split\n-  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n-\t(mult:DI\n-\t (sign_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"\"))\n-\t (sign_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"\"))))\n-   (clobber (reg:SI MACH_REG))\n-   (clobber (reg:SI MACL_REG))]\n-  \"TARGET_SH2\"\n+  \"#\"\n+  \"&& 1\"\n   [(const_int 0)]\n {\n   rtx low_dst = gen_lowpart (SImode, operands[0]);\n@@ -2930,9 +2908,9 @@ label:\n   [(set_attr \"type\" \"dmpy\")])\n \n (define_expand \"umulsidi3\"\n-  [(set (match_operand:DI 0 \"arith_reg_operand\" \"=r\")\n-\t(mult:DI (zero_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"r\"))\n-\t\t (zero_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"r\"))))]\n+  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n+\t(mult:DI (zero_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"\"))\n+\t\t (zero_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"\"))))]\n   \"TARGET_SH2 || TARGET_SHMEDIA\"\n {\n   if (TARGET_SH2)\n@@ -2951,23 +2929,16 @@ label:\n   [(set_attr \"type\" \"dmpy_media\")\n    (set_attr \"highpart\" \"ignore\")])\n \n-(define_insn \"umulsidi3_compact\"\n+(define_insn_and_split \"umulsidi3_compact\"\n   [(set (match_operand:DI 0 \"arith_reg_dest\" \"=r\")\n \t(mult:DI\n \t (zero_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"r\"))\n \t (zero_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"r\"))))\n    (clobber (reg:SI MACH_REG))\n    (clobber (reg:SI MACL_REG))]\n   \"TARGET_SH2\"\n-  \"#\")\n-\n-(define_split\n-  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n-\t(mult:DI (zero_extend:DI (match_operand:SI 1 \"arith_reg_operand\" \"\"))\n-\t\t (zero_extend:DI (match_operand:SI 2 \"arith_reg_operand\" \"\"))))\n-   (clobber (reg:SI MACH_REG))\n-   (clobber (reg:SI MACL_REG))]\n-  \"TARGET_SH2\"\n+  \"#\"\n+  \"&& 1\"\n   [(const_int 0)]\n {\n   rtx low_dst = gen_lowpart (SImode, operands[0]);\n@@ -3366,9 +3337,9 @@ label:\n ;; -------------------------------------------------------------------------\n \n (define_expand \"rotldi3\"\n-  [(set (match_operand:DI 0 \"arith_reg_dest\" \"=r\")\n-\t(rotate:DI (match_operand:DI 1 \"arith_reg_operand\" \"r\")\n-\t\t   (match_operand:HI 2 \"mextr_bit_offset\" \"i\")))]\n+  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n+\t(rotate:DI (match_operand:DI 1 \"arith_reg_operand\" \"\")\n+\t\t   (match_operand:HI 2 \"mextr_bit_offset\" \"\")))]\n   \"TARGET_SHMEDIA\"\n   \"if (! mextr_bit_offset (operands[2], HImode)) FAIL;\")\n \n@@ -3387,9 +3358,9 @@ label:\n   [(set_attr \"type\" \"arith_media\")])\n \n (define_expand \"rotrdi3\"\n-  [(set (match_operand:DI 0 \"arith_reg_dest\" \"=r\")\n-\t(rotatert:DI (match_operand:DI 1 \"arith_reg_operand\" \"r\")\n-\t\t     (match_operand:HI 2 \"mextr_bit_offset\" \"i\")))]\n+  [(set (match_operand:DI 0 \"arith_reg_dest\" \"\")\n+\t(rotatert:DI (match_operand:DI 1 \"arith_reg_operand\" \"\")\n+\t\t     (match_operand:HI 2 \"mextr_bit_offset\" \"\")))]\n   \"TARGET_SHMEDIA\"\n {\n   if (! mextr_bit_offset (operands[2], HImode))\n@@ -3567,13 +3538,19 @@ label:\n \tshll%O2\t%0\"\n   [(set_attr \"type\" \"arith\")])\n \n-(define_insn \"ashlsi3_n\"\n+(define_insn_and_split \"ashlsi3_n\"\n   [(set (match_operand:SI 0 \"arith_reg_dest\" \"=r\")\n \t(ashift:SI (match_operand:SI 1 \"arith_reg_operand\" \"0\")\n \t\t   (match_operand:SI 2 \"const_int_operand\" \"n\")))\n    (clobber (reg:SI T_REG))]\n   \"TARGET_SH1 && ! sh_dynamicalize_shift_p (operands[2])\"\n   \"#\"\n+  \"TARGET_SH1 && reload_completed\"\n+  [(use (reg:SI R0_REG))]\n+{\n+  gen_shifty_op (ASHIFT, operands);\n+  DONE;\n+}\n   [(set (attr \"length\")\n \t(cond [(match_test \"shift_insns_rtx (insn)\")\n \t       (const_string \"2\")\n@@ -3584,18 +3561,6 @@ label:\n \t      (const_string \"8\")))\n    (set_attr \"type\" \"arith\")])\n \n-(define_split\n-  [(set (match_operand:SI 0 \"arith_reg_dest\" \"\")\n-\t(ashift:SI (match_operand:SI 1 \"arith_reg_operand\" \"\")\n-\t\t   (match_operand:SI 2 \"const_int_operand\" \"\")))\n-   (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1 && reload_completed\"\n-  [(use (reg:SI R0_REG))]\n-{\n-  gen_shifty_op (ASHIFT, operands);\n-  DONE;\n-})\n-\n (define_insn \"ashlsi3_media\"\n   [(set (match_operand:SI 0 \"arith_reg_dest\" \"=r,r\")\n \t(ashift:SI (match_operand:SI 1 \"extend_reg_operand\" \"r,r\")\n@@ -3631,21 +3596,6 @@ label:\n     FAIL;\n })\n \n-(define_insn \"*ashlhi3_n\"\n-  [(set (match_operand:HI 0 \"arith_reg_dest\" \"=r\")\n-\t(ashift:HI (match_operand:HI 1 \"arith_reg_operand\" \"0\")\n-\t\t   (match_operand:HI 2 \"const_int_operand\" \"n\")))\n-   (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1\"\n-  \"#\"\n-  [(set (attr \"length\")\n-\t(cond [(match_test \"shift_insns_rtx (insn)\")\n-\t       (const_string \"2\")\n-\t       (eq (symbol_ref \"shift_insns_rtx (insn)\") (const_int 2))\n-\t       (const_string \"4\")]\n-\t      (const_string \"6\")))\n-   (set_attr \"type\" \"arith\")])\n-\n (define_expand \"ashlhi3\"\n   [(parallel [(set (match_operand:HI 0 \"arith_reg_operand\" \"\")\n \t\t   (ashift:HI (match_operand:HI 1 \"arith_reg_operand\" \"\")\n@@ -3661,17 +3611,26 @@ label:\n     operands[1] = copy_to_mode_reg (HImode, operands[1]);\n })\n \n-(define_split\n-  [(set (match_operand:HI 0 \"arith_reg_dest\" \"\")\n-\t(ashift:HI (match_operand:HI 1 \"arith_reg_operand\" \"\")\n-\t\t   (match_operand:HI 2 \"const_int_operand\" \"\")))\n+(define_insn_and_split \"*ashlhi3_n\"\n+  [(set (match_operand:HI 0 \"arith_reg_dest\" \"=r\")\n+\t(ashift:HI (match_operand:HI 1 \"arith_reg_operand\" \"0\")\n+\t\t   (match_operand:HI 2 \"const_int_operand\" \"n\")))\n    (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1 && reload_completed\"\n+  \"TARGET_SH1\"\n+  \"#\"\n+  \"&& reload_completed\"\n   [(use (reg:SI R0_REG))]\n {\n   gen_shifty_hi_op (ASHIFT, operands);\n   DONE;\n-})\n+}\n+  [(set (attr \"length\")\n+\t(cond [(match_test \"shift_insns_rtx (insn)\")\n+\t       (const_string \"2\")\n+\t       (eq (symbol_ref \"shift_insns_rtx (insn)\") (const_int 2))\n+\t       (const_string \"4\")]\n+\t      (const_string \"6\")))\n+   (set_attr \"type\" \"arith\")])\n \n ;;\n ;; arithmetic shift right\n@@ -3694,19 +3653,13 @@ label:\n \n ;; ??? This should be a define expand.\n \n-(define_insn \"ashrsi2_16\"\n+(define_insn_and_split \"ashrsi2_16\"\n   [(set (match_operand:SI 0 \"arith_reg_dest\" \"=r\")\n         (ashiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"r\")\n                      (const_int 16)))]\n   \"TARGET_SH1\"\n   \"#\"\n-  [(set_attr \"length\" \"4\")])\n-\n-(define_split\n-  [(set (match_operand:SI 0 \"arith_reg_dest\" \"\")\n-        (ashiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"\")\n-\t\t     (const_int 16)))]\n-  \"TARGET_SH1\"\n+  \"&& 1\"\n   [(set (match_dup 0) (rotate:SI (match_dup 1) (const_int 16)))\n    (set (match_dup 0) (sign_extend:SI (match_dup 2)))]\n {\n@@ -3715,21 +3668,14 @@ label:\n \n ;; ??? This should be a define expand.\n \n-(define_insn \"ashrsi2_31\"\n+(define_insn_and_split \"ashrsi2_31\"\n   [(set (match_operand:SI 0 \"arith_reg_dest\" \"=r\")\n \t(ashiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"0\")\n \t\t     (const_int 31)))\n    (clobber (reg:SI T_REG))]\n   \"TARGET_SH1\"\n   \"#\"\n-  [(set_attr \"length\" \"4\")])\n-\n-(define_split\n-  [(set (match_operand:SI 0 \"arith_reg_dest\" \"\")\n-\t(ashiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"\")\n-\t\t     (const_int 31)))\n-   (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1\"\n+  \"&& 1\"\n   [(const_int 0)]\n {\n   emit_insn (gen_ashlsi_c (operands[0], operands[1]));\n@@ -3799,7 +3745,7 @@ label:\n    (set_attr \"highpart\" \"ignore\")])\n \n (define_expand \"ashrsi3\"\n-  [(parallel [(set (match_operand:SI 0 \"arith_reg_operand\" \"\")\n+  [(parallel [(set (match_operand:SI 0 \"arith_reg_dest\" \"\")\n \t\t   (ashiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"\")\n \t\t\t\t(match_operand:SI 2 \"nonmemory_operand\" \"\")))\n \t      (clobber (reg:SI T_REG))])]\n@@ -3846,13 +3792,19 @@ label:\n   \"shlr%O2\t%0\"\n   [(set_attr \"type\" \"arith\")])\n \n-(define_insn \"lshrsi3_n\"\n+(define_insn_and_split \"lshrsi3_n\"\n   [(set (match_operand:SI 0 \"arith_reg_dest\" \"=r\")\n \t(lshiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"0\")\n \t\t     (match_operand:SI 2 \"const_int_operand\" \"n\")))\n    (clobber (reg:SI T_REG))]\n   \"TARGET_SH1 && ! sh_dynamicalize_shift_p (operands[2])\"\n   \"#\"\n+  \"TARGET_SH1 && reload_completed\"\n+  [(use (reg:SI R0_REG))]\n+{\n+  gen_shifty_op (LSHIFTRT, operands);\n+  DONE;\n+}\n   [(set (attr \"length\")\n \t(cond [(match_test \"shift_insns_rtx (insn)\")\n \t       (const_string \"2\")\n@@ -3863,18 +3815,6 @@ label:\n \t      (const_string \"8\")))\n    (set_attr \"type\" \"arith\")])\n \n-(define_split\n-  [(set (match_operand:SI 0 \"arith_reg_dest\" \"\")\n-\t(lshiftrt:SI (match_operand:SI 1 \"arith_reg_operand\" \"\")\n-\t\t     (match_operand:SI 2 \"const_int_operand\" \"\")))\n-   (clobber (reg:SI T_REG))]\n-  \"TARGET_SH1 && reload_completed\"\n-  [(use (reg:SI R0_REG))]\n-{\n-  gen_shifty_op (LSHIFTRT, operands);\n-  DONE;\n-})\n-\n (define_insn \"lshrsi3_media\"\n   [(set (match_operand:SI 0 \"arith_reg_dest\" \"=r,r\")\n \t(lshiftrt:SI (match_operand:SI 1 \"extend_reg_operand\" \"r,r\")"}]}