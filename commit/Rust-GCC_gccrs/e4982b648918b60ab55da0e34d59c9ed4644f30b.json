{"sha": "e4982b648918b60ab55da0e34d59c9ed4644f30b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQ5ODJiNjQ4OTE4YjYwYWI1NWRhMGUzNGQ1OWM5ZWQ0NjQ0ZjMwYg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-03T14:45:56Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-03T14:45:56Z"}, "message": "[multiple changes]\n\n2011-08-03  Ed Schonberg  <schonberg@adacore.com>\n\n\t* exp_ch5.adb (Expand_Iterator_Loop): indicate that the cursor is\n\tmodified in the source, to prevent spurious warnings when compiling\n\twith -gnatg.\n\n2011-08-03  Thomas Quinot  <quinot@adacore.com>\n\n\t* a-except-2005.adb: Minor reformatting.\n\n2011-08-03  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_warn.adb (Check_One_Unit): if the only mention of a withed unit\n\tis a renaming declaration in the private part of a package, do not emit\n\ta warning that the with_clause could be moved because the renaming may\n\tbe used in the body or in a child unit.\n\n2011-08-03  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* exp_ch6.adb (Make_Build_In_Place_Call_In_Object_Declaration):\n\tPropagate the Comes_From_Source attribute from the original return\n\tobject to the renaming.\n\n2011-08-03  Jose Ruiz  <ruiz@adacore.com>\n\n\t* exp_ch7.adb (Build_Raise_Statement): Do not call\n\tRaise_From_Controlled_Operation when this routine is not present in\n\tthe run-time library.\n\t(Cleanup_Protected_Object, Cleanup_Task): For restricted run-time\n\tlibraries (Ravenscar), tasks are non-terminating, and protected objects\n\tand tasks can only appear at library level, so we do not want\n\tfinalization of protected objects nor tasks.\n\t* exp_intr.adb: Minor clarification in comment.\n\tbindgen.adb (Gen_Adainit_Ada, Gen_Main_C, Gen_Output_File_Ada,\n\tGen_Output_File_C): Remove references to finalization of library-level\n\tobjects when using restricted run-time libraries.\n\n2011-08-03  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch3.adb (Build_Discriminant_Constraints): Set\n\tOriginal_Discriminant only if the parent type is a generic formal.\n\nFrom-SVN: r177278", "tree": {"sha": "2d32960fb664e091bc9b840b4f4cdbdfb1bc9b8b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d32960fb664e091bc9b840b4f4cdbdfb1bc9b8b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e4982b648918b60ab55da0e34d59c9ed4644f30b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4982b648918b60ab55da0e34d59c9ed4644f30b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e4982b648918b60ab55da0e34d59c9ed4644f30b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4982b648918b60ab55da0e34d59c9ed4644f30b/comments", "author": null, "committer": null, "parents": [{"sha": "ac88396b5e3bf22b4013339e7980a748d88eddf7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac88396b5e3bf22b4013339e7980a748d88eddf7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac88396b5e3bf22b4013339e7980a748d88eddf7"}], "stats": {"total": 244, "additions": 164, "deletions": 80}, "files": [{"sha": "9cf21ed38f28a9b0d221d3c81019f783a1f59b5e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -1,3 +1,45 @@\n+2011-08-03  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* exp_ch5.adb (Expand_Iterator_Loop): indicate that the cursor is\n+\tmodified in the source, to prevent spurious warnings when compiling\n+\twith -gnatg.\n+\n+2011-08-03  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* a-except-2005.adb: Minor reformatting.\n+\n+2011-08-03  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_warn.adb (Check_One_Unit): if the only mention of a withed unit\n+\tis a renaming declaration in the private part of a package, do not emit\n+\ta warning that the with_clause could be moved because the renaming may\n+\tbe used in the body or in a child unit.\n+\n+2011-08-03  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_ch6.adb (Make_Build_In_Place_Call_In_Object_Declaration):\n+\tPropagate the Comes_From_Source attribute from the original return\n+\tobject to the renaming.\n+\n+2011-08-03  Jose Ruiz  <ruiz@adacore.com>\n+\n+\t* exp_ch7.adb (Build_Raise_Statement): Do not call\n+\tRaise_From_Controlled_Operation when this routine is not present in\n+\tthe run-time library.\n+\t(Cleanup_Protected_Object, Cleanup_Task): For restricted run-time\n+\tlibraries (Ravenscar), tasks are non-terminating, and protected objects\n+\tand tasks can only appear at library level, so we do not want\n+\tfinalization of protected objects nor tasks.\n+\t* exp_intr.adb: Minor clarification in comment.\n+\tbindgen.adb (Gen_Adainit_Ada, Gen_Main_C, Gen_Output_File_Ada,\n+\tGen_Output_File_C): Remove references to finalization of library-level\n+\tobjects when using restricted run-time libraries.\n+\n+2011-08-03  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch3.adb (Build_Discriminant_Constraints): Set\n+\tOriginal_Discriminant only if the parent type is a generic formal.\n+\n 2011-08-03  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* exp_ch13.adb: Add with and use clause for Targparm;"}, {"sha": "e84b0e908ada2eac74e5db774659fb49fd3d0ba9", "filename": "gcc/ada/a-except-2005.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fa-except-2005.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fa-except-2005.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-except-2005.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -880,7 +880,7 @@ package body Ada.Exceptions is\n    procedure Raise_From_Controlled_Operation\n      (X : Ada.Exceptions.Exception_Occurrence)\n    is\n-      Prev_Exc  : constant EOA := Get_Current_Excep.all;\n+      Prev_Exc : constant EOA := Get_Current_Excep.all;\n \n    begin\n       --  We're raising an exception during finalization. If the finalization\n@@ -906,7 +906,7 @@ package body Ada.Exceptions is\n               (Orig_Msg'First .. Orig_Msg'First + Orig_Prefix_Length - 1);\n \n          begin\n-            --  Message already has the proper prefix, just re-reraise\n+            --  Message already has the proper prefix, just re-raise\n \n             if Orig_Prefix = Prefix then\n                Raise_Exception_No_Defer"}, {"sha": "2d9a1c1e85e72c062bc1ca680299cd7a86e91acd", "filename": "gcc/ada/bindgen.adb", "status": "modified", "additions": 39, "deletions": 25, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fbindgen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fbindgen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindgen.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -665,10 +665,11 @@ package body Bindgen is\n               \"\"\"__gnat_handler_installed\"\");\");\n \n          --  The import of the soft link which performs library-level object\n-         --  finalization is not needed for VM targets. Regular Ada is used in\n-         --  that case.\n+         --  finalization is not needed for VM targets; regular Ada is used in\n+         --  that case. For restricted run-time libraries (ZFP and Ravenscar)\n+         --  tasks are non-terminating, so we do not want finalization.\n \n-         if VM_Target = No_VM then\n+         if VM_Target = No_VM and then not Configurable_Run_Time_On_Target then\n             WBI (\"\");\n             WBI (\"      type No_Param_Proc is access procedure;\");\n             WBI (\"      Finalize_Library_Objects : No_Param_Proc;\");\n@@ -926,32 +927,38 @@ package body Bindgen is\n          WBI (\"      Initialize_Stack_Limit;\");\n       end if;\n \n-      --  Attach Finalize_Library to the right softlink\n+      --  Attach Finalize_Library to the right soft link. Do it only when not\n+      --  using a restricted run time, in which case tasks are\n+      --  non-terminating, so we do not want library-level finalization.\n \n-      if not Suppress_Standard_Library_On_Target then\n-         WBI (\"\");\n+      if not Configurable_Run_Time_On_Target then\n+         if not Suppress_Standard_Library_On_Target then\n+            WBI (\"\");\n \n-         if VM_Target = No_VM then\n-            if Lib_Final_Built then\n-               Set_String (\"      Finalize_Library_Objects := \");\n-               Set_String (\"Finalize_Library'access;\");\n-            else\n-               Set_String (\"      Finalize_Library_Objects := null;\");\n-            end if;\n+            if VM_Target = No_VM then\n+               if Lib_Final_Built then\n+                  Set_String (\"      Finalize_Library_Objects := \");\n+                  Set_String (\"Finalize_Library'access;\");\n+               else\n+                  Set_String (\"      Finalize_Library_Objects := null;\");\n+               end if;\n \n-         --  On VM targets use regular Ada to set the soft link\n+            --  On VM targets use regular Ada to set the soft link\n \n-         else\n-            if Lib_Final_Built then\n-               Set_String (\"      System.Soft_Links.Finalize_Library_Objects\");\n-               Set_String (\" := Finalize_Library'access;\");\n             else\n-               Set_String (\"      System.Soft_Links.Finalize_Library_Objects\");\n-               Set_String (\" := null;\");\n+               if Lib_Final_Built then\n+                  Set_String\n+                    (\"      System.Soft_Links.Finalize_Library_Objects\");\n+                  Set_String (\" := Finalize_Library'access;\");\n+               else\n+                  Set_String\n+                    (\"      System.Soft_Links.Finalize_Library_Objects\");\n+                  Set_String (\" := null;\");\n+               end if;\n             end if;\n-         end if;\n \n-         Write_Statement_Buffer;\n+            Write_Statement_Buffer;\n+         end if;\n       end if;\n \n       --  Generate elaboration calls\n@@ -2117,7 +2124,10 @@ package body Bindgen is\n    ----------------\n \n    procedure Gen_Main_C is\n-      Needs_Library_Finalization : constant Boolean := Has_Finalizer;\n+      Needs_Library_Finalization : constant Boolean :=\n+        not Configurable_Run_Time_On_Target and then Has_Finalizer;\n+      --  For restricted run-time libraries (ZFP and Ravenscar) tasks are\n+      --  non-terminating, so we do not want library-level finalization.\n \n    begin\n       if Exit_Status_Supported_On_Target then\n@@ -2638,7 +2648,10 @@ package body Bindgen is\n       --  Name to be used for generated Ada main program. See the body of\n       --  function Get_Ada_Main_Name for details on the form of the name.\n \n-      Needs_Library_Finalization : constant Boolean := Has_Finalizer;\n+      Needs_Library_Finalization : constant Boolean :=\n+        not Configurable_Run_Time_On_Target and then Has_Finalizer;\n+      --  For restricted run-time libraries (ZFP and Ravenscar) tasks are\n+      --  non-terminating, so we do not want finalization.\n \n       Bfiles : Name_Id;\n       --  Name of generated bind file (spec)\n@@ -2990,7 +3003,8 @@ package body Bindgen is\n \n    procedure Gen_Output_File_C (Filename : String) is\n \n-      Needs_Library_Finalization : constant Boolean := Has_Finalizer;\n+      Needs_Library_Finalization : constant Boolean :=\n+        not Configurable_Run_Time_On_Target and then Has_Finalizer;\n \n       Bfile : Name_Id;\n       pragma Warnings (Off, Bfile);"}, {"sha": "5f3e30049f74df985317611ebf1616327f110856", "filename": "gcc/ada/exp_ch5.adb", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch5.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -3020,6 +3020,12 @@ package body Exp_Ch5 is\n                     Selector_Name =>\n                       Make_Identifier (Loc, Name_Init))));\n \n+            --  The cursor is not modified in the source, but of course will\n+            --  be updated in the generated code. Indicate that it is actually\n+            --  set to prevent spurious warnings.\n+\n+            Set_Never_Set_In_Source (Cursor, False);\n+\n             --  If the range of iteration is given by a function call that\n             --  returns a container, the finalization actions have been saved\n             --  in the Condition_Actions of the iterator. Insert them now at"}, {"sha": "1bb0a710a22d52c37228286acc59e3c7d2a6acce", "filename": "gcc/ada/exp_ch6.adb", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch6.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -7787,7 +7787,10 @@ package body Exp_Ch6 is\n \n             Preserve_Comes_From_Source\n               (Object_Decl, Original_Node (Object_Decl));\n-            Set_Comes_From_Source (Obj_Def_Id, True);\n+\n+            Preserve_Comes_From_Source\n+              (Obj_Def_Id, Original_Node (Object_Decl));\n+\n             Set_Comes_From_Source (Renaming_Def_Id, False);\n          end;\n       end if;"}, {"sha": "e72c19b409550f19d68378a3f513d3c5bb8c8dc9", "filename": "gcc/ada/exp_ch7.adb", "status": "modified", "additions": 40, "deletions": 15, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch7.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -316,7 +316,7 @@ package body Exp_Ch7 is\n    --          Save_Occurrence (E_Id, Get_Current_Excep.all.all);\n    --       end if;\n    --\n-   --  If flag For_Library is set:\n+   --  If flag For_Library is set (and not in restricted profile):\n    --\n    --    when others =>\n    --       if not Raised_Id then\n@@ -769,7 +769,7 @@ package body Exp_Ch7 is\n                   Prefix =>\n                     New_Reference_To (RTE (RE_Get_Current_Excep), Loc)))));\n \n-      if For_Library then\n+      if For_Library and then not Restricted_Profile then\n          Proc_To_Call := RTE (RE_Save_Library_Occurrence);\n \n       else\n@@ -2922,8 +2922,15 @@ package body Exp_Ch7 is\n       Raise_Id : Entity_Id;\n \n    begin\n-      if VM_Target = No_VM then\n+      if VM_Target /= No_VM then\n+         Raise_Id := RTE (RE_Reraise_Occurrence);\n+\n+      --  Standard run-time library\n+      elsif RTE_Available (RE_Raise_From_Controlled_Operation) then\n          Raise_Id := RTE (RE_Raise_From_Controlled_Operation);\n+\n+      --  Restricted runtime: exception messages are not supported and hence\n+      --  Raise_From_Controlled_Operation is not supported.\n       else\n          Raise_Id := RTE (RE_Reraise_Occurrence);\n       end if;\n@@ -3166,12 +3173,21 @@ package body Exp_Ch7 is\n       Loc : constant Source_Ptr := Sloc (N);\n \n    begin\n-      return\n-        Make_Procedure_Call_Statement (Loc,\n-          Name =>\n-            New_Reference_To (RTE (RE_Finalize_Protection), Loc),\n-          Parameter_Associations =>\n-            New_List (Concurrent_Ref (Ref)));\n+      --  For restricted run-time libraries (Ravenscar), tasks are\n+      --  non-terminating, and protected objects can only appear at library\n+      --  level, so we do not want finalization of protected objects.\n+\n+      if Restricted_Profile then\n+         return Empty;\n+\n+      else\n+         return\n+           Make_Procedure_Call_Statement (Loc,\n+             Name =>\n+               New_Reference_To (RTE (RE_Finalize_Protection), Loc),\n+             Parameter_Associations =>\n+               New_List (Concurrent_Ref (Ref)));\n+      end if;\n    end Cleanup_Protected_Object;\n \n    ------------------\n@@ -3184,12 +3200,21 @@ package body Exp_Ch7 is\n    is\n       Loc  : constant Source_Ptr := Sloc (N);\n    begin\n-      return\n-        Make_Procedure_Call_Statement (Loc,\n-          Name =>\n-            New_Reference_To (RTE (RE_Free_Task), Loc),\n-          Parameter_Associations =>\n-            New_List (Concurrent_Ref (Ref)));\n+      --  For restricted run-time libraries (Ravenscar), tasks are\n+      --  non-terminating and they can only appear at library level, so we do\n+      --  not want finalization of task objects.\n+\n+      if Restricted_Profile then\n+         return Empty;\n+\n+      else\n+         return\n+           Make_Procedure_Call_Statement (Loc,\n+             Name =>\n+               New_Reference_To (RTE (RE_Free_Task), Loc),\n+             Parameter_Associations =>\n+               New_List (Concurrent_Ref (Ref)));\n+      end if;\n    end Cleanup_Task;\n \n    ------------------------------"}, {"sha": "a08a9e3865cf94fdefd7a7e3da7798eaeeea293b", "filename": "gcc/ada/exp_intr.adb", "status": "modified", "additions": 8, "deletions": 26, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_intr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fexp_intr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_intr.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -31,7 +31,6 @@ with Errout;   use Errout;\n with Exp_Atag; use Exp_Atag;\n with Exp_Ch4;  use Exp_Ch4;\n with Exp_Ch7;  use Exp_Ch7;\n-with Exp_Ch11; use Exp_Ch11;\n with Exp_Code; use Exp_Code;\n with Exp_Fixd; use Exp_Fixd;\n with Exp_Util; use Exp_Util;\n@@ -965,7 +964,6 @@ package body Exp_Intr is\n                New_Reference_To (Standard_False, Loc));\n \n          Append_To (Stmts, Raised_Decl);\n-         Analyze (Raised_Decl);\n \n          Exc_Occ_Decl :=\n            Make_Object_Declaration (Loc,\n@@ -975,7 +973,6 @@ package body Exp_Intr is\n          Set_No_Initialization (Exc_Occ_Decl);\n \n          Append_To (Stmts, Exc_Occ_Decl);\n-         Analyze (Exc_Occ_Decl);\n \n          Final_Code := New_List (\n            Make_Block_Statement (Loc,\n@@ -1034,21 +1031,7 @@ package body Exp_Intr is\n                   At_End_Proc =>\n                     New_Occurrence_Of (RTE (RE_Abort_Undefer_Direct), Loc)));\n \n-            --  We now expand the exception (at end) handler. We set a\n-            --  temporary parent pointer since we have not attached Blk\n-            --  to the tree yet.\n-\n-            Set_Parent (Blk, N);\n-            Analyze (Blk);\n-            Expand_At_End_Handler\n-              (Handled_Statement_Sequence (Blk), Entity (Identifier (Blk)));\n             Append (Blk, Stmts);\n-\n-            --  We kill saved current values, since analyzing statements not\n-            --  properly attached to the tree can set wrong current values.\n-\n-            Kill_Current_Values;\n-\n          else\n             Append_List_To (Stmts, Final_Code);\n          end if;\n@@ -1129,7 +1112,7 @@ package body Exp_Intr is\n       Append_To (Stmts, Free_Node);\n       Set_Storage_Pool (Free_Node, Pool);\n \n-      --  Attach to tree before analysis of generated subtypes below.\n+      --  Attach to tree before analysis of generated subtypes below\n \n       Set_Parent (Stmts, Parent (N));\n \n@@ -1142,17 +1125,15 @@ package body Exp_Intr is\n          if Is_RTE (Pool, RE_SS_Pool) then\n             null;\n \n-         elsif Is_Class_Wide_Type (Etype (Pool)) then\n+         --  Case of a class-wide pool type: make a dispatching call to\n+         --  Deallocate through the class-wide Deallocate_Any.\n \n-            --  Case of a class-wide pool type: make a dispatching call\n-            --  to Deallocate through the class-wide Deallocate_Any.\n+         elsif Is_Class_Wide_Type (Etype (Pool)) then\n+            Set_Procedure_To_Call (Free_Node, RTE (RE_Deallocate_Any));\n \n-            Set_Procedure_To_Call (Free_Node,\n-              RTE (RE_Deallocate_Any));\n+         --  Case of a specific pool type: make a statically bound call\n \n          else\n-            --  Case of a specific pool type: make a statically bound call\n-\n             Set_Procedure_To_Call (Free_Node,\n               Find_Prim_Op (Etype (Pool), Name_Deallocate));\n          end if;\n@@ -1261,7 +1242,8 @@ package body Exp_Intr is\n       --\n       --  Generate:\n       --    if Raised then\n-      --       Reraise_Occurrence (Exc_Occ);               --  for .NET\n+      --       Reraise_Occurrence (Exc_Occ);               --  for .NET and\n+      --                                                   --  restricted RTS\n       --         <or>\n       --       Raise_From_Controlled_Operation (Exc_Occ);  --  all other cases\n       --    end if;"}, {"sha": "1851f93b2e2a8825629049b097ce4933c20f1f35", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -8354,14 +8354,11 @@ package body Sem_Ch3 is\n                      Error_Msg_N (\"& does not match any discriminant\", Id);\n                      return New_Elmt_List;\n \n-                  --  The following is only useful for the benefit of generic\n-                  --  instances but it does not interfere with other\n-                  --  processing for the non-generic case so we do it in all\n-                  --  cases (for generics this statement is executed when\n-                  --  processing the generic definition, see comment at the\n-                  --  beginning of this if statement).\n+                  --  If the parent type is a generic formal, preserve the\n+                  --  name of the discriminant for subsequent instances.\n+                  --  see comment at the beginning of this if statement.\n \n-                  else\n+                  elsif Is_Generic_Type (Root_Type (T)) then\n                      Set_Original_Discriminant (Id, Discr);\n                   end if;\n                end if;"}, {"sha": "6b9dd9b415408053e1ecfe0ca1302ed9b1736fd2", "filename": "gcc/ada/sem_warn.adb", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fsem_warn.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e4982b648918b60ab55da0e34d59c9ed4644f30b/gcc%2Fada%2Fsem_warn.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_warn.adb?ref=e4982b648918b60ab55da0e34d59c9ed4644f30b", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1999-2010, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1999-2011, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -2425,9 +2425,19 @@ package body Sem_Warn is\n                               Pack :=\n                                 Find_Package_Renaming\n                                   (Spec_Entity (Munite), Lunit);\n+                           else\n+                              Pack := Empty;\n                            end if;\n \n-                           if Unreferenced_In_Spec (Item) then\n+                           --  If a renaming is present in the spec do not warn\n+                           --  because the body or child unit may depend on it.\n+\n+                           if Present (Pack)\n+                             and then Renamed_Entity (Pack) = Lunit\n+                           then\n+                              exit;\n+\n+                           elsif Unreferenced_In_Spec (Item) then\n                               Error_Msg_N -- CODEFIX\n                                 (\"?unit& is not referenced in spec!\",\n                                  Name (Item));\n@@ -3367,10 +3377,15 @@ package body Sem_Warn is\n                               Error_Msg_FE\n                                 (\"`IN OUT` prefix overlaps with actual for&?\",\n                                  Act1, Form);\n+\n                            else\n+\n+                              --  For greater clarity, give name of formal.\n+\n+                              Error_Msg_Node_2 := Form;\n                               Error_Msg_FE\n-                                (\"writable actual overlaps with actual for&?\",\n-                                 Act1, Form);\n+                                (\"writable actual for & overlaps with\"\n+                                  & \"  actual for&?\", Act1, Form);\n                            end if;\n \n                         else"}]}