{"sha": "5028356f89c3b41afa1a06ded96c6b82dd732ab7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTAyODM1NmY4OWMzYjQxYWZhMWEwNmRlZDk2YzZiODJkZDczMmFiNw==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2014-05-30T11:39:49Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2014-05-30T11:39:49Z"}, "message": "-fuse-caller-save - Enable for i386\n\n2014-05-30  Tom de Vries  <tom@codesourcery.com>\n\n\t* config/i386/i386.c (TARGET_CALL_FUSAGE_CONTAINS_NON_CALLEE_CLOBBERS):\n\tRedefine as true.\n\n\t* gcc.target/i386/fuse-caller-save.c: New test.\n\t* gcc.dg/ira-shrinkwrap-prep-1.c: Run with -fno-use-caller-save.\n\t* gcc.dg/ira-shrinkwrap-prep-2.c: Same.\n\nFrom-SVN: r211078", "tree": {"sha": "3459e32db14e3ba9f4c29f960b72170af6cbc471", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3459e32db14e3ba9f4c29f960b72170af6cbc471"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5028356f89c3b41afa1a06ded96c6b82dd732ab7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5028356f89c3b41afa1a06ded96c6b82dd732ab7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5028356f89c3b41afa1a06ded96c6b82dd732ab7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5028356f89c3b41afa1a06ded96c6b82dd732ab7/comments", "author": null, "committer": null, "parents": [{"sha": "29f095214040d604e9ec4f933bd2c3bfad7a722b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29f095214040d604e9ec4f933bd2c3bfad7a722b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29f095214040d604e9ec4f933bd2c3bfad7a722b"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "c7b2af3afc76e3a19e196754a6f8ac4423efce12", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5028356f89c3b41afa1a06ded96c6b82dd732ab7", "patch": "@@ -1,3 +1,8 @@\n+2014-05-30  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* config/i386/i386.c (TARGET_CALL_FUSAGE_CONTAINS_NON_CALLEE_CLOBBERS):\n+\tRedefine as true.\n+\n 2014-05-30  Tom de Vries  <tom@codesourcery.com>\n \n \t* lra-int.h (struct lra_reg): Add field actual_call_used_reg_set."}, {"sha": "83d3ba3c089fbbd55bf0e4be0165429b29e22642", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=5028356f89c3b41afa1a06ded96c6b82dd732ab7", "patch": "@@ -47272,6 +47272,9 @@ ix86_atomic_assign_expand_fenv (tree *hold, tree *clear, tree *update)\n #undef TARGET_MODE_PRIORITY\n #define TARGET_MODE_PRIORITY ix86_mode_priority\n \n+#undef TARGET_CALL_FUSAGE_CONTAINS_NON_CALLEE_CLOBBERS\n+#define TARGET_CALL_FUSAGE_CONTAINS_NON_CALLEE_CLOBBERS true\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n #include \"gt-i386.h\""}, {"sha": "1d846dca8e942cd63ca5e5e98160d1152217c802", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5028356f89c3b41afa1a06ded96c6b82dd732ab7", "patch": "@@ -1,3 +1,9 @@\n+2014-05-30  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* gcc.target/i386/fuse-caller-save.c: New test.\n+\t* gcc.dg/ira-shrinkwrap-prep-1.c: Run with -fno-use-caller-save.\n+\t* gcc.dg/ira-shrinkwrap-prep-2.c: Same.\n+\n 2014-04-30  Alan Lawrence  <alan.lawrence@arm.com>\n \n \tgcc.target/arm/simd/vrev16p8_1.c: New file."}, {"sha": "fc7b142afdf4d4a423d7cdfc3d288ac7d37fda95", "filename": "gcc/testsuite/gcc.dg/ira-shrinkwrap-prep-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2Fgcc.dg%2Fira-shrinkwrap-prep-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2Fgcc.dg%2Fira-shrinkwrap-prep-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fira-shrinkwrap-prep-1.c?ref=5028356f89c3b41afa1a06ded96c6b82dd732ab7", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile { target { { x86_64-*-* && lp64 } || { powerpc*-*-* && lp64 } } } } */\n-/* { dg-options \"-O3 -fdump-rtl-ira -fdump-rtl-pro_and_epilogue\"  } */\n+/* { dg-options \"-O3 -fdump-rtl-ira -fdump-rtl-pro_and_epilogue -fno-use-caller-save\"  } */\n \n long __attribute__((noinline, noclone))\n foo (long a)"}, {"sha": "2e5a9cfdc2928cbba6eb232c699a9546f344bd9e", "filename": "gcc/testsuite/gcc.dg/ira-shrinkwrap-prep-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2Fgcc.dg%2Fira-shrinkwrap-prep-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2Fgcc.dg%2Fira-shrinkwrap-prep-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fira-shrinkwrap-prep-2.c?ref=5028356f89c3b41afa1a06ded96c6b82dd732ab7", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile { target { { x86_64-*-* && lp64 } || { powerpc*-*-* && lp64 } } } } */\n-/* { dg-options \"-O3 -fdump-rtl-ira -fdump-rtl-pro_and_epilogue\"  } */\n+/* { dg-options \"-O3 -fdump-rtl-ira -fdump-rtl-pro_and_epilogue -fno-use-caller-save\"  } */\n \n long __attribute__((noinline, noclone))\n foo (long a)"}, {"sha": "ff77d81427f009492adfe759394797840eea046d", "filename": "gcc/testsuite/gcc.target/i386/fuse-caller-save.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuse-caller-save.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5028356f89c3b41afa1a06ded96c6b82dd732ab7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuse-caller-save.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuse-caller-save.c?ref=5028356f89c3b41afa1a06ded96c6b82dd732ab7", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fuse-caller-save\" } */\n+/* Testing -fuse-caller-save optimization option.  */\n+\n+static int __attribute__((noinline))\n+bar (int x)\n+{\n+  return x + 3;\n+}\n+\n+int __attribute__((noinline))\n+foo (int y)\n+{\n+  return y + bar (y);\n+}\n+\n+int\n+main (void)\n+{\n+  return !(foo (5) == 13);\n+}\n+\n+/* { dg-final { scan-assembler-not \"\\.cfi_def_cfa_offset\"  } } */\n+/* { dg-final { scan-assembler-not \"\\.cfi_offset\"  } } */\n+"}]}