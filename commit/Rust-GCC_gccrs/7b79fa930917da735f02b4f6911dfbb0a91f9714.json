{"sha": "7b79fa930917da735f02b4f6911dfbb0a91f9714", "node_id": "C_kwDOANBUbNoAKDdiNzlmYTkzMDkxN2RhNzM1ZjAyYjRmNjkxMWRmYmIwYTkxZjk3MTQ", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-11-28T10:52:23Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-11-28T16:57:35Z"}, "message": "libstdc++: Fix _Hash_bytes for I16LP32 targets [PR107885]\n\nFor H8/300 size_t is 32 bits wide, but (unsigned char)buf[2] << 16\npromotes to int which is only 16 bits wide. The shift is then undefined.\nThis fixes it by converting to size_t before shifting.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/107885\n\t* libsupc++/hash_bytes.cc (_Hash_bytes): Convert to size_t\n\tinstead of implicit integer promotion to 16 bits.", "tree": {"sha": "99c402155552fc6ac6a1d14b2785acbb580282a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99c402155552fc6ac6a1d14b2785acbb580282a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b79fa930917da735f02b4f6911dfbb0a91f9714", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b79fa930917da735f02b4f6911dfbb0a91f9714", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b79fa930917da735f02b4f6911dfbb0a91f9714", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b79fa930917da735f02b4f6911dfbb0a91f9714/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7a41b5cfd7406da1f2e5a0f1f813521d3dc2bb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7a41b5cfd7406da1f2e5a0f1f813521d3dc2bb2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7a41b5cfd7406da1f2e5a0f1f813521d3dc2bb2"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "67e2dbb1a0fe86dc967af4c9f2b720c205b1e784", "filename": "libstdc++-v3/libsupc++/hash_bytes.cc", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b79fa930917da735f02b4f6911dfbb0a91f9714/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fhash_bytes.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b79fa930917da735f02b4f6911dfbb0a91f9714/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fhash_bytes.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Fhash_bytes.cc?ref=7b79fa930917da735f02b4f6911dfbb0a91f9714", "patch": "@@ -90,17 +90,21 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \tlen -= 4;\n       }\n \n+    size_t k;\n     // Handle the last few bytes of the input array.\n     switch(len)\n       {\n       case 3:\n-\thash ^= static_cast<unsigned char>(buf[2]) << 16;\n+\tk = static_cast<unsigned char>(buf[2]);\n+\thash ^= k << 16;\n \t[[gnu::fallthrough]];\n       case 2:\n-\thash ^= static_cast<unsigned char>(buf[1]) << 8;\n+\tk = static_cast<unsigned char>(buf[1]);\n+\thash ^= k << 8;\n \t[[gnu::fallthrough]];\n       case 1:\n-\thash ^= static_cast<unsigned char>(buf[0]);\n+\tk = static_cast<unsigned char>(buf[0]);\n+\thash ^= k;\n \thash *= m;\n       };\n "}]}