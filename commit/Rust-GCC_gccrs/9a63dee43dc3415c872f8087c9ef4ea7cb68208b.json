{"sha": "9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWE2M2RlZTQzZGMzNDE1Yzg3MmY4MDg3YzllZjRlYTdjYjY4MjA4Yg==", "commit": {"author": {"name": "Georg-Johann Lay", "email": "avr@gjlay.de", "date": "2011-06-29T07:52:56Z"}, "committer": {"name": "Georg-Johann Lay", "email": "gjl@gcc.gnu.org", "date": "2011-06-29T07:52:56Z"}, "message": "t-avr (LIB1ASMFUNCS): Add _mulhisi3, _umulhisi3, _xmulhisi3_exit.\n\n\t* config/avr/t-avr (LIB1ASMFUNCS): Add _mulhisi3, _umulhisi3,\n\t_xmulhisi3_exit.\n\t* config/avr/libgcc.S (_xmulhisi3_exit): New Function.\n\t(__mulhisi3): Optimize if have MUL*.  Use XJMP instead of rjmp.\n\t(__umulhisi3): Ditto.\n\t* config/avr/avr.md (mulhisi3): New insn expender.\n\t(umulhisi3): New insn expender.\n\t(*mulhisi3_call): New insn.\n\t(*umulhisi3_call): New insn.\n\nFrom-SVN: r175620", "tree": {"sha": "bc2060ac8eb6c415f5985e6e51b7e04a1b03d11c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc2060ac8eb6c415f5985e6e51b7e04a1b03d11c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/comments", "author": null, "committer": {"login": "sprintersb", "id": 8905355, "node_id": "MDQ6VXNlcjg5MDUzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8905355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sprintersb", "html_url": "https://github.com/sprintersb", "followers_url": "https://api.github.com/users/sprintersb/followers", "following_url": "https://api.github.com/users/sprintersb/following{/other_user}", "gists_url": "https://api.github.com/users/sprintersb/gists{/gist_id}", "starred_url": "https://api.github.com/users/sprintersb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sprintersb/subscriptions", "organizations_url": "https://api.github.com/users/sprintersb/orgs", "repos_url": "https://api.github.com/users/sprintersb/repos", "events_url": "https://api.github.com/users/sprintersb/events{/privacy}", "received_events_url": "https://api.github.com/users/sprintersb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2ac88e57d709dfc484b3d41ef365b08cd761fe65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ac88e57d709dfc484b3d41ef365b08cd761fe65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ac88e57d709dfc484b3d41ef365b08cd761fe65"}], "stats": {"total": 195, "additions": 185, "deletions": 10}, "files": [{"sha": "2b40b2c1046e0aa6f67d85422516e80cfe2dd454", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "patch": "@@ -1,3 +1,15 @@\n+2011-06-29  Georg-Johann Lay  <avr@gjlay.de>\n+\t\n+\t* config/avr/t-avr (LIB1ASMFUNCS): Add _mulhisi3, _umulhisi3,\n+\t_xmulhisi3_exit.\n+\t* config/avr/libgcc.S (_xmulhisi3_exit): New Function.\n+\t(__mulhisi3): Optimize if have MUL*.  Use XJMP instead of rjmp.\n+\t(__umulhisi3): Ditto.\n+\t* config/avr/avr.md (mulhisi3): New insn expender.\n+\t(umulhisi3): New insn expender.\n+\t(*mulhisi3_call): New insn.\n+\t(*umulhisi3_call): New insn.\n+\n 2011-06-28  Joseph Myers  <joseph@codesourcery.com>\n \n \t* Makefile.in (LIBGCC2_CFLAGS): Remove -D__GCC_FLOAT_NOT_NEEDED."}, {"sha": "a07992389cb1d79506f370d307436bad6a3fac99", "filename": "gcc/config/avr/avr.md", "status": "modified", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2Fconfig%2Favr%2Favr.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2Fconfig%2Favr%2Favr.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Favr%2Favr.md?ref=9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "patch": "@@ -1056,6 +1056,50 @@\n   [(set_attr \"type\" \"xcall\")\n    (set_attr \"cc\" \"clobber\")])\n \n+(define_expand \"mulhisi3\"\n+  [(set (reg:HI 18)\n+        (match_operand:HI 1 \"register_operand\" \"\"))\n+   (set (reg:HI 20)\n+        (match_operand:HI 2 \"register_operand\" \"\"))\n+   (set (reg:SI 22) \n+        (mult:SI (sign_extend:SI (reg:HI 18))\n+                 (sign_extend:SI (reg:HI 20))))\n+   (set (match_operand:SI 0 \"register_operand\" \"\") \n+        (reg:SI 22))]\n+  \"AVR_HAVE_MUL\"\n+  \"\")\n+\n+(define_expand \"umulhisi3\"\n+  [(set (reg:HI 18)\n+        (match_operand:HI 1 \"register_operand\" \"\"))\n+   (set (reg:HI 20)\n+        (match_operand:HI 2 \"register_operand\" \"\"))\n+   (set (reg:SI 22) \n+        (mult:SI (zero_extend:SI (reg:HI 18))\n+                 (zero_extend:SI (reg:HI 20))))\n+   (set (match_operand:SI 0 \"register_operand\" \"\") \n+        (reg:SI 22))]\n+  \"AVR_HAVE_MUL\"\n+  \"\")\n+\n+(define_insn \"*mulhisi3_call\"\n+  [(set (reg:SI 22) \n+        (mult:SI (sign_extend:SI (reg:HI 18))\n+                 (sign_extend:SI (reg:HI 20))))]\n+  \"AVR_HAVE_MUL\"\n+  \"%~call __mulhisi3\"\n+  [(set_attr \"type\" \"xcall\")\n+   (set_attr \"cc\" \"clobber\")])\n+\n+(define_insn \"*umulhisi3_call\"\n+  [(set (reg:SI 22) \n+        (mult:SI (zero_extend:SI (reg:HI 18))\n+                 (zero_extend:SI (reg:HI 20))))]\n+  \"AVR_HAVE_MUL\"\n+  \"%~call __umulhisi3\"\n+  [(set_attr \"type\" \"xcall\")\n+   (set_attr \"cc\" \"clobber\")])\n+\n ; / % / % / % / % / % / % / % / % / % / % / % / % / % / % / % / % / % / % / %\n ; divmod\n "}, {"sha": "9d13d9611b4b6e4c65f0cd977ec231c1cd0c56da", "filename": "gcc/config/avr/libgcc.S", "status": "modified", "additions": 126, "deletions": 10, "changes": 136, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2Fconfig%2Favr%2Flibgcc.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2Fconfig%2Favr%2Flibgcc.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Favr%2Flibgcc.S?ref=9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "patch": "@@ -178,10 +178,58 @@ __mulhi3_exit:\n #endif /* defined (L_mulhi3) */\n #endif /* !defined (__AVR_HAVE_MUL__) */\n \n+/*******************************************************\n+      Widening Multiplication  32 = 16 x 16\n+*******************************************************/\n+                              \n #if defined (L_mulhisi3)\n-\t.global\t__mulhisi3\n-\t.func\t__mulhisi3\n-__mulhisi3:\n+DEFUN __mulhisi3\n+#if defined (__AVR_HAVE_MUL__)\n+\n+;; r25:r22 = r19:r18 * r21:r20\n+\n+#define A0 18\n+#define B0 20\n+#define C0 22\n+\n+#define A1 A0+1\n+#define B1 B0+1\n+#define C1 C0+1\n+#define C2 C0+2\n+#define C3 C0+3\n+ \n+    ; C = (signed)A1 * (signed)B1\n+    muls  A1, B1\n+    movw  C2, R0\n+\n+    ; C += A0 * B0\n+    mul   A0, B0\n+    movw  C0, R0\n+\n+    ; C += (signed)A1 * B0\n+    mulsu A1, B0\n+    sbci  C3, 0\n+    add   C1, R0\n+    adc   C2, R1\n+    clr   __zero_reg__\n+    adc   C3, __zero_reg__\n+\n+    ; C += (signed)B1 * A0\n+    mulsu B1, A0\n+    sbci  C3, 0\n+    XJMP  __xmulhisi3_exit\n+\n+#undef A0\n+#undef A1\n+#undef B0\n+#undef B1\n+#undef C0\n+#undef C1\n+#undef C2\n+#undef C3\n+\n+#else /* !__AVR_HAVE_MUL__ */\n+;;; FIXME: This is dead code (noone calls it)\n \tmov_l\tr18, r24\n \tmov_h\tr19, r25\n \tclr\tr24\n@@ -192,24 +240,92 @@ __mulhisi3:\n \tsbrc\tr19, 7\n \tdec\tr20\n \tmov\tr21, r20\n-\trjmp\t__mulsi3\n-\t.endfunc\n+\tXJMP\t__mulsi3\n+#endif /* __AVR_HAVE_MUL__ */\n+ENDF __mulhisi3\n #endif /* defined (L_mulhisi3) */\n \n #if defined (L_umulhisi3)\n-\t.global\t__umulhisi3\n-\t.func\t__umulhisi3\n-__umulhisi3:\n+DEFUN __umulhisi3\n+#if defined (__AVR_HAVE_MUL__)\n+\n+;; r25:r22 = r19:r18 * r21:r20\n+\n+#define A0 18\n+#define B0 20\n+#define C0 22\n+\n+#define A1 A0+1\n+#define B1 B0+1\n+#define C1 C0+1\n+#define C2 C0+2\n+#define C3 C0+3\n+\n+    ; C = A1 * B1\n+    mul   A1, B1\n+    movw  C2, R0\n+\n+    ; C += A0 * B0\n+    mul   A0, B0\n+    movw  C0, R0\n+\n+    ; C += A1 * B0\n+    mul   A1, B0\n+    add   C1, R0\n+    adc   C2, R1\n+    clr   __zero_reg__\n+    adc   C3, __zero_reg__\n+\n+    ; C += B1 * A0\n+    mul   B1, A0\n+    XJMP  __xmulhisi3_exit\n+\n+#undef A0\n+#undef A1\n+#undef B0\n+#undef B1\n+#undef C0\n+#undef C1\n+#undef C2\n+#undef C3\n+\n+#else /* !__AVR_HAVE_MUL__ */\n+;;; FIXME: This is dead code (noone calls it)\n \tmov_l\tr18, r24\n \tmov_h\tr19, r25\n \tclr\tr24\n \tclr\tr25\n \tclr\tr20\n \tclr\tr21\n-\trjmp\t__mulsi3\n-\t.endfunc\n+\tXJMP\t__mulsi3\n+#endif /* __AVR_HAVE_MUL__ */\n+ENDF __umulhisi3\n #endif /* defined (L_umulhisi3) */\n \n+#if defined (L_xmulhisi3_exit)\n+\n+;;; Helper for __mulhisi3 resp. __umulhisi3.\n+\n+#define C0 22\n+#define C1 C0+1\n+#define C2 C0+2\n+#define C3 C0+3\n+\n+DEFUN __xmulhisi3_exit\n+    add   C1, R0\n+    adc   C2, R1\n+    clr   __zero_reg__\n+    adc   C3, __zero_reg__\n+    ret\n+ENDF __xmulhisi3_exit\n+\n+#undef C0\n+#undef C1\n+#undef C2\n+#undef C3\n+\n+#endif /* defined (L_xmulhisi3_exit) */\n+\n #if defined (L_mulsi3)\n /*******************************************************\n                Multiplication  32 x 32"}, {"sha": "026ee10b10e95e8f2392ba0ac991061f441d465d", "filename": "gcc/config/avr/t-avr", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2Fconfig%2Favr%2Ft-avr", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a63dee43dc3415c872f8087c9ef4ea7cb68208b/gcc%2Fconfig%2Favr%2Ft-avr", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Favr%2Ft-avr?ref=9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "patch": "@@ -39,6 +39,9 @@ LIB1ASMSRC = avr/libgcc.S\n LIB1ASMFUNCS = \\\n \t_mulqi3 \\\n \t_mulhi3 \\\n+\t_mulhisi3 \\\n+\t_umulhisi3 \\\n+\t_xmulhisi3_exit \\\n \t_mulsi3 \\\n \t_udivmodqi4 \\\n \t_divmodqi4 \\"}]}