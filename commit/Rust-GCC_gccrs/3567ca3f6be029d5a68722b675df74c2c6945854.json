{"sha": "3567ca3f6be029d5a68722b675df74c2c6945854", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzU2N2NhM2Y2YmUwMjlkNWE2ODcyMmI2NzVkZjc0YzJjNjk0NTg1NA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2018-07-17T08:06:55Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-17T08:06:55Z"}, "message": "[Ada] Fix Enclosing_Subprogram for protected entries and task entries\n\n2018-07-17  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_util.adb (Enclosing_Subprogram): Protected entries and task\n\tentries must be treated separately: task entries are within the\n\tenclosing subprogram of the task type, while protected entries are\n\ttransformed into the corresponding Protected_Body_Subprogram, which is\n\tthe enclosing_subprogram of any subprogram declared within the entry\n\tbody.\n\nFrom-SVN: r262778", "tree": {"sha": "0fcc14e6808f8c572ba618866885b20f17d5eaab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0fcc14e6808f8c572ba618866885b20f17d5eaab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3567ca3f6be029d5a68722b675df74c2c6945854", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3567ca3f6be029d5a68722b675df74c2c6945854", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3567ca3f6be029d5a68722b675df74c2c6945854", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3567ca3f6be029d5a68722b675df74c2c6945854/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eae2aa7ce1e52e5789410d0ad2d3e10c77ac2fc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eae2aa7ce1e52e5789410d0ad2d3e10c77ac2fc4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eae2aa7ce1e52e5789410d0ad2d3e10c77ac2fc4"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "4f747f22b759f42217fdfdcbce081f9723d70c69", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3567ca3f6be029d5a68722b675df74c2c6945854/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3567ca3f6be029d5a68722b675df74c2c6945854/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3567ca3f6be029d5a68722b675df74c2c6945854", "patch": "@@ -1,3 +1,12 @@\n+2018-07-17  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_util.adb (Enclosing_Subprogram): Protected entries and task\n+\tentries must be treated separately: task entries are within the\n+\tenclosing subprogram of the task type, while protected entries are\n+\ttransformed into the corresponding Protected_Body_Subprogram, which is\n+\tthe enclosing_subprogram of any subprogram declared within the entry\n+\tbody.\n+\n 2018-07-17  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* doc/gnat_ugn/building_executable_programs_with_gnat.rst: Add missing"}, {"sha": "31d5c1748d93241d5433654ad22358366fba1e12", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3567ca3f6be029d5a68722b675df74c2c6945854/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3567ca3f6be029d5a68722b675df74c2c6945854/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=3567ca3f6be029d5a68722b675df74c2c6945854", "patch": "@@ -6906,10 +6906,25 @@ package body Sem_Util is\n       elsif Ekind (Dynamic_Scope) = E_Subprogram_Body then\n          return Corresponding_Spec (Parent (Parent (Dynamic_Scope)));\n \n-      elsif Ekind_In (Dynamic_Scope, E_Block, E_Return_Statement, E_Entry)\n-      then\n+      elsif Ekind_In (Dynamic_Scope, E_Block, E_Return_Statement) then\n          return Enclosing_Subprogram (Dynamic_Scope);\n \n+      elsif Ekind (Dynamic_Scope) = E_Entry then\n+\n+         --  For a task entry, return the enclosing subprogram of the\n+         --  task itself.\n+\n+         if Ekind (Scope (Dynamic_Scope)) = E_Task_Type then\n+            return Enclosing_Subprogram (Dynamic_Scope);\n+\n+         --  A protected entry is rewritten as a protected procedure\n+         --  which is the desired enclosing subprogram. This is relevant\n+         --  when unnesting a procedure local to an entry body\n+\n+         else\n+            return Protected_Body_Subprogram (Dynamic_Scope);\n+         end if;\n+\n       elsif Ekind (Dynamic_Scope) = E_Task_Type then\n          return Get_Task_Body_Procedure (Dynamic_Scope);\n "}]}