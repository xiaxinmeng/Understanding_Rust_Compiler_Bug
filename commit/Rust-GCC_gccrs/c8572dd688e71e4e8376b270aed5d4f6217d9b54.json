{"sha": "c8572dd688e71e4e8376b270aed5d4f6217d9b54", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzg1NzJkZDY4OGU3MWU0ZTgzNzZiMjcwYWVkNWQ0ZjYyMTdkOWI1NA==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-06-03T20:42:08Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-06-03T20:42:08Z"}, "message": "re PR c++/27100 (ICE with multiple friend declarations)\n\nFix PR c++/27100\n\ngcc/cp/ChangeLog:\n\n\tPR c++/27100\n\t* decl.c (duplicate_decls): Properly copy the\n\tDECL_PENDING_INLINE_P, DECL_PENDING_INLINE_INFO and\n\tDECL_SAVED_FUNCTION_DATA fields from OLDDECL to NEWDECL.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/27100\n\t* g++.dg/other/friend6.C: New test.\n\nFrom-SVN: r237078", "tree": {"sha": "512c9c2ecc0a93b425170e5c085e92c022006d59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/512c9c2ecc0a93b425170e5c085e92c022006d59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c8572dd688e71e4e8376b270aed5d4f6217d9b54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8572dd688e71e4e8376b270aed5d4f6217d9b54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8572dd688e71e4e8376b270aed5d4f6217d9b54", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8572dd688e71e4e8376b270aed5d4f6217d9b54/comments", "author": null, "committer": null, "parents": [{"sha": "1c7733a760d7000a9c947d13b8c515d249c74fc8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c7733a760d7000a9c947d13b8c515d249c74fc8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c7733a760d7000a9c947d13b8c515d249c74fc8"}], "stats": {"total": 40, "additions": 38, "deletions": 2}, "files": [{"sha": "0569d842e54006ab7d53c0eb787a6d6b198cd8bf", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c8572dd688e71e4e8376b270aed5d4f6217d9b54", "patch": "@@ -1,3 +1,10 @@\n+2016-06-03  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/27100\n+\t* decl.c (duplicate_decls): Properly copy the\n+\tDECL_PENDING_INLINE_P, DECL_PENDING_INLINE_INFO and\n+\tDECL_SAVED_FUNCTION_DATA fields from OLDDECL to NEWDECL.\n+\n 2016-06-03  Chung-Lin Tang  <cltang@codesourcery.com>\n \n \t* semantics.c (finish_omp_clauses): Mark OpenACC reduction"}, {"sha": "3328e7158aa4bd95e718f891aaa08ab4d5b51c70", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=c8572dd688e71e4e8376b270aed5d4f6217d9b54", "patch": "@@ -2351,8 +2351,17 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n \t}\n       else\n \t{\n-\t  if (DECL_PENDING_INLINE_INFO (newdecl) == 0)\n-\t    DECL_PENDING_INLINE_INFO (newdecl) = DECL_PENDING_INLINE_INFO (olddecl);\n+\t  if (DECL_PENDING_INLINE_P (olddecl))\n+\t    {\n+\t      DECL_PENDING_INLINE_P (newdecl) = 1;\n+\t      DECL_PENDING_INLINE_INFO (newdecl)\n+\t\t= DECL_PENDING_INLINE_INFO (olddecl);\n+\t    }\n+\t  else if (DECL_PENDING_INLINE_P (newdecl))\n+\t    ;\n+\t  else if (DECL_SAVED_FUNCTION_DATA (newdecl) == NULL)\n+\t    DECL_SAVED_FUNCTION_DATA (newdecl)\n+\t      = DECL_SAVED_FUNCTION_DATA (olddecl);\n \n \t  DECL_DECLARED_INLINE_P (newdecl) |= DECL_DECLARED_INLINE_P (olddecl);\n "}, {"sha": "659477b8e7ea1c0a357e7b61ef0c98edb0614dc1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c8572dd688e71e4e8376b270aed5d4f6217d9b54", "patch": "@@ -1,3 +1,8 @@\n+2016-06-03  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/27100\n+\t* g++.dg/other/friend6.C: New test.\n+\n 2016-06-03  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* g++.dg/torture/ppc-ldst-array.C: New."}, {"sha": "851cd25237ab01e42802d8bc9bc0ac40c2347bba", "filename": "gcc/testsuite/g++.dg/other/friend6.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Ffriend6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8572dd688e71e4e8376b270aed5d4f6217d9b54/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Ffriend6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Ffriend6.C?ref=c8572dd688e71e4e8376b270aed5d4f6217d9b54", "patch": "@@ -0,0 +1,15 @@\n+// PR c++/27100\n+// This used to fail at link time with an \"undefined reference to 'foo'\" error.\n+// { dg-do run }\n+\n+struct A\n+{\n+  friend void foo (const A&) { }\n+  friend void foo (const A&);\n+};\n+\n+int\n+main ()\n+{\n+  foo (A ());\n+}"}]}