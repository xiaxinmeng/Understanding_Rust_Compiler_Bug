{"sha": "3799a5b853ef08d781407009427f9ddc9a6ec7be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzc5OWE1Yjg1M2VmMDhkNzgxNDA3MDA5NDI3ZjlkZGM5YTZlYzdiZQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2017-02-10T16:33:45Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2017-02-10T16:33:45Z"}, "message": "re PR c++/79184 (-Wint-in-bool-context triggered erroneously in template parameter)\n\n\tPR c++/79184\n\t* cvt.c (ocp_convert): Add a sentinel against -Wint-in-bool-context\n\tif warnings shouldn't be given.\n\n\t* g++.dg/warn/Wint-in-bool-context-1.C: New.\n\nFrom-SVN: r245335", "tree": {"sha": "a4bcc54abde1d36997602780f82030ac500335ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a4bcc54abde1d36997602780f82030ac500335ec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3799a5b853ef08d781407009427f9ddc9a6ec7be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3799a5b853ef08d781407009427f9ddc9a6ec7be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3799a5b853ef08d781407009427f9ddc9a6ec7be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3799a5b853ef08d781407009427f9ddc9a6ec7be/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6f4f30bf3142fe3454345be587b373aa457078d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f4f30bf3142fe3454345be587b373aa457078d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f4f30bf3142fe3454345be587b373aa457078d3"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "5ea0c930a096305bfa378c84a10125aac412722f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3799a5b853ef08d781407009427f9ddc9a6ec7be", "patch": "@@ -4,6 +4,10 @@\n \t* pt.c (type_dependent_expression_p): Check if the expression type\n \tis null.\n \n+\tPR c++/79184\n+\t* cvt.c (ocp_convert): Add a sentinel against -Wint-in-bool-context\n+\tif warnings shouldn't be given.\n+\n 2017-02-10  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/71737"}, {"sha": "5f4b5e30a5fe2f0e893fbb9501d9165f3ceb6a65", "filename": "gcc/cp/cvt.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Fcp%2Fcvt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Fcp%2Fcvt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcvt.c?ref=3799a5b853ef08d781407009427f9ddc9a6ec7be", "patch": "@@ -798,7 +798,15 @@ ocp_convert (tree type, tree expr, int convtype, int flags,\n \t     to the underlying type first.  */\n \t  if (SCOPED_ENUM_P (intype) && (convtype & CONV_STATIC))\n \t    e = build_nop (ENUM_UNDERLYING_TYPE (intype), e);\n-\t  return cp_truthvalue_conversion (e);\n+\t  if (complain & tf_warning)\n+\t    return cp_truthvalue_conversion (e);\n+\t  else\n+\t    {\n+\t      /* Prevent bogus -Wint-in-bool-context warnings coming\n+\t\t from c_common_truthvalue_conversion down the line.  */\n+\t      warning_sentinel w (warn_int_in_bool_context);\n+\t      return cp_truthvalue_conversion (e);\n+\t    }\n \t}\n \n       converted = convert_to_integer_maybe_fold (type, e, dofold);"}, {"sha": "aab9ef51d0acedbe3e1896bc530b37c8cd37795a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3799a5b853ef08d781407009427f9ddc9a6ec7be", "patch": "@@ -3,6 +3,9 @@\n \tPR c++/79435\n \t* g++.dg/cpp1y/pr79435.C: New.\n \n+\tPR c++/79184\n+\t* g++.dg/warn/Wint-in-bool-context-1.C: New.\n+\n 2017-02-10  Christophe Lyon  <christophe.lyon@linaro.org>\n \n \t* gcc.target/aarch64/advsimd-intrinsics/p64_p128.c"}, {"sha": "117eca433ba7e6f03780e70793a5097e789a7955", "filename": "gcc/testsuite/g++.dg/warn/Wint-in-bool-context-1.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWint-in-bool-context-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3799a5b853ef08d781407009427f9ddc9a6ec7be/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWint-in-bool-context-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWint-in-bool-context-1.C?ref=3799a5b853ef08d781407009427f9ddc9a6ec7be", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/79184\n+// { dg-do compile }\n+// { dg-options \"-Wint-in-bool-context\" }\n+\n+enum { E = 2 };\n+template <bool> void f(int) { }\n+template <int> void f() {}\n+\n+int\n+main ()\n+{\n+  f<1 * 1>(); // { dg-bogus \"in boolean context\" }\n+  f<1 << 1>(); // { dg-bogus \"in boolean context\" }\n+  f<1 ? 3 : 2>(); // { dg-bogus \"in boolean context\" }\n+  f<E>(); // { dg-bogus \"in boolean context\" }\n+}"}]}