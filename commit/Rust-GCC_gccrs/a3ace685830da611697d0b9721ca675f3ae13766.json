{"sha": "a3ace685830da611697d0b9721ca675f3ae13766", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNhY2U2ODU4MzBkYTYxMTY5N2QwYjk3MjFjYTY3NWYzYWUxMzc2Ng==", "commit": {"author": {"name": "Richard Henderson", "email": "richard.henderson@linaro.org", "date": "2018-10-31T23:12:14Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2018-10-31T23:12:14Z"}, "message": "Add visibility to libfunc constructors\n\n\t* optabs-libfuncs.c (build_libfunc_function_visibility):\n\tNew, split out from...\n\t(build_libfunc_function): ... here.\n\t(init_one_libfunc_visibility): New, split out from ...\n\t(init_one_libfunc): ... here.\n\nFrom-SVN: r265704", "tree": {"sha": "a8c3ef7ca75d3c88a15f28bb5ca635ca058e3bc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a8c3ef7ca75d3c88a15f28bb5ca635ca058e3bc7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3ace685830da611697d0b9721ca675f3ae13766", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3ace685830da611697d0b9721ca675f3ae13766", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3ace685830da611697d0b9721ca675f3ae13766", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3ace685830da611697d0b9721ca675f3ae13766/comments", "author": {"login": "rth7680", "id": 2529319, "node_id": "MDQ6VXNlcjI1MjkzMTk=", "avatar_url": "https://avatars.githubusercontent.com/u/2529319?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rth7680", "html_url": "https://github.com/rth7680", "followers_url": "https://api.github.com/users/rth7680/followers", "following_url": "https://api.github.com/users/rth7680/following{/other_user}", "gists_url": "https://api.github.com/users/rth7680/gists{/gist_id}", "starred_url": "https://api.github.com/users/rth7680/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rth7680/subscriptions", "organizations_url": "https://api.github.com/users/rth7680/orgs", "repos_url": "https://api.github.com/users/rth7680/repos", "events_url": "https://api.github.com/users/rth7680/events{/privacy}", "received_events_url": "https://api.github.com/users/rth7680/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "53de1ea800db54b47290d578c43892799b66c8dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53de1ea800db54b47290d578c43892799b66c8dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53de1ea800db54b47290d578c43892799b66c8dc"}], "stats": {"total": 34, "additions": 28, "deletions": 6}, "files": [{"sha": "56e802ef0afbef91dbb6294f45ee85a99a09a3eb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3ace685830da611697d0b9721ca675f3ae13766/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3ace685830da611697d0b9721ca675f3ae13766/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a3ace685830da611697d0b9721ca675f3ae13766", "patch": "@@ -1,5 +1,11 @@\n 2018-10-31  Richard Henderson  <richard.henderson@linaro.org>\n \n+\t* optabs-libfuncs.c (build_libfunc_function_visibility):\n+\tNew, split out from...\n+\t(build_libfunc_function): ... here.\n+\t(init_one_libfunc_visibility): New, split out from ...\n+\t(init_one_libfunc): ... here.\n+\n \t* config/aarch64/atomics.md (aarch64_atomic_<ATOMIC_LDOP><ALLI>_lse):\n \tscratch register need not be early-clobber.  Document the reason\n \twhy we cannot use ST<OP>."}, {"sha": "73a28e9ca7a1e5b1564861071e0923d8b8219d25", "filename": "gcc/optabs-libfuncs.c", "status": "modified", "additions": 20, "deletions": 6, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3ace685830da611697d0b9721ca675f3ae13766/gcc%2Foptabs-libfuncs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3ace685830da611697d0b9721ca675f3ae13766/gcc%2Foptabs-libfuncs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs-libfuncs.c?ref=a3ace685830da611697d0b9721ca675f3ae13766", "patch": "@@ -719,10 +719,10 @@ struct libfunc_decl_hasher : ggc_ptr_hash<tree_node>\n /* A table of previously-created libfuncs, hashed by name.  */\n static GTY (()) hash_table<libfunc_decl_hasher> *libfunc_decls;\n \n-/* Build a decl for a libfunc named NAME.  */\n+/* Build a decl for a libfunc named NAME with visibility VIS.  */\n \n tree\n-build_libfunc_function (const char *name)\n+build_libfunc_function_visibility (const char *name, symbol_visibility vis)\n {\n   /* ??? We don't have any type information; pretend this is \"int foo ()\".  */\n   tree decl = build_decl (UNKNOWN_LOCATION, FUNCTION_DECL,\n@@ -731,7 +731,7 @@ build_libfunc_function (const char *name)\n   DECL_EXTERNAL (decl) = 1;\n   TREE_PUBLIC (decl) = 1;\n   DECL_ARTIFICIAL (decl) = 1;\n-  DECL_VISIBILITY (decl) = VISIBILITY_DEFAULT;\n+  DECL_VISIBILITY (decl) = vis;\n   DECL_VISIBILITY_SPECIFIED (decl) = 1;\n   gcc_assert (DECL_ASSEMBLER_NAME (decl));\n \n@@ -742,11 +742,19 @@ build_libfunc_function (const char *name)\n   return decl;\n }\n \n+/* Build a decl for a libfunc named NAME.  */\n+\n+tree\n+build_libfunc_function (const char *name)\n+{\n+  return build_libfunc_function_visibility (name, VISIBILITY_DEFAULT);\n+}\n+\n /* Return a libfunc for NAME, creating one if we don't already have one.\n-   The returned rtx is a SYMBOL_REF.  */\n+   The decl is given visibility VIS.  The returned rtx is a SYMBOL_REF.  */\n \n rtx\n-init_one_libfunc (const char *name)\n+init_one_libfunc_visibility (const char *name, symbol_visibility vis)\n {\n   tree id, decl;\n   hashval_t hash;\n@@ -763,12 +771,18 @@ init_one_libfunc (const char *name)\n     {\n       /* Create a new decl, so that it can be passed to\n \t targetm.encode_section_info.  */\n-      decl = build_libfunc_function (name);\n+      decl = build_libfunc_function_visibility (name, vis);\n       *slot = decl;\n     }\n   return XEXP (DECL_RTL (decl), 0);\n }\n \n+rtx\n+init_one_libfunc (const char *name)\n+{\n+  return init_one_libfunc_visibility (name, VISIBILITY_DEFAULT);\n+}\n+\n /* Adjust the assembler name of libfunc NAME to ASMSPEC.  */\n \n rtx"}, {"sha": "cf39da36887516193aa789446ef0b6a7c24fb1ef", "filename": "gcc/optabs-libfuncs.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3ace685830da611697d0b9721ca675f3ae13766/gcc%2Foptabs-libfuncs.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3ace685830da611697d0b9721ca675f3ae13766/gcc%2Foptabs-libfuncs.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs-libfuncs.h?ref=a3ace685830da611697d0b9721ca675f3ae13766", "patch": "@@ -63,7 +63,9 @@ void gen_satfract_conv_libfunc (convert_optab, const char *,\n void gen_satfractuns_conv_libfunc (convert_optab, const char *,\n \t\t\t\t   machine_mode, machine_mode);\n \n+tree build_libfunc_function_visibility (const char *, symbol_visibility);\n tree build_libfunc_function (const char *);\n+rtx init_one_libfunc_visibility (const char *, symbol_visibility);\n rtx init_one_libfunc (const char *);\n rtx set_user_assembler_libfunc (const char *, const char *);\n "}]}