{"sha": "598dc594fa743db13fae4a884e33079a06de07e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTk4ZGM1OTRmYTc0M2RiMTNmYWU0YTg4NGUzMzA3OWEwNmRlMDdlMg==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-06-09T15:33:28Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-06-09T15:33:28Z"}, "message": "re PR fortran/63514 (functions containing volatile are considered pure)\n\n2018-06-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n PR fortran/63514\n * symbol.c (gfc_add_volatile): Enforce F2008:C1282 and F2018:C1588.\n\n\n2018-06-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n PR fortran/63514\n * gfortran.dg/pr63514.f90: New test.\n\nFrom-SVN: r261360", "tree": {"sha": "5c2a866c63fed50de846dfdcd2665df720745fc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5c2a866c63fed50de846dfdcd2665df720745fc7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/598dc594fa743db13fae4a884e33079a06de07e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/598dc594fa743db13fae4a884e33079a06de07e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/598dc594fa743db13fae4a884e33079a06de07e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/598dc594fa743db13fae4a884e33079a06de07e2/comments", "author": null, "committer": null, "parents": [{"sha": "1ae28fc34c1f1baada3e40e613bce904fd283203", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ae28fc34c1f1baada3e40e613bce904fd283203", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ae28fc34c1f1baada3e40e613bce904fd283203"}], "stats": {"total": 65, "additions": 65, "deletions": 0}, "files": [{"sha": "5f1ed3bc75d49d9a1bad85c44266f47fa39868b0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=598dc594fa743db13fae4a884e33079a06de07e2", "patch": "@@ -1,3 +1,8 @@\n+2018-06-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/63514\n+\t* symbol.c (gfc_add_volatile): Enforce F2008:C1282 and F2018:C1588.\n+\n 2018-06-08  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/85631"}, {"sha": "b4a950aa4af9c212fda1117804901e8afb96b1eb", "filename": "gcc/fortran/symbol.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ffortran%2Fsymbol.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ffortran%2Fsymbol.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsymbol.c?ref=598dc594fa743db13fae4a884e33079a06de07e2", "patch": "@@ -1349,6 +1349,20 @@ gfc_add_volatile (symbol_attribute *attr, const char *name, locus *where)\n \t\t\t where))\n       return false;\n \n+  /* F2008:  C1282 A designator of a variable with the VOLATILE attribute\n+     shall not appear in a pure subprogram.\n+\n+     F2018: C1588 A local variable of a pure subprogram, or of a BLOCK\n+     construct within a pure subprogram, shall not have the SAVE or\n+     VOLATILE attribute.  */\n+  if (gfc_pure (NULL))\n+    {\n+      gfc_error (\"VOLATILE attribute at %L cannot be specified in a \"\n+\t\t \"PURE procedure\", where);\n+      return false;\n+    }\n+\n+\n   attr->volatile_ = 1;\n   attr->volatile_ns = gfc_current_ns;\n   return check_conflict (attr, name, where);"}, {"sha": "36135a88521afd56bf65854a91c192dbc39679ed", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=598dc594fa743db13fae4a884e33079a06de07e2", "patch": "@@ -1,3 +1,8 @@\n+2018-06-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/63514\n+\t* gfortran.dg/pr63514.f90: New test.\n+\n 2018-06-08  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/85631"}, {"sha": "389fb92608ec2ec08af4421fb1247dfb16d143bd", "filename": "gcc/testsuite/gfortran.dg/pr63514.f90", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr63514.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/598dc594fa743db13fae4a884e33079a06de07e2/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr63514.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr63514.f90?ref=598dc594fa743db13fae4a884e33079a06de07e2", "patch": "@@ -0,0 +1,41 @@\n+! { dg-do compile }\n+! PR fortran/63514.f90\n+program foo\n+\n+   implicit none\n+\n+   integer, volatile :: n\n+\n+   n = 0\n+\n+   call bar\n+   call bah\n+\n+   contains\n+\n+   subroutine bar\n+      integer k\n+      integer, volatile :: m\n+      block\n+         integer, save :: i\n+         integer, volatile :: j\n+         i = 42\n+         j = 2 * i\n+         k = i + j + n\n+      end block\n+   end subroutine bar\n+\n+   pure subroutine bah\n+      integer k\n+      integer, volatile :: m     ! { dg-error \"cannot be specified in a PURE\" }\n+      block\n+         integer, save :: i      ! { dg-error \"cannot be specified in a PURE\" }\n+         integer, volatile :: j  ! { dg-error \"cannot be specified in a PURE\" }\n+         i = 42                  ! { dg-error \"has no IMPLICIT type\" }\n+         j = 2 * i               ! { dg-error \"has no IMPLICIT type\" }\n+         k = i + j + n\n+      end block\n+      m = k * m                  ! { dg-error \"has no IMPLICIT type\" }\n+   end subroutine bah\n+\n+end program foo"}]}