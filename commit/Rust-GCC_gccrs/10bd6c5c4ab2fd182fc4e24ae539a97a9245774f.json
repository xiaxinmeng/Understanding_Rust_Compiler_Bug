{"sha": "10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTBiZDZjNWM0YWIyZmQxODJmYzRlMjRhZTUzOWE5N2E5MjQ1Nzc0Zg==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-01-14T16:45:22Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-01-14T16:45:22Z"}, "message": "re PR tree-optimization/38826 (points-to result wrong for reads from call-clobbered vars)\n\n2009-01-14  Richard Guenther  <rguenther@suse.de>\n\n\tPR tree-optimization/38826\n\tPR middle-end/38477\n\t* tree-ssa-structalias.c (emit_alias_warning): Emit the pointer\n\tinitialization notes only if we actually emitted a warning.\n\t(intra_create_variable_infos): Add constraints for a result decl\n\tthat is passed by hidden reference.\n\t(build_pred_graph): Mark all related variables non-direct on\n\taddress-taking.\n\n\t* gcc.dg/Wstrict-aliasing-bogus-pta-1.c: New testcase.\n\nFrom-SVN: r143374", "tree": {"sha": "8fa08c2737a3ac983b265b46753713f8c3d356b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8fa08c2737a3ac983b265b46753713f8c3d356b3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7fe8ccdae51b85dd812af0d06df6f1a730064bc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fe8ccdae51b85dd812af0d06df6f1a730064bc1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7fe8ccdae51b85dd812af0d06df6f1a730064bc1"}], "stats": {"total": 71, "additions": 65, "deletions": 6}, "files": [{"sha": "97e97422c5a4de13c347bfa9586b598c2b5e41fc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "patch": "@@ -1,3 +1,14 @@\n+2009-01-14  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/38826\n+\tPR middle-end/38477\n+\t* tree-ssa-structalias.c (emit_alias_warning): Emit the pointer\n+\tinitialization notes only if we actually emitted a warning.\n+\t(intra_create_variable_infos): Add constraints for a result decl\n+\tthat is passed by hidden reference.\n+\t(build_pred_graph): Mark all related variables non-direct on\n+\taddress-taking.\n+\n 2009-01-14  Nick Clifton  <nickc@redhat.com>\n \n \t* ira-conflicts.c: Include addresses.h for the definition of"}, {"sha": "8432ec6cdfe2fec3c19b87b152dc70aa2f78b31f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "patch": "@@ -1,3 +1,9 @@\n+2009-01-14  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/38826\n+\tPR middle-end/38477\n+\t* gcc.dg/Wstrict-aliasing-bogus-pta-1.c: New testcase.\n+\n 2009-01-13  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* gcc.dg/graphite/pr38786.c: Fix commit problem."}, {"sha": "a48827474d7ee5f81e85f46a626012d056623c87", "filename": "gcc/testsuite/gcc.dg/Wstrict-aliasing-bogus-pta-1.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2Ftestsuite%2Fgcc.dg%2FWstrict-aliasing-bogus-pta-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2Ftestsuite%2Fgcc.dg%2FWstrict-aliasing-bogus-pta-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWstrict-aliasing-bogus-pta-1.c?ref=10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wall\" } */\n+\n+struct S { int *p; int *q; };\n+\n+void foo (struct S *);\n+\n+int bar (int b)\n+{\n+  struct S s;\n+  int *p;\n+  float f;\n+  foo (&s);\n+  if (b)\n+    p = s.q;\n+  else\n+    p = (int *)&f;\n+  return *p;\n+}"}, {"sha": "8b49556b3c00547e5b3b04b86b8d4cb308f18cc3", "filename": "gcc/tree-ssa-structalias.c", "status": "modified", "additions": 29, "deletions": 6, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2Ftree-ssa-structalias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10bd6c5c4ab2fd182fc4e24ae539a97a9245774f/gcc%2Ftree-ssa-structalias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-structalias.c?ref=10bd6c5c4ab2fd182fc4e24ae539a97a9245774f", "patch": "@@ -1129,6 +1129,8 @@ build_pred_graph (void)\n \t}\n       else if (rhs.type == ADDRESSOF)\n \t{\n+\t  varinfo_t v;\n+\n \t  /* x = &y */\n \t  if (graph->points_to[lhsvar] == NULL)\n \t    graph->points_to[lhsvar] = BITMAP_ALLOC (&predbitmap_obstack);\n@@ -1141,7 +1143,19 @@ build_pred_graph (void)\n \t  /* Implicitly, *x = y */\n \t  add_implicit_graph_edge (graph, FIRST_REF_NODE + lhsvar, rhsvar);\n \n+\t  /* All related variables are no longer direct nodes.  */\n \t  RESET_BIT (graph->direct_nodes, rhsvar);\n+\t  v = get_varinfo (rhsvar);\n+\t  if (!v->is_full_var)\n+\t    {\n+\t      v = lookup_vi_for_tree (v->decl);\n+\t      do\n+\t\t{\n+\t\t  RESET_BIT (graph->direct_nodes, v->id);\n+\t\t  v = v->next;\n+\t\t}\n+\t      while (v != NULL);\n+\t    }\n \t  bitmap_set_bit (graph->address_taken, rhsvar);\n \t}\n       else if (lhsvar > anything_id\n@@ -4561,6 +4575,16 @@ intra_create_variable_infos (void)\n \t}\n     }\n \n+  /* Add a constraint for a result decl that is passed by reference.  */\n+  if (DECL_RESULT (cfun->decl)\n+      && DECL_BY_REFERENCE (DECL_RESULT (cfun->decl)))\n+    {\n+      varinfo_t p, result_vi = get_vi_for_tree (DECL_RESULT (cfun->decl));\n+\n+      for (p = result_vi; p; p = p->next)\n+        make_constraint_from (p, nonlocal_id);\n+    }\n+\n   /* Add a constraint for the incoming static chain parameter.  */\n   if (cfun->static_chain_decl != NULL_TREE)\n     {\n@@ -4735,7 +4759,7 @@ emit_alias_warning (tree ptr)\n {\n   gimple use;\n   imm_use_iterator ui;\n-  unsigned warned = 0;\n+  bool warned = false;\n \n   FOR_EACH_IMM_USE_STMT (use, ui, ptr)\n     {\n@@ -4773,13 +4797,12 @@ emit_alias_warning (tree ptr)\n \t  && !TREE_NO_WARNING (deref))\n \t{\n \t  TREE_NO_WARNING (deref) = 1;\n-\t  warning_at (gimple_location (use), OPT_Wstrict_aliasing,\n-\t\t      \"dereferencing pointer %qD does break strict-aliasing \"\n-\t\t      \"rules\", SSA_NAME_VAR (ptr));\n-\t  ++warned;\n+\t  warned |= warning_at (gimple_location (use), OPT_Wstrict_aliasing,\n+\t\t\t\t\"dereferencing pointer %qD does break \"\n+\t\t\t\t\"strict-aliasing rules\", SSA_NAME_VAR (ptr));\n \t}\n     }\n-  if (warned > 0)\n+  if (warned)\n     {\n       bitmap visited = BITMAP_ALLOC (NULL);\n       emit_pointer_definition (ptr, visited);"}]}