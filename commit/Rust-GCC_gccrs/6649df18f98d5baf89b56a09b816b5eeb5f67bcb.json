{"sha": "6649df18f98d5baf89b56a09b816b5eeb5f67bcb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjY0OWRmMThmOThkNWJhZjg5YjU2YTA5YjgxNmI1ZWViNWY2N2JjYg==", "commit": {"author": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2020-09-29T00:13:40Z"}, "committer": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2020-09-29T22:27:16Z"}, "message": "Fix GCC 10+ build failure with zstd version 1.2.0 or older.\n\nExtends the configure check for zstd.h to also verify the zstd version,\nsince gcc requires features that only exist in 1.3.0 and newer.  Without\nthis patch we get a build error for lto-compress.c when using an old zstd\nversion.\n\n\tgcc/\n\tPR bootstrap/97183\n\t* configure.ac (gcc_cv_header_zstd_h): Check ZSTD_VERISON_NUMBER.\n\t* configure: Regenerated.", "tree": {"sha": "2467e755fc026372252559eff3164811a97fdce3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2467e755fc026372252559eff3164811a97fdce3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6649df18f98d5baf89b56a09b816b5eeb5f67bcb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6649df18f98d5baf89b56a09b816b5eeb5f67bcb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6649df18f98d5baf89b56a09b816b5eeb5f67bcb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6649df18f98d5baf89b56a09b816b5eeb5f67bcb/comments", "author": null, "committer": null, "parents": [{"sha": "0eef5eea2b42d892df52b655e55458f27ac3fb81", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eef5eea2b42d892df52b655e55458f27ac3fb81", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0eef5eea2b42d892df52b655e55458f27ac3fb81"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "b05a3714fb2b97b6dd060b7ca03fef1ce6e5ad02", "filename": "gcc/configure", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6649df18f98d5baf89b56a09b816b5eeb5f67bcb/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6649df18f98d5baf89b56a09b816b5eeb5f67bcb/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=6649df18f98d5baf89b56a09b816b5eeb5f67bcb", "patch": "@@ -10022,9 +10022,14 @@ $as_echo_n \"checking for zstd.h... \" >&6; }\n if ${gcc_cv_header_zstd_h+:} false; then :\n   $as_echo_n \"(cached) \" >&6\n else\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+  # We require version 1.3.0 or later.  This is the first version that has\n+# ZSTD_getFrameContentSize.\n+cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n /* end confdefs.h.  */\n #include <zstd.h>\n+#if ZSTD_VERSION_NUMBER < 10300\n+#error \"need zstd 1.3.0 or better\"\n+#endif\n int\n main ()\n {\n@@ -19013,7 +19018,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 19016 \"configure\"\n+#line 19021 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -19119,7 +19124,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 19122 \"configure\"\n+#line 19127 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "f5612161dcdc1dd720b24b0ac99dcdd7b9f14800", "filename": "gcc/configure.ac", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6649df18f98d5baf89b56a09b816b5eeb5f67bcb/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6649df18f98d5baf89b56a09b816b5eeb5f67bcb/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=6649df18f98d5baf89b56a09b816b5eeb5f67bcb", "patch": "@@ -1376,8 +1376,13 @@ LDFLAGS=\"$LDFLAGS $ZSTD_LDFLAGS\"\n \n AC_MSG_CHECKING(for zstd.h)\n AC_CACHE_VAL(gcc_cv_header_zstd_h,\n+# We require version 1.3.0 or later.  This is the first version that has\n+# ZSTD_getFrameContentSize.\n [AC_COMPILE_IFELSE([AC_LANG_PROGRAM(\n-[[#include <zstd.h>]])],\n+[[#include <zstd.h>\n+#if ZSTD_VERSION_NUMBER < 10300\n+#error \"need zstd 1.3.0 or better\"\n+#endif]])],\n   [gcc_cv_header_zstd_h=yes],\n   [gcc_cv_header_zstd_h=no])])\n AC_MSG_RESULT($gcc_cv_header_zstd_h)"}]}