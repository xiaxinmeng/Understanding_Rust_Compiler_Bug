{"sha": "ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "node_id": "C_kwDOANBUbNoAKGNlMzk3NGU1OTYyYjBlMWY3MmExZjcxZWJkYTM5ZDUzYTc3YjdjYzk", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-03-28T09:00:32Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-03-28T09:00:32Z"}, "message": "range-op-float: Only flush_denormals_to_zero for +-*/ [PR109154]\n\nAs discussed in the PR, flushing denormals to zero on every frange::set\nmight be harmful for e.g. x < 0.0 comparisons, because we then on both\nsides use ranges that include zero [-Inf, -0.0] on the true side, and\n[-0.0, +Inf] NAN on the false side, rather than [-Inf, nextafter (-0.0, -Inf)]\non the true side.\n\nThe following patch does it only in range_operator_float::fold_range\nwhich is right now used for +-*/ (both normal and reverse ops of those).\n\nThough, I don't see any difference on the testcase in the PR, but not sure\nwhat I should be looking at and the reduced testcase there has undefined\nbehavior.\n\n2023-03-28  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR tree-optimization/109154\n\t* value-range.h (frange::flush_denormals_to_zero): Make it public\n\trather than private.\n\t* value-range.cc (frange::set): Don't call flush_denormals_to_zero\n\there.\n\t* range-op-float.cc (range_operator_float::fold_range): Call\n\tflush_denormals_to_zero.", "tree": {"sha": "5cdedd975249b8b02713510b7b83a40b07e8bdee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5cdedd975249b8b02713510b7b83a40b07e8bdee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "39a43dc336561e0eba0de477b16c7355f19d84ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39a43dc336561e0eba0de477b16c7355f19d84ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39a43dc336561e0eba0de477b16c7355f19d84ee"}], "stats": {"total": 6, "additions": 3, "deletions": 3}, "files": [{"sha": "d212e64a6240d59a5d8c81290f99da5d2cdf377c", "filename": "gcc/range-op-float.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/gcc%2Frange-op-float.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/gcc%2Frange-op-float.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frange-op-float.cc?ref=ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "patch": "@@ -112,6 +112,8 @@ range_operator_float::fold_range (frange &r, tree type,\n \t}\n     }\n \n+  r.flush_denormals_to_zero ();\n+\n   return true;\n }\n "}, {"sha": "ec826c2fe1bb3f8f5adc1d817475915ee0594362", "filename": "gcc/value-range.cc", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/gcc%2Fvalue-range.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/gcc%2Fvalue-range.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-range.cc?ref=ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "patch": "@@ -361,8 +361,6 @@ frange::set (tree type,\n \n   normalize_kind ();\n \n-  flush_denormals_to_zero ();\n-\n   if (flag_checking)\n     verify_range ();\n }"}, {"sha": "969b2b68418439a2c098e77bb28cd01eae3adb6e", "filename": "gcc/value-range.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/gcc%2Fvalue-range.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9/gcc%2Fvalue-range.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-range.h?ref=ce3974e5962b0e1f72a1f71ebda39d53a77b7cc9", "patch": "@@ -373,6 +373,7 @@ class frange : public vrange\n   void update_nan (tree) = delete; // Disallow silent conversion to bool.\n   void update_nan (const nan_state &);\n   void clear_nan ();\n+  void flush_denormals_to_zero ();\n \n   // fpclassify like API\n   bool known_isfinite () const;\n@@ -389,7 +390,6 @@ class frange : public vrange\n   bool union_nans (const frange &);\n   bool intersect_nans (const frange &);\n   bool combine_zeros (const frange &, bool union_p);\n-  void flush_denormals_to_zero ();\n \n   tree m_type;\n   REAL_VALUE_TYPE m_min;"}]}