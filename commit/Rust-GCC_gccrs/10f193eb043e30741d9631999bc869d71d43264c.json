{"sha": "10f193eb043e30741d9631999bc869d71d43264c", "node_id": "C_kwDOANBUbNoAKDEwZjE5M2ViMDQzZTMwNzQxZDk2MzE5OTliYzg2OWQ3MWQ0MzI2NGM", "commit": {"author": {"name": "Steve Baird", "email": "baird@adacore.com", "date": "2022-10-25T23:59:29Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-11-08T08:35:03Z"}, "message": "ada: Compile-time simplification of 'Image incorrectly ignores Put_Image\n\nIn the case of Some_Enumeration_Type'Image (<some static value>),\nthe compiler will replace this expression in its internal program\nrepresentation with a corresponding string literal. This is incorrect\nif the Put_Image aspect has been specified (directly or via inheritance)\nfor the enumeration type.\n\ngcc/ada/\n\n\t* sem_attr.adb\n\t(Eval_Attribute): Don't simplify 'Image call if Put_Image has been\n\tspecified.", "tree": {"sha": "7b5c5520a97d7a735d6fca41fc20a6bcf46590a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7b5c5520a97d7a735d6fca41fc20a6bcf46590a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10f193eb043e30741d9631999bc869d71d43264c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10f193eb043e30741d9631999bc869d71d43264c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10f193eb043e30741d9631999bc869d71d43264c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10f193eb043e30741d9631999bc869d71d43264c/comments", "author": {"login": "swbaird", "id": 50751052, "node_id": "MDQ6VXNlcjUwNzUxMDUy", "avatar_url": "https://avatars.githubusercontent.com/u/50751052?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swbaird", "html_url": "https://github.com/swbaird", "followers_url": "https://api.github.com/users/swbaird/followers", "following_url": "https://api.github.com/users/swbaird/following{/other_user}", "gists_url": "https://api.github.com/users/swbaird/gists{/gist_id}", "starred_url": "https://api.github.com/users/swbaird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swbaird/subscriptions", "organizations_url": "https://api.github.com/users/swbaird/orgs", "repos_url": "https://api.github.com/users/swbaird/repos", "events_url": "https://api.github.com/users/swbaird/events{/privacy}", "received_events_url": "https://api.github.com/users/swbaird/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "11f892571c7ab4964f16c0d432e6f5a9b4a091f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11f892571c7ab4964f16c0d432e6f5a9b4a091f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11f892571c7ab4964f16c0d432e6f5a9b4a091f1"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "5166b4be4e9db91c8770566f3bed89f57736d052", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10f193eb043e30741d9631999bc869d71d43264c/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10f193eb043e30741d9631999bc869d71d43264c/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=10f193eb043e30741d9631999bc869d71d43264c", "patch": "@@ -9203,13 +9203,15 @@ package body Sem_Attr is\n       --  Image is a scalar attribute, but is never static, because it is\n       --  not a static function (having a non-scalar argument (RM 4.9(22))\n       --  However, we can constant-fold the image of an enumeration literal\n-      --  if names are available.\n+      --  if names are available and default Image implementation has not\n+      --  been overridden.\n \n       when Attribute_Image =>\n          if Is_Entity_Name (E1)\n            and then Ekind (Entity (E1)) = E_Enumeration_Literal\n            and then not Discard_Names (First_Subtype (Etype (E1)))\n            and then not Global_Discard_Names\n+           and then not Has_Aspect (Etype (E1), Aspect_Put_Image)\n          then\n             declare\n                Lit : constant Entity_Id := Entity (E1);"}]}