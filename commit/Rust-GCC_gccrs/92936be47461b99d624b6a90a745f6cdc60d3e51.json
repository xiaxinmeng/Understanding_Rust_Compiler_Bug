{"sha": "92936be47461b99d624b6a90a745f6cdc60d3e51", "node_id": "C_kwDOANBUbNoAKDkyOTM2YmU0NzQ2MWI5OWQ2MjRiNmE5MGE3NDVmNmNkYzYwZDNlNTE", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-10-01T14:55:57Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-10-01T20:06:26Z"}, "message": "libstdc++: Restore printing of assertion messages [PR102100]\n\nMy changes for PR 101429 broke the _-replacement_assert function,\nbecause we now always just abort without printing anything. That's\nbecause I added checks for _GLIBCXX_HOSTED and _GLIBCXX_VERBOSE, but the\nchecks are done before those get defined.\n\nThis adds a new macro which is set\nby the sed command in include/Makefile, once the HOSTED and VERBOSE\nmacros have been set by the configure script.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/102100\n\t* include/Makefile.am (c++config.h): Define\n\t_GLIBCXX_VERBOSE_ASSERT based on configure output.\n\t* include/Makefile.in: Regenerate.\n\t* include/bits/c++config: Fix condition for verbose assertions.", "tree": {"sha": "031b6960e7af7dab63db6b0059812c74a16169e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/031b6960e7af7dab63db6b0059812c74a16169e7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/92936be47461b99d624b6a90a745f6cdc60d3e51", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92936be47461b99d624b6a90a745f6cdc60d3e51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92936be47461b99d624b6a90a745f6cdc60d3e51", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92936be47461b99d624b6a90a745f6cdc60d3e51/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "acf3a21cbc26b39b73c0006300f35ff017ddd6cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acf3a21cbc26b39b73c0006300f35ff017ddd6cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acf3a21cbc26b39b73c0006300f35ff017ddd6cb"}], "stats": {"total": 19, "additions": 17, "deletions": 2}, "files": [{"sha": "5a5b5fd1d1b8c7d841fffe87f1fcdc709ed6cf3b", "filename": "libstdc++-v3/include/Makefile.am", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92936be47461b99d624b6a90a745f6cdc60d3e51/libstdc%2B%2B-v3%2Finclude%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92936be47461b99d624b6a90a745f6cdc60d3e51/libstdc%2B%2B-v3%2Finclude%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2FMakefile.am?ref=92936be47461b99d624b6a90a745f6cdc60d3e51", "patch": "@@ -1315,6 +1315,12 @@ ${host_builddir}/c++config.h: ${CONFIG_HEADER} \\\n \tgrep \"^[\t ]*#[\t ]*define[\t ][\t ]*_GLIBCXX_LONG_DOUBLE_ALT128_COMPAT[\t ][\t ]*1[\t ]*$$\" \\\n \t${CONFIG_HEADER} > /dev/null 2>&1 \\\n \t&& ldbl_alt128_compat='s,^#undef _GLIBCXX_LONG_DOUBLE_ALT128_COMPAT$$,#define _GLIBCXX_LONG_DOUBLE_ALT128_COMPAT 1,' ;\\\n+\tverbose_assert='s,g,g,' ; \\\n+\tgrep \"^[\t ]*#[\t ]*define[\t ][\t ]*_GLIBCXX_HOSTED[\t ][\t ]*1[\t ]*$$\" \\\n+\t${CONFIG_HEADER} > /dev/null 2>&1 \\\n+\t&& grep \"^[\t ]*#[\t ]*define[\t ][\t ]*_GLIBCXX_VERBOSE[\t ][\t ]*1[\t ]*$$\" \\\n+\t${CONFIG_HEADER} > /dev/null 2>&1 \\\n+\t&& verbose_assert='s,^#undef _GLIBCXX_VERBOSE_ASSERT$$,#define _GLIBCXX_VERBOSE_ASSERT 1,' ;\\\n \tsed -e \"s,define __GLIBCXX__,define __GLIBCXX__ $$date,\" \\\n \t-e \"s,define _GLIBCXX_RELEASE,define _GLIBCXX_RELEASE $$release,\" \\\n \t-e \"s,define _GLIBCXX_INLINE_VERSION, define _GLIBCXX_INLINE_VERSION $$ns_version,\" \\\n@@ -1326,6 +1332,7 @@ ${host_builddir}/c++config.h: ${CONFIG_HEADER} \\\n \t-e \"s,define _GLIBCXX_USE_FLOAT128,$$float128,\" \\\n \t-e \"$$ldbl_compat\" \\\n \t-e \"$$ldbl_alt128_compat\" \\\n+\t-e \"$$verbose_assert\" \\\n \t    < ${glibcxx_srcdir}/include/bits/c++config > $@ ;\\\n \tsed -e 's/HAVE_/_GLIBCXX_HAVE_/g' \\\n \t    -e 's/PACKAGE/_GLIBCXX_PACKAGE/g' \\"}, {"sha": "8402cd704b4f015bbfca26e1ba2b295280ebd4db", "filename": "libstdc++-v3/include/Makefile.in", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92936be47461b99d624b6a90a745f6cdc60d3e51/libstdc%2B%2B-v3%2Finclude%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92936be47461b99d624b6a90a745f6cdc60d3e51/libstdc%2B%2B-v3%2Finclude%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2FMakefile.in?ref=92936be47461b99d624b6a90a745f6cdc60d3e51", "patch": "@@ -1801,6 +1801,12 @@ ${host_builddir}/c++config.h: ${CONFIG_HEADER} \\\n \tgrep \"^[\t ]*#[\t ]*define[\t ][\t ]*_GLIBCXX_LONG_DOUBLE_ALT128_COMPAT[\t ][\t ]*1[\t ]*$$\" \\\n \t${CONFIG_HEADER} > /dev/null 2>&1 \\\n \t&& ldbl_alt128_compat='s,^#undef _GLIBCXX_LONG_DOUBLE_ALT128_COMPAT$$,#define _GLIBCXX_LONG_DOUBLE_ALT128_COMPAT 1,' ;\\\n+\tverbose_assert='s,g,g,' ; \\\n+\tgrep \"^[\t ]*#[\t ]*define[\t ][\t ]*_GLIBCXX_HOSTED[\t ][\t ]*1[\t ]*$$\" \\\n+\t${CONFIG_HEADER} > /dev/null 2>&1 \\\n+\t&& grep \"^[\t ]*#[\t ]*define[\t ][\t ]*_GLIBCXX_VERBOSE[\t ][\t ]*1[\t ]*$$\" \\\n+\t${CONFIG_HEADER} > /dev/null 2>&1 \\\n+\t&& verbose_assert='s,^#undef _GLIBCXX_VERBOSE_ASSERT$$,#define _GLIBCXX_VERBOSE_ASSERT 1,' ;\\\n \tsed -e \"s,define __GLIBCXX__,define __GLIBCXX__ $$date,\" \\\n \t-e \"s,define _GLIBCXX_RELEASE,define _GLIBCXX_RELEASE $$release,\" \\\n \t-e \"s,define _GLIBCXX_INLINE_VERSION, define _GLIBCXX_INLINE_VERSION $$ns_version,\" \\\n@@ -1812,6 +1818,7 @@ ${host_builddir}/c++config.h: ${CONFIG_HEADER} \\\n \t-e \"s,define _GLIBCXX_USE_FLOAT128,$$float128,\" \\\n \t-e \"$$ldbl_compat\" \\\n \t-e \"$$ldbl_alt128_compat\" \\\n+\t-e \"$$verbose_assert\" \\\n \t    < ${glibcxx_srcdir}/include/bits/c++config > $@ ;\\\n \tsed -e 's/HAVE_/_GLIBCXX_HAVE_/g' \\\n \t    -e 's/PACKAGE/_GLIBCXX_PACKAGE/g' \\"}, {"sha": "69343a25533678fa114be5ca245b8b8a709f166e", "filename": "libstdc++-v3/include/bits/c++config", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92936be47461b99d624b6a90a745f6cdc60d3e51/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fc%2B%2Bconfig", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92936be47461b99d624b6a90a745f6cdc60d3e51/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fc%2B%2Bconfig", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fc%2B%2Bconfig?ref=92936be47461b99d624b6a90a745f6cdc60d3e51", "patch": "@@ -506,11 +506,12 @@ namespace std\n # define __glibcxx_constexpr_assert(unevaluated)\n #endif\n \n+#undef _GLIBCXX_VERBOSE_ASSERT\n \n // Assert.\n #if defined(_GLIBCXX_ASSERTIONS) \\\n   || defined(_GLIBCXX_PARALLEL) || defined(_GLIBCXX_PARALLEL_ASSERTIONS)\n-# if _GLIBCXX_HOSTED && _GLIBCXX_VERBOSE\n+# ifdef _GLIBCXX_VERBOSE_ASSERT\n namespace std\n {\n   // Avoid the use of assert, because we're trying to keep the <cassert>\n@@ -533,7 +534,7 @@ namespace std\n     std::__replacement_assert(__FILE__, __LINE__, __PRETTY_FUNCTION__, \\\n \t\t\t      #_Condition);\t\t\t       \\\n   }\n-# else // ! VERBOSE\n+# else // ! VERBOSE_ASSERT\n # define __glibcxx_assert_impl(_Condition)\t\t\\\n   if (__builtin_expect(!bool(_Condition), false))\t\\\n   {\t\t\t\t\t\t\t\\"}]}