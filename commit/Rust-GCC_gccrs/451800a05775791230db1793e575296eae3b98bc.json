{"sha": "451800a05775791230db1793e575296eae3b98bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDUxODAwYTA1Nzc1NzkxMjMwZGIxNzkzZTU3NTI5NmVhZTNiOThiYw==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2009-04-20T12:35:50Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-20T12:35:50Z"}, "message": "exp_ch3.adb (Make_Predefined_Primitive_Specs, [...]): Do not create the declarations and bodies of the primitive subprograms...\n\n        * exp_ch3.adb (Make_Predefined_Primitive_Specs,\n        Predefined_Primitive_Bodies): Do not create the declarations and bodies\n        of the primitive subprograms associated with dispatching select\n        statements when the runtime is in configurable mode.\n\nFrom-SVN: r146407", "tree": {"sha": "2061f4d95ed6f49ed98db0ed68e6e7fc8c3b1b58", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2061f4d95ed6f49ed98db0ed68e6e7fc8c3b1b58"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/451800a05775791230db1793e575296eae3b98bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/451800a05775791230db1793e575296eae3b98bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/451800a05775791230db1793e575296eae3b98bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/451800a05775791230db1793e575296eae3b98bc/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c206e8fd96c4a15826d2b9e3b0620cb31bb4b175", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c206e8fd96c4a15826d2b9e3b0620cb31bb4b175", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c206e8fd96c4a15826d2b9e3b0620cb31bb4b175"}], "stats": {"total": 82, "additions": 51, "deletions": 31}, "files": [{"sha": "de647ba2ef45cf04053c50794fe09e070a497852", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/451800a05775791230db1793e575296eae3b98bc/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/451800a05775791230db1793e575296eae3b98bc/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=451800a05775791230db1793e575296eae3b98bc", "patch": "@@ -32,7 +32,7 @@\n \n 2009-04-20  Ed Schonberg  <schonberg@adacore.com>\n \n-\t* sem_ch8,adb (Analyze_Object_Renaming): Reject ambiguous expressions\n+\t* sem_ch8.adb (Analyze_Object_Renaming): Reject ambiguous expressions\n \tin an object renaming declaration when the expected type is an\n \tanonymous access type.\n "}, {"sha": "8b70aeb446b38e619ec9c7964ccf8697a0b21e82", "filename": "gcc/ada/exp_ch3.adb", "status": "modified", "additions": 50, "deletions": 30, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/451800a05775791230db1793e575296eae3b98bc/gcc%2Fada%2Fexp_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/451800a05775791230db1793e575296eae3b98bc/gcc%2Fada%2Fexp_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch3.adb?ref=451800a05775791230db1793e575296eae3b98bc", "patch": "@@ -7500,14 +7500,15 @@ package body Exp_Ch3 is\n      (Tag_Typ   : Entity_Id;\n       Decl_List : out List_Id)\n    is\n-      Loc         : constant Source_Ptr := Sloc (Tag_Typ);\n-      Formal      : Entity_Id;\n-      Formal_List : List_Id;\n-      Parent_Subp : Entity_Id;\n-      Prim_Elmt   : Elmt_Id;\n-      Proc_Spec   : Node_Id;\n-      Proc_Decl   : Node_Id;\n-      Subp        : Entity_Id;\n+      Loc : constant Source_Ptr := Sloc (Tag_Typ);\n+\n+      Formal         : Entity_Id;\n+      Formal_List    : List_Id;\n+      New_Param_Spec : Node_Id;\n+      Parent_Subp    : Entity_Id;\n+      Prim_Elmt      : Elmt_Id;\n+      Proc_Decl      : Node_Id;\n+      Subp           : Entity_Id;\n \n       function Is_Null_Interface_Primitive (E : Entity_Id) return Boolean;\n       --  Returns True if E is a null procedure that is an interface primitive\n@@ -7549,33 +7550,52 @@ package body Exp_Ch3 is\n                Formal_List := New_List;\n \n                while Present (Formal) loop\n-                  Append\n-                    (Make_Parameter_Specification (Loc,\n-                       Defining_Identifier =>\n-                         Make_Defining_Identifier (Sloc (Formal),\n-                           Chars => Chars (Formal)),\n-                       In_Present  => In_Present (Parent (Formal)),\n-                       Out_Present => Out_Present (Parent (Formal)),\n-                       Null_Exclusion_Present =>\n-                         Null_Exclusion_Present (Parent (Formal)),\n-                       Parameter_Type =>\n-                         New_Occurrence_Of (Etype (Formal), Loc),\n-                       Expression =>\n-                         New_Copy_Tree (Expression (Parent (Formal)))),\n-                     Formal_List);\n+\n+                  --  Copy the parameter spec including default expressions\n+\n+                  New_Param_Spec :=\n+                    New_Copy_Tree (Parent (Formal), New_Sloc => Loc);\n+\n+                  --  Generate a new defining identifier for the new formal.\n+                  --  required because New_Copy_Tree does not duplicate\n+                  --  semantic fields (except itypes).\n+\n+                  Set_Defining_Identifier (New_Param_Spec,\n+                    Make_Defining_Identifier (Sloc (Formal),\n+                      Chars => Chars (Formal)));\n+\n+                  --  For controlling arguments we must change their\n+                  --  parameter type to reference the tagged type (instead\n+                  --  of the interface type)\n+\n+                  if Is_Controlling_Formal (Formal) then\n+                     if Nkind (Parameter_Type (Parent (Formal)))\n+                       = N_Identifier\n+                     then\n+                        Set_Parameter_Type (New_Param_Spec,\n+                          New_Occurrence_Of (Tag_Typ, Loc));\n+\n+                     else pragma Assert\n+                            (Nkind (Parameter_Type (Parent (Formal)))\n+                               = N_Access_Definition);\n+                        Set_Subtype_Mark (Parameter_Type (New_Param_Spec),\n+                          New_Occurrence_Of (Tag_Typ, Loc));\n+                     end if;\n+                  end if;\n+\n+                  Append (New_Param_Spec, Formal_List);\n \n                   Next_Formal (Formal);\n                end loop;\n             end if;\n \n-            Proc_Spec :=\n-              Make_Procedure_Specification (Loc,\n-                Defining_Unit_Name =>\n-                  Make_Defining_Identifier (Loc, Chars (Subp)),\n-                Parameter_Specifications => Formal_List);\n-            Set_Null_Present (Proc_Spec);\n-\n-            Proc_Decl := Make_Subprogram_Declaration (Loc, Proc_Spec);\n+            Proc_Decl :=\n+              Make_Subprogram_Declaration (Loc,\n+                Make_Procedure_Specification (Loc,\n+                  Defining_Unit_Name =>\n+                    Make_Defining_Identifier (Loc, Chars (Subp)),\n+                  Parameter_Specifications => Formal_List,\n+                  Null_Present => True));\n             Append_To (Decl_List, Proc_Decl);\n             Analyze (Proc_Decl);\n          end if;"}]}