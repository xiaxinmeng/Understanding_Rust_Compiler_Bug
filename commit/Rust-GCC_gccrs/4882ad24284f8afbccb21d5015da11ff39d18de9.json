{"sha": "4882ad24284f8afbccb21d5015da11ff39d18de9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDg4MmFkMjQyODRmOGFmYmNjYjIxZDUwMTVkYTExZmYzOWQxOGRlOQ==", "commit": {"author": {"name": "Frank Ch. Eigler", "email": "fche@redhat.com", "date": "2004-09-08T01:34:03Z"}, "committer": {"name": "Frank Ch. Eigler", "email": "fche@gcc.gnu.org", "date": "2004-09-08T01:34:03Z"}, "message": "builtins.c (std_gimplify_va_arg_expr): Mark INDIRECT_REF nodes generated from standard va_arg expansion.\n\n2004-09-07  Frank Ch. Eigler  <fche@redhat.com>\n\n\t* builtins.c (std_gimplify_va_arg_expr): Mark INDIRECT_REF nodes\n\tgenerated from standard va_arg expansion.\n\t* tree-mudflap.c (mx_xform_derefs_1): Omit instrumentation from\n\tmarked nodes.\n\t(mf_varname_tree, mf_file_function_line_tree): Add some support\n\tfor column numbers if compiled with USE_MAPPED_LOCATION.\n\nFrom-SVN: r87170", "tree": {"sha": "a42c80627f0fb93c09cb0d451d473f36620b2435", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a42c80627f0fb93c09cb0d451d473f36620b2435"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4882ad24284f8afbccb21d5015da11ff39d18de9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4882ad24284f8afbccb21d5015da11ff39d18de9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4882ad24284f8afbccb21d5015da11ff39d18de9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4882ad24284f8afbccb21d5015da11ff39d18de9/comments", "author": {"login": "fche", "id": 588885, "node_id": "MDQ6VXNlcjU4ODg4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/588885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fche", "html_url": "https://github.com/fche", "followers_url": "https://api.github.com/users/fche/followers", "following_url": "https://api.github.com/users/fche/following{/other_user}", "gists_url": "https://api.github.com/users/fche/gists{/gist_id}", "starred_url": "https://api.github.com/users/fche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fche/subscriptions", "organizations_url": "https://api.github.com/users/fche/orgs", "repos_url": "https://api.github.com/users/fche/repos", "events_url": "https://api.github.com/users/fche/events{/privacy}", "received_events_url": "https://api.github.com/users/fche/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "06f624bab80cb9dbb9bebd258f729c84b4e0d967", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06f624bab80cb9dbb9bebd258f729c84b4e0d967", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06f624bab80cb9dbb9bebd258f729c84b4e0d967"}], "stats": {"total": 53, "additions": 44, "deletions": 9}, "files": [{"sha": "6e0408f46560688849e669f48ea536771743b09f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4882ad24284f8afbccb21d5015da11ff39d18de9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4882ad24284f8afbccb21d5015da11ff39d18de9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4882ad24284f8afbccb21d5015da11ff39d18de9", "patch": "@@ -1,3 +1,12 @@\n+2004-09-07  Frank Ch. Eigler  <fche@redhat.com>\n+\n+\t* builtins.c (std_gimplify_va_arg_expr): Mark INDIRECT_REF nodes\n+\tgenerated from standard va_arg expansion.\n+\t* tree-mudflap.c (mx_xform_derefs_1): Omit instrumentation from\n+\tmarked nodes.\n+\t(mf_varname_tree, mf_file_function_line_tree): Add some support\n+\tfor column numbers if compiled with USE_MAPPED_LOCATION.\n+\n 2004-09-07  Ziemowit Laski  <zlaski@apple.com>\n \n \t* c-decl.c (groktypename_in_parm_context): Remove function."}, {"sha": "6d4cd8fbbc1ca6600c13b62d8991ded85b16ace4", "filename": "gcc/builtins.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4882ad24284f8afbccb21d5015da11ff39d18de9/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4882ad24284f8afbccb21d5015da11ff39d18de9/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=4882ad24284f8afbccb21d5015da11ff39d18de9", "patch": "@@ -4349,9 +4349,17 @@ std_gimplify_va_arg_expr (tree valist, tree type, tree *pre_p, tree *post_p)\n   addr = fold_convert (build_pointer_type (type), addr);\n \n   if (indirect)\n-    addr = build_fold_indirect_ref (addr);\n+    {\n+      addr = build_fold_indirect_ref (addr);\n+      if (flag_mudflap) /* Don't instrument va_arg INDIRECT_REF.  */\n+        mf_mark (addr);\n+    }\n+\n+  addr = build_fold_indirect_ref (addr);\n+  if (flag_mudflap) /* Don't instrument va_arg INDIRECT_REF.  */\n+    mf_mark (addr);\n \n-  return build_fold_indirect_ref (addr);\n+  return addr;\n }\n \n /* Return a dummy expression of type TYPE in order to keep going after an"}, {"sha": "55263e880d0e6fcb53200e9518f28b5d47dcb02a", "filename": "gcc/tree-mudflap.c", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4882ad24284f8afbccb21d5015da11ff39d18de9/gcc%2Ftree-mudflap.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4882ad24284f8afbccb21d5015da11ff39d18de9/gcc%2Ftree-mudflap.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-mudflap.c?ref=4882ad24284f8afbccb21d5015da11ff39d18de9", "patch": "@@ -112,12 +112,15 @@ mf_varname_tree (tree decl)\n     }\n   pp_clear_output_area (buf);\n \n-  /* Add FILENAME[:LINENUMBER].  */\n+  /* Add FILENAME[:LINENUMBER[:COLUMNNUMBER]].  */\n   {\n     expanded_location xloc = expand_location (DECL_SOURCE_LOCATION (decl));\n     const char *sourcefile;\n     unsigned sourceline = xloc.line;\n-\n+    unsigned sourcecolumn = 0;\n+#ifdef USE_MAPPED_LOCATION\n+    sourcecolumn = xloc.column;\n+#endif\n     sourcefile = xloc.file;\n     if (sourcefile == NULL && current_function_decl != NULL_TREE)\n       sourcefile = DECL_SOURCE_FILE (current_function_decl);\n@@ -130,12 +133,18 @@ mf_varname_tree (tree decl)\n       {\n         pp_string (buf, \":\");\n         pp_decimal_int (buf, sourceline);\n+\n+        if (sourcecolumn != 0)\n+          {\n+            pp_string (buf, \":\");\n+            pp_decimal_int (buf, sourcecolumn);\n+          }\n       }\n   }\n \n   if (current_function_decl != NULL_TREE)\n     {\n-      /* Add (FUNCTION): */\n+      /* Add (FUNCTION) */\n       pp_string (buf, \" (\");\n       {\n         const char *funcname = NULL;\n@@ -189,11 +198,11 @@ mf_file_function_line_tree (location_t location)\n {\n   expanded_location xloc = expand_location (location);\n   const char *file = NULL, *colon, *line, *op, *name, *cp;\n-  char linebuf[18];\n+  char linecolbuf[30]; /* Enough for two decimal numbers plus a colon.  */\n   char *string;\n   tree result;\n \n-  /* Add FILENAME[:LINENUMBER].  */\n+  /* Add FILENAME[:LINENUMBER[:COLUMNNUMBER]].  */\n   file = xloc.file;\n   if (file == NULL && current_function_decl != NULL_TREE)\n     file = DECL_SOURCE_FILE (current_function_decl);\n@@ -202,9 +211,14 @@ mf_file_function_line_tree (location_t location)\n \n   if (xloc.line > 0)\n     {\n-      sprintf (linebuf, \"%d\", xloc.line);\n+#ifdef USE_MAPPED_LOCATION\n+      if (xloc.column > 0)\n+        sprintf (linecolbuf, \"%d:%d\", xloc.line, xloc.column);\n+      else\n+#endif\n+        sprintf (linecolbuf, \"%d\", xloc.line);\n       colon = \":\";\n-      line = linebuf;\n+      line = linecolbuf;\n     }\n   else\n     colon = line = \"\";\n@@ -676,6 +690,10 @@ mf_xform_derefs_1 (block_stmt_iterator *iter, tree *tp,\n   if (dirflag == integer_zero_node && flag_mudflap_ignore_reads)\n     return;\n \n+  /* Don't instrument marked nodes.  */\n+  if (mf_marked_p (*tp))\n+    return;\n+\n   t = *tp;\n   type = TREE_TYPE (t);\n   size = TYPE_SIZE_UNIT (type);"}]}