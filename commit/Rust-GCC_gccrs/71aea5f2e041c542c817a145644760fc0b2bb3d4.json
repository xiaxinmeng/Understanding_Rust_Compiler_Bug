{"sha": "71aea5f2e041c542c817a145644760fc0b2bb3d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzFhZWE1ZjJlMDQxYzU0MmM4MTdhMTQ1NjQ0NzYwZmMwYjJiYjNkNA==", "commit": {"author": {"name": "Simon Martin", "email": "simartin@users.sourceforge.net", "date": "2007-03-28T21:06:01Z"}, "committer": {"name": "Simon Martin", "email": "simartin@gcc.gnu.org", "date": "2007-03-28T21:06:01Z"}, "message": "re PR c++/29077 (Incorrect error message for destructor in wrong namespace)\n\n2007-03-28  Simon Martin  <simartin@users.sourceforge.net>\n\n\tPR c++/29077\n\t* decl.c (grokfndecl): Properly setup decl if it is a constructor or a\n\tdestructor.\n\nFrom-SVN: r123312", "tree": {"sha": "99605bf354a1f0b3c7a0c7b9462dc8cd9e96aa4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99605bf354a1f0b3c7a0c7b9462dc8cd9e96aa4b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/71aea5f2e041c542c817a145644760fc0b2bb3d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71aea5f2e041c542c817a145644760fc0b2bb3d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/71aea5f2e041c542c817a145644760fc0b2bb3d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71aea5f2e041c542c817a145644760fc0b2bb3d4/comments", "author": {"login": "simartin", "id": 935202, "node_id": "MDQ6VXNlcjkzNTIwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/935202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simartin", "html_url": "https://github.com/simartin", "followers_url": "https://api.github.com/users/simartin/followers", "following_url": "https://api.github.com/users/simartin/following{/other_user}", "gists_url": "https://api.github.com/users/simartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/simartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simartin/subscriptions", "organizations_url": "https://api.github.com/users/simartin/orgs", "repos_url": "https://api.github.com/users/simartin/repos", "events_url": "https://api.github.com/users/simartin/events{/privacy}", "received_events_url": "https://api.github.com/users/simartin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8975ae2285b74f05a4465e7a9c8c0bdf8cf300b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8975ae2285b74f05a4465e7a9c8c0bdf8cf300b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8975ae2285b74f05a4465e7a9c8c0bdf8cf300b1"}], "stats": {"total": 46, "additions": 40, "deletions": 6}, "files": [{"sha": "4f2b06191efa5d4c1d17abf5e0036e0fcb762995", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=71aea5f2e041c542c817a145644760fc0b2bb3d4", "patch": "@@ -1,3 +1,9 @@\n+2007-03-28  Simon Martin  <simartin@users.sourceforge.net>\n+\n+\tPR c++/29077\n+\t* decl.c (grokfndecl): Properly setup decl if it is a constructor or a\n+\tdestructor.\n+\n 2007-03-28 Douglas Gregor <doug.gregor@gmail.com>\n \n \t* parser.c (struct cp_parser): Update comment for"}, {"sha": "0315f01241d05bcde3a0e9b94910674095f667cb", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=71aea5f2e041c542c817a145644760fc0b2bb3d4", "patch": "@@ -5981,6 +5981,20 @@ grokfndecl (tree ctype,\n   if (TYPE_VOLATILE (type))\n     TREE_THIS_VOLATILE (decl) = 1;\n \n+  /* Setup decl according to sfk.  */\n+  switch (sfk)\n+    {\n+    case sfk_constructor:\n+    case sfk_copy_constructor:\n+      DECL_CONSTRUCTOR_P (decl) = 1;\n+      break;\n+    case sfk_destructor:\n+      DECL_DESTRUCTOR_P (decl) = 1;\n+      break;\n+    default:\n+      break;\n+    }\n+\n   if (friendp\n       && TREE_CODE (orig_declarator) == TEMPLATE_ID_EXPR)\n     {\n@@ -6168,12 +6182,7 @@ grokfndecl (tree ctype,\n     return decl;\n \n   if (ctype != NULL_TREE)\n-    {\n-      if (sfk == sfk_constructor)\n-\tDECL_CONSTRUCTOR_P (decl) = 1;\n-\n-      grokclassfn (ctype, decl, flags);\n-    }\n+    grokclassfn (ctype, decl, flags);\n \n   decl = check_explicit_specialization (orig_declarator, decl,\n \t\t\t\t\ttemplate_count,"}, {"sha": "9b5244e597fdfb35b3671774a90f3fbd77b06db8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=71aea5f2e041c542c817a145644760fc0b2bb3d4", "patch": "@@ -1,3 +1,8 @@\n+2007-03-28  Simon Martin  <simartin@users.sourceforge.net>\n+\n+\tPR c++/29077\n+\t* g++.dg/parse/constructor3.C: New test.\n+\n 2007-03-28  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/thin_pointer.ad[sb]: New test."}, {"sha": "9a2e9783e3d25d4e353f4dc12791d22bd4ba5d2c", "filename": "gcc/testsuite/g++.dg/parse/constructor3.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fconstructor3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71aea5f2e041c542c817a145644760fc0b2bb3d4/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fconstructor3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fconstructor3.C?ref=71aea5f2e041c542c817a145644760fc0b2bb3d4", "patch": "@@ -0,0 +1,14 @@\n+/* PR c++/29077 */\n+/* { dg-do \"compile\" } */\n+\n+class c {\n+  c();\n+  c(const c&);\n+  ~c();\n+};\n+\n+namespace m {\n+  c::c() {} /* { dg-error \"c::c\" } */\n+  c::c(const c&) {} /* { dg-error \"c::c\" } */\n+  c::~c() {} /* { dg-error \"c::~c\" } */\n+}"}]}