{"sha": "c1b48b29294ed58e72129db4db42adab3d0d1a9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzFiNDhiMjkyOTRlZDU4ZTcyMTI5ZGI0ZGI0MmFkYWIzZDBkMWE5YQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-10-11T12:42:37Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-10-11T12:42:37Z"}, "message": "[PATCH] A couple of line map fixes\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-10/msg00623.html\n\t* include/line-map.h (LINEMAPS_MACRO_LOWEST_LOCATION): Fix\n\toff-by-one error.\n\t* line-map.c (linemap_enter_macro): Use RAII.  Clear all of the\n\tmacro_locations.\n\nFrom-SVN: r265037", "tree": {"sha": "32a29d7459eecd3699a84f59acf2073799e71dbc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/32a29d7459eecd3699a84f59acf2073799e71dbc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c1b48b29294ed58e72129db4db42adab3d0d1a9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1b48b29294ed58e72129db4db42adab3d0d1a9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1b48b29294ed58e72129db4db42adab3d0d1a9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1b48b29294ed58e72129db4db42adab3d0d1a9a/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c7790bdbd97889b39fde3e0249b398a9bf5fb43b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7790bdbd97889b39fde3e0249b398a9bf5fb43b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7790bdbd97889b39fde3e0249b398a9bf5fb43b"}], "stats": {"total": 29, "additions": 15, "deletions": 14}, "files": [{"sha": "fe0dc8ddfe5e9bf4a0b7098220ac968d0d954169", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1b48b29294ed58e72129db4db42adab3d0d1a9a/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1b48b29294ed58e72129db4db42adab3d0d1a9a/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=c1b48b29294ed58e72129db4db42adab3d0d1a9a", "patch": "@@ -1,3 +1,10 @@\n+2018-10-11  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* include/line-map.h (LINEMAPS_MACRO_LOWEST_LOCATION): Fix\n+\toff-by-one error.\n+\t* line-map.c (linemap_enter_macro): Use RAII.  Clear all of the\n+\tmacro_locations.\n+\n 2018-10-09  David Malcolm  <dmalcolm@redhat.com>\n \n \t* charset.c (noop_error_cb): Rename to..."}, {"sha": "23f0e4a3514348bce0656706450c4fe7a6bf76af", "filename": "libcpp/include/line-map.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1b48b29294ed58e72129db4db42adab3d0d1a9a/libcpp%2Finclude%2Fline-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1b48b29294ed58e72129db4db42adab3d0d1a9a/libcpp%2Finclude%2Fline-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finclude%2Fline-map.h?ref=c1b48b29294ed58e72129db4db42adab3d0d1a9a", "patch": "@@ -1017,7 +1017,7 @@ LINEMAPS_MACRO_LOWEST_LOCATION (const line_maps *set)\n {\n   return LINEMAPS_MACRO_USED (set)\n          ? MAP_START_LOCATION (LINEMAPS_LAST_MACRO_MAP (set))\n-         : MAX_SOURCE_LOCATION;\n+         : MAX_SOURCE_LOCATION + 1;\n }\n \n /* Returns the last macro map allocated in the line table SET.  */"}, {"sha": "66d92cf34aa2ccac522391f5863a8b05b38fae70", "filename": "libcpp/line-map.c", "status": "modified", "additions": 7, "deletions": 13, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1b48b29294ed58e72129db4db42adab3d0d1a9a/libcpp%2Fline-map.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1b48b29294ed58e72129db4db42adab3d0d1a9a/libcpp%2Fline-map.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fline-map.c?ref=c1b48b29294ed58e72129db4db42adab3d0d1a9a", "patch": "@@ -612,30 +612,24 @@ const line_map_macro *\n linemap_enter_macro (struct line_maps *set, struct cpp_hashnode *macro_node,\n \t\t     source_location expansion, unsigned int num_tokens)\n {\n-  line_map_macro *map;\n-  source_location start_location;\n-  /* Cast away extern \"C\" from the type of xrealloc.  */\n-  line_map_realloc reallocator = (set->reallocator\n-\t\t\t\t  ? set->reallocator\n-\t\t\t\t  : (line_map_realloc) xrealloc);\n-\n-  start_location = LINEMAPS_MACRO_LOWEST_LOCATION (set) - num_tokens;\n+  source_location start_location\n+    = LINEMAPS_MACRO_LOWEST_LOCATION (set) - num_tokens;\n \n   if (start_location < LINE_MAP_MAX_LOCATION)\n     /* We ran out of macro map space.   */\n     return NULL;\n \n-  map = linemap_check_macro (new_linemap (set, start_location));\n+  line_map_macro *map = linemap_check_macro (new_linemap (set, start_location));\n \n   map->macro = macro_node;\n   map->n_tokens = num_tokens;\n   map->macro_locations\n-    = (source_location*) reallocator (NULL,\n-\t\t\t\t      2 * num_tokens\n-\t\t\t\t      * sizeof (source_location));\n+    = (source_location*) set->reallocator (NULL,\n+\t\t\t\t\t   2 * num_tokens\n+\t\t\t\t\t   * sizeof (source_location));\n   map->expansion = expansion;\n   memset (MACRO_MAP_LOCATIONS (map), 0,\n-\t  num_tokens * sizeof (source_location));\n+\t  2 * num_tokens * sizeof (source_location));\n \n   LINEMAPS_MACRO_CACHE (set) = LINEMAPS_MACRO_USED (set) - 1;\n "}]}