{"sha": "1855f812512d84eca88c51c1ceac0045bc95ad5e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg1NWY4MTI1MTJkODRlY2E4OGM1MWMxY2VhYzAwNDViYzk1YWQ1ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-10-19T08:37:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-10-19T08:37:04Z"}, "message": "re PR target/82580 (Optimize comparisons for __int128 on x86-64)\n\n\tPR target/82580\n\t* config/i386/i386.md (setcc + movzbl to xor + setcc): New peephole2.\n\t(setcc + and to xor + setcc): New peephole2.\n\n\t* gcc.target/i386/pr82580.c: Use {\\msbb} instead of \"sbb\" in\n\tscan-assembler-times.  Check that there are no movzb* instructions\n\tif lp64.\n\nFrom-SVN: r253884", "tree": {"sha": "e4479516274dc8ab14def1e71fba5b975ba80468", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4479516274dc8ab14def1e71fba5b975ba80468"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1855f812512d84eca88c51c1ceac0045bc95ad5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1855f812512d84eca88c51c1ceac0045bc95ad5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1855f812512d84eca88c51c1ceac0045bc95ad5e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1855f812512d84eca88c51c1ceac0045bc95ad5e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8a78f1a1b6bc31b0897107bd32cc8cffa3187070", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a78f1a1b6bc31b0897107bd32cc8cffa3187070", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a78f1a1b6bc31b0897107bd32cc8cffa3187070"}], "stats": {"total": 73, "additions": 72, "deletions": 1}, "files": [{"sha": "b7f4e4e071cdabf8dd0e7f1b1f77427013c59d1b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1855f812512d84eca88c51c1ceac0045bc95ad5e", "patch": "@@ -1,3 +1,9 @@\n+2017-10-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/82580\n+\t* config/i386/i386.md (setcc + movzbl to xor + setcc): New peephole2.\n+\t(setcc + and to xor + setcc): New peephole2.\n+\n 2017-10-19  Tom de Vries  <tom@codesourcery.com>\n \n \t* doc/sourcebuild.texi (Test Directives, Variants of"}, {"sha": "6fed9b8786ae027eb3a9161c3f0ea0817b23ee6e", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 57, "deletions": 0, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=1855f812512d84eca88c51c1ceac0045bc95ad5e", "patch": "@@ -12300,6 +12300,34 @@\n   ix86_expand_clear (operands[3]);\n })\n \n+(define_peephole2\n+  [(set (reg FLAGS_REG) (match_operand 0))\n+   (parallel [(set (reg FLAGS_REG) (match_operand 1))\n+\t      (match_operand 5)])\n+   (set (match_operand:QI 2 \"register_operand\")\n+\t(match_operator:QI 3 \"ix86_comparison_operator\"\n+\t  [(reg FLAGS_REG) (const_int 0)]))\n+   (set (match_operand 4 \"any_QIreg_operand\")\n+\t(zero_extend (match_dup 2)))]\n+  \"(peep2_reg_dead_p (4, operands[2])\n+    || operands_match_p (operands[2], operands[4]))\n+   && ! reg_overlap_mentioned_p (operands[4], operands[0])\n+   && ! reg_overlap_mentioned_p (operands[4], operands[1])\n+   && ! reg_set_p (operands[4], operands[5])\n+   && refers_to_regno_p (FLAGS_REG, operands[1], (rtx *)NULL)\n+   && peep2_regno_dead_p (0, FLAGS_REG)\"\n+  [(set (match_dup 6) (match_dup 0))\n+   (parallel [(set (match_dup 7) (match_dup 1))\n+\t      (match_dup 5)])\n+   (set (strict_low_part (match_dup 8))\n+\t(match_dup 3))]\n+{\n+  operands[6] = gen_rtx_REG (GET_MODE (operands[0]), FLAGS_REG);\n+  operands[7] = gen_rtx_REG (GET_MODE (operands[1]), FLAGS_REG);\n+  operands[8] = gen_lowpart (QImode, operands[4]);\n+  ix86_expand_clear (operands[4]);\n+})\n+\n ;; Similar, but match zero extend with andsi3.\n \n (define_peephole2\n@@ -12345,6 +12373,35 @@\n   operands[6] = gen_lowpart (QImode, operands[3]);\n   ix86_expand_clear (operands[3]);\n })\n+\n+(define_peephole2\n+  [(set (reg FLAGS_REG) (match_operand 0))\n+   (parallel [(set (reg FLAGS_REG) (match_operand 1))\n+\t      (match_operand 5)])\n+   (set (match_operand:QI 2 \"register_operand\")\n+\t(match_operator:QI 3 \"ix86_comparison_operator\"\n+\t  [(reg FLAGS_REG) (const_int 0)]))\n+   (parallel [(set (match_operand 4 \"any_QIreg_operand\")\n+\t\t   (zero_extend (match_dup 2)))\n+\t      (clobber (reg:CC FLAGS_REG))])]\n+  \"(peep2_reg_dead_p (4, operands[2])\n+    || operands_match_p (operands[2], operands[4]))\n+   && ! reg_overlap_mentioned_p (operands[4], operands[0])\n+   && ! reg_overlap_mentioned_p (operands[4], operands[1])\n+   && ! reg_set_p (operands[4], operands[5])\n+   && refers_to_regno_p (FLAGS_REG, operands[1], (rtx *)NULL)\n+   && peep2_regno_dead_p (0, FLAGS_REG)\"\n+  [(set (match_dup 6) (match_dup 0))\n+   (parallel [(set (match_dup 7) (match_dup 1))\n+\t      (match_dup 5)])\n+   (set (strict_low_part (match_dup 8))\n+\t(match_dup 3))]\n+{\n+  operands[6] = gen_rtx_REG (GET_MODE (operands[0]), FLAGS_REG);\n+  operands[7] = gen_rtx_REG (GET_MODE (operands[1]), FLAGS_REG);\n+  operands[8] = gen_lowpart (QImode, operands[4]);\n+  ix86_expand_clear (operands[4]);\n+})\n \f\n ;; Call instructions.\n "}, {"sha": "8416e7a16368bdda7766f5779574e236a4d2ba16", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1855f812512d84eca88c51c1ceac0045bc95ad5e", "patch": "@@ -1,3 +1,10 @@\n+2017-10-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/82580\n+\t* gcc.target/i386/pr82580.c: Use {\\msbb} instead of \"sbb\" in\n+\tscan-assembler-times.  Check that there are no movzb* instructions\n+\tif lp64.\n+\n 2017-10-19  Tom de Vries  <tom@codesourcery.com>\n \n \t* gcc.dg/tree-ssa/ldist-27.c: Use dg-require-stack-size."}, {"sha": "965dfeec28d8590ef3f004527c90242f19afa3b1", "filename": "gcc/testsuite/gcc.target/i386/pr82580.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr82580.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1855f812512d84eca88c51c1ceac0045bc95ad5e/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr82580.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr82580.c?ref=1855f812512d84eca88c51c1ceac0045bc95ad5e", "patch": "@@ -35,4 +35,5 @@ void f21 (S x, S y) { if (x >= y) bar (); }\n void f22 (S x, S y) { if (x < y) bar (); }\n void f23 (S x, S y) { if (x <= y) bar (); }\n \n-/* { dg-final { scan-assembler-times \"sbb\" 16 } } */\n+/* { dg-final { scan-assembler-times {\\msbb} 16 } } */\n+/* { dg-final { scan-assembler-not {\\mmovzb} { target lp64 } } } */"}]}