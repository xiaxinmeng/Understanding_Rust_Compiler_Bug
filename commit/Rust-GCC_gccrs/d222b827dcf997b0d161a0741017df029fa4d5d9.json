{"sha": "d222b827dcf997b0d161a0741017df029fa4d5d9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDIyMmI4MjdkY2Y5OTdiMGQxNjFhMDc0MTAxN2RmMDI5ZmE0ZDVkOQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-07-08T20:34:26Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-07-08T20:34:26Z"}, "message": "c4x-protos.h (c4x_va_arg): Remove.\n\n        * config/c4x/c4x-protos.h (c4x_va_arg): Remove.\n        * config/c4x/c4x.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n        (c4x_gimplify_va_arg_expr): Rewrite from c4x_va_arg.\n        * config/c4x/c4x.h (EXPAND_BUILTIN_VA_ARG): Remove.\n\nFrom-SVN: r84311", "tree": {"sha": "9c89a6a4ad1f5a69daade8dc6d7a5824d2a5072f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c89a6a4ad1f5a69daade8dc6d7a5824d2a5072f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d222b827dcf997b0d161a0741017df029fa4d5d9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d222b827dcf997b0d161a0741017df029fa4d5d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d222b827dcf997b0d161a0741017df029fa4d5d9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d222b827dcf997b0d161a0741017df029fa4d5d9/comments", "author": null, "committer": null, "parents": [{"sha": "09eeca5e301971b7ff49d0432b5352ff11aa4f91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09eeca5e301971b7ff49d0432b5352ff11aa4f91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09eeca5e301971b7ff49d0432b5352ff11aa4f91"}], "stats": {"total": 30, "additions": 19, "deletions": 11}, "files": [{"sha": "9f84fcc577a47cc6c99e8c150788254abe53151c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d222b827dcf997b0d161a0741017df029fa4d5d9", "patch": "@@ -1,3 +1,10 @@\n+2004-07-08  Richard Henderson  <rth@redhat.com>\n+\n+\t* config/c4x/c4x-protos.h (c4x_va_arg): Remove.\n+\t* config/c4x/c4x.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n+\t(c4x_gimplify_va_arg_expr): Rewrite from c4x_va_arg.\n+\t* config/c4x/c4x.h (EXPAND_BUILTIN_VA_ARG): Remove.\n+\n 2004-07-08  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>\n \n \t* pa.md (prefetch_32, prefetch_64): Simplify constraint checks."}, {"sha": "6189f7d201c9dcf5c223b945a619fb6b3e2fe588", "filename": "gcc/config/c4x/c4x-protos.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2Fconfig%2Fc4x%2Fc4x-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2Fconfig%2Fc4x%2Fc4x-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fc4x%2Fc4x-protos.h?ref=d222b827dcf997b0d161a0741017df029fa4d5d9", "patch": "@@ -56,8 +56,6 @@ extern struct rtx_def *c4x_function_arg (CUMULATIVE_ARGS *,\n #if defined(RTX_CODE) && defined(TREE_CODE)\n extern void c4x_init_cumulative_args (CUMULATIVE_ARGS *c, tree, rtx);\n \n-extern struct rtx_def *c4x_va_arg (tree, tree);\n-\n extern rtx c4x_expand_builtin (tree, rtx, rtx, enum machine_mode, int);\n \n extern void c4x_init_builtins (void);"}, {"sha": "dff0da4ed5dfe27b6e66d4c31b0ef4ada0812b1a", "filename": "gcc/config/c4x/c4x.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2Fconfig%2Fc4x%2Fc4x.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2Fconfig%2Fc4x%2Fc4x.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fc4x%2Fc4x.c?ref=d222b827dcf997b0d161a0741017df029fa4d5d9", "patch": "@@ -202,6 +202,7 @@ static int c4x_address_cost (rtx);\n static void c4x_init_libfuncs (void);\n static void c4x_external_libcall (rtx);\n static rtx c4x_struct_value_rtx (tree, int);\n+static tree c4x_gimplify_va_arg_expr (tree, tree, tree *, tree *);\n \f\n /* Initialize the GCC target structure.  */\n #undef TARGET_ASM_BYTE_OP\n@@ -255,6 +256,9 @@ static rtx c4x_struct_value_rtx (tree, int);\n #undef TARGET_STRUCT_VALUE_RTX\n #define TARGET_STRUCT_VALUE_RTX c4x_struct_value_rtx\n \n+#undef TARGET_GIMPLIFY_VA_ARG_EXPR\n+#define TARGET_GIMPLIFY_VA_ARG_EXPR c4x_gimplify_va_arg_expr\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n /* Override command line options.\n@@ -722,16 +726,20 @@ c4x_function_arg (CUMULATIVE_ARGS *cum, enum machine_mode mode,\n \n /* C[34]x arguments grow in weird ways (downwards) that the standard\n    varargs stuff can't handle..  */\n-rtx\n-c4x_va_arg (tree valist, tree type)\n+\n+static tree\n+c4x_gimplify_va_arg_expr (tree valist, tree type,\n+\t\t\t  tree *pre_p ATTRIBUTE_UNUSED,\n+\t\t\t  tree *post_p ATTRIBUTE_UNUSED)\n {\n   tree t;\n \n   t = build (PREDECREMENT_EXPR, TREE_TYPE (valist), valist,\n \t     build_int_2 (int_size_in_bytes (type), 0));\n-  TREE_SIDE_EFFECTS (t) = 1;\n+  t = fold_convert (build_pointer_type (type), t);\n+  t = build_fold_indirect_ref (t);\n \n-  return expand_expr (t, NULL_RTX, Pmode, EXPAND_NORMAL);\n+  return t;\n }\n \n "}, {"sha": "823a6085da63a1ae8eff6a3b70f7185951f0a056", "filename": "gcc/config/c4x/c4x.h", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2Fconfig%2Fc4x%2Fc4x.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d222b827dcf997b0d161a0741017df029fa4d5d9/gcc%2Fconfig%2Fc4x%2Fc4x.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fc4x%2Fc4x.h?ref=d222b827dcf997b0d161a0741017df029fa4d5d9", "patch": "@@ -1162,11 +1162,6 @@ CUMULATIVE_ARGS;\n \n #define DEFAULT_PCC_STRUCT_RETURN\t0\n \n-/* Varargs handling.  */\n-\n-#define EXPAND_BUILTIN_VA_ARG(valist, type) \\\n-  c4x_va_arg (valist, type)\n-\n /* Generating Code for Profiling.  */\n \n /* Note that the generated assembly uses the ^ operator to load the 16"}]}