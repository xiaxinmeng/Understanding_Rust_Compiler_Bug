{"sha": "25396db9caa179fb2e50199a9b72d579dde3e68b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjUzOTZkYjljYWExNzlmYjJlNTAxOTlhOWI3MmQ1NzlkZGUzZTY4Yg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2017-06-06T23:02:49Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2017-06-06T23:02:49Z"}, "message": "name-lookup.c (suggest_alternatives_for): Use qualified lookup sans using directives.\n\n\t* name-lookup.c (suggest_alternatives_for): Use qualified lookup\n\tsans using directives.  Don't walk into inline namespaces.\n\n\t* g++.dg/pr45330.C: Add inline namespace case.\n\nFrom-SVN: r248938", "tree": {"sha": "5dd0dec0b426a37b2a5a4b4ba15119df9c4d4ead", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5dd0dec0b426a37b2a5a4b4ba15119df9c4d4ead"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/25396db9caa179fb2e50199a9b72d579dde3e68b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25396db9caa179fb2e50199a9b72d579dde3e68b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25396db9caa179fb2e50199a9b72d579dde3e68b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25396db9caa179fb2e50199a9b72d579dde3e68b/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f788537d682b78a5496276da4e35c8462317175f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f788537d682b78a5496276da4e35c8462317175f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f788537d682b78a5496276da4e35c8462317175f"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "8375ceedd4961184f5ad16c7312b2b08969a9de6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=25396db9caa179fb2e50199a9b72d579dde3e68b", "patch": "@@ -1,5 +1,8 @@\n 2017-06-06  Nathan Sidwell  <nathan@acm.org>\n \n+\t* name-lookup.c (suggest_alternatives_for): Use qualified lookup\n+\tsans using directives.  Don't walk into inline namespaces.\n+\n \tPR c++/80979\n \t* name-lookup.c (adl_class_only): Don't add visible friends.\n "}, {"sha": "6ed164d46452621616975298b6246b98806fcde3", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=25396db9caa179fb2e50199a9b72d579dde3e68b", "patch": "@@ -4714,9 +4714,10 @@ suggest_alternatives_for (location_t location, tree name,\n   for (unsigned ix = 0; ix != worklist.length (); ix++)\n     {\n       tree ns = worklist[ix];\n+      name_lookup lookup (name);\n \n-      if (tree value = ovl_skip_hidden (find_namespace_value (ns, name)))\n-\tcandidates.safe_push (value);\n+      if (lookup.search_qualified (ns, false))\n+\tcandidates.safe_push (lookup.value);\n \n       if (!limited)\n \t{\n@@ -4728,7 +4729,8 @@ suggest_alternatives_for (location_t location, tree name,\n \t  for (tree decl = NAMESPACE_LEVEL (ns)->names;\n \t       decl; decl = TREE_CHAIN (decl))\n \t    if (TREE_CODE (decl) == NAMESPACE_DECL\n-\t\t&& !DECL_NAMESPACE_ALIAS (decl))\n+\t\t&& !DECL_NAMESPACE_ALIAS (decl)\n+\t\t&& !DECL_NAMESPACE_INLINE_P (decl))\n \t      children.safe_push (decl);\n \n \t  while (!limited && !children.is_empty ())"}, {"sha": "bd12c4786f40cfabaf24ed7ff59b26992134e024", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=25396db9caa179fb2e50199a9b72d579dde3e68b", "patch": "@@ -1,3 +1,7 @@\n+2017-06-06  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* g++.dg/pr45330.C: Add inline namespace case.\n+\n 2017-06-06  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/80975"}, {"sha": "f16094d93f1f724580f4ebc0aec913c9b61685f5", "filename": "gcc/testsuite/g++.dg/pr45330.C", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr45330.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/25396db9caa179fb2e50199a9b72d579dde3e68b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr45330.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr45330.C?ref=25396db9caa179fb2e50199a9b72d579dde3e68b", "patch": "@@ -1,4 +1,4 @@\n-// { dg-do compile }\n+// { dg-do compile { target c++11 } }\n // Search std, __cxxabiv1, and global namespaces, plus two more,\n // breadth first\n \n@@ -17,7 +17,10 @@ namespace A\n \n namespace B\n {\n-  int foo;\t\t\t// { dg-message \"B::foo\" \"suggested alternative\" }\n+  inline namespace I\n+  {\n+    int foo;\t\t\t// { dg-message \"B::I::foo\" \"suggested alternative\" }\n+  }\n }\n \n namespace C"}]}