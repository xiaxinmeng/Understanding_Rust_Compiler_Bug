{"sha": "54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTQ4MzNlYzBhNmJjYzkxMTYzZGE0YzNmN2EwMTdhMmY3Mzg3OWNkMQ==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2011-03-21T07:27:03Z"}, "committer": {"name": "Chung-Lin Tang", "email": "cltang@gcc.gnu.org", "date": "2011-03-21T07:27:03Z"}, "message": "simplify-rtx.c (simplify_binary_operation_1): Handle (xor (and A B) C) case when B and C are both constants.\n\n2011-03-21  Chung-Lin Tang  <cltang@codesourcery.com>\n\n\t* simplify-rtx.c (simplify_binary_operation_1): Handle\n\t(xor (and A B) C) case when B and C are both constants.\n\n\ttestsuite/\n\t* gcc.target/arm/xor-and.c: New.\n\nFrom-SVN: r171208", "tree": {"sha": "7be61378d32c6ae04d9c2b5ed89dfb6bc55d20fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7be61378d32c6ae04d9c2b5ed89dfb6bc55d20fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2757d5ecfc14883087e062b169e8355f8cc74b19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2757d5ecfc14883087e062b169e8355f8cc74b19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2757d5ecfc14883087e062b169e8355f8cc74b19"}], "stats": {"total": 63, "additions": 63, "deletions": 0}, "files": [{"sha": "7d3878107effc36680fcd5e8ff4aa82ca94c4055", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "patch": "@@ -1,3 +1,8 @@\n+2011-03-21  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* simplify-rtx.c (simplify_binary_operation_1): Handle\n+\t(xor (and A B) C) case when B and C are both constants.\n+\n 2011-03-21  Mingjie Xing  <mingjie.xing@gmail.com>\n \n \t* tree-dfa.c (add_referenced_var): Fix typo in comment."}, {"sha": "4a8e3c6166726b76d0b33adde566b73d47a1fe00", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "patch": "@@ -2480,6 +2480,46 @@ simplify_binary_operation_1 (enum rtx_code code, enum machine_mode mode,\n \t\t\t\t\t\t\tXEXP (op0, 1), mode),\n \t\t\t\t    op1);\n \n+      /* Given (xor (and A B) C), using P^Q == (~P&Q) | (~Q&P),\n+\t we can transform like this:\n+            (A&B)^C == ~(A&B)&C | ~C&(A&B)\n+                    == (~A|~B)&C | ~C&(A&B)    * DeMorgan's Law\n+                    == ~A&C | ~B&C | A&(~C&B)  * Distribute and re-order\n+\t Attempt a few simplifications when B and C are both constants.  */\n+      if (GET_CODE (op0) == AND\n+\t  && CONST_INT_P (op1)\n+\t  && CONST_INT_P (XEXP (op0, 1)))\n+\t{\n+\t  rtx a = XEXP (op0, 0);\n+\t  rtx b = XEXP (op0, 1);\n+\t  rtx c = op1;\n+\t  HOST_WIDE_INT bval = INTVAL (b);\n+\t  HOST_WIDE_INT cval = INTVAL (c);\n+\n+\t  rtx na_c\n+\t    = simplify_binary_operation (AND, mode,\n+\t\t\t\t\t simplify_gen_unary (NOT, mode, a, mode),\n+\t\t\t\t\t c);\n+\t  if ((~cval & bval) == 0)\n+\t    {\n+\t      /* Try to simplify ~A&C | ~B&C.  */\n+\t      if (na_c != NULL_RTX)\n+\t\treturn simplify_gen_binary (IOR, mode, na_c,\n+\t\t\t\t\t    GEN_INT (~bval & cval));\n+\t    }\n+\t  else\n+\t    {\n+\t      /* If ~A&C is zero, simplify A&(~C&B) | ~B&C.  */\n+\t      if (na_c == const0_rtx)\n+\t\t{\n+\t\t  rtx a_nc_b = simplify_gen_binary (AND, mode, a,\n+\t\t\t\t\t\t    GEN_INT (~cval & bval));\n+\t\t  return simplify_gen_binary (IOR, mode, a_nc_b,\n+\t\t\t\t\t      GEN_INT (~bval & cval));\n+\t\t}\n+\t    }\n+\t}\n+\n       /* (xor (comparison foo bar) (const_int 1)) can become the reversed\n \t comparison if STORE_FLAG_VALUE is 1.  */\n       if (STORE_FLAG_VALUE == 1"}, {"sha": "dbf0e213e39d82839ca3dca4e1835a1f10bde903", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "patch": "@@ -1,3 +1,7 @@\n+2011-03-21  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* gcc.target/arm/xor-and.c: New.\n+\n 2010-03-21  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/22572"}, {"sha": "4b0f79013fc9ff6e0de6413331873e3664a07b39", "filename": "gcc/testsuite/gcc.target/arm/xor-and.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fxor-and.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/54833ec0a6bcc91163da4c3f7a017a2f73879cd1/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fxor-and.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fxor-and.c?ref=54833ec0a6bcc91163da4c3f7a017a2f73879cd1", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -march=armv6\" } */\n+\n+unsigned short foo (unsigned short x)\n+{\n+  x ^= 0x4002;\n+  x >>= 1;\n+  x |= 0x8000;\n+  return x;\n+}\n+\n+/* { dg-final { scan-assembler \"orr\" } } */\n+/* { dg-final { scan-assembler-not \"mvn\" } } */\n+/* { dg-final { scan-assembler-not \"uxth\" } } */"}]}