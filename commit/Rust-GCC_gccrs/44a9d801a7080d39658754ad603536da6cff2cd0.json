{"sha": "44a9d801a7080d39658754ad603536da6cff2cd0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRhOWQ4MDFhNzA4MGQzOTY1ODc1NGFkNjAzNTM2ZGE2Y2ZmMmNkMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-01-22T08:54:59Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-01-22T08:54:59Z"}, "message": "openmp: Fix up !$omp target parallel handling\n\nThe PR93329 fix revealed we ICE on !$omp target parallel, this change fixes\nthat.\n\n2020-01-22  Jakub Jelinek  <jakub@redhat.com>\n\n\t* parse.c (parse_omp_structured_block): Handle ST_OMP_TARGET_PARALLEL.\n\t* trans-openmp.c (gfc_trans_omp_target)\n\t<case EXEC_OMP_TARGET_PARALLEL>: Call pushlevel first.\n\n\t* gfortran.dg/gomp/target-parallel1.f90: New test.\n\t* gfortran.dg/goacc/pr93329.f90: Enable commented out target parallel\n\ttest.", "tree": {"sha": "617e098fd0dca82af8e90aef29025792bb7f3424", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/617e098fd0dca82af8e90aef29025792bb7f3424"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44a9d801a7080d39658754ad603536da6cff2cd0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44a9d801a7080d39658754ad603536da6cff2cd0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44a9d801a7080d39658754ad603536da6cff2cd0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44a9d801a7080d39658754ad603536da6cff2cd0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a38979d9d7a4ab08336436052704028c56187618", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a38979d9d7a4ab08336436052704028c56187618", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a38979d9d7a4ab08336436052704028c56187618"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "d338a4a9728bcf5d97cf9322f9fd7a936d50f305", "filename": "gcc/ChangeLog", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -13,7 +13,6 @@\n \t<case SYMBOL_SMALL_TLSGD>: Call gen_tlsgd_small_* with a ptr_mode\n \tregister.  Convert that register back to dest using convert_mode.\n \n-\n 2020-01-21  Jim Wilson  <jimw@sifive.com>\n \n \t* config/riscv/riscv-sr.c (riscv_sr_match_prologue): Use INTVAL"}, {"sha": "1609344ac6fd029838d9df2a014846cce9336974", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -1,10 +1,10 @@\n-2020-01-22  Jun Ma <JunMa@linux.alibaba.com>\n+2020-01-22  Jun Ma  <JunMa@linux.alibaba.com>\n \n \t* coroutines.cc (finish_co_await_expr): Add error check on return\n \tvalue of build_co_await.\n \t(finish_co_yield_expr,): Ditto.\n \n-2020-01-22  Jun Ma <JunMa@linux.alibaba.com>\n+2020-01-22  Jun Ma  <JunMa@linux.alibaba.com>\n \n \t* coroutines.cc (lookup_awaitable_member): Lookup an awaitable member.\n \t(lookup_promise_method): Emit diagnostic when get NULL_TREE back only."}, {"sha": "ceefdf8c03ddd97c76bda6e700fa49957a1143d8", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -1,5 +1,9 @@\n 2020-01-22  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* parse.c (parse_omp_structured_block): Handle ST_OMP_TARGET_PARALLEL.\n+\t* trans-openmp.c (gfc_trans_omp_target)\n+\t<case EXEC_OMP_TARGET_PARALLEL>: Call pushlevel first.\n+\n \tPR fortran/93329\n \t* openmp.c (omp_code_to_statement): Handle remaining EXEC_OMP_*\n \tcases."}, {"sha": "4bff0c885e2322f8b09419c65b5dac8fa36ba403", "filename": "gcc/fortran/parse.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ffortran%2Fparse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ffortran%2Fparse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.c?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -5231,6 +5231,9 @@ parse_omp_structured_block (gfc_statement omp_st, bool workshare_stmts_only)\n     case ST_OMP_TARGET_DATA:\n       omp_end_st = ST_OMP_END_TARGET_DATA;\n       break;\n+    case ST_OMP_TARGET_PARALLEL:\n+      omp_end_st = ST_OMP_END_TARGET_PARALLEL;\n+      break;\n     case ST_OMP_TARGET_TEAMS:\n       omp_end_st = ST_OMP_END_TARGET_TEAMS;\n       break;"}, {"sha": "fd60bbbed5de1e1686973ef0053a97514b9d3d69", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -5357,6 +5357,7 @@ gfc_trans_omp_target (gfc_code *code)\n       {\n \tstmtblock_t iblock;\n \n+\tpushlevel ();\n \tgfc_start_block (&iblock);\n \ttree inner_clauses\n \t  = gfc_trans_omp_clauses (&block, &clausesa[GFC_OMP_SPLIT_PARALLEL],"}, {"sha": "552270d874cf708220bbaa4d4f393c5fffb3b927", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -1,5 +1,9 @@\n 2020-01-22  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* gfortran.dg/gomp/target-parallel1.f90: New test.\n+\t* gfortran.dg/goacc/pr93329.f90: Enable commented out target parallel\n+\ttest.\n+\n \tPR fortran/93329\n \t* gfortran.dg/goacc/pr93329.f90: New test.\n "}, {"sha": "b2d25bda88b3abf8af4d8740b4af694f3f3be999", "filename": "gcc/testsuite/gfortran.dg/goacc/pr93329.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr93329.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr93329.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Fpr93329.f90?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -68,8 +68,8 @@\n !$omp target exit data map(from: x)\t! { dg-error \"OMP TARGET EXIT DATA directive cannot be specified within\" }\n !$acc end kernels\n !$acc kernels\n-!!$omp target parallel\n-!!$omp end target parallel\n+!$omp target parallel\t\t! { dg-error \"OMP TARGET PARALLEL directive cannot be specified within\" }\n+!$omp end target parallel\n !$acc end kernels\n !$acc kernels\n !$omp target parallel do\t! { dg-error \"OMP TARGET PARALLEL DO directive cannot be specified within\" }"}, {"sha": "bb8561f1c73a392d53efdf2c8080eff514b8c9bf", "filename": "gcc/testsuite/gfortran.dg/gomp/target-parallel1.f90", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Ftarget-parallel1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44a9d801a7080d39658754ad603536da6cff2cd0/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Ftarget-parallel1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Ftarget-parallel1.f90?ref=44a9d801a7080d39658754ad603536da6cff2cd0", "patch": "@@ -0,0 +1,4 @@\n+!$omp target parallel\n+  print *, 'Hello, world'\n+!$omp end target parallel\n+end"}]}