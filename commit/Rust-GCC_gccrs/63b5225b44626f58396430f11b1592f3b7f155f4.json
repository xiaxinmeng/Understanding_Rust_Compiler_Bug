{"sha": "63b5225b44626f58396430f11b1592f3b7f155f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjNiNTIyNWI0NDYyNmY1ODM5NjQzMGYxMWIxNTkyZjNiN2YxNTVmNA==", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2014-05-21T12:56:05Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-05-21T12:56:05Z"}, "message": "2014-05-21  Yannick Moy  <moy@adacore.com>\n\n\t* lib-xref-spark_specific.adb, lib-xref.ads, lib-xref.adb\n\t(Enclosing_Subprogram_Or_Package): Only return a library-level\n\tpackage.\n\nFrom-SVN: r210700", "tree": {"sha": "56db786687dc97722095edb5588d9fc21cf0651a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/56db786687dc97722095edb5588d9fc21cf0651a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63b5225b44626f58396430f11b1592f3b7f155f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63b5225b44626f58396430f11b1592f3b7f155f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63b5225b44626f58396430f11b1592f3b7f155f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63b5225b44626f58396430f11b1592f3b7f155f4/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a8a89b743d7f22120969402642b2375537c67243", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a8a89b743d7f22120969402642b2375537c67243", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a8a89b743d7f22120969402642b2375537c67243"}], "stats": {"total": 63, "additions": 45, "deletions": 18}, "files": [{"sha": "0091301dacfb415d48557cf4410f3c0efb1d61e2", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=63b5225b44626f58396430f11b1592f3b7f155f4", "patch": "@@ -1,3 +1,9 @@\n+2014-05-21  Yannick Moy  <moy@adacore.com>\n+\n+\t* lib-xref-spark_specific.adb, lib-xref.ads, lib-xref.adb\n+\t(Enclosing_Subprogram_Or_Package): Only return a library-level\n+\tpackage.\n+\n 2014-05-21  Javier Miranda  <miranda@adacore.com>\n \n \t* sem_ch3.adb (Build_Derived_Record_Type): Initialize Parent_Base"}, {"sha": "aea8b2cfee88a85950e9ced7fa4ada93159fdffb", "filename": "gcc/ada/lib-xref-spark_specific.adb", "status": "modified", "additions": 27, "deletions": 12, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2Flib-xref-spark_specific.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2Flib-xref-spark_specific.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-xref-spark_specific.adb?ref=63b5225b44626f58396430f11b1592f3b7f155f4", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2011-2013, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2011-2014, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -23,10 +23,9 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n-with SPARK_Xrefs;     use SPARK_Xrefs;\n-with Einfo;           use Einfo;\n-with Nmake;           use Nmake;\n-with Put_SPARK_Xrefs;\n+with SPARK_Xrefs; use SPARK_Xrefs;\n+with Einfo;       use Einfo;\n+with Nmake;       use Nmake;\n \n with GNAT.HTable;\n \n@@ -972,7 +971,9 @@ package body SPARK_Specific is\n    -- Enclosing_Subprogram_Or_Package --\n    -------------------------------------\n \n-   function Enclosing_Subprogram_Or_Package (N : Node_Id) return Entity_Id is\n+   function Enclosing_Subprogram_Or_Library_Package\n+     (N : Node_Id) return Entity_Id\n+   is\n       Result : Entity_Id;\n \n    begin\n@@ -990,12 +991,26 @@ package body SPARK_Specific is\n       while Present (Result) loop\n          case Nkind (Result) is\n             when N_Package_Specification =>\n-               Result := Defining_Unit_Name (Result);\n-               exit;\n+\n+               --  Only return a library-level package\n+\n+               if Is_Library_Level_Entity (Defining_Entity (Result)) then\n+                  Result := Defining_Entity (Result);\n+                  exit;\n+               else\n+                  Result := Parent (Result);\n+               end if;\n \n             when N_Package_Body =>\n-               Result := Defining_Unit_Name (Result);\n-               exit;\n+\n+               --  Only return a library-level package\n+\n+               if Is_Library_Level_Entity (Defining_Entity (Result)) then\n+                  Result := Defining_Entity (Result);\n+                  exit;\n+               else\n+                  Result := Parent (Result);\n+               end if;\n \n             when N_Subprogram_Specification =>\n                Result := Defining_Unit_Name (Result);\n@@ -1045,7 +1060,7 @@ package body SPARK_Specific is\n       end if;\n \n       return Result;\n-   end Enclosing_Subprogram_Or_Package;\n+   end Enclosing_Subprogram_Or_Library_Package;\n \n    -----------------\n    -- Entity_Hash --\n@@ -1107,7 +1122,7 @@ package body SPARK_Specific is\n                Create_Heap;\n             end if;\n \n-            Ref_Scope := Enclosing_Subprogram_Or_Package (N);\n+            Ref_Scope := Enclosing_Subprogram_Or_Library_Package (N);\n \n             Deref.Ent := Heap;\n             Deref.Loc := Loc;"}, {"sha": "ed1138927cf30b123b62c4a26dc2fabdda2c2bd0", "filename": "gcc/ada/lib-xref.adb", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2Flib-xref.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2Flib-xref.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-xref.adb?ref=63b5225b44626f58396430f11b1592f3b7f155f4", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1998-2013, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1998-2014, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -1029,8 +1029,10 @@ package body Lib.Xref is\n             Ref := Sloc (Nod);\n             Def := Sloc (Ent);\n \n-            Ref_Scope := SPARK_Specific.Enclosing_Subprogram_Or_Package (Nod);\n-            Ent_Scope := SPARK_Specific.Enclosing_Subprogram_Or_Package (Ent);\n+            Ref_Scope :=\n+              SPARK_Specific.Enclosing_Subprogram_Or_Library_Package (Nod);\n+            Ent_Scope :=\n+              SPARK_Specific.Enclosing_Subprogram_Or_Library_Package (Ent);\n \n             --  Since we are reaching through renamings in SPARK mode, we may\n             --  end up with standard constants. Ignore those."}, {"sha": "17733a0c93038b1d17a28691c8052a7cf20f7ffd", "filename": "gcc/ada/lib-xref.ads", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2Flib-xref.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63b5225b44626f58396430f11b1592f3b7f155f4/gcc%2Fada%2Flib-xref.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-xref.ads?ref=63b5225b44626f58396430f11b1592f3b7f155f4", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 1998-2013, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1998-2014, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -624,8 +624,12 @@ package Lib.Xref is\n \n    package SPARK_Specific is\n \n-      function Enclosing_Subprogram_Or_Package (N : Node_Id) return Entity_Id;\n-      --  Return the closest enclosing subprogram of package\n+      function Enclosing_Subprogram_Or_Library_Package\n+        (N : Node_Id) return Entity_Id;\n+      --  Return the closest enclosing subprogram of package. Only return a\n+      --  library level package. If the package is enclosed in a subprogram,\n+      --  return the subprogram. This ensures that GNATprove can distinguish\n+      --  local variables from global variables.\n \n       procedure Generate_Dereference\n         (N   : Node_Id;"}]}