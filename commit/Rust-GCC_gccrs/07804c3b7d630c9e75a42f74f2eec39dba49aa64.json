{"sha": "07804c3b7d630c9e75a42f74f2eec39dba49aa64", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc4MDRjM2I3ZDYzMGM5ZTc1YTQyZjc0ZjJlZWMzOWRiYTQ5YWE2NA==", "commit": {"author": {"name": "Nick Clifton", "email": "nickc@cambridge.redhat.com", "date": "2001-06-30T08:46:31Z"}, "committer": {"name": "Nick Clifton", "email": "nickc@gcc.gnu.org", "date": "2001-06-30T08:46:31Z"}, "message": "Append a DIR_SEPARATOR to a path specified by the -B switch, if doing so would\ncreate a valid directory name.\n\nFrom-SVN: r43664", "tree": {"sha": "f078a945da21af809e03e047a7c58790767cfd57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f078a945da21af809e03e047a7c58790767cfd57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/07804c3b7d630c9e75a42f74f2eec39dba49aa64", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07804c3b7d630c9e75a42f74f2eec39dba49aa64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07804c3b7d630c9e75a42f74f2eec39dba49aa64", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07804c3b7d630c9e75a42f74f2eec39dba49aa64/comments", "author": null, "committer": null, "parents": [{"sha": "bc2fa2fd2e5bd9841a1f889cd14d99649f3022b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc2fa2fd2e5bd9841a1f889cd14d99649f3022b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc2fa2fd2e5bd9841a1f889cd14d99649f3022b0"}], "stats": {"total": 80, "additions": 57, "deletions": 23}, "files": [{"sha": "f4fbe8aac78283a61fb46ab3f3199b4adb19cd1b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07804c3b7d630c9e75a42f74f2eec39dba49aa64/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07804c3b7d630c9e75a42f74f2eec39dba49aa64/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=07804c3b7d630c9e75a42f74f2eec39dba49aa64", "patch": "@@ -1,3 +1,10 @@\n+2001-06-29  Nick Clifton  <nickc@cambridge.redhat.com>\n+\n+\t* gcc.c (process_command): Append a DIR_SEPARATOR to a path\n+\tspecified by the -B switch, if doing so would create a valid\n+\tdirectory name.\n+\t* doc/invoke.texi: Document changed behaviour of -B.\n+\n 2001-06-29  DJ Delorie  <dj@redhat.com>\n \n \t* simplify-rtx.c (simplify_subreg): When simplifying a CONCAT, at"}, {"sha": "37645ebc7abba9fd130b7ed183de2aa30b1fe1f3", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07804c3b7d630c9e75a42f74f2eec39dba49aa64/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07804c3b7d630c9e75a42f74f2eec39dba49aa64/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=07804c3b7d630c9e75a42f74f2eec39dba49aa64", "patch": "@@ -4398,6 +4398,10 @@ those results in a file name that is found, the unmodified program\n name is searched for using the directories specified in your\n @env{PATH} environment variable.\n \n+The compiler will check to see if the path provided by the @option{-B}\n+refers to a directory, and if necessary it will add a directory\n+separator character at the end of the path.\n+\n @option{-B} prefixes that effectively specify directory names also apply\n to libraries in the linker, because the compiler translates these\n options into @option{-L} options for the linker.  They also apply to\n@@ -4414,6 +4418,10 @@ Another way to specify a prefix much like the @option{-B} prefix is to use\n the environment variable @env{GCC_EXEC_PREFIX}.  @xref{Environment\n Variables}.\n \n+As a special kludge, if the path provided by @option{-B} is\n+@samp{[foo/]stage<N>/} then it will be replaced by\n+@samp{[foo/]include}.  This is to help with boot-strapping the compiler.\n+\n @item -specs=@var{file}\n @opindex specs\n Process @var{file} after the compiler reads in the standard @file{specs}"}, {"sha": "50be2f8e6140c35f488a901d8b976b4a17570db2", "filename": "gcc/gcc.c", "status": "modified", "additions": 42, "deletions": 23, "changes": 65, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07804c3b7d630c9e75a42f74f2eec39dba49aa64/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07804c3b7d630c9e75a42f74f2eec39dba49aa64/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=07804c3b7d630c9e75a42f74f2eec39dba49aa64", "patch": "@@ -3366,36 +3366,55 @@ process_command (argc, argv)\n \t    case 'B':\n \t      {\n \t\tconst char *value;\n+\t\tint len;\n+\n \t\tif (p[1] == 0 && i + 1 == argc)\n \t\t  fatal (\"argument to `-B' is missing\");\n \t\tif (p[1] == 0)\n \t\t  value = argv[++i];\n \t\telse\n \t\t  value = p + 1;\n-\t\t{\n-\t\t  /* As a kludge, if the arg is \"[foo/]stageN/\", just\n-\t\t     add \"[foo/]include\" to the include prefix.  */\n-\t\t  int len = strlen (value);\n-\t\t  if ((len == 7\n-\t\t       || (len > 7\n-\t\t\t   && (IS_DIR_SEPARATOR (value[len - 8]))))\n-\t\t      && strncmp (value + len - 7, \"stage\", 5) == 0\n-\t\t      && ISDIGIT (value[len - 2])\n-\t\t      && (IS_DIR_SEPARATOR (value[len - 1])))\n-\t\t    {\n-\t\t      if (len == 7)\n-\t\t\tadd_prefix (&include_prefixes, \"include\", NULL,\n+\n+\t\tlen = strlen (value);\n+\n+\t\t/* Catch the case where the user has forgotten to append a\n+\t\t   directory seperator to the path.  Note, they may be using\n+\t\t   -B to add an executable name prefix, eg \"i386-elf-\", in\n+\t\t   order to distinguish between multiple installations of\n+\t\t   GCC in the same directory.  Hence we must check to see\n+\t\t   if appending a directory separator actually makes a\n+\t\t   valid directory name.  */\n+\t\tif (! IS_DIR_SEPARATOR (value [len - 1])\n+\t\t    && is_directory (value, \"\", 0))\n+\t\t  {\n+\t\t    value = strcpy (xmalloc (len + 2), value);\n+\t\t    value[len] = DIR_SEPARATOR;\n+\t\t    value[++ len] = 0;\n+\t\t  }\n+\t\t\n+\t\t/* As a kludge, if the arg is \"[foo/]stageN/\", just\n+\t\t   add \"[foo/]include\" to the include prefix.  */\n+\t\tif ((len == 7\n+\t\t     || (len > 7\n+\t\t\t && (IS_DIR_SEPARATOR (value[len - 8]))))\n+\t\t    && strncmp (value + len - 7, \"stage\", 5) == 0\n+\t\t    && ISDIGIT (value[len - 2])\n+\t\t    && (IS_DIR_SEPARATOR (value[len - 1])))\n+\t\t  {\n+\t\t    if (len == 7)\n+\t\t      add_prefix (&include_prefixes, \"include\", NULL,\n+\t\t\t\t  PREFIX_PRIORITY_B_OPT, 0, NULL);\n+\t\t    else\n+\t\t      {\n+\t\t\tchar * string = xmalloc (len + 1);\n+\n+\t\t\tstrncpy (string, value, len - 7);\n+\t\t\tstrcpy (string + len - 7, \"include\");\n+\t\t\tadd_prefix (&include_prefixes, string, NULL,\n \t\t\t\t    PREFIX_PRIORITY_B_OPT, 0, NULL);\n-\t\t      else\n-\t\t\t{\n-\t\t\t  char *string = xmalloc (len + 1);\n-\t\t\t  strncpy (string, value, len-7);\n-\t\t\t  strcpy (string+len-7, \"include\");\n-\t\t\t  add_prefix (&include_prefixes, string, NULL,\n-\t\t\t\t      PREFIX_PRIORITY_B_OPT, 0, NULL);\n-\t\t\t}\n-\t\t    }\n-\t\t}\n+\t\t      }\n+\t\t  }\n+\n \t\tadd_prefix (&exec_prefixes, value, NULL,\n \t\t\t    PREFIX_PRIORITY_B_OPT, 0, &warn_B);\n \t\tadd_prefix (&startfile_prefixes, value, NULL,"}]}