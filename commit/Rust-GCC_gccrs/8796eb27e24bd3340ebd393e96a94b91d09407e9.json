{"sha": "8796eb27e24bd3340ebd393e96a94b91d09407e9", "node_id": "C_kwDOANBUbNoAKDg3OTZlYjI3ZTI0YmQzMzQwZWJkMzkzZTk2YTk0YjkxZDA5NDA3ZTk", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-03-27T13:44:59Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-03-28T13:35:58Z"}, "message": "c++: visibility of local extern [PR103291]\n\nWhen setting up the hidden namespace-scope decl for a local extern, we also\nneed to set its visibility.\n\n\tPR c++/103291\n\ngcc/cp/ChangeLog:\n\n\t* name-lookup.cc (push_local_extern_decl_alias): Call\n\tdetermine_visibility.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/ext/visibility/visibility-local-extern1.C: New test.", "tree": {"sha": "1fc2a9385e5994b8e5fd5e95ad249821750198d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1fc2a9385e5994b8e5fd5e95ad249821750198d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8796eb27e24bd3340ebd393e96a94b91d09407e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8796eb27e24bd3340ebd393e96a94b91d09407e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8796eb27e24bd3340ebd393e96a94b91d09407e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8796eb27e24bd3340ebd393e96a94b91d09407e9/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b854ce130ebbfdf2f882ef08538746030513b44b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b854ce130ebbfdf2f882ef08538746030513b44b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b854ce130ebbfdf2f882ef08538746030513b44b"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "c833b84ca8a77d6e702eac061f7d2fe2ba943baa", "filename": "gcc/cp/name-lookup.cc", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8796eb27e24bd3340ebd393e96a94b91d09407e9/gcc%2Fcp%2Fname-lookup.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8796eb27e24bd3340ebd393e96a94b91d09407e9/gcc%2Fcp%2Fname-lookup.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.cc?ref=8796eb27e24bd3340ebd393e96a94b91d09407e9", "patch": "@@ -3476,6 +3476,9 @@ push_local_extern_decl_alias (tree decl)\n \t      && CP_DECL_THREAD_LOCAL_P (decl)\n \t      && alias != error_mark_node)\n \t    set_decl_tls_model (alias, DECL_TLS_MODEL (decl));\n+\n+\t  /* Adjust visibility.  */\n+\t  determine_visibility (alias);\n \t}\n     }\n "}, {"sha": "40c20199d0ccecbf8a6bfcc0f0df45f572b191b0", "filename": "gcc/testsuite/g++.dg/ext/visibility/visibility-local-extern1.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8796eb27e24bd3340ebd393e96a94b91d09407e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fvisibility-local-extern1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8796eb27e24bd3340ebd393e96a94b91d09407e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fvisibility-local-extern1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fvisibility-local-extern1.C?ref=8796eb27e24bd3340ebd393e96a94b91d09407e9", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/103291\n+// { dg-additional-options -fpic }\n+// { dg-final { scan-assembler-not \"@GOTPCREL\" } }\n+\n+#pragma GCC visibility push(hidden)\n+\n+int hidden_fetch(void) {\n+  extern const int hidden_global;\n+  return hidden_global;\n+}"}]}