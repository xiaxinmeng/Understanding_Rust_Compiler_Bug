{"sha": "7dcc7195959693f57a3df3ccc92854566b96b590", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2RjYzcxOTU5NTk2OTNmNTdhM2RmM2NjYzkyODU0NTY2Yjk2YjU5MA==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2015-07-05T21:49:08Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2015-07-05T21:49:08Z"}, "message": "nios2-protos.h (nios2_symbol_ref_in_small_data_p): Delete extern declaration.\n\n2015-07-05  Chung-Lin Tang  <cltang@codesourcery.com>\n\t    Sandra Loosemore <sandra@codesourcery.com>\n\n\tgcc/\n\t* config/nios2/nios2-protos.h (nios2_symbol_ref_in_small_data_p):\n\tDelete extern declaration.\n\t(gprel_constant_p): Add extern declaration.\n\t* config/nios2/constraints.md (\"S\"): Use gprel_constant_p\n\tinstead of nios2_symbol_ref_in_small_data_p.\n\t* config/nios2/nios2.c (nios2_legitimate_address_p): Likewise.\n\t(nios2_symbol_ref_in_small_data_p): Make static.\n\t(gprel_constant_p): Make non-static.\n\n\tgcc/testsuite/\n\t* gcc.target/nios2/gprel-offset.c: New test.\n\nCo-Authored-By: Sandra Loosemore <sandra@codesourcery.com>\n\nFrom-SVN: r225437", "tree": {"sha": "ed87521b0f371de05b482aab31fb3b60a63fc020", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed87521b0f371de05b482aab31fb3b60a63fc020"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7dcc7195959693f57a3df3ccc92854566b96b590", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dcc7195959693f57a3df3ccc92854566b96b590", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7dcc7195959693f57a3df3ccc92854566b96b590", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7dcc7195959693f57a3df3ccc92854566b96b590/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "291e91daa73361a1f4a426a879f89c1ea6cf0e9f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/291e91daa73361a1f4a426a879f89c1ea6cf0e9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/291e91daa73361a1f4a426a879f89c1ea6cf0e9f"}], "stats": {"total": 53, "additions": 45, "deletions": 8}, "files": [{"sha": "0d6337c2a23bc294d20e0557ec817764713a5f72", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7dcc7195959693f57a3df3ccc92854566b96b590", "patch": "@@ -1,3 +1,15 @@\n+2015-07-05  Chung-Lin Tang  <cltang@codesourcery.com>\n+\t    Sandra Loosemore <sandra@codesourcery.com>\n+\n+\t* config/nios2/nios2-protos.h (nios2_symbol_ref_in_small_data_p):\n+\tDelete extern declaration.\n+\t(gprel_constant_p): Add extern declaration.\n+\t* config/nios2/constraints.md (\"S\"): Use gprel_constant_p\n+\tinstead of nios2_symbol_ref_in_small_data_p.\n+\t* config/nios2/nios2.c (nios2_legitimate_address_p): Likewise.\n+\t(nios2_symbol_ref_in_small_data_p): Make static.\n+\t(gprel_constant_p): Make non-static.\n+\n 2015-07-05  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* doc/fragments.texi (Target Fragment): Convert debian.org"}, {"sha": "b67e87d3b3c85af7285ba6dcc416ea16a0e580e0", "filename": "gcc/config/nios2/constraints.md", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Fconfig%2Fnios2%2Fconstraints.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Fconfig%2Fnios2%2Fconstraints.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fconstraints.md?ref=7dcc7195959693f57a3df3ccc92854566b96b590", "patch": "@@ -84,8 +84,7 @@\n \n (define_constraint \"S\"\n   \"An immediate stored in small data, accessible by GP.\"\n-  (and (match_code \"symbol_ref\")\n-       (match_test \"nios2_symbol_ref_in_small_data_p (op)\")))\n+  (match_test \"gprel_constant_p (op)\"))\n \n (define_constraint \"T\"\n   \"A constant unspec offset representing a relocation.\""}, {"sha": "52985a9d06cc8e1e96081053146620605cc71871", "filename": "gcc/config/nios2/nios2-protos.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Fconfig%2Fnios2%2Fnios2-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Fconfig%2Fnios2%2Fnios2-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2-protos.h?ref=7dcc7195959693f57a3df3ccc92854566b96b590", "patch": "@@ -44,7 +44,7 @@ extern bool nios2_fpu_insn_enabled (enum n2fpu_code);\n extern const char * nios2_fpu_insn_asm (enum n2fpu_code);\n \n extern bool nios2_legitimate_pic_operand_p (rtx);\n-extern bool nios2_symbol_ref_in_small_data_p (rtx);\n+extern bool gprel_constant_p (rtx);\n extern bool nios2_regno_ok_for_base_p (int, bool);\n extern bool nios2_unspec_reloc_p (rtx);\n "}, {"sha": "51f7aa2defb044b96411d1541bf4abe31dd508f9", "filename": "gcc/config/nios2/nios2.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Fconfig%2Fnios2%2Fnios2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Fconfig%2Fnios2%2Fnios2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnios2%2Fnios2.c?ref=7dcc7195959693f57a3df3ccc92854566b96b590", "patch": "@@ -1614,14 +1614,15 @@ nios2_legitimate_address_p (machine_mode mode ATTRIBUTE_UNUSED,\n     case SYMBOL_REF:\n       if (SYMBOL_REF_TLS_MODEL (operand))\n \treturn false;\n-      \n-      if (nios2_symbol_ref_in_small_data_p (operand))\n+\n+      /* Else, fall through.  */\n+    case CONST:\n+      if (gprel_constant_p (operand))\n \treturn true;\n \n       /* Else, fall through.  */\n     case LABEL_REF:\n     case CONST_INT:\n-    case CONST:\n     case CONST_DOUBLE:\n       return false;\n \n@@ -1688,7 +1689,7 @@ nios2_in_small_data_p (const_tree exp)\n \n /* Return true if symbol is in small data section.  */\n \n-bool\n+static bool\n nios2_symbol_ref_in_small_data_p (rtx sym)\n {\n   tree decl;\n@@ -2110,7 +2111,7 @@ nios2_print_operand (FILE *file, rtx op, int letter)\n }\n \n /* Return true if this is a GP-relative accessible reference.  */\n-static bool\n+bool\n gprel_constant_p (rtx op)\n {\n   if (GET_CODE (op) == SYMBOL_REF"}, {"sha": "2eb4fdc22a48268f2c6499bff8d59dcd52061e3b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7dcc7195959693f57a3df3ccc92854566b96b590", "patch": "@@ -1,3 +1,8 @@\n+2015-07-05  Chung-Lin Tang  <cltang@codesourcery.com>\n+\t    Sandra Loosemore <sandra@codesourcery.com>\n+\n+\t* gcc.target/nios2/gprel-offset.c: New test.\n+\n 2015-07-04  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/66725"}, {"sha": "05186c66adbb6965207b449a94f09af64eaaea1a", "filename": "gcc/testsuite/gcc.target/nios2/gprel-offset.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fgprel-offset.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7dcc7195959693f57a3df3ccc92854566b96b590/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fgprel-offset.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnios2%2Fgprel-offset.c?ref=7dcc7195959693f57a3df3ccc92854566b96b590", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+static struct s {\n+  int x;\n+  char y;\n+} s;\n+\n+void set (char c)\n+{\n+  s.y = c;\n+}\n+\n+\n+char get (void)\n+{\n+  return s.y;\n+}\n+\n+/* { dg-final { scan-assembler-times \"%gprel\\\\(s\\\\+4\\\\)\\\\(gp\\\\)\" 2 } } */"}]}