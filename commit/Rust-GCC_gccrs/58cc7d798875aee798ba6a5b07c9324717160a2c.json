{"sha": "58cc7d798875aee798ba6a5b07c9324717160a2c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThjYzdkNzk4ODc1YWVlNzk4YmE2YTViMDdjOTMyNDcxNzE2MGEyYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-12-18T17:52:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-12-18T17:52:13Z"}, "message": "re PR c++/83300 (Segmentation fault with template and __attribute__((vector_size (sizeof(int) * N)));)\n\n\tPR c++/83300\n\t* decl2.c (save_template_attributes): Add flags argument, if\n\tnot ATTR_FLAG_TYPE_IN_PLACE, *decl_p is a type and we want to\n\tmodify TYPE_ATTRIBUTES, add them on type attribute variant.\n\n\t* g++.dg/ext/vector33.C: New test.\n\nFrom-SVN: r255783", "tree": {"sha": "8d372d57995156dce5e48bf2bddbd29ebf1e01fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8d372d57995156dce5e48bf2bddbd29ebf1e01fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58cc7d798875aee798ba6a5b07c9324717160a2c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58cc7d798875aee798ba6a5b07c9324717160a2c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58cc7d798875aee798ba6a5b07c9324717160a2c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58cc7d798875aee798ba6a5b07c9324717160a2c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "82cfbd01e4870097de5f9ccdae900141b382d70e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82cfbd01e4870097de5f9ccdae900141b382d70e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82cfbd01e4870097de5f9ccdae900141b382d70e"}], "stats": {"total": 41, "additions": 38, "deletions": 3}, "files": [{"sha": "b6e782a389c573f35b90959e613e83b6a1746278", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=58cc7d798875aee798ba6a5b07c9324717160a2c", "patch": "@@ -1,3 +1,10 @@\n+2017-12-18  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/83300\n+\t* decl2.c (save_template_attributes): Add flags argument, if\n+\tnot ATTR_FLAG_TYPE_IN_PLACE, *decl_p is a type and we want to\n+\tmodify TYPE_ATTRIBUTES, add them on type attribute variant.\n+\n 2017-12-18  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/59930"}, {"sha": "5a87f30fa403bba49c9f0fb6c5afc9ac980bf7c8", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=58cc7d798875aee798ba6a5b07c9324717160a2c", "patch": "@@ -1244,7 +1244,7 @@ splice_template_attributes (tree *attr_p, tree decl)\n    DECL_P.  */\n \n static void\n-save_template_attributes (tree *attr_p, tree *decl_p)\n+save_template_attributes (tree *attr_p, tree *decl_p, int flags)\n {\n   tree *q;\n \n@@ -1265,7 +1265,20 @@ save_template_attributes (tree *attr_p, tree *decl_p)\n   /* Merge the late attributes at the beginning with the attribute\n      list.  */\n   late_attrs = merge_attributes (late_attrs, *q);\n-  *q = late_attrs;\n+  if (*q != late_attrs\n+      && !DECL_P (*decl_p)\n+      && !(flags & ATTR_FLAG_TYPE_IN_PLACE))\n+    {\n+      if (!dependent_type_p (*decl_p))\n+\t*decl_p = cp_build_type_attribute_variant (*decl_p, late_attrs);\n+      else\n+\t{\n+\t  *decl_p = build_variant_type_copy (*decl_p);\n+\t  TYPE_ATTRIBUTES (*decl_p) = late_attrs;\n+\t}\n+    }\n+  else\n+    *q = late_attrs;\n \n   if (!DECL_P (*decl_p) && *decl_p == TYPE_MAIN_VARIANT (*decl_p))\n     {\n@@ -1466,7 +1479,7 @@ cplus_decl_attributes (tree *decl, tree attributes, int flags)\n       if (check_for_bare_parameter_packs (attributes))\n \treturn;\n \n-      save_template_attributes (&attributes, decl);\n+      save_template_attributes (&attributes, decl, flags);\n     }\n \n   cp_check_const_attributes (attributes);"}, {"sha": "0963f4ec9618f93c2b9e4c36d92932d0b1ccb9f5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=58cc7d798875aee798ba6a5b07c9324717160a2c", "patch": "@@ -1,3 +1,8 @@\n+2017-12-18  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/83300\n+\t* g++.dg/ext/vector33.C: New test.\n+\n 2017-12-18  Marek Polacek  <polacek@redhat.com>\n \n \tPR middle-end/83463"}, {"sha": "f50253232cf8542011abf55a48494894d9973007", "filename": "gcc/testsuite/g++.dg/ext/vector33.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector33.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58cc7d798875aee798ba6a5b07c9324717160a2c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector33.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector33.C?ref=58cc7d798875aee798ba6a5b07c9324717160a2c", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/83300\n+// { dg-do compile { target c++11 } }\n+\n+template<int N>\n+using T = int __attribute__((vector_size (sizeof(int) * N)));\n+\n+void\n+f (T<4>)\n+{\n+}"}]}