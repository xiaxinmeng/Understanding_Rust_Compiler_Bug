{"sha": "ef1f343258a2fba8b7ce3af5534787ed38d0ee3e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWYxZjM0MzI1OGEyZmJhOGI3Y2UzYWY1NTM0Nzg3ZWQzOGQwZWUzZQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-05-22T16:57:23Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-05-22T16:57:23Z"}, "message": "runtime: Use getcontext, not setjmp, to save regs for GC.\n\nFrom-SVN: r187777", "tree": {"sha": "4519e817522fc93f7bdd2860a46165fd4ab038c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4519e817522fc93f7bdd2860a46165fd4ab038c5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e/comments", "author": null, "committer": null, "parents": [{"sha": "3cd50158f525564510b05c2c494f477ed42c0a0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3cd50158f525564510b05c2c494f477ed42c0a0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3cd50158f525564510b05c2c494f477ed42c0a0a"}], "stats": {"total": 11, "additions": 4, "deletions": 7}, "files": [{"sha": "ade8b9e2db10e5c32dea1ed045b6b6a7499119de", "filename": "libgo/runtime/proc.c", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e/libgo%2Fruntime%2Fproc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e/libgo%2Fruntime%2Fproc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fproc.c?ref=ef1f343258a2fba8b7ce3af5534787ed38d0ee3e", "patch": "@@ -1239,9 +1239,7 @@ runtime_entersyscall(void)\n \n \t// Save the registers in the g structure so that any pointers\n \t// held in registers will be seen by the garbage collector.\n-\t// We could use getcontext here, but setjmp is more efficient\n-\t// because it doesn't need to save the signal mask.\n-\tsetjmp(g->gcregs);\n+\tgetcontext(&g->gcregs);\n \n \tg->status = Gsyscall;\n \n@@ -1299,7 +1297,7 @@ runtime_exitsyscall(void)\n \t\tgp->gcstack = nil;\n #endif\n \t\tgp->gcnext_sp = nil;\n-\t\truntime_memclr(gp->gcregs, sizeof gp->gcregs);\n+\t\truntime_memclr(&gp->gcregs, sizeof gp->gcregs);\n \n \t\tif(m->profilehz > 0)\n \t\t\truntime_setprof(true);\n@@ -1328,7 +1326,7 @@ runtime_exitsyscall(void)\n \tgp->gcstack = nil;\n #endif\n \tgp->gcnext_sp = nil;\n-\truntime_memclr(gp->gcregs, sizeof gp->gcregs);\n+\truntime_memclr(&gp->gcregs, sizeof gp->gcregs);\n }\n \n // Allocate a new g, with a stack big enough for stacksize bytes."}, {"sha": "67dabd26b144539c3da36cd790dcc5252ca130b9", "filename": "libgo/runtime/runtime.h", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e/libgo%2Fruntime%2Fruntime.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef1f343258a2fba8b7ce3af5534787ed38d0ee3e/libgo%2Fruntime%2Fruntime.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fruntime.h?ref=ef1f343258a2fba8b7ce3af5534787ed38d0ee3e", "patch": "@@ -7,7 +7,6 @@\n #include \"config.h\"\n \n #include \"go-assert.h\"\n-#include <setjmp.h>\n #include <signal.h>\n #include <stdio.h>\n #include <stdlib.h>\n@@ -128,7 +127,7 @@ struct\tG\n \tvoid*\tgcnext_segment;\n \tvoid*\tgcnext_sp;\n \tvoid*\tgcinitial_sp;\n-\tjmp_buf\tgcregs;\n+\tucontext_t gcregs;\n \tbyte*\tentry;\t\t// initial function\n \tG*\talllink;\t// on allg\n \tvoid*\tparam;\t\t// passed parameter on wakeup"}]}