{"sha": "b9a21efdea18862f79c68ceb2eee0704844ead53", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjlhMjFlZmRlYTE4ODYyZjc5YzY4Y2ViMmVlZTA3MDQ4NDRlYWQ1Mw==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-08-17T17:15:42Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2019-08-17T17:15:42Z"}, "message": "re PR fortran/82992 (ICE in create_int_parameter_array, at fortran/module.c:6586)\n\n2019-08-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/82992\n\t* module.c (gfc_match_use):  When renaming a module entity, search\n\tcurrent namespace for conflicting symbol.\n\n2019-08-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/82992\n\t* gfortran.dg/pr71649.f90: Adjust error messages.\n\t* gfortran.dg/use_15.f90: Ditto.\n\t* gfortran.dg/use_rename_8.f90: Ditto.\n\nFrom-SVN: r274608", "tree": {"sha": "a444631882998d3b411bc5adb6625e7f311ec123", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a444631882998d3b411bc5adb6625e7f311ec123"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b9a21efdea18862f79c68ceb2eee0704844ead53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9a21efdea18862f79c68ceb2eee0704844ead53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9a21efdea18862f79c68ceb2eee0704844ead53", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9a21efdea18862f79c68ceb2eee0704844ead53/comments", "author": null, "committer": null, "parents": [{"sha": "716ac0fc6c0ef0f1bf3a295f1338eeb697cddb43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/716ac0fc6c0ef0f1bf3a295f1338eeb697cddb43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/716ac0fc6c0ef0f1bf3a295f1338eeb697cddb43"}], "stats": {"total": 57, "additions": 43, "deletions": 14}, "files": [{"sha": "9af58369cc1b8b90b9954aafee67f189b608e320", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b9a21efdea18862f79c68ceb2eee0704844ead53", "patch": "@@ -1,3 +1,9 @@\n+2019-08-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/82992\n+\t* module.c (gfc_match_use):  When renaming a module entity, search\n+\tcurrent namespace for conflicting symbol.\n+\n 2019-08-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/78739"}, {"sha": "fb6173dcde3bd45ef1504733e9ccac0d1d14fbb7", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=b9a21efdea18862f79c68ceb2eee0704844ead53", "patch": "@@ -525,6 +525,8 @@ gfc_match_use (void)\n   gfc_intrinsic_op op;\n   match m;\n   gfc_use_list *use_list;\n+  gfc_symtree *st;\n+  locus loc;\n \n   use_list = gfc_get_use_list ();\n \n@@ -632,6 +634,8 @@ gfc_match_use (void)\n \tcase INTERFACE_USER_OP:\n \tcase INTERFACE_GENERIC:\n \tcase INTERFACE_DTIO:\n+\t  loc = gfc_current_locus;\n+\n \t  m = gfc_match (\" =>\");\n \n \t  if (type == INTERFACE_USER_OP && m == MATCH_YES\n@@ -642,6 +646,18 @@ gfc_match_use (void)\n \t  if (type == INTERFACE_USER_OP)\n \t    new_use->op = INTRINSIC_USER;\n \n+\t  st = gfc_find_symtree (gfc_current_ns->sym_root, name);\n+\t  if (st)\n+\t    {\n+\t      if (m == MATCH_YES)\n+\t\tgfc_error (\"Symbol %qs at %L conflicts with the rename symbol \"\n+\t\t\t   \"at %L\", name, &st->n.sym->declared_at, &loc);\n+\t      else\n+\t\tgfc_error (\"Symbol %qs at %L conflicts with the symbol \"\n+\t\t\t   \"at %L\", name, &st->n.sym->declared_at, &loc);\n+\t      goto cleanup;\n+\t    }\n+\n \t  if (use_list->only_flag)\n \t    {\n \t      if (m != MATCH_YES)"}, {"sha": "0eb47a644b2904f8d680c95dc70898d68c3d988d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b9a21efdea18862f79c68ceb2eee0704844ead53", "patch": "@@ -1,3 +1,10 @@\n+2019-08-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/82992\n+\t* gfortran.dg/pr71649.f90: Adjust error messages.\n+\t* gfortran.dg/use_15.f90: Ditto.\n+\t* gfortran.dg/use_rename_8.f90: Ditto.\n+\n 2019-08-17  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/78739"}, {"sha": "c01389acfcf743049f71a664e19a2f0492b53778", "filename": "gcc/testsuite/gfortran.dg/pr71649.f90", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr71649.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr71649.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr71649.f90?ref=b9a21efdea18862f79c68ceb2eee0704844ead53", "patch": "@@ -1,13 +1,13 @@\n ! { dg-do compile }\n ! PR71649 Internal Compiler Error\n-SUBROUTINE Compiler_Options ( Options, Version, WriteOpt )\n-   USE ISO_FORTRAN_ENV, ONLY : Compiler_Version, Compiler_Options ! { dg-error \"already declared\" }\n+SUBROUTINE Compiler_Options ( Options, Version, WriteOpt )        ! { dg-error \"\\(1\\)\" }\n+   USE ISO_FORTRAN_ENV, ONLY : Compiler_Version, Compiler_Options ! { dg-error \"conflicts with the\" }\n    IMPLICIT NONE\n    CHARACTER (LEN=*), INTENT(OUT) :: Options\n    CHARACTER (LEN=*), INTENT(OUT) :: Version\n    LOGICAL, INTENT(IN), OPTIONAL  :: WriteOpt\n-   Version = Compiler_Version()\n-   Options = Compiler_Options() ! { dg-error \"Unexpected use of subroutine name\" }\n+   Version = Compiler_Version()  ! { dg-error \"has no IMPLICIT type\" }\n+   Options = Compiler_Options()  ! { dg-error \"Unexpected use of subroutine name\" }\n    RETURN\n END SUBROUTINE Compiler_Options\n "}, {"sha": "eb5aa87cc8b77327bbd0873a4bb347802ebd21ee", "filename": "gcc/testsuite/gfortran.dg/use_15.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_15.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_15.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_15.f90?ref=b9a21efdea18862f79c68ceb2eee0704844ead53", "patch": "@@ -28,8 +28,8 @@ subroutine my_sub2 (a)\n end subroutine\n \n \n-subroutine my_sub3 (a)\n-  use test_mod2, my_sub3 => my_sub2  ! { dg-error \"is also the name of the current program unit\" }\n+subroutine my_sub3 (a)              ! { dg-error \"\\(1\\)\" }\n+  use test_mod2, my_sub3 => my_sub2 ! { dg-error \"conflicts with the rename\" }\n   real a\n   print *, a\n end subroutine"}, {"sha": "b8b49d7a0525e06579b4aed42ca606b22a86dce8", "filename": "gcc/testsuite/gfortran.dg/use_rename_8.f90", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9a21efdea18862f79c68ceb2eee0704844ead53/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_rename_8.f90?ref=b9a21efdea18862f79c68ceb2eee0704844ead53", "patch": "@@ -19,8 +19,8 @@ SUBROUTINE T\n     USE MOO, ONLY: X => B\n END SUBROUTINE T\n \n-SUBROUTINE C\n-    USE MOO, ONLY: C  ! { dg-error \"is also the name of the current program unit\" }\n+SUBROUTINE C          ! { dg-error \"\\(1\\)\" }\n+    USE MOO, ONLY: C  ! { dg-error \"conflicts with the\" }\n END SUBROUTINE C\n \n SUBROUTINE D\n@@ -36,15 +36,15 @@ SUBROUTINE F\n     USE MOO, ONLY: X => F\n END SUBROUTINE F\n \n-SUBROUTINE X\n-    USE MOO, ONLY: X => G ! { dg-error \"is also the name of the current program unit\" }\n+SUBROUTINE X              ! { dg-error \"\\(1\\)\" }\n+    USE MOO, ONLY: X => G ! { dg-error \"conflicts with the rename\" }\n END SUBROUTINE X\n \n-SUBROUTINE Y\n-    USE MOO, ONLY: Y => H ! { dg-error \"is also the name of the current program unit\" }\n+SUBROUTINE Y              ! { dg-error \"\\(1\\)\" }\n+    USE MOO, ONLY: Y => H ! { dg-error \"conflicts with the rename\" }\n END SUBROUTINE Y\n \n-SUBROUTINE Z\n-    USE MOO, ONLY: Z => I, Z => I ! { dg-error \"is also the name of the current program unit\" }\n+SUBROUTINE Z                        ! { dg-error \"\\(1\\)\" }\n+    USE MOO, ONLY: Z => I, Z => I   ! { dg-error \"conflicts with the rename\" }\n END SUBROUTINE Z\n "}]}