{"sha": "3d3a96a26eff2367d6573b30683c3c2945f443eb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2QzYTk2YTI2ZWZmMjM2N2Q2NTczYjMwNjgzYzNjMjk0NWY0NDNlYg==", "commit": {"author": {"name": "Szabolcs Nagy", "email": "szabolcs.nagy@arm.com", "date": "2019-11-18T12:08:18Z"}, "committer": {"name": "Szabolcs Nagy", "email": "nsz@gcc.gnu.org", "date": "2019-11-18T12:08:18Z"}, "message": "musl: Don't use gthr weak refs in libgcc PR91737\n\nThe gthr weak reference based single thread detection is unsafe with\nstatic linking and in case of dynamic linking it's ineffective on musl\nsince pthread symbols are defined in libc.so.\n\n(Ideally this should be fixed for all targets, since glibc plans to move\nlibpthread.so into libc.so too and users want to static link to pthread\nwithout --whole-archive: PR87189.)\n\nFor now we have to explicitly opt out from the broken behaviour in the\nconfig machinery of each target lib and libgcc was previously missed.\n\nlibgcc/ChangeLog:\n\n2019-11-18  Szabolcs Nagy  <szabolcs.nagy@arm.com>\n\n\t* config.host: Add t-gthr-noweak on *-*-musl*.\n\t* config/t-gthr-noweak: New file.\n\nFrom-SVN: r278399", "tree": {"sha": "67fc6ffa1a2f35921c1fb325578745a85b746db3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/67fc6ffa1a2f35921c1fb325578745a85b746db3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d3a96a26eff2367d6573b30683c3c2945f443eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d3a96a26eff2367d6573b30683c3c2945f443eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d3a96a26eff2367d6573b30683c3c2945f443eb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d3a96a26eff2367d6573b30683c3c2945f443eb/comments", "author": {"login": "nsz-arm", "id": 30925343, "node_id": "MDQ6VXNlcjMwOTI1MzQz", "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nsz-arm", "html_url": "https://github.com/nsz-arm", "followers_url": "https://api.github.com/users/nsz-arm/followers", "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}", "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions", "organizations_url": "https://api.github.com/users/nsz-arm/orgs", "repos_url": "https://api.github.com/users/nsz-arm/repos", "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/nsz-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8d7be8d614ba028074597c3ab1ee12d9495fde09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d7be8d614ba028074597c3ab1ee12d9495fde09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d7be8d614ba028074597c3ab1ee12d9495fde09"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "f7fc8214ffd77ab9c983461b201b8ff996d21f20", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3a96a26eff2367d6573b30683c3c2945f443eb/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3a96a26eff2367d6573b30683c3c2945f443eb/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=3d3a96a26eff2367d6573b30683c3c2945f443eb", "patch": "@@ -1,3 +1,8 @@\n+2019-11-18  Szabolcs Nagy  <szabolcs.nagy@arm.com>\n+\n+\t* config.host: Add t-gthr-noweak on *-*-musl*.\n+\t* config/t-gthr-noweak: New file.\n+\n 2019-11-17  John David Anglin  <danglin@gcc.gnu.org>\n \n \t* config/pa/linux-atomic.c (__kernel_cmpxchg): Change argument 1 to"}, {"sha": "bc3e497739f84946bba11bc256434229b43a3055", "filename": "libgcc/config.host", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3a96a26eff2367d6573b30683c3c2945f443eb/libgcc%2Fconfig.host", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3a96a26eff2367d6573b30683c3c2945f443eb/libgcc%2Fconfig.host", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig.host?ref=3d3a96a26eff2367d6573b30683c3c2945f443eb", "patch": "@@ -1531,3 +1531,10 @@ vxworks)\n \t\t;;\n \tesac\n esac\n+\n+case ${host} in\n+*-*-musl*)\n+  # The gthr weak references are unsafe with static linking\n+  tmake_file=\"$tmake_file t-gthr-noweak\"\n+  ;;\n+esac"}, {"sha": "45a21e9361dca719a3ddc5929eb556cff71e1e62", "filename": "libgcc/config/t-gthr-noweak", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d3a96a26eff2367d6573b30683c3c2945f443eb/libgcc%2Fconfig%2Ft-gthr-noweak", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d3a96a26eff2367d6573b30683c3c2945f443eb/libgcc%2Fconfig%2Ft-gthr-noweak", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Ft-gthr-noweak?ref=3d3a96a26eff2367d6573b30683c3c2945f443eb", "patch": "@@ -0,0 +1,2 @@\n+# Don't use weak references for single-thread detection\n+HOST_LIBGCC2_CFLAGS += -DGTHREAD_USE_WEAK=0"}]}