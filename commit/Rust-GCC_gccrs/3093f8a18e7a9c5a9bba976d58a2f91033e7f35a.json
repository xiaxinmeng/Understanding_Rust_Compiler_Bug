{"sha": "3093f8a18e7a9c5a9bba976d58a2f91033e7f35a", "node_id": "C_kwDOANBUbNoAKDMwOTNmOGExOGU3YTljNWE5YmJhOTc2ZDU4YTJmOTEwMzNlN2YzNWE", "commit": {"author": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2022-03-08T23:23:19Z"}, "committer": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2022-03-08T23:23:19Z"}, "message": "PR c++/96437: ICE-on-invalid-code error recovery.\n\nThis patch fixes PR c++/96437 which is an ICE-on-invalid-code regression\naffecting mainline.\n\n2022-03-08  Roger Sayle  <roger@nextmovesoftware.com>\n\ngcc/cp/ChangeLog\n\tPR c++/96437\n\t* parser.cc (synthesize_implicit_template_parm): Check that\n\tTREE_VALUE (new_parm) isn't error_mark_node before setting its\n\tDECL_VIRTUAL_P.\n\ngcc/testsuite/ChangeLog\n\tPR c++/96437\n\t* g++.dg/cpp2a/pr96437.C: New test case.", "tree": {"sha": "16f162e7c64751d5e04d69cdbdb9c78bbddd379b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/16f162e7c64751d5e04d69cdbdb9c78bbddd379b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a/comments", "author": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ab72ec7c456c92989276f17fe0ae90a56932149", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ab72ec7c456c92989276f17fe0ae90a56932149", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ab72ec7c456c92989276f17fe0ae90a56932149"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "9153c74f0694de2ddf3053da6966c2492a80992d", "filename": "gcc/cp/parser.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a/gcc%2Fcp%2Fparser.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a/gcc%2Fcp%2Fparser.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.cc?ref=3093f8a18e7a9c5a9bba976d58a2f91033e7f35a", "patch": "@@ -48218,7 +48218,8 @@ synthesize_implicit_template_parm  (cp_parser *parser, tree constr)\n      function template is equivalent to an explicit template.\n \n      Note that DECL_ARTIFICIAL is used elsewhere for template parameters.  */\n-  DECL_VIRTUAL_P (TREE_VALUE (new_parm)) = true;\n+  if (TREE_VALUE (new_parm) != error_mark_node)\n+    DECL_VIRTUAL_P (TREE_VALUE (new_parm)) = true;\n \n   // Chain the new parameter to the list of implicit parameters.\n   if (parser->implicit_template_parms)"}, {"sha": "79d481e70027e01fad5fed65133c0a9ffa8de85e", "filename": "gcc/testsuite/g++.dg/cpp2a/pr96437.C", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fpr96437.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3093f8a18e7a9c5a9bba976d58a2f91033e7f35a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fpr96437.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fpr96437.C?ref=3093f8a18e7a9c5a9bba976d58a2f91033e7f35a", "patch": "@@ -0,0 +1,4 @@\n+/* { dg-do compile } */\n+/* { dg-excess-errors \"\" } */\n+\n+template <()> void A(auto){}"}]}