{"sha": "11c01dcc46761825183da2f641d81aec89e38393", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTFjMDFkY2M0Njc2MTgyNTE4M2RhMmY2NDFkODFhZWM4OWUzODM5Mw==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@bigpond.net.au", "date": "2004-05-15T12:39:34Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2004-05-15T12:39:34Z"}, "message": "rs6000.c (rs6000_va_arg <ABI_V4>): Don't use UNITS_PER_WORD to calculate gpr size.\n\n\t* config/rs6000/rs6000.c (rs6000_va_arg <ABI_V4>): Don't use\n\tUNITS_PER_WORD to calculate gpr size.  Re-instate code to set reg\n\tcount to 8 to handle n_reg > 2.\n\nFrom-SVN: r81880", "tree": {"sha": "fcdac5d2801017881321925f83882bd4bee7d3dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fcdac5d2801017881321925f83882bd4bee7d3dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/11c01dcc46761825183da2f641d81aec89e38393", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11c01dcc46761825183da2f641d81aec89e38393", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11c01dcc46761825183da2f641d81aec89e38393", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11c01dcc46761825183da2f641d81aec89e38393/comments", "author": null, "committer": null, "parents": [{"sha": "9322b95bd7dee4569ef6579e2a59dd37f12c4daf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9322b95bd7dee4569ef6579e2a59dd37f12c4daf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9322b95bd7dee4569ef6579e2a59dd37f12c4daf"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "65f431ad9a78173cb43d4edb44bad7ec0c29e819", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11c01dcc46761825183da2f641d81aec89e38393/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11c01dcc46761825183da2f641d81aec89e38393/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=11c01dcc46761825183da2f641d81aec89e38393", "patch": "@@ -1,3 +1,9 @@\n+2004-05-15  Alan Modra  <amodra@bigpond.net.au>\n+\n+\t* config/rs6000/rs6000.c (rs6000_va_arg <ABI_V4>): Don't use\n+\tUNITS_PER_WORD to calculate gpr size.  Re-instate code to set reg\n+\tcount to 8 to handle n_reg > 2.\n+\n 2004-05-15  Joseph S. Myers  <jsm@polyomino.org.uk>\n \n \t* doc/extend.texi: Update WG14 URL."}, {"sha": "4dfabe1b00b9c540873cb0797d5ebdaebcea4cfc", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11c01dcc46761825183da2f641d81aec89e38393/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11c01dcc46761825183da2f641d81aec89e38393/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=11c01dcc46761825183da2f641d81aec89e38393", "patch": "@@ -5144,7 +5144,7 @@ rs6000_va_arg (tree valist, tree type)\n   sav = build (COMPONENT_REF, TREE_TYPE (f_sav), valist, f_sav);\n \n   size = int_size_in_bytes (type);\n-  rsize = (size + UNITS_PER_WORD - 1) / UNITS_PER_WORD;\n+  rsize = (size + 3) / 4;\n   align = 1;\n \n   if (AGGREGATE_TYPE_P (type)\n@@ -5158,7 +5158,7 @@ rs6000_va_arg (tree valist, tree type)\n       n_reg = 1;\n       sav_ofs = 0;\n       sav_scale = 4;\n-      size = UNITS_PER_WORD;\n+      size = 4;\n       rsize = 1;\n     }\n   else if (TARGET_HARD_FLOAT && TARGET_FPRS\n@@ -5240,6 +5240,14 @@ rs6000_va_arg (tree valist, tree type)\n       emit_barrier ();\n \n       emit_label (lab_false);\n+      if (n_reg > 2)\n+\t{\n+\t  /* Ensure that we don't find any more args in regs.\n+\t     Alignment has taken care of the n_reg == 2 case.  */\n+\t  t = build (MODIFY_EXPR, TREE_TYPE (reg), reg, build_int_2 (8, 0));\n+\t  TREE_SIDE_EFFECTS (t) = 1;\n+\t  expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);\n+\t}\n     }\n \n   /* ... otherwise out of the overflow area.  */"}]}