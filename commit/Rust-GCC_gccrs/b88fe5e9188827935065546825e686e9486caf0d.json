{"sha": "b88fe5e9188827935065546825e686e9486caf0d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjg4ZmU1ZTkxODg4Mjc5MzUwNjU1NDY4MjVlNjg2ZTk0ODZjYWYwZA==", "commit": {"author": {"name": "Zhenqiang Chen", "email": "zhenqiang.chen@arm.com", "date": "2014-08-07T04:54:06Z"}, "committer": {"name": "Zhenqiang Chen", "email": "zqchen@gcc.gnu.org", "date": "2014-08-07T04:54:06Z"}, "message": "tree-ssa-loop-ivopts.c (get_address_cost): Try aligned offset.\n\nChangeLog\n2014-08-07  Zhenqiang Chen  <zhenqiang.chen@arm.com>\n\n\t* tree-ssa-loop-ivopts.c (get_address_cost): Try aligned offset.\n\ntestsuite/ChangeLog\n2014-08-07  Zhenqiang Chen  <zhenqiang.chen@arm.com>\n\n\t* gcc.target/arm/get_address_cost_aligned_max_offset.c: New test.\n\nFrom-SVN: r213691", "tree": {"sha": "68e96db1207de96e14f3c0c839ed05fc9d7d85ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/68e96db1207de96e14f3c0c839ed05fc9d7d85ee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b88fe5e9188827935065546825e686e9486caf0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b88fe5e9188827935065546825e686e9486caf0d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b88fe5e9188827935065546825e686e9486caf0d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b88fe5e9188827935065546825e686e9486caf0d/comments", "author": null, "committer": null, "parents": [{"sha": "c0014b079fe34362888727502986ce7af50462b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0014b079fe34362888727502986ce7af50462b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0014b079fe34362888727502986ce7af50462b6"}], "stats": {"total": 48, "additions": 48, "deletions": 0}, "files": [{"sha": "81ab714542544a7101fc463156d57246757ee4d6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b88fe5e9188827935065546825e686e9486caf0d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b88fe5e9188827935065546825e686e9486caf0d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b88fe5e9188827935065546825e686e9486caf0d", "patch": "@@ -1,3 +1,7 @@\n+2014-08-07  Zhenqiang Chen  <zhenqiang.chen@arm.com>\n+\n+\t* tree-ssa-loop-ivopts.c (get_address_cost): Try aligned offset.\n+\n 2014-08-06  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR debug/61923"}, {"sha": "e0af2ab77b74d1bfd284f304bf26a24e2dc26027", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b88fe5e9188827935065546825e686e9486caf0d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b88fe5e9188827935065546825e686e9486caf0d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b88fe5e9188827935065546825e686e9486caf0d", "patch": "@@ -1,3 +1,7 @@\n+2014-08-07  Zhenqiang Chen  <zhenqiang.chen@arm.com>\n+\n+\t* gcc.target/arm/get_address_cost_aligned_max_offset.c: New test.\n+\n 2014-08-06  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/43906"}, {"sha": "cc3e2f778321345f843642b25d891252d1b8cb7c", "filename": "gcc/testsuite/gcc.target/arm/get_address_cost_aligned_max_offset.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b88fe5e9188827935065546825e686e9486caf0d/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fget_address_cost_aligned_max_offset.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b88fe5e9188827935065546825e686e9486caf0d/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fget_address_cost_aligned_max_offset.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fget_address_cost_aligned_max_offset.c?ref=b88fe5e9188827935065546825e686e9486caf0d", "patch": "@@ -0,0 +1,28 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-mthumb -O2\" }  */\n+/* { dg-require-effective-target arm_thumb1_ok } */\n+\n+unsigned int\n+test (const short p16[6 * 64])\n+{\n+  unsigned int i = 6;\n+  unsigned int ret = 0;\n+\n+  do\n+    {\n+      unsigned long long *p64 = (unsigned long long*) p16;\n+      unsigned int *p32 = (unsigned int*) p16;\n+      ret += ret;\n+      if (p16[1] || p32[1])\n+\tret++;\n+      else if (p64[1] | p64[2] | p64[3])\n+\tret++;\n+      p16 += 64;\n+      i--;\n+    } while (i != 0);\n+\n+  return ret;\n+}\n+\n+/* { dg-final { scan-assembler-not \"#22\" } } */\n+/* { dg-final { scan-assembler-not \"#14\" } } */"}, {"sha": "98b60abdcb526c11ac8877b8c8e34340769257b6", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b88fe5e9188827935065546825e686e9486caf0d/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b88fe5e9188827935065546825e686e9486caf0d/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=b88fe5e9188827935065546825e686e9486caf0d", "patch": "@@ -3309,6 +3309,18 @@ get_address_cost (bool symbol_present, bool var_present,\n \t  XEXP (addr, 1) = gen_int_mode (off, address_mode);\n \t  if (memory_address_addr_space_p (mem_mode, addr, as))\n \t    break;\n+\t  /* For some TARGET, like ARM THUMB1, the offset should be nature\n+\t     aligned.  Try an aligned offset if address_mode is not QImode.  */\n+\t  off = (address_mode == QImode)\n+\t\t? 0\n+\t\t: ((unsigned HOST_WIDE_INT) 1 << i)\n+\t\t    - GET_MODE_SIZE (address_mode);\n+\t  if (off > 0)\n+\t    {\n+\t      XEXP (addr, 1) = gen_int_mode (off, address_mode);\n+\t      if (memory_address_addr_space_p (mem_mode, addr, as))\n+\t\tbreak;\n+\t    }\n \t}\n       if (i == -1)\n         off = 0;"}]}