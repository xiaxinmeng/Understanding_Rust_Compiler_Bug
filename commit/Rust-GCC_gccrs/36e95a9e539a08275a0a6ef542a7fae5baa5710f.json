{"sha": "36e95a9e539a08275a0a6ef542a7fae5baa5710f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzZlOTVhOWU1MzlhMDgyNzVhMGE2ZWY1NDJhN2ZhZTViYWE1NzEwZg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-06-10T13:16:23Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-06-10T16:06:41Z"}, "message": "tree-optimization/95576 - fix compare-debug issue with SLP vectorization\n\nThe following avoids leading debug stmts in BB vectorizer regions.\n\n2020-06-10  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/95576\n\t* tree-vect-slp.c (vect_slp_bb): Skip leading debug stmts.\n\n\t* g++.dg/vect/pr95576.cc: New testcase.", "tree": {"sha": "bcfc4f2b6ffc42f962ede37d394e89bb3a1e3e09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bcfc4f2b6ffc42f962ede37d394e89bb3a1e3e09"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36e95a9e539a08275a0a6ef542a7fae5baa5710f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36e95a9e539a08275a0a6ef542a7fae5baa5710f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36e95a9e539a08275a0a6ef542a7fae5baa5710f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36e95a9e539a08275a0a6ef542a7fae5baa5710f/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5cebc9ab7f6ab47067dc04cae17bf9921a62a18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5cebc9ab7f6ab47067dc04cae17bf9921a62a18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5cebc9ab7f6ab47067dc04cae17bf9921a62a18"}], "stats": {"total": 32, "additions": 31, "deletions": 1}, "files": [{"sha": "64e0e2dae7f59cd6629142d1d67f74da3f99ef9c", "filename": "gcc/testsuite/g++.dg/vect/pr95576.cc", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36e95a9e539a08275a0a6ef542a7fae5baa5710f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr95576.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36e95a9e539a08275a0a6ef542a7fae5baa5710f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr95576.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr95576.cc?ref=36e95a9e539a08275a0a6ef542a7fae5baa5710f", "patch": "@@ -0,0 +1,23 @@\n+// { dg-do compile }\n+// { dg-additional-options \"-O3 -fno-tree-forwprop -fcompare-debug\" }\n+\n+struct S {\n+  virtual ~S();\n+  struct S *s;\n+  virtual void m();\n+  int f;\n+  void *d;\n+};\n+\n+struct T : S {\n+  void m();\n+};\n+\n+S::~S() {\n+  if (s) {\n+    s->f = 0;\n+    s->d = __null;\n+  }\n+}\n+\n+void T::m() {}"}, {"sha": "866ce8d37172791d37b5057afa1215df6a1a5336", "filename": "gcc/tree-vect-slp.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36e95a9e539a08275a0a6ef542a7fae5baa5710f/gcc%2Ftree-vect-slp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36e95a9e539a08275a0a6ef542a7fae5baa5710f/gcc%2Ftree-vect-slp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-slp.c?ref=36e95a9e539a08275a0a6ef542a7fae5baa5710f", "patch": "@@ -3316,7 +3316,12 @@ vect_slp_bb (basic_block bb)\n \t{\n \t  gimple *stmt = gsi_stmt (gsi);\n \t  if (is_gimple_debug (stmt))\n-\t    continue;\n+\t    {\n+\t      /* Skip leading debug stmts.  */\n+\t      if (gsi_stmt (region_begin) == stmt)\n+\t\tgsi_next (&region_begin);\n+\t      continue;\n+\t    }\n \t  insns++;\n \n \t  if (gimple_location (stmt) != UNKNOWN_LOCATION)\n@@ -3325,6 +3330,8 @@ vect_slp_bb (basic_block bb)\n \t  if (!vect_find_stmt_data_reference (NULL, stmt, &datarefs))\n \t    break;\n \t}\n+      if (gsi_end_p (region_begin))\n+\tbreak;\n \n       /* Skip leading unhandled stmts.  */\n       if (gsi_stmt (region_begin) == gsi_stmt (gsi))"}]}