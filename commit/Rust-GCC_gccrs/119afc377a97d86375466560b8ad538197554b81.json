{"sha": "119afc377a97d86375466560b8ad538197554b81", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTE5YWZjMzc3YTk3ZDg2Mzc1NDY2NTYwYjhhZDUzODE5NzU1NGI4MQ==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2006-04-04T23:25:09Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2006-04-04T23:25:09Z"}, "message": "re PR classpath/26990 (SecurityManager.checkExit() problem)\n\n\tPR libgcj/26990:\n\t* prims.cc (_Jv_RunMain): Use exitNoChecksAccessor.\n\t* gnu/java/lang/natMainThread.cc (call_main): Use\n\texitNoChecksAccessor.\n\t* testsuite/libjava.lang/pr26990.out: New file.\n\t* testsuite/libjava.lang/pr26990.java: New file.\n\t* java/lang/Runtime.java (exitNoChecks): New method.\n\t(exitNoChecksAccessor): Likewise.\n\t(exit): Call exitNoChecks.\n\nFrom-SVN: r112685", "tree": {"sha": "69263b8da1ad85374698a5321589ea97c4c382ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/69263b8da1ad85374698a5321589ea97c4c382ff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/119afc377a97d86375466560b8ad538197554b81", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/119afc377a97d86375466560b8ad538197554b81", "html_url": "https://github.com/Rust-GCC/gccrs/commit/119afc377a97d86375466560b8ad538197554b81", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/119afc377a97d86375466560b8ad538197554b81/comments", "author": null, "committer": null, "parents": [{"sha": "4b1c1f6fc2f1ed0d5e4315ef6b788bf84755a5ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b1c1f6fc2f1ed0d5e4315ef6b788bf84755a5ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b1c1f6fc2f1ed0d5e4315ef6b788bf84755a5ee"}], "stats": {"total": 45, "additions": 40, "deletions": 5}, "files": [{"sha": "28b41f40ca1e5ca457d543a77a028c1c81e305e8", "filename": "libjava/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/119afc377a97d86375466560b8ad538197554b81/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/119afc377a97d86375466560b8ad538197554b81/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=119afc377a97d86375466560b8ad538197554b81", "patch": "@@ -1,3 +1,15 @@\n+2006-04-04  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR libgcj/26990:\n+\t* prims.cc (_Jv_RunMain): Use exitNoChecksAccessor.\n+\t* gnu/java/lang/natMainThread.cc (call_main): Use\n+\texitNoChecksAccessor.\n+\t* testsuite/libjava.lang/pr26990.out: New file.\n+\t* testsuite/libjava.lang/pr26990.java: New file.\n+\t* java/lang/Runtime.java (exitNoChecks): New method.\n+\t(exitNoChecksAccessor): Likewise.\n+\t(exit): Call exitNoChecks.\n+\n 2006-04-03  Tom Tromey  <tromey@redhat.com>\n \n \t* Makefile.in: Rebuilt."}, {"sha": "99d5f95ffdeb6080f0d3e4906f0a7f450ea38ab0", "filename": "libjava/gnu/java/lang/natMainThread.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/119afc377a97d86375466560b8ad538197554b81/libjava%2Fgnu%2Fjava%2Flang%2FnatMainThread.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/119afc377a97d86375466560b8ad538197554b81/libjava%2Fgnu%2Fjava%2Flang%2FnatMainThread.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Flang%2FnatMainThread.cc?ref=119afc377a97d86375466560b8ad538197554b81", "patch": "@@ -57,6 +57,5 @@ gnu::java::lang::MainThread::call_main (void)\n   _Jv_ThreadWait ();\n \n   int status = (int) ::java::lang::ThreadGroup::had_uncaught_exception;\n-  ::java::lang::Runtime *runtime = ::java::lang::Runtime::getRuntime ();\n-  runtime->exit (status);\n+  ::java::lang::Runtime::exitNoChecksAccessor (status);\n }"}, {"sha": "3466f19f2a00ca5bfc39d93c5d1ff874d9e999f8", "filename": "libjava/java/lang/Runtime.java", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/119afc377a97d86375466560b8ad538197554b81/libjava%2Fjava%2Flang%2FRuntime.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/119afc377a97d86375466560b8ad538197554b81/libjava%2Fjava%2Flang%2FRuntime.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FRuntime.java?ref=119afc377a97d86375466560b8ad538197554b81", "patch": "@@ -146,9 +146,20 @@ public void exit(int status)\n     SecurityManager sm = SecurityManager.current; // Be thread-safe!\n     if (sm != null)\n       sm.checkExit(status);\n+    exitNoChecks(status);\n+  }\n \n+  // Accessor to avoid adding a vtable slot.\n+  static void exitNoChecksAccessor(int status)\n+  {\n+    current.exitNoChecks(status);\n+  }\n+\n+  // Private since we can't add a vtable slot in 4.1.x.\n+  private void exitNoChecks(int status)\n+  {\n     if (runShutdownHooks())\n-      halt(status);\n+      exitInternal(status);\n \n     // Someone else already called runShutdownHooks().\n     // Make sure we are not/no longer in the shutdownHooks set.\n@@ -171,7 +182,7 @@ public void exit(int status)\n     // while finalization for exit is going on and the status is non-zero\n     // we halt immediately.\n     if (status != 0)\n-      halt(status);\n+      exitInternal(status);\n \n     while (true)\n       try"}, {"sha": "5e016c94c7839deb0a22a1847b1586b927bd2e13", "filename": "libjava/prims.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/119afc377a97d86375466560b8ad538197554b81/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/119afc377a97d86375466560b8ad538197554b81/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=119afc377a97d86375466560b8ad538197554b81", "patch": "@@ -1525,7 +1525,7 @@ _Jv_RunMain (JvVMInitArgs *vm_args, jclass klass, const char *name, int argc,\n         (\"Exception during runtime initialization\"));\n       t->printStackTrace();\n       if (runtime)\n-\truntime->exit (1);\n+\tjava::lang::Runtime::exitNoChecksAccessor (1);\n       // In case the runtime creation failed.\n       ::exit (1);\n     }"}, {"sha": "88db93e3e12efafe2e4ccb3082ca154ef65d6be1", "filename": "libjava/testsuite/libjava.lang/pr26990.java", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/119afc377a97d86375466560b8ad538197554b81/libjava%2Ftestsuite%2Flibjava.lang%2Fpr26990.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/119afc377a97d86375466560b8ad538197554b81/libjava%2Ftestsuite%2Flibjava.lang%2Fpr26990.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2Flibjava.lang%2Fpr26990.java?ref=119afc377a97d86375466560b8ad538197554b81", "patch": "@@ -0,0 +1,13 @@\n+public class pr26990\n+{\n+  public static void main (String args[]) throws Exception\n+  {\n+    System.setSecurityManager(new SecurityManager()\n+                              {\n+                                public void checkExit(int status)\n+                                {\n+                                  throw new SecurityException(\"This is a bug\");\n+                                }\n+                              });\n+  }\n+}"}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "libjava/testsuite/libjava.lang/pr26990.out", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/119afc377a97d86375466560b8ad538197554b81/libjava%2Ftestsuite%2Flibjava.lang%2Fpr26990.out", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/119afc377a97d86375466560b8ad538197554b81/libjava%2Ftestsuite%2Flibjava.lang%2Fpr26990.out", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2Flibjava.lang%2Fpr26990.out?ref=119afc377a97d86375466560b8ad538197554b81"}]}