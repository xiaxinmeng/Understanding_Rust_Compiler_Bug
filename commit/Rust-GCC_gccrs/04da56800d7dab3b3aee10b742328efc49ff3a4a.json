{"sha": "04da56800d7dab3b3aee10b742328efc49ff3a4a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDRkYTU2ODAwZDdkYWIzYjNhZWUxMGI3NDIzMjhlZmM0OWZmM2E0YQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2014-01-18T10:12:22Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2014-01-18T10:12:22Z"}, "message": "jump.c (delete_related_insns): Keep (use (insn))s.\n\ngcc/\n\t* jump.c (delete_related_insns): Keep (use (insn))s.\n\t* reorg.c (redundant_insn): Check for barriers too.\n\nFrom-SVN: r206749", "tree": {"sha": "08a94ea963a1b5777d0b73d6d37380df36dd60d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/08a94ea963a1b5777d0b73d6d37380df36dd60d0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04da56800d7dab3b3aee10b742328efc49ff3a4a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04da56800d7dab3b3aee10b742328efc49ff3a4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04da56800d7dab3b3aee10b742328efc49ff3a4a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04da56800d7dab3b3aee10b742328efc49ff3a4a/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1e99bee598858cf783e585f48bda3dfc7702b4c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e99bee598858cf783e585f48bda3dfc7702b4c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e99bee598858cf783e585f48bda3dfc7702b4c9"}], "stats": {"total": 17, "additions": 16, "deletions": 1}, "files": [{"sha": "51d6cc6e8e4c50bdcf8ca65d8b19a22a7172cd06", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04da56800d7dab3b3aee10b742328efc49ff3a4a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04da56800d7dab3b3aee10b742328efc49ff3a4a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=04da56800d7dab3b3aee10b742328efc49ff3a4a", "patch": "@@ -1,3 +1,8 @@\n+2014-01-18  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* jump.c (delete_related_insns): Keep (use (insn))s.\n+\t* reorg.c (redundant_insn): Check for barriers too.\n+\n 2014-01-17  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/i386/i386.c (ix86_split_lea_for_addr): Fix a comment"}, {"sha": "e6dabd05c5c3cf6429cf82804f00eed4a2ed6f72", "filename": "gcc/jump.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04da56800d7dab3b3aee10b742328efc49ff3a4a/gcc%2Fjump.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04da56800d7dab3b3aee10b742328efc49ff3a4a/gcc%2Fjump.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjump.c?ref=04da56800d7dab3b3aee10b742328efc49ff3a4a", "patch": "@@ -1355,6 +1355,13 @@ delete_related_insns (rtx insn)\n \t  /* Keep going past other deleted labels to delete what follows.  */\n \t  else if (code == CODE_LABEL && INSN_DELETED_P (next))\n \t    next = NEXT_INSN (next);\n+\t  /* Keep the (use (insn))s created by dbr_schedule, which needs\n+\t     them in order to track liveness relative to a previous\n+\t     barrier.  */\n+\t  else if (INSN_P (next)\n+\t\t   && GET_CODE (PATTERN (next)) == USE\n+\t\t   && INSN_P (XEXP (PATTERN (next), 0)))\n+\t    next = NEXT_INSN (next);\n \t  else if (code == BARRIER || INSN_P (next))\n \t    /* Note: if this deletes a jump, it can cause more\n \t       deletion of unreachable code, after a different label."}, {"sha": "054304a188a3103b50e135cb8b1268a1977c7529", "filename": "gcc/reorg.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04da56800d7dab3b3aee10b742328efc49ff3a4a/gcc%2Freorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04da56800d7dab3b3aee10b742328efc49ff3a4a/gcc%2Freorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freorg.c?ref=04da56800d7dab3b3aee10b742328efc49ff3a4a", "patch": "@@ -1512,7 +1512,10 @@ redundant_insn (rtx insn, rtx target, rtx delay_list)\n        trial && insns_to_search > 0;\n        trial = PREV_INSN (trial))\n     {\n-      if (LABEL_P (trial))\n+      /* (use (insn))s can come immediately after a barrier if the\n+\t label that used to precede them has been deleted as dead.\n+\t See delete_related_insns.  */\n+      if (LABEL_P (trial) || BARRIER_P (trial))\n \treturn 0;\n \n       if (!INSN_P (trial))"}]}