{"sha": "a05bea767716117ac703c1adfcdf660906183b65", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA1YmVhNzY3NzE2MTE3YWM3MDNjMWFkZmNkZjY2MDkwNjE4M2I2NQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard@codesourcery.com", "date": "2007-07-23T12:49:45Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2007-07-23T12:49:45Z"}, "message": "mips.c (override_options): Use mips_costs to derive the default branch cost.\n\ngcc/\n\t* config/mips/mips.c (override_options): Use mips_costs to derive\n\tthe default branch cost.\n\t* config/mips/mips.h (BRANCH_COST): Use mips_branch_cost rather\n\tthan mips_costs.\n\t* config/mips/mips.opt (mbranch-cost=): New option.\n\t* doc/invoke.texi (-mbrach-cost): Document new MIPS option.\n\ngcc/testsuite/\n\t* gcc.target/mips/branch-cost-1.c: New test.\n\t* gcc.target/mips/branch-cost-2.c: Likewise.\n\nFrom-SVN: r126846", "tree": {"sha": "261fdc61422012cf1e8354c83eca63bf14ce9391", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/261fdc61422012cf1e8354c83eca63bf14ce9391"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a05bea767716117ac703c1adfcdf660906183b65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a05bea767716117ac703c1adfcdf660906183b65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a05bea767716117ac703c1adfcdf660906183b65", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a05bea767716117ac703c1adfcdf660906183b65/comments", "author": null, "committer": null, "parents": [{"sha": "fae4095f015e9cf79b4b2bd2a243cf825ca624e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fae4095f015e9cf79b4b2bd2a243cf825ca624e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fae4095f015e9cf79b4b2bd2a243cf825ca624e0"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "ad37fca1c92530c530246fd474eada9c4b6b7075", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -1,3 +1,12 @@\n+2007-07-23  Richard Sandiford  <richard@codesourcery.com>\n+\n+\t* config/mips/mips.c (override_options): Use mips_costs to derive\n+\tthe default branch cost.\n+\t* config/mips/mips.h (BRANCH_COST): Use mips_branch_cost rather\n+\tthan mips_costs.\n+\t* config/mips/mips.opt (mbranch-cost=): New option.\n+\t* doc/invoke.texi (-mbrach-cost): Document new MIPS option.\n+\n 2007-07-23  Richard Sandiford  <richard@codesourcery.com>\n \n \t* config/mips/mips.h (GR_REG_CLASS_P, COP_REG_CLASS_P): Delete."}, {"sha": "f42fe77eaf19cb2e17a166bcc4b4ac9f408cf2c4", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -5047,6 +5047,11 @@ override_options (void)\n   else\n     mips_cost = &mips_rtx_cost_data[mips_tune];\n \n+  /* If the user hasn't specified a branch cost, use the processor's\n+     default.  */\n+  if (mips_branch_cost == 0)\n+    mips_branch_cost = mips_cost->branch_cost;\n+\n   if ((target_flags_explicit & MASK_64BIT) != 0)\n     {\n       /* The user specified the size of the integer registers.  Make sure"}, {"sha": "2496986c881216ea2927596d98458a12c2024cbd", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -2326,7 +2326,7 @@ typedef struct mips_args {\n /* A C expression for the cost of a branch instruction.  A value of\n    1 is the default; other values are interpreted relative to that.  */\n \n-#define BRANCH_COST mips_cost->branch_cost\n+#define BRANCH_COST mips_branch_cost\n #define LOGICAL_OP_NON_SHORT_CIRCUIT 0\n \n /* If defined, modifies the length assigned to instruction INSN as a"}, {"sha": "7e6dd37c7259c4b02813810eb3a115dbeef84a0f", "filename": "gcc/config/mips/mips.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fconfig%2Fmips%2Fmips.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fconfig%2Fmips%2Fmips.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.opt?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -35,6 +35,10 @@ march=\n Target RejectNegative Joined Var(mips_arch_string)\n -march=ISA\tGenerate code for the given ISA\n \n+mbranch-cost=\n+Target RejectNegative Joined UInteger Var(mips_branch_cost)\n+-mbranch-cost=COST\tSet the cost of branches to roughly COST instructions\n+\n mbranch-likely\n Target Report Mask(BRANCHLIKELY)\n Use Branch Likely instructions, overriding the architecture default"}, {"sha": "116513ea031eeb8c91aa666b88ff62f390d0346c", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -638,7 +638,7 @@ Objective-C and Objective-C++ Dialects}.\n -mfix-vr4120  -mno-fix-vr4120  -mfix-vr4130  -mno-fix-vr4130 @gol\n -mfix-sb1  -mno-fix-sb1 @gol\n -mflush-func=@var{func}  -mno-flush-func @gol\n--mbranch-likely  -mno-branch-likely @gol\n+-mbranch-cost=@var{num}  -mbranch-likely  -mno-branch-likely @gol\n -mfp-exceptions -mno-fp-exceptions @gol\n -mvr4130-align -mno-vr4130-align}\n \n@@ -11915,6 +11915,13 @@ memory range, and the number 3 (to flush both caches).  The default\n depends on the target GCC was configured for, but commonly is either\n @samp{_flush_func} or @samp{__cpu_flush}.\n \n+@item mbranch-cost=@var{num}\n+@opindex mbranch-cost\n+Set the cost of branches to roughly @var{num} ``simple'' instructions.\n+This cost is only a heuristic and is not guaranteed to produce\n+consistent results across releases.  A zero cost redundantly selects\n+the default, which is based on the @option{-mtune} setting.\n+\n @item -mbranch-likely\n @itemx -mno-branch-likely\n @opindex mbranch-likely"}, {"sha": "bc46a5d4091f9c78dd0d43e5065b41422b52c171", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -1,3 +1,8 @@\n+2007-07-23  Richard Sandiford  <richard@codesourcery.com>\n+\n+\t* gcc.target/mips/branch-cost-1.c: New test.\n+\t* gcc.target/mips/branch-cost-2.c: Likewise.\n+\n 2007-07-23  Christopher D. Rickett  <crickett@lanl.gov>\n \n \tPR fortran/32732"}, {"sha": "3b2c80d990ae14b7566da8234b8b7b043f612947", "filename": "gcc/testsuite/gcc.target/mips/branch-cost-1.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fbranch-cost-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fbranch-cost-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fbranch-cost-1.c?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -0,0 +1,8 @@\n+/* { dg-mips-options \"-mbranch-cost=1 -mips64 -O2\" } */\n+int\n+foo (int x, int y, int z, int k)\n+{\n+  return x == k ? x + y : z - x;\n+}\n+/* { dg-final { scan-assembler-not \"\\t(movz|movn)\\t\" } } */\n+/* { dg-final { scan-assembler \"\\t(bne|beq)\\t\" } } */"}, {"sha": "356def21ebee5fa71a859de3fd7686e3edc6991e", "filename": "gcc/testsuite/gcc.target/mips/branch-cost-2.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fbranch-cost-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a05bea767716117ac703c1adfcdf660906183b65/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fbranch-cost-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fbranch-cost-2.c?ref=a05bea767716117ac703c1adfcdf660906183b65", "patch": "@@ -0,0 +1,8 @@\n+/* { dg-mips-options \"-mbranch-cost=10 -mips64 -O2\" } */\n+int\n+foo (int x, int y, int z, int k)\n+{\n+  return x == k ? x + y : z - x;\n+}\n+/* { dg-final { scan-assembler \"\\t(movz|movn)\\t\" } } */\n+/* { dg-final { scan-assembler-not \"\\t(bne|beq)\\t\" } } */"}]}