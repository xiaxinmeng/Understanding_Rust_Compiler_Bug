{"sha": "67e28ef818ad694185e3738dad037864d2c51240", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjdlMjhlZjgxOGFkNjk0MTg1ZTM3MzhkYWQwMzc4NjRkMmM1MTI0MA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2011-08-01T08:59:50Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-01T08:59:50Z"}, "message": "sem_attr.adb (Analyze_Attribute, [...]): Handle properly a quantified expression that appears within a postcondition and...\n\n2011-08-01  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_attr.adb (Analyze_Attribute, case 'Result): Handle properly a\n\tquantified expression that appears within a postcondition and uses the\n\tAda2012 'Result attribute.\n\nFrom-SVN: r177001", "tree": {"sha": "c97b4b0bfb9c203a519611dae003a263130a3d97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c97b4b0bfb9c203a519611dae003a263130a3d97"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/67e28ef818ad694185e3738dad037864d2c51240", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67e28ef818ad694185e3738dad037864d2c51240", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67e28ef818ad694185e3738dad037864d2c51240", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67e28ef818ad694185e3738dad037864d2c51240/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "57044b5af1c270378dd02087bb48c48cd6786d6e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57044b5af1c270378dd02087bb48c48cd6786d6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57044b5af1c270378dd02087bb48c48cd6786d6e"}], "stats": {"total": 33, "additions": 26, "deletions": 7}, "files": [{"sha": "46032fdff3bfa4dfdc1e738a7c68b085c48b6024", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67e28ef818ad694185e3738dad037864d2c51240/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67e28ef818ad694185e3738dad037864d2c51240/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=67e28ef818ad694185e3738dad037864d2c51240", "patch": "@@ -1,3 +1,9 @@\n+2011-08-01  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_attr.adb (Analyze_Attribute, case 'Result): Handle properly a\n+\tquantified expression that appears within a postcondition and uses the\n+\tAda2012 'Result attribute.\n+\n 2011-07-28  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* init.c (__gnat_error_handler): Cast reason to int."}, {"sha": "734c1a723c69a14d2e78c4b1868efd264df9c657", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67e28ef818ad694185e3738dad037864d2c51240/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67e28ef818ad694185e3738dad037864d2c51240/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=67e28ef818ad694185e3738dad037864d2c51240", "patch": "@@ -3947,14 +3947,29 @@ package body Sem_Attr is\n       ------------\n \n       when Attribute_Result => Result : declare\n-         CS : Entity_Id := Current_Scope;\n-         PS : Entity_Id := Scope (CS);\n+         CS : Entity_Id;\n+         --  The enclosing scope, excluding loops for quantified expressions\n+\n+         PS : Entity_Id;\n+         --  During analysis, CS is the postcondition subprogram and PS the\n+         --  source subprogram to which the postcondition applies. During\n+         --  pre-analysis, CS is the scope of the subprogram declaration.\n \n       begin\n+         --  Find enclosing scopes, excluding loops\n+\n+         CS := Current_Scope;\n+         while Ekind (CS) = E_Loop loop\n+            CS := Scope (CS);\n+         end loop;\n+\n+         PS := Scope (CS);\n+\n          --  If the enclosing subprogram is always inlined, the enclosing\n          --  postcondition will not be propagated to the expanded call.\n \n-         if Has_Pragma_Inline_Always (PS)\n+         if not In_Spec_Expression\n+           and then Has_Pragma_Inline_Always (PS)\n            and then Warn_On_Redundant_Constructs\n          then\n             Error_Msg_N\n@@ -3994,9 +4009,7 @@ package body Sem_Attr is\n          --  current one.\n \n          else\n-            while Present (CS)\n-              and then CS /= Standard_Standard\n-            loop\n+            while Present (CS) and then CS /= Standard_Standard loop\n                if Chars (CS) = Name_uPostconditions then\n                   exit;\n                else\n@@ -4038,7 +4051,7 @@ package body Sem_Attr is\n             else\n                Error_Attr\n                  (\"% attribute can only appear\" &\n-                   \"  in function Postcondition pragma\", P);\n+                   \" in function Postcondition pragma\", P);\n             end if;\n          end if;\n       end Result;"}]}