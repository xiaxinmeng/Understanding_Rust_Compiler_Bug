{"sha": "a6b15ad077bc9de883b11f6f89ed6133427a88a2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTZiMTVhZDA3N2JjOWRlODgzYjExZjZmODllZDYxMzM0MjdhODhhMg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2008-12-07T13:04:57Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2008-12-07T13:04:57Z"}, "message": "tree-sra.c (scalarize_use): Create another temporary with the proper type for signed types in the use_all...\n\n\t* tree-sra.c (scalarize_use): Create another temporary with the proper\n\ttype for signed types in the use_all && !is_output bitfield case.\n\nFrom-SVN: r142537", "tree": {"sha": "baa288c19c0e443a3ffeb3e972ffaeb77f2af4e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/baa288c19c0e443a3ffeb3e972ffaeb77f2af4e4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6b15ad077bc9de883b11f6f89ed6133427a88a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6b15ad077bc9de883b11f6f89ed6133427a88a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6b15ad077bc9de883b11f6f89ed6133427a88a2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6b15ad077bc9de883b11f6f89ed6133427a88a2/comments", "author": null, "committer": null, "parents": [{"sha": "0717bfbd1778001f3f15370e9d7fdef4f749f88f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0717bfbd1778001f3f15370e9d7fdef4f749f88f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0717bfbd1778001f3f15370e9d7fdef4f749f88f"}], "stats": {"total": 71, "additions": 65, "deletions": 6}, "files": [{"sha": "85cd145d8e4a0128567b01be4185b21c08c12614", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a6b15ad077bc9de883b11f6f89ed6133427a88a2", "patch": "@@ -1,3 +1,8 @@\n+2008-12-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* tree-sra.c (scalarize_use): Create another temporary with the proper\n+\ttype for signed types in the use_all && !is_output bitfield case.\n+\n 2008-12-06  Steven Bosscher  <steven@gcc.gnu.org>\n \n \tPR rtl-optimization/36365"}, {"sha": "d7b0da024e17286d47fbaf15c7f7aeeb70708928", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a6b15ad077bc9de883b11f6f89ed6133427a88a2", "patch": "@@ -1,3 +1,8 @@\n+2008-12-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/aggr10.adb: New test.\n+\t* gnat.dg/aggr10_pkg.ads: New helper.\n+\n 2008-12-06  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/38425"}, {"sha": "6fbb8ed5d7a7f3a7b9db6528fb95ed0a894a80bb", "filename": "gcc/testsuite/gnat.dg/aggr10.adb", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftestsuite%2Fgnat.dg%2Faggr10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftestsuite%2Fgnat.dg%2Faggr10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Faggr10.adb?ref=a6b15ad077bc9de883b11f6f89ed6133427a88a2", "patch": "@@ -0,0 +1,23 @@\n+-- { dg-do compile }\n+-- { dg-options \"-O2\" }\n+\n+with Aggr10_Pkg; use Aggr10_Pkg;\n+\n+procedure Aggr10 is\n+\n+   No_Name_Location : constant Name_Location :=\n+                        (Name     => Name_Id'First,\n+                         Location => Int'First,\n+                         Source   => Source_Id'First,\n+                         Except   => False,\n+                         Found    => False);\n+\n+   Name_Loc : Name_Location;\n+\n+begin\n+   Name_Loc := Get;\n+   if Name_Loc = No_Name_Location then  -- { dg-bogus \"comparison always false\" }\n+      raise Program_Error;\n+   end if;\n+   Set (Name_Loc);\n+end;"}, {"sha": "92400f990e09e8015f0a66f228b25b87dae88b13", "filename": "gcc/testsuite/gnat.dg/aggr10_pkg.ads", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftestsuite%2Fgnat.dg%2Faggr10_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftestsuite%2Fgnat.dg%2Faggr10_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Faggr10_pkg.ads?ref=a6b15ad077bc9de883b11f6f89ed6133427a88a2", "patch": "@@ -0,0 +1,18 @@\n+package Aggr10_Pkg is\n+\n+   type Name_Id is range 300_000_000 .. 399_999_999;\n+   type Int is range -2 ** 31 .. +2 ** 31 - 1;\n+   type Source_Id is range 5_000_000 .. 5_999_999;\n+\n+   type Name_Location is record\n+      Name     : Name_Id;\n+      Location : Int;\n+      Source   : Source_Id;\n+      Except   : Boolean;\n+      Found    : Boolean := False;\n+   end record;\n+\n+   function Get return Name_Location;\n+   procedure Set (Name_Loc : Name_Location);\n+\n+end Aggr10_Pkg;"}, {"sha": "aa161936410203ad8caa10f060f2ed1a97476d0d", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6b15ad077bc9de883b11f6f89ed6133427a88a2/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=a6b15ad077bc9de883b11f6f89ed6133427a88a2", "patch": "@@ -3223,12 +3223,20 @@ scalarize_use (struct sra_elt *elt, tree *expr_p, gimple_stmt_iterator *gsi,\n       if (!elt->use_block_copy)\n \t{\n \t  tree type = TREE_TYPE (bfexpr);\n-\t  tree var, vpos;\n+\t  tree var = make_rename_temp (type, \"SR\"), tmp, vpos;\n+\t  gimple st = NULL;\n \n-\t  if (!TYPE_UNSIGNED (type))\n-\t    type = unsigned_type_for (type);\n+\t  gimple_assign_set_rhs1 (stmt, var);\n+\t  update = true;\n \n-\t  var = make_rename_temp (type, \"SR\");\n+\t  if (!TYPE_UNSIGNED (type))\n+\t    {\n+\t      type = unsigned_type_for (type);\n+\t      tmp = make_rename_temp (type, \"SR\");\n+\t      st = gimple_build_assign (var,\n+\t\t\t\t\tfold_convert (TREE_TYPE (var), tmp));\n+\t      var = tmp;\n+\t    }\n \n \t  gimple_seq_add_stmt (&seq,\n                                gimple_build_assign\n@@ -3245,8 +3253,8 @@ scalarize_use (struct sra_elt *elt, tree *expr_p, gimple_stmt_iterator *gsi,\n \t  sra_explode_bitfield_assignment\n \t    (var, vpos, true, &seq, blen, bpos, elt);\n \n-\t  gimple_assign_set_rhs1 (stmt, var);\n-\t  update = true;\n+\t  if (st)\n+\t    gimple_seq_add_stmt (&seq, st);\n \t}\n       else\n \tsra_sync_for_bitfield_assignment"}]}