{"sha": "a84162511d4712374a9ae76edae32a5068fcfc0d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTg0MTYyNTExZDQ3MTIzNzRhOWFlNzZlZGFlMzJhNTA2OGZjZmMwZA==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-10T18:05:37Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-12-10T18:05:37Z"}, "message": "re PR fortran/88269 (ICE in gfc_format_decoder, at fortran/error.c:947)\n\n2018-12-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88269\n\t* io.c (io_constraint): Update macro. If locus line buffer is NULL,\n\tuse gfc_current_locus in error messages.\n\t(check_io_constraints): Catch missing IO UNIT in write and read\n\tstatements.  io_constraint macro is incompatible here.\n\n2018-12-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/88269\n\t* gfortran.dg/pr88269.f90: New test.\n\nFrom-SVN: r266959", "tree": {"sha": "034a8398ee5599c374c104325d351c6f3459eb58", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/034a8398ee5599c374c104325d351c6f3459eb58"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a84162511d4712374a9ae76edae32a5068fcfc0d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a84162511d4712374a9ae76edae32a5068fcfc0d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a84162511d4712374a9ae76edae32a5068fcfc0d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a84162511d4712374a9ae76edae32a5068fcfc0d/comments", "author": null, "committer": null, "parents": [{"sha": "98900a06642a7c10751720a26f8cbca359d89fa3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98900a06642a7c10751720a26f8cbca359d89fa3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98900a06642a7c10751720a26f8cbca359d89fa3"}], "stats": {"total": 35, "additions": 30, "deletions": 5}, "files": [{"sha": "bbb8ce18d0e836144b4e78f561cc4fa052f36d15", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a84162511d4712374a9ae76edae32a5068fcfc0d", "patch": "@@ -1,3 +1,11 @@\n+2018-12-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88269\n+\t* io.c (io_constraint): Update macro. If locus line buffer is NULL,\n+\tuse gfc_current_locus in error messages.\n+\t(check_io_constraints): Catch missing IO UNIT in write and read\n+\tstatements.  io_constraint macro is incompatible here.\n+\n 2018-12-09  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/88205"}, {"sha": "8d5410721ef3fea3ddbaa6204e2763185a031a56", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=a84162511d4712374a9ae76edae32a5068fcfc0d", "patch": "@@ -3678,10 +3678,13 @@ static match\n check_io_constraints (io_kind k, gfc_dt *dt, gfc_code *io_code,\n \t\t      locus *spec_end)\n {\n-#define io_constraint(condition,msg,arg)\\\n+#define io_constraint(condition, msg, arg)\\\n if (condition) \\\n   {\\\n-    gfc_error(msg,arg);\\\n+    if ((arg)->lb != NULL)\\\n+      gfc_error ((msg), (arg));\\\n+    else\\\n+      gfc_error ((msg), &gfc_current_locus);\\\n     m = MATCH_ERROR;\\\n   }\n \n@@ -3741,11 +3744,14 @@ if (condition) \\\n   if (expr && expr->ts.type != BT_CHARACTER)\n     {\n \n-      io_constraint (gfc_pure (NULL) && (k == M_READ || k == M_WRITE),\n-\t\t     \"IO UNIT in %s statement at %C must be \"\n+      if (gfc_pure (NULL) && (k == M_READ || k == M_WRITE))\n+\t{\n+\t  gfc_error (\"IO UNIT in %s statement at %C must be \"\n \t\t     \"an internal file in a PURE procedure\",\n \t\t     io_kind_name (k));\n-\n+\t  return MATCH_ERROR;\n+\t}\n+\t  \n       if (k == M_READ || k == M_WRITE)\n \tgfc_unset_implicit_pure (NULL);\n     }"}, {"sha": "35b4fe14c2ecc3d92888e9dcfc421e4b49146496", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a84162511d4712374a9ae76edae32a5068fcfc0d", "patch": "@@ -1,3 +1,8 @@\n+2018-12-10  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/88269\n+\t* gfortran.dg/pr88269.f90: New test.\n+\n 2018-12-10  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/88418"}, {"sha": "6cda5f7a339f92da779d0dc0ff80c25dc0e5896e", "filename": "gcc/testsuite/gfortran.dg/pr88269.f90", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88269.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a84162511d4712374a9ae76edae32a5068fcfc0d/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88269.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88269.f90?ref=a84162511d4712374a9ae76edae32a5068fcfc0d", "patch": "@@ -0,0 +1,6 @@\n+! { dg-do compile }\n+! PR fortran/88269\n+program p\n+   write (end=1e1) ! { dg-error \"tag not allowed\" }\n+end\n+"}]}