{"sha": "2e69f143e34f5c82caf1072f5a34784237b9f0a2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmU2OWYxNDNlMzRmNWM4MmNhZjEwNzJmNWEzNDc4NDIzN2I5ZjBhMg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-10-05T19:04:39Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-10-05T19:04:39Z"}, "message": "re PR sanitizer/66343 (\"Error: .Lubsan_type3 already defined\" with UBSan and precompiled headers)\n\n\tPR sanitizer/66343\n\t* ubsan.c (ubsan_create_data): Call initialize_sanitizer_builtins here.\n\t(ubsan_instrument_float_cast): And not here.\n\n\t* c-ubsan.c (ubsan_instrument_return): Don't call\n\tinitialize_sanitizer_builtins here.\n\n\t* gcc.dg/pch/pr66343-3.c: New test.\n\t* gcc.dg/pch/pr66343-3.hs: New file.\n\nFrom-SVN: r240804", "tree": {"sha": "95ac17961ff15889a5a6b03662531a2b2ece6b74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95ac17961ff15889a5a6b03662531a2b2ece6b74"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e69f143e34f5c82caf1072f5a34784237b9f0a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e69f143e34f5c82caf1072f5a34784237b9f0a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e69f143e34f5c82caf1072f5a34784237b9f0a2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e69f143e34f5c82caf1072f5a34784237b9f0a2/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "875825211ba723311fa12b2c8aaa7c808bfa972f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/875825211ba723311fa12b2c8aaa7c808bfa972f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/875825211ba723311fa12b2c8aaa7c808bfa972f"}], "stats": {"total": 41, "additions": 37, "deletions": 4}, "files": [{"sha": "9be5e48c5673b478d638af72f55164fe23ab9f15", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -1,5 +1,9 @@\n 2016-10-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR sanitizer/66343\n+\t* ubsan.c (ubsan_create_data): Call initialize_sanitizer_builtins here.\n+\t(ubsan_instrument_float_cast): And not here.\n+\n \tPR sanitizer/66343\n \t* ubsan.c (ubsan_ids): New GTY(()) array.\n \t(ubsan_type_descriptor, ubsan_create_data): Use ubsan_ids"}, {"sha": "6474a6dd6f64ec97240f511de722975aa2d18818", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -1,3 +1,9 @@\n+2016-10-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/66343\n+\t* c-ubsan.c (ubsan_instrument_return): Don't call\n+\tinitialize_sanitizer_builtins here.\n+\n 2016-10-05  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* c-common.c (c_common_truthvalue_conversion): Warn also for suspicious"}, {"sha": "482cce19f3c387a0ca0430a5acb4049963503f70", "filename": "gcc/c-family/c-ubsan.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Fc-family%2Fc-ubsan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Fc-family%2Fc-ubsan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-ubsan.c?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -235,9 +235,6 @@ ubsan_instrument_return (location_t loc)\n {\n   if (flag_sanitize_undefined_trap_on_error)\n     return build_call_expr_loc (loc, builtin_decl_explicit (BUILT_IN_TRAP), 0);\n-  /* It is possible that PCH zapped table with definitions of sanitizer\n-     builtins.  Reinitialize them if needed.  */\n-  initialize_sanitizer_builtins ();\n \n   tree data = ubsan_create_data (\"__ubsan_missing_return_data\", 1, &loc,\n \t\t\t\t NULL_TREE, NULL_TREE);"}, {"sha": "8a7e21e98d5eca1837225ca010e10e5ddd19de09", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -1,5 +1,9 @@\n 2016-10-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR sanitizer/66343\n+\t* gcc.dg/pch/pr66343-3.c: New test.\n+\t* gcc.dg/pch/pr66343-3.hs: New file.\n+\n \tPR sanitizer/66343\n \t* gcc.dg/pch/pr66343-1.c: New test.\n \t* gcc.dg/pch/pr66343-1.hs: New file."}, {"sha": "67186e2e77fabc55dfb02e90d67af31877a29688", "filename": "gcc/testsuite/gcc.dg/pch/pr66343-3.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Ftestsuite%2Fgcc.dg%2Fpch%2Fpr66343-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Ftestsuite%2Fgcc.dg%2Fpch%2Fpr66343-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpch%2Fpr66343-3.c?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -0,0 +1,15 @@\n+/* PR sanitizer/66343 */\n+/* { dg-do assemble } */\n+/* { dg-options \"-fsanitize=undefined\" } */\n+\n+#include \"pr66343-3.h\"\n+\n+void\n+bar (int a, int b)\n+{\n+  a / b;\n+}\n+\n+/* Hack to turn off PCH assembly comparison, as it is incompatible\n+   with dg-do assemble.  The target condition will be always false.  */\n+/* { dg-error \"\" \"\" { target { lp64 && { ! lp64 } } } } */"}, {"sha": "2f86a02ec76ceaeacc04eec68bea43f4dd54c853", "filename": "gcc/testsuite/gcc.dg/pch/pr66343-3.hs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Ftestsuite%2Fgcc.dg%2Fpch%2Fpr66343-3.hs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Ftestsuite%2Fgcc.dg%2Fpch%2Fpr66343-3.hs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpch%2Fpr66343-3.hs?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -0,0 +1,4 @@\n+/* PR sanitizer/66343 */\n+/* { dg-options \"-fno-sanitize=undefined\" } */\n+\n+/* Empty.  */"}, {"sha": "8818de4f372e1d61e1c1f73b6fb7a3c9d47ea9b2", "filename": "gcc/ubsan.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Fubsan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e69f143e34f5c82caf1072f5a34784237b9f0a2/gcc%2Fubsan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fubsan.c?ref=2e69f143e34f5c82caf1072f5a34784237b9f0a2", "patch": "@@ -511,6 +511,10 @@ ubsan_create_data (const char *name, int loccnt, const location_t *ploc, ...)\n   size_t i = 0;\n   int j;\n \n+  /* It is possible that PCH zapped table with definitions of sanitizer\n+     builtins.  Reinitialize them if needed.  */\n+  initialize_sanitizer_builtins ();\n+\n   /* Firstly, create a pointer to type descriptor type.  */\n   tree td_type = ubsan_get_type_descriptor_type ();\n   td_type = build_pointer_type (td_type);\n@@ -1589,7 +1593,6 @@ ubsan_instrument_float_cast (location_t loc, tree type, tree expr)\n     {\n       location_t *loc_ptr = NULL;\n       unsigned num_locations = 0;\n-      initialize_sanitizer_builtins ();\n       /* Figure out if we can propagate location to ubsan_data and use new\n          style handlers in libubsan.  */\n       if (ubsan_use_new_style_p (loc))"}]}