{"sha": "f8dc0f2bf410d4fc5136c60cb3590c88d5db0995", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjhkYzBmMmJmNDEwZDRmYzUxMzZjNjBjYjM1OTBjODhkNWRiMDk5NQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2018-06-27T18:32:48Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2018-06-27T18:32:48Z"}, "message": "v850.md (addsi3_set_flags): New pattern.\n\n\t* config/v850/v850.md (addsi3_set_flags): New pattern.\n\t(subsi3_set_flags, negsi2_set_flags, andsi3_set_flags): Likewise.\n\t(iorsi3_set_flags, xorsi3_set_flags, one_cmplsi2_set_flags): Likewise.\n\t(zero_extendhisi2_v850_set_flags): Likewise.\n\t(zero_extendqisi2_v850_set_flags): Likewise.\n\t(ashlsi3_set_flags, ashlsi3_v850e2_set_flags): Likewise.\n\t(lshrsi3_set_flags, lshrsi3_v850e2_set_flags): Likewise.\n\t(ashrsi3_set_flags, ashrsi3_v850e2_set_flags): Likewise.\n\nCo-Authored-By: Austin Law <austinklaw@gmail.com>\n\nFrom-SVN: r262192", "tree": {"sha": "cb0312445d0007975b5aa04237c05f74d104e88b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb0312445d0007975b5aa04237c05f74d104e88b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995/comments", "author": null, "committer": null, "parents": [{"sha": "1ec0eb08cebf52b464c2f1da505b41858cde8bcf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ec0eb08cebf52b464c2f1da505b41858cde8bcf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ec0eb08cebf52b464c2f1da505b41858cde8bcf"}], "stats": {"total": 190, "additions": 190, "deletions": 0}, "files": [{"sha": "c435a3b29a7ddfdc80a91a98c372d1abd1cc567c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f8dc0f2bf410d4fc5136c60cb3590c88d5db0995", "patch": "@@ -1,6 +1,15 @@\n 2018-06-27  Jeff Law  <law@redhat.com>\n \t    Austin Law  <austinklaw@gmail.com>\n \n+\t* config/v850/v850.md (addsi3_set_flags): New pattern.\n+\t(subsi3_set_flags, negsi2_set_flags, andsi3_set_flags): Likewise.\n+\t(iorsi3_set_flags, xorsi3_set_flags, one_cmplsi2_set_flags): Likewise.\n+\t(zero_extendhisi2_v850_set_flags): Likewise.\n+\t(zero_extendqisi2_v850_set_flags): Likewise.\n+\t(ashlsi3_set_flags, ashlsi3_v850e2_set_flags): Likewise.\n+\t(lshrsi3_set_flags, lshrsi3_v850e2_set_flags): Likewise.\n+\t(ashrsi3_set_flags, ashrsi3_v850e2_set_flags): Likewise.\n+\n \t* config/v850/v850-protos.h (notice_update_cc): Remove.\n \t* config/v850/v850.c (v850_compare_op0, v850_compare_op1): Remove.\n \t(v850_print_operand): Handle 'D' and \"d\"."}, {"sha": "b8f098b936328dddbb83ab0f387f322e94112f40", "filename": "gcc/config/v850/v850.md", "status": "modified", "additions": 181, "deletions": 0, "changes": 181, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995/gcc%2Fconfig%2Fv850%2Fv850.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8dc0f2bf410d4fc5136c60cb3590c88d5db0995/gcc%2Fconfig%2Fv850%2Fv850.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fv850%2Fv850.md?ref=f8dc0f2bf410d4fc5136c60cb3590c88d5db0995", "patch": "@@ -569,6 +569,20 @@\n    addi %O2(%P2),%1,%0\"\n   [(set_attr \"length\" \"2,4,4\")])\n \n+(define_insn \"addsi3_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (plus:SI (match_operand:SI 1 \"register_operand\" \"%0,r,r\")\n+\t\t\t       (match_operand:SI 2 \"nonmemory_operand\" \"rJ,K,U\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r,r\")\n+\t(plus:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+   add %2,%0\n+   addi %2,%1,%0\n+   addi %O2(%P2),%1,%0\"\n+  [(set_attr \"length\" \"2,4,4\")])\n+\n ;; ----------------------------------------------------------------------\n ;; SUBTRACT INSTRUCTIONS\n ;; ----------------------------------------------------------------------\n@@ -593,6 +607,19 @@\n   subr %1,%0\"\n   [(set_attr \"length\" \"2,2\")])\n \n+(define_insn \"*subsi3_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (minus:SI (match_operand:SI 1 \"register_operand\" \"0,r\")\n+\t\t\t        (match_operand:SI 2 \"nonmemory_operand\" \"r,0\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n+\t(minus:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  sub %2,%0\n+  subr %1,%0\"\n+  [(set_attr \"length\" \"2,2\")])\n+\n (define_insn_and_split \"negsi2\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t(neg:SI (match_operand:SI 1 \"register_operand\" \"0\")))]\n@@ -610,6 +637,16 @@\n   \"subr %.,%0\"\n   [(set_attr \"length\" \"2\")])\n \n+(define_insn \"*negsi2_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (neg:SI (match_operand:SI 1 \"register_operand\" \"0\"))\n+\t\t      (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+\t(neg:SI (match_dup 1)))]\n+  \"reload_completed\"\n+  \"subr %.,%0\"\n+  [(set_attr \"length\" \"2\")])\n+\n ;; ----------------------------------------------------------------------\n ;; MULTIPLY INSTRUCTIONS\n ;; ----------------------------------------------------------------------\n@@ -831,6 +868,20 @@\n   andi %2,%1,%0\"\n   [(set_attr \"length\" \"2,2,4\")])\n \n+(define_insn \"andsi3_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (and:SI (match_operand:SI 1 \"register_operand\" \"%0,0,r\")\n+\t\t\t    (match_operand:SI 2 \"nonmemory_operand\" \"r,I,M\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r,r\")\n+\t(and:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  and %2,%0\n+  and %.,%0\n+  andi %2,%1,%0\"\n+  [(set_attr \"length\" \"2,2,4\")])\n+\n ;; ----------------------------------------------------------------------\n ;; OR INSTRUCTIONS\n ;; ----------------------------------------------------------------------\n@@ -916,6 +967,20 @@\n   ori %2,%1,%0\"\n   [(set_attr \"length\" \"2,2,4\")])\n \n+(define_insn \"*iorsi3_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (ior:SI (match_operand:SI 1 \"register_operand\" \"%0,0,r\")\n+\t\t\t    (match_operand:SI 2 \"nonmemory_operand\" \"r,I,M\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r,r\")\n+\t(ior:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  or %2,%0\n+  or %.,%0\n+  ori %2,%1,%0\"\n+  [(set_attr \"length\" \"2,2,4\")])\n+\n ;; ----------------------------------------------------------------------\n ;; XOR INSTRUCTIONS\n ;; ----------------------------------------------------------------------\n@@ -1001,6 +1066,20 @@\n   xori %2,%1,%0\"\n   [(set_attr \"length\" \"2,2,4\")])\n \n+(define_insn \"*xorsi3_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (xor:SI (match_operand:SI 1 \"register_operand\" \"%0,0,r\")\n+\t\t\t    (match_operand:SI 2 \"nonmemory_operand\" \"r,I,M\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r,r\")\n+\t(xor:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  xor %2,%0\n+  xor %.,%0\n+  xori %2,%1,%0\"\n+  [(set_attr \"length\" \"2,2,4\")])\n+\n \f\n ;; ----------------------------------------------------------------------\n ;; NOT INSTRUCTIONS\n@@ -1024,6 +1103,16 @@\n   \"not %1,%0\"\n   [(set_attr \"length\" \"2\")])\n \n+(define_insn \"*one_cmplsi2_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (not:SI (match_operand:SI 1 \"register_operand\" \"r\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+\t(not:SI (match_dup 1)))]\n+  \"reload_completed\"\n+  \"not %1,%0\"\n+  [(set_attr \"length\" \"2\")])\n+\n ;; -----------------------------------------------------------------\n ;; BIT FIELDS\n ;; -----------------------------------------------------------------\n@@ -1808,6 +1897,16 @@\n   \"andi 65535,%1,%0\"\n   [(set_attr \"length\" \"4\")])\n \n+(define_insn \"*zero_extendhisi2_v850_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (zero_extend:SI (match_operand:HI 1 \"register_operand\" \"r\"))\n+\t\t      (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+\t(zero_extend:SI (match_dup 1)))]\n+  \"reload_completed\"\n+  \"andi 65535,%1,%0\"\n+  [(set_attr \"length\" \"4\")])\n+\n (define_expand \"zero_extendhisi2\"\n   [(parallel [(set (match_operand:SI 0 \"register_operand\")\n \t\t   (zero_extend:SI\n@@ -1841,6 +1940,16 @@\n   \"andi 255,%1,%0\"\n   [(set_attr \"length\" \"4\")])\n \n+(define_insn \"*zero_extendqisi2_v850_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (zero_extend:SI (match_operand:QI 1 \"register_operand\" \"r\"))\n+\t\t      (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+\t(zero_extend:SI (match_dup 1)))]\n+  \"reload_completed\"\n+  \"andi 255,%1,%0\"\n+  [(set_attr \"length\" \"4\")])\n+\n (define_expand \"zero_extendqisi2\"\n   [(parallel [(set (match_operand:SI 0 \"register_operand\")\n \t\t   (zero_extend:SI\n@@ -1941,6 +2050,19 @@\n   shl %2,%0\"\n   [(set_attr \"length\" \"4,2\")])\n \n+(define_insn \"ashlsi3_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (ashift:SI (match_operand:SI 1 \"register_operand\" \"0,0\")\n+\t\t\t\t (match_operand:SI 2 \"nonmemory_operand\" \"r,N\"))\n+\t\t      (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n+      (ashift:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  shl %2,%0\n+  shl %2,%0\"\n+  [(set_attr \"length\" \"4,2\")])\n+\n (define_insn \"ashlsi3_v850e2_clobber_flags\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n       (ashift:SI\n@@ -1951,6 +2073,17 @@\n   \"shl %2,%1,%0\"\n   [(set_attr \"length\" \"4\")])\n \n+(define_insn \"ashlsi3_v850e2_set_flags\"\n+  [(set (reg:CCNZ CC_REGNUM)\n+\t(compare:CCNZ (ashift:SI (match_operand:SI 1 \"register_operand\" \"r\")\n+\t\t\t\t (match_operand:SI 2 \"nonmemory_operand\" \"r\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+\t(ashift:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed && TARGET_V850E2_UP\"\n+  \"shl %2,%1,%0\"\n+  [(set_attr \"length\" \"4\")])\n+\n (define_insn_and_split \"lshrsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n       (lshiftrt:SI\n@@ -1974,6 +2107,19 @@\n   shr %2,%0\"\n   [(set_attr \"length\" \"4,2\")])\n \n+(define_insn \"lshrsi3_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (lshiftrt:SI (match_operand:SI 1 \"register_operand\" \"0,0\")\n+\t\t\t         (match_operand:SI 2 \"nonmemory_operand\" \"r,N\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n+      (lshiftrt:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  shr %2,%0\n+  shr %2,%0\"\n+  [(set_attr \"length\" \"4,2\")])\n+\n (define_insn \"lshrsi3_v850e2_clobber_flags\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n       (lshiftrt:SI\n@@ -1984,6 +2130,17 @@\n   \"shr %2,%1,%0\"\n   [(set_attr \"length\" \"4\")])\n \n+(define_insn \"lshrsi3_v850e2_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (lshiftrt:SI (match_operand:SI 1 \"register_operand\" \"r\")\n+\t\t\t         (match_operand:SI 2 \"nonmemory_operand\" \"r\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+      (lshiftrt:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed && TARGET_V850E2_UP\"\n+  \"shr %2,%1,%0\"\n+  [(set_attr \"length\" \"4\")])\n+\n (define_insn_and_split \"ashrsi3\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n       (ashiftrt:SI\n@@ -2007,6 +2164,19 @@\n   sar %2,%0\"\n   [(set_attr \"length\" \"4,2\")])\n \n+(define_insn \"ashrsi3_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (ashiftrt:SI (match_operand:SI 1 \"register_operand\" \"0,0\")\n+\t\t\t         (match_operand:SI 2 \"nonmemory_operand\" \"r,N\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r,r\")\n+      (ashiftrt:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed\"\n+  \"@\n+  sar %2,%0\n+  sar %2,%0\"\n+  [(set_attr \"length\" \"4,2\")])\n+\n (define_insn \"ashrsi3_v850e2_clobber_flags\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n       (ashiftrt:SI\n@@ -2017,6 +2187,17 @@\n   \"sar %2,%1,%0\"\n   [(set_attr \"length\" \"4\")])\n \n+(define_insn \"ashrsi3_v850e2_set_flags\"\n+  [(set (reg:CC CC_REGNUM)\n+\t(compare:CC (ashiftrt:SI (match_operand:SI 1 \"register_operand\" \"r\")\n+\t\t\t         (match_operand:SI 2 \"nonmemory_operand\" \"r\"))\n+\t\t    (const_int 0)))\n+   (set (match_operand:SI 0 \"register_operand\" \"=r\")\n+      (ashiftrt:SI (match_dup 1) (match_dup 2)))]\n+  \"reload_completed && TARGET_V850E2_UP\"\n+  \"sar %2,%1,%0\"\n+  [(set_attr \"length\" \"4\")])\n+\n ;; ----------------------------------------------------------------------\n ;; FIND FIRST BIT INSTRUCTION\n ;; ----------------------------------------------------------------------"}]}