{"sha": "082ab5ff77937fc128fd802fde9d580ca76d71f1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDgyYWI1ZmY3NzkzN2ZjMTI4ZmQ4MDJmZGU5ZDU4MGNhNzZkNzFmMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-01-12T09:43:31Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-01-12T09:43:31Z"}, "message": "re PR tree-optimization/42645 (\"-fcompare-debug failure\" at -O1)\n\n\tPR tree-optimization/42645\n\t* tree-inline.c (processing_debug_stmt): Move earlier.  Make static.\n\t(remap_ssa_name): If processing_debug_stmt and name wasn't found in\n\tdecl_map, set processing_debug_stmt to -1 and return name without\n\tany remapping.\n\n\t* g++.dg/other/pr42645-1.C: New test.\n\t* g++.dg/other/pr42645-2.C: New test.\n\nFrom-SVN: r155830", "tree": {"sha": "cf837610df26a25fc371d690acc9bce414016e16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf837610df26a25fc371d690acc9bce414016e16"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/082ab5ff77937fc128fd802fde9d580ca76d71f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/082ab5ff77937fc128fd802fde9d580ca76d71f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/082ab5ff77937fc128fd802fde9d580ca76d71f1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/082ab5ff77937fc128fd802fde9d580ca76d71f1/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b1a54dd0523fe1104313b9d19897f24779dce5b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1a54dd0523fe1104313b9d19897f24779dce5b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1a54dd0523fe1104313b9d19897f24779dce5b7"}], "stats": {"total": 94, "additions": 87, "deletions": 7}, "files": [{"sha": "47491c083117d634e067725dbfe3dad5ddb9aaaf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=082ab5ff77937fc128fd802fde9d580ca76d71f1", "patch": "@@ -1,3 +1,11 @@\n+2010-01-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/42645\n+\t* tree-inline.c (processing_debug_stmt): Move earlier.  Make static.\n+\t(remap_ssa_name): If processing_debug_stmt and name wasn't found in\n+\tdecl_map, set processing_debug_stmt to -1 and return name without\n+\tany remapping.\n+\n 2010-01-11  Dave Korn  <dave.korn.cygwin@gmail.com>\n \n \t* doc/install.texi (Specific#x-x-cygwin): Document minimum required"}, {"sha": "cc978cd3bd4afe75a7ce0f52fa374f07ea4a6a16", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=082ab5ff77937fc128fd802fde9d580ca76d71f1", "patch": "@@ -1,3 +1,9 @@\n+2010-01-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/42645\n+\t* g++.dg/other/pr42645-1.C: New test.\n+\t* g++.dg/other/pr42645-2.C: New test.\n+\n 2010-01-11  Janis Johnson  <janis187@us.ibm.com>\n \n \tPR target/42416"}, {"sha": "5dc76f9efd9c1fc75af774b2f74200aa882c8ee3", "filename": "gcc/testsuite/g++.dg/other/pr42645-1.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr42645-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr42645-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr42645-1.C?ref=082ab5ff77937fc128fd802fde9d580ca76d71f1", "patch": "@@ -0,0 +1,26 @@\n+// PR tree-optimization/42645\n+// { dg-do compile }\n+// { dg-options \"-fcompare-debug -O1\" }\n+\n+extern void foo ();\n+\n+struct S\n+{\n+  struct T\n+  {\n+    int t1;\n+    char t2[4];\n+    T *t3;\n+  } t;\n+  int m1 () const { return t.t3[0].t1; }\n+  char *m2 () { foo (); }\n+  void m3 (int x) { char *m = m2 (); if (m1 () > 0 && x > 0); }\n+  void m4 () { if (m1 () > 0) for (int i = 0; i < 4; i++) t.t2[i] = 0; }\n+};\n+\n+void\n+f (S *a)\n+{\n+  a->m3 (0);\n+  a->m4 ();\n+}"}, {"sha": "67632e51d91286dc4c43822082c5d0d613d8de74", "filename": "gcc/testsuite/g++.dg/other/pr42645-2.C", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr42645-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr42645-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fpr42645-2.C?ref=082ab5ff77937fc128fd802fde9d580ca76d71f1", "patch": "@@ -0,0 +1,34 @@\n+// PR tree-optimization/42645\n+// { dg-do compile }\n+// { dg-options \"-fcompare-debug -O1\" }\n+\n+struct C\n+{\n+  bool b;\n+  C ();\n+};\n+\n+static inline C *foo () {}\n+\n+extern void f4 ();\n+\n+static inline int\n+f3 ()\n+{\n+  f4 ();\n+}\n+\n+static inline void\n+f2 (bool b)\n+{\n+  int tmp = f3 ();\n+  if (C ().b && b)\n+    C ();\n+}\n+\n+void\n+f1 ()\n+{\n+  C *c = foo ();\n+  f2 (c->b);\n+}"}, {"sha": "883a431c7ff62b6c33e7413cbe3768d64fed47a2", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/082ab5ff77937fc128fd802fde9d580ca76d71f1/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=082ab5ff77937fc128fd802fde9d580ca76d71f1", "patch": "@@ -1,5 +1,5 @@\n /* Tree inlining.\n-   Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009\n+   Copyright 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010\n    Free Software Foundation, Inc.\n    Contributed by Alexandre Oliva <aoliva@redhat.com>\n \n@@ -171,6 +171,12 @@ insert_debug_decl_map (copy_body_data *id, tree key, tree value)\n   *pointer_map_insert (id->debug_map, key) = value;\n }\n \n+/* If nonzero, we're remapping the contents of inlined debug\n+   statements.  If negative, an error has occurred, such as a\n+   reference to a variable that isn't available in the inlined\n+   context.  */\n+static int processing_debug_stmt = 0;\n+\n /* Construct new SSA name for old NAME. ID is the inline context.  */\n \n static tree\n@@ -185,6 +191,12 @@ remap_ssa_name (tree name, copy_body_data *id)\n   if (n)\n     return unshare_expr (*n);\n \n+  if (processing_debug_stmt)\n+    {\n+      processing_debug_stmt = -1;\n+      return name;\n+    }\n+\n   /* Do not set DEF_STMT yet as statement is not copied yet. We do that\n      in copy_bb.  */\n   new_tree = remap_decl (SSA_NAME_VAR (name), id);\n@@ -244,12 +256,6 @@ remap_ssa_name (tree name, copy_body_data *id)\n   return new_tree;\n }\n \n-/* If nonzero, we're remapping the contents of inlined debug\n-   statements.  If negative, an error has occurred, such as a\n-   reference to a variable that isn't available in the inlined\n-   context.  */\n-int processing_debug_stmt = 0;\n-\n /* Remap DECL during the copying of the BLOCK tree for the function.  */\n \n tree"}]}