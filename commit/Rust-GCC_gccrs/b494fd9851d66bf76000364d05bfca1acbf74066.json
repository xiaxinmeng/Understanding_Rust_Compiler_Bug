{"sha": "b494fd9851d66bf76000364d05bfca1acbf74066", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjQ5NGZkOTg1MWQ2NmJmNzYwMDAzNjRkMDViZmNhMWFjYmY3NDA2Ng==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@libertysurf.fr", "date": "2003-10-04T18:02:32Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2003-10-04T18:02:32Z"}, "message": "re PR c/12446 (ICE in emit_move_insn on complicated array reference)\n\n\tPR c/12446\n\t* c-typeck.c (convert_for_assignment): Issue an error for\n\tarray to pointer assignment after default conversion.\n\t(digest_init): Likewise.\n\nFrom-SVN: r72096", "tree": {"sha": "ea93cb95fbf3f7b89f23547114e93eaef32cfd22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea93cb95fbf3f7b89f23547114e93eaef32cfd22"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b494fd9851d66bf76000364d05bfca1acbf74066", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b494fd9851d66bf76000364d05bfca1acbf74066", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b494fd9851d66bf76000364d05bfca1acbf74066", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b494fd9851d66bf76000364d05bfca1acbf74066/comments", "author": {"login": "ebotcazou", "id": 48091907, "node_id": "MDQ6VXNlcjQ4MDkxOTA3", "avatar_url": "https://avatars.githubusercontent.com/u/48091907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebotcazou", "html_url": "https://github.com/ebotcazou", "followers_url": "https://api.github.com/users/ebotcazou/followers", "following_url": "https://api.github.com/users/ebotcazou/following{/other_user}", "gists_url": "https://api.github.com/users/ebotcazou/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebotcazou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebotcazou/subscriptions", "organizations_url": "https://api.github.com/users/ebotcazou/orgs", "repos_url": "https://api.github.com/users/ebotcazou/repos", "events_url": "https://api.github.com/users/ebotcazou/events{/privacy}", "received_events_url": "https://api.github.com/users/ebotcazou/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e9ff9b17a7c2b5dc5d3dd383dbe191c2354cd859", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9ff9b17a7c2b5dc5d3dd383dbe191c2354cd859", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9ff9b17a7c2b5dc5d3dd383dbe191c2354cd859"}], "stats": {"total": 60, "additions": 58, "deletions": 2}, "files": [{"sha": "b1724000cff6937df510520927866a31da4cb336", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b494fd9851d66bf76000364d05bfca1acbf74066", "patch": "@@ -1,3 +1,10 @@\n+2003-10-04  Eric Botcazou  <ebotcazou@libertysurf.fr>\n+\n+\tPR c/12446\n+\t* c-typeck.c (convert_for_assignment): Issue an error for\n+\tarray to pointer assignment after default conversion.\n+\t(digest_init): Likewise.\n+\n 2003-10-04  Fariborz Jahanian  <fjahanian@apple.com>\n \n \t* c-decl.c (duplicate_decls): retain DECL_COMMON of old declaration"}, {"sha": "eaad4fe9698c8970f0a2e293bb1dccf9b88f7c7c", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=b494fd9851d66bf76000364d05bfca1acbf74066", "patch": "@@ -3556,6 +3556,11 @@ convert_for_assignment (tree type, tree rhs, const char *errtype,\n \t\t\t     errtype, funname, parmnum);\n       return convert (type, rhs);\n     }\n+  else if (codel == POINTER_TYPE && coder == ARRAY_TYPE)\n+    {\n+      error (\"invalid use of non-lvalue array\");\n+      return error_mark_node;\n+    }\n   else if (codel == POINTER_TYPE && coder == INTEGER_TYPE)\n     {\n       /* An explicit constant 0 can convert to a pointer,\n@@ -4052,8 +4057,16 @@ digest_init (tree type, tree init, int require_constant)\n \t\t\t    TREE_TYPE (type), COMPARE_STRICT))))\n     {\n       if (code == POINTER_TYPE)\n-\tinside_init = default_function_array_conversion (inside_init);\n-      \n+\t{\n+\t  inside_init = default_function_array_conversion (inside_init);\n+\n+\t  if (TREE_CODE (TREE_TYPE (inside_init)) == ARRAY_TYPE)\n+\t    {\n+\t      error_init (\"invalid use of non-lvalue array\");\n+\t      return error_mark_node;\n+\t    }\n+\t }\n+\n       if (code == VECTOR_TYPE)\n \t/* Although the types are compatible, we may require a\n \t   conversion.  */"}, {"sha": "6361f9e33c266abf5f512d983bbae5ccaf6f5bb3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b494fd9851d66bf76000364d05bfca1acbf74066", "patch": "@@ -1,3 +1,8 @@\n+2003-10-04  Eric Botcazou  <ebotcazou@libertysurf.fr>\n+\n+\t* gcc.dg/c90-array-lval-6.c: New test.\n+\t* gcc.dg/c99-array-lval-6.c: New test.\n+\n 2003-10-03  Alexander Malmberg  <alexander@malmberg.org>\n \t    Ziemowit Laski  <zlaski@apple.com>\n "}, {"sha": "f42ef52bd190167a8be3f16d6122e7e2fcb59308", "filename": "gcc/testsuite/gcc.dg/c90-array-lval-6.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Ftestsuite%2Fgcc.dg%2Fc90-array-lval-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Ftestsuite%2Fgcc.dg%2Fc90-array-lval-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc90-array-lval-6.c?ref=b494fd9851d66bf76000364d05bfca1acbf74066", "patch": "@@ -0,0 +1,16 @@\n+/* PR c/12446 */\n+/* Origin: Keith Thompson <kst@cts.com> */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-std=iso9899:1990 -pedantic-errors\" } */\n+\n+\n+struct s { char c[1]; };\n+\n+extern struct s foo(void);\n+\n+void bar(void)\n+{\n+  char *ptr = foo().c; /* { dg-bogus \"warning\" \"warning in place of error\" } */\n+}\n+/* { dg-error \"non-lvalue\" \"array not decaying to lvalue\" { target *-*-* } 14 } */"}, {"sha": "426b3c75c90eab585b6b65ebf7fcc075a2e35d85", "filename": "gcc/testsuite/gcc.dg/c99-array-lval-6.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-array-lval-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b494fd9851d66bf76000364d05bfca1acbf74066/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-array-lval-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc99-array-lval-6.c?ref=b494fd9851d66bf76000364d05bfca1acbf74066", "patch": "@@ -0,0 +1,15 @@\n+/* PR c/12446 */\n+/* Origin: Keith Thompson <kst@cts.com> */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-std=iso9899:1999 -pedantic-errors\" } */\n+\n+\n+struct s { char c[1]; };\n+\n+extern struct s foo(void);\n+\n+void bar(void)\n+{\n+  char *ptr = foo().c; /* { dg-bogus \"non-lvalue\" \"array not decaying to lvalue\" } */\n+}"}]}