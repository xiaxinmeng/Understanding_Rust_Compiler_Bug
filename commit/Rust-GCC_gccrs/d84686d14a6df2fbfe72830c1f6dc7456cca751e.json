{"sha": "d84686d14a6df2fbfe72830c1f6dc7456cca751e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg0Njg2ZDE0YTZkZjJmYmZlNzI4MzBjMWY2ZGM3NDU2Y2NhNzUxZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-06-07T17:50:10Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-06-07T17:50:10Z"}, "message": "re PR c++/44444 (-Wunused-but-set-variable problem with field references)\n\n\tPR c++/44444\n\t* expr.c (mark_exp_read): Handle INDIRECT_REF.\n\t* cvt.c (convert_to_void): Handle INDIRECT_REF like\n\thandled_component_p.\n\n\t* g++.dg/warn/Wunused-var-12.C: New test.\n\nFrom-SVN: r160388", "tree": {"sha": "6bf1acdbbbfd98a7996cc0ee8d991ab35560999a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6bf1acdbbbfd98a7996cc0ee8d991ab35560999a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d84686d14a6df2fbfe72830c1f6dc7456cca751e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d84686d14a6df2fbfe72830c1f6dc7456cca751e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d84686d14a6df2fbfe72830c1f6dc7456cca751e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d84686d14a6df2fbfe72830c1f6dc7456cca751e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "026698d28e6eac591edfc8b1fd397e73b0503c56", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/026698d28e6eac591edfc8b1fd397e73b0503c56", "html_url": "https://github.com/Rust-GCC/gccrs/commit/026698d28e6eac591edfc8b1fd397e73b0503c56"}], "stats": {"total": 51, "additions": 49, "deletions": 2}, "files": [{"sha": "3bfd7f1e4b254179dc5b1d2905d0a82054241c72", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d84686d14a6df2fbfe72830c1f6dc7456cca751e", "patch": "@@ -1,5 +1,10 @@\n 2010-06-07  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/44444\n+\t* expr.c (mark_exp_read): Handle INDIRECT_REF.\n+\t* cvt.c (convert_to_void): Handle INDIRECT_REF like\n+\thandled_component_p.\n+\n \tPR c++/44443\n \t* decl.c (initialize_local_var): If TREE_USED is set on the type,\n \tset also DECL_READ_P on the decl."}, {"sha": "04c068cb3e89f573b167f5b6fad1c6c7ddc86843", "filename": "gcc/cp/cvt.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Fcp%2Fcvt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Fcp%2Fcvt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcvt.c?ref=d84686d14a6df2fbfe72830c1f6dc7456cca751e", "patch": "@@ -834,7 +834,9 @@ convert_to_void (tree expr, const char *implicit, tsubst_flags_t complain)\n \n       while (TREE_CODE (exprv) == COMPOUND_EXPR)\n \texprv = TREE_OPERAND (exprv, 1);\n-      if (DECL_P (exprv) || handled_component_p (exprv))\n+      if (DECL_P (exprv)\n+\t  || handled_component_p (exprv)\n+\t  || TREE_CODE (exprv) == INDIRECT_REF)\n \t/* Expr is not being 'used' here, otherwise we whould have\n \t   called mark_{rl}value_use use here, which would have in turn\n \t   called mark_exp_read.  Rather, we call mark_exp_read directly"}, {"sha": "0a0ba534063cfc808ed225a29ce2b128ee68aa91", "filename": "gcc/cp/expr.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Fcp%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Fcp%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fexpr.c?ref=d84686d14a6df2fbfe72830c1f6dc7456cca751e", "patch": "@@ -1,7 +1,7 @@\n /* Convert language-specific tree expression to rtl instructions,\n    for GNU compiler.\n    Copyright (C) 1988, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   2000, 2001, 2002, 2003, 2004, 2007 Free Software Foundation, Inc.\n+   2000, 2001, 2002, 2003, 2004, 2007, 2010 Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -132,6 +132,7 @@ mark_exp_read (tree exp)\n     case IMAGPART_EXPR:\n     CASE_CONVERT:\n     case ADDR_EXPR:\n+    case INDIRECT_REF:\n       mark_exp_read (TREE_OPERAND (exp, 0));\n       break;\n     case COMPOUND_EXPR:"}, {"sha": "70d709eb0761acef53060cfc6996e9bf6bc1d1cb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d84686d14a6df2fbfe72830c1f6dc7456cca751e", "patch": "@@ -1,5 +1,8 @@\n 2010-06-07  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/44444\n+\t* g++.dg/warn/Wunused-var-12.C: New test.\n+\n \tPR c++/44443\n \t* c-c++-common/Wunused-var-11.c: New test.\n "}, {"sha": "3300cbe3d8ad5a70e020423c8974aaa8086db4e1", "filename": "gcc/testsuite/g++.dg/warn/Wunused-var-12.C", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-var-12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d84686d14a6df2fbfe72830c1f6dc7456cca751e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-var-12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWunused-var-12.C?ref=d84686d14a6df2fbfe72830c1f6dc7456cca751e", "patch": "@@ -0,0 +1,36 @@\n+// PR c++/44444\n+// { dg-do compile }\n+// { dg-options \"-Wunused\" }\n+\n+struct S\n+{\n+  const int &u;\n+  const int &v;\n+  S (const int &a, const int &b) : u(a), v(b) { }\n+};\n+\n+bool\n+f1 ()\n+{\n+  bool t = false;\n+  S z = S (1, 2);\n+  t |= z.u == 1;\n+  t |= z.v == 2;\n+  return t;\n+}\n+\n+void\n+f2 ()\n+{\n+  S z = S (1, 2);\n+  z.u;\t\t// { dg-warning \"no effect\" }\n+}\n+\n+int i;\n+\n+void\n+f3 ()\n+{\n+  S z = S (1, 2);\n+  i++, z.u;\t// { dg-warning \"no effect\" }\n+}"}]}