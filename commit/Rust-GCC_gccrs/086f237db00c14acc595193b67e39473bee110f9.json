{"sha": "086f237db00c14acc595193b67e39473bee110f9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDg2ZjIzN2RiMDBjMTRhY2M1OTUxOTNiNjdlMzk0NzNiZWUxMTBmOQ==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-05-02T22:21:14Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-05-02T22:21:14Z"}, "message": "(expand_end_case): Make sure gen_casesi operands are\nvalid by passing them through copy_to_mode_reg if necessary.\n\nFrom-SVN: r7192", "tree": {"sha": "eb23424389a9c7e8b24b5c103c47938b63f621e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb23424389a9c7e8b24b5c103c47938b63f621e6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/086f237db00c14acc595193b67e39473bee110f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/086f237db00c14acc595193b67e39473bee110f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/086f237db00c14acc595193b67e39473bee110f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/086f237db00c14acc595193b67e39473bee110f9/comments", "author": null, "committer": null, "parents": [{"sha": "09dcff637fea4a1cd22ded1dda471b89b24d7633", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09dcff637fea4a1cd22ded1dda471b89b24d7633", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09dcff637fea4a1cd22ded1dda471b89b24d7633"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "c056bb3e208f2e59cc6d3a05e4025da8ceb3eab0", "filename": "gcc/stmt.c", "status": "modified", "additions": 22, "deletions": 4, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/086f237db00c14acc595193b67e39473bee110f9/gcc%2Fstmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/086f237db00c14acc595193b67e39473bee110f9/gcc%2Fstmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstmt.c?ref=086f237db00c14acc595193b67e39473bee110f9", "patch": "@@ -4438,6 +4438,8 @@ expand_end_case (orig_index)\n \t    {\n \t      enum machine_mode index_mode = SImode;\n \t      int index_bits = GET_MODE_BITSIZE (index_mode);\n+\t      rtx op1, op2;\n+\t      enum machine_mode op_mode;\n \n \t      /* Convert the index to SImode.  */\n \t      if (GET_MODE_BITSIZE (TYPE_MODE (TREE_TYPE (index_expr)))\n@@ -4467,10 +4469,26 @@ expand_end_case (orig_index)\n \t      index = protect_from_queue (index, 0);\n \t      do_pending_stack_adjust ();\n \n-\t      emit_jump_insn (gen_casesi (index, expand_expr (minval, NULL_RTX,\n-\t\t\t\t\t\t\t      VOIDmode, 0),\n-\t\t\t\t\t  expand_expr (range, NULL_RTX,\n-\t\t\t\t\t\t       VOIDmode, 0),\n+\t      op_mode = insn_operand_mode[(int)CODE_FOR_casesi][0];\n+\t      if (! (*insn_operand_predicate[(int)CODE_FOR_casesi][0])\n+\t\t  (index, op_mode))\n+\t\tindex = copy_to_mode_reg (op_mode, index);\n+\n+\t      op1 = expand_expr (minval, NULL_RTX, VOIDmode, 0);\n+\n+\t      op_mode = insn_operand_mode[(int)CODE_FOR_casesi][1];\n+\t      if (! (*insn_operand_predicate[(int)CODE_FOR_casesi][1])\n+\t\t  (op1, op_mode))\n+\t\top1 = copy_to_mode_reg (op_mode, op1);\n+\n+\t      op2 = expand_expr (range, NULL_RTX, VOIDmode, 0);\n+\n+\t      op_mode = insn_operand_mode[(int)CODE_FOR_casesi][2];\n+\t      if (! (*insn_operand_predicate[(int)CODE_FOR_casesi][2])\n+\t\t  (op2, op_mode))\n+\t\top2 = copy_to_mode_reg (op_mode, op2);\n+\n+\t      emit_jump_insn (gen_casesi (index, op1, op2,\n \t\t\t\t\t  table_label, default_label));\n \t      win = 1;\n \t    }"}]}