{"sha": "2ce298900287e37c7442a413f658608c8ae22833", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmNlMjk4OTAwMjg3ZTM3Yzc0NDJhNDEzZjY1ODYwOGM4YWUyMjgzMw==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2014-03-01T21:14:54Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2014-03-01T21:14:54Z"}, "message": "re PR fortran/60341 (ICE compiling Nonmem 6.2.0)\n\nfortran/\n        PR fortran/60341\n        * frontend-passes.c (optimize_comparison): Guard two union\n        accesses with the corresponding tag checks.\n\ntestsuite/\n        PR fortran/60341\n        * gfortran.dg/str_comp_optimize_1.f90: New test.\n\nFrom-SVN: r208249", "tree": {"sha": "b9129c9449d200fd7c5ab98022a3e108749ee455", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b9129c9449d200fd7c5ab98022a3e108749ee455"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ce298900287e37c7442a413f658608c8ae22833", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ce298900287e37c7442a413f658608c8ae22833", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ce298900287e37c7442a413f658608c8ae22833", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ce298900287e37c7442a413f658608c8ae22833/comments", "author": null, "committer": null, "parents": [{"sha": "c582aac943fe2574a03cb5f557a3ee1e5d6585f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c582aac943fe2574a03cb5f557a3ee1e5d6585f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c582aac943fe2574a03cb5f557a3ee1e5d6585f1"}], "stats": {"total": 35, "additions": 35, "deletions": 0}, "files": [{"sha": "549421fbafcfdc532a4a3e6230b09abbcf6dca09", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2ce298900287e37c7442a413f658608c8ae22833", "patch": "@@ -1,3 +1,9 @@\n+2014-03-01  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/60341\n+\t* frontend-passes.c (optimize_comparison): Guard two union accesses\n+\twith the corresponding tag checks.\n+\n 2014-02-28  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/60359"}, {"sha": "e663868d3ce00906f8f95e848721d9c04061d3f1", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=2ce298900287e37c7442a413f658608c8ae22833", "patch": "@@ -1391,7 +1391,9 @@ optimize_comparison (gfc_expr *e, gfc_intrinsic_op op)\n \t  /* Replace A // B < A // C with B < C, and A // B < C // B\n \t     with A < C.  */\n \t  if (op1->ts.type == BT_CHARACTER && op2->ts.type == BT_CHARACTER\n+\t      && op1->expr_type == EXPR_OP\n \t      && op1->value.op.op == INTRINSIC_CONCAT\n+\t      && op2->expr_type == EXPR_OP\n \t      && op2->value.op.op == INTRINSIC_CONCAT)\n \t    {\n \t      gfc_expr *op1_left = op1->value.op.op1;"}, {"sha": "dd9dcbae1d1bc796eb6d336a7716124c2bcbadd3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2ce298900287e37c7442a413f658608c8ae22833", "patch": "@@ -1,3 +1,8 @@\n+2014-03-01  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\tPR fortran/60341\n+\t* gfortran.dg/str_comp_optimize_1.f90: New test.\n+\n 2014-03-01  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/60071"}, {"sha": "84287b475a5f2398a0082c6a21aea3260f771fbb", "filename": "gcc/testsuite/gfortran.dg/str_comp_optimize_1.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ftestsuite%2Fgfortran.dg%2Fstr_comp_optimize_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce298900287e37c7442a413f658608c8ae22833/gcc%2Ftestsuite%2Fgfortran.dg%2Fstr_comp_optimize_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fstr_comp_optimize_1.f90?ref=2ce298900287e37c7442a413f658608c8ae22833", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do compile }\n+! { dg-options \"-ffrontend-optimize\" }\n+!\n+! PR fortran/60341\n+! An unguarded union access was wrongly enabling a frontend optimization on a\n+! string comparison, leading to an ICE.\n+!\n+! Original testcase from Steve Chapel  <steve.chapel@a2pg.com>.\n+! Reduced by Steven G. Kargl  <kargl@gcc.gnu.org>.\n+!\n+\n+      subroutine modelg(ncm)\n+      implicit none\n+      integer, parameter :: pc = 30, pm = pc - 1\n+      integer i\n+      character*4 catt(pm,2)\n+      integer ncm,iatt(pm,pc)\n+      do i=1,ncm\n+         if (catt(i,1)//catt(i,2).eq.'central') exit\n+      end do\n+      iatt(i,4)=1\n+      end"}]}