{"sha": "68c3f02a687ec4e6dd51392f1154da5690cd7963", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjhjM2YwMmE2ODdlYzRlNmRkNTEzOTJmMTE1NGRhNTY5MGNkNzk2Mw==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2008-04-08T06:48:54Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2008-04-08T06:48:54Z"}, "message": "clean.adb (Parse_Cmd_Line): Recognize switch --subdirs=\n\n2008-04-08  Vincent Celier  <celier@adacore.com>\n\n\t* clean.adb (Parse_Cmd_Line): Recognize switch --subdirs=\n\t(Usage): Add line for switch --subdirs=\n\tAdd new switch -eL, to follow symbolic links when processing project\n\tfiles.\n\n\t* gnatcmd.adb: Process switches -eL and --subdirs=\n\t(Non_VMS_Usage): Output \"gnaampcmd\" instead of \"gnat\", and call\n\tProgram_Name to get proper tool names when AAMP_On_Target is set.\n\t(Gnatcmd): Call Add_Default_Search_Dirs and Get_Target_Parameters to get\n\tAAMP_On_Target set properly for use of GNAAMP tools (this is needed by\n\tOsint.Program_Name).\n\n\t* gnatname.adb: (Scan_Args): Recognize switches -eL and --subdirs=\n\t(Usage): Add lines for switches -eL and --subdirs=\n\n\t* makeusg.adb: Add line for switch --subdirs=\n\n\t* prj.ads: \n\t(Source_Data): New Boolean component Compiled, defaulted to True\n\t(Empty_File_Name: New global variable in private part, initialized in\n\tprocedure Initialize.\n\t(Subdirs_Option): New constant string\n\t(Subdirs): New String_Ptr global variable\n\t(Language_Config): New component Include_Compatible_Languages\n\t(Project_Qualifier): New type for project qualifiers\n\t(Project_Data): New component Qualifier\n\t(Project_Configuration): New component Archive_Builder_Append_Option\n\n\t* prj-nmsc.adb (Get_Unit_Exceptions): When a unit is already in\n\tanother imported project indicate the name of this imported project.\n\t(Check_File): When a unit is in two project files, indicate the project\n\tnames and the paths of the source files for each project.\n\t(Add_Source): Set Compiled to False if compiler driver is empty. Only\n\tset object, dependency and switches file names if Compiled is True.\n\t(Process_Compiler): Allow the empty string for value of attribute Driver\n\t(Get_Directories): When Subdirs is not null and Object_Dir is not\n\t specified, locate and create if necessary the actual object dir.\n\t(Locate_Directory): When Subdirs is not empty and Create is not the\n\tempty string, locate and create if necessary the actual directory\n\tas a subdirectory of directory Name.\n\t(Check_Library_Attributes.Check_Library): Allow a project where the only\n\t\"sources\" are header files of file based languages to be imported by\n\tlibrary projects, in multi-language mode (gprbuild).\n\t(Check_Library_Attributes.Check_Library): In multi-language mode\n\t(gprbuild), allow a library project to import a project with no\n\tsources, even when this is not declared explicitly.\n\t(Check_If_Externally_Built): A virtual project extending an externally\n\tbuilt project is also externally built.\n\t(Check_Library_Attributes): For a virtual project extending a library\n\tproject, inherit the library directory.\n\t(Process_Project_Level_Array_Attributes): Process new attribute\n\tInherit_Source_Path.\n\tFor projects with specified qualifiers \"standard\", \"library\" or\n\t\"abstract\", check that the project conforms to the qualifier.\n\t(Process_Project_Level_Simple_Attributes): Process new attribute\n\t Archive_Builder_Append_Option.\n\n\t* switch-m.adb: (Scan_Make_Switches): Process switch --subdirs=\n\t(Normalize_Compiler_Switches): Only keep compiler switches that are\n\tpassed to gnat1 by the gcc driver and that are stored in the ALI file\n\tby gnat1.\n\tDo not take into account switc -save-temps\n\n\t* makegpr.adb (Compile_Link_With_Gnatmake): Transmit switch -eL if\n\tgprmake is called with -eL.\n\t(Scan_Arg): Recognize switch -eL\n\t(Usage): Add line for switch -eL\n\n\t* prj.adb (Initialize): Initialize Empty_File_Name\n\t(Project_Empty): New component Qualifier\n\n\t* prj-attr.ads, prj-attr.adb: New project level attribute\n\tInherit_Source_Path.\n\tNew project level attribute Archive_Builder_Append_Option\n\n\t* prj-dect.adb: Replace System.Strings by GNAT.Strings.\n\n\t* prj-ext.adb (Initialize_Project_Path): In Multi_Language mode, add\n\t<prefix>/lib/gnat in the project path, after <prefix>/share/gpr, for\n\tupward compatibility.\n\n\t* prj-part.adb (Project_Path_Name_Of.Try_Path): In high verbosity, put\n\teach Trying ...\" on different lines.\n\t(Parse_Single_Project): Recognize project qualifiers. Fail in qualifier\n\tis \"configuration\" when not in configuration. Fail when in configuration\n\twhen a specified qualifier is other than \"configuration\".\n\n\t* prj-proc.adb (Process_Declarative_Items): Link new elements of copied\n\tfull associative array together.\n\t(Recursive_Process): Put the project qualifier in the project data\n\t\n\t* prj-tree.ads, prj-tree.adb: (Project_Qualifier_Of): New function\n\t(Set_Project_Qualifier_Of): New procedure\n\nFrom-SVN: r134023", "tree": {"sha": "19a9ced7ffaa892a7a6277565007023c9130ccce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/19a9ced7ffaa892a7a6277565007023c9130ccce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68c3f02a687ec4e6dd51392f1154da5690cd7963", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68c3f02a687ec4e6dd51392f1154da5690cd7963", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68c3f02a687ec4e6dd51392f1154da5690cd7963", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68c3f02a687ec4e6dd51392f1154da5690cd7963/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a1e2130ca1fa141e3dcb1ba4913a8f46d33ab9c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a1e2130ca1fa141e3dcb1ba4913a8f46d33ab9c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a1e2130ca1fa141e3dcb1ba4913a8f46d33ab9c1"}], "stats": {"total": 1131, "additions": 813, "deletions": 318}, "files": [{"sha": "876ec5a19a3220ba296fbf775d5a00a71f00d1b1", "filename": "gcc/ada/clean.adb", "status": "modified", "additions": 26, "deletions": 1, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fclean.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fclean.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fclean.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2003-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2003-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -1669,6 +1669,18 @@ package body Clean is\n                   end if;\n \n                   case Arg (2) is\n+                     when '-' =>\n+                        if Arg'Length > Subdirs_Option'Length and then\n+                          Arg (1 .. Subdirs_Option'Length) = Subdirs_Option\n+                        then\n+                           Subdirs :=\n+                             new String'\n+                               (Arg (Subdirs_Option'Length + 1 .. Arg'Last));\n+\n+                        else\n+                           Bad_Argument;\n+                        end if;\n+\n                      when 'a' =>\n                         if Arg'Length < 4 then\n                            Bad_Argument;\n@@ -1725,6 +1737,14 @@ package body Clean is\n                            end;\n                         end if;\n \n+                     when 'e' =>\n+                        if Arg = \"-eL\" then\n+                           Follow_Links_For_Files := True;\n+\n+                        else\n+                           Bad_Argument;\n+                        end if;\n+\n                      when 'f' =>\n                         Force_Deletions := True;\n \n@@ -1954,8 +1974,13 @@ package body Clean is\n          Put_Line (\"  names may be omitted if -P<project> is specified\");\n          New_Line;\n \n+         Put_Line (\"  --subdirs=dir real obj/lib/exec dirs are subdirs\");\n+         New_Line;\n+\n          Put_Line (\"  -c       Only delete compiler generated files\");\n          Put_Line (\"  -D dir   Specify dir as the object library\");\n+         Put_Line (\"  -eL      Follow symbolic links when processing \" &\n+                   \"project files\");\n          Put_Line (\"  -f       Force deletions of unwritable files\");\n          Put_Line (\"  -F       Full project path name \" &\n                    \"in brief error messages\");"}, {"sha": "8135bfc8a4d07fecb716dec37cbc6aea1102c6db", "filename": "gcc/ada/gnatcmd.adb", "status": "modified", "additions": 77, "deletions": 34, "changes": 111, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fgnatcmd.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fgnatcmd.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatcmd.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1996-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1996-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -41,6 +41,7 @@ with Prj.Util; use Prj.Util;\n with Sinput.P;\n with Snames;   use Snames;\n with Table;\n+with Targparm;\n with Tempdir;\n with Types;    use Types;\n with Hostparm; use Hostparm;\n@@ -233,7 +234,8 @@ procedure GNATCmd is\n    --  METRIC).\n \n    procedure Delete_Temp_Config_Files;\n-   --  Delete all temporary config files\n+   --  Delete all temporary config files. The caller is responsible for\n+   --  ensuring that Keep_Temporary_Files is False.\n \n    procedure Get_Closure;\n    --  Get the sources in the closure of the ASIS_Main and add them to the\n@@ -721,38 +723,40 @@ procedure GNATCmd is\n       pragma Warnings (Off, Success);\n \n    begin\n-      if not Keep_Temporary_Files then\n-         if Project /= No_Project then\n-            for Prj in Project_Table.First ..\n-                       Project_Table.Last (Project_Tree.Projects)\n-            loop\n-               if\n-                 Project_Tree.Projects.Table (Prj).Config_File_Temp\n-               then\n-                  if Verbose_Mode then\n-                     Output.Write_Str (\"Deleting temp configuration file \"\"\");\n-                     Output.Write_Str\n-                       (Get_Name_String\n-                          (Project_Tree.Projects.Table\n-                             (Prj).Config_File_Name));\n-                     Output.Write_Line (\"\"\"\");\n-                  end if;\n+      --  This should only be called if Keep_Temporary_Files is False\n \n-                  Delete_File\n-                    (Name    => Get_Name_String\n+      pragma Assert (not Keep_Temporary_Files);\n+\n+      if Project /= No_Project then\n+         for Prj in Project_Table.First ..\n+                    Project_Table.Last (Project_Tree.Projects)\n+         loop\n+            if\n+              Project_Tree.Projects.Table (Prj).Config_File_Temp\n+            then\n+               if Verbose_Mode then\n+                  Output.Write_Str (\"Deleting temp configuration file \"\"\");\n+                  Output.Write_Str\n+                    (Get_Name_String\n                        (Project_Tree.Projects.Table\n-                          (Prj).Config_File_Name),\n-                     Success => Success);\n+                          (Prj).Config_File_Name));\n+                  Output.Write_Line (\"\"\"\");\n                end if;\n-            end loop;\n-         end if;\n \n-         --  If a temporary text file that contains a list of files for a tool\n-         --  has been created, delete this temporary file.\n+               Delete_File\n+                 (Name =>\n+                    Get_Name_String\n+                      (Project_Tree.Projects.Table (Prj).Config_File_Name),\n+                  Success => Success);\n+            end if;\n+         end loop;\n+      end if;\n \n-         if Temp_File_Name /= null then\n-            Delete_File (Temp_File_Name.all, Success);\n-         end if;\n+      --  If a temporary text file that contains a list of files for a tool\n+      --  has been created, delete this temporary file.\n+\n+      if Temp_File_Name /= null then\n+         Delete_File (Temp_File_Name.all, Success);\n       end if;\n    end Delete_Temp_Config_Files;\n \n@@ -770,7 +774,8 @@ procedure GNATCmd is\n                 6 => new String'(\"-bargs\"),\n                 7 => new String'(\"-R\"),\n                 8 => new String'(\"-Z\"));\n-      --  Arguments of the invocation of gnatmake to get the list of\n+      --  Arguments for the invocation of gnatmake which are added to the\n+      --  Last_Arguments list by this procedure.\n \n       FD : File_Descriptor;\n       --  File descriptor for the temp file that will get the output of the\n@@ -793,6 +798,8 @@ procedure GNATCmd is\n       File : Ada.Text_IO.File_Type;\n       Line : String (1 .. 250);\n       Last : Natural;\n+      --  Used to read file if there is an error, it is good enough to display\n+      --  just 250 characters if the first line of the file is very long.\n \n       Udata : Unit_Data;\n       Path  : Path_Name_Type;\n@@ -890,7 +897,6 @@ procedure GNATCmd is\n \n          if not Keep_Temporary_Files then\n             Delete (File);\n-\n          else\n             Close (File);\n          end if;\n@@ -1322,9 +1328,15 @@ procedure GNATCmd is\n \n       for C in Command_List'Range loop\n          if not Command_List (C).VMS_Only then\n-            Put (\"gnat \" & To_Lower (Command_List (C).Cname.all));\n+            if Targparm.AAMP_On_Target then\n+               Put (\"gnaampcmd \");\n+            else\n+               Put (\"gnat \");\n+            end if;\n+\n+            Put (To_Lower (Command_List (C).Cname.all));\n             Set_Col (25);\n-            Put (Command_List (C).Unixcmd.all);\n+            Put (Program_Name (Command_List (C).Unixcmd.all).all);\n \n             declare\n                Sws : Argument_List_Access renames Command_List (C).Unixsws;\n@@ -1375,6 +1387,16 @@ begin\n \n    Set_Mode (Ada_Only);\n \n+   --  Add the default search directories, to be able to find system.ads in the\n+   --  subsequent call to Targparm.Get_Target_Parameters.\n+\n+   Add_Default_Search_Dirs;\n+\n+   --  Get target parameters so that AAMP_On_Target will be set, for testing in\n+   --  Osint.Program_Name to handle the mapping of GNAAMP tool names.\n+\n+   Targparm.Get_Target_Parameters;\n+\n    --  Add the directory where the GNAT driver is invoked in front of the path,\n    --  if the GNAT driver is invoked with directory information. Do not do this\n    --  for VMS, where the notion of path does not really exist.\n@@ -1666,16 +1688,37 @@ begin\n                      end if;\n                   end if;\n \n+                  --  --subdirs=... Specify Subdirs\n+\n+                  if Argv'Length > Subdirs_Option'Length and then\n+                    Argv\n+                      (Argv'First .. Argv'First + Subdirs_Option'Length - 1) =\n+                      Subdirs_Option\n+                  then\n+                     Subdirs :=\n+                       new String'\n+                         (Argv\n+                            (Argv'First + Subdirs_Option'Length .. Argv'Last));\n+\n+                     Remove_Switch (Arg_Num);\n+\n                   --  -aPdir  Add dir to the project search path\n \n-                  if Argv'Length > 3\n+                  elsif Argv'Length > 3\n                     and then Argv (Argv'First + 1 .. Argv'First + 2) = \"aP\"\n                   then\n                      Add_Search_Project_Directory\n                        (Argv (Argv'First + 3 .. Argv'Last));\n \n                      Remove_Switch (Arg_Num);\n \n+                  --  -eL  Follow links for files\n+\n+                  elsif Argv.all = \"-eL\" then\n+                     Follow_Links_For_Files := True;\n+\n+                     Remove_Switch (Arg_Num);\n+\n                   --  -vPx  Specify verbosity while parsing project files\n \n                   elsif Argv'Length = 4"}, {"sha": "299e682bdc5d91d2b51b99f23da6e1d86bf0bcd8", "filename": "gcc/ada/gnatname.adb", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fgnatname.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fgnatname.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatname.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -27,6 +27,7 @@ with Hostparm;\n with Opt;\n with Osint;    use Osint;\n with Output;   use Output;\n+with Prj;      use Prj;\n with Prj.Makr;\n with Switch;   use Switch;\n with Table;\n@@ -194,10 +195,15 @@ procedure Gnatname is\n       --  Scan options first\n \n       loop\n-         case Getopt (\"c: d: gnatep=! gnatep! gnateD! D: h P: v x: f:\") is\n+         case Getopt\n+           (\"-subdirs=! c: d: gnatep=! gnatep! gnateD! eL D: h P: v x: f:\")\n+         is\n             when ASCII.NUL =>\n                exit;\n \n+            when '-' =>\n+               Subdirs := new String'(Parameter);\n+\n             when 'c' =>\n                if File_Set then\n                   Fail (\"only one -P or -c switch may be specified\");\n@@ -213,6 +219,9 @@ procedure Gnatname is\n             when 'D' =>\n                Get_Directories (Parameter);\n \n+            when 'e' =>\n+               Opt.Follow_Links_For_Files := True;\n+\n             when 'f' =>\n                Foreign_Patterns.Increment_Last;\n                Foreign_Patterns.Table (Foreign_Patterns.Last) :=\n@@ -286,10 +295,15 @@ procedure Gnatname is\n          Write_Eol;\n          Write_Line (\"switches:\");\n \n+         Write_Line (\"  --subdirs=dir real obj/lib/exec dirs are subdirs\");\n+         Write_Eol;\n+\n          Write_Line (\"  -cfile       create configuration pragmas file\");\n          Write_Line (\"  -ddir        use dir as one of the source \" &\n                      \"directories\");\n          Write_Line (\"  -Dfile       get source directories from file\");\n+         Write_Line (\"  -eL          follow symbolic links when processing \" &\n+                     \"project files\");\n          Write_Line (\"  -fpat        foreign pattern\");\n          Write_Line (\"  -gnateDsym=v preprocess with symbol definition\");\n          Write_Line (\"  -gnatep=data preprocess files with data file\");"}, {"sha": "684cae99eb8b491753679a48fcb66ddc040ca18c", "filename": "gcc/ada/makegpr.adb", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fmakegpr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fmakegpr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakegpr.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2004-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2004-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -283,6 +283,8 @@ package body Makegpr is\n    Dash_cargs        : constant String_Access := Dash_cargs_String'Access;\n    Dash_d_String     : aliased  String := \"-d\";\n    Dash_d            : constant String_Access := Dash_d_String'Access;\n+   Dash_eL_String    : aliased  String := \"-eL\";\n+   Dash_eL           : constant String_Access := Dash_eL_String'Access;\n    Dash_f_String     : aliased  String := \"-f\";\n    Dash_f            : constant String_Access := Dash_f_String'Access;\n    Dash_k_String     : aliased  String := \"-k\";\n@@ -2609,6 +2611,12 @@ package body Makegpr is\n          Add_Argument (Dash_d, True);\n       end if;\n \n+      --  -eL\n+\n+      if Follow_Links_For_Files then\n+         Add_Argument (Dash_eL, True);\n+      end if;\n+\n       --  -k\n \n       if Keep_Going then\n@@ -3375,8 +3383,8 @@ package body Makegpr is\n \n       --  Add the directory where gprmake is invoked in front of the path,\n       --  if gprmake is invoked from a bin directory or with directory\n-      --  information. Only do this if the platform is not VMS,\n-      --  where the notion of path does not really exist.\n+      --  information. Only do this if the platform is not VMS, where the\n+      --  notion of path does not really exist.\n \n       --  Below code shares nasty code duplication with make.adb code???\n \n@@ -4231,6 +4239,9 @@ package body Makegpr is\n          elsif Arg = \"-d\" then\n             Display_Compilation_Progress := True;\n \n+         elsif Arg = \"-eL\" then\n+            Follow_Links_For_Files := True;\n+\n          elsif Arg = \"-f\" then\n             Force_Compilations := True;\n \n@@ -4370,6 +4381,12 @@ package body Makegpr is\n          Write_Str (\"  -c       Compile only\");\n          Write_Eol;\n \n+         --  Line for -eL\n+\n+         Write_Str (\"  -eL      Follow symbolic links when processing \" &\n+                    \"project files\");\n+         Write_Eol;\n+\n          --  Line for -f\n \n          Write_Str (\"  -f       Force recompilations\");"}, {"sha": "ca22dceec9cd982253adbb9d3ed85be4a9942416", "filename": "gcc/ada/makeusg.adb", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fmakeusg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fmakeusg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeusg.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -306,6 +306,11 @@ begin\n    Write_Str (\"  --RTS=dir specify the default source and object search\"\n               & \" path\");\n    Write_Eol;\n+\n+   --  Line for --subdirs=\n+\n+   Write_Str (\"  --subdirs=dir real obj/lib/exec dirs are subdirs\");\n+   Write_Eol;\n    Write_Eol;\n \n    --  General Compiler, Binder, Linker switches"}, {"sha": "d3ff283ada275e615aec1994692160ac3bb51525", "filename": "gcc/ada/prj-attr.adb", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -25,10 +25,13 @@\n \n with Osint;\n with Prj.Com; use Prj.Com;\n-with System.Case_Util; use System.Case_Util;\n+\n+with GNAT.Case_Util; use GNAT.Case_Util;\n \n package body Prj.Attr is\n \n+   use GNAT;\n+\n    --  Data for predefined attributes and packages\n \n    --  Names are in lower case and end with '#'\n@@ -74,6 +77,7 @@ package body Prj.Attr is\n    \"SVobject_dir#\" &\n    \"SVexec_dir#\" &\n    \"LVsource_dirs#\" &\n+   \"Lainherit_source_path#\" &\n    \"LVexcluded_source_dirs#\" &\n \n    --  Source files\n@@ -114,6 +118,7 @@ package body Prj.Attr is\n    --  Configuration - Archives\n \n    \"LVarchive_builder#\" &\n+   \"LVarchive_builder_append_option#\" &\n    \"LVarchive_indexer#\" &\n    \"SVarchive_suffix#\" &\n    \"LVlibrary_partial_linker#\" &"}, {"sha": "473ea53dd8ceda1be9c9c9541a978458cdf5aecc", "filename": "gcc/ada/prj-attr.ads", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-attr.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-attr.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-attr.ads?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -28,14 +28,13 @@\n \n --  It is also possible to define new packages with their attributes\n \n-with System.Strings;\n with Table;\n \n-package Prj.Attr is\n+with GNAT.Strings;\n \n-   use System;\n+package Prj.Attr is\n \n-   function Package_Name_List return Strings.String_List;\n+   function Package_Name_List return GNAT.Strings.String_List;\n    --  Returns the list of valid package names, including those added by\n    --  procedures Register_New_Package below. The String_Access components of\n    --  the returned String_List should never be freed.\n@@ -55,6 +54,7 @@ package Prj.Attr is\n    --  Characteristics of an attribute. Optional_Index indicates that there\n    --  may be an optional index in the index of the associative array, as in\n    --     for Switches (\"files.ada\" at 2) use ...\n+   --  Above character literals should be documented ???\n \n    subtype Defined_Attribute_Kind is Attribute_Kind\n      range Single .. Optional_Index_Case_Insensitive_Associative_Array;"}, {"sha": "593874fad02a898c61f2feb84edaa496d2bf5725", "filename": "gcc/ada/prj-dect.adb", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-dect.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-dect.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-dect.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -37,11 +37,11 @@ with Prj.Tree;    use Prj.Tree;\n with Snames;\n with Uintp;       use Uintp;\n \n-with System.Strings;\n+with GNAT.Strings;\n \n package body Prj.Dect is\n \n-   use System;\n+   use GNAT;\n \n    type Zone is (In_Project, In_Package, In_Case_Construction);\n    --  Used to indicate if we are parsing a package (In_Package),"}, {"sha": "5a7e9b97896fde1200befbf979b89c8e4883efda", "filename": "gcc/ada/prj-ext.adb", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-ext.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-ext.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-ext.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2000-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2000-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -260,19 +260,17 @@ package body Prj.Ext is\n                Prefix := new String'(Executable_Prefix_Path);\n \n                if Prefix.all /= \"\" then\n-                  if Get_Mode = Ada_Only then\n-                     Current_Project_Path :=\n-                       new String'(Name_Buffer (1 .. Name_Len) &\n-                                   Path_Separator &\n-                                   Prefix.all & Directory_Separator & \"gnat\");\n-\n-                  else\n-                     Current_Project_Path :=\n-                       new String'(Name_Buffer (1 .. Name_Len) &\n-                                   Path_Separator &\n-                                   Prefix.all & Directory_Separator &\n-                                   \"share\" & Directory_Separator & \"gpr\");\n+                  if Get_Mode = Multi_Language then\n+                     Add_Str_To_Name_Buffer\n+                       (Path_Separator & Prefix.all &\n+                        Directory_Separator & \"share\" &\n+                        Directory_Separator & \"gpr\");\n                   end if;\n+\n+                  Add_Str_To_Name_Buffer\n+                    (Path_Separator & Prefix.all &\n+                     Directory_Separator & \"lib\" &\n+                     Directory_Separator & \"gnat\");\n                end if;\n \n             else"}, {"sha": "a3e9806bf1793c6645358138850c453c8d482ebc", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 244, "deletions": 77, "changes": 321, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2000-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2000-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -610,7 +610,7 @@ package body Prj.Nmsc is\n       Src_Data : Source_Data := No_Source_Data;\n \n    begin\n-      --  This is a new source. Create an entry for it in the Sources table.\n+      --  This is a new source so create an entry for it in the Sources table\n \n       Source_Data_Table.Increment_Last (In_Tree.Sources);\n       Id := Source_Data_Table.Last (In_Tree.Sources);\n@@ -619,34 +619,41 @@ package body Prj.Nmsc is\n          Write_Str (\"Adding source #\");\n          Write_Str (Id'Img);\n          Write_Str (\", File : \");\n+         Write_Str (Get_Name_String (File_Name));\n \n          if Lang_Kind = Unit_Based then\n             Write_Str (\", Unit : \");\n             Write_Str (Get_Name_String (Unit));\n          end if;\n \n-         Write_Line (Get_Name_String (File_Name));\n+         Write_Eol;\n       end if;\n \n       Src_Data.Project             := Project;\n       Src_Data.Language_Name       := Lang;\n       Src_Data.Language            := Lang_Id;\n       Src_Data.Lang_Kind           := Lang_Kind;\n+      Src_Data.Compiled            := In_Tree.Languages_Data.Table\n+                                        (Lang_Id).Config.Compiler_Driver /=\n+                                                              Empty_File_Name;\n       Src_Data.Kind                := Kind;\n       Src_Data.Alternate_Languages := Alternate_Languages;\n       Src_Data.Other_Part          := Other_Part;\n       Src_Data.Unit                := Unit;\n       Src_Data.Index               := Index;\n       Src_Data.File                := File_Name;\n-      Src_Data.Object              := Object_Name (File_Name);\n       Src_Data.Display_File        := Display_File;\n-      Src_Data.Dependency          :=\n-        In_Tree.Languages_Data.Table (Lang_Id).Config.Dependency_Kind;\n-      Src_Data.Dep_Name            :=\n-        Dependency_Name (File_Name, Src_Data.Dependency);\n-      Src_Data.Switches            := Switches_Name (File_Name);\n+      Src_Data.Dependency          := In_Tree.Languages_Data.Table\n+                                        (Lang_Id).Config.Dependency_Kind;\n       Src_Data.Naming_Exception    := Naming_Exception;\n \n+      if Src_Data.Compiled then\n+         Src_Data.Object   := Object_Name (File_Name);\n+         Src_Data.Dep_Name :=\n+           Dependency_Name (File_Name, Src_Data.Dependency);\n+         Src_Data.Switches := Switches_Name (File_Name);\n+      end if;\n+\n       if Path /= No_Path then\n          Src_Data.Path           := Path;\n          Src_Data.Display_Path   := Display_Path;\n@@ -732,6 +739,15 @@ package body Prj.Nmsc is\n \n       Check_Programming_Languages (In_Tree, Project, Data);\n \n+      if Data.Qualifier = Dry and then Data.Source_Dirs /= Nil_String then\n+         Error_Msg\n+           (Project,\n+            In_Tree,\n+            \"an abstract project need to have no language, no sources or no \" &\n+            \"source directories\",\n+            Data.Location);\n+      end if;\n+\n       --  Check configuration in multi language mode\n \n       if Must_Check_Configuration then\n@@ -1475,14 +1491,6 @@ package body Prj.Nmsc is\n \n                            Get_Name_String (Element.Value.Value);\n \n-                           if Name_Len = 0 then\n-                              Error_Msg\n-                                (Project,\n-                                 In_Tree,\n-                                 \"compiler driver name cannot be empty\",\n-                                 Element.Value.Location);\n-                           end if;\n-\n                            In_Tree.Languages_Data.Table\n                              (Lang_Index).Config.Compiler_Driver :=\n                              File_Name_Type (Element.Value.Value);\n@@ -1893,6 +1901,20 @@ package body Prj.Nmsc is\n                        From_List => List,\n                        In_Tree   => In_Tree);\n \n+               elsif Attribute.Name = Name_Archive_Builder_Append_Option then\n+\n+                  --  Attribute Archive_Builder: the archive builder\n+                  --  (usually \"ar\") and its minimum options (usually \"cr\").\n+\n+                  List := Attribute.Value.Values;\n+\n+                  if List /= Nil_String then\n+                     Put\n+                       (Into_List => Data.Config.Archive_Builder_Append_Option,\n+                        From_List => List,\n+                        In_Tree   => In_Tree);\n+                  end if;\n+\n                elsif Attribute.Name = Name_Archive_Indexer then\n \n                   --  Attribute Archive_Indexer: the optional archive\n@@ -2043,9 +2065,9 @@ package body Prj.Nmsc is\n                         Error_Msg\n                           (Project,\n                            In_Tree,\n-                           \"invalid value \"\"\" &\n-                           Get_Name_String (Attribute.Value.Value) &\n-                           \"\"\" for Symbolic_Link_Supported\",\n+                           \"invalid value \"\"\"\n+                             & Get_Name_String (Attribute.Value.Value)\n+                             & \"\"\" for Symbolic_Link_Supported\",\n                            Attribute.Value.Location);\n                   end;\n \n@@ -2069,29 +2091,24 @@ package body Prj.Nmsc is\n                            Attribute.Value.Location);\n                   end;\n \n-               elsif\n-                 Attribute.Name = Name_Library_Auto_Init_Supported\n-               then\n+               elsif Attribute.Name = Name_Library_Auto_Init_Supported then\n                   declare\n                      pragma Unsuppress (All_Checks);\n                   begin\n                      Data.Config.Auto_Init_Supported :=\n-                       Boolean'Value (Get_Name_String\n-                                      (Attribute.Value.Value));\n+                       Boolean'Value (Get_Name_String (Attribute.Value.Value));\n                   exception\n                      when Constraint_Error =>\n                         Error_Msg\n                           (Project,\n                            In_Tree,\n-                           \"invalid value \"\"\" &\n-                           Get_Name_String (Attribute.Value.Value) &\n-                           \"\"\" for Library_Auto_Init_Supported\",\n+                           \"invalid value \"\"\"\n+                             & Get_Name_String (Attribute.Value.Value)\n+                             & \"\"\" for Library_Auto_Init_Supported\",\n                            Attribute.Value.Location);\n                   end;\n \n-               elsif\n-                 Attribute.Name = Name_Shared_Library_Minimum_Switches\n-               then\n+               elsif Attribute.Name = Name_Shared_Library_Minimum_Switches then\n                   List := Attribute.Value.Values;\n \n                   if List /= Nil_String then\n@@ -2100,9 +2117,7 @@ package body Prj.Nmsc is\n                           In_Tree   => In_Tree);\n                   end if;\n \n-               elsif\n-                 Attribute.Name = Name_Library_Version_Switches\n-               then\n+               elsif Attribute.Name = Name_Library_Version_Switches then\n                   List := Attribute.Value.Values;\n \n                   if List /= Nil_String then\n@@ -2126,6 +2141,7 @@ package body Prj.Nmsc is\n          Current_Array    : Array_Data;\n          Element_Id       : Array_Element_Id;\n          Element          : Array_Element;\n+         List             : String_List_Id;\n \n       begin\n          --  Process the associative array attributes at project level\n@@ -2144,6 +2160,19 @@ package body Prj.Nmsc is\n \n                if Lang_Index /= No_Language_Index then\n                   case Current_Array.Name is\n+                     when Name_Inherit_Source_Path =>\n+                        List := Element.Value.Values;\n+\n+                        if List /= Nil_String then\n+                           Put\n+                             (Into_List  =>\n+                                In_Tree.Languages_Data.Table (Lang_Index).\n+                                  Config.Include_Compatible_Languages,\n+                              From_List  => List,\n+                              In_Tree    => In_Tree,\n+                              Lower_Case => True);\n+                        end if;\n+\n                      when Name_Toolchain_Description =>\n \n                         --  Attribute Toolchain_Description (<language>)\n@@ -2613,6 +2642,14 @@ package body Prj.Nmsc is\n          end if;\n       end if;\n \n+      --  A virtual project extending an externally built project is itself\n+      --  externally built.\n+\n+      if Data.Virtual and then Data.Extends /= No_Project then\n+         Data.Externally_Built :=\n+           In_Tree.Projects.Table (Data.Extends).Externally_Built;\n+      end if;\n+\n       if Current_Verbosity = High then\n          Write_Str (\"Project is \");\n \n@@ -2946,12 +2983,12 @@ package body Prj.Nmsc is\n \n                      else\n                         Error_Msg_Name_1 := Unit;\n-\n+                        Error_Msg_Name_2 :=\n+                          In_Tree.Projects.Table (Other_Project).Name;\n                         Error_Msg\n                           (Project,\n                            In_Tree,\n-                           \"unit%% cannot belong to two projects \" &\n-                           \"simultaneously\",\n+                           \"%% is already a source of project %%\",\n                            Element.Value.Location);\n                      end if;\n                   end if;\n@@ -3534,6 +3571,8 @@ package body Prj.Nmsc is\n \n       Support_For_Libraries : Library_Support;\n \n+      Library_Directory_Present : Boolean;\n+\n       procedure Check_Library (Proj : Project_Id; Extends : Boolean);\n       --  Check if an imported or extended project if also a library project\n \n@@ -3543,17 +3582,30 @@ package body Prj.Nmsc is\n \n       procedure Check_Library (Proj : Project_Id; Extends : Boolean) is\n          Proj_Data : Project_Data;\n+         Src_Id    : Source_Id;\n+         Src       : Source_Data;\n \n       begin\n          if Proj /= No_Project then\n             Proj_Data := In_Tree.Projects.Table (Proj);\n \n             if not Proj_Data.Library then\n+\n                --  The only not library projects that are OK are those that\n-               --  have no sources.\n+               --  have no sources. However, header files from non-Ada\n+               --  languages are OK, as there is nothing to compile.\n+\n+               Src_Id := Proj_Data.First_Source;\n+               while Src_Id /= No_Source loop\n+                  Src := In_Tree.Sources.Table (Src_Id);\n+\n+                  exit when Src.Lang_Kind /= File_Based\n+                    or else Src.Kind /= Spec;\n \n-               if Proj_Data.Source_Dirs /= Nil_String then\n+                  Src_Id := Src.Next_In_Project;\n+               end loop;\n \n+               if Src_Id /= No_Source then\n                   Error_Msg_Name_1 := Data.Name;\n                   Error_Msg_Name_2 := Proj_Data.Name;\n \n@@ -3608,6 +3660,8 @@ package body Prj.Nmsc is\n    --  Start of processing for Check_Library_Attributes\n \n    begin\n+      Library_Directory_Present := Lib_Dir.Value /= Empty_String;\n+\n       --  Special case of extending project\n \n       if Data.Extends /= No_Project then\n@@ -3621,17 +3675,34 @@ package body Prj.Nmsc is\n             --  directory is specified.\n \n             if Extended_Data.Library then\n-               if Lib_Name.Default then\n-                  Data.Library_Name := Extended_Data.Library_Name;\n-               end if;\n+               if Data.Qualifier = Standard then\n+                  Error_Msg\n+                    (Project, In_Tree,\n+                     \"a standard project cannot extend a library project\",\n+                     Data.Location);\n \n-               if Lib_Dir.Default then\n-                  if not Data.Virtual then\n-                     Error_Msg\n-                       (Project, In_Tree,\n-                        \"a project extending a library project must \" &\n-                        \"specify an attribute Library_Dir\",\n-                        Data.Location);\n+               else\n+                  if Lib_Name.Default then\n+                     Data.Library_Name := Extended_Data.Library_Name;\n+                  end if;\n+\n+                  if Lib_Dir.Default then\n+                     if not Data.Virtual then\n+                        Error_Msg\n+                          (Project, In_Tree,\n+                           \"a project extending a library project must \" &\n+                           \"specify an attribute Library_Dir\",\n+                           Data.Location);\n+\n+                     else\n+                        --  For a virtual project extending a library project,\n+                        --  inherit library directory.\n+\n+                        Data.Library_Dir := Extended_Data.Library_Dir;\n+                        Data.Display_Library_Dir :=\n+                          Extended_Data.Display_Library_Dir;\n+                        Library_Directory_Present := True;\n+                     end if;\n                   end if;\n                end if;\n             end if;\n@@ -3662,24 +3733,26 @@ package body Prj.Nmsc is\n \n          pragma Assert (Lib_Dir.Kind = Single);\n \n-         if Lib_Dir.Value = Empty_String then\n+         if not Library_Directory_Present then\n             if Current_Verbosity = High then\n                Write_Line (\"No library directory\");\n             end if;\n \n          else\n-            --  Find path name, check that it is a directory\n+            --  Find path name (unless inherited), check that it is a directory\n \n-            Locate_Directory\n-              (Project,\n-               In_Tree,\n-               File_Name_Type (Lib_Dir.Value),\n-               Data.Display_Directory,\n-               Data.Library_Dir,\n-               Data.Display_Library_Dir,\n-               Create   => \"library\",\n-               Current_Dir => Current_Dir,\n-               Location => Lib_Dir.Location);\n+            if Data.Library_Dir = No_Path then\n+               Locate_Directory\n+                 (Project,\n+                  In_Tree,\n+                  File_Name_Type (Lib_Dir.Value),\n+                  Data.Display_Directory,\n+                  Data.Library_Dir,\n+                  Data.Display_Library_Dir,\n+                  Create      => \"library\",\n+                  Current_Dir => Current_Dir,\n+                  Location    => Lib_Dir.Location);\n+            end if;\n \n             if Data.Library_Dir = No_Path then\n \n@@ -3817,6 +3890,30 @@ package body Prj.Nmsc is\n         and then\n       Data.Library_Name /= No_Name;\n \n+      if Data.Extends = No_Project then\n+         case Data.Qualifier is\n+            when Standard =>\n+               if Data.Library then\n+                  Error_Msg\n+                    (Project, In_Tree,\n+                     \"a standard project cannot be a library project\",\n+                     Lib_Name.Location);\n+               end if;\n+\n+            when Library =>\n+               if not Data.Library then\n+                  Error_Msg\n+                    (Project, In_Tree,\n+                     \"not a library project\",\n+                     Data.Location);\n+               end if;\n+\n+            when others =>\n+               null;\n+\n+         end case;\n+      end if;\n+\n       if Data.Library then\n          if Get_Mode = Multi_Language then\n             Support_For_Libraries := Data.Config.Lib_Support;\n@@ -4426,6 +4523,14 @@ package body Prj.Nmsc is\n                if Current = Nil_String then\n                   Data.Source_Dirs := Nil_String;\n \n+                  if Data.Qualifier = Standard then\n+                     Error_Msg\n+                       (Project,\n+                        In_Tree,\n+                        \"a standard project cannot have no language declared\",\n+                        Languages.Location);\n+                  end if;\n+\n                else\n                   --  Look through all the languages specified in attribute\n                   --  Languages.\n@@ -6259,6 +6364,20 @@ package body Prj.Nmsc is\n                end if;\n             end if;\n          end if;\n+\n+      elsif Subdirs /= null then\n+         Name_Len := 1;\n+         Name_Buffer (1) := '.';\n+         Locate_Directory\n+           (Project,\n+            In_Tree,\n+            Name_Find,\n+            Data.Display_Directory,\n+            Data.Object_Directory,\n+            Data.Display_Object_Dir,\n+            Create      => \"object\",\n+            Location    => Object_Dir.Location,\n+            Current_Dir => Current_Dir);\n       end if;\n \n       if Current_Verbosity = High then\n@@ -6291,7 +6410,7 @@ package body Prj.Nmsc is\n                Exec_Dir.Location);\n \n          else\n-            --  We check that the specified object directory does exist\n+            --  We check that the specified exec directory does exist\n \n             Locate_Directory\n               (Project,\n@@ -6337,6 +6456,14 @@ package body Prj.Nmsc is\n       then\n          Data.Source_Dirs := Nil_String;\n \n+         if Data.Qualifier = Standard then\n+            Error_Msg\n+              (Project,\n+               In_Tree,\n+               \"a standard project cannot have no sources\",\n+               Source_Files.Location);\n+         end if;\n+\n          if Data.Extends = No_Project\n            and then Data.Object_Directory = Data.Directory\n          then\n@@ -6368,6 +6495,13 @@ package body Prj.Nmsc is\n          end if;\n \n       elsif Source_Dirs.Values = Nil_String then\n+         if Data.Qualifier = Standard then\n+            Error_Msg\n+              (Project,\n+               In_Tree,\n+               \"a standard project cannot have no source directories\",\n+               Source_Dirs.Location);\n+         end if;\n \n          --  If Source_Dirs is an empty string list, this means that this\n          --  project contains no source. For projects that don't extend other\n@@ -6940,8 +7074,6 @@ package body Prj.Nmsc is\n       Current_Dir : String;\n       Location    : Source_Ptr := No_Location)\n    is\n-      The_Name        : String := Get_Name_String (Name);\n-\n       The_Parent      : constant String :=\n                           Get_Name_String (Parent) & Directory_Separator;\n \n@@ -6950,18 +7082,35 @@ package body Prj.Nmsc is\n \n       Full_Name       : File_Name_Type;\n \n+      The_Name        : File_Name_Type;\n+\n    begin\n+      Get_Name_String (Name);\n+\n+      --  Add Subdirs.all if it is a directory that may be created and\n+      --  Subdirs is not null;\n+\n+      if Create /= \"\" and then Subdirs /= null then\n+         if Name_Buffer (Name_Len) /= Directory_Separator then\n+            Add_Char_To_Name_Buffer (Directory_Separator);\n+         end if;\n+\n+         Add_Str_To_Name_Buffer (Subdirs.all);\n+      end if;\n+\n       --  Convert '/' to directory separator (for Windows)\n \n-      for J in The_Name'Range loop\n-         if The_Name (J) = '/' then\n-            The_Name (J) := Directory_Separator;\n+      for J in 1 .. Name_Len loop\n+         if Name_Buffer (J) = '/' then\n+            Name_Buffer (J) := Directory_Separator;\n          end if;\n       end loop;\n \n+      The_Name := Name_Find;\n+\n       if Current_Verbosity = High then\n          Write_Str (\"Locate_Directory (\"\"\");\n-         Write_Str (The_Name);\n+         Write_Str (Get_Name_String (The_Name));\n          Write_Str (\"\"\", \"\"\");\n          Write_Str (The_Parent);\n          Write_Line (\"\"\")\");\n@@ -6970,22 +7119,23 @@ package body Prj.Nmsc is\n       Dir     := No_Path;\n       Display := No_Path;\n \n-      if Is_Absolute_Path (The_Name) then\n-         Full_Name := Name;\n+      if Is_Absolute_Path (Get_Name_String (The_Name)) then\n+         Full_Name := The_Name;\n \n       else\n          Name_Len := 0;\n          Add_Str_To_Name_Buffer\n            (The_Parent (The_Parent'First .. The_Parent_Last));\n-         Add_Str_To_Name_Buffer (The_Name);\n+         Add_Str_To_Name_Buffer (Get_Name_String (The_Name));\n          Full_Name := Name_Find;\n       end if;\n \n       declare\n          Full_Path_Name : constant String := Get_Name_String (Full_Name);\n \n       begin\n-         if Setup_Projects and then Create'Length > 0\n+         if (Setup_Projects or else Subdirs /= null)\n+           and then Create'Length > 0\n            and then not Is_Directory (Full_Path_Name)\n          then\n             begin\n@@ -7331,7 +7481,7 @@ package body Prj.Nmsc is\n         and then Lang = Ada_Language_Index\n         and then Data.Extends = No_Project\n       then\n-         --  We should have found at least one source. If not, report an error.\n+         --  We should have found at least one source, if not report an error\n \n          if Data.Ada_Sources = Nil_String then\n             Report_No_Sources\n@@ -7979,8 +8129,10 @@ package body Prj.Nmsc is\n             Kind                  => Kind);\n \n          if Language = No_Language_Index then\n+\n+            --  A file name in a list must be a source of a language\n+\n             if Name_Loc.Found then\n-               --  A file name in a list must be a source of a language.\n                Error_Msg_File_1 := File_Name;\n                Error_Msg\n                  (Project,\n@@ -8045,9 +8197,24 @@ package body Prj.Nmsc is\n                      Error_Msg_Name_1 := Unit;\n                      Error_Msg\n                        (Project, In_Tree,\n-                        \"unit %% cannot belong to \" &\n-                        \"several projects\",\n+                        \"unit %% cannot belong to several projects\",\n                         No_Location);\n+\n+                     Error_Msg_Name_1 := In_Tree.Projects.Table (Project).Name;\n+                     Error_Msg_Name_2 := Name_Id (Display_Path_Id);\n+                     Error_Msg\n+                       (Project, In_Tree,\n+                        \"\\  project %%, %%\",\n+                        No_Location);\n+\n+                     Error_Msg_Name_1 :=\n+                       In_Tree.Projects.Table (Src_Data.Project).Name;\n+                     Error_Msg_Name_2 := Name_Id (Src_Data.Display_Path);\n+                     Error_Msg\n+                       (Project, In_Tree,\n+                        \"\\  project %%, %%\",\n+                        No_Location);\n+\n                      Add_Src := False;\n                   end if;\n                end if;\n@@ -8847,7 +9014,7 @@ package body Prj.Nmsc is\n \n                      Err_Vars.Error_Msg_Name_1 := Unit_Name;\n                      Error_Msg\n-                       (Project, In_Tree, \"duplicate source %%\", The_Location);\n+                       (Project, In_Tree, \"duplicate unit %%\", The_Location);\n \n                      Err_Vars.Error_Msg_Name_1 :=\n                        In_Tree.Projects.Table"}, {"sha": "00f3c32ba3ce3aaf0e022adc51e8dc6a3ff8c6bd", "filename": "gcc/ada/prj-part.adb", "status": "modified", "additions": 61, "deletions": 3, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-part.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-part.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-part.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -945,6 +945,9 @@ package body Prj.Part is\n \n       Project_Comment_State : Tree.Comment_State;\n \n+      Proj_Qualifier     : Project_Qualifier := Unspecified;\n+      Qualifier_Location : Source_Ptr;\n+\n    begin\n       Extends_All := False;\n \n@@ -1119,8 +1122,63 @@ package body Prj.Part is\n       Project_Stack.Table (Project_Stack.Last).Id := Project;\n       Set_Directory_Of (Project, In_Tree, Project_Directory);\n       Set_Path_Name_Of (Project, In_Tree,  Normed_Path_Name);\n-      Set_Location_Of (Project, In_Tree, Token_Ptr);\n       Set_First_With_Clause_Of (Project, In_Tree, Imported_Projects);\n+\n+      --  Check if there is a qualifier before the reserved word \"project\"\n+\n+      Qualifier_Location := Token_Ptr;\n+\n+      if Token = Tok_Abstract then\n+         Proj_Qualifier := Dry;\n+         Scan (In_Tree);\n+\n+      elsif Token = Tok_Identifier then\n+         case Token_Name is\n+            when Snames.Name_Standard =>\n+               Proj_Qualifier := Standard;\n+               Scan (In_Tree);\n+\n+            when Snames.Name_Aggregate =>\n+               Proj_Qualifier := Aggregate;\n+               Scan (In_Tree);\n+\n+               if Token = Tok_Identifier and then\n+                 Token_Name = Snames.Name_Library\n+               then\n+                  Proj_Qualifier := Aggregate_Library;\n+                  Scan (In_Tree);\n+               end if;\n+\n+            when Snames.Name_Library =>\n+               Proj_Qualifier := Library;\n+               Scan (In_Tree);\n+\n+            when Snames.Name_Configuration =>\n+               if not In_Configuration then\n+                  Error_Msg (\"configuration projects cannot belong to a user\" &\n+                             \" project tree\",\n+                             Token_Ptr);\n+               end if;\n+\n+               Scan (In_Tree);\n+\n+            when others =>\n+               null;\n+         end case;\n+      end if;\n+\n+      if Proj_Qualifier /= Unspecified then\n+         if In_Configuration then\n+            Error_Msg (\"a configuration project cannot be qualified except \" &\n+                       \"as configuration project\",\n+                       Qualifier_Location);\n+         end if;\n+\n+         Set_Project_Qualifier_Of (Project, In_Tree, Proj_Qualifier);\n+      end if;\n+\n+      Set_Location_Of (Project, In_Tree, Token_Ptr);\n+\n       Expect (Tok_Project, \"PROJECT\");\n \n       --  Mark location of PROJECT token if present\n@@ -1780,7 +1838,7 @@ package body Prj.Part is\n       begin\n          if Current_Verbosity = High then\n             Write_Str  (\"   Trying \");\n-            Write_Str  (Path);\n+            Write_Line (Path);\n          end if;\n \n          return Locate_Regular_File"}, {"sha": "638bf18ca4890960c2769c6bfc41b5ccb01679d9", "filename": "gcc/ada/prj-proc.adb", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-proc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-proc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -1621,8 +1621,11 @@ package body Prj.Proc is\n                               if Next_Element = No_Array_Element then\n                                  Array_Element_Table.Increment_Last\n                                    (In_Tree.Array_Elements);\n-                                 New_Element := Array_Element_Table.Last\n-                                   (In_Tree.Array_Elements);\n+                                 New_Element :=\n+                                   Array_Element_Table.Last\n+                                    (In_Tree.Array_Elements);\n+                                 In_Tree.Array_Elements.Table\n+                                   (Prev_Element).Next := New_Element;\n \n                               else\n                                  New_Element := Next_Element;\n@@ -1636,8 +1639,7 @@ package body Prj.Proc is\n \n                            In_Tree.Array_Elements.Table\n                              (New_Element) :=\n-                               In_Tree.Array_Elements.Table\n-                                 (Orig_Element);\n+                               In_Tree.Array_Elements.Table (Orig_Element);\n                            In_Tree.Array_Elements.Table\n                              (New_Element).Value.Project := Project;\n \n@@ -1872,9 +1874,7 @@ package body Prj.Proc is\n \n                         else\n                            In_Tree.Variable_Elements.Table\n-                             (The_Variable).Value :=\n-                                New_Value;\n-\n+                             (The_Variable).Value := New_Value;\n                         end if;\n \n                      --  Associative array attribute\n@@ -2524,7 +2524,11 @@ package body Prj.Proc is\n             Processed_Projects.Set (Name, Project);\n \n             Processed_Data.Name := Name;\n+            Processed_Data.Qualifier :=\n+              Project_Qualifier_Of (From_Project_Node, From_Project_Node_Tree);\n             In_Tree.Projects.Table (Project).Name := Name;\n+            In_Tree.Projects.Table (Project).Qualifier :=\n+              Processed_Data.Qualifier;\n \n             Get_Name_String (Name);\n \n@@ -2786,6 +2790,8 @@ package body Prj.Proc is\n                      end if;\n                   end if;\n                end;\n+\n+               In_Tree.Projects.Table (Project) := Processed_Data;\n             end if;\n \n             --  Process limited withed projects"}, {"sha": "83ee5f936b6144000b89f0c3ba3f670272aba93b", "filename": "gcc/ada/prj-tree.adb", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-tree.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-tree.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-tree.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -108,6 +108,7 @@ package body Prj.Tree is\n          In_Tree.Project_Nodes.Table\n            (Project_Node_Table.Last (In_Tree.Project_Nodes)) :=\n            (Kind             => N_Comment_Zones,\n+            Qualifier        => Unspecified,\n             Expr_Kind        => Undefined,\n             Location         => No_Location,\n             Directory        => No_Path,\n@@ -153,6 +154,7 @@ package body Prj.Tree is\n             In_Tree.Project_Nodes.Table\n               (Project_Node_Table.Last (In_Tree.Project_Nodes)) :=\n               (Kind             => N_Comment,\n+               Qualifier        => Unspecified,\n                Expr_Kind        => Undefined,\n                Flag1            => Comments.Table (J).Follows_Empty_Line,\n                Flag2            =>\n@@ -321,6 +323,7 @@ package body Prj.Tree is\n          Zone := Project_Node_Table.Last (In_Tree.Project_Nodes);\n          In_Tree.Project_Nodes.Table (Zone) :=\n         (Kind             => N_Comment_Zones,\n+         Qualifier        => Unspecified,\n          Location         => No_Location,\n          Directory        => No_Path,\n          Expr_Kind        => Undefined,\n@@ -395,6 +398,7 @@ package body Prj.Tree is\n       In_Tree.Project_Nodes.Table\n         (Project_Node_Table.Last (In_Tree.Project_Nodes)) :=\n         (Kind             => Of_Kind,\n+         Qualifier        => Unspecified,\n          Location         => No_Location,\n          Directory        => No_Path,\n          Expr_Kind        => And_Expr_Kind,\n@@ -429,6 +433,7 @@ package body Prj.Tree is\n             In_Tree.Project_Nodes.Table\n               (Project_Node_Table.Last (In_Tree.Project_Nodes)) :=\n               (Kind             => N_Comment_Zones,\n+               Qualifier        => Unspecified,\n                Expr_Kind        => Undefined,\n                Location         => No_Location,\n                Directory        => No_Path,\n@@ -458,6 +463,7 @@ package body Prj.Tree is\n                In_Tree.Project_Nodes.Table\n                  (Project_Node_Table.Last (In_Tree.Project_Nodes)) :=\n                  (Kind             => N_Comment,\n+                  Qualifier        => Unspecified,\n                   Expr_Kind        => Undefined,\n                   Flag1            => Comments.Table (J).Follows_Empty_Line,\n                   Flag2            =>\n@@ -1352,6 +1358,22 @@ package body Prj.Tree is\n       return In_Tree.Project_Nodes.Table (Node).Field2;\n    end Project_Declaration_Of;\n \n+   --------------------------\n+   -- Project_Qualifier_Of --\n+   --------------------------\n+\n+   function Project_Qualifier_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref) return Project_Qualifier\n+   is\n+   begin\n+      pragma Assert\n+        (Node /= Empty_Node\n+          and then\n+            In_Tree.Project_Nodes.Table (Node).Kind = N_Project);\n+      return In_Tree.Project_Nodes.Table (Node).Qualifier;\n+   end Project_Qualifier_Of;\n+\n    -------------------------------------------\n    -- Project_File_Includes_Unkept_Comments --\n    -------------------------------------------\n@@ -2467,6 +2489,22 @@ package body Prj.Tree is\n       In_Tree.Project_Nodes.Table (Node).Field2 := To;\n    end Set_Project_Declaration_Of;\n \n+   ------------------------------\n+   -- Set_Project_Qualifier_Of --\n+   ------------------------------\n+\n+   procedure Set_Project_Qualifier_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref;\n+      To      : Project_Qualifier)\n+   is\n+   begin\n+      pragma Assert\n+        (Node /= Empty_Node\n+          and then In_Tree.Project_Nodes.Table (Node).Kind = N_Project);\n+      In_Tree.Project_Nodes.Table (Node).Qualifier := To;\n+   end Set_Project_Qualifier_Of;\n+\n    -----------------------------------------------\n    -- Set_Project_File_Includes_Unkept_Comments --\n    -----------------------------------------------"}, {"sha": "9649adddec89438585198d1ccb71e85228ea586e", "filename": "gcc/ada/prj-tree.ads", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-tree.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj-tree.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-tree.ads?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -344,6 +344,12 @@ package Prj.Tree is\n    pragma Inline (Project_Declaration_Of);\n    --  Only valid for N_Project nodes\n \n+   function Project_Qualifier_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref) return Project_Qualifier;\n+   pragma Inline (Project_Qualifier_Of);\n+   --  Only valid for N_Project nodes\n+\n    function Extending_Project_Of\n      (Node    : Project_Node_Id;\n       In_Tree : Project_Node_Tree_Ref) return Project_Node_Id;\n@@ -694,6 +700,12 @@ package Prj.Tree is\n       To      : Project_Node_Id);\n    pragma Inline (Set_Project_Declaration_Of);\n \n+   procedure Set_Project_Qualifier_Of\n+     (Node    : Project_Node_Id;\n+      In_Tree : Project_Node_Tree_Ref;\n+      To      : Project_Qualifier);\n+   pragma Inline (Set_Project_Qualifier_Of);\n+\n    procedure Set_Extending_Project_Of\n      (Node    : Project_Node_Id;\n       In_Tree : Project_Node_Tree_Ref;\n@@ -912,6 +924,8 @@ package Prj.Tree is\n \n          Kind : Project_Node_Kind;\n \n+         Qualifier : Project_Qualifier := Unspecified;\n+\n          Location : Source_Ptr := No_Location;\n \n          Directory : Path_Name_Type := No_Path;"}, {"sha": "a362fb8bd227347b55dc5ef8861e0e2b7c51cf69", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 83, "deletions": 80, "changes": 163, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -88,84 +88,87 @@ package body Prj is\n                         Supp_Suffixes             => No_Supp_Language_Index);\n \n    Project_Empty : constant Project_Data :=\n-     (Externally_Built               => False,\n-      Config                         => Default_Project_Config,\n-      Languages                      => No_Name_List,\n-      First_Referred_By              => No_Project,\n-      Name                           => No_Name,\n-      Display_Name                   => No_Name,\n-      Path_Name                      => No_Path,\n-      Display_Path_Name              => No_Path,\n-      Virtual                        => False,\n-      Location                       => No_Location,\n-      Mains                          => Nil_String,\n-      Directory                      => No_Path,\n-      Display_Directory              => No_Path,\n-      Dir_Path                       => null,\n-      Library                        => False,\n-      Library_Dir                    => No_Path,\n-      Display_Library_Dir            => No_Path,\n-      Library_Src_Dir                => No_Path,\n-      Display_Library_Src_Dir        => No_Path,\n-      Library_ALI_Dir                => No_Path,\n-      Display_Library_ALI_Dir        => No_Path,\n-      Library_Name                   => No_Name,\n-      Library_Kind                   => Static,\n-      Lib_Internal_Name              => No_Name,\n-      Standalone_Library             => False,\n-      Lib_Interface_ALIs             => Nil_String,\n-      Lib_Auto_Init                  => False,\n-      Libgnarl_Needed                => Unknown,\n-      Symbol_Data                    => No_Symbols,\n-      Ada_Sources                    => Nil_String,\n-      Sources                        => Nil_String,\n-      First_Source                   => No_Source,\n-      Last_Source                    => No_Source,\n-      Unit_Based_Language_Name       => No_Name,\n-      Unit_Based_Language_Index      => No_Language_Index,\n-      Imported_Directories_Switches  => null,\n-      Include_Path                   => null,\n-      Include_Data_Set               => False,\n-      Include_Language               => No_Language_Index,\n-      Source_Dirs                    => Nil_String,\n-      Known_Order_Of_Source_Dirs     => True,\n-      Object_Directory               => No_Path,\n-      Display_Object_Dir             => No_Path,\n-      Library_TS                     => Empty_Time_Stamp,\n-      Exec_Directory                 => No_Path,\n-      Display_Exec_Dir               => No_Path,\n-      Extends                        => No_Project,\n-      Extended_By                    => No_Project,\n-      Naming                         => Std_Naming_Data,\n-      First_Language_Processing      => No_Language_Index,\n-      Decl                           => No_Declarations,\n-      Imported_Projects              => Empty_Project_List,\n-      All_Imported_Projects          => Empty_Project_List,\n-      Ada_Include_Path               => null,\n-      Ada_Objects_Path               => null,\n-      Objects_Path                   => null,\n-      Include_Path_File              => No_Path,\n-      Objects_Path_File_With_Libs    => No_Path,\n-      Objects_Path_File_Without_Libs => No_Path,\n-      Config_File_Name               => No_Path,\n-      Config_File_Temp               => False,\n-      Linker_Name                    => No_File,\n-      Linker_Path                    => No_Path,\n-      Minimum_Linker_Options         => No_Name_List,\n-      Config_Checked                 => False,\n-      Checked                        => False,\n-      Seen                           => False,\n-      Need_To_Build_Lib              => False,\n-      Depth                          => 0,\n-      Unkept_Comments                => False,\n-      Langs                          => No_Languages,\n-      Supp_Languages                 => No_Supp_Language_Index,\n-      Ada_Sources_Present            => True,\n-      Other_Sources_Present          => True,\n-      First_Other_Source             => No_Other_Source,\n-      Last_Other_Source              => No_Other_Source,\n-      First_Lang_Processing          => Default_First_Language_Processing_Data,\n-      Supp_Language_Processing       => No_Supp_Language_Index);\n+                     (Qualifier                      => Unspecified,\n+                      Externally_Built               => False,\n+                      Config                         => Default_Project_Config,\n+                      Languages                      => No_Name_List,\n+                      First_Referred_By              => No_Project,\n+                      Name                           => No_Name,\n+                      Display_Name                   => No_Name,\n+                      Path_Name                      => No_Path,\n+                      Display_Path_Name              => No_Path,\n+                      Virtual                        => False,\n+                      Location                       => No_Location,\n+                      Mains                          => Nil_String,\n+                      Directory                      => No_Path,\n+                      Display_Directory              => No_Path,\n+                      Dir_Path                       => null,\n+                      Library                        => False,\n+                      Library_Dir                    => No_Path,\n+                      Display_Library_Dir            => No_Path,\n+                      Library_Src_Dir                => No_Path,\n+                      Display_Library_Src_Dir        => No_Path,\n+                      Library_ALI_Dir                => No_Path,\n+                      Display_Library_ALI_Dir        => No_Path,\n+                      Library_Name                   => No_Name,\n+                      Library_Kind                   => Static,\n+                      Lib_Internal_Name              => No_Name,\n+                      Standalone_Library             => False,\n+                      Lib_Interface_ALIs             => Nil_String,\n+                      Lib_Auto_Init                  => False,\n+                      Libgnarl_Needed                => Unknown,\n+                      Symbol_Data                    => No_Symbols,\n+                      Ada_Sources                    => Nil_String,\n+                      Sources                        => Nil_String,\n+                      First_Source                   => No_Source,\n+                      Last_Source                    => No_Source,\n+                      Unit_Based_Language_Name       => No_Name,\n+                      Unit_Based_Language_Index      => No_Language_Index,\n+                      Imported_Directories_Switches  => null,\n+                      Include_Path                   => null,\n+                      Include_Data_Set               => False,\n+                      Include_Language               => No_Language_Index,\n+                      Source_Dirs                    => Nil_String,\n+                      Known_Order_Of_Source_Dirs     => True,\n+                      Object_Directory               => No_Path,\n+                      Display_Object_Dir             => No_Path,\n+                      Library_TS                     => Empty_Time_Stamp,\n+                      Exec_Directory                 => No_Path,\n+                      Display_Exec_Dir               => No_Path,\n+                      Extends                        => No_Project,\n+                      Extended_By                    => No_Project,\n+                      Naming                         => Std_Naming_Data,\n+                      First_Language_Processing      => No_Language_Index,\n+                      Decl                           => No_Declarations,\n+                      Imported_Projects              => Empty_Project_List,\n+                      All_Imported_Projects          => Empty_Project_List,\n+                      Ada_Include_Path               => null,\n+                      Ada_Objects_Path               => null,\n+                      Objects_Path                   => null,\n+                      Include_Path_File              => No_Path,\n+                      Objects_Path_File_With_Libs    => No_Path,\n+                      Objects_Path_File_Without_Libs => No_Path,\n+                      Config_File_Name               => No_Path,\n+                      Config_File_Temp               => False,\n+                      Linker_Name                    => No_File,\n+                      Linker_Path                    => No_Path,\n+                      Minimum_Linker_Options         => No_Name_List,\n+                      Config_Checked                 => False,\n+                      Checked                        => False,\n+                      Seen                           => False,\n+                      Need_To_Build_Lib              => False,\n+                      Depth                          => 0,\n+                      Unkept_Comments                => False,\n+                      Langs                          => No_Languages,\n+                      Supp_Languages                 => No_Supp_Language_Index,\n+                      Ada_Sources_Present            => True,\n+                      Other_Sources_Present          => True,\n+                      First_Other_Source             => No_Other_Source,\n+                      Last_Other_Source              => No_Other_Source,\n+                      First_Lang_Processing          =>\n+                        Default_First_Language_Processing_Data,\n+                      Supp_Language_Processing       =>\n+                        No_Supp_Language_Index);\n \n    package Temp_Files is new Table.Table\n      (Table_Component_Type => Path_Name_Type,\n@@ -626,6 +629,7 @@ package body Prj is\n          Name_Len := 0;\n          The_Empty_String := Name_Find;\n          Empty_Name := The_Empty_String;\n+         Empty_File_Name := File_Name_Type (The_Empty_String);\n          Name_Len := 4;\n          Name_Buffer (1 .. 4) := \".ads\";\n          Default_Ada_Spec_Suffix_Id := Name_Find;\n@@ -1418,7 +1422,6 @@ package body Prj is\n       if Tree = No_Project_Tree then\n          Prj.Initialize (Tree => No_Project_Tree);\n          return Std_Naming_Data;\n-\n       else\n          return Tree.Private_Part.Default_Naming;\n       end if;"}, {"sha": "5b62ec9e017a4ee301ccdb2be4a1a5ae0f150c8f", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 121, "deletions": 73, "changes": 194, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -43,6 +43,15 @@ with System.HTable;\n \n package Prj is\n \n+   Subdirs_Option : constant String := \"--subdirs=\";\n+   --  Switch used to indicate that the real directories (object, exec,\n+   --  library, ...) are subdirectories of what is indicated in the project\n+   --  file.\n+\n+   Subdirs : String_Ptr := null;\n+   --  The value after the equal sign in switch --subdirs=...\n+   --  Contains the relative subdirectory.\n+\n    type Library_Support is (None, Static_Only, Full);\n    --  Support for Library Project File.\n    --  - None: Library Project Files are not supported at all\n@@ -55,6 +64,23 @@ package Prj is\n    --  Tri-state to decide if -lgnarl is needed when linking\n \n    type Mode is (Multi_Language, Ada_Only);\n+   --  Ada_Only: mode for gnatmake, gnatname, the GNAT driver\n+   --  Multi_Language: mode for gprbuild, gprclean\n+\n+   type Project_Qualifier is\n+     (Unspecified,\n+      Standard,\n+      Library,\n+      Dry,\n+      Aggregate,\n+      Aggregate_Library);\n+   --  Qualifiers that can prefix the reserved word \"project\" in a project\n+   --  file:\n+   --    Standard:             standard project ...\n+   --    Library:              library project is ...\n+   --    Dry:                  abstract project is\n+   --    Aggregate:            aggregate project is\n+   --    Aggregate_Library:    aggregate library project is ...\n \n    function Get_Mode return Mode;\n    pragma Inline (Get_Mode);\n@@ -373,6 +399,12 @@ package Prj is\n       Naming_Data : Lang_Naming_Data;\n       --  The naming data for the languages (prefixes, etc.)\n \n+      Include_Compatible_Languages : Name_List_Index := No_Name_List;\n+      --  The list of languages that are \"include compatible\" with this\n+      --  language. A language B (for example \"C\") is \"include compatible\" with\n+      --  a language A (for example \"C++\") if it is expected that sources of\n+      --  language A may \"include\" header files from language B.\n+\n       Compiler_Driver : File_Name_Type := No_File;\n       --  The name of the executable for the compiler of the language\n \n@@ -488,38 +520,39 @@ package Prj is\n    --  Record describing the configuration of a language\n \n    No_Language_Config : constant Language_Config :=\n-                          (Kind                       => File_Based,\n-                           Naming_Data                => No_Lang_Naming_Data,\n-                           Compiler_Driver            => No_File,\n-                           Compiler_Driver_Path       => null,\n-                           Compiler_Required_Switches => No_Name_List,\n-                           Compilation_PIC_Option     => No_Name_List,\n-                           Runtime_Library_Dir        => No_Name,\n-                           Mapping_File_Switches      => No_Name_List,\n-                           Mapping_Spec_Suffix        => No_File,\n-                           Mapping_Body_Suffix        => No_File,\n-                           Config_File_Switches       => No_Name_List,\n-                           Dependency_Kind            => Makefile,\n-                           Dependency_Option          => No_Name_List,\n-                           Compute_Dependency         => No_Name_List,\n-                           Include_Option             => No_Name_List,\n-                           Include_Path               => No_Name,\n-                           Include_Path_File          => No_Name,\n-                           Objects_Path               => No_Name,\n-                           Objects_Path_File          => No_Name,\n-                           Config_Body                => No_Name,\n-                           Config_Spec                => No_Name,\n-                           Config_Body_Pattern        => No_Name,\n-                           Config_Spec_Pattern        => No_Name,\n-                           Config_File_Unique         => False,\n-                           Binder_Driver              => No_File,\n-                           Binder_Driver_Path         => No_Path,\n-                           Binder_Required_Switches   => No_Name_List,\n-                           Binder_Prefix              => No_Name,\n-                           Toolchain_Version          => No_Name,\n-                           Toolchain_Description      => No_Name,\n-                           PIC_Option                 => No_Name,\n-                           Objects_Generated          => True);\n+                          (Kind                         => File_Based,\n+                           Naming_Data                  => No_Lang_Naming_Data,\n+                           Include_Compatible_Languages => No_Name_List,\n+                           Compiler_Driver              => No_File,\n+                           Compiler_Driver_Path         => null,\n+                           Compiler_Required_Switches   => No_Name_List,\n+                           Compilation_PIC_Option       => No_Name_List,\n+                           Runtime_Library_Dir          => No_Name,\n+                           Mapping_File_Switches        => No_Name_List,\n+                           Mapping_Spec_Suffix          => No_File,\n+                           Mapping_Body_Suffix          => No_File,\n+                           Config_File_Switches         => No_Name_List,\n+                           Dependency_Kind              => Makefile,\n+                           Dependency_Option            => No_Name_List,\n+                           Compute_Dependency           => No_Name_List,\n+                           Include_Option               => No_Name_List,\n+                           Include_Path                 => No_Name,\n+                           Include_Path_File            => No_Name,\n+                           Objects_Path                 => No_Name,\n+                           Objects_Path_File            => No_Name,\n+                           Config_Body                  => No_Name,\n+                           Config_Spec                  => No_Name,\n+                           Config_Body_Pattern          => No_Name,\n+                           Config_Spec_Pattern          => No_Name,\n+                           Config_File_Unique           => False,\n+                           Binder_Driver                => No_File,\n+                           Binder_Driver_Path           => No_Path,\n+                           Binder_Required_Switches     => No_Name_List,\n+                           Binder_Prefix                => No_Name,\n+                           Toolchain_Version            => No_Name,\n+                           Toolchain_Description        => No_Name,\n+                           PIC_Option                   => No_Name,\n+                           Objects_Generated            => True);\n \n    type Language_Data is record\n       Name          : Name_Id         := No_Name;\n@@ -580,6 +613,9 @@ package Prj is\n       Lang_Kind           : Language_Kind         := File_Based;\n       --  Kind of the language\n \n+      Compiled            : Boolean               := True;\n+      --  False when there is no compiler for the language\n+\n       Alternate_Languages : Alternate_Language_Id := No_Alternate_Language;\n       --  List of languages a header file may also be, in addition of\n       --  language Language_Name.\n@@ -640,40 +676,40 @@ package Prj is\n       Object_Path         : Path_Name_Type        := No_Path;\n       --  Object path of the real object file\n \n-      Object_TS : Time_Stamp_Type := Empty_Time_Stamp;\n+      Object_TS           : Time_Stamp_Type       := Empty_Time_Stamp;\n       --  Object file time stamp\n \n-      Dep_Name : File_Name_Type := No_File;\n+      Dep_Name            : File_Name_Type        := No_File;\n       --  Dependency file simple name\n \n-      Current_Dep_Path : Path_Name_Type := No_Path;\n+      Current_Dep_Path    : Path_Name_Type        := No_Path;\n       --  Path name of an existing dependency file\n \n-      Dep_Path : Path_Name_Type := No_Path;\n+      Dep_Path            : Path_Name_Type        := No_Path;\n       --  Path name of the real dependency file\n \n-      Dep_TS : Time_Stamp_Type := Empty_Time_Stamp;\n+      Dep_TS              : Time_Stamp_Type       := Empty_Time_Stamp;\n       --  Dependency file time stamp\n \n-      Switches            : File_Name_Type  := No_File;\n+      Switches            : File_Name_Type        := No_File;\n       --  File name of the switches file\n \n-      Switches_Path       : Path_Name_Type  := No_Path;\n+      Switches_Path       : Path_Name_Type        := No_Path;\n       --  Path name of the switches file\n \n-      Switches_TS         : Time_Stamp_Type := Empty_Time_Stamp;\n+      Switches_TS         : Time_Stamp_Type       := Empty_Time_Stamp;\n       --  Switches file time stamp\n \n-      Naming_Exception    : Boolean         := False;\n+      Naming_Exception    : Boolean               := False;\n       --  True if the source has an exceptional name\n \n-      Next_In_Sources     : Source_Id       := No_Source;\n+      Next_In_Sources     : Source_Id             := No_Source;\n       --  Link to another source in the project tree\n \n-      Next_In_Project     : Source_Id       := No_Source;\n+      Next_In_Project     : Source_Id             := No_Source;\n       --  Link to another source in the project\n \n-      Next_In_Lang        : Source_Id       := No_Source;\n+      Next_In_Lang        : Source_Id             := No_Source;\n       --  Link to another source of the same language\n    end record;\n \n@@ -682,6 +718,7 @@ package Prj is\n                        Language_Name       => No_Name,\n                        Language            => No_Language_Index,\n                        Lang_Kind           => File_Based,\n+                       Compiled            => True,\n                        Alternate_Languages => No_Alternate_Language,\n                        Kind                => Spec,\n                        Dependency          => None,\n@@ -1110,6 +1147,9 @@ package Prj is\n          --  The name of the executable to build archives, with the minimum\n          --  switches. Specified in the configuration.\n \n+         Archive_Builder_Append_Option : Name_List_Index := No_Name_List;\n+         --  The options to append object files to an archive\n+\n          Archive_Indexer          : Name_List_Index := No_Name_List;\n          --  The name of the executable to index archives, with the minimum\n          --  switches. Specified in the configuration.\n@@ -1149,26 +1189,27 @@ package Prj is\n    end record;\n \n    Default_Project_Config : constant Project_Configuration :=\n-       (Run_Path_Option          => No_Name_List,\n-        Executable_Suffix        => No_Name,\n-        Linker                   => No_Path,\n-        Minimum_Linker_Options   => No_Name_List,\n-        Linker_Executable_Option => No_Name_List,\n-        Linker_Lib_Dir_Option    => No_Name,\n-        Linker_Lib_Name_Option   => No_Name,\n-        Library_Builder          => No_Path,\n-        Lib_Support              => None,\n-        Archive_Builder          => No_Name_List,\n-        Archive_Indexer          => No_Name_List,\n-        Archive_Suffix           => No_File,\n-        Lib_Partial_Linker       => No_Name_List,\n-        Shared_Lib_Prefix        => No_File,\n-        Shared_Lib_Suffix        => No_File,\n-        Shared_Lib_Min_Options   => No_Name_List,\n-        Lib_Version_Options      => No_Name_List,\n-        Symbolic_Link_Supported  => False,\n-        Lib_Maj_Min_Id_Supported => False,\n-        Auto_Init_Supported      => False);\n+                              (Run_Path_Option               => No_Name_List,\n+                               Executable_Suffix             => No_Name,\n+                               Linker                        => No_Path,\n+                               Minimum_Linker_Options        => No_Name_List,\n+                               Linker_Executable_Option      => No_Name_List,\n+                               Linker_Lib_Dir_Option         => No_Name,\n+                               Linker_Lib_Name_Option        => No_Name,\n+                               Library_Builder               => No_Path,\n+                               Lib_Support                   => None,\n+                               Archive_Builder               => No_Name_List,\n+                               Archive_Builder_Append_Option => No_Name_List,\n+                               Archive_Indexer               => No_Name_List,\n+                               Archive_Suffix                => No_File,\n+                               Lib_Partial_Linker            => No_Name_List,\n+                               Shared_Lib_Prefix             => No_File,\n+                               Shared_Lib_Suffix             => No_File,\n+                               Shared_Lib_Min_Options        => No_Name_List,\n+                               Lib_Version_Options           => No_Name_List,\n+                               Symbolic_Link_Supported       => False,\n+                               Lib_Maj_Min_Id_Supported      => False,\n+                               Auto_Init_Supported           => False);\n \n    --  The following record describes a project file representation\n \n@@ -1177,6 +1218,9 @@ package Prj is\n    --  separator.\n \n    type Project_Data is record\n+      Qualifier : Project_Qualifier := Unspecified;\n+      --  The eventual qualifier for this project\n+\n       Externally_Built : Boolean := False;\n       --  True if the project is externally built. In such case, the Project\n       --  Manager will not modify anything in this project.\n@@ -1436,21 +1480,21 @@ package Prj is\n       Supp_Languages : Supp_Language_Index  := No_Supp_Language_Index;\n       --  Indicate the different languages of the source of this project\n \n-      Ada_Sources_Present            : Boolean := True;\n+      Ada_Sources_Present : Boolean := True;\n       --  True if there are Ada sources in the project\n \n-      Other_Sources_Present          : Boolean := True;\n+      Other_Sources_Present : Boolean := True;\n       --  True if there are sources from languages other than Ada in the\n       --  project.\n \n-      First_Other_Source             : Other_Source_Id := No_Other_Source;\n+      First_Other_Source : Other_Source_Id := No_Other_Source;\n       --  First source of a language other than Ada\n \n-      Last_Other_Source              : Other_Source_Id := No_Other_Source;\n+      Last_Other_Source : Other_Source_Id := No_Other_Source;\n       --  Last source of a language other than Ada\n \n-      First_Lang_Processing : First_Language_Processing_Data :=\n-                                Default_First_Language_Processing_Data;\n+      First_Lang_Processing    : First_Language_Processing_Data :=\n+                                   Default_First_Language_Processing_Data;\n       Supp_Language_Processing : Supp_Language_Index :=\n                                    No_Supp_Language_Index;\n       --  Language configurations\n@@ -1740,8 +1784,12 @@ private\n    --  normally forbidden for project names, there cannot be any name clash.\n \n    Empty_Name : Name_Id;\n-   --  Name_Id for an empty name (no characters). Initialized by the call\n-   --  to procedure Initialize.\n+   --  Name_Id for an empty name (no characters). Initialized in procedure\n+   --  Initialize.\n+\n+   Empty_File_Name : File_Name_Type;\n+   --  Empty File_Name_Type (no characters). Initialized in procedure\n+   --  Initialize.\n \n    procedure Add_To_Buffer\n      (S    : String;"}, {"sha": "20761f417cdccf5fee1b788c6444cf4b7eae1799", "filename": "gcc/ada/switch-m.adb", "status": "modified", "additions": 67, "deletions": 13, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fswitch-m.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c3f02a687ec4e6dd51392f1154da5690cd7963/gcc%2Fada%2Fswitch-m.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fswitch-m.adb?ref=68c3f02a687ec4e6dd51392f1154da5690cd7963", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2008, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -26,6 +26,7 @@\n with Debug;    use Debug;\n with Osint;    use Osint;\n with Opt;      use Opt;\n+with Prj;      use Prj;\n with Prj.Ext;  use Prj.Ext;\n with Table;\n \n@@ -150,20 +151,59 @@ package body Switch.M is\n             when False =>\n \n                --  All switches that don't start with -gnat stay as is,\n-               --  except -v, -E and -pg\n+               --  except -pg, -Wall, -k8, -w\n \n-               if Switch_Chars = \"-pg\" then\n+               if Switch_Chars = \"-pg\" or else Switch_Chars = \"-p\" then\n \n                   --  The gcc driver converts -pg to -p, so that is what\n                   --  is stored in the ALI file.\n \n                   Add_Switch_Component (\"-p\");\n \n-               --  Do not take into account switches that are not transmitted\n-               --  to gnat1 by the gcc driver.\n+               elsif Switch_Chars = \"-Wall\" then\n \n-               elsif C /= 'v' and then C /= 'E' then\n+                  --  The gcc driver adds -gnatwa when -Wall is used\n+\n+                  Add_Switch_Component (\"-gnatwa\");\n+                  Add_Switch_Component (\"-Wall\");\n+\n+               elsif Switch_Chars = \"-k8\" then\n+\n+                  --  The gcc driver transforms -k8 into -gnatk8\n+\n+                  Add_Switch_Component (\"-gnatk8\");\n+\n+               elsif Switch_Chars = \"-w\" then\n+\n+                  --  The gcc driver adds -gnatws when -w is used\n+\n+                  Add_Switch_Component (\"-gnatws\");\n+                  Add_Switch_Component (\"-w\");\n+\n+               elsif Switch_Chars'Length > 6\n+                 and then\n+                   Switch_Chars (Switch_Chars'First .. Switch_Chars'First + 5)\n+                                                             = \"--RTS=\"\n+               then\n                   Add_Switch_Component (Switch_Chars);\n+\n+                  --  When --RTS=mtp is used, the gcc driver adds -mrtp\n+\n+                  if Switch_Chars = \"--RTS=mtp\" then\n+                     Add_Switch_Component (\"-mrtp\");\n+                  end if;\n+\n+               --  Take only into account switches that are transmitted to\n+               --  gnat1 by the gcc driver and stored by gnat1 in the ALI file.\n+\n+               else\n+                  case C is\n+                     when 'O' | 'W' | 'w' | 'f' | 'd' | 'g' | 'm' =>\n+                        Add_Switch_Component (Switch_Chars);\n+\n+                     when others =>\n+                        null;\n+                  end case;\n                end if;\n \n                return;\n@@ -332,7 +372,8 @@ package body Switch.M is\n                            Ptr := Ptr + 1;\n \n                            if Ptr <= Max\n-                             and then Switch_Chars (Ptr) = 's' then\n+                             and then Switch_Chars (Ptr) = 's'\n+                           then\n                               Last_Stored := Last_Stored + 1;\n                               Storing (Last_Stored) := 's';\n                               Ptr := Ptr + 1;\n@@ -366,12 +407,9 @@ package body Switch.M is\n \n                         --  -gnatyMxxx\n \n-                        if C = 'M' and then\n-                          Storing (First_Stored) = 'y'\n-                        then\n+                        if C = 'M' and then Storing (First_Stored) = 'y' then\n                            Last_Stored := First_Stored + 1;\n                            Storing (Last_Stored) := 'M';\n-\n                            while Ptr <= Max loop\n                               C := Switch_Chars (Ptr);\n                               exit when C not in '0' .. '9';\n@@ -517,8 +555,24 @@ package body Switch.M is\n          if Switch_Chars = \"--create-missing-dirs\" then\n             Setup_Projects := True;\n \n-         elsif Switch_Chars'Length > 3 and then\n-               Switch_Chars (Ptr .. Ptr + 1) = \"aP\"\n+         elsif Switch_Chars'Length > Subdirs_Option'Length\n+           and then\n+             Switch_Chars\n+               (Switch_Chars'First ..\n+                Switch_Chars'First + Subdirs_Option'Length - 1) =\n+                                                            Subdirs_Option\n+         then\n+            Subdirs :=\n+              new String'\n+                (Switch_Chars\n+                  (Switch_Chars'First + Subdirs_Option'Length ..\n+                   Switch_Chars'Last));\n+\n+         elsif Switch_Chars (Ptr) = '-' then\n+            Bad_Switch (Switch_Chars);\n+\n+         elsif Switch_Chars'Length > 3\n+           and then Switch_Chars (Ptr .. Ptr + 1) = \"aP\"\n          then\n             Add_Search_Project_Directory\n               (Switch_Chars (Ptr + 2 .. Switch_Chars'Last));"}]}