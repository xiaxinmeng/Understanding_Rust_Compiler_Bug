{"sha": "606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjA2YTlhOGM3MjhmMmRhZTZiOWQ1ODM5N2ZjZWZiM2NiMGZhMGRiOA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2019-07-02T08:23:02Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-07-02T08:23:02Z"}, "message": "lto-common.c (lto_register_canonical_types_for_odr_types): Copy CXX_ODR_P from the main variant.\n\n\t* lto-common.c (lto_register_canonical_types_for_odr_types):\n\tCopy CXX_ODR_P from the main variant.\n\nFrom-SVN: r272923", "tree": {"sha": "3612193ad94598df1e8f631ae0b5c37ae195bc3a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3612193ad94598df1e8f631ae0b5c37ae195bc3a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8/comments", "author": null, "committer": null, "parents": [{"sha": "14ec49a7537004633b7fff859178cbebd288ca1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14ec49a7537004633b7fff859178cbebd288ca1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14ec49a7537004633b7fff859178cbebd288ca1d"}], "stats": {"total": 18, "additions": 16, "deletions": 2}, "files": [{"sha": "ae4e1572496edbc097458a1dddf65aebade714b9", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8", "patch": "@@ -1,3 +1,8 @@\n+2019-06-27  Jan Hubicka  <jh@suse.cz>\n+\n+\t* lto-common.c (lto_register_canonical_types_for_odr_types):\n+\tCopy CXX_ODR_P from the main variant.\n+\n 2019-06-27  Jan Hubicka  <jh@suse.cz>\n \n \t* lto-common.c: tree-pretty-print.h"}, {"sha": "2b3165a77f481fdd6fa9b18c062eb12eb4490157", "filename": "gcc/lto/lto-common.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8/gcc%2Flto%2Flto-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8/gcc%2Flto%2Flto-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-common.c?ref=606a9a8c728f2dae6b9d58397fcefb3cb0fa0db8", "patch": "@@ -568,8 +568,17 @@ lto_register_canonical_types_for_odr_types ()\n \n   /* Register all remaining types.  */\n   FOR_EACH_VEC_ELT (*types_to_register, i, t)\n-    if (!TYPE_CANONICAL (t))\n-      gimple_register_canonical_type (t);\n+    {\n+      /* For pre-streamed types like va-arg it is possible that main variant\n+\t is !CXX_ODR_P while the variant (which is streamed) is.\n+\t Copy CXX_ODR_P to make type verifier happy.  This is safe because\n+\t in canonical type calculation we only consider main variants.\n+\t However we can not change this flag before streaming is finished\n+\t to not affect tree merging.  */\n+      TYPE_CXX_ODR_P (t) = TYPE_CXX_ODR_P (TYPE_MAIN_VARIANT (t));\n+      if (!TYPE_CANONICAL (t))\n+        gimple_register_canonical_type (t);\n+    }\n }\n \n "}]}