{"sha": "bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmY2MzRkMWM0YzljYzNjZDNhNDUyM2FiNDE3OGI5NDM5ODg5MmRlZA==", "commit": {"author": {"name": "Thomas Preud'homme", "email": "thomas.preudhomme@arm.com", "date": "2017-03-22T11:35:15Z"}, "committer": {"name": "Thomas Preud'homme", "email": "thopre01@gcc.gnu.org", "date": "2017-03-22T11:35:15Z"}, "message": "Fix PR80082: LDRD erronously used for 64bit load on ARMv7-R\n\n2017-03-22  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n\n    gcc/\n    PR target/80082\n    * config/arm/arm-isa.h (isa_bit_lpae): New feature bit.\n    (ISA_ARMv7ve): Add isa_bit_lpae to the definition.\n    * config/arm/arm-protos.h (arm_arch7ve): Rename into ...\n    (arm_arch_lpae): This.\n    * config/arm/arm.c (arm_arch7ve): Rename into ...\n    (arm_arch_lpae): This.  Define it in term of isa_bit_lpae.\n    * config/arm/arm.h (TARGET_HAVE_LPAE): Redefine in term of\n    arm_arch_lpae.\n\n    gcc/testsuite/\n    PR target/80082\n    * gcc.target/arm/atomic_loaddi_10.c: New testcase.\n    * gcc.target/arm/atomic_loaddi_11.c: Likewise.\n\nFrom-SVN: r246365", "tree": {"sha": "ea7e7b9a74354d39e29fac53693fa3831d8296ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea7e7b9a74354d39e29fac53693fa3831d8296ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/comments", "author": {"login": "RoboTux", "id": 272327, "node_id": "MDQ6VXNlcjI3MjMyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/272327?v=4", "gravatar_id": "", "url": "https://api.github.com/users/RoboTux", "html_url": "https://github.com/RoboTux", "followers_url": "https://api.github.com/users/RoboTux/followers", "following_url": "https://api.github.com/users/RoboTux/following{/other_user}", "gists_url": "https://api.github.com/users/RoboTux/gists{/gist_id}", "starred_url": "https://api.github.com/users/RoboTux/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/RoboTux/subscriptions", "organizations_url": "https://api.github.com/users/RoboTux/orgs", "repos_url": "https://api.github.com/users/RoboTux/repos", "events_url": "https://api.github.com/users/RoboTux/events{/privacy}", "received_events_url": "https://api.github.com/users/RoboTux/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f7325b95de5695677008cff92181f36cf59ad19a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7325b95de5695677008cff92181f36cf59ad19a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7325b95de5695677008cff92181f36cf59ad19a"}], "stats": {"total": 64, "additions": 56, "deletions": 8}, "files": [{"sha": "18d00c29fba75ef4b97deb32e404078501711a1c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -1,3 +1,15 @@\n+t2017-03-22  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n+\n+\tPR target/80082\n+\t* config/arm/arm-isa.h (isa_bit_lpae): New feature bit.\n+\t(ISA_ARMv7ve): Add isa_bit_lpae to the definition.\n+\t* config/arm/arm-protos.h (arm_arch7ve): Rename into ...\n+\t(arm_arch_lpae): This.\n+\t* config/arm/arm.c (arm_arch7ve): Rename into ...\n+\t(arm_arch_lpae): This.  Define it in term of isa_bit_lpae.\n+\t* config/arm/arm.h (TARGET_HAVE_LPAE): Redefine in term of\n+\tarm_arch_lpae.\n+\n 2017-03-22  Martin Liska  <mliska@suse.cz>\n \n \tPR target/79906"}, {"sha": "7d1e23be0a22ea3d04368a73538d606eef3ae092", "filename": "gcc/config/arm/arm-isa.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm-isa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm-isa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-isa.h?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -58,6 +58,7 @@ enum isa_feature\n     isa_bit_VFPv3,\t/* Vector floating point v3.  */\n     isa_bit_VFPv4,\t/* Vector floating point v4.  */\n     isa_bit_FPv5,\t/* Floating point v5.  */\n+    isa_bit_lpae,\t/* ARMv7-A LPAE.  */\n     isa_bit_FP_ARMv8,\t/* ARMv8 floating-point extension.  */\n     isa_bit_neon,\t/* Advanced SIMD instructions.  */\n     isa_bit_fp16conv,\t/* Conversions to/from fp16 (VFPv3 extension).  */\n@@ -116,7 +117,7 @@ enum isa_feature\n    integer SIMD instructions that are in ARMv6T2.  */\n #define ISA_ARMv7\tISA_ARMv6m, isa_bit_thumb2, isa_bit_ARMv7\n #define ISA_ARMv7a\tISA_ARMv7, isa_bit_notm, isa_bit_ARMv6k\n-#define ISA_ARMv7ve\tISA_ARMv7a, isa_bit_adiv, isa_bit_tdiv\n+#define ISA_ARMv7ve\tISA_ARMv7a, isa_bit_adiv, isa_bit_tdiv, isa_bit_lpae\n #define ISA_ARMv7r\tISA_ARMv7a, isa_bit_tdiv\n #define ISA_ARMv7m\tISA_ARMv7, isa_bit_tdiv\n #define ISA_ARMv7em\tISA_ARMv7m, isa_bit_ARMv7em"}, {"sha": "cf8b43714d8cfc1aa6b648fc7f57d2234fd74927", "filename": "gcc/config/arm/arm-protos.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-protos.h?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -391,8 +391,8 @@ extern int arm_arch6m;\n /* Nonzero if this chip supports the ARM 7 extensions.  */\n extern int arm_arch7;\n \n-/* Nonzero if this chip supports the ARM 7ve extensions.  */\n-extern int arm_arch7ve;\n+/* Nonzero if this chip supports the Large Physical Address Extension.  */\n+extern int arm_arch_lpae;\n \n /* Nonzero if instructions not present in the 'M' profile can be used.  */\n extern int arm_arch_notm;"}, {"sha": "b24143e32e2f100000f3b150f7ed0df4fabb3cc8", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -841,8 +841,8 @@ int arm_arch6m = 0;\n /* Nonzero if this chip supports the ARM 7 extensions.  */\n int arm_arch7 = 0;\n \n-/* Nonzero if this chip supports the ARM 7ve extensions.  */\n-int arm_arch7ve = 0;\n+/* Nonzero if this chip supports the Large Physical Address Extension.  */\n+int arm_arch_lpae = 0;\n \n /* Nonzero if instructions not present in the 'M' profile can be used.  */\n int arm_arch_notm = 0;\n@@ -3365,8 +3365,7 @@ arm_option_override (void)\n   arm_arch_crc = bitmap_bit_p (arm_active_target.isa, isa_bit_crc32);\n   arm_arch_cmse = bitmap_bit_p (arm_active_target.isa, isa_bit_cmse);\n   arm_fp16_inst = bitmap_bit_p (arm_active_target.isa, isa_bit_fp16);\n-  arm_arch7ve\n-    = (arm_arch6k && arm_arch7 && arm_arch_thumb_hwdiv && arm_arch_arm_hwdiv);\n+  arm_arch_lpae = bitmap_bit_p (arm_active_target.isa, isa_bit_lpae);\n   if (arm_fp16_inst)\n     {\n       if (arm_fp16_format == ARM_FP16_FORMAT_ALTERNATIVE)"}, {"sha": "4dab73d37be8465fe6f504232e3ee83548beef95", "filename": "gcc/config/arm/arm.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Fconfig%2Farm%2Farm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.h?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -251,7 +251,7 @@ extern tree arm_fp16_type_node;\n \t\t\t\t  || (arm_arch8 && !arm_arch_notm))\n \n /* Nonzero if this chip supports LPAE.  */\n-#define TARGET_HAVE_LPAE (arm_arch7ve)\n+#define TARGET_HAVE_LPAE (arm_arch_lpae)\n \n /* Nonzero if this chip supports ldrex{bh} and strex{bh}.  */\n #define TARGET_HAVE_LDREXBH ((arm_arch6k && TARGET_ARM)\t\t\\"}, {"sha": "ead24fa48d394c4c57bde66f250fb9adc62b0b73", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -1,3 +1,9 @@\n+2017-03-22  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n+\n+\tPR target/80082\n+\t* gcc.target/arm/atomic_loaddi_10.c: New testcase.\n+\t* gcc.target/arm/atomic_loaddi_11.c: Likewise.\n+\n 2017-03-22  Martin Liska  <mliska@suse.cz>\n \n \tPR target/79906"}, {"sha": "ecc3d06d0c9f5966daa3ce7e2d52e09d14e0cbc8", "filename": "gcc/testsuite/gcc.target/arm/atomic_loaddi_10.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fatomic_loaddi_10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fatomic_loaddi_10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fatomic_loaddi_10.c?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_arch_v7ve_ok } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-add-options arm_arch_v7ve } */\n+\n+#include <stdatomic.h>\n+\n+atomic_llong x = 0;\n+\n+atomic_llong get_x()\n+{\n+  return atomic_load(&x);\n+}\n+\n+/* { dg-final { scan-assembler \"ldrd\" } } */"}, {"sha": "275669bd76356dc7c7b6a5373792d9a5089ede51", "filename": "gcc/testsuite/gcc.target/arm/atomic_loaddi_11.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fatomic_loaddi_11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf634d1c4c9cc3cd3a4523ab4178b94398892ded/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fatomic_loaddi_11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fatomic_loaddi_11.c?ref=bf634d1c4c9cc3cd3a4523ab4178b94398892ded", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_arch_v7r_ok } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-add-options arm_arch_v7r } */\n+\n+#include <stdatomic.h>\n+\n+atomic_llong x = 0;\n+\n+atomic_llong get_x()\n+{\n+  return atomic_load(&x);\n+}\n+\n+/* { dg-final { scan-assembler-not \"ldrd\" } } */"}]}