{"sha": "8fff206014983b3f02f42b442d4b7c94942fc1de", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGZmZjIwNjAxNDk4M2IzZjAyZjQyYjQ0MmQ0YjdjOTQ5NDJmYzFkZQ==", "commit": {"author": {"name": "Seongbae Park", "email": "seongbae.park@gmail.com", "date": "2007-04-16T16:49:02Z"}, "committer": {"name": "Seongbae Park", "email": "spark@gcc.gnu.org", "date": "2007-04-16T16:49:02Z"}, "message": "re PR c++/29365 (Unnecessary anonymous namespace warnings)\n\ngcc/ChangeLog:\n\n2007-04-16  Seongbae Park <seongbae.park@gmail.com>\n\n\tPR c++/29365\n\n\t* cp/decl2.c (constrain_class_visibility):\n\tDo not warn about the use of anonymous namespace in the main input file.\n\ngcc/testsuite/ChangeLog:\n\n2007-04-16  Seongbae Park <seongbae.park@gmail.com>\n\n\tPR c++/29365\n\tTestcase for c++ anonymous namespace warning\n\n\t* g++.dg/warn/anonymous-namespace-1.C: New test\n\t* g++.dg/warn/anonymous-namespace-1.h: New test\n\nFrom-SVN: r123879", "tree": {"sha": "a76fd122db7d411dbe53fb1858ea5a4f4db27197", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a76fd122db7d411dbe53fb1858ea5a4f4db27197"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8fff206014983b3f02f42b442d4b7c94942fc1de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fff206014983b3f02f42b442d4b7c94942fc1de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8fff206014983b3f02f42b442d4b7c94942fc1de", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fff206014983b3f02f42b442d4b7c94942fc1de/comments", "author": null, "committer": null, "parents": [{"sha": "de41203b65518a7a7a3ee16ae595b542021673b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de41203b65518a7a7a3ee16ae595b542021673b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de41203b65518a7a7a3ee16ae595b542021673b4"}], "stats": {"total": 55, "additions": 51, "deletions": 4}, "files": [{"sha": "6448f7a07d050c037275c6a8fa7ec30bef45c024", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8fff206014983b3f02f42b442d4b7c94942fc1de", "patch": "@@ -1,3 +1,10 @@\n+2007-04-16  Seongbae Park <seongbae.park@gmail.com>\n+\n+\tPR c++/29365\n+\n+\t* cp/decl2.c (constrain_class_visibility):\n+\tDo not warn about the use of anonymous namespace in the main input file.\n+\n 2007-04-16  Kazu Hirata  <kazu@codesourcery.com>\n \n \t* config/m68k/m68k.c (m68k_libcall_value,"}, {"sha": "54d5aa22939052def881a6ea30bf5ca3b06f38bf", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=8fff206014983b3f02f42b442d4b7c94942fc1de", "patch": "@@ -1860,9 +1860,13 @@ constrain_class_visibility (tree type)\n \tint subvis = type_visibility (ftype);\n \n \tif (subvis == VISIBILITY_ANON)\n-\t  warning (0, \"\\\n+\t  {\n+\t    if (strcmp (main_input_filename,\n+\t                DECL_SOURCE_FILE (TYPE_MAIN_DECL (ftype))))\n+\t      warning (0, \"\\\n %qT has a field %qD whose type uses the anonymous namespace\",\n-\t\t   type, t);\n+\t\t       type, t);\n+\t  }\n \telse if (IS_AGGR_TYPE (ftype)\n \t\t && vis < VISIBILITY_HIDDEN\n \t\t && subvis >= VISIBILITY_HIDDEN)\n@@ -1877,9 +1881,13 @@ constrain_class_visibility (tree type)\n       int subvis = type_visibility (TREE_TYPE (t));\n \n       if (subvis == VISIBILITY_ANON)\n-\twarning (0, \"\\\n+        {\n+\t  if (strcmp (main_input_filename,\n+\t              DECL_SOURCE_FILE (TYPE_MAIN_DECL (TREE_TYPE (t)))))\n+\t    warning (0, \"\\\n %qT has a base %qT whose type uses the anonymous namespace\",\n-\t\t type, TREE_TYPE (t));\n+\t\t     type, TREE_TYPE (t));\n+\t}\n       else if (vis < VISIBILITY_HIDDEN\n \t       && subvis >= VISIBILITY_HIDDEN)\n \twarning (OPT_Wattributes, \"\\"}, {"sha": "761a0ae7b5010ca8ffe6fc3003c6401369eeb475", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8fff206014983b3f02f42b442d4b7c94942fc1de", "patch": "@@ -1,3 +1,11 @@\n+2007-04-16  Seongbae Park <seongbae.park@gmail.com>\n+\n+\tPR c++/29365\n+\tTestcase for c++ anonymous namespace warning\n+\n+\t* g++.dg/warn/anonymous-namespace-1.C: New test\n+\t* g++.dg/warn/anonymous-namespace-1.h: New test\n+\n 2007-04-14  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n \n \tPR testsuite/31578"}, {"sha": "6949f1589262d8b5807a8eaa81ab430073c2caa6", "filename": "gcc/testsuite/g++.dg/warn/anonymous-namespace-1.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-1.C?ref=8fff206014983b3f02f42b442d4b7c94942fc1de", "patch": "@@ -0,0 +1,17 @@\n+// Test for the warning of exposing types from an anonymous namespace\n+// { dg-do compile }\n+\n+#include \"anonymous-namespace-1.h\"\n+\n+namespace {\n+ class good { };\n+}\n+\n+class foo::bar : public good { }; \n+class foobar1\n+{\n+  good g;\n+};\n+\n+class foobar : public bad { }; // { dg-warning \"uses the anonymous namespace\" }\n+class foobar2 { bad b; }; // { dg-warning \"uses the anonymous namespace\" }"}, {"sha": "0d3e239e404b5a5ec6984cd0d5c8b2a85779d4e0", "filename": "gcc/testsuite/g++.dg/warn/anonymous-namespace-1.h", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-1.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fff206014983b3f02f42b442d4b7c94942fc1de/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-1.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fanonymous-namespace-1.h?ref=8fff206014983b3f02f42b442d4b7c94942fc1de", "patch": "@@ -0,0 +1,7 @@\n+class foo {\n+ class bar;\n+};\n+\n+namespace {\n+  class bad { };\n+}"}]}