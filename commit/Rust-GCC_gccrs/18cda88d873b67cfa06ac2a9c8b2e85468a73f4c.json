{"sha": "18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MThjZGE4OGQ4NzNiNjdjZmEwNmFjMmE5YzhiMmU4NTQ2OGE3M2Y0Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-10-10T11:08:37Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-10-10T11:08:37Z"}, "message": "re PR fortran/59488 ([OpenMP] named constant in parallel construct leads to \"not specified in enclosing parallel\" error.)\n\n\tPR fortran/59488\n\t* trans-openmp.c (gfc_omp_predetermined_sharing): Return\n\tOMP_CLAUSE_DEFAULT_SHARED for parameters or vtables.\n\n\t* gfortran.dg/gomp/pr59488-1.f90: New test.\n\t* gfortran.dg/gomp/pr59488-2.f90: New test.\n\nFrom-SVN: r216067", "tree": {"sha": "04f2252e785647862f9851e5481a7c9c979024eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/04f2252e785647862f9851e5481a7c9c979024eb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "81231d139c7bb882fe12b6e1948d34c8b1e9daf0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81231d139c7bb882fe12b6e1948d34c8b1e9daf0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81231d139c7bb882fe12b6e1948d34c8b1e9daf0"}], "stats": {"total": 51, "additions": 51, "deletions": 0}, "files": [{"sha": "88fc33f87b440ba0febcd85e1a8d1015485a927f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "patch": "@@ -1,3 +1,9 @@\n+2014-10-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/59488\n+\t* trans-openmp.c (gfc_omp_predetermined_sharing): Return\n+\tOMP_CLAUSE_DEFAULT_SHARED for parameters or vtables.\n+\n 2014-10-10  Tobias Burnus  <burnus@net-b.de>\n \n \t* gfortran.h (gfc_set_implicit_none): Update prototype."}, {"sha": "038c3e9a6e4095faba6da93874f6a39fd11dffc7", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "patch": "@@ -135,6 +135,16 @@ gfc_omp_predetermined_sharing (tree decl)\n   if (GFC_DECL_RESULT (decl) && ! DECL_HAS_VALUE_EXPR_P (decl))\n     return OMP_CLAUSE_DEFAULT_SHARED;\n \n+  /* These are either array or derived parameters, or vtables.\n+     In the former cases, the OpenMP standard doesn't consider them to be\n+     variables at all (they can't be redefined), but they can nevertheless appear\n+     in parallel/task regions and for default(none) purposes treat them as shared.\n+     For vtables likely the same handling is desirable.  */\n+  if (TREE_CODE (decl) == VAR_DECL\n+      && TREE_READONLY (decl)\n+      && TREE_STATIC (decl))\n+    return OMP_CLAUSE_DEFAULT_SHARED;\n+\n   return OMP_CLAUSE_DEFAULT_UNSPECIFIED;\n }\n "}, {"sha": "d9e93d352a9e4439ad82aacd3e7caa595c5d13cd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "patch": "@@ -1,3 +1,9 @@\n+2014-10-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/59488\n+\t* gfortran.dg/gomp/pr59488-1.f90: New test.\n+\t* gfortran.dg/gomp/pr59488-2.f90: New test.\n+\n 2014-10-10  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/63476"}, {"sha": "9db17dd2769a4d6b26ce79da2e27d2e09893e85b", "filename": "gcc/testsuite/gfortran.dg/gomp/pr59488-1.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr59488-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr59488-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr59488-1.f90?ref=18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "patch": "@@ -0,0 +1,13 @@\n+! PR fortran/59488\n+! { dg-do compile }\n+! { dg-options \"-fopenmp\" }\n+\n+  implicit none\n+  integer, parameter :: p(2) = (/ 11, 12 /)\n+  integer :: r\n+\n+  !$omp parallel do default(none)\n+  do r = 1, 2\n+    print *, p(r)\n+  end do\n+end"}, {"sha": "38f157b81ada6266e318ba7b29c60157380082ca", "filename": "gcc/testsuite/gfortran.dg/gomp/pr59488-2.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr59488-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18cda88d873b67cfa06ac2a9c8b2e85468a73f4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr59488-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr59488-2.f90?ref=18cda88d873b67cfa06ac2a9c8b2e85468a73f4c", "patch": "@@ -0,0 +1,16 @@\n+! PR fortran/59488\n+! { dg-do compile }\n+! { dg-options \"-fopenmp\" }\n+\n+  implicit none\n+  type t\n+    integer :: s1, s2, s3\n+  end type\n+  integer :: r\n+  type(t), parameter :: u = t(1, 2, 3)\n+\n+  !$omp parallel do default(none)\n+  do r = 1, 2\n+    print *, u\n+  end do\n+end"}]}