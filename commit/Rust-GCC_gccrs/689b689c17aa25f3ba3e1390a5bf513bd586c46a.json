{"sha": "689b689c17aa25f3ba3e1390a5bf513bd586c46a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Njg5YjY4OWMxN2FhMjVmM2JhM2UxMzkwYTViZjUxM2JkNTg2YzQ2YQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2009-03-27T22:28:20Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2009-03-27T22:28:20Z"}, "message": "re PR rtl-optimization/38034 (Unnecessary register move)\n\ngcc/\n\n2009-03-27  H.J. Lu  <hongjiu.lu@intel.com>\n\t    Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/38034\n\t* config/ia64/sync.md (cmpxchg_rel_<mode>): Replace input\n\tgr_register_operand with gr_reg_or_0_operand.\n\t(cmpxchg_rel_di): Likewise.\n\t(sync_lock_test_and_set<mode>): Likewise.\n\ngcc/testsuite/\n\n2009-03-27  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR target/38034\n\t* gcc.target/ia64/sync-1.c: New.\n\nCo-Authored-By: Jakub Jelinek <jakub@redhat.com>\n\nFrom-SVN: r145135", "tree": {"sha": "96ed17549cb034b9a4557fee21713d29798dd347", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96ed17549cb034b9a4557fee21713d29798dd347"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/689b689c17aa25f3ba3e1390a5bf513bd586c46a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/689b689c17aa25f3ba3e1390a5bf513bd586c46a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/689b689c17aa25f3ba3e1390a5bf513bd586c46a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/689b689c17aa25f3ba3e1390a5bf513bd586c46a/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c619e9823eb70134db45642968eb815bf270bd58", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c619e9823eb70134db45642968eb815bf270bd58", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c619e9823eb70134db45642968eb815bf270bd58"}], "stats": {"total": 49, "additions": 43, "deletions": 6}, "files": [{"sha": "408250bcfc8d47f2575b608b5e02227d9faeddb1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=689b689c17aa25f3ba3e1390a5bf513bd586c46a", "patch": "@@ -1,3 +1,12 @@\n+2009-03-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/38034\n+\t* config/ia64/sync.md (cmpxchg_rel_<mode>): Replace input\n+\tgr_register_operand with gr_reg_or_0_operand.\n+\t(cmpxchg_rel_di): Likewise.\n+\t(sync_lock_test_and_set<mode>): Likewise.\n+\n 2009-03-27  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* jump.c (rtx_renumbered_equal_p): Use subreg_get_info."}, {"sha": "b40e208b6a0287f325f913fae70161b46db4e931", "filename": "gcc/config/ia64/sync.md", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2Fconfig%2Fia64%2Fsync.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2Fconfig%2Fia64%2Fsync.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fia64%2Fsync.md?ref=689b689c17aa25f3ba3e1390a5bf513bd586c46a", "patch": "@@ -151,10 +151,10 @@\n         (unspec:I124MODE\n \t  [(match_dup 1)\n \t   (match_operand:DI 2 \"ar_ccv_reg_operand\" \"\")\n-\t   (match_operand:I124MODE 3 \"gr_register_operand\" \"r\")]\n+\t   (match_operand:I124MODE 3 \"gr_reg_or_0_operand\" \"rO\")]\n \t  UNSPEC_CMPXCHG_ACQ))]\n   \"\"\n-  \"cmpxchg<modesuffix>.rel %0 = %1, %3, %2\"\n+  \"cmpxchg<modesuffix>.rel %0 = %1, %r3, %2\"\n   [(set_attr \"itanium_class\" \"sem\")])\n \n (define_insn \"cmpxchg_rel_di\"\n@@ -163,19 +163,19 @@\n    (set (match_dup 1)\n         (unspec:DI [(match_dup 1)\n \t\t    (match_operand:DI 2 \"ar_ccv_reg_operand\" \"\")\n-\t\t    (match_operand:DI 3 \"gr_register_operand\" \"r\")]\n+\t\t    (match_operand:DI 3 \"gr_reg_or_0_operand\" \"rO\")]\n \t\t   UNSPEC_CMPXCHG_ACQ))]\n   \"\"\n-  \"cmpxchg8.rel %0 = %1, %3, %2\"\n+  \"cmpxchg8.rel %0 = %1, %r3, %2\"\n   [(set_attr \"itanium_class\" \"sem\")])\n \n (define_insn \"sync_lock_test_and_set<mode>\"\n   [(set (match_operand:IMODE 0 \"gr_register_operand\" \"=r\")\n         (match_operand:IMODE 1 \"not_postinc_memory_operand\" \"+S\"))\n    (set (match_dup 1)\n-        (match_operand:IMODE 2 \"gr_register_operand\" \"r\"))]\n+        (match_operand:IMODE 2 \"gr_reg_or_0_operand\" \"rO\"))]\n   \"\"\n-  \"xchg<modesuffix> %0 = %1, %2\"\n+  \"xchg<modesuffix> %0 = %1, %r2\"\n   [(set_attr \"itanium_class\" \"sem\")])\n \n (define_expand \"sync_lock_release<mode>\""}, {"sha": "0060483f10c4d82a0f0b1580cd46c2ddfb3f1965", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=689b689c17aa25f3ba3e1390a5bf513bd586c46a", "patch": "@@ -1,3 +1,8 @@\n+2009-03-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/38034\n+\t* gcc.target/ia64/sync-1.c: New.\n+\n 2009-03-27  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/39472"}, {"sha": "95f6daeb9974785d04c2ad79b2ee73d34d9d767f", "filename": "gcc/testsuite/gcc.target/ia64/sync-1.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fsync-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/689b689c17aa25f3ba3e1390a5bf513bd586c46a/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fsync-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fsync-1.c?ref=689b689c17aa25f3ba3e1390a5bf513bd586c46a", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-final { scan-assembler \"xchg4 .*, r0\" } } */\n+/* { dg-final { scan-assembler \"cmpxchg4.*, r0, .*\" } } */\n+/* { dg-final { scan-assembler \"cmpxchg8.*, r0, .*\" } } */\n+\n+int\n+foo1 (int *p)\n+{\n+  return __sync_lock_test_and_set (p, 0);\n+}\n+\n+int\n+foo2 (int *p, int v)\n+{\n+  return __sync_bool_compare_and_swap (p, v, 0);\n+}\n+\n+long\n+foo3 (long *p, long v)\n+{\n+  return __sync_bool_compare_and_swap (p, v, 0);\n+}"}]}