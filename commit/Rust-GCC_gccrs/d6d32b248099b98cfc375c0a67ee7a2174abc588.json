{"sha": "d6d32b248099b98cfc375c0a67ee7a2174abc588", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZkMzJiMjQ4MDk5Yjk4Y2ZjMzc1YzBhNjdlZTdhMjE3NGFiYzU4OA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonber@gnat.com", "date": "2001-12-03T19:21:33Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-12-03T19:21:33Z"}, "message": "sem_ch12.adb (Inline_Instance_Body): Use Save_Scope_Stack and push Standard on the stack before analyzing the...\n\n2001-12-03  Ed Schonberg <schonber@gnat.com>\n\n\t* sem_ch12.adb (Inline_Instance_Body): Use Save_Scope_Stack and\n\tpush Standard on the stack before analyzing the instance body,\n\tin order to have a clean visibility environment.\n\n\t* sem_ch12.adb (Inline_Instance_Body): Remove redundant code.\n\nFrom-SVN: r47559", "tree": {"sha": "6e9f6c7b7364bbc29a8601292577541921ec75e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6e9f6c7b7364bbc29a8601292577541921ec75e7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6d32b248099b98cfc375c0a67ee7a2174abc588", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6d32b248099b98cfc375c0a67ee7a2174abc588", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6d32b248099b98cfc375c0a67ee7a2174abc588", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6d32b248099b98cfc375c0a67ee7a2174abc588/comments", "author": null, "committer": null, "parents": [{"sha": "c725bd79e7613da00fb1b5bc440706a219db7653", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c725bd79e7613da00fb1b5bc440706a219db7653", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c725bd79e7613da00fb1b5bc440706a219db7653"}], "stats": {"total": 47, "additions": 18, "deletions": 29}, "files": [{"sha": "93613407ab942746110b60a5c00cd9000e0dd7e8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6d32b248099b98cfc375c0a67ee7a2174abc588/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6d32b248099b98cfc375c0a67ee7a2174abc588/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=d6d32b248099b98cfc375c0a67ee7a2174abc588", "patch": "@@ -1,3 +1,11 @@\n+2001-12-03  Ed Schonberg <schonber@gnat.com>\n+\n+\t* sem_ch12.adb (Inline_Instance_Body): Use Save_Scope_Stack and \n+\tpush Standard on the stack before analyzing the instance body, \n+\tin order to have a clean visibility environment.\n+\t\n+\t* sem_ch12.adb (Inline_Instance_Body): Remove redundant code. \n+\n 2001-12-03  Ed Schonberg <schonber@gnat.com>\n \n \t* sem_ch12.adb (Instantiate_Package_Body): Protect against double "}, {"sha": "b7c880422a2702d28fea6630b8c158e632a12d4b", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 10, "deletions": 29, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6d32b248099b98cfc375c0a67ee7a2174abc588/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6d32b248099b98cfc375c0a67ee7a2174abc588/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=d6d32b248099b98cfc375c0a67ee7a2174abc588", "patch": "@@ -2728,6 +2728,11 @@ package body Sem_Ch12 is\n             then\n                Removed := True;\n \n+               --  Remove entities in current scopes from visibility, so\n+               --  than instance body is compiled in a clean environment.\n+\n+               Save_Scope_Stack;\n+\n                if Is_Child_Unit (S) then\n                   --  Remove child unit from stack, as well as inner scopes.\n                   --  Removing the context of a child unit removes parent\n@@ -2755,8 +2760,11 @@ package body Sem_Ch12 is\n             S := Scope (S);\n          end loop;\n \n+         New_Scope (Standard_Standard);\n          Instantiate_Package_Body\n            ((N, Act_Decl, Expander_Active, Current_Sem_Unit));\n+         Pop_Scope;\n+\n \n          --  Restore context.\n \n@@ -2771,37 +2779,8 @@ package body Sem_Ch12 is\n          end loop;\n \n          if Removed then\n-            --  Make local entities not visible, so that when the context of\n-            --  unit is restored, there are not spurious hidings of use-\n-            --  visible entities (which appear in the environment before the\n-            --  current scope).\n-\n-            if Current_Scope /= Standard_Standard then\n-               S := First_Entity (Current_Scope);\n-\n-               while Present (S) loop\n-                  if Is_Overloadable (S) then\n-                     Set_Is_Immediately_Visible (S, False);\n-                  end if;\n-\n-                  Next_Entity (S);\n-               end loop;\n-            end if;\n-\n             Install_Context (Curr_Comp);\n \n-            if Current_Scope /= Standard_Standard then\n-               S := First_Entity (Current_Scope);\n-\n-               while Present (S) loop\n-                  if Is_Overloadable (S) then\n-                     Set_Is_Immediately_Visible (S);\n-                  end if;\n-\n-                  Next_Entity (S);\n-               end loop;\n-            end if;\n-\n             if Present (Curr_Scope)\n               and then Is_Child_Unit (Curr_Scope)\n             then\n@@ -2814,6 +2793,8 @@ package body Sem_Ch12 is\n                   New_Scope (Inner_Scopes (J));\n                end loop;\n             end if;\n+\n+            Restore_Scope_Stack;\n          end if;\n \n          for J in reverse 1 .. Num_Scopes loop"}]}