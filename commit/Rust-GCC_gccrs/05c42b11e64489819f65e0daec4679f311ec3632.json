{"sha": "05c42b11e64489819f65e0daec4679f311ec3632", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDVjNDJiMTFlNjQ0ODk4MTlmNjVlMGRhZWM0Njc5ZjMxMWVjMzYzMg==", "commit": {"author": {"name": "Richard Sandiford", "email": "rsandifo@nildram.co.uk", "date": "2007-10-09T11:05:33Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2007-10-09T11:05:33Z"}, "message": "re PR tree-optimization/33615 (Hoisting of potentially-throwing values for -fnon-call-exceptions)\n\ngcc/\n\tPR tree-optimization/33615\n\t* tree-ssa-pre.c (compute_avail): Don't call make_values_for_stmt\n\tif the statement might throw.  Fix formatting.\n\ngcc/testsuite/\n\tPR tree-optimization/33615\n\t* g++.dg/tree-ssa/pr33615-2.C: New test.\n\nFrom-SVN: r129164", "tree": {"sha": "94d4249b124b7d6332c42eef3d7a4bddeec5583c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94d4249b124b7d6332c42eef3d7a4bddeec5583c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/05c42b11e64489819f65e0daec4679f311ec3632", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05c42b11e64489819f65e0daec4679f311ec3632", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05c42b11e64489819f65e0daec4679f311ec3632", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05c42b11e64489819f65e0daec4679f311ec3632/comments", "author": null, "committer": null, "parents": [{"sha": "94172876940bd493e6c193e46dfacaa77d1f8606", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94172876940bd493e6c193e46dfacaa77d1f8606", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94172876940bd493e6c193e46dfacaa77d1f8606"}], "stats": {"total": 40, "additions": 36, "deletions": 4}, "files": [{"sha": "43c2c9d8282bbfb3f2a0883cc08f2b0a5db3a2ae", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=05c42b11e64489819f65e0daec4679f311ec3632", "patch": "@@ -1,3 +1,9 @@\n+2007-10-09  Richard Sandiford  <rsandifo@nildram.co.uk>\n+\n+\tPR tree-optimization/33615\n+\t* tree-ssa-pre.c (compute_avail): Don't call make_values_for_stmt\n+\tif the statement might throw.  Fix formatting.\n+\n 2007-10-09  Richard Sandiford  <rsandifo@nildram.co.uk>\n \n \tPR tree-optimization/33615"}, {"sha": "61dd6de929bb6d762802d5b19d317068436f2794", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=05c42b11e64489819f65e0daec4679f311ec3632", "patch": "@@ -1,3 +1,8 @@\n+2007-10-09  Richard Sandiford  <rsandifo@nildram.co.uk>\n+\n+\tPR tree-optimization/33615\n+\t* g++.dg/tree-ssa/pr33615-2.C: New test.\n+\n 2007-10-09  Richard Sandiford  <rsandifo@nildram.co.uk>\n \n \tPR tree-optimization/33615"}, {"sha": "542731a606d219b8a55f72b01fa18da2b1a918e7", "filename": "gcc/testsuite/g++.dg/tree-ssa/pr33615-2.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr33615-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr33615-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr33615-2.C?ref=05c42b11e64489819f65e0daec4679f311ec3632", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fnon-call-exceptions -fdump-tree-pre-details -w\" } */\n+\n+extern volatile int y;\n+\n+double\n+foo (double a, int x)\n+{\n+  while (x--)\n+    {\n+      y++;\n+      a += 1.0 / 0.0;\n+    }\n+  return a;\n+}\n+\n+// The expression 1.0 / 0.0 should not be treated as a loop invariant\n+// if it may throw an exception.\n+// { dg-final { scan-tree-dump-times \"Replaced 1\\\\\\.0e\\\\\\+0 / 0\\\\\\.0\" 0 \"pre\" } }\n+// { dg-final { cleanup-tree-dump \"pre\" } }"}, {"sha": "620346789a57cd8e79b7ff79027444fa5da0741e", "filename": "gcc/tree-ssa-pre.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2Ftree-ssa-pre.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05c42b11e64489819f65e0daec4679f311ec3632/gcc%2Ftree-ssa-pre.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-pre.c?ref=05c42b11e64489819f65e0daec4679f311ec3632", "patch": "@@ -3555,10 +3555,11 @@ compute_avail (void)\n \t    }\n \n \t  else if (TREE_CODE (stmt) == GIMPLE_MODIFY_STMT\n-\t      && !ann->has_volatile_ops\n-\t      && TREE_CODE (GIMPLE_STMT_OPERAND (stmt, 0)) == SSA_NAME\n-\t      && !SSA_NAME_OCCURS_IN_ABNORMAL_PHI\n-\t\t   (GIMPLE_STMT_OPERAND (stmt, 0)))\n+\t\t   && !ann->has_volatile_ops\n+\t\t   && TREE_CODE (GIMPLE_STMT_OPERAND (stmt, 0)) == SSA_NAME\n+\t\t   && (!SSA_NAME_OCCURS_IN_ABNORMAL_PHI\n+\t\t       (GIMPLE_STMT_OPERAND (stmt, 0)))\n+\t\t   && !tree_could_throw_p (stmt))\n \t    {\n \t      if (make_values_for_stmt (stmt, block))\n \t\tcontinue;"}]}