{"sha": "4e08ba6c027785116a70d4a45ae8c1a0fa261f92", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGUwOGJhNmMwMjc3ODUxMTZhNzBkNGE0NWFlOGMxYTBmYTI2MWY5Mg==", "commit": {"author": {"name": "Stan Shebs", "email": "shebs@apple.com", "date": "2001-08-02T01:40:01Z"}, "committer": {"name": "Stan Shebs", "email": "shebs@gcc.gnu.org", "date": "2001-08-02T01:40:01Z"}, "message": "darwin.c (machopic_stub_name): Try matching by name.\n\n        * config/darwin.c (machopic_stub_name): Try matching by name.\n        (update_stubs): New function.\n        (darwin_encode_section_info):  Call it and update_non_lazy_ptrs\n        unconditionally.\n\nFrom-SVN: r44562", "tree": {"sha": "79781eb2cf77e53ee3795a0bf77e941274995a5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/79781eb2cf77e53ee3795a0bf77e941274995a5f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4e08ba6c027785116a70d4a45ae8c1a0fa261f92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e08ba6c027785116a70d4a45ae8c1a0fa261f92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e08ba6c027785116a70d4a45ae8c1a0fa261f92", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e08ba6c027785116a70d4a45ae8c1a0fa261f92/comments", "author": null, "committer": null, "parents": [{"sha": "7a900ebc50d0b561682cdb63fd94a674392d05ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a900ebc50d0b561682cdb63fd94a674392d05ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a900ebc50d0b561682cdb63fd94a674392d05ff"}], "stats": {"total": 48, "additions": 45, "deletions": 3}, "files": [{"sha": "b0802ccdfdb9dd26f9dfd08aabd88cdb18f2b72e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4e08ba6c027785116a70d4a45ae8c1a0fa261f92/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4e08ba6c027785116a70d4a45ae8c1a0fa261f92/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4e08ba6c027785116a70d4a45ae8c1a0fa261f92", "patch": "@@ -1,3 +1,10 @@\n+2001-08-01  Stan Shebs  <shebs@apple.com>\n+\n+\t* config/darwin.c (machopic_stub_name): Try matching by name.\n+\t(update_stubs): New function.\n+\t(darwin_encode_section_info):  Call it and update_non_lazy_ptrs\n+\tunconditionally.\n+\n 2001-08-01  Richard Henderson  <rth@redhat.com>\n \n \t* except.c (output_function_exception_table): Use assemble_align."}, {"sha": "65311a3a61583e8be7265f2872c79abc5870dea6", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 38, "deletions": 3, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4e08ba6c027785116a70d4a45ae8c1a0fa261f92/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4e08ba6c027785116a70d4a45ae8c1a0fa261f92/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=4e08ba6c027785116a70d4a45ae8c1a0fa261f92", "patch": "@@ -45,6 +45,7 @@ extern void machopic_output_stub PARAMS ((FILE *, const char *, const char *));\n static int machopic_data_defined_p PARAMS ((const char *));\n static int func_name_maybe_scoped PARAMS ((const char *));\n static void update_non_lazy_ptrs PARAMS ((const char *));\n+static void update_stubs PARAMS ((const char *));\n \n int\n name_needs_quotes (name)\n@@ -330,6 +331,8 @@ machopic_stub_name (name)\n     {\n       if (ident == TREE_VALUE (temp))\n \treturn IDENTIFIER_POINTER (TREE_PURPOSE (temp));\n+      if (strcmp (name, IDENTIFIER_POINTER (TREE_VALUE (temp))) == 0)\n+\treturn IDENTIFIER_POINTER (TREE_PURPOSE (temp));\n     }\n \n   STRIP_NAME_ENCODING (name, name);\n@@ -1025,9 +1028,6 @@ darwin_encode_section_info (decl)\n       memcpy (new_str, orig_str, len);\n       new_str[1] = code;\n       XSTR (sym_ref, 0) = ggc_alloc_string (new_str, len);\n-      /* The non-lazy pointer list may have captured references to the\n-\t old encoded name, change them.  */\n-      update_non_lazy_ptrs (XSTR (sym_ref, 0));\n     }\n   else\n     {\n@@ -1041,6 +1041,10 @@ darwin_encode_section_info (decl)\n       memcpy (new_str + 4, orig_str, len);\n       XSTR (sym_ref, 0) = ggc_alloc_string (new_str, new_len);\n     }\n+  /* The non-lazy pointer list may have captured references to the\n+     old encoded name, change them.  */\n+  update_non_lazy_ptrs (XSTR (sym_ref, 0));\n+  update_stubs (XSTR (sym_ref, 0));\n }\n \n /* Scan the list of non-lazy pointers and update any recorded names whose\n@@ -1072,3 +1076,34 @@ update_non_lazy_ptrs (name)\n \t}\n     }\n }\n+\n+\n+/* Scan the list of stubs and update any recorded names whose\n+   stripped name matches the argument.  */\n+\n+static void\n+update_stubs (name)\n+     const char *name;\n+{\n+  char *name1, *name2;\n+  tree temp;\n+\n+  STRIP_NAME_ENCODING (name1, name);\n+\n+  for (temp = machopic_stubs;\n+       temp != NULL_TREE; \n+       temp = TREE_CHAIN (temp))\n+    {\n+      char *sym_name = IDENTIFIER_POINTER (TREE_VALUE (temp));\n+\n+      if (*sym_name == '!')\n+\t{\n+\t  STRIP_NAME_ENCODING (name2, sym_name);\n+\t  if (strcmp (name1, name2) == 0)\n+\t    {\n+\t      IDENTIFIER_POINTER (TREE_VALUE (temp)) = name;\n+\t      break;\n+\t    }\n+\t}\n+    }\n+}"}]}