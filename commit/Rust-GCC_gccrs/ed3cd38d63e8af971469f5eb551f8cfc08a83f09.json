{"sha": "ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWQzY2QzOGQ2M2U4YWY5NzE0NjlmNWViNTUxZjhjZmMwOGE4M2YwOQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-04-06T20:46:29Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-04-06T20:46:29Z"}, "message": "re PR debug/80234 (ICE in splice_child_die at dwarfout.c:5265)\n\n\tPR debug/80234\n\t* dwarf2out.c (gen_member_die): Handle C++17 inline static data\n\tmembers with redundant out-of-class redeclaration.\n\n\t* g++.dg/debug/dwarf2/pr80234-1.C: New test.\n\t* g++.dg/debug/dwarf2/pr80234-2.C: New test.\n\nFrom-SVN: r246743", "tree": {"sha": "ad9d43a716508a1d3627dc4f83184c729135240b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad9d43a716508a1d3627dc4f83184c729135240b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "926e747845a2cb5782942735d28abf479c2d825c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/926e747845a2cb5782942735d28abf479c2d825c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/926e747845a2cb5782942735d28abf479c2d825c"}], "stats": {"total": 76, "additions": 72, "deletions": 4}, "files": [{"sha": "dc518ee559fda8985148f9dd409b3fec03d0cde7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "patch": "@@ -1,3 +1,9 @@\n+2017-04-06  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/80234\n+\t* dwarf2out.c (gen_member_die): Handle C++17 inline static data\n+\tmembers with redundant out-of-class redeclaration.\n+\n 2017-04-06  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/80286"}, {"sha": "8c3b1868f69b3ef831a1217be485718291d527e6", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 30, "deletions": 4, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "patch": "@@ -24085,6 +24085,10 @@ gen_member_die (tree type, dw_die_ref context_die)\n   for (member = TYPE_FIELDS (type); member; member = DECL_CHAIN (member))\n     {\n       struct vlr_context vlr_ctx = { type, NULL_TREE };\n+      bool static_inline_p\n+\t= (TREE_STATIC (member)\n+\t   && (lang_hooks.decls.decl_dwarf_attribute (member, DW_AT_inline)\n+\t       != -1));\n \n       /* If we thought we were generating minimal debug info for TYPE\n \t and then changed our minds, some of the member declarations\n@@ -24096,9 +24100,33 @@ gen_member_die (tree type, dw_die_ref context_die)\n \t{\n \t  /* Handle inline static data members, which only have in-class\n \t     declarations.  */\n+\t  dw_die_ref ref = NULL; \n+\t  if (child->die_tag == DW_TAG_variable\n+\t      && child->die_parent == comp_unit_die ())\n+\t    {\n+\t      ref = get_AT_ref (child, DW_AT_specification);\n+\t      /* For C++17 inline static data members followed by redundant\n+\t\t out of class redeclaration, we might get here with\n+\t\t child being the DIE created for the out of class\n+\t\t redeclaration and with its DW_AT_specification being\n+\t\t the DIE created for in-class definition.  We want to\n+\t\t reparent the latter, and don't want to create another\n+\t\t DIE with DW_AT_specification in that case, because\n+\t\t we already have one.  */\n+\t      if (ref\n+\t\t  && static_inline_p\n+\t\t  && ref->die_tag == DW_TAG_variable\n+\t\t  && ref->die_parent == comp_unit_die ()\n+\t\t  && get_AT (ref, DW_AT_specification) == NULL)\n+\t\t{\n+\t\t  child = ref;\n+\t\t  ref = NULL;\n+\t\t  static_inline_p = false;\n+\t\t}\n+\t    }\n \t  if (child->die_tag == DW_TAG_variable\n \t      && child->die_parent == comp_unit_die ()\n-\t      && get_AT (child, DW_AT_specification) == NULL)\n+\t      && ref == NULL)\n \t    {\n \t      reparent_child (child, context_die);\n \t      if (dwarf_version < 5)\n@@ -24126,9 +24154,7 @@ gen_member_die (tree type, dw_die_ref context_die)\n       /* For C++ inline static data members emit immediately a DW_TAG_variable\n \t DIE that will refer to that DW_TAG_member/DW_TAG_variable through\n \t DW_AT_specification.  */\n-      if (TREE_STATIC (member)\n-\t  && (lang_hooks.decls.decl_dwarf_attribute (member, DW_AT_inline)\n-\t      != -1))\n+      if (static_inline_p)\n \t{\n \t  int old_extern = DECL_EXTERNAL (member);\n \t  DECL_EXTERNAL (member) = 0;"}, {"sha": "0cb18d4cd4cf28bd873a77bd827d304c6bbe6b26", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "patch": "@@ -1,3 +1,9 @@\n+2017-04-06  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/80234\n+\t* g++.dg/debug/dwarf2/pr80234-1.C: New test.\n+\t* g++.dg/debug/dwarf2/pr80234-2.C: New test.\n+\n 2017-04-06  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/79733"}, {"sha": "5ab8ca84aafaa7a29a0dd9cf28e4167fbc61ef11", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/pr80234-1.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr80234-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr80234-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr80234-1.C?ref=ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "patch": "@@ -0,0 +1,15 @@\n+// PR debug/80234\n+// { dg-do compile }\n+// { dg-options \"-gdwarf-4 -std=c++17\" }\n+\n+struct S\n+{\n+  static constexpr const char n = 'S';\n+  virtual ~S ();\n+};\n+\n+constexpr const char S::n;\n+\n+S::~S()\n+{\n+}"}, {"sha": "145beacf6eb2c2983a4d9cab24f980a0facd43b3", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/pr80234-2.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr80234-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed3cd38d63e8af971469f5eb551f8cfc08a83f09/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr80234-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpr80234-2.C?ref=ed3cd38d63e8af971469f5eb551f8cfc08a83f09", "patch": "@@ -0,0 +1,15 @@\n+// PR debug/80234\n+// { dg-do compile }\n+// { dg-options \"-gdwarf-5 -std=c++17\" }\n+\n+struct S\n+{\n+  static constexpr const char n = 'S';\n+  virtual ~S ();\n+};\n+\n+constexpr const char S::n;\n+\n+S::~S()\n+{\n+}"}]}