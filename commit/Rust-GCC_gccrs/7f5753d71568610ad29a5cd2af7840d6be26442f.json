{"sha": "7f5753d71568610ad29a5cd2af7840d6be26442f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y1NzUzZDcxNTY4NjEwYWQyOWE1Y2QyYWY3ODQwZDZiZTI2NDQyZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-20T08:21:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-20T08:21:36Z"}, "message": "re PR c++/84449 (ICE with constexpr and deleted destructor)\n\n\tPR c++/84449\n\t* tree.c (bot_manip): If build_cplus_new or break_out_target_exprs\n\treturns error_mark_node, return it immediately.\n\t(break_out_target_exprs): If cp_walk_tree with bot_manip returns\n\terror_mark_node, return error_mark_node.\n\n\t* g++.dg/cpp0x/constexpr-84449.C: New test.\n\nFrom-SVN: r257839", "tree": {"sha": "2fd070be67ef41eb656524225c03f066f0772be4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2fd070be67ef41eb656524225c03f066f0772be4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f5753d71568610ad29a5cd2af7840d6be26442f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f5753d71568610ad29a5cd2af7840d6be26442f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f5753d71568610ad29a5cd2af7840d6be26442f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f5753d71568610ad29a5cd2af7840d6be26442f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dda0944cd51484658f2e1d3ec39800fd6709b6af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dda0944cd51484658f2e1d3ec39800fd6709b6af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dda0944cd51484658f2e1d3ec39800fd6709b6af"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "8a786bb4c0692de324bfccc713c619766a8e0d31", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7f5753d71568610ad29a5cd2af7840d6be26442f", "patch": "@@ -1,5 +1,11 @@\n 2018-02-20  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/84449\n+\t* tree.c (bot_manip): If build_cplus_new or break_out_target_exprs\n+\treturns error_mark_node, return it immediately.\n+\t(break_out_target_exprs): If cp_walk_tree with bot_manip returns\n+\terror_mark_node, return error_mark_node.\n+\n \tPR c++/84455\n \t* pt.c (tsubst_lambda_expr): If not nested, increment temporarily\n \tfunction_depth to avoid GC during finish_lambda_function."}, {"sha": "39c1ef28b2d04a5f5dea72d63d550ea26626834c", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=7f5753d71568610ad29a5cd2af7840d6be26442f", "patch": "@@ -2896,6 +2896,8 @@ bot_manip (tree* tp, int* walk_subtrees, void* data)\n \t{\n \t  u = build_cplus_new (TREE_TYPE (t), TREE_OPERAND (t, 1),\n \t\t\t       tf_warning_or_error);\n+\t  if (u == error_mark_node)\n+\t    return u;\n \t  if (AGGR_INIT_ZERO_FIRST (TREE_OPERAND (t, 1)))\n \t    AGGR_INIT_ZERO_FIRST (TREE_OPERAND (u, 1)) = true;\n \t}\n@@ -2913,6 +2915,8 @@ bot_manip (tree* tp, int* walk_subtrees, void* data)\n \t\t\t (splay_tree_value) TREE_OPERAND (u, 0));\n \n       TREE_OPERAND (u, 1) = break_out_target_exprs (TREE_OPERAND (u, 1));\n+      if (TREE_OPERAND (u, 1) == error_mark_node)\n+\treturn error_mark_node;\n \n       /* Replace the old expression with the new version.  */\n       *tp = u;\n@@ -3025,7 +3029,8 @@ break_out_target_exprs (tree t)\n     target_remap = splay_tree_new (splay_tree_compare_pointers,\n \t\t\t\t   /*splay_tree_delete_key_fn=*/NULL,\n \t\t\t\t   /*splay_tree_delete_value_fn=*/NULL);\n-  cp_walk_tree (&t, bot_manip, target_remap, NULL);\n+  if (cp_walk_tree (&t, bot_manip, target_remap, NULL) == error_mark_node)\n+    t = error_mark_node;\n   cp_walk_tree (&t, bot_replace, target_remap, NULL);\n \n   if (!--target_remap_count)"}, {"sha": "fd21d3b8a42bf390d77bf009e6a13f4e85025862", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7f5753d71568610ad29a5cd2af7840d6be26442f", "patch": "@@ -1,5 +1,8 @@\n 2018-02-20  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/84449\n+\t* g++.dg/cpp0x/constexpr-84449.C: New test.\n+\n \tPR c++/84455\n \t* g++.dg/cpp0x/lambda/lambda-ice26.C: New test.\n "}, {"sha": "f187c425272988997167fd11576976ec8710d7ed", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-84449.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-84449.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f5753d71568610ad29a5cd2af7840d6be26442f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-84449.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-84449.C?ref=7f5753d71568610ad29a5cd2af7840d6be26442f", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/84449\n+// { dg-do compile { target c++11 } }\n+\n+struct A\n+{\n+  constexpr A (int) {}\n+  ~A () = delete;\n+};\n+\n+struct B\n+{\n+  A a;\n+  constexpr B () : a (0) {}\t// { dg-error \"use of deleted function\" }\n+};"}]}