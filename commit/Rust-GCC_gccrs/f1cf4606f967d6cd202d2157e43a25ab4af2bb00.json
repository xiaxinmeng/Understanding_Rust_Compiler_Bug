{"sha": "f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjFjZjQ2MDZmOTY3ZDZjZDIwMmQyMTU3ZTQzYTI1YWI0YWYyYmIwMA==", "commit": {"author": {"name": "Marc Espie", "email": "espie@cvs.openbsd.org", "date": "2001-07-13T18:12:22Z"}, "committer": {"name": "Marc Espie", "email": "espie@gcc.gnu.org", "date": "2001-07-13T18:12:22Z"}, "message": "config.gcc (*-*-openbsd*): Add fragment to compile libgcc correctly for shared configurations.\n\n2001-07-13  Marc Espie  <espie@cvs.openbsd.org>\n\n\t* config.gcc (*-*-openbsd*):  Add fragment to compile libgcc\n\tcorrectly for shared configurations.\n\t* config/t-libgcc-pic:  New.\n\t* config/{i386,m68k,sparc}/t-openbsd:  New.\n\t* config/openbsd.h:  Include cpu_spec in cpp_spec where needed.\n\tSupport -shared.  Support debugging libraries with -g.\n\t* config/i386/openbsd.h:  Correct ASM_COMMENT_START.  Ensure dwarf2\n\tframe information does not emit pointer diffs.\n\t* config/sparc/openbsd.h:  Ensure dwarf2 frame information does not\n\temit pointer diffs.\n\nFrom-SVN: r43988", "tree": {"sha": "85a550762d0c195f69d066c9199eb145b33ed9ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/85a550762d0c195f69d066c9199eb145b33ed9ab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/comments", "author": null, "committer": null, "parents": [{"sha": "998d20d22a7632ac162773c0561bc8cd6f269f26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/998d20d22a7632ac162773c0561bc8cd6f269f26", "html_url": "https://github.com/Rust-GCC/gccrs/commit/998d20d22a7632ac162773c0561bc8cd6f269f26"}], "stats": {"total": 59, "additions": 54, "deletions": 5}, "files": [{"sha": "7c5ec9c4b2e61744ae91dcbe0f277d36a3e5ca54", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -1,3 +1,16 @@\n+2001-07-13  Marc Espie  <espie@cvs.openbsd.org>\n+\n+\t* config.gcc (*-*-openbsd*):  Add fragment to compile libgcc\n+\tcorrectly for shared configurations.\n+\t* config/t-libgcc-pic:  New.\n+\t* config/{i386,m68k,sparc}/t-openbsd:  New.\n+\t* config/openbsd.h:  Include cpu_spec in cpp_spec where needed.\n+\tSupport -shared.  Support debugging libraries with -g.\n+\t* config/i386/openbsd.h:  Correct ASM_COMMENT_START.  Ensure dwarf2\n+\tframe information does not emit pointer diffs.\n+\t* config/sparc/openbsd.h:  Ensure dwarf2 frame information does not\n+\temit pointer diffs.\n+\n 2001-07-13  Geoffrey Keating  <geoffk@redhat.com>\n \n \tRevert Jan Hubicka's patch of Fri Jul 13 14:46:21 CEST 2001."}, {"sha": "932b00dbb12b538cc81d28c87afd14aa52919573", "filename": "gcc/config.gcc", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -286,7 +286,7 @@ case $machine in\n \t;;\n *-*-openbsd*)\n \ttm_file=${cpu_type}/openbsd.h\n-\ttmake_file=\"t-libc-ok t-openbsd\"\n+\ttmake_file=\"t-libc-ok t-openbsd t-libgcc-pic\"\n \txm_defines=POSIX\n \tif test x$enable_threads = xyes; then\n \t\tthread_file='posix'\n@@ -1058,6 +1058,8 @@ i[34567]86-*-netbsd*)\n \tuse_collect2=yes\n \t;;\n i[34567]86-*-openbsd*)\n+\t# needed to unconfuse gdb\n+\ttmake_file=\"t-libc-ok t-openbsd i386/t-openbsd\"\n \t# we need collect2 until our bug is fixed...\n \tuse_collect2=yes\n \t;;\n@@ -1859,6 +1861,8 @@ m68k*-*-netbsd*)\n \tuse_collect2=yes\n \t;;\n m68k*-*-openbsd*)\n+\t# needed to unconfuse gdb\n+\ttmake_file=\"t-libc-ok t-openbsd m68k/t-openbsd\"\n \tfloat_format=m68k\n \t# we need collect2 until our bug is fixed...\n \tuse_collect2=yes\n@@ -2830,6 +2834,8 @@ sparc-*-netbsd*)\n \tuse_collect2=yes\n \t;;\n sparc-*-openbsd*)\n+\t# needed to unconfuse gdb\n+\ttmake_file=\"t-libc-ok t-openbsd sparc/t-openbsd\"\n \t# we need collect2 until our bug is fixed...\n \tuse_collect2=yes\n \t;;"}, {"sha": "470577505373e9f0053ae183eaf57b9867e5970b", "filename": "gcc/config/i386/openbsd.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fi386%2Fopenbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fi386%2Fopenbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fopenbsd.h?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -111,6 +111,8 @@ Boston, MA 02111-1307, USA.  */\n    configuration files...  */\n #define DWARF2_UNWIND_INFO 0\n \n+#undef ASM_PREFERRED_EH_DATA_FORMAT\n+\n /* Assembler format: alignment output.  */\n \n /* A C statement to output to the stdio stream FILE an assembler\n@@ -130,3 +132,7 @@ Boston, MA 02111-1307, USA.  */\n #endif\n \n /* Note that we pick up ASM_OUTPUT_MI_THUNK from unix.h.  */\n+\n+#undef ASM_COMMENT_START\n+#define ASM_COMMENT_START \";#\"\n+"}, {"sha": "18304634000b89d02e4b3709a6f5b6de87bb7987", "filename": "gcc/config/i386/t-openbsd", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fi386%2Ft-openbsd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fi386%2Ft-openbsd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Ft-openbsd?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -0,0 +1,6 @@\n+# gdb gets confused if pic code is linked with non pic\n+# We cope by building variants of libgcc.\n+MULTILIB_OPTIONS = fpic\n+MULTILIB_MATCHES=fpic=fPIC\n+LIBGCC = stmp-multilib\n+INSTALL_LIBGCC = install-multilib"}, {"sha": "24f9a43b000b734221b16460469f3b45e26e93e6", "filename": "gcc/config/m68k/t-openbsd", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fm68k%2Ft-openbsd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fm68k%2Ft-openbsd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Ft-openbsd?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -0,0 +1,5 @@\n+# gdb gets confused if pic code is linked with non pic\n+# We cope by building all variants of libgcc.\n+MULTILIB_OPTIONS = fpic/fPIC\n+LIBGCC = stmp-multilib\n+INSTALL_LIBGCC = install-multilib"}, {"sha": "ff1c1ad540b79842d0122cc6a9bcfd9d2700dd9a", "filename": "gcc/config/openbsd.h", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fopenbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fopenbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fopenbsd.h?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -78,12 +78,16 @@ Boston, MA 02111-1307, USA.  */\n    since all code must be compiled with -pthread to work. \n    This two-stage defines makes it easy to pick that for targets that\n    have subspecs.  */\n+#ifdef CPP_CPU_SPEC\n+#define OBSD_CPP_SPEC \"%(cpp_cpu) %{posix:-D_POSIX_SOURCE} %{pthread:-D_POSIX_THREADS}\"\n+#else\n #define OBSD_CPP_SPEC \"%{posix:-D_POSIX_SOURCE} %{pthread:-D_POSIX_THREADS}\"\n+#endif\n \n /* LIB_SPEC appropriate for OpenBSD.  Select the appropriate libc, \n    depending on profiling and threads.  Basically, \n    -lc(_r)?(_p)?, select _r for threads, and _p for p or pg.  */\n-#define OBSD_LIB_SPEC \"-lc%{pthread:_r}%{p:_p}%{!p:%{pg:_p}}\"\n+#define OBSD_LIB_SPEC \"%{!shared:-lc%{pthread:_r}%{p:_p}%{!p:%{pg:_p}}}\"\n \n #ifndef OBSD_HAS_CORRECT_SPECS\n \n@@ -103,6 +107,7 @@ Boston, MA 02111-1307, USA.  */\n    pic code.  */\n #undef ASM_SPEC\n #define ASM_SPEC \"%{fpic:-k} %{fPIC:-k -K} %|\"\n+\n #else\n /* Since we use gas, stdin -> - is a good idea, but we don't want to\n    override native specs just for that.  */\n@@ -116,10 +121,10 @@ Boston, MA 02111-1307, USA.  */\n #undef LINK_SPEC\n #ifdef OBSD_NO_DYNAMIC_LIBRARIES\n #define LINK_SPEC \\\n-  \"%{!nostdlib:%{!r*:%{!e*:-e start}}} -dc -dp %{assert*}\"\n+  \"%{g:%{!nostdlib:-L/usr/lib/debug}} %{!nostdlib:%{!r*:%{!e*:-e start}}} -dc -dp %{assert*}\"\n #else\n #define LINK_SPEC \\\n-  \"%{!shared:%{!nostdlib:%{!r*:%{!e*:-e start}}}} %{shared:-Bshareable -x} -dc -dp %{R*} %{static:-Bstatic} %{assert*}\"\n+  \"%{g:%{!nostdlib:-L/usr/lib/debug}} %{!shared:%{!nostdlib:%{!r*:%{!e*:-e start}}}} %{shared:-Bshareable -x} -dc -dp %{R*} %{static:-Bstatic} %{assert*}\"\n #endif\n \n #undef LIB_SPEC"}, {"sha": "ba97ac7b9de4722c09ae6601ca4c652976f11007", "filename": "gcc/config/sparc/openbsd.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fsparc%2Fopenbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fsparc%2Fopenbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fopenbsd.h?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -64,5 +64,6 @@ Boston, MA 02111-1307, USA.  */\n    configuration files...  */\n #define DWARF2_UNWIND_INFO 0\n \n-/* Default sparc.h does already define ASM_OUTPUT_MI_THUNK */\n+#undef ASM_PREFERRED_EH_DATA_FORMAT\n \n+/* Default sparc.h does already define ASM_OUTPUT_MI_THUNK */"}, {"sha": "898a24e079d9912234612ff3a43cd7620abff182", "filename": "gcc/config/sparc/t-openbsd", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fsparc%2Ft-openbsd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Fsparc%2Ft-openbsd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Ft-openbsd?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -0,0 +1,5 @@\n+# The native linker doesn't handle linking -fpic code with -fPIC code.  Ugh.\n+# We cope by building both variants of libgcc.\n+MULTILIB_OPTIONS = fpic/fPIC\n+LIBGCC = stmp-multilib\n+INSTALL_LIBGCC = install-multilib"}, {"sha": "ff935fe1e057424b0074b68476114c98f30441f4", "filename": "gcc/config/t-libgcc-pic", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Ft-libgcc-pic", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1cf4606f967d6cd202d2157e43a25ab4af2bb00/gcc%2Fconfig%2Ft-libgcc-pic", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ft-libgcc-pic?ref=f1cf4606f967d6cd202d2157e43a25ab4af2bb00", "patch": "@@ -0,0 +1,2 @@\n+# Compile libgcc2.a with pic.\n+TARGET_LIBGCC2_CFLAGS = -fPIC"}]}