{"sha": "bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmI3ZWJhZDFjMGY2NDE3NTNmZmI2MGEyMmQyZjNjNTQ2YzQwNmUxYg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2016-08-11T08:49:56Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2016-08-11T08:49:56Z"}, "message": "tree-ssa-threadbackward.c (pass_data_thread_jumps): Remove unconditional TODO_cleanup_cfg.\n\n2016-08-11  Richard Biener  <rguenther@suse.de>\n\n\t* tree-ssa-threadbackward.c (pass_data_thread_jumps): Remove\n\tunconditional TODO_cleanup_cfg.\n\t(pass_thread_jumps::execute): Initialize loops, perform a CFG\n\tcleanup only if we threaded a jump.\n\n\t* gcc.dg/tree-ssa/ssa-dom-thread-7.c: Adjust.\n\nFrom-SVN: r239355", "tree": {"sha": "96bdae5b59a4b3af8514e48519f238d75d480175", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96bdae5b59a4b3af8514e48519f238d75d480175"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7d188edd736820008bc161a200ebd92eba29a716", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d188edd736820008bc161a200ebd92eba29a716", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d188edd736820008bc161a200ebd92eba29a716"}], "stats": {"total": 26, "additions": 21, "deletions": 5}, "files": [{"sha": "d8c65cf3e104c5c7a40ceb7b8712f30e573b912a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "patch": "@@ -1,3 +1,10 @@\n+2016-08-11  Richard Biener  <rguenther@suse.de>\n+\n+\t* tree-ssa-threadbackward.c (pass_data_thread_jumps): Remove\n+\tunconditional TODO_cleanup_cfg.\n+\t(pass_thread_jumps::execute): Initialize loops, perform a CFG\n+\tcleanup only if we threaded a jump.\n+\n 2016-08-11  Alan Modra  <amodra@gmail.com>\n \n \tPR target/71680"}, {"sha": "6798ff8ae481f20961d1a116b44bbe960c79227b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "patch": "@@ -1,3 +1,7 @@\n+2016-08-11  Richard Biener  <rguenther@suse.de>\n+\n+\t* gcc.dg/tree-ssa/ssa-dom-thread-7.c: Adjust.\n+\n 2016-08-11  Alan Modra  <amodra@gmail.com>\n \n \t* gcc.target/powerpc/pr71680.c: New."}, {"sha": "9a9d1cb7cf7cec17b6be7adff5dd6bcdba95e72d", "filename": "gcc/testsuite/gcc.dg/tree-ssa/ssa-dom-thread-7.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-dom-thread-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-dom-thread-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-dom-thread-7.c?ref=bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "patch": "@@ -1,8 +1,9 @@\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -fdump-tree-thread1-stats -fdump-tree-thread2-stats -fdump-tree-thread3-stats -fdump-tree-dom3-stats -fdump-tree-vrp2-stats -fno-guess-branch-probability\" } */\n+/* { dg-options \"-O2 -fdump-tree-thread1-stats -fdump-tree-thread2-stats -fdump-tree-dom2-stats -fdump-tree-thread3-stats -fdump-tree-dom3-stats -fdump-tree-vrp2-stats -fno-guess-branch-probability\" } */\n /* { dg-final { scan-tree-dump \"Jumps threaded: 16\"  \"thread1\" } } */\n-/* { dg-final { scan-tree-dump \"Jumps threaded: 6\" \"thread2\" } } */\n+/* { dg-final { scan-tree-dump \"Jumps threaded: 9\" \"thread2\" } } */\n /* { dg-final { scan-tree-dump \"Jumps threaded: 3\" \"thread3\" } } */\n+/* { dg-final { scan-tree-dump-not \"Jumps threaded\"  \"dom2\" } } */\n /* { dg-final { scan-tree-dump-not \"Jumps threaded\"  \"dom3\" } } */\n /* { dg-final { scan-tree-dump-not \"Jumps threaded\"  \"vrp2\" } } */\n "}, {"sha": "506078f23581a59eb6c81f4b51f5405ddb299cda", "filename": "gcc/tree-ssa-threadbackward.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2Ftree-ssa-threadbackward.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7ebad1c0f641753ffb60a22d2f3c546c406e1b/gcc%2Ftree-ssa-threadbackward.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-threadbackward.c?ref=bb7ebad1c0f641753ffb60a22d2f3c546c406e1b", "patch": "@@ -674,7 +674,7 @@ const pass_data pass_data_thread_jumps =\n   0,\n   0,\n   0,\n-  ( TODO_cleanup_cfg | TODO_update_ssa ),\n+  TODO_update_ssa,\n };\n \n class pass_thread_jumps : public gimple_opt_pass\n@@ -699,15 +699,19 @@ pass_thread_jumps::gate (function *fun ATTRIBUTE_UNUSED)\n unsigned int\n pass_thread_jumps::execute (function *fun)\n {\n+  loop_optimizer_init (LOOPS_HAVE_PREHEADERS | LOOPS_HAVE_SIMPLE_LATCHES);\n+\n   /* Try to thread each block with more than one successor.  */\n   basic_block bb;\n   FOR_EACH_BB_FN (bb, fun)\n     {\n       if (EDGE_COUNT (bb->succs) > 1)\n \tfind_jump_threads_backwards (bb);\n     }\n-  thread_through_all_blocks (true);\n-  return 0;\n+  bool changed = thread_through_all_blocks (true);\n+\n+  loop_optimizer_finalize ();\n+  return changed ? TODO_cleanup_cfg : 0;\n }\n \n }"}]}