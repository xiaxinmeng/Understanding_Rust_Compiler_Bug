{"sha": "11cc5f49ddde6807b157dfaeffc26d286eaf2549", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTFjYzVmNDlkZGRlNjgwN2IxNTdkZmFlZmZjMjZkMjg2ZWFmMjU0OQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2012-01-01T22:33:31Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2012-01-01T22:33:31Z"}, "message": "re PR c++/16603 (Incorrect enumerator type before enumeration's closing brace)\n\n/cp\n2012-01-01  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/16603\n\t* decl.c (build_enumerator): Don't call perform_integral_promotions\n\ton the value.\n\n/testsuite\n2012-01-01  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/16603\n\t* g++.dg/parse/enum8.C: New.\n\nFrom-SVN: r182776", "tree": {"sha": "808f9cfab7d955a51cefa33b0c0ac2bd73f801d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/808f9cfab7d955a51cefa33b0c0ac2bd73f801d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/11cc5f49ddde6807b157dfaeffc26d286eaf2549", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11cc5f49ddde6807b157dfaeffc26d286eaf2549", "html_url": "https://github.com/Rust-GCC/gccrs/commit/11cc5f49ddde6807b157dfaeffc26d286eaf2549", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/11cc5f49ddde6807b157dfaeffc26d286eaf2549/comments", "author": null, "committer": null, "parents": [{"sha": "9f88ff5a1fedb4ac29628ec421ff0cc613ba6f38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f88ff5a1fedb4ac29628ec421ff0cc613ba6f38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f88ff5a1fedb4ac29628ec421ff0cc613ba6f38"}], "stats": {"total": 33, "additions": 26, "deletions": 7}, "files": [{"sha": "c60272131875b5cb37409fb0a5c8652a91ff3956", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=11cc5f49ddde6807b157dfaeffc26d286eaf2549", "patch": "@@ -1,3 +1,9 @@\n+2012-01-01  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/16603\n+\t* decl.c (build_enumerator): Don't call perform_integral_promotions\n+\ton the value.\n+\n 2012-01-01  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/51379"}, {"sha": "48f3085a92f1a43ed25902dcb4b406e66f18d531", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=11cc5f49ddde6807b157dfaeffc26d286eaf2549", "patch": "@@ -12369,14 +12369,11 @@ build_enumerator (tree name, tree value, tree enumtype, location_t loc)\n \t{\n \t  value = cxx_constant_value (value);\n \n-\t  if (TREE_CODE (value) == INTEGER_CST\n-\t      && INTEGRAL_OR_ENUMERATION_TYPE_P (TREE_TYPE (value)))\n+\t  if (TREE_CODE (value) != INTEGER_CST\n+\t      || ! INTEGRAL_OR_ENUMERATION_TYPE_P (TREE_TYPE (value)))\n \t    {\n-\t      value = perform_integral_promotions (value);\n-\t    }\n-\t  else\n-\t    {\n-\t      error (\"enumerator value for %qD is not an integer constant\", name);\n+\t      error (\"enumerator value for %qD is not an integer constant\",\n+\t\t     name);\n \t      value = NULL_TREE;\n \t    }\n \t}"}, {"sha": "3e357228c7bac140b883c6a101f071302f5a146d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=11cc5f49ddde6807b157dfaeffc26d286eaf2549", "patch": "@@ -1,3 +1,8 @@\n+2012-01-01  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/16603\n+\t* g++.dg/parse/enum8.C: New.\n+\n 2012-01-01  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/51379"}, {"sha": "83dd6e0e18f580e03858f02ed83f77e8497a3c4f", "filename": "gcc/testsuite/g++.dg/parse/enum8.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/11cc5f49ddde6807b157dfaeffc26d286eaf2549/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum8.C?ref=11cc5f49ddde6807b157dfaeffc26d286eaf2549", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/16603\n+\n+char const c = 'q';\n+\n+enum\n+  {\n+    x = c,\n+    y = sizeof(x)\n+  };\n+\n+int test[y == sizeof(char) ? 1 : -1];"}]}