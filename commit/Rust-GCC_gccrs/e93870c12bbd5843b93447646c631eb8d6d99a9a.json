{"sha": "e93870c12bbd5843b93447646c631eb8d6d99a9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTkzODcwYzEyYmJkNTg0M2I5MzQ0NzY0NmM2MzFlYjhkNmQ5OWE5YQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-03-24T20:55:43Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-03-24T20:55:43Z"}, "message": "re PR go/65417 (debug/elf: lacks support for PPC relocations)\n\n\tPR go/65417\ndebug/elf: support reading debug info from 32-bit PPC objects\n\nThis is a backport of http://golang.org/7590 from the master\nGo library.\n\nFrom-SVN: r221644", "tree": {"sha": "fabff1b90b4cd9a8bc7b7b25d6913e8da5956eaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fabff1b90b4cd9a8bc7b7b25d6913e8da5956eaa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e93870c12bbd5843b93447646c631eb8d6d99a9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e93870c12bbd5843b93447646c631eb8d6d99a9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e93870c12bbd5843b93447646c631eb8d6d99a9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e93870c12bbd5843b93447646c631eb8d6d99a9a/comments", "author": null, "committer": null, "parents": [{"sha": "ab24432b9ab95cc0e12cb5ae298fffbda04b3202", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab24432b9ab95cc0e12cb5ae298fffbda04b3202", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab24432b9ab95cc0e12cb5ae298fffbda04b3202"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "653b8d42400c3b25eb8541e1dd76fb32406e2dce", "filename": "libgo/go/debug/elf/file.go", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e93870c12bbd5843b93447646c631eb8d6d99a9a/libgo%2Fgo%2Fdebug%2Felf%2Ffile.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e93870c12bbd5843b93447646c631eb8d6d99a9a/libgo%2Fgo%2Fdebug%2Felf%2Ffile.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fdebug%2Felf%2Ffile.go?ref=e93870c12bbd5843b93447646c631eb8d6d99a9a", "patch": "@@ -532,6 +532,9 @@ func (f *File) applyRelocations(dst []byte, rels []byte) error {\n \tif f.Class == ELFCLASS64 && f.Machine == EM_AARCH64 {\n \t\treturn f.applyRelocationsARM64(dst, rels)\n \t}\n+\tif f.Class == ELFCLASS32 && f.Machine == EM_PPC {\n+\t\treturn f.applyRelocationsPPC(dst, rels)\n+\t}\n \tif f.Class == ELFCLASS64 && f.Machine == EM_PPC64 {\n \t\treturn f.applyRelocationsPPC64(dst, rels)\n \t}\n@@ -677,6 +680,46 @@ func (f *File) applyRelocationsARM64(dst []byte, rels []byte) error {\n \treturn nil\n }\n \n+func (f *File) applyRelocationsPPC(dst []byte, rels []byte) error {\n+\t// 12 is the size of Rela32.\n+\tif len(rels)%12 != 0 {\n+\t\treturn errors.New(\"length of relocation section is not a multiple of 12\")\n+\t}\n+\n+\tsymbols, _, err := f.getSymbols(SHT_SYMTAB)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tb := bytes.NewReader(rels)\n+\tvar rela Rela32\n+\n+\tfor b.Len() > 0 {\n+\t\tbinary.Read(b, f.ByteOrder, &rela)\n+\t\tsymNo := rela.Info >> 8\n+\t\tt := R_PPC(rela.Info & 0xff)\n+\n+\t\tif symNo == 0 || symNo > uint32(len(symbols)) {\n+\t\t\tcontinue\n+\t\t}\n+\t\tsym := &symbols[symNo-1]\n+\t\tif SymType(sym.Info&0xf) != STT_SECTION {\n+\t\t\t// We don't handle non-section relocations for now.\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tswitch t {\n+\t\tcase R_PPC_ADDR32:\n+\t\t\tif rela.Off+4 >= uint32(len(dst)) || rela.Addend < 0 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tf.ByteOrder.PutUint32(dst[rela.Off:rela.Off+4], uint32(rela.Addend))\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n func (f *File) applyRelocationsPPC64(dst []byte, rels []byte) error {\n \t// 24 is the size of Rela64.\n \tif len(rels)%24 != 0 {"}, {"sha": "56e2604d9d3f24251a6f01778fb5ace724ddab84", "filename": "libgo/go/debug/elf/file_test.go", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e93870c12bbd5843b93447646c631eb8d6d99a9a/libgo%2Fgo%2Fdebug%2Felf%2Ffile_test.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e93870c12bbd5843b93447646c631eb8d6d99a9a/libgo%2Fgo%2Fdebug%2Felf%2Ffile_test.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fdebug%2Felf%2Ffile_test.go?ref=e93870c12bbd5843b93447646c631eb8d6d99a9a", "patch": "@@ -260,6 +260,12 @@ var relocationTests = []relocationTest{\n \t\t\t{0, &dwarf.Entry{Offset: 0xb, Tag: dwarf.TagCompileUnit, Children: true, Field: []dwarf.Field{{Attr: dwarf.AttrProducer, Val: \"GNU C 4.2.4 (Ubuntu 4.2.4-1ubuntu4)\"}, {Attr: dwarf.AttrLanguage, Val: int64(1)}, {Attr: dwarf.AttrName, Val: \"go-relocation-test-gcc424.c\"}, {Attr: dwarf.AttrCompDir, Val: \"/tmp\"}, {Attr: dwarf.AttrLowpc, Val: uint64(0x0)}, {Attr: dwarf.AttrHighpc, Val: uint64(0x6)}, {Attr: dwarf.AttrStmtList, Val: int64(0)}}}},\n \t\t},\n \t},\n+\t{\n+\t\t\"testdata/go-relocation-test-gcc5-ppc.obj\",\n+\t\t[]relocationTestEntry{\n+\t\t\t{0, &dwarf.Entry{Offset: 0xb, Tag: dwarf.TagCompileUnit, Children: true, Field: []dwarf.Field{dwarf.Field{Attr: dwarf.AttrProducer, Val: \"GNU C11 5.0.0 20150116 (experimental) -Asystem=linux -Asystem=unix -Asystem=posix -g\"}, dwarf.Field{Attr: dwarf.AttrLanguage, Val: int64(12)}, dwarf.Field{Attr: dwarf.AttrName, Val: \"go-relocation-test-gcc5-ppc.c\"}, dwarf.Field{Attr: dwarf.AttrCompDir, Val: \"/tmp\"}, dwarf.Field{Attr: dwarf.AttrLowpc, Val: uint64(0x0)}, dwarf.Field{Attr: dwarf.AttrHighpc, Val: int64(0x44)}, dwarf.Field{Attr: dwarf.AttrStmtList, Val: int64(0)}}}},\n+\t\t},\n+\t},\n \t{\n \t\t\"testdata/go-relocation-test-gcc482-ppc64le.obj\",\n \t\t[]relocationTestEntry{"}, {"sha": "f4165af0982d3b87761a4a540900e687b39e980f", "filename": "libgo/go/debug/elf/testdata/go-relocation-test-gcc5-ppc.obj", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e93870c12bbd5843b93447646c631eb8d6d99a9a/libgo%2Fgo%2Fdebug%2Felf%2Ftestdata%2Fgo-relocation-test-gcc5-ppc.obj", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e93870c12bbd5843b93447646c631eb8d6d99a9a/libgo%2Fgo%2Fdebug%2Felf%2Ftestdata%2Fgo-relocation-test-gcc5-ppc.obj", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fdebug%2Felf%2Ftestdata%2Fgo-relocation-test-gcc5-ppc.obj?ref=e93870c12bbd5843b93447646c631eb8d6d99a9a"}]}