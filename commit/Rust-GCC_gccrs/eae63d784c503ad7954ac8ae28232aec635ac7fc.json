{"sha": "eae63d784c503ad7954ac8ae28232aec635ac7fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWFlNjNkNzg0YzUwM2FkNzk1NGFjOGFlMjgyMzJhZWM2MzVhYzdmYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-01-11T20:10:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-01-11T20:10:36Z"}, "message": "re PR c++/71537 (GCC rejects consetxpr boolean conversions and comparisons on the result of pointer arithmetic.)\n\n\tPR c++/71537\n\t* fold-const.c (maybe_nonzero_address): Return 1 for function\n\tlocal objects.\n\t(tree_single_nonzero_warnv_p): Don't handle function local objects\n\there.\n\n\t* g++.dg/cpp1y/constexpr-71537.C: New test.\n\nFrom-SVN: r244333", "tree": {"sha": "445f6cd62d154885a446d235163b694f1b08a014", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/445f6cd62d154885a446d235163b694f1b08a014"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eae63d784c503ad7954ac8ae28232aec635ac7fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eae63d784c503ad7954ac8ae28232aec635ac7fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eae63d784c503ad7954ac8ae28232aec635ac7fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eae63d784c503ad7954ac8ae28232aec635ac7fc/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "88df7964b5aa1b8cc2226177da25785c58b7c7e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88df7964b5aa1b8cc2226177da25785c58b7c7e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88df7964b5aa1b8cc2226177da25785c58b7c7e2"}], "stats": {"total": 40, "additions": 32, "deletions": 8}, "files": [{"sha": "82847b903abdcd7743980d3c33b927caa90eeb0f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=eae63d784c503ad7954ac8ae28232aec635ac7fc", "patch": "@@ -1,5 +1,11 @@\n 2017-01-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/71537\n+\t* fold-const.c (maybe_nonzero_address): Return 1 for function\n+\tlocal objects.\n+\t(tree_single_nonzero_warnv_p): Don't handle function local objects\n+\there.\n+\n \tPR c++/72813\n \t* gcc.c (default_compilers): Don't add -o %g.s for -S -save-temps\n \tof c-header."}, {"sha": "cfd270ce83c2c942b06cc35a22169d8ba47f1c2f", "filename": "gcc/fold-const.c", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=eae63d784c503ad7954ac8ae28232aec635ac7fc", "patch": "@@ -8171,14 +8171,22 @@ pointer_may_wrap_p (tree base, tree offset, HOST_WIDE_INT bitpos)\n /* Return a positive integer when the symbol DECL is known to have\n    a nonzero address, zero when it's known not to (e.g., it's a weak\n    symbol), and a negative integer when the symbol is not yet in the\n-   symbol table and so whether or not its address is zero is unknown.  */\n+   symbol table and so whether or not its address is zero is unknown.\n+   For function local objects always return positive integer.  */\n static int\n maybe_nonzero_address (tree decl)\n {\n   if (DECL_P (decl) && decl_in_symtab_p (decl))\n     if (struct symtab_node *symbol = symtab_node::get_create (decl))\n       return symbol->nonzero_address ();\n \n+  /* Function local objects are never NULL.  */\n+  if (DECL_P (decl)\n+      && (DECL_CONTEXT (decl)\n+      && TREE_CODE (DECL_CONTEXT (decl)) == FUNCTION_DECL\n+      && auto_var_in_fn_p (decl, DECL_CONTEXT (decl))))\n+    return 1;\n+\n   return -1;\n }\n \n@@ -13276,13 +13284,6 @@ tree_single_nonzero_warnv_p (tree t, bool *strict_overflow_p)\n \tif (nonzero_addr >= 0)\n \t  return nonzero_addr;\n \n-\t/* Function local objects are never NULL.  */\n-\tif (DECL_P (base)\n-\t    && (DECL_CONTEXT (base)\n-\t\t&& TREE_CODE (DECL_CONTEXT (base)) == FUNCTION_DECL\n-\t\t&& auto_var_in_fn_p (base, DECL_CONTEXT (base))))\n-\t  return true;\n-\n \t/* Constants are never weak.  */\n \tif (CONSTANT_CLASS_P (base))\n \t  return true;"}, {"sha": "b8cd53a9bff78f932d7745fa5c965f9029cbcdc1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eae63d784c503ad7954ac8ae28232aec635ac7fc", "patch": "@@ -1,5 +1,8 @@\n 2017-01-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/71537\n+\t* g++.dg/cpp1y/constexpr-71537.C: New test.\n+\n \t* gcc.dg/tree-ssa/flatten-3.c: Add quotation marks around dg-options\n \targument.\n "}, {"sha": "5d468d7c2e75891fc3706d9edd0dbc6ae3deb562", "filename": "gcc/testsuite/g++.dg/cpp1y/constexpr-71537.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-71537.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eae63d784c503ad7954ac8ae28232aec635ac7fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-71537.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-71537.C?ref=eae63d784c503ad7954ac8ae28232aec635ac7fc", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/71537\n+// { dg-do compile { target c++14 } }\n+\n+constexpr bool\n+foo ()\n+{\n+  constexpr int n[42] = { 1 };\n+  constexpr int o = n ? 1 : 0;\n+  constexpr int p = n + 1 ? 1 : 0;\n+  constexpr int q = \"abc\" + 1 ? 1 : 0;\n+  return p + p + q == 3;\n+}\n+\n+static_assert (foo (), \"\");"}]}