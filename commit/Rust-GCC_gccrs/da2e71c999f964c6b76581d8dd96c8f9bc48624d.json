{"sha": "da2e71c999f964c6b76581d8dd96c8f9bc48624d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGEyZTcxYzk5OWY5NjRjNmI3NjU4MWQ4ZGQ5NmM4ZjliYzQ4NjI0ZA==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2015-06-29T16:25:26Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2015-06-29T16:25:26Z"}, "message": "Wunused-parameter warnings are given from cgraph::finalize_function,\n\nwhich is the middle-end. This is an oddity compared to other\n-Wunused-* warnings. Moreover, Fortran has its own definition of\n-Wunused-parameter that conflicts with the middle-end definition.\n\nThis patch moves the middle-end part of Wunused-parameter to the C/C++\nFEs. I'm not sure if other FEs expected this warning to work. If so,\nthey do not seem to test for it. Ada, for example, explicitly disables\nit.\n\ngcc/ChangeLog:\n\n2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/66605\n\t* cgraphunit.c (cgraph_node::finalize_function): Do not call\n\tdo_warn_unused_parameter.\n\t* function.c (do_warn_unused_parameter): Move from here.\n\t* function.h (do_warn_unused_parameter): Do not declare.\n\ngcc/c-family/ChangeLog:\n\n2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/66605\n\t* c-common.c (do_warn_unused_parameter): Move here.\n\t* c-common.h (do_warn_unused_parameter): Declare.\n\ngcc/ada/ChangeLog:\n\n2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/66605\n\t* gcc-interface/misc.c (gnat_post_options): No need to disable\n\twarn_unused_parameter anymore.\n\ngcc/cp/ChangeLog:\n\n2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/66605\n\t* decl.c (finish_function): Call do_warn_unused_parameter.\n\ngcc/testsuite/ChangeLog:\n\n2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/66605\n\t* gfortran.dg/wunused-parameter.f90: New test.\n\ngcc/c/ChangeLog:\n\n2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR fortran/66605\n\t* c-decl.c (finish_function): Call do_warn_unused_parameter.\n\nFrom-SVN: r225135", "tree": {"sha": "37d706419594766fd97ec27e029b3959e40e8aa6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37d706419594766fd97ec27e029b3959e40e8aa6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da2e71c999f964c6b76581d8dd96c8f9bc48624d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da2e71c999f964c6b76581d8dd96c8f9bc48624d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da2e71c999f964c6b76581d8dd96c8f9bc48624d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da2e71c999f964c6b76581d8dd96c8f9bc48624d/comments", "author": null, "committer": null, "parents": [{"sha": "77f3f9bf9eaec6f7095f711024d76a342655863b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77f3f9bf9eaec6f7095f711024d76a342655863b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77f3f9bf9eaec6f7095f711024d76a342655863b"}], "stats": {"total": 100, "additions": 78, "deletions": 22}, "files": [{"sha": "0de1eadae55a61abdd5aff895531595bbaee67fd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1,3 +1,11 @@\n+2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/66605\n+\t* cgraphunit.c (cgraph_node::finalize_function): Do not call\n+\tdo_warn_unused_parameter.\n+\t* function.c (do_warn_unused_parameter): Move from here.\n+\t* function.h (do_warn_unused_parameter): Do not declare.\n+\n 2015-06-29  Matthew Wahab  <matthew.wahab@arm.com>\n \n \tPR target/65697"}, {"sha": "97e293dec1284bc10f233d532c4782029c66a201", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1,3 +1,9 @@\n+2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/66605\n+\t* gcc-interface/misc.c (gnat_post_options): No need to disable\n+\twarn_unused_parameter anymore.\n+\n 2015-06-26  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/trans.c (Handled_Sequence_Of_Statements_to_gnu): When"}, {"sha": "fec71999ac39c2ea88682e2f4f7e3fb0b7635436", "filename": "gcc/ada/gcc-interface/misc.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fada%2Fgcc-interface%2Fmisc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fada%2Fgcc-interface%2Fmisc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fmisc.c?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -262,9 +262,6 @@ gnat_post_options (const char **pfilename ATTRIBUTE_UNUSED)\n     sorry (\"-fexcess-precision=standard for Ada\");\n   flag_excess_precision_cmdline = EXCESS_PRECISION_FAST;\n \n-  /* ??? The warning machinery is outsmarted by Ada.  */\n-  warn_unused_parameter = 0;\n-\n   /* No psABI change warnings for Ada.  */\n   warn_psabi = 0;\n "}, {"sha": "0e03e7e87d0ad9b55c1dae9c152ce7577ec0970c", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1,3 +1,9 @@\n+2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/66605\n+\t* c-common.c (do_warn_unused_parameter): Move here.\n+\t* c-common.h (do_warn_unused_parameter): Declare.\n+\n 2015-06-29  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/66322"}, {"sha": "ac42e4aea9aa0ac01ceb278c91be71c0534d4c04", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -12103,6 +12103,23 @@ do_warn_double_promotion (tree result_type, tree type1, tree type2,\n   warning_at (loc, OPT_Wdouble_promotion, gmsgid, source_type, result_type);\n }\n \n+/* Possibly warn about unused parameters.  */\n+\n+void\n+do_warn_unused_parameter (tree fn)\n+{\n+  tree decl;\n+\n+  for (decl = DECL_ARGUMENTS (fn);\n+       decl; decl = DECL_CHAIN (decl))\n+    if (!TREE_USED (decl) && TREE_CODE (decl) == PARM_DECL\n+\t&& DECL_NAME (decl) && !DECL_ARTIFICIAL (decl)\n+\t&& !TREE_NO_WARNING (decl))\n+      warning_at (DECL_SOURCE_LOCATION (decl), OPT_Wunused_parameter,\n+\t\t  \"unused parameter %qD\", decl);\n+}\n+\n+\n /* Setup a TYPE_DECL node as a typedef representation.\n \n    X is a TYPE_DECL for a typedef statement.  Create a brand new"}, {"sha": "dd9839682c2a38f80101379ada9e81ddbbd5ab73", "filename": "gcc/c-family/c-common.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc-family%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc-family%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.h?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1045,6 +1045,7 @@ extern void warn_for_sign_compare (location_t,\n \t\t\t\t   tree op0, tree op1,\n \t\t\t\t   tree result_type,\n \t\t\t\t   enum tree_code resultcode);\n+extern void do_warn_unused_parameter (tree);\n extern void do_warn_double_promotion (tree, tree, tree, const char *, \n \t\t\t\t      location_t);\n extern void set_underlying_type (tree);"}, {"sha": "15c2303c2de1e974606c174430bbf292944d34e0", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1,3 +1,8 @@\n+2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/66605\n+\t* c-decl.c (finish_function): Call do_warn_unused_parameter.\n+\n 2015-06-29  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/66322"}, {"sha": "383f0a766bf9f80e85284b70eecae35c6c7a4229", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -9028,6 +9028,10 @@ finish_function (void)\n      function.  */\n   maybe_warn_unused_local_typedefs ();\n \n+  /* Possibly warn about unused parameters.  */\n+  if (warn_unused_parameter)\n+    do_warn_unused_parameter (fndecl);\n+\n   /* Store the end of the function, so that we get good line number\n      info for the epilogue.  */\n   cfun->function_end_locus = input_location;"}, {"sha": "7e78bf789155c779f9620a4a5185e7f8465b85a7", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -472,10 +472,6 @@ cgraph_node::finalize_function (tree decl, bool no_collect)\n   if (!TREE_ASM_WRITTEN (decl))\n     (*debug_hooks->deferred_inline_function) (decl);\n \n-  /* Possibly warn about unused parameters.  */\n-  if (warn_unused_parameter)\n-    do_warn_unused_parameter (decl);\n-\n   if (!no_collect)\n     ggc_collect ();\n "}, {"sha": "aad780f6aea4bef593049b7c81eaa437ab8c86c2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1,3 +1,8 @@\n+2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/66605\n+\t* decl.c (finish_function): Call do_warn_unused_parameter.\n+\n 2015-06-29  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/66322"}, {"sha": "3f1cd340e16afcae03f54a4d78c0949b48f0f536", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -14323,6 +14323,12 @@ finish_function (int flags)\n      function.  */\n   maybe_warn_unused_local_typedefs ();\n \n+  /* Possibly warn about unused parameters.  */\n+  if (warn_unused_parameter\n+      && !processing_template_decl \n+      && !DECL_CLONED_FUNCTION_P (fndecl))\n+    do_warn_unused_parameter (fndecl);\n+\n   /* Genericize before inlining.  */\n   if (!processing_template_decl)\n     {"}, {"sha": "de0b38fe52af23da6a74d8d0e6a8e342b4b2e274", "filename": "gcc/function.c", "status": "modified", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ffunction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ffunction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.c?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -5210,20 +5210,6 @@ use_return_register (void)\n   diddle_return_value (do_use_return_reg, NULL);\n }\n \n-/* Possibly warn about unused parameters.  */\n-void\n-do_warn_unused_parameter (tree fn)\n-{\n-  tree decl;\n-\n-  for (decl = DECL_ARGUMENTS (fn);\n-       decl; decl = DECL_CHAIN (decl))\n-    if (!TREE_USED (decl) && TREE_CODE (decl) == PARM_DECL\n-\t&& DECL_NAME (decl) && !DECL_ARTIFICIAL (decl)\n-\t&& !TREE_NO_WARNING (decl))\n-      warning (OPT_Wunused_parameter, \"unused parameter %q+D\", decl);\n-}\n-\n /* Set the location of the insn chain starting at INSN to LOC.  */\n \n static void"}, {"sha": "e92c17c6fcc2c9ac47f8051795aadb6e83b95a3e", "filename": "gcc/function.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ffunction.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ffunction.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffunction.h?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -614,7 +614,6 @@ extern void expand_dummy_function_end (void);\n extern void thread_prologue_and_epilogue_insns (void);\n extern void diddle_return_value (void (*)(rtx, void*), void*);\n extern void clobber_return_register (void);\n-extern void do_warn_unused_parameter (tree);\n extern void expand_function_end (void);\n extern rtx get_arg_pointer_save_area (void);\n extern void maybe_copy_prologue_epilogue_insn (rtx, rtx);"}, {"sha": "b4e9732fc0bfc06fc13d415cc22fe350793c1479", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -1,3 +1,8 @@\n+2015-06-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR fortran/66605\n+\t* gfortran.dg/wunused-parameter.f90: New test.\n+\n 2015-06-29  Richard Henderson  <rth@redhat.com>\n \n \t* gcc.target/i386/asm-flag-1.c: New."}, {"sha": "df39af8aa57d63c6ac2bca8504093ed6f78d6e2d", "filename": "gcc/testsuite/gfortran.dg/wunused-parameter.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ftestsuite%2Fgfortran.dg%2Fwunused-parameter.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da2e71c999f964c6b76581d8dd96c8f9bc48624d/gcc%2Ftestsuite%2Fgfortran.dg%2Fwunused-parameter.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fwunused-parameter.f90?ref=da2e71c999f964c6b76581d8dd96c8f9bc48624d", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do compile }\n+! { dg-options \"-Wunused-parameter\" }\n+! PR66605\n+MODULE test\n+  IMPLICIT NONE\n+  INTEGER, PARAMETER :: wp = KIND(1.0D0)\n+CONTAINS\n+SUBROUTINE sub (neq, time, y, dydt)\n+  IMPLICIT NONE    \n+    INTEGER :: neq\n+    REAL(WP) :: time, y(neq), dydt(neq)\n+\n+    dydt(1) = 1.0 / y(1)\n+END SUBROUTINE sub\n+END MODULE"}]}