{"sha": "bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "node_id": "C_kwDOANBUbNoAKGJmM2I1MzJiNTI0ZWNhY2IzMjAyYWIyYzhhZjQxOWZmYWFhYjdjZmY", "commit": {"author": {"name": "Tejas Joshi", "email": "TejasSanjay.Joshi@amd.com", "date": "2022-06-28T11:03:53Z"}, "committer": {"name": "Venkataramanan Kumar", "email": "Venkataramanan.Kumar@amd.com", "date": "2022-10-21T09:55:57Z"}, "message": "Enable AMD znver4 support and add instruction reservations\n\n2022-09-28  Tejas Joshi <TejasSanjay.Joshi@amd.com>\n\ngcc/ChangeLog:\n\n\t* common/config/i386/cpuinfo.h (get_amd_cpu): Recognize znver4.\n\t* common/config/i386/i386-common.cc (processor_names): Add znver4.\n\t(processor_alias_table): Add znver4 and modularize old znvers.\n\t* common/config/i386/i386-cpuinfo.h (processor_subtypes):\n\tAMDFAM19H_ZNVER4.\n\t* config.gcc (x86_64-*-* |...): Likewise.\n\t* config/i386/driver-i386.cc (host_detect_local_cpu): Let\n\t-march=native recognize znver4 cpus.\n\t* config/i386/i386-c.cc (ix86_target_macros_internal): Add znver4.\n\t* config/i386/i386-options.cc (m_ZNVER4): New definition.\n\t(m_ZNVER): Include m_ZNVER4.\n\t(processor_cost_table): Add znver4.\n\t* config/i386/i386.cc (ix86_reassociation_width): Likewise.\n\t* config/i386/i386.h (processor_type): Add PROCESSOR_ZNVER4.\n\t(PTA_ZNVER1): New definition.\n\t(PTA_ZNVER2): Likewise.\n\t(PTA_ZNVER3): Likewise.\n\t(PTA_ZNVER4): Likewise.\n\t* config/i386/i386.md (define_attr \"cpu\"): Add znver4 and rename\n\tmd file.\n\t* config/i386/x86-tune-costs.h (znver4_cost): New definition.\n\t* config/i386/x86-tune-sched.cc (ix86_issue_rate): Add znver4.\n\t(ix86_adjust_cost): Likewise.\n\t* config/i386/znver1.md: Rename to znver.md.\n\t* config/i386/znver.md: Add new reservations for znver4.\n\t* doc/extend.texi: Add details about znver4.\n\t* doc/invoke.texi: Likewise.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/i386/funcspec-56.inc: Handle new march.\n\t* g++.target/i386/mv29.C: Likewise.", "tree": {"sha": "0fbde96ab28f9269588ac179f880ca78e95ef4fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0fbde96ab28f9269588ac179f880ca78e95ef4fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/comments", "author": {"login": "tejas-amd", "id": 133217167, "node_id": "U_kgDOB_C7jw", "avatar_url": "https://avatars.githubusercontent.com/u/133217167?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tejas-amd", "html_url": "https://github.com/tejas-amd", "followers_url": "https://api.github.com/users/tejas-amd/followers", "following_url": "https://api.github.com/users/tejas-amd/following{/other_user}", "gists_url": "https://api.github.com/users/tejas-amd/gists{/gist_id}", "starred_url": "https://api.github.com/users/tejas-amd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tejas-amd/subscriptions", "organizations_url": "https://api.github.com/users/tejas-amd/orgs", "repos_url": "https://api.github.com/users/tejas-amd/repos", "events_url": "https://api.github.com/users/tejas-amd/events{/privacy}", "received_events_url": "https://api.github.com/users/tejas-amd/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "88b34661f73e9da8032d20a37299223b39db4ef9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88b34661f73e9da8032d20a37299223b39db4ef9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88b34661f73e9da8032d20a37299223b39db4ef9"}], "stats": {"total": 1105, "additions": 1035, "deletions": 70}, "files": [{"sha": "d45451c5704270f124466ef829e6f971e4374510", "filename": "gcc/common/config/i386/cpuinfo.h", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fcommon%2Fconfig%2Fi386%2Fcpuinfo.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fcommon%2Fconfig%2Fi386%2Fcpuinfo.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Fi386%2Fcpuinfo.h?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -253,13 +253,27 @@ get_amd_cpu (struct __processor_model *cpu_model,\n       break;\n     case 0x19:\n       cpu_model->__cpu_type = AMDFAM19H;\n-      /* AMD family 19h version 1.  */\n+      /* AMD family 19h.  */\n       if (model <= 0x0f)\n \t{\n \t  cpu = \"znver3\";\n \t  CHECK___builtin_cpu_is (\"znver3\");\n \t  cpu_model->__cpu_subtype = AMDFAM19H_ZNVER3;\n \t}\n+      else if ((model >= 0x10 && model <= 0x1f)\n+\t\t|| (model >= 0x60 && model <= 0xaf))\n+\t{\n+\t  cpu = \"znver4\";\n+\t  CHECK___builtin_cpu_is (\"znver4\");\n+\t  cpu_model->__cpu_subtype = AMDFAM19H_ZNVER4;\n+\t}\n+      else if (has_cpu_feature (cpu_model, cpu_features2,\n+\t\t\t\tFEATURE_AVX512F))\n+\t{\n+\t  cpu = \"znver4\";\n+\t  CHECK___builtin_cpu_is (\"znver4\");\n+\t  cpu_model->__cpu_subtype = AMDFAM19H_ZNVER4;\n+\t}\n       else if (has_cpu_feature (cpu_model, cpu_features2,\n \t\t\t\tFEATURE_VAES))\n \t{"}, {"sha": "4b01c3540e55a3dd1bd99bfef87ec11fad0d8e7e", "filename": "gcc/common/config/i386/i386-common.cc", "status": "modified", "additions": 8, "deletions": 27, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-common.cc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -1868,7 +1868,8 @@ const char *const processor_names[] =\n   \"btver2\",\n   \"znver1\",\n   \"znver2\",\n-  \"znver3\"\n+  \"znver3\",\n+  \"znver4\"\n };\n \n /* Guarantee that the array is aligned with enum processor_type.  */\n@@ -2104,37 +2105,17 @@ const pta processor_alias_table[] =\n       | PTA_MOVBE | PTA_MWAITX,\n     M_CPU_SUBTYPE (AMDFAM15H_BDVER4), P_PROC_AVX2},\n   {\"znver1\", PROCESSOR_ZNVER1, CPU_ZNVER1,\n-    PTA_64BIT | PTA_MMX | PTA_SSE | PTA_SSE2 | PTA_SSE3\n-      | PTA_SSE4A | PTA_CX16 | PTA_ABM | PTA_SSSE3 | PTA_SSE4_1\n-      | PTA_SSE4_2 | PTA_AES | PTA_PCLMUL | PTA_AVX | PTA_AVX2\n-      | PTA_BMI | PTA_BMI2 | PTA_F16C | PTA_FMA | PTA_PRFCHW\n-      | PTA_FXSR | PTA_XSAVE | PTA_XSAVEOPT | PTA_FSGSBASE\n-      | PTA_RDRND | PTA_MOVBE | PTA_MWAITX | PTA_ADX | PTA_RDSEED\n-      | PTA_CLZERO | PTA_CLFLUSHOPT | PTA_XSAVEC | PTA_XSAVES\n-      | PTA_SHA | PTA_LZCNT | PTA_POPCNT,\n+    PTA_ZNVER1,\n     M_CPU_SUBTYPE (AMDFAM17H_ZNVER1), P_PROC_AVX2},\n   {\"znver2\", PROCESSOR_ZNVER2, CPU_ZNVER2,\n-    PTA_64BIT | PTA_MMX | PTA_SSE | PTA_SSE2 | PTA_SSE3\n-      | PTA_SSE4A | PTA_CX16 | PTA_ABM | PTA_SSSE3 | PTA_SSE4_1\n-      | PTA_SSE4_2 | PTA_AES | PTA_PCLMUL | PTA_AVX | PTA_AVX2\n-      | PTA_BMI | PTA_BMI2 | PTA_F16C | PTA_FMA | PTA_PRFCHW\n-      | PTA_FXSR | PTA_XSAVE | PTA_XSAVEOPT | PTA_FSGSBASE\n-      | PTA_RDRND | PTA_MOVBE | PTA_MWAITX | PTA_ADX | PTA_RDSEED\n-      | PTA_CLZERO | PTA_CLFLUSHOPT | PTA_XSAVEC | PTA_XSAVES\n-      | PTA_SHA | PTA_LZCNT | PTA_POPCNT | PTA_CLWB | PTA_RDPID\n-      | PTA_WBNOINVD,\n+    PTA_ZNVER2,\n     M_CPU_SUBTYPE (AMDFAM17H_ZNVER2), P_PROC_AVX2},\n   {\"znver3\", PROCESSOR_ZNVER3, CPU_ZNVER3,\n-    PTA_64BIT | PTA_MMX | PTA_SSE | PTA_SSE2 | PTA_SSE3\n-      | PTA_SSE4A | PTA_CX16 | PTA_ABM | PTA_SSSE3 | PTA_SSE4_1\n-      | PTA_SSE4_2 | PTA_AES | PTA_PCLMUL | PTA_AVX | PTA_AVX2\n-      | PTA_BMI | PTA_BMI2 | PTA_F16C | PTA_FMA | PTA_PRFCHW\n-      | PTA_FXSR | PTA_XSAVE | PTA_XSAVEOPT | PTA_FSGSBASE\n-      | PTA_RDRND | PTA_MOVBE | PTA_MWAITX | PTA_ADX | PTA_RDSEED\n-      | PTA_CLZERO | PTA_CLFLUSHOPT | PTA_XSAVEC | PTA_XSAVES\n-      | PTA_SHA | PTA_LZCNT | PTA_POPCNT | PTA_CLWB | PTA_RDPID\n-      | PTA_WBNOINVD | PTA_VAES | PTA_VPCLMULQDQ | PTA_PKU,\n+    PTA_ZNVER3,\n     M_CPU_SUBTYPE (AMDFAM19H_ZNVER3), P_PROC_AVX2},\n+  {\"znver4\", PROCESSOR_ZNVER4, CPU_ZNVER4,\n+    PTA_ZNVER4,\n+    M_CPU_SUBTYPE (AMDFAM19H_ZNVER4), P_PROC_AVX512F},\n   {\"btver1\", PROCESSOR_BTVER1, CPU_GENERIC,\n     PTA_64BIT | PTA_MMX | PTA_SSE | PTA_SSE2 | PTA_SSE3\n       | PTA_SSSE3 | PTA_SSE4A | PTA_ABM | PTA_CX16 | PTA_PRFCHW"}, {"sha": "9893fc422bcc255c09f935ad3a9a619bdfa46387", "filename": "gcc/common/config/i386/i386-cpuinfo.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-cpuinfo.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-cpuinfo.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Fi386%2Fi386-cpuinfo.h?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -92,6 +92,7 @@ enum processor_subtypes\n   AMDFAM19H_ZNVER3,\n   INTEL_COREI7_ROCKETLAKE,\n   ZHAOXIN_FAM7H_LUJIAZUI,\n+  AMDFAM19H_ZNVER4,\n   CPU_SUBTYPE_MAX\n };\n "}, {"sha": "160c52c542958a80fa8736def5c2120ae2dab773", "filename": "gcc/config.gcc", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -660,7 +660,7 @@ c7 esther\"\n # 64-bit x86 processors supported by --with-arch=.  Each processor\n # MUST be separated by exactly one space.\n x86_64_archs=\"amdfam10 athlon64 athlon64-sse3 barcelona bdver1 bdver2 \\\n-bdver3 bdver4 znver1 znver2 znver3 btver1 btver2 k8 k8-sse3 opteron \\\n+bdver3 bdver4 znver1 znver2 znver3 znver4 btver1 btver2 k8 k8-sse3 opteron \\\n opteron-sse3 nocona core2 corei7 corei7-avx core-avx-i core-avx2 atom \\\n slm nehalem westmere sandybridge ivybridge haswell broadwell bonnell \\\n silvermont knl knm skylake-avx512 cannonlake icelake-client icelake-server \\\n@@ -3643,6 +3643,10 @@ case ${target} in\n \tarch=znver3\n \tcpu=znver3\n \t;;\n+      znver4-*)\n+\tarch=znver4\n+\tcpu=znver4\n+\t;;\n       bdver4-*)\n         arch=bdver4\n         cpu=bdver4\n@@ -3771,6 +3775,10 @@ case ${target} in\n       znver3-*)\n \tarch=znver3\n \tcpu=znver3\n+\t;;\n+\t  znver4-*)\n+\tarch=znver4\n+\tcpu=znver4\n \t;;\n       bdver4-*)\n         arch=bdver4"}, {"sha": "aa16895442f7575e19d37355237982261fa73867", "filename": "gcc/config/i386/driver-i386.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fdriver-i386.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fdriver-i386.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fdriver-i386.cc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -465,6 +465,8 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n \tprocessor = PROCESSOR_GEODE;\n       else if (has_feature (FEATURE_MOVBE) && family == 22)\n \tprocessor = PROCESSOR_BTVER2;\n+      else if (has_feature (FEATURE_AVX512F))\n+\tprocessor = PROCESSOR_ZNVER4;\n       else if (has_feature (FEATURE_VAES))\n \tprocessor = PROCESSOR_ZNVER3;\n       else if (has_feature (FEATURE_CLWB))\n@@ -779,6 +781,9 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n     case PROCESSOR_ZNVER3:\n       cpu = \"znver3\";\n       break;\n+    case PROCESSOR_ZNVER4:\n+      cpu = \"znver4\";\n+      break;\n     case PROCESSOR_BTVER1:\n       cpu = \"btver1\";\n       break;"}, {"sha": "f70f8918da97201edfd651cc0465107a89699f61", "filename": "gcc/config/i386/i386-c.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386-c.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386-c.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-c.cc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -132,6 +132,10 @@ ix86_target_macros_internal (HOST_WIDE_INT isa_flag,\n       def_or_undef (parse_in, \"__znver3\");\n       def_or_undef (parse_in, \"__znver3__\");\n       break;\n+    case PROCESSOR_ZNVER4:\n+      def_or_undef (parse_in, \"__znver4\");\n+      def_or_undef (parse_in, \"__znver4__\");\n+      break;\n     case PROCESSOR_BTVER1:\n       def_or_undef (parse_in, \"__btver1\");\n       def_or_undef (parse_in, \"__btver1__\");\n@@ -330,6 +334,9 @@ ix86_target_macros_internal (HOST_WIDE_INT isa_flag,\n     case PROCESSOR_ZNVER3:\n       def_or_undef (parse_in, \"__tune_znver3__\");\n       break;\n+    case PROCESSOR_ZNVER4:\n+      def_or_undef (parse_in, \"__tune_znver4__\");\n+      break;\n     case PROCESSOR_BTVER1:\n       def_or_undef (parse_in, \"__tune_btver1__\");\n       break;"}, {"sha": "1f14d6917d8dc753ed31c9294b432912febba9c7", "filename": "gcc/config/i386/i386-options.cc", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386-options.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386-options.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-options.cc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -154,11 +154,12 @@ along with GCC; see the file COPYING3.  If not see\n #define m_ZNVER1 (HOST_WIDE_INT_1U<<PROCESSOR_ZNVER1)\n #define m_ZNVER2 (HOST_WIDE_INT_1U<<PROCESSOR_ZNVER2)\n #define m_ZNVER3 (HOST_WIDE_INT_1U<<PROCESSOR_ZNVER3)\n+#define m_ZNVER4 (HOST_WIDE_INT_1U<<PROCESSOR_ZNVER4)\n #define m_BTVER1 (HOST_WIDE_INT_1U<<PROCESSOR_BTVER1)\n #define m_BTVER2 (HOST_WIDE_INT_1U<<PROCESSOR_BTVER2)\n #define m_BDVER\t(m_BDVER1 | m_BDVER2 | m_BDVER3 | m_BDVER4)\n #define m_BTVER (m_BTVER1 | m_BTVER2)\n-#define m_ZNVER\t(m_ZNVER1 | m_ZNVER2 | m_ZNVER3)\n+#define m_ZNVER\t(m_ZNVER1 | m_ZNVER2 | m_ZNVER3 | m_ZNVER4)\n #define m_AMD_MULTIPLE (m_ATHLON_K8 | m_AMDFAM10 | m_BDVER | m_BTVER \\\n \t\t\t| m_ZNVER)\n \n@@ -773,7 +774,8 @@ static const struct processor_costs *processor_cost_table[] =\n   &btver2_cost,\n   &znver1_cost,\n   &znver2_cost,\n-  &znver3_cost\n+  &znver3_cost,\n+  &znver4_cost\n };\n \n /* Guarantee that the array is aligned with enum processor_type.  */"}, {"sha": "aeea26ef4bee294e13af73e25f917d35c4123fdb", "filename": "gcc/config/i386/i386.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.cc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -23079,7 +23079,7 @@ ix86_reassociation_width (unsigned int op, machine_mode mode)\n       /* Integer vector instructions execute in FP unit\n \t and can execute 3 additions and one multiplication per cycle.  */\n       if ((ix86_tune == PROCESSOR_ZNVER1 || ix86_tune == PROCESSOR_ZNVER2\n-\t   || ix86_tune == PROCESSOR_ZNVER3)\n+\t   || ix86_tune == PROCESSOR_ZNVER3 || ix86_tune == PROCESSOR_ZNVER4)\n    \t  && INTEGRAL_MODE_P (mode) && op != PLUS && op != MINUS)\n \treturn 1;\n "}, {"sha": "fd7c9df47e515836cb87a0eaafbc1fbe76f92f77", "filename": "gcc/config/i386/i386.h", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.h?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -2255,6 +2255,7 @@ enum processor_type\n   PROCESSOR_ZNVER1,\n   PROCESSOR_ZNVER2,\n   PROCESSOR_ZNVER3,\n+  PROCESSOR_ZNVER4,\n   PROCESSOR_max\n };\n \n@@ -2347,6 +2348,21 @@ constexpr wide_int_bitmask PTA_ALDERLAKE = PTA_TREMONT | PTA_ADX | PTA_AVX\n   | PTA_HRESET | PTA_KL | PTA_WIDEKL | PTA_AVXVNNI;\n constexpr wide_int_bitmask PTA_KNM = PTA_KNL | PTA_AVX5124VNNIW\n   | PTA_AVX5124FMAPS | PTA_AVX512VPOPCNTDQ;\n+constexpr wide_int_bitmask PTA_ZNVER1 = PTA_64BIT | PTA_MMX | PTA_SSE | PTA_SSE2\n+  | PTA_SSE3 | PTA_SSE4A | PTA_CX16 | PTA_ABM | PTA_SSSE3 | PTA_SSE4_1\n+  | PTA_SSE4_2 | PTA_AES | PTA_PCLMUL | PTA_AVX | PTA_AVX2 | PTA_BMI | PTA_BMI2\n+  | PTA_F16C | PTA_FMA | PTA_PRFCHW | PTA_FXSR | PTA_XSAVE | PTA_XSAVEOPT\n+  | PTA_FSGSBASE | PTA_RDRND | PTA_MOVBE | PTA_MWAITX | PTA_ADX | PTA_RDSEED\n+  | PTA_CLZERO | PTA_CLFLUSHOPT | PTA_XSAVEC | PTA_XSAVES | PTA_SHA | PTA_LZCNT\n+  | PTA_POPCNT;\n+constexpr wide_int_bitmask PTA_ZNVER2 = PTA_ZNVER1 | PTA_CLWB | PTA_RDPID\n+  | PTA_WBNOINVD;\n+constexpr wide_int_bitmask PTA_ZNVER3 = PTA_ZNVER2 | PTA_VAES | PTA_VPCLMULQDQ\n+  | PTA_PKU;\n+constexpr wide_int_bitmask PTA_ZNVER4 = PTA_ZNVER3 | PTA_AVX512F | PTA_AVX512DQ\n+  | PTA_AVX512IFMA | PTA_AVX512CD | PTA_AVX512BW | PTA_AVX512VL\n+  | PTA_AVX512BF16 | PTA_AVX512VBMI | PTA_AVX512VBMI2 | PTA_GFNI\n+  | PTA_AVX512VNNI | PTA_AVX512BITALG | PTA_AVX512VPOPCNTDQ;\n \n #ifndef GENERATOR_FILE\n "}, {"sha": "baf1f1f8fa22166d95a812a11c7b8e3f1cf48540", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -474,7 +474,7 @@\n ;; Processor type.\n (define_attr \"cpu\" \"none,pentium,pentiumpro,geode,k6,athlon,k8,core2,nehalem,\n \t\t    atom,slm,glm,haswell,generic,lujiazui,amdfam10,bdver1,\n-\t\t    bdver2,bdver3,bdver4,btver2,znver1,znver2,znver3\"\n+\t\t    bdver2,bdver3,bdver4,btver2,znver1,znver2,znver3,znver4\"\n   (const (symbol_ref \"ix86_schedule\")))\n \n ;; A basic instruction type.  Refinements due to arguments to be\n@@ -1309,7 +1309,7 @@\n (include \"bdver1.md\")\n (include \"bdver3.md\")\n (include \"btver2.md\")\n-(include \"znver1.md\")\n+(include \"znver.md\")\n (include \"geode.md\")\n (include \"atom.md\")\n (include \"slm.md\")"}, {"sha": "aeaa7eb008e2e6776072c48069f63cae1ab90ec7", "filename": "gcc/config/i386/x86-tune-costs.h", "status": "modified", "additions": 133, "deletions": 0, "changes": 133, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fx86-tune-costs.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fx86-tune-costs.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fx86-tune-costs.h?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -1820,6 +1820,139 @@ struct processor_costs znver3_cost = {\n   \"16\",\t\t\t\t\t/* Func alignment.  */\n };\n \n+/* This table currently replicates znver3_cost table. */\n+struct processor_costs znver4_cost = {\n+  {\n+  /* Start of register allocator costs.  integer->integer move cost is 2. */\n+\n+  /* reg-reg moves are done by renaming and thus they are even cheaper than\n+     1 cycle.  Because reg-reg move cost is 2 and following tables correspond\n+     to doubles of latencies, we do not model this correctly.  It does not\n+     seem to make practical difference to bump prices up even more.  */\n+  6,\t\t\t\t\t/* cost for loading QImode using\n+\t\t\t\t\t   movzbl.  */\n+  {6, 6, 6},\t\t\t\t/* cost of loading integer registers\n+\t\t\t\t\t   in QImode, HImode and SImode.\n+\t\t\t\t\t   Relative to reg-reg move (2).  */\n+  {8, 8, 8},\t\t\t\t/* cost of storing integer\n+\t\t\t\t\t   registers.  */\n+  2,\t\t\t\t\t/* cost of reg,reg fld/fst.  */\n+  {6, 6, 16},\t\t\t\t/* cost of loading fp registers\n+\t\t\t\t\t   in SFmode, DFmode and XFmode.  */\n+  {8, 8, 16},\t\t\t\t/* cost of storing fp registers\n+\t\t\t\t\t   in SFmode, DFmode and XFmode.  */\n+  2,\t\t\t\t\t/* cost of moving MMX register.  */\n+  {6, 6},\t\t\t\t/* cost of loading MMX registers\n+\t\t\t\t\t   in SImode and DImode.  */\n+  {8, 8},\t\t\t\t/* cost of storing MMX registers\n+\t\t\t\t\t   in SImode and DImode.  */\n+  2, 2, 3,\t\t\t\t/* cost of moving XMM,YMM,ZMM\n+\t\t\t\t\t   register.  */\n+  {6, 6, 6, 6, 12},\t\t\t/* cost of loading SSE registers\n+\t\t\t\t\t   in 32,64,128,256 and 512-bit.  */\n+  {8, 8, 8, 8, 16},\t\t\t/* cost of storing SSE registers\n+\t\t\t\t\t   in 32,64,128,256 and 512-bit.  */\n+  6, 6,\t\t\t\t\t/* SSE->integer and integer->SSE\n+\t\t\t\t\t   moves.  */\n+  8, 8,\t\t\t\t/* mask->integer and integer->mask moves */\n+  {6, 6, 6},\t\t\t\t/* cost of loading mask register\n+\t\t\t\t\t   in QImode, HImode, SImode.  */\n+  {8, 8, 8},\t\t\t\t/* cost if storing mask register\n+\t\t\t\t\t   in QImode, HImode, SImode.  */\n+  2,\t\t\t\t\t/* cost of moving mask register.  */\n+  /* End of register allocator costs.  */\n+  },\n+\n+  COSTS_N_INSNS (1),\t\t\t/* cost of an add instruction.  */\n+  COSTS_N_INSNS (1),\t\t\t/* cost of a lea instruction.  */\n+  COSTS_N_INSNS (1),\t\t\t/* variable shift costs.  */\n+  COSTS_N_INSNS (1),\t\t\t/* constant shift costs.  */\n+  {COSTS_N_INSNS (3),\t\t\t/* cost of starting multiply for QI.  */\n+   COSTS_N_INSNS (3),\t\t\t/* \t\t\t\t HI.  */\n+   COSTS_N_INSNS (3),\t\t\t/*\t\t\t\t SI.  */\n+   COSTS_N_INSNS (3),\t\t\t/*\t\t\t\t DI.  */\n+   COSTS_N_INSNS (3)},\t\t\t/*\t\t\tother.  */\n+  0,\t\t\t\t\t/* cost of multiply per each bit\n+\t\t\t\t\t   set.  */\n+  {COSTS_N_INSNS (9),\t\t\t/* cost of a divide/mod for QI.  */\n+   COSTS_N_INSNS (10),\t\t\t/* \t\t\t    HI.  */\n+   COSTS_N_INSNS (12),\t\t\t/*\t\t\t    SI.  */\n+   COSTS_N_INSNS (17),\t\t\t/*\t\t\t    DI.  */\n+   COSTS_N_INSNS (17)},\t\t\t/*\t\t\t    other.  */\n+  COSTS_N_INSNS (1),\t\t\t/* cost of movsx.  */\n+  COSTS_N_INSNS (1),\t\t\t/* cost of movzx.  */\n+  8,\t\t\t\t\t/* \"large\" insn.  */\n+  9,\t\t\t\t\t/* MOVE_RATIO.  */\n+  6,\t\t\t\t\t/* CLEAR_RATIO */\n+  {6, 6, 6},\t\t\t\t/* cost of loading integer registers\n+\t\t\t\t\t   in QImode, HImode and SImode.\n+\t\t\t\t\t   Relative to reg-reg move (2).  */\n+  {8, 8, 8},\t\t\t\t/* cost of storing integer\n+\t\t\t\t\t   registers.  */\n+  {6, 6, 6, 6, 12},\t\t\t/* cost of loading SSE registers\n+\t\t\t\t\t   in 32bit, 64bit, 128bit, 256bit and 512bit */\n+  {8, 8, 8, 8, 16},\t\t\t/* cost of storing SSE register\n+\t\t\t\t\t   in 32bit, 64bit, 128bit, 256bit and 512bit */\n+  {6, 6, 6, 6, 12},\t\t\t/* cost of unaligned loads.  */\n+  {8, 8, 8, 8, 16},\t\t\t/* cost of unaligned stores.  */\n+  2, 2, 3,\t\t\t\t/* cost of moving XMM,YMM,ZMM\n+\t\t\t\t\t   register.  */\n+  6,\t\t\t\t\t/* cost of moving SSE register to integer.  */\n+  /* VGATHERDPD is 15 uops and throughput is 4, VGATHERDPS is 23 uops,\n+     throughput 9.  Approx 7 uops do not depend on vector size and every load\n+     is 4 uops.  */\n+  14, 8,\t\t\t\t/* Gather load static, per_elt.  */\n+  14, 10,\t\t\t\t/* Gather store static, per_elt.  */\n+  32,\t\t\t\t\t/* size of l1 cache.  */\n+  512,\t\t\t\t\t/* size of l2 cache.  */\n+  64,\t\t\t\t\t/* size of prefetch block.  */\n+  /* New AMD processors never drop prefetches; if they cannot be performed\n+     immediately, they are queued.  We set number of simultaneous prefetches\n+     to a large constant to reflect this (it probably is not a good idea not\n+     to limit number of prefetches at all, as their execution also takes some\n+     time).  */\n+  100,\t\t\t\t\t/* number of parallel prefetches.  */\n+  3,\t\t\t\t\t/* Branch cost.  */\n+  COSTS_N_INSNS (5),\t\t\t/* cost of FADD and FSUB insns.  */\n+  COSTS_N_INSNS (5),\t\t\t/* cost of FMUL instruction.  */\n+  /* Latency of fdiv is 8-15.  */\n+  COSTS_N_INSNS (15),\t\t\t/* cost of FDIV instruction.  */\n+  COSTS_N_INSNS (1),\t\t\t/* cost of FABS instruction.  */\n+  COSTS_N_INSNS (1),\t\t\t/* cost of FCHS instruction.  */\n+  /* Latency of fsqrt is 4-10.  */\n+  COSTS_N_INSNS (10),\t\t\t/* cost of FSQRT instruction.  */\n+\n+  COSTS_N_INSNS (1),\t\t\t/* cost of cheap SSE instruction.  */\n+  COSTS_N_INSNS (3),\t\t\t/* cost of ADDSS/SD SUBSS/SD insns.  */\n+  COSTS_N_INSNS (3),\t\t\t/* cost of MULSS instruction.  */\n+  COSTS_N_INSNS (3),\t\t\t/* cost of MULSD instruction.  */\n+  COSTS_N_INSNS (5),\t\t\t/* cost of FMA SS instruction.  */\n+  COSTS_N_INSNS (5),\t\t\t/* cost of FMA SD instruction.  */\n+  COSTS_N_INSNS (10),\t\t\t/* cost of DIVSS instruction.  */\n+  /* 9-13.  */\n+  COSTS_N_INSNS (13),\t\t\t/* cost of DIVSD instruction.  */\n+  COSTS_N_INSNS (10),\t\t\t/* cost of SQRTSS instruction.  */\n+  COSTS_N_INSNS (15),\t\t\t/* cost of SQRTSD instruction.  */\n+  /* Zen can execute 4 integer operations per cycle.  FP operations\n+     take 3 cycles and it can execute 2 integer additions and 2\n+     multiplications thus reassociation may make sense up to with of 6.\n+     SPEC2k6 bencharks suggests\n+     that 4 works better than 6 probably due to register pressure.\n+\n+     Integer vector operations are taken by FP unit and execute 3 vector\n+     plus/minus operations per cycle but only one multiply.  This is adjusted\n+     in ix86_reassociation_width.  */\n+  4, 4, 3, 6,\t\t\t\t/* reassoc int, fp, vec_int, vec_fp.  */\n+  znver2_memcpy,\n+  znver2_memset,\n+  COSTS_N_INSNS (4),\t\t\t/* cond_taken_branch_cost.  */\n+  COSTS_N_INSNS (2),\t\t\t/* cond_not_taken_branch_cost.  */\n+  \"16\",\t\t\t\t\t/* Loop alignment.  */\n+  \"16\",\t\t\t\t\t/* Jump alignment.  */\n+  \"0:0:8\",\t\t\t\t/* Label alignment.  */\n+  \"16\",\t\t\t\t\t/* Func alignment.  */\n+};\n+\n /* skylake_cost should produce code tuned for Skylake familly of CPUs.  */\n static stringop_algs skylake_memcpy[2] =   {\n   {libcall,"}, {"sha": "96eb06a5b6dd67e13ad02609fb9b39add7dc3c28", "filename": "gcc/config/i386/x86-tune-sched.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fx86-tune-sched.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fx86-tune-sched.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fx86-tune-sched.cc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -68,6 +68,7 @@ ix86_issue_rate (void)\n     case PROCESSOR_ZNVER1:\n     case PROCESSOR_ZNVER2:\n     case PROCESSOR_ZNVER3:\n+    case PROCESSOR_ZNVER4:\n     case PROCESSOR_CORE2:\n     case PROCESSOR_NEHALEM:\n     case PROCESSOR_SANDYBRIDGE:\n@@ -415,6 +416,7 @@ ix86_adjust_cost (rtx_insn *insn, int dep_type, rtx_insn *dep_insn, int cost,\n     case PROCESSOR_ZNVER1:\n     case PROCESSOR_ZNVER2:\n     case PROCESSOR_ZNVER3:\n+    case PROCESSOR_ZNVER4:\n       /* Stack engine allows to execute push&pop instructions in parall.  */\n       if ((insn_type == TYPE_PUSH || insn_type == TYPE_POP)\n \t  && (dep_insn_type == TYPE_PUSH || dep_insn_type == TYPE_POP))"}, {"sha": "376a145b95edd7e0d26d7a3a8cc166b4da69752a", "filename": "gcc/config/i386/znver.md", "status": "renamed", "additions": 813, "deletions": 36, "changes": 849, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fznver.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fconfig%2Fi386%2Fznver.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fznver.md?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -23,8 +23,8 @@\n \n ;; AMD znver1, znver2 and znver3 Scheduling\n ;; Modeling automatons for zen decoders, integer execution pipes,\n-;; AGU pipes and floating point execution units.\n-(define_automaton \"znver1, znver1_ieu, znver1_fp, znver1_agu\")\n+;; AGU pipes, floating point execution, branch and store units.\n+(define_automaton \"znver1, znver1_ieu, znver1_fp, znver1_agu, znver4_bru, znver4_fp_store\")\n \n ;; Decoders unit has 4 decoders and all of them can decode fast path\n ;; and vector type instructions.\n@@ -63,6 +63,8 @@\n ;; Load is 4 cycles. We do not model reservation of load unit.\n ;;(define_reservation \"znver1-load\" \"znver1-agu-reserve, nothing, nothing, nothing\")\n (define_reservation \"znver1-load\" \"znver1-agu-reserve\")\n+;; According to Manual, all AGU are used for loads and stores in znver4.\n+(define_reservation \"znver4-load\" \"znver2-store-agu-reserve\")\n ;; Store operations differs between znver1, znver2 and znver3 because extra AGU\n ;; was added.\n (define_reservation \"znver1-store\" \"znver1-agu-reserve\")\n@@ -93,6 +95,11 @@\n \t\t\t\t      +znver1-fp2+znver1-fp3\n \t\t\t\t      +znver1-agu0+znver1-agu1+znver2-agu2\")\n \n+;; znver4 has one branch unit in znver1-ieu0 and a separate branch unit.\n+(define_cpu_unit \"znver4-bru0\" \"znver4_bru\")\n+;; znver4 also has dedicated fp-store unit.\n+(define_cpu_unit \"znver4-fp-store0\" \"znver4_fp_store\")\n+\n ;; Call instruction\n (define_insn_reservation \"znver1_call\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n@@ -104,14 +111,19 @@\n \t\t\t      (eq_attr \"type\" \"call,callv\"))\n \t\t\t \"znver1-double,znver2-store,znver1-ieu0|znver1-ieu3\")\n \n+(define_insn_reservation \"znver4_call\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"type\" \"call,callv\"))\n+\t\t\t \"znver1-double,znver1-ieu0|znver4-bru0,znver2-store\")\n+\n ;; General instructions\n (define_insn_reservation \"znver1_push\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"type\" \"push\")\n \t\t\t\t   (eq_attr \"memory\" \"store\")))\n \t\t\t \"znver1-direct,znver1-store\")\n (define_insn_reservation \"znver2_push\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"push\")\n \t\t\t\t   (eq_attr \"memory\" \"store\")))\n \t\t\t \"znver1-direct,znver2-store\")\n@@ -126,12 +138,22 @@\n \t\t\t      (and (eq_attr \"type\" \"push\")\n \t\t\t\t   (eq_attr \"memory\" \"both\")))\n \t\t\t \"znver1-direct,znver1-load,znver2-store\")\n+(define_insn_reservation \"znver4_push_load\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"push\")\n+\t\t\t\t   (eq_attr \"memory\" \"both\")))\n+\t\t\t \"znver1-direct,znver4-load,znver2-store\")\n \n (define_insn_reservation \"znver1_pop\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"pop\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load\")\n+(define_insn_reservation \"znver4_pop\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"pop\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load\")\n \n (define_insn_reservation \"znver1_pop_mem\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n@@ -143,14 +165,19 @@\n \t\t\t      (and (eq_attr \"type\" \"pop\")\n \t\t\t\t   (eq_attr \"memory\" \"both\")))\n \t\t\t \"znver1-direct,znver1-load,znver2-store\")\n+(define_insn_reservation \"znver4_pop_mem\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"pop\")\n+\t\t\t\t   (eq_attr \"memory\" \"both\")))\n+\t\t\t \"znver1-direct,znver4-load,znver2-store\")\n \n ;; Leave\n (define_insn_reservation \"znver1_leave\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (eq_attr \"type\" \"leave\"))\n \t\t\t \"znver1-double,znver1-ieu, znver1-store\")\n (define_insn_reservation \"znver2_leave\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (eq_attr \"type\" \"leave\"))\n \t\t\t \"znver1-double,znver1-ieu, znver2-store\")\n \n@@ -162,12 +189,29 @@\n \t\t\t      (and (eq_attr \"type\" \"imul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-ieu1\")\n+(define_insn_reservation \"znver4_imul\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"imul\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SI,HI,QI\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-ieu1\")\n+(define_insn_reservation \"znver4_imul_DI\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"imul\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"DI\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-ieu1\")\n \n (define_insn_reservation \"znver1_imul_mem\" 7\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"imul\")\n \t\t\t\t   (eq_attr \"memory\" \"!none\")))\n \t\t\t \"znver1-direct,znver1-load, znver1-ieu1\")\n+(define_insn_reservation \"znver4_imul_mem\" 7\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"imul\")\n+\t\t\t\t   (eq_attr \"memory\" \"!none\")))\n+\t\t\t \"znver1-direct,znver4-load, znver1-ieu1\")\n \n ;; Divisions\n ;; Reg operands\n@@ -261,14 +305,14 @@\n                               (and (eq_attr \"type\" \"idiv\")\n                                    (and (eq_attr \"mode\" \"DI\")\n                                         (eq_attr \"memory\" \"load\"))))\n-                         \"znver1-double,znver1-load,znver1-ieu2*22\")\n+                         \"znver1-double,znver1-load,znver1-ieu2*18\")\n \n (define_insn_reservation \"znver3_idiv_mem_SI\" 16\n                          (and (eq_attr \"cpu\" \"znver3\")\n                               (and (eq_attr \"type\" \"idiv\")\n                                    (and (eq_attr \"mode\" \"SI\")\n                                         (eq_attr \"memory\" \"load\"))))\n-                         \"znver1-double,znver1-load,znver1-ieu2*16\")\n+                         \"znver1-double,znver1-load,znver1-ieu2*12\")\n \n (define_insn_reservation \"znver3_idiv_mem_HI\" 14\n                          (and (eq_attr \"cpu\" \"znver3\")\n@@ -284,6 +328,62 @@\n                                         (eq_attr \"memory\" \"load\"))))\n                          \"znver1-direct,znver1-load,znver1-ieu2*9\")\n \n+(define_insn_reservation \"znver4_idiv_DI\" 18\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"DI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-ieu0*18\")\n+\n+(define_insn_reservation \"znver4_idiv_SI\" 12\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-ieu0*12\")\n+\n+(define_insn_reservation \"znver4_idiv_HI\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"HI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-ieu0*10\")\n+\n+(define_insn_reservation \"znver4_idiv_QI\" 9\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"QI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-ieu0*9\")\n+\n+(define_insn_reservation \"znver4_idiv_mem_DI\" 22\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"DI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-ieu0*18\")\n+\n+(define_insn_reservation \"znver4_idiv_mem_SI\" 16\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"SI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-ieu0*12\")\n+\n+(define_insn_reservation \"znver4_idiv_mem_HI\" 14\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"HI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-ieu0*10\")\n+\n+(define_insn_reservation \"znver4_idiv_mem_QI\" 13\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"idiv\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"QI\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-ieu0*9\")\n+\n ;; STR ISHIFT which are micro coded.\n ;; Fix me: Latency need to be rechecked.\n (define_insn_reservation \"znver1_str_ishift\" 6\n@@ -293,15 +393,15 @@\n \t\t\t \"znver1-vector,znver1-ivector\")\n \n (define_insn_reservation \"znver2_str_ishift\" 3\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"ishift\")\n \t\t\t\t   (eq_attr \"memory\" \"both,store\")))\n-\t\t\t \"znver1-vector,znver1-ivector\")\n+\t\t\t \"znver1-vector,znver2-ivector\")\n (define_insn_reservation \"znver2_str_istr\" 19\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"str\")\n \t\t\t\t   (eq_attr \"memory\" \"both,store\")))\n-\t\t\t \"znver1-vector,znver1-ivector\")\n+\t\t\t \"znver1-vector,znver2-ivector\")\n \n ;; MOV - integer moves\n (define_insn_reservation \"znver1_load_imov_double\" 2\n@@ -318,8 +418,15 @@\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n \t\t\t \"znver1-double,znver1-ieu|znver1-ieu\")\n \n+(define_insn_reservation \"znver4_load_imov_double\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n+\t\t\t\t   (and (eq_attr \"type\" \"imovx\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-ieu0|znver1-ieu3\")\n+\n (define_insn_reservation \"znver1_load_imov_direct\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"imov,imovx\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-ieu\")\n@@ -332,7 +439,7 @@\n \t\t\t \"znver1-double,znver1-ieu|znver1-ieu,znver1-store\")\n \n (define_insn_reservation \"znver2_load_imov_double_store\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n \t\t\t\t   (and (eq_attr \"type\" \"imovx\")\n \t\t\t\t\t(eq_attr \"memory\" \"store\"))))\n@@ -345,7 +452,7 @@\n \t\t\t\t   \"znver1-direct,znver1-ieu,znver1-store\")\n \n (define_insn_reservation \"znver2_load_imov_direct_store\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"imov,imovx\")\n \t\t\t\t   (eq_attr \"memory\" \"store\")))\n \t\t\t\t   \"znver1-direct,znver1-ieu,znver2-store\")\n@@ -364,6 +471,13 @@\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n \t\t\t \"znver1-double,znver1-load,znver1-ieu|znver1-ieu\")\n \n+(define_insn_reservation \"znver4_load_imov_double_load\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n+\t\t\t\t   (and (eq_attr \"type\" \"imovx\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-ieu\")\n+\n (define_insn_reservation \"znver1_load_imov_direct_load\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"imov,imovx\")\n@@ -378,12 +492,48 @@\n \t\t\t\t   (eq_attr \"memory\" \"none,unknown\")))\n \t\t\t \"znver1-direct,znver1-ieu\")\n \n+(define_insn_reservation \"znver4_insn_1\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,test,incdec\")\n+\t\t\t\t   (eq_attr \"memory\" \"none,unknown\")))\n+\t\t\t \"znver1-direct,znver1-ieu\")\n+\n+(define_insn_reservation \"znver4_insn_2\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"rotate,rotate1,ishift,ishift1\")\n+\t\t\t\t   (eq_attr \"memory\" \"none,unknown\")))\n+\t\t\t \"znver1-direct,znver1-ieu1|znver1-ieu2\")\n+\n+(define_insn_reservation \"znver4_insn_3\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"setcc,icmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-ieu0|znver1-ieu3\")\n+\n (define_insn_reservation \"znver1_insn_load\" 5\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,rotate,rotate1,ishift,ishift1,test,setcc,incdec,icmov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-ieu\")\n \n+(define_insn_reservation \"znver4_insn_1_load\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,test,incdec\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-ieu\")\n+\n+(define_insn_reservation \"znver4_insn_2_load\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"rotate,rotate1,ishift,ishift1\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-ieu1|znver1-ieu2\")\n+\n+(define_insn_reservation \"znver4_insn_3_load\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"setcc,icmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-double,znver4-load,znver1-ieu0|znver1-ieu3\")\n+\n (define_insn_reservation \"znver1_insn_store\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,rotate,rotate1,ishift1,test,setcc,incdec\")\n@@ -396,6 +546,24 @@\n \t\t\t\t   (eq_attr \"memory\" \"store\")))\n \t\t\t \"znver1-direct,znver1-ieu,znver2-store\")\n \n+(define_insn_reservation \"znver4_insn_1_store\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,test,incdec\")\n+\t\t\t\t   (eq_attr \"memory\" \"store\")))\n+\t\t\t \"znver1-direct,znver1-ieu,znver2-store\")\n+\n+(define_insn_reservation \"znver4_insn_2_store\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"rotate,rotate1,ishift,ishift1\")\n+\t\t\t\t   (eq_attr \"memory\" \"store\")))\n+\t\t\t \"znver1-direct,znver1-ieu1|znver1-ieu2,znver2-store\")\n+\n+(define_insn_reservation \"znver4_insn_3_store\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"setcc,icmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"store\")))\n+\t\t\t \"znver1-double,znver1-ieu0|znver1-ieu3,znver2-store\")\n+\n (define_insn_reservation \"znver1_insn_both\" 5\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,rotate,rotate1,ishift1,test,setcc,incdec\")\n@@ -408,14 +576,32 @@\n \t\t\t\t   (eq_attr \"memory\" \"both\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-ieu,znver2-store\")\n \n+(define_insn_reservation \"znver4_insn_1_both\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"alu,icmp,negnot,test,incdec\")\n+\t\t\t\t   (eq_attr \"memory\" \"both\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-ieu,znver2-store\")\n+\n+(define_insn_reservation \"znver4_insn_2_both\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"rotate,rotate1,ishift,ishift1\")\n+\t\t\t\t   (eq_attr \"memory\" \"both\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-ieu1|znver1-ieu2,znver2-store\")\n+\n+(define_insn_reservation \"znver4_insn_3_both\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"setcc,icmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"both\")))\n+\t\t\t \"znver1-double,znver4-load,znver1-ieu0|znver1-ieu3,znver2-store\")\n+\n ;; Fix me: Other vector type insns keeping latency 6 as of now.\n (define_insn_reservation \"znver1_ieu_vector\" 6\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (eq_attr \"type\" \"other,str,multi\"))\n \t\t\t \"znver1-vector,znver1-ivector\")\n \n (define_insn_reservation \"znver2_ieu_vector\" 5\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (eq_attr \"type\" \"other,str,multi\"))\n \t\t\t \"znver1-vector,znver2-ivector\")\n \n@@ -428,21 +614,21 @@\n \t\t\t \"znver1-vector,znver1-ivector\")\n \n (define_insn_reservation \"znver2_alu1_vector\" 3\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"vector\")\n \t\t\t\t   (and (eq_attr \"type\" \"alu1\")\n \t\t\t\t\t(eq_attr \"memory\" \"none,unknown\"))))\n \t\t\t \"znver1-vector,znver2-ivector\")\n \n (define_insn_reservation \"znver1_alu1_double\" 2\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n \t\t\t\t   (and (eq_attr \"type\" \"alu1\")\n \t\t\t\t\t(eq_attr \"memory\" \"none,unknown\"))))\n \t\t\t \"znver1-double,znver1-ieu\")\n \n (define_insn_reservation \"znver1_alu1_direct\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"direct\")\n \t\t\t\t   (and (eq_attr \"type\" \"alu1\")\n \t\t\t\t\t(eq_attr \"memory\" \"none,unknown\"))))\n@@ -454,6 +640,11 @@\n \t\t\t      (and (eq_attr \"type\" \"ibr\")\n \t\t\t\t\t(eq_attr \"memory\" \"none\")))\n \t\t\t  \"znver1-direct\")\n+(define_insn_reservation \"znver4_branch\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ibr\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\")))\n+\t\t\t  \"znver1-direct,znver1-ieu0|znver4-bru0\")\n \n ;; Indirect branches check latencies.\n (define_insn_reservation \"znver1_indirect_branch_mem\" 6\n@@ -468,40 +659,58 @@\n \t\t\t\t\t(eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-vector,znver2-ivector\")\n \n+(define_insn_reservation \"znver4_indirect_branch_mem\" 6\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ibr\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-vector,znver2-ivector+znver4-bru0\")\n+\n ;; LEA executes in ALU units with 1 cycle latency.\n (define_insn_reservation \"znver1_lea\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (eq_attr \"type\" \"lea\"))\n \t\t\t \"znver1-direct,znver1-ieu\")\n \n-;; Other integer instrucions\n+;; Other integer instructions\n (define_insn_reservation \"znver1_idirect\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"unit\" \"integer,unknown\")\n \t\t\t\t   (eq_attr \"memory\" \"none,unknown\")))\n \t\t\t \"znver1-direct,znver1-ieu\")\n \n ;;  Floating point\n (define_insn_reservation \"znver1_fp_cmov\" 6\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (eq_attr \"type\" \"fcmov\"))\n \t\t\t \"znver1-vector,znver1-fvector\")\n \n+(define_insn_reservation \"znver2_fp_cmov\" 6\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n+\t\t\t      (eq_attr \"type\" \"fcmov\"))\n+\t\t\t \"znver1-vector,znver2-fvector\")\n+\n (define_insn_reservation \"znver1_fp_mov_direct_load\" 8 \n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"direct\")\n \t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp3|znver1-fp1\")\n \n+(define_insn_reservation \"znver4_fp_mov_direct_load\" 8 \n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"znver1_decode\" \"direct\")\n+\t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp2|znver1-fp3\")\n+\n (define_insn_reservation \"znver1_fp_mov_direct_store\" 5\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"direct\")\n \t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t\t(eq_attr \"memory\" \"store\"))))\n \t\t\t \"znver1-direct,znver1-fp2|znver1-fp3,znver1-store\")\n (define_insn_reservation \"znver2_fp_mov_direct_store\" 5\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"direct\")\n \t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t\t(eq_attr \"memory\" \"store\"))))\n@@ -514,32 +723,63 @@\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n \t\t\t \"znver1-double,znver1-fp3\")\n \n+(define_insn_reservation \"znver4_fp_mov_double\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n+\t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-fp1\")\n+\n (define_insn_reservation \"znver1_fp_mov_double_load\" 12\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n \t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n \t\t\t \"znver1-double,znver1-load,znver1-fp3\")\n \n+(define_insn_reservation \"znver4_fp_mov_double_load\" 11\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"znver1_decode\" \"double\")\n+\t\t\t\t   (and (eq_attr \"type\" \"fmov\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp1\")\n+\n (define_insn_reservation \"znver1_fp_mov_direct\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (eq_attr \"type\" \"fmov\"))\n \t\t\t \"znver1-direct,znver1-fp3\")\n \n+(define_insn_reservation \"znver4_fp_mov_direct\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"type\" \"fmov\"))\n+\t\t\t \"znver1-direct,znver1-fp1\")\n+\n ;; TODO: AGU?\n (define_insn_reservation \"znver1_fp_spc_direct\" 5\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"fpspc\")\n \t\t\t\t   (eq_attr \"memory\" \"store\")))\n \t\t\t \"znver1-direct,znver1-fp3,znver1-fp2\")\n \n+(define_insn_reservation \"znver4_fp_spc_direct\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fpspc\")\n+\t\t\t\t   (eq_attr \"memory\" \"store\")))\n+\t\t\t \"znver1-direct,znver1-fp1,znver4-fp-store0\")\n+\n+(define_insn_reservation \"znver4_fp_sqrt_direct\" 22\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fpspc\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp1\")\n+\n (define_insn_reservation \"znver1_fp_insn_vector\" 6\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"vector\")\n \t\t\t\t   (eq_attr \"type\" \"fpspc,mmxcvt,sselog1,ssemul,ssemov\")))\n \t\t\t \"znver1-vector,znver1-fvector\")\n (define_insn_reservation \"znver2_fp_insn_vector\" 6\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"znver1_decode\" \"vector\")\n \t\t\t\t   (eq_attr \"type\" \"fpspc,mmxcvt,sselog1,ssemul,ssemov\")))\n \t\t\t \"znver1-vector,znver2-fvector\")\n@@ -550,42 +790,99 @@\n \t\t\t      (eq_attr \"type\" \"fsgn\"))\n \t\t\t \"znver1-direct,znver1-fp3\")\n \n+(define_insn_reservation \"znver4_fp_fsgn\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"type\" \"fsgn\"))\n+\t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n (define_insn_reservation \"znver1_fp_fcmp\" 2\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"memory\" \"none\")\n \t\t\t\t   (and (eq_attr \"znver1_decode\" \"double\")\n \t\t\t\t\t(eq_attr \"type\" \"fcmp\"))))\n \t\t\t \"znver1-double,znver1-fp0,znver1-fp2\")\n \n+(define_insn_reservation \"znver4_fp_fcmp_double\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"memory\" \"none\")\n+\t\t\t\t   (and (eq_attr \"znver1_decode\" \"double\")\n+\t\t\t\t\t(eq_attr \"type\" \"fcmp\"))))\n+\t\t\t \"znver1-double,znver1-fp0,znver4-fp-store0\")\n+\n+(define_insn_reservation \"znver4_fp_fcmp\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fcmp\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp0\")\n+\n (define_insn_reservation \"znver1_fp_fcmp_load\" 9\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n-\t\t\t      (and (eq_attr \"memory\" \"none\")\n+\t\t\t      (and (eq_attr \"memory\" \"load\")\n \t\t\t\t   (and (eq_attr \"znver1_decode\" \"double\")\n \t\t\t\t\t(eq_attr \"type\" \"fcmp\"))))\n \t\t\t \"znver1-double,znver1-load, znver1-fp0,znver1-fp2\")\n \n+(define_insn_reservation \"znver4_fp_fcmp_double_load\" 11\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"memory\" \"load\")\n+\t\t\t\t   (and (eq_attr \"znver1_decode\" \"double\")\n+\t\t\t\t\t(eq_attr \"type\" \"fcmp\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp0,znver4-fp-store0\")\n+\n+(define_insn_reservation \"znver4_fp_fcmp_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fcmp\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0\")\n+\n ;;FADD FSUB FMUL\n (define_insn_reservation \"znver1_fp_op_mul\" 5\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0*5\")\n \n+(define_insn_reservation \"znver4_fp_op_mul\" 6\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp0*6\")\n+\n (define_insn_reservation \"znver1_fp_op_mul_load\" 12 \n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp0*5\")\n \n+(define_insn_reservation \"znver4_fp_op_mul_load\" 13 \n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0*6\")\n+\n+(define_insn_reservation \"znver4_fp_op_imul\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n+\t\t\t\t   (and (eq_attr \"fp_int_src\" \"true\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-fp1,znver1-fp0\")\n+\n (define_insn_reservation \"znver1_fp_op_imul_load\" 16\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n \t\t\t\t   (and (eq_attr \"fp_int_src\" \"true\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n \t\t\t\"znver1-double,znver1-load,znver1-fp3,znver1-fp0\")\n \n+(define_insn_reservation \"znver4_fp_op_imul_load\" 17\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n+\t\t\t\t   (and (eq_attr \"fp_int_src\" \"true\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp1,znver1-fp0\")\n+\n (define_insn_reservation \"znver1_fp_op_div\" 15\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"fdiv\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp3*15\")\n@@ -596,6 +893,12 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp3*15\")\n \n+(define_insn_reservation \"znver4_fp_op_div_load\" 22\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fdiv\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp3*15\")\n+\n (define_insn_reservation \"znver1_fp_op_idiv_load\" 27\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"type\" \"fdiv\")\n@@ -610,6 +913,19 @@\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n \t\t\t \"znver1-double,znver1-load,znver1-fp3*19\")\n \n+(define_insn_reservation \"znver4_fp_op_idiv\" 19\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fdiv\")\n+\t\t\t\t   (and (eq_attr \"fp_int_src\" \"true\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-fp1,znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_fp_op_idiv_load\" 26\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"fdiv\")\n+\t\t\t\t   (and (eq_attr \"fp_int_src\" \"true\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp1,znver1-fp1\")\n \n ;; MMX, SSE, SSEn.n, AVX, AVX2 instructions\n (define_insn_reservation \"znver1_fp_insn\" 1\n@@ -623,26 +939,49 @@\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0|znver1-fp1|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_fp_insn\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"type\" \"mmx,mmxadd\"))\n+\t\t\t \"znver1-direct,znver1-fpu\")\n+\n (define_insn_reservation \"znver1_mmx_add_load\" 8\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxadd\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp1|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_mmx_add_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxadd\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fpu\")\n+\n (define_insn_reservation \"znver1_mmx_cmp\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxcmp\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_mmx_cmp\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxcmp\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fpu\")\n+\n (define_insn_reservation \"znver1_mmx_cmp_load\" 8\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxcmp\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_mmx_cmp_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxcmp\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fpu\")\n+\n (define_insn_reservation \"znver1_mmx_cvt_pck_shuf\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"mmxcvt,sseshuf,sseshuf1\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp1|znver1-fp2\")\n@@ -653,18 +992,48 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp1|znver1-fp2\")\n \n+(define_insn_reservation \"znver4_mmx_cvt_pck_shuf_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxcvt,sseshuf,sseshuf1\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp1|znver1-fp2\")\n+\n (define_insn_reservation \"znver1_mmx_shift_move\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxshft,mmxmov\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp2\")\n \n+(define_insn_reservation \"znver4_mmx_shift\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxshft\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp1|znver1-fp2\")\n+\n+(define_insn_reservation \"znver4_mmx_move\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver4-fp-store0\")\n+\n (define_insn_reservation \"znver1_mmx_shift_move_load\" 8\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxshft,mmxmov\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp2\")\n \n+(define_insn_reservation \"znver4_mmx_shift_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxshft\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp1|znver1-fp2\")\n+\n+(define_insn_reservation \"znver4_mmx_move_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver4-fp-store0\")\n+\n (define_insn_reservation \"znver1_mmx_move_store\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"type\" \"mmxshft,mmxmov\")\n@@ -676,18 +1045,42 @@\n \t\t\t\t   (eq_attr \"memory\" \"store,both\")))\n \t\t\t  \"znver1-direct,znver1-fp2,znver2-store\")\n \n+(define_insn_reservation \"znver4_mmx_shift_store\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxshft\")\n+\t\t\t\t   (eq_attr \"memory\" \"store,both\")))\n+\t\t\t \"znver1-direct,znver1-fp1|znver1-fp2,znver2-store\")\n+\n+(define_insn_reservation \"znver4_mmx_move_store\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmov\")\n+\t\t\t\t   (eq_attr \"memory\" \"store,both\")))\n+\t\t\t \"znver1-direct,znver4-fp-store0\")\n+\n (define_insn_reservation \"znver1_mmx_mul\" 3\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t  \"znver1-direct,znver1-fp0*3\")\n \n+(define_insn_reservation \"znver4_mmx_mul\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t  \"znver1-direct,(znver1-fp0|znver1-fp3)*3\")\n+\n (define_insn_reservation \"znver1_mmx_load\" 10\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp0*3\")\n \n+(define_insn_reservation \"znver4_mmx_mul_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t  \"znver1-direct,znver4-load,(znver1-fp0|znver1-fp3)*3\")\n+\n ;; TODO\n (define_insn_reservation \"znver1_avx256_log\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n@@ -709,6 +1102,62 @@\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fpu\")\n \n+(define_insn_reservation \"znver4_sse_log\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V4SF,V8SF,V2DF,V4DF\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fpu\")\n+\n+(define_insn_reservation \"znver4_sse_log_evex\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V16SF,V8DF\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fp0+znver1-fp1|znver1-fp2+znver1-fp3\")\n+\n+(define_insn_reservation \"znver4_sse_log_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V4SF,V8SF,V2DF,V4DF\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fpu\")\n+\n+(define_insn_reservation \"znver4_sse_log_evex_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V16SF,V8DF\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0+znver1-fp1|znver1-fp2+znver1-fp3\")\n+\n+(define_insn_reservation \"znver4_sse_ilog\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"OI\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fp0+znver1-fp1|znver1-fp2+znver1-fp3\")\n+\n+(define_insn_reservation \"znver4_sse_ilog_evex\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"TI\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fp0+znver1-fp1+znver1-fp2+znver1-fp3\")\n+\n+(define_insn_reservation \"znver4_sse_ilog_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"OI\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0+znver1-fp1|znver1-fp2+znver1-fp3\")\n+\n+(define_insn_reservation \"znver4_sse_ilog_evex_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"sselog,sselog1\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"TI\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0+znver1-fp1+znver1-fp2+znver1-fp3\")\n+\n (define_insn_reservation \"znver1_sse_log_load\" 8\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"sselog\")\n@@ -771,6 +1220,18 @@\n \t\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n \t\t\t \"znver1-double,znver1-fp0|znver1-fp1\")\n \n+(define_insn_reservation \"znver4_sse_comi\" 1\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecomi\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-double,znver1-fp2|znver1-fp3,znver4-fp-store0\")\n+\n+(define_insn_reservation \"znver4_sse_comi_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecomi\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp2|znver1-fp3,znver4-fp-store0\")\n+\n (define_insn_reservation \"znver1_sse_comi_double_load\" 10\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"V4SF,V2DF,TI\"))\n@@ -786,7 +1247,7 @@\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,TI\"))\n \t\t\t\t   (ior (eq_attr \"cpu\" \"znver2\")\n-\t\t\t\t\t(eq_attr \"cpu\" \"znver3\")))\n+\t\t\t\t\t(eq_attr \"cpu\" \"znver3,znver4\")))\n \t\t\t      (and (eq_attr \"prefix_extra\" \"1\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssecomi\")\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n@@ -802,6 +1263,13 @@\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp1|znver1-fp2\")\n \n+(define_insn_reservation \"znver4_sse_test_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"prefix_extra\" \"1\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecomi\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp1|znver1-fp2\")\n+\n ;; SSE moves\n ;; Fix me:  Need to revist this again some of the moves may be restricted\n ;; to some fpu pipes.\n@@ -814,7 +1282,7 @@\n \t\t\t \"znver1-direct,znver1-ieu0\")\n \n (define_insn_reservation \"znver2_sse_mov\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"mode\" \"SI\")\n \t\t\t\t   (and (eq_attr \"isa\" \"avx\")\n \t\t\t\t\t(and (eq_attr \"type\" \"ssemov\")\n@@ -831,7 +1299,7 @@\n \t\t\t \"znver1-direct,znver1-ieu2\")\n \n (define_insn_reservation \"znver2_avx_mov\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"mode\" \"TI\")\n \t\t\t\t   (and (eq_attr \"isa\" \"avx\")\n \t\t\t\t\t(and (eq_attr \"type\" \"ssemov\")\n@@ -843,7 +1311,8 @@\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,TI\"))\n \t\t\t\t   (ior (eq_attr \"cpu\" \"znver2\")\n-\t\t\t\t\t      (eq_attr \"cpu\" \"znver3\")))\n+\t\t\t\t\t(ior (eq_attr \"cpu\" \"znver3\")\n+\t\t\t\t\t (eq_attr \"cpu\" \"znver4\"))))\n \t\t\t      (and (eq_attr \"type\" \"ssemov\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fpu\")\n@@ -855,7 +1324,7 @@\n \t\t\t\t\t(eq_attr \"memory\" \"store\"))))\n \t\t\t\"znver1-direct,znver1-fpu,znver1-store\")\n (define_insn_reservation \"znver2_sseavx_mov_store\" 1\n-\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n+\t\t\t (and (eq_attr \"cpu\" \"znver2,znver3,znver4\")\n \t\t\t      (and (eq_attr \"type\" \"ssemov\")\n \t\t\t\t   (eq_attr \"memory\" \"store\")))\n \t\t\t\"znver1-direct,znver1-fpu,znver2-store\")\n@@ -869,6 +1338,12 @@\n \t\t\t\t    (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fpu\")\n \n+(define_insn_reservation \"znver4_sseavx_mov_load\" 8\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssemov\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-double,znver4-load,znver1-fpu\")\n+\n (define_insn_reservation \"znver1_avx256_mov\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF,V4DF,OI\")\n@@ -895,7 +1370,8 @@\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,TI\"))\n \t\t\t\t   (ior (eq_attr \"cpu\" \"znver2\")\n-\t\t\t\t\t(eq_attr \"cpu\" \"znver3\")))\n+\t\t\t\t    (ior (eq_attr \"cpu\" \"znver3\")\n+\t\t\t\t\t (eq_attr \"cpu\" \"znver4\"))))\n \t\t\t      (and (eq_attr \"type\" \"sseadd\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp2|znver1-fp3\")\n@@ -909,6 +1385,12 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp2|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_sseavx_add_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseadd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp2|znver1-fp3\")\n+\n (define_insn_reservation \"znver1_avx256_add\" 3\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF,V4DF,OI\")\n@@ -960,13 +1442,41 @@\n \t\t\t\t\t(eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n \n+(define_insn_reservation \"znver4_sseavx_fma\" 4\n+\t\t\t (and (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,V8SF,V4DF\"))\n+\t\t\t\t   (and (eq_attr \"type\" \"ssemuladd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sseavx_fma_evex\" 4\n+\t\t\t (and (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"mode\" \"V16SF,V8DF\"))\n+\t\t\t\t   (and (eq_attr \"type\" \"ssemuladd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp0+znver1-fp1\")\n+\n (define_insn_reservation \"znver3_sseavx_fma_load\" 11\n \t\t\t (and (and (eq_attr \"cpu\" \"znver3\")\n \t\t\t       (eq_attr \"mode\" \"SF,DF,V4SF,V2DF\"))\n \t\t\t\t     (and (eq_attr \"type\" \"ssemuladd\")\n \t\t\t\t\t  (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp1\")\n \n+(define_insn_reservation \"znver4_sseavx_fma_load\" 11\n+\t\t\t (and (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,V8SF,V4DF\"))\n+\t\t\t\t   (and (eq_attr \"type\" \"ssemuladd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sseavx_fma_evex_load\" 11\n+\t\t\t (and (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"mode\" \"V16SF,V8DF\"))\n+\t\t\t\t   (and (eq_attr \"type\" \"ssemuladd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0+znver1-fp1\")\n+\n (define_insn_reservation \"znver3_avx256_fma\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver3\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF,V4DF\")\n@@ -990,6 +1500,20 @@\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0|znver1-fp1|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_sseavx_iadd\" 1\n+\t\t\t (and (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"mode\" \"QI,HI,SI,DI,TI,OI,XI\"))\n+\t\t\t\t   (and (eq_attr \"type\" \"sseiadd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fpu\")\n+\n+(define_insn_reservation \"znver4_sseavx_iadd_load\" 8\n+\t\t\t (and (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (eq_attr \"mode\" \"QI,HI,SI,DI,TI,OI,XI\"))\n+\t\t\t\t   (and (eq_attr \"type\" \"sseiadd\")\n+\t\t\t\t\t(eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fpu\")\n+\n (define_insn_reservation \"znver1_sseavx_iadd_load\" 8\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"DI,TI\"))\n@@ -1053,6 +1577,33 @@\n \t\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n \t\t\t \"znver1-double,znver1-load,znver1-fp3,znver1-ieu0\")\n \n+(define_insn_reservation \"znver4_ssecvtsfdf_si\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"SI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-double,znver1-fp2|znver1-fp3,znver4-fp-store0\")\n+\n+(define_insn_reservation \"znver4_ssecvtsfdf_si_load\" 11\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"SI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-double,znver4-load,znver1-fp2|znver1-fp3,znver4-fp-store0\")\n+\n+(define_insn_reservation \"znver4_ssecvtsfdf_di\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"DI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fp2|znver1-fp3\")\n+\n+(define_insn_reservation \"znver4_ssecvtsfdf_di_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"DI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseicvt\")\n+\t\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp2|znver1-fp3\")\n \n ;; All other used ssecvt fp3 pipes\n ;; Check: Need to revisit this again.\n@@ -1069,12 +1620,24 @@\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp3\")\n \n+(define_insn_reservation \"znver4_ssecvt\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (eq_attr \"memory\" \"none\")))\n+\t\t\t \"znver1-direct,znver1-fp2|znver1-fp3\")\n+\n (define_insn_reservation \"znver1_ssecvt_load\" 11\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp3\")\n \n+(define_insn_reservation \"znver4_ssecvt_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (eq_attr \"memory\" \"load\")))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp2|znver1-fp3\")\n+\n ;; SSE div\n (define_insn_reservation \"znver1_ssediv_ss_ps\" 10\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n@@ -1087,6 +1650,21 @@\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp3*10\")\n \n+(define_insn_reservation \"znver4_ssediv_ss_ps\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V16SF,V8SF,V4SF,SF\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fp3*10\")\n+\n+(define_insn_reservation \"znver4_ssediv_ss_ps_evex\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V16SF,V8SF,V4SF,SF\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"znver1-direct,znver1-fp1*10\")\n+\n (define_insn_reservation \"znver1_ssediv_ss_ps_load\" 17\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"V4SF,SF\"))\n@@ -1098,6 +1676,21 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp3*10\")\n \n+(define_insn_reservation \"znver4_ssediv_ss_ps_load\" 17\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V16SF,V8SF,V4SF,SF\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp3*10\")\n+\n+(define_insn_reservation \"znver4_ssediv_ss_ps_evex_load\" 17\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V16SF,V8SF,V4SF,SF\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp1*10\")\n+\n (define_insn_reservation \"znver1_ssediv_sd_pd\" 13\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"V2DF,DF\"))\n@@ -1109,6 +1702,21 @@\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp3*13\")\n \n+(define_insn_reservation \"znver4_ssediv_sd_pd\" 13\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V8DF,V4DF,V2DF,DF\")\n+\t\t\t\t    (eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver1-fp3*13\")\n+\n+(define_insn_reservation \"znver4_ssediv_sd_pd_evex\" 13\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V8DF,V4DF,V2DF,DF\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t     (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"znver1-direct,znver1-fp1*13\")\n+\n (define_insn_reservation \"znver1_ssediv_sd_pd_load\" 20\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t\t\t       (eq_attr \"mode\" \"V2DF,DF\"))\n@@ -1120,6 +1728,21 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp3*13\")\n \n+(define_insn_reservation \"znver4_ssediv_sd_pd_load\" 20\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V8DF,V4DF,V2DF,DF\")\n+\t\t\t\t    (eq_attr \"memory\" \"load\"))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp3*13\")\n+\n+(define_insn_reservation \"znver4_ssediv_sd_pd_evex_load\" 20\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssecvt\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V8DF,V4DF,V2DF,DF\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t     (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp1*13\")\n+\n (define_insn_reservation \"znver1_ssediv_avx256_ps\" 12\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF\")\n@@ -1153,12 +1776,19 @@\n \t\t\t                (eq_attr \"mode\" \"V4SF,SF\"))\n \t\t\t\t   (and (eq_attr \"cpu\" \"znver2\")\n \t\t\t\t\t      (eq_attr \"mode\" \"V8SF,V4SF,SF,V4DF,V2DF,DF\"))\n-\t\t\t\t   (and (eq_attr \"cpu\" \"znver3\")\n+\t\t\t\t   (and (eq_attr \"cpu\" \"znver3,znver4\")\n \t\t\t\t\t      (eq_attr \"mode\" \"V8SF,V4SF,SF,V4DF,V2DF,DF\")))\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,(znver1-fp0|znver1-fp1)*3\")\n \n+(define_insn_reservation \"znver4_ssemul_ss_ps_evex\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssemul\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V8DF,V16SF\")\n+\t\t\t\t    \t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,(znver1-fp0+znver1-fp1)*3\")\n+\n (define_insn_reservation \"znver1_ssemul_ss_ps_load\" 10 \n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t                (eq_attr \"mode\" \"V4SF,SF\"))\n@@ -1170,6 +1800,13 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,(znver1-fp0|znver1-fp1)*3\")\n \n+(define_insn_reservation \"znver4_ssemul_ss_ps_evex_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"type\" \"ssemul\")\n+\t\t\t\t   (and (eq_attr \"mode\" \"V8DF,V16SF\")\n+\t\t\t\t    \t(eq_attr \"memory\" \"none\"))))\n+\t\t\t \"znver1-direct,znver4-load,(znver1-fp0+znver1-fp1)*3\")\n+\n (define_insn_reservation \"znver1_ssemul_avx256_ps\" 3\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF\")\n@@ -1231,12 +1868,44 @@\n \t\t\t                (eq_attr \"mode\" \"TI\"))\n \t\t\t\t   (and (eq_attr \"cpu\" \"znver2\")\n \t\t\t\t\t      (eq_attr \"mode\" \"TI,OI\"))\n-\t\t\t\t   (and (eq_attr \"cpu\" \"znver3\")\n+\t\t\t\t   (and (eq_attr \"cpu\" \"znver3,znver4\")\n \t\t\t\t\t      (eq_attr \"mode\" \"TI,OI\")))\n \t\t\t      (and (eq_attr \"type\" \"sseimul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0*3\")\n \n+(define_insn_reservation \"znver4_sseimul\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"TI,OI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sseimul_evex\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"XI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (eq_attr \"memory\" \"none\")))))\n+\t\t\t \"znver1-direct,znver1-fp0+znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sseimul_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"TI,OI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sseimul_evex_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"XI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (eq_attr \"memory\" \"load\")))))\n+\t\t\t \"znver1-direct,znver4-load,znver1-fp0+znver1-fp1\")\n+\n (define_insn_reservation \"znver1_sseimul_avx256\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"mode\" \"OI\")\n@@ -1282,12 +1951,66 @@\n \t\t\t                (eq_attr \"mode\" \"SF,DF,V4SF,V2DF\"))\n \t\t\t\t   (and (eq_attr \"cpu\" \"znver2\")\n \t\t\t\t\t      (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,V8SF,V4DF\"))\n-\t\t\t\t   (and (eq_attr \"cpu\" \"znver3\")\n+\t\t\t\t   (and (eq_attr \"cpu\" \"znver3,znver4\")\n \t\t\t\t\t      (eq_attr \"mode\" \"SF,DF,V4SF,V2DF,V8SF,V4DF\")))\n \t\t\t       (and (eq_attr \"type\" \"ssecmp\")\n \t\t\t\t    (eq_attr \"memory\" \"none\")))\n \t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n \n+(define_insn_reservation \"znver4_sse_cmp\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"SF,DF,V4SF,V2DF\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"none\"))))))\n+\t\t\t\"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_cmp_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"SF,DF,V4SF,V2DF\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"load\"))))))\n+\t\t\t\"znver1-double,znver4-load,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_cmp_vex\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"V8SF,V4DF\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"none\"))))))\n+\t\t\t\"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_cmp_vex_load\" 11\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"V8SF,V4DF\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"load\"))))))\n+\t\t\t\"znver1-double,znver4-load,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_cmp_evex\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"V16SF,V8DF\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"none\"))))))\n+\t\t\t\"znver1-direct,znver1-fp0+znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_cmp_evex_load\" 12\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"V16SF,V8DF\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"load\"))))))\n+\t\t\t\"znver1-double,znver4-load,znver1-fp0+znver1-fp1\")\n+\n (define_insn_reservation \"znver1_sse_cmp_load\" 8\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t\t         (eq_attr \"mode\" \"SF,DF,V4SF,V2DF\"))\n@@ -1318,7 +2041,7 @@\n \t\t\t\t\t       (eq_attr \"mode\" \"QI,HI,SI,DI,TI\"))\n \t\t\t\t   (and (eq_attr \"cpu\" \"znver2\")\n \t\t\t\t\t      (eq_attr \"mode\" \"QI,HI,SI,DI,TI,OI\"))\n-\t\t\t\t   (and (eq_attr \"cpu\" \"znver3\")\n+\t\t\t\t   (and (eq_attr \"cpu\" \"znver3,znver4\")\n \t\t\t\t\t      (eq_attr \"mode\" \"QI,HI,SI,DI,TI,OI\")))\n \t\t\t      (and (eq_attr \"type\" \"ssecmp\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n@@ -1335,6 +2058,60 @@\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n \t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp3\")\n \n+(define_insn_reservation \"znver4_sse_icmp\" 3\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"QI,HI,SI,DI,TI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"none\"))))))\n+\t\t\t\"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_icmp_load\" 10\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"QI,HI,SI,DI,TI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"load\"))))))\n+\t\t\t\"znver1-double,znver4-load,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_icmp_vex\" 4\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"OI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"none\"))))))\n+\t\t\t\"znver1-direct,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_cmp_ivex_load\" 11\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"OI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"load\"))))))\n+\t\t\t\"znver1-double,znver4-load,znver1-fp0|znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_icmp_evex\" 5\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"XI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"none\"))))))\n+\t\t\t\"znver1-direct,znver1-fp0+znver1-fp1\")\n+\n+(define_insn_reservation \"znver4_sse_icmp_evex_load\" 12\n+\t\t\t (and (eq_attr \"cpu\" \"znver4\")\n+\t\t\t      (and (eq_attr \"mode\" \"XI\")\n+\t\t\t\t   (and (eq_attr \"type\" \"ssecmp\")\n+\t\t\t\t    (and (eq_attr \"prefix\" \"evex\")\n+\t\t\t\t\t (and (eq_attr \"length_immediate\" \"1\")\n+\t\t\t\t\t  (eq_attr \"memory\" \"load\"))))))\n+\t\t\t\"znver1-double,znver4-load,znver1-fp0+znver1-fp1\")\n+\n (define_insn_reservation \"znver1_sse_icmp_avx256\" 1\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"OI\")", "previous_filename": "gcc/config/i386/znver1.md"}, {"sha": "ba90bfa6b157e84661d37dcdbee633d273bc7aac", "filename": "gcc/doc/extend.texi", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fdoc%2Fextend.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fdoc%2Fextend.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fextend.texi?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -21935,6 +21935,9 @@ AMD Family 19h CPU.\n @item znver3\n AMD Family 19h Zen version 3.\n \n+@item znver4\n+AMD Family 19h Zen version 4.\n+\n @item x86-64\n Baseline x86-64 microarchitecture level (as defined in x86-64 psABI).\n "}, {"sha": "09548c4528c0a25db5dab398a1e08e96a361aab2", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -32172,6 +32172,15 @@ MWAITX, SHA, CLZERO, AES, PCLMUL, CX16, MOVBE, MMX, SSE, SSE2, SSE3, SSE4A,\n SSSE3, SSE4.1, SSE4.2, ABM, XSAVEC, XSAVES, CLFLUSHOPT, POPCNT, RDPID,\n WBNOINVD, PKU, VPCLMULQDQ, VAES, and 64-bit instruction set extensions.)\n \n+@item znver4\n+AMD Family 19h core based CPUs with x86-64 instruction set support. (This\n+supersets BMI, BMI2, CLWB, F16C, FMA, FSGSBASE, AVX, AVX2, ADCX, RDSEED,\n+MWAITX, SHA, CLZERO, AES, PCLMUL, CX16, MOVBE, MMX, SSE, SSE2, SSE3, SSE4A,\n+SSSE3, SSE4.1, SSE4.2, ABM, XSAVEC, XSAVES, CLFLUSHOPT, POPCNT, RDPID,\n+WBNOINVD, PKU, VPCLMULQDQ, VAES, AVX512F, AVX512DQ, AVX512IFMA, AVX512CD,\n+AVX512BW, AVX512VL, AVX512BF16, AVX512VBMI, AVX512VBMI2, AVX512VNNI,\n+AVX512BITALG, AVX512VPOPCNTDQ, GFNI and 64-bit instruction set extensions.)\n+\n @item btver1\n CPUs based on AMD Family 14h cores with x86-64 instruction set support.  (This\n supersets MMX, SSE, SSE2, SSE3, SSSE3, SSE4A, CX16, ABM and 64-bit"}, {"sha": "a8dd8ac4803b6366294b62e8ec26c8a64a123b18", "filename": "gcc/testsuite/g++.target/i386/mv29.C", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fmv29.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fmv29.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fmv29.C?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -49,6 +49,9 @@ int __attribute__ ((target(\"arch=znver3\"))) foo () {\n   return 9;\n }\n \n+int __attribute__ ((target(\"arch=znver4\"))) foo () {\n+  return 10;\n+}\n \n int main ()\n {\n@@ -72,6 +75,8 @@ int main ()\n     assert (val == 8);\n   else if (__builtin_cpu_is (\"znver3\"))\n     assert (val == 9);\n+  else if (__builtin_cpu_is (\"znver4\"))\n+    assert (val == 10);\n   else\n     assert (val == 0);\n "}, {"sha": "fada66bb8bc1f8a1618a39ca406b6cc6d9836cf8", "filename": "gcc/testsuite/gcc.target/i386/funcspec-56.inc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuncspec-56.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf3b532b524ecacb3202ab2c8af419ffaaab7cff/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuncspec-56.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Ffuncspec-56.inc?ref=bf3b532b524ecacb3202ab2c8af419ffaaab7cff", "patch": "@@ -204,6 +204,7 @@ extern void test_arch_bdver3 (void)\t\t__attribute__((__target__(\"arch=bdver3\")));\n extern void test_arch_znver1 (void)             __attribute__((__target__(\"arch=znver1\")));\n extern void test_arch_znver2 (void)             __attribute__((__target__(\"arch=znver2\")));\n extern void test_arch_znver3 (void)             __attribute__((__target__(\"arch=znver3\")));\n+extern void test_arch_znver4 (void)             __attribute__((__target__(\"arch=znver4\")));\n \n extern void test_tune_nocona (void)\t\t__attribute__((__target__(\"tune=nocona\")));\n extern void test_tune_core2 (void)\t\t__attribute__((__target__(\"tune=core2\")));\n@@ -227,6 +228,7 @@ extern void test_tune_generic (void)\t\t__attribute__((__target__(\"tune=generic\"))\n extern void test_tune_znver1 (void)             __attribute__((__target__(\"tune=znver1\")));\n extern void test_tune_znver2 (void)             __attribute__((__target__(\"tune=znver2\")));\n extern void test_tune_znver3 (void)             __attribute__((__target__(\"tune=znver3\")));\n+extern void test_tune_znver4 (void)             __attribute__((__target__(\"tune=znver4\")));\n \n extern void test_fpmath_sse (void)\t\t__attribute__((__target__(\"sse2,fpmath=sse\")));\n extern void test_fpmath_387 (void)\t\t__attribute__((__target__(\"sse2,fpmath=387\")));"}]}