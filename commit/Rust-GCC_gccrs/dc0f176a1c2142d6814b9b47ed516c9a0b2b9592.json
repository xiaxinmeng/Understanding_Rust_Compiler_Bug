{"sha": "dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGMwZjE3NmExYzIxNDJkNjgxNGI5YjQ3ZWQ1MTZjOWEwYjJiOTU5Mg==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2015-10-30T16:26:59Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2015-10-30T16:26:59Z"}, "message": "re PR fortran/68154 (ICE on initializing character parameter array (explicit, implied))\n\n2015-10-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/68154\n\t* decl.c (add_init_expr_to_sym): if the char length in the typespec\n\tis NULL, check for and use a constructor. \n\n2015-10-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/68154\n\t*gfortran.dg/pr68154.f90\n\nFrom-SVN: r229588", "tree": {"sha": "a6154385dcaeb865e9c74b0186eda483530adef3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a6154385dcaeb865e9c74b0186eda483530adef3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/comments", "author": null, "committer": null, "parents": [{"sha": "e3316e3caaf2a009c44ed51bfa9047d0f80903bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3316e3caaf2a009c44ed51bfa9047d0f80903bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3316e3caaf2a009c44ed51bfa9047d0f80903bf"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "74cae2f0d8258145f1ab4e99e14d8fed4351e8ab", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "patch": "@@ -1,4 +1,9 @@\n-2015-10-29  Steven G. Kargl  <kargl@gcc.gnu.org>\n+2015-10-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/68154\n+\t* decl.c (add_init_expr_to_sym): if the char length in the typespec\n+\tis NULL, check for and use a constructor. \n+2015-10-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/68054\n \t* decl.c (match_attr_spec): PROTECTED can only be a module."}, {"sha": "5a95fa4f193c8c5ede074e013d5828d70c2bf2cd", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "patch": "@@ -1461,7 +1461,16 @@ add_init_expr_to_sym (const char *name, gfc_expr **initp, locus *var_locus)\n \t\t    }\n \t\t  else if (init->expr_type == EXPR_ARRAY)\n \t\t    {\n-\t\t      clen = mpz_get_si (init->ts.u.cl->length->value.integer);\n+\t\t      if (init->ts.u.cl)\n+\t\t\tclen = mpz_get_si (init->ts.u.cl->length->value.integer);\n+\t\t      else if (init->value.constructor)\n+\t\t\t{\n+\t\t\t  gfc_constructor *c;\n+\t                  c = gfc_constructor_first (init->value.constructor); \t \n+\t                  clen = c->expr->value.character.length;\n+\t\t\t}\n+\t\t      else\n+\t\t\t  gcc_unreachable ();\n \t\t      sym->ts.u.cl->length\n \t\t\t\t= gfc_get_int_expr (gfc_default_integer_kind,\n \t\t\t\t\t\t    NULL, clen);"}, {"sha": "5407db7f1be10f6a4feda3950d1b1ac7ef14680e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "patch": "@@ -1,3 +1,8 @@\n+2015-10-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/68154\n+\t*gfortran.dg/pr68154.f90\n+\n 2015-10-29  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* c-c++-common/goacc/acc_on_device-2-off.c: Delete."}, {"sha": "6415eb0b804809ff058d0f86df8865b19a80c833", "filename": "gcc/testsuite/gfortran.dg/pr68154.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr68154.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc0f176a1c2142d6814b9b47ed516c9a0b2b9592/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr68154.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr68154.f90?ref=dc0f176a1c2142d6814b9b47ed516c9a0b2b9592", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+! PR fortran/68154\n+! Original code contributed by Gerhard Steinmetz\n+! gerhard dot steinmetz dot fortran at t-online dot de\n+program p\n+   character(1), parameter :: x1(2) = 'a'\n+   character(*), parameter :: x2(2) = x1\n+   character(*), parameter :: x3(*) = x1\n+end"}]}