{"sha": "41cf94fbbaaa245b707a0242b61daf18843aa860", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFjZjk0ZmJiYWFhMjQ1YjcwN2EwMjQyYjYxZGFmMTg4NDNhYTg2MA==", "commit": {"author": {"name": "Mike Stump", "email": "mikestump@comcast.net", "date": "2011-02-07T20:41:50Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2011-02-07T20:41:50Z"}, "message": "re PR target/47558 (163267 breaks exception traceback in xplor-nih)\n\n\tPR target/47558\n\tAdd __ieee_divdc3 entry point.\n\t* config/i386/darwin.h (DECLARE_LIBRARY_RENAMES): Retain ___divdc3\n\tentry point.\n\t(SUBTARGET_INIT_BUILTINS): Call darwin_rename_builtins.\n\t* config/i386/i386.c (TARGET_INIT_LIBFUNCS): Likewise.\n\t* config/darwin.c (darwin_rename_builtins): Add.\n\t* config/darwin-protos.h (darwin_rename_builtins): Add.\n\nFrom-SVN: r169902", "tree": {"sha": "64b9e1e54766da31a2f1890d359a6c3a67297b5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/64b9e1e54766da31a2f1890d359a6c3a67297b5c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41cf94fbbaaa245b707a0242b61daf18843aa860", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41cf94fbbaaa245b707a0242b61daf18843aa860", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41cf94fbbaaa245b707a0242b61daf18843aa860", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41cf94fbbaaa245b707a0242b61daf18843aa860/comments", "author": null, "committer": null, "parents": [{"sha": "ee09a3dd0fc25264794888516d41434a281f7daa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee09a3dd0fc25264794888516d41434a281f7daa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee09a3dd0fc25264794888516d41434a281f7daa"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "e46a0604085a5f70882dcb1d222187a39fb42249", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=41cf94fbbaaa245b707a0242b61daf18843aa860", "patch": "@@ -1,3 +1,14 @@\n+2011-02-07  Mike Stump  <mikestump@comcast.net>\n+\n+\tPR target/47558\n+\tAdd __ieee_divdc3 entry point.\n+\t* config/i386/darwin.h (DECLARE_LIBRARY_RENAMES): Retain ___divdc3\n+\tentry point.\n+\t(SUBTARGET_INIT_BUILTINS): Call darwin_rename_builtins.\n+\t* config/i386/i386.c (TARGET_INIT_LIBFUNCS): Likewise.\n+\t* config/darwin.c (darwin_rename_builtins): Add.\n+\t* config/darwin-protos.h (darwin_rename_builtins): Add.\n+\n 2011-02-07  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \tPR target/47636"}, {"sha": "00230994ad5750d410d7a1b24621b22e1d6e534e", "filename": "gcc/config/darwin-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fdarwin-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fdarwin-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-protos.h?ref=41cf94fbbaaa245b707a0242b61daf18843aa860", "patch": "@@ -124,3 +124,4 @@ extern bool darwin_use_anchors_for_symbol_p (const_rtx symbol);\n extern bool darwin_kextabi_p (void);\n extern void darwin_override_options (void);\n extern void darwin_patch_builtins (void);\n+extern void darwin_rename_builtins (void);"}, {"sha": "8ccf18c4426729434538486fc14d4293e47ab1df", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=41cf94fbbaaa245b707a0242b61daf18843aa860", "patch": "@@ -2823,6 +2823,34 @@ darwin_fold_builtin (tree fndecl, int n_args, tree *argp,\n   return NULL_TREE;\n }\n \n+void\n+darwin_rename_builtins (void)\n+{\n+  /* The system ___divdc3 routine in libSystem on darwin10 is not\n+     accurate to 1ulp, ours is, so we avoid ever using the system name\n+     for this routine and instead install a non-conflicting name that\n+     is accurate.\n+\n+     When -ffast-math or -funsafe-math-optimizations is given, we can\n+     use the faster version.  */\n+  if (!flag_unsafe_math_optimizations)\n+    {\n+      int dcode = (BUILT_IN_COMPLEX_DIV_MIN\n+\t\t   + DCmode - MIN_MODE_COMPLEX_FLOAT);\n+      tree fn = built_in_decls[dcode];\n+      /* Fortran and c call TARGET_INIT_BUILTINS and\n+\t TARGET_INIT_LIBFUNCS at different times, so we have to put a\n+\t call into each to ensure that at least one of them is called\n+\t after build_common_builtin_nodes.  A better fix is to add a\n+\t new hook to run after build_common_builtin_nodes runs.  */\n+      if (fn)\n+\tset_user_assembler_name (fn, \"___ieee_divdc3\");\n+      fn = implicit_built_in_decls[dcode];\n+      if (fn)\n+\tset_user_assembler_name (fn, \"___ieee_divdc3\");\n+    }\n+}\n+\n static hashval_t\n cfstring_hash (const void *ptr)\n {"}, {"sha": "9cf51e326006fd58fb6f2c9149a260edb1c2f683", "filename": "gcc/config/i386/darwin.h", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fi386%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fi386%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fdarwin.h?ref=41cf94fbbaaa245b707a0242b61daf18843aa860", "patch": "@@ -309,5 +309,14 @@ do {\t\t\t\t\t\t\t\t\t\\\n #define SUBTARGET_INIT_BUILTINS\t\t\t\t\t\\\n do {\t\t\t\t\t\t\t\t\\\n   darwin_init_cfstring_builtins ((unsigned) (IX86_BUILTIN_MAX));\\\n+  darwin_rename_builtins ();\t\t\t\t\t\\\n } while(0)\n \n+/* The system ___divdc3 routine in libSystem on darwin10 is not\n+   accurate to 1ulp, ours is, so we avoid ever using the system name\n+   for this routine and instead install a non-conflicting name that is\n+   accurate.  See darwin_rename_builtins.  */\n+#ifdef L_divdc3\n+#define DECLARE_LIBRARY_RENAMES \\\n+  asm(\".text; ___divdc3: jmp ___ieee_divdc3 ; .globl ___divdc3\");\n+#endif"}, {"sha": "12c7062e5ae43b644c063e203d5aea2301016252", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41cf94fbbaaa245b707a0242b61daf18843aa860/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=41cf94fbbaaa245b707a0242b61daf18843aa860", "patch": "@@ -35040,6 +35040,11 @@ ix86_autovectorize_vector_sizes (void)\n #undef TARGET_CONDITIONAL_REGISTER_USAGE\n #define TARGET_CONDITIONAL_REGISTER_USAGE ix86_conditional_register_usage\n \n+#if TARGET_MACHO\n+#undef TARGET_INIT_LIBFUNCS\n+#define TARGET_INIT_LIBFUNCS darwin_rename_builtins\n+#endif\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n #include \"gt-i386.h\""}]}