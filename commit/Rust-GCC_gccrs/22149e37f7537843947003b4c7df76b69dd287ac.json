{"sha": "22149e37f7537843947003b4c7df76b69dd287ac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjIxNDllMzdmNzUzNzg0Mzk0NzAwM2I0YzdkZjc2YjY5ZGQyODdhYw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2018-02-01T01:38:52Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2018-02-01T01:38:52Z"}, "message": "compiler: check for nil receiver in value method\n    \n    We already dereference the pointer to copy the value, but if the\n    method does not use the value then the pointer dereference may be\n    optimized away.  Do an explicit nil check so that we get the panic\n    that is required.\n    \n    Fixes golang/go#19806\n    \n    Reviewed-on: https://go-review.googlesource.com/91275\n\n\t* go.go-torture/execute/printnil.go: New test.\n\nFrom-SVN: r257280", "tree": {"sha": "388a01b7e313a8a26c20afbf0aa8050f869359bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/388a01b7e313a8a26c20afbf0aa8050f869359bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/22149e37f7537843947003b4c7df76b69dd287ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22149e37f7537843947003b4c7df76b69dd287ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22149e37f7537843947003b4c7df76b69dd287ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22149e37f7537843947003b4c7df76b69dd287ac/comments", "author": null, "committer": null, "parents": [{"sha": "ee249a767f6d80ecc1037432ced41bba7e073268", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee249a767f6d80ecc1037432ced41bba7e073268", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee249a767f6d80ecc1037432ced41bba7e073268"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "7dc00636527f2c6e2793c89bba9e795365846fc6", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22149e37f7537843947003b4c7df76b69dd287ac/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22149e37f7537843947003b4c7df76b69dd287ac/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=22149e37f7537843947003b4c7df76b69dd287ac", "patch": "@@ -1,4 +1,4 @@\n-65eaa9003db4effc9c5ffe9c955e9534ba5d7d15\n+71758f9ca1804743afe178f0e2fca489e0217474\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "04edb08c0314de14243dc8a3ce2291e77519d82b", "filename": "gcc/go/gofrontend/gogo.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22149e37f7537843947003b4c7df76b69dd287ac/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22149e37f7537843947003b4c7df76b69dd287ac/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.cc?ref=22149e37f7537843947003b4c7df76b69dd287ac", "patch": "@@ -5610,7 +5610,7 @@ Function::build(Gogo* gogo, Named_object* named_function)\n                   Expression::make_var_reference(parm_no, loc);\n               parm_ref =\n                   Expression::make_dereference(parm_ref,\n-                                               Expression::NIL_CHECK_DEFAULT,\n+                                               Expression::NIL_CHECK_NEEDED,\n                                                loc);\n \t      if ((*p)->var_value()->is_in_heap())\n \t\tparm_ref = Expression::make_heap_expression(parm_ref, loc);"}, {"sha": "9b72dd4736455002346df386d464ff04388ffe3e", "filename": "gcc/testsuite/go.go-torture/execute/printnil.go", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22149e37f7537843947003b4c7df76b69dd287ac/gcc%2Ftestsuite%2Fgo.go-torture%2Fexecute%2Fprintnil.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22149e37f7537843947003b4c7df76b69dd287ac/gcc%2Ftestsuite%2Fgo.go-torture%2Fexecute%2Fprintnil.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgo.go-torture%2Fexecute%2Fprintnil.go?ref=22149e37f7537843947003b4c7df76b69dd287ac", "patch": "@@ -0,0 +1,19 @@\n+// printnil checks that fmt correctly handles a nil pointer receiver\n+// for a value method at all optimization levels.\n+package main\n+\n+import \"fmt\"\n+\n+type MyType struct {\n+\tval int\n+}\n+\n+func (t MyType) String() string {\n+\treturn \"foobar\"\n+}\n+\n+func main() {\n+\tif got := fmt.Sprintf(\"%s\", (*MyType)(nil)); got != \"<nil>\" {\n+\t\tpanic(got)\n+\t}\n+}"}]}