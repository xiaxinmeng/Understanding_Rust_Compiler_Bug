{"sha": "630686f93f0018fa1ef128aa673fddd302cc83e1", "node_id": "C_kwDOANBUbNoAKDYzMDY4NmY5M2YwMDE4ZmExZWYxMjhhYTY3M2ZkZGQzMDJjYzgzZTE", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-11-22T16:29:40Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-11-23T02:43:38Z"}, "message": "libcpp: Use [[likely]] conditionally\n\nLet's hide [[likely]] behind a macro, to suppress warnings if the\ncompiler doesn't support it.\n\nCo-authored-by: Jonathan Wakely <jwakely@redhat.com>\n\n\tPR preprocessor/103355\n\nlibcpp/ChangeLog:\n\n\t* lex.c: Use ATTR_LIKELY instead of [[likely]].\n\t* system.h (ATTR_LIKELY): Define.", "tree": {"sha": "26e9d26bbbc8b103e2c8199ce6d818d3f90bae7d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/26e9d26bbbc8b103e2c8199ce6d818d3f90bae7d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/630686f93f0018fa1ef128aa673fddd302cc83e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/630686f93f0018fa1ef128aa673fddd302cc83e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/630686f93f0018fa1ef128aa673fddd302cc83e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/630686f93f0018fa1ef128aa673fddd302cc83e1/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e888bea2384a0d8d29a6545c4f57f41cb49df0a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e888bea2384a0d8d29a6545c4f57f41cb49df0a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e888bea2384a0d8d29a6545c4f57f41cb49df0a6"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "9c27d8b5a085e6ff256514d0aa6bed8023e97ede", "filename": "libcpp/lex.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/630686f93f0018fa1ef128aa673fddd302cc83e1/libcpp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/630686f93f0018fa1ef128aa673fddd302cc83e1/libcpp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Flex.c?ref=630686f93f0018fa1ef128aa673fddd302cc83e1", "patch": "@@ -1286,7 +1286,7 @@ namespace bidi {\n       case kind::RTL:\n \t/* These aren't popped by a PDF/PDI.  */\n \tbreak;\n-      [[likely]] case kind::NONE:\n+      ATTR_LIKELY case kind::NONE:\n \tbreak;\n       default:\n \tabort ();"}, {"sha": "f6fc583ab806afe8edf93df2bb9d9b2f5c4f2c71", "filename": "libcpp/system.h", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/630686f93f0018fa1ef128aa673fddd302cc83e1/libcpp%2Fsystem.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/630686f93f0018fa1ef128aa673fddd302cc83e1/libcpp%2Fsystem.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fsystem.h?ref=630686f93f0018fa1ef128aa673fddd302cc83e1", "patch": "@@ -422,6 +422,16 @@ extern void fancy_abort (const char *, int, const char *) ATTRIBUTE_NORETURN;\n #define gcc_checking_assert(EXPR) ((void)(0 && (EXPR)))\n #endif\n \n+#ifdef __has_cpp_attribute\n+# if __has_cpp_attribute(likely)\n+#  define ATTR_LIKELY [[likely]]\n+# elif __has_cpp_attribute(__likely__)\n+#  define ATTR_LIKELY [[__likely__]]\n+# else\n+#  define ATTR_LIKELY\n+# endif\n+#endif\n+\n /* Poison identifiers we do not want to use.  */\n #if (GCC_VERSION >= 3000)\n #undef calloc"}]}