{"sha": "8c098567886e155a07aabfeea764d5c67eadbdaf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGMwOTg1Njc4ODZlMTU1YTA3YWFiZmVlYTc2NGQ1YzY3ZWFkYmRhZg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-11-21T02:17:11Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-11-21T02:17:11Z"}, "message": "re PR libfortran/78549 (Very slow formatted internal file output)\n\n2017-11-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libgfortran/78549\n\t* io/io.h (newunit_free): Add declaration. Clean some whitespace.\n\t* io/transfer.c (st_read_done, st_write_done): Call newunit_free.\n\t* io/unit.c (newunit_free): Change type from static void to void.\n\nFrom-SVN: r254982", "tree": {"sha": "0079454f1190fece42b63c7212011aa660f64fa4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0079454f1190fece42b63c7212011aa660f64fa4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c098567886e155a07aabfeea764d5c67eadbdaf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c098567886e155a07aabfeea764d5c67eadbdaf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c098567886e155a07aabfeea764d5c67eadbdaf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c098567886e155a07aabfeea764d5c67eadbdaf/comments", "author": null, "committer": null, "parents": [{"sha": "34b81eb96cd1df28d7f878bc1f3df607746507da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34b81eb96cd1df28d7f878bc1f3df607746507da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34b81eb96cd1df28d7f878bc1f3df607746507da"}], "stats": {"total": 65, "additions": 40, "deletions": 25}, "files": [{"sha": "f37850c4505591ee492be37a7430eb08db8fd115", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=8c098567886e155a07aabfeea764d5c67eadbdaf", "patch": "@@ -1,3 +1,10 @@\n+2017-11-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/78549\n+\t* io/io.h (newunit_free): Add declaration. Clean some whitespace.\n+\t* io/transfer.c (st_read_done, st_write_done): Call newunit_free.\n+\t* io/unit.c (newunit_free): Change type from static void to void.\n+\n 2017-11-19  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR fortran/44292"}, {"sha": "50db35e1cff45467d9e04f4c6938edc1c1462e33", "filename": "libgfortran/io/io.h", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2Fio%2Fio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2Fio%2Fio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fio.h?ref=8c098567886e155a07aabfeea764d5c67eadbdaf", "patch": "@@ -760,18 +760,21 @@ internal_proto(find_or_create_unit);\n extern gfc_unit *get_unit (st_parameter_dt *, int);\n internal_proto(get_unit);\n \n-extern void unlock_unit (gfc_unit *);\n+extern void unlock_unit(gfc_unit *);\n internal_proto(unlock_unit);\n \n extern void finish_last_advance_record (gfc_unit *u);\n-internal_proto (finish_last_advance_record);\n+internal_proto(finish_last_advance_record);\n \n-extern int unit_truncate (gfc_unit *, gfc_offset, st_parameter_common *);\n-internal_proto (unit_truncate);\n+extern int unit_truncate(gfc_unit *, gfc_offset, st_parameter_common *);\n+internal_proto(unit_truncate);\n \n extern int newunit_alloc (void);\n internal_proto(newunit_alloc);\n \n+extern void newunit_free (int);\n+internal_proto(newunit_free);\n+\n \n /* open.c */\n "}, {"sha": "1eb23fb89c8fc065aaabd644dfa9958fcfdd1a45", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 25, "deletions": 19, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=8c098567886e155a07aabfeea764d5c67eadbdaf", "patch": "@@ -4087,16 +4087,19 @@ st_read_done (st_parameter_dt *dtp)\n   if (dtp->u.p.current_unit != NULL\n       && dtp->u.p.current_unit->child_dtio == 0)\n     {\n-      if (is_internal_unit (dtp) &&\n-\t  (dtp->common.flags & IOPARM_DT_HAS_UDTIO) == 0)\n-        {\n-\t  free (dtp->u.p.current_unit->filename);\n-\t  dtp->u.p.current_unit->filename = NULL;\n-\t  free (dtp->u.p.current_unit->s);\n-\t  dtp->u.p.current_unit->s = NULL;\n-\t  if (dtp->u.p.current_unit->ls)\n-\t    free (dtp->u.p.current_unit->ls);\n-\t  dtp->u.p.current_unit->ls = NULL;\n+      if (is_internal_unit (dtp))\n+\t{\n+\t  if ((dtp->common.flags & IOPARM_DT_HAS_UDTIO) == 0)\n+\t    {\n+\t      free (dtp->u.p.current_unit->filename);\n+\t      dtp->u.p.current_unit->filename = NULL;\n+\t      free (dtp->u.p.current_unit->s);\n+\t      dtp->u.p.current_unit->s = NULL;\n+\t      if (dtp->u.p.current_unit->ls)\n+\t\tfree (dtp->u.p.current_unit->ls);\n+\t      dtp->u.p.current_unit->ls = NULL;\n+\t    }\n+\t  newunit_free (dtp->common.unit);\n \t}\n       if (is_internal_unit (dtp) || dtp->u.p.format_not_saved)\n \t{\n@@ -4155,16 +4158,19 @@ st_write_done (st_parameter_dt *dtp)\n \n       /* If this is a parent WRITE statement we do not need to retain the\n \t internal unit structure for child use.  */\n-      if (is_internal_unit (dtp) &&\n-\t  (dtp->common.flags & IOPARM_DT_HAS_UDTIO) == 0)\n+      if (is_internal_unit (dtp))\n \t{\n-\t  free (dtp->u.p.current_unit->filename);\n-\t  dtp->u.p.current_unit->filename = NULL;\n-\t  free (dtp->u.p.current_unit->s);\n-\t  dtp->u.p.current_unit->s = NULL;\n-\t  if (dtp->u.p.current_unit->ls)\n-\t    free (dtp->u.p.current_unit->ls);\n-\t  dtp->u.p.current_unit->ls = NULL;\n+\t  if ((dtp->common.flags & IOPARM_DT_HAS_UDTIO) == 0)\n+\t    {\n+\t      free (dtp->u.p.current_unit->filename);\n+\t      dtp->u.p.current_unit->filename = NULL;\n+\t      free (dtp->u.p.current_unit->s);\n+\t      dtp->u.p.current_unit->s = NULL;\n+\t      if (dtp->u.p.current_unit->ls)\n+\t\tfree (dtp->u.p.current_unit->ls);\n+\t      dtp->u.p.current_unit->ls = NULL;\n+\t    }\n+\t  newunit_free (dtp->common.unit);\n \t}\n       if (is_internal_unit (dtp) || dtp->u.p.format_not_saved)\n \t{"}, {"sha": "e62f9b839d4a35eff4e251459082807a8ff8bff5", "filename": "libgfortran/io/unit.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2Fio%2Funit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c098567886e155a07aabfeea764d5c67eadbdaf/libgfortran%2Fio%2Funit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funit.c?ref=8c098567886e155a07aabfeea764d5c67eadbdaf", "patch": "@@ -89,7 +89,6 @@ static int newunit_size; /* Total number of elements in the newunits array.  */\n    units are allocated, above and equal to the LWI there may be both\n    allocated and free units. */\n static int newunit_lwi;\n-static void newunit_free (int);\n \n /* Unit numbers assigned with NEWUNIT start from here.  */\n #define NEWUNIT_START -10\n@@ -911,7 +910,7 @@ newunit_alloc (void)\n /* Free a previously allocated newunit= unit number.  unit_lock must\n    be held when calling.  */\n \n-static void\n+void\n newunit_free (int unit)\n {\n   int ind = -unit + NEWUNIT_START;"}]}