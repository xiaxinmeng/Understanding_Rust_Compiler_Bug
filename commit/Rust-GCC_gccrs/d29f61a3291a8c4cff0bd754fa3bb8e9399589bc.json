{"sha": "d29f61a3291a8c4cff0bd754fa3bb8e9399589bc", "node_id": "C_kwDOANBUbNoAKGQyOWY2MWEzMjkxYThjNGNmZjBiZDc1NGZhM2JiOGU5Mzk5NTg5YmM", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-06-22T22:19:11Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-06-23T03:23:01Z"}, "message": "c++: dependence of baselink [PR105964]\n\nhelper<token>::c isn't dependent just because we haven't deduced its return\ntype yet.  type_dependent_expression_p already knows how to deal with that\nfor bare FUNCTION_DECL, but needs to learn to look through a BASELINK.\n\n\tPR c++/105964\n\ngcc/cp/ChangeLog:\n\n\t* pt.cc (type_dependent_expression_p): Look through BASELINK.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp1z/nontype-auto21.C: New test.", "tree": {"sha": "411de58233950f3fca46854527f13b8f905f648c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/411de58233950f3fca46854527f13b8f905f648c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3104a9fa7e704d859cec46afba8b51cb1a233b40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3104a9fa7e704d859cec46afba8b51cb1a233b40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3104a9fa7e704d859cec46afba8b51cb1a233b40"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "4d1c325432d64297615cc78c9c2c97fa2f9db627", "filename": "gcc/cp/pt.cc", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc/gcc%2Fcp%2Fpt.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc/gcc%2Fcp%2Fpt.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.cc?ref=d29f61a3291a8c4cff0bd754fa3bb8e9399589bc", "patch": "@@ -27960,6 +27960,15 @@ type_dependent_expression_p (tree expression)\n       && DECL_INITIAL (expression))\n    return true;\n \n+  /* Pull a FUNCTION_DECL out of a BASELINK if we can.  */\n+  if (BASELINK_P (expression))\n+    {\n+      if (BASELINK_OPTYPE (expression)\n+\t  && dependent_type_p (BASELINK_OPTYPE (expression)))\n+\treturn true;\n+      expression = BASELINK_FUNCTIONS (expression);\n+    }\n+\n   /* A function or variable template-id is type-dependent if it has any\n      dependent template arguments.  */\n   if (VAR_OR_FUNCTION_DECL_P (expression)"}, {"sha": "376d63269cb599eb3ca9f5510f9b0383e07b8b02", "filename": "gcc/testsuite/g++.dg/cpp1z/nontype-auto21.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnontype-auto21.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d29f61a3291a8c4cff0bd754fa3bb8e9399589bc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnontype-auto21.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fnontype-auto21.C?ref=d29f61a3291a8c4cff0bd754fa3bb8e9399589bc", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/105964\n+// { dg-do compile { target c++17 } }\n+\n+struct token {};\n+\n+struct example {};\n+\n+template< typename >\n+struct helper\n+{\n+    static constexpr auto c() { return 42; }\n+};\n+\n+struct impostor_c\n+{\n+    template< typename T, auto= helper< T >::c >\n+    static example func();\n+};\n+\n+example c= impostor_c::func< token >();"}]}