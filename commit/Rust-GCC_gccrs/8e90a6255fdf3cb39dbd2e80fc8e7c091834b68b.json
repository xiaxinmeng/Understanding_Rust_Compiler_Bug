{"sha": "8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGU5MGE2MjU1ZmRmM2NiMzlkYmQyZTgwZmM4ZTdjMDkxODM0YjY4Yg==", "commit": {"author": {"name": "Walter Lee", "email": "walt@tilera.com", "date": "2014-01-25T20:24:57Z"}, "committer": {"name": "Walter Lee", "email": "walt@gcc.gnu.org", "date": "2014-01-25T20:24:57Z"}, "message": "tilegx.c (tilegx_gen_bundles): Delete barrier insns after bundles have been formed.\n\n2014-01-25  Walter Lee  <walt@tilera.com>\n\n            * config/tilegx/tilegx.c (tilegx_gen_bundles): Delete barrier\n            insns after bundles have been formed.\n            * config/tilegx/tilegx.md (tile_network_barrier): Update\n            comment.\n\nFrom-SVN: r207081", "tree": {"sha": "1f774bec111b57c238aaf4588c36a3d8c66ee3e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f774bec111b57c238aaf4588c36a3d8c66ee3e1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/comments", "author": {"login": "walt-tilera", "id": 6602917, "node_id": "MDQ6VXNlcjY2MDI5MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/6602917?v=4", "gravatar_id": "", "url": "https://api.github.com/users/walt-tilera", "html_url": "https://github.com/walt-tilera", "followers_url": "https://api.github.com/users/walt-tilera/followers", "following_url": "https://api.github.com/users/walt-tilera/following{/other_user}", "gists_url": "https://api.github.com/users/walt-tilera/gists{/gist_id}", "starred_url": "https://api.github.com/users/walt-tilera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/walt-tilera/subscriptions", "organizations_url": "https://api.github.com/users/walt-tilera/orgs", "repos_url": "https://api.github.com/users/walt-tilera/repos", "events_url": "https://api.github.com/users/walt-tilera/events{/privacy}", "received_events_url": "https://api.github.com/users/walt-tilera/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "450c1ffe7717b814b69154b2ab0f66239a8820ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/450c1ffe7717b814b69154b2ab0f66239a8820ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/450c1ffe7717b814b69154b2ab0f66239a8820ba"}], "stats": {"total": 31, "additions": 25, "deletions": 6}, "files": [{"sha": "36ec716a3977ae81f8251c7d79c4e92781086817", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "patch": "@@ -1,3 +1,10 @@\n+2014-01-25  Walter Lee  <walt@tilera.com>\n+\n+\t* config/tilegx/tilegx.c (tilegx_gen_bundles): Delete barrier\n+\tinsns before bundling.\n+\t* config/tilegx/tilegx.md (tile_network_barrier): Update\n+\tcomment.\n+\n 2014-01-25  Walter Lee  <walt@tilera.com>\n \n \t* config/tilegx/tilegx.c (tilegx_expand_builtin): Set"}, {"sha": "7694e31e7553967afb821ce7b9a64185a2381b0a", "filename": "gcc/config/tilegx/tilegx.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/gcc%2Fconfig%2Ftilegx%2Ftilegx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/gcc%2Fconfig%2Ftilegx%2Ftilegx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ftilegx%2Ftilegx.c?ref=8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "patch": "@@ -4401,10 +4401,12 @@ tilegx_gen_bundles (void)\n   basic_block bb;\n   FOR_EACH_BB_FN (bb, cfun)\n     {\n-      rtx insn, next;\n+      rtx insn, next, prev;\n       rtx end = NEXT_INSN (BB_END (bb));\n \n-      for (insn = next_insn_to_bundle (BB_HEAD (bb), end); insn; insn = next)\n+      prev = NULL_RTX;\n+      for (insn = next_insn_to_bundle (BB_HEAD (bb), end); insn;\n+\t   prev = insn, insn = next)\n \t{\n \t  next = next_insn_to_bundle (NEXT_INSN (insn), end);\n \n@@ -4429,6 +4431,18 @@ tilegx_gen_bundles (void)\n \t\t  PUT_MODE (insn, SImode);\n \t\t}\n \t    }\n+\n+\t  /* Delete barrier insns, because they can mess up the\n+\t     emitting of bundle braces.  If it is end-of-bundle, then\n+\t     the previous insn must be marked end-of-bundle.  */\n+\t  if (get_attr_type (insn) == TYPE_NOTHING) {\n+\t    if (GET_MODE (insn) == QImode && prev != NULL\n+\t\t&& GET_MODE (prev) == SImode)\n+\t      {\n+\t\tPUT_MODE (prev, QImode);\n+\t      }\n+\t    delete_insn (insn);\n+\t  }\n \t}\n     }\n }"}, {"sha": "c8c7af682a8fd5c86abfbae4190d5dac81405294", "filename": "gcc/config/tilegx/tilegx.md", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/gcc%2Fconfig%2Ftilegx%2Ftilegx.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b/gcc%2Fconfig%2Ftilegx%2Ftilegx.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Ftilegx%2Ftilegx.md?ref=8e90a6255fdf3cb39dbd2e80fc8e7c091834b68b", "patch": "@@ -5171,10 +5171,8 @@\n \f\n ;; Network intrinsics\n \n-;; Note the \"pseudo\" text is handled specially by the\n-;; asm_output_opcode routine.  If the output is an empty string, the\n-;; instruction would bypass the asm_output_opcode routine, bypassing\n-;; the bundle handling code.\n+;; Note the this barrier is of type \"nothing,\" which is deleted after\n+;; the final scheduling pass so that nothing is emitted for it.\n (define_insn \"tilegx_network_barrier\"\n   [(unspec_volatile:SI [(const_int 0)] UNSPEC_NETWORK_BARRIER)]\n   \"\""}]}