{"sha": "68ef8841db44baf4b390349b630dd8bcbdfd5223", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjhlZjg4NDFkYjQ0YmFmNGIzOTAzNDliNjMwZGQ4YmNiZGZkNTIyMw==", "commit": {"author": {"name": "Kaveh R. Ghazi", "email": "ghazi@caip.rutgers.edu", "date": "2003-05-05T21:14:46Z"}, "committer": {"name": "Kaveh Ghazi", "email": "ghazi@gcc.gnu.org", "date": "2003-05-05T21:14:46Z"}, "message": "builtins.c (expand_builtin_stpcpy): Only expand when the length of the source string can be evaluated at compile-time.\n\n\t* builtins.c (expand_builtin_stpcpy): Only expand when the length\n\tof the source string can be evaluated at compile-time.\n\nFrom-SVN: r66503", "tree": {"sha": "1f9babb1e5ac2553b24e4cb6ef3e08283d0e9eed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1f9babb1e5ac2553b24e4cb6ef3e08283d0e9eed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68ef8841db44baf4b390349b630dd8bcbdfd5223", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68ef8841db44baf4b390349b630dd8bcbdfd5223", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68ef8841db44baf4b390349b630dd8bcbdfd5223", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68ef8841db44baf4b390349b630dd8bcbdfd5223/comments", "author": null, "committer": null, "parents": [{"sha": "5f7262e693943229dfd8262e04b122a89b9cdd5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f7262e693943229dfd8262e04b122a89b9cdd5f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f7262e693943229dfd8262e04b122a89b9cdd5f"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "ed14f650c0df9708e864c6bde6b8023c0be6caf6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68ef8841db44baf4b390349b630dd8bcbdfd5223/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68ef8841db44baf4b390349b630dd8bcbdfd5223/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=68ef8841db44baf4b390349b630dd8bcbdfd5223", "patch": "@@ -1,3 +1,8 @@\n+2003-05-05  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n+\n+\t* builtins.c (expand_builtin_stpcpy): Only expand when the length\n+\tof the source string can be evaluated at compile-time.\n+\n 2003-05-05  Aldy Hernandez  <aldyh@redhat.com>\n \n         * testsuite/gcc.c-torture/compile/simd-6.c: New."}, {"sha": "feee5312a6c30f020f5342dfb3deaaa47c54e4df", "filename": "gcc/builtins.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68ef8841db44baf4b390349b630dd8bcbdfd5223/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68ef8841db44baf4b390349b630dd8bcbdfd5223/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=68ef8841db44baf4b390349b630dd8bcbdfd5223", "patch": "@@ -2508,7 +2508,7 @@ expand_builtin_stpcpy (arglist, target, mode)\n   else\n     {\n       tree newarglist;\n-      tree len;\n+      tree src, len;\n \n       /* If return value is ignored, transform stpcpy into strcpy.  */\n       if (target == const0_rtx)\n@@ -2527,8 +2527,12 @@ expand_builtin_stpcpy (arglist, target, mode)\n \t\t\t      target, mode, EXPAND_NORMAL);\n \t}\n \n-      len = c_strlen (TREE_VALUE (TREE_CHAIN (arglist)));\n-      if (len == 0)\n+      /* Ensure we get an actual string who length can be evaluated at\n+         compile-time, not an expression containing a string.  This is\n+         because the latter will potentially produce pessimized code\n+         when used to produce the return value.  */\n+      src = TREE_VALUE (TREE_CHAIN (arglist));\n+      if (! c_getstr (src) || ! (len = c_strlen (src)))\n \treturn 0;\n \n       len = fold (size_binop (PLUS_EXPR, len, ssize_int (1)));"}]}