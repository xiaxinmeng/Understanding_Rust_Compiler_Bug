{"sha": "6e471ea7b847f2a8bf4ee0673dc64a4156ec694e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmU0NzFlYTdiODQ3ZjJhOGJmNGVlMDY3M2RjNjRhNDE1NmVjNjk0ZQ==", "commit": {"author": {"name": "Per Bothner", "email": "per@bothner.com", "date": "2002-09-11T19:53:14Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2002-09-11T19:53:14Z"}, "message": "parse.y (fold_constant_for_init): If a VAR_DECL, convert numerical constant to the type of the field.\n\n2002-09-11  Per Bothner  <per@bothner.com>\n\n\t* parse.y (fold_constant_for_init):  If a VAR_DECL, convert numerical\n\tconstant to the type of the field.\n\t(java_complete_tree):  Remove now-redundant code.\n\n\t* parse.y (fold_constant_for_init):  'null' is not a constant expr.\n\nFrom-SVN: r57036", "tree": {"sha": "e28d832f590eaf7db9f11637f405d577093281fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e28d832f590eaf7db9f11637f405d577093281fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e/comments", "author": {"login": "PerBothner", "id": 10293361, "node_id": "MDQ6VXNlcjEwMjkzMzYx", "avatar_url": "https://avatars.githubusercontent.com/u/10293361?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PerBothner", "html_url": "https://github.com/PerBothner", "followers_url": "https://api.github.com/users/PerBothner/followers", "following_url": "https://api.github.com/users/PerBothner/following{/other_user}", "gists_url": "https://api.github.com/users/PerBothner/gists{/gist_id}", "starred_url": "https://api.github.com/users/PerBothner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PerBothner/subscriptions", "organizations_url": "https://api.github.com/users/PerBothner/orgs", "repos_url": "https://api.github.com/users/PerBothner/repos", "events_url": "https://api.github.com/users/PerBothner/events{/privacy}", "received_events_url": "https://api.github.com/users/PerBothner/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "23114b697a3357b7c4166f9841123d2318bdd264", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23114b697a3357b7c4166f9841123d2318bdd264", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23114b697a3357b7c4166f9841123d2318bdd264"}], "stats": {"total": 31, "additions": 15, "deletions": 16}, "files": [{"sha": "2defb3301aadc331f6b06205505f756bfc259cb1", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=6e471ea7b847f2a8bf4ee0673dc64a4156ec694e", "patch": "@@ -1,3 +1,11 @@\n+2002-09-11  Per Bothner  <per@bothner.com>\n+\n+\t* parse.y (fold_constant_for_init):  If a VAR_DECL, convert numerical\n+\tconstant to the type of the field.\n+\t(java_complete_tree):  Remove now-redundant code.\n+\n+\t* parse.y (fold_constant_for_init):  'null' is not a constant expr.\n+\n 2002-09-03  Jesse Rosenstock  <jmr@ugcs.caltech.edu>\n \n \tFor PR java/5794:"}, {"sha": "2112b717da0f329119a1c10e14b541ebf2819499", "filename": "gcc/java/parse.y", "status": "modified", "additions": 7, "deletions": 16, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e/gcc%2Fjava%2Fparse.y", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e471ea7b847f2a8bf4ee0673dc64a4156ec694e/gcc%2Fjava%2Fparse.y", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fparse.y?ref=6e471ea7b847f2a8bf4ee0673dc64a4156ec694e", "patch": "@@ -11509,22 +11509,9 @@ java_complete_tree (node)\n       && DECL_INITIAL (node) != NULL_TREE\n       && !flag_emit_xref)\n     {\n-      tree value = DECL_INITIAL (node);\n-      DECL_INITIAL (node) = NULL_TREE;\n-      value = fold_constant_for_init (value, node);\n-      DECL_INITIAL (node) = value;\n+      tree value = fold_constant_for_init (node, node);\n       if (value != NULL_TREE)\n-\t{\n-\t  /* fold_constant_for_init sometimes widens the original type\n-             of the constant (i.e. byte to int). It's not desirable,\n-             especially if NODE is a function argument. */\n-\t  if ((TREE_CODE (value) == INTEGER_CST\n-\t       || TREE_CODE (value) == REAL_CST)\n-\t      && TREE_TYPE (node) != TREE_TYPE (value))\n-\t    return convert (TREE_TYPE (node), value);\n-\t  else\n-\t    return value;\n-\t}\n+\treturn value;\n     }\n   return node;\n }\n@@ -16010,8 +15997,10 @@ fold_constant_for_init (node, context)\n \n   switch (code)\n     {\n-    case STRING_CST:\n     case INTEGER_CST:\n+      if (node == null_pointer_node)\n+\treturn NULL_TREE;\n+    case STRING_CST:\n     case REAL_CST:\n       return node;\n \n@@ -16084,6 +16073,8 @@ fold_constant_for_init (node, context)\n       /* Guard against infinite recursion. */\n       DECL_INITIAL (node) = NULL_TREE;\n       val = fold_constant_for_init (val, node);\n+      if (val != NULL_TREE && TREE_CODE (val) != STRING_CST)\n+\tval = try_builtin_assignconv (NULL_TREE, TREE_TYPE (node), val);\n       DECL_INITIAL (node) = val;\n       return val;\n "}]}