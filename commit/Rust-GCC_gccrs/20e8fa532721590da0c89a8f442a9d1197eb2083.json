{"sha": "20e8fa532721590da0c89a8f442a9d1197eb2083", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjBlOGZhNTMyNzIxNTkwZGEwYzg5YThmNDQyYTlkMTE5N2ViMjA4Mw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2013-10-11T14:35:23Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-10-11T14:35:23Z"}, "message": "re PR c++/58633 (ICE with decltype of destructor call)\n\n/cp\n2013-10-11  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/58633\n\t* parser.c (cp_parser_commit_to_topmost_tentative_parse): New.\n\t(cp_parser_pseudo_destructor_name): Use it.\n\n/testsuite\n2013-10-11  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/58633\n\t* g++.dg/cpp0x/decltype57.C: New.\n\nFrom-SVN: r203448", "tree": {"sha": "6817098a3e4cee1557cdcd8c01ab3a80bd44e84f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6817098a3e4cee1557cdcd8c01ab3a80bd44e84f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/20e8fa532721590da0c89a8f442a9d1197eb2083", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20e8fa532721590da0c89a8f442a9d1197eb2083", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20e8fa532721590da0c89a8f442a9d1197eb2083", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20e8fa532721590da0c89a8f442a9d1197eb2083/comments", "author": null, "committer": null, "parents": [{"sha": "acd15a286e182ee4b3331a35503bcd67a4294331", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acd15a286e182ee4b3331a35503bcd67a4294331", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acd15a286e182ee4b3331a35503bcd67a4294331"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "d1af38217bc3471a67f68e31db782f6b7faf9b40", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=20e8fa532721590da0c89a8f442a9d1197eb2083", "patch": "@@ -1,3 +1,9 @@\n+2013-10-11  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/58633\n+\t* parser.c (cp_parser_commit_to_topmost_tentative_parse): New.\n+\t(cp_parser_pseudo_destructor_name): Use it.\n+\n 2013-10-11  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/31671"}, {"sha": "4189bf6f117b4731b699098783b7a8dd1072a4f0", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 29, "deletions": 1, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=20e8fa532721590da0c89a8f442a9d1197eb2083", "patch": "@@ -2395,6 +2395,8 @@ static void cp_parser_parse_tentatively\n   (cp_parser *);\n static void cp_parser_commit_to_tentative_parse\n   (cp_parser *);\n+static void cp_parser_commit_to_topmost_tentative_parse\n+  (cp_parser *);\n static void cp_parser_abort_tentative_parse\n   (cp_parser *);\n static bool cp_parser_parse_definitely\n@@ -6741,7 +6743,7 @@ cp_parser_pseudo_destructor_name (cp_parser* parser,\n \n   /* Once we see the ~, this has to be a pseudo-destructor.  */\n   if (!processing_template_decl && !cp_parser_error_occurred (parser))\n-    cp_parser_commit_to_tentative_parse (parser);\n+    cp_parser_commit_to_topmost_tentative_parse (parser);\n \n   /* Look for the type-name again.  We are not responsible for\n      checking that it matches the first type-name.  */\n@@ -24449,6 +24451,32 @@ cp_parser_commit_to_tentative_parse (cp_parser* parser)\n     }\n }\n \n+/* Commit to the topmost currently active tentative parse.\n+\n+   Note that this function shouldn't be called when there are\n+   irreversible side-effects while in a tentative state.  For\n+   example, we shouldn't create a permanent entry in the symbol\n+   table, or issue an error message that might not apply if the\n+   tentative parse is aborted.  */\n+\n+static void\n+cp_parser_commit_to_topmost_tentative_parse (cp_parser* parser)\n+{\n+  cp_parser_context *context = parser->context;\n+  cp_lexer *lexer = parser->lexer;\n+\n+  if (context)\n+    {\n+      if (context->status == CP_PARSER_STATUS_KIND_COMMITTED)\n+\treturn;\n+      context->status = CP_PARSER_STATUS_KIND_COMMITTED;\n+\n+      while (!cp_lexer_saving_tokens (lexer))\n+\tlexer = lexer->next;\n+      cp_lexer_commit_tokens (lexer);\n+    }\n+}\n+\n /* Abort the currently active tentative parse.  All consumed tokens\n    will be rolled back, and no diagnostics will be issued.  */\n "}, {"sha": "87ff2a7dacaf3a857afe3701cc51a0e598d96412", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=20e8fa532721590da0c89a8f442a9d1197eb2083", "patch": "@@ -1,3 +1,8 @@\n+2013-10-11  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/58633\n+\t* g++.dg/cpp0x/decltype57.C: New.\n+\n 2013-10-11  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/31671"}, {"sha": "353cc72c3357edd6e1a6c21fd54aaa2932155bdd", "filename": "gcc/testsuite/g++.dg/cpp0x/decltype57.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype57.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20e8fa532721590da0c89a8f442a9d1197eb2083/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype57.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fdecltype57.C?ref=20e8fa532721590da0c89a8f442a9d1197eb2083", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/58633\n+// { dg-do compile { target c++11 } }\n+\n+void foo(int i)\n+{\n+  typedef int I;\n+  decltype(i.I::~I())* p;\n+}"}]}