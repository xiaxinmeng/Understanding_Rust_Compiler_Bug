{"sha": "15879ef7ac321e3803d96f741a18f6865b0f5bfb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTU4NzllZjdhYzMyMWUzODAzZDk2Zjc0MWExOGY2ODY1YjBmNWJmYg==", "commit": {"author": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2017-08-13T18:31:39Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2017-08-13T18:31:39Z"}, "message": "i386: Replace frame pointer with stack pointer in debug insns\n\nWhen we eliminate frame pointer, we should also replace frame pointer\nwith stack pointer - UNITS_PER_WORD in debug insns.  This patch fixed:\n\nFAIL: gcc.dg/guality/pr58791-5.c   -Os  line pr58791-5.c:20 b1 == 9\nFAIL: gcc.dg/guality/pr58791-5.c   -Os  line pr58791-5.c:20 b2 == 73\nFAIL: gcc.dg/guality/pr58791-5.c   -Os  line pr58791-5.c:20 b3 == 585\nFAIL: gcc.dg/guality/pr58791-5.c   -Os  line pr58791-5.c:20 b4 == 4681\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:17 s1.f == 5.0\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:17 s1.g == 6.0\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:17 s2.g == 6.0\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:20 s1.f == 5.0\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:20 s1.g == 6.0\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:20 s2.f == 5.0\nFAIL: gcc.dg/guality/pr59776.c   -Os  line pr59776.c:20 s2.g == 6.0\n\non Linux/i386.\n\n\tPR target/81820\n\t* config/i386/i386.c (ix86_finalize_stack_frame_flags): Replace\n\tframe pointer with stack pointer - UNITS_PER_WORD in debug insns.\n\nFrom-SVN: r251076", "tree": {"sha": "7935b8ac03a2ed71e5cfe233d0329b11581f6497", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7935b8ac03a2ed71e5cfe233d0329b11581f6497"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/15879ef7ac321e3803d96f741a18f6865b0f5bfb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15879ef7ac321e3803d96f741a18f6865b0f5bfb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15879ef7ac321e3803d96f741a18f6865b0f5bfb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15879ef7ac321e3803d96f741a18f6865b0f5bfb/comments", "author": null, "committer": null, "parents": [{"sha": "cfc72af0fbdfb2af54722bd5fa58b75eaa14c05f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfc72af0fbdfb2af54722bd5fa58b75eaa14c05f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cfc72af0fbdfb2af54722bd5fa58b75eaa14c05f"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "1d88e4f247add49ba9195f1dc8291b525b2a1d42", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15879ef7ac321e3803d96f741a18f6865b0f5bfb/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15879ef7ac321e3803d96f741a18f6865b0f5bfb/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=15879ef7ac321e3803d96f741a18f6865b0f5bfb", "patch": "@@ -14281,6 +14281,42 @@ ix86_finalize_stack_frame_flags (void)\n       df_scan_blocks ();\n       df_compute_regs_ever_live (true);\n       df_analyze ();\n+\n+      if (flag_var_tracking)\n+\t{\n+\t  /* Since frame pointer is no longer available, replace it with\n+\t     stack pointer - UNITS_PER_WORD in debug insns.  */\n+\t  df_ref ref, next;\n+\t  for (ref = DF_REG_USE_CHAIN (HARD_FRAME_POINTER_REGNUM);\n+\t       ref; ref = next)\n+\t    {\n+\t      rtx_insn *insn = DF_REF_INSN (ref);\n+\t      /* Make sure the next ref is for a different instruction,\n+\t\t so that we're not affected by the rescan.  */\n+\t      next = DF_REF_NEXT_REG (ref);\n+\t      while (next && DF_REF_INSN (next) == insn)\n+\t\tnext = DF_REF_NEXT_REG (next);\n+\n+\t      if (DEBUG_INSN_P (insn))\n+\t\t{\n+\t\t  bool changed = false;\n+\t\t  for (; ref != next; ref = DF_REF_NEXT_REG (ref))\n+\t\t    {\n+\t\t      rtx *loc = DF_REF_LOC (ref);\n+\t\t      if (*loc == hard_frame_pointer_rtx)\n+\t\t\t{\n+\t\t\t  *loc = plus_constant (Pmode,\n+\t\t\t\t\t\tstack_pointer_rtx,\n+\t\t\t\t\t\t-UNITS_PER_WORD);\n+\t\t\t  changed = true;\n+\t\t\t}\n+\t\t    }\n+\t\t  if (changed)\n+\t\t    df_insn_rescan (insn);\n+\t\t}\n+\t    }\n+\t}\n+\n       recompute_frame_layout_p = true;\n     }\n "}]}