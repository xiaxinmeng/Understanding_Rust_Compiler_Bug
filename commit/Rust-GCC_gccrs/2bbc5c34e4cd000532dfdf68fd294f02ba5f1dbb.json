{"sha": "2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmJiYzVjMzRlNGNkMDAwNTMyZGZkZjY4ZmQyOTRmMDJiYTVmMWRiYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-01-16T08:44:48Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-01-16T08:44:48Z"}, "message": "re PR c++/83817 (internal compiler error: tree check: expected call_expr, have aggr_init_expr in tsubst_copy_and_build, at cp/pt.c:17822)\n\n\tPR c++/83817\n\t* pt.c (tsubst_copy_and_build) <case CALL_EXPR>: If function\n\tis AGGR_INIT_EXPR rather than CALL_EXPR, set AGGR_INIT_FROM_THUNK_P\n\tinstead of CALL_FROM_THUNK_P.\n\n\t* g++.dg/cpp1y/pr83817.C: New test.\n\nFrom-SVN: r256726", "tree": {"sha": "f16818b6e090ddd13edf92ebe12b8dbf8e02f0f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f16818b6e090ddd13edf92ebe12b8dbf8e02f0f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "774ae645c0c30c19a751b5c3713beef3aa5d8f28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/774ae645c0c30c19a751b5c3713beef3aa5d8f28", "html_url": "https://github.com/Rust-GCC/gccrs/commit/774ae645c0c30c19a751b5c3713beef3aa5d8f28"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "a0119e14640180d0a9dd401b3ca9da20f45bed43", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "patch": "@@ -1,5 +1,10 @@\n 2018-01-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/83817\n+\t* pt.c (tsubst_copy_and_build) <case CALL_EXPR>: If function\n+\tis AGGR_INIT_EXPR rather than CALL_EXPR, set AGGR_INIT_FROM_THUNK_P\n+\tinstead of CALL_FROM_THUNK_P.\n+\n \tPR c++/83825\n \t* name-lookup.c (member_vec_dedup): Return early if len is 0.\n \t(resort_type_member_vec, set_class_bindings,"}, {"sha": "322408d92ec286a9a19de5dd28d2725ac0e491fb", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "patch": "@@ -17819,7 +17819,10 @@ tsubst_copy_and_build (tree t,\n \t\tCALL_EXPR_REVERSE_ARGS (function) = rev;\n \t\tif (thk)\n \t\t  {\n-\t\t    CALL_FROM_THUNK_P (function) = true;\n+\t\t    if (TREE_CODE (function) == CALL_EXPR)\n+\t\t      CALL_FROM_THUNK_P (function) = true;\n+\t\t    else\n+\t\t      AGGR_INIT_FROM_THUNK_P (function) = true;\n \t\t    /* The thunk location is not interesting.  */\n \t\t    SET_EXPR_LOCATION (function, UNKNOWN_LOCATION);\n \t\t  }"}, {"sha": "7bbeafafa34608cf3a5436da9c7768a3aad7743f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "patch": "@@ -1,5 +1,8 @@\n 2018-01-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/83817\n+\t* g++.dg/cpp1y/pr83817.C: New test.\n+\n \tPR c++/83825\n \t* g++.dg/template/pr83825.C: New test.\n "}, {"sha": "9a69cbb201ca70106e2391471a070501f4dbf272", "filename": "gcc/testsuite/g++.dg/cpp1y/pr83817.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr83817.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr83817.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr83817.C?ref=2bbc5c34e4cd000532dfdf68fd294f02ba5f1dbb", "patch": "@@ -0,0 +1,17 @@\n+// PR c++/83817\n+// { dg-do compile { target c++14 } }\n+\n+struct A;\n+struct B { template <typename> using C = A; };\n+struct D : B { struct F { typedef C<char> E; }; };\n+struct G {\n+  struct I { I (D, A &); } h;\n+  D::F::E &k ();\n+  D j;\n+  G (G &&) : h (j, k ()) {}\n+};\n+struct N { G l; };\n+typedef N (*M)(N &);\n+struct H { const char *o; M s; };\n+N foo (N &);\n+H r { \"\", [](auto &x) { return foo (x); }};"}]}