{"sha": "2c86a5741f00f3a85ccd685f250070013c67fc90", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmM4NmE1NzQxZjAwZjNhODVjY2Q2ODVmMjUwMDcwMDEzYzY3ZmM5MA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2019-01-07T22:28:30Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2019-01-07T22:28:30Z"}, "message": "decl.c (start_decl): Improve two error_at locations.\n\n/cp\n2019-01-07  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* decl.c (start_decl): Improve two error_at locations.\n\t(expand_static_init): Likewise.\n\n/testsuite\n2019-01-07  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* g++.dg/diagnostic/constexpr1.C: New.\n\t* g++.dg/diagnostic/thread1.C: Likewise.\n\nFrom-SVN: r267662", "tree": {"sha": "b42c429e5b3f75358238d7a4938ff19cd6b33c2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b42c429e5b3f75358238d7a4938ff19cd6b33c2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c86a5741f00f3a85ccd685f250070013c67fc90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c86a5741f00f3a85ccd685f250070013c67fc90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c86a5741f00f3a85ccd685f250070013c67fc90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c86a5741f00f3a85ccd685f250070013c67fc90/comments", "author": null, "committer": null, "parents": [{"sha": "33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33a5d8ccb5482e446410ffbba30f0b560fc1c8fc"}], "stats": {"total": 50, "additions": 40, "deletions": 10}, "files": [{"sha": "4da1c82334a2a9be16c5c1659cc3c02d5c001f30", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2c86a5741f00f3a85ccd685f250070013c67fc90", "patch": "@@ -1,3 +1,8 @@\n+2019-01-07  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* decl.c (start_decl): Improve two error_at locations.\n+\t(expand_static_init): Likewise.\n+\n 2019-01-07  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/88741 - wrong error with initializer-string."}, {"sha": "220a95c4b0ff01fa6a290d2de595e3c0b71d15e4", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 12, "deletions": 10, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=2c86a5741f00f3a85ccd685f250070013c67fc90", "patch": "@@ -5235,10 +5235,12 @@ start_decl (const cp_declarator *declarator,\n     {\n       bool ok = false;\n       if (CP_DECL_THREAD_LOCAL_P (decl))\n-\terror (\"%qD declared %<thread_local%> in %<constexpr%> function\",\n-\t       decl);\n+\terror_at (DECL_SOURCE_LOCATION (decl),\n+\t\t  \"%qD declared %<thread_local%> in %<constexpr%> function\",\n+\t\t  decl);\n       else if (TREE_STATIC (decl))\n-\terror (\"%qD declared %<static%> in %<constexpr%> function\", decl);\n+\terror_at (DECL_SOURCE_LOCATION (decl),\n+\t\t  \"%qD declared %<static%> in %<constexpr%> function\", decl);\n       else\n \tok = true;\n       if (!ok)\n@@ -8253,18 +8255,18 @@ expand_static_init (tree decl, tree init)\n   if (CP_DECL_THREAD_LOCAL_P (decl) && DECL_GNU_TLS_P (decl)\n       && !DECL_FUNCTION_SCOPE_P (decl))\n     {\n+      location_t dloc = DECL_SOURCE_LOCATION (decl);\n       if (init)\n-\terror (\"non-local variable %qD declared %<__thread%> \"\n-\t       \"needs dynamic initialization\", decl);\n+\terror_at (dloc, \"non-local variable %qD declared %<__thread%> \"\n+\t\t  \"needs dynamic initialization\", decl);\n       else\n-\terror (\"non-local variable %qD declared %<__thread%> \"\n-\t       \"has a non-trivial destructor\", decl);\n+\terror_at (dloc, \"non-local variable %qD declared %<__thread%> \"\n+\t\t  \"has a non-trivial destructor\", decl);\n       static bool informed;\n       if (!informed)\n \t{\n-\t  inform (DECL_SOURCE_LOCATION (decl),\n-\t\t  \"C++11 %<thread_local%> allows dynamic initialization \"\n-\t\t  \"and destruction\");\n+\t  inform (dloc, \"C++11 %<thread_local%> allows dynamic \"\n+\t\t  \"initialization and destruction\");\n \t  informed = true;\n \t}\n       return;"}, {"sha": "29b3b835acccb4dcd39102cff41d90df0f9d6f53", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2c86a5741f00f3a85ccd685f250070013c67fc90", "patch": "@@ -1,3 +1,8 @@\n+2019-01-07  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* g++.dg/diagnostic/constexpr1.C: New.\n+\t* g++.dg/diagnostic/thread1.C: Likewise.\n+\n 2019-01-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \tHarald Anlauf <anlauf@gmx.de>\n \tTobias Burnus <burnus@gcc.gnu.org>"}, {"sha": "f029e86e076b9dd9e8af6cdbc8634b83b84892be", "filename": "gcc/testsuite/g++.dg/diagnostic/constexpr1.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fconstexpr1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fconstexpr1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fconstexpr1.C?ref=2c86a5741f00f3a85ccd685f250070013c67fc90", "patch": "@@ -0,0 +1,5 @@\n+// { dg-do compile { target c++11 } }\n+\n+constexpr int foo() { thread_local int i __attribute__((unused)) {}; return 1; }  // { dg-error \"40:.i. declared .thread_local.\" }\n+\n+constexpr int bar() { static int i __attribute__((unused)) {}; return 1; }  // { dg-error \"34:.i. declared .static.\" }"}, {"sha": "a35d9975f2e0fbcc4848059f4c8f607c836ac9e0", "filename": "gcc/testsuite/g++.dg/diagnostic/thread1.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fthread1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c86a5741f00f3a85ccd685f250070013c67fc90/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fthread1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fthread1.C?ref=2c86a5741f00f3a85ccd685f250070013c67fc90", "patch": "@@ -0,0 +1,13 @@\n+// { dg-do compile { target c++11 } }\n+\n+int foo();\n+\n+__thread int i __attribute__((unused)) = foo();  // { dg-error \"14:non-local variable .i. declared .__thread. needs\" }\n+\n+struct S\n+{\n+  constexpr S() {}\n+  ~S();\n+};\n+\n+__thread S s __attribute__((unused));  // { dg-error \"12:non-local variable .s. declared .__thread. has\" }"}]}