{"sha": "ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWU3OGNiYWE4OTU2Njg0MTg5ZjhmZTNjYTJiNGZjYWM3ZDQ4ZGY5MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-07-21T07:02:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-07-21T07:02:04Z"}, "message": "re PR libgomp/71941 (ICE with OpenMP tasks and queue)\n\n\tPR c++/71941\n\t* cp-gimplify.c (cp_genericize): For nested cp_genericize calls\n\tsave/restore bc_label array.\n\n\t* g++.dg/gomp/pr71941.C: New test.\n\nFrom-SVN: r238579", "tree": {"sha": "ce352f34041577c4315dbf84fa043735176fe814", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce352f34041577c4315dbf84fa043735176fe814"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "172f0e1311f23be40aeb4816f77793dc1317612d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/172f0e1311f23be40aeb4816f77793dc1317612d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/172f0e1311f23be40aeb4816f77793dc1317612d"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "30a0b44c12140d2c9002ec1364e5a6c27105eb96", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "patch": "@@ -1,3 +1,9 @@\n+2016-07-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/71941\n+\t* cp-gimplify.c (cp_genericize): For nested cp_genericize calls\n+\tsave/restore bc_label array.\n+\n 2016-07-21  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/70781"}, {"sha": "59953a6ee04376969051acb710456be0667f24f4", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "patch": "@@ -1632,6 +1632,13 @@ cp_genericize (tree fndecl)\n   if (DECL_CLONED_FUNCTION_P (fndecl))\n     return;\n \n+  /* Allow cp_genericize calls to be nested.  */\n+  tree save_bc_label[2];\n+  save_bc_label[bc_break] = bc_label[bc_break];\n+  save_bc_label[bc_continue] = bc_label[bc_continue];\n+  bc_label[bc_break] = NULL_TREE;\n+  bc_label[bc_continue] = NULL_TREE;\n+\n   /* Expand all the array notations here.  */\n   if (flag_cilkplus \n       && contains_array_notation_expr (DECL_SAVED_TREE (fndecl)))\n@@ -1651,6 +1658,8 @@ cp_genericize (tree fndecl)\n \n   gcc_assert (bc_label[bc_break] == NULL);\n   gcc_assert (bc_label[bc_continue] == NULL);\n+  bc_label[bc_break] = save_bc_label[bc_break];\n+  bc_label[bc_continue] = save_bc_label[bc_continue];\n }\n \f\n /* Build code to apply FN to each member of ARG1 and ARG2.  FN may be"}, {"sha": "48f7bafda0f949e5f0e1d9296135d32303fc0add", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "patch": "@@ -1,3 +1,8 @@\n+2016-07-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/71941\n+\t* g++.dg/gomp/pr71941.C: New test.\n+\n 2016-07-20  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR c/70339"}, {"sha": "ffa53d03e6001549c91fa6d8d4fdb8794272d197", "filename": "gcc/testsuite/g++.dg/gomp/pr71941.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr71941.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee78cbaa8956684189f8fe3ca2b4fcac7d48df91/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr71941.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Fpr71941.C?ref=ee78cbaa8956684189f8fe3ca2b4fcac7d48df91", "patch": "@@ -0,0 +1,22 @@\n+// PR c++/71941\n+// { dg-do compile }\n+// { dg-options \"-fopenmp\" }\n+\n+struct A { A (); A (A &); ~A (); };\n+\n+template <int N>\n+struct B\n+{\n+  struct C { A a; C () : a () {} };\n+  C c;\n+  void foo ();\n+};\n+\n+void\n+bar ()\n+{\n+  B<0> b;\n+#pragma omp task\n+  for (int i = 0; i < 2; i++)\n+    b.foo ();\n+}"}]}