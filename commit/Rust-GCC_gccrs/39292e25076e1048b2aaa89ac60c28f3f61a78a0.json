{"sha": "39292e25076e1048b2aaa89ac60c28f3f61a78a0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzkyOTJlMjUwNzZlMTA0OGIyYWFhODlhYzYwYzI4ZjNmNjFhNzhhMA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2019-12-20T17:41:06Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2019-12-20T17:41:06Z"}, "message": "c-ada-spec.h (decl_sloc): Delete.\n\nc-family/\n\t* c-ada-spec.h (decl_sloc): Delete.\n\t* c-ada-spec.c (decl_sloc): Make static.\nc/\n\t* c-decl.c (collect_source_ref_cb): Delete.\n\t(for_each_global_decl): Rename into...\n\t(collect_source_refs): ...this.  Call collect_source_ref directly.\n\t(c_parse_final_cleanups): Always call collect_source_ref on the main\n\tinput filename.\ncp/\n\t* decl2.c (c_parse_final_cleanups): Always call collect_source_ref on\n\tthe main input filename.\n\nFrom-SVN: r279670", "tree": {"sha": "14d790f6ae6c3e85fd4ba2d1f7763bd61a026494", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14d790f6ae6c3e85fd4ba2d1f7763bd61a026494"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39292e25076e1048b2aaa89ac60c28f3f61a78a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39292e25076e1048b2aaa89ac60c28f3f61a78a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39292e25076e1048b2aaa89ac60c28f3f61a78a0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39292e25076e1048b2aaa89ac60c28f3f61a78a0/comments", "author": null, "committer": null, "parents": [{"sha": "02e8542795c4321a76783b8f419435696bfed9f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02e8542795c4321a76783b8f419435696bfed9f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02e8542795c4321a76783b8f419435696bfed9f1"}], "stats": {"total": 52, "additions": 30, "deletions": 22}, "files": [{"sha": "33ea8ab53d68ada7282c58649ec966f600617d7f", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -1,3 +1,8 @@\n+2019-12-20  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* c-ada-spec.h (decl_sloc): Delete.\n+\t* c-ada-spec.c (decl_sloc): Make static.\n+\n 2019-12-19  Julian Brown  <julian@codesourcery.com>\n \n \t* c-common.h (c_omp_map_clause_name): Add prototype."}, {"sha": "024a3ac91713b6451f751d5087b6aae7a0c5db70", "filename": "gcc/c-family/c-ada-spec.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc-family%2Fc-ada-spec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc-family%2Fc-ada-spec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-ada-spec.c?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -630,7 +630,7 @@ static const char *current_source_file;\n \n /* Return sloc of DECL, using sloc of last field if LAST is true.  */\n \n-location_t\n+static location_t\n decl_sloc (const_tree decl, bool last)\n {\n   tree field;"}, {"sha": "085e89120b206143a88b66bf0b9ae364ddf4837d", "filename": "gcc/c-family/c-ada-spec.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc-family%2Fc-ada-spec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc-family%2Fc-ada-spec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-ada-spec.h?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -36,7 +36,6 @@ enum cpp_operation {\n   IS_TRIVIAL\n };\n \n-extern location_t decl_sloc (const_tree, bool);\n extern void collect_ada_nodes (tree, const char *);\n extern void collect_source_ref (const char *);\n extern void dump_ada_specs (void (*)(const char *),"}, {"sha": "86b6c9fc6ab3cf5efd0e2a695ac6b2e816e3059b", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -1,3 +1,11 @@\n+2019-12-20  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* c-decl.c (collect_source_ref_cb): Delete.\n+\t(for_each_global_decl): Rename into...\n+\t(collect_source_refs): ...this.  Call collect_source_ref directly.\n+\t(c_parse_final_cleanups): Always call collect_source_ref on the main\n+\tinput filename.\n+\n 2019-12-19  Julian Brown  <julian@codesourcery.com>\n \t    Cesar Philippidis  <cesar@codesourcery.com>\n "}, {"sha": "01f85e2feba4c917e7510dc9b662808150837583", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 9, "deletions": 17, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -11787,15 +11787,6 @@ c_write_global_declarations_1 (tree globals)\n   while (reconsider);\n }\n \n-/* Callback to collect a source_ref from a DECL.  */\n-\n-static void\n-collect_source_ref_cb (tree decl)\n-{\n-  if (!DECL_IS_BUILTIN (decl))\n-    collect_source_ref (LOCATION_FILE (decl_sloc (decl, false)));\n-}\n-\n /* Preserve the external declarations scope across a garbage collect.  */\n static GTY(()) tree ext_block;\n \n@@ -11813,10 +11804,10 @@ collect_all_refs (const char *source_file)\n   collect_ada_nodes (BLOCK_VARS (ext_block), source_file);\n }\n \n-/* Iterate over all global declarations and call CALLBACK.  */\n+/* Collect source file references at global level.  */\n \n static void\n-for_each_global_decl (void (*callback) (tree decl))\n+collect_source_refs (void)\n {\n   tree t;\n   tree decls;\n@@ -11827,11 +11818,13 @@ for_each_global_decl (void (*callback) (tree decl))\n     { \n       decls = DECL_INITIAL (t);\n       for (decl = BLOCK_VARS (decls); decl; decl = TREE_CHAIN (decl))\n-\tcallback (decl);\n+\tif (!DECL_IS_BUILTIN (decl))\n+\t  collect_source_ref (DECL_SOURCE_FILE (decl));\n     }\n \n   for (decl = BLOCK_VARS (ext_block); decl; decl = TREE_CHAIN (decl))\n-    callback (decl);\n+    if (!DECL_IS_BUILTIN (decl))\n+      collect_source_ref (DECL_SOURCE_FILE (decl));\n }\n \n /* Perform any final parser cleanups and generate initial debugging\n@@ -11865,10 +11858,9 @@ c_parse_final_cleanups (void)\n   if (flag_dump_ada_spec || flag_dump_ada_spec_slim)\n     {\n       /* Build a table of files to generate specs for */\n-      if (flag_dump_ada_spec_slim)\n-\tcollect_source_ref (main_input_filename);\n-      else\n-\tfor_each_global_decl (collect_source_ref_cb);\n+      collect_source_ref (main_input_filename);\n+      if (!flag_dump_ada_spec_slim)\n+\tcollect_source_refs ();\n \n       dump_ada_specs (collect_all_refs, NULL);\n     }"}, {"sha": "37353e91b036880f47f53ab60909d6d061d795fe", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -1,3 +1,8 @@\n+2019-12-20  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* decl2.c (c_parse_final_cleanups): Always call collect_source_ref on\n+\tthe main input filename.\n+\n 2019-12-19  Julian Brown  <julian@codesourcery.com>\n \t    Cesar Philippidis  <cesar@codesourcery.com>\n "}, {"sha": "6ff81136c5817bc481e66e03d20f2b313d8e4d93", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39292e25076e1048b2aaa89ac60c28f3f61a78a0/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=39292e25076e1048b2aaa89ac60c28f3f61a78a0", "patch": "@@ -4816,9 +4816,8 @@ c_parse_final_cleanups (void)\n   /* Handle -fdump-ada-spec[-slim] */\n   if (flag_dump_ada_spec || flag_dump_ada_spec_slim)\n     {\n-      if (flag_dump_ada_spec_slim)\n-\tcollect_source_ref (main_input_filename);\n-      else\n+      collect_source_ref (main_input_filename);\n+      if (!flag_dump_ada_spec_slim)\n \tcollect_source_refs (global_namespace);\n \n       dump_ada_specs (collect_all_refs, cpp_check);"}]}