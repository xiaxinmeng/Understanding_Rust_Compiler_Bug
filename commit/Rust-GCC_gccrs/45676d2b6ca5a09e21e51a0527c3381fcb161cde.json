{"sha": "45676d2b6ca5a09e21e51a0527c3381fcb161cde", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDU2NzZkMmI2Y2E1YTA5ZTIxZTUxYTA1MjdjMzM4MWZjYjE2MWNkZQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2005-03-18T14:57:10Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2005-03-18T14:57:10Z"}, "message": "re PR middle-end/20225 (ICE during GC)\n\n\tPR middle-end/20225\n\t* cgraph.c (cgraph_mark_reachable_node): Assert that it is not called\n\ttoo late.\n\t* varasm.c (find_decl_and_mark_needed): Mark needed only when not\n\tcalled too late.\n\nFrom-SVN: r96685", "tree": {"sha": "437a96bf5c4ffbdcea6395eb75991df4b2b70ed1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/437a96bf5c4ffbdcea6395eb75991df4b2b70ed1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/45676d2b6ca5a09e21e51a0527c3381fcb161cde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45676d2b6ca5a09e21e51a0527c3381fcb161cde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45676d2b6ca5a09e21e51a0527c3381fcb161cde", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45676d2b6ca5a09e21e51a0527c3381fcb161cde/comments", "author": null, "committer": null, "parents": [{"sha": "625da0db0f79c2d754857d772bb59aba0a3ea1cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/625da0db0f79c2d754857d772bb59aba0a3ea1cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/625da0db0f79c2d754857d772bb59aba0a3ea1cb"}], "stats": {"total": 34, "additions": 24, "deletions": 10}, "files": [{"sha": "acc6a1338571fa3af9c29c578f167c70b3f17e58", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45676d2b6ca5a09e21e51a0527c3381fcb161cde/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45676d2b6ca5a09e21e51a0527c3381fcb161cde/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=45676d2b6ca5a09e21e51a0527c3381fcb161cde", "patch": "@@ -1,3 +1,11 @@\n+2005-03-18  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR middle-end/20225\n+\t* cgraph.c (cgraph_mark_reachable_node): Assert that it is not called\n+\ttoo late.\n+\t* varasm.c (find_decl_and_mark_needed): Mark needed only when not\n+\tcalled too late.\n+\n 2005-03-18  Kazu Hirata  <kazu@cs.umass.edu>\n \n \t* tree-into-ssa.c (find_idf): Use VEC_quick_push instead of"}, {"sha": "c7475c18eb3693a4b39c92d13bf4c869028122a9", "filename": "gcc/cgraph.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45676d2b6ca5a09e21e51a0527c3381fcb161cde/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45676d2b6ca5a09e21e51a0527c3381fcb161cde/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=45676d2b6ca5a09e21e51a0527c3381fcb161cde", "patch": "@@ -469,6 +469,7 @@ cgraph_mark_reachable_node (struct cgraph_node *node)\n     {\n       notice_global_symbol (node->decl);\n       node->reachable = 1;\n+      gcc_assert (!cgraph_global_info_ready);\n \n       node->next_needed = cgraph_nodes_queue;\n       cgraph_nodes_queue = node;"}, {"sha": "5392dae3a5eb6e308f01e71e38b9172e900aa83e", "filename": "gcc/varasm.c", "status": "modified", "additions": 15, "deletions": 10, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45676d2b6ca5a09e21e51a0527c3381fcb161cde/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45676d2b6ca5a09e21e51a0527c3381fcb161cde/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=45676d2b6ca5a09e21e51a0527c3381fcb161cde", "patch": "@@ -4360,17 +4360,22 @@ find_decl_and_mark_needed (tree decl, tree target)\n   struct cgraph_node *fnode = NULL;\n   struct cgraph_varpool_node *vnode = NULL;\n \n-  if (TREE_CODE (decl) == FUNCTION_DECL)\n+  /* C++ thunk emitting code produces aliases late in the game.\n+     Avoid confusing cgraph code in that case.  */\n+  if (!cgraph_global_info_ready)\n     {\n-      fnode = cgraph_node_for_asm (target);\n-      if (fnode == NULL)\n-\tvnode = cgraph_varpool_node_for_asm (target);\n-    }\n-  else\n-    {\n-      vnode = cgraph_varpool_node_for_asm (target);\n-      if (vnode == NULL)\n-\tfnode = cgraph_node_for_asm (target);\n+      if (TREE_CODE (decl) == FUNCTION_DECL)\n+\t{\n+\t  fnode = cgraph_node_for_asm (target);\n+\t  if (fnode == NULL)\n+\t    vnode = cgraph_varpool_node_for_asm (target);\n+\t}\n+      else\n+\t{\n+\t  vnode = cgraph_varpool_node_for_asm (target);\n+\t  if (vnode == NULL)\n+\t    fnode = cgraph_node_for_asm (target);\n+\t}\n     }\n \n   if (fnode)"}]}