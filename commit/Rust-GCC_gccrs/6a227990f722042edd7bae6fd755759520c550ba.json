{"sha": "6a227990f722042edd7bae6fd755759520c550ba", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmEyMjc5OTBmNzIyMDQyZWRkN2JhZTZmZDc1NTc1OTUyMGM1NTBiYQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2010-11-24T16:42:06Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2010-11-24T16:42:06Z"}, "message": "re PR fortran/46638 (Wrong result with TRANSFER from string to DT)\n\n2010-11-24  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/46638\n        * target-memory.c (gfc_interpret_derived): Correctly handle\n        component offset.\n\n2010-11-24  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/46638\n        * gfortran.dg/transfer_simplify_10.f90: New.\n\nFrom-SVN: r167119", "tree": {"sha": "acd5f12f3e0bb7e8341b72081fd0e90b7d634044", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/acd5f12f3e0bb7e8341b72081fd0e90b7d634044"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6a227990f722042edd7bae6fd755759520c550ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a227990f722042edd7bae6fd755759520c550ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a227990f722042edd7bae6fd755759520c550ba", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a227990f722042edd7bae6fd755759520c550ba/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "094a14eff78e4f2a4830b80416642dd247e6ad8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/094a14eff78e4f2a4830b80416642dd247e6ad8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/094a14eff78e4f2a4830b80416642dd247e6ad8e"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "adf75f885a1b27203c1c1348e69282238aa8dd6d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=6a227990f722042edd7bae6fd755759520c550ba", "patch": "@@ -1,3 +1,9 @@\n+2010-11-24  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/46638\n+\t* target-memory.c (gfc_interpret_derived): Correctly handle\n+\tcomponent offset.\n+\n 2010-11-23  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/46545"}, {"sha": "01383c7758840c4a050d70e6d75e9515d06668b4", "filename": "gcc/fortran/target-memory.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ffortran%2Ftarget-memory.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ffortran%2Ftarget-memory.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftarget-memory.c?ref=6a227990f722042edd7bae6fd755759520c550ba", "patch": "@@ -477,7 +477,16 @@ gfc_interpret_derived (unsigned char *buffer, size_t buffer_size, gfc_expr *resu\n       /* The constructor points to the component.  */\n       c->n.component = cmp;\n \n-      ptr = TREE_INT_CST_LOW (DECL_FIELD_OFFSET (cmp->backend_decl));\n+      /* Calculate the offset, which consists of the the FIELD_OFFSET in\n+\t bytes, which appears in multiples of DECL_OFFSET_ALIGN-bit-sized,\n+\t and additional bits of FIELD_BIT_OFFSET. The code assumes that all\n+\t sizes of the components are multiples of BITS_PER_UNIT,\n+\t i.e. there are, e.g., no bit fields.  */\n+\n+      ptr = TREE_INT_CST_LOW (DECL_FIELD_BIT_OFFSET (cmp->backend_decl));\n+      gcc_assert (ptr % 8 == 0);\n+      ptr = ptr/8 + TREE_INT_CST_LOW (DECL_FIELD_OFFSET (cmp->backend_decl));\n+\n       gfc_target_interpret_expr (&buffer[ptr], buffer_size - ptr, e);\n     }\n     "}, {"sha": "b4fe8baf130d3abec5b9028867772a3187651052", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6a227990f722042edd7bae6fd755759520c550ba", "patch": "@@ -1,3 +1,8 @@\n+2010-11-24  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/46638\n+\t* gfortran.dg/transfer_simplify_10.f90: New.\n+\n 2010-11-24  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/46629"}, {"sha": "d0c83b5ca129c89ec1c06641019410f03756c0fe", "filename": "gcc/testsuite/gfortran.dg/transfer_simplify_10.f90", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_simplify_10.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a227990f722042edd7bae6fd755759520c550ba/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_simplify_10.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_simplify_10.f90?ref=6a227990f722042edd7bae6fd755759520c550ba", "patch": "@@ -0,0 +1,28 @@\n+! { dg-do run }\n+!\n+! PR fortran/46638\n+!\n+! Contributed by James Van Buskirk\n+!\n+program test5\n+   use ISO_C_BINDING\n+   implicit none\n+   type, bind(C) :: CPUID_type\n+      integer(C_INT32_T) eax\n+      integer(C_INT32_T) ebx\n+      integer(C_INT32_T) edx\n+      integer(C_INT32_T) ecx\n+      integer(C_INT32_T) bbb\n+   end type CPUID_type\n+   type(CPUID_TYPE) result\n+  result = transfer(achar(10)//achar(0)//achar(0)//achar(0)//'GenuineIntel'//'abcd',result)\n+\n+  if (     int(z'0000000A') /= result%eax  &\n+      .or. int(z'756E6547') /= result%ebx  &\n+      .or. int(z'49656E69') /= result%edx  &\n+      .or. int(z'6C65746E') /= result%ecx  &\n+      .or. int(z'64636261') /= result%bbb) then\n+    write(*,'(5(z8.8:1x))') result\n+    call abort()\n+  end if\n+end program test5 "}]}