{"sha": "434fe1a4092e12e5b518ef0716dc5b315e06118d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDM0ZmUxYTQwOTJlMTJlNWI1MThlZjA3MTZkYzViMzE1ZTA2MTE4ZA==", "commit": {"author": {"name": "Stefan Liebler", "email": "stli@linux.ibm.com", "date": "2020-04-07T14:14:40Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@linux.ibm.com", "date": "2020-04-07T14:15:28Z"}, "message": "S/390: Fix layout of struct sigaction_t\n\nThe ordering of some fields in  struct sigaction on s390x (64bit)\ndiffers compared to s390 and other architectures.\nThis patch adjusts this order according to the definition of\n<glibc-src>/sysdeps/unix/sysv/linux/s390/bits/sigaction.h\n\nWithout this fix e.g. the call\nsigaction( suspendSignalNumber, &sigusr1, null ) in thread.d\nleads to setting the sa_restorer field to 0xffffffffffffffff.\nIn case a signal, the signal handler returns to this address\nand the process stops with a SIGILL.\n\nThis was observable in several execution testcases on s390x:\nlibphobos.druntime/core/thread.d\nlibphobos.druntime_shared/core/thread.d\nlibphobos.thread/tlsgc_sections.d\nlibphobos.allocations/tls_gc_integration.d\nlibphobos.phobos/std/parallelism.d\nlibphobos.phobos_shared/std/parallelism.d\nlibphobos.shared/host.c\nlibphobos.shared/linkD.c\nlibphobos.shared/linkDR.c\nlibphobos.shared/link_linkdep.d\nlibphobos.shared/load.d\nlibphobos.shared/loadDR.c\nlibphobos.shared/load_linkdep.d\nlibphobos.shared/load_loaddep.d\n\nlibphobos/ChangeLog:\n\n2020-04-07  Stefan Liebler  <stli@linux.ibm.com>\n\n\t* libdruntime/core/sys/posix/signal.d:\n\tAdd struct sigaction_t for SystemZ.", "tree": {"sha": "addde037c62ab6a59337afb4e75f5537c6deb7d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/addde037c62ab6a59337afb4e75f5537c6deb7d2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/434fe1a4092e12e5b518ef0716dc5b315e06118d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/434fe1a4092e12e5b518ef0716dc5b315e06118d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/434fe1a4092e12e5b518ef0716dc5b315e06118d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/434fe1a4092e12e5b518ef0716dc5b315e06118d/comments", "author": {"login": "stliibm", "id": 17591893, "node_id": "MDQ6VXNlcjE3NTkxODkz", "avatar_url": "https://avatars.githubusercontent.com/u/17591893?v=4", "gravatar_id": "", "url": "https://api.github.com/users/stliibm", "html_url": "https://github.com/stliibm", "followers_url": "https://api.github.com/users/stliibm/followers", "following_url": "https://api.github.com/users/stliibm/following{/other_user}", "gists_url": "https://api.github.com/users/stliibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/stliibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/stliibm/subscriptions", "organizations_url": "https://api.github.com/users/stliibm/orgs", "repos_url": "https://api.github.com/users/stliibm/repos", "events_url": "https://api.github.com/users/stliibm/events{/privacy}", "received_events_url": "https://api.github.com/users/stliibm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Andreas-Krebbel", "id": 38103320, "node_id": "MDQ6VXNlcjM4MTAzMzIw", "avatar_url": "https://avatars.githubusercontent.com/u/38103320?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Andreas-Krebbel", "html_url": "https://github.com/Andreas-Krebbel", "followers_url": "https://api.github.com/users/Andreas-Krebbel/followers", "following_url": "https://api.github.com/users/Andreas-Krebbel/following{/other_user}", "gists_url": "https://api.github.com/users/Andreas-Krebbel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Andreas-Krebbel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Andreas-Krebbel/subscriptions", "organizations_url": "https://api.github.com/users/Andreas-Krebbel/orgs", "repos_url": "https://api.github.com/users/Andreas-Krebbel/repos", "events_url": "https://api.github.com/users/Andreas-Krebbel/events{/privacy}", "received_events_url": "https://api.github.com/users/Andreas-Krebbel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "23f1f679141bbb4720ca195cb758605dc017b7fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23f1f679141bbb4720ca195cb758605dc017b7fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23f1f679141bbb4720ca195cb758605dc017b7fd"}], "stats": {"total": 52, "additions": 42, "deletions": 10}, "files": [{"sha": "3791d4a5ef65066199307c773ce274e05813d4a9", "filename": "libphobos/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/434fe1a4092e12e5b518ef0716dc5b315e06118d/libphobos%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/434fe1a4092e12e5b518ef0716dc5b315e06118d/libphobos%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2FChangeLog?ref=434fe1a4092e12e5b518ef0716dc5b315e06118d", "patch": "@@ -1,3 +1,8 @@\n+2020-04-07  Stefan Liebler  <stli@linux.ibm.com>\n+\n+\t* libdruntime/core/sys/posix/signal.d:\n+\tAdd struct sigaction_t for SystemZ.\n+\n 2020-03-16  Iain Buclaw  <ibuclaw@gdcproject.org>\n \n \tPR d/92792"}, {"sha": "5abcdac13554b6ad4b6b3c5edc4ab889e1329daa", "filename": "libphobos/libdruntime/core/sys/posix/signal.d", "status": "modified", "additions": 37, "deletions": 10, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/434fe1a4092e12e5b518ef0716dc5b315e06118d/libphobos%2Flibdruntime%2Fcore%2Fsys%2Fposix%2Fsignal.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/434fe1a4092e12e5b518ef0716dc5b315e06118d/libphobos%2Flibdruntime%2Fcore%2Fsys%2Fposix%2Fsignal.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2Fcore%2Fsys%2Fposix%2Fsignal.d?ref=434fe1a4092e12e5b518ef0716dc5b315e06118d", "patch": "@@ -575,24 +575,51 @@ else\n \n version (CRuntime_Glibc)\n {\n-    struct sigaction_t\n+    version (SystemZ)\n     {\n-        static if ( true /* __USE_POSIX199309 */ )\n+        struct sigaction_t\n         {\n-            union\n+            static if ( true /* __USE_POSIX199309 */ )\n+            {\n+                union\n+                {\n+                    sigfn_t     sa_handler;\n+                    sigactfn_t  sa_sigaction;\n+                }\n+            }\n+            else\n             {\n                 sigfn_t     sa_handler;\n-                sigactfn_t  sa_sigaction;\n             }\n+            int             __glibc_reserved0;\n+            int             sa_flags;\n+\n+            void function() sa_restorer;\n+\n+            sigset_t        sa_mask;\n         }\n-        else\n+    }\n+    else\n+    {\n+        struct sigaction_t\n         {\n-            sigfn_t     sa_handler;\n-        }\n-        sigset_t        sa_mask;\n-        int             sa_flags;\n+            static if ( true /* __USE_POSIX199309 */ )\n+            {\n+                union\n+                {\n+                    sigfn_t     sa_handler;\n+                    sigactfn_t  sa_sigaction;\n+                }\n+            }\n+            else\n+            {\n+                sigfn_t     sa_handler;\n+            }\n+            sigset_t        sa_mask;\n+            int             sa_flags;\n \n-        void function() sa_restorer;\n+            void function() sa_restorer;\n+        }\n     }\n }\n else version (CRuntime_Musl)"}]}