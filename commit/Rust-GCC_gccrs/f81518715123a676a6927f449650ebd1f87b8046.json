{"sha": "f81518715123a676a6927f449650ebd1f87b8046", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjgxNTE4NzE1MTIzYTY3NmE2OTI3ZjQ0OTY1MGViZDFmODdiODA0Ng==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-02-20T21:50:13Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-02-20T21:50:13Z"}, "message": "(mips_move_2words): Check for TARGET_FLOAT64 != TARGET_64BIT.\n\n(override_options): Don't override MASK_64BIT; don't allow -gp64\nwithout -mips3.\n\nFrom-SVN: r6597", "tree": {"sha": "e41b1187731ab3a330c1c119faad3faf54a07fb1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e41b1187731ab3a330c1c119faad3faf54a07fb1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f81518715123a676a6927f449650ebd1f87b8046", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f81518715123a676a6927f449650ebd1f87b8046", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f81518715123a676a6927f449650ebd1f87b8046", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f81518715123a676a6927f449650ebd1f87b8046/comments", "author": null, "committer": null, "parents": [{"sha": "2370b831da45660213c12b3627b450d822ac0e00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2370b831da45660213c12b3627b450d822ac0e00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2370b831da45660213c12b3627b450d822ac0e00"}], "stats": {"total": 35, "additions": 27, "deletions": 8}, "files": [{"sha": "9e0f3e17068bf3f4e5c230d88c8e4828db6c2bef", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 27, "deletions": 8, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f81518715123a676a6927f449650ebd1f87b8046/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f81518715123a676a6927f449650ebd1f87b8046/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=f81518715123a676a6927f449650ebd1f87b8046", "patch": "@@ -1310,8 +1310,10 @@ mips_move_2words (operands, insn)\n \t      else\n \t\t{\n \t\t  delay = DELAY_LOAD;\n-\t\t  if (TARGET_64BIT)\n+\t\t  if (TARGET_FLOAT64)\n \t\t    {\n+\t\t      if (!TARGET_64BIT)\n+\t\t\tabort_with_insn (insn, \"Bad move\");\n #ifdef TARGET_FP_CALL_32\n \t\t      if (FP_CALL_GP_REG_P (regno1))\n \t\t\tret = \"dsll\\t%1,32\\n\\tor\\t%1,%D1\\n\\tdmtc1\\t%1,%0\";\n@@ -1327,8 +1329,10 @@ mips_move_2words (operands, insn)\n \t  else if (FP_REG_P (regno1))\n \t    {\n \t      delay = DELAY_LOAD;\n-\t      if (TARGET_64BIT)\n+\t      if (TARGET_FLOAT64)\n \t\t{\n+\t\t  if (!TARGET_64BIT)\n+\t\t    abort_with_insn (insn, \"Bad move\");\n #ifdef TARGET_FP_CALL_32\n \t\t  if (FP_CALL_GP_REG_P (regno0))\n \t\t    ret = \"dmfc1\\t%0,%1\\n\\tmfc1\\t%D0,%1\\n\\tdsrl\\t%0,32\";\n@@ -1370,20 +1374,32 @@ mips_move_2words (operands, insn)\n \n       else if (code1 == CONST_DOUBLE)\n \t{\n-\t  if (op1 != CONST0_RTX (GET_MODE (op1)))\n+\t  /* Move zero from $0 unless !TARGET_64BIT and recipient\n+\t     is 64-bit fp reg, in which case generate a constant.  */\n+\t  if (op1 != CONST0_RTX (GET_MODE (op1))\n+\t      || (TARGET_FLOAT64 && !TARGET_64BIT && FP_REG_P (regno0)))\n \t    {\n \t      if (GET_MODE (op1) == DFmode)\n \t\t{\n \t\t  delay = DELAY_LOAD;\n #ifdef TARGET_FP_CALL_32\n \t\t  if (FP_CALL_GP_REG_P (regno0))\n-\t\t    ret = \"li.d\\t%0,%1\\n\\tdsll\\t%D0,%0,32\\n\\tdsrl\\t%D0,32\\n\\tdsrl\\t%0,32\";\n+\t\t    {\n+\t\t      if (TARGET_FLOAT64 && !TARGET_64BIT)\n+\t\t\t{\n+\t\t\t  operands[2] = GEN_INT (CONST_DOUBLE_LOW (op1));\n+\t\t\t  operands[3] = GEN_INT (CONST_DOUBLE_HIGH (op1));\n+\t\t\t  ret = \"li\\t%M0,%3\\n\\tli\\t%L0,%2\";\n+\t\t\t}\n+\t\t      else\n+\t\t\tret = \"li.d\\t%0,%1\\n\\tdsll\\t%D0,%0,32\\n\\tdsrl\\t%D0,32\\n\\tdsrl\\t%0,32\";\n+\t\t    }\n \t\t  else\n #endif\n \t\t    ret = \"li.d\\t%0,%1\";\n \t\t}\n \n-\t      else if (TARGET_64BIT)\n+\t      else if (TARGET_FLOAT64)\n \t\tret = \"li\\t%0,%1\";\n \n \t      else\n@@ -1427,7 +1443,9 @@ mips_move_2words (operands, insn)\n \t      delay = DELAY_LOAD;\n \t      ret = (TARGET_64BIT)\n \t\t\t\t? \"dmtc1\\t%.,%0\"\n-\t\t\t\t: \"mtc1\\t%.,%0\\n\\tmtc1\\t%.,%D0\";\n+\t\t\t\t: (TARGET_FLOAT64\n+\t\t\t\t   ? \"li.d\\t%0,%1\"\n+\t\t\t\t   : \"mtc1\\t%.,%0\\n\\tmtc1\\t%.,%D0\");\n \t    }\n \t}\n \t\n@@ -3213,11 +3231,12 @@ override_options ()\n \n       else if (TARGET_FLOAT64)\n \tfatal (\"Only MIPS-III CPUs can support 64 bit fp registers\");\n+\n+      else if (TARGET_64BIT)\n+\tfatal (\"Only MIPS-III CPUs can support 64 bit gp registers\");\n     }\n   else\n     {\n-      target_flags |= MASK_64BIT;\n-\n       if (TARGET_LLONG128)\n \tfatal (\"128 bit long longs are not supported\");\n     }"}]}