{"sha": "9cc29fc6f4116e86c5b09ce2915673caec1029b8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNjMjlmYzZmNDExNmU4NmM1YjA5Y2UyOTE1NjczY2FlYzEwMjliOA==", "commit": {"author": {"name": "Thomas Quinot", "email": "quinot@act-europe.fr", "date": "2004-10-27T13:03:38Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2004-10-27T13:03:38Z"}, "message": "g-os_lib.ads, [...] (Set_Executable, [...]): New subprograms.\n\n2004-10-26  Thomas Quinot  <quinot@act-europe.fr>\n\n\t* g-os_lib.ads, g-os_lib.adb (Set_Executable, Set_Writable,\n\tSet_Read_Only): New subprograms.\n\tThese new routines allow the user to set or unset the Owner execute\n\tand Owner write permission flags on a file.\n\n\t* makegpr.adb, mlib.adb, mlib-prj.adb: Use\n\tGNAT.OS_Lib.Set_Executable instead of rolling our own.\n\nFrom-SVN: r89654", "tree": {"sha": "644a6bf5583a35d02fb195335ac90e6baa77489b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/644a6bf5583a35d02fb195335ac90e6baa77489b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9cc29fc6f4116e86c5b09ce2915673caec1029b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cc29fc6f4116e86c5b09ce2915673caec1029b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cc29fc6f4116e86c5b09ce2915673caec1029b8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cc29fc6f4116e86c5b09ce2915673caec1029b8/comments", "author": null, "committer": null, "parents": [{"sha": "427024aeb0b494def455696e8c4887810799af6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/427024aeb0b494def455696e8c4887810799af6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/427024aeb0b494def455696e8c4887810799af6b"}], "stats": {"total": 78, "additions": 58, "deletions": 20}, "files": [{"sha": "d0db36ea5ffcc863936d33be0e81ca42a7244f71", "filename": "gcc/ada/g-os_lib.adb", "status": "modified", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fg-os_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fg-os_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-os_lib.adb?ref=9cc29fc6f4116e86c5b09ce2915673caec1029b8", "patch": "@@ -2056,6 +2056,48 @@ package body GNAT.OS_Lib is\n       Rename_File (C_Old_Name'Address, C_New_Name'Address, Success);\n    end Rename_File;\n \n+   --------------------\n+   -- Set_Executable --\n+   --------------------\n+\n+   procedure Set_Executable (Name : String) is\n+      procedure C_Set_Executable (Name : C_File_Name);\n+      pragma Import (C, C_Set_Executable, \"__gnat_set_executable\");\n+      C_Name : aliased String (Name'First .. Name'Last + 1);\n+   begin\n+      C_Name (Name'Range)  := Name;\n+      C_Name (C_Name'Last) := ASCII.NUL;\n+      C_Set_Executable (C_Name (C_Name'First)'Address);\n+   end Set_Executable;\n+\n+   --------------------\n+   -- Set_Read_Only --\n+   --------------------\n+\n+   procedure Set_Read_Only (Name : String) is\n+      procedure C_Set_Read_Only (Name : C_File_Name);\n+      pragma Import (C, C_Set_Read_Only, \"__gnat_set_readonly\");\n+      C_Name : aliased String (Name'First .. Name'Last + 1);\n+   begin\n+      C_Name (Name'Range)  := Name;\n+      C_Name (C_Name'Last) := ASCII.NUL;\n+      C_Set_Read_Only (C_Name (C_Name'First)'Address);\n+   end Set_Read_Only;\n+\n+   --------------------\n+   -- Set_Writable --\n+   --------------------\n+\n+   procedure Set_Writable (Name : String) is\n+      procedure C_Set_Writable (Name : C_File_Name);\n+      pragma Import (C, C_Set_Writable, \"__gnat_set_writable\");\n+      C_Name : aliased String (Name'First .. Name'Last + 1);\n+   begin\n+      C_Name (Name'Range)  := Name;\n+      C_Name (C_Name'Last) := ASCII.NUL;\n+      C_Set_Writable (C_Name (C_Name'First)'Address);\n+   end Set_Writable;\n+\n    ------------\n    -- Setenv --\n    ------------"}, {"sha": "2db605b34cbf49f73ee5f86ce3aedabe3c3ed243", "filename": "gcc/ada/g-os_lib.ads", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fg-os_lib.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fg-os_lib.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-os_lib.ads?ref=9cc29fc6f4116e86c5b09ce2915673caec1029b8", "patch": "@@ -470,6 +470,18 @@ pragma Elaborate_Body (OS_Lib);\n    --  contains the name of the file to which it is linked. Symbolic links may\n    --  span file systems and may refer to directories.\n \n+   procedure Set_Writable (Name : String);\n+   --  Change the permissions on the named file to make it writable\n+   --  for its owner.\n+\n+   procedure Set_Read_Only (Name : String);\n+   --  Change the permissions on the named file to make it non-writable\n+   --  for its owner.\n+\n+   procedure Set_Executable (Name : String);\n+   --  Change the permissions on the named file to make it executable\n+   --  for its owner.\n+\n    function Locate_Exec_On_Path\n      (Exec_Name : String) return String_Access;\n    --  Try to locate an executable whose name is given by Exec_Name in the\n@@ -562,9 +574,7 @@ pragma Elaborate_Body (OS_Lib);\n    --  Returns Invalid_Time is Name doesn't correspond to an existing file.\n \n    function Is_Regular_File (Name : C_File_Name) return Boolean;\n-\n    function Is_Directory (Name : C_File_Name) return Boolean;\n-\n    function Is_Readable_File (Name : C_File_Name) return Boolean;\n    function Is_Writable_File (Name : C_File_Name) return Boolean;\n    function Is_Symbolic_Link (Name : C_File_Name) return Boolean;"}, {"sha": "8faf04dd7b70d905d0aa935262db8defb8950987", "filename": "gcc/ada/makegpr.adb", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fmakegpr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fmakegpr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakegpr.adb?ref=9cc29fc6f4116e86c5b09ce2915673caec1029b8", "patch": "@@ -3315,12 +3315,6 @@ package body Makegpr is\n             Change_Dir (Object_Dir);\n \n             declare\n-               procedure Set_Executable (Name : System.Address);\n-               pragma Import\n-                 (C, Set_Executable, \"__gnat_set_executable\");\n-\n-               Name : constant String := Cpp_Linker & ASCII.NUL;\n-\n                File : Ada.Text_IO.File_Type;\n                use Ada.Text_IO;\n \n@@ -3336,7 +3330,7 @@ package body Makegpr is\n                   \" $* ${LIBGCC}\");\n \n                Close (File);\n-               Set_Executable (Name (Name'First)'Address);\n+               Set_Executable (Cpp_Linker);\n             end;\n          end if;\n       end Choose_C_Plus_Plus_Link_Process;"}, {"sha": "0af9b8f3205b29adcd481c52bd9d83f4684b0c4c", "filename": "gcc/ada/mlib-prj.adb", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fmlib-prj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fmlib-prj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-prj.adb?ref=9cc29fc6f4116e86c5b09ce2915673caec1029b8", "patch": "@@ -1638,9 +1638,6 @@ package body MLib.Prj is\n \n       Disregard : Boolean;\n \n-      procedure Set_Writable (Name : System.Address);\n-      pragma Import (C, Set_Writable, \"__gnat_set_writable\");\n-\n    begin\n       Get_Name_String (Directory);\n \n@@ -1667,8 +1664,7 @@ package body MLib.Prj is\n          exit when Last = 0;\n \n          if Is_Regular_File (Name (1 .. Last)) then\n-            Name (Last + 1) := ASCII.NUL;\n-            Set_Writable (Name (1)'Address);\n+            Set_Writable (Name (1 .. Last));\n             Delete_File (Name (1 .. Last), Disregard);\n          end if;\n       end loop;"}, {"sha": "df8796f30cd57c6e9b9525e25b74a4bcc320ad9a", "filename": "gcc/ada/mlib.adb", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fmlib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc29fc6f4116e86c5b09ce2915673caec1029b8/gcc%2Fada%2Fmlib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib.adb?ref=9cc29fc6f4116e86c5b09ce2915673caec1029b8", "patch": "@@ -37,8 +37,6 @@ with MLib.Utl; use MLib.Utl;\n with GNAT.Directory_Operations; use GNAT.Directory_Operations;\n with GNAT.OS_Lib;               use GNAT.OS_Lib;\n \n-with System;\n-\n package body MLib is\n \n    -------------------\n@@ -107,9 +105,6 @@ package body MLib is\n       To_Dir    : constant String := Get_Name_String (To);\n       Interface : Boolean := False;\n \n-      procedure Set_Readonly (Name : System.Address);\n-      pragma Import (C, Set_Readonly, \"__gnat_set_readonly\");\n-\n       procedure Verbose_Copy (Index : Positive);\n       --  In verbose mode, output a message that the indexed file is copied\n       --  to the destination directory.\n@@ -264,7 +259,8 @@ package body MLib is\n                               Success := Status and Actual_Len = Len + 3;\n \n                               if Success then\n-                                 Set_Readonly (Name_Buffer'Address);\n+                                 Set_Read_Only (\n+                                   Name_Buffer (1 .. Name_Len - 1));\n                               end if;\n                            end if;\n                         end if;"}]}