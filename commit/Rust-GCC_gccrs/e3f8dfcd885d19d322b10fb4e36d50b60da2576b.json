{"sha": "e3f8dfcd885d19d322b10fb4e36d50b60da2576b", "node_id": "C_kwDOANBUbNoAKGUzZjhkZmNkODg1ZDE5ZDMyMmIxMGZiNGUzNmQ1MGI2MGRhMjU3NmI", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-02-22T09:25:04Z"}, "committer": {"name": "Jonathan Yong", "email": "10walls@gmail.com", "date": "2023-03-10T10:17:57Z"}, "message": "cygwin: Don't try to support multilibs [PR107998]\n\nAs discussed in the PR, t-cygwin-w64 file has been introduced in 2013\nand has one important problem, two different multilib options -m64 and -m32,\nbut MULTILIB_DIRNAMES with just one word in it.\nBefore the genmultilib sanity checking was added, my understanding is that\nthis essentially resulted in effective --disable-multilib,\n$ gcc -print-multi-lib\n.;\n;@m32\n$ gcc -print-multi-directory\n.\n$ gcc -print-multi-directory -m64\n.\n$ gcc -print-multi-directory -m32\n\n$ gcc -print-multi-os-directory\n../lib\n$ gcc -print-multi-os-directory -m64\n../lib\n$ gcc -print-multi-os-directory -m32\n../lib32\nand because of the way e.g. config-ml.in operates\nmultidirs=\nfor i in `${CC-gcc} --print-multi-lib 2>/dev/null`; do\n  dir=`echo $i | sed -e 's/;.*$//'`\n  if [ \"${dir}\" = \".\" ]; then\n    true\n  else\n    if [ -z \"${multidirs}\" ]; then\n      multidirs=\"${dir}\"\n    else\n      multidirs=\"${multidirs} ${dir}\"\n    fi\n  fi\ndone\ndir was . first time (and so nothing was done) and empty\nsecond time, multidirs empty too, so multidirs was set to empty\nlike it would be with --disable-multilib.\n\nWith the added sanity checking the build fails unless --disable-multilib\nis used in configure (dunno whether people usually configure that way\non cygwin).\n\n>From what has been said in the PR, multilibs were not meant to be supported\nand e.g. cygwin headers probably aren't ready for it.\n\nSo the following patch just removes the file with the (incorrect) multilib\nstuff instead of fixing it (say by setting MULTILIB_DIRNAMES to 64 32).\n\nI have no way to test this though, no Windows around, can anyone please\ntest this?  I just would like to get some progress on the P1s we have...\n\n2023-02-22  Jakub Jelinek  <jakub@redhat.com>\n\ngcc/ChangeLog:\n\n\tPR target/107998\n\t* config.gcc (x86_64-*-cygwin*): Don't add i386/t-cygwin-w64 into\n\t$tmake_file.\n\t* config/i386/t-cygwin-w64: Remove.\n\nSigned-off-by: Jonathan Yong <10walls@gmail.com>", "tree": {"sha": "cc8bf33faf790c66dd0524313126b7610f47c371", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cc8bf33faf790c66dd0524313126b7610f47c371"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3f8dfcd885d19d322b10fb4e36d50b60da2576b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3f8dfcd885d19d322b10fb4e36d50b60da2576b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3f8dfcd885d19d322b10fb4e36d50b60da2576b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3f8dfcd885d19d322b10fb4e36d50b60da2576b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jon-y", "id": 4688224, "node_id": "MDQ6VXNlcjQ2ODgyMjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/4688224?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jon-y", "html_url": "https://github.com/jon-y", "followers_url": "https://api.github.com/users/jon-y/followers", "following_url": "https://api.github.com/users/jon-y/following{/other_user}", "gists_url": "https://api.github.com/users/jon-y/gists{/gist_id}", "starred_url": "https://api.github.com/users/jon-y/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jon-y/subscriptions", "organizations_url": "https://api.github.com/users/jon-y/orgs", "repos_url": "https://api.github.com/users/jon-y/repos", "events_url": "https://api.github.com/users/jon-y/events{/privacy}", "received_events_url": "https://api.github.com/users/jon-y/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c599ae6e081496466cada6f97b0d4687a6d765a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c599ae6e081496466cada6f97b0d4687a6d765a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c599ae6e081496466cada6f97b0d4687a6d765a"}], "stats": {"total": 5, "additions": 1, "deletions": 4}, "files": [{"sha": "f986224817a12888e51be3873b6f230ea900bccb", "filename": "gcc/config.gcc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3f8dfcd885d19d322b10fb4e36d50b60da2576b/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3f8dfcd885d19d322b10fb4e36d50b60da2576b/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=e3f8dfcd885d19d322b10fb4e36d50b60da2576b", "patch": "@@ -2105,7 +2105,7 @@ x86_64-*-cygwin*)\n \tneed_64bit_isa=yes\n \ttm_file=\"${tm_file} i386/unix.h i386/bsd.h i386/gas.h i386/cygming.h i386/cygwin.h i386/cygwin-w64.h i386/cygwin-stdint.h\"\n \txm_file=i386/xm-cygwin.h\n-\ttmake_file=\"${tmake_file} i386/t-cygming t-slibgcc i386/t-cygwin-w64\"\n+\ttmake_file=\"${tmake_file} i386/t-cygming t-slibgcc\"\n \ttarget_gtfiles=\"$target_gtfiles \\$(srcdir)/config/i386/winnt.cc\"\n \textra_options=\"${extra_options} i386/cygming.opt i386/cygwin.opt\"\n \textra_objs=\"${extra_objs} winnt.o winnt-stubs.o\""}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "gcc/config/i386/t-cygwin-w64", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3f8dfcd885d19d322b10fb4e36d50b60da2576b/gcc%2Fconfig%2Fi386%2Ft-cygwin-w64", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3f8dfcd885d19d322b10fb4e36d50b60da2576b/gcc%2Fconfig%2Fi386%2Ft-cygwin-w64", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Ft-cygwin-w64?ref=e3f8dfcd885d19d322b10fb4e36d50b60da2576b", "patch": "@@ -1,3 +0,0 @@\n-MULTILIB_OPTIONS = m64/m32\n-MULTILIB_DIRNAMES = 64\n-MULTILIB_OSDIRNAMES = ../lib ../lib32"}]}