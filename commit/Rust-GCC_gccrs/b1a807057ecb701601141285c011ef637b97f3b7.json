{"sha": "b1a807057ecb701601141285c011ef637b97f3b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjFhODA3MDU3ZWNiNzAxNjAxMTQxMjg1YzAxMWVmNjM3Yjk3ZjNiNw==", "commit": {"author": {"name": "Bud Davis", "email": "bdavis9659@comcast.net", "date": "2005-01-22T03:51:12Z"}, "committer": {"name": "Bud Davis", "email": "bdavis@gcc.gnu.org", "date": "2005-01-22T03:51:12Z"}, "message": "re PR libfortran/19314 (inquire(position=) segfaults at runtime)\n\n2004-01-22  Bud Davis  <bdavis9659@comcast.net>\n\n        PR fortran/19314\n        * io/inquire.c(inquire_via_unit): implement POSITION=.\n        * io/transfer.c(next_record): update position for\n        INQUIRE.\n        * io/rewind.c(st_rewind): update position for\n        INQUIRE.\n\n        * gfortran.dg/inquire_5.f90: New test.\n\nFrom-SVN: r94060", "tree": {"sha": "2558c3d156cfc7fc1cf142d5f1c70137cabcff5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2558c3d156cfc7fc1cf142d5f1c70137cabcff5b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b1a807057ecb701601141285c011ef637b97f3b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1a807057ecb701601141285c011ef637b97f3b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1a807057ecb701601141285c011ef637b97f3b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1a807057ecb701601141285c011ef637b97f3b7/comments", "author": null, "committer": null, "parents": [{"sha": "987732e0c88255f18d408d2ad35eb7bcff865083", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/987732e0c88255f18d408d2ad35eb7bcff865083", "html_url": "https://github.com/Rust-GCC/gccrs/commit/987732e0c88255f18d408d2ad35eb7bcff865083"}], "stats": {"total": 80, "additions": 74, "deletions": 6}, "files": [{"sha": "fb28b4b79034cc67360cad0112c8ab74fc669890", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1a807057ecb701601141285c011ef637b97f3b7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1a807057ecb701601141285c011ef637b97f3b7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b1a807057ecb701601141285c011ef637b97f3b7", "patch": "@@ -1,3 +1,8 @@\n+2005-01-22  Bud Davis  <bdavis9659@comcast.net>\n+\n+\tPR fortran/19314\n+\t* gfortran.dg/inquire_5.f90: New test.\n+\n 2005-01-22  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n \tPR c/18809"}, {"sha": "0daa579d1b678d3a5eedd9ca6d02e70c73a72196", "filename": "gcc/testsuite/gfortran.dg/inquire_5.f90", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1a807057ecb701601141285c011ef637b97f3b7/gcc%2Ftestsuite%2Fgfortran.dg%2Finquire_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1a807057ecb701601141285c011ef637b97f3b7/gcc%2Ftestsuite%2Fgfortran.dg%2Finquire_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finquire_5.f90?ref=b1a807057ecb701601141285c011ef637b97f3b7", "patch": "@@ -0,0 +1,35 @@\n+! { dg-do run }\n+! pr19314 inquire(..position=..) segfaults\n+! test by Thomas.Koenig@online.de\n+!         bdavis9659@comcast.net\n+      implicit none\n+      character*20 chr\n+      open(7,STATUS='SCRATCH')\n+      inquire(7,position=chr)\n+      if (chr.NE.'ASIS') CALL ABORT\n+      close(7)\n+      open(7,STATUS='SCRATCH',ACCESS='DIRECT',RECL=100)\n+      inquire(7,position=chr)\n+      if (chr.NE.'UNDEFINED') CALL ABORT\n+      close(7)\n+      open(7,STATUS='SCRATCH',POSITION='REWIND')\n+      inquire(7,position=chr)\n+      if (chr.NE.'REWIND') CALL ABORT\n+      close(7)\n+      open(7,STATUS='SCRATCH',POSITION='ASIS')\n+      inquire(7,position=chr)\n+      if (chr.NE.'ASIS') CALL ABORT\n+      close(7)\n+      open(7,STATUS='SCRATCH',POSITION='APPEND')\n+      inquire(7,position=chr)\n+      if (chr.NE.'APPEND') CALL ABORT\n+      close(7)\n+      open(7,STATUS='SCRATCH',POSITION='REWIND')\n+      write(7,*)'this is a record written to the file'\n+      inquire(7,position=chr)\n+      if (chr.NE.'ASIS') CALL ABORT\n+      rewind(7)\n+      inquire(7,position=chr)\n+      if (chr.NE.'REWIND') CALL ABORT\n+      close(7)\n+      end"}, {"sha": "9f7e3789cd659faa3b6569850fd64aba001cb49f", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=b1a807057ecb701601141285c011ef637b97f3b7", "patch": "@@ -1,3 +1,12 @@\n+2004-01-22  Bud Davis  <bdavis9659@comcast.net>\n+\n+\tPR fortran/19314\n+\t* io/inquire.c(inquire_via_unit): implement POSITION=.\n+\t* io/transfer.c(next_record): update position for \n+\tINQUIRE.\n+\t* io/rewind.c(st_rewind): update position for\n+\tINQUIRE.\n+\n 2004-01-16  Bud Davis  <bdavis9659@comcast.net>\n \n \tPR fortran/18778"}, {"sha": "20fa8b3dd7bcfc333b59aa021eb53796b7c4a5c7", "filename": "libgfortran/io/inquire.c", "status": "modified", "additions": 20, "deletions": 6, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2Fio%2Finquire.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2Fio%2Finquire.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Finquire.c?ref=b1a807057ecb701601141285c011ef637b97f3b7", "patch": "@@ -166,13 +166,27 @@ inquire_via_unit (gfc_unit * u)\n   if (ioparm.position != NULL)\n     {\n       if (u == NULL || u->flags.access == ACCESS_DIRECT)\n-\tp = undefined;\n+        p = undefined;\n       else\n-\t{\n-\t  p = NULL;\t\t/* TODO: Try to decode what the standard says... */\n-\t}\n-\n-      cf_strcpy (ioparm.blank, ioparm.blank_len, p);\n+        switch (u->flags.position)\n+          {\n+             case POSITION_REWIND:\n+               p = \"REWIND\";\n+               break;\n+             case POSITION_APPEND:\n+               p = \"APPEND\";\n+               break;\n+             case POSITION_ASIS:\n+               p = \"ASIS\";\n+               break;\n+             default:\n+               /* if not direct access, it must be\n+                  either REWIND, APPEND, or ASIS.\n+                  ASIS seems to be the best default */\n+               p = \"ASIS\";\n+               break;\n+          }\n+      cf_strcpy (ioparm.position, ioparm.position_len, p);\n     }\n \n   if (ioparm.action != NULL)"}, {"sha": "f0b0e90e45449fddb9e003b94d0b7e8b2ad4e74e", "filename": "libgfortran/io/rewind.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2Fio%2Frewind.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2Fio%2Frewind.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Frewind.c?ref=b1a807057ecb701601141285c011ef637b97f3b7", "patch": "@@ -66,6 +66,8 @@ st_rewind (void)\n \t  u->current_record = 0;\n \t  test_endfile (u);\n \t}\n+      /* update position for INQUIRE */\n+      u->flags.position = POSITION_REWIND;\n     }\n \n   library_end ();"}, {"sha": "114ed92abb951b2d28208aff727e99a884e00112", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b1a807057ecb701601141285c011ef637b97f3b7/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=b1a807057ecb701601141285c011ef637b97f3b7", "patch": "@@ -1363,6 +1363,9 @@ next_record (int done)\n   else\n     next_record_w (done);\n \n+  /* keep position up to date for INQUIRE */\n+  current_unit->flags.position = POSITION_ASIS;\n+\n   current_unit->current_record = 0;\n   if (current_unit->flags.access == ACCESS_DIRECT)\n    {"}]}