{"sha": "8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODU1NGQ5YTQ2NGM1NDRmYmUxZjJjZjdkZjg0YjMzZGQ4YWI3OTM0Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2001-10-12T10:51:17Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2001-10-12T10:51:17Z"}, "message": "final.c (output_asm_insn): Make sure assembly dialects are terminated, not nested.\n\n\t* final.c (output_asm_insn): Make sure assembly dialects are\n\tterminated, not nested.  Output `|' and `}' characters if they\n\tdon't appear inside assembly dialect selection.\n\t* config/i386/i386.md (rep_movdi_rex64, rep_movsi, rep_movsi_rex64,\n\trep_movqi, rep_movqi_rex64, rep_stosdi_rex64, rep_stossi,\n\trep_stossi_rex64, rep_stosqi, rep_stosqi_rex64, strsetsi_1,\n\tstrsetsi_rex_1): Add {} braces.\n\n\t* testsuite/gcc.dg/20011009-1.c: New test.\n\nFrom-SVN: r46227", "tree": {"sha": "a51f1faf4476c94046f181727d55f03fb99cb9b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a51f1faf4476c94046f181727d55f03fb99cb9b1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e60505a59dad6aa8c17c43411e4998b209ddcd64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e60505a59dad6aa8c17c43411e4998b209ddcd64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e60505a59dad6aa8c17c43411e4998b209ddcd64"}], "stats": {"total": 87, "additions": 72, "deletions": 15}, "files": [{"sha": "82d84f68b86d02204a2c61b758bff0ea941609a0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "patch": "@@ -1,3 +1,13 @@\n+2001-10-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* final.c (output_asm_insn): Make sure assembly dialects are\n+\tterminated, not nested.  Output `|' and `}' characters if they\n+\tdon't appear inside assembly dialect selection.\n+\t* config/i386/i386.md (rep_movdi_rex64, rep_movsi, rep_movsi_rex64,\n+\trep_movqi, rep_movqi_rex64, rep_stosdi_rex64, rep_stossi,\n+\trep_stossi_rex64, rep_stosqi, rep_stosqi_rex64, strsetsi_1,\n+\tstrsetsi_rex_1): Add {} braces.\n+\n 2001-10-11  Zack Weinberg  <zack@codesourcery.com>\n \n \t* toplev.c (compile_file): Ignore return value from yyparse."}, {"sha": "db143969dc6274c0dfc2babd8698a0f060873079", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "patch": "@@ -14938,7 +14938,7 @@\n    (use (match_dup 5))\n    (use (reg:SI 19))]\n   \"TARGET_64BIT\"\n-  \"rep\\;movsq|rep movsq\"\n+  \"{rep\\;movsq|rep movsq}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"both\")\n@@ -14958,7 +14958,7 @@\n    (use (match_dup 5))\n    (use (reg:SI 19))]\n   \"!TARGET_64BIT\"\n-  \"rep\\;movsl|rep movsd\"\n+  \"{rep\\;movsl|rep movsd}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"both\")\n@@ -14978,7 +14978,7 @@\n    (use (match_dup 5))\n    (use (reg:SI 19))]\n   \"TARGET_64BIT\"\n-  \"rep\\;movsl|rep movsd\"\n+  \"{rep\\;movsl|rep movsd}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"both\")\n@@ -14996,7 +14996,7 @@\n    (use (match_dup 5))\n    (use (reg:SI 19))]\n   \"!TARGET_64BIT\"\n-  \"rep\\;movsb|rep movsb\"\n+  \"{rep\\;movsb|rep movsb}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"both\")\n@@ -15014,7 +15014,7 @@\n    (use (match_dup 5))\n    (use (reg:SI 19))]\n   \"TARGET_64BIT\"\n-  \"rep\\;movsb|rep movsb\"\n+  \"{rep\\;movsb|rep movsb}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"both\")\n@@ -15181,7 +15181,7 @@\n \t\t (const_int 4)))\n    (use (reg:SI 19))]\n   \"!TARGET_64BIT && (TARGET_SINGLE_STRINGOP || optimize_size)\"\n-  \"stosl|stosd\"\n+  \"{stosl|stosd}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"memory\" \"store\")\n    (set_attr \"mode\" \"SI\")])\n@@ -15194,7 +15194,7 @@\n \t\t (const_int 4)))\n    (use (reg:SI 19))]\n   \"TARGET_64BIT && (TARGET_SINGLE_STRINGOP || optimize_size)\"\n-  \"stosl|stosd\"\n+  \"{stosl|stosd}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"memory\" \"store\")\n    (set_attr \"mode\" \"SI\")])\n@@ -15263,7 +15263,7 @@\n    (use (match_dup 4))\n    (use (reg:SI 19))]\n   \"TARGET_64BIT\"\n-  \"rep\\;stosq|rep stosq\"\n+  \"{rep\\;stosq|rep stosq}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"store\")\n@@ -15281,7 +15281,7 @@\n    (use (match_dup 4))\n    (use (reg:SI 19))]\n   \"!TARGET_64BIT\"\n-  \"rep\\;stosl|rep stosd\"\n+  \"{rep\\;stosl|rep stosd}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"store\")\n@@ -15299,7 +15299,7 @@\n    (use (match_dup 4))\n    (use (reg:SI 19))]\n   \"TARGET_64BIT\"\n-  \"rep\\;stosl|rep stosd\"\n+  \"{rep\\;stosl|rep stosd}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"store\")\n@@ -15316,7 +15316,7 @@\n    (use (match_dup 4))\n    (use (reg:SI 19))]\n   \"!TARGET_64BIT\"\n-  \"rep\\;stosb|rep stosb\"\n+  \"{rep\\;stosb|rep stosb}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"store\")\n@@ -15333,7 +15333,7 @@\n    (use (match_dup 4))\n    (use (reg:DI 19))]\n   \"TARGET_64BIT\"\n-  \"rep\\;stosb|rep stosb\"\n+  \"{rep\\;stosb|rep stosb}\"\n   [(set_attr \"type\" \"str\")\n    (set_attr \"prefix_rep\" \"1\")\n    (set_attr \"memory\" \"store\")"}, {"sha": "5d2d8d9ae69efa434c886ff2356f6299dc7c528b", "filename": "gcc/final.c", "status": "modified", "additions": 30, "deletions": 3, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "patch": "@@ -3313,6 +3313,9 @@ output_asm_insn (template, operands)\n {\n   const char *p;\n   int c;\n+#ifdef ASSEMBLER_DIALECT\n+  int dialect = 0;\n+#endif\n \n   /* An insn may return a null string template\n      in a case where no assembler code is needed.  */\n@@ -3347,6 +3350,11 @@ output_asm_insn (template, operands)\n \t{\n \t  int i;\n \n+\t  if (dialect)\n+\t    output_operand_lossage (\"nested assembly dialect alternatives\");\n+\t  else\n+\t    dialect = 1;\n+\n \t  /* If we want the first dialect, do nothing.  Otherwise, skip\n \t     DIALECT_NUMBER of strings ending with '|'.  */\n \t  for (i = 0; i < dialect_number; i++)\n@@ -3358,16 +3366,35 @@ output_asm_insn (template, operands)\n \t      if (*p == '|')\n \t\tp++;\n \t    }\n+\n+\t  if (*p == '\\0')\n+\t    output_operand_lossage (\"unterminated assembly dialect alternative\");\n \t}\n \tbreak;\n \n       case '|':\n-\t/* Skip to close brace.  */\n-\twhile (*p && *p++ != '}')\n-\t  ;\n+\tif (dialect)\n+\t  {\n+\t    /* Skip to close brace.  */\n+\t    do\n+\t      {\n+\t\tif (*p == '\\0')\n+\t\t  {\n+\t\t    output_operand_lossage (\"unterminated assembly dialect alternative\");\n+\t\t    break;\n+\t\t  }\n+\t      }\t  \n+\t    while (*p++ != '}');\n+\t    dialect = 0;\n+\t  }\n+\telse\n+\t  putc (c, asm_out_file);\n \tbreak;\n \n       case '}':\n+\tif (! dialect)\n+\t  putc (c, asm_out_file);\n+\tdialect = 0;\n \tbreak;\n #endif\n "}, {"sha": "35f40e591793629dd8778a7268bcf3fe839eed76", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "patch": "@@ -1,3 +1,7 @@\n+2001-10-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* testsuite/gcc.dg/20011009-1.c: New test.\n+\n 2001-10-12  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tPR g++/4476"}, {"sha": "dbf32e63fba87ef04f646fd9fab23cb1d29a522d", "filename": "gcc/testsuite/gcc.dg/20011009-1.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Ftestsuite%2Fgcc.dg%2F20011009-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8554d9a464c544fbe1f2cf7df84b33dd8ab79347/gcc%2Ftestsuite%2Fgcc.dg%2F20011009-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20011009-1.c?ref=8554d9a464c544fbe1f2cf7df84b33dd8ab79347", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do run { target i?86-*-* } } */\n+/* { dg-options \"-O2\" } */\n+\n+extern void abort (void);\n+extern void exit (int);\n+\n+int main ()\n+{\n+  int x;\n+\n+  asm (\"movl $26, %0 # 26 |-> reg \\n\\t\"\n+       \"movl $28, %0\" : \"=r\" (x));\n+  if (x != 28)\n+    abort ();\n+  exit (0);\n+}"}]}