{"sha": "50f78bded40cb2b7d44480d8ac6d0e483631ade7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBmNzhiZGVkNDBjYjJiN2Q0NDQ4MGQ4YWM2ZDBlNDgzNjMxYWRlNw==", "commit": {"author": {"name": "Alexander Monakov", "email": "amonakov@ispras.ru", "date": "2018-04-11T10:40:07Z"}, "committer": {"name": "Alexander Monakov", "email": "amonakov@gcc.gnu.org", "date": "2018-04-11T10:40:07Z"}, "message": "sel-sched: run cleanup_cfg just before loop_optimizer_init (PR 84659)\n\n\tPR rtl-optimization/85659\n\t* sel-sched-ir.c (sel_init_pipelining): Invoke cleanup_cfg.\n\ntestsuite/\n\t* gcc.dg/pr84659.c: New test.\n\nFrom-SVN: r259313", "tree": {"sha": "639a12867115343cb108947c74325120b139c556", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/639a12867115343cb108947c74325120b139c556"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50f78bded40cb2b7d44480d8ac6d0e483631ade7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50f78bded40cb2b7d44480d8ac6d0e483631ade7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50f78bded40cb2b7d44480d8ac6d0e483631ade7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50f78bded40cb2b7d44480d8ac6d0e483631ade7/comments", "author": {"login": "amonakov", "id": 1997391, "node_id": "MDQ6VXNlcjE5OTczOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1997391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amonakov", "html_url": "https://github.com/amonakov", "followers_url": "https://api.github.com/users/amonakov/followers", "following_url": "https://api.github.com/users/amonakov/following{/other_user}", "gists_url": "https://api.github.com/users/amonakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/amonakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amonakov/subscriptions", "organizations_url": "https://api.github.com/users/amonakov/orgs", "repos_url": "https://api.github.com/users/amonakov/repos", "events_url": "https://api.github.com/users/amonakov/events{/privacy}", "received_events_url": "https://api.github.com/users/amonakov/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "23d87577a3a02b11858c7de68313ebcc45445a13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23d87577a3a02b11858c7de68313ebcc45445a13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23d87577a3a02b11858c7de68313ebcc45445a13"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "d70b106ade48a9b05b6e026217f47d109858e2e7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=50f78bded40cb2b7d44480d8ac6d0e483631ade7", "patch": "@@ -1,3 +1,8 @@\n+2018-04-11  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\tPR rtl-optimization/85659\n+\t* sel-sched-ir.c (sel_init_pipelining): Invoke cleanup_cfg.\n+\n 2018-04-11  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/85302"}, {"sha": "50a7daafba6889c14fca136ee120e0ffb2ad67b4", "filename": "gcc/sel-sched-ir.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2Fsel-sched-ir.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2Fsel-sched-ir.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsel-sched-ir.c?ref=50f78bded40cb2b7d44480d8ac6d0e483631ade7", "patch": "@@ -30,6 +30,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"cfgrtl.h\"\n #include \"cfganal.h\"\n #include \"cfgbuild.h\"\n+#include \"cfgcleanup.h\"\n #include \"insn-config.h\"\n #include \"insn-attr.h\"\n #include \"recog.h\"\n@@ -6121,6 +6122,9 @@ make_regions_from_loop_nest (struct loop *loop)\n void\n sel_init_pipelining (void)\n {\n+  /* Remove empty blocks: their presence can break assumptions elsewhere,\n+     e.g. the logic to invoke update_liveness_on_insn in sel_region_init.  */\n+  cleanup_cfg (0);\n   /* Collect loop information to be used in outer loops pipelining.  */\n   loop_optimizer_init (LOOPS_HAVE_PREHEADERS\n                        | LOOPS_HAVE_FALLTHRU_PREHEADERS"}, {"sha": "999ce0969f4417106d12fe42a007381cde5c0859", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=50f78bded40cb2b7d44480d8ac6d0e483631ade7", "patch": "@@ -1,3 +1,8 @@\n+2018-04-11  Alexander Monakov  <amonakov@ispras.ru>\n+\n+\tPR rtl-optimization/85659\n+\t* gcc.dg/pr84659.c: New test.\n+\n 2018-04-11  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/85302"}, {"sha": "94c885f3869c3e36862eb8c6f705c2e548b2cf97", "filename": "gcc/testsuite/gcc.dg/pr84659.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84659.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50f78bded40cb2b7d44480d8ac6d0e483631ade7/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84659.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84659.c?ref=50f78bded40cb2b7d44480d8ac6d0e483631ade7", "patch": "@@ -0,0 +1,19 @@\n+/* PR rtl-optimization/84659 */\n+/* { dg-do compile { target powerpc*-*-* ia64-*-* i?86-*-* x86_64-*-* } } */\n+/* { dg-options \"-O2 -fselective-scheduling -fsel-sched-pipelining -fno-split-wide-types -fno-strict-aliasing -fno-tree-dce\" } */\n+\n+void\n+jk (int **lq, int *k4, long long int qv, int od)\n+{\n+  while (**lq < 1)\n+    {\n+      int uo;\n+\n+      uo = ((od == 0) ? qv : *k4) != 1;\n+      ++**lq;\n+    }\n+\n+  for (;;)\n+    {\n+    }\n+}"}]}