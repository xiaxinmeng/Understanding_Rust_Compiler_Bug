{"sha": "8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGY4ZTlhYTVjMWI0OGE2YTZhNDA4MzlmZWM3Y2U5ODZjZmI2YjMwMw==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@codesourcery.com", "date": "2004-09-18T00:53:50Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2004-09-18T00:53:50Z"}, "message": "directives.c (do_pragma): Save current buffer position before lexing the pragma keywords...\n\n\t* directives.c (do_pragma): Save current buffer position\n\tbefore lexing the pragma keywords; don't call\n\t_cpp_backup_tokens in the defer_pragmas case.\n\nFrom-SVN: r87687", "tree": {"sha": "60adaba7e7c1f378d329b3a602df3862f5395b04", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60adaba7e7c1f378d329b3a602df3862f5395b04"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303/comments", "author": null, "committer": null, "parents": [{"sha": "bf3b7cd307678b263047bdd49adb08440302d0e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf3b7cd307678b263047bdd49adb08440302d0e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf3b7cd307678b263047bdd49adb08440302d0e0"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "5727f1ba165a396ae538fd6f2890ffee2cfcfe8a", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303", "patch": "@@ -1,3 +1,9 @@\n+2004-09-17  Zack Weinberg  <zack@codesourcery.com>\n+\n+\t* directives.c (do_pragma): Save current buffer position\n+\tbefore lexing the pragma keywords; don't call\n+\t_cpp_backup_tokens in the defer_pragmas case.\n+\n 2004-09-15  Per Bothner  <per@bothner.com>\n \n \t* include/line-map.h (line_map_start):  Add parameter names so"}, {"sha": "49f95ca338953fce6f5627a9cd6e44bda8847bc6", "filename": "libcpp/directives.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303/libcpp%2Fdirectives.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303/libcpp%2Fdirectives.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fdirectives.c?ref=8f8e9aa5c1b48a6a6a40839fec7ce986cfb6b303", "patch": "@@ -1145,6 +1145,11 @@ do_pragma (cpp_reader *pfile)\n   const cpp_token *token, *pragma_token = pfile->cur_token;\n   unsigned int count = 1;\n \n+  /* Save the current position so that defer_pragmas mode can\n+     copy the entire current line to a string.  It will not work\n+     to use _cpp_backup_tokens as that does not reverse buffer->cur.  */\n+  const uchar *line_start = CPP_BUFFER (pfile)->cur;\n+\n   pfile->state.prevent_expansion++;\n \n   token = cpp_get_token (pfile);\n@@ -1174,13 +1179,11 @@ do_pragma (cpp_reader *pfile)\n   else if (CPP_OPTION (pfile, defer_pragmas))\n     {\n       /* Squirrel away the pragma text.  Pragmas are newline-terminated. */\n-      const uchar *line_start, *line_end;\n+      const uchar *line_end;\n       uchar *s;\n       cpp_string body;\n       cpp_token *ptok;\n \n-      _cpp_backup_tokens (pfile, count);\n-      line_start = CPP_BUFFER (pfile)->cur;\n       line_end = ustrchr (line_start, '\\n');\n \n       body.len = (line_end - line_start) + 1;"}]}