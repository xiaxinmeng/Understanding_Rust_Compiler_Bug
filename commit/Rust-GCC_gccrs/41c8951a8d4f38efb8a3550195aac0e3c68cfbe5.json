{"sha": "41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFjODk1MWE4ZDRmMzhlZmI4YTM1NTAxOTVhYWMwZTNjNjhjZmJlNQ==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2007-08-31T10:19:18Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-08-31T10:19:18Z"}, "message": "re PR ada/4720 (GNAT programs do not support --help and --version)\n\n2007-08-30  Vincent Celier  <celier@adacore.com>\n\n\tPR ada/4720\n\n\t* gnatchop.adb, gnatfind.adb, gnatlink.adb, gnatls.adb, \n\tgnatname.adb, gnatxref.adb, gprep.adb, clean.adb gnatbind.adb\n\t(Check_Version_And_Help): New procedure in package Switch to process\n\tswitches --version and --help.\n\tUse Check_Version_And_Help in GNAT tools\n\n\t* make.adb:  Ditto.\n\t(Compile_Sources): Make sure that sources that are \"excluded\" are not\n\tcompiled.\n\t(Gnatmake): Do not issue -aO. to gnatbind and only issue -I- if a\n\tproject file is used.\n\t(Version_Switch): Remove, moved to Switch\n\t(Help_Switch): Remove, moved to Switch\n\t(Display_Version): Remove, moved to Switch\n\n\t* switch.ads, switch.adb (Check_Version_And_Help): New procedure in\n\tpackage Switch to process switches --version and --help.\n\t(Display_Version): New procedure\n\n\t* gnatvsn.ads, gnatvsn.adb (Copyright_Holder): New function.\n\nFrom-SVN: r127967", "tree": {"sha": "c8c87d18a9109794633d5e936943a3f76d7e949f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c8c87d18a9109794633d5e936943a3f76d7e949f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c66bc9cc91b859926122b611e577b61c401e1e3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c66bc9cc91b859926122b611e577b61c401e1e3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c66bc9cc91b859926122b611e577b61c401e1e3e"}], "stats": {"total": 465, "additions": 277, "deletions": 188}, "files": [{"sha": "e3f8541263bf87f0a15146be24cb95ba0224541d", "filename": "gcc/ada/clean.adb", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fclean.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fclean.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fclean.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -26,7 +26,6 @@\n \n with ALI;      use ALI;\n with Csets;\n-with Gnatvsn;  use Gnatvsn;\n with Makeutl;\n with MLib.Tgt; use MLib.Tgt;\n with Namet;    use Namet;\n@@ -39,6 +38,7 @@ with Prj.Ext;\n with Prj.Pars;\n with Prj.Util; use Prj.Util;\n with Snames;\n+with Switch;   use Switch;\n with Table;\n with Targparm; use Targparm;\n with Types;    use Types;\n@@ -1342,11 +1342,7 @@ package body Clean is\n    begin\n       if not Copyright_Displayed then\n          Copyright_Displayed := True;\n-         Put_Line\n-           (\"GNATCLEAN \" & Gnatvsn.Gnat_Version_String\n-            & \" Copyright 2003-\"\n-            & Current_Year\n-            & \" Free Software Foundation, Inc.\");\n+         Display_Version (\"GNATCLEAN\", \"2003\");\n       end if;\n    end Display_Copyright;\n \n@@ -1640,9 +1636,14 @@ package body Clean is\n    procedure Parse_Cmd_Line is\n       Last         : constant Natural := Argument_Count;\n       Source_Index : Int := 0;\n-      Index        : Positive := 1;\n+      Index        : Positive;\n \n    begin\n+      --  First, check for --version and --help\n+\n+      Check_Version_And_Help (\"GNATCLEAN\", \"2003\", Usage'Access);\n+\n+      Index := 1;\n       while Index <= Last loop\n          declare\n             Arg : constant String := Argument (Index);"}, {"sha": "3445672f1d487f838daaaea989d85637177643e6", "filename": "gcc/ada/gnatbind.adb", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatbind.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatbind.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatbind.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -37,7 +37,6 @@ with Csets;\n with Debug;    use Debug;\n with Fmap;\n with Fname;    use Fname;\n-with Gnatvsn;  use Gnatvsn;\n with Namet;    use Namet;\n with Opt;      use Opt;\n with Osint;    use Osint;\n@@ -423,6 +422,12 @@ begin\n       Shared_Libgnat := (Shared_Libgnat_Default = SHARED);\n    end;\n \n+   --  Scan the switches and arguments\n+\n+   --  First, scan to detect --version and/or --help\n+\n+   Check_Version_And_Help (\"GNATBIND\", \"1995\", Bindusg.Display'Access);\n+\n    --  Use low level argument routines to avoid dragging in the secondary stack\n \n    Next_Arg := 1;\n@@ -553,13 +558,7 @@ begin\n \n    if Verbose_Mode then\n       Write_Eol;\n-      Write_Str (\"GNATBIND \");\n-      Write_Str (Gnat_Version_String);\n-      Write_Eol;\n-      Write_Str (\"Copyright 1995-\" &\n-                 Current_Year &\n-                 \", Free Software Foundation, Inc.\");\n-      Write_Eol;\n+      Display_Version (\"GNATBIND\", \"1995\");\n    end if;\n \n    --  Output usage information if no files"}, {"sha": "9bd1736d3e35491fc74f093c7f2af51173eadea1", "filename": "gcc/ada/gnatchop.adb", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatchop.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatchop.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatchop.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                     Copyright (C) 1998-2007, AdaCore                     --\n+--          Copyright (C) 1998-2007, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -36,8 +36,8 @@ with GNAT.OS_Lib;                use GNAT.OS_Lib;\n with GNAT.Heap_Sort_G;\n with GNAT.Table;\n \n-with Gnatvsn;\n with Hostparm;\n+with Switch;   use Switch;\n with Types;\n \n procedure Gnatchop is\n@@ -1158,14 +1158,7 @@ procedure Gnatchop is\n \n             when 'v' =>\n                Verbose_Mode := True;\n-\n-               --  Why is following written to standard error. Most other\n-               --  tools write to standard output ???\n-\n-               Put (Standard_Error, \"GNATCHOP \");\n-               Put_Line (Standard_Error, Gnatvsn.Gnat_Version_String);\n-               Put_Line\n-                 (Standard_Error, \"Copyright 1998-2005, AdaCore\");\n+               Display_Version (\"GNATCHOP\", \"1998\");\n \n             when 'w' =>\n                Overwrite_Files := True;\n@@ -1767,6 +1760,10 @@ begin\n \n    --  Process command line options and initialize global variables\n \n+   --  First, scan to detect --version and/or --help\n+\n+   Check_Version_And_Help (\"GNATCHOP\", \"1998\", Usage'Unrestricted_Access);\n+\n    if not Scan_Arguments then\n       Set_Exit_Status (Failure);\n       return;"}, {"sha": "bc6f423dfd542aca7dbc62bce730c0693073e87b", "filename": "gcc/ada/gnatfind.adb", "status": "modified", "additions": 31, "deletions": 12, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatfind.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatfind.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatfind.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -24,13 +24,12 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n-with Xr_Tabls; use Xr_Tabls;\n-with Xref_Lib; use Xref_Lib;\n+with Opt;\n with Osint;    use Osint;\n+with Switch;   use Switch;\n with Types;    use Types;\n-\n-with Gnatvsn;\n-with Opt;\n+with Xr_Tabls; use Xr_Tabls;\n+with Xref_Lib; use Xref_Lib;\n \n with Ada.Strings.Fixed; use Ada.Strings.Fixed;\n with Ada.Text_IO;       use Ada.Text_IO;\n@@ -69,15 +68,26 @@ procedure Gnatfind is\n    procedure Parse_Cmd_Line;\n    --  Parse every switch on the command line\n \n+   procedure Usage;\n+   --  Display the usage\n+\n    procedure Write_Usage;\n-   --  Print a small help page for program usage\n+   --  Print a small help page for program usage and exit program\n \n    --------------------\n    -- Parse_Cmd_Line --\n    --------------------\n \n    procedure Parse_Cmd_Line is\n    begin\n+      --  First check for --version or --help\n+\n+      Check_Version_And_Help (\"GNATFIND\", \"1998\", Usage'Unrestricted_Access);\n+\n+      --  Now scan the other switches\n+\n+      GNAT.Command_Line.Initialize_Option_Scan;\n+\n       loop\n          case\n            GNAT.Command_Line.Getopt\n@@ -232,14 +242,12 @@ procedure Gnatfind is\n          Write_Usage;\n    end Parse_Cmd_Line;\n \n-   -----------------\n-   -- Write_Usage --\n-   -----------------\n+   -----------\n+   -- Usage --\n+   -----------\n \n-   procedure Write_Usage is\n+   procedure Usage is\n    begin\n-      Put_Line (\"GNATFIND \" & Gnatvsn.Gnat_Version_String);\n-      Put_Line (\"Copyright 1998-2005, AdaCore\");\n       Put_Line (\"Usage: gnatfind pattern[:sourcefile[:line[:column]]] \"\n                 & \"[file1 file2 ...]\");\n       New_Line;\n@@ -276,8 +284,19 @@ procedure Gnatfind is\n                 & \" only)\");\n       Put_Line (\"   -s        Print source line\");\n       Put_Line (\"   -t        Print type hierarchy\");\n+   end Usage;\n+\n+   -----------------\n+   -- Write_Usage --\n+   -----------------\n+\n+   procedure Write_Usage is\n+   begin\n+      Display_Version (\"GNATFIND\", \"1998\");\n       New_Line;\n \n+      Usage;\n+\n       raise Usage_Error;\n    end Write_Usage;\n "}, {"sha": "2170f5b25672872c6a4d7c9ffe311769df18c1ff", "filename": "gcc/ada/gnatlink.adb", "status": "modified", "additions": 33, "deletions": 24, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatlink.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatlink.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatlink.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -205,6 +205,9 @@ procedure Gnatlink is\n    procedure Process_Binder_File (Name : String);\n    --  Reads the binder file and extracts linker arguments\n \n+   procedure Usage;\n+   --  Display usage\n+\n    procedure Write_Header;\n    --  Show user the program name, version and copyright\n \n@@ -291,6 +294,10 @@ procedure Gnatlink is\n       --  linker's argument without parsing it.\n \n    begin\n+      --  First, check for --version and --help\n+\n+      Check_Version_And_Help (\"GNATLINK\", \"1995\", Usage'Unrestricted_Access);\n+\n       --  Loop through arguments of gnatlink command\n \n       Next_Arg := 1;\n@@ -1329,32 +1336,12 @@ procedure Gnatlink is\n       Status := fclose (Fd);\n    end Process_Binder_File;\n \n-   ------------------\n-   -- Write_Header --\n-   ------------------\n+   -----------\n+   -- Usage --\n+   -----------\n \n-   procedure Write_Header is\n+   procedure Usage is\n    begin\n-      if Verbose_Mode then\n-         Write_Eol;\n-         Write_Str (\"GNATLINK \");\n-         Write_Str (Gnat_Version_String);\n-         Write_Eol;\n-         Write_Str (\"Copyright 1995-\" &\n-                    Current_Year &\n-                    \", Free Software Foundation, Inc\");\n-         Write_Eol;\n-      end if;\n-   end Write_Header;\n-\n-   -----------------\n-   -- Write_Usage --\n-   -----------------\n-\n-   procedure Write_Usage is\n-   begin\n-      Write_Header;\n-\n       Write_Str (\"Usage: \");\n       Write_Str (Base_Name (Command_Name));\n       Write_Str (\" switches mainprog.ali [non-Ada-objects] [linker-options]\");\n@@ -1385,6 +1372,28 @@ procedure Gnatlink is\n       Write_Eol;\n       Write_Line (\"  [non-Ada-objects]  list of non Ada object files\");\n       Write_Line (\"  [linker-options]   other options for the linker\");\n+   end Usage;\n+\n+   ------------------\n+   -- Write_Header --\n+   ------------------\n+\n+   procedure Write_Header is\n+   begin\n+      if Verbose_Mode then\n+         Write_Eol;\n+         Display_Version (\"GNATLINK\", \"1995\");\n+      end if;\n+   end Write_Header;\n+\n+   -----------------\n+   -- Write_Usage --\n+   -----------------\n+\n+   procedure Write_Usage is\n+   begin\n+      Write_Header;\n+      Usage;\n    end Write_Usage;\n \n --  Start of processing for Gnatlink"}, {"sha": "1bee17980af599949895cb89a817558a794843ca", "filename": "gcc/ada/gnatls.adb", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatls.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatls.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatls.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -40,6 +40,7 @@ with Output;      use Output;\n with Rident;      use Rident;\n with Sdefault;\n with Snames;\n+with Switch;      use Switch;\n with Targparm;    use Targparm;\n with Types;       use Types;\n \n@@ -1528,6 +1529,10 @@ begin\n    Csets.Initialize;\n    Snames.Initialize;\n \n+   --  First check for --version or --help\n+\n+   Check_Version_And_Help (\"GNATLS\", \"1997\", Usage'Unrestricted_Access);\n+\n    --  Loop to scan out arguments\n \n    Next_Arg := 1;\n@@ -1572,13 +1577,7 @@ begin\n       Targparm.Get_Target_Parameters;\n \n       Write_Eol;\n-      Write_Str (\"GNATLS \");\n-      Write_Str (Gnat_Version_String);\n-      Write_Eol;\n-      Write_Str (\"Copyright 1997-\" &\n-                 Current_Year &\n-                 \", Free Software Foundation, Inc.\");\n-      Write_Eol;\n+      Display_Version (\"GNATLS\", \"1997\");\n       Write_Eol;\n       Write_Str (\"Source Search Path:\");\n       Write_Eol;"}, {"sha": "84bea96f81b9c342b0cc251862d63c409a741418", "filename": "gcc/ada/gnatname.adb", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatname.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatname.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatname.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -24,12 +24,12 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n-with Gnatvsn;  use Gnatvsn;\n with Hostparm;\n with Opt;\n with Osint;    use Osint;\n with Output;   use Output;\n with Prj.Makr;\n+with Switch;   use Switch;\n with Table;\n \n with Ada.Command_Line;  use Ada.Command_Line;\n@@ -169,12 +169,7 @@ procedure Gnatname is\n       if not Version_Output then\n          Version_Output := True;\n          Output.Write_Eol;\n-         Output.Write_Str (\"GNATNAME \");\n-         Output.Write_Line (Gnatvsn.Gnat_Version_String);\n-         Output.Write_Line\n-           (\"Copyright 2001-\" &\n-            Current_Year &\n-            \", Free Software Foundation, Inc.\");\n+         Display_Version (\"GNATNAME\", \"2001\");\n       end if;\n    end Output_Version;\n \n@@ -184,6 +179,12 @@ procedure Gnatname is\n \n    procedure Scan_Args is\n    begin\n+      --  First check for --version or --help\n+\n+      Check_Version_And_Help (\"GNATNAME\", \"2001\", Usage'Unrestricted_Access);\n+\n+      --  Now scan the other switches\n+\n       Initialize_Option_Scan;\n \n       --  Scan options first"}, {"sha": "dadcda157e2407656aff7b259560122acf55af3c", "filename": "gcc/ada/gnatvsn.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatvsn.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatvsn.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatvsn.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -33,6 +33,15 @@\n \n package body Gnatvsn is\n \n+   ----------------------\n+   -- Copyright_Holder --\n+   ----------------------\n+\n+   function Copyright_Holder return String is\n+   begin\n+      return \"Free Software Foundation, Inc.\";\n+   end Copyright_Holder;\n+\n    ------------------------\n    -- Gnat_Free_Software --\n    ------------------------"}, {"sha": "1b1398920baab51e92b24866543f57714a042ee5", "filename": "gcc/ada/gnatvsn.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatvsn.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatvsn.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatvsn.ads?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -68,6 +68,10 @@ package Gnatvsn is\n    --  Text to be displayed by the different GNAT tools when switch --version\n    --  is used. This text depends on the GNAT build type.\n \n+   function Copyright_Holder return String;\n+   --  Return the name of the Copyright holder to be displayed by the different\n+   --  GNAT tools when switch --version is used.\n+\n    Ver_Len_Max : constant := 64;\n    --  Longest possible length for Gnat_Version_String in this or any\n    --  other version of GNAT. This is used by the binder to establish"}, {"sha": "859b984c418ebe1dac09a833a5a4f0e6bd5e4b08", "filename": "gcc/ada/gnatxref.adb", "status": "modified", "additions": 26, "deletions": 11, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatxref.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgnatxref.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatxref.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -24,13 +24,12 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n-with Xr_Tabls; use Xr_Tabls;\n-with Xref_Lib; use Xref_Lib;\n+with Opt;\n with Osint;    use Osint;\n with Types;    use Types;\n-\n-with Gnatvsn;\n-with Opt;\n+with Switch;   use Switch;\n+with Xr_Tabls; use Xr_Tabls;\n+with Xref_Lib; use Xref_Lib;\n \n with Ada.Strings.Fixed; use Ada.Strings.Fixed;\n with Ada.Text_IO;       use Ada.Text_IO;\n@@ -57,6 +56,9 @@ procedure Gnatxref is\n    procedure Parse_Cmd_Line;\n    --  Parse every switch on the command line\n \n+   procedure Usage;\n+   --  Display the usage\n+\n    procedure Write_Usage;\n    --  Print a small help page for program usage\n \n@@ -66,6 +68,10 @@ procedure Gnatxref is\n \n    procedure Parse_Cmd_Line is\n    begin\n+      --  First check for --version or --help\n+\n+      Check_Version_And_Help (\"GNATXREF\", \"1998\", Usage'Unrestricted_Access);\n+\n       loop\n          case\n            GNAT.Command_Line.Getopt\n@@ -205,14 +211,12 @@ procedure Gnatxref is\n          Write_Usage;\n    end Parse_Cmd_Line;\n \n-   -----------------\n-   -- Write_Usage --\n-   -----------------\n+   -----------\n+   -- Usage --\n+   -----------\n \n-   procedure Write_Usage is\n+   procedure Usage is\n    begin\n-      Put_Line (\"GNATXREF \" & Gnatvsn.Gnat_Version_String);\n-      Put_Line (\"Copyright 1998-2005, AdaCore\");\n       Put_Line (\"Usage: gnatxref [switches] file1 file2 ...\");\n       New_Line;\n       Put_Line (\"  file ... list of source files to xref, \" &\n@@ -238,6 +242,17 @@ procedure Gnatxref is\n       Put_Line (\"   -v        Print a 'tags' file for vi\");\n       New_Line;\n \n+   end Usage;\n+\n+   -----------------\n+   -- Write_Usage --\n+   -----------------\n+\n+   procedure Write_Usage is\n+   begin\n+      Display_Version (\"GNATXREF\", \"1998\");\n+      New_Line;\n+      Usage;\n       raise Usage_Error;\n    end Write_Usage;\n "}, {"sha": "26194aed796c51afbfa6cf707d317f9ec98edd75", "filename": "gcc/ada/gprep.adb", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgprep.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fgprep.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgprep.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -27,7 +27,6 @@\n with Csets;\n with Err_Vars; use Err_Vars;\n with Errutil;\n-with Gnatvsn;  use Gnatvsn;\n with Namet;    use Namet;\n with Opt;\n with Osint;    use Osint;\n@@ -37,15 +36,16 @@ with Scng;\n with Sinput.C;\n with Snames;\n with Stringt;  use Stringt;\n+with Switch;   use Switch;\n with Types;    use Types;\n \n-with Ada.Text_IO;               use Ada.Text_IO;\n+with Ada.Text_IO;     use Ada.Text_IO;\n \n with GNAT.Case_Util;            use GNAT.Case_Util;\n with GNAT.Command_Line;\n with GNAT.Directory_Operations; use GNAT.Directory_Operations;\n \n-with System.OS_Lib;             use System.OS_Lib;\n+with System.OS_Lib; use System.OS_Lib;\n \n package body GPrep is\n \n@@ -138,10 +138,7 @@ package body GPrep is\n    procedure Display_Copyright is\n    begin\n       if not Copyright_Displayed then\n-         Write_Line (\"GNAT Preprocessor \" & Gnatvsn.Gnat_Version_String);\n-         Write_Line (\"Copyright 1996-\" &\n-                     Current_Year &\n-                     \", Free Software Foundation, Inc.\");\n+         Display_Version (\"GNAT Preprocessor\", \"1996\");\n          Copyright_Displayed := True;\n       end if;\n    end Display_Copyright;\n@@ -704,7 +701,13 @@ package body GPrep is\n       Switch : Character;\n \n    begin\n-      --  Parse the switches\n+      --  First check for --version or --help\n+\n+      Check_Version_And_Help (\"GNATPREP\", \"1996\", Usage'Access);\n+\n+      --  Now scan the other switches\n+\n+      GNAT.Command_Line.Initialize_Option_Scan;\n \n       loop\n          begin"}, {"sha": "6d13179d525efe3507dd0082a1d876d1e4ddd4e4", "filename": "gcc/ada/make.adb", "status": "modified", "additions": 20, "deletions": 82, "changes": 102, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fmake.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fmake.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmake.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -392,8 +392,6 @@ package body Make is\n \n    Shared_String           : aliased String := \"-shared\";\n    Force_Elab_Flags_String : aliased String := \"-F\";\n-   Version_Switch          : constant String := \"--version\";\n-   Help_Switch             : constant String := \"--help\";\n \n    No_Shared_Switch : aliased Argument_List := (1 .. 0 => null);\n    Shared_Switch    : aliased Argument_List := (1 => Shared_String'Access);\n@@ -509,9 +507,6 @@ package body Make is\n    -- Misc Routines --\n    -------------------\n \n-   procedure Display_Version;\n-   --  Display version when switch --version is used\n-\n    procedure List_Depend;\n    --  Prints to standard output the list of object dependencies. This list\n    --  can be used directly in a Makefile. A call to Compile_Sources must\n@@ -3562,15 +3557,22 @@ package body Make is\n                               if Uid /= Prj.No_Unit_Index then\n                                  Udata := Project_Tree.Units.Table (Uid);\n \n-                                 if Udata.File_Names (Body_Part).Name /=\n-                                                                     No_File\n+                                 if\n+                                    Udata.File_Names (Body_Part).Name /=\n+                                                                       No_File\n+                                   and then\n+                                     Udata.File_Names (Body_Part).Path /= Slash\n                                  then\n                                     Sfile := Udata.File_Names (Body_Part).Name;\n                                     Source_Index :=\n                                       Udata.File_Names (Body_Part).Index;\n \n-                                 elsif Udata.File_Names (Specification).Name /=\n-                                                                     No_File\n+                                 elsif\n+                                    Udata.File_Names (Specification).Name /=\n+                                                                        No_File\n+                                   and then\n+                                    Udata.File_Names (Specification).Path /=\n+                                                                          Slash\n                                  then\n                                     Sfile :=\n                                       Udata.File_Names (Specification).Name;\n@@ -4063,26 +4065,6 @@ package body Make is\n       Display_Executed_Programs := Display;\n    end Display_Commands;\n \n-   ---------------------\n-   -- Display_Version --\n-   ---------------------\n-\n-   procedure Display_Version is\n-   begin\n-      Write_Str (\"GNATMAKE \");\n-      Write_Str (Gnatvsn.Gnat_Version_String);\n-      Write_Eol;\n-\n-      Write_Str (\"Copyright (C) 1995-\");\n-      Write_Str (Gnatvsn.Current_Year);\n-      Write_Str (\", Free Software Foundation, Inc.\");\n-      Write_Eol;\n-\n-      Write_Str (Gnatvsn.Gnat_Free_Software);\n-      Write_Eol;\n-      Write_Eol;\n-   end Display_Version;\n-\n    -------------\n    -- Empty_Q --\n    -------------\n@@ -4821,14 +4803,7 @@ package body Make is\n \n       if Verbose_Mode then\n          Write_Eol;\n-         Write_Str (\"GNATMAKE \");\n-         Write_Str (Gnatvsn.Gnat_Version_String);\n-         Write_Eol;\n-         Write_Str\n-           (\"Copyright 1995-\" &\n-            Current_Year &\n-            \", Free Software Foundation, Inc.\");\n-         Write_Eol;\n+         Display_Version (\"GNATMAKE \", \"1995\");\n       end if;\n \n       if Main_Project /= No_Project\n@@ -4901,7 +4876,6 @@ package body Make is\n          Main_Index := Current_File_Index;\n       end if;\n \n-      Add_Switch (\"-I-\", Binder, And_Save => True);\n       Add_Switch (\"-I-\", Compiler, And_Save => True);\n \n       if Main_Project = No_Project then\n@@ -4914,10 +4888,6 @@ package body Make is\n                Compiler, Append_Switch => False,\n                And_Save => False);\n \n-            Add_Switch (\"-aO\" & Normalized_CWD,\n-                        Binder,\n-                        Append_Switch => False,\n-                        And_Save => False);\n          end if;\n \n       else\n@@ -4930,6 +4900,7 @@ package body Make is\n          --  projects.\n \n          Look_In_Primary_Dir := False;\n+         Add_Switch (\"-I-\", Binder, And_Save => True);\n       end if;\n \n       --  If the user wants a program without a main subprogram, add the\n@@ -6670,49 +6641,16 @@ package body Make is\n \n       --  Scan the switches and arguments\n \n-      declare\n-         Args                   : Argument_List (1 .. Argument_Count);\n-         Version_Switch_Present : Boolean := False;\n-         Help_Switch_Present    : Boolean := False;\n+      --  First, scan to detect --version and/or --help\n \n-      begin\n-         --  First, scan to detect --version and/or --help\n-\n-         for Next_Arg in 1 .. Argument_Count loop\n-            Args (Next_Arg) := new String'(Argument (Next_Arg));\n-\n-            if Args (Next_Arg).all = Version_Switch then\n-               Version_Switch_Present := True;\n-            elsif Args (Next_Arg).all = Help_Switch then\n-               Help_Switch_Present := True;\n-            end if;\n-         end loop;\n+      Check_Version_And_Help (\"GNATMAKE\", \"1995\", Makeusg'Access);\n \n-         --  If --version was used, display version and exit\n-\n-         if Version_Switch_Present then\n-            Set_Standard_Output;\n-            Display_Version;\n-            Exit_Program (E_Success);\n-         end if;\n+      --  Scan again the switch and arguments, now that we are sure that\n+      --  they do not include --version or --help.\n \n-         --  If --help was used, display help and exit\n-\n-         if Help_Switch_Present then\n-            Set_Standard_Output;\n-            Makeusg;\n-            Write_Eol;\n-            Write_Line (\"Report bugs to report@adacore.com\");\n-            Exit_Program (E_Success);\n-         end if;\n-\n-         --  Scan again the switch and arguments, now that we are sure that\n-         --  they do not include --version or --help.\n-\n-         Scan_Args : for Next_Arg in Args'Range loop\n-            Scan_Make_Arg (Args (Next_Arg).all, And_Save => True);\n-         end loop Scan_Args;\n-      end;\n+      Scan_Args : for Next_Arg in 1 .. Argument_Count loop\n+         Scan_Make_Arg (Argument (Next_Arg), And_Save => True);\n+      end loop Scan_Args;\n \n       if Commands_To_Stdout then\n          Set_Standard_Output;"}, {"sha": "fcbcbbbc2f8d54e4382fea2a9414e26062f40f51", "filename": "gcc/ada/switch.adb", "status": "modified", "additions": 84, "deletions": 2, "changes": 86, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fswitch.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fswitch.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fswitch.adb?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2005, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2007, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -24,7 +24,8 @@\n --                                                                          --\n ------------------------------------------------------------------------------\n \n-with Osint;\n+with Osint;  use Osint;\n+with Output; use Output;\n \n package body Switch is\n \n@@ -42,6 +43,87 @@ package body Switch is\n       Osint.Fail (\"invalid switch: \", Switch);\n    end Bad_Switch;\n \n+   ----------------------------\n+   -- Check_Version_And_Help --\n+   ----------------------------\n+\n+   procedure Check_Version_And_Help\n+     (Tool_Name      : String;\n+      Initial_Year   : String;\n+      Usage          : Procedure_Ptr;\n+      Version_String : String := Gnatvsn.Gnat_Version_String)\n+   is\n+      Version_Switch_Present : Boolean := False;\n+      Help_Switch_Present    : Boolean := False;\n+      Next_Arg               : Natural;\n+\n+   begin\n+      --  First check for --version or --help\n+\n+      Next_Arg := 1;\n+      while Next_Arg < Arg_Count loop\n+         declare\n+            Next_Argv : String (1 .. Len_Arg (Next_Arg));\n+         begin\n+            Fill_Arg (Next_Argv'Address, Next_Arg);\n+\n+            if Next_Argv = Version_Switch then\n+               Version_Switch_Present := True;\n+\n+            elsif Next_Argv = Help_Switch then\n+               Help_Switch_Present := True;\n+            end if;\n+\n+            Next_Arg := Next_Arg + 1;\n+         end;\n+      end loop;\n+\n+      --  If --version was used, display version and exit\n+\n+      if Version_Switch_Present then\n+         Set_Standard_Output;\n+         Display_Version (Tool_Name, Initial_Year, Version_String);\n+         Write_Str (Gnatvsn.Gnat_Free_Software);\n+         Write_Eol;\n+         Write_Eol;\n+         Exit_Program (E_Success);\n+      end if;\n+\n+      --  If --help was used, display help and exit\n+\n+      if Help_Switch_Present then\n+         Set_Standard_Output;\n+         Usage.all;\n+         Write_Eol;\n+         Write_Line (\"Report bugs to report@adacore.com\");\n+         Exit_Program (E_Success);\n+      end if;\n+   end Check_Version_And_Help;\n+\n+   ---------------------\n+   -- Display_Version --\n+   ---------------------\n+\n+   procedure Display_Version\n+     (Tool_Name      : String;\n+      Initial_Year   : String;\n+      Version_String : String := Gnatvsn.Gnat_Version_String)\n+   is\n+   begin\n+      Write_Str (Tool_Name);\n+      Write_Char (' ');\n+      Write_Str (Version_String);\n+      Write_Eol;\n+\n+      Write_Str (\"Copyright (C) \");\n+      Write_Str (Initial_Year);\n+      Write_Char ('-');\n+      Write_Str (Gnatvsn.Current_Year);\n+      Write_Str (\", \");\n+      Write_Str (Gnatvsn.Copyright_Holder);\n+      Write_Eol;\n+   end Display_Version;\n+\n    -------------------------\n    -- Is_Front_End_Switch --\n    -------------------------"}, {"sha": "470ea93c48edf4eb7cca0a1611055e57b02a9ff0", "filename": "gcc/ada/switch.ads", "status": "modified", "additions": 23, "deletions": 10, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fswitch.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41c8951a8d4f38efb8a3550195aac0e3c68cfbe5/gcc%2Fada%2Fswitch.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fswitch.ads?ref=41c8951a8d4f38efb8a3550195aac0e3c68cfbe5", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 1992-2005 Free Software Foundation, Inc.          --\n+--          Copyright (C) 1992-2007, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -31,30 +31,43 @@\n --  switches that are recognized. In addition, package Debug documents\n --  the otherwise undocumented debug switches that are also recognized.\n \n+with Gnatvsn;\n with Types; use Types;\n \n package Switch is\n \n-   --  Note: The default switch character is indicated by Switch_Character,\n-   --  but regardless of what it is, a hyphen is always allowed as an\n-   --  (alternative) switch character.\n+   --  Common switches for GNU tools\n \n-   --  Note: In GNAT, the case of switches is not significant if\n-   --  Switches_Case_Sensitive is False. If this is the case, switch\n-   --  characters, or letters appearing in the parameter to a switch, may be\n-   --  either upper case or lower case.\n+   Version_Switch : constant String := \"--version\";\n+   Help_Switch    : constant String := \"--help\";\n \n    -----------------\n    -- Subprograms --\n    -----------------\n \n+   type Procedure_Ptr is access procedure;\n+\n+   procedure Check_Version_And_Help\n+     (Tool_Name      : String;\n+      Initial_Year   : String;\n+      Usage          : Procedure_Ptr;\n+      Version_String : String := Gnatvsn.Gnat_Version_String);\n+   --  Check if switches --version or --help is used. If one of this switch\n+   --  is used, issue the proper messages and end the process.\n+\n+   procedure Display_Version\n+     (Tool_Name      : String;\n+      Initial_Year   : String;\n+      Version_String : String := Gnatvsn.Gnat_Version_String);\n+   --  Display version of a tool when switch --version is used\n+\n    function Is_Switch (Switch_Chars : String) return Boolean;\n    --  Returns True iff Switch_Chars is at least two characters long,\n-   --  and the first character indicates it is a switch.\n+   --  and the first character is an hyphen ('-').\n \n    function Is_Front_End_Switch (Switch_Chars : String) return Boolean;\n    --  Returns True iff Switch_Chars represents a front-end switch,\n-   --  ie. it starts with -I or -gnat.\n+   --  ie. it starts with -I, -gnat or -?RTS.\n \n private\n "}]}