{"sha": "63523a1fa58d1059e9c2d9ac926873fae010a367", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM1MjNhMWZhNThkMTA1OWU5YzJkOWFjOTI2ODczZmFlMDEwYTM2Nw==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-07-17T19:57:10Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-07-17T19:57:10Z"}, "message": "re PR fortran/34657 (program-unit MY_SUB imports symbol MY_SUB)\n\n2011-07-17  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/34657\n        * module.c (check_for_ambiguous): Check whether the name is\n        * matches\n        the current program unit.\n\n2011-07-17  Tobias Burnus  <burnus@net-b.de>\n            Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n        PR fortran/34657\n        * gfortran.dg/generic_17.f90: Fix testcase.\n        * gfortran.dg/interface_3.f90: Add dg-error.\n        * gfortran.dg/use_14.f90: New.\n        * gfortran.dg/use_15.f90: New.\n\n\nCo-Authored-By: Thomas Koenig <tkoenig@gcc.gnu.org>\n\nFrom-SVN: r176375", "tree": {"sha": "52dd10e8bef572d706dc9826d00910855edbbe4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/52dd10e8bef572d706dc9826d00910855edbbe4e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63523a1fa58d1059e9c2d9ac926873fae010a367", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63523a1fa58d1059e9c2d9ac926873fae010a367", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63523a1fa58d1059e9c2d9ac926873fae010a367", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63523a1fa58d1059e9c2d9ac926873fae010a367/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1ff247496641c78fbfbeb6a04db2c8dbdedbcf1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ff247496641c78fbfbeb6a04db2c8dbdedbcf1f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ff247496641c78fbfbeb6a04db2c8dbdedbcf1f"}], "stats": {"total": 90, "additions": 86, "deletions": 4}, "files": [{"sha": "d1f354e13c6011859cd5aa38c3902dc67b9accf6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -1,3 +1,9 @@\n+2011-07-17  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/34657\n+\t* module.c (check_for_ambiguous): Check whether the name is matches\n+\tthe current program unit.\n+\n 2011-07-17  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/49624"}, {"sha": "b62ad8d08e06728fbeb24b2fb6b5aea1b87f094b", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -4278,6 +4278,13 @@ check_for_ambiguous (gfc_symbol *st_sym, pointer_info *info)\n   module_locus locus;\n   symbol_attribute attr;\n \n+  if (st_sym->ns->proc_name && st_sym->name == st_sym->ns->proc_name->name)\n+    {\n+      gfc_error (\"'%s' of module '%s', imported at %C, is also the name of the \"\n+\t\t \"current program unit\", st_sym->name, module_name);\n+      return true;\n+    }\n+\n   rsym = info->u.rsym.sym;\n   if (st_sym == rsym)\n     return false;"}, {"sha": "9eb36a76045e95a976ce3b86420b1c9a8b460f1c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -1,3 +1,12 @@\n+2011-07-17  Tobias Burnus  <burnus@net-b.de>\n+\t    Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/34657\n+\t* gfortran.dg/generic_17.f90: Fix testcase.\n+\t* gfortran.dg/interface_3.f90: Add dg-error.\n+\t* gfortran.dg/use_14.f90: New.\n+\t* gfortran.dg/use_15.f90: New.\n+\n 2011-07-17  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/pointer_controlled.adb: New test."}, {"sha": "0e9a41d5b027b8ca55c50e427dacefc52d75eb70", "filename": "gcc/testsuite/gfortran.dg/generic_17.f90", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Fgeneric_17.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Fgeneric_17.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgeneric_17.f90?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -34,7 +34,7 @@ module foo_mod\n   use d_foo_mod\r\n end module foo_mod\r\n \r\n-subroutine s_foobar(x)  \r\n+subroutine s_foobar2(x)  \r\n   use foo_mod\r\n-end subroutine s_foobar\r\n+end subroutine s_foobar2\r\n ! { dg-final { cleanup-modules \"s_foo_mod d_foo_mod foo_mod\" } }"}, {"sha": "1d954eef8b6d5c76a119ca97beb3af9251ce07d4", "filename": "gcc/testsuite/gfortran.dg/interface_3.f90", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_3.f90?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -5,6 +5,8 @@\n !\n ! Contributed by Joost VandeVondele  <jv244@cam.ac.uk>\n !\n+! Modified for PR fortran/34657\n+!\n module test_mod\n interface\n   subroutine my_sub (a)\n@@ -30,14 +32,14 @@ function my_fun (a)\n ! This is the original PR, excepting that the error requires the symbol\n ! to be referenced.\n subroutine my_sub (a)\n-  use test_mod\n+  use test_mod     ! { dg-error \"is also the name of the current program unit\" }\n   real a\n   call my_sub (a)  ! { dg-error \"ambiguous reference\" }\n   print *, a\n end subroutine\n \n integer function my_fun (a)\n-  use test_mod\n+  use test_mod ! { dg-error \"is also the name of the current program unit\" }\n   real a\n   print *, a\n   my_fun = 1  ! { dg-error \"ambiguous reference\" }"}, {"sha": "63f3dff98b054ef3ef6ebda34b7fa034dfb68f8e", "filename": "gcc/testsuite/gfortran.dg/use_14.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_14.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_14.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_14.f90?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do compile }\n+!\n+! PR fortran/34657\n+!\n+module test_mod\n+interface\n+  subroutine my_sub (a)\n+    real a\n+  end subroutine\n+end interface\n+end module\n+\n+subroutine my_sub (a)\n+  use test_mod, gugu => my_sub\n+  real a\n+  print *, a\n+end subroutine\n+\n+END"}, {"sha": "099588836e0f82a7010aa1d4981298ffafab0392", "filename": "gcc/testsuite/gfortran.dg/use_15.f90", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_15.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63523a1fa58d1059e9c2d9ac926873fae010a367/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_15.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fuse_15.f90?ref=63523a1fa58d1059e9c2d9ac926873fae010a367", "patch": "@@ -0,0 +1,39 @@\n+! { dg-do compile }\n+!\n+! PR fortran/34657\n+!\n+module test_mod\n+interface\n+  subroutine my_sub (a)\n+    real a\n+  end subroutine\n+end interface\n+end module\n+\n+subroutine my_sub (a)\n+  use test_mod ! { dg-error \"is also the name of the current program unit\" }\n+  real a\n+  print *, a\n+end subroutine\n+\n+\n+module test_mod2\n+  integer :: my_sub2\n+end module\n+\n+subroutine my_sub2 (a)\n+  use test_mod2 ! { dg-error \"is also the name of the current program unit\" }\n+  real a\n+  print *, a\n+end subroutine\n+\n+\n+subroutine my_sub3 (a)\n+  use test_mod2, my_sub3 => my_sub2  ! { dg-error \"is also the name of the current program unit\" }\n+  real a\n+  print *, a\n+end subroutine\n+\n+END\n+\n+! { dg-final { cleanup-modules \"test_mod test_mod2\" } }"}]}