{"sha": "d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDI1OWIyMzRhMzAxYWE1YzA2Y2E3ODI2MmFlODE0YjNkOGQwZjFhNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-03-08T20:05:21Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-03-08T20:05:21Z"}, "message": "re PR sanitizer/70135 (-fsanitize=undefined causes static_assert to fail)\n\n\tPR c++/70135\n\t* constexpr.c (cxx_eval_loop_expr): Forget saved values of SAVE_EXPRs\n\teven after the last iteration of the loop.\n\n\t* g++.dg/cpp1y/constexpr-loop4.C: New test.\n\t* g++.dg/ubsan/pr70135.C: New test.\n\nFrom-SVN: r234064", "tree": {"sha": "897ce2c797917765609e86f7a7499d60e9903ecf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/897ce2c797917765609e86f7a7499d60e9903ecf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "56aae4b7c0d088f2b1056b41ba1f502d93550020", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56aae4b7c0d088f2b1056b41ba1f502d93550020", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56aae4b7c0d088f2b1056b41ba1f502d93550020"}], "stats": {"total": 77, "additions": 74, "deletions": 3}, "files": [{"sha": "5906ceb9e3b124a1cdfa22287a7f6a83631cfee8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "patch": "@@ -1,5 +1,9 @@\n 2016-03-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/70135\n+\t* constexpr.c (cxx_eval_loop_expr): Forget saved values of SAVE_EXPRs\n+\teven after the last iteration of the loop.\n+\n \t* decl.c (duplicate_decls): Fix spelling - becuase -> because.\n \n 2016-03-07  Patrick Palka  <ppalka@gcc.gnu.org>"}, {"sha": "7f3edcf431e9721aecba2cb2c4c79cee44032e95", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "patch": "@@ -3165,21 +3165,21 @@ cxx_eval_loop_expr (const constexpr_ctx *ctx, tree t,\n   constexpr_ctx new_ctx = *ctx;\n \n   tree body = TREE_OPERAND (t, 0);\n-  while (true)\n+  do\n     {\n       hash_set<tree> save_exprs;\n       new_ctx.save_exprs = &save_exprs;\n \n       cxx_eval_statement_list (&new_ctx, body,\n \t\t\t       non_constant_p, overflow_p, jump_target);\n-      if (returns (jump_target) || breaks (jump_target) || *non_constant_p)\n-\tbreak;\n \n       /* Forget saved values of SAVE_EXPRs.  */\n       for (hash_set<tree>::iterator iter = save_exprs.begin();\n \t   iter != save_exprs.end(); ++iter)\n \tnew_ctx.values->remove (*iter);\n     }\n+  while (!returns (jump_target) && !breaks (jump_target) && !*non_constant_p);\n+\n   if (breaks (jump_target))\n     *jump_target = NULL_TREE;\n "}, {"sha": "51494140033f89a53229a564dea75d5256fd26a9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "patch": "@@ -1,5 +1,9 @@\n 2016-03-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/70135\n+\t* g++.dg/cpp1y/constexpr-loop4.C: New test.\n+\t* g++.dg/ubsan/pr70135.C: New test.\n+\n \tPR target/70110\n \t* gcc.dg/pr70110.c: New test.\n "}, {"sha": "67f7cfa1d1d689e794633c40c197ba9d8b18c884", "filename": "gcc/testsuite/g++.dg/cpp1y/constexpr-loop4.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-loop4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-loop4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fconstexpr-loop4.C?ref=d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "patch": "@@ -0,0 +1,27 @@\n+// { dg-do compile { target c++14 } }\n+\n+struct A\n+{\n+  int i;\n+};\n+\n+constexpr bool f()\n+{\n+  A ar[5] = { 6, 7, 8, 9, 10 };\n+  A *ap = ar;\n+  int i = 0, j = 0;\n+  for (j = 0; j < 2; j++)\n+    {\n+      do\n+\t*ap++ = A{i};\n+      while (++i < j * 2 + 2);\n+    }\n+  return (ar[0].i == 0\n+\t  && ar[1].i == 1\n+\t  && ar[2].i == 2\n+\t  && ar[3].i == 3\n+\t  && ar[4].i == 10);\n+}\n+\n+#define SA(X) static_assert((X),#X)\n+SA(f());"}, {"sha": "340334a15e4abb6de938fc8d9cb5eb74a7ef55ea", "filename": "gcc/testsuite/g++.dg/ubsan/pr70135.C", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr70135.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d259b234a301aa5c06ca78262ae814b3d8d0f1a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr70135.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr70135.C?ref=d259b234a301aa5c06ca78262ae814b3d8d0f1a5", "patch": "@@ -0,0 +1,36 @@\n+// PR c++/70135\n+// { dg-do run }\n+// { dg-options \"-fsanitize=bounds -std=c++14\" }\n+\n+template <bool... b>\n+struct S {\n+  static constexpr bool c[] {b...};\n+  static constexpr auto foo ()\n+  {\n+    unsigned long n = 0;\n+    for (unsigned long i = 0; i < sizeof (c); i++)\n+      if (!c[i])\n+\t++n;\n+    return n;\n+  }\n+  static constexpr auto n = foo () + 1;\n+  static constexpr auto bar ()\n+  {\n+    int h = 0;\n+    for (int g = 0, i = 0; g < n; ++g)\n+      {\n+\twhile (i < sizeof...(b) && c[i++])\n+\t  ++h;\n+\th += 64;\n+      }\n+    return h;\n+  }\n+};\n+\n+int\n+main ()\n+{\n+  S <true, false, false, true, true, true, false, true> s;\n+  constexpr auto c = s.bar ();\n+  static_assert (s.bar () == 4 * 64 + 5);\n+}"}]}