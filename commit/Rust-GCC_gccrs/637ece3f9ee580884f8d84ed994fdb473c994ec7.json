{"sha": "637ece3f9ee580884f8d84ed994fdb473c994ec7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM3ZWNlM2Y5ZWU1ODA4ODRmOGQ4NGVkOTk0ZmRiNDczYzk5NGVjNw==", "commit": {"author": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2015-02-23T23:35:31Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gcc.gnu.org", "date": "2015-02-23T23:35:31Z"}, "message": "xtensa: align data naturally when optimizing for size\n\ngcc for xtensa always aligns data at least to a word boundary, even when\nit has smaller natural alignment. This results in unexpectedly high data\nsection sizes and unreasonable amount of wasted space when linking\nobjects compiled with -fdata-sections flag.\n\nAlign data naturally when optimization for size is enabled.\n\n2015-02-22  Max Filippov  <jcmvbkbc@gmail.com>\n\ngcc/\n\t* config/xtensa/xtensa.h (CONSTANT_ALIGNMENT, DATA_ALIGNMENT):\n\tuse natural alignment when optimizing for size.\n\nFrom-SVN: r220923", "tree": {"sha": "2e92c72cacbb04347e18f4c1d7263fb718ba9fea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e92c72cacbb04347e18f4c1d7263fb718ba9fea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/637ece3f9ee580884f8d84ed994fdb473c994ec7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/637ece3f9ee580884f8d84ed994fdb473c994ec7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/637ece3f9ee580884f8d84ed994fdb473c994ec7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/637ece3f9ee580884f8d84ed994fdb473c994ec7/comments", "author": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "708c7f7fb884199b55bede6d00bd7ed6021e6dbf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/708c7f7fb884199b55bede6d00bd7ed6021e6dbf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/708c7f7fb884199b55bede6d00bd7ed6021e6dbf"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "02e60b77dc209736e587ed456cabfd04a68e70d6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637ece3f9ee580884f8d84ed994fdb473c994ec7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637ece3f9ee580884f8d84ed994fdb473c994ec7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=637ece3f9ee580884f8d84ed994fdb473c994ec7", "patch": "@@ -1,3 +1,8 @@\n+2015-02-22  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* config/xtensa/xtensa.h (CONSTANT_ALIGNMENT, DATA_ALIGNMENT):\n+\tuse natural alignment when optimizing for size.\n+\n 2015-02-23  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \tPR target/65153"}, {"sha": "74ca240b4e6e78ea941fd460ad9399877643d438", "filename": "gcc/config/xtensa/xtensa.h", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637ece3f9ee580884f8d84ed994fdb473c994ec7/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637ece3f9ee580884f8d84ed994fdb473c994ec7/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.h?ref=637ece3f9ee580884f8d84ed994fdb473c994ec7", "patch": "@@ -174,7 +174,8 @@ extern unsigned xtensa_current_frame_size;\n    constants to be word aligned so that 'strcpy' calls that copy\n    constants can be done inline.  */\n #define CONSTANT_ALIGNMENT(EXP, ALIGN)\t\t\t\t\t\\\n-  ((TREE_CODE (EXP) == STRING_CST || TREE_CODE (EXP) == CONSTRUCTOR)\t\\\n+  (!optimize_size &&\t\t\t\t\t\t\t\\\n+   (TREE_CODE (EXP) == STRING_CST || TREE_CODE (EXP) == CONSTRUCTOR)\t\\\n    && (ALIGN) < BITS_PER_WORD\t\t\t\t\t\t\\\n \t? BITS_PER_WORD\t\t\t\t\t\t\t\\\n \t: (ALIGN))\n@@ -186,7 +187,7 @@ extern unsigned xtensa_current_frame_size;\n    that copy constants to character arrays can be done inline.  */\n #undef DATA_ALIGNMENT\n #define DATA_ALIGNMENT(TYPE, ALIGN)\t\t\t\t\t\\\n-  ((((ALIGN) < BITS_PER_WORD)\t\t\t\t\t\t\\\n+  (!optimize_size && (((ALIGN) < BITS_PER_WORD)\t\t\t\t\\\n     && (TREE_CODE (TYPE) == ARRAY_TYPE\t\t\t\t\t\\\n \t|| TREE_CODE (TYPE) == UNION_TYPE\t\t\t\t\\\n \t|| TREE_CODE (TYPE) == RECORD_TYPE)) ? BITS_PER_WORD : (ALIGN))"}]}