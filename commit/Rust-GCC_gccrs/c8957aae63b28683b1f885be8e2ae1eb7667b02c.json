{"sha": "c8957aae63b28683b1f885be8e2ae1eb7667b02c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzg5NTdhYWU2M2IyODY4M2IxZjg4NWJlOGUyYWUxZWI3NjY3YjAyYw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-05-15T10:41:15Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-05-15T10:41:15Z"}, "message": "[multiple changes]\n\n2012-05-15  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* exp_ch9.adb (Expand_N_Asynchronous_Select): Extract the statements\n\tof the abortable part and triggering alternative after being processed\n\tfor controlled objects.\n\t(Expand_N_Timed_Entry_Call): Code and comment reformatting.\n\n2012-05-15  Robert Dewar  <dewar@adacore.com>\n\n\t* sem_util.adb: Minor code reorganization.\n\nFrom-SVN: r187520", "tree": {"sha": "465473a8589fa128e518de5ad85c5e708673ae10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/465473a8589fa128e518de5ad85c5e708673ae10"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c8957aae63b28683b1f885be8e2ae1eb7667b02c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8957aae63b28683b1f885be8e2ae1eb7667b02c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8957aae63b28683b1f885be8e2ae1eb7667b02c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8957aae63b28683b1f885be8e2ae1eb7667b02c/comments", "author": null, "committer": null, "parents": [{"sha": "799d0e05c71f63b11ddb7d64f314c1281fe53cfb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/799d0e05c71f63b11ddb7d64f314c1281fe53cfb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/799d0e05c71f63b11ddb7d64f314c1281fe53cfb"}], "stats": {"total": 108, "additions": 64, "deletions": 44}, "files": [{"sha": "43cf64ed4342adc696daca8b457d30917c72351a", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=c8957aae63b28683b1f885be8e2ae1eb7667b02c", "patch": "@@ -1,3 +1,14 @@\n+2012-05-15  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_ch9.adb (Expand_N_Asynchronous_Select): Extract the statements\n+\tof the abortable part and triggering alternative after being processed\n+\tfor controlled objects.\n+\t(Expand_N_Timed_Entry_Call): Code and comment reformatting.\n+\n+2012-05-15  Robert Dewar  <dewar@adacore.com>\n+\n+\t* sem_util.adb: Minor code reorganization.\n+\n 2012-05-15  Robert Dewar  <dewar@adacore.com>\n \n \t* exp_ch7.adb, exp_ch11.adb, exp_ch11.ads: Minor reformatting."}, {"sha": "b6ba237840f61df96642488cbeb73c636137824d", "filename": "gcc/ada/a-exextr.adb", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fa-exextr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fa-exextr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-exextr.adb?ref=c8957aae63b28683b1f885be8e2ae1eb7667b02c", "patch": "@@ -162,6 +162,9 @@ package body Exception_Traces is\n    -----------------------------------\n \n    procedure Unhandled_Exception_Terminate is\n+\n+      --  Comments needed on why we do things this way ??? (see RH)\n+\n       Excep : Exception_Occurrence;\n       --  This occurrence will be used to display a message after finalization.\n       --  It is necessary to save a copy here, or else the designated value"}, {"sha": "e0ea3219cff50e07f6362ecca774bac6ff54d357", "filename": "gcc/ada/exp_ch9.adb", "status": "modified", "additions": 20, "deletions": 14, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fexp_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fexp_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch9.adb?ref=c8957aae63b28683b1f885be8e2ae1eb7667b02c", "patch": "@@ -6595,15 +6595,14 @@ package body Exp_Ch9 is\n    --  see Expand_N_Entry_Call_Statement.\n \n    procedure Expand_N_Asynchronous_Select (N : Node_Id) is\n-      Loc    : constant Source_Ptr := Sloc (N);\n-      Abrt   : constant Node_Id    := Abortable_Part (N);\n-      Astats : constant List_Id    := Statements (Abrt);\n-      Trig   : constant Node_Id    := Triggering_Alternative (N);\n-      Tstats : constant List_Id    := Statements (Trig);\n+      Loc  : constant Source_Ptr := Sloc (N);\n+      Abrt : constant Node_Id    := Abortable_Part (N);\n+      Trig : constant Node_Id    := Triggering_Alternative (N);\n \n       Abort_Block_Ent   : Entity_Id;\n       Abortable_Block   : Node_Id;\n       Actuals           : List_Id;\n+      Astats            : List_Id;\n       Blk_Ent           : Entity_Id;\n       Blk_Typ           : Entity_Id;\n       Call              : Node_Id;\n@@ -6635,6 +6634,7 @@ package body Exp_Ch9 is\n       Stmt              : Node_Id;\n       Stmts             : List_Id;\n       TaskE_Stmts       : List_Id;\n+      Tstats            : List_Id;\n \n       B   : Entity_Id;  --  Call status flag\n       Bnn : Entity_Id;  --  Communication block\n@@ -6648,6 +6648,12 @@ package body Exp_Ch9 is\n       Process_Statements_For_Controlled_Objects (Trig);\n       Process_Statements_For_Controlled_Objects (Abrt);\n \n+      --  Retrieve Astats and Tstats now because the finalization machinery may\n+      --  wrap them in blocks.\n+\n+      Astats := Statements (Abrt);\n+      Tstats := Statements (Trig);\n+\n       Blk_Ent := Make_Temporary (Loc, 'A');\n       Ecall   := Triggering_Statement (Trig);\n \n@@ -11881,13 +11887,6 @@ package body Exp_Ch9 is\n    procedure Expand_N_Timed_Entry_Call (N : Node_Id) is\n       Loc : constant Source_Ptr := Sloc (N);\n \n-      E_Call  : Node_Id :=\n-                  Entry_Call_Statement (Entry_Call_Alternative (N));\n-      E_Stats : List_Id;  --  statements after entry call\n-      D_Stat  : Node_Id :=\n-                  Delay_Statement (Delay_Alternative (N));\n-      D_Stats : List_Id;  --  statements after \"delay ...\"\n-\n       Actuals        : List_Id;\n       Blk_Typ        : Entity_Id;\n       Call           : Node_Id;\n@@ -11896,9 +11895,13 @@ package body Exp_Ch9 is\n       Concval        : Node_Id;\n       D_Conv         : Node_Id;\n       D_Disc         : Node_Id;\n+      D_Stat         : Node_Id;\n+      D_Stats        : List_Id;\n       D_Type         : Entity_Id;\n       Decls          : List_Id;\n       Dummy          : Node_Id;\n+      E_Call         : Node_Id;\n+      E_Stats        : List_Id;\n       Ename          : Node_Id;\n       Formals        : List_Id;\n       Index          : Node_Id;\n@@ -11928,11 +11931,14 @@ package body Exp_Ch9 is\n          return;\n       end if;\n \n+      E_Call := Entry_Call_Statement (Entry_Call_Alternative (N));\n+      D_Stat := Delay_Statement (Delay_Alternative (N));\n+\n       Process_Statements_For_Controlled_Objects (Entry_Call_Alternative (N));\n       Process_Statements_For_Controlled_Objects (Delay_Alternative (N));\n \n-      --  Must fetch E_Stats/D_Stats after above \"Process_...\", because it\n-      --  might modify them.\n+      --  Retrieve E_Stats and D_Stats now because the finalization machinery\n+      --  may wrap them in blocks.\n \n       E_Stats := Statements (Entry_Call_Alternative (N));\n       D_Stats := Statements (Delay_Alternative (N));"}, {"sha": "747636d69c112fc7b3473de73311f3a2d62ac20b", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=c8957aae63b28683b1f885be8e2ae1eb7667b02c", "patch": "@@ -2509,9 +2509,9 @@ package body Sem_Ch6 is\n       --  Previously we scanned the body to look for nested subprograms, and\n       --  rejected an inline directive if nested subprograms were present,\n       --  because the back-end would generate conflicting symbols for the\n-      --  nested bodies.  This is now unecessary.\n+      --  nested bodies. This is now unnecessary.\n \n-      --  Look ahead to recognize a pragma inline that appears after the body\n+      --  Look ahead to recognize a pragma Inline that appears after the body\n \n       Check_Inline_Pragma (Spec_Id);\n "}, {"sha": "21e16ac1245e020ae9e57a9700df3c8b7dae1ee1", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 24, "deletions": 24, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=c8957aae63b28683b1f885be8e2ae1eb7667b02c", "patch": "@@ -3039,11 +3039,33 @@ package body Sem_Util is\n         and then Is_Entity_Name (Renamed_Object (Id))\n       then\n          return Effective_Extra_Accessibility (Entity (Renamed_Object (Id)));\n+      else\n+         return Extra_Accessibility (Id);\n       end if;\n-\n-      return Extra_Accessibility (Id);\n    end Effective_Extra_Accessibility;\n \n+   ------------------------------\n+   -- Enclosing_Comp_Unit_Node --\n+   ------------------------------\n+\n+   function Enclosing_Comp_Unit_Node (N : Node_Id) return Node_Id is\n+      Current_Node : Node_Id;\n+\n+   begin\n+      Current_Node := N;\n+      while Present (Current_Node)\n+        and then Nkind (Current_Node) /= N_Compilation_Unit\n+      loop\n+         Current_Node := Parent (Current_Node);\n+      end loop;\n+\n+      if Nkind (Current_Node) /= N_Compilation_Unit then\n+         return Empty;\n+      else\n+         return Current_Node;\n+      end if;\n+   end Enclosing_Comp_Unit_Node;\n+\n    --------------------------\n    -- Enclosing_CPP_Parent --\n    --------------------------\n@@ -3165,28 +3187,6 @@ package body Sem_Util is\n       return Unit_Entity;\n    end Enclosing_Lib_Unit_Entity;\n \n-   ------------------------------\n-   -- Enclosing_Comp_Unit_Node --\n-   ------------------------------\n-\n-   function Enclosing_Comp_Unit_Node (N : Node_Id) return Node_Id is\n-      Current_Node : Node_Id;\n-\n-   begin\n-      Current_Node := N;\n-      while Present (Current_Node)\n-        and then Nkind (Current_Node) /= N_Compilation_Unit\n-      loop\n-         Current_Node := Parent (Current_Node);\n-      end loop;\n-\n-      if Nkind (Current_Node) /= N_Compilation_Unit then\n-         return Empty;\n-      end if;\n-\n-      return Current_Node;\n-   end Enclosing_Comp_Unit_Node;\n-\n    -----------------------\n    -- Enclosing_Package --\n    -----------------------"}, {"sha": "73998a952ec2fbad1ea81a682db0c98b8d516954", "filename": "gcc/ada/sem_util.ads", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fsem_util.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8957aae63b28683b1f885be8e2ae1eb7667b02c/gcc%2Fada%2Fsem_util.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.ads?ref=c8957aae63b28683b1f885be8e2ae1eb7667b02c", "patch": "@@ -368,6 +368,10 @@ package Sem_Util is\n    --  Same as Einfo.Extra_Accessibility except thtat object renames\n    --  are looked through.\n \n+   function Enclosing_Comp_Unit_Node (N : Node_Id) return Node_Id;\n+   --  Returns the enclosing N_Compilation_Unit Node that is the root of a\n+   --  subtree containing N.\n+\n    function Enclosing_CPP_Parent (Typ : Entity_Id) return Entity_Id;\n    --  Returns the closest ancestor of Typ that is a CPP type.\n \n@@ -386,10 +390,6 @@ package Sem_Util is\n    --  root of the current scope (which must not be Standard_Standard, and the\n    --  caller is responsible for ensuring this condition).\n \n-   function Enclosing_Comp_Unit_Node (N : Node_Id) return Node_Id;\n-   --  Returns the enclosing N_Compilation_Unit Node that is the root of a\n-   --  subtree containing N.\n-\n    function Enclosing_Package (E : Entity_Id) return Entity_Id;\n    --  Utility function to return the Ada entity of the package enclosing\n    --  the entity E, if any. Returns Empty if no enclosing package."}]}