{"sha": "ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "node_id": "C_kwDOANBUbNoAKGNjZmQxZTdmMGQ5Njg2YWE5MzFlNjVhMDQ4NDVhNzQzNmY4NWQ3MWM", "commit": {"author": {"name": "Srinath Parvathaneni", "email": "srinath.parvathaneni@arm.com", "date": "2023-01-23T11:00:26Z"}, "committer": {"name": "Srinath Parvathaneni", "email": "srinath.parvathaneni@arm.com", "date": "2023-01-23T11:03:00Z"}, "message": "arm: Add support for Arm Cortex-M85 CPU.\n\nThis patch adds the -mcpu support for the Arm Cortex-M85 CPU which is\nan Armv8.1-M Mainline CPU supporting MVE and PACBTI by default.\n\n-mpcu=cortex-m85 switch by default matches to -march=armv8.1-m.main+pacbti+mve.fp+fp.dp.\n\nAlso following options are provided to disable default features.\n+nomve.fp (disables MVE Floating point)\n+nomve (disables MVE Integer and MVE Floating point)\n+nodsp (disables dsp, MVE Integer and MVE Floating point)\n+nopacbti (disables pacbti)\n+nofp (disables floating point and MVE floating point)\n\ngcc/ChangeLog:\n\n2022-08-12  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n\n\t* config/arm/arm-cpus.in (cortex-m85): Define new CPU.\n\t* config/arm/arm-tables.opt: Regenerate.\n\t* config/arm/arm-tune.md: Likewise.\n\t* doc/invoke.texi (Arm Options): Document -mcpu=cortex-m85.\n\t* (-mfix-cmse-cve-2021-35465): Likewise.\n\ngcc/testsuite/ChangeLog:\n\n2022-08-12  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n\n\t* gcc.target/arm/multilib.exp: Add tests for cortex-m85.", "tree": {"sha": "74de4f7ed5fd628b4de68a0b93953cb2e62f5dfd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74de4f7ed5fd628b4de68a0b93953cb2e62f5dfd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/comments", "author": {"login": "sripar01", "id": 115715849, "node_id": "U_kgDOBuWvCQ", "avatar_url": "https://avatars.githubusercontent.com/u/115715849?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sripar01", "html_url": "https://github.com/sripar01", "followers_url": "https://api.github.com/users/sripar01/followers", "following_url": "https://api.github.com/users/sripar01/following{/other_user}", "gists_url": "https://api.github.com/users/sripar01/gists{/gist_id}", "starred_url": "https://api.github.com/users/sripar01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sripar01/subscriptions", "organizations_url": "https://api.github.com/users/sripar01/orgs", "repos_url": "https://api.github.com/users/sripar01/repos", "events_url": "https://api.github.com/users/sripar01/events{/privacy}", "received_events_url": "https://api.github.com/users/sripar01/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sripar01", "id": 115715849, "node_id": "U_kgDOBuWvCQ", "avatar_url": "https://avatars.githubusercontent.com/u/115715849?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sripar01", "html_url": "https://github.com/sripar01", "followers_url": "https://api.github.com/users/sripar01/followers", "following_url": "https://api.github.com/users/sripar01/following{/other_user}", "gists_url": "https://api.github.com/users/sripar01/gists{/gist_id}", "starred_url": "https://api.github.com/users/sripar01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sripar01/subscriptions", "organizations_url": "https://api.github.com/users/sripar01/orgs", "repos_url": "https://api.github.com/users/sripar01/repos", "events_url": "https://api.github.com/users/sripar01/events{/privacy}", "received_events_url": "https://api.github.com/users/sripar01/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ad4f8c4e375dd7603382ed3ff95bd184e1959918", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad4f8c4e375dd7603382ed3ff95bd184e1959918", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad4f8c4e375dd7603382ed3ff95bd184e1959918"}], "stats": {"total": 80, "additions": 64, "deletions": 16}, "files": [{"sha": "f1fa3fa174ced6d479e1b339aea80a65eb765667", "filename": "gcc/config/arm/arm-cpus.in", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fconfig%2Farm%2Farm-cpus.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fconfig%2Farm%2Farm-cpus.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-cpus.in?ref=ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "patch": "@@ -1672,6 +1672,21 @@ begin cpu star-mc1\n  costs v7m\n end cpu star-mc1\n \n+begin cpu cortex-m85\n+ cname cortexm85\n+ tune flags LDSCHED\n+ architecture armv8.1-m.main+pacbti+mve.fp+fp.dp\n+ option nopacbti remove pacbti\n+ option nomve.fp remove mve_float\n+ option nomve remove mve mve_float\n+ option nofp remove ALL_FP mve_float\n+ option nodsp remove MVE mve_float\n+ isa quirk_no_asmcpu quirk_vlldm\n+ costs v7m\n+ part 0xd23\n+ vendor 41\n+end cpu cortex-m85\n+\n # V8 R-profile implementations.\n begin cpu cortex-r52\n  cname cortexr52"}, {"sha": "88909c2698edbe937b73286340798b492013f470", "filename": "gcc/config/arm/arm-tables.opt", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fconfig%2Farm%2Farm-tables.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fconfig%2Farm%2Farm-tables.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-tables.opt?ref=ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "patch": "@@ -288,6 +288,9 @@ Enum(processor_type) String(cortex-m55) Value( TARGET_CPU_cortexm55)\n EnumValue\n Enum(processor_type) String(star-mc1) Value( TARGET_CPU_starmc1)\n \n+EnumValue\n+Enum(processor_type) String(cortex-m85) Value( TARGET_CPU_cortexm85)\n+\n EnumValue\n Enum(processor_type) String(cortex-r52) Value( TARGET_CPU_cortexr52)\n "}, {"sha": "5e95e827911aecdc5713c860b907bf321c6f3d2c", "filename": "gcc/config/arm/arm-tune.md", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fconfig%2Farm%2Farm-tune.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fconfig%2Farm%2Farm-tune.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-tune.md?ref=ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "patch": "@@ -46,9 +46,10 @@\n \tcortexa73cortexa53,cortexa55,cortexa75,\n \tcortexa76,cortexa76ae,cortexa77,\n \tcortexa78,cortexa78ae,cortexa78c,\n-\tcortexa710,cortexx1,cortexx1c,neoversen1,\n-\tcortexa75cortexa55,cortexa76cortexa55,neoversev1,\n-\tneoversen2,cortexm23,cortexm33,\n-\tcortexm35p,cortexm55,starmc1,\n-\tcortexr52,cortexr52plus\"\n+\tcortexa710,cortexx1,cortexx1c,\n+\tneoversen1,cortexa75cortexa55,cortexa76cortexa55,\n+\tneoversev1,neoversen2,cortexm23,\n+\tcortexm33,cortexm35p,cortexm55,\n+\tstarmc1,cortexm85,cortexr52,\n+\tcortexr52plus\"\n \t(const (symbol_ref \"((enum attr_tune) arm_tune)\")))"}, {"sha": "f1c0b52012b8979070c265b7978810afe4601047", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "patch": "@@ -22097,8 +22097,8 @@ Permissible names are: @samp{arm7tdmi}, @samp{arm7tdmi-s}, @samp{arm710t},\n @samp{cortex-r7}, @samp{cortex-r8}, @samp{cortex-r52}, @samp{cortex-r52plus},\n @samp{cortex-m0}, @samp{cortex-m0plus}, @samp{cortex-m1}, @samp{cortex-m3},\n @samp{cortex-m4}, @samp{cortex-m7}, @samp{cortex-m23}, @samp{cortex-m33},\n-@samp{cortex-m35p}, @samp{cortex-m55}, @samp{cortex-x1}, @samp{cortex-x1c},\n-@samp{cortex-m1.small-multiply}, @samp{cortex-m0.small-multiply},\n+@samp{cortex-m35p}, @samp{cortex-m55}, @samp{cortex-m85}, @samp{cortex-x1},\n+@samp{cortex-x1c}, @samp{cortex-m1.small-multiply}, @samp{cortex-m0.small-multiply},\n @samp{cortex-m0plus.small-multiply}, @samp{exynos-m1}, @samp{marvell-pj4},\n @samp{neoverse-n1}, @samp{neoverse-n2}, @samp{neoverse-v1}, @samp{xscale},\n @samp{iwmmxt}, @samp{iwmmxt2}, @samp{ep9312}, @samp{fa526}, @samp{fa626},\n@@ -22162,17 +22162,22 @@ The following extension options are common to the listed CPUs:\n \n @table @samp\n @item +nodsp\n-Disable the DSP instructions on @samp{cortex-m33}, @samp{cortex-m35p}\n-and @samp{cortex-m55}. Also disable the M-Profile Vector Extension (MVE)\n-integer and single precision floating-point instructions on @samp{cortex-m55}.\n+Disable the DSP instructions on @samp{cortex-m33}, @samp{cortex-m35p},\n+@samp{cortex-m55} and @samp{cortex-m85}. Also disable the M-Profile Vector\n+Extension (MVE) integer and single precision floating-point instructions on\n+@samp{cortex-m55} and @samp{cortex-m85}.\n+\n+@item +nopacbti\n+Disable the Pointer Authentication and Branch Target Identification Extension\n+on @samp{cortex-m85}.\n \n @item +nomve\n Disable the M-Profile Vector Extension (MVE) integer and single precision\n-floating-point instructions on @samp{cortex-m55}.\n+floating-point instructions on @samp{cortex-m55} and @samp{cortex-m85}.\n \n @item +nomve.fp\n Disable the M-Profile Vector Extension (MVE) single precision floating-point\n-instructions on @samp{cortex-m55}.\n+instructions on @samp{cortex-m55} and @samp{cortex-m85}.\n \n @item +cdecp0, +cdecp1, ... , +cdecp7\n Enable the Custom Datapath Extension (CDE) on selected coprocessors according\n@@ -22184,7 +22189,8 @@ Disables the floating-point instructions on @samp{arm9e},\n @samp{arm1020e}, @samp{arm1022e}, @samp{arm926ej-s},\n @samp{arm1026ej-s}, @samp{cortex-r5}, @samp{cortex-r7}, @samp{cortex-r8},\n @samp{cortex-m4}, @samp{cortex-m7}, @samp{cortex-m33}, @samp{cortex-m35p}\n-and @samp{cortex-m55}.\n+@samp{cortex-m4}, @samp{cortex-m7}, @samp{cortex-m33}, @samp{cortex-m35p},\n+@samp{cortex-m55} and @samp{cortex-m85}.\n Disables the floating-point and SIMD instructions on\n @samp{generic-armv7-a}, @samp{cortex-a5}, @samp{cortex-a7},\n @samp{cortex-a8}, @samp{cortex-a9}, @samp{cortex-a12},\n@@ -22524,9 +22530,9 @@ Development Tools Engineering Specification\", which can be found on\n Mitigate against a potential security issue with the @code{VLLDM} instruction\n in some M-profile devices when using CMSE (CVE-2021-365465).  This option is\n enabled by default when the option @option{-mcpu=} is used with\n-@code{cortex-m33}, @code{cortex-m35p}, @code{cortex-m55} or @code{star-mc1}.\n-The option @option{-mno-fix-cmse-cve-2021-35465} can be used to disable\n-the mitigation.\n+@code{cortex-m33}, @code{cortex-m35p}, @code{cortex-m55}, @code{cortex-m85}\n+or @code{star-mc1}. The option @option{-mno-fix-cmse-cve-2021-35465} can be used\n+to disable the mitigation.\n \n @item -mstack-protector-guard=@var{guard}\n @itemx -mstack-protector-guard-offset=@var{offset}"}, {"sha": "8442f45306a5ee51af1a13f9c842c61fbf6e060a", "filename": "gcc/testsuite/gcc.target/arm/multilib.exp", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ccfd1e7f0d9686aa931e65a04845a7436f85d71c/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp?ref=ccfd1e7f0d9686aa931e65a04845a7436f85d71c", "patch": "@@ -524,6 +524,11 @@ if {[multilib_config \"rmprofile\"] } {\n \t{-mcpu=cortex-m23 -mfpu=fpv5-d16 -mfloat-abi=soft} \"thumb/v8-m.base/nofp\"\n \t{-mcpu=cortex-m33 -mfpu=fpv5-d16 -mfloat-abi=soft} \"thumb/v8-m.main/nofp\"\n \t{-mcpu=cortex-m7+nofp.dp -mfpu=fpv5-d16 -mfloat-abi=soft} \"thumb/v7e-m/nofp\"\n+\t{-mcpu=cortex-m85+nopacbti -mfpu=auto -mfloat-abi=soft} \"thumb/v8-m.main/nofp\"\n+\t{-mcpu=cortex-m85+nopacbti+nofp -mfpu=auto -mfloat-abi=soft} \"thumb/v8-m.main/nofp\"\n+\t{-mcpu=cortex-m85+nopacbti+nomve -mfpu=auto -mfloat-abi=soft} \"thumb/v8-m.main/nofp\"\n+\t{-mcpu=cortex-m85+nopacbti+nodsp -mfpu=auto -mfloat-abi=soft} \"thumb/v8-m.main/nofp\"\n+\t{-mcpu=cortex-m85+nopacbti+nomve.fp -mfpu=auto -mfloat-abi=soft} \"thumb/v8-m.main/nofp\"\n \t{-mcpu=cortex-m4 -mfpu=auto -mfloat-abi=hard} \"thumb/v7e-m+fp/hard\"\n \t{-mcpu=cortex-m7 -mfpu=auto -mfloat-abi=hard} \"thumb/v7e-m+dp/hard\"\n \t{-mcpu=cortex-m33 -mfpu=auto -mfloat-abi=hard} \"thumb/v8-m.main+fp/hard\"\n@@ -549,6 +554,15 @@ if {[multilib_config \"rmprofile\"] } {\n \t{-mcpu=cortex-m7 -mfpu=fpv5-d16 -mfloat-abi=hard} \"thumb/v7e-m+dp/hard\"\n \t{-mcpu=cortex-m33 -mfpu=fpv5-d16 -mfloat-abi=hard} \"thumb/v8-m.main+dp/hard\"\n \t{-mcpu=cortex-m7+nofp.dp -mfpu=fpv5-d16 -mfloat-abi=hard} \"thumb/v7e-m+dp/hard\"\n+\t{-mcpu=cortex-m85+nopacbti -mfpu=auto -mfloat-abi=hard} \"thumb/v8-m.main+dp/hard\"\n+\t{-mcpu=cortex-m85+nopacbti+nomve -mfpu=auto -mfloat-abi=hard} \"thumb/v8-m.main+dp/hard\"\n+\t{-mcpu=cortex-m85+nopacbti+nodsp -mfpu=auto -mfloat-abi=hard} \"thumb/v8-m.main+dp/hard\"\n+\t{-mcpu=cortex-m85+nopacbti+nofp -mfpu=auto -mfloat-abi=hard} \"thumb/v8.1-m.main+mve/hard\"\n+\t{-mcpu=cortex-m85+nopacbti+nomve.fp -mfpu=auto -mfloat-abi=hard} \"thumb/v8-m.main+dp/hard\"\n+\t{-mcpu=cortex-m85 -mbranch-protection=standard -mfpu=auto -mfloat-abi=hard} \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/hard\"\n+\t{-mcpu=cortex-m85+nomve.fp -mbranch-protection=standard -mfpu=auto -mfloat-abi=hard}  \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/hard\"\n+\t{-mcpu=cortex-m85+nomve -mbranch-protection=standard -mfpu=auto -mfloat-abi=hard}  \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/hard\"\n+\t{-mcpu=cortex-m85+nodsp -mbranch-protection=standard -mfpu=auto -mfloat-abi=hard}  \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/hard\"\n \t{-mcpu=cortex-m0 -mfpu=auto -mfloat-abi=softfp} \"thumb/v6-m/nofp\"\n \t{-mcpu=cortex-m1 -mfpu=auto -mfloat-abi=softfp} \"thumb/v6-m/nofp\"\n \t{-mcpu=cortex-m3 -mfpu=auto -mfloat-abi=softfp} \"thumb/v7-m/nofp\"\n@@ -598,6 +612,15 @@ if {[multilib_config \"rmprofile\"] } {\n \t{-mcpu=cortex-m23 -mfpu=fpv5-d16 -mfloat-abi=softfp} \"thumb/v8-m.base/nofp\"\n \t{-mcpu=cortex-m33 -mfpu=fpv5-d16 -mfloat-abi=softfp} \"thumb/v8-m.main+dp/softfp\"\n \t{-mcpu=cortex-m7+nofp.dp -mfpu=fpv5-d16 -mfloat-abi=softfp} \"thumb/v7e-m+dp/softfp\"\n+\t{-mcpu=cortex-m85+nopacbti+nofp -mfpu=auto -mfloat-abi=softfp} \"thumb/v8-m.main/nofp\"\n+\t{-mcpu=cortex-m85+nopacbti -mfpu=auto -mfloat-abi=softfp}  \"thumb/v8-m.main+dp/softfp\"\n+\t{-mcpu=cortex-m85+nopacbti+nomve -mfpu=auto -mfloat-abi=softfp} \"thumb/v8-m.main+dp/softfp\"\n+\t{-mcpu=cortex-m85+nopacbti+nodsp -mfpu=auto -mfloat-abi=softfp} \"thumb/v8-m.main+dp/softfp\"\n+\t{-mcpu=cortex-m85+nopacbti+nomve.fp -mfpu=auto -mfloat-abi=softfp} \"thumb/v8-m.main+dp/softfp\"\n+\t{-mcpu=cortex-m85 -mbranch-protection=standard -mfpu=auto -mfloat-abi=softfp} \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/softfp\"\n+\t{-mcpu=cortex-m85+nomve.fp -mbranch-protection=standard -mfpu=auto -mfloat-abi=softfp}  \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/softfp\"\n+\t{-mcpu=cortex-m85+nomve -mbranch-protection=standard -mfpu=auto -mfloat-abi=softfp}  \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/softfp\"\n+\t{-mcpu=cortex-m85+nodsp -mbranch-protection=standard -mfpu=auto -mfloat-abi=softfp}  \"thumb/v8.1-m.main+pacbti+dp/mbranch-protection/softfp\"\n \t{-march=armv6-m -mfpu=auto -mfloat-abi=soft} \"thumb/v6-m/nofp\"\n \t{-march=armv7-m -mfpu=auto -mfloat-abi=soft} \"thumb/v7-m/nofp\"\n \t{-march=armv7e-m -mfpu=auto -mfloat-abi=soft} \"thumb/v7e-m/nofp\""}]}