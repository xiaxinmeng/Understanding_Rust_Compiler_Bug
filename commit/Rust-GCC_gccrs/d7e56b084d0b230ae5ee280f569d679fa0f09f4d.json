{"sha": "d7e56b084d0b230ae5ee280f569d679fa0f09f4d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDdlNTZiMDg0ZDBiMjMwYWU1ZWUyODBmNTY5ZDY3OWZhMGYwOWY0ZA==", "commit": {"author": {"name": "YunQiang Su", "email": "yunqiang.su@cipunited.com", "date": "2021-08-28T12:17:18Z"}, "committer": {"name": "YunQiang Su", "email": "syq@debian.org", "date": "2021-08-30T08:03:59Z"}, "message": "libffi: Fix MIPS r6 support\n\nfor some instructions, MIPS r6 uses different encoding other than\nthe previous releases.\n\n1. mips/n32.S disable .set mips4: since it casuses old insn encoding\n   is used.\n   https://github.com/libffi/libffi/pull/396 has been accepted as:\n     94c102aa69b04337f63498e0e6551fcdce549ae5\n2. mips/ffi.c: the encoding for JR is hardcoded: we need to use\n   different value for r6 and pre-r6.\n   https://github.com/libffi/libffi/pull/401 has been accpeted as:\n     746dbe3a6a79a41931c03b51df2972be4d5e5028\n\nlibffi/\n\tPR libffi/83636\n\t* src/mips/n32.S: disable .set mips4\n\t* src/mips/ffi.c: use different JR encoding for r6.", "tree": {"sha": "bf80e0ed85b73d06df8c9f949edbb2d904f6a3bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bf80e0ed85b73d06df8c9f949edbb2d904f6a3bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d7e56b084d0b230ae5ee280f569d679fa0f09f4d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7e56b084d0b230ae5ee280f569d679fa0f09f4d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7e56b084d0b230ae5ee280f569d679fa0f09f4d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7e56b084d0b230ae5ee280f569d679fa0f09f4d/comments", "author": null, "committer": {"login": "wzssyqa", "id": 163337, "node_id": "MDQ6VXNlcjE2MzMzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/163337?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wzssyqa", "html_url": "https://github.com/wzssyqa", "followers_url": "https://api.github.com/users/wzssyqa/followers", "following_url": "https://api.github.com/users/wzssyqa/following{/other_user}", "gists_url": "https://api.github.com/users/wzssyqa/gists{/gist_id}", "starred_url": "https://api.github.com/users/wzssyqa/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wzssyqa/subscriptions", "organizations_url": "https://api.github.com/users/wzssyqa/orgs", "repos_url": "https://api.github.com/users/wzssyqa/repos", "events_url": "https://api.github.com/users/wzssyqa/events{/privacy}", "received_events_url": "https://api.github.com/users/wzssyqa/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7218c2ec365ce95f5a1012a6eb425b0a36aec6bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7218c2ec365ce95f5a1012a6eb425b0a36aec6bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7218c2ec365ce95f5a1012a6eb425b0a36aec6bf"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "ecd783a56c553bd9d2a49c58b2d463969a4bf481", "filename": "libffi/src/mips/ffi.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7e56b084d0b230ae5ee280f569d679fa0f09f4d/libffi%2Fsrc%2Fmips%2Fffi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7e56b084d0b230ae5ee280f569d679fa0f09f4d/libffi%2Fsrc%2Fmips%2Fffi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fmips%2Fffi.c?ref=d7e56b084d0b230ae5ee280f569d679fa0f09f4d", "patch": "@@ -698,7 +698,11 @@ ffi_prep_closure_loc (ffi_closure *closure,\n   /* lui  $12,high(codeloc) */\n   tramp[2] = 0x3c0c0000 | ((unsigned)codeloc >> 16);\n   /* jr   $25          */\n+#if !defined(__mips_isa_rev) || (__mips_isa_rev<6)\n   tramp[3] = 0x03200008;\n+#else\n+  tramp[3] = 0x03200009;\n+#endif\n   /* ori  $12,low(codeloc)  */\n   tramp[4] = 0x358c0000 | ((unsigned)codeloc & 0xffff);\n #else\n@@ -726,7 +730,11 @@ ffi_prep_closure_loc (ffi_closure *closure,\n   /* ori  $25,low(fn)  */\n   tramp[10] = 0x37390000 | ((unsigned long)fn  & 0xffff);\n   /* jr   $25          */\n+#if !defined(__mips_isa_rev) || (__mips_isa_rev<6)\n   tramp[11] = 0x03200008;\n+#else\n+  tramp[11] = 0x03200009;\n+#endif\n   /* ori  $12,low(codeloc)  */\n   tramp[12] = 0x358c0000 | ((unsigned long)codeloc & 0xffff);\n "}, {"sha": "06e6c46076bf7c3cd697b51e6e00163c8cd7ba65", "filename": "libffi/src/mips/n32.S", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7e56b084d0b230ae5ee280f569d679fa0f09f4d/libffi%2Fsrc%2Fmips%2Fn32.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7e56b084d0b230ae5ee280f569d679fa0f09f4d/libffi%2Fsrc%2Fmips%2Fn32.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fmips%2Fn32.S?ref=d7e56b084d0b230ae5ee280f569d679fa0f09f4d", "patch": "@@ -43,7 +43,9 @@\n #ifdef __GNUC__\n \t.abicalls\n #endif\n+#if !defined(__mips_isa_rev) || (__mips_isa_rev<6)\n \t.set mips4\n+#endif\n \t.text\n \t.align\t2\n \t.globl\tffi_call_N32"}]}