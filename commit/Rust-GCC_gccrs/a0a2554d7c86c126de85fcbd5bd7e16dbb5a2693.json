{"sha": "a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693", "node_id": "C_kwDOANBUbNoAKGEwYTI1NTRkN2M4NmMxMjZkZTg1ZmNiZDViZDdlMTZkYmI1YTI2OTM", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-14T21:35:35Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-29T13:21:32Z"}, "message": "c++: using in diagnostics [PR102987]\n\nThe decl pretty-printing code wasn't looking at the flags parameter, so we\nwere printing 'using' in the middle of an expression.\n\n\tPR c++/102987\n\ngcc/cp/ChangeLog:\n\n\t* error.cc (dump_decl) [USING_DECL]: Respect flags.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/diagnostic/using1.C: Check pretty-printing.", "tree": {"sha": "e747cdf9ead6dfdc7e019bb6f48feb3058850819", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e747cdf9ead6dfdc7e019bb6f48feb3058850819"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac5b356d0567992d8863816e203c7d98b25036dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac5b356d0567992d8863816e203c7d98b25036dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac5b356d0567992d8863816e203c7d98b25036dc"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "53a9073d99bffd9c955d3632b880d2a08df10f8e", "filename": "gcc/cp/error.cc", "status": "modified", "additions": 11, "deletions": 7, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693/gcc%2Fcp%2Ferror.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693/gcc%2Fcp%2Ferror.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ferror.cc?ref=a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693", "patch": "@@ -1439,16 +1439,20 @@ dump_decl (cxx_pretty_printer *pp, tree t, int flags)\n \n     case USING_DECL:\n       {\n-\tpp_cxx_ws_string (pp, \"using\");\n-\ttree scope = USING_DECL_SCOPE (t);\n+\tif (flags & TFF_DECL_SPECIFIERS)\n+\t  pp_cxx_ws_string (pp, \"using\");\n \tbool variadic = false;\n-\tif (PACK_EXPANSION_P (scope))\n+\tif (!(flags & TFF_UNQUALIFIED_NAME))\n \t  {\n-\t    scope = PACK_EXPANSION_PATTERN (scope);\n-\t    variadic = true;\n+\t    tree scope = USING_DECL_SCOPE (t);\n+\t    if (PACK_EXPANSION_P (scope))\n+\t      {\n+\t\tscope = PACK_EXPANSION_PATTERN (scope);\n+\t\tvariadic = true;\n+\t      }\n+\t    dump_type (pp, scope, flags);\n+\t    pp_cxx_colon_colon (pp);\n \t  }\n-\tdump_type (pp, scope, flags);\n-\tpp_cxx_colon_colon (pp);\n \tdump_decl (pp, DECL_NAME (t), flags);\n \tif (variadic)\n \t  pp_cxx_ws_string (pp, \"...\");"}, {"sha": "4090dd24a60775e8300eedc3d8120b6906c7f693", "filename": "gcc/testsuite/g++.dg/diagnostic/using1.C", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fusing1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fusing1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fusing1.C?ref=a0a2554d7c86c126de85fcbd5bd7e16dbb5a2693", "patch": "@@ -7,6 +7,7 @@ struct a {\n template <typename c> struct d : c {\n   using c::e;\n   using f = d;\n+  // { dg-message \"decltype .c::e\" \"\" { target *-*-* } 0 }\n   constexpr int g(decltype(e.b())) { return buh; } // { dg-error \"buh\" }\n };\n struct h {"}]}