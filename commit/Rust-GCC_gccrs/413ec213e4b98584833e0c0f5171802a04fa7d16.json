{"sha": "413ec213e4b98584833e0c0f5171802a04fa7d16", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDEzZWMyMTNlNGI5ODU4NDgzM2UwYzBmNTE3MTgwMmEwNGZhN2QxNg==", "commit": {"author": {"name": "Jason Merrill", "email": "merrill@gnu.org", "date": "1994-06-02T22:28:22Z"}, "committer": {"name": "Jason Merrill", "email": "merrill@gnu.org", "date": "1994-06-02T22:28:22Z"}, "message": "(expand_end_bindings): Don't bother emitting cleanups\n        after a barrier.\n\nFrom-SVN: r7432", "tree": {"sha": "61caa8a05e6524ab65356e082ab819f6cd0416a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/61caa8a05e6524ab65356e082ab819f6cd0416a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/413ec213e4b98584833e0c0f5171802a04fa7d16", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/413ec213e4b98584833e0c0f5171802a04fa7d16", "html_url": "https://github.com/Rust-GCC/gccrs/commit/413ec213e4b98584833e0c0f5171802a04fa7d16", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/413ec213e4b98584833e0c0f5171802a04fa7d16/comments", "author": null, "committer": null, "parents": [{"sha": "d9e1ab8d4e8b293dea59a751c9f5b98e05898dd7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9e1ab8d4e8b293dea59a751c9f5b98e05898dd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9e1ab8d4e8b293dea59a751c9f5b98e05898dd7"}], "stats": {"total": 44, "additions": 24, "deletions": 20}, "files": [{"sha": "704dc65fafaccca48fe4dac52f759d26bc42b3c3", "filename": "gcc/stmt.c", "status": "modified", "additions": 24, "deletions": 20, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/413ec213e4b98584833e0c0f5171802a04fa7d16/gcc%2Fstmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/413ec213e4b98584833e0c0f5171802a04fa7d16/gcc%2Fstmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstmt.c?ref=413ec213e4b98584833e0c0f5171802a04fa7d16", "patch": "@@ -2955,29 +2955,33 @@ expand_end_bindings (vars, mark_ends, dont_jump_in)\n   if (thisblock->data.block.stack_level != 0\n       || thisblock->data.block.cleanups != 0)\n     {\n-      /* Don't let cleanups affect ({...}) constructs.  */\n-      int old_expr_stmts_for_value = expr_stmts_for_value;\n-      rtx old_last_expr_value = last_expr_value;\n-      tree old_last_expr_type = last_expr_type;\n-      expr_stmts_for_value = 0;\n-\n-      /* Do the cleanups.  */\n-      expand_cleanups (thisblock->data.block.cleanups, NULL_TREE);\n-      do_pending_stack_adjust ();\n+      /* Only clean up here if this point can actually be reached.  */\n+      if (GET_CODE (get_last_insn ()) != BARRIER)\n+\t{\n+\t  /* Don't let cleanups affect ({...}) constructs.  */\n+\t  int old_expr_stmts_for_value = expr_stmts_for_value;\n+\t  rtx old_last_expr_value = last_expr_value;\n+\t  tree old_last_expr_type = last_expr_type;\n+\t  expr_stmts_for_value = 0;\n+\n+\t  /* Do the cleanups.  */\n+\t  expand_cleanups (thisblock->data.block.cleanups, NULL_TREE);\n+\t  do_pending_stack_adjust ();\n \n-      expr_stmts_for_value = old_expr_stmts_for_value;\n-      last_expr_value = old_last_expr_value;\n-      last_expr_type = old_last_expr_type;\n+\t  expr_stmts_for_value = old_expr_stmts_for_value;\n+\t  last_expr_value = old_last_expr_value;\n+\t  last_expr_type = old_last_expr_type;\n \n-      /* Restore the stack level.  */\n+\t  /* Restore the stack level.  */\n \n-      if (thisblock->data.block.stack_level != 0)\n-\t{\n-\t  emit_stack_restore (thisblock->next ? SAVE_BLOCK : SAVE_FUNCTION,\n-\t\t\t      thisblock->data.block.stack_level, NULL_RTX);\n-\t  if (nonlocal_goto_handler_slot != 0)\n-\t    emit_stack_save (SAVE_NONLOCAL, &nonlocal_goto_stack_level,\n-\t\t\t     NULL_RTX);\n+\t  if (thisblock->data.block.stack_level != 0)\n+\t    {\n+\t      emit_stack_restore (thisblock->next ? SAVE_BLOCK : SAVE_FUNCTION,\n+\t\t\t\t  thisblock->data.block.stack_level, NULL_RTX);\n+\t      if (nonlocal_goto_handler_slot != 0)\n+\t\temit_stack_save (SAVE_NONLOCAL, &nonlocal_goto_stack_level,\n+\t\t\t\t NULL_RTX);\n+\t    }\n \t}\n \n       /* Any gotos out of this block must also do these things."}]}