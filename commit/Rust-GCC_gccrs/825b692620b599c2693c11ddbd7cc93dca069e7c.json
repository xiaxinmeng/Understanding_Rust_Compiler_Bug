{"sha": "825b692620b599c2693c11ddbd7cc93dca069e7c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODI1YjY5MjYyMGI1OTljMjY5M2MxMWRkYmQ3Y2M5M2RjYTA2OWU3Yw==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2001-01-12T04:54:42Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2001-01-12T04:54:42Z"}, "message": "aclocal.m4 (AC_FUNC_MMAP_ANYWHERE): Completely rewritten.\n\n2001-01-11  Zack Weinberg  <zack@wolery.stanford.edu>\n\n\t* aclocal.m4 (AC_FUNC_MMAP_ANYWHERE): Completely rewritten.\n\tNow defines HAVE_MMAP_DEV_ZERO and/or HAVE_MMAP_ANON depending\n\twhich you have.\n\t(AC_FUNC_MMAP_FILE): Don't AC_REQUIRE AC_FUNC_MMAP_ANYWHERE.\n\t* configure.in: Set GGC to ggc-page if any of mmap_dev_zero,\n\tmmap_anon, and valloc is available.\n\t* ggc-page.c: Restructure ifdef logic to match new autoconf\n\tspec.  Don't throw away the test page in init_ggc.\n\n\t* configure, config.in: Regenerate.\n\nFrom-SVN: r38934", "tree": {"sha": "9381534d80452c32494066d2511c5ca33135ba29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9381534d80452c32494066d2511c5ca33135ba29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/825b692620b599c2693c11ddbd7cc93dca069e7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/825b692620b599c2693c11ddbd7cc93dca069e7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/825b692620b599c2693c11ddbd7cc93dca069e7c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/825b692620b599c2693c11ddbd7cc93dca069e7c/comments", "author": null, "committer": null, "parents": [{"sha": "099f0f3f6e956a49ecb663000268f3fbcf449dc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/099f0f3f6e956a49ecb663000268f3fbcf449dc1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/099f0f3f6e956a49ecb663000268f3fbcf449dc1"}], "stats": {"total": 1332, "additions": 876, "deletions": 456}, "files": [{"sha": "50f9c20055dc0fa205812f81c39c30895bfa245b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 208, "deletions": 195, "changes": 403, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=825b692620b599c2693c11ddbd7cc93dca069e7c", "patch": "@@ -1,3 +1,16 @@\n+2001-01-11  Zack Weinberg  <zack@wolery.stanford.edu>\n+\n+\t* aclocal.m4 (AC_FUNC_MMAP_ANYWHERE): Completely rewritten.\n+\tNow defines HAVE_MMAP_DEV_ZERO and/or HAVE_MMAP_ANON depending\n+\twhich you have.\n+\t(AC_FUNC_MMAP_FILE): Don't AC_REQUIRE AC_FUNC_MMAP_ANYWHERE.\n+\t* configure.in: Set GGC to ggc-page if any of mmap_dev_zero,\n+\tmmap_anon, and valloc is available.\n+\t* ggc-page.c: Restructure ifdef logic to match new autoconf\n+\tspec.  Don't throw away the test page in init_ggc.\n+\n+\t* configure, config.in: Regenerate.\n+\n 2001-01-12  Michael Hayes  <mhayes@redhat.com>\n \n \t* loop.h (total_biv_increment): Constify iv_class pointer.\n@@ -44,10 +57,10 @@ Fri Jan 12 00:04:00 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n \t* builtins.c (std_expand_builtin_va_start): Handle varargs when\n \tsizeof (int) is larger than sizeof(__word__).\n-\t\n+\n 2001-01-11  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cppinit.c (do_includes): Fix typo.\n+\t* cppinit.c (do_includes): Fix typo.\n \n 2001-01-11  Stephane Carrez  <Stephane.Carrez@worldnet.fr>\n \n@@ -63,27 +76,27 @@ Fri Jan 12 00:04:00 MET 2001  Jan Hubicka  <jh@suse.cz>\n \t(lshrdi_const1, lshrsi3_const16): Likewise.\n \t(*addhi3, lshrsi3_const1, lshrqi3_const1): Likewise.\n \t(*movhi_68hc12, *movqi_68hc12): Likewise.\n-\t(movstrictqi): Make sure reloading in D_REGS as a destination \n+\t(movstrictqi): Make sure reloading in D_REGS as a destination\n \tdoes not happen.\n \n 2001-01-11  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cppspec.c (DEFAULT_WORD_SWITCH_TAKES_ARG): Add -MQ. \n+\t* cppspec.c (DEFAULT_WORD_SWITCH_TAKES_ARG): Add -MQ.\n \n 2001-01-11  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cppinit.c (cpp_start_read): If -fpreprocessed, ignore\n-        -D, -U and -A, and don't initialize the builtins.\n+\t* cppinit.c (cpp_start_read): If -fpreprocessed, ignore\n+\t-D, -U and -A, and don't initialize the builtins.\n \t(do_includes): Error if -include or -imacros with -fpreprocessed.\n-        * cppmain.c (cb_define, cb_undef): Unconditionally process\n-        the callback.\n-        * tradcpp.c (main): Fix typo.\n+\t* cppmain.c (cb_define, cb_undef): Unconditionally process\n+\tthe callback.\n+\t* tradcpp.c (main): Fix typo.\n \n 2000-01-11  Mark Elbrecht  <snowball3@bigfoot.com>\n-\t  \n+\n \t * cppfiles.c (cpp_included, find_include_file, _cpp_execute_include)\n \t   (read_name_map): Use IS_ABSOLUTE_PATH.\n-\t * tradcpp.c (get_filename): Likewise.   \n+\t * tradcpp.c (get_filename): Likewise.\n \n 2001-01-11  Stephane Carrez  <Stephane.Carrez@worldnet.fr>\n \n@@ -104,7 +117,7 @@ Fri Jan 12 00:04:00 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-11  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * invoke.texi: Restore documentation of the drivers' switches -MD\n+\t* invoke.texi: Restore documentation of the drivers' switches -MD\n \tand -MMD.\n \n 2001-01-11  Alexandre Oliva  <aoliva@redhat.com>\n@@ -155,22 +168,22 @@ Fri Jan 12 00:04:00 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-10  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * Makefile.in (tradcpp0): Depend on mkdeps.h.  Link mkdeps.o\n-        * cppinit.c (cpp_start_read): Update comment, remove unneeded\n-        if statement.\n-        * tradcpp.c: Include mkdeps.h.\n-        (deps, print_deps_phony_targets, deps_append, output_deps,\n-        init_dependency_output, output_deps): New.\n-        (deps_buffer, deps_allocated_size, deps_size, deps_column,\n-        deps_output): Delete.\n-        (print_deps_missing_files): Rename deps_missing_files.\n-        (inhibit_output): Make global.\n-        (main): Delete inhibit_output, deps_stream, deps_target.\n-        Use mkdeps functionality in the same way as cpplib.  Remove\n-        -g3 handling.  Handle -MF, -MP, -MQ, -MT.  Update handling of\n-        -M and -MM.  Remove old handling of deps via deps_out, and\n-        old reading of environment variables.\n-        (get_filename): Update to use deps_add_dep.\n+\t* Makefile.in (tradcpp0): Depend on mkdeps.h.  Link mkdeps.o\n+\t* cppinit.c (cpp_start_read): Update comment, remove unneeded\n+\tif statement.\n+\t* tradcpp.c: Include mkdeps.h.\n+\t(deps, print_deps_phony_targets, deps_append, output_deps,\n+\tinit_dependency_output, output_deps): New.\n+\t(deps_buffer, deps_allocated_size, deps_size, deps_column,\n+\tdeps_output): Delete.\n+\t(print_deps_missing_files): Rename deps_missing_files.\n+\t(inhibit_output): Make global.\n+\t(main): Delete inhibit_output, deps_stream, deps_target.\n+\tUse mkdeps functionality in the same way as cpplib.  Remove\n+\t-g3 handling.  Handle -MF, -MP, -MQ, -MT.  Update handling of\n+\t-M and -MM.  Remove old handling of deps via deps_out, and\n+\told reading of environment variables.\n+\t(get_filename): Update to use deps_add_dep.\n \n 2001-01-10  Mark Mitchell  <mark@codesourcery.com>\n \n@@ -215,25 +228,25 @@ Fri Jan 12 00:04:00 MET 2001  Jan Hubicka  <jh@suse.cz>\n \trestore_machine_status.\n \n \t* emit-rtl.c (init_emit_once): Amend comment describing\n-\t{init|mark|free}_machine_status. \n+\t{init|mark|free}_machine_status.\n \n \t* tm.texi (Per-Function Data): New node.  Describe the\n \tINIT_EXPANDERS macro and the {init|mark|free}_machine_status\n \tfunction pointers.\n \n 2001-01-10  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cppinit.c (OPT_g): Remove.\n-        (cpp_handle_option): Update for removed -g3. \n-        (print_help): Update.\n-        * cpplib.h (struct cpp_options): Remove debug_output.\n-        * cppmain.c (setup_callbacks, cb_define): Update.\n-        * gcc.c (cpp_options): Translate -g3 to -dD.  \n+\t* cppinit.c (OPT_g): Remove.\n+\t(cpp_handle_option): Update for removed -g3.\n+\t(print_help): Update.\n+\t* cpplib.h (struct cpp_options): Remove debug_output.\n+\t* cppmain.c (setup_callbacks, cb_define): Update.\n+\t* gcc.c (cpp_options): Translate -g3 to -dD.\n \n 2001-01-10  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* config/i960/i960.md: Change modifier to + on the zero_extract\n-        pattern after the (rotate -2 reg) canonicalization pattern.\n+\tpattern after the (rotate -2 reg) canonicalization pattern.\n \n 2001-01-10  Richard Henderson  <rth@redhat.com>\n \n@@ -282,14 +295,14 @@ Wed Jan 10 16:38:31 MET 2001  Jan Hubicka  <jh@suse.cz>\n \t@w.\n \n 2001-01-10  Nathan Sidwell  <nathan@codesourcery.com>\n-\t\n-        * gcc.c (cpp_options): Set MD file name from output\n-        filename, if specified.\n-        (suffix_subst): New static variable.\n-        (do_spec): Clear it.\n-        (do_spec_1, case '.'): Handle new `%.suffix' spec.\n-        Clear it.\n-        (give_switch): Handle suffix_subst.\n+\n+\t* gcc.c (cpp_options): Set MD file name from output\n+\tfilename, if specified.\n+\t(suffix_subst): New static variable.\n+\t(do_spec): Clear it.\n+\t(do_spec_1, case '.'): Handle new `%.suffix' spec.\n+\tClear it.\n+\t(give_switch): Handle suffix_subst.\n \n 2001-01-10  Phil Edwards  <pme@sources.redhat.com>\n \n@@ -301,28 +314,28 @@ Wed Jan 10 16:38:31 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-10  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * c-lang.c (lang_hooks): Update.\n-        (lang_decode_option): Remove.\n-        (lang_init_options): Rename c_init_options.\n-        * toplev.c (main): Use lang_hooks for lang_init_options\n-        and lang_decode_option.\n-        * toplev.h (lang_hooks): Add 2 new hooks.\n-        * tree.h: Remove lang_init_options and lang_decode_option.\n-        * cp/cp-tree.h (lang_decode_option): Rename cxx_decode_option.\n-        * cp/decl2.c: Similarly.\n-        * cp/lex.c (lang_init_options): Rename cxx_init_options.\n-        (lang_hooks): Update.   \n-        * f/com.c (f_init, f_finish): Rename ffe_init, ffe_finish\n-        for consistency.\n-        (lang_init_options): Rename ffe_init_options.\n-        (lang_hooks): Update.\n-        (lang_decode_option): Remove.\n-        * java/lang.c (lang_init_options): Rename java_init_options.\n-        (lang_decode_option): Rename java_decode_option.\n-        (lang_hooks): Update.\n-        * objc/objc-act.c (lang_init_options): Rename objc_init_options.\n-        (lang_decode_option): Rename objc_decode_option.\n-        (lang_hooks): Update.\n+\t* c-lang.c (lang_hooks): Update.\n+\t(lang_decode_option): Remove.\n+\t(lang_init_options): Rename c_init_options.\n+\t* toplev.c (main): Use lang_hooks for lang_init_options\n+\tand lang_decode_option.\n+\t* toplev.h (lang_hooks): Add 2 new hooks.\n+\t* tree.h: Remove lang_init_options and lang_decode_option.\n+\t* cp/cp-tree.h (lang_decode_option): Rename cxx_decode_option.\n+\t* cp/decl2.c: Similarly.\n+\t* cp/lex.c (lang_init_options): Rename cxx_init_options.\n+\t(lang_hooks): Update.\n+\t* f/com.c (f_init, f_finish): Rename ffe_init, ffe_finish\n+\tfor consistency.\n+\t(lang_init_options): Rename ffe_init_options.\n+\t(lang_hooks): Update.\n+\t(lang_decode_option): Remove.\n+\t* java/lang.c (lang_init_options): Rename java_init_options.\n+\t(lang_decode_option): Rename java_decode_option.\n+\t(lang_hooks): Update.\n+\t* objc/objc-act.c (lang_init_options): Rename objc_init_options.\n+\t(lang_decode_option): Rename objc_decode_option.\n+\t(lang_hooks): Update.\n \n 2001-01-09  Nick Clifton  <nickc@redhat.com>\n \n@@ -367,7 +380,7 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n \n \t* reload.c (find_reloads_address): Check for eliminable registers\n \t\t  when substituting a constant expression for a pseudo.\n-\t\n+\n 2001-01-09  Joseph S. Myers  <jsm28@cam.ac.uk>\n \n \t* c-common.c (enum format_type): Add format_type_error.\n@@ -469,16 +482,16 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n \n 2001-01-09  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cppinit.c (OPT_MD, OPT_MMD): Restore.\n-        (cpp_handle_option): Handle them.\n-        (cpp_post_options): Ensure one of -M or -MM is specified with\n-        any other -M? option.\n-        (init_dependency_output): Suppress output with -MG.\n+\t* cppinit.c (OPT_MD, OPT_MMD): Restore.\n+\t(cpp_handle_option): Handle them.\n+\t(cpp_post_options): Ensure one of -M or -MM is specified with\n+\tany other -M? option.\n+\t(init_dependency_output): Suppress output with -MG.\n \n 2001-01-09  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cpp.texi: Update.\n-        * invoke.texi: Update.\n+\t* cpp.texi: Update.\n+\t* invoke.texi: Update.\n \n 2001-01-09  Bernd Schmidt  <bernds@redhat.com>\n \n@@ -488,25 +501,25 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n 2001-01-09  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n \t* c-lang.c (lang_hooks): Update.\n-        (lang_init): Rename c_init.\n-        (lang_finish): Remove.\n-        * toplev.c (compile_file): Use lang_hooks for lang_init ()\n-        and lang_finish ().\n-        * toplev.h (lang_hooks): Add init () and finish ().\n-        * tree.h (lang_init, lang_finish): Remove.\n-        * cp/tree.h (lang_init, lang_finish): Remove.\n-        * cp/decl2.c (cxx_post_options, lang_hooks): Move to cp/lex.c.\n-        * cp/lex.c (cxx_init, cxx_finish, cxx_post_options,\n-        lang_hooks): New.\n-        (lang_init, lang_finish): Remove.\n-        * f/com.c (lang_init, lang_finish): Rename f_init, f_finish.\n-        (lang_hooks): Update.\n-        * java/lang.c (lang_init): Rename java_init.\n-        (lang_finish): Remove.\n-        (lang_hooks): Update.\n-        * objc/objc-act.c (lang_init): Rename objc_init.\n-        (lang_finish): Remove.\n-        (lang_hoooks): Update.\n+\t(lang_init): Rename c_init.\n+\t(lang_finish): Remove.\n+\t* toplev.c (compile_file): Use lang_hooks for lang_init ()\n+\tand lang_finish ().\n+\t* toplev.h (lang_hooks): Add init () and finish ().\n+\t* tree.h (lang_init, lang_finish): Remove.\n+\t* cp/tree.h (lang_init, lang_finish): Remove.\n+\t* cp/decl2.c (cxx_post_options, lang_hooks): Move to cp/lex.c.\n+\t* cp/lex.c (cxx_init, cxx_finish, cxx_post_options,\n+\tlang_hooks): New.\n+\t(lang_init, lang_finish): Remove.\n+\t* f/com.c (lang_init, lang_finish): Rename f_init, f_finish.\n+\t(lang_hooks): Update.\n+\t* java/lang.c (lang_init): Rename java_init.\n+\t(lang_finish): Remove.\n+\t(lang_hooks): Update.\n+\t* objc/objc-act.c (lang_init): Rename objc_init.\n+\t(lang_finish): Remove.\n+\t(lang_hoooks): Update.\n \n 20001-01-09  Graham Stott  <grahams@redhat.com>\n \n@@ -550,7 +563,7 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n 2001-01-08  Nick Clifton  <nickc@redhat.com>\n \n \t* config/v850/v850.c (ra_rtx): Delete.\n-        (v850_save_machine_status): Delete.\n+\t(v850_save_machine_status): Delete.\n \t(v850_restore_machine_status): Delete.\n \t(v850_init_machine_status): New function.\n \t(v850_mark_machine_status): New function.\n@@ -563,7 +576,7 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n \tto take a const char *, to avoid compile time warning.\n \t* config/v850/v850.h (ASM_OUTPUT_LABELREF): Undefine, not needed.\n \t(USER_LABEL_PREFIX): Redefine.\n-\t\n+\n 2000-01-08  Jim Wilson  <wilson@redhat.com>\n \n \t* sched-rgn.c (BITSET_ADD, BITSET_REMOVE, bitset_member): Cast\n@@ -582,10 +595,10 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n \n 2001-01-08  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cppinit.c (init): Rename init_library.\n-        (cpp_create_reader): Update.\n-        * gcc.c (cpp_options): If -o given, use it as the target of\n-        any -M options.\n+\t* cppinit.c (init): Rename init_library.\n+\t(cpp_create_reader): Update.\n+\t* gcc.c (cpp_options): If -o given, use it as the target of\n+\tany -M options.\n \n 2001-01-08  Richard Earnshaw  <rearnsha@arm.com>\n \n@@ -604,7 +617,7 @@ Tue Jan  9 21:25:19 2001  Jeffrey A Law  (law@cygnus.com)\n \t(emit_multi_reg_push, emit_sfm, expand_prologue): Use constants.\n \t* arm.h (SP_REGNUM, IP_REGNUM, PC_REGNUM): Delete defines.\n \t(STACK_POINTER_REGNUM): Define in terms of SP_REGNUM.\n-\t\n+\n Mon Jan  8 16:14:56 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n \t* jump.c (jump_optimize_1): Use reversed_comparison_code\n@@ -622,7 +635,7 @@ Mon Jan  8 16:14:56 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n \t* arm.h (HARD_REGNO_RENAME_OK): Delete.\n \t(EPILOGUE_USES): Define.\n-\t(INITIAL_ELIMINATION_OFFSET): Current prologue code does not \n+\t(INITIAL_ELIMINATION_OFFSET): Current prologue code does not\n \tautomatically stack the LR if it isn't live.\n \n Mon Jan  8 13:46:02 MET 2001  Jan Hubicka  <jh@suse.cz>\n@@ -702,28 +715,28 @@ Sun Jan  7 19:37:48 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-07  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * fix-header.c (read_scan_file): s/pfile/scan_in/.\n+\t* fix-header.c (read_scan_file): s/pfile/scan_in/.\n \n 2001-01-07  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * c-lang.c (c_post_options): Call cpp_post_options.\n+\t* c-lang.c (c_post_options): Call cpp_post_options.\n \t* objc/objc-act.c (objc_post_options): Similarly.\n \t* cppmain.c (main): Similarly.\n-        * fix-header.c (read_scan_file): Similarly.\n-        * cppinit.c (cpp_start_read): Move option consistency checks\n-        to cpp_post_options.  Don't call init_dependency_output.\n-        If needed, add default target and main file dependency.\n-        (OPT_MD, OPT_MMD): Remove.\n-        (OPT_MF): New.\n-        (cpp_handle_option): Update for OPT_* changes.\n-        (cpp_post_options): New.\n-        (init_dependency_output): Command line -MF overrides environment\n-        variables.  Don't set default target etc.  Suppress output\n-        if dependencies are going to stdout.\n-        (print_help): Update.\n-        * cpplib.h (cpp_post_options): New.\n-        * gcc.c (cpp_options): Update for -MD, -MMD, -MF.\n-\t\n+\t* fix-header.c (read_scan_file): Similarly.\n+\t* cppinit.c (cpp_start_read): Move option consistency checks\n+\tto cpp_post_options.  Don't call init_dependency_output.\n+\tIf needed, add default target and main file dependency.\n+\t(OPT_MD, OPT_MMD): Remove.\n+\t(OPT_MF): New.\n+\t(cpp_handle_option): Update for OPT_* changes.\n+\t(cpp_post_options): New.\n+\t(init_dependency_output): Command line -MF overrides environment\n+\tvariables.  Don't set default target etc.  Suppress output\n+\tif dependencies are going to stdout.\n+\t(print_help): Update.\n+\t* cpplib.h (cpp_post_options): New.\n+\t* gcc.c (cpp_options): Update for -MD, -MMD, -MF.\n+\n Sun Jan  7 14:44:19 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n \t* jump.c (comparison_dominates_p): Support unordered compares.\n@@ -766,17 +779,17 @@ Sun Jan  7 13:49:19 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-07  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * (initialize, initialize_builtins,\n-        initialize_dependency_output, initialize_standard_includes):\n-        Rename s/initialize/init. Update.\n-        (init_dependency_output): Move to after\n-        cpp_handle_options, the correct location temporally at least.\n-        (opt_comp): Move next to init (), its caller.  Fix prototype.\n-        (init): Make \"initialized\" local scope.\n-        (cpp_create_reader): Always call init ().\n-        (cpp_start_read): Update.\n-        (output_deps): New function, broken out of cpp_finish.\n-        (cpp_finish): Break out output_deps.\n+\t* (initialize, initialize_builtins,\n+\tinitialize_dependency_output, initialize_standard_includes):\n+\tRename s/initialize/init. Update.\n+\t(init_dependency_output): Move to after\n+\tcpp_handle_options, the correct location temporally at least.\n+\t(opt_comp): Move next to init (), its caller.  Fix prototype.\n+\t(init): Make \"initialized\" local scope.\n+\t(cpp_create_reader): Always call init ().\n+\t(cpp_start_read): Update.\n+\t(output_deps): New function, broken out of cpp_finish.\n+\t(cpp_finish): Break out output_deps.\n \n 2001-01-07  Richard Henderson  <rth@redhat.com>\n \n@@ -870,26 +883,26 @@ Sun Jan  7 13:49:19 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-07  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * toplev.c (main): Call the front-end specific post_options\n-        hook if one is given.\n-        * toplev.h (struct_lang_hooks, lang_hooks): New.\n-        * c-lang.c (c_post_options, lang_hooks): Implement lang_hooks\n-        for the C front end.\n-        * cp/decl2.c (cxx_post_options, lang_hooks): Implement\n-        lang_hooks for the C++ front end.\n-        * objc/objc-act.c (objc_post_options, lang_hooks): Implement\n-        lang_hooks for the ObjC front end.\n-        * f/com.c (lang_hooks): Hooks for the Fortran front end.\n-        * java/lang.c (lang_hooks): Hooks for the Java front end.\n+\t* toplev.c (main): Call the front-end specific post_options\n+\thook if one is given.\n+\t* toplev.h (struct_lang_hooks, lang_hooks): New.\n+\t* c-lang.c (c_post_options, lang_hooks): Implement lang_hooks\n+\tfor the C front end.\n+\t* cp/decl2.c (cxx_post_options, lang_hooks): Implement\n+\tlang_hooks for the C++ front end.\n+\t* objc/objc-act.c (objc_post_options, lang_hooks): Implement\n+\tlang_hooks for the ObjC front end.\n+\t* f/com.c (lang_hooks): Hooks for the Fortran front end.\n+\t* java/lang.c (lang_hooks): Hooks for the Java front end.\n \n 2001-01-07  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * c-lex.c (init_c_lex): Request #define / #undef callbacks\n-        for verbose DWARF[2] debugging.\n-        (cb_define, cb_undef): The new callbacks.\n-        * toplev.h (debug_define, debug_undef): Make const correct.\n-        * toplev.c (debug_define, debug_undef): Similarly.  Do not   \n-        perform the verbosity tests here anymore.\n+\t* c-lex.c (init_c_lex): Request #define / #undef callbacks\n+\tfor verbose DWARF[2] debugging.\n+\t(cb_define, cb_undef): The new callbacks.\n+\t* toplev.h (debug_define, debug_undef): Make const correct.\n+\t* toplev.c (debug_define, debug_undef): Similarly.  Do not\n+\tperform the verbosity tests here anymore.\n \n 2001-01-07  Alexandre Oliva  <aoliva@redhat.com>\n \n@@ -954,19 +967,19 @@ Fri Jan  5 16:34:18 2001  Nick Clifton  <nickc@redhat.com>\n \n 2001-01-05  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cpp.texi: Update for -MQ.\n-        * cppinit.c (cpp_create_reader): Always create pfile->deps.\n-        (cpp_cleanup): Always free pfile->deps.\n-        (initialize_dependency_output): Don't create pfile->deps.\n-        (cpp_handle_option): Similarly.\n-        (OPT_MQ): New.\n-        * gcc.c (cpp_options): Handle -MQ.\n-        (DEFAULT_WORD_SWITCH_TAKES_ARG): Add -MQ.\n-        * mkdeps.c (base_name): Remove.\n-        (deps_init): Don't allocate vector space until it's needed.\n-        (deps_free): Only free vectors if allocated.\n-        (deps_add_target, deps_add_dep): Update for initial allocation.\n-        (deps_add_default_target): Don't strip to the base_name.\n+\t* cpp.texi: Update for -MQ.\n+\t* cppinit.c (cpp_create_reader): Always create pfile->deps.\n+\t(cpp_cleanup): Always free pfile->deps.\n+\t(initialize_dependency_output): Don't create pfile->deps.\n+\t(cpp_handle_option): Similarly.\n+\t(OPT_MQ): New.\n+\t* gcc.c (cpp_options): Handle -MQ.\n+\t(DEFAULT_WORD_SWITCH_TAKES_ARG): Add -MQ.\n+\t* mkdeps.c (base_name): Remove.\n+\t(deps_init): Don't allocate vector space until it's needed.\n+\t(deps_free): Only free vectors if allocated.\n+\t(deps_add_target, deps_add_dep): Update for initial allocation.\n+\t(deps_add_default_target): Don't strip to the base_name.\n \n 2001-01-05  DJ Delorie <dj@redhat.com>\n \n@@ -981,7 +994,7 @@ Fri Jan  5 16:34:18 2001  Nick Clifton  <nickc@redhat.com>\n \n \t* config/v850/v850-protos.h: Add prototypes for v850_return_addr\n \tand v850_init_expanders.\n-\t\n+\n 2001-01-05  Zack Weinberg  <zack@wolery.stanford.edu>\n \n \t* cpplib.h (struct cpp_reader): Add help_only field.\n@@ -1009,7 +1022,7 @@ Fri Jan  5 16:34:18 2001  Nick Clifton  <nickc@redhat.com>\n \t* print-rtl.c (print_simple_rtl): New.\n \t(flag_simple): New.\n \t(print_rtx): Disable printing of flags and modes, etc.,\n-        if `flag_simple` nonzero.\n+\tif `flag_simple` nonzero.\n \n 2001-01-05  Zack Weinberg  <zack@wolery.stanford.edu>\n \n@@ -1086,7 +1099,7 @@ Fri Jan  5 20:34:06 2001  J\"orn Rennecke <amylaar@redhat.com>\n 2001-01-05  Daniel Berlin  <dberlin@redhat.com>\n \n \t* c-common.c (lang_get_alias_set): Say we know nothing of\n-\tVECTOR_TYPE aliasing. \n+\tVECTOR_TYPE aliasing.\n \n \t* dwarf2out.c (is_base_type): Handle VECTOR_TYPE properly.\n \n@@ -1127,18 +1140,18 @@ Fri Jan  5 16:29:49 MET 2001  Jan Hubicka  <jh@suse.cz>\n \n 2001-01-05  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cpp.texi: Update for -MP.  Clarify behaviour of -MT.\n-        * cppinit.c (initialize_dependency_output):  Update.\n-        (cpp_finish): Output dummy targets for -MP.\n-        (OPT_MP): New.\n-        (cpp_handle_option): Handle -MP.  Don't quote -MT options.  \n-        * cpplib.h (struct cpp_options): Add deps_phony_targets.\n-        * gcc.c (cpp_options): Update to handle -MP.\n-        * mkdeps.c (deps_add_target, deps_add_default_target): Update\n-        to quote only the default target.\n-        (deps_phony_targets): Insert a preceding newline.  Rename from\n-        deps_dummy_targets for consistency.\n-        * mkdeps.h: Update\n+\t* cpp.texi: Update for -MP.  Clarify behaviour of -MT.\n+\t* cppinit.c (initialize_dependency_output):  Update.\n+\t(cpp_finish): Output dummy targets for -MP.\n+\t(OPT_MP): New.\n+\t(cpp_handle_option): Handle -MP.  Don't quote -MT options.\n+\t* cpplib.h (struct cpp_options): Add deps_phony_targets.\n+\t* gcc.c (cpp_options): Update to handle -MP.\n+\t* mkdeps.c (deps_add_target, deps_add_default_target): Update\n+\tto quote only the default target.\n+\t(deps_phony_targets): Insert a preceding newline.  Rename from\n+\tdeps_dummy_targets for consistency.\n+\t* mkdeps.h: Update\n \n 2001-01-05  Alexandre Oliva  <aoliva@redhat.com>\n \n@@ -1159,7 +1172,7 @@ Fri Jan  5 16:29:49 MET 2001  Jan Hubicka  <jh@suse.cz>\n \t(process_init_element): Don't dereference null DECL_SIZE.\n \t* varasm.c (array_size_for_constructor): Return a HOST_WIDE_INT.\n \tDon't abort for empty constructors.  Use size_binop\n-\t(output_constructor): Add commentary regarding zero length \n+\t(output_constructor): Add commentary regarding zero length\n \tarray futures.  Abort if we try to initialize an array of\n \tunspecified length with a non-empty constructor in the middle\n \tof a structure.\n@@ -1188,7 +1201,7 @@ Fri Jan  5 16:29:49 MET 2001  Jan Hubicka  <jh@suse.cz>\n \tfor prset and prget.\n \n 2001-01-05  Michael Hayes  <mhayes@redhat.com>\n-\t\n+\n \t* loop.h (struct loop_reg): New.\n \t(struct loop_regs): Change to use array of `struct loop_reg'.\n \t* loop.c: Replace assortment of varrays with single regs array.\n@@ -1201,7 +1214,7 @@ Fri Jan  5 16:29:49 MET 2001  Jan Hubicka  <jh@suse.cz>\n \t(loop_optimize): Delete `moved_once' array.\n \n 2001-01-05  Michael Hayes  <mhayes@redhat.com>\n-\t\n+\n \t* loop.c (prescan_loop): Set loop_info->has_nonconst_call.\n \tUse it instead of loop_info->has_call for scanning loop mems.\n \t(check_dbra_loop): Replace loop_info->has_call test with\n@@ -1320,18 +1333,18 @@ Thu Jan  4 15:54:05 2001  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n 2001-01-04  Neil Booth  <neil@daikokuya.demon.co.uk>\n \n-        * cpp.texi: Update for -MT.\n-        * cppinit.c (initialize_dependency_output): Add a default\n-        target if none has been given already.\n-        (no_tgt, OPT_MT): New.\n-        (cpp_handle_option): Handle -MT.  Update -M etc.\n-        * cpplib.h (struct cpp_options): Remove deps_target.\n-        * gcc.c (cpp_options): Handle -MT.\n-        * mkdeps.c (struct deps): Move from mkdeps.h.\n-        (deps_calc_target): Rename deps_add_default_target.  Add a\n-        default target if none has been specified already.\n-        * mkdeps.h (struct deps): Move to mkdeps.c.\n-        (deps_calc_target): Rename deps_add_default_target.\n+\t* cpp.texi: Update for -MT.\n+\t* cppinit.c (initialize_dependency_output): Add a default\n+\ttarget if none has been given already.\n+\t(no_tgt, OPT_MT): New.\n+\t(cpp_handle_option): Handle -MT.  Update -M etc.\n+\t* cpplib.h (struct cpp_options): Remove deps_target.\n+\t* gcc.c (cpp_options): Handle -MT.\n+\t* mkdeps.c (struct deps): Move from mkdeps.h.\n+\t(deps_calc_target): Rename deps_add_default_target.  Add a\n+\tdefault target if none has been specified already.\n+\t* mkdeps.h (struct deps): Move to mkdeps.c.\n+\t(deps_calc_target): Rename deps_add_default_target.\n \n 2000-01-03  Richard Henderson  <rth@redhat.com>\n \n@@ -1355,7 +1368,7 @@ Thu Jan  4 15:54:05 2001  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n \t* config/alpha/alpha.md (addvsi3, addvdi3): New.\n \t(negvsi2, negvdi2, subvsi3, subvdi3, mulvsi3, mulvdi3): New.\n-\t\n+\n 2001-01-03  Franz Sirl  <Franz.Sirl-kernel@lauterbach.com>\n \n \t* tradcpp.c (main): Make sure finclude() is called with a valid\n@@ -1464,7 +1477,7 @@ Wed Jan  3 08:53:50 2001  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n \t* c-common.h (ASM_INPUT_P): New.\n \t* c-parse.in (asm): Set it when needed.\n-\t* c-semantics.c (genrtl_asm_stmt): Test it instead of the \n+\t* c-semantics.c (genrtl_asm_stmt): Test it instead of the\n \texistance of an operand.\n \n Tue Jan  2 20:27:07 MET 2001  Jan Hubicka  <jh@suse.cz>\n@@ -1527,7 +1540,7 @@ Tue Jan  2 10:47:38 2001  Richard Kenner  <kenner@vlsi1.ultra.nyu.\n \n 2001-01-02  Philip Blundell  <pb@futuretv.com>\n \n-\t* config/arm/linux-gas.h (CLEAR_INSN_CACHE): Avoid illegal clobber \n+\t* config/arm/linux-gas.h (CLEAR_INSN_CACHE): Avoid illegal clobber\n \tof input operand.\n \n 2001-01-02  Richard Henderson  <rth@redhat.com>\n@@ -1585,9 +1598,9 @@ Mon Jan  1 21:28:29 2001  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n 2001-01-01  John David Anglin  <dave@hiauly1.hia.nrc.ca>\n \n-        * loop.c (add_label_notes): Increment the label usage count when\n-        a note is added to an insn which refers to a CODE_LABEL.\n-        * gcse.c (add_label_notes): Likewise.\n+\t* loop.c (add_label_notes): Increment the label usage count when\n+\ta note is added to an insn which refers to a CODE_LABEL.\n+\t* gcse.c (add_label_notes): Likewise.\n \n 2001-01-01  Andreas Jaeger  <aj@suse.de>\n "}, {"sha": "4544c778503ea7d60f7fec1eb162e9322be0c487", "filename": "gcc/aclocal.m4", "status": "modified", "additions": 234, "deletions": 32, "changes": 266, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Faclocal.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Faclocal.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Faclocal.m4?ref=825b692620b599c2693c11ddbd7cc93dca069e7c", "patch": "@@ -737,16 +737,17 @@ AC_SUBST($1)dnl\n # Check whether mmap can map an arbitrary page from /dev/zero or with\n # MAP_ANONYMOUS, without MAP_FIXED.\n AC_DEFUN([AC_FUNC_MMAP_ANYWHERE],\n-[AC_CHECK_HEADERS(unistd.h)\n-AC_CHECK_FUNCS(getpagesize)\n-AC_CACHE_CHECK(for working mmap which provides zeroed pages anywhere,\n-  ac_cv_func_mmap_anywhere,\n-[AC_TRY_RUN([\n-/* Test by Richard Henderson and Alexandre Oliva.\n-   Check whether mmap MAP_ANONYMOUS or mmap from /dev/zero works. */\n+[AC_CHECK_FUNCS(getpagesize)\n+# The test program for the next two tests is the same except for one\n+# set of ifdefs.\n+changequote({{{,}}})dnl\n+{{{cat >ct-mmap.inc <<'EOF'\n #include <sys/types.h>\n-#include <fcntl.h>\n #include <sys/mman.h>\n+#include <fcntl.h>\n+#include <signal.h>\n+#include <setjmp.h>\n+#include <stdio.h>\n \n #if !defined (MAP_ANONYMOUS) && defined (MAP_ANON)\n # define MAP_ANONYMOUS MAP_ANON\n@@ -793,45 +794,246 @@ AC_CACHE_CHECK(for working mmap which provides zeroed pages anywhere,\n \n #endif /* no HAVE_GETPAGESIZE */\n \n-int main()\n-{\n-  char *x;\n-  int fd, pg;\n-\n-#ifndef MAP_ANONYMOUS\n-  fd = open(\"/dev/zero\", O_RDWR);\n-  if (fd < 0)\n-    exit(1);\n+#ifndef MAP_FAILED\n+# define MAP_FAILED -1\n #endif\n \n-  pg = getpagesize();\n-#ifdef MAP_ANONYMOUS\n-  x = (char*)mmap(0, pg, PROT_READ|PROT_WRITE,\n-                  MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);\n+#undef perror_exit\n+#define perror_exit(str, val) \\\n+  do { perror(str); exit(val); } while (0)\n+\n+/* Some versions of cygwin mmap require that munmap is called with the\n+   same parameters as mmap.  GCC expects that this is not the case.\n+   Test for various forms of this problem.  Warning - icky signal games.  */\n+\n+static sigset_t unblock_sigsegv;\n+static jmp_buf r;\n+static size_t pg;\n+static int devzero;\n+\n+static char *\n+anonmap (size)\n+     size_t size;\n+{\n+#ifdef USE_MAP_ANON\n+  return (char *) mmap (0, size, PROT_READ|PROT_WRITE,\n+\t\t\tMAP_PRIVATE|MAP_ANONYMOUS, -1, 0);\n #else\n-  x = (char*)mmap(0, pg, PROT_READ|PROT_WRITE, MAP_PRIVATE, fd, 0);\n+  return (char *) mmap (0, size, PROT_READ|PROT_WRITE,\n+\t\t\tMAP_PRIVATE, devzero, 0);\n #endif\n-  if (x == (char *) -1)\n-    exit(2);\n+}\n+\n+static void\n+sigsegv (unused)\n+     int unused;\n+{\n+  sigprocmask (SIG_UNBLOCK, &unblock_sigsegv, 0);\n+  longjmp (r, 1);\n+}\n+\n+/* Basic functionality test.  */\n+void\n+test_0 ()\n+{\n+  char *x = anonmap (pg);\n+  if (x == (char *) MAP_FAILED)\n+    perror_exit(\"test 0 mmap\", 2);\n \n   *(int *)x += 1;\n \n   if (munmap(x, pg) < 0)\n-    exit(3);\n+    perror_exit(\"test 0 munmap\", 3);\n+}\n+\n+/* 1. If we map a 2-page region and unmap its second page, the first page\n+   must remain.  */\n+static void\n+test_1 ()\n+{\n+  char *x = anonmap (pg * 2);\n+  if (x == (char *)MAP_FAILED)\n+    perror_exit (\"test 1 mmap\", 4);\n+\n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r))\n+    perror_exit (\"test 1 fault\", 5);\n+\n+  x[0] = 1;\n+  x[pg] = 1;\n+\n+  if (munmap (x + pg, pg) < 0)\n+    perror_exit (\"test 1 munmap 1\", 6);\n+  x[0] = 2;\n+\n+  if (setjmp (r) == 0)\n+    {\n+      x[pg] = 1;\n+      perror_exit (\"test 1 no fault\", 7);\n+    }\n+  if (munmap (x, pg) < 0)\n+    perror_exit (\"test 1 munmap 2\", 8);\n+}\n+\n+/* 2. If we map a 2-page region and unmap its first page, the second\n+   page must remain.  */\n+static void\n+test_2 ()\n+{\n+  char *x = anonmap (pg * 2);\n+  if (x == (char *)MAP_FAILED)\n+    perror_exit (\"test 2 mmap\", 9);\n+\n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r))\n+    perror_exit (\"test 2 fault\", 10);\n+\n+  x[0] = 1;\n+  x[pg] = 1;\n+\n+  if (munmap (x, pg) < 0)\n+    perror_exit (\"test 2 munmap 1\", 11);\n+\n+  x[pg] = 2;\n+\n+  if (setjmp (r) == 0)\n+    {\n+      x[0] = 1;\n+      perror_exit (\"test 2 no fault\", 12);\n+    }\n+\n+  if (munmap (x+pg, pg) < 0)\n+    perror_exit (\"test 2 munmap 2\", 13);\n+}\n+\n+/* 3. If we map two adjacent 1-page regions and unmap them both with\n+   one munmap, both must go away.\n+\n+   Getting two adjacent 1-page regions with two mmap calls is slightly\n+   tricky.  All OS's tested skip over already-allocated blocks; therefore\n+   we have been careful to unmap all allocated regions in previous tests.\n+   HP/UX allocates pages backward in memory.  No OS has yet been observed\n+   to be so perverse as to leave unmapped space between consecutive calls\n+   to mmap.  */\n+\n+static void\n+test_3 ()\n+{\n+  char *x, *y, *z;\n+\n+  x = anonmap (pg);\n+  if (x == (char *)MAP_FAILED)\n+    perror_exit (\"test 3 mmap 1\", 14);\n+  y = anonmap (pg);\n+  if (y == (char *)MAP_FAILED)\n+    perror_exit (\"test 3 mmap 2\", 15);\n+\n+  if (y != x + pg)\n+    {\n+      if (y == x - pg)\n+\tz = y, y = x, x = z;\n+      else\n+\t{\n+\t  fprintf (stderr, \"test 3 nonconsecutive pages - %lx, %lx\\n\",\n+\t\t   (unsigned long)x, (unsigned long)y);\n+\t  exit (16);\n+\t}\n+    }\n+\n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r))\n+    perror_exit (\"test 3 fault\", 17);\n+\n+  x[0] = 1;\n+  y[0] = 1;\n+\n+  if (munmap (x, pg*2) < 0)\n+    perror_exit (\"test 3 munmap\", 18);\n+\n+  if (setjmp (r) == 0)\n+    {\n+      x[0] = 1;\n+      perror_exit (\"test 3 no fault 1\", 19);\n+    }\n+  \n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r) == 0)\n+    {\n+      y[0] = 1;\n+      perror_exit (\"test 3 no fault 2\", 20);\n+    }\n+}\n+\n+int\n+main ()\n+{\n+  sigemptyset (&unblock_sigsegv);\n+  sigaddset (&unblock_sigsegv, SIGSEGV);\n+  pg = getpagesize ();\n+#ifndef USE_MAP_ANON\n+  devzero = open (\"/dev/zero\", O_RDWR);\n+  if (devzero < 0)\n+    perror_exit (\"open /dev/zero\", 1);\n+#endif\n+\n+  test_0();\n+  test_1();\n+  test_2();\n+  test_3();\n \n   exit(0);\n-}], ac_cv_func_mmap_anywhere=yes, ac_cv_func_mmap_anywhere=no,\n-ac_cv_func_mmap_anywhere=no)])\n-if test $ac_cv_func_mmap_anywhere = yes; then\n-  AC_DEFINE(HAVE_MMAP_ANYWHERE, 1,\n-\t    [Define if mmap can get us zeroed pages without MAP_FIXED.])\n+}\n+EOF}}}\n+changequote([,])dnl\n+\n+AC_CACHE_CHECK(for working mmap from /dev/zero,\n+  ac_cv_func_mmap_dev_zero,\n+[AC_TRY_RUN(\n+ [#include \"ct-mmap.inc\"],\n+ ac_cv_func_mmap_dev_zero=yes,\n+ [if test $? -lt 4\n+ then ac_cv_func_mmap_dev_zero=no\n+ else ac_cv_func_mmap_dev_zero=buggy\n+ fi],\n+ # If this is not cygwin, and /dev/zero is a character device, it's probably\n+ # safe to assume it works.\n+ [case \"$host_os\" in\n+   cygwin* | win32 | pe | mingw* ) ac_cv_func_mmap_dev_zero=buggy ;;\n+   * ) if test -c /dev/zero\n+       then ac_cv_func_mmap_dev_zero=yes\n+       else ac_cv_func_mmap_dev_zero=no\n+       fi ;;\n+  esac])\n+])\n+if test $ac_cv_func_mmap_dev_zero = yes; then\n+  AC_DEFINE(HAVE_MMAP_DEV_ZERO, 1,\n+\t    [Define if mmap can get us zeroed pages from /dev/zero.])\n+fi\n+\n+AC_CACHE_CHECK([for working mmap with MAP_ANON(YMOUS)],\n+  ac_cv_func_mmap_anon,\n+[AC_TRY_RUN(\n+ [#define USE_MAP_ANON\n+#include \"ct-mmap.inc\"],\n+ ac_cv_func_mmap_anon=yes,\n+ [if test $? -lt 4\n+ then ac_cv_func_mmap_anon=no\n+ else ac_cv_func_mmap_anon=buggy\n+ fi],\n+ # Unlike /dev/zero, it is not safe to assume MAP_ANON(YMOUS) works\n+ # just because it's there. Some SCO Un*xen define it but don't implement it.\n+ ac_cv_func_mmap_anon=no)\n+])\n+if test $ac_cv_func_mmap_anon = yes; then\n+  AC_DEFINE(HAVE_MMAP_ANON, 1,\n+\t    [Define if mmap can get us zeroed pages using MAP_ANON(YMOUS).])\n fi\n+rm -f ct-mmap.inc\n ])\n \n # Check whether mmap can map a plain file, without MAP_FIXED.\n AC_DEFUN([AC_FUNC_MMAP_FILE], \n-[AC_REQUIRE([AC_FUNC_MMAP_ANYWHERE])dnl\n-AC_CACHE_CHECK(for working mmap of a file, ac_cv_func_mmap_file,\n+[AC_CACHE_CHECK(for working mmap of a file, ac_cv_func_mmap_file,\n [# Create a file one thousand bytes long.\n for i in 1 2 3 4 5 6 7 8 9 0\n do for j in 1 2 3 4 5 6 7 8 9 0"}, {"sha": "5056b42b3879da206ad440b7c4853db30ddc25c0", "filename": "gcc/config.in", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=825b692620b599c2693c11ddbd7cc93dca069e7c", "patch": "@@ -330,8 +330,11 @@\n /* Define if printf supports %p. */\n #undef HAVE_PRINTF_PTR\n \n-/* Define if mmap can get us zeroed pages without MAP_FIXED. */\n-#undef HAVE_MMAP_ANYWHERE\n+/* Define if mmap can get us zeroed pages from /dev/zero. */\n+#undef HAVE_MMAP_DEV_ZERO\n+\n+/* Define if mmap can get us zeroed pages using MAP_ANON(YMOUS). */\n+#undef HAVE_MMAP_ANON\n \n /* Define if read-only mmap of a plain file works. */\n #undef HAVE_MMAP_FILE"}, {"sha": "39e8e467746f57f1d72f19ab3c3ee9adbfbee965", "filename": "gcc/configure", "status": "modified", "additions": 373, "deletions": 190, "changes": 563, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=825b692620b599c2693c11ddbd7cc93dca069e7c", "patch": "@@ -1558,7 +1558,7 @@ for ac_kw in inline __inline__ __inline; do\n #include \"confdefs.h\"\n \n int main() {\n-} $ac_kw foo() {\n+} int $ac_kw foo() {\n ; return 0; }\n EOF\n if { (eval echo configure:1565: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n@@ -1588,7 +1588,7 @@ esac\n \n \n # Find some useful tools\n-for ac_prog in gawk mawk nawk awk\n+for ac_prog in mawk gawk nawk awk\n do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n@@ -3192,55 +3192,15 @@ EOF\n \n fi\n \n-for ac_hdr in unistd.h\n-do\n-ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n-echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:3200: checking for $ac_hdr\" >&5\n-if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n-  echo $ac_n \"(cached) $ac_c\" 1>&6\n-else\n-  cat > conftest.$ac_ext <<EOF\n-#line 3205 \"configure\"\n-#include \"confdefs.h\"\n-#include <$ac_hdr>\n-EOF\n-ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:3210: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n-ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n-if test -z \"$ac_err\"; then\n-  rm -rf conftest*\n-  eval \"ac_cv_header_$ac_safe=yes\"\n-else\n-  echo \"$ac_err\" >&5\n-  echo \"configure: failed program was:\" >&5\n-  cat conftest.$ac_ext >&5\n-  rm -rf conftest*\n-  eval \"ac_cv_header_$ac_safe=no\"\n-fi\n-rm -f conftest*\n-fi\n-if eval \"test \\\"`echo '$ac_cv_header_'$ac_safe`\\\" = yes\"; then\n-  echo \"$ac_t\"\"yes\" 1>&6\n-    ac_tr_hdr=HAVE_`echo $ac_hdr | sed 'y%abcdefghijklmnopqrstuvwxyz./-%ABCDEFGHIJKLMNOPQRSTUVWXYZ___%'`\n-  cat >> confdefs.h <<EOF\n-#define $ac_tr_hdr 1\n-EOF\n- \n-else\n-  echo \"$ac_t\"\"no\" 1>&6\n-fi\n-done\n-\n for ac_func in getpagesize\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3239: checking for $ac_func\" >&5\n+echo \"configure:3199: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3244 \"configure\"\n+#line 3204 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3263,7 +3223,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3267: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3227: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3287,23 +3247,15 @@ else\n fi\n done\n \n-echo $ac_n \"checking for working mmap which provides zeroed pages anywhere\"\"... $ac_c\" 1>&6\n-echo \"configure:3292: checking for working mmap which provides zeroed pages anywhere\" >&5\n-if eval \"test \\\"`echo '$''{'ac_cv_func_mmap_anywhere'+set}'`\\\" = set\"; then\n-  echo $ac_n \"(cached) $ac_c\" 1>&6\n-else\n-  if test \"$cross_compiling\" = yes; then\n-  ac_cv_func_mmap_anywhere=no\n-else\n-  cat > conftest.$ac_ext <<EOF\n-#line 3300 \"configure\"\n-#include \"confdefs.h\"\n-\n-/* Test by Richard Henderson and Alexandre Oliva.\n-   Check whether mmap MAP_ANONYMOUS or mmap from /dev/zero works. */\n+# The test program for the next two tests is the same except for one\n+# set of ifdefs.\n+cat >ct-mmap.inc <<'EOF'\n #include <sys/types.h>\n-#include <fcntl.h>\n #include <sys/mman.h>\n+#include <fcntl.h>\n+#include <signal.h>\n+#include <setjmp.h>\n+#include <stdio.h>\n \n #if !defined (MAP_ANONYMOUS) && defined (MAP_ANON)\n # define MAP_ANONYMOUS MAP_ANON\n@@ -3350,59 +3302,289 @@ else\n \n #endif /* no HAVE_GETPAGESIZE */\n \n-int main()\n-{\n-  char *x;\n-  int fd, pg;\n-\n-#ifndef MAP_ANONYMOUS\n-  fd = open(\"/dev/zero\", O_RDWR);\n-  if (fd < 0)\n-    exit(1);\n+#ifndef MAP_FAILED\n+# define MAP_FAILED -1\n #endif\n \n-  pg = getpagesize();\n-#ifdef MAP_ANONYMOUS\n-  x = (char*)mmap(0, pg, PROT_READ|PROT_WRITE,\n-                  MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);\n+#undef perror_exit\n+#define perror_exit(str, val) \\\n+  do { perror(str); exit(val); } while (0)\n+\n+/* Some versions of cygwin mmap require that munmap is called with the\n+   same parameters as mmap.  GCC expects that this is not the case.\n+   Test for various forms of this problem.  Warning - icky signal games.  */\n+\n+static sigset_t unblock_sigsegv;\n+static jmp_buf r;\n+static size_t pg;\n+static int devzero;\n+\n+static char *\n+anonmap (size)\n+     size_t size;\n+{\n+#ifdef USE_MAP_ANON\n+  return (char *) mmap (0, size, PROT_READ|PROT_WRITE,\n+\t\t\tMAP_PRIVATE|MAP_ANONYMOUS, -1, 0);\n #else\n-  x = (char*)mmap(0, pg, PROT_READ|PROT_WRITE, MAP_PRIVATE, fd, 0);\n+  return (char *) mmap (0, size, PROT_READ|PROT_WRITE,\n+\t\t\tMAP_PRIVATE, devzero, 0);\n #endif\n-  if (x == (char *) -1)\n-    exit(2);\n+}\n+\n+static void\n+sigsegv (unused)\n+     int unused;\n+{\n+  sigprocmask (SIG_UNBLOCK, &unblock_sigsegv, 0);\n+  longjmp (r, 1);\n+}\n+\n+/* Basic functionality test.  */\n+void\n+test_0 ()\n+{\n+  char *x = anonmap (pg);\n+  if (x == (char *) MAP_FAILED)\n+    perror_exit(\"test 0 mmap\", 2);\n \n   *(int *)x += 1;\n \n   if (munmap(x, pg) < 0)\n-    exit(3);\n+    perror_exit(\"test 0 munmap\", 3);\n+}\n+\n+/* 1. If we map a 2-page region and unmap its second page, the first page\n+   must remain.  */\n+static void\n+test_1 ()\n+{\n+  char *x = anonmap (pg * 2);\n+  if (x == (char *)MAP_FAILED)\n+    perror_exit (\"test 1 mmap\", 4);\n+\n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r))\n+    perror_exit (\"test 1 fault\", 5);\n+\n+  x[0] = 1;\n+  x[pg] = 1;\n+\n+  if (munmap (x + pg, pg) < 0)\n+    perror_exit (\"test 1 munmap 1\", 6);\n+  x[0] = 2;\n+\n+  if (setjmp (r) == 0)\n+    {\n+      x[pg] = 1;\n+      perror_exit (\"test 1 no fault\", 7);\n+    }\n+  if (munmap (x, pg) < 0)\n+    perror_exit (\"test 1 munmap 2\", 8);\n+}\n+\n+/* 2. If we map a 2-page region and unmap its first page, the second\n+   page must remain.  */\n+static void\n+test_2 ()\n+{\n+  char *x = anonmap (pg * 2);\n+  if (x == (char *)MAP_FAILED)\n+    perror_exit (\"test 2 mmap\", 9);\n+\n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r))\n+    perror_exit (\"test 2 fault\", 10);\n+\n+  x[0] = 1;\n+  x[pg] = 1;\n+\n+  if (munmap (x, pg) < 0)\n+    perror_exit (\"test 2 munmap 1\", 11);\n+\n+  x[pg] = 2;\n+\n+  if (setjmp (r) == 0)\n+    {\n+      x[0] = 1;\n+      perror_exit (\"test 2 no fault\", 12);\n+    }\n+\n+  if (munmap (x+pg, pg) < 0)\n+    perror_exit (\"test 2 munmap 2\", 13);\n+}\n+\n+/* 3. If we map two adjacent 1-page regions and unmap them both with\n+   one munmap, both must go away.\n+\n+   Getting two adjacent 1-page regions with two mmap calls is slightly\n+   tricky.  All OS's tested skip over already-allocated blocks; therefore\n+   we have been careful to unmap all allocated regions in previous tests.\n+   HP/UX allocates pages backward in memory.  No OS has yet been observed\n+   to be so perverse as to leave unmapped space between consecutive calls\n+   to mmap.  */\n+\n+static void\n+test_3 ()\n+{\n+  char *x, *y, *z;\n+\n+  x = anonmap (pg);\n+  if (x == (char *)MAP_FAILED)\n+    perror_exit (\"test 3 mmap 1\", 14);\n+  y = anonmap (pg);\n+  if (y == (char *)MAP_FAILED)\n+    perror_exit (\"test 3 mmap 2\", 15);\n+\n+  if (y != x + pg)\n+    {\n+      if (y == x - pg)\n+\tz = y, y = x, x = z;\n+      else\n+\t{\n+\t  fprintf (stderr, \"test 3 nonconsecutive pages - %lx, %lx\\n\",\n+\t\t   (unsigned long)x, (unsigned long)y);\n+\t  exit (16);\n+\t}\n+    }\n+\n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r))\n+    perror_exit (\"test 3 fault\", 17);\n+\n+  x[0] = 1;\n+  y[0] = 1;\n+\n+  if (munmap (x, pg*2) < 0)\n+    perror_exit (\"test 3 munmap\", 18);\n+\n+  if (setjmp (r) == 0)\n+    {\n+      x[0] = 1;\n+      perror_exit (\"test 3 no fault 1\", 19);\n+    }\n+  \n+  signal (SIGSEGV, sigsegv);\n+  if (setjmp (r) == 0)\n+    {\n+      y[0] = 1;\n+      perror_exit (\"test 3 no fault 2\", 20);\n+    }\n+}\n+\n+int\n+main ()\n+{\n+  sigemptyset (&unblock_sigsegv);\n+  sigaddset (&unblock_sigsegv, SIGSEGV);\n+  pg = getpagesize ();\n+#ifndef USE_MAP_ANON\n+  devzero = open (\"/dev/zero\", O_RDWR);\n+  if (devzero < 0)\n+    perror_exit (\"open /dev/zero\", 1);\n+#endif\n+\n+  test_0();\n+  test_1();\n+  test_2();\n+  test_3();\n \n   exit(0);\n }\n EOF\n-if { (eval echo configure:3383: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+\n+echo $ac_n \"checking for working mmap from /dev/zero\"\"... $ac_c\" 1>&6\n+echo \"configure:3498: checking for working mmap from /dev/zero\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_func_mmap_dev_zero'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  if test \"$cross_compiling\" = yes; then\n+  # If this is not cygwin, and /dev/zero is a character device, it's probably\n+ # safe to assume it works.\n+ case \"$host_os\" in\n+   cygwin* | win32 | pe | mingw* ) ac_cv_func_mmap_dev_zero=buggy ;;\n+   * ) if test -c /dev/zero\n+       then ac_cv_func_mmap_dev_zero=yes\n+       else ac_cv_func_mmap_dev_zero=no\n+       fi ;;\n+  esac\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 3514 \"configure\"\n+#include \"confdefs.h\"\n+#include \"ct-mmap.inc\"\n+EOF\n+if { (eval echo configure:3518: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+then\n+  ac_cv_func_mmap_dev_zero=yes\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -fr conftest*\n+  if test $? -lt 4\n+ then ac_cv_func_mmap_dev_zero=no\n+ else ac_cv_func_mmap_dev_zero=buggy\n+ fi\n+fi\n+rm -fr conftest*\n+fi\n+\n+\n+fi\n+\n+echo \"$ac_t\"\"$ac_cv_func_mmap_dev_zero\" 1>&6\n+if test $ac_cv_func_mmap_dev_zero = yes; then\n+  cat >> confdefs.h <<\\EOF\n+#define HAVE_MMAP_DEV_ZERO 1\n+EOF\n+\n+fi\n+\n+echo $ac_n \"checking for working mmap with MAP_ANON(YMOUS)\"\"... $ac_c\" 1>&6\n+echo \"configure:3545: checking for working mmap with MAP_ANON(YMOUS)\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_func_mmap_anon'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  if test \"$cross_compiling\" = yes; then\n+  # Unlike /dev/zero, it is not safe to assume MAP_ANON(YMOUS) works\n+ # just because it's there. Some SCO Un*xen define it but don't implement it.\n+ ac_cv_func_mmap_anon=no\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 3555 \"configure\"\n+#include \"confdefs.h\"\n+#define USE_MAP_ANON\n+#include \"ct-mmap.inc\"\n+EOF\n+if { (eval echo configure:3560: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n-  ac_cv_func_mmap_anywhere=yes\n+  ac_cv_func_mmap_anon=yes\n else\n   echo \"configure: failed program was:\" >&5\n   cat conftest.$ac_ext >&5\n   rm -fr conftest*\n-  ac_cv_func_mmap_anywhere=no\n+  if test $? -lt 4\n+ then ac_cv_func_mmap_anon=no\n+ else ac_cv_func_mmap_anon=buggy\n+ fi\n fi\n rm -fr conftest*\n fi\n \n+\n fi\n \n-echo \"$ac_t\"\"$ac_cv_func_mmap_anywhere\" 1>&6\n-if test $ac_cv_func_mmap_anywhere = yes; then\n+echo \"$ac_t\"\"$ac_cv_func_mmap_anon\" 1>&6\n+if test $ac_cv_func_mmap_anon = yes; then\n   cat >> confdefs.h <<\\EOF\n-#define HAVE_MMAP_ANYWHERE 1\n+#define HAVE_MMAP_ANON 1\n EOF\n \n fi\n+rm -f ct-mmap.inc\n \n echo $ac_n \"checking for working mmap of a file\"\"... $ac_c\" 1>&6\n-echo \"configure:3406: checking for working mmap of a file\" >&5\n+echo \"configure:3588: checking for working mmap of a file\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_mmap_file'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3417,7 +3599,7 @@ if test \"$cross_compiling\" = yes; then\n   ac_cv_func_mmap_file=no\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3421 \"configure\"\n+#line 3603 \"configure\"\n #include \"confdefs.h\"\n \n /* Test by Zack Weinberg.  Modified from MMAP_ANYWHERE test by\n@@ -3454,7 +3636,7 @@ int main()\n   exit(0);\n }\n EOF\n-if { (eval echo configure:3458: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:3640: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_func_mmap_file=yes\n else\n@@ -3487,12 +3669,12 @@ for ac_func in bcopy \\\n do\n   ac_tr_decl=HAVE_DECL_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`\n echo $ac_n \"checking whether $ac_func is declared\"\"... $ac_c\" 1>&6\n-echo \"configure:3491: checking whether $ac_func is declared\" >&5\n+echo \"configure:3673: checking whether $ac_func is declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_have_decl_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3496 \"configure\"\n+#line 3678 \"configure\"\n #include \"confdefs.h\"\n #include \"gansidecl.h\"\n #include \"system.h\"\n@@ -3503,7 +3685,7 @@ char *(*pfn) = (char *(*)) $ac_func ;\n #endif\n ; return 0; }\n EOF\n-if { (eval echo configure:3507: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3689: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   eval \"gcc_cv_have_decl_$ac_func=yes\"\n else\n@@ -3596,12 +3778,12 @@ for ac_func in getrlimit setrlimit getrusage\n do\n   ac_tr_decl=HAVE_DECL_`echo $ac_func | tr 'abcdefghijklmnopqrstuvwxyz' 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'`\n echo $ac_n \"checking whether $ac_func is declared\"\"... $ac_c\" 1>&6\n-echo \"configure:3600: checking whether $ac_func is declared\" >&5\n+echo \"configure:3782: checking whether $ac_func is declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_have_decl_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3605 \"configure\"\n+#line 3787 \"configure\"\n #include \"confdefs.h\"\n #include \"gansidecl.h\"\n #include \"system.h\"\n@@ -3616,7 +3798,7 @@ char *(*pfn) = (char *(*)) $ac_func ;\n #endif\n ; return 0; }\n EOF\n-if { (eval echo configure:3620: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3802: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   eval \"gcc_cv_have_decl_$ac_func=yes\"\n else\n@@ -3659,12 +3841,12 @@ CFLAGS=\"$saved_CFLAGS\"\n \n # mkdir takes a single argument on some systems. \n echo $ac_n \"checking if mkdir takes one argument\"\"... $ac_c\" 1>&6\n-echo \"configure:3663: checking if mkdir takes one argument\" >&5\n+echo \"configure:3845: checking if mkdir takes one argument\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_mkdir_takes_one_arg'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3668 \"configure\"\n+#line 3850 \"configure\"\n #include \"confdefs.h\"\n \n #include <sys/types.h>\n@@ -3681,7 +3863,7 @@ int main() {\n mkdir (\"foo\", 0);\n ; return 0; }\n EOF\n-if { (eval echo configure:3685: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:3867: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_mkdir_takes_one_arg=no\n else\n@@ -3992,15 +4174,15 @@ fi\n \n \n         echo $ac_n \"checking for strerror in -lcposix\"\"... $ac_c\" 1>&6\n-echo \"configure:3996: checking for strerror in -lcposix\" >&5\n+echo \"configure:4178: checking for strerror in -lcposix\" >&5\n ac_lib_var=`echo cposix'_'strerror | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lcposix  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4004 \"configure\"\n+#line 4186 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4011,7 +4193,7 @@ int main() {\n strerror()\n ; return 0; }\n EOF\n-if { (eval echo configure:4015: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4197: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4034,18 +4216,18 @@ fi\n   \n \n echo $ac_n \"checking for working const\"\"... $ac_c\" 1>&6\n-echo \"configure:4038: checking for working const\" >&5\n+echo \"configure:4220: checking for working const\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_const'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4043 \"configure\"\n+#line 4225 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n \n /* Ultrix mips cc rejects this.  */\n-typedef int charset[2]; const charset x;\n+typedef int charset[2]; const charset x = {0,0};\n /* SunOS 4.1.1 cc rejects this.  */\n char const *const *ccp;\n char **p;\n@@ -4088,7 +4270,7 @@ ccp = (char const *const *) p;\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4092: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4274: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_c_const=yes\n else\n@@ -4109,12 +4291,12 @@ EOF\n fi\n \n echo $ac_n \"checking for off_t\"\"... $ac_c\" 1>&6\n-echo \"configure:4113: checking for off_t\" >&5\n+echo \"configure:4295: checking for off_t\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_type_off_t'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4118 \"configure\"\n+#line 4300 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -4142,12 +4324,12 @@ EOF\n fi\n \n echo $ac_n \"checking for size_t\"\"... $ac_c\" 1>&6\n-echo \"configure:4146: checking for size_t\" >&5\n+echo \"configure:4328: checking for size_t\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_type_size_t'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4151 \"configure\"\n+#line 4333 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #if STDC_HEADERS\n@@ -4177,19 +4359,19 @@ fi\n # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works\n # for constant arguments.  Useless!\n echo $ac_n \"checking for working alloca.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4181: checking for working alloca.h\" >&5\n+echo \"configure:4363: checking for working alloca.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_alloca_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4186 \"configure\"\n+#line 4368 \"configure\"\n #include \"confdefs.h\"\n #include <alloca.h>\n int main() {\n-char *p = alloca(2 * sizeof(int));\n+void *p = alloca(2 * sizeof(int));\n ; return 0; }\n EOF\n-if { (eval echo configure:4193: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4375: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_header_alloca_h=yes\n else\n@@ -4210,12 +4392,12 @@ EOF\n fi\n \n echo $ac_n \"checking for alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:4214: checking for alloca\" >&5\n+echo \"configure:4396: checking for alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_alloca_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4219 \"configure\"\n+#line 4401 \"configure\"\n #include \"confdefs.h\"\n \n #ifdef __GNUC__\n@@ -4243,7 +4425,7 @@ int main() {\n char *p = (char *) alloca(1);\n ; return 0; }\n EOF\n-if { (eval echo configure:4247: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4429: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_alloca_works=yes\n else\n@@ -4275,12 +4457,12 @@ EOF\n \n \n echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:4279: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:4461: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4284 \"configure\"\n+#line 4466 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -4305,12 +4487,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n for ac_func in _getb67 GETB67 getb67; do\n   echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4309: checking for $ac_func\" >&5\n+echo \"configure:4491: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4314 \"configure\"\n+#line 4496 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4333,7 +4515,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4337: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4519: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4360,15 +4542,15 @@ done\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:4364: checking stack direction for C alloca\" >&5\n+echo \"configure:4546: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4372 \"configure\"\n+#line 4554 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -4387,7 +4569,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:4391: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:4573: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -4414,17 +4596,17 @@ unistd.h sys/param.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:4418: checking for $ac_hdr\" >&5\n+echo \"configure:4600: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4423 \"configure\"\n+#line 4605 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4428: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4610: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4454,12 +4636,12 @@ done\n strdup __argz_count __argz_stringify __argz_next\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4458: checking for $ac_func\" >&5\n+echo \"configure:4640: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4463 \"configure\"\n+#line 4645 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4482,7 +4664,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4486: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4668: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4511,12 +4693,12 @@ done\n      for ac_func in stpcpy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4515: checking for $ac_func\" >&5\n+echo \"configure:4697: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4520 \"configure\"\n+#line 4702 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4539,7 +4721,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4543: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4725: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4573,19 +4755,19 @@ EOF\n \n    if test $ac_cv_header_locale_h = yes; then\n     echo $ac_n \"checking for LC_MESSAGES\"\"... $ac_c\" 1>&6\n-echo \"configure:4577: checking for LC_MESSAGES\" >&5\n+echo \"configure:4759: checking for LC_MESSAGES\" >&5\n if eval \"test \\\"`echo '$''{'am_cv_val_LC_MESSAGES'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4582 \"configure\"\n+#line 4764 \"configure\"\n #include \"confdefs.h\"\n #include <locale.h>\n int main() {\n return LC_MESSAGES\n ; return 0; }\n EOF\n-if { (eval echo configure:4589: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4771: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   am_cv_val_LC_MESSAGES=yes\n else\n@@ -4606,7 +4788,7 @@ EOF\n     fi\n   fi\n    echo $ac_n \"checking whether NLS is requested\"\"... $ac_c\" 1>&6\n-echo \"configure:4610: checking whether NLS is requested\" >&5\n+echo \"configure:4792: checking whether NLS is requested\" >&5\n         # Check whether --enable-nls or --disable-nls was given.\n if test \"${enable_nls+set}\" = set; then\n   enableval=\"$enable_nls\"\n@@ -4626,7 +4808,7 @@ fi\n EOF\n \n       echo $ac_n \"checking whether included gettext is requested\"\"... $ac_c\" 1>&6\n-echo \"configure:4630: checking whether included gettext is requested\" >&5\n+echo \"configure:4812: checking whether included gettext is requested\" >&5\n       # Check whether --with-included-gettext or --without-included-gettext was given.\n if test \"${with_included_gettext+set}\" = set; then\n   withval=\"$with_included_gettext\"\n@@ -4645,17 +4827,17 @@ fi\n \n \tac_safe=`echo \"libintl.h\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for libintl.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4649: checking for libintl.h\" >&5\n+echo \"configure:4831: checking for libintl.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4654 \"configure\"\n+#line 4836 \"configure\"\n #include \"confdefs.h\"\n #include <libintl.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4659: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4841: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4672,19 +4854,19 @@ fi\n if eval \"test \\\"`echo '$ac_cv_header_'$ac_safe`\\\" = yes\"; then\n   echo \"$ac_t\"\"yes\" 1>&6\n   echo $ac_n \"checking for gettext in libc\"\"... $ac_c\" 1>&6\n-echo \"configure:4676: checking for gettext in libc\" >&5\n+echo \"configure:4858: checking for gettext in libc\" >&5\n if eval \"test \\\"`echo '$''{'gt_cv_func_gettext_libc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4681 \"configure\"\n+#line 4863 \"configure\"\n #include \"confdefs.h\"\n #include <libintl.h>\n int main() {\n return (int) gettext (\"\")\n ; return 0; }\n EOF\n-if { (eval echo configure:4688: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4870: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   gt_cv_func_gettext_libc=yes\n else\n@@ -4700,15 +4882,15 @@ echo \"$ac_t\"\"$gt_cv_func_gettext_libc\" 1>&6\n \n \t   if test \"$gt_cv_func_gettext_libc\" != \"yes\"; then\n \t     echo $ac_n \"checking for bindtextdomain in -lintl\"\"... $ac_c\" 1>&6\n-echo \"configure:4704: checking for bindtextdomain in -lintl\" >&5\n+echo \"configure:4886: checking for bindtextdomain in -lintl\" >&5\n ac_lib_var=`echo intl'_'bindtextdomain | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lintl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4712 \"configure\"\n+#line 4894 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4719,7 +4901,7 @@ int main() {\n bindtextdomain()\n ; return 0; }\n EOF\n-if { (eval echo configure:4723: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4905: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4735,20 +4917,20 @@ fi\n if eval \"test \\\"`echo '$ac_cv_lib_'$ac_lib_var`\\\" = yes\"; then\n   echo \"$ac_t\"\"yes\" 1>&6\n   echo $ac_n \"checking for gettext in libintl\"\"... $ac_c\" 1>&6\n-echo \"configure:4739: checking for gettext in libintl\" >&5\n+echo \"configure:4921: checking for gettext in libintl\" >&5\n if eval \"test \\\"`echo '$''{'gt_cv_func_gettext_libintl'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   echo $ac_n \"checking for gettext in -lintl\"\"... $ac_c\" 1>&6\n-echo \"configure:4744: checking for gettext in -lintl\" >&5\n+echo \"configure:4926: checking for gettext in -lintl\" >&5\n ac_lib_var=`echo intl'_'gettext | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lintl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4752 \"configure\"\n+#line 4934 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4759,7 +4941,7 @@ int main() {\n gettext()\n ; return 0; }\n EOF\n-if { (eval echo configure:4763: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4945: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4798,7 +4980,7 @@ EOF\n \t      # Extract the first word of \"msgfmt\", so it can be a program name with args.\n set dummy msgfmt; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4802: checking for $ac_word\" >&5\n+echo \"configure:4984: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_MSGFMT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4832,12 +5014,12 @@ fi\n \t\tfor ac_func in dcgettext\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4836: checking for $ac_func\" >&5\n+echo \"configure:5018: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4841 \"configure\"\n+#line 5023 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4860,7 +5042,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4864: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5046: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4887,7 +5069,7 @@ done\n \t\t# Extract the first word of \"gmsgfmt\", so it can be a program name with args.\n set dummy gmsgfmt; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4891: checking for $ac_word\" >&5\n+echo \"configure:5073: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_GMSGFMT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4923,7 +5105,7 @@ fi\n \t\t# Extract the first word of \"xgettext\", so it can be a program name with args.\n set dummy xgettext; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4927: checking for $ac_word\" >&5\n+echo \"configure:5109: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_XGETTEXT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4955,15 +5137,15 @@ else\n fi\n \n \t\tcat > conftest.$ac_ext <<EOF\n-#line 4959 \"configure\"\n+#line 5141 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n extern int _nl_msg_cat_cntr;\n \t\t\t       return _nl_msg_cat_cntr\n ; return 0; }\n EOF\n-if { (eval echo configure:4967: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5149: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   CATOBJEXT=.gmo\n \t\t   DATADIRNAME=share\n@@ -4988,7 +5170,7 @@ fi\n \n         if test \"$CATOBJEXT\" = \"NONE\"; then\n \t  echo $ac_n \"checking whether catgets can be used\"\"... $ac_c\" 1>&6\n-echo \"configure:4992: checking whether catgets can be used\" >&5\n+echo \"configure:5174: checking whether catgets can be used\" >&5\n \t  # Check whether --with-catgets or --without-catgets was given.\n if test \"${with_catgets+set}\" = set; then\n   withval=\"$with_catgets\"\n@@ -5001,22 +5183,22 @@ fi\n \n \t  if test \"$nls_cv_use_catgets\" = \"yes\"; then\n \t    \t    echo $ac_n \"checking for main in -li\"\"... $ac_c\" 1>&6\n-echo \"configure:5005: checking for main in -li\" >&5\n+echo \"configure:5187: checking for main in -li\" >&5\n ac_lib_var=`echo i'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-li  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 5013 \"configure\"\n+#line 5195 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:5020: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5202: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -5044,12 +5226,12 @@ else\n fi\n \n \t    echo $ac_n \"checking for catgets\"\"... $ac_c\" 1>&6\n-echo \"configure:5048: checking for catgets\" >&5\n+echo \"configure:5230: checking for catgets\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_catgets'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5053 \"configure\"\n+#line 5235 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char catgets(); below.  */\n@@ -5072,7 +5254,7 @@ catgets();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:5076: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:5258: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_catgets=yes\"\n else\n@@ -5094,7 +5276,7 @@ EOF\n \t       # Extract the first word of \"gencat\", so it can be a program name with args.\n set dummy gencat; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5098: checking for $ac_word\" >&5\n+echo \"configure:5280: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_GENCAT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5130,7 +5312,7 @@ fi\n \t\t # Extract the first word of \"gmsgfmt\", so it can be a program name with args.\n set dummy gmsgfmt; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5134: checking for $ac_word\" >&5\n+echo \"configure:5316: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_GMSGFMT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5167,7 +5349,7 @@ fi\n \t\t   # Extract the first word of \"msgfmt\", so it can be a program name with args.\n set dummy msgfmt; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5171: checking for $ac_word\" >&5\n+echo \"configure:5353: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_GMSGFMT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5205,7 +5387,7 @@ fi\n \t\t # Extract the first word of \"xgettext\", so it can be a program name with args.\n set dummy xgettext; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5209: checking for $ac_word\" >&5\n+echo \"configure:5391: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_XGETTEXT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5263,7 +5445,7 @@ fi\n         # Extract the first word of \"msgfmt\", so it can be a program name with args.\n set dummy msgfmt; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5267: checking for $ac_word\" >&5\n+echo \"configure:5449: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_MSGFMT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5297,7 +5479,7 @@ fi\n         # Extract the first word of \"gmsgfmt\", so it can be a program name with args.\n set dummy gmsgfmt; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5301: checking for $ac_word\" >&5\n+echo \"configure:5483: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_GMSGFMT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5336,7 +5518,7 @@ fi\n         # Extract the first word of \"xgettext\", so it can be a program name with args.\n set dummy xgettext; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:5340: checking for $ac_word\" >&5\n+echo \"configure:5522: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_path_XGETTEXT'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -5435,7 +5617,7 @@ fi\n        LINGUAS=\n      else\n        echo $ac_n \"checking for catalogs to be installed\"\"... $ac_c\" 1>&6\n-echo \"configure:5439: checking for catalogs to be installed\" >&5\n+echo \"configure:5621: checking for catalogs to be installed\" >&5\n        if test \"x$LINGUAS\" = \"x\"; then\n \t LINGUAS=$ALL_LINGUAS\n        else\n@@ -5467,17 +5649,17 @@ echo \"configure:5439: checking for catalogs to be installed\" >&5\n    if test \"$CATOBJEXT\" = \".cat\"; then\n      ac_safe=`echo \"linux/version.h\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for linux/version.h\"\"... $ac_c\" 1>&6\n-echo \"configure:5471: checking for linux/version.h\" >&5\n+echo \"configure:5653: checking for linux/version.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 5476 \"configure\"\n+#line 5658 \"configure\"\n #include \"confdefs.h\"\n #include <linux/version.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:5481: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:5663: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -5552,7 +5734,7 @@ fi\n \n \n echo $ac_n \"checking whether windows registry support is requested\"\"... $ac_c\" 1>&6\n-echo \"configure:5556: checking whether windows registry support is requested\" >&5\n+echo \"configure:5738: checking whether windows registry support is requested\" >&5\n if test x$enable_win32_registry != xno; then\n   cat >> confdefs.h <<\\EOF\n #define ENABLE_WIN32_REGISTRY 1\n@@ -5581,7 +5763,7 @@ esac\n \n if test x$enable_win32_registry != xno; then\n   echo $ac_n \"checking registry key on windows hosts\"\"... $ac_c\" 1>&6\n-echo \"configure:5585: checking registry key on windows hosts\" >&5\n+echo \"configure:5767: checking registry key on windows hosts\" >&5\n   cat >> confdefs.h <<EOF\n #define WIN32_REGISTRY_KEY \"$gcc_cv_win32_registry_key\"\n EOF\n@@ -5761,7 +5943,7 @@ fi\n \n # Figure out what assembler we will be using.\n echo $ac_n \"checking what assembler to use\"\"... $ac_c\" 1>&6\n-echo \"configure:5765: checking what assembler to use\" >&5\n+echo \"configure:5947: checking what assembler to use\" >&5\n gcc_cv_as=\n gcc_cv_gas_major_version=\n gcc_cv_gas_minor_version=\n@@ -5846,7 +6028,7 @@ fi\n \n # Figure out what nm we will be using.\n echo $ac_n \"checking what nm to use\"\"... $ac_c\" 1>&6\n-echo \"configure:5850: checking what nm to use\" >&5\n+echo \"configure:6032: checking what nm to use\" >&5\n if test -x nm$host_exeext; then\n \tgcc_cv_nm=./nm$host_exeext\n elif test x$host = x$target; then\n@@ -5857,7 +6039,7 @@ echo \"$ac_t\"\"$gcc_cv_nm\" 1>&6\n \n # Figure out what assembler alignment features are present.\n echo $ac_n \"checking assembler alignment features\"\"... $ac_c\" 1>&6\n-echo \"configure:5861: checking assembler alignment features\" >&5\n+echo \"configure:6043: checking assembler alignment features\" >&5\n gcc_cv_as_alignment_features=none\n if test x$gcc_cv_gas_major_version != x -a x$gcc_cv_gas_minor_version != x; then\n \t# Gas version 2.6 and later support for .balign and .p2align.\n@@ -5905,7 +6087,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_alignment_features\" 1>&6\n \n echo $ac_n \"checking assembler subsection support\"\"... $ac_c\" 1>&6\n-echo \"configure:5909: checking assembler subsection support\" >&5\n+echo \"configure:6091: checking assembler subsection support\" >&5\n gcc_cv_as_subsections=no\n if test x$gcc_cv_gas_major_version != x -a x$gcc_cv_gas_minor_version != x; then\n   if test \"$gcc_cv_gas_major_version\" -eq 2 -a \"$gcc_cv_gas_minor_version\" -ge 9 -o \"$gcc_cv_gas_major_version\" -gt 2 && grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n@@ -5945,7 +6127,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_subsections\" 1>&6\n \n echo $ac_n \"checking assembler weak support\"\"... $ac_c\" 1>&6\n-echo \"configure:5949: checking assembler weak support\" >&5\n+echo \"configure:6131: checking assembler weak support\" >&5\n gcc_cv_as_weak=no\n if test x$gcc_cv_gas_major_version != x -a x$gcc_cv_gas_minor_version != x; then\n   if test \"$gcc_cv_gas_major_version\" -eq 2 -a \"$gcc_cv_gas_minor_version\" -ge 2 -o \"$gcc_cv_gas_major_version\" -gt 2; then\n@@ -5968,7 +6150,7 @@ fi\n echo \"$ac_t\"\"$gcc_cv_as_weak\" 1>&6\n \n echo $ac_n \"checking assembler hidden support\"\"... $ac_c\" 1>&6\n-echo \"configure:5972: checking assembler hidden support\" >&5\n+echo \"configure:6154: checking assembler hidden support\" >&5\n gcc_cv_as_hidden=no\n if test x$gcc_cv_gas_major_version != x -a x$gcc_cv_gas_minor_version != x; then\n   if test \"$gcc_cv_gas_major_version\" -eq 2 -a \"$gcc_cv_gas_minor_version\" -ge 10 -o \"$gcc_cv_gas_major_version\" -gt 2 && grep 'obj_format = elf' ../gas/Makefile > /dev/null; then\n@@ -5994,7 +6176,7 @@ echo \"$ac_t\"\"$gcc_cv_as_hidden\" 1>&6\n case \"$target\" in \n   sparc*-*-*)\n     echo $ac_n \"checking assembler .register pseudo-op support\"\"... $ac_c\" 1>&6\n-echo \"configure:5998: checking assembler .register pseudo-op support\" >&5\n+echo \"configure:6180: checking assembler .register pseudo-op support\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_register_pseudo_op'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -6022,7 +6204,7 @@ EOF\n     fi\n \n     echo $ac_n \"checking assembler supports -relax\"\"... $ac_c\" 1>&6\n-echo \"configure:6026: checking assembler supports -relax\" >&5\n+echo \"configure:6208: checking assembler supports -relax\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_relax_opt'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -6052,7 +6234,7 @@ EOF\n     case \"$tm_file\" in\n     *64*)\n \techo $ac_n \"checking for 64 bit support in assembler ($gcc_cv_as)\"\"... $ac_c\" 1>&6\n-echo \"configure:6056: checking for 64 bit support in assembler ($gcc_cv_as)\" >&5\n+echo \"configure:6238: checking for 64 bit support in assembler ($gcc_cv_as)\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_flags64'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -6097,7 +6279,7 @@ EOF\n \n     if test \"x$gcc_cv_as_flags64\" != xno; then\n \techo $ac_n \"checking for assembler offsetable %lo() support\"\"... $ac_c\" 1>&6\n-echo \"configure:6101: checking for assembler offsetable %lo() support\" >&5\n+echo \"configure:6283: checking for assembler offsetable %lo() support\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_as_offsetable_lo10'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -6136,7 +6318,7 @@ EOF\n \n   i[34567]86-*-*)\n     echo $ac_n \"checking assembler instructions\"\"... $ac_c\" 1>&6\n-echo \"configure:6140: checking assembler instructions\" >&5\n+echo \"configure:6322: checking assembler instructions\" >&5\n     gcc_cv_as_instructions=\n     if test x$gcc_cv_gas_major_version != x -a x$gcc_cv_gas_minor_version != x; then\n       if test \"$gcc_cv_gas_major_version\" -eq 2 -a \"$gcc_cv_gas_minor_version\" -ge 9 -o \"$gcc_cv_gas_major_version\" -gt 2; then\n@@ -6165,7 +6347,7 @@ EOF\n esac\n \n echo $ac_n \"checking assembler dwarf2 debug_line support\"\"... $ac_c\" 1>&6\n-echo \"configure:6169: checking assembler dwarf2 debug_line support\" >&5\n+echo \"configure:6351: checking assembler dwarf2 debug_line support\" >&5\n gcc_cv_as_dwarf2_debug_line=no\n # ??? Not all targets support dwarf2 debug_line, even within a version\n # of gas.  Moreover, we need to emit a valid instruction to trigger any\n@@ -6284,7 +6466,8 @@ if test \"${with_gc+set}\" = set; then\n     ;;\n esac\n else\n-  if test $ac_cv_func_mmap_anywhere = yes \\\n+  if test $ac_cv_func_mmap_dev_zero = yes \\\n+    || test $ac_cv_func_mmap_anon = yes \\\n     || test $ac_cv_func_valloc = yes; then\n   GGC=ggc-page\n else\n@@ -6338,7 +6521,7 @@ EOF\n \n \n echo $ac_n \"checking whether to enable maintainer-specific portions of Makefiles\"\"... $ac_c\" 1>&6\n-echo \"configure:6342: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n+echo \"configure:6525: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n     # Check whether --enable-maintainer-mode or --disable-maintainer-mode was given.\n if test \"${enable_maintainer_mode+set}\" = set; then\n   enableval=\"$enable_maintainer_mode\""}, {"sha": "e318236bdea2d3c883415436e8266870c1263482", "filename": "gcc/configure.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.in?ref=825b692620b599c2693c11ddbd7cc93dca069e7c", "patch": "@@ -1565,7 +1565,8 @@ AC_ARG_WITH(gc,\n     AC_MSG_ERROR([$withval is an invalid option to --with-gc])\n     ;;\n esac],\n-[if test $ac_cv_func_mmap_anywhere = yes \\\n+[if test $ac_cv_func_mmap_dev_zero = yes \\\n+    || test $ac_cv_func_mmap_anon = yes \\\n     || test $ac_cv_func_valloc = yes; then\n   GGC=ggc-page\n else"}, {"sha": "b5c6d57be74784b8b92fca21d33e117717e9b517", "filename": "gcc/ggc-page.c", "status": "modified", "additions": 54, "deletions": 36, "changes": 90, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fggc-page.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/825b692620b599c2693c11ddbd7cc93dca069e7c/gcc%2Fggc-page.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fggc-page.c?ref=825b692620b599c2693c11ddbd7cc93dca069e7c", "patch": "@@ -29,16 +29,37 @@ Boston, MA 02111-1307, USA.  */\n #include \"ggc.h\"\n #include \"timevar.h\"\n \n-#ifdef HAVE_MMAP_ANYWHERE\n-#include <sys/mman.h>\n+/* Prefer MAP_ANON(YMOUS) to /dev/zero, since we don't need to keep a\n+   file open.  Prefer either to valloc.  */\n+#ifdef HAVE_MMAP_ANON\n+# undef HAVE_MMAP_DEV_ZERO\n+# undef HAVE_VALLOC\n+\n+# include <sys/mman.h>\n+# ifndef MAP_FAILED\n+#  define MAP_FAILED -1\n+# endif\n+# if !defined (MAP_ANONYMOUS) && defined (MAP_ANON)\n+#  define MAP_ANONYMOUS MAP_ANON\n+# endif\n+# define USING_MMAP\n+\n #endif\n \n-#ifndef MAP_FAILED\n-#define MAP_FAILED -1\n+#ifdef HAVE_MMAP_DEV_ZERO\n+# undef HAVE_VALLOC\n+\n+# include <sys/mman.h>\n+# ifndef MAP_FAILED\n+#  define MAP_FAILED -1\n+# endif\n+# define USING_MMAP\n+\n #endif\n \n-#if !defined (MAP_ANONYMOUS) && defined (MAP_ANON)\n-#define MAP_ANONYMOUS MAP_ANON\n+#ifdef HAVE_VALLOC\n+# undef MAP_FAILED\n+# define MAP_FAILED 0\n #endif\n \n /* Stategy: \n@@ -279,7 +300,7 @@ static struct globals\n   unsigned short context_depth;\n \n   /* A file descriptor open to /dev/zero for reading.  */\n-#if defined (HAVE_MMAP_ANYWHERE) && !defined(MAP_ANONYMOUS)\n+#if defined (HAVE_MMAP_DEV_ZERO)\n   int dev_zero_fd;\n #endif\n \n@@ -445,38 +466,31 @@ debug_print_page_list (order)\n }\n \n /* Allocate SIZE bytes of anonymous memory, preferably near PREF,\n-   (if non-null).  */\n+   (if non-null).  The ifdef structure here is intended to cause a\n+   compile error unless exactly one of the HAVE_* is defined.  */\n \n static inline char *\n alloc_anon (pref, size)\n      char *pref ATTRIBUTE_UNUSED;\n      size_t size;\n {\n-  char *page;\n-\n-#ifdef HAVE_MMAP_ANYWHERE\n-#ifdef MAP_ANONYMOUS\n-  page = (char *) mmap (pref, size, PROT_READ | PROT_WRITE,\n-\t\t\tMAP_PRIVATE | MAP_ANONYMOUS, -1, 0);\n-#else\n-  page = (char *) mmap (pref, size, PROT_READ | PROT_WRITE,\n-\t\t\tMAP_PRIVATE, G.dev_zero_fd, 0);\n+#ifdef HAVE_MMAP_ANON\n+  char *page = (char *) mmap (pref, size, PROT_READ | PROT_WRITE,\n+\t\t\t      MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);\n+#endif\n+#ifdef HAVE_MMAP_DEV_ZERO\n+  char *page = (char *) mmap (pref, size, PROT_READ | PROT_WRITE,\n+\t\t\t      MAP_PRIVATE, G.dev_zero_fd, 0);\n #endif\n-  if (page == (char *) MAP_FAILED)\n-    {\n-      fputs (\"Virtual memory exhausted!\\n\", stderr);\n-      exit(1);\n-    }\n-#else\n #ifdef HAVE_VALLOC\n-  page = (char *) valloc (size);\n-  if (!page)\n+  char *page = (char *) valloc (size);\n+#endif\n+\n+  if (page == (char *) MAP_FAILED)\n     {\n       fputs (\"Virtual memory exhausted!\\n\", stderr);\n       exit(1);\n     }\n-#endif /* HAVE_VALLOC */\n-#endif /* HAVE_MMAP_ANYWHERE */\n \n   /* Remember that we allocated this memory.  */\n   G.bytes_mapped += size;\n@@ -526,7 +540,7 @@ alloc_page (order)\n       else\n \tfree (p);\n     }\n-#ifdef HAVE_MMAP_ANYWHERE\n+#ifdef USING_MMAP\n   else if (entry_size == G.pagesize)\n     {\n       /* We want just one page.  Allocate a bunch of them and put the\n@@ -601,7 +615,7 @@ release_pages ()\n {\n   page_entry *p, *next;\n \n-#ifdef HAVE_MMAP_ANYWHERE\n+#ifdef USING_MMAP\n   char *start;\n   size_t len;\n \n@@ -628,17 +642,14 @@ release_pages ()\n       G.bytes_mapped -= len;\n     }\n #else\n-#ifdef HAVE_VALLOC\n-\n   for (p = G.free_pages; p; p = next)\n     {\n       next = p->next;\n       free (p->page);\n       G.bytes_mapped -= p->bytes;\n       free (p);\n     }\n-#endif /* HAVE_VALLOC */\n-#endif /* HAVE_MMAP_ANYWHERE */\n+#endif /* USING_MMAP */\n \n   G.free_pages = NULL;\n }\n@@ -849,7 +860,7 @@ init_ggc ()\n   G.pagesize = getpagesize();\n   G.lg_pagesize = exact_log2 (G.pagesize);\n \n-#if defined (HAVE_MMAP_ANYWHERE) && !defined(MAP_ANONYMOUS)\n+#ifdef HAVE_MMAP_DEV_ZERO\n   G.dev_zero_fd = open (\"/dev/zero\", O_RDONLY);\n   if (G.dev_zero_fd == -1)\n     abort ();\n@@ -863,13 +874,14 @@ init_ggc ()\n \n   G.allocated_last_gc = GGC_MIN_LAST_ALLOCATED;\n \n-#ifdef HAVE_MMAP_ANYWHERE\n+#ifdef USING_MMAP\n   /* StunOS has an amazing off-by-one error for the first mmap allocation\n      after fiddling with RLIMIT_STACK.  The result, as hard as it is to\n      believe, is an unaligned page allocation, which would cause us to\n      hork badly if we tried to use it.  */\n   {\n     char *p = alloc_anon (NULL, G.pagesize);\n+    struct page_entry *e;\n     if ((size_t)p & (G.pagesize - 1))\n       {\n \t/* How losing.  Discard this one and try another.  If we still\n@@ -879,7 +891,13 @@ init_ggc ()\n \tif ((size_t)p & (G.pagesize - 1))\n \t  abort ();\n       }\n-    munmap (p, G.pagesize);\n+\n+    /* We have a good page, might as well hold onto it... */\n+    e = (struct page_entry *) xcalloc (1, sizeof (struct page_entry));\n+    e->bytes = G.pagesize;\n+    e->page = p;\n+    e->next = G.free_pages;\n+    G.free_pages = e;\n   }\n #endif\n "}]}