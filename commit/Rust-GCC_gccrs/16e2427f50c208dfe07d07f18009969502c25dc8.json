{"sha": "16e2427f50c208dfe07d07f18009969502c25dc8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZlMjQyN2Y1MGMyMDhkZmUwN2QwN2YxODAwOTk2OTUwMmMyNWRjOA==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2020-10-23T13:54:58Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2020-10-24T08:38:33Z"}, "message": "Handle undefined ranges in get_size_range.\n\nAn undefined range was leaking through to the end of this function,\nwhich leads us to use an uninitialized wide_int.\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/97538\n\t* calls.c (get_size_range): Handle undefined ranges.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/pr97538.C: New test.", "tree": {"sha": "73a81d852f46e6b10b293b30a1029dbefffde12a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/73a81d852f46e6b10b293b30a1029dbefffde12a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16e2427f50c208dfe07d07f18009969502c25dc8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16e2427f50c208dfe07d07f18009969502c25dc8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16e2427f50c208dfe07d07f18009969502c25dc8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16e2427f50c208dfe07d07f18009969502c25dc8/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a29ff9c53a77b6e208350d8c6db0f3e988f61d1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a29ff9c53a77b6e208350d8c6db0f3e988f61d1f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a29ff9c53a77b6e208350d8c6db0f3e988f61d1f"}], "stats": {"total": 37, "additions": 31, "deletions": 6}, "files": [{"sha": "17b8e2f7a0d3cc3ff065f5bac64a2afea8d32d5b", "filename": "gcc/calls.c", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e2427f50c208dfe07d07f18009969502c25dc8/gcc%2Fcalls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e2427f50c208dfe07d07f18009969502c25dc8/gcc%2Fcalls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.c?ref=16e2427f50c208dfe07d07f18009969502c25dc8", "patch": "@@ -1269,16 +1269,14 @@ get_size_range (range_query *query, tree exp, gimple *stmt, tree range[2],\n       value_range vr;\n       if (query && query->range_of_expr (vr, exp, stmt))\n \t{\n+\t  if (vr.undefined_p ())\n+\t    vr.set_varying (TREE_TYPE (exp));\n \t  range_type = vr.kind ();\n-\t  if (!vr.undefined_p ())\n-\t    {\n-\t      min = wi::to_wide (vr.min ());\n-\t      max = wi::to_wide (vr.max ());\n-\t    }\n+\t  min = wi::to_wide (vr.min ());\n+\t  max = wi::to_wide (vr.max ());\n \t}\n       else\n \trange_type = determine_value_range (exp, &min, &max);\n-\n     }\n   else\n     range_type = VR_VARYING;"}, {"sha": "b29b1e40aa4e544559e3136275e739928003eae6", "filename": "gcc/testsuite/g++.dg/pr97538.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16e2427f50c208dfe07d07f18009969502c25dc8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr97538.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16e2427f50c208dfe07d07f18009969502c25dc8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr97538.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr97538.C?ref=16e2427f50c208dfe07d07f18009969502c25dc8", "patch": "@@ -0,0 +1,27 @@\n+// { dg-do compile }\n+// { dg-options \"-fno-guess-branch-probability -fno-tree-pta -O1\" }\n+\n+void *b, *c;\n+struct H {\n+  virtual bool accept(const char *, unsigned long, int *, bool);\n+};\n+char accept_bt[1], accept_cd[1];\n+int accept_cb;\n+bool accept_cb_0;\n+class t : H {\n+  bool accept(const char *, unsigned long bd, int *bg, bool) {\n+    long bu = sizeof(int) + bd;\n+    char *bw = bu > sizeof(accept_bt) ? new char : accept_bt,\n+         *cf = bd ? new char : accept_cd;\n+    __builtin___memcpy_chk(b, c, bd, 0);\n+    if (bw != accept_bt)\n+      delete bw;\n+    bool ci = cj((int *)cf, bg), atran = bp && accept_cb_0;\n+    atran &&ci &&cm(&accept_cb);\n+    return ci;\n+  }\n+  bool cj(int *, int *);\n+  bool cm(int *);\n+  bool bp;\n+};\n+void bj() { new t; }"}]}