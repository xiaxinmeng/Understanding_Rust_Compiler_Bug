{"sha": "16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZmOGZmYzgzMWU5OWNmMjhlZDdmZTJhYTlmOTZlZjhkZGEzMDY3OA==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-05-06T04:10:53Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-05-06T04:10:53Z"}, "message": "re PR fortran/31251 (Non-integer character length leads to segfault)\n\n2007-05-05  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/31251\n\t* decl.c (match_char_spec): Add check for invalid character lengths.\n\n2007-05-05  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/31251\n\t* gfortran.dg/char_type_len_2.f90: New test.\n\nFrom-SVN: r124469", "tree": {"sha": "9bf07d951e73fd47e03d74eb9003a09385971baa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9bf07d951e73fd47e03d74eb9003a09385971baa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/comments", "author": null, "committer": null, "parents": [{"sha": "a758fa89b5177aa2f986245c0b926f7c9376ab5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a758fa89b5177aa2f986245c0b926f7c9376ab5a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a758fa89b5177aa2f986245c0b926f7c9376ab5a"}], "stats": {"total": 29, "additions": 28, "deletions": 1}, "files": [{"sha": "9435165ffc30227908e7d6ea64365029aca19724", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "patch": "@@ -1,3 +1,8 @@\n+2007-05-05  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/31251\n+\t* decl.c (match_char_spec): Add check for invalid character lengths.\n+\n 2007-05-04  Brooks Moses  <brooks.moses@codesourcery.com>\n \n \t* intrinsic.texi (CMPLX): Document result kind."}, {"sha": "1dcc53dd067f2b9ccfd6ca4a6b1a4e9a374d7d78", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "patch": "@@ -1626,14 +1626,23 @@ match_char_spec (gfc_typespec *ts)\n syntax:\n   gfc_error (\"Syntax error in CHARACTER declaration at %C\");\n   m = MATCH_ERROR;\n+  gfc_free_expr (len);\n+  return m;\n \n done:\n-  if (m == MATCH_YES && gfc_validate_kind (BT_CHARACTER, kind, true) < 0)\n+  if (gfc_validate_kind (BT_CHARACTER, kind, true) < 0)\n     {\n       gfc_error (\"Kind %d is not a CHARACTER kind at %C\", kind);\n       m = MATCH_ERROR;\n     }\n \n+  if (seen_length == 1 && len != NULL\n+      && len->ts.type != BT_INTEGER && len->ts.type != BT_UNKNOWN)\n+    {\n+      gfc_error (\"Expression at %C must be of INTEGER type\");\n+      m = MATCH_ERROR;\n+    }\n+\n   if (m != MATCH_YES)\n     {\n       gfc_free_expr (len);"}, {"sha": "2c6bc0ab6d1a7100e024d4a9da5f5bfd1cafec0d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "patch": "@@ -1,3 +1,8 @@\n+2007-05-05  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/31251\n+\t* gfortran.dg/char_type_len_2.f90: New test.\n+\n 2007-05-05  Geoffrey Keating  <geoffk@apple.com>\n \n \tPR 31775"}, {"sha": "a5cb835b02806e920055a63c1b4e76ff78145ae0", "filename": "gcc/testsuite/gfortran.dg/char_type_len_2.f90", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_type_len_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_type_len_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fchar_type_len_2.f90?ref=16f8ffc831e99cf28ed7fe2aa9f96ef8dda30678", "patch": "@@ -0,0 +1,8 @@\n+! { dg-do compile }\n+! PR31251 Non-integer character length leads to segfault\n+! Submitted by Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+  character(len=2.3) :: s ! { dg-error \"must be of INTEGER type\" }\n+  character(kind=1,len=4.3) : t ! { dg-error \"must be of INTEGER type\" }\n+  character(len=,,7.2,kind=1) : u ! { dg-error \"Syntax error in CHARACTER declaration\" }\n+  character(len=7,kind=2) : v ! ! { dg-error \"Kind 2 is not a CHARACTER kind\" }\n+  end"}]}