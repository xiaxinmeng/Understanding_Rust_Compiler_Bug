{"sha": "ef7866a3f1395f16872a0d61e111660e302a674d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWY3ODY2YTNmMTM5NWYxNjg3MmEwZDYxZTExMTY2MGUzMDJhNjc0ZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-20T13:56:00Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-20T13:56:00Z"}, "message": "re PR middle-end/82004 (SPEC CPU2017 628.pop2_s miscompare)\n\n\tPR middle-end/82004\n\t* match.pd (pow(C,x) -> exp(log(C)*x)): Delay all folding until\n\tafter vectorization.\n\n\t* gfortran.dg/pr82004.f90: New test.\n\nFrom-SVN: r257846", "tree": {"sha": "ee8267b70b3a0387eab2db77772f229f91c4ee29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee8267b70b3a0387eab2db77772f229f91c4ee29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ef7866a3f1395f16872a0d61e111660e302a674d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef7866a3f1395f16872a0d61e111660e302a674d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef7866a3f1395f16872a0d61e111660e302a674d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef7866a3f1395f16872a0d61e111660e302a674d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "731c3fc22d8edb4e9ee6655543017ce76c05bfcc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/731c3fc22d8edb4e9ee6655543017ce76c05bfcc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/731c3fc22d8edb4e9ee6655543017ce76c05bfcc"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "b485a9252682a4a7395f6b52c7de0fe63051e300", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ef7866a3f1395f16872a0d61e111660e302a674d", "patch": "@@ -1,3 +1,9 @@\n+2018-02-20  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/82004\n+\t* match.pd (pow(C,x) -> exp(log(C)*x)): Delay all folding until\n+\tafter vectorization.\n+\n 2018-02-20  Martin Liska  <mliska@suse.cz>\n \n \tPR driver/83193"}, {"sha": "b77f4ead3a84e22e10add6919e6826fcd9dd679a", "filename": "gcc/match.pd", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=ef7866a3f1395f16872a0d61e111660e302a674d", "patch": "@@ -4006,7 +4006,14 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n   (simplify\n    (pows REAL_CST@0 @1)\n    (if (real_compare (GT_EXPR, TREE_REAL_CST_PTR (@0), &dconst0)\n-\t&& real_isfinite (TREE_REAL_CST_PTR (@0)))\n+\t&& real_isfinite (TREE_REAL_CST_PTR (@0))\n+\t/* As libmvec doesn't have a vectorized exp2, defer optimizing\n+\t   the use_exp2 case until after vectorization.  It seems actually\n+\t   beneficial for all constants to postpone this until later,\n+\t   because exp(log(C)*x), while faster, will have worse precision\n+\t   and if x folds into a constant too, that is unnecessary\n+\t   pessimization.  */\n+\t&& canonicalize_math_after_vectorization_p ())\n     (with {\n        const REAL_VALUE_TYPE *const value = TREE_REAL_CST_PTR (@0);\n        bool use_exp2 = false;\n@@ -4021,10 +4028,7 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n      }\n      (if (!use_exp2)\n       (exps (mult (logs @0) @1))\n-      /* As libmvec doesn't have a vectorized exp2, defer optimizing\n-\t this until after vectorization.  */\n-      (if (canonicalize_math_after_vectorization_p ())\n-\t(exp2s (mult (log2s @0) @1))))))))\n+      (exp2s (mult (log2s @0) @1)))))))\n \n  (for sqrts (SQRT)\n       cbrts (CBRT)"}, {"sha": "95f06bf66d270d46e5699cd42462dc149e3c93a2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ef7866a3f1395f16872a0d61e111660e302a674d", "patch": "@@ -1,3 +1,8 @@\n+2018-02-20  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/82004\n+\t* gfortran.dg/pr82004.f90: New test.\n+\n 2018-02-20  Siddhesh Poyarekar  <siddhesh@sourceware.org>\n \n \t* g++.dg/warn/Wimplicit-fallthrough-3.C: New test case."}, {"sha": "2ddc95f5145332cdba0204193ff0a3c6ed9f322c", "filename": "gcc/testsuite/gfortran.dg/pr82004.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr82004.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ef7866a3f1395f16872a0d61e111660e302a674d/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr82004.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr82004.f90?ref=ef7866a3f1395f16872a0d61e111660e302a674d", "patch": "@@ -0,0 +1,18 @@\n+! PR middle-end/82004\n+! { dg-do run }\n+! { dg-options \"-Ofast\" }\n+\n+  integer, parameter :: r8 = selected_real_kind(13), i4 = kind(1)\n+  integer (i4), parameter :: a = 400, b = 2\n+  real (r8), parameter, dimension(b) :: c = (/ .001_r8, 10.00_r8 /)\n+  real (r8) :: d, e, f, g, h\n+  real (r8), parameter :: j &\n+    = 10**(log10(c(1))-(log10(c(b))-log10(c(1)))/real(a))\n+\n+  d = c(1)\n+  e = c(b)\n+  f = (log10(e)-log10(d))/real(a)\n+  g = log10(d) - f\n+  h = 10**(g)\n+  if (h.ne.j) stop 1\n+end"}]}