{"sha": "61ba73292722363dd1b1317aed03713df7f220be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjFiYTczMjkyNzIyMzYzZGQxYjEzMTdhZWQwMzcxM2RmN2YyMjBiZQ==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.vnet.ibm.com", "date": "2014-04-25T14:28:58Z"}, "committer": {"name": "William Schmidt", "email": "wschmidt@gcc.gnu.org", "date": "2014-04-25T14:28:58Z"}, "message": "re PR tree-optimization/60930 (Wrong folding of - ((unsigned long long) a * (unsigned long long) (unsigned int)-1))\n\n[gcc]\n\n2014-04-25  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR tree-optimization/60930\n\t* gimple-ssa-strength-reduction.c (create_mul_imm_cand):  Reject\n\tcreating a multiply candidate by folding two constant\n\tmultiplicands when the result overflows.\n\n[gcc/testsuite]\n\n2014-04-25  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR tree-optimization/60930\n\t* gcc.dg/torture/pr60930.c:  New test.\n\nFrom-SVN: r209805", "tree": {"sha": "1b203dd28338d28e3b1e6d6254f8c66033429a5e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b203dd28338d28e3b1e6d6254f8c66033429a5e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/61ba73292722363dd1b1317aed03713df7f220be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61ba73292722363dd1b1317aed03713df7f220be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61ba73292722363dd1b1317aed03713df7f220be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61ba73292722363dd1b1317aed03713df7f220be/comments", "author": {"login": "wschmidt-ibm", "id": 5520937, "node_id": "MDQ6VXNlcjU1MjA5Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/5520937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wschmidt-ibm", "html_url": "https://github.com/wschmidt-ibm", "followers_url": "https://api.github.com/users/wschmidt-ibm/followers", "following_url": "https://api.github.com/users/wschmidt-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/wschmidt-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/wschmidt-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wschmidt-ibm/subscriptions", "organizations_url": "https://api.github.com/users/wschmidt-ibm/orgs", "repos_url": "https://api.github.com/users/wschmidt-ibm/repos", "events_url": "https://api.github.com/users/wschmidt-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/wschmidt-ibm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2b33282907e37ff709826b7f60832b036ceb6cbd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b33282907e37ff709826b7f60832b036ceb6cbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b33282907e37ff709826b7f60832b036ceb6cbd"}], "stats": {"total": 51, "additions": 44, "deletions": 7}, "files": [{"sha": "228404c3b662967360a1aecd361d49c3d719ab2f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61ba73292722363dd1b1317aed03713df7f220be/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61ba73292722363dd1b1317aed03713df7f220be/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=61ba73292722363dd1b1317aed03713df7f220be", "patch": "@@ -1,3 +1,10 @@\n+2014-04-25  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR tree-optimization/60930\n+\t* gimple-ssa-strength-reduction.c (create_mul_imm_cand):  Reject\n+\tcreating a multiply candidate by folding two constant\n+\tmultiplicands when the result overflows.\n+\n 2014-04-25  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/60960"}, {"sha": "321cb15eb0ab4ae0577d73bdbad78c55f353c663", "filename": "gcc/gimple-ssa-strength-reduction.c", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61ba73292722363dd1b1317aed03713df7f220be/gcc%2Fgimple-ssa-strength-reduction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61ba73292722363dd1b1317aed03713df7f220be/gcc%2Fgimple-ssa-strength-reduction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-strength-reduction.c?ref=61ba73292722363dd1b1317aed03713df7f220be", "patch": "@@ -1114,15 +1114,18 @@ create_mul_imm_cand (gimple gs, tree base_in, tree stride_in, bool speed)\n \t     X = Y * c\n \t     ============================\n \t     X = (B + i') * (S * c)  */\n-\t  base = base_cand->base_expr;\n-\t  index = base_cand->index;\n \t  temp = tree_to_double_int (base_cand->stride)\n \t\t * tree_to_double_int (stride_in);\n-\t  stride = double_int_to_tree (TREE_TYPE (stride_in), temp);\n-\t  ctype = base_cand->cand_type;\n-\t  if (has_single_use (base_in))\n-\t    savings = (base_cand->dead_savings \n-\t\t       + stmt_cost (base_cand->cand_stmt, speed));\n+\t  if (double_int_fits_to_tree_p (TREE_TYPE (stride_in), temp))\n+\t    {\n+\t      base = base_cand->base_expr;\n+\t      index = base_cand->index;\n+\t      stride = double_int_to_tree (TREE_TYPE (stride_in), temp);\n+\t      ctype = base_cand->cand_type;\n+\t      if (has_single_use (base_in))\n+\t\tsavings = (base_cand->dead_savings \n+\t\t\t   + stmt_cost (base_cand->cand_stmt, speed));\n+\t    }\n \t}\n       else if (base_cand->kind == CAND_ADD && integer_onep (base_cand->stride))\n \t{"}, {"sha": "0d65bef0ad09596f3328cd54d830a30209535aaa", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61ba73292722363dd1b1317aed03713df7f220be/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61ba73292722363dd1b1317aed03713df7f220be/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=61ba73292722363dd1b1317aed03713df7f220be", "patch": "@@ -1,3 +1,8 @@\n+2014-04-25  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR tree-optimization/60930\n+\t* gcc.dg/torture/pr60930.c:  New test.\n+\n 2014-04-25  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/60960"}, {"sha": "5e35f19882dc93ca474103ed1b287ce6867e5c86", "filename": "gcc/testsuite/gcc.dg/torture/pr60930.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61ba73292722363dd1b1317aed03713df7f220be/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr60930.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61ba73292722363dd1b1317aed03713df7f220be/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr60930.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr60930.c?ref=61ba73292722363dd1b1317aed03713df7f220be", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do run } */\n+\n+int x = 1;\n+\n+__attribute__((noinline, noclone)) void\n+foo (unsigned long long t)\n+{\n+  asm volatile (\"\" : : \"r\" (&t));\n+  if (t == 1)\n+    __builtin_abort ();\n+}\n+\n+int\n+main ()\n+{\n+#if __SIZEOF_LONG_LONG__ >= 8\n+  unsigned long long t = 0xffffffffffffffffULL * (0xffffffffUL * x);\n+  if (t != 0xffffffff00000001ULL)\n+    foo (t);;\n+#endif\n+  return 0;\n+}"}]}