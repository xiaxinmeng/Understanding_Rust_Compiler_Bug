{"sha": "39bc0f01ef154a6157026d72de49303f18e02186", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzliYzBmMDFlZjE1NGE2MTU3MDI2ZDcyZGU0OTMwM2YxOGUwMjE4Ng==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2012-06-13T20:41:55Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2012-06-13T20:41:55Z"}, "message": "re PR debug/52983 (internal compiler error: in df_uses_record, at df-scan.c:3243)\n\nPR debug/52983\nPR debug/48866\n* dce.c (word_dce_process_block): Insert debug temps only if the\ninsn is not marked.\n(dce_process_block): Likewise, and if debug.used is not empty,\nand only after iterating over all DEFs that might mark the insn.\n\nFrom-SVN: r188527", "tree": {"sha": "0f55319406217d4091a8647c69087d7dabaa4e73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f55319406217d4091a8647c69087d7dabaa4e73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39bc0f01ef154a6157026d72de49303f18e02186", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39bc0f01ef154a6157026d72de49303f18e02186", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39bc0f01ef154a6157026d72de49303f18e02186", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39bc0f01ef154a6157026d72de49303f18e02186/comments", "author": null, "committer": null, "parents": [{"sha": "21d01365ab8d0e16c681352cc0cc0e7ab726dc03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21d01365ab8d0e16c681352cc0cc0e7ab726dc03", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21d01365ab8d0e16c681352cc0cc0e7ab726dc03"}], "stats": {"total": 39, "additions": 25, "deletions": 14}, "files": [{"sha": "c17e7ad511ee6b7643e7a0e5cfb18cedcf9b3961", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39bc0f01ef154a6157026d72de49303f18e02186/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39bc0f01ef154a6157026d72de49303f18e02186/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=39bc0f01ef154a6157026d72de49303f18e02186", "patch": "@@ -1,3 +1,12 @@\n+2012-06-13  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR debug/52983\n+\tPR debug/48866\n+\t* dce.c (word_dce_process_block): Insert debug temps only if the\n+\tinsn is not marked.\n+\t(dce_process_block): Likewise, and if debug.used is not empty,\n+\tand only after iterating over all DEFs that might mark the insn.\n+\n 2012-06-13  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* common.opt (ftree-coalesce-inlined-vars): New."}, {"sha": "86edea11c55602180116ef4b1846ece2fea7f3a0", "filename": "gcc/dce.c", "status": "modified", "additions": 16, "deletions": 14, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39bc0f01ef154a6157026d72de49303f18e02186/gcc%2Fdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39bc0f01ef154a6157026d72de49303f18e02186/gcc%2Fdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdce.c?ref=39bc0f01ef154a6157026d72de49303f18e02186", "patch": "@@ -857,8 +857,9 @@ word_dce_process_block (basic_block bb, bool redo_out)\n \t   anything in local_live.  */\n \tif (marked_insn_p (insn))\n \t  df_word_lr_simulate_uses (insn, local_live);\n-\n-\tif (debug.used && !bitmap_empty_p (debug.used))\n+\t/* Insert debug temps for dead REGs used in subsequent debug\n+\t   insns.  */\n+\telse if (debug.used && !bitmap_empty_p (debug.used))\n \t  {\n \t    df_ref *def_rec;\n \n@@ -939,18 +940,13 @@ dce_process_block (basic_block bb, bool redo_out, bitmap au)\n \t/* The insn is needed if there is someone who uses the output.  */\n \tif (!needed)\n \t  for (def_rec = DF_INSN_DEFS (insn); *def_rec; def_rec++)\n-\t    {\n-\t      dead_debug_insert_temp (&debug, DF_REF_REGNO (*def_rec), insn,\n-\t\t\t\t      DEBUG_TEMP_BEFORE_WITH_VALUE);\n-\n-\t      if (bitmap_bit_p (local_live, DF_REF_REGNO (*def_rec))\n-\t\t  || bitmap_bit_p (au, DF_REF_REGNO (*def_rec)))\n-\t\t{\n-\t\t  needed = true;\n-\t\t  mark_insn (insn, true);\n-\t\t  break;\n-\t\t}\n-\t    }\n+\t    if (bitmap_bit_p (local_live, DF_REF_REGNO (*def_rec))\n+\t\t|| bitmap_bit_p (au, DF_REF_REGNO (*def_rec)))\n+\t      {\n+\t\tneeded = true;\n+\t\tmark_insn (insn, true);\n+\t\tbreak;\n+\t      }\n \n \t/* No matter if the instruction is needed or not, we remove\n \t   any regno in the defs from the live set.  */\n@@ -960,6 +956,12 @@ dce_process_block (basic_block bb, bool redo_out, bitmap au)\n \t   anything in local_live.  */\n \tif (needed)\n \t  df_simulate_uses (insn, local_live);\n+\t/* Insert debug temps for dead REGs used in subsequent debug\n+\t   insns.  */\n+\telse if (debug.used && !bitmap_empty_p (debug.used))\n+\t  for (def_rec = DF_INSN_DEFS (insn); *def_rec; def_rec++)\n+\t    dead_debug_insert_temp (&debug, DF_REF_REGNO (*def_rec), insn,\n+\t\t\t\t    DEBUG_TEMP_BEFORE_WITH_VALUE);\n       }\n \n   dead_debug_finish (&debug, NULL);"}]}