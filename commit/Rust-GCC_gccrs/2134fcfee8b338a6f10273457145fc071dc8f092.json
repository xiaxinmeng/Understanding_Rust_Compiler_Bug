{"sha": "2134fcfee8b338a6f10273457145fc071dc8f092", "node_id": "C_kwDOANBUbNoAKDIxMzRmY2ZlZThiMzM4YTZmMTAyNzM0NTcxNDVmYzA3MWRjOGYwOTI", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-04-14T07:19:25Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2023-04-14T07:19:25Z"}, "message": "loop-iv: Fix up bounds computation\n\nOn Thu, Apr 13, 2023 at 06:35:07AM -0600, Jeff Law wrote:\n> Bootstrap was successful with v3, but there's hundreds of testsuite failures\n> due to the simplify-rtx hunk.  compile/20070520-1.c for example when\n> compiled with:  -O3 -funroll-loops -march=rv64gc -mabi=lp64d\n>\n> Thursdays are my hell day.  It's unlikely I'd be able to look at this at all\n> today.\n\nSo, seems to me this is because loop-iv.cc asks for invalid RTL to be\nsimplified, it calls simplify_gen_binary (AND, SImode,\n(subreg:SI (plus:DI (reg:DI 289 [ ivtmp_312 ])\n        (const_int 4294967295 [0xffffffff])) 0),\n(const_int 4294967295 [0xffffffff]))\nbut 0xffffffff is not valid SImode CONST_INT, and unlike previously\nwe no longer on WORD_REGISTER_OPERATIONS targets which have DImode\nword_mode optimize that into the op0, so the invalid constant is emitted\ninto the IL and checking fails.\n\nThe following patch fixes that (and we optimize that & -1 away even earlier\nwith that).\n\n2023-04-14  Jakub Jelinek  <jakub@redhat.com>\n\n\t* loop-iv.cc (iv_number_of_iterations): Use gen_int_mode instead\n\tof GEN_INT.", "tree": {"sha": "96704d59069083dbc3c203ecf2ab2e988e5af0ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96704d59069083dbc3c203ecf2ab2e988e5af0ce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2134fcfee8b338a6f10273457145fc071dc8f092", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2134fcfee8b338a6f10273457145fc071dc8f092", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2134fcfee8b338a6f10273457145fc071dc8f092", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2134fcfee8b338a6f10273457145fc071dc8f092/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "edc6659c97c4a747123b1150b372dc8e7a83a824", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/edc6659c97c4a747123b1150b372dc8e7a83a824", "html_url": "https://github.com/Rust-GCC/gccrs/commit/edc6659c97c4a747123b1150b372dc8e7a83a824"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "6c40db947f7f549303f8bb4d4f38aa98b6561bcc", "filename": "gcc/loop-iv.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2134fcfee8b338a6f10273457145fc071dc8f092/gcc%2Floop-iv.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2134fcfee8b338a6f10273457145fc071dc8f092/gcc%2Floop-iv.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-iv.cc?ref=2134fcfee8b338a6f10273457145fc071dc8f092", "patch": "@@ -2617,7 +2617,7 @@ iv_number_of_iterations (class loop *loop, rtx_insn *insn, rtx condition,\n \t  d *= 2;\n \t  size--;\n \t}\n-      bound = GEN_INT (((uint64_t) 1 << (size - 1 ) << 1) - 1);\n+      bound = gen_int_mode (((uint64_t) 1 << (size - 1) << 1) - 1, mode);\n \n       tmp1 = lowpart_subreg (mode, iv1.base, comp_mode);\n       tmp = simplify_gen_binary (UMOD, mode, tmp1, gen_int_mode (d, mode));"}]}