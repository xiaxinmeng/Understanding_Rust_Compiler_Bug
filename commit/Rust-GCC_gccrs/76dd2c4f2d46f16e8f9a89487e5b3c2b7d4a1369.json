{"sha": "76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "node_id": "C_kwDOANBUbNoAKDc2ZGQyYzRmMmQ0NmYxNmU4ZjlhODk0ODdlNWIzYzJiN2Q0YTEzNjk", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-11-03T17:47:02Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-11-03T17:47:02Z"}, "message": "analyzer: use std::unique_ptr for known functions\n\ngcc/analyzer/ChangeLog:\n\t* analyzer.h: Use std::unique_ptr for known functions.\n\t* engine.cc: Likewise.\n\t* known-function-manager.cc: Likewise.\n\t* known-function-manager.h: Likewise.\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/plugin/analyzer_kernel_plugin.c: Use std::unique_ptr for\n\tknown functions.\n\t* gcc.dg/plugin/analyzer_known_fns_plugin.c: Likewise.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "6d581c48f99c8f8b4524687a4dca356d0ff9f3ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d581c48f99c8f8b4524687a4dca356d0ff9f3ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "accece8c9543e4f3f7bbf24989755dd0453658b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/accece8c9543e4f3f7bbf24989755dd0453658b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/accece8c9543e4f3f7bbf24989755dd0453658b7"}], "stats": {"total": 27, "additions": 15, "deletions": 12}, "files": [{"sha": "88fdc1d04f0162d1650770e815975fa5d6f6370f", "filename": "gcc/analyzer/analyzer.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fanalyzer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fanalyzer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fanalyzer.h?ref=76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "patch": "@@ -244,7 +244,7 @@ class plugin_analyzer_init_iface\n public:\n   virtual void register_state_machine (state_machine *) = 0;\n   virtual void register_known_function (const char *name,\n-\t\t\t\t\tknown_function *) = 0;\n+\t\t\t\t\tstd::unique_ptr<known_function>) = 0;\n   virtual logger *get_logger () const = 0;\n };\n "}, {"sha": "fe17f8f76ce2d4fef8d7e52387d7046bdf6544d2", "filename": "gcc/analyzer/engine.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fengine.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fengine.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fengine.cc?ref=76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "patch": "@@ -5960,10 +5960,10 @@ class plugin_analyzer_init_impl : public plugin_analyzer_init_iface\n   }\n \n   void register_known_function (const char *name,\n-\t\t\t\tknown_function *kf) final override\n+\t\t\t\tstd::unique_ptr<known_function> kf) final override\n   {\n     LOG_SCOPE (m_logger);\n-    m_known_fn_mgr->add (name, kf);\n+    m_known_fn_mgr->add (name, std::move (kf));\n   }\n \n   logger *get_logger () const final override"}, {"sha": "7341b06848083fa7d56b1a088e39db0f921b68f2", "filename": "gcc/analyzer/known-function-manager.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fknown-function-manager.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fknown-function-manager.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fknown-function-manager.cc?ref=76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "patch": "@@ -48,11 +48,12 @@ known_function_manager::~known_function_manager ()\n }\n \n void\n-known_function_manager::add (const char *name, known_function *kf)\n+known_function_manager::add (const char *name,\n+\t\t\t     std::unique_ptr<known_function> kf)\n {\n   LOG_FUNC_1 (get_logger (), \"registering %s\", name);\n   tree id = get_identifier (name);\n-  m_map_id_to_kf.put (id, kf);\n+  m_map_id_to_kf.put (id, kf.release ());\n }\n \n const known_function *"}, {"sha": "daf1bc57855d7e6911aa62c082c22129f4a2e4d0", "filename": "gcc/analyzer/known-function-manager.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fknown-function-manager.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Fanalyzer%2Fknown-function-manager.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fknown-function-manager.h?ref=76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "patch": "@@ -30,7 +30,7 @@ class known_function_manager : public log_user\n public:\n   known_function_manager (logger *logger);\n   ~known_function_manager ();\n-  void add (const char *name, known_function *kf);\n+  void add (const char *name, std::unique_ptr<known_function> kf);\n   const known_function *get_by_identifier (tree identifier);\n   const known_function *get_by_fndecl (tree fndecl);\n "}, {"sha": "92b4dfbd4d0237d6b764ee4b447495d5235145ce", "filename": "gcc/testsuite/gcc.dg/plugin/analyzer_kernel_plugin.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fanalyzer_kernel_plugin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fanalyzer_kernel_plugin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fanalyzer_kernel_plugin.c?ref=76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "patch": "@@ -210,10 +210,11 @@ kernel_analyzer_init_cb (void *gcc_data, void */*user_data*/)\n   LOG_SCOPE (iface->get_logger ());\n   if (0)\n     inform (input_location, \"got here: kernel_analyzer_init_cb\");\n-  iface->register_known_function (\"copy_from_user\",\n-\t\t\t\t  new known_function_copy_from_user ());\n+  iface->register_known_function\n+    (\"copy_from_user\",\n+     make_unique<known_function_copy_from_user> ());\n   iface->register_known_function (\"copy_to_user\",\n-\t\t\t\t  new known_function_copy_to_user ());\n+\t\t\t\t  make_unique<known_function_copy_to_user> ());\n }\n \n } // namespace ana"}, {"sha": "e9f607f58fe5f31bfe447c375c959765576d0015", "filename": "gcc/testsuite/gcc.dg/plugin/analyzer_known_fns_plugin.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fanalyzer_known_fns_plugin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fanalyzer_known_fns_plugin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fanalyzer_known_fns_plugin.c?ref=76dd2c4f2d46f16e8f9a89487e5b3c2b7d4a1369", "patch": "@@ -175,9 +175,10 @@ known_fn_analyzer_init_cb (void *gcc_data, void */*user_data*/)\n   if (0)\n     inform (input_location, \"got here: known_fn_analyzer_init_cb\");\n   iface->register_known_function (\"returns_42\",\n-\t\t\t\t  new known_function_returns_42 ());\n-  iface->register_known_function (\"attempt_to_copy\",\n-\t\t\t\t  new known_function_attempt_to_copy ());\n+\t\t\t\t  make_unique<known_function_returns_42> ());\n+  iface->register_known_function\n+    (\"attempt_to_copy\",\n+     make_unique<known_function_attempt_to_copy> ());\n }\n \n } // namespace ana"}]}