{"sha": "07f1cf564b3b64096998da79ea1963e100688a0e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDdmMWNmNTY0YjNiNjQwOTY5OThkYTc5ZWExOTYzZTEwMDY4OGEwZQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2014-08-27T08:01:25Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2014-08-27T08:01:25Z"}, "message": "re PR lto/62239 (ICE: in execute_todo, at passes.c:1795 with LTO)\n\n2014-08-27  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/62239\n\t* builtins.c (fold_builtin_strcat_chk): Move to gimple-fold.c.\n\t(fold_builtin_3): Do not fold strcat_chk here.\n\t* gimple-fold.c (gimple_fold_builtin_strcat_chk): Move here\n\tfrom builtins.c.\n\t(gimple_fold_builtin): Fold strcat_chk here.\n\nFrom-SVN: r214564", "tree": {"sha": "60748f8fb1fb8fb65da82dd94574e47a560dbb66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60748f8fb1fb8fb65da82dd94574e47a560dbb66"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/07f1cf564b3b64096998da79ea1963e100688a0e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07f1cf564b3b64096998da79ea1963e100688a0e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07f1cf564b3b64096998da79ea1963e100688a0e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07f1cf564b3b64096998da79ea1963e100688a0e/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "53fa2d27a0275e03696351dc2a178ed12fb9b6ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53fa2d27a0275e03696351dc2a178ed12fb9b6ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53fa2d27a0275e03696351dc2a178ed12fb9b6ed"}], "stats": {"total": 81, "additions": 46, "deletions": 35}, "files": [{"sha": "3156965eb08058b90059d7c35c3411f94b1d83f1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07f1cf564b3b64096998da79ea1963e100688a0e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07f1cf564b3b64096998da79ea1963e100688a0e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=07f1cf564b3b64096998da79ea1963e100688a0e", "patch": "@@ -1,3 +1,12 @@\n+2014-08-27  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/62239\n+\t* builtins.c (fold_builtin_strcat_chk): Move to gimple-fold.c.\n+\t(fold_builtin_3): Do not fold strcat_chk here.\n+\t* gimple-fold.c (gimple_fold_builtin_strcat_chk): Move here\n+\tfrom builtins.c.\n+\t(gimple_fold_builtin): Fold strcat_chk here.\n+\n 2014-08-26  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* dwarf2out.h (dwarf2out_decl): Remove prototype."}, {"sha": "20add5ffbece7739163749abd8459c49c56a0b33", "filename": "gcc/builtins.c", "status": "modified", "additions": 0, "deletions": 35, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07f1cf564b3b64096998da79ea1963e100688a0e/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07f1cf564b3b64096998da79ea1963e100688a0e/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=07f1cf564b3b64096998da79ea1963e100688a0e", "patch": "@@ -198,7 +198,6 @@ static void maybe_emit_chk_warning (tree, enum built_in_function);\n static void maybe_emit_sprintf_chk_warning (tree, enum built_in_function);\n static void maybe_emit_free_warning (tree);\n static tree fold_builtin_object_size (tree, tree);\n-static tree fold_builtin_strcat_chk (location_t, tree, tree, tree, tree);\n static tree fold_builtin_strncat_chk (location_t, tree, tree, tree, tree, tree);\n static tree fold_builtin_printf (location_t, tree, tree, tree, bool, enum built_in_function);\n static tree fold_builtin_fprintf (location_t, tree, tree, tree, tree, bool,\n@@ -10321,9 +10320,6 @@ fold_builtin_3 (location_t loc, tree fndecl,\n     case BUILT_IN_MEMCMP:\n       return fold_builtin_memcmp (loc, arg0, arg1, arg2);;\n \n-    case BUILT_IN_STRCAT_CHK:\n-      return fold_builtin_strcat_chk (loc, fndecl, arg0, arg1, arg2);\n-\n     case BUILT_IN_PRINTF_CHK:\n     case BUILT_IN_VPRINTF_CHK:\n       if (!validate_arg (arg0, INTEGER_TYPE)\n@@ -11588,37 +11584,6 @@ fold_builtin_object_size (tree ptr, tree ost)\n   return NULL_TREE;\n }\n \n-/* Fold a call to the __strcat_chk builtin FNDECL.  DEST, SRC, and SIZE\n-   are the arguments to the call.  */\n-\n-static tree\n-fold_builtin_strcat_chk (location_t loc, tree fndecl, tree dest,\n-\t\t\t tree src, tree size)\n-{\n-  tree fn;\n-  const char *p;\n-\n-  if (!validate_arg (dest, POINTER_TYPE)\n-      || !validate_arg (src, POINTER_TYPE)\n-      || !validate_arg (size, INTEGER_TYPE))\n-    return NULL_TREE;\n-\n-  p = c_getstr (src);\n-  /* If the SRC parameter is \"\", return DEST.  */\n-  if (p && *p == '\\0')\n-    return omit_one_operand_loc (loc, TREE_TYPE (TREE_TYPE (fndecl)), dest, src);\n-\n-  if (! tree_fits_uhwi_p (size) || ! integer_all_onesp (size))\n-    return NULL_TREE;\n-\n-  /* If __builtin_strcat_chk is used, assume strcat is available.  */\n-  fn = builtin_decl_explicit (BUILT_IN_STRCAT);\n-  if (!fn)\n-    return NULL_TREE;\n-\n-  return build_call_expr_loc (loc, fn, 2, dest, src);\n-}\n-\n /* Fold a call to the __strncat_chk builtin with arguments DEST, SRC,\n    LEN, and SIZE.  */\n "}, {"sha": "7538ec0cad579a67d24633d0fa3ddfffbeca5a25", "filename": "gcc/gimple-fold.c", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07f1cf564b3b64096998da79ea1963e100688a0e/gcc%2Fgimple-fold.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07f1cf564b3b64096998da79ea1963e100688a0e/gcc%2Fgimple-fold.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-fold.c?ref=07f1cf564b3b64096998da79ea1963e100688a0e", "patch": "@@ -1587,6 +1587,41 @@ gimple_fold_builtin_strcat (gimple_stmt_iterator *gsi,\n   return true;\n }\n \n+/* Fold a call to the __strcat_chk builtin FNDECL.  DEST, SRC, and SIZE\n+   are the arguments to the call.  */\n+\n+static bool\n+gimple_fold_builtin_strcat_chk (gimple_stmt_iterator *gsi)\n+{\n+  gimple stmt = gsi_stmt (*gsi);\n+  tree dest = gimple_call_arg (stmt, 0);\n+  tree src = gimple_call_arg (stmt, 1);\n+  tree size = gimple_call_arg (stmt, 2);\n+  tree fn;\n+  const char *p;\n+\n+\n+  p = c_getstr (src);\n+  /* If the SRC parameter is \"\", return DEST.  */\n+  if (p && *p == '\\0')\n+    {\n+      replace_call_with_value (gsi, dest);\n+      return true;\n+    }\n+\n+  if (! tree_fits_uhwi_p (size) || ! integer_all_onesp (size))\n+    return false;\n+\n+  /* If __builtin_strcat_chk is used, assume strcat is available.  */\n+  fn = builtin_decl_explicit (BUILT_IN_STRCAT);\n+  if (!fn)\n+    return false;\n+\n+  gimple repl = gimple_build_call (fn, 2, dest, src);\n+  replace_call_with_call_and_fold (gsi, repl);\n+  return true;\n+}\n+\n /* Fold a call to the fputs builtin.  ARG0 and ARG1 are the arguments\n    to the call.  IGNORE is true if the value returned\n    by the builtin will be ignored.  UNLOCKED is true is true if this\n@@ -2569,6 +2604,8 @@ gimple_fold_builtin (gimple_stmt_iterator *gsi)\n     case BUILT_IN_SPRINTF_CHK:\n     case BUILT_IN_VSPRINTF_CHK:\n       return gimple_fold_builtin_sprintf_chk (gsi, DECL_FUNCTION_CODE (callee));\n+    case BUILT_IN_STRCAT_CHK:\n+      return gimple_fold_builtin_strcat_chk (gsi);\n     default:;\n     }\n "}]}