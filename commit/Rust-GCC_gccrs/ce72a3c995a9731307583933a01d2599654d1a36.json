{"sha": "ce72a3c995a9731307583933a01d2599654d1a36", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2U3MmEzYzk5NWE5NzMxMzA3NTgzOTMzYTAxZDI1OTk2NTRkMWEzNg==", "commit": {"author": {"name": "Ramana Radhakrishnan", "email": "ramana.radhakrishnan@arm.com", "date": "2015-06-24T08:28:08Z"}, "committer": {"name": "Ramana Radhakrishnan", "email": "ramana@gcc.gnu.org", "date": "2015-06-24T08:28:08Z"}, "message": "re PR target/63408 (GCC emits incorrect fixed->fp conversion instruction on Cortex-M4 target)\n\nFix PR target/63408\n\nThe attached patch fixes PR target/63408 and adds a regression test\nfor the same. The problem is essentially that\nvfp3_const_double_for_fract_bits() needs to be aware that negative\nvalues cannot be used in this context.\n\nTested with a bootstrap and regression test run on armhf. Applied.\n\n\n\n\n2015-06-24  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n\n\tPR target/63408\n\t* config/arm/arm.c (vfp3_const_double_for_fract_bits): Disable\n\tfor negative numbers.\n\n2015-06-24  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n\n\tPR target/63408\n\t* gcc.target/arm/pr63408.c: New test.\n\nFrom-SVN: r224879", "tree": {"sha": "a9d4ab4f22bdb53d8684a942ea13d10fd39d15de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9d4ab4f22bdb53d8684a942ea13d10fd39d15de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce72a3c995a9731307583933a01d2599654d1a36", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce72a3c995a9731307583933a01d2599654d1a36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce72a3c995a9731307583933a01d2599654d1a36", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce72a3c995a9731307583933a01d2599654d1a36/comments", "author": null, "committer": null, "parents": [{"sha": "0bc64a6ca5b518419c91637f88635c95e3c3acb9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bc64a6ca5b518419c91637f88635c95e3c3acb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bc64a6ca5b518419c91637f88635c95e3c3acb9"}], "stats": {"total": 37, "additions": 36, "deletions": 1}, "files": [{"sha": "8a95bc27bb72fe417490417dd0861724413e5110", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ce72a3c995a9731307583933a01d2599654d1a36", "patch": "@@ -1,3 +1,9 @@\n+2015-06-24  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n+\n+\tPR target/63408\n+\t* config/arm/arm.c (vfp3_const_double_for_fract_bits): Disable\n+\tfor negative numbers.\n+\n 2015-06-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \tPR rtl-optimization/66306"}, {"sha": "09191e5d2c2e403808eefc6c91bc931b571585a8", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=ce72a3c995a9731307583933a01d2599654d1a36", "patch": "@@ -27382,7 +27382,8 @@ vfp3_const_double_for_fract_bits (rtx operand)\n     return 0;\n   \n   REAL_VALUE_FROM_CONST_DOUBLE (r0, operand);\n-  if (exact_real_inverse (DFmode, &r0))\n+  if (exact_real_inverse (DFmode, &r0)\n+      && !REAL_VALUE_NEGATIVE (r0))\n     {\n       if (exact_real_truncate (DFmode, &r0))\n \t{"}, {"sha": "daadf4c4229d592bef7145220575f6d6eeb91bd2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ce72a3c995a9731307583933a01d2599654d1a36", "patch": "@@ -1,3 +1,8 @@\n+2015-06-24  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n+\n+\tPR target/63408\n+\t* gcc.target/arm/pr63408.c: New test.\n+\n 2015-06-24  James Greenhalgh  <james.greenhalgh@arm.com>\n \n         * lib/c-torture.exp: Don't call check_effective_target_lto"}, {"sha": "850596bd1803a83fb663d08d7ce7a48c1f17bae0", "filename": "gcc/testsuite/gcc.target/arm/pr63408.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr63408.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce72a3c995a9731307583933a01d2599654d1a36/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr63408.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr63408.c?ref=ce72a3c995a9731307583933a01d2599654d1a36", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do run }  */\n+/* { dg-options \"-O2\" } */\n+void abort (void) __attribute__ ((noreturn));\n+float __attribute__((noinline))\n+f(float a, int b)\n+{\n+  return a - (((float)b / 0x7fffffff) * 100);\n+}\n+\n+int\n+main (void)\n+{\n+  float a[] = { 100.0, 0.0, 0.0};\n+  int b[] = { 0x7fffffff, 0x7fffffff/100.0f, -0x7fffffff / 100.0f};\n+  float c[] = { 0.0, -1.0, 1.0 };\n+  int i;\n+\n+  for (i = 0; i < (sizeof(a) / sizeof (float)); i++)\n+    if (f (a[i], b[i]) != c[i])\n+\tabort ();\n+\n+  return 0;\n+}"}]}