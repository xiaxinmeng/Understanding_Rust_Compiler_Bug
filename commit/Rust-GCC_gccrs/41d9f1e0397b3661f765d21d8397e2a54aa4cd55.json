{"sha": "41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDFkOWYxZTAzOTdiMzY2MWY3NjVkMjFkODM5N2UyYTU0YWE0Y2Q1NQ==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2015-09-25T14:24:11Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2015-09-25T14:24:11Z"}, "message": "PR pretty-print/67567 do not pass NULL as a string\n\nFortran passes NULL where a non-null string is expected by the pretty-printer,\nwhich causes a sanitizer warning. This could have been found earlier by using\ngcc_checking_assert. Even if the assertion is false, the result is just an\nincomplete diagnostic, thus it seems more user-friendly to assert only when\nchecking. I do not have any idea how to properly fix the Fortran bug, thus this\npatch simply works-around it.\n\ngcc/fortran/ChangeLog:\n\n2015-09-25  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR pretty-print/67567\n\t* resolve.c (resolve_fl_procedure): Work-around when iface->module\n\t== NULL.\n\ngcc/ChangeLog:\n\n2015-09-25  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR pretty-print/67567\n\t* pretty-print.c (pp_string): Add gcc_checking_assert.\n\t* pretty-print.h (output_buffer_append_r): Likewise.\n\nFrom-SVN: r228131", "tree": {"sha": "21100e9b2f3e1a93346e76fdaba64fa8547b8ad1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21100e9b2f3e1a93346e76fdaba64fa8547b8ad1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/comments", "author": null, "committer": null, "parents": [{"sha": "f700c7caef3feffdadcac957ac92f8c5d8470270", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f700c7caef3feffdadcac957ac92f8c5d8470270", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f700c7caef3feffdadcac957ac92f8c5d8470270"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "7c39c519ec25c7e15d6da93c1484adbad12af012", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "patch": "@@ -1,3 +1,9 @@\n+2015-09-25  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR pretty-print/67567\n+\t* pretty-print.c (pp_string): Add gcc_checking_assert.\n+\t* pretty-print.h (output_buffer_append_r): Likewise.\n+\n 2015-09-25  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/67675"}, {"sha": "8e33a1d231c5fb1ab1828c37e52cdba7bac595eb", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "patch": "@@ -1,3 +1,9 @@\n+2015-09-25  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR pretty-print/67567\n+\t* resolve.c (resolve_fl_procedure): Work-around when iface->module\n+\t== NULL.\n+\n 2015-09-21  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \t* resolve.c (nonscalar_typebound_assign): Fix typos in comment."}, {"sha": "59cf03402fe26fc4a6400fa8fc4fd6df52fdcf21", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "patch": "@@ -11743,7 +11743,10 @@ resolve_fl_procedure (gfc_symbol *sym, int mp_flag)\n \t{\n \t  gfc_error (\"Mismatch in PURE attribute between MODULE \"\n \t\t     \"PROCEDURE at %L and its interface in %s\",\n-\t\t     &sym->declared_at, iface->module);\n+\t\t     &sym->declared_at, \n+\t\t     /* FIXME: PR fortran/67567: iface->module should\n+\t\t\tnot be NULL !  */\n+\t\t     iface->module ? iface->module : \"\");\n \t  return false;\n \t}\n \n@@ -11759,7 +11762,10 @@ resolve_fl_procedure (gfc_symbol *sym, int mp_flag)\n \t{\n \t  gfc_error (\"Mismatch in RECURSIVE attribute between MODULE \"\n \t\t     \"PROCEDURE at %L and its interface in %s\",\n-\t\t     &sym->declared_at, iface->module);\n+\t\t     &sym->declared_at, \n+\t\t     /* FIXME: PR fortran/67567: iface->module should\n+\t\t\tnot be NULL !  */\n+\t\t     iface->module ? iface->module : \"\");\n \t  return false;\n \t}\n \n@@ -11768,7 +11774,10 @@ resolve_fl_procedure (gfc_symbol *sym, int mp_flag)\n \t{\n \t  gfc_error (\"%s between the MODULE PROCEDURE declaration \"\n \t\t     \"in module %s and the declaration at %L in \"\n-\t\t     \"SUBMODULE %s\", errmsg, iface->module,\n+\t\t     \"SUBMODULE %s\", errmsg, \n+\t\t     /* FIXME: PR fortran/67567: iface->module should\n+\t\t\tnot be NULL !  */\n+\t\t     iface->module ? iface->module : \"\",\n \t\t     &sym->declared_at, sym->ns->proc_name->name);\n \t  return false;\n \t}"}, {"sha": "5889015d40004164cd6eb29c288989e321bdb959", "filename": "gcc/pretty-print.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Fpretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Fpretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpretty-print.c?ref=41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "patch": "@@ -905,7 +905,8 @@ pp_character (pretty_printer *pp, int c)\n void\n pp_string (pretty_printer *pp, const char *str)\n {\n-  pp_maybe_wrap_text (pp, str, str + (str ? strlen (str) : 0));\n+  gcc_checking_assert (str);\n+  pp_maybe_wrap_text (pp, str, str + strlen (str));\n }\n \n /* Maybe print out a whitespace if needed.  */"}, {"sha": "2654b0fcbecbbd6ea63c91fdef2c1ba9151cf67e", "filename": "gcc/pretty-print.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Fpretty-print.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/41d9f1e0397b3661f765d21d8397e2a54aa4cd55/gcc%2Fpretty-print.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpretty-print.h?ref=41d9f1e0397b3661f765d21d8397e2a54aa4cd55", "patch": "@@ -139,6 +139,7 @@ output_buffer_formatted_text (output_buffer *buff)\n static inline void\n output_buffer_append_r (output_buffer *buff, const char *start, int length)\n {\n+  gcc_checking_assert (start);\n   obstack_grow (buff->obstack, start, length);\n   buff->line_length += length;\n }"}]}