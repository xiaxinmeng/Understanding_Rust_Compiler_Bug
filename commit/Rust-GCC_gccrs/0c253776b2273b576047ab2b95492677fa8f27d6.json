{"sha": "0c253776b2273b576047ab2b95492677fa8f27d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGMyNTM3NzZiMjI3M2I1NzYwNDdhYjJiOTU0OTI2NzdmYThmMjdkNg==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-07-28T12:37:19Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-07-28T12:37:19Z"}, "message": "(divhi3, modhi3, divmodhi4): Rewrite.\n\nFrom-SVN: r10175", "tree": {"sha": "c03e5bfce7cf2c1e1059480d303f58e7d7fbb3e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c03e5bfce7cf2c1e1059480d303f58e7d7fbb3e9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0c253776b2273b576047ab2b95492677fa8f27d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c253776b2273b576047ab2b95492677fa8f27d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c253776b2273b576047ab2b95492677fa8f27d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c253776b2273b576047ab2b95492677fa8f27d6/comments", "author": null, "committer": null, "parents": [{"sha": "47d1946b298281c1f653d23adf0f16b9526f08d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d1946b298281c1f653d23adf0f16b9526f08d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d1946b298281c1f653d23adf0f16b9526f08d4"}], "stats": {"total": 296, "additions": 44, "deletions": 252}, "files": [{"sha": "a179b369492d15ed767b1f05a7868816b28fe6fc", "filename": "gcc/config/pdp11/pdp11.md", "status": "modified", "additions": 44, "deletions": 252, "changes": 296, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c253776b2273b576047ab2b95492677fa8f27d6/gcc%2Fconfig%2Fpdp11%2Fpdp11.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c253776b2273b576047ab2b95492677fa8f27d6/gcc%2Fconfig%2Fpdp11%2Fpdp11.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpdp11%2Fpdp11.md?ref=0c253776b2273b576047ab2b95492677fa8f27d6", "patch": "@@ -1699,9 +1699,6 @@\n ;  [(set_attr \"length\" \"1,2\")])\n \n ;;- divide\n-;; how can I use the remainder ? - \n-;; modsidi and move upper register to lower ????\n-\n (define_insn \"divdf3\"\n   [(set (match_operand:DF 0 \"register_operand\" \"=a,a,a\")\n \t(div:DF (match_operand:DF 1 \"register_operand\" \"0,0,0\")\n@@ -1710,269 +1707,64 @@\n   \"divd %2, %0\"\n   [(set_attr \"length\" \"1,2,5\")])\n \n-(define_insn \"\"\n-  [(set (match_operand:HI 0 \"general_operand\" \"=r,r\")\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0,0\")\n-\t  (sign_extend:SI (match_operand:HI 2 \"general_operand\" \"rR,Q\")))))]\n-  \"TARGET_45\"\n-  \"div %2,%0\"\n-  [(set_attr \"length\" \"1,2\")])\n-\n-;; - problem matching the (sign_extend:SI (const_int ...))\n-; used without -O \n-(define_insn \"\"\n-  [(set (match_operand:HI 0 \"general_operand\" \"=r\")\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0\")\n-\t  (sign_extend:SI (match_operand 2 \"immediate_operand\" \"n\")))))]\n-  \"TARGET_45\"\n-  \"div %2,%0\"\n-  [(set_attr \"length\" \"2\")])\n-\n-; used with -O\n-(define_insn \"\"\n-  [(set (match_operand:HI 0 \"general_operand\" \"=r\")\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0\")\n-\t  (match_operand:SI 2 \"immediate_operand\" \"i\"))))]\n-  \"TARGET_45\"\n-  \"div %2,%0\"\n-  [(set_attr \"length\" \"2\")])\n-\n+\t \n (define_expand \"divhi3\"\n-  [(set (match_dup 3)\n-\t(sign_extend:SI (match_operand:HI 1 \"general_operand\" \"g\")))\n-   (set (match_operand:HI 0 \"general_operand\" \"g\")\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_dup 3)\n-\t  (sign_extend:SI (match_operand:HI 2 \"general_operand\" \"g\")))))]\n+  [(set (subreg:HI (match_dup 1) 0)\n+\t(div:HI (match_operand:SI 1 \"general_operand\" \"0\")\n+\t\t(match_operand:HI 2 \"general_operand\" \"g\")))\n+   (set (match_operand:HI 0 \"general_operand\" \"=r\")\n+        (subreg:HI (match_dup 1) 0))]\n   \"TARGET_45\"\n-  \"operands[3] = gen_reg_rtx (SImode);\")\n-\n-(define_expand \"udivqi\"\n-  [(set (subreg:HI (match_dup 3) 1)\n-\t(zero_extend:HI (match_operand:QI 1 \"general_operand\" \"g\")))\n-   (set (subreg:HI (match_dup 3) 0)\n-\t(const_int 0))\n-   (set (match_dup 4)\n-\t(sign_extend:HI (match_operand:QI 2 \"general_operand\" \"g\")))\n-   (set (match_dup 5)\n-\t(and:HI (match_dup 4)\n-\t\t(const_int 255)))\n-   (set (match_dup 6)\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_dup 3)\n-\t  (sign_extend:SI (match_dup 5)))))\n-   (set (match_operand:QI 0 \"general_operand\" \"g\")\n-\t(truncate:QI (match_dup 6)))]\n-  \"TARGET_45\"\n-  \"\n-{\n-  operands[3] = gen_reg_rtx (SImode);\n-  operands[4] = gen_reg_rtx (HImode);\n-  operands[5] = gen_reg_rtx (HImode);\n-  operands[6] = gen_reg_rtx (HImode);\n-}\")\n-   \n-;; we must restrict it to divide by 15-bit constant...\n-(define_expand \"udivhi3\"\n-  [(set (subreg:HI (match_dup 3) 1)\n-\t(match_operand:HI 1 \"general_operand\" \"g\"))\n-   (set (subreg:HI (match_dup 3) 0)\n-\t(const_int 0))\n-   (set (match_operand:HI 0 \"general_operand\" \"g\")\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_dup 3)\n-\t  (sign_extend:SI (match_operand:HI 2 \"immediate15_operand\" \"n\")))))]\n-  \"TARGET_45\"\n-  \"\n-{\n-  operands[3] = gen_reg_rtx (SImode);\n-  \n-  if (GET_CODE (operands[2]) != CONST_INT\n-      || ((INTVAL (operands[2]) & 0x8000) != 0x0000))\n-    FAIL;\n-}\")\n-\n-(define_insn \"\"\n-  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r,r\") 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0,0\")\n-\t  (sign_extend:SI (match_operand:HI 2 \"nonimmediate_operand\" \"rR,Q\")))))]\n-  \"TARGET_45\"\n-  \"div %2,%0\"\n-  [(set_attr \"length\" \"1,2\")])\n+  \"\")\n \n-;; (sign_extend:SI (const_int ))\n-; w/o -O\n (define_insn \"\"\n-  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0\")\n-\t  (sign_extend:SI (match_operand 2 \"immediate_operand\" \"i\")))))]\n-  \"TARGET_45\"\n-  \"div %2,%0\"\n-  [(set_attr \"length\" \"2\")])\n-; w/ -O\n-(define_insn \"\"\n-  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0\")\n-\t  (match_operand:SI 2 \"immediate_operand\" \"i\"))))]\n+  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 0)\n+\t(div:HI (match_operand:SI 1 \"general_operand\" \"0\")\n+\t\t(match_operand:HI 2 \"general_operand\" \"g\")))]\n   \"TARGET_45\"\n   \"div %2,%0\"\n   [(set_attr \"length\" \"2\")])\n \n (define_expand \"modhi3\"\n-  [(set (match_dup 3)\n-\t(sign_extend:SI (match_operand:HI 1 \"general_operand\" \"g\")))\n-   (set (subreg:HI (match_dup 3) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 3)\n-\t  (sign_extend:SI (match_operand:HI 2 \"general_operand\" \"g\")))))\n-   (set (match_operand:HI 0 \"general_operand\" \"g\")\n-\t(subreg:HI (match_dup 3) 1))]\n-  \"TARGET_45\"\n-  \"operands[3] = gen_reg_rtx (SImode);\")\n-\n-;; we must restrict it to mod by 15 bit constant\n-(define_expand \"umodhi3\"\n-  [(set (subreg:HI (match_dup 3) 0)\n-\t(match_operand:HI 1 \"general_operand\" \"g\"))\n-   (set (subreg:HI (match_dup 3) 1)\n-\t(const_int 0))\n-   (set (subreg:HI (match_dup 3) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 3)\n-\t  (sign_extend:SI (match_operand:HI 2 \"immediate15_operand\" \"n\")))))\n-   (set (match_operand:HI 0 \"general_operand\" \"g\")\n-\t(subreg:HI (match_dup 3) 1))]\n-  \"TARGET_45\"\n-  \"\n-{\n-  operands[3] = gen_reg_rtx (SImode);\n-  \n-  if (GET_CODE (operands[2]) != CONST_INT\n-      || ((INTVAL (operands[2]) & 0x8000) != 0x0000))\n-    FAIL;\n-}\")\n-\n-(define_insn \"\"\n-  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r,r\") 0)\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0,0\")\n-\t  (sign_extend:SI (match_operand:HI 2 \"nonimmediate_operand\" \"rR,Q\")))))\n-   (set (subreg:HI (match_dup 0) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 1)\n-\t  (sign_extend:SI (match_dup 2)))))]\n+  [(set (subreg:HI (match_dup 1) 1)\n+\t(mod:HI (match_operand:SI 1 \"general_operand\" \"0\")\n+\t\t(match_operand:HI 2 \"general_operand\" \"g\")))\n+   (set (match_operand:HI 0 \"general_operand\" \"=r\")\n+        (subreg:HI (match_dup 1) 1))]\n   \"TARGET_45\"\n-  \"div %2, %0\"\n-  [(set_attr \"length\" \"1,2\")])\n+  \"\")\n \n-;; (sign_extend:SI (const_int))\n-; w/o -O \n-(define_insn \"\"\n-  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 0)\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0\")\n-\t  (sign_extend:SI (match_operand 2 \"immediate_operand\" \"i\")))))\n-   (set (subreg:HI (match_dup 0) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 1)\n-\t  (sign_extend:SI (match_dup 2)))))]\n-  \"TARGET_45\"\n-  \"div %2, %0\"\n-  [(set_attr \"length\" \"2\")])\n-; w/ -O\n (define_insn \"\"\n-  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 0)\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_operand:SI 1 \"general_operand\" \"0\")\n-\t  (match_operand:SI 2 \"immediate_operand\" \"i\"))))\n-   (set (subreg:HI (match_dup 0) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 1)\n-\t  (match_dup 2))))]\n+  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 1)\n+\t(mod:HI (match_operand:SI 1 \"general_operand\" \"0\")\n+\t\t(match_operand:HI 2 \"general_operand\" \"g\")))]\n   \"TARGET_45\"\n-  \"div %2, %0\"\n+  \"div %2,%0\"\n   [(set_attr \"length\" \"2\")])\n \n-(define_expand \"divmodhi4\"\n-  [(set (match_dup 4)\n-\t(sign_extend:SI (match_operand:HI 1 \"general_operand\" \"g\")))\n-   (set (subreg:HI (match_dup 4) 0)\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_dup 4)\n-\t  (sign_extend:SI (match_operand:HI 2 \"general_operand\" \"g\")))))\n-   (set (subreg:HI (match_dup 4) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 4)\n-\t  (sign_extend:SI (match_dup 2)))))\n-   (set (match_operand:HI 0 \"general_operand\" \"g\")\n-\t(subreg:HI (match_dup 4) 0))\n-   (set (match_operand:HI 3 \"general_operand\" \"g\")\n-\t(subreg:HI (match_dup 4) 1))]\n-  \"TARGET_45\"\n-  \"operands[4] = gen_reg_rtx(SImode);\")\n-\n-(define_expand \"udivmodhi4\"\n-  [(set (subreg:HI (match_dup 3) 1)\n-\t(match_operand:HI 1 \"general_operand\" \"g\"))\n-   (set (subreg:HI (match_dup 3) 0)\n-\t(const_int 0))\n-   (set (subreg:HI (match_dup 4) 0)\n-\t(truncate:HI \n-\t (div:SI\n-\t  (match_dup 4)\n-\t  (sign_extend:SI (match_operand:HI 2 \"immediate15_operand\" \"n\")))))\n-   (set (subreg:HI (match_dup 4) 1)\n-\t(truncate:HI \n-\t (mod:SI\n-\t  (match_dup 4)\n-\t  (sign_extend:SI (match_dup 2)))))\n-   (set (match_operand:HI 0 \"general_operand\" \"g\")\n-\t(subreg:HI (match_dup 4) 0))\n-   (set (match_operand:HI 3 \"general_operand\" \"g\")\n-\t(subreg:HI (match_dup 4) 1))]\n-  \"TARGET_45\"\n-  \"\n-{\n-  operands[3] = gen_reg_rtx (SImode);\n-  \n-  if (GET_CODE (operands[2]) != CONST_INT\n-      || ((INTVAL (operands[2]) & 0x8000) != 0x0000))\n-    FAIL;\n-}\")\n-\n-;; truncate used in div/mod patterns\n-(define_insn \"\"\n-  [(set (match_operand:QI 0 \"general_operand\" \"=r,r\")\n-\t(truncate:QI (match_operand:HI 1 \"general_operand\" \"0,r\")))]\n-  \"TARGET_45\"\n-  \"@\n-   ; nop\n-   movb %1, %0\"\n-  [(set_attr \"length\" \"0,1\")])\n+;(define_expand \"divmodhi4\"\n+;  [(parallel [(set (subreg:HI (match_dup 1) 0)\n+;\t           (div:HI (match_operand:SI 1 \"general_operand\" \"0\")\n+;\t\t           (match_operand:HI 2 \"general_operand\" \"g\")))\n+;              (set (subreg:HI (match_dup 1) 1)\n+;\t           (mod:HI (match_dup 1)\n+;\t\t           (match_dup 2)))])\n+;   (set (match_operand:HI 3 \"general_operand\" \"=r\")\n+;        (subreg:HI (match_dup 1) 1))\n+;   (set (match_operand:HI 0 \"general_operand\" \"=r\")\n+;        (subreg:HI (match_dup 1) 0))]\n+;  \"TARGET_45\"\n+;  \"\")\n+;\n+;(define_insn \"\"\n+;  [(set (subreg:HI (match_operand:SI 0 \"general_operand\" \"=r\") 0)\n+;\t           (div:HI (match_operand:SI 1 \"general_operand\" \"0\")\n+;\t\t           (match_operand:HI 2 \"general_operand\" \"g\")))\n+;   (set (subreg:HI (match_dup 0) 1)\n+;\t           (mod:HI (match_dup 1)\n+;\t\t           (match_dup 2)))]\n+;  \"TARGET_45\"\n+;  \"div %2, %0\")\n+;\n    \n ;; is rotate doing the right thing to be included here ????"}]}