{"sha": "efc643e90d0e75d3e003644404d4e29f84f274e6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWZjNjQzZTkwZDBlNzVkM2UwMDM2NDQ0MDRkNGUyOWY4NGYyNzRlNg==", "commit": {"author": {"name": "Igor Tsimbalist", "email": "igor.v.tsimbalist@intel.com", "date": "2017-11-17T21:18:15Z"}, "committer": {"name": "Igor Tsimbalist", "email": "itsimbal@gcc.gnu.org", "date": "2017-11-17T21:18:15Z"}, "message": "Enable building libatomic with Intel CET\n\nlibatomic/\n\t* configure.ac: Set CET_FLAGS, update XCFLAGS.\n\t* acinclude.m4: Add cet.m4 and enable.m4.\n\t* configure: Regenerate.\n\t* Makefile.in: Likewise.\n\t* testsuite/Makefile.in: Likewise.\n\nFrom-SVN: r254893", "tree": {"sha": "8b2c49c6371bafb0cc4c2febc9cee707d8d0271f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8b2c49c6371bafb0cc4c2febc9cee707d8d0271f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/efc643e90d0e75d3e003644404d4e29f84f274e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efc643e90d0e75d3e003644404d4e29f84f274e6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efc643e90d0e75d3e003644404d4e29f84f274e6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efc643e90d0e75d3e003644404d4e29f84f274e6/comments", "author": {"login": "itsimbal", "id": 29258612, "node_id": "MDQ6VXNlcjI5MjU4NjEy", "avatar_url": "https://avatars.githubusercontent.com/u/29258612?v=4", "gravatar_id": "", "url": "https://api.github.com/users/itsimbal", "html_url": "https://github.com/itsimbal", "followers_url": "https://api.github.com/users/itsimbal/followers", "following_url": "https://api.github.com/users/itsimbal/following{/other_user}", "gists_url": "https://api.github.com/users/itsimbal/gists{/gist_id}", "starred_url": "https://api.github.com/users/itsimbal/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/itsimbal/subscriptions", "organizations_url": "https://api.github.com/users/itsimbal/orgs", "repos_url": "https://api.github.com/users/itsimbal/repos", "events_url": "https://api.github.com/users/itsimbal/events{/privacy}", "received_events_url": "https://api.github.com/users/itsimbal/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "44685d378f723f8cd54770a445b6dfeab085ac99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44685d378f723f8cd54770a445b6dfeab085ac99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44685d378f723f8cd54770a445b6dfeab085ac99"}], "stats": {"total": 96, "additions": 92, "deletions": 4}, "files": [{"sha": "bc254ece628c549610e8762f32075db44b326193", "filename": "libatomic/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2FChangeLog?ref=efc643e90d0e75d3e003644404d4e29f84f274e6", "patch": "@@ -1,3 +1,11 @@\n+2017-11-17  Igor Tsimbalist  <igor.v.tsimbalist@intel.com>\n+\n+\t* configure.ac: Set CET_FLAGS, update XCFLAGS.\n+\t* acinclude.m4: Add cet.m4 and enable.m4.\n+\t* configure: Regenerate.\n+\t* Makefile.in: Likewise.\n+\t* testsuite/Makefile.in: Likewise.\n+\n 2017-10-20  Richard Earnshaw  <rearnsha@arm.com>\n \n \t* Makefile.am: (IFUNC_OPTIONS): Set the architecture to"}, {"sha": "fac9bae6e1ff6a37507e0b23b9253a9536c1d0da", "filename": "libatomic/Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2FMakefile.in?ref=efc643e90d0e75d3e003644404d4e29f84f274e6", "patch": "@@ -75,7 +75,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../ltoptions.m4 $(top_srcdir)/../ltsugar.m4 \\\n \t$(top_srcdir)/../ltversion.m4 $(top_srcdir)/../lt~obsolete.m4 \\\n \t$(top_srcdir)/acinclude.m4 $(top_srcdir)/../libtool.m4 \\\n-\t$(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../config/enable.m4 \\\n+\t$(top_srcdir)/../config/cet.m4 $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \\"}, {"sha": "bb6308bfa4fd621e91560780f167ce24e159622f", "filename": "libatomic/acinclude.m4", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Facinclude.m4?ref=efc643e90d0e75d3e003644404d4e29f84f274e6", "patch": "@@ -632,6 +632,8 @@ AC_MSG_NOTICE(versioning on shared library symbols is $enable_symvers)\n \n dnl ----------------------------------------------------------------------\n sinclude(../libtool.m4)\n+sinclude(../config/enable.m4)\n+sinclude(../config/cet.m4)\n dnl The lines below arrange for aclocal not to bring an installed\n dnl libtool.m4 into aclocal.m4, while still arranging for automake to\n dnl add a definition of LIBTOOL to Makefile.in."}, {"sha": "e49313fbf929373f60ee77793a1ecb24fd4a7afa", "filename": "libatomic/configure", "status": "modified", "additions": 74, "deletions": 2, "changes": 76, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Fconfigure?ref=efc643e90d0e75d3e003644404d4e29f84f274e6", "patch": "@@ -764,6 +764,7 @@ with_gnu_ld\n enable_libtool_lock\n enable_maintainer_mode\n enable_symvers\n+enable_cet\n with_gcc_major_version_only\n '\n       ac_precious_vars='build_alias\n@@ -1410,6 +1411,8 @@ Optional Features:\n \t\t\t  (and sometimes confusing) to the casual installer\n   --enable-symvers=STYLE  enables symbol versioning of the shared library\n                           [default=yes]\n+  --enable-cet            enable Intel CET in target libraries\n+                          [default=default]\n \n Optional Packages:\n   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]\n@@ -11115,7 +11118,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11118 \"configure\"\n+#line 11121 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11221,7 +11224,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11224 \"configure\"\n+#line 11227 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -15225,6 +15228,75 @@ if test \"x$GCC\" = \"xyes\"; then\n   XCFLAGS=\"$XCFLAGS -Wall -Werror\"\n fi\n \n+# Add CET specific flags if CET is enabled\n+ # Check whether --enable-cet was given.\n+if test \"${enable_cet+set}\" = set; then :\n+  enableval=$enable_cet;\n+      case \"$enableval\" in\n+       yes|no|default) ;;\n+       *) as_fn_error \"Unknown argument to enable/disable cet\" \"$LINENO\" 5 ;;\n+                          esac\n+\n+else\n+  enable_cet=default\n+fi\n+\n+\n+case \"$host\" in\n+  i[34567]86-*-linux* | x86_64-*-linux*)\n+    case \"$enable_cet\" in\n+      default)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  enable_cet=yes\n+else\n+  enable_cet=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+      yes)\n+\t# Check if assembler supports CET.\n+\tcat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+asm (\"setssbsy\");\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+\n+else\n+  as_fn_error \"assembler with CET support is required for --enable-cet\" \"$LINENO\" 5\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t;;\n+    esac\n+    ;;\n+  *)\n+    enable_cet=no\n+    ;;\n+esac\n+if test x$enable_cet = xyes; then\n+  CET_FLAGS=\"-fcf-protection -mcet\"\n+fi\n+\n+XCFLAGS=\"$XCFLAGS $CET_FLAGS\"\n+\n XCFLAGS=\"$XCFLAGS $XPCFLAGS\"\n \n "}, {"sha": "bf7315e78d1b6c3cc26c7fd598e89fe829199418", "filename": "libatomic/configure.ac", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Fconfigure.ac?ref=efc643e90d0e75d3e003644404d4e29f84f274e6", "patch": "@@ -238,6 +238,10 @@ if test \"x$GCC\" = \"xyes\"; then\n   XCFLAGS=\"$XCFLAGS -Wall -Werror\"\n fi\n \n+# Add CET specific flags if CET is enabled\n+GCC_CET_FLAGS(CET_FLAGS)\n+XCFLAGS=\"$XCFLAGS $CET_FLAGS\"\n+\n XCFLAGS=\"$XCFLAGS $XPCFLAGS\"\n \n AC_SUBST(config_path)"}, {"sha": "a95e3ca8e8ab9a18e537984d9455fb266cb6a734", "filename": "libatomic/testsuite/Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efc643e90d0e75d3e003644404d4e29f84f274e6/libatomic%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Ftestsuite%2FMakefile.in?ref=efc643e90d0e75d3e003644404d4e29f84f274e6", "patch": "@@ -64,7 +64,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../ltoptions.m4 $(top_srcdir)/../ltsugar.m4 \\\n \t$(top_srcdir)/../ltversion.m4 $(top_srcdir)/../lt~obsolete.m4 \\\n \t$(top_srcdir)/acinclude.m4 $(top_srcdir)/../libtool.m4 \\\n-\t$(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../config/enable.m4 \\\n+\t$(top_srcdir)/../config/cet.m4 $(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs"}]}