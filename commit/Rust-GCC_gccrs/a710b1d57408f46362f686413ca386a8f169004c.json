{"sha": "a710b1d57408f46362f686413ca386a8f169004c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTcxMGIxZDU3NDA4ZjQ2MzYyZjY4NjQxM2NhMzg2YThmMTY5MDA0Yw==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2016-05-09T12:35:25Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2016-05-09T12:35:25Z"}, "message": "[RS6000] Fragile testcase breaks with -frename-registers\n\n\tPR testsuite/70826\n\t* gcc.target/powerpc/savres.c: Compile with -fno-rename-registers.\n\nFrom-SVN: r236033", "tree": {"sha": "b815cf1264000d2a26af3b934534fb5a33189773", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b815cf1264000d2a26af3b934534fb5a33189773"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a710b1d57408f46362f686413ca386a8f169004c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a710b1d57408f46362f686413ca386a8f169004c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a710b1d57408f46362f686413ca386a8f169004c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a710b1d57408f46362f686413ca386a8f169004c/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "171f6f05db326f704e48375045aa2a98ea77675c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/171f6f05db326f704e48375045aa2a98ea77675c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/171f6f05db326f704e48375045aa2a98ea77675c"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "ebb70e98415962ae1511f04bdd9d36d6e6169009", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a710b1d57408f46362f686413ca386a8f169004c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a710b1d57408f46362f686413ca386a8f169004c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a710b1d57408f46362f686413ca386a8f169004c", "patch": "@@ -1,3 +1,8 @@\n+2016-05-09  Alan Modra  <amodra@gmail.com>\n+\n+\tPR testsuite/70826\n+\t* gcc.target/powerpc/savres.c: Compile with -fno-rename-registers.\n+\n 2016-05-09  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/70985"}, {"sha": "f724f308094c462fd050ada0c30b05676024c0ab", "filename": "gcc/testsuite/gcc.target/powerpc/savres.c", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a710b1d57408f46362f686413ca386a8f169004c/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fsavres.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a710b1d57408f46362f686413ca386a8f169004c/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fsavres.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fsavres.c?ref=a710b1d57408f46362f686413ca386a8f169004c", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run } */\n-/* { dg-options \"-fno-inline -fomit-frame-pointer\" } */\n+/* { dg-options \"-fno-inline -fomit-frame-pointer -fno-rename-registers\" } */\n /* { dg-additional-options \"-mdynamic-no-pic\" { target *-*-darwin* } } */\n \n /* -fno-inline -maltivec -m32/-m64 -mmultiple/no-multiple -Os/-O2.  */\n@@ -10,6 +10,13 @@\n #define SET_GPR(R,V) SET (long, R, V)\n #define SET_FPR(R,V) SET (double, R, V)\n #define SET_VR(R,V) SET (__attribute__ ((vector_size (16))) int, R, V)\n+/* There doesn't seem to be a way of letting gcc know that cr2, cr3\n+   and cr4 are being used, and therefore should not be touched by\n+   gcc.  Unlike gpr, fpr and vr we can't do something like\n+   register __attribute__ ((__mode__ (\"__CC__\"))) int cr2 __asm__ (\"cr2\");\n+   This makes the test somewhat fragile, dependent on gcc not using\n+   any of cr2, cr3 and cr4 in main(), and is why -fno-rename-registers\n+   is required.  */\n #define SET_CR(R,V) __asm__ __volatile__ (\"mtcrf %0,%1\" : : \"n\" (1<<(7-R)), \"r\" (V<<(4*(7-R))) : \"cr\" #R)\n #define TRASH_GPR(R) SET_GPR (R, 0)\n #define TRASH_FPR(R) SET_FPR (R, 0)\n@@ -1063,7 +1070,18 @@ void ws_0 (void)\n     abort ();\n }\n \n-int main (void)\n+/* We'd like to compile main with\n+   __attribute__ ((__optimize__ (\"fixed-cr2,fixed-cr3,fixed-cr4\")))\n+   but that doesn't do anything currently.  Obviously we don't want to\n+   compile the whole file with -ffixed-cr2 -ffixed-cr3 -ffixed-cr4 as\n+   that would also tell gcc not to save/restore cr, and we're trying\n+   to check that the above functions do save/restore cr.\n+   __attribute__ ((__optimize__ (\"no-rename-registers,omit-frame-pointer\")))\n+   works, but it seems odd to need omit-frame-pointer and raises the\n+   question of whether darwin would need -mdynamic-no-pic.\n+   So for now use -fno-rename-registers over the whole test.  */\n+int\n+main (void)\n {\n   INIT_REGS;\n   USE_ALL_CR;"}]}