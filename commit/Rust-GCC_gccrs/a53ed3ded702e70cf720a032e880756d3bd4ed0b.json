{"sha": "a53ed3ded702e70cf720a032e880756d3bd4ed0b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTUzZWQzZGVkNzAyZTcwY2Y3MjBhMDMyZTg4MDc1NmQzYmQ0ZWQwYg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2005-03-24T04:26:30Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2005-03-24T04:26:30Z"}, "message": "normal.exp: Read testsuite_files, if it exists.\n\n\t* testsuite/libstdc++-dg/normal.exp: Read testsuite_files, if it\n\texists.\n\nFrom-SVN: r96980", "tree": {"sha": "93ab0653b4688a32081137dcf0fff2e80027d5b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/93ab0653b4688a32081137dcf0fff2e80027d5b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a53ed3ded702e70cf720a032e880756d3bd4ed0b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a53ed3ded702e70cf720a032e880756d3bd4ed0b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a53ed3ded702e70cf720a032e880756d3bd4ed0b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a53ed3ded702e70cf720a032e880756d3bd4ed0b/comments", "author": null, "committer": null, "parents": [{"sha": "97e095fdc7191eea3d9bbf098c5feccc9446dc67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97e095fdc7191eea3d9bbf098c5feccc9446dc67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97e095fdc7191eea3d9bbf098c5feccc9446dc67"}], "stats": {"total": 85, "additions": 57, "deletions": 28}, "files": [{"sha": "1c25f7873666bb07358cba455b4ab8fba575fa63", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a53ed3ded702e70cf720a032e880756d3bd4ed0b/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a53ed3ded702e70cf720a032e880756d3bd4ed0b/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=a53ed3ded702e70cf720a032e880756d3bd4ed0b", "patch": "@@ -1,5 +1,8 @@\n 2005-03-23  Mark Mitchell  <mark@codesourcery.com>\n \n+\t* testsuite/libstdc++-dg/normal.exp: Read testsuite_files, if it\n+\texists.\n+\n \t* testsuite/lib/libstdc++.exp (libstdc++_wchar_t): Rename to ...\n \t(v3-wchar_t): ... this.\n \t(libstdc++_threads): Rename to ..."}, {"sha": "746c7a8ec3f11dc1a9fd99cc3f38757ec32d09ed", "filename": "libstdc++-v3/testsuite/libstdc++-dg/normal.exp", "status": "modified", "additions": 54, "deletions": 28, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a53ed3ded702e70cf720a032e880756d3bd4ed0b/libstdc%2B%2B-v3%2Ftestsuite%2Flibstdc%2B%2B-dg%2Fnormal.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a53ed3ded702e70cf720a032e880756d3bd4ed0b/libstdc%2B%2B-v3%2Ftestsuite%2Flibstdc%2B%2B-dg%2Fnormal.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flibstdc%2B%2B-dg%2Fnormal.exp?ref=a53ed3ded702e70cf720a032e880756d3bd4ed0b", "patch": "@@ -24,36 +24,62 @@ dg-init\n # Build the support objects.\n v3-build_support\n \n-# Find directories that might have tests.\n-set subdirs [glob \"$srcdir/\\[0-9\\]\\[0-9\\]*\"]\n-foreach d [glob \"$srcdir/\\[a-z\\]*\"] {\n-    if {[file isdirectory $d]} { \n-\tlappend subdirs $d\n-    }\n-}\n-\n-# Find all the tests.\n set tests [list]\n-foreach s $subdirs {\n-    set subdir_tests [find $s *.cc]\n-    # Filter out tests that should not be run.\n-    foreach t $subdir_tests {\n-\t# The DejaGNU \"find\" procedure sometimes returns a list \n-\t# containing an empty string, when it should realy return\n-\t# an empty list.\n-\tif { $t == \"\" } {\n-\t    continue\n+\n+# If there is a \"testsuite_files\" file, use it.\n+#\n+# This is a workaround for problems reported with using:\n+#\n+#   runtest normal.exp=\"`cat testsuite_files`\"\n+#\n+# See:\n+#  http://gcc.gnu.org/ml/libstdc++/2005-03/msg00278.html\n+# for discussion of the problem.\n+#\n+# If that worked consistently, we could modify \"make check\" to\n+# pass that option, and then remove this code.\n+if {[info exists blddir]} {\n+    set tests_file \"${blddir}/testsuite/testsuite_files\"\n+}\n+if {[info exists tests_file] && [file exists $tests_file]} {\n+    set f [open $tests_file]\n+    while { ! [eof $f] } {\n+\tset t [gets $f]\n+\tif { [string length \"$t\"] != 0 } {\n+\t    lappend tests ${srcdir}/${t}\n \t}\n-\t# Filter out:\n-\t# 1. interactive tests.\n-\t# 2. performance tests.\n-\t# 3. wchar_t tests, if not supported.\n-\t# 4. thread tests, if not supported. \n-\tif { [string first _xin $t] == -1\n-\t     && [string first performance $t] == -1\n-\t     && (${v3-wchar_t} || [string first wchar_t $t] == -1) \n-             && (${v3-threads} || [string first thread $t] == -1) } {\n-\t    lappend tests $t\n+    } \n+    close $f\n+} else {\n+    # Find directories that might have tests.\n+    set subdirs [glob \"$srcdir/\\[0-9\\]\\[0-9\\]*\"]\n+    foreach d [glob \"$srcdir/\\[a-z\\]*\"] {\n+\tif {[file isdirectory $d]} { \n+\t    lappend subdirs $d\n+\t}\n+    }\n+    # Find all the tests.\n+    foreach s $subdirs {\n+\tset subdir_tests [find $s *.cc]\n+\t# Filter out tests that should not be run.\n+\tforeach t $subdir_tests {\n+\t    # The DejaGNU \"find\" procedure sometimes returns a list \n+\t    # containing an empty string, when it should really return\n+\t    # an empty list.\n+\t    if { $t == \"\" } {\n+\t\tcontinue\n+\t    }\n+\t    # Filter out:\n+\t    # 1. interactive tests.\n+\t    # 2. performance tests.\n+\t    # 3. wchar_t tests, if not supported.\n+\t    # 4. thread tests, if not supported. \n+\t    if { [string first _xin $t] == -1\n+\t\t && [string first performance $t] == -1\n+\t\t && (${v3-wchar_t} || [string first wchar_t $t] == -1) \n+\t\t && (${v3-threads} || [string first thread $t] == -1) } {\n+\t\tlappend tests $t\n+\t    }\n \t}\n     }\n }"}]}