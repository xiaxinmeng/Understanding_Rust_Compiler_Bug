{"sha": "8a874cb4375959c5653959372507fd980fad7957", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGE4NzRjYjQzNzU5NTljNTY1Mzk1OTM3MjUwN2ZkOTgwZmFkNzk1Nw==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2002-11-24T23:26:13Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2002-11-24T23:26:13Z"}, "message": "class.c (layout_class_type): Reuse tail padding when laying out virtual bases.\n\n\t* class.c (layout_class_type): Reuse tail padding when laying out\n\tvirtual bases.\n\n\t* g++.dg/abi/empty10.C: New test.\n\nFrom-SVN: r59443", "tree": {"sha": "86d3041c59c15d3b3a525c0b70a8d5c24a779764", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/86d3041c59c15d3b3a525c0b70a8d5c24a779764"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a874cb4375959c5653959372507fd980fad7957", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a874cb4375959c5653959372507fd980fad7957", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a874cb4375959c5653959372507fd980fad7957", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a874cb4375959c5653959372507fd980fad7957/comments", "author": null, "committer": null, "parents": [{"sha": "adde288a90bb507dd7dccc6cdc46bf8ec0546a49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/adde288a90bb507dd7dccc6cdc46bf8ec0546a49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/adde288a90bb507dd7dccc6cdc46bf8ec0546a49"}], "stats": {"total": 56, "additions": 51, "deletions": 5}, "files": [{"sha": "a2feb543b984df680f2b30a1500c5aa5b6bb5e68", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a874cb4375959c5653959372507fd980fad7957/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a874cb4375959c5653959372507fd980fad7957/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8a874cb4375959c5653959372507fd980fad7957", "patch": "@@ -1,3 +1,8 @@\n+2002-11-24  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* class.c (layout_class_type): Reuse tail padding when laying out\n+\tvirtual bases.\n+\n 2002-11-22  Mark Mitchell  <mark@codesourcery.com>\n \n \t* rtti.c (qualifier_flags): Fix thinko."}, {"sha": "4d54376fb96142faf7969b7e6a54f5ef4ebf9848", "filename": "gcc/cp/class.c", "status": "modified", "additions": 15, "deletions": 5, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a874cb4375959c5653959372507fd980fad7957/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a874cb4375959c5653959372507fd980fad7957/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=8a874cb4375959c5653959372507fd980fad7957", "patch": "@@ -4993,9 +4993,10 @@ layout_class_type (tree t, tree *virtuals_p)\n       normalize_rli (rli);\n     }\n \n-  /* Make sure that empty classes are reflected in RLI at this \n-     point.  */\n-  include_empty_classes(rli);\n+  /* G++ 3.2 does not allow virtual bases to be overlaid with tail\n+     padding.  */\n+  if (!abi_version_at_least (2))\n+    include_empty_classes(rli);\n \n   /* Delete all zero-width bit-fields from the list of fields.  Now\n      that the type is laid out they are no longer important.  */\n@@ -5022,8 +5023,17 @@ layout_class_type (tree t, tree *virtuals_p)\n \t}\n       else\n \t{\n-\t  TYPE_SIZE (base_t) = rli_size_so_far (rli);\n-\t  TYPE_SIZE_UNIT (base_t) = rli_size_unit_so_far (rli);\n+\t  TYPE_SIZE_UNIT (base_t) \n+\t    = size_binop (MAX_EXPR,\n+\t\t\t  rli_size_unit_so_far (rli),\n+\t\t\t  end_of_class (t, /*include_virtuals_p=*/0));\n+\t  TYPE_SIZE (base_t) \n+\t    = size_binop (MAX_EXPR,\n+\t\t\t  rli_size_so_far (rli),\n+\t\t\t  size_binop (MULT_EXPR,\n+\t\t\t\t      convert (bitsizetype,\n+\t\t\t\t\t       TYPE_SIZE_UNIT (base_t)),\n+\t\t\t\t      bitsize_int (BITS_PER_UNIT)));\n \t}\n       TYPE_ALIGN (base_t) = rli->record_align;\n       TYPE_USER_ALIGN (base_t) = TYPE_USER_ALIGN (t);"}, {"sha": "c8da9924fad06b0dda5406e5997258428a33a00c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a874cb4375959c5653959372507fd980fad7957/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a874cb4375959c5653959372507fd980fad7957/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8a874cb4375959c5653959372507fd980fad7957", "patch": "@@ -1,3 +1,7 @@\n+2002-11-24  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* g++.dg/abi/empty10.C: New test.\n+\n 2002-11-24 \ufffdEric Botcazou \ufffd<ebotcazou@libertysurf.fr>\n \n \t* gcc.c-torture/compile/20021124-1.c: New test."}, {"sha": "802e2c3abe81ca4ca2f33c57962aadefedfa69ae", "filename": "gcc/testsuite/g++.dg/abi/empty10.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a874cb4375959c5653959372507fd980fad7957/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fempty10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a874cb4375959c5653959372507fd980fad7957/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fempty10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Fempty10.C?ref=8a874cb4375959c5653959372507fd980fad7957", "patch": "@@ -0,0 +1,27 @@\n+// { dg-do run }\n+// { dg-options \"-fabi-version=0 -w\" }\n+\n+struct E {};\n+struct E2 : public E {};\n+\n+struct A {\n+  int i;\n+};\n+\n+struct B {\n+  int j;\n+};\n+\n+struct C :\n+  public E, \n+  public A, \n+  public E2, \n+  virtual public B {\n+};\n+\n+C c;\n+\n+int main () {\n+  if (((char*)(B*)&c - (char*)&c) != 8)\n+    return 1;\n+}"}]}