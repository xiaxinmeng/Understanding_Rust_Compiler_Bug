{"sha": "0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGY3Y2VjMDk4MmEyODY2ZjM2ZDE3ZTJhYzFjMWIwNWQ2OWU2MTU0ZA==", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2019-02-17T21:19:20Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gcc.gnu.org", "date": "2019-02-17T21:19:20Z"}, "message": "re PR fortran/88299 ([F18] COMMON in a legacy module produces bogus warnings in dependent code)\n\n2019-02-17  Harald Anlauf  <anlauf@gmx.de>\n\n\tPR fortran/88299\n\t* resolve.c (resolve_common_blocks,resolve_common_vars): Move\n\tcheck for obsolent COMMON feature in F2018 to better place.\n\n\tPR fortran/88299\n\t* gfortran.dg/pr88299.f90: New test.\n\nFrom-SVN: r268974", "tree": {"sha": "9d0429003ce847666f183a45e6f00854304c1587", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d0429003ce847666f183a45e6f00854304c1587"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e6ca33ba57dd55357cf2fd97c81fd12daca465a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6ca33ba57dd55357cf2fd97c81fd12daca465a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6ca33ba57dd55357cf2fd97c81fd12daca465a3"}], "stats": {"total": 37, "additions": 32, "deletions": 5}, "files": [{"sha": "4f150e257eb529e9f60dcdd68006eb2bdcb423f7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "patch": "@@ -1,3 +1,9 @@\n+2019-02-17  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/88299\n+\t* resolve.c (resolve_common_blocks,resolve_common_vars): Move\n+\tcheck for obsolent COMMON feature in F2018 to better place.\n+\n 2019-02-17  Harald Anlauf  <anlauf@gmx.de>\n \n \tPR fortran/89077"}, {"sha": "e581a60f157f41f1ea88764a56ab8b62b2ec9b8f", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "patch": "@@ -940,7 +940,11 @@ resolve_common_vars (gfc_common_head *common_block, bool named_common)\n \t have been ignored to continue parsing.\n \t We do the checks again here.  */\n       if (!csym->attr.use_assoc)\n-\tgfc_add_in_common (&csym->attr, csym->name, &common_block->where);\n+\t{\n+\t  gfc_add_in_common (&csym->attr, csym->name, &common_block->where);\n+\t  gfc_notify_std (GFC_STD_F2018_OBS, \"COMMON block at %L\",\n+\t\t\t  &common_block->where);\n+\t}\n \n       if (csym->value || csym->attr.data)\n \t{\n@@ -998,10 +1002,6 @@ resolve_common_blocks (gfc_symtree *common_root)\n \n   resolve_common_vars (common_root->n.common, true);\n \n-  if (!gfc_notify_std (GFC_STD_F2018_OBS, \"COMMON block at %L\",\n-\t\t       &common_root->n.common->where))\n-    return;\n-\n   /* The common name is a global name - in Fortran 2003 also if it has a\n      C binding name, since Fortran 2008 only the C binding name is a global\n      identifier.  */"}, {"sha": "9b197cc7947e92f22641b1ccae5b7f80d7490f28", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "patch": "@@ -1,3 +1,8 @@\n+2019-02-17  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/88299\n+\t* gfortran.dg/pr88299.f90: New test.\n+\n 2019-02-17  Harald Anlauf  <anlauf@gmx.de>\n \n \tPR fortran/89077"}, {"sha": "5471d40ea38eb94192811438eed6534c314d18e3", "filename": "gcc/testsuite/gfortran.dg/pr88299.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88299.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f7cec0982a2866f36d17e2ac1c1b05d69e6154d/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88299.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr88299.f90?ref=0f7cec0982a2866f36d17e2ac1c1b05d69e6154d", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do compile }\n+! { dg-options \"-std=f2018\" }\n+!\n+! PR 85839: [F18] COMMON in a legacy module produces bogus warnings\n+!           in dependent code\n+\n+module legacy\n+  integer :: major, n\n+  common /version/ major  ! { dg-warning \"obsolescent feature\" }\n+  public  :: n\n+  private\n+end module legacy\n+\n+module mod1\n+  use legacy, only: n     ! No warning expected here\n+end module mod1"}]}