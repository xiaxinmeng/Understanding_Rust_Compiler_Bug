{"sha": "a093356aba118841c901f3667a99b5250a8e3b18", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA5MzM1NmFiYTExODg0MWM5MDFmMzY2N2E5OWI1MjUwYThlM2IxOA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2012-10-25T14:52:32Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2012-10-25T14:52:32Z"}, "message": "re PR lto/54980 (gimple check: expected gimple_cond(error_mark), have gimple_call() in gimple_cond_set_lhs, at gimple.h:2578)\n\n\n\tPR tree-optimize/54980\n\t* tree-ssa-loop-ivcanon.c (constant_after_peeling): Fix\n\tobvious typo.\n\t(loop_edge_to_cancel): Be sure that the edge is from an conditional\n\tso we can cancel it.\n\nFrom-SVN: r192809", "tree": {"sha": "4ea7a5db9dd46f6e2bcb5902d32cc1518ce78171", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4ea7a5db9dd46f6e2bcb5902d32cc1518ce78171"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a093356aba118841c901f3667a99b5250a8e3b18", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a093356aba118841c901f3667a99b5250a8e3b18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a093356aba118841c901f3667a99b5250a8e3b18", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a093356aba118841c901f3667a99b5250a8e3b18/comments", "author": null, "committer": null, "parents": [{"sha": "93100c6b5b45c39b54b25beb5d77e50ea9caa047", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93100c6b5b45c39b54b25beb5d77e50ea9caa047", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93100c6b5b45c39b54b25beb5d77e50ea9caa047"}], "stats": {"total": 14, "additions": 13, "deletions": 1}, "files": [{"sha": "0dde7f8fb421734364625c6d517bc5f0287205af", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a093356aba118841c901f3667a99b5250a8e3b18/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a093356aba118841c901f3667a99b5250a8e3b18/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a093356aba118841c901f3667a99b5250a8e3b18", "patch": "@@ -1,3 +1,11 @@\n+2012-10-25  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR tree-optimize/54980\n+\t* tree-ssa-loop-ivcanon.c (constant_after_peeling): Fix\n+\tobvious typo.\n+\t(loop_edge_to_cancel): Be sure that the edge is from an conditional\n+\tso we can cancel it.\n+\n 2012-10-25  Marc Glisse  <marc.glisse@inria.fr>\n \n \tPR c++/54427"}, {"sha": "3868b45a4c39e24e0879230093d837a7e7b41318", "filename": "gcc/tree-ssa-loop-ivcanon.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a093356aba118841c901f3667a99b5250a8e3b18/gcc%2Ftree-ssa-loop-ivcanon.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a093356aba118841c901f3667a99b5250a8e3b18/gcc%2Ftree-ssa-loop-ivcanon.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivcanon.c?ref=a093356aba118841c901f3667a99b5250a8e3b18", "patch": "@@ -160,7 +160,7 @@ constant_after_peeling (tree op, gimple stmt, struct loop *loop)\n       /* First make fast look if we see constant array inside.  */\n       while (handled_component_p (base))\n \tbase = TREE_OPERAND (base, 0);\n-      if ((DECL_P (base) == VAR_DECL\n+      if ((DECL_P (base)\n \t   && const_value_known_p (base))\n \t  || CONSTANT_CLASS_P (base))\n \t{\n@@ -364,6 +364,10 @@ loop_edge_to_cancel (struct loop *loop)\n        else\n          edge_to_cancel = EDGE_SUCC (edge_to_cancel->src, 0);\n \n+      /* We only can handle conditionals.  */\n+      if (!(edge_to_cancel->flags & (EDGE_TRUE_VALUE | EDGE_FALSE_VALUE)))\n+\tcontinue;\n+\n       /* We should never have conditionals in the loop latch. */\n       gcc_assert (edge_to_cancel->dest != loop->header);\n "}]}