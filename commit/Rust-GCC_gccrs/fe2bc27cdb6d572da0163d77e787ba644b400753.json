{"sha": "fe2bc27cdb6d572da0163d77e787ba644b400753", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmUyYmMyN2NkYjZkNTcyZGEwMTYzZDc3ZTc4N2JhNjQ0YjQwMDc1Mw==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2019-10-11T17:32:48Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2019-10-11T17:32:48Z"}, "message": "Support _Decimal* keywords for C2x.\n\nISO C2x adds decimal floating point as an optional standard feature.\nThis patch accordingly makes GCC accept the _Decimal* keywords in\nstrict C2x mode, using pedwarn_c11 to get a warning for\n-Wc11-c2x-compat.  (Constants, where the pedwarn is in libcpp, will be\ndealt with separately.)\n\nThe _Decimal* keywords are marked with D_EXT, meaning they are not\nconsidered keywords at all in strict conformance modes.  This is\ncontrary to the normal practice for most implementation-namespace\nkeywords, which are accepted in all standards modes but with\nappropriate pedwarns for older standards.  This patch removes D_EXT\nfrom those keywords so they are accepted as keywords for all\nstandards, consequently removing the gcc.dg/dfp/keywords-ignored-c99.c\ntest that is no longer valid.\n\n(A new D_C2X for keywords will still be needed if any new keywords get\nadded that aren't in the implementation namespace for older standards;\nthere are proposals for such keywords, albeit as predefined macros\nthat might not actually need new keywords in the compiler in all\ncases.  If the DFP keywords end up as decimal32 etc., of course\nappropriate compiler and testcase changes will be needed, and a\nversion of keywords-ignored-c99.c would make sense again with such\nspellings.)\n\nBootstrapped with no regressions on x86_64-pc-linux-gnu.\n\ngcc/c:\n\t* c-decl.c (declspecs_add_type): Use pedwarn_c11 for DFP types.\n\ngcc/c-family:\n\t* c-common.c (c_common_reswords): Do not use D_EXT for _Decimal32,\n\t_Decimal64 and _Decimal128.\n\ngcc/testsuite:\n\t* gcc.dg/dfp/c11-keywords-1.c, gcc.dg/dfp/c11-keywords-2.c,\n\tgcc.dg/dfp/c2x-keywords-1.c, gcc.dg/dfp/c2x-keywords-2.c: New\n\ttests.\n\t* gcc.dg/dfp/keywords-ignored-c99.c: Remove test.\n\t* gcc.dg/dfp/constants-c99.c, gcc.dg/dfp/keywords-c89.c,\n\tgcc.dg/dfp/keywords-c99.c: Use -pedantic-errors.\n\nFrom-SVN: r276896", "tree": {"sha": "abec31c70851140a7af2d5ec10894a47c357ec8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/abec31c70851140a7af2d5ec10894a47c357ec8a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fe2bc27cdb6d572da0163d77e787ba644b400753", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe2bc27cdb6d572da0163d77e787ba644b400753", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe2bc27cdb6d572da0163d77e787ba644b400753", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe2bc27cdb6d572da0163d77e787ba644b400753/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6334c1f49fe3e3b81dfe90f25fdf89a3ddb557b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6334c1f49fe3e3b81dfe90f25fdf89a3ddb557b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6334c1f49fe3e3b81dfe90f25fdf89a3ddb557b8"}], "stats": {"total": 82, "additions": 57, "deletions": 25}, "files": [{"sha": "a0ce54b485870241d30728af55a431e6176e14b1", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -1,3 +1,8 @@\n+2019-10-11  Joseph Myers  <joseph@codesourcery.com>\n+\n+\t* c-common.c (c_common_reswords): Do not use D_EXT for _Decimal32,\n+\t_Decimal64 and _Decimal128.\n+\n 2019-10-10  Joseph Myers  <joseph@codesourcery.com>\n \n \t* c-cppbuiltin.c (c_cpp_builtins): Do not define macros for DFP"}, {"sha": "909f52a922a524731925f5ba1d13732a1efb9fb2", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -351,9 +351,9 @@ const struct c_common_resword c_common_reswords[] =\n   { \"_Float32x\",        RID_FLOAT32X,  D_CONLY },\n   { \"_Float64x\",        RID_FLOAT64X,  D_CONLY },\n   { \"_Float128x\",       RID_FLOAT128X, D_CONLY },\n-  { \"_Decimal32\",       RID_DFLOAT32,  D_CONLY | D_EXT },\n-  { \"_Decimal64\",       RID_DFLOAT64,  D_CONLY | D_EXT },\n-  { \"_Decimal128\",      RID_DFLOAT128, D_CONLY | D_EXT },\n+  { \"_Decimal32\",       RID_DFLOAT32,  D_CONLY },\n+  { \"_Decimal64\",       RID_DFLOAT64,  D_CONLY },\n+  { \"_Decimal128\",      RID_DFLOAT128, D_CONLY },\n   { \"_Fract\",           RID_FRACT,     D_CONLY | D_EXT },\n   { \"_Accum\",           RID_ACCUM,     D_CONLY | D_EXT },\n   { \"_Sat\",             RID_SAT,       D_CONLY | D_EXT },"}, {"sha": "894f5e752e3a8024c6a206bd69829b8bad2df469", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -1,3 +1,7 @@\n+2019-10-11  Joseph Myers  <joseph@codesourcery.com>\n+\n+\t* c-decl.c (declspecs_add_type): Use pedwarn_c11 for DFP types.\n+\n 2019-10-10  Jakub Jelinek  <jakub@redhat.com>\n \n \t* c-parser.c (c_parser_omp_all_clauses): Add NESTED_P argument, if"}, {"sha": "f67033b82d25d5c45940de6ee221f76b714669db", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -10959,8 +10959,9 @@ declspecs_add_type (location_t loc, struct c_declspecs *specs,\n \t\terror_at (loc,\n \t\t\t  (\"decimal floating-point not supported \"\n \t\t\t   \"for this target\"));\n-\t      pedwarn (loc, OPT_Wpedantic,\n-\t\t       \"ISO C does not support decimal floating-point\");\n+\t      pedwarn_c11 (loc, OPT_Wpedantic,\n+\t\t\t   \"ISO C does not support decimal floating-point \"\n+\t\t\t   \"before C2X\");\n \t      return specs;\n \t    case RID_FRACT:\n \t    case RID_ACCUM:"}, {"sha": "2459275f333da06e7266e2b66fb3279a5c2b7be3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -1,3 +1,12 @@\n+2019-10-11  Joseph Myers  <joseph@codesourcery.com>\n+\n+\t* gcc.dg/dfp/c11-keywords-1.c, gcc.dg/dfp/c11-keywords-2.c,\n+\tgcc.dg/dfp/c2x-keywords-1.c, gcc.dg/dfp/c2x-keywords-2.c: New\n+\ttests.\n+\t* gcc.dg/dfp/keywords-ignored-c99.c: Remove test.\n+\t* gcc.dg/dfp/constants-c99.c, gcc.dg/dfp/keywords-c89.c,\n+\tgcc.dg/dfp/keywords-c99.c: Use -pedantic-errors.\n+\n 2019-10-11  Tobias Burnus  <tobias@codesourcery.com>\n \n \tPR fortran/92050"}, {"sha": "5a5c862cde1f1f1cea6214cee41572bb76547871", "filename": "gcc/testsuite/gcc.dg/dfp/c11-keywords-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc11-keywords-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc11-keywords-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc11-keywords-1.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -0,0 +1,7 @@\n+/* Test that _Decimal* keywords diagnosed in C11 mode: -pedantic.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c11 -pedantic\" } */\n+\n+_Decimal32 d32; /* { dg-warning \"ISO C does not support\" } */\n+_Decimal64 d64; /* { dg-warning \"ISO C does not support\" } */\n+_Decimal128 d128; /* { dg-warning \"ISO C does not support\" } */"}, {"sha": "7c7f3d9b4b11ed9d2fec916b025667ae3a2444b5", "filename": "gcc/testsuite/gcc.dg/dfp/c11-keywords-2.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc11-keywords-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc11-keywords-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc11-keywords-2.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -0,0 +1,7 @@\n+/* Test that _Decimal* keywords diagnosed in C11 mode: -pedantic-errors.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c11 -pedantic-errors\" } */\n+\n+_Decimal32 d32; /* { dg-error \"ISO C does not support\" } */\n+_Decimal64 d64; /* { dg-error \"ISO C does not support\" } */\n+_Decimal128 d128; /* { dg-error \"ISO C does not support\" } */"}, {"sha": "a3a1da536f0018cf6dbc85bdf694122c18392408", "filename": "gcc/testsuite/gcc.dg/dfp/c2x-keywords-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc2x-keywords-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc2x-keywords-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc2x-keywords-1.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -0,0 +1,7 @@\n+/* Test that _Decimal* keywords are accepted in C2X mode.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c2x -pedantic-errors\" } */\n+\n+_Decimal32 d32;\n+_Decimal64 d64;\n+_Decimal128 d128;"}, {"sha": "9655dd0cf02536497ee1ec36edb088d392367c20", "filename": "gcc/testsuite/gcc.dg/dfp/c2x-keywords-2.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc2x-keywords-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc2x-keywords-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fc2x-keywords-2.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -0,0 +1,7 @@\n+/* Test that _Decimal* keywords are accepted in C2X mode: compat warnings.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c2x -Wc11-c2x-compat\" } */\n+\n+_Decimal32 d32; /* { dg-warning \"ISO C does not support\" } */\n+_Decimal64 d64; /* { dg-warning \"ISO C does not support\" } */\n+_Decimal128 d128; /* { dg-warning \"ISO C does not support\" } */"}, {"sha": "5a135c534928f975657911b93ea857c70092af69", "filename": "gcc/testsuite/gcc.dg/dfp/constants-c99.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fconstants-c99.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fconstants-c99.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fconstants-c99.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-options \"-std=c99 -Wno-overflow\" } */\n+/* { dg-options \"-std=c99 -Wno-overflow -pedantic-errors\" } */\n \n /* N1150 6: Constants.\n    C99 6.4.4.2: Floating constants.  */"}, {"sha": "a67c3d63c0b1daaa964e01138b4cb8849577f0a5", "filename": "gcc/testsuite/gcc.dg/dfp/keywords-c89.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-c89.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-c89.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-c89.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -1,7 +1,7 @@\n /* { dg-do compile } */\n-/* { dg-options \"-std=c89\" } */\n+/* { dg-options \"-std=c89 -pedantic-errors\" } */\n \n-/* Decimal float keywords are not recognized in C89 mode.  */\n+/* Decimal float keywords are diagnosed in pedantic C89 mode.  */\n \n _Decimal32 x;\t\t/* { dg-error \"\" } */\n _Decimal64 y;\t\t/* { dg-error \"\" } */"}, {"sha": "f51900e380865546601ef3425a09a217337296f5", "filename": "gcc/testsuite/gcc.dg/dfp/keywords-c99.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-c99.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fe2bc27cdb6d572da0163d77e787ba644b400753/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-c99.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-c99.c?ref=fe2bc27cdb6d572da0163d77e787ba644b400753", "patch": "@@ -1,7 +1,7 @@\n /* { dg-do compile } */\n-/* { dg-options \"-std=c99\" } */\n+/* { dg-options \"-std=c99 -pedantic-errors\" } */\n \n-/* Decimal float keywords are not recognized in C99 mode.  */\n+/* Decimal float keywords are diagnosed in pedantic C99 mode.  */\n \n _Decimal32 x;\t\t/* { dg-error \"\" } */\n _Decimal64 y;\t\t/* { dg-error \"\" } */"}, {"sha": "a4258aaa8ae655745b90568d80531b9c948b4cc1", "filename": "gcc/testsuite/gcc.dg/dfp/keywords-ignored-c99.c", "status": "removed", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6334c1f49fe3e3b81dfe90f25fdf89a3ddb557b8/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-ignored-c99.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6334c1f49fe3e3b81dfe90f25fdf89a3ddb557b8/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-ignored-c99.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdfp%2Fkeywords-ignored-c99.c?ref=6334c1f49fe3e3b81dfe90f25fdf89a3ddb557b8", "patch": "@@ -1,15 +0,0 @@\n-/* { dg-do compile } */\n-/* { dg-options \"-std=c99\" } */\n-\n-/* Decimal float keywords are not reserved for c99.  */\n-\n-int _Decimal32 (void)\n-{\n-  return 0;\n-}\n-\n-int foo (int i)\n-{\n-  int _Decimal64 = i * 2;\n-  return _Decimal64;\n-}"}]}