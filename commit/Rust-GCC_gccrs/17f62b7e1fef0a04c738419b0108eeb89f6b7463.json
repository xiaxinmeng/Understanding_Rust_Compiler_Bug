{"sha": "17f62b7e1fef0a04c738419b0108eeb89f6b7463", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTdmNjJiN2UxZmVmMGEwNGM3Mzg0MTliMDEwOGVlYjg5ZjZiNzQ2Mw==", "commit": {"author": {"name": "Jim MacArthur", "email": "jim.macarthur@codethink.co.uk", "date": "2019-06-19T03:02:21Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2019-06-19T03:02:21Z"}, "message": "re PR fortran/89103 (Allow blank format items in format strings)\n\n2019-06-19  Jim MacArthur  <jim.macarthur@codethink.co.uk>\n\t    Mark Eggleston  <mark.eggleston@codethink.com>\n\n\tPR fortran/89103\n\t* gfortran.texi: Add -fdec-blank-format-item\n\t* invoke.texi: Add option to list of options.\n\t* invoke.texi: Add to section on Commas in FORMAT specifications.\n\t* io.c (check_format): At FMT_RPAREN goto finished if\n\t-fdec-blank-format-item otherwise set error string.\n\t* lang.opt: Add new option.\n\t* options.c (set_dec_flags): Add SET_BITFLAG for\n\tflag_dec_format_defaults.\n\n\t* gfortran.dg/dec_format_empty_item_1.f: New test.\n\t* gfortran.dg/dec_format_empty_item_2.f: New test.\n\t* gfortran.dg/dec_format_empty_item_3.f: New test.\n\nCo-Authored-By: Mark Eggleston <mark.eggleston@codethink.com>\n\nFrom-SVN: r272467", "tree": {"sha": "ff00dffb7f13addcdaa0121629e4649ffdef0fce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff00dffb7f13addcdaa0121629e4649ffdef0fce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/17f62b7e1fef0a04c738419b0108eeb89f6b7463", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17f62b7e1fef0a04c738419b0108eeb89f6b7463", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17f62b7e1fef0a04c738419b0108eeb89f6b7463", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17f62b7e1fef0a04c738419b0108eeb89f6b7463/comments", "author": {"login": "jmacarthur", "id": 691227, "node_id": "MDQ6VXNlcjY5MTIyNw==", "avatar_url": "https://avatars.githubusercontent.com/u/691227?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jmacarthur", "html_url": "https://github.com/jmacarthur", "followers_url": "https://api.github.com/users/jmacarthur/followers", "following_url": "https://api.github.com/users/jmacarthur/following{/other_user}", "gists_url": "https://api.github.com/users/jmacarthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/jmacarthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jmacarthur/subscriptions", "organizations_url": "https://api.github.com/users/jmacarthur/orgs", "repos_url": "https://api.github.com/users/jmacarthur/repos", "events_url": "https://api.github.com/users/jmacarthur/events{/privacy}", "received_events_url": "https://api.github.com/users/jmacarthur/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eb54b267a168b87d38d6ea89dcb57b355b0d1b35", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb54b267a168b87d38d6ea89dcb57b355b0d1b35", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb54b267a168b87d38d6ea89dcb57b355b0d1b35"}], "stats": {"total": 112, "additions": 107, "deletions": 5}, "files": [{"sha": "289be5b6c81a7090d6dde1a514c9c7cd2ebd4e2b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -1,3 +1,16 @@\n+2019-06-19  Jim MacArthur  <jim.macarthur@codethink.co.uk>\n+\t    Mark Eggleston  <mark.eggleston@codethink.com>\n+\t\n+\tPR fortran/89103\n+\t* gfortran.texi: Add -fdec-blank-format-item\n+\t* invoke.texi: Add option to list of options.\n+\t* invoke.texi: Add to section on Commas in FORMAT specifications.\n+\t* io.c (check_format): At FMT_RPAREN goto finished if\n+\t-fdec-blank-format-item otherwise set error string.\n+\t* lang.opt: Add new option.\n+\t* options.c (set_dec_flags): Add SET_BITFLAG for\n+\tflag_dec_format_defaults.\n+\n 2019-06-18  Julian Brown  <julian@codesourcery.com>\n \n \tPR fortran/90921"}, {"sha": "c887e7d1a4251bf56c6e40dc43f69f0dcadd5bd6", "filename": "gcc/fortran/gfortran.texi", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Fgfortran.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Fgfortran.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.texi?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -1761,11 +1761,16 @@ When omitted, the count is implicitly assumed to be one.\n \n To support legacy codes, GNU Fortran allows the comma separator\n to be omitted immediately before and after character string edit\n-descriptors in @code{FORMAT} statements.\n+descriptors in @code{FORMAT} statements.  A comma with no following format\n+decriptor is permited if the @option{-fdec-blank-format-item} is given on\n+the command line. This is considered non-conforming code and is\n+discouraged.\n \n @smallexample\n        PRINT 10, 2, 3\n 10     FORMAT ('FOO='I1' BAR='I2)\n+       print 20, 5, 6\n+20     FORMAT (I3, I3,)\n @end smallexample\n \n "}, {"sha": "2b08ac4de22fd600f59a8775513e51f00317546f", "filename": "gcc/fortran/invoke.texi", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finvoke.texi?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -119,10 +119,10 @@ by type.  Explanations are in the following sections.\n @gccoptlist{-fall-intrinsics -fbackslash -fcray-pointer -fd-lines-as-code @gol\n -fd-lines-as-comments -fdec -fdec-structure -fdec-intrinsic-ints @gol\n -fdec-static -fdec-math -fdec-include -fdec-format-defaults @gol\n--fdefault-double-8 -fdefault-integer-8 -fdefault-real-8 -fdefault-real-10 @gol\n--fdefault-real-16 -fdollar-ok -ffixed-line-length-@var{n} @gol\n--ffixed-line-length-none -fpad-source -ffree-form @gol\n--ffree-line-length-@var{n} -ffree-line-length-none @gol\n+-fdec-blank-format-item -fdefault-double-8 -fdefault-integer-8 @gol\n+-fdefault-real-8 -fdefault-real-10 -fdefault-real-16 -fdollar-ok @gol\n+-ffixed-line-length-@var{n} -ffixed-line-length-none -fpad-source @gol\n+-ffree-form -ffree-line-length-@var{n} -ffree-line-length-none @gol\n -fimplicit-none -finteger-4-integer-8 -fmax-identifier-length @gol\n -fmodule-private -ffixed-form -fno-range-check -fopenacc -fopenmp @gol\n -freal-4-real-10 -freal-4-real-16 -freal-4-real-8 -freal-8-real-10 @gol\n@@ -289,6 +289,11 @@ be on a single line and can use line continuations.\n Enable format specifiers F, G and I to be used without width specifiers,\n default widths will be used instead.\n \n+@item -fdec-blank-format-item\n+@opindex @code{fdec-blank-format-item}\n+Enable a blank format item at the end of a format specification i.e. nothing\n+following the final comma.\n+\n @item -fdollar-ok\n @opindex @code{fdollar-ok}\n @cindex @code{$}"}, {"sha": "425c2b86899f791233b2f5bc5119b7c7172b2a50", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -762,6 +762,15 @@ check_format (bool is_input)\n       error = unexpected_end;\n       goto syntax;\n \n+    case FMT_RPAREN:\n+      if (flag_dec_blank_format_item)\n+\tgoto finished;\n+      else\n+\t{\n+\t  error = G_(\"Missing item in format string at %L\");\n+\t  goto syntax;\n+\t}\n+\n     default:\n       error = unexpected_element;\n       goto syntax;"}, {"sha": "88674cb5dc7a7aebce3774d8e031a980870a8fdd", "filename": "gcc/fortran/lang.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Flang.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Flang.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Flang.opt?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -444,6 +444,10 @@ fdec\n Fortran Var(flag_dec)\n Enable all DEC language extensions.\n \n+fdec-blank-format-item\n+Fortran Var(flag_dec_blank_format_item)\n+Enable the use of blank format items in format strings.\n+\n fdec-include\n Fortran Var(flag_dec_include)\n Enable legacy parsing of INCLUDE as statement."}, {"sha": "3bc79ef9b45b269c038334ee527095250ff7189c", "filename": "gcc/fortran/options.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Foptions.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ffortran%2Foptions.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Foptions.c?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -75,6 +75,7 @@ set_dec_flags (int value)\n   SET_BITFLAG (flag_dec_math, value, value);\n   SET_BITFLAG (flag_dec_include, value, value);\n   SET_BITFLAG (flag_dec_format_defaults, value, value);\n+  SET_BITFLAG (flag_dec_blank_format_item, value, value);\n }\n \n /* Finalize DEC flags.  */"}, {"sha": "8255d9e37517634000179d6dadb799607a7fa054", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -1,3 +1,11 @@\n+2019-06-19  Jim MacArthur  <jim.macarthur@codethink.co.uk>\n+\t    Mark Eggleston  <mark.eggleston@codethink.com>\n+\n+\tPR fortran/89103\n+\t* gfortran.dg/dec_format_empty_item_1.f: New test.\n+\t* gfortran.dg/dec_format_empty_item_2.f: New test.\n+\t* gfortran.dg/dec_format_empty_item_3.f: New test. \n+\n 2019-06-19  Kugan Vivekanandarajah  <kugan.vivekanandarajah@linaro.org>\n \n \t* gcc.target/aarch64/pr88834.c: Move from here..."}, {"sha": "ed27c18944b8ccd46129d424f02a46db0ee43ca0", "filename": "gcc/testsuite/gfortran.dg/dec_format_empty_item_1.f", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_1.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_1.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_1.f?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! { dg-options \"-fdec\" }\n+!\n+! Test blank/empty format items in format string\n+!\n+! Test case contributed by Jim MacArthur <jim.macarthur@codethink.co.uk>\n+! Modified by Mark Eggleston <mark.eggleston@codethink.com>\n+!\n+        PROGRAM blank_format_items\n+          INTEGER A/0/\n+\n+          OPEN(1, status=\"scratch\")\n+          WRITE(1, 10) 100\n+          REWIND(1)\n+          READ(1, 10) A\n+          IF (a.NE.100) STOP 1\n+          PRINT 10, A\n+10        FORMAT( I5,)\n+        END"}, {"sha": "2793cb16225cd7df019f6c9512fa4e9d50af4b91", "filename": "gcc/testsuite/gfortran.dg/dec_format_empty_item_2.f", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_2.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_2.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_2.f?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! { dg-options \"-fdec-blank-format-item\" }\n+!\n+! Test blank/empty format items in format string\n+!\n+! Test case contributed by Jim MacArthur <jim.macarthur@codethink.co.uk>\n+! Modified by Mark Eggleston <mark.eggleston@codethink.com>\n+!\n+        PROGRAM blank_format_items\n+          INTEGER A/0/\n+\n+          OPEN(1, status=\"scratch\")\n+          WRITE(1, 10) 100\n+          REWIND(1)\n+          READ(1, 10) A\n+          IF (a.NE.100) STOP 1\n+          PRINT 10, A\n+10        FORMAT( I5,)\n+        END"}, {"sha": "dbccd671baeb86052edf2685e38665cfeeb31fd0", "filename": "gcc/testsuite/gfortran.dg/dec_format_empty_item_3.f", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_3.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17f62b7e1fef0a04c738419b0108eeb89f6b7463/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_3.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_format_empty_item_3.f?ref=17f62b7e1fef0a04c738419b0108eeb89f6b7463", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do compile }\n+! { dg-options \"-fdec -fno-dec-blank-format-item\" }\n+!\n+! Test blank/empty format items in format string\n+!\n+! Test case contributed by Jim MacArthur <jim.macarthur@codethink.co.uk>\n+! Modified by Mark Eggleston <mark.eggleston@codethink.com>\n+!\n+        PROGRAM blank_format_items\n+          INTEGER A/0/\n+\n+          OPEN(1, status=\"scratch\")\n+          WRITE(1, 10) 100 ! { dg-error \"FORMAT label 10 at\" }\n+          REWIND(1)\n+          READ(1, 10) A ! { dg-error \"FORMAT label 10 at\" }\n+          IF (a.NE.100) STOP 1\n+          PRINT 10, A ! { dg-error \"FORMAT label 10 at\" }\n+ 10       FORMAT( I5,) ! { dg-error \"Missing item\" }\n+        END"}]}