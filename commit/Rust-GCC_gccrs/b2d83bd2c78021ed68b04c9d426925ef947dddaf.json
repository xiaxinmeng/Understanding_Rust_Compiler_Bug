{"sha": "b2d83bd2c78021ed68b04c9d426925ef947dddaf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjJkODNiZDJjNzgwMjFlZDY4YjA0YzlkNDI2OTI1ZWY5NDdkZGRhZg==", "commit": {"author": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-06-05T17:20:54Z"}, "committer": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-06-05T17:20:54Z"}, "message": "re PR fortran/69659 (ICE on using option -frepack-arrays, in gfc_conv_descriptor_data_get)\n\ngcc/testsuite/ChangeLog:\n\n2016-06-05  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/69659\n\t* gfortran.dg/class_array_22.f03: New test.\n\n\ngcc/fortran/ChangeLog:\n\n2016-06-05  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/69659\n\t* trans-array.c (gfc_trans_dummy_array_bias): For class arrays use\n\tthe address of the _data component to reference the arrays data\n\tcomponent.\n\nFrom-SVN: r237105", "tree": {"sha": "ee59ef2501c0185b00fd3015378c8c282a5e083d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee59ef2501c0185b00fd3015378c8c282a5e083d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b2d83bd2c78021ed68b04c9d426925ef947dddaf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2d83bd2c78021ed68b04c9d426925ef947dddaf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2d83bd2c78021ed68b04c9d426925ef947dddaf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2d83bd2c78021ed68b04c9d426925ef947dddaf/comments", "author": null, "committer": null, "parents": [{"sha": "ec81960e85d5b9957f96dfda3b7c411c3d548f6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec81960e85d5b9957f96dfda3b7c411c3d548f6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec81960e85d5b9957f96dfda3b7c411c3d548f6b"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "e6edc16ff19fca1cf23c8c6df02a30dcc01345dd", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b2d83bd2c78021ed68b04c9d426925ef947dddaf", "patch": "@@ -1,3 +1,10 @@\n+2016-06-05  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/69659\n+\t* trans-array.c (gfc_trans_dummy_array_bias): For class arrays use\n+\tthe address of the _data component to reference the arrays data\n+\tcomponent.\n+\n 2016-06-03  Chung-Lin Tang  <cltang@codesourcery.com>\n \n \t* trans-openmp.c (gfc_trans_omp_reduction_list): Add mark_addressable"}, {"sha": "403ce3a750dd96d56768fe7992388d1e8ccb7ab4", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=b2d83bd2c78021ed68b04c9d426925ef947dddaf", "patch": "@@ -6386,7 +6386,12 @@ gfc_trans_dummy_array_bias (gfc_symbol * sym, tree tmpdesc,\n       stmtCleanup = gfc_finish_block (&cleanup);\n \n       /* Only do the cleanup if the array was repacked.  */\n-      tmp = build_fold_indirect_ref_loc (input_location, dumdesc);\n+      if (is_classarray)\n+\t/* For a class array the dummy array descriptor is in the _class\n+\t   component.  */\n+\ttmp = gfc_class_data_get (dumdesc);\n+      else\n+\ttmp = build_fold_indirect_ref_loc (input_location, dumdesc);\n       tmp = gfc_conv_descriptor_data_get (tmp);\n       tmp = fold_build2_loc (input_location, NE_EXPR, boolean_type_node,\n \t\t\t     tmp, tmpdesc);"}, {"sha": "583a7cf9066031542ac0aa19441b3a206d74eae7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b2d83bd2c78021ed68b04c9d426925ef947dddaf", "patch": "@@ -1,3 +1,8 @@\n+2016-06-05  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/69659\n+\t* gfortran.dg/class_array_22.f03: New test.\n+\n 2016-06-05  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* gcc.dg/tree-prof/peel-1.c: Fix testcase."}, {"sha": "94107419b8427e7528bfd0d9bbaa4c7547369b27", "filename": "gcc/testsuite/gfortran.dg/class_array_22.f03", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_array_22.f03", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2d83bd2c78021ed68b04c9d426925ef947dddaf/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_array_22.f03", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_array_22.f03?ref=b2d83bd2c78021ed68b04c9d426925ef947dddaf", "patch": "@@ -0,0 +1,25 @@\n+! { dg-do compile }\n+! { dg-options \"-frepack-arrays \" }\n+!\n+! Original class_array_11.f03 but with -frepack-arrays a new\n+! ICE was produced reported in\n+! PR fortran/69659\n+!\n+! Original testcase by Ian Harvey <ian_harvey@bigpond.com>\n+! Reduced by Janus Weil <Janus@gcc.gnu.org>\n+\n+  IMPLICIT NONE\n+\n+  TYPE :: ParentVector\n+    INTEGER :: a\n+  END TYPE ParentVector\n+\n+CONTAINS\n+\n+  SUBROUTINE vector_operation(pvec)\n+    CLASS(ParentVector), INTENT(INOUT) :: pvec(:)\n+    print *,pvec(1)%a\n+  END SUBROUTINE\n+\n+END\n+"}]}