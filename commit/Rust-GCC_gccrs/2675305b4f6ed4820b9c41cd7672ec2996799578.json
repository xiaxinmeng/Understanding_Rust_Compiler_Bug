{"sha": "2675305b4f6ed4820b9c41cd7672ec2996799578", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjY3NTMwNWI0ZjZlZDQ4MjBiOWM0MWNkNzY3MmVjMjk5Njc5OTU3OA==", "commit": {"author": {"name": "Yury Gribov", "email": "y.gribov@samsung.com", "date": "2014-05-14T08:33:45Z"}, "committer": {"name": "Yury Gribov", "email": "ygribov@gcc.gnu.org", "date": "2014-05-14T08:33:45Z"}, "message": "re PR sanitizer/61100 (asan/tsan should have the sanitizer includes)\n\n2014-05-14  Yury Gribov  <y.gribov@samsung.com>\n\n\tPR sanitizer/61100\n\t* Makefile.am (nodist_saninclude_HEADERS): Install\n\tpublic headers.\n\t* Makefile.in: Regenerate.\n\n\t* c-c++-common/asan/asan-interface-1.c: New test.\n\t* lib/asan-dg.exp (asan_include_flags): New function.\n\t(asan_init): Call asan_include_flags to obtain path\n\tto sanitizer headers.\n\nFrom-SVN: r210413", "tree": {"sha": "344d97df3e133d20059ec12568ffce31177be3e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/344d97df3e133d20059ec12568ffce31177be3e3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2675305b4f6ed4820b9c41cd7672ec2996799578", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2675305b4f6ed4820b9c41cd7672ec2996799578", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2675305b4f6ed4820b9c41cd7672ec2996799578", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2675305b4f6ed4820b9c41cd7672ec2996799578/comments", "author": null, "committer": null, "parents": [{"sha": "5600d8982ea2d310eb9ebaff2e798b40ed570260", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5600d8982ea2d310eb9ebaff2e798b40ed570260", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5600d8982ea2d310eb9ebaff2e798b40ed570260"}], "stats": {"total": 124, "additions": 103, "deletions": 21}, "files": [{"sha": "2e49912561e93f57b7cf1120c61e2c9682049a02", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2675305b4f6ed4820b9c41cd7672ec2996799578/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2675305b4f6ed4820b9c41cd7672ec2996799578/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2675305b4f6ed4820b9c41cd7672ec2996799578", "patch": "@@ -1,3 +1,11 @@\n+2014-05-14  Yury Gribov  <y.gribov@samsung.com>\n+\n+\tPR sanitizer/61100\n+\t* c-c++-common/asan/asan-interface-1.c: New test.\n+\t* lib/asan-dg.exp (asan_include_flags): New function.\n+\t(asan_init): Call asan_include_flags to obtain path\n+\tto sanitizer headers.\n+\n 2014-05-13  Peter Bergner  <bergner@vnet.ibm.com>\n \n \t* lib/target-support.exp (check_dfp_hw_available): New function."}, {"sha": "33ed1b0e84591c32f8ad1180dd4d678ac1d47fb6", "filename": "gcc/testsuite/c-c++-common/asan/asan-interface-1.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2675305b4f6ed4820b9c41cd7672ec2996799578/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fasan-interface-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2675305b4f6ed4820b9c41cd7672ec2996799578/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fasan-interface-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fasan-interface-1.c?ref=2675305b4f6ed4820b9c41cd7672ec2996799578", "patch": "@@ -0,0 +1,13 @@\n+/* Check that interface headers work. */\n+\n+/* { dg-do run { target { *-*-linux* } } } */\n+\n+#include <sanitizer/asan_interface.h>\n+\n+int main() {\n+  char tmp;\n+  if (__asan_address_is_poisoned((volatile char *)&tmp + 1))\n+    return 0;\n+  return 1;\n+}\n+"}, {"sha": "7a12160bb19cf4a68b1107619f8f76046bd78b79", "filename": "gcc/testsuite/lib/asan-dg.exp", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2675305b4f6ed4820b9c41cd7672ec2996799578/gcc%2Ftestsuite%2Flib%2Fasan-dg.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2675305b4f6ed4820b9c41cd7672ec2996799578/gcc%2Ftestsuite%2Flib%2Fasan-dg.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fasan-dg.exp?ref=2675305b4f6ed4820b9c41cd7672ec2996799578", "patch": "@@ -23,6 +23,21 @@ proc check_effective_target_faddress_sanitizer {} {\n     } \"-fsanitize=address\"]\n }\n \n+proc asan_include_flags {} {\n+    global srcdir\n+    global TESTING_IN_BUILD_TREE\n+\n+    set flags \"\"\n+\n+    if { [is_remote host] || ! [info exists TESTING_IN_BUILD_TREE] } {\n+      return \"${flags}\"\n+    }\n+\n+    set flags \"-I$srcdir/../../libsanitizer/include\"\n+\n+    return \"$flags\"\n+}\n+\n #\n # asan_link_flags -- compute library path and flags to find libasan.\n # (originally from g++.exp)\n@@ -80,17 +95,19 @@ proc asan_init { args } {\n \t}\n     }\n \n+    set include_flags \"[asan_include_flags]\"\n+\n     if [info exists TEST_ALWAYS_FLAGS] {\n \tset asan_saved_TEST_ALWAYS_FLAGS $TEST_ALWAYS_FLAGS\n     }\n     if [info exists ALWAYS_CXXFLAGS] {\n \tset ALWAYS_CXXFLAGS [concat \"{ldflags=$link_flags}\" $ALWAYS_CXXFLAGS]\n-\tset ALWAYS_CXXFLAGS [concat \"{additional_flags=-fsanitize=address -g}\" $ALWAYS_CXXFLAGS]\n+\tset ALWAYS_CXXFLAGS [concat \"{additional_flags=-fsanitize=address -g $include_flags}\" $ALWAYS_CXXFLAGS]\n     } else {\n \tif [info exists TEST_ALWAYS_FLAGS] {\n-\t    set TEST_ALWAYS_FLAGS \"$link_flags -fsanitize=address -g $TEST_ALWAYS_FLAGS\"\n+\t    set TEST_ALWAYS_FLAGS \"$link_flags -fsanitize=address -g $include_flags $TEST_ALWAYS_FLAGS\"\n \t} else {\n-\t    set TEST_ALWAYS_FLAGS \"$link_flags -fsanitize=address -g\"\n+\t    set TEST_ALWAYS_FLAGS \"$link_flags -fsanitize=address -g $include_flags\"\n \t}\n     }\n     if { $link_flags != \"\" } {"}, {"sha": "319f93226900df8e8b85bc00ef7ecb5c40f45779", "filename": "libsanitizer/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2675305b4f6ed4820b9c41cd7672ec2996799578/libsanitizer%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2675305b4f6ed4820b9c41cd7672ec2996799578/libsanitizer%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2FChangeLog?ref=2675305b4f6ed4820b9c41cd7672ec2996799578", "patch": "@@ -1,3 +1,10 @@\n+2014-05-14  Yury Gribov  <y.gribov@samsung.com>\n+\n+\tPR sanitizer/61100\n+\t* Makefile.am (nodist_saninclude_HEADERS): Install\n+\tpublic headers.\n+\t* Makefile.in: Regenerate.\n+\n 2014-03-07  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* libbacktrace/Makefile.am (libsanitizer_libbacktrace_la_SOURCES):"}, {"sha": "6b0c571c46efabde39d74e2efc2ce978c8087a18", "filename": "libsanitizer/Makefile.am", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2675305b4f6ed4820b9c41cd7672ec2996799578/libsanitizer%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2675305b4f6ed4820b9c41cd7672ec2996799578/libsanitizer%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2FMakefile.am?ref=2675305b4f6ed4820b9c41cd7672ec2996799578", "patch": "@@ -1,14 +1,23 @@\n ACLOCAL_AMFLAGS = -I .. -I ../config\n \n+sanincludedir = $(libdir)/gcc/$(target_alias)/$(gcc_version)/include/sanitizer\n+\n+nodist_saninclude_HEADERS =\n+\n if SANITIZER_SUPPORTED\n SUBDIRS = sanitizer_common\n+nodist_saninclude_HEADERS += \\\n+  include/sanitizer/common_interface_defs.h\n if !USING_MAC_INTERPOSE\n SUBDIRS += interception\n endif\n if LIBBACKTRACE_SUPPORTED\n SUBDIRS += libbacktrace\n endif\n SUBDIRS += lsan asan ubsan\n+nodist_saninclude_HEADERS += \\\n+  include/sanitizer/lsan_interface.h \\\n+  include/sanitizer/asan_interface.h\n if TSAN_SUPPORTED\n SUBDIRS += tsan\n endif"}, {"sha": "0b8924554dc5bced290af37bafeeb27e62344e16", "filename": "libsanitizer/Makefile.in", "status": "modified", "additions": 46, "deletions": 18, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2675305b4f6ed4820b9c41cd7672ec2996799578/libsanitizer%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2675305b4f6ed4820b9c41cd7672ec2996799578/libsanitizer%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libsanitizer%2FMakefile.in?ref=2675305b4f6ed4820b9c41cd7672ec2996799578", "patch": "@@ -35,9 +35,12 @@ POST_UNINSTALL = :\n build_triplet = @build@\n host_triplet = @host@\n target_triplet = @target@\n-@SANITIZER_SUPPORTED_TRUE@@USING_MAC_INTERPOSE_FALSE@am__append_1 = interception\n-@LIBBACKTRACE_SUPPORTED_TRUE@@SANITIZER_SUPPORTED_TRUE@am__append_2 = libbacktrace\n-@SANITIZER_SUPPORTED_TRUE@@TSAN_SUPPORTED_TRUE@am__append_3 = tsan\n+@SANITIZER_SUPPORTED_TRUE@am__append_1 = include/sanitizer/common_interface_defs.h \\\n+@SANITIZER_SUPPORTED_TRUE@\tinclude/sanitizer/lsan_interface.h \\\n+@SANITIZER_SUPPORTED_TRUE@\tinclude/sanitizer/asan_interface.h\n+@SANITIZER_SUPPORTED_TRUE@@USING_MAC_INTERPOSE_FALSE@am__append_2 = interception\n+@LIBBACKTRACE_SUPPORTED_TRUE@@SANITIZER_SUPPORTED_TRUE@am__append_3 = libbacktrace\n+@SANITIZER_SUPPORTED_TRUE@@TSAN_SUPPORTED_TRUE@am__append_4 = tsan\n subdir = .\n DIST_COMMON = ChangeLog $(srcdir)/Makefile.in $(srcdir)/Makefile.am \\\n \t$(top_srcdir)/configure $(am__configure_deps) \\\n@@ -98,8 +101,9 @@ am__nobase_list = $(am__nobase_strip_setup); \\\n am__base_list = \\\n   sed '$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;$$!N;s/\\n/ /g' | \\\n   sed '$$!N;$$!N;$$!N;$$!N;s/\\n/ /g'\n-am__installdirs = \"$(DESTDIR)$(toolexeclibdir)\"\n-HEADERS = $(nodist_toolexeclib_HEADERS)\n+am__installdirs = \"$(DESTDIR)$(sanincludedir)\" \\\n+\t\"$(DESTDIR)$(toolexeclibdir)\"\n+HEADERS = $(nodist_saninclude_HEADERS) $(nodist_toolexeclib_HEADERS)\n RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive\t\\\n   distclean-recursive maintainer-clean-recursive\n AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \\\n@@ -250,9 +254,11 @@ top_build_prefix = @top_build_prefix@\n top_builddir = @top_builddir@\n top_srcdir = @top_srcdir@\n ACLOCAL_AMFLAGS = -I .. -I ../config\n-@SANITIZER_SUPPORTED_TRUE@SUBDIRS = sanitizer_common $(am__append_1) \\\n-@SANITIZER_SUPPORTED_TRUE@\t$(am__append_2) lsan asan ubsan \\\n-@SANITIZER_SUPPORTED_TRUE@\t$(am__append_3)\n+sanincludedir = $(libdir)/gcc/$(target_alias)/$(gcc_version)/include/sanitizer\n+nodist_saninclude_HEADERS = $(am__append_1)\n+@SANITIZER_SUPPORTED_TRUE@SUBDIRS = sanitizer_common $(am__append_2) \\\n+@SANITIZER_SUPPORTED_TRUE@\t$(am__append_3) lsan asan ubsan \\\n+@SANITIZER_SUPPORTED_TRUE@\t$(am__append_4)\n gcc_version := $(shell cat $(top_srcdir)/../gcc/BASE-VER)\n \n # Work around what appears to be a GNU make bug handling MAKEFLAGS\n@@ -378,6 +384,26 @@ distclean-multi:\n \t$(MULTICLEAN) $(AM_MAKEFLAGS) DO=distclean multi-clean # $(MAKE)\n maintainer-clean-multi:\n \t$(MULTICLEAN) $(AM_MAKEFLAGS) DO=maintainer-clean multi-clean # $(MAKE)\n+install-nodist_sanincludeHEADERS: $(nodist_saninclude_HEADERS)\n+\t@$(NORMAL_INSTALL)\n+\ttest -z \"$(sanincludedir)\" || $(MKDIR_P) \"$(DESTDIR)$(sanincludedir)\"\n+\t@list='$(nodist_saninclude_HEADERS)'; test -n \"$(sanincludedir)\" || list=; \\\n+\tfor p in $$list; do \\\n+\t  if test -f \"$$p\"; then d=; else d=\"$(srcdir)/\"; fi; \\\n+\t  echo \"$$d$$p\"; \\\n+\tdone | $(am__base_list) | \\\n+\twhile read files; do \\\n+\t  echo \" $(INSTALL_HEADER) $$files '$(DESTDIR)$(sanincludedir)'\"; \\\n+\t  $(INSTALL_HEADER) $$files \"$(DESTDIR)$(sanincludedir)\" || exit $$?; \\\n+\tdone\n+\n+uninstall-nodist_sanincludeHEADERS:\n+\t@$(NORMAL_UNINSTALL)\n+\t@list='$(nodist_saninclude_HEADERS)'; test -n \"$(sanincludedir)\" || list=; \\\n+\tfiles=`for p in $$list; do echo $$p; done | sed -e 's|^.*/||'`; \\\n+\ttest -n \"$$files\" || exit 0; \\\n+\techo \" ( cd '$(DESTDIR)$(sanincludedir)' && rm -f\" $$files \")\"; \\\n+\tcd \"$(DESTDIR)$(sanincludedir)\" && rm -f $$files\n install-nodist_toolexeclibHEADERS: $(nodist_toolexeclib_HEADERS)\n \t@$(NORMAL_INSTALL)\n \ttest -z \"$(toolexeclibdir)\" || $(MKDIR_P) \"$(DESTDIR)$(toolexeclibdir)\"\n@@ -538,7 +564,7 @@ check: check-recursive\n all-am: Makefile all-multi $(HEADERS) config.h\n installdirs: installdirs-recursive\n installdirs-am:\n-\tfor dir in \"$(DESTDIR)$(toolexeclibdir)\"; do \\\n+\tfor dir in \"$(DESTDIR)$(sanincludedir)\" \"$(DESTDIR)$(toolexeclibdir)\"; do \\\n \t  test -z \"$$dir\" || $(MKDIR_P) \"$$dir\"; \\\n \tdone\n install: install-recursive\n@@ -588,7 +614,7 @@ info: info-recursive\n \n info-am:\n \n-install-data-am:\n+install-data-am: install-nodist_sanincludeHEADERS\n \n install-dvi: install-dvi-recursive\n \n@@ -634,7 +660,8 @@ ps: ps-recursive\n \n ps-am:\n \n-uninstall-am: uninstall-nodist_toolexeclibHEADERS\n+uninstall-am: uninstall-nodist_sanincludeHEADERS \\\n+\tuninstall-nodist_toolexeclibHEADERS\n \n .MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) all all-multi \\\n \tclean-multi ctags-recursive distclean-multi install-am \\\n@@ -649,13 +676,14 @@ uninstall-am: uninstall-nodist_toolexeclibHEADERS\n \tinfo-am install install-am install-data install-data-am \\\n \tinstall-dvi install-dvi-am install-exec install-exec-am \\\n \tinstall-html install-html-am install-info install-info-am \\\n-\tinstall-man install-multi install-nodist_toolexeclibHEADERS \\\n-\tinstall-pdf install-pdf-am install-ps install-ps-am \\\n-\tinstall-strip installcheck installcheck-am installdirs \\\n-\tinstalldirs-am maintainer-clean maintainer-clean-generic \\\n-\tmaintainer-clean-multi mostlyclean mostlyclean-generic \\\n-\tmostlyclean-libtool mostlyclean-multi pdf pdf-am ps ps-am tags \\\n-\ttags-recursive uninstall uninstall-am \\\n+\tinstall-man install-multi install-nodist_sanincludeHEADERS \\\n+\tinstall-nodist_toolexeclibHEADERS install-pdf install-pdf-am \\\n+\tinstall-ps install-ps-am install-strip installcheck \\\n+\tinstallcheck-am installdirs installdirs-am maintainer-clean \\\n+\tmaintainer-clean-generic maintainer-clean-multi mostlyclean \\\n+\tmostlyclean-generic mostlyclean-libtool mostlyclean-multi pdf \\\n+\tpdf-am ps ps-am tags tags-recursive uninstall uninstall-am \\\n+\tuninstall-nodist_sanincludeHEADERS \\\n \tuninstall-nodist_toolexeclibHEADERS\n \n "}]}