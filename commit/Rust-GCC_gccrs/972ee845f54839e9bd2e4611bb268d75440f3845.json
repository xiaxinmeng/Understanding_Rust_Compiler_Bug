{"sha": "972ee845f54839e9bd2e4611bb268d75440f3845", "node_id": "C_kwDOANBUbNoAKDk3MmVlODQ1ZjU0ODM5ZTliZDJlNDYxMWJiMjY4ZDc1NDQwZjM4NDU", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2021-10-20T08:42:56Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2021-10-20T08:46:37Z"}, "message": "Fix PR middle-end/102764\n\nThis is a regression present on the mainline in the form of -fcompare-debug\nfailure at -O3 on a compiler-generated testcase.  Fixed by disregarding a\ndebug statement in the last position of a basic block to reset the current\nlocation for the outgoing edges.\n\ngcc/\n\tPR middle-end/102764\n\t* cfgexpand.c (expand_gimple_basic_block): Disregard a final debug\n\tstatement to reset the current location for the outgoing edges.\n\ngcc/testsuite/\n\t* gcc.dg/pr102764.c: New test.", "tree": {"sha": "e9ceceb581e4026a5ccf1b447806da911667d97d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e9ceceb581e4026a5ccf1b447806da911667d97d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/972ee845f54839e9bd2e4611bb268d75440f3845", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/972ee845f54839e9bd2e4611bb268d75440f3845", "html_url": "https://github.com/Rust-GCC/gccrs/commit/972ee845f54839e9bd2e4611bb268d75440f3845", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/972ee845f54839e9bd2e4611bb268d75440f3845/comments", "author": null, "committer": null, "parents": [{"sha": "8fe93cc664ded8cc1952da28b23f3fc68504a73e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fe93cc664ded8cc1952da28b23f3fc68504a73e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8fe93cc664ded8cc1952da28b23f3fc68504a73e"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "8b067f9d84871e77c16a878e35d85db68b9c581b", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/972ee845f54839e9bd2e4611bb268d75440f3845/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/972ee845f54839e9bd2e4611bb268d75440f3845/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=972ee845f54839e9bd2e4611bb268d75440f3845", "patch": "@@ -6090,7 +6090,7 @@ expand_gimple_basic_block (basic_block bb, bool disable_tail_calls)\n   /* Expand implicit goto and convert goto_locus.  */\n   FOR_EACH_EDGE (e, ei, bb->succs)\n     {\n-      if (e->goto_locus != UNKNOWN_LOCATION || !stmt)\n+      if (e->goto_locus != UNKNOWN_LOCATION || !stmt || is_gimple_debug (stmt))\n \tset_curr_insn_location (e->goto_locus);\n       if ((e->flags & EDGE_FALLTHRU) && e->dest != bb->next_bb)\n \t{"}, {"sha": "ea1c634c73c7be2320f85f52b15762b6b2ace44e", "filename": "gcc/testsuite/gcc.dg/pr102764.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/972ee845f54839e9bd2e4611bb268d75440f3845/gcc%2Ftestsuite%2Fgcc.dg%2Fpr102764.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/972ee845f54839e9bd2e4611bb268d75440f3845/gcc%2Ftestsuite%2Fgcc.dg%2Fpr102764.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr102764.c?ref=972ee845f54839e9bd2e4611bb268d75440f3845", "patch": "@@ -0,0 +1,14 @@\n+/* PR middle-end/102764 */\n+/* Reported by Chengnian Sun <cnsun@uwaterloo.ca> */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fcompare-debug\" } */\n+\n+volatile int a;\n+\n+void main (void)\n+{\n+  for (int i = 0; i < 1000; i++)\n+    if (i % 17)\n+      a++;\n+}"}]}