{"sha": "7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2MwZGU2YTU0NGJhNWQyOTNlYWIxZjkxYjcwZTAxN2VmNWQ1ODM0Zg==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@apple.com", "date": "2006-07-13T06:16:59Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2006-07-13T06:16:59Z"}, "message": "Index: ChangeLog\n2006-07-12  Geoffrey Keating  <geoffk@apple.com>\n\n\t* doc/invoke.texi (C++ Dialect Options): Explain difference\n\tbetween -fvisibility-inlines-hidden and setting hidden\n\tvisibility explicitly.\n\nIndex: cp/ChangeLog\n2006-07-12  Geoffrey Keating  <geoffk@apple.com>\n\n\t* decl2.c (determine_visibility): Don't change visibility of\n\tfunction locals because of -fvisibility-inlines-hidden.\n\nIndex: testsuite/ChangeLog\n2006-07-12  Geoffrey Keating  <geoffk@apple.com>\n\n\t* g++.dg/ext/visibility/fvisibility-inlines-hidden-2.C: New.\n\nFrom-SVN: r115411", "tree": {"sha": "d0cf7502eabafc2262e5a615fdbd20410a69b531", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d0cf7502eabafc2262e5a615fdbd20410a69b531"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/comments", "author": {"login": "geoffk01", "id": 31905243, "node_id": "MDQ6VXNlcjMxOTA1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/31905243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffk01", "html_url": "https://github.com/geoffk01", "followers_url": "https://api.github.com/users/geoffk01/followers", "following_url": "https://api.github.com/users/geoffk01/following{/other_user}", "gists_url": "https://api.github.com/users/geoffk01/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffk01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffk01/subscriptions", "organizations_url": "https://api.github.com/users/geoffk01/orgs", "repos_url": "https://api.github.com/users/geoffk01/repos", "events_url": "https://api.github.com/users/geoffk01/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffk01/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "72af9f0b517b8dec055f72bf2ba7bfcb2e8da99b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72af9f0b517b8dec055f72bf2ba7bfcb2e8da99b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72af9f0b517b8dec055f72bf2ba7bfcb2e8da99b"}], "stats": {"total": 58, "additions": 52, "deletions": 6}, "files": [{"sha": "9e907dd364769d29a1a3434a465cfb46ef67b0eb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "patch": "@@ -1,3 +1,9 @@\n+2006-07-12  Geoffrey Keating  <geoffk@apple.com>\n+\n+\t* doc/invoke.texi (C++ Dialect Options): Explain difference\n+\tbetween -fvisibility-inlines-hidden and setting hidden\n+\tvisibility explicitly.\n+\n 2006-07-12  Eric Christopher  <echristo@apple.com>\n \n \t* config/t-slibgcc-darwin (SHLIB_LINK): Don't munge stmp-lipo."}, {"sha": "de1f4f117a7d3e62b0ffda45617debe233738919", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "patch": "@@ -1,3 +1,8 @@\n+2006-07-12  Geoffrey Keating  <geoffk@apple.com>\n+\n+\t* decl2.c (determine_visibility): Don't change visibility of\n+\tfunction locals because of -fvisibility-inlines-hidden.\n+\n 2006-07-12  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/28217"}, {"sha": "3a78c40c22364acd2358edff62aabe8bbc187968", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "patch": "@@ -1712,13 +1712,20 @@ determine_visibility (tree decl)\n       gcc_assert (TREE_CODE (decl) != VAR_DECL\n \t\t  || !DECL_VTABLE_OR_VTT_P (decl));\n \n-      if (DECL_FUNCTION_SCOPE_P (decl))\n+      if (DECL_FUNCTION_SCOPE_P (decl) && ! DECL_VISIBILITY_SPECIFIED (decl))\n \t{\n \t  /* Local statics and classes get the visibility of their\n-\t     containing function.  */\n+\t     containing function by default, except that\n+\t     -fvisibility-inlines-hidden doesn't affect them.  */\n \t  tree fn = DECL_CONTEXT (decl);\n-\t  DECL_VISIBILITY (decl) = DECL_VISIBILITY (fn);\n-\t  DECL_VISIBILITY_SPECIFIED (decl) = DECL_VISIBILITY_SPECIFIED (fn);\n+\t  if (DECL_VISIBILITY_SPECIFIED (fn) || ! DECL_CLASS_SCOPE_P (fn))\n+\t    {\n+\t      DECL_VISIBILITY (decl) = DECL_VISIBILITY (fn);\n+\t      DECL_VISIBILITY_SPECIFIED (decl) = \n+\t\tDECL_VISIBILITY_SPECIFIED (fn);\n+\t    }\n+\t  else\n+\t    determine_visibility_from_class (decl, DECL_CONTEXT (fn));\n \n \t  /* Local classes in templates have CLASSTYPE_USE_TEMPLATE set,\n \t     but have no TEMPLATE_INFO, so don't try to check it.  */"}, {"sha": "0a1a917d9145d4ec8c90ea9e4e9cad0c5a8e8eed", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "patch": "@@ -1618,10 +1618,15 @@ when used within the DSO@.  Enabling this option can have a dramatic effect\n on load and link times of a DSO as it massively reduces the size of the\n dynamic export table when the library makes heavy use of templates.\n \n+The behaviour of this switch is not quite the same as marking the\n+methods as hidden directly, because it does not affect static variables\n+local to the function or cause the compiler to deduce that\n+the function is defined in only one shared object.\n+\n You may mark a method as having a visibility explicitly to negate the\n effect of the switch for that method.  For example, if you do want to\n-compare pointers to a particular inline method, or the method has\n-local static data, you might mark it as having default visibility.\n+compare pointers to a particular inline method, you might mark it as\n+having default visibility.\n \n @item -fno-weak\n @opindex fno-weak"}, {"sha": "15484111c2d1751de172c19d71563ad9fa8e1a26", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "patch": "@@ -1,3 +1,7 @@\n+2006-07-12  Geoffrey Keating  <geoffk@apple.com>\n+\n+\t* g++.dg/ext/visibility/fvisibility-inlines-hidden-2.C: New.\n+\n 2006-07-13  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/25097"}, {"sha": "ed38ebefe9dde2cc0993a76b773bbb34e1611124", "filename": "gcc/testsuite/g++.dg/ext/visibility/fvisibility-inlines-hidden-2.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Ffvisibility-inlines-hidden-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de6a544ba5d293eab1f91b70e017ef5d5834f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Ffvisibility-inlines-hidden-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Ffvisibility-inlines-hidden-2.C?ref=7c0de6a544ba5d293eab1f91b70e017ef5d5834f", "patch": "@@ -0,0 +1,19 @@\n+/* Test that -fvisibility-inlines-hidden doesn't affect static variables. */\n+/* { dg-do compile } */\n+/* { dg-require-visibility \"\" } */\n+/* { dg-options \"-fvisibility-inlines-hidden\" } */\n+/* { dg-final { scan-not-hidden \"_ZZN3foo7my_funcEvE1x\" } } */\n+\n+struct foo \n+{\n+  int my_func() {\n+    static int x;\n+    return x++;\n+  }\n+};\n+\n+int t() \n+{\n+  foo f;\n+  return f.my_func();\n+}"}]}