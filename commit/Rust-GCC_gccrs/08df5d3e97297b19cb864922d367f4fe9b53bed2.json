{"sha": "08df5d3e97297b19cb864922d367f4fe9b53bed2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDhkZjVkM2U5NzI5N2IxOWNiODY0OTIyZDM2N2Y0ZmU5YjUzYmVkMg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2008-07-28T23:28:16Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2008-07-28T23:28:16Z"}, "message": "re PR libstdc++/36949 ([C++0x] make_shared does not initialize enable_shared_from_this' internal shared_count)\n\n2008-07-28  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR libstdc++/36949\n\t* include/tr1_impl/boost_shared_ptr.h\n\t(__shared_ptr(_Sp_make_shared_tag, _Alloc, _Args&&...): Call\n\t__enable_shared_from_this_helper.\n\t* testsuite/20_util/shared_ptr/creation/36949.cc: New.\n\nFrom-SVN: r138219", "tree": {"sha": "20cc65da4d739c33baa9749eba0954a635aa7c36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/20cc65da4d739c33baa9749eba0954a635aa7c36"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/08df5d3e97297b19cb864922d367f4fe9b53bed2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08df5d3e97297b19cb864922d367f4fe9b53bed2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08df5d3e97297b19cb864922d367f4fe9b53bed2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08df5d3e97297b19cb864922d367f4fe9b53bed2/comments", "author": null, "committer": null, "parents": [{"sha": "4d2ad64c5bc72eb10fc6fa28950d38a36cff1d29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d2ad64c5bc72eb10fc6fa28950d38a36cff1d29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d2ad64c5bc72eb10fc6fa28950d38a36cff1d29"}], "stats": {"total": 52, "additions": 48, "deletions": 4}, "files": [{"sha": "25f0d56f8644819dc5c7a38c543a1d8be4350c85", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08df5d3e97297b19cb864922d367f4fe9b53bed2/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08df5d3e97297b19cb864922d367f4fe9b53bed2/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=08df5d3e97297b19cb864922d367f4fe9b53bed2", "patch": "@@ -1,3 +1,11 @@\n+2008-07-28  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR libstdc++/36949\n+\t* include/tr1_impl/boost_shared_ptr.h\n+\t(__shared_ptr(_Sp_make_shared_tag, _Alloc, _Args&&...): Call\n+\t__enable_shared_from_this_helper.\n+\t* testsuite/20_util/shared_ptr/creation/36949.cc: New.\n+\n 2008-07-24  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR libstdc++/36924"}, {"sha": "5da40516bd6d9282a354dfbe857b24924cfa456b", "filename": "libstdc++-v3/include/tr1_impl/boost_shared_ptr.h", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08df5d3e97297b19cb864922d367f4fe9b53bed2/libstdc%2B%2B-v3%2Finclude%2Ftr1_impl%2Fboost_shared_ptr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08df5d3e97297b19cb864922d367f4fe9b53bed2/libstdc%2B%2B-v3%2Finclude%2Ftr1_impl%2Fboost_shared_ptr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Ftr1_impl%2Fboost_shared_ptr.h?ref=08df5d3e97297b19cb864922d367f4fe9b53bed2", "patch": "@@ -1,6 +1,6 @@\n // <tr1_impl/boost_shared_ptr.h> -*- C++ -*-\n \n-// Copyright (C) 2007 Free Software Foundation, Inc.\n+// Copyright (C) 2007, 2008 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -505,13 +505,14 @@ _GLIBCXX_BEGIN_NAMESPACE_TR1\n       // This constructor is non-standard, it is used by allocate_shared.\n       template<typename _Alloc, typename... _Args>\n         __shared_ptr(_Sp_make_shared_tag __tag, _Alloc __a, _Args&&... __args)\n-        : _M_ptr()\n-        , _M_refcount(__tag, (_Tp*)0, __a, std::forward<_Args>(__args)...)\n+        : _M_ptr(), _M_refcount(__tag, (_Tp*)0, __a,\n+\t\t\t\tstd::forward<_Args>(__args)...)\n         {\n           // _M_ptr needs to point to the newly constructed object.\n           // This relies on _Sp_counted_ptr_inplace::_M_get_deleter.\n-          void * __p = _M_refcount._M_get_deleter(typeid(__tag));\n+          void* __p = _M_refcount._M_get_deleter(typeid(__tag));\n           _M_ptr = static_cast<_Tp*>(__p);\n+\t  __enable_shared_from_this_helper(_M_refcount, _M_ptr, _M_ptr);\n         }\n \n       template<typename _Tp1, _Lock_policy _Lp1, typename _Alloc,"}, {"sha": "4fc7db3a610f17dc27ee59fee3677fa84853d2d2", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/creation/36949.cc", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08df5d3e97297b19cb864922d367f4fe9b53bed2/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcreation%2F36949.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08df5d3e97297b19cb864922d367f4fe9b53bed2/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcreation%2F36949.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fcreation%2F36949.cc?ref=08df5d3e97297b19cb864922d367f4fe9b53bed2", "patch": "@@ -0,0 +1,35 @@\n+// { dg-options \"-std=gnu++0x\" }\n+\n+// Copyright (C) 2008 Free Software Foundation\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 2, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING.  If not, write to the Free\n+// Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301,\n+// USA.\n+\n+#include <memory>\n+\n+struct A : std::enable_shared_from_this<A> { };\n+\n+// libstdc++/36949\n+void test01()\n+{\n+  std::make_shared<A>()->shared_from_this();\n+}\n+\n+int main()\n+{\n+  test01();\n+  return 0;\n+}"}]}