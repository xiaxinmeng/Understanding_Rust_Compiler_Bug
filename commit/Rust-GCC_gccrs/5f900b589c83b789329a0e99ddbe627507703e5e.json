{"sha": "5f900b589c83b789329a0e99ddbe627507703e5e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWY5MDBiNTg5YzgzYjc4OTMyOWEwZTk5ZGRiZTYyNzUwNzcwM2U1ZQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2021-03-11T16:00:04Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-06-17T14:32:15Z"}, "message": "[Ada] Missing finalization on nested expression with action\n\ngcc/ada/\n\n\t* exp_ch4.adb (Expand_N_Expression_With_Actions.Process_Action):\n\tDo not abandon processing on a nested N_Expression_With_Actions\n\tor N_Loop_Statement, otherwise we may miss some transient\n\tdeclarations.", "tree": {"sha": "68a3673a891716785d1a7fd0a0907ba2e38e0a81", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/68a3673a891716785d1a7fd0a0907ba2e38e0a81"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5f900b589c83b789329a0e99ddbe627507703e5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f900b589c83b789329a0e99ddbe627507703e5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f900b589c83b789329a0e99ddbe627507703e5e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f900b589c83b789329a0e99ddbe627507703e5e/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b4d46ee9a15b83552134476e9c0f691df1bfa123", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b4d46ee9a15b83552134476e9c0f691df1bfa123", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b4d46ee9a15b83552134476e9c0f691df1bfa123"}], "stats": {"total": 15, "additions": 7, "deletions": 8}, "files": [{"sha": "4436557b354c78fdeda03b9d78164884ef966fc1", "filename": "gcc/ada/exp_ch4.adb", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5f900b589c83b789329a0e99ddbe627507703e5e/gcc%2Fada%2Fexp_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5f900b589c83b789329a0e99ddbe627507703e5e/gcc%2Fada%2Fexp_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch4.adb?ref=5f900b589c83b789329a0e99ddbe627507703e5e", "patch": "@@ -5780,15 +5780,14 @@ package body Exp_Ch4 is\n \n          --  Avoid processing temporary function results multiple times when\n          --  dealing with nested expression_with_actions.\n+         --  Similarly, do not process temporary function results in loops.\n+         --  This is done by Expand_N_Loop_Statement and Build_Finalizer.\n+         --  Note that we used to wrongly return Abandon instead of Skip here:\n+         --  this is wrong since it means that we were ignoring lots of\n+         --  relevant subsequent statements.\n \n-         elsif Nkind (Act) = N_Expression_With_Actions then\n-            return Abandon;\n-\n-         --  Do not process temporary function results in loops. This is done\n-         --  by Expand_N_Loop_Statement and Build_Finalizer.\n-\n-         elsif Nkind (Act) = N_Loop_Statement then\n-            return Abandon;\n+         elsif Nkind (Act) in N_Expression_With_Actions | N_Loop_Statement then\n+            return Skip;\n          end if;\n \n          return OK;"}]}