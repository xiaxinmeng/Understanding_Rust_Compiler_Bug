{"sha": "e299a383a9334fe71492e54ccfa9888434d69d05", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTI5OWEzODNhOTMzNGZlNzE0OTJlNTRjY2ZhOTg4ODQzNGQ2OWQwNQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2013-05-15T19:16:34Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2013-05-15T19:16:34Z"}, "message": "re PR target/57260 (Generated R_MIPS_GOT_MIPS relocation for direct function call while compiling with -O2 on MIPS N64)\n\ngcc/\n\tPR target/57260\n\t* config/mips/mips.c (mips_function_ok_for_sibcall): Don't allow\n\tsibling calls to functions that would normally be lazily bound,\n\tunless $gp is call-clobbered.\n\ngcc/testsuite/\n\tPR target/57260\n\t* gcc.target/mips/call-1.c: Restrict to o32.\n\t* gcc.target/mips/call-5.c, gcc.target/mips/call-6.c: New test.\n\nFrom-SVN: r198945", "tree": {"sha": "3d392484a1d49b2407852da42793dd5b4ea7c9d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d392484a1d49b2407852da42793dd5b4ea7c9d9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e299a383a9334fe71492e54ccfa9888434d69d05", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e299a383a9334fe71492e54ccfa9888434d69d05", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e299a383a9334fe71492e54ccfa9888434d69d05", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e299a383a9334fe71492e54ccfa9888434d69d05/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1e6cf26ea81901fb00daef06d74966bcacbd99eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e6cf26ea81901fb00daef06d74966bcacbd99eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e6cf26ea81901fb00daef06d74966bcacbd99eb"}], "stats": {"total": 141, "additions": 140, "deletions": 1}, "files": [{"sha": "425e3d2e5b6b0467d1dbc014077fac82c9f41896", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e299a383a9334fe71492e54ccfa9888434d69d05", "patch": "@@ -1,3 +1,10 @@\n+2013-05-15  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\tPR target/57260\n+\t* config/mips/mips.c (mips_function_ok_for_sibcall): Don't allow\n+\tsibling calls to functions that would normally be lazily bound,\n+\tunless $gp is call-clobbered.\n+\n 2013-05-15  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* config/i386/i386.c (iy86_option_override_internal): Update"}, {"sha": "066e7a1b1386032d08b12904c24f9a0d1f441e12", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=e299a383a9334fe71492e54ccfa9888434d69d05", "patch": "@@ -6995,6 +6995,15 @@ mips_function_ok_for_sibcall (tree decl, tree exp ATTRIBUTE_UNUSED)\n       && mips_call_may_need_jalx_p (decl))\n     return false;\n \n+  /* Sibling calls should not prevent lazy binding.  Lazy-binding stubs\n+     require $gp to be valid on entry, so sibcalls can only use stubs\n+     if $gp is call-clobbered.  */\n+  if (decl\n+      && TARGET_CALL_SAVED_GP\n+      && !TARGET_ABICALLS_PIC0\n+      && !targetm.binds_local_p (decl))\n+    return false;\n+\n   /* Otherwise OK.  */\n   return true;\n }"}, {"sha": "e608612d2d16cd828e781ef1c973bb5683fc73d8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e299a383a9334fe71492e54ccfa9888434d69d05", "patch": "@@ -1,3 +1,9 @@\n+2013-05-15  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\tPR target/57260\n+\t* gcc.target/mips/call-1.c: Restrict to o32.\n+\t* gcc.target/mips/call-5.c, gcc.target/mips/call-6.c: New test.\n+\n 2013-05-15  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* g++.dg/cpp0x/lambda/lambda-shadow1.C: Replace dg-warnings with"}, {"sha": "2a9f1e57159839f9ae47144a3f94056a48a96646", "filename": "gcc/testsuite/gcc.target/mips/call-1.c", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-1.c?ref=e299a383a9334fe71492e54ccfa9888434d69d05", "patch": "@@ -1,10 +1,12 @@\n-/* { dg-options \"-mrelax-pic-calls -mshared -foptimize-sibling-calls\" } */\n+/* { dg-options \"-mrelax-pic-calls -mshared -foptimize-sibling-calls -mabi=32\" } */\n /* { dg-skip-if \"requires -foptimize-sibling-calls\" { *-*-* } { \"-O0\" } { \"\" } } */\n /* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,normal\\n1:\\tjalr\\t\" } } */\n /* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,normal2\\n1:\\tjalr\\t\" } } */\n /* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,staticfunc\\n1:\\tjalr\\t\" } } */\n /* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail\\n1:\\tjr\\t\" } } */\n /* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail2\\n1:\\tjr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail3\\n1:\\tjr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail4\\n1:\\tjr\\t\" } } */\n \n __attribute__ ((noinline)) static void staticfunc () { asm (\"\"); }\n int normal ();\n@@ -31,3 +33,17 @@ NOMIPS16 void g ()\n {\n   tail2 ();\n }\n+\n+__attribute__ ((visibility (\"hidden\"))) void tail3 ();\n+\n+NOMIPS16 void j ()\n+{\n+  tail3 ();\n+}\n+\n+__attribute__ ((noinline)) static void tail4 () { asm (\"\"); }\n+\n+NOMIPS16 void k ()\n+{\n+  tail4 ();\n+}"}, {"sha": "2e58178ba94b43e798224e69b82bd8b249c2a165", "filename": "gcc/testsuite/gcc.target/mips/call-5.c", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-5.c?ref=e299a383a9334fe71492e54ccfa9888434d69d05", "patch": "@@ -0,0 +1,51 @@\n+/* Like call-1.c, but for n32.  We cannot use sibling calls for tail and tail2\n+   in this case (PR target/57260).  */\n+/* { dg-options \"-mrelax-pic-calls -mshared -foptimize-sibling-calls -mabi=n32\" } */\n+/* { dg-skip-if \"requires -foptimize-sibling-calls\" { *-*-* } { \"-O0\" } { \"\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,normal\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,normal2\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,staticfunc\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail2\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail3\\n1:\\tjr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail4\\n1:\\tjr\\t\" } } */\n+\n+__attribute__ ((noinline)) static void staticfunc () { asm (\"\"); }\n+int normal ();\n+void normal2 ();\n+\n+NOMIPS16 f (int *p)\n+{\n+  *p = normal ();\n+  normal2 ();\n+  staticfunc ();\n+  return 1;\n+}\n+\n+int tail ();\n+\n+NOMIPS16 h ()\n+{\n+  return tail ();\n+}\n+\n+void tail2 ();\n+\n+NOMIPS16 void g ()\n+{\n+  tail2 ();\n+}\n+\n+__attribute__ ((visibility (\"hidden\"))) void tail3 ();\n+\n+NOMIPS16 void j ()\n+{\n+  tail3 ();\n+}\n+\n+__attribute__ ((noinline)) static void tail4 () { asm (\"\"); }\n+\n+NOMIPS16 void k ()\n+{\n+  tail4 ();\n+}"}, {"sha": "86f3dc4a8fe9104908ac567eecff6edacb721367", "filename": "gcc/testsuite/gcc.target/mips/call-6.c", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e299a383a9334fe71492e54ccfa9888434d69d05/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fcall-6.c?ref=e299a383a9334fe71492e54ccfa9888434d69d05", "patch": "@@ -0,0 +1,50 @@\n+/* Like call-5.c, but for n64.  */\n+/* { dg-options \"-mrelax-pic-calls -mshared -foptimize-sibling-calls -mabi=64\" } */\n+/* { dg-skip-if \"requires -foptimize-sibling-calls\" { *-*-* } { \"-O0\" } { \"\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,normal\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,normal2\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,staticfunc\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail2\\n1:\\tjalr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail3\\n1:\\tjr\\t\" } } */\n+/* { dg-final { scan-assembler \"\\\\.reloc\\t1f,R_MIPS_JALR,tail4\\n1:\\tjr\\t\" } } */\n+\n+__attribute__ ((noinline)) static void staticfunc () { asm (\"\"); }\n+int normal ();\n+void normal2 ();\n+\n+NOMIPS16 f (int *p)\n+{\n+  *p = normal ();\n+  normal2 ();\n+  staticfunc ();\n+  return 1;\n+}\n+\n+int tail ();\n+\n+NOMIPS16 h ()\n+{\n+  return tail ();\n+}\n+\n+void tail2 ();\n+\n+NOMIPS16 void g ()\n+{\n+  tail2 ();\n+}\n+\n+__attribute__ ((visibility (\"hidden\"))) void tail3 ();\n+\n+NOMIPS16 void j ()\n+{\n+  tail3 ();\n+}\n+\n+__attribute__ ((noinline)) static void tail4 () { asm (\"\"); }\n+\n+NOMIPS16 void k ()\n+{\n+  tail4 ();\n+}"}]}