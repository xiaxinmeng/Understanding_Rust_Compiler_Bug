{"sha": "cd1588c4d60162730a103b6ca3a30139d88a57e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2QxNTg4YzRkNjAxNjI3MzBhMTAzYjZjYTNhMzAxMzlkODhhNTdlMw==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-03-23T21:02:34Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-03-23T21:02:34Z"}, "message": "Fix PR c++/70332 (ICE due to aggregate initialization of NSDMI)\n\ngcc/cp/ChangeLog:\n\n\tPR c++/70332\n\t* pt.c (tsubst_copy) [PARM_DECL]: Handle the use of 'this' in an\n\tNSDMI that's part of an aggregrate initialization.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/70332\n\t* g++.dg/cpp1y/nsdmi-aggr5.C: New test.\n\nFrom-SVN: r234442", "tree": {"sha": "14bfa7e79e1654780fbe7af110d52eca7878e111", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14bfa7e79e1654780fbe7af110d52eca7878e111"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd1588c4d60162730a103b6ca3a30139d88a57e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd1588c4d60162730a103b6ca3a30139d88a57e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd1588c4d60162730a103b6ca3a30139d88a57e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd1588c4d60162730a103b6ca3a30139d88a57e3/comments", "author": null, "committer": null, "parents": [{"sha": "80636611f3a1490d8164509f1b206d009d153b61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80636611f3a1490d8164509f1b206d009d153b61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80636611f3a1490d8164509f1b206d009d153b61"}], "stats": {"total": 44, "additions": 41, "deletions": 3}, "files": [{"sha": "984a030286b754f5306db3375b92cf9d2ce3d932", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=cd1588c4d60162730a103b6ca3a30139d88a57e3", "patch": "@@ -1,3 +1,9 @@\n+2016-03-23  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/70332\n+\t* pt.c (tsubst_copy) [PARM_DECL]: Handle the use of 'this' in an\n+\tNSDMI that's part of an aggregrate initialization.\n+\n 2016-03-23  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/70001"}, {"sha": "a6398c04f85e0cdf9e187be6554276402d222c2e", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=cd1588c4d60162730a103b6ca3a30139d88a57e3", "patch": "@@ -13878,10 +13878,13 @@ tsubst_copy (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \n       if (r == NULL_TREE)\n \t{\n-\t  /* We get here for a use of 'this' in an NSDMI.  */\n+\t  /* We get here for a use of 'this' in an NSDMI as part of a\n+\t     constructor call or as part of an aggregate initialization.  */\n \t  if (DECL_NAME (t) == this_identifier\n-\t      && current_function_decl\n-\t      && DECL_CONSTRUCTOR_P (current_function_decl))\n+\t      && ((current_function_decl\n+\t\t   && DECL_CONSTRUCTOR_P (current_function_decl))\n+\t\t  || (current_class_ref\n+\t\t      && TREE_CODE (current_class_ref) == PLACEHOLDER_EXPR)))\n \t    return current_class_ptr;\n \n \t  /* This can happen for a parameter name used later in a function"}, {"sha": "5e3227643855dd00a39625a78c90bfea9ffc24dc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cd1588c4d60162730a103b6ca3a30139d88a57e3", "patch": "@@ -1,3 +1,8 @@\n+2016-03-23  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/70332\n+\t* g++.dg/cpp1y/nsdmi-aggr5.C: New test.\n+\n 2016-03-23  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/70001"}, {"sha": "fe377c399c806f8d98be417501f075fc673e8bec", "filename": "gcc/testsuite/g++.dg/cpp1y/nsdmi-aggr5.C", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-aggr5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd1588c4d60162730a103b6ca3a30139d88a57e3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-aggr5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-aggr5.C?ref=cd1588c4d60162730a103b6ca3a30139d88a57e3", "patch": "@@ -0,0 +1,24 @@\n+// PR c++/70332\n+// { dg-do run { target c++14 } }\n+\n+template <class T>\n+struct C\n+{\n+ T m;\n+ T *n = &m;\n+};\n+\n+C<int> c { };\n+\n+int\n+main ()\n+{\n+  *c.n = 5;\n+  if (c.m != 5)\n+    __builtin_abort ();\n+\n+  C<int> d { 10 };\n+  *d.n = *d.n + 1;\n+  if (d.m != 11)\n+    __builtin_abort ();\n+}"}]}