{"sha": "2ec58cfcea146a61755516ce4ed160827fe0b4ff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmVjNThjZmNlYTE0NmE2MTc1NTUxNmNlNGVkMTYwODI3ZmUwYjRmZg==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-09-21T13:30:38Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-09-21T13:30:38Z"}, "message": "libstdc++: Relax constraints on transform_view and elements_view iterators\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/ranges (transform_view, elements_view): Relax\n\tconstraints on operator- for iterators, as per LWG 3483.\n\t* testsuite/std/ranges/adaptors/elements.cc: Check that we\n\tcan take the difference of two iterators from a non-random\n\taccess range.\n\t* testsuite/std/ranges/adaptors/transform.cc: Likewise.", "tree": {"sha": "b1fcf569ab7b8253574c11eac18d5b08951063a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1fcf569ab7b8253574c11eac18d5b08951063a1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ec58cfcea146a61755516ce4ed160827fe0b4ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ec58cfcea146a61755516ce4ed160827fe0b4ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ec58cfcea146a61755516ce4ed160827fe0b4ff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ec58cfcea146a61755516ce4ed160827fe0b4ff/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f10ed928e2f8ecc2c859abff8f2f9296b11b8d95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f10ed928e2f8ecc2c859abff8f2f9296b11b8d95", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f10ed928e2f8ecc2c859abff8f2f9296b11b8d95"}], "stats": {"total": 56, "additions": 54, "deletions": 2}, "files": [{"sha": "005e89f94b2fa282592c82128d8d6aeec122ee28", "filename": "libstdc++-v3/include/std/ranges", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ec58cfcea146a61755516ce4ed160827fe0b4ff/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ec58cfcea146a61755516ce4ed160827fe0b4ff/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Franges?ref=2ec58cfcea146a61755516ce4ed160827fe0b4ff", "patch": "@@ -1833,9 +1833,11 @@ namespace views\n \t    requires random_access_range<_Base>\n \t  { return {*__i._M_parent, __i._M_current - __n}; }\n \n+\t  // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+\t  // 3483. transform_view::iterator's difference is overconstrained\n \t  friend constexpr difference_type\n \t  operator-(const _Iterator& __x, const _Iterator& __y)\n-\t    requires random_access_range<_Base>\n+\t    requires sized_sentinel_for<iterator_t<_Base>, iterator_t<_Base>>\n \t  { return __x._M_current - __y._M_current; }\n \n \t  friend constexpr decltype(auto)\n@@ -3538,9 +3540,11 @@ namespace views\n \t    requires random_access_range<_Base>\n \t  { return _Iterator{__x} -= __y; }\n \n+\t  // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+\t  // 3483. transform_view::iterator's difference is overconstrained\n \t  friend constexpr difference_type\n \t  operator-(const _Iterator& __x, const _Iterator& __y)\n-\t    requires random_access_range<_Base>\n+\t    requires sized_sentinel_for<iterator_t<_Base>, iterator_t<_Base>>\n \t  { return __x._M_current - __y._M_current; }\n \n \t  friend _Sentinel<_Const>;"}, {"sha": "94dd7c945052d79a627dd5d1a957bafbb45a6655", "filename": "libstdc++-v3/testsuite/std/ranges/adaptors/elements.cc", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ec58cfcea146a61755516ce4ed160827fe0b4ff/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Felements.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ec58cfcea146a61755516ce4ed160827fe0b4ff/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Felements.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Felements.cc?ref=2ec58cfcea146a61755516ce4ed160827fe0b4ff", "patch": "@@ -66,9 +66,33 @@ test02()\n   VERIFY( ranges::equal(v2, (std::pair<char, int>[]){{1,2}}) );\n }\n \n+struct X\n+{\n+  using Iter = __gnu_test::forward_iterator_wrapper<std::pair<int, X>>;\n+\n+  friend auto operator-(Iter l, Iter r) { return l.ptr - r.ptr; }\n+};\n+\n+void\n+test03()\n+{\n+  // LWG 3483\n+  std::pair<int, X> x[3];\n+  __gnu_test::test_forward_range<std::pair<int, X>> r(x);\n+  auto v = views::elements<1>(r);\n+  auto b = begin(v);\n+  static_assert( !ranges::random_access_range<decltype(r)> );\n+  static_assert( std::sized_sentinel_for<decltype(b), decltype(b)> );\n+  VERIFY( (next(b, 1) - b) == 1 );\n+  const auto v_const = v;\n+  auto b_const = begin(v_const);\n+  VERIFY( (next(b_const, 2) - b_const) == 2 );\n+}\n+\n int\n main()\n {\n   test01();\n   test02();\n+  test03();\n }"}, {"sha": "41a7d3b33213f509c345169d1869e242a30a167f", "filename": "libstdc++-v3/testsuite/std/ranges/adaptors/transform.cc", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ec58cfcea146a61755516ce4ed160827fe0b4ff/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Ftransform.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ec58cfcea146a61755516ce4ed160827fe0b4ff/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Ftransform.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fadaptors%2Ftransform.cc?ref=2ec58cfcea146a61755516ce4ed160827fe0b4ff", "patch": "@@ -122,6 +122,29 @@ test05()\n   b = ranges::end(v);\n }\n \n+struct Y\n+{\n+  using Iter = __gnu_test::forward_iterator_wrapper<Y>;\n+\n+  friend auto operator-(Iter l, Iter r) { return l.ptr - r.ptr; }\n+};\n+\n+void\n+test06()\n+{\n+  // LWG 3483\n+  Y y[3];\n+  __gnu_test::test_forward_range<Y> r(y);\n+  auto v = views::transform(r, std::identity{});\n+  auto b = begin(v);\n+  static_assert( !ranges::random_access_range<decltype(r)> );\n+  static_assert( std::sized_sentinel_for<decltype(b), decltype(b)> );\n+  VERIFY( (next(b, 1) - b) == 1 );\n+  const auto v_const = v;\n+  auto b_const = begin(v_const);\n+  VERIFY( (next(b_const, 2) - b_const) == 2 );\n+}\n+\n int\n main()\n {\n@@ -130,4 +153,5 @@ main()\n   test03();\n   test04();\n   test05();\n+  test06();\n }"}]}