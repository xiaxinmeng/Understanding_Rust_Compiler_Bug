{"sha": "d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2", "node_id": "C_kwDOANBUbNoAKGQ2YTg3ZDk2ZDc0NzNjYmQyNDA0ZDVkY2M3ZWVmMzZhN2Y1M2IyYjI", "commit": {"author": {"name": "Indu Bhagat", "email": "indu.bhagat@oracle.com", "date": "2021-09-29T20:25:39Z"}, "committer": {"name": "Indu Bhagat", "email": "indu.bhagat@oracle.com", "date": "2021-09-29T20:27:19Z"}, "message": "debug/102507: ICE in btf_finalize when compiling with -gbtf\n\nFix the free up of btf_var_ids hash_map in btf_finalize ().\n\ngcc/ChangeLog:\n\n\tPR debug/102507\n\t* btfout.c (GTY): Add GTY (()) albeit for cosmetic only purpose.\n\t(btf_finalize): Empty the hash_map btf_var_ids.", "tree": {"sha": "187a41df87b75408405c2ac6a1afb0f7b47a9d06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/187a41df87b75408405c2ac6a1afb0f7b47a9d06"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2/comments", "author": {"login": "ibhagatgnu", "id": 51812649, "node_id": "MDQ6VXNlcjUxODEyNjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/51812649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibhagatgnu", "html_url": "https://github.com/ibhagatgnu", "followers_url": "https://api.github.com/users/ibhagatgnu/followers", "following_url": "https://api.github.com/users/ibhagatgnu/following{/other_user}", "gists_url": "https://api.github.com/users/ibhagatgnu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibhagatgnu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibhagatgnu/subscriptions", "organizations_url": "https://api.github.com/users/ibhagatgnu/orgs", "repos_url": "https://api.github.com/users/ibhagatgnu/repos", "events_url": "https://api.github.com/users/ibhagatgnu/events{/privacy}", "received_events_url": "https://api.github.com/users/ibhagatgnu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibhagatgnu", "id": 51812649, "node_id": "MDQ6VXNlcjUxODEyNjQ5", "avatar_url": "https://avatars.githubusercontent.com/u/51812649?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibhagatgnu", "html_url": "https://github.com/ibhagatgnu", "followers_url": "https://api.github.com/users/ibhagatgnu/followers", "following_url": "https://api.github.com/users/ibhagatgnu/following{/other_user}", "gists_url": "https://api.github.com/users/ibhagatgnu/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibhagatgnu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibhagatgnu/subscriptions", "organizations_url": "https://api.github.com/users/ibhagatgnu/orgs", "repos_url": "https://api.github.com/users/ibhagatgnu/repos", "events_url": "https://api.github.com/users/ibhagatgnu/events{/privacy}", "received_events_url": "https://api.github.com/users/ibhagatgnu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cd5448f6c534c0d386f6b561ab903ffd5d3884b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd5448f6c534c0d386f6b561ab903ffd5d3884b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd5448f6c534c0d386f6b561ab903ffd5d3884b2"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "a78781575602240d39c59539786bb0840b6c7275", "filename": "gcc/btfout.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2/gcc%2Fbtfout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2/gcc%2Fbtfout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbtfout.c?ref=d6a87d96d7473cbd2404d5dcc7eef36a7f53b2b2", "patch": "@@ -70,7 +70,7 @@ static char btf_info_section_label[MAX_BTF_LABEL_BYTES];\n    converted to BTF_KIND_VAR type records. Strictly accounts for the index\n    from the start of the variable type entries, does not include the number\n    of types emitted prior to the variable records.  */\n-static hash_map <ctf_dvdef_ref, unsigned int> *btf_var_ids;\n+static GTY (()) hash_map <ctf_dvdef_ref, unsigned> *btf_var_ids;\n \n /* Mapping of type IDs from original CTF ID to BTF ID. Types do not map\n    1-to-1 from CTF to BTF. To avoid polluting the CTF container when updating\n@@ -1119,12 +1119,12 @@ btf_finalize (void)\n \n   funcs = NULL;\n \n+  btf_var_ids->empty ();\n+  btf_var_ids = NULL;\n+\n   free (btf_id_map);\n   btf_id_map = NULL;\n \n-  ggc_free (btf_var_ids);\n-  btf_var_ids = NULL;\n-\n   ctf_container_ref tu_ctfc = ctf_get_tu_ctfc ();\n   ctfc_delete_container (tu_ctfc);\n   tu_ctfc = NULL;"}]}