{"sha": "65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjVjZmEyZmVkMzljNzY0OThlN2MzZGZlMTM4YmRkYjA0OWQ2MGRkNw==", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2021-03-24T08:50:37Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2021-03-24T09:48:23Z"}, "message": "run sysconf-requiring test on systems that support it\n\nSome gcc.target/i386 tests requires the mmap feature, but that's not\nenough for the test to be able to call sysconf.\n\nThis patch introduces a sysconf feature, analogous to mmap, and adds\nit to tests in gcc.target/i386 that call sysconf.\n\nThere are other tests within gcc.dg and g++.dg that call sysconf, but\nI haven't added the tag to them, because they already cover it with\ntarget triplets.  I was a little nervous about dropping the triplets,\nand saw how they implied sysconf, so I left those alone.\n\n\nfor  gcc/ChangeLog\n\n\t* doc/sourcebuild.texi (sysconf): New effective target.\n\nfor  gcc/testsuite/ChangeLog\n\n\t* lib/target-supports.exp (check_effective_target_sysconf): New.\n\t* gcc.target/i386/pr95443-1.c: Require it.\n\t* gcc.target/i386/pr95443-2.c: Likewise.\n\t* gcc.target/i386/sse2-mmx-maskmovq.c: Likewise.\n\t* gcc.target/i386/strncmp-1.c: Likewise.", "tree": {"sha": "52b7b58d8a326a05f1f74d5a0a5c090c388651b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/52b7b58d8a326a05f1f74d5a0a5c090c388651b3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/comments", "author": null, "committer": null, "parents": [{"sha": "9eec7c7686aedc79853699549d1c9eee0a0a84fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9eec7c7686aedc79853699549d1c9eee0a0a84fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9eec7c7686aedc79853699549d1c9eee0a0a84fd"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "0104916e6603158013c506145ec15a2f0a61831e", "filename": "gcc/doc/sourcebuild.texi", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Fdoc%2Fsourcebuild.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Fdoc%2Fsourcebuild.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fsourcebuild.texi?ref=65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "patch": "@@ -2450,6 +2450,9 @@ all targets.\n @item stpcpy\n Target provides @code{stpcpy} function.\n \n+@item sysconf\n+Target supports @code{sysconf}.\n+\n @item trampolines\n Target supports trampolines.\n "}, {"sha": "d846fcbda0a2eb285df841fb9679d5f54b874e62", "filename": "gcc/testsuite/gcc.target/i386/pr95443-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95443-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95443-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95443-1.c?ref=65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run { target mmap } } */\n+/* { dg-do run { target { sysconf && mmap } } } */\n /* { dg-options \"-O2 -minline-all-stringops\" } */\n \n #include <stdint.h>"}, {"sha": "2ab260608bc2620c5ae75bd8c5a18f6b724c9e5f", "filename": "gcc/testsuite/gcc.target/i386/pr95443-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95443-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95443-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr95443-2.c?ref=65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run { target mmap } } */\n+/* { dg-do run { target { sysconf && mmap } } } */\n /* { dg-options \"-O2 -minline-all-stringops\" } */\n \n #include <stdint.h>"}, {"sha": "87705be3f70d7985d07a9271979f0e41f8fb3d49", "filename": "gcc/testsuite/gcc.target/i386/sse2-mmx-maskmovq.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse2-mmx-maskmovq.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse2-mmx-maskmovq.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fsse2-mmx-maskmovq.c?ref=65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run { target mmap } } */\n+/* { dg-do run { target { sysconf && mmap } } } */\n /* { dg-options \"-O2 -fno-strict-aliasing -msse2\" } */\n /* { dg-additional-options \"-mno-mmx\" { target { ! ia32 } } } */\n "}, {"sha": "1ea3e0a57c1dec0a8b300b50196886105af00e2d", "filename": "gcc/testsuite/gcc.target/i386/strncmp-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fstrncmp-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fstrncmp-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fstrncmp-1.c?ref=65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do run { target mmap } } */\n+/* { dg-do run { target { sysconf && mmap } } } */\n /* { dg-options \"-O2\" } */\n \n #include <stdio.h>"}, {"sha": "1230d19421544efb40cfe6af994f019b8e9ad656", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65cfa2fed39c76498e7c3dfe138bddb049d60dd7/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=65cfa2fed39c76498e7c3dfe138bddb049d60dd7", "patch": "@@ -1067,6 +1067,12 @@ proc check_effective_target_mmap {} {\n     return [check_function_available \"mmap\"]\n }\n \n+# Return 1 if the target supports sysconf, 0 otherwise.\n+\n+proc check_effective_target_sysconf {} {\n+    return [check_function_available \"sysconf\"]\n+}\n+\n # Return 1 if the target supports dlopen, 0 otherwise.\n proc check_effective_target_dlopen {} {\n     return [check_no_compiler_messages dlopen executable {"}]}