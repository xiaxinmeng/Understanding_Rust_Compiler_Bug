{"sha": "55bb77b50a5ec520f28978ac3fdac1983200e1f7", "node_id": "C_kwDOANBUbNoAKDU1YmI3N2I1MGE1ZWM1MjBmMjg5NzhhYzNmZGFjMTk4MzIwMGUxZjc", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2022-07-08T17:28:24Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2022-07-08T17:32:45Z"}, "message": "libbacktrace: check for sys/link.h\n\nQNX uses sys/link.h rather than link.h for dl_iterate_phdr\n\nFixes https://github.com/ianlancetaylor/libbacktrace/issues/86\n\n\t* configure.ac: Check for sys/link.h.  Use either link.h or\n\tsys/link.h when checking for dl_iterate_phdr.\n\t* elf.c: Include sys/link.h if available.\n\t* configure, config.h.in: Regenerate.", "tree": {"sha": "d634f55ec84cb7fd365e52020980c0fbad9e292f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d634f55ec84cb7fd365e52020980c0fbad9e292f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55bb77b50a5ec520f28978ac3fdac1983200e1f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55bb77b50a5ec520f28978ac3fdac1983200e1f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55bb77b50a5ec520f28978ac3fdac1983200e1f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55bb77b50a5ec520f28978ac3fdac1983200e1f7/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b984b84cbe4bf026edef2ba37685f3958a1dc1cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b984b84cbe4bf026edef2ba37685f3958a1dc1cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b984b84cbe4bf026edef2ba37685f3958a1dc1cf"}], "stats": {"total": 37, "additions": 27, "deletions": 10}, "files": [{"sha": "a21e2eaf5252c4b0b2f17d062a23ddca2d8ad212", "filename": "libbacktrace/config.h.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fconfig.h.in?ref=55bb77b50a5ec520f28978ac3fdac1983200e1f7", "patch": "@@ -85,6 +85,9 @@\n /* Define to 1 if you have the <sys/ldr.h> header file. */\n #undef HAVE_SYS_LDR_H\n \n+/* Define to 1 if you have the <sys/link.h> header file. */\n+#undef HAVE_SYS_LINK_H\n+\n /* Define to 1 if you have the <sys/mman.h> header file. */\n #undef HAVE_SYS_MMAN_H\n "}, {"sha": "705b71bd8cd1c0ddba242511220443fe026d1864", "filename": "libbacktrace/configure", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fconfigure?ref=55bb77b50a5ec520f28978ac3fdac1983200e1f7", "patch": "@@ -13267,26 +13267,31 @@ fi\n \n \n # Check for dl_iterate_phdr.\n-for ac_header in link.h\n+for ac_header in link.h sys/link.h\n do :\n-  ac_fn_c_check_header_mongrel \"$LINENO\" \"link.h\" \"ac_cv_header_link_h\" \"$ac_includes_default\"\n-if test \"x$ac_cv_header_link_h\" = xyes; then :\n+  as_ac_Header=`$as_echo \"ac_cv_header_$ac_header\" | $as_tr_sh`\n+ac_fn_c_check_header_mongrel \"$LINENO\" \"$ac_header\" \"$as_ac_Header\" \"$ac_includes_default\"\n+if eval test \\\"x\\$\"$as_ac_Header\"\\\" = x\"yes\"; then :\n   cat >>confdefs.h <<_ACEOF\n-#define HAVE_LINK_H 1\n+#define `$as_echo \"HAVE_$ac_header\" | $as_tr_cpp` 1\n _ACEOF\n \n fi\n \n done\n \n-if test \"$ac_cv_header_link_h\" = \"no\"; then\n+if test \"$ac_cv_header_link_h\" = \"no\" -a \"$ac_cv_header_sys_link_h\" = \"no\"; then\n   have_dl_iterate_phdr=no\n else\n   if test -n \"${with_target_subdir}\"; then\n+    link_h=link.h\n+    if test \"$ac_cv_header_link_h\" = \"no\"; then\n+       link_h=sys/link.h\n+    fi\n     # When built as a GCC target library, we can't do a link test.\n     cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n /* end confdefs.h.  */\n-#include <link.h>\n+#include <$link_h>\n \n _ACEOF\n if (eval \"$ac_cpp conftest.$ac_ext\") 2>&5 |"}, {"sha": "1daaa2f62d21b90dfb0586a82eefbf840765db6c", "filename": "libbacktrace/configure.ac", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fconfigure.ac?ref=55bb77b50a5ec520f28978ac3fdac1983200e1f7", "patch": "@@ -335,13 +335,17 @@ fi\n AC_SUBST(BACKTRACE_USES_MALLOC)\n \n # Check for dl_iterate_phdr.\n-AC_CHECK_HEADERS(link.h)\n-if test \"$ac_cv_header_link_h\" = \"no\"; then\n+AC_CHECK_HEADERS(link.h sys/link.h)\n+if test \"$ac_cv_header_link_h\" = \"no\" -a \"$ac_cv_header_sys_link_h\" = \"no\"; then\n   have_dl_iterate_phdr=no\n else\n   if test -n \"${with_target_subdir}\"; then\n+    link_h=link.h\n+    if test \"$ac_cv_header_link_h\" = \"no\"; then\n+       link_h=sys/link.h\n+    fi\n     # When built as a GCC target library, we can't do a link test.\n-    AC_EGREP_HEADER([dl_iterate_phdr], [link.h], [have_dl_iterate_phdr=yes],\n+    AC_EGREP_HEADER([dl_iterate_phdr], [$link_h], [have_dl_iterate_phdr=yes],\n \t\t    [have_dl_iterate_phdr=no])\n   else\n     AC_CHECK_FUNC([dl_iterate_phdr], [have_dl_iterate_phdr=yes],"}, {"sha": "181d195fe355fd31bc610d572c66952dfadaecc1", "filename": "libbacktrace/elf.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Felf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55bb77b50a5ec520f28978ac3fdac1983200e1f7/libbacktrace%2Felf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Felf.c?ref=55bb77b50a5ec520f28978ac3fdac1983200e1f7", "patch": "@@ -40,7 +40,12 @@ POSSIBILITY OF SUCH DAMAGE.  */\n #include <unistd.h>\n \n #ifdef HAVE_DL_ITERATE_PHDR\n-#include <link.h>\n+ #ifdef HAVE_LINK_H\n+  #include <link.h>\n+ #endif\n+ #ifdef HAVE_SYS_LINK_H\n+  #include <sys/link.h>\n+ #endif\n #endif\n \n #include \"backtrace.h\""}]}