{"sha": "3d57d7bafa6c6e503c04fe234d996103b5e3e06c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2Q1N2Q3YmFmYTZjNmU1MDNjMDRmZTIzNGQ5OTYxMDNiNWUzZTA2Yw==", "commit": {"author": {"name": "Loren J. Rittle", "email": "ljrittle@acm.org", "date": "2003-06-24T06:34:34Z"}, "committer": {"name": "Loren J. Rittle", "email": "ljrittle@gcc.gnu.org", "date": "2003-06-24T06:34:34Z"}, "message": "* include/ext/mt_allocator.h: Portability.\n\nFrom-SVN: r68406", "tree": {"sha": "0be11284ee79b07a95dc0f66a15c38c017d1d2a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0be11284ee79b07a95dc0f66a15c38c017d1d2a0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d57d7bafa6c6e503c04fe234d996103b5e3e06c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d57d7bafa6c6e503c04fe234d996103b5e3e06c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d57d7bafa6c6e503c04fe234d996103b5e3e06c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d57d7bafa6c6e503c04fe234d996103b5e3e06c/comments", "author": null, "committer": null, "parents": [{"sha": "d46c570d55159311fc749bb7609e1b1ddf22a2d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d46c570d55159311fc749bb7609e1b1ddf22a2d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d46c570d55159311fc749bb7609e1b1ddf22a2d5"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "c1acd15755e1f48db23b4e8bb5ab96360d8c36fd", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57d7bafa6c6e503c04fe234d996103b5e3e06c/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57d7bafa6c6e503c04fe234d996103b5e3e06c/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=3d57d7bafa6c6e503c04fe234d996103b5e3e06c", "patch": "@@ -7,6 +7,8 @@\n \t* config/abi/alpha-freebsd5/baseline_symbols.txt: New file.\n \t* config/abi/sparc-freebsd5/baseline_symbols.txt: New file.\n \n+\t* include/ext/mt_allocator.h: Portability.\n+\n 2003-06-23  Benjamin Kosnik  <bkoz@redhat.com>\n \n \t* docs/html/17_intro/libstdc++-assign.txt: Update address."}, {"sha": "cd3b273ad91a0529980871f7b72060343a4ed058", "filename": "libstdc++-v3/include/ext/mt_allocator.h", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d57d7bafa6c6e503c04fe234d996103b5e3e06c/libstdc%2B%2B-v3%2Finclude%2Fext%2Fmt_allocator.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d57d7bafa6c6e503c04fe234d996103b5e3e06c/libstdc%2B%2B-v3%2Finclude%2Fext%2Fmt_allocator.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fext%2Fmt_allocator.h?ref=3d57d7bafa6c6e503c04fe234d996103b5e3e06c", "patch": "@@ -613,13 +613,15 @@ namespace __gnu_cxx\n           if (!_S_bin[bin].mutex) \n             __throw_bad_alloc();\n \n-          /*\n-           * This is not only ugly - it's extremly non-portable!\n-           * However gthr.h does not currently provide a\n-           * __gthread_mutex_init() call. The correct solution to\n-           * this problem needs to be discussed.\n-           */\n-          pthread_mutex_init(_S_bin[bin].mutex, NULL);\n+#ifdef __GTHREAD_MUTEX_INIT\n+\t  {\n+\t    // Do not copy a POSIX/gthr mutex once in use.\n+\t    __gthread_mutex_t __tmp = __GTHREAD_MUTEX_INIT;\n+\t    *_S_bin[bin].mutex = __tmp;\n+\t  }\n+#else\n+\t  { __GTHREAD_MUTEX_INIT_FUNCTION (_S_bin[bin].mutex); }\n+#endif\n #endif\n \n           for (size_t thread = 0; thread <= _S_max_threads; thread++)"}]}