{"sha": "9cd6dd82398c07551d428e2943a7d8429c4650c0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNkNmRkODIzOThjMDc1NTFkNDI4ZTI5NDNhN2Q4NDI5YzQ2NTBjMA==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@codesourcery.com", "date": "2012-07-26T23:18:47Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2012-07-26T23:18:47Z"}, "message": "pex-win32.c (pex_win32_exec_child): Only close original file descriptors if child is launched successfully.\n\n2012-07-26  Kazu Hirata  <kazu@codesourcery.com>\n\t    Sandra Loosemore  <sandra@codesourcery.com>\n\n\tlibiberty/\n\t* pex-win32.c (pex_win32_exec_child): Only close original file\n\tdescriptors if child is launched successfully.\n\nCo-Authored-By: Sandra Loosemore <sandra@codesourcery.com>\n\nFrom-SVN: r189901", "tree": {"sha": "5bb79d01d34e0a177c2f1d1b9375c4447d077918", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5bb79d01d34e0a177c2f1d1b9375c4447d077918"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9cd6dd82398c07551d428e2943a7d8429c4650c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cd6dd82398c07551d428e2943a7d8429c4650c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cd6dd82398c07551d428e2943a7d8429c4650c0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cd6dd82398c07551d428e2943a7d8429c4650c0/comments", "author": null, "committer": null, "parents": [{"sha": "3984ea61cb3e47663b34655b7f62726260a23eb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3984ea61cb3e47663b34655b7f62726260a23eb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3984ea61cb3e47663b34655b7f62726260a23eb3"}], "stats": {"total": 31, "additions": 23, "deletions": 8}, "files": [{"sha": "349dc98eb06eaaf4a2cb755e7d456ae05e119824", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cd6dd82398c07551d428e2943a7d8429c4650c0/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cd6dd82398c07551d428e2943a7d8429c4650c0/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=9cd6dd82398c07551d428e2943a7d8429c4650c0", "patch": "@@ -1,3 +1,9 @@\n+2012-07-26  Kazu Hirata  <kazu@codesourcery.com>\n+\t    Sandra Loosemore  <sandra@codesourcery.com>\n+\n+\t* pex-win32.c (pex_win32_exec_child): Only close original file\n+\tdescriptors if child is launched successfully.\n+\n 2012-07-18  Jason Merrill  <jason@redhat.com>\n \n \t* cp-demangle.c (cplus_demangle_operators): Add *_cast."}, {"sha": "eae72c51dc0a2662db01b16c43abdf20590ac027", "filename": "libiberty/pex-win32.c", "status": "modified", "additions": 17, "deletions": 8, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cd6dd82398c07551d428e2943a7d8429c4650c0/libiberty%2Fpex-win32.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cd6dd82398c07551d428e2943a7d8429c4650c0/libiberty%2Fpex-win32.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fpex-win32.c?ref=9cd6dd82398c07551d428e2943a7d8429c4650c0", "patch": "@@ -741,24 +741,17 @@ pex_win32_exec_child (struct pex_obj *obj ATTRIBUTE_UNUSED, int flags,\n   int orig_out, orig_in, orig_err;\n   BOOL separate_stderr = !(flags & PEX_STDERR_TO_STDOUT);\n \n-  /* Ensure we have inheritable descriptors to pass to the child, and close the\n-     original descriptors.  */\n+  /* Ensure we have inheritable descriptors to pass to the child.  */\n   orig_in = in;\n   in = _dup (orig_in);\n-  if (orig_in != STDIN_FILENO)\n-    _close (orig_in);\n   \n   orig_out = out;\n   out = _dup (orig_out);\n-  if (orig_out != STDOUT_FILENO)\n-    _close (orig_out);\n   \n   if (separate_stderr)\n     {\n       orig_err = errdes;\n       errdes = _dup (orig_err);\n-      if (orig_err != STDERR_FILENO)\n-\t_close (orig_err);\n     }\n \n   stdin_handle = INVALID_HANDLE_VALUE;\n@@ -836,6 +829,22 @@ pex_win32_exec_child (struct pex_obj *obj ATTRIBUTE_UNUSED, int flags,\n       *errmsg = \"CreateProcess\";\n     }\n \n+  /* If the child was created successfully, close the original file\n+     descriptors.  If the process creation fails, these are closed by\n+     pex_run_in_environment instead.  We must not close them twice as\n+     that seems to cause a Windows exception.  */\n+     \n+  if (pid != (pid_t) -1)\n+    {\n+      if (orig_in != STDIN_FILENO)\n+\t_close (orig_in);\n+      if (orig_out != STDOUT_FILENO)\n+\t_close (orig_out);\n+      if (separate_stderr\n+\t  && orig_err != STDERR_FILENO)\n+\t_close (orig_err);\n+    }\n+\n   /* Close the standard input, standard output and standard error handles\n      in the parent.  */ \n "}]}