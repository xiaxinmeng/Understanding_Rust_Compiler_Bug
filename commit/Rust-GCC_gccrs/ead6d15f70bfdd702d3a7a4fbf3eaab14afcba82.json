{"sha": "ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWFkNmQxNWY3MGJmZGQ3MDJkM2E3YTRmYmYzZWFhYjE0YWZjYmE4Mg==", "commit": {"author": {"name": "Andrew Pinski", "email": "apinski@apple.com", "date": "2004-08-15T19:26:32Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2004-08-15T19:26:32Z"}, "message": "re PR fortran/17030 (gfortran does not optimize ABS of complex that well)\n\n2004-08-15  Andrew Pinski  <apinski@apple.com>\n\n        PR fortran/17030\n        * f95-lang.c (gfc_init_builtin_functions): Initialize the builtins\n        for cabs{,f} and copysign{,f}.\n        * trans-decl.c (gfor_fndecl_math_cabsf): Delete.\n        (gfor_fndecl_math_cabs): Delete.\n        (gfor_fndecl_math_sign4): Delete.\n        (gfor_fndecl_math_sign8): Delete.\n        (gfc_build_intrinsic_function_decls): Remove the\n        initializing of cabs{,f} and copysign{,f} functions.\n        * trans-intrinsic.c (gfc_conv_intrinsic_abs): Use the builtins\n        instead of the functions definitions.\n        (gfc_conv_intrinsic_sign): Likewise.\n        * trans.h (gfor_fndecl_math_cabsf): Delete.\n        (gfor_fndecl_math_cabs): Delete.\n        (gfor_fndecl_math_sign4): Delete.\n        (gfor_fndecl_math_sign8): Delete.\n\nFrom-SVN: r86027", "tree": {"sha": "6bcacd875e3ce9792611301d13f0a353cc99978a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6bcacd875e3ce9792611301d13f0a353cc99978a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/comments", "author": null, "committer": null, "parents": [{"sha": "23d4fa49c6b844fc4e4ca88708a92456ca865e80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23d4fa49c6b844fc4e4ca88708a92456ca865e80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23d4fa49c6b844fc4e4ca88708a92456ca865e80"}], "stats": {"total": 78, "additions": 47, "deletions": 31}, "files": [{"sha": "e0d97f2648c1926dde96ebe7114591514563d8b5", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "patch": "@@ -1,3 +1,22 @@\n+2004-08-15  Andrew Pinski  <apinski@apple.com>\n+\n+\tPR fortran/17030\n+\t* f95-lang.c (gfc_init_builtin_functions): Initialize the builtins\n+\tfor cabs{,f} and copysign{,f}.\n+\t* trans-decl.c (gfor_fndecl_math_cabsf): Delete. \n+\t(gfor_fndecl_math_cabs): Delete. \n+\t(gfor_fndecl_math_sign4): Delete. \n+\t(gfor_fndecl_math_sign8): Delete. \n+\t(gfc_build_intrinsic_function_decls): Remove the\n+\tinitializing of cabs{,f} and copysign{,f} functions.\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_abs): Use the builtins\n+\tinstead of the functions definitions.\n+\t(gfc_conv_intrinsic_sign): Likewise.\n+\t* trans.h (gfor_fndecl_math_cabsf): Delete. \n+\t(gfor_fndecl_math_cabs): Delete. \n+\t(gfor_fndecl_math_sign4): Delete. \n+\t(gfor_fndecl_math_sign8): Delete. \n+\n 2004-08-15  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* trans-array.c (gfc_trans_array_constructor_value): Use"}, {"sha": "aee5c9594a48a947c63111e6dd532d043707ffde", "filename": "gcc/fortran/f95-lang.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ff95-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ff95-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ff95-lang.c?ref=ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "patch": "@@ -723,18 +723,28 @@ gfc_init_builtin_functions (void)\n {\n   tree mfunc_float[2];\n   tree mfunc_double[2];\n+  tree func_cfloat_float;\n+  tree func_cdouble_double;\n   tree ftype;\n   tree tmp;\n \n   tmp = tree_cons (NULL_TREE, float_type_node, void_list_node);\n   mfunc_float[0] = build_function_type (float_type_node, tmp);\n   tmp = tree_cons (NULL_TREE, float_type_node, tmp);\n   mfunc_float[1] = build_function_type (float_type_node, tmp);\n+  \n+  tmp = tree_cons (NULL_TREE, complex_float_type_node, void_list_node);\n+  func_cfloat_float = build_function_type (float_type_node, tmp);\n+  \n \n   tmp = tree_cons (NULL_TREE, double_type_node, void_list_node);\n   mfunc_double[0] = build_function_type (double_type_node, tmp);\n   tmp = tree_cons (NULL_TREE, double_type_node, tmp);\n   mfunc_double[1] = build_function_type (double_type_node, tmp);\n+  \n+  \n+  tmp = tree_cons (NULL_TREE, complex_double_type_node, void_list_node);\n+  func_cdouble_double = build_function_type (double_type_node, tmp);\n \n #include \"mathbuiltins.def\"\n \n@@ -748,6 +758,17 @@ gfc_init_builtin_functions (void)\n \t\t      BUILT_IN_ROUND, \"round\", true);\n   gfc_define_builtin (\"__builtin_roundf\", mfunc_float[0], \n \t\t      BUILT_IN_ROUNDF, \"roundf\", true);\n+  \n+  gfc_define_builtin (\"__builtin_cabs\", func_cdouble_double, \n+\t\t      BUILT_IN_CABS, \"cabs\", true);\n+  gfc_define_builtin (\"__builtin_cabsf\", func_cfloat_float, \n+\t\t      BUILT_IN_CABSF, \"cabsf\", true);\n+\t\t      \n+  \n+  gfc_define_builtin (\"__builtin_copysign\", mfunc_double[1], \n+\t\t      BUILT_IN_COPYSIGN, \"copysign\", true);\n+  gfc_define_builtin (\"__builtin_copysignf\", mfunc_float[1], \n+\t\t      BUILT_IN_COPYSIGNF, \"copysignf\", true);\n \n   /* These are used to implement the ** operator.  */\n   gfc_define_builtin (\"__builtin_pow\", mfunc_double[1], "}, {"sha": "d9476b8220135cf51e5182ef8b301592f58d80c3", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "patch": "@@ -96,10 +96,6 @@ tree gfor_fndecl_associated;\n gfc_powdecl_list gfor_fndecl_math_powi[3][2];\n tree gfor_fndecl_math_cpowf;\n tree gfor_fndecl_math_cpow;\n-tree gfor_fndecl_math_cabsf;\n-tree gfor_fndecl_math_cabs;\n-tree gfor_fndecl_math_sign4;\n-tree gfor_fndecl_math_sign8;\n tree gfor_fndecl_math_ishftc4;\n tree gfor_fndecl_math_ishftc8;\n tree gfor_fndecl_math_exponent4;\n@@ -1460,22 +1456,6 @@ gfc_build_intrinsic_function_decls (void)\n     gfc_build_library_function_decl (get_identifier (\"cpow\"),\n \t\t\t\t     gfc_complex8_type_node,\n \t\t\t\t     1, gfc_complex8_type_node);\n-  gfor_fndecl_math_cabsf =\n-    gfc_build_library_function_decl (get_identifier (\"cabsf\"),\n-\t\t\t\t     gfc_real4_type_node,\n-\t\t\t\t     1, gfc_complex4_type_node);\n-  gfor_fndecl_math_cabs =\n-    gfc_build_library_function_decl (get_identifier (\"cabs\"),\n-\t\t\t\t     gfc_real8_type_node,\n-\t\t\t\t     1, gfc_complex8_type_node);\n-  gfor_fndecl_math_sign4 =\n-    gfc_build_library_function_decl (get_identifier (\"copysignf\"),\n-\t\t\t\t     gfc_real4_type_node,\n-\t\t\t\t     1, gfc_real4_type_node);\n-  gfor_fndecl_math_sign8 =\n-    gfc_build_library_function_decl (get_identifier (\"copysign\"),\n-\t\t\t\t     gfc_real8_type_node,\n-\t\t\t\t     1, gfc_real8_type_node);\n   gfor_fndecl_math_ishftc4 =\n     gfc_build_library_function_decl (get_identifier (PREFIX(\"ishftc4\")),\n \t\t\t\t     gfc_int4_type_node,"}, {"sha": "1a8a8b6f70b1e566d5d554c871f57df9a1aadd88", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "patch": "@@ -703,7 +703,7 @@ gfc_conv_intrinsic_abs (gfc_se * se, gfc_expr * expr)\n {\n   tree args;\n   tree val;\n-  tree fndecl;\n+  int n;\n \n   args = gfc_conv_intrinsic_function_args (se, expr);\n   assert (args && TREE_CHAIN (args) == NULL_TREE);\n@@ -720,15 +720,15 @@ gfc_conv_intrinsic_abs (gfc_se * se, gfc_expr * expr)\n       switch (expr->ts.kind)\n \t{\n \tcase 4:\n-\t  fndecl = gfor_fndecl_math_cabsf;\n+\t  n = BUILT_IN_CABSF;\n \t  break;\n \tcase 8:\n-\t  fndecl = gfor_fndecl_math_cabs;\n+\t  n = BUILT_IN_CABS;\n \t  break;\n \tdefault:\n \t  abort ();\n \t}\n-      se->expr = gfc_build_function_call (fndecl, args);\n+      se->expr = fold (gfc_build_function_call (built_in_decls[n], args));\n       break;\n \n     default:\n@@ -893,15 +893,15 @@ gfc_conv_intrinsic_sign (gfc_se * se, gfc_expr * expr)\n       switch (expr->ts.kind)\n \t{\n \tcase 4:\n-\t  tmp = gfor_fndecl_math_sign4;\n+\t  tmp = built_in_decls[BUILT_IN_COPYSIGNF];\n \t  break;\n \tcase 8:\n-\t  tmp = gfor_fndecl_math_sign8;\n+\t  tmp = built_in_decls[BUILT_IN_COPYSIGN];\n \t  break;\n \tdefault:\n \t  abort ();\n \t}\n-      se->expr = gfc_build_function_call (tmp, arg);\n+      se->expr = fold (gfc_build_function_call (tmp, arg));\n       return;\n     }\n "}, {"sha": "7f9e997f83b493824afa9e547ab0bbe2b65f7ea5", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=ead6d15f70bfdd702d3a7a4fbf3eaab14afcba82", "patch": "@@ -465,10 +465,6 @@ gfc_powdecl_list;\n extern GTY(()) gfc_powdecl_list gfor_fndecl_math_powi[3][2];\n extern GTY(()) tree gfor_fndecl_math_cpowf;\n extern GTY(()) tree gfor_fndecl_math_cpow;\n-extern GTY(()) tree gfor_fndecl_math_cabsf;\n-extern GTY(()) tree gfor_fndecl_math_cabs;\n-extern GTY(()) tree gfor_fndecl_math_sign4;\n-extern GTY(()) tree gfor_fndecl_math_sign8;\n extern GTY(()) tree gfor_fndecl_math_ishftc4;\n extern GTY(()) tree gfor_fndecl_math_ishftc8;\n extern GTY(()) tree gfor_fndecl_math_exponent4;"}]}