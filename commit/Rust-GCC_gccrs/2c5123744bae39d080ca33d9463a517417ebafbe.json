{"sha": "2c5123744bae39d080ca33d9463a517417ebafbe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmM1MTIzNzQ0YmFlMzlkMDgwY2EzM2Q5NDYzYTUxNzQxN2ViYWZiZQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-01-01T15:40:29Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-01-01T15:40:29Z"}, "message": "re PR middle-end/77484 (Static branch predictor causes ~6-8% regression of SPEC2000 GAP)\n\n\n\tPR middle-end/77484\n\t* predict.def (PRED_CALL): Update hitrate.\n\t(PRED_INDIR_CALL, PRED_POLYMORPHIC_CALL): New predictors.\n\t* predict.c (tree_estimate_probability_bb): Split CALL predictor\n\tinto direct/indirect/polymorphic variants.\n\nFrom-SVN: r243995", "tree": {"sha": "475c65d4ed2a25b62b2d50aab21862505952302c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/475c65d4ed2a25b62b2d50aab21862505952302c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c5123744bae39d080ca33d9463a517417ebafbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c5123744bae39d080ca33d9463a517417ebafbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c5123744bae39d080ca33d9463a517417ebafbe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c5123744bae39d080ca33d9463a517417ebafbe/comments", "author": null, "committer": null, "parents": [{"sha": "cbe34bb5edd97015e38c483516492f171bf9f95d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbe34bb5edd97015e38c483516492f171bf9f95d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbe34bb5edd97015e38c483516492f171bf9f95d"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "a5767870bcabef7894358c532af0a343029316c2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c5123744bae39d080ca33d9463a517417ebafbe/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c5123744bae39d080ca33d9463a517417ebafbe/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2c5123744bae39d080ca33d9463a517417ebafbe", "patch": "@@ -1,3 +1,11 @@\n+2017-01-01  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR middle-end/77484\n+\t* predict.def (PRED_CALL): Update hitrate.\n+\t(PRED_INDIR_CALL, PRED_POLYMORPHIC_CALL): New predictors.\n+\t* predict.c (tree_estimate_probability_bb): Split CALL predictor\n+\tinto direct/indirect/polymorphic variants.\n+\n 2017-01-01  Jakub Jelinek  <jakub@redhat.com>\n \n \tUpdate copyright years."}, {"sha": "e85573bc51dd5ea2e1bf07f6599e7b4393ddc651", "filename": "gcc/predict.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c5123744bae39d080ca33d9463a517417ebafbe/gcc%2Fpredict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c5123744bae39d080ca33d9463a517417ebafbe/gcc%2Fpredict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpredict.c?ref=2c5123744bae39d080ca33d9463a517417ebafbe", "patch": "@@ -2786,7 +2786,12 @@ tree_estimate_probability_bb (basic_block bb)\n \t\t     something exceptional.  */\n \t\t  && gimple_has_side_effects (stmt))\n \t\t{\n-\t\t  predict_edge_def (e, PRED_CALL, NOT_TAKEN);\n+\t\t  if (gimple_call_fndecl (stmt))\n+\t\t    predict_edge_def (e, PRED_CALL, NOT_TAKEN);\n+\t\t  else if (virtual_method_call_p (gimple_call_fn (stmt)))\n+\t\t    predict_edge_def (e, PRED_POLYMORPHIC_CALL, TAKEN);\n+\t\t  else\n+\t\t    predict_edge_def (e, PRED_INDIR_CALL, TAKEN);\n \t\t  break;\n \t\t}\n \t    }"}, {"sha": "b6b2a402b22e1598ff9350b93197b61c166ae5a0", "filename": "gcc/predict.def", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c5123744bae39d080ca33d9463a517417ebafbe/gcc%2Fpredict.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c5123744bae39d080ca33d9463a517417ebafbe/gcc%2Fpredict.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpredict.def?ref=2c5123744bae39d080ca33d9463a517417ebafbe", "patch": "@@ -116,7 +116,13 @@ DEF_PREDICTOR (PRED_TREE_OPCODE_NONEQUAL, \"opcode values nonequal (on trees)\",\n DEF_PREDICTOR (PRED_TREE_FPOPCODE, \"fp_opcode (on trees)\", HITRATE (90), 0)\n \n /* Branch guarding call is probably taken.  */\n-DEF_PREDICTOR (PRED_CALL, \"call\", HITRATE (67), 0)\n+DEF_PREDICTOR (PRED_CALL, \"call\", HITRATE (55), 0)\n+\n+/* PRED_CALL is not very reliable predictor and it turns out to be even\n+   less reliable for indirect calls and polymorphic calls.  For spec2k6\n+   the predictio nis slightly in the direction of taking the call.  */\n+DEF_PREDICTOR (PRED_INDIR_CALL, \"indirect call\", HITRATE (51), 0)\n+DEF_PREDICTOR (PRED_POLYMORPHIC_CALL, \"polymorphic call\", HITRATE (58), 0)\n \n /* Recursive calls are usually not taken or the function will recurse\n    indefinitely.  */"}]}