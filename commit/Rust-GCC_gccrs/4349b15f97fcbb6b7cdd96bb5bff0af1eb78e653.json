{"sha": "4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDM0OWIxNWY5N2ZjYmI2YjdjZGQ5NmJiNWJmZjBhZjFlYjc4ZTY1Mw==", "commit": {"author": {"name": "Sudakshina Das", "email": "sudi.das@arm.com", "date": "2017-11-07T12:23:38Z"}, "committer": {"name": "Wilco Dijkstra", "email": "wilco@gcc.gnu.org", "date": "2017-11-07T12:23:38Z"}, "message": "PR80131: Simplification of 1U << (31 - x)\n\nCurrently the code A << (B - C) is not simplified.\nHowever at least a more specific case of 1U << (C -x) where\nC = precision(type) - 1 can be simplified to (1 << C) >> x.\n\nThis is done by adding a new simplification rule in match.pd.\n\n2017-11-07  Sudakshina Das  <sudi.das@arm.com>\n\n    gcc/\n\tPR middle-end/80131\n\t* match.pd: Simplify 1 << (C - x) where C = precision (x) - 1.\n\n    testsuite/\n\tPR middle-end/80131\n\t* testsuite/gcc.dg/pr80131-1.c: New Test.\n\nFrom-SVN: r254496", "tree": {"sha": "42fa37718305129f4e755dba2412234ea69883f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42fa37718305129f4e755dba2412234ea69883f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/comments", "author": {"login": "sudakshina-das-arm", "id": 28538945, "node_id": "MDQ6VXNlcjI4NTM4OTQ1", "avatar_url": "https://avatars.githubusercontent.com/u/28538945?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sudakshina-das-arm", "html_url": "https://github.com/sudakshina-das-arm", "followers_url": "https://api.github.com/users/sudakshina-das-arm/followers", "following_url": "https://api.github.com/users/sudakshina-das-arm/following{/other_user}", "gists_url": "https://api.github.com/users/sudakshina-das-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/sudakshina-das-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sudakshina-das-arm/subscriptions", "organizations_url": "https://api.github.com/users/sudakshina-das-arm/orgs", "repos_url": "https://api.github.com/users/sudakshina-das-arm/repos", "events_url": "https://api.github.com/users/sudakshina-das-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/sudakshina-das-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e268a77b59cb788637d6db4829f0fd1ddf63f6f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e268a77b59cb788637d6db4829f0fd1ddf63f6f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e268a77b59cb788637d6db4829f0fd1ddf63f6f2"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "ad93a20244a95d7c6083823924ea2e1b47b51d92", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "patch": "@@ -1,3 +1,8 @@\n+2017-11-07  Sudakshina Das  <sudi.das@arm.com>\n+\n+\tPR middle-end/80131\n+\t* match.pd: Simplify 1 << (C - x) where C = precision (x) - 1.\n+\n 2017-11-07  Marc Glisse  <marc.glisse@inria.fr>\n \n \t* match.pd ((a&~b)|(a^b),(a&~b)^~a,(a|b)&~(a^b),a|~(a^b),"}, {"sha": "49134bcb04f48f7c76c69ac8c323785505cb4f59", "filename": "gcc/match.pd", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "patch": "@@ -605,6 +605,19 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n        && tree_nop_conversion_p (type, TREE_TYPE (@1)))\n    (lshift @0 @2)))\n \n+/* Fold (1 << (C - x)) where C = precision(type) - 1\n+   into ((1 << C) >> x). */\n+(simplify\n+ (lshift integer_onep@0 (minus@1 INTEGER_CST@2 @3))\n+  (if (INTEGRAL_TYPE_P (type)\n+       && wi::eq_p (@2, TYPE_PRECISION (type) - 1)\n+       && single_use (@1))\n+   (if (TYPE_UNSIGNED (type))\n+     (rshift (lshift @0 @2) @3)\n+   (with\n+    { tree utype = unsigned_type_for (type); }\n+    (convert (rshift (lshift (convert:utype @0) @2) @3))))))\n+\n /* Fold (C1/X)*C2 into (C1*C2)/X.  */\n (simplify\n  (mult (rdiv@3 REAL_CST@0 @1) REAL_CST@2)"}, {"sha": "2032379bcd73981af21f8608d44db11bcc976575", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "patch": "@@ -1,3 +1,8 @@\n+2017-11-07  Sudakshina Das  <sudi.das@arm.com>\n+\n+\tPR middle-end/80131\n+\t* testsuite/gcc.dg/pr80131-1.c: New Test.\n+\n 2017-11-07  Marc Glisse  <marc.glisse@inria.fr>\n \n \t* gcc.dg/tree-ssa/bitops-1.c: New file."}, {"sha": "0bfe1f4f3daa621a0f727cb0001bb2dfa0fc40bc", "filename": "gcc/testsuite/gcc.dg/pr80131-1.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2Ftestsuite%2Fgcc.dg%2Fpr80131-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653/gcc%2Ftestsuite%2Fgcc.dg%2Fpr80131-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr80131-1.c?ref=4349b15f97fcbb6b7cdd96bb5bff0af1eb78e653", "patch": "@@ -0,0 +1,31 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target int32plus } */\n+/* { dg-options \"-fdump-tree-gimple\" } */\n+\n+/* Checks the simplification of:\n+   1 << (C - x) to (1 << C) >> x, where C = precision (type) - 1\n+   f1 is not simplified but f2, f3 and f4 are. */\n+\n+__INT64_TYPE__ f1 (__INT64_TYPE__ i)\n+{\n+  return (__INT64_TYPE__)1 << (31 - i);\n+}\n+\n+__INT64_TYPE__ f2 (__INT64_TYPE__ i)\n+{\n+  return (__INT64_TYPE__)1 << (63 - i);\n+}\n+\n+__UINT64_TYPE__ f3 (__INT64_TYPE__ i)\n+{\n+  return (__UINT64_TYPE__)1 << (63 - i);\n+}\n+\n+__INT32_TYPE__ f4 (__INT32_TYPE__ i)\n+{\n+  return (__INT32_TYPE__)1 << (31 - i);\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"= 31 -\"  1 \"gimple\" } } */\n+/* { dg-final { scan-tree-dump-times \"9223372036854775808 >>\" 2 \"gimple\" } } */\n+/* { dg-final { scan-tree-dump \"2147483648 >>\" \"gimple\" } } */"}]}