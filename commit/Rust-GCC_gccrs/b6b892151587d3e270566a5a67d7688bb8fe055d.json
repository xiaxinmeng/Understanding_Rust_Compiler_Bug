{"sha": "b6b892151587d3e270566a5a67d7688bb8fe055d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZiODkyMTUxNTg3ZDNlMjcwNTY2YTVhNjdkNzY4OGJiOGZlMDU1ZA==", "commit": {"author": {"name": "Andi Kleen", "email": "ak@linux.intel.com", "date": "2011-10-29T00:10:36Z"}, "committer": {"name": "Andi Kleen", "email": "ak@gcc.gnu.org", "date": "2011-10-29T00:10:36Z"}, "message": "Add gcc-ar/nm/ranlib wrappers for slim LTO v2\n\ngcc/:\n2011-10-19  Andi Kleen  <ak@linux.intel.com>\n\n\t* Makefile.in (MOSTLYCLEANFILES): Add gcc-ar/nm/ranlib.\n\t(native): Add gcc-ar, gcc-nm, gcc-ranlib.\n\t(AR_LIBS, gcc-ar, gcc-ar.o, gcc-ranlib, gcc-ranlib.o,\n         gcc-nm, gcc-nm.o, gcc-ranlib.c, gcc-nm.c): Add.\n\t(install): Depend on install-gcc-ar.\n\t(install-gcc-ar): Add.\n\t(uninstall): Uninstall gcc-ar, gcc-nm, gcc-ranlib.\n\t* gcc-ar.c: Add new file.\n\nFrom-SVN: r180642", "tree": {"sha": "8c32f7bc56485636cece052310c0804fb09db95a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8c32f7bc56485636cece052310c0804fb09db95a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6b892151587d3e270566a5a67d7688bb8fe055d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6b892151587d3e270566a5a67d7688bb8fe055d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6b892151587d3e270566a5a67d7688bb8fe055d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6b892151587d3e270566a5a67d7688bb8fe055d/comments", "author": null, "committer": null, "parents": [{"sha": "d6b0f0f14f2e90a368476bf6b90820ed9ea09ec8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6b0f0f14f2e90a368476bf6b90820ed9ea09ec8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6b0f0f14f2e90a368476bf6b90820ed9ea09ec8"}], "stats": {"total": 178, "additions": 175, "deletions": 3}, "files": [{"sha": "6686f7d8296915cd373e240d8d6224bd19f5b28a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6b892151587d3e270566a5a67d7688bb8fe055d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6b892151587d3e270566a5a67d7688bb8fe055d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b6b892151587d3e270566a5a67d7688bb8fe055d", "patch": "@@ -1,3 +1,14 @@\n+2011-10-19  Andi Kleen  <ak@linux.intel.com>\n+\n+\t* Makefile.in (MOSTLYCLEANFILES): Add gcc-ar/nm/ranlib.\n+\t(native): Add gcc-ar, gcc-nm, gcc-ranlib.\n+\t(AR_LIBS, gcc-ar, gcc-ar.o, gcc-ranlib, gcc-ranlib.o,\n+         gcc-nm, gcc-nm.o, gcc-ranlib.c, gcc-nm.c): Add.\n+\t(install): Depend on install-gcc-ar.\n+\t(install-gcc-ar): Add.\n+\t(uninstall): Uninstall gcc-ar, gcc-nm, gcc-ranlib.\n+\t* gcc-ar.c: Add new file.\n+\n 2011-10-28  Pat Haugen <pthaugen@us.ibm.com>\n \n \t* config/rs6000/rs6000.md (define_attr \"type\"): Add vecdouble."}, {"sha": "c8f6e92673d70bc09a619ac012f20851c00fa7f1", "filename": "gcc/Makefile.in", "status": "modified", "additions": 68, "deletions": 3, "changes": 71, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6b892151587d3e270566a5a67d7688bb8fe055d/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6b892151587d3e270566a5a67d7688bb8fe055d/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=b6b892151587d3e270566a5a67d7688bb8fe055d", "patch": "@@ -1545,7 +1545,8 @@ MOSTLYCLEANFILES = insn-flags.h insn-config.h insn-codes.h \\\n  genrtl.h gt-*.h gtype-*.h gtype-desc.c gtyp-input.list \\\n  xgcc$(exeext) cpp$(exeext) cc1$(exeext) $(EXTRA_PASSES) \\\n  $(EXTRA_PARTS) $(EXTRA_PROGRAMS) gcc-cross$(exeext) \\\n- $(SPECS) collect2$(exeext) lto-wrapper$(exeext) \\\n+ $(SPECS) collect2$(exeext) gcc-ar$(exeext) gcc-nm$(exeext) \\\n+ gcc-ranlib$(exeext) \\\n  gcov-iov$(build_exeext) gcov$(exeext) gcov-dump$(exeext) \\\n  gengtype$(exeext) *.[0-9][0-9].* *.[si] *-checksum.c libbackend.a \\\n  libcommon-target.a libcommon.a libgcc.mk\n@@ -1791,7 +1792,8 @@ rest.encap: lang.rest.encap\n # This is what is made with the host's compiler\n # whether making a cross compiler or not.\n native: config.status auto-host.h build-@POSUB@ $(LANGUAGES) \\\n-\t$(EXTRA_PASSES) $(EXTRA_PROGRAMS) $(COLLECT2) lto-wrapper$(exeext)\n+\t$(EXTRA_PASSES) $(EXTRA_PROGRAMS) $(COLLECT2) lto-wrapper$(exeext) \\\n+\tgcc-ar$(exeext) gcc-nm$(exeext) gcc-ranlib$(exeext)\n \n ifeq ($(enable_plugin),yes)\n native: gengtype$(exeext)\n@@ -2049,6 +2051,46 @@ sbitmap.o: sbitmap.c sbitmap.h $(CONFIG_H) $(SYSTEM_H) coretypes.h $(BASIC_BLOCK\n ebitmap.o: ebitmap.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(EBITMAP_H)\n sparseset.o: sparseset.c $(SYSTEM_H) sparseset.h $(CONFIG_H)\n \n+AR_LIBS = @COLLECT2_LIBS@\n+\n+gcc-ar$(exeext): gcc-ar.o $(LIBDEPS)\n+\t+$(LINKER) $(ALL_LINKERFLAGS) $(LDFLAGS) gcc-ar.o -o $@ \\\n+\t\t$(LIBS) $(AR_LIBS)\n+\n+gcc-nm$(exeext): gcc-nm.o $(LIBDEPS)\n+\t+$(LINKER) $(ALL_LINKERFLAGS) $(LDFLAGS) gcc-nm.o -o $@ \\\n+\t\t$(LIBS) $(AR_LIBS)\n+\n+gcc-ranlib$(exeext): gcc-ranlib.o $(LIBDEPS)\n+\t+$(LINKER) $(ALL_LINKERFLAGS) $(LDFLAGS) gcc-ranlib.o -o $@ \\\n+\t\t$(LIBS) $(AR_LIBS)\n+\n+CFLAGS-gcc-ar.o += $(DRIVER_DEFINES) \\\n+\t-DTARGET_MACHINE=\\\"$(target_noncanonical)\\\" \\\n+\t@TARGET_SYSTEM_ROOT_DEFINE@ -DPERSONALITY=\\\"ar\\\"\n+\n+gcc-ar.o: gcc-ar.c $(CONFIG_H) $(SYSTEM_H) $(LIBIBERTY_H)\n+\n+CFLAGS-gcc-ranlib.o += $(DRIVER_DEFINES) \\\n+\t-DTARGET_MACHINE=\\\"$(target_noncanonical)\\\" \\\n+\t@TARGET_SYSTEM_ROOT_DEFINE@ -DPERSONALITY=\\\"ranlib\\\"\n+\n+gcc-ranlib.o: gcc-ranlib.c $(CONFIG_H) $(SYSTEM_H) $(LIBIBERTY_H)\n+\n+CFLAGS-gcc-nm.o += $(DRIVER_DEFINES) \\\n+\t-DTARGET_MACHINE=\\\"$(target_noncanonical)\\\" \\\n+\t@TARGET_SYSTEM_ROOT_DEFINE@ -DPERSONALITY=\\\"nm\\\"\n+\n+gcc-nm.o: gcc-nm.c $(CONFIG_H) $(SYSTEM_H) $(LIBIBERTY_H)\n+\n+# ??? the implicit rules dont trigger if the source file has a different name\n+# so copy instead\n+gcc-ranlib.c: gcc-ar.c\n+\tcp $^ $@\n+\n+gcc-nm.c: gcc-ar.c\n+\tcp $^ $@\n+\n COLLECT2_OBJS = collect2.o collect2-aix.o tlink.o\n COLLECT2_LIBS = @COLLECT2_LIBS@\n collect2$(exeext): $(COLLECT2_OBJS) $(LIBDEPS)\n@@ -4579,7 +4621,7 @@ maintainer-clean:\n # broken is small.\n install: install-common $(INSTALL_HEADERS) \\\n     install-cpp install-man install-info install-@POSUB@ \\\n-    install-driver install-lto-wrapper\n+    install-driver install-lto-wrapper install-gcc-ar\n \n ifeq ($(enable_plugin),yes)\n install: install-plugin\n@@ -4904,6 +4946,23 @@ install-collect2: collect2 installdirs\n install-lto-wrapper: lto-wrapper$(exeext)\n \t$(INSTALL_PROGRAM) lto-wrapper$(exeext) $(DESTDIR)$(libexecsubdir)/lto-wrapper$(exeext)\n \n+install-gcc-ar:\n+\tset -e ; \\\n+\tfor i in ar nm ranlib ; do \\\n+\t  install_name=`echo gcc-$$i|sed '$(program_transform_name)'`$(exeext) ;\\\n+\t  target_install_name=$(target_noncanonical)-`echo gcc-$$i|sed '$(program_transform_name)'`$(exeext) ; \\\n+\t  binname=gcc-$$i$(exeext) ; \\\n+\t  rm -f $(DESTDIR)$(bindir)/$$install_name ; \\\n+\t  rm -f $(DESTDIR)$(bindir)/$$target_install_name ; \\\n+\t  $(INSTALL_PROGRAM) $$binname $(DESTDIR)$(bindir)/$$install_name ;\\\n+\t  if test -f $(DESTDIR)$(bindir)$$target_install_name ; then \\\n+\t    :; \\\n+\t  else \\\n+\t    ( cd $(DESTDIR)$(bindir) && \\\n+\t      $(LN) $$install_name $$target_install_name ) ; \\\n+\t  fi ; \\\n+\tdone\n+\n # Cancel installation by deleting the installed files.\n uninstall: lang.uninstall\n \t-rm -rf $(DESTDIR)$(libsubdir)\n@@ -4918,6 +4977,12 @@ uninstall: lang.uninstall\n \t-rm -rf $(DESTDIR)$(man1dir)/cpp$(man1ext)\n \t-rm -f $(DESTDIR)$(infodir)/cpp.info* $(DESTDIR)$(infodir)/gcc.info*\n \t-rm -f $(DESTDIR)$(infodir)/cppinternals.info* $(DESTDIR)$(infodir)/gccint.info*\n+\tfor i in ar nm ranlib ; do \\\n+\t  install_name=`echo gcc-$$i|sed '$(program_transform_name)'`$(exeext) ;\\\n+\t  target_install_name=$(target_noncanonical)-`echo gcc-$$i|sed '$(program_transform_name)'`$(exeext) ; \\\n+\t  rm -f $(DESTDIR)$(bindir)/$$install_name ; \\\n+\t  rm -f $(DESTDIR)$(bindir)/$$target_install_name ; \\\n+\tdone\n #\f\n # These targets are for the dejagnu testsuites. The file site.exp\n # contains global variables that all the testsuites will use."}, {"sha": "fc7e4a2a2ec3977bf8b03a1671e0e1e0ae058dc9", "filename": "gcc/gcc-ar.c", "status": "added", "additions": 96, "deletions": 0, "changes": 96, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6b892151587d3e270566a5a67d7688bb8fe055d/gcc%2Fgcc-ar.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6b892151587d3e270566a5a67d7688bb8fe055d/gcc%2Fgcc-ar.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc-ar.c?ref=b6b892151587d3e270566a5a67d7688bb8fe055d", "patch": "@@ -0,0 +1,96 @@\n+/* Wrapper for ar/ranlib/nm to pass the LTO plugin.\n+   Copyright (C) 2011 Free Software Foundation, Inc.\n+   Contributed by Andi Kleen.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify it under\n+the terms of the GNU General Public License as published by the Free\n+Software Foundation; either version 3, or (at your option) any later\n+version.\n+\n+GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GCC; see the file COPYING3.  If not see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#include <stdio.h>\n+#include \"config.h\"\n+#include \"system.h\"\n+#include \"libiberty.h\"\n+\n+#ifndef PERSONALITY\n+#error \"Please set personality\"\n+#endif\n+\n+static const char standard_libexec_prefix[] = STANDARD_LIBEXEC_PREFIX;\n+static const char standard_bin_prefix[] = STANDARD_BINDIR_PREFIX;\n+\n+static const char dir_separator[] = { DIR_SEPARATOR, 0 };\n+\n+int \n+main(int ac, char **av)\n+{\n+  const char *nprefix;\n+  const char *exe_name;\n+  char *plugin;\n+  int k, status, err;\n+  const char *err_msg;\n+  const char **nargv;\n+  bool is_ar = !strcmp (PERSONALITY, \"ar\");\n+\n+  exe_name = PERSONALITY;\n+#ifdef CROSS_DIRECTORY_STRUCTURE\n+  exe_name = concat (target_machine, \"-\", exe_name, NULL);\n+#endif\n+\n+  /* Find plugin */\n+  /* XXX implement more magic from gcc.c? */\n+  nprefix = getenv (\"GCC_EXEC_PREFIX\");\n+  if (!nprefix)\n+    nprefix = standard_libexec_prefix;\n+\n+  nprefix = make_relative_prefix (av[0], \n+\t\t\t\t  standard_bin_prefix, \n+\t\t\t\t  nprefix);\n+  plugin = concat (nprefix,\n+\t\t   dir_separator,\n+                   DEFAULT_TARGET_MACHINE, \n+\t\t   dir_separator,\n+\t\t   DEFAULT_TARGET_VERSION,\n+\t           dir_separator,\n+\t\t   LTOPLUGINSONAME,\n+\t\t   NULL);\n+  if (access (plugin, X_OK))\n+    {\n+      fprintf (stderr, \"%s: Cannot find plugin %s\\n\", av[0], plugin);\n+      exit (1);\n+    }\n+\n+  /* Create new command line with plugin */\n+  nargv = XCNEWVEC (const char *, ac + 4);\n+  nargv[0] = exe_name;\n+  nargv[1] = \"--plugin\";\n+  nargv[2] = plugin;\n+  if (is_ar && av[1] && av[1][0] != '-')\n+    av[1] = concat(\"-\", av[1], NULL);\n+  for (k = 1; k < ac; k++)\n+    nargv[2 + k] = av[k];\n+  nargv[2 + k] = NULL;\n+\n+  /* Run utility */\n+  /* ??? the const is misplaced in pex_one's argv? */\n+  err_msg = pex_one (PEX_LAST|PEX_SEARCH, \n+\t\t     exe_name, \n+\t\t     CONST_CAST2 (char * const *, const char **, nargv),\n+\t\t     concat(\"gcc-\", exe_name, NULL), \n+\t\t     NULL,NULL,  &status, &err);\n+  if (err_msg) \n+    fprintf(stderr, \"Error running %s: %s\\n\", exe_name, err_msg);\n+\n+  return err;\n+}"}]}