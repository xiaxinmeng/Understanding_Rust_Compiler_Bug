{"sha": "eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWIxMzg3YTA1MTFiMGI3MWM5MDFjN2E5NDU4Y2VhMWNjMmY5MTFjNA==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2008-01-16T09:44:23Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2008-01-16T09:44:23Z"}, "message": "re PR c/34768 (Wrong code with conditional function invocation)\n\n2008-01-16  Richard Guenther  <rguenther@suse.de>\n\n\tPR c/34768\n\t* c-typeck.c (common_pointer_type): Do not merge inconsistent\n\ttype qualifiers for function types.\n\n\t* gcc.c-torture/execute/pr34768-1.c: New testcase.\n\t* gcc.c-torture/execute/pr34768-2.c: Likewise.\n\nFrom-SVN: r131568", "tree": {"sha": "4a6974a6ea8f6fdba10c4b24af2794548a43d1dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4a6974a6ea8f6fdba10c4b24af2794548a43d1dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4349e292879d8bc589a8a2b52defe5e754d75a16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4349e292879d8bc589a8a2b52defe5e754d75a16", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4349e292879d8bc589a8a2b52defe5e754d75a16"}], "stats": {"total": 80, "additions": 76, "deletions": 4}, "files": [{"sha": "dd099a44055cb42156083af351266e34be5e71b6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "patch": "@@ -1,3 +1,9 @@\n+2008-01-16  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR c/34768\n+\t* c-typeck.c (common_pointer_type): Do not merge inconsistent\n+\ttype qualifiers for function types.\n+\n 2008-01-15  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* tree-parloops (gen_parallel_loop): Revert my fix."}, {"sha": "fb2e47f096996e7883cc90dcd5d61c8500fada7c", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "patch": "@@ -530,6 +530,7 @@ common_pointer_type (tree t1, tree t2)\n   tree pointed_to_1, mv1;\n   tree pointed_to_2, mv2;\n   tree target;\n+  unsigned target_quals;\n \n   /* Save time if the two types are the same.  */\n \n@@ -557,10 +558,15 @@ common_pointer_type (tree t1, tree t2)\n   if (TREE_CODE (mv2) != ARRAY_TYPE)\n     mv2 = TYPE_MAIN_VARIANT (pointed_to_2);\n   target = composite_type (mv1, mv2);\n-  t1 = build_pointer_type (c_build_qualified_type\n-\t\t\t   (target,\n-\t\t\t    TYPE_QUALS (pointed_to_1) |\n-\t\t\t    TYPE_QUALS (pointed_to_2)));\n+\n+  /* For function types do not merge const qualifiers, but drop them\n+     if used inconsistently.  The middle-end uses these to mark const\n+     and noreturn functions.  */\n+  if (TREE_CODE (pointed_to_1) == FUNCTION_TYPE)\n+    target_quals = TYPE_QUALS (pointed_to_1) & TYPE_QUALS (pointed_to_2);\n+  else\n+    target_quals = TYPE_QUALS (pointed_to_1) | TYPE_QUALS (pointed_to_2);\n+  t1 = build_pointer_type (c_build_qualified_type (target, target_quals));\n   return build_type_attribute_variant (t1, attributes);\n }\n "}, {"sha": "b69ff98543974e324080e2d1552193d4337d40c9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "patch": "@@ -1,3 +1,9 @@\n+2008-01-16  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR c/34768\n+\t* gcc.c-torture/execute/pr34768-1.c: New testcase.\n+\t* gcc.c-torture/execute/pr34768-2.c: Likewise.\n+\n 2008-01-16  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/34796"}, {"sha": "eb16adbf1f351153993698a6d41f4061153df7d3", "filename": "gcc/testsuite/gcc.c-torture/execute/pr34768-1.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr34768-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr34768-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr34768-1.c?ref=eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "patch": "@@ -0,0 +1,26 @@\n+int x;\n+\n+void __attribute__((noinline)) foo (void)\n+{\n+  x = -x;\n+}\n+void __attribute__((const,noinline)) bar (void)\n+{\n+}\n+\n+int __attribute__((noinline))\n+test (int c)\n+{\n+  int tmp = x;\n+  (c ? foo : bar) ();\n+  return tmp + x;\n+}\n+\n+extern void abort (void);\n+int main()\n+{\n+  x = 1;\n+  if (test (1) != 0)\n+    abort ();\n+  return 0;\n+}"}, {"sha": "917bf9e2b6f99e6f355b038792c6be4ade53c2fa", "filename": "gcc/testsuite/gcc.c-torture/execute/pr34768-2.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr34768-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb1387a0511b0b71c901c7a9458cea1cc2f911c4/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr34768-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr34768-2.c?ref=eb1387a0511b0b71c901c7a9458cea1cc2f911c4", "patch": "@@ -0,0 +1,28 @@\n+int x;\n+\n+int __attribute__((noinline)) foo (void)\n+{\n+  x = -x;\n+  return 0;\n+}\n+int __attribute__((const,noinline)) bar (void)\n+{\n+  return 0;\n+}\n+\n+int __attribute__((noinline))\n+test (int c)\n+{\n+  int tmp = x;\n+  int res = (c ? foo : bar) ();\n+  return tmp + x + res;\n+}\n+\n+extern void abort (void);\n+int main()\n+{\n+  x = 1;\n+  if (test (1) != 0)\n+    abort ();\n+  return 0;\n+}"}]}