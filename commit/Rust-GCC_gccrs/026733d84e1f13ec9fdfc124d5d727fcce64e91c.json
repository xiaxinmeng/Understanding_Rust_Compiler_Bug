{"sha": "026733d84e1f13ec9fdfc124d5d727fcce64e91c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDI2NzMzZDg0ZTFmMTNlYzlmZGZjMTI0ZDVkNzI3ZmNjZTY0ZTkxYw==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2018-05-23T10:23:24Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-05-23T10:23:24Z"}, "message": "[Ada] Crash processing Valid_Scalars whose evaluation is always true\n\nThe compiler blows up generating code associated with occurrences of attribute\nValid_Scalars whose evaluation is always true. After this patch the following\ntest compiles fine.\n\n2018-05-23  Javier Miranda  <miranda@adacore.com>\n\ngcc/ada/\n\n\t* sem_attr.adb (Valid_Scalars): Do not invoke Error_Attr_P to report\n\tthe warning on occurrences of this attribute whose evaluation is always\n\ttrue (since that subprogram aborts processing the attribute). In\n\taddition, replace the node by its boolean result 'True' (required\n\tbecause the backend has no knowledge of this attribute).\n\ngcc/testsuite/\n\n\t* gnat.dg/valid_scalars1.adb: New testcase.\n\nFrom-SVN: r260591", "tree": {"sha": "cf3d2ff150c4e3a8fdacd899b48463e44dfcadd1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf3d2ff150c4e3a8fdacd899b48463e44dfcadd1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/026733d84e1f13ec9fdfc124d5d727fcce64e91c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/026733d84e1f13ec9fdfc124d5d727fcce64e91c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/026733d84e1f13ec9fdfc124d5d727fcce64e91c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/026733d84e1f13ec9fdfc124d5d727fcce64e91c/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aeaa0347e94b1dfa040809b3b098fcc0474d45f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aeaa0347e94b1dfa040809b3b098fcc0474d45f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aeaa0347e94b1dfa040809b3b098fcc0474d45f7"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "8874e6ad152ccabaa5f7c69b8480325be1d0e0f2", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=026733d84e1f13ec9fdfc124d5d727fcce64e91c", "patch": "@@ -1,3 +1,11 @@\n+2018-05-23  Javier Miranda  <miranda@adacore.com>\n+\n+\t* sem_attr.adb (Valid_Scalars): Do not invoke Error_Attr_P to report\n+\tthe warning on occurrences of this attribute whose evaluation is always\n+\ttrue (since that subprogram aborts processing the attribute). In\n+\taddition, replace the node by its boolean result 'True' (required\n+\tbecause the backend has no knowledge of this attribute).\n+\n 2018-05-23  Bob Duff  <duff@adacore.com>\n \n \t* libgnat/a-convec.adb: (Insert, Insert_Space): Suppress warnings. The"}, {"sha": "f94cbadc9f813c4f0fb3260eb5e71bc6bc779ff2", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=026733d84e1f13ec9fdfc124d5d727fcce64e91c", "patch": "@@ -6929,8 +6929,10 @@ package body Sem_Attr is\n \n             else\n                if not Scalar_Part_Present (P_Type) then\n-                  Error_Attr_P\n-                    (\"??attribute % always True, no scalars to check\");\n+                  Error_Msg_Name_1 := Aname;\n+                  Error_Msg_F\n+                    (\"??attribute % always True, no scalars to check\", P);\n+                  Set_Boolean_Result (N, True);\n                end if;\n \n                --  Attribute 'Valid_Scalars is illegal on unchecked union types"}, {"sha": "cd836e893407f2db0cdcbf9bddf004e6df14acff", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=026733d84e1f13ec9fdfc124d5d727fcce64e91c", "patch": "@@ -1,3 +1,7 @@\n+2018-05-23  Javier Miranda  <miranda@adacore.com>\n+\n+\t* gnat.dg/valid_scalars1.adb: New testcase.\n+\n 2018-05-23  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/iter1.adb, gnat.dg/iter1.ads: New testcase."}, {"sha": "0b010487ed3145737d68e8dd12bebe21e40d5eea", "filename": "gcc/testsuite/gnat.dg/valid_scalars1.adb", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Ftestsuite%2Fgnat.dg%2Fvalid_scalars1.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/026733d84e1f13ec9fdfc124d5d727fcce64e91c/gcc%2Ftestsuite%2Fgnat.dg%2Fvalid_scalars1.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fvalid_scalars1.adb?ref=026733d84e1f13ec9fdfc124d5d727fcce64e91c", "patch": "@@ -0,0 +1,11 @@\n+--  { dg-do compile }\n+--  { dg-options \"-gnata -gnatws\" }\n+\n+procedure Valid_Scalars1 is\n+   type Ptr is access Integer;\n+   V1 : Ptr;\n+\n+   Check : Boolean := V1'Valid_Scalars;\n+begin\n+   pragma Assert (Check);\n+end;"}]}