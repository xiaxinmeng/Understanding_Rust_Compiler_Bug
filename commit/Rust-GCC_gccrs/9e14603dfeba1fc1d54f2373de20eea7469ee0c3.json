{"sha": "9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWUxNDYwM2RmZWJhMWZjMWQ1NGYyMzczZGUyMGVlYTc0NjllZTBjMw==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@linux.alibaba.com", "date": "2019-04-23T03:54:59Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2019-04-23T03:54:59Z"}, "message": "re PR tree-optimization/90021 (ICE in index_in_loop_nest, at tree-data-ref.h:587 since r270203)\n\n\tPR tree-optimization/92001\n\t* tree-chrec.c (evolution_function_is_univariate_p): New parameter\n\tand check univariate against it.\n\t* tree-chrec.h (evolution_function_is_univariate_p): New parameter.\n\t* tree-data-ref.c (add_other_self_distances): Pass new argument.\n\n\tgcc/testsuite\n\t* gcc/testsuite/gfortran.dg/pr90021.f90: New test.\n\nFrom-SVN: r270499", "tree": {"sha": "f859612eaba12970593f1be51bca49c98d577ba7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f859612eaba12970593f1be51bca49c98d577ba7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/comments", "author": null, "committer": null, "parents": [{"sha": "6e8fc175bda51464ac124fcf20df62fd19801203", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e8fc175bda51464ac124fcf20df62fd19801203", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e8fc175bda51464ac124fcf20df62fd19801203"}], "stats": {"total": 62, "additions": 54, "deletions": 8}, "files": [{"sha": "e52b4c45cd6bb5a5900c967225fb2924b69e3f74", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "patch": "@@ -1,3 +1,11 @@\n+2019-04-23  Bin Cheng  <bin.cheng@linux.alibaba.com>\n+\n+\tPR tree-optimization/92001\n+\t* tree-chrec.c (evolution_function_is_univariate_p): New parameter\n+\tand check univariate against it.\n+\t* tree-chrec.h (evolution_function_is_univariate_p): New parameter.\n+\t* tree-data-ref.c (add_other_self_distances): Pass new argument.\n+\n 2019-04-21  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/90178"}, {"sha": "e855e15d93fbf52c044c9d0a18ba7efab951ba32", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "patch": "@@ -1,3 +1,8 @@\n+2018-04-23  Bin Cheng  <bin.cheng@linux.alibaba.com>\n+\n+\tPR tree-optimization/92001\n+\t* gcc/testsuite/gfortran.dg/pr90021.f90: New test.\n+\n 2019-04-22  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/90166"}, {"sha": "4689e8b9634ec6504aeabb2603508779b0a0baac", "filename": "gcc/testsuite/gfortran.dg/pr90021.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr90021.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr90021.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr90021.f90?ref=9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do compile }\n+! { dg-options \"-fno-tree-loop-ivcanon -O1 -floop-interchange -fno-tree-ccp -fno-tree-ch -fipa-pta\" }\n+! PR tree-optimization/90021\n+\n+MODULE a\n+  INTEGER b\n+CONTAINS\n+  SUBROUTINE bar(c)\n+    REAL c(1)\n+    INTEGER g, d, e, f \n+    DO g = 1,3\n+      DO f = 1,1\n+        DO e = 1,3\n+          DO d = 1,1\n+            c(f-1+d) = c(f-1+d)*b\n+          END DO\n+        END DO\n+      END DO\n+    END DO\n+  END\n+  END"}, {"sha": "813b87fd00b312294eecf801f46bff85cfd399c0", "filename": "gcc/tree-chrec.c", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftree-chrec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftree-chrec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-chrec.c?ref=9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "patch": "@@ -1142,23 +1142,30 @@ evolution_function_is_affine_multivariate_p (const_tree chrec, int loopnum)\n }\n \n /* Determine whether the given tree is a function in zero or one\n-   variables.  */\n+   variables with respect to loop specified by LOOPNUM.  Note only positive\n+   LOOPNUM stands for a real loop.  */\n \n bool\n-evolution_function_is_univariate_p (const_tree chrec)\n+evolution_function_is_univariate_p (const_tree chrec, int loopnum)\n {\n   if (chrec == NULL_TREE)\n     return true;\n \n+  tree sub_chrec;\n   switch (TREE_CODE (chrec))\n     {\n     case POLYNOMIAL_CHREC:\n       switch (TREE_CODE (CHREC_LEFT (chrec)))\n \t{\n \tcase POLYNOMIAL_CHREC:\n-\t  if (CHREC_VARIABLE (chrec) != CHREC_VARIABLE (CHREC_LEFT (chrec)))\n+\t  sub_chrec = CHREC_LEFT (chrec);\n+\t  if (CHREC_VARIABLE (chrec) != CHREC_VARIABLE (sub_chrec)\n+\t      && (loopnum <= 0\n+\t\t  || CHREC_VARIABLE (sub_chrec) == (unsigned) loopnum\n+\t\t  || flow_loop_nested_p (get_loop (cfun, loopnum),\n+\t\t\t\t\t get_chrec_loop (sub_chrec))))\n \t    return false;\n-\t  if (!evolution_function_is_univariate_p (CHREC_LEFT (chrec)))\n+\t  if (!evolution_function_is_univariate_p (sub_chrec, loopnum))\n \t    return false;\n \t  break;\n \n@@ -1171,9 +1178,14 @@ evolution_function_is_univariate_p (const_tree chrec)\n       switch (TREE_CODE (CHREC_RIGHT (chrec)))\n \t{\n \tcase POLYNOMIAL_CHREC:\n-\t  if (CHREC_VARIABLE (chrec) != CHREC_VARIABLE (CHREC_RIGHT (chrec)))\n+\t  sub_chrec = CHREC_RIGHT (chrec);\n+\t  if (CHREC_VARIABLE (chrec) != CHREC_VARIABLE (sub_chrec)\n+\t      && (loopnum <= 0\n+\t\t  || CHREC_VARIABLE (sub_chrec) == (unsigned) loopnum\n+\t\t  || flow_loop_nested_p (get_loop (cfun, loopnum),\n+\t\t\t\t\t get_chrec_loop (sub_chrec))))\n \t    return false;\n-\t  if (!evolution_function_is_univariate_p (CHREC_RIGHT (chrec)))\n+\t  if (!evolution_function_is_univariate_p (sub_chrec, loopnum))\n \t    return false;\n \t  break;\n "}, {"sha": "dbbc1b182ac3d40504b1aeb6199b1f5b476def30", "filename": "gcc/tree-chrec.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftree-chrec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftree-chrec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-chrec.h?ref=9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "patch": "@@ -85,7 +85,7 @@ extern bool chrec_contains_symbols_defined_in_loop (const_tree, unsigned);\n extern bool chrec_contains_undetermined (const_tree);\n extern bool tree_contains_chrecs (const_tree, int *);\n extern bool evolution_function_is_affine_multivariate_p (const_tree, int);\n-extern bool evolution_function_is_univariate_p (const_tree);\n+extern bool evolution_function_is_univariate_p (const_tree, int = 0);\n extern unsigned nb_vars_in_chrec (tree);\n extern bool evolution_function_is_invariant_p (tree, int);\n extern bool scev_is_linear_expression (tree);"}, {"sha": "ccb1cfc53695a4bde30f92f9488fac0cf7a07bbf", "filename": "gcc/tree-data-ref.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftree-data-ref.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e14603dfeba1fc1d54f2373de20eea7469ee0c3/gcc%2Ftree-data-ref.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-data-ref.c?ref=9e14603dfeba1fc1d54f2373de20eea7469ee0c3", "patch": "@@ -4431,7 +4431,7 @@ add_other_self_distances (struct data_dependence_relation *ddr)\n \n       if (TREE_CODE (access_fun) == POLYNOMIAL_CHREC)\n \t{\n-\t  if (!evolution_function_is_univariate_p (access_fun))\n+\t  if (!evolution_function_is_univariate_p (access_fun, loop->num))\n \t    {\n \t      if (DDR_NUM_SUBSCRIPTS (ddr) != 1)\n \t\t{"}]}