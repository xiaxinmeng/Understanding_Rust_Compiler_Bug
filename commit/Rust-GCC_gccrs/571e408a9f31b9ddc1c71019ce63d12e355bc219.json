{"sha": "571e408a9f31b9ddc1c71019ce63d12e355bc219", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTcxZTQwOGE5ZjMxYjlkZGMxYzcxMDE5Y2U2M2QxMmUzNTViYzIxOQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-12-20T18:05:19Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-12-20T18:05:19Z"}, "message": "s390: Generate rxsbg, and shifted forms of rosbg\n\n        * config/s390/s390.md (IXOR): New code iterator.\n        (*r<IXOR>sbg_<GPR>_noshift): Rename from *insv<GPR>_or_z10_noshift;\n        macro-ize to handle XOR too.\n        (*r<IXOR>sbg_di_rotl, *r<IXOR>sbg_<GPR>_srl, *r<IXOR>sbg_<GPR>_sll):\n        New patterns.\n\nCo-Authored-By: Andreas Krebbel <Andreas.Krebbel@de.ibm.com>\n\nFrom-SVN: r194645", "tree": {"sha": "9185eb4c3a256079a66c576e7d71ae9b04890234", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9185eb4c3a256079a66c576e7d71ae9b04890234"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/571e408a9f31b9ddc1c71019ce63d12e355bc219", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/571e408a9f31b9ddc1c71019ce63d12e355bc219", "html_url": "https://github.com/Rust-GCC/gccrs/commit/571e408a9f31b9ddc1c71019ce63d12e355bc219", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/571e408a9f31b9ddc1c71019ce63d12e355bc219/comments", "author": null, "committer": null, "parents": [{"sha": "1a2e356efefb29718ef217149c0df76fcb4ac08a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a2e356efefb29718ef217149c0df76fcb4ac08a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a2e356efefb29718ef217149c0df76fcb4ac08a"}], "stats": {"total": 69, "additions": 62, "deletions": 7}, "files": [{"sha": "b01203fa900cf513e9175b1a8b166af2c3334e22", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/571e408a9f31b9ddc1c71019ce63d12e355bc219/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/571e408a9f31b9ddc1c71019ce63d12e355bc219/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=571e408a9f31b9ddc1c71019ce63d12e355bc219", "patch": "@@ -28,7 +28,13 @@\n \t(*extzv<GPR>_zEC12, *extzv<GPR>_z10): New insns.\n \t(*pre_z10_extzv<GPR>): Rename from *extzv<GPR>; simplify with\n \tnonzero_shift_count_operand.\n-\t(*extzv_<mode>_srl, *extzv_<mode>_sll): New insns.\n+\t(*extzv_<GPR>_srl, *extzv_<GPR>_sll): New insns.\n+\n+\t* config/s390/s390.md (IXOR): New code iterator.\n+\t(*r<IXOR>sbg_<GPR>_noshift): Rename from *insv<GPR>_or_z10_noshift;\n+\tmacro-ize to handle XOR too.\n+\t(*r<IXOR>sbg_di_rotl, *r<IXOR>sbg_<GPR>_srl, *r<IXOR>sbg_<GPR>_sll):\n+\tNew patterns.\n \n 2012-12-20  Thomas Schwinge  <thomas@codesourcery.com>\n "}, {"sha": "3a1b4c036512e6d9434dd8cc77e828946302177e", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 55, "deletions": 6, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/571e408a9f31b9ddc1c71019ce63d12e355bc219/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/571e408a9f31b9ddc1c71019ce63d12e355bc219/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=571e408a9f31b9ddc1c71019ce63d12e355bc219", "patch": "@@ -393,6 +393,9 @@\n ;; the same template.\n (define_code_iterator SHIFT [ashift lshiftrt])\n \n+;; This iterator allow r[ox]sbg to be defined with the same template\n+(define_code_iterator IXOR [ior xor])\n+\n ;; This iterator and attribute allow to combine most atomic operations.\n (define_code_iterator ATOMIC [and ior xor plus minus mult])\n (define_code_iterator ATOMIC_Z196 [and ior xor plus])\n@@ -3474,15 +3477,61 @@\n   [(set_attr \"op_type\" \"RIE\")\n    (set_attr \"z10prop\" \"z10_super_E1\")])\n \n-; and op1 with a mask being 1 for the selected bits and 0 for the rest\n-(define_insn \"*insv<mode>_or_z10_noshift\"\n+(define_insn \"*r<noxa>sbg_<mode>_noshift\"\n   [(set (match_operand:GPR 0 \"nonimmediate_operand\" \"=d\")\n-\t(ior:GPR (and:GPR (match_operand:GPR 1 \"nonimmediate_operand\" \"d\")\n-\t\t\t  (match_operand:GPR 2 \"contiguous_bitmask_operand\" \"\"))\n-\t\t(match_operand:GPR 3 \"nonimmediate_operand\" \"0\")))\n+\t(IXOR:GPR\n+\t  (and:GPR (match_operand:GPR 1 \"nonimmediate_operand\" \"d\")\n+                   (match_operand:GPR 2 \"contiguous_bitmask_operand\" \"\"))\n+\t  (match_operand:GPR 3 \"nonimmediate_operand\" \"0\")))\n    (clobber (reg:CC CC_REGNUM))]\n   \"TARGET_Z10\"\n-  \"rosbg\\t%0,%1,%<bfstart>2,%<bfend>2,0\"\n+  \"r<noxa>sbg\\t%0,%1,%<bfstart>2,%<bfend>2,0\"\n+  [(set_attr \"op_type\" \"RIE\")])\n+\n+(define_insn \"*r<noxa>sbg_di_rotl\"\n+  [(set (match_operand:DI 0 \"nonimmediate_operand\" \"=d\")\n+\t(IXOR:DI\n+\t  (and:DI\n+\t    (rotate:DI\n+\t      (match_operand:DI 1 \"nonimmediate_operand\" \"d\")\n+              (match_operand:DI 3 \"const_int_operand\" \"\"))\n+            (match_operand:DI 2 \"contiguous_bitmask_operand\" \"\"))\n+\t  (match_operand:DI 4 \"nonimmediate_operand\" \"0\")))\n+   (clobber (reg:CC CC_REGNUM))]\n+  \"TARGET_Z10\"\n+  \"r<noxa>sbg\\t%0,%1,%<bfstart>2,%<bfend>2,%b3\"\n+  [(set_attr \"op_type\" \"RIE\")])\n+\n+(define_insn \"*r<noxa>sbg_<mode>_srl\"\n+  [(set (match_operand:GPR 0 \"nonimmediate_operand\" \"=d\")\n+\t(IXOR:GPR\n+\t  (and:GPR\n+\t    (lshiftrt:GPR\n+              (match_operand:GPR 1 \"nonimmediate_operand\" \"d\")\n+              (match_operand:GPR 3 \"nonzero_shift_count_operand\" \"\"))\n+            (match_operand:GPR 2 \"contiguous_bitmask_operand\" \"\"))\n+\t  (match_operand:GPR 4 \"nonimmediate_operand\" \"0\")))\n+   (clobber (reg:CC CC_REGNUM))]\n+  \"TARGET_Z10\n+   && s390_extzv_shift_ok (<bitsize>, 64 - INTVAL (operands[3]),\n+                           INTVAL (operands[2]))\"\n+  \"r<noxa>sbg\\t%0,%1,%<bfstart>2,%<bfend>2,64-%3\"\n+  [(set_attr \"op_type\" \"RIE\")])\n+\n+(define_insn \"*r<noxa>sbg_<mode>_sll\"\n+  [(set (match_operand:GPR 0 \"nonimmediate_operand\" \"=d\")\n+\t(IXOR:GPR\n+\t  (and:GPR\n+\t    (ashift:GPR\n+              (match_operand:GPR 1 \"nonimmediate_operand\" \"d\")\n+              (match_operand:GPR 3 \"nonzero_shift_count_operand\" \"\"))\n+            (match_operand:GPR 2 \"contiguous_bitmask_operand\" \"\"))\n+\t  (match_operand:GPR 4 \"nonimmediate_operand\" \"0\")))\n+   (clobber (reg:CC CC_REGNUM))]\n+  \"TARGET_Z10\n+   && s390_extzv_shift_ok (<bitsize>, INTVAL (operands[3]),\n+                           INTVAL (operands[2]))\"\n+  \"r<noxa>sbg\\t%0,%1,%<bfstart>2,%<bfend>2,%3\"\n   [(set_attr \"op_type\" \"RIE\")])\n \n (define_insn \"*insv<mode>_mem_reg\""}]}