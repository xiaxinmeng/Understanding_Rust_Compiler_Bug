{"sha": "34b7ae1dd5f0c01036b2a9308baf15329280733e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzRiN2FlMWRkNWYwYzAxMDM2YjJhOTMwOGJhZjE1MzI5MjgwNzMzZQ==", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@gcc.gnu.org", "date": "2019-11-28T06:34:31Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@gcc.gnu.org", "date": "2019-11-28T06:34:31Z"}, "message": "[rs6000] Fix PR92566 by checking VECTOR_UNIT_NONE_P\n\nAs Segher pointed out in PR92566, we shouldn't offer some vector modes which\naren't supported under current setting.  This patch is to make it check by\nVECTOR_UNIT_NONE_P which is initialized as current architecture masks.\n\n2019-11-28  Kewen Lin  <linkw@gcc.gnu.org>\n\n    PR target/92566\n    * gcc/config/rs6000/rs6000.c (rs6000_preferred_simd_mode): Check by\n    VECTOR_UNIT_NONE_P instead.\n\nFrom-SVN: r278800", "tree": {"sha": "7334ed585a09e6f70e874513c99d7c48e3dcca74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7334ed585a09e6f70e874513c99d7c48e3dcca74"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/34b7ae1dd5f0c01036b2a9308baf15329280733e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34b7ae1dd5f0c01036b2a9308baf15329280733e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34b7ae1dd5f0c01036b2a9308baf15329280733e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34b7ae1dd5f0c01036b2a9308baf15329280733e/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c9cb582fc11b0106be24a3d9f428558aeb7cf45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c9cb582fc11b0106be24a3d9f428558aeb7cf45", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c9cb582fc11b0106be24a3d9f428558aeb7cf45"}], "stats": {"total": 35, "additions": 11, "deletions": 24}, "files": [{"sha": "7c7ff3f03004ca6f2d54533809351e5bd3f9b9ea", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34b7ae1dd5f0c01036b2a9308baf15329280733e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34b7ae1dd5f0c01036b2a9308baf15329280733e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=34b7ae1dd5f0c01036b2a9308baf15329280733e", "patch": "@@ -1,3 +1,9 @@\n+2019-11-28  Kewen Lin  <linkw@gcc.gnu.org>\n+\n+\tPR target/92566\n+\t* gcc/config/rs6000/rs6000.c (rs6000_preferred_simd_mode): Check\n+\tby VECTOR_UNIT_NONE_P instead.\n+\n 2019-11-28  Hongtao Liu  <hongtao.liu@inte.com>\n \n \t* gcc/config/i386/sse.md (avx512f_maskcmp<mode>3):"}, {"sha": "3c22f64c139d00f841d9e8de9ae5bb323d19398d", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 5, "deletions": 24, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34b7ae1dd5f0c01036b2a9308baf15329280733e/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34b7ae1dd5f0c01036b2a9308baf15329280733e/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=34b7ae1dd5f0c01036b2a9308baf15329280733e", "patch": "@@ -4915,30 +4915,11 @@ rs6000_builtin_vectorization_cost (enum vect_cost_for_stmt type_of_cost,\n static machine_mode\n rs6000_preferred_simd_mode (scalar_mode mode)\n {\n-  if (TARGET_VSX)\n-    switch (mode)\n-      {\n-      case E_DFmode:\n-\treturn V2DFmode;\n-      default:;\n-      }\n-  if (TARGET_ALTIVEC || TARGET_VSX)\n-    switch (mode)\n-      {\n-      case E_SFmode:\n-\treturn V4SFmode;\n-      case E_TImode:\n-\treturn V1TImode;\n-      case E_DImode:\n-\treturn V2DImode;\n-      case E_SImode:\n-\treturn V4SImode;\n-      case E_HImode:\n-\treturn V8HImode;\n-      case E_QImode:\n-\treturn V16QImode;\n-      default:;\n-      }\n+  opt_machine_mode vmode = mode_for_vector (mode, 16 / GET_MODE_SIZE (mode));\n+\n+  if (vmode.exists () && !VECTOR_UNIT_NONE_P (vmode.require ()))\n+    return vmode.require ();\n+\n   return word_mode;\n }\n "}]}