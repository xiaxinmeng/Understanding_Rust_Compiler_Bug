{"sha": "768e3c602bb1210ee8076a2b897704579a10727e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY4ZTNjNjAyYmIxMjEwZWU4MDc2YTJiODk3NzA0NTc5YTEwNzI3ZQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2011-01-26T14:03:54Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2011-01-26T14:03:54Z"}, "message": "re PR tree-optimization/47190 (ICE: in function_and_variable_visibility, at ipa.c:934 with static weakref variable)\n\n\tPR tree-optimization/47190\n\t * cgraphunit.c (process_common_attributes): New function.\n        (process_function_and_variable_attributes): Use it.\n\t* gcc.dg/attr-weakref-3.c: New testcase.\n\nFrom-SVN: r169288", "tree": {"sha": "23e86173693e6e051ef3662dcfc23b2dff6f5b46", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/23e86173693e6e051ef3662dcfc23b2dff6f5b46"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/768e3c602bb1210ee8076a2b897704579a10727e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/768e3c602bb1210ee8076a2b897704579a10727e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/768e3c602bb1210ee8076a2b897704579a10727e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/768e3c602bb1210ee8076a2b897704579a10727e/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0418e131cb2f282df950394a77616fe58c361955", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0418e131cb2f282df950394a77616fe58c361955", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0418e131cb2f282df950394a77616fe58c361955"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "a358ec7e4359205c60be37340275c275cc5b487e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=768e3c602bb1210ee8076a2b897704579a10727e", "patch": "@@ -1,3 +1,9 @@\n+2011-01-26  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/47190\n+\t * cgraphunit.c (process_common_attributes): New function.\n+        (process_function_and_variable_attributes): Use it.\n+\n 2011-01-26  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/47423"}, {"sha": "2eb3285290b77dc0e3c862c08648c3fc45461ef1", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=768e3c602bb1210ee8076a2b897704579a10727e", "patch": "@@ -791,6 +791,23 @@ cgraph_analyze_function (struct cgraph_node *node)\n   current_function_decl = save;\n }\n \n+/* Process attributes common for vars and functions.  */\n+\n+static void\n+process_common_attributes (tree decl)\n+{\n+  tree weakref = lookup_attribute (\"weakref\", DECL_ATTRIBUTES (decl));\n+\n+  if (weakref && !lookup_attribute (\"alias\", DECL_ATTRIBUTES (decl)))\n+    {\n+      warning_at (DECL_SOURCE_LOCATION (decl), OPT_Wattributes,\n+\t\t  \"%<weakref%> attribute should be accompanied with\"\n+\t\t  \" an %<alias%> attribute\");\n+      DECL_WEAK (decl) = 0;\n+      remove_attribute (\"weakref\", DECL_ATTRIBUTES (decl));\n+    }\n+}\n+\n /* Look for externally_visible and used attributes and mark cgraph nodes\n    accordingly.\n \n@@ -843,6 +860,7 @@ process_function_and_variable_attributes (struct cgraph_node *first,\n \t  else if (node->local.finalized)\n \t     cgraph_mark_needed_node (node);\n \t}\n+      process_common_attributes (decl);\n     }\n   for (vnode = varpool_nodes; vnode != first_var; vnode = vnode->next)\n     {\n@@ -869,6 +887,7 @@ process_function_and_variable_attributes (struct cgraph_node *first,\n \t  else if (vnode->finalized)\n \t    varpool_mark_needed_node (vnode);\n \t}\n+      process_common_attributes (decl);\n     }\n }\n "}, {"sha": "2d7d765dc15fb13496950bd0ded4371c2366807f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=768e3c602bb1210ee8076a2b897704579a10727e", "patch": "@@ -1,3 +1,8 @@\n+2011-01-26  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR tree-optimization/47190\n+\t* gcc.dg/attr-weakref-3.c: New testcase.\n+\n 2011-01-26  Dave Korn  <dave.korn.cygwin@gmail.com>\n \n \tPR c++/43601"}, {"sha": "fe4462a8a3a22523db0f47c25dd82e6e137aab38", "filename": "gcc/testsuite/gcc.dg/attr-weakref-3.c", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-weakref-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/768e3c602bb1210ee8076a2b897704579a10727e/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-weakref-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-weakref-3.c?ref=768e3c602bb1210ee8076a2b897704579a10727e", "patch": "@@ -0,0 +1,3 @@\n+/* { dg-do compile } */\n+/* { dg-require-weak \"\" } */\n+static int i __attribute__ ((weakref)); /* { dg-warning \"attribute should be accompanied\" } */"}]}