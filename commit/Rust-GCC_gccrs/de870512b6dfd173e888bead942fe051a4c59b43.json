{"sha": "de870512b6dfd173e888bead942fe051a4c59b43", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGU4NzA1MTJiNmRmZDE3M2U4ODhiZWFkOTQyZmUwNTFhNGM1OWI0Mw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-08-29T18:53:33Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-08-29T18:53:33Z"}, "message": "dwarf2out.c (descr_info_loc): Handle VAR_DECL.\n\n\t* dwarf2out.c (descr_info_loc): Handle VAR_DECL.\n\n\t* trans.h (struct lang_type): Add span.\n\t(GFC_TYPE_ARRAY_SPAN): Define.\n\t* trans-decl.c (gfc_get_symbol_decl): For subref array pointers,\n\tcopy TREE_STATIC from decl to span instead of setting it\n\tunconditionally, set DECL_ARTIFICIAL, fix type of initializer\n\tand set GFC_TYPE_ARRAY_SPAN on decl's type.\n\t* trans-types.c (gfc_get_array_descr_info): If\n\tGFC_TYPE_ARRAY_SPAN is non-NULL, use it as element size.\n\nFrom-SVN: r139782", "tree": {"sha": "c114c4587eae8ac0792d25948c7ef9bac93f6a3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c114c4587eae8ac0792d25948c7ef9bac93f6a3b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de870512b6dfd173e888bead942fe051a4c59b43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de870512b6dfd173e888bead942fe051a4c59b43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de870512b6dfd173e888bead942fe051a4c59b43", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de870512b6dfd173e888bead942fe051a4c59b43/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bd11e37d6102fa1e90174e627a5f15e7975adc14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd11e37d6102fa1e90174e627a5f15e7975adc14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd11e37d6102fa1e90174e627a5f15e7975adc14"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "1158c2fb60a655750e06149f495f8fd6d28aa2f0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=de870512b6dfd173e888bead942fe051a4c59b43", "patch": "@@ -1,5 +1,7 @@\n 2008-08-29  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* dwarf2out.c (descr_info_loc): Handle VAR_DECL.\n+\n \t* dwarf2out.c (gen_const_die): New function.\n \t(size_of_die, value_format, output_die): Output larger\n \tdw_val_class_vec using DW_FORM_block2 or DW_FORM_block4."}, {"sha": "22c36249facfa5e9014235e57fd6b9a04edd1d73", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=de870512b6dfd173e888bead942fe051a4c59b43", "patch": "@@ -12854,6 +12854,8 @@ descr_info_loc (tree val, tree base_decl)\n     {\n     CASE_CONVERT:\n       return descr_info_loc (TREE_OPERAND (val, 0), base_decl);\n+    case VAR_DECL:\n+      return loc_descriptor_from_tree_1 (val, 0);\n     case INTEGER_CST:\n       if (host_integerp (val, 0))\n \treturn int_loc_descriptor (tree_low_cst (val, 0));"}, {"sha": "196626c4875948db642005fe3798e4865c24f74b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=de870512b6dfd173e888bead942fe051a4c59b43", "patch": "@@ -1,5 +1,14 @@\n 2008-08-29  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* trans.h (struct lang_type): Add span.\n+\t(GFC_TYPE_ARRAY_SPAN): Define.\n+\t* trans-decl.c (gfc_get_symbol_decl): For subref array pointers,\n+\tcopy TREE_STATIC from decl to span instead of setting it\n+\tunconditionally, set DECL_ARTIFICIAL, fix type of initializer\n+\tand set GFC_TYPE_ARRAY_SPAN on decl's type.\n+\t* trans-types.c (gfc_get_array_descr_info): If\n+\tGFC_TYPE_ARRAY_SPAN is non-NULL, use it as element size.\n+\n \t* trans-decl.c (check_constant_initializer,\n \tgfc_emit_parameter_debug_info): New functions.\n \t(gfc_generate_module_vars, gfc_generate_function_code): Emit"}, {"sha": "72f59737ae6918f0f13a24f3ff280b0fe8e25873", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=de870512b6dfd173e888bead942fe051a4c59b43", "patch": "@@ -1105,10 +1105,12 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n       span = build_decl (VAR_DECL, create_tmp_var_name (\"span\"),\n \t\t\t gfc_array_index_type);\n       gfc_finish_var_decl (span, sym);\n-      TREE_STATIC (span) = 1;\n-      DECL_INITIAL (span) = build_int_cst (NULL_TREE, 0);\n+      TREE_STATIC (span) = TREE_STATIC (decl);\n+      DECL_ARTIFICIAL (span) = 1;\n+      DECL_INITIAL (span) = build_int_cst (gfc_array_index_type, 0);\n \n       GFC_DECL_SPAN (decl) = span;\n+      GFC_TYPE_ARRAY_SPAN (TREE_TYPE (decl)) = span;\n     }\n \n   sym->backend_decl = decl;"}, {"sha": "8178ae39f05ce53c53f995b7fed5df28602142b4", "filename": "gcc/fortran/trans-types.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2Ftrans-types.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2Ftrans-types.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-types.c?ref=de870512b6dfd173e888bead942fe051a4c59b43", "patch": "@@ -2289,7 +2289,10 @@ gfc_get_array_descr_info (const_tree type, struct array_descr_info *info)\n   else\n     info->base_decl = base_decl = build_decl (VAR_DECL, NULL_TREE, ptype);\n \n-  elem_size = fold_convert (gfc_array_index_type, TYPE_SIZE_UNIT (etype));\n+  if (GFC_TYPE_ARRAY_SPAN (type))\n+    elem_size = GFC_TYPE_ARRAY_SPAN (type);\n+  else\n+    elem_size = fold_convert (gfc_array_index_type, TYPE_SIZE_UNIT (etype));\n   field = TYPE_FIELDS (TYPE_MAIN_VARIANT (type));\n   data_off = byte_position (field);\n   field = TREE_CHAIN (field);"}, {"sha": "5d729eaab837c5fd602e8b4c3bcff9b00d200bd6", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de870512b6dfd173e888bead942fe051a4c59b43/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=de870512b6dfd173e888bead942fe051a4c59b43", "patch": "@@ -615,6 +615,7 @@ struct lang_type\t\tGTY(())\n   tree offset;\n   tree dtype;\n   tree dataptr_type;\n+  tree span;\n };\n \n struct lang_decl\t\tGTY(())\n@@ -667,6 +668,7 @@ struct lang_decl\t\tGTY(())\n #define GFC_TYPE_ARRAY_DTYPE(node) (TYPE_LANG_SPECIFIC(node)->dtype)\n #define GFC_TYPE_ARRAY_DATAPTR_TYPE(node) \\\n   (TYPE_LANG_SPECIFIC(node)->dataptr_type)\n+#define GFC_TYPE_ARRAY_SPAN(node) (TYPE_LANG_SPECIFIC(node)->span)\n \n /* Build an expression with void type.  */\n #define build1_v(code, arg) fold_build1(code, void_type_node, arg)"}]}