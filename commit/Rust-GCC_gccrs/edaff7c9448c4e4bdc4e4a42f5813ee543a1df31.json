{"sha": "edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWRhZmY3Yzk0NDhjNGU0YmRjNGU0YTQyZjU4MTNlZTU0M2ExZGYzMQ==", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2019-03-13T21:33:27Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gcc.gnu.org", "date": "2019-03-13T21:33:27Z"}, "message": "re PR fortran/87045 (pointer to array of character)\n\n2019-03-13  Harald Anlauf  <anlauf@gmx.de>\n\n\tPR fortran/87045\n\t* trans-expr.c (gfc_trans_pointer_assignment): Move check for same\n\tstring length so that we do not get false errors for deferred\n\tlength.\n\n\tPR fortran/87045\n\t* gfortran.dg/pr87045.f90: New test.\n\nFrom-SVN: r269664", "tree": {"sha": "63e431971014e2cb9e412402010f1b4ec6e604f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/63e431971014e2cb9e412402010f1b4ec6e604f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1e05d1854cd6d63cda5828c50735d029ce198ff2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e05d1854cd6d63cda5828c50735d029ce198ff2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e05d1854cd6d63cda5828c50735d029ce198ff2"}], "stats": {"total": 51, "additions": 41, "deletions": 10}, "files": [{"sha": "8264e59d931b8c995a965350b9284382638977f3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "patch": "@@ -1,3 +1,10 @@\n+2019-03-13  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/87045\n+\t* trans-expr.c (gfc_trans_pointer_assignment): Move check for same\n+\tstring length so that we do not get false errors for deferred\n+\tlength.\n+\n 2019-03-13  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/89601"}, {"sha": "9575f391abd4fd4681432325456d5aa41eef0f40", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "patch": "@@ -9278,16 +9278,6 @@ gfc_trans_pointer_assignment (gfc_expr * expr1, gfc_expr * expr2)\n \t    }\n \t}\n \n-      /* Check string lengths if applicable.  The check is only really added\n-\t to the output code if -fbounds-check is enabled.  */\n-      if (expr1->ts.type == BT_CHARACTER && expr2->expr_type != EXPR_NULL)\n-\t{\n-\t  gcc_assert (expr2->ts.type == BT_CHARACTER);\n-\t  gcc_assert (strlen_lhs && strlen_rhs);\n-\t  gfc_trans_same_strlen_check (\"pointer assignment\", &expr1->where,\n-\t\t\t\t       strlen_lhs, strlen_rhs, &block);\n-\t}\n-\n       /* If rank remapping was done, check with -fcheck=bounds that\n \t the target is at least as large as the pointer.  */\n       if (rank_remap && (gfc_option.rtcheck & GFC_RTCHECK_BOUNDS))\n@@ -9322,6 +9312,16 @@ gfc_trans_pointer_assignment (gfc_expr * expr1, gfc_expr * expr2)\n \t    gfc_add_modify (&block, tmp, build_zero_cst (TREE_TYPE (tmp)));\n \t}\n \n+      /* Check string lengths if applicable.  The check is only really added\n+\t to the output code if -fbounds-check is enabled.  */\n+      if (expr1->ts.type == BT_CHARACTER && expr2->expr_type != EXPR_NULL)\n+\t{\n+\t  gcc_assert (expr2->ts.type == BT_CHARACTER);\n+\t  gcc_assert (strlen_lhs && strlen_rhs);\n+\t  gfc_trans_same_strlen_check (\"pointer assignment\", &expr1->where,\n+\t\t\t\t       strlen_lhs, strlen_rhs, &block);\n+\t}\n+\n       gfc_add_block_to_block (&block, &lse.post);\n       if (rank_remap)\n \tgfc_add_block_to_block (&block, &rse.post);"}, {"sha": "b7550a2c1701349487651aabe21bc0c0c61e3b8c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "patch": "@@ -1,3 +1,8 @@\n+2019-03-13  Harald Anlauf  <anlauf@gmx.de>\n+\n+\tPR fortran/87045\n+\t* gfortran.dg/pr87045.f90: New test.\n+\n 2019-03-13  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/85860"}, {"sha": "46b11f9112f58bfa5f4e42efa7f60db4c596b222", "filename": "gcc/testsuite/gfortran.dg/pr87045.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr87045.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/edaff7c9448c4e4bdc4e4a42f5813ee543a1df31/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr87045.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr87045.f90?ref=edaff7c9448c4e4bdc4e4a42f5813ee543a1df31", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! { dg-additional-options \"-fcheck=bounds\" }\n+!\n+! PR fortran/87045 - pointer to array of character\n+! Contributed by Valery Weber\n+! This used to give an invalid run-time error\n+\n+program test\n+  character(:), dimension(:), allocatable, target :: t\n+  character(:), pointer, dimension(:) :: p\n+  allocate( character(3) :: t(2) )\n+  t(1) = \"abc\"\n+  t(2) = \"123\"\n+  p => t\n+  if (size (p) /= 2) stop 1\n+  if (len  (p) /= 3) stop 2\n+  if (p(1) /= \"abc\") stop 3\n+  if (p(2) /= \"123\") stop 4\n+end program test"}]}