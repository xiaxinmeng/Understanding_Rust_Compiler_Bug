{"sha": "2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmU4ZDkyMTJkYWFhOGM2MTYyYWI4NzI0ODVkZDAzZDI4Yzk2ZWE0Yw==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-05-06T18:12:25Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-05-06T18:12:25Z"}, "message": "re PR fortran/48858 (Incorrect error for same binding label on two generic interface specifics)\n\n2011-05-06  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/48858\n        PR fortran/48820\n        * lang.opt (std=f2008tr): New.\n        * libgfortran.h (GFC_STD_F2008_TR): New macro constant.\n        * decl.c (verify_c_interop_param): Allow OPTIONAL in BIND(C)\n        procedures for -std=f2008tr/gnu/legacy.\n\n2011-05-06  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/48858\n        PR fortran/48820\n        * gfortran.dg/bind_c_usage_22.f90: New.\n        * gfortran.dg/bind_c_usage_23.f90: New.\n        * gfortran.dg/bind_c_usage_24.f90: New.\n        * gfortran.dg/bind_c_usage_24_c.c: New.\n\nFrom-SVN: r173500", "tree": {"sha": "0b573a6cdfb20f51178b705ea9d49570cd795302", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0b573a6cdfb20f51178b705ea9d49570cd795302"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "80bde45b083facc3f141c29c8c71d38619b1d9cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80bde45b083facc3f141c29c8c71d38619b1d9cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80bde45b083facc3f141c29c8c71d38619b1d9cb"}], "stats": {"total": 188, "additions": 182, "deletions": 6}, "files": [{"sha": "e53be65e19d043b9d329fecab0212b24824195e0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -1,3 +1,16 @@\n+2011-05-06  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/48858\n+\tPR fortran/48820\n+\t* lang.opt (std=f2008tr): New.\n+\t* libgfortran.h (GFC_STD_F2008_TR): New macro constant.\n+\t* decl.c (verify_c_interop_param): Allow OPTIONAL in BIND(C)\n+\tprocedures for -std=f2008tr/gnu/legacy.\n+\t(gfc_match_import): Set sym to NULL.\n+\t* options.c (set_default_std_flags,gfc_handle_option): Handle\n+\t-std=f2008tr.\n+\t* invoke.texi (-std=): Document -std=f2008tr.\n+\n 2011-05-05  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* trans-decl.c (gfc_trans_entry_master_switch): Call build_case_label."}, {"sha": "8acd594f08394f36e53e0a9699beaaf9a263d854", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -1060,14 +1060,22 @@ verify_c_interop_param (gfc_symbol *sym)\n \t      retval = FAILURE;\n \t    }\n \n-\t  if (sym->attr.optional == 1)\n+\t  if (sym->attr.optional == 1 && sym->attr.value)\n \t    {\n-\t      gfc_error (\"Variable '%s' at %L cannot have the \"\n-\t\t\t \"OPTIONAL attribute because procedure '%s'\"\n-\t\t\t \" is BIND(C)\", sym->name, &(sym->declared_at),\n+\t      gfc_error (\"Variable '%s' at %L cannot have both the OPTIONAL \"\n+\t\t\t \"and the VALUE attribute because procedure '%s' \"\n+\t\t\t \"is BIND(C)\", sym->name, &(sym->declared_at),\n \t\t\t sym->ns->proc_name->name);\n \t      retval = FAILURE;\n \t    }\n+\t  else if (sym->attr.optional == 1\n+\t\t   && gfc_notify_std (GFC_STD_F2008_TR, \"TR29113: Variable '%s' \"\n+\t\t\t\t      \"at %L with OPTIONAL attribute in \"\n+\t\t\t\t      \"procedure '%s' which is BIND(C)\",\n+\t\t\t\t      sym->name, &(sym->declared_at),\n+\t\t\t\t      sym->ns->proc_name->name)\n+\t\t      == FAILURE)\n+\t    retval = FAILURE;\n \n           /* Make sure that if it has the dimension attribute, that it is\n \t     either assumed size or explicit shape.  */\n@@ -2985,6 +2993,7 @@ gfc_match_import (void)\n \n   for(;;)\n     {\n+      sym = NULL;\n       m = gfc_match (\" %n\", name);\n       switch (m)\n \t{"}, {"sha": "9f022390b56917665dc50e32a34dfa6f74b1ed5e", "filename": "gcc/fortran/invoke.texi", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finvoke.texi?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -368,7 +368,9 @@ extensions, and may be useful for old non-standard programs.  The\n conformance to the Fortran 95, Fortran 2003 and Fortran 2008 standards,\n respectively; errors are given for all extensions beyond the relevant\n language standard, and warnings are given for the Fortran 77 features\n-that are permitted but obsolescent in later standards.\n+that are permitted but obsolescent in later standards. @samp{-std=f2008tr}\n+allows the Fortran 2008 standard including the additions of the \n+technical report (TR) 29113.\n \n @end table\n "}, {"sha": "ce944e3b4cebb41e67515f0a5fe5f4e0d38e7387", "filename": "gcc/fortran/lang.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Flang.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Flang.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Flang.opt?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -590,6 +590,10 @@ std=f2008\n Fortran\n Conform to the ISO Fortran 2008 standard\n \n+std=f2008tr\n+Fortran\n+Conform to the ISO Fortran 2008 standard including TR 29113\n+\n std=f95\n Fortran\n Conform to the ISO Fortran 95 standard"}, {"sha": "035a32a75077507223cf9ba4f177a60cc9ab7bea", "filename": "gcc/fortran/libgfortran.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Flibgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Flibgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Flibgfortran.h?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -23,6 +23,7 @@ along with GCC; see the file COPYING3.  If not see\n    Note that no features were obsoleted nor deleted in F2003.\n    Please remember to keep those definitions in sync with\n    gfortran.texi.  */\n+#define GFC_STD_F2008_TR\t(1<<9)\t/* POST-F2008 technical reports.  */\n #define GFC_STD_F2008_OBS\t(1<<8)\t/* Obsolescent in F2008.  */\n #define GFC_STD_F2008\t\t(1<<7)\t/* New in F2008.  */\n #define GFC_STD_LEGACY\t\t(1<<6)\t/* Backward compatibility.  */"}, {"sha": "c67d10916e97ed30e66bf4b26c095753d390a3d5", "filename": "gcc/fortran/options.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Foptions.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ffortran%2Foptions.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Foptions.c?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -49,7 +49,7 @@ set_default_std_flags (void)\n {\n   gfc_option.allow_std = GFC_STD_F95_OBS | GFC_STD_F95_DEL\n     | GFC_STD_F2003 | GFC_STD_F2008 | GFC_STD_F95 | GFC_STD_F77\n-    | GFC_STD_F2008_OBS | GFC_STD_GNU | GFC_STD_LEGACY;\n+    | GFC_STD_F2008_OBS | GFC_STD_F2008_TR | GFC_STD_GNU | GFC_STD_LEGACY;\n   gfc_option.warn_std = GFC_STD_F95_DEL | GFC_STD_LEGACY;\n }\n \n@@ -945,6 +945,16 @@ gfc_handle_option (size_t scode, const char *arg, int value,\n       gfc_option.warn_tabs = 0;\n       break;\n \n+    case OPT_std_f2008tr:\n+      gfc_option.allow_std = GFC_STD_F95_OBS | GFC_STD_F77 \n+\t| GFC_STD_F2003 | GFC_STD_F95 | GFC_STD_F2008 | GFC_STD_F2008_OBS\n+\t| GFC_STD_F2008_TR;\n+      gfc_option.warn_std = GFC_STD_F95_OBS | GFC_STD_F2008_OBS;\n+      gfc_option.max_identifier_length = 63;\n+      gfc_option.warn_ampersand = 1;\n+      gfc_option.warn_tabs = 0;\n+      break;\n+\n     case OPT_std_gnu:\n       set_default_std_flags ();\n       break;"}, {"sha": "66656f5ef62b62fb0962eac4fbba83a613b8ff94", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -1,3 +1,12 @@\n+2011-05-06  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/48858\n+\tPR fortran/48820\n+\t* gfortran.dg/bind_c_usage_22.f90: New.\n+\t* gfortran.dg/bind_c_usage_23.f90: New.\n+\t* gfortran.dg/bind_c_usage_24.f90: New.\n+\t* gfortran.dg/bind_c_usage_24_c.c: New.\n+\n 2011-05-06  Dodji Seketeli  <dodji@redhat.com>\n \n \tPR c++/48838"}, {"sha": "861f8c7cfd8e3f390dc5bdbc3d78a7839871737c", "filename": "gcc/testsuite/gfortran.dg/bind_c_usage_22.f90", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_22.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_22.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_22.f90?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -0,0 +1,64 @@\n+! { dg-do compile }\n+! { dg-options \"-std=f2008tr\" }\n+!\n+! PR fortran/48858\n+! PR fortran/48820\n+!\n+! OPTIONAL + BIND(C) is allowed since TR 29113\n+!\n+\n+! VALID\n+subroutine sub(z) bind(C)\n+  use iso_c_binding\n+  integer(c_int), value :: z\n+end subroutine sub\n+\n+! VALID since TR29113\n+subroutine sub2(z) bind(C)\n+  use iso_c_binding\n+  integer(c_int), optional :: z\n+end subroutine sub2\n+\n+! VALID since TR29113\n+subroutine sub2a(z) bind(C)\n+  use iso_c_binding\n+  integer(c_int) :: z\n+  optional :: z\n+end subroutine sub2a\n+\n+! VALID since TR29113\n+subroutine sub2b(z) bind(C)\n+  use iso_c_binding\n+  optional :: z\n+  integer(c_int) :: z\n+end subroutine sub2b\n+\n+! Invalid\n+subroutine sub3(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  integer(c_int), value, optional :: z\n+end subroutine sub3\n+\n+! Invalid\n+subroutine sub3a(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  integer(c_int) :: z\n+  optional :: z\n+  value :: z\n+end subroutine sub3a\n+\n+! Invalid\n+subroutine sub3b(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  optional :: z\n+  value :: z\n+  integer(c_int) :: z\n+end subroutine sub3b\n+\n+! Invalid\n+subroutine sub3c(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  value :: z\n+  integer(c_int) :: z\n+  optional :: z\n+end subroutine sub3c"}, {"sha": "374f8129136fcea2babbbcb0b99b0f153774aeac", "filename": "gcc/testsuite/gfortran.dg/bind_c_usage_23.f90", "status": "added", "additions": 64, "deletions": 0, "changes": 64, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_23.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e8d9212daaa8c6162ab872485dd03d28c96ea4c/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_23.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_23.f90?ref=2e8d9212daaa8c6162ab872485dd03d28c96ea4c", "patch": "@@ -0,0 +1,64 @@\n+! { dg-do compile }\n+! { dg-options \"-std=f2008\" }\n+!\n+! PR fortran/48858\n+! PR fortran/48820\n+!\n+! OPTIONAL + BIND(C) is allowed since TR 29113\n+!\n+\n+! VALID\n+subroutine sub(z) bind(C)\n+  use iso_c_binding\n+  integer(c_int), value :: z\n+end subroutine sub\n+\n+! VALID since TR29113\n+subroutine sub2(z) bind(C) ! { dg-error \"with OPTIONAL attribute in procedure\" }\n+  use iso_c_binding\n+  integer(c_int), optional :: z\n+end subroutine sub2\n+\n+! VALID since TR29113\n+subroutine sub2a(z) bind(C) ! { dg-error \"with OPTIONAL attribute in procedure\" }\n+  use iso_c_binding\n+  integer(c_int) :: z\n+  optional :: z\n+end subroutine sub2a\n+\n+! VALID since TR29113\n+subroutine sub2b(z) bind(C) ! { dg-error \"with OPTIONAL attribute in procedure\" }\n+  use iso_c_binding\n+  optional :: z\n+  integer(c_int) :: z\n+end subroutine sub2b\n+\n+! Invalid\n+subroutine sub3(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  integer(c_int), value, optional :: z\n+end subroutine sub3\n+\n+! Invalid\n+subroutine sub3a(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  integer(c_int) :: z\n+  optional :: z\n+  value :: z\n+end subroutine sub3a\n+\n+! Invalid\n+subroutine sub3b(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  optional :: z\n+  value :: z\n+  integer(c_int) :: z\n+end subroutine sub3b\n+\n+! Invalid\n+subroutine sub3c(z) bind(C) ! { dg-error \"cannot have both the OPTIONAL and the VALUE attribute\" }\n+  use iso_c_binding\n+  value :: z\n+  integer(c_int) :: z\n+  optional :: z\n+end subroutine sub3c"}]}