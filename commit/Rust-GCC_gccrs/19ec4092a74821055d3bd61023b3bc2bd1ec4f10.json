{"sha": "19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "node_id": "C_kwDOANBUbNoAKDE5ZWM0MDkyYTc0ODIxMDU1ZDNiZDYxMDIzYjNiYzJiZDFlYzRmMTA", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-02-21T09:26:30Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-02-21T09:26:30Z"}, "message": "Revert \"tree-optimization/108691 - indirect calls to setjmp\"\n\nThis reverts commit 6436add49ed9ecf74f1f01b4fe18961df4f3e83d.", "tree": {"sha": "eebcab08a95236f0accc9c28b36e68d81b29dc81", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eebcab08a95236f0accc9c28b36e68d81b29dc81"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a804419c89db9e1c0b99e772dda6c95095bab0bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a804419c89db9e1c0b99e772dda6c95095bab0bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a804419c89db9e1c0b99e772dda6c95095bab0bf"}], "stats": {"total": 30, "additions": 6, "deletions": 24}, "files": [{"sha": "4d7f6c3d2912c9dcb150d8d219dce07d99ada0a6", "filename": "gcc/calls.cc", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/gcc%2Fcalls.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/gcc%2Fcalls.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.cc?ref=19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "patch": "@@ -506,11 +506,11 @@ emit_call_1 (rtx funexp, tree fntree ATTRIBUTE_UNUSED, tree fndecl ATTRIBUTE_UNU\n   if (ecf_flags & ECF_NORETURN)\n     add_reg_note (call_insn, REG_NORETURN, const0_rtx);\n \n-  if (ecf_flags & ECF_RETURNS_TWICE\n-      /* We rely on GIMPLE setting this flag and here use it to\n-\t catch formerly indirect and not control-altering calls.  */\n-      && cfun->calls_setjmp)\n-    add_reg_note (call_insn, REG_SETJMP, const0_rtx);\n+  if (ecf_flags & ECF_RETURNS_TWICE)\n+    {\n+      add_reg_note (call_insn, REG_SETJMP, const0_rtx);\n+      cfun->calls_setjmp = 1;\n+    }\n \n   SIBLING_CALL_P (call_insn) = ((ecf_flags & ECF_SIBCALL) != 0);\n "}, {"sha": "25b1558dcb941ea491a19aeeb2cd8f4d2dbdf7c6", "filename": "gcc/cfgexpand.cc", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/gcc%2Fcfgexpand.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/gcc%2Fcfgexpand.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.cc?ref=19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "patch": "@@ -2808,11 +2808,6 @@ expand_call_stmt (gcall *stmt)\n   /* Must come after copying location.  */\n   copy_warning (exp, stmt);\n \n-  /* For calls that do not alter control flow avoid REG_SETJMP notes.  */\n-  bool saved_calls_setjmp = cfun->calls_setjmp;\n-  if (!gimple_call_ctrl_altering_p (stmt))\n-    cfun->calls_setjmp = false;\n-\n   /* Ensure RTL is created for debug args.  */\n   if (decl && DECL_HAS_DEBUG_ARGS_P (decl))\n     {\n@@ -2851,8 +2846,6 @@ expand_call_stmt (gcall *stmt)\n     }\n \n   mark_transaction_restart_calls (stmt);\n-\n-  cfun->calls_setjmp = saved_calls_setjmp;\n }\n \n "}, {"sha": "e412df10f22c2c196aa65ed6d8ec199a18a9d645", "filename": "gcc/testsuite/gcc.dg/pr108691.c", "status": "removed", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a804419c89db9e1c0b99e772dda6c95095bab0bf/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108691.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a804419c89db9e1c0b99e772dda6c95095bab0bf/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108691.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr108691.c?ref=a804419c89db9e1c0b99e772dda6c95095bab0bf", "patch": "@@ -1,9 +0,0 @@\n-/* { dg-do compile } */\n-/* { dg-options \"-O2\" } */\n-\n-extern int __attribute__((returns_twice)) setjmp(void*);\n-\n-void bbb(void) {\n-  int (*fnptr)(void*) = setjmp;\n-  fnptr(0);\n-}"}, {"sha": "a9fcc7fd050f871437ef336ecfb8d6cc81280ee0", "filename": "gcc/tree-cfg.cc", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/gcc%2Ftree-cfg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19ec4092a74821055d3bd61023b3bc2bd1ec4f10/gcc%2Ftree-cfg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.cc?ref=19ec4092a74821055d3bd61023b3bc2bd1ec4f10", "patch": "@@ -2280,9 +2280,7 @@ notice_special_calls (gcall *call)\n \n   if (flags & ECF_MAY_BE_ALLOCA)\n     cfun->calls_alloca = true;\n-  if (flags & ECF_RETURNS_TWICE\n-      && (!(cfun->curr_properties & PROP_cfg)\n-\t  || gimple_call_ctrl_altering_p (call)))\n+  if (flags & ECF_RETURNS_TWICE)\n     cfun->calls_setjmp = true;\n }\n "}]}