{"sha": "f5b328d9648e09bd305255d1029b9a22cc598ccb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjViMzI4ZDk2NDhlMDliZDMwNTI1NWQxMDI5YjlhMjJjYzU5OGNjYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-08-07T08:29:21Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-08-07T08:29:21Z"}, "message": "re PR middle-end/81698 (expand_case uses wrong edge as default edge)\n\n\tPR middle-end/81698\n\t* stmt.c (emit_case_dispatch_table): Add DEFAULT_EDGE argument,\n\tinstead of computing it in the function.  Formatting fix.\n\t(expand_case): Don't rely on default_edge being the first edge,\n\tclear it if removing it, pass default_edge to\n\temit_case_dispatch_table.\n\t(expand_sjlj_dispatch_table): Pass NULL as DEFAULT_EDGE, formatting\n\tfix.\n\nFrom-SVN: r250909", "tree": {"sha": "100d7ad1cc51d37c58e8ae54f03f9c39da4b7b83", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/100d7ad1cc51d37c58e8ae54f03f9c39da4b7b83"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f5b328d9648e09bd305255d1029b9a22cc598ccb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5b328d9648e09bd305255d1029b9a22cc598ccb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5b328d9648e09bd305255d1029b9a22cc598ccb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5b328d9648e09bd305255d1029b9a22cc598ccb/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c0e5f294e891d8e1803f451440b2e4181b33aaff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0e5f294e891d8e1803f451440b2e4181b33aaff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0e5f294e891d8e1803f451440b2e4181b33aaff"}], "stats": {"total": 35, "additions": 23, "deletions": 12}, "files": [{"sha": "db8204f8e65849d72fc1bb35965f608d71b51605", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5b328d9648e09bd305255d1029b9a22cc598ccb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5b328d9648e09bd305255d1029b9a22cc598ccb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f5b328d9648e09bd305255d1029b9a22cc598ccb", "patch": "@@ -1,3 +1,14 @@\n+2017-08-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/81698\n+\t* stmt.c (emit_case_dispatch_table): Add DEFAULT_EDGE argument,\n+\tinstead of computing it in the function.  Formatting fix.\n+\t(expand_case): Don't rely on default_edge being the first edge,\n+\tclear it if removing it, pass default_edge to\n+\temit_case_dispatch_table.\n+\t(expand_sjlj_dispatch_table): Pass NULL as DEFAULT_EDGE, formatting\n+\tfix.\n+\n 2017-08-06  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* config/alpha/alpha.c (alpha_reorg): If trap is the last active"}, {"sha": "73aa9b2b8090f1da178e0f312ad48acd9fd0d943", "filename": "gcc/stmt.c", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5b328d9648e09bd305255d1029b9a22cc598ccb/gcc%2Fstmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5b328d9648e09bd305255d1029b9a22cc598ccb/gcc%2Fstmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstmt.c?ref=f5b328d9648e09bd305255d1029b9a22cc598ccb", "patch": "@@ -945,16 +945,15 @@ conditional_probability (profile_probability target_prob,\n static void\n emit_case_dispatch_table (tree index_expr, tree index_type,\n \t\t\t  struct case_node *case_list, rtx default_label,\n-\t\t\t  tree minval, tree maxval, tree range,\n-                          basic_block stmt_bb)\n+\t\t\t  edge default_edge,  tree minval, tree maxval,\n+\t\t\t  tree range, basic_block stmt_bb)\n {\n   int i, ncases;\n   struct case_node *n;\n   rtx *labelvec;\n   rtx_insn *fallback_label = label_rtx (case_list->code_label);\n   rtx_code_label *table_label = gen_label_rtx ();\n   bool has_gaps = false;\n-  edge default_edge = stmt_bb ? EDGE_SUCC (stmt_bb, 0) : NULL;\n   profile_probability default_prob = default_edge ? default_edge->probability\n \t\t\t\t\t\t  : profile_probability::never ();\n   profile_probability base = get_outgoing_edge_probs (stmt_bb);\n@@ -1026,9 +1025,8 @@ emit_case_dispatch_table (tree index_expr, tree index_type,\n          through the indirect jump or the direct conditional jump\n          before that. Split the probability of reaching the\n          default label among these two jumps.  */\n-      new_default_prob = conditional_probability (default_prob.apply_scale\n-\t\t\t\t\t\t\t (1, 2),\n-                                                  base);\n+      new_default_prob\n+\t= conditional_probability (default_prob.apply_scale (1, 2), base);\n       default_prob = default_prob.apply_scale (1, 2);\n       base -= default_prob;\n     }\n@@ -1147,9 +1145,10 @@ expand_case (gswitch *stmt)\n   do_pending_stack_adjust ();\n \n   /* Find the default case target label.  */\n-  default_label = jump_target_rtx\n-      (CASE_LABEL (gimple_switch_default_label (stmt)));\n-  edge default_edge = EDGE_SUCC (bb, 0);\n+  tree default_lab = CASE_LABEL (gimple_switch_default_label (stmt));\n+  default_label = jump_target_rtx (default_lab);\n+  basic_block default_bb = label_to_block_fn (cfun, default_lab);\n+  edge default_edge = find_edge (bb, default_bb);\n   profile_probability default_prob = default_edge->probability;\n \n   /* Get upper and lower bounds of case values.  */\n@@ -1245,9 +1244,10 @@ expand_case (gswitch *stmt)\n \t{\n \t  default_label = NULL;\n \t  remove_edge (default_edge);\n+\t  default_edge = NULL;\n \t}\n       emit_case_dispatch_table (index_expr, index_type,\n-\t\t\t\tcase_list, default_label,\n+\t\t\t\tcase_list, default_label, default_edge,\n \t\t\t\tminval, maxval, range, bb);\n     }\n \n@@ -1340,9 +1340,9 @@ expand_sjlj_dispatch_table (rtx dispatch_index,\n \t}\n \n       emit_case_dispatch_table (index_expr, index_type,\n-\t\t\t\tcase_list, default_label,\n+\t\t\t\tcase_list, default_label, NULL,\n \t\t\t\tminval, maxval, range,\n-                                BLOCK_FOR_INSN (before_case));\n+\t\t\t\tBLOCK_FOR_INSN (before_case));\n       emit_label (default_label);\n     }\n "}]}