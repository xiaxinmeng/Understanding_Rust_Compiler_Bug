{"sha": "0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGIwNmM5YTZkYTc1M2NlYjc5YjBlYjZjYzhjMjY1ZTE0ZmNkMjBkMw==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.ibm.com", "date": "2018-08-09T07:06:23Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2018-08-09T07:06:23Z"}, "message": "S/390: Fix PR84332 ICE with stack clash protection\n\nOur implementation of the stack probe requires the probe interval to\nbe used as displacement in an address operand.  The maximum probe\ninterval currently is 64k.  This would exceed short displacements.\nTrim that value down to 4k if that happens.  This might result in too\nmany probes being generated only on the oldest supported machine level\nz900.\n\ngcc/ChangeLog:\n\n2018-08-09  Andreas Krebbel  <krebbel@linux.ibm.com>\n\n\tPR target/84332\n\t* config/s390/s390.c (s390_option_override_internal): Reduce the\n\tstack-clash-protection-probe-interval param if it would be too big\n\tfor z900.\n\ngcc/testsuite/ChangeLog:\n\n2018-08-09  Andreas Krebbel  <krebbel@linux.ibm.com>\n\n\tPR target/84332\n\t* gcc.target/s390/pr84332.c: New testcase.\n\nFrom-SVN: r263441", "tree": {"sha": "f338f7e98d354131d75dc1a24163a914cabe35b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f338f7e98d354131d75dc1a24163a914cabe35b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/comments", "author": {"login": "Andreas-Krebbel", "id": 38103320, "node_id": "MDQ6VXNlcjM4MTAzMzIw", "avatar_url": "https://avatars.githubusercontent.com/u/38103320?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Andreas-Krebbel", "html_url": "https://github.com/Andreas-Krebbel", "followers_url": "https://api.github.com/users/Andreas-Krebbel/followers", "following_url": "https://api.github.com/users/Andreas-Krebbel/following{/other_user}", "gists_url": "https://api.github.com/users/Andreas-Krebbel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Andreas-Krebbel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Andreas-Krebbel/subscriptions", "organizations_url": "https://api.github.com/users/Andreas-Krebbel/orgs", "repos_url": "https://api.github.com/users/Andreas-Krebbel/repos", "events_url": "https://api.github.com/users/Andreas-Krebbel/events{/privacy}", "received_events_url": "https://api.github.com/users/Andreas-Krebbel/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a0de11f47fde9e4af00cff2aeca8054ba5769b05", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0de11f47fde9e4af00cff2aeca8054ba5769b05", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0de11f47fde9e4af00cff2aeca8054ba5769b05"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "e2ae04db139ca2e39bc8843b4962a413e246a29e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "patch": "@@ -1,3 +1,10 @@\n+2018-08-09  Andreas Krebbel  <krebbel@linux.ibm.com>\n+\n+\tPR target/84332\n+\t* config/s390/s390.c (s390_option_override_internal): Reduce the\n+\tstack-clash-protection-probe-interval param if it would be too big\n+\tfor z900.\n+\n 2018-08-08  Andreas Schwab  <schwab@linux-m68k.org>\n \n \tPR target/46179"}, {"sha": "d5511d01192d8b8aa948b495aa9d3ce74b7af432", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "patch": "@@ -14983,6 +14983,17 @@ s390_option_override_internal (struct gcc_options *opts,\n   else if (opts->x_s390_stack_guard)\n     error (\"-mstack-guard implies use of -mstack-size\");\n \n+  /* Our implementation of the stack probe requires the probe interval\n+     to be used as displacement in an address operand.  The maximum\n+     probe interval currently is 64k.  This would exceed short\n+     displacements.  Trim that value down to 4k if that happens.  This\n+     might result in too many probes being generated only on the\n+     oldest supported machine level z900.  */\n+  if (!DISP_IN_RANGE ((1 << PARAM_VALUE (PARAM_STACK_CLASH_PROTECTION_PROBE_INTERVAL))))\n+    set_param_value (\"stack-clash-protection-probe-interval\", 12,\n+\t\t     opts->x_param_values,\n+\t\t     opts_set->x_param_values);\n+\n #ifdef TARGET_DEFAULT_LONG_DOUBLE_128\n   if (!TARGET_LONG_DOUBLE_128_P (opts_set->x_target_flags))\n     opts->x_target_flags |= MASK_LONG_DOUBLE_128;"}, {"sha": "592e3ecf2abeb38ce96f36f40fcfdb08903898fc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "patch": "@@ -1,3 +1,8 @@\n+2018-08-09  Andreas Krebbel  <krebbel@linux.ibm.com>\n+\n+\tPR target/84332\n+\t* gcc.target/s390/pr84332.c: New testcase.\n+\n 2018-08-08  Andreas Schwab  <schwab@linux-m68k.org>\n \n \tPR target/46179"}, {"sha": "3dec99f62c706cd4cf0b42ba7a2663096b3c6202", "filename": "gcc/testsuite/gcc.target/s390/pr84332.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr84332.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr84332.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr84332.c?ref=0b06c9a6da753ceb79b0eb6cc8c265e14fcd20d3", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-march=z900 -fstack-clash-protection --param stack-clash-protection-probe-interval=16\" } */\n+\n+struct b\n+{\n+  char a[65536];\n+};\n+\n+void c (void) { struct b d; }"}]}