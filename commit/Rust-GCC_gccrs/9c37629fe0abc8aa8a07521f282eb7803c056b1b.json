{"sha": "9c37629fe0abc8aa8a07521f282eb7803c056b1b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWMzNzYyOWZlMGFiYzhhYThhMDc1MjFmMjgyZWI3ODAzYzA1NmIxYg==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2015-11-24T14:47:55Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2015-11-24T14:47:55Z"}, "message": "Allow pass_lim to run outside pass_tree_loop\n\n2015-11-24  Tom de Vries  <tom@codesourcery.com>\n\n\t* tree-ssa-loop-im.c (tree_ssa_lim): Make static.\n\t(pass_lim::execute): Allow to run outside pass_tree_loop.\n\nFrom-SVN: r230815", "tree": {"sha": "0367b380138fae228e11618b71da358fba49e479", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0367b380138fae228e11618b71da358fba49e479"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c37629fe0abc8aa8a07521f282eb7803c056b1b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c37629fe0abc8aa8a07521f282eb7803c056b1b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c37629fe0abc8aa8a07521f282eb7803c056b1b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c37629fe0abc8aa8a07521f282eb7803c056b1b/comments", "author": null, "committer": null, "parents": [{"sha": "4e55c7c347fe797af3aaee1dedb46230168c371b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e55c7c347fe797af3aaee1dedb46230168c371b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e55c7c347fe797af3aaee1dedb46230168c371b"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "5d18534493228fc89272d4de601c1a3ad2bc60fd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c37629fe0abc8aa8a07521f282eb7803c056b1b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c37629fe0abc8aa8a07521f282eb7803c056b1b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9c37629fe0abc8aa8a07521f282eb7803c056b1b", "patch": "@@ -1,3 +1,8 @@\n+2015-11-24  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* tree-ssa-loop-im.c (tree_ssa_lim): Make static.\n+\t(pass_lim::execute): Allow to run outside pass_tree_loop.\n+\n 2015-11-24  Wilco Dijkstra  <wdijkstr@arm.com>\n \n \t* gcc/config/aarch64/aarch64.md (add<mode>3):"}, {"sha": "0d82d36af9340ffc7bed8878aa8be9e81016bcf8", "filename": "gcc/tree-ssa-loop-im.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c37629fe0abc8aa8a07521f282eb7803c056b1b/gcc%2Ftree-ssa-loop-im.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c37629fe0abc8aa8a07521f282eb7803c056b1b/gcc%2Ftree-ssa-loop-im.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-im.c?ref=9c37629fe0abc8aa8a07521f282eb7803c056b1b", "patch": "@@ -43,6 +43,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree-ssa-propagate.h\"\n #include \"trans-mem.h\"\n #include \"gimple-fold.h\"\n+#include \"tree-scalar-evolution.h\"\n \n /* TODO:  Support for predicated code motion.  I.e.\n \n@@ -2496,7 +2497,7 @@ tree_ssa_lim_finalize (void)\n /* Moves invariants from loops.  Only \"expensive\" invariants are moved out --\n    i.e. those that are likely to be win regardless of the register pressure.  */\n \n-unsigned int\n+static unsigned int\n tree_ssa_lim (void)\n {\n   unsigned int todo;\n@@ -2560,10 +2561,17 @@ class pass_lim : public gimple_opt_pass\n unsigned int\n pass_lim::execute (function *fun)\n {\n+  bool in_loop_pipeline = scev_initialized_p ();\n+  if (!in_loop_pipeline)\n+    loop_optimizer_init (LOOPS_NORMAL | LOOPS_HAVE_RECORDED_EXITS);\n+\n   if (number_of_loops (fun) <= 1)\n     return 0;\n+  unsigned int todo = tree_ssa_lim ();\n \n-  return tree_ssa_lim ();\n+  if (!in_loop_pipeline)\n+    loop_optimizer_finalize ();\n+  return todo;\n }\n \n } // anon namespace"}]}