{"sha": "ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWJmOWI2YzEzZjA4NDdkZGNjMjJlNTQwYTVmY2RiZjY0NGU4NWE5Yw==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-02-16T13:17:35Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-02-16T13:17:35Z"}, "message": "Fortran: Reject DT as fmt in I/O statments [PR99111]\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/99111\n\t* io.c (resolve_tag_format): Reject BT_DERIVED/CLASS/VOID\n\tas (array-valued) FORMAT tag.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/99111\n\t* gfortran.dg/fmt_nonchar_1.f90: New test.\n\t* gfortran.dg/fmt_nonchar_2.f90: New test.", "tree": {"sha": "06b58649d06f9511a250566d74e8777425b8d241", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/06b58649d06f9511a250566d74e8777425b8d241"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3f16a1678156035bbe73b217fbce4d9c27d1d559", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f16a1678156035bbe73b217fbce4d9c27d1d559", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f16a1678156035bbe73b217fbce4d9c27d1d559"}], "stats": {"total": 75, "additions": 75, "deletions": 0}, "files": [{"sha": "40cd76eb5858614c81de98b59a4f6e5b814988ea", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "patch": "@@ -1762,6 +1762,13 @@ resolve_tag_format (gfc_expr *e)\n      It may be assigned an Hollerith constant.  */\n   if (e->ts.type != BT_CHARACTER)\n     {\n+      if (e->ts.type == BT_DERIVED || e->ts.type == BT_CLASS\n+\t  || e->ts.type == BT_VOID)\n+\t{\n+\t  gfc_error (\"Non-character non-Hollerith in FORMAT tag at %L\",\n+\t\t     &e->where);\n+\t  return false;\n+\t}\n       if (!gfc_notify_std (GFC_STD_LEGACY, \"Non-character in FORMAT tag \"\n \t\t\t   \"at %L\", &e->where))\n \treturn false;"}, {"sha": "431b61569e2cc5959ab60f76db12350f5da078e5", "filename": "gcc/testsuite/gfortran.dg/fmt_nonchar_1.f90", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_nonchar_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_nonchar_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_nonchar_1.f90?ref=ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "patch": "@@ -0,0 +1,46 @@\n+! { dg-do compile }\n+!\n+! PR fortran/99111\n+!\n+program p\n+   use iso_c_binding\n+   implicit none\n+   type t\n+      integer :: a(1)\n+   end type\n+   type(t), parameter :: x(3) = [t(transfer('(\"he', 1)), &\n+                                 t(transfer('llo ', 1)), &\n+                                 t(transfer('W1\")', 1))]\n+   type t2\n+     procedure(), pointer, nopass :: ppt\n+   end type t2\n+   type(t2) :: ppcomp(1)\n+   interface\n+     function fptr()\n+       procedure(), pointer :: fptr\n+     end function\n+   end interface\n+   class(t), allocatable :: cl(:)\n+   type(c_ptr) :: cptr(1)\n+   type(c_funptr) :: cfunptr(1)\n+   procedure(), pointer :: proc\n+   external proc2\n+\n+   print x ! { dg-error \"Non-character non-Hollerith in FORMAT tag\" }\n+   print cl ! { dg-error \"Non-character non-Hollerith in FORMAT tag\" }\n+   print cptr ! { dg-error \"Non-character non-Hollerith in FORMAT tag\" }\n+   print cfunptr ! { dg-error \"Non-character non-Hollerith in FORMAT tag\" }\n+\n+   print proc ! { dg-error \"Syntax error in PRINT statement\" }\n+   print proc2 ! { dg-error \"Syntax error in PRINT statement\" }\n+   print ppcomp%ppt ! { dg-error \"Syntax error in PRINT statement\" }\n+\n+   print fptr() ! { dg-error \"must be of type default-kind CHARACTER or of INTEGER\" }\n+\n+   call bar(1)\n+contains\n+   subroutine bar (xx)\n+     type(*) :: xx\n+     print xx  ! { dg-error \"Assumed-type variable xx at ... may only be used as actual argument\" }\n+   end\n+end"}, {"sha": "7c0f524c3c97e344ed03f7094a7690a0c523afda", "filename": "gcc/testsuite/gfortran.dg/fmt_nonchar_2.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_nonchar_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_nonchar_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_nonchar_2.f90?ref=ebf9b6c13f0847ddcc22e540a5fcdbf644e85a9c", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do run }\n+!\n+! PR fortran/99111\n+!\n+program p\n+   implicit none\n+   type t\n+      integer :: a(1)\n+   end type\n+   type(t), parameter :: x(3) = [t(transfer('(\"he', 1)), &\n+                                 t(transfer('llo ', 1)), &\n+                                 t(transfer('W1\")', 1))]\n+\n+   integer, parameter :: y(3) = transfer('(\"hello W2\")', 1, size=3)\n+   real, parameter :: z(3) = transfer('(\"hello W3\")', 1.0, size=3)\n+\n+   print y      ! { dg-warning \"Legacy Extension: Non-character in FORMAT\" }\n+   print z      ! { dg-warning \"Legacy Extension: Non-character in FORMAT\" }\n+   print x%a(1) ! { dg-warning \"Legacy Extension: Non-character in FORMAT\" }\n+end\n+\n+! { dg-output \"hello W2(\\n|\\r\\n|\\r)hello W3(\\n|\\r\\n|\\r)hello W1\" }"}]}