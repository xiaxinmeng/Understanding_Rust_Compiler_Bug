{"sha": "af2e3244f56152d94a18c1339a18a4c0b0e33060", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWYyZTMyNDRmNTYxNTJkOTRhMThjMTMzOWExOGE0YzBiMGUzMzA2MA==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2018-01-26T08:32:21Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2018-01-26T08:32:21Z"}, "message": "Configure USE_HIDDEN_LINKONCE on Solaris/x86\n\n\tgcc/testsuite:\n\t* gcc.target/i386/mcount_pic.c: Only xfail get_pc_thunk scan on\n\tSolaris 10.\n\t* gcc.target/i386/pr63620.c: Likewise.\n\n\tgcc:\n\t* config/i386/sol2.h (USE_HIDDEN_LINKONCE): Remove.\n\t* configure.ac (hidden_linkonce): New test.\n\t* configure: Regenerate.\n\t* config.in: Regenerate.\n\nFrom-SVN: r257076", "tree": {"sha": "957b816c25e791bc435d9375088bd5091c75fe96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/957b816c25e791bc435d9375088bd5091c75fe96"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/af2e3244f56152d94a18c1339a18a4c0b0e33060", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af2e3244f56152d94a18c1339a18a4c0b0e33060", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af2e3244f56152d94a18c1339a18a4c0b0e33060", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af2e3244f56152d94a18c1339a18a4c0b0e33060/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aad36c569d14bada8f278fcdb9eb78056ae6b6ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aad36c569d14bada8f278fcdb9eb78056ae6b6ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aad36c569d14bada8f278fcdb9eb78056ae6b6ac"}], "stats": {"total": 83, "additions": 75, "deletions": 8}, "files": [{"sha": "66ae9d189a8d175282be21a325fdd42c95420867", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -1,3 +1,10 @@\n+2018-01-26  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* config/i386/sol2.h (USE_HIDDEN_LINKONCE): Remove.\n+\t* configure.ac (hidden_linkonce): New test.\n+\t* configure: Regenerate.\n+\t* config.in: Regenerate.\n+\n 2018-01-26  Julia Koval  <julia.koval@intel.com>\n \n \t* config/i386/avx512bitalgintrin.h (_mm512_bitshuffle_epi64_mask,"}, {"sha": "8dc453104c13a7707ce2f3a5b05cd880c6984b2f", "filename": "gcc/config.in", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -2207,6 +2207,12 @@\n #endif\n \n \n+/* Define 0/1 if your linker supports hidden thunks in linkonce sections. */\n+#ifndef USED_FOR_TARGET\n+#undef USE_HIDDEN_LINKONCE\n+#endif\n+\n+\n /* Define to 1 if the 'long long' type is wider than 'long' but still\n    efficiently supported by the host hardware. */\n #ifndef USED_FOR_TARGET"}, {"sha": "41048d23776e04b0bdba02f3f28ff51d7f4bef91", "filename": "gcc/config/i386/sol2.h", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfig%2Fi386%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfig%2Fi386%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsol2.h?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -253,9 +253,3 @@ along with GCC; see the file COPYING3.  If not see\n /* We do not need NT_VERSION notes.  */\n #undef X86_FILE_START_VERSION_DIRECTIVE\n #define X86_FILE_START_VERSION_DIRECTIVE false\n-\n-/* Only recent versions of Solaris 11 ld properly support hidden .gnu.linkonce\n-   sections, so don't use them.  */\n-#ifndef USE_GLD\n-#define USE_HIDDEN_LINKONCE 0\n-#endif"}, {"sha": "f3695adc945ac354a6c0f3bb42c51d53a99ae9b4", "filename": "gcc/configure", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -23798,6 +23798,35 @@ cat >>confdefs.h <<_ACEOF\n _ACEOF\n \n \n+# Restrict this test to Solaris/x86: other targets define this statically.\n+case \"${target}\" in\n+  i?86-*-solaris2* | x86_64-*-solaris2*)\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: checking support for hidden thunks in linkonce sections\" >&5\n+$as_echo_n \"checking support for hidden thunks in linkonce sections... \" >&6; }\n+    if test $in_tree_ld = yes || echo \"$ld_ver\" | grep GNU > /dev/null; then\n+      hidden_linkonce=yes\n+    else\n+      case \"${target}\" in\n+\t# Full support for hidden thunks in linkonce sections only appeared in\n+\t# Solaris 11/OpenSolaris.\n+        *-*-solaris2.1[1-9]*)\n+\t  hidden_linkonce=yes\n+\t  ;;\n+\t*)\n+\t  hidden_linkonce=no\n+\t  ;;\n+      esac\n+    fi\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $hidden_linkonce\" >&5\n+$as_echo \"$hidden_linkonce\" >&6; }\n+\n+cat >>confdefs.h <<_ACEOF\n+#define USE_HIDDEN_LINKONCE `if test $hidden_linkonce = yes; then echo 1; else echo 0; fi`\n+_ACEOF\n+\n+  ;;\n+esac\n+\n { $as_echo \"$as_me:${as_lineno-$LINENO}: checking assembler for line table discriminator support\" >&5\n $as_echo_n \"checking assembler for line table discriminator support... \" >&6; }\n if test \"${gcc_cv_as_discriminator+set}\" = set; then :"}, {"sha": "b7f972868f68ef1e1e66d025edc2bce2c12bd5ab", "filename": "gcc/configure.ac", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -3070,6 +3070,31 @@ AC_DEFINE_UNQUOTED(HAVE_COMDAT_GROUP,\n     || test $gcc_cv_as_comdat_group_group = yes; then echo 1; else echo 0; fi`],\n [Define 0/1 if your assembler and linker support COMDAT groups.])\n \n+# Restrict this test to Solaris/x86: other targets define this statically.\n+case \"${target}\" in\n+  i?86-*-solaris2* | x86_64-*-solaris2*)\n+    AC_MSG_CHECKING(support for hidden thunks in linkonce sections)\n+    if test $in_tree_ld = yes || echo \"$ld_ver\" | grep GNU > /dev/null; then\n+      hidden_linkonce=yes\n+    else\n+      case \"${target}\" in\n+\t# Full support for hidden thunks in linkonce sections only appeared in\n+\t# Solaris 11/OpenSolaris.\n+        *-*-solaris2.1[[1-9]]*)\n+\t  hidden_linkonce=yes\n+\t  ;;\n+\t*)\n+\t  hidden_linkonce=no\n+\t  ;;\n+      esac\n+    fi\n+    AC_MSG_RESULT($hidden_linkonce)\n+    AC_DEFINE_UNQUOTED(USE_HIDDEN_LINKONCE,\n+      [`if test $hidden_linkonce = yes; then echo 1; else echo 0; fi`],\n+    [Define 0/1 if your linker supports hidden thunks in linkonce sections.])\n+  ;;\n+esac\n+\n gcc_GAS_CHECK_FEATURE([line table discriminator support],\n  gcc_cv_as_discriminator,\n  [2,19,51],,"}, {"sha": "01904c83cb4ac95280caa779c57895b67a5efa83", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -1,3 +1,9 @@\n+2018-01-26  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* gcc.target/i386/mcount_pic.c: Only xfail get_pc_thunk scan on\n+\tSolaris 10.\n+\t* gcc.target/i386/pr63620.c: Likewise.\n+\n 2018-01-26  Julia Koval  <julia.koval@intel.com>\n \n \t* gcc.target/i386/avx512bitalg-vpshufbitqmb-1.c: Add -mavx512f -mavx512bw."}, {"sha": "2eccfbd1c90f8b37bb1ce73c173c946d350ff912", "filename": "gcc/testsuite/gcc.target/i386/mcount_pic.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fmcount_pic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fmcount_pic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fmcount_pic.c?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -11,5 +11,5 @@ int main ()\n }\n \n /* { dg-final { scan-assembler \"mcount\" } } */\n-/* { dg-final { scan-assembler \"get_pc_thunk\" { xfail { *-*-solaris* && { ! gld } } } } } */\n+/* { dg-final { scan-assembler \"get_pc_thunk\" { xfail { *-*-solaris2.10* && { ! gld } } } } } */\n /* { dg-final { cleanup-profile-file } } */"}, {"sha": "36f6b63f1e8ed7763b4754651b168165ee307806", "filename": "gcc/testsuite/gcc.target/i386/pr63620.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr63620.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af2e3244f56152d94a18c1339a18a4c0b0e33060/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr63620.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr63620.c?ref=af2e3244f56152d94a18c1339a18a4c0b0e33060", "patch": "@@ -17,4 +17,4 @@ test (__float128 x, int p, func f)\n   return x;\n }\n \n-/* { dg-final { scan-assembler \"get_pc_thunk\" { xfail { *-*-solaris* && { ! gld } } } } } */\n+/* { dg-final { scan-assembler \"get_pc_thunk\" { xfail { *-*-solaris2.10* && { ! gld } } } } } */"}]}