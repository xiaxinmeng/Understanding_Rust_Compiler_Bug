{"sha": "723afc4436e1c3753b152e0a14e6de5c52b07202", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzIzYWZjNDQzNmUxYzM3NTNiMTUyZTBhMTRlNmRlNWM1MmIwNzIwMg==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2011-11-10T12:22:46Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2011-11-10T12:22:46Z"}, "message": "re PR middle-end/51071 (ICE in gimple_has_side_effects, at gimple.c:2513)\n\n2011-11-10  Richard Guenther  <rguenther@suse.de>\n\n\tPR middle-end/51071\n\t* gimple.c (gimple_has_side_effects): Remove checking code\n\tthat doesn't belong here.\n\n\t* gcc.dg/torture/pr51071.c: New testcase.\n\nFrom-SVN: r181253", "tree": {"sha": "ae04cc73c7c383580aa79ea02aaddaea175a9672", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ae04cc73c7c383580aa79ea02aaddaea175a9672"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/723afc4436e1c3753b152e0a14e6de5c52b07202", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/723afc4436e1c3753b152e0a14e6de5c52b07202", "html_url": "https://github.com/Rust-GCC/gccrs/commit/723afc4436e1c3753b152e0a14e6de5c52b07202", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/723afc4436e1c3753b152e0a14e6de5c52b07202/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "08d603d6edd42cd148c78336ecb7457899763f46", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08d603d6edd42cd148c78336ecb7457899763f46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08d603d6edd42cd148c78336ecb7457899763f46"}], "stats": {"total": 86, "additions": 48, "deletions": 38}, "files": [{"sha": "56505f75a350236cd1433ace2758d2623e2fbbfa", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=723afc4436e1c3753b152e0a14e6de5c52b07202", "patch": "@@ -1,3 +1,9 @@\n+2011-11-10  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/51071\n+\t* gimple.c (gimple_has_side_effects): Remove checking code\n+\tthat doesn't belong here.\n+\n 2011-11-10  Ira Rosen  <ira.rosen@linaro.org>\n \n \tPR tree-optimization/51058"}, {"sha": "6168d33ac0508ee85ad98a3260c567063873a183", "filename": "gcc/gimple.c", "status": "modified", "additions": 4, "deletions": 38, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2Fgimple.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2Fgimple.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple.c?ref=723afc4436e1c3753b152e0a14e6de5c52b07202", "patch": "@@ -2457,8 +2457,6 @@ gimple_set_modified (gimple s, bool modifiedp)\n bool\n gimple_has_side_effects (const_gimple s)\n {\n-  unsigned i;\n-\n   if (is_gimple_debug (s))\n     return false;\n \n@@ -2474,47 +2472,15 @@ gimple_has_side_effects (const_gimple s)\n \n   if (is_gimple_call (s))\n     {\n-      unsigned nargs = gimple_call_num_args (s);\n-      tree fn;\n+      int flags = gimple_call_flags (s);\n \n-      if (!(gimple_call_flags (s) & (ECF_CONST | ECF_PURE)))\n-        return true;\n-      else if (gimple_call_flags (s) & ECF_LOOPING_CONST_OR_PURE)\n-\t/* An infinite loop is considered a side effect.  */\n+      /* An infinite loop is considered a side effect.  */\n+      if (!(flags & (ECF_CONST | ECF_PURE))\n+\t  || (flags & ECF_LOOPING_CONST_OR_PURE))\n \treturn true;\n \n-      if (gimple_call_lhs (s)\n-          && TREE_SIDE_EFFECTS (gimple_call_lhs (s)))\n-\t{\n-\t  gcc_checking_assert (gimple_has_volatile_ops (s));\n-\t  return true;\n-\t}\n-\n-      fn = gimple_call_fn (s);\n-      if (fn && TREE_SIDE_EFFECTS (fn))\n-        return true;\n-\n-      for (i = 0; i < nargs; i++)\n-        if (TREE_SIDE_EFFECTS (gimple_call_arg (s, i)))\n-\t  {\n-\t    gcc_checking_assert (gimple_has_volatile_ops (s));\n-\t    return true;\n-\t  }\n-\n       return false;\n     }\n-  else\n-    {\n-      for (i = 0; i < gimple_num_ops (s); i++)\n-\t{\n-\t  tree op = gimple_op (s, i);\n-\t  if (op && TREE_SIDE_EFFECTS (op))\n-\t    {\n-\t      gcc_checking_assert (gimple_has_volatile_ops (s));\n-\t      return true;\n-\t    }\n-\t}\n-    }\n \n   return false;\n }"}, {"sha": "c36aa0612e0dba178784528658000e421ee10c4a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=723afc4436e1c3753b152e0a14e6de5c52b07202", "patch": "@@ -1,3 +1,8 @@\n+2011-11-10  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/51071\n+\t* gcc.dg/torture/pr51071.c: New testcase.\n+\n 2011-11-10  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/loop_optimization9.ad[sb]: New test."}, {"sha": "99af9587d055a7c6f04ea31c3ef4017284064852", "filename": "gcc/testsuite/gcc.dg/torture/pr51071.c", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr51071.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/723afc4436e1c3753b152e0a14e6de5c52b07202/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr51071.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr51071.c?ref=723afc4436e1c3753b152e0a14e6de5c52b07202", "patch": "@@ -0,0 +1,33 @@\n+/* { dg-do compile } */\n+\n+void foo (void);\n+void bar (void *);\n+extern int t;\n+\n+static void kmalloc_large (int size, int flags)\n+{\n+  (void) size;\n+  (void) flags;\n+  foo ();\n+  bar (({__here:&&__here;}));\n+}\n+\n+static void kmalloc (int size, int flags)\n+{\n+  if (size)\n+    {\n+      if ((unsigned long) size > 0x1000)\n+\tkmalloc_large (size, flags);\n+\n+      if (flags)\n+\tbar (({__here:&&__here;}));\n+    }\n+}\n+\n+void compress_file_range (int i, int j, int k)\n+{\n+  int nr_pages = ({j < k;});\n+\n+  if (i || t)\n+    kmalloc (0x1000UL * nr_pages, 0x40UL);\n+}"}]}