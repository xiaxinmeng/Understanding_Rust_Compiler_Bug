{"sha": "47d5b6edfe962508d685a181e5afe6a2a2453973", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDdkNWI2ZWRmZTk2MjUwOGQ2ODVhMTgxZTVhZmU2YTJhMjQ1Mzk3Mw==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@gnat.com", "date": "2001-10-26T15:12:03Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-10-26T15:12:03Z"}, "message": "g-os_lib.adb (Normalize_Pathname): Preserve the double slash (\"//\") that precede the drive letter on Interix.\n\n\t* g-os_lib.adb (Normalize_Pathname): Preserve the double slash\n        (\"//\") that precede the drive letter on Interix.\n\nFrom-SVN: r46542", "tree": {"sha": "f05892b3b2b4974042741ecbbe3c39838eb5bf48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f05892b3b2b4974042741ecbbe3c39838eb5bf48"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47d5b6edfe962508d685a181e5afe6a2a2453973", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d5b6edfe962508d685a181e5afe6a2a2453973", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d5b6edfe962508d685a181e5afe6a2a2453973", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d5b6edfe962508d685a181e5afe6a2a2453973/comments", "author": null, "committer": null, "parents": [{"sha": "bdfa170fda77953d49509e4f16da32f1d584f3f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdfa170fda77953d49509e4f16da32f1d584f3f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdfa170fda77953d49509e4f16da32f1d584f3f5"}], "stats": {"total": 58, "additions": 54, "deletions": 4}, "files": [{"sha": "54cabc00d6c92dc666c5550a248b16ecb7b502ca", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d5b6edfe962508d685a181e5afe6a2a2453973/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d5b6edfe962508d685a181e5afe6a2a2453973/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=47d5b6edfe962508d685a181e5afe6a2a2453973", "patch": "@@ -1,3 +1,8 @@\n+2001-10-26  Vincent Celier <celier@gnat.com>\n+\n+\t* g-os_lib.adb (Normalize_Pathname): Preserve the double slash \n+        (\"//\") that precede the drive letter on Interix.\n+\n 2001-10-26  Geert Bosch <bosch@gnat.com>\n \n \t* gnat_rm.texi: Add GNAT Reference Manual."}, {"sha": "cc600789e1dc716fca2045f996a25da5c31423eb", "filename": "gcc/ada/g-os_lib.adb", "status": "modified", "additions": 49, "deletions": 4, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d5b6edfe962508d685a181e5afe6a2a2453973/gcc%2Fada%2Fg-os_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d5b6edfe962508d685a181e5afe6a2a2453973/gcc%2Fada%2Fg-os_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-os_lib.adb?ref=47d5b6edfe962508d685a181e5afe6a2a2453973", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                            $Revision: 1.74 $\n+--                            $Revision$\n --                                                                          --\n --           Copyright (C) 1995-2001 Ada Core Technologies, Inc.            --\n --                                                                          --\n@@ -813,6 +813,9 @@ package body GNAT.OS_Lib is\n       Canonical_File_Addr : System.Address;\n       Canonical_File_Len  : Integer;\n \n+      Need_To_Check_Drive_Letter : Boolean := False;\n+      --  Set to true if Name is an absolute path that starts with \"//\"\n+\n       function Strlen (S : System.Address) return Integer;\n       pragma Import (C, Strlen, \"strlen\");\n \n@@ -821,6 +824,13 @@ package body GNAT.OS_Lib is\n       --  if not already present, otherwise return current working directory\n       --  with terminating directory separator.\n \n+      function Final_Value (S : String) return String;\n+      --  Make final adjustment to the returned string.\n+      --  To compensate for non standard path name in Interix,\n+      --  if S is \"/x\" or starts with \"/x\", where x is a capital\n+      --  letter 'A' to 'Z', add an additional '/' at the beginning\n+      --  so that the returned value starts with \"//x\".\n+\n       -------------------\n       -- Get_Directory --\n       -------------------\n@@ -866,6 +876,35 @@ package body GNAT.OS_Lib is\n       Reference_Dir : constant String := Get_Directory;\n       --  Current directory name specified\n \n+      function Final_Value (S : String) return String is\n+      begin\n+         --  Interix has the non standard notion of disk drive\n+         --  indicated by two '/' followed by a capital letter\n+         --  'A' .. 'Z'. One of the two '/' may have been removed\n+         --  by Normalize_Pathname. It has to be added again.\n+         --  For other OSes, this should not make no difference.\n+\n+         if Need_To_Check_Drive_Letter\n+           and then S'Length >= 2\n+           and then S (S'First) = '/'\n+           and then S (S'First + 1) in 'A' .. 'Z'\n+           and then (S'Length = 2 or else S (S'First + 2) = '/')\n+         then\n+            declare\n+               Result : String (1 .. S'Length + 1);\n+\n+            begin\n+               Result (1) := '/';\n+               Result (2 .. Result'Last) := S;\n+               return Result;\n+            end;\n+\n+         else\n+            return S;\n+         end if;\n+\n+      end Final_Value;\n+\n    --  Start of processing for Normalize_Pathname\n \n    begin\n@@ -942,20 +981,26 @@ package body GNAT.OS_Lib is\n             Last := Reference_Dir'Length;\n          end if;\n \n+         --  If name starts with \"//\", we may have a drive letter on Interix\n+\n+         if Last = 1 and then End_Path >= 3 then\n+            Need_To_Check_Drive_Letter := (Path_Buffer (1 .. 2)) = \"//\";\n+         end if;\n+\n          Start  := Last + 1;\n          Finish := Last;\n \n          --  If we have traversed the full pathname, return it\n \n          if Start > End_Path then\n-            return Path_Buffer (1 .. End_Path);\n+            return Final_Value (Path_Buffer (1 .. End_Path));\n          end if;\n \n          --  Remove duplicate directory separators\n \n          while Path_Buffer (Start) = Directory_Separator loop\n             if Start = End_Path then\n-               return Path_Buffer (1 .. End_Path - 1);\n+               return Final_Value (Path_Buffer (1 .. End_Path - 1));\n \n             else\n                Path_Buffer (Start .. End_Path - 1) :=\n@@ -1014,7 +1059,7 @@ package body GNAT.OS_Lib is\n \n             else\n                if Finish = End_Path then\n-                  return Path_Buffer (1 .. Start - 1);\n+                  return Final_Value (Path_Buffer (1 .. Start - 1));\n \n                else\n                   Path_Buffer (Start + 1 .. Start + End_Path - Finish - 1) :="}]}