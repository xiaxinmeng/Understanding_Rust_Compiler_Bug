{"sha": "3b21c21f3f5726823e19728fdd1571a14aae0fb3", "node_id": "C_kwDOANBUbNoAKDNiMjFjMjFmM2Y1NzI2ODIzZTE5NzI4ZmRkMTU3MWExNGFhZTBmYjM", "commit": {"author": {"name": "Sergei Trofimovich", "email": "siarheit@google.com", "date": "2022-06-27T12:27:24Z"}, "committer": {"name": "Sergei Trofimovich", "email": "siarheit@google.com", "date": "2022-06-27T22:22:02Z"}, "message": "c++: avoid <memory> poisoning on musl [PR106102]\n\nOn musl <pthread.h> uses calloc() (via <sched.h>). <memory> includes\nit indirectly and exposes use of poisoned calloc() when module code\nis built:\n\n    /build/build/./prev-gcc/xg++ ... ../../gcc-13-20220626/gcc/cp/mapper-resolver.cc\n        In file included from /<<NIX>>/musl-1.2.3-dev/include/pthread.h:30,\n                 from /build/build/prev-x86_64-unknown-linux-musl/libstdc++-v3/include/x86_64-unknown-linux-musl/bits/gthr-default.h:35,\n                 ....\n                 from /build/build/prev-x86_64-unknown-linux-musl/libstdc++-v3/include/memory:77,\n                 from ../../gcc-13-20220626/gcc/../libcody/cody.hh:24,\n                 from ../../gcc-13-20220626/gcc/cp/../../c++tools/resolver.h:25,\n                 from ../../gcc-13-20220626/gcc/cp/../../c++tools/resolver.cc:23,\n                 from ../../gcc-13-20220626/gcc/cp/mapper-resolver.cc:32:\n    /<<NIX>>/musl-1.2.3-dev/include/sched.h:84:7: error: attempt to use poisoned \"calloc\"\n       84 | void *calloc(size_t, size_t);\n          |       ^\n    /<<NIX>>/musl-1.2.3-dev/include/sched.h:124:36: error: attempt to use poisoned \"calloc\"\n      124 | #define CPU_ALLOC(n) ((cpu_set_t *)calloc(1,CPU_ALLOC_SIZE(n)))\n          |                                    ^\n\ngcc/cp/\n\n\tPR c++/106102\n\t* mapper-client.cc: Include <memory> via \"system.h\".\n\t* mapper-resolver.cc: Ditto.\n\t* module.cc: Ditto.\n\nlibcc1/\n\n\tPR c++/106102\n\t* libcc1plugin.cc: Include <memory> via \"system.h\".\n\t* libcp1plugin.cc: Ditto.", "tree": {"sha": "45c415a1bc7ceb5dca4dd7bdd9cbf8e696eb312c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/45c415a1bc7ceb5dca4dd7bdd9cbf8e696eb312c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3b21c21f3f5726823e19728fdd1571a14aae0fb3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b21c21f3f5726823e19728fdd1571a14aae0fb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b21c21f3f5726823e19728fdd1571a14aae0fb3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b21c21f3f5726823e19728fdd1571a14aae0fb3/comments", "author": {"login": "trofi", "id": 226650, "node_id": "MDQ6VXNlcjIyNjY1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/226650?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trofi", "html_url": "https://github.com/trofi", "followers_url": "https://api.github.com/users/trofi/followers", "following_url": "https://api.github.com/users/trofi/following{/other_user}", "gists_url": "https://api.github.com/users/trofi/gists{/gist_id}", "starred_url": "https://api.github.com/users/trofi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trofi/subscriptions", "organizations_url": "https://api.github.com/users/trofi/orgs", "repos_url": "https://api.github.com/users/trofi/repos", "events_url": "https://api.github.com/users/trofi/events{/privacy}", "received_events_url": "https://api.github.com/users/trofi/received_events", "type": "User", "site_admin": false}, "committer": {"login": "trofi", "id": 226650, "node_id": "MDQ6VXNlcjIyNjY1MA==", "avatar_url": "https://avatars.githubusercontent.com/u/226650?v=4", "gravatar_id": "", "url": "https://api.github.com/users/trofi", "html_url": "https://github.com/trofi", "followers_url": "https://api.github.com/users/trofi/followers", "following_url": "https://api.github.com/users/trofi/following{/other_user}", "gists_url": "https://api.github.com/users/trofi/gists{/gist_id}", "starred_url": "https://api.github.com/users/trofi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/trofi/subscriptions", "organizations_url": "https://api.github.com/users/trofi/orgs", "repos_url": "https://api.github.com/users/trofi/repos", "events_url": "https://api.github.com/users/trofi/events{/privacy}", "received_events_url": "https://api.github.com/users/trofi/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26f77c4d19b827f3a2a8a9323df8e182e1389cb9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26f77c4d19b827f3a2a8a9323df8e182e1389cb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26f77c4d19b827f3a2a8a9323df8e182e1389cb9"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "fe9544b5ba43e02d47e2685fd54243abd0ed7161", "filename": "gcc/cp/mapper-client.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b21c21f3f5726823e19728fdd1571a14aae0fb3/gcc%2Fcp%2Fmapper-client.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b21c21f3f5726823e19728fdd1571a14aae0fb3/gcc%2Fcp%2Fmapper-client.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmapper-client.cc?ref=3b21c21f3f5726823e19728fdd1571a14aae0fb3", "patch": "@@ -27,6 +27,7 @@ along with GCC; see the file COPYING3.  If not see\n #define INCLUDE_STRING\n #define INCLUDE_VECTOR\n #define INCLUDE_MAP\n+#define INCLUDE_MEMORY\n #include \"system.h\"\n \n #include \"line-map.h\""}, {"sha": "e70d1b4ae2cae80c06c79238f628f045704c588e", "filename": "gcc/cp/mapper-resolver.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b21c21f3f5726823e19728fdd1571a14aae0fb3/gcc%2Fcp%2Fmapper-resolver.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b21c21f3f5726823e19728fdd1571a14aae0fb3/gcc%2Fcp%2Fmapper-resolver.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmapper-resolver.cc?ref=3b21c21f3f5726823e19728fdd1571a14aae0fb3", "patch": "@@ -25,6 +25,7 @@ along with GCC; see the file COPYING3.  If not see\n #define INCLUDE_VECTOR\n #define INCLUDE_ALGORITHM\n #define INCLUDE_MAP\n+#define INCLUDE_MEMORY\n #include \"system.h\"\n \n // We don't want or need to be aware of networking"}, {"sha": "8bb22c2b305a19326ead487094c6704336ab4abd", "filename": "gcc/cp/module.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b21c21f3f5726823e19728fdd1571a14aae0fb3/gcc%2Fcp%2Fmodule.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b21c21f3f5726823e19728fdd1571a14aae0fb3/gcc%2Fcp%2Fmodule.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmodule.cc?ref=3b21c21f3f5726823e19728fdd1571a14aae0fb3", "patch": "@@ -206,6 +206,7 @@ Classes used:\n \n #define _DEFAULT_SOURCE 1 /* To get TZ field of struct tm, if available.  */\n #include \"config.h\"\n+#define INCLUDE_MEMORY\n #define INCLUDE_STRING\n #define INCLUDE_VECTOR\n #include \"system.h\""}, {"sha": "bdd0bdabe77f8c8e7d45c94eec68b1b4f77db09e", "filename": "libcc1/libcc1plugin.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b21c21f3f5726823e19728fdd1571a14aae0fb3/libcc1%2Flibcc1plugin.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b21c21f3f5726823e19728fdd1571a14aae0fb3/libcc1%2Flibcc1plugin.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcc1%2Flibcc1plugin.cc?ref=3b21c21f3f5726823e19728fdd1571a14aae0fb3", "patch": "@@ -31,6 +31,7 @@\n #undef PACKAGE_TARNAME\n #undef PACKAGE_VERSION\n \n+#define INCLUDE_MEMORY\n #include \"gcc-plugin.h\"\n #include \"system.h\"\n #include \"coretypes.h\""}, {"sha": "e2d5039a0a1f3b2a18db7ac7fca696dab52a4fcc", "filename": "libcc1/libcp1plugin.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b21c21f3f5726823e19728fdd1571a14aae0fb3/libcc1%2Flibcp1plugin.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b21c21f3f5726823e19728fdd1571a14aae0fb3/libcc1%2Flibcp1plugin.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcc1%2Flibcp1plugin.cc?ref=3b21c21f3f5726823e19728fdd1571a14aae0fb3", "patch": "@@ -32,6 +32,7 @@\n #undef PACKAGE_TARNAME\n #undef PACKAGE_VERSION\n \n+#define INCLUDE_MEMORY\n #include \"gcc-plugin.h\"\n #include \"system.h\"\n #include \"coretypes.h\""}]}