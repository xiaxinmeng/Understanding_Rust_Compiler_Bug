{"sha": "ab386758ef41dad695ccf25f975ebf12b4afe8c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWIzODY3NThlZjQxZGFkNjk1Y2NmMjVmOTc1ZWJmMTJiNGFmZThjNA==", "commit": {"author": {"name": "Bernd Edlinger", "email": "bernd.edlinger@hotmail.de", "date": "2018-11-09T20:38:07Z"}, "committer": {"name": "Bernd Edlinger", "email": "edlinger@gcc.gnu.org", "date": "2018-11-09T20:38:07Z"}, "message": "re PR tree-optimization/87940 (FAIL: gcc.dg/warn-strlen-no-nul.c)\n\n2018-11-09  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        PR tree-optimization/87940\n        * expr.c (string_constant): Don't strip NOPS in subexpressions.\n        Fold PLUS_EXPR correctly.\n\nFrom-SVN: r265992", "tree": {"sha": "b4e750d78e5710a9c0ddaf5743b86c604eedd376", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4e750d78e5710a9c0ddaf5743b86c604eedd376"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ab386758ef41dad695ccf25f975ebf12b4afe8c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab386758ef41dad695ccf25f975ebf12b4afe8c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab386758ef41dad695ccf25f975ebf12b4afe8c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab386758ef41dad695ccf25f975ebf12b4afe8c4/comments", "author": {"login": "bernd-edlinger", "id": 17638929, "node_id": "MDQ6VXNlcjE3NjM4OTI5", "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bernd-edlinger", "html_url": "https://github.com/bernd-edlinger", "followers_url": "https://api.github.com/users/bernd-edlinger/followers", "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}", "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions", "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs", "repos_url": "https://api.github.com/users/bernd-edlinger/repos", "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}", "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "340e0dd66466091ea2bbd160592c017eb67dc47d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/340e0dd66466091ea2bbd160592c017eb67dc47d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/340e0dd66466091ea2bbd160592c017eb67dc47d"}], "stats": {"total": 31, "additions": 18, "deletions": 13}, "files": [{"sha": "1535fe51b1524a2931649ae17e40ae0fdc893ced", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab386758ef41dad695ccf25f975ebf12b4afe8c4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab386758ef41dad695ccf25f975ebf12b4afe8c4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ab386758ef41dad695ccf25f975ebf12b4afe8c4", "patch": "@@ -1,3 +1,9 @@\n+2018-11-09  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tPR tree-optimization/87940\n+\t* expr.c (string_constant): Don't strip NOPS in subexpressions.\n+\tFold PLUS_EXPR correctly.\n+\n 2018-11-09  Ilya Leoshkevich  <iii@linux.ibm.com>\n \n \tPR target/87762"}, {"sha": "7ae3e37378c5afbc6bb59b064ded4afb3e0e8673", "filename": "gcc/expr.c", "status": "modified", "additions": 12, "deletions": 13, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab386758ef41dad695ccf25f975ebf12b4afe8c4/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab386758ef41dad695ccf25f975ebf12b4afe8c4/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=ab386758ef41dad695ccf25f975ebf12b4afe8c4", "patch": "@@ -11358,18 +11358,15 @@ string_constant (tree arg, tree *ptr_offset, tree *mem_size, tree *decl)\n       tree arg0 = TREE_OPERAND (arg, 0);\n       tree arg1 = TREE_OPERAND (arg, 1);\n \n-      STRIP_NOPS (arg0);\n-      STRIP_NOPS (arg1);\n-\n-      if (TREE_CODE (arg0) == ADDR_EXPR)\n-\t;   /* Do nothing.  */\n-      else if (TREE_CODE (arg1) == ADDR_EXPR)\n-\tstd::swap (arg0, arg1);\n-      else\n-\treturn NULL_TREE;\n-\n       tree offset;\n-      if (tree str = string_constant (arg0, &offset, mem_size, decl))\n+      tree str = string_constant (arg0, &offset, mem_size, decl);\n+      if (!str)\n+\t{\n+\t   str = string_constant (arg1, &offset, mem_size, decl);\n+\t   arg1 = arg0;\n+\t}\n+\n+      if (str)\n \t{\n \t  /* Avoid pointers to arrays (see bug 86622).  */\n \t  if (POINTER_TYPE_P (TREE_TYPE (arg))\n@@ -11380,7 +11377,8 @@ string_constant (tree arg, tree *ptr_offset, tree *mem_size, tree *decl)\n \t\t   && tree_int_cst_equal (*mem_size, DECL_SIZE_UNIT (*decl))))\n \t    return NULL_TREE;\n \n-\t  tree type = TREE_TYPE (arg1);\n+\t  tree type = TREE_TYPE (offset);\n+\t  arg1 = fold_convert (type, arg1);\n \t  *ptr_offset = fold_build2 (PLUS_EXPR, type, offset, arg1);\n \t  return str;\n \t}\n@@ -11412,7 +11410,8 @@ string_constant (tree arg, tree *ptr_offset, tree *mem_size, tree *decl)\n \t    return NULL_TREE;\n \n \t  tree rhs2 = gimple_assign_rhs2 (stmt);\n-\t  tree type = TREE_TYPE (rhs2);\n+\t  tree type = TREE_TYPE (offset);\n+\t  rhs2 = fold_convert (type, rhs2);\n \t  *ptr_offset = fold_build2 (PLUS_EXPR, type, offset, rhs2);\n \t  return str;\n \t}"}]}