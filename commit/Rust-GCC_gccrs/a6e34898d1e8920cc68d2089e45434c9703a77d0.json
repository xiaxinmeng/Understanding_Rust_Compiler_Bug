{"sha": "a6e34898d1e8920cc68d2089e45434c9703a77d0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTZlMzQ4OThkMWU4OTIwY2M2OGQyMDg5ZTQ1NDM0Yzk3MDNhNzdkMA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-04-27T16:56:55Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2018-04-27T16:56:55Z"}, "message": "re PR c++/84691 (internal compiler error: in poplevel_class, at cp/name-lookup.c:4430)\n\n/cp\n2018-04-27  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/84691\n\t* decl.c (grokdeclarator): Clear friendp upon definition in local\n\tclass definition error.\n\n/testsuite\n2018-04-27  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/84691\n\t* g++.dg/cpp0x/friend3.C: New.\n\nFrom-SVN: r259716", "tree": {"sha": "fe98a04a49b515de108cb210e8fe690dcb838ace", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe98a04a49b515de108cb210e8fe690dcb838ace"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6e34898d1e8920cc68d2089e45434c9703a77d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6e34898d1e8920cc68d2089e45434c9703a77d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6e34898d1e8920cc68d2089e45434c9703a77d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6e34898d1e8920cc68d2089e45434c9703a77d0/comments", "author": null, "committer": null, "parents": [{"sha": "6d0e87b25ee21493d4f47bb39aee3e2d33cb08d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d0e87b25ee21493d4f47bb39aee3e2d33cb08d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d0e87b25ee21493d4f47bb39aee3e2d33cb08d9"}], "stats": {"total": 30, "additions": 27, "deletions": 3}, "files": [{"sha": "552828fa3eaf66d9cf60adaa7d72fe2ad0b0c5e9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a6e34898d1e8920cc68d2089e45434c9703a77d0", "patch": "@@ -1,3 +1,9 @@\n+2018-04-27  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/84691\n+\t* decl.c (grokdeclarator): Clear friendp upon definition in local\n+\tclass definition error.\n+\n 2018-04-27  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/85545 - ICE with noexcept PMF conversion."}, {"sha": "03bc041780fc5103c61f91f8ce272244b8536088", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=a6e34898d1e8920cc68d2089e45434c9703a77d0", "patch": "@@ -11298,9 +11298,11 @@ grokdeclarator (const cp_declarator *declarator,\n \t\tif (decl_context == NORMAL)\n \t\t  error (\"friend declaration not in class definition\");\n \t\tif (current_function_decl && funcdef_flag)\n-\t\t  error (\"can%'t define friend function %qs in a local \"\n-\t\t\t \"class definition\",\n-\t\t\t name);\n+\t\t  {\n+\t\t    error (\"can%'t define friend function %qs in a local \"\n+\t\t\t   \"class definition\", name);\n+\t\t    friendp = 0;\n+\t\t  }\n \t      }\n \t    else if (ctype && sfk == sfk_conversion)\n \t      {"}, {"sha": "a20bfd0c1dc17831a994c3afda10766fed39046f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a6e34898d1e8920cc68d2089e45434c9703a77d0", "patch": "@@ -1,3 +1,8 @@\n+2018-04-27  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/84691\n+\t* g++.dg/cpp0x/friend3.C: New.\n+\n 2018-04-27  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \tPR target/82518"}, {"sha": "4432fc184df623b1e969d022a8359cd839802c08", "filename": "gcc/testsuite/g++.dg/cpp0x/friend3.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Ffriend3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e34898d1e8920cc68d2089e45434c9703a77d0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Ffriend3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Ffriend3.C?ref=a6e34898d1e8920cc68d2089e45434c9703a77d0", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/84691\n+// { dg-do compile { target c++11 } }\n+\n+template<typename>\n+struct a {\n+  unsigned b = [] {\n+    union {\n+      friend void c() {}  // { dg-error \"local class\" }\n+    };  // { dg-error \"no members\" }\n+  };\n+};"}]}