{"sha": "e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTFhOTczZDgzOGIyNGU4YTc4ZWEwYjZiNDMzNmQ3Yzk2MWU0MmI3YQ==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2011-01-06T19:44:32Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2011-01-06T19:44:32Z"}, "message": "re PR target/43309 (amd64 TLS IE code sequence on Solaris 2/x86 violates spec)\n\n\tPR target/43309\n\t* config/i386/i386.c (legitimize_tls_address)\n\t<TLS_MODEL_INITIAL_EXEC>: Handle TARGET_64BIT && TARGET_SUN_TLS.\n\t* config/i386/i386.md (UNSPEC_TLS_IE_SUN): Declare.\n\t(tls_initial_exec_64_sun): New pattern.\n\nFrom-SVN: r168553", "tree": {"sha": "8426f69b885ccf4f9bd4efb07209728afebe1956", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8426f69b885ccf4f9bd4efb07209728afebe1956"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c73f67c50ef76e2b8b5797adf6e61ceb3ec9febd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c73f67c50ef76e2b8b5797adf6e61ceb3ec9febd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c73f67c50ef76e2b8b5797adf6e61ceb3ec9febd"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "c7fe6588663a6ebc08b3174763f3a9771dbe4576", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "patch": "@@ -1,3 +1,11 @@\n+2011-01-06  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\tPR target/43309\n+\t* config/i386/i386.c (legitimize_tls_address)\n+\t<TLS_MODEL_INITIAL_EXEC>: Handle TARGET_64BIT && TARGET_SUN_TLS.\n+\t* config/i386/i386.md (UNSPEC_TLS_IE_SUN): Declare.\n+\t(tls_initial_exec_64_sun): New pattern.\n+\n 2011-01-06  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* doc/invoke.texi (Overall Options): Improve wording and markup"}, {"sha": "39be03e278a97d4ca485c293f7d68377a026eb92", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "patch": "@@ -12505,6 +12505,17 @@ legitimize_tls_address (rtx x, enum tls_model model, int for_mov)\n     case TLS_MODEL_INITIAL_EXEC:\n       if (TARGET_64BIT)\n \t{\n+\t  if (TARGET_SUN_TLS)\n+\t    {\n+\t      /* The Sun linker took the AMD64 TLS spec literally\n+\t\t and can only handle %rax as destination of the\n+\t\t initial executable code sequence.  */\n+\n+\t      dest = gen_reg_rtx (Pmode);\n+\t      emit_insn (gen_tls_initial_exec_64_sun (dest, x));\n+\t      return dest;\n+\t    }\n+\n \t  pic = NULL;\n \t  type = UNSPEC_GOTNTPOFF;\n \t}"}, {"sha": "66ddf1d404d66896bc62696bb31876256146fe1a", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1a973d838b24e8a78ea0b6b4336d7c961e42b7a/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=e1a973d838b24e8a78ea0b6b4336d7c961e42b7a", "patch": "@@ -93,6 +93,7 @@\n   UNSPEC_TLS_GD\n   UNSPEC_TLS_LD_BASE\n   UNSPEC_TLSDESC\n+  UNSPEC_TLS_IE_SUN\n \n   ;; Other random patterns\n   UNSPEC_SCAS\n@@ -12688,6 +12689,18 @@\n    (set_attr \"memory\" \"load\")\n    (set_attr \"imm_disp\" \"false\")])\n \n+;; The Sun linker took the AMD64 TLS spec literally and can only handle\n+;; %rax as destination of the initial executable code sequence.\n+(define_insn \"tls_initial_exec_64_sun\"\n+  [(set (match_operand:DI 0 \"register_operand\" \"=a\")\n+\t(unspec:DI\n+\t [(match_operand:DI 1 \"tls_symbolic_operand\" \"\")]\n+\t UNSPEC_TLS_IE_SUN))\n+   (clobber (reg:CC FLAGS_REG))]\n+  \"TARGET_64BIT && TARGET_SUN_TLS\"\n+  \"mov{q}\\t{%%fs:0, %0|%0, QWORD PTR fs:0}\\n\\tadd{q}\\t{%a1@gottpoff(%%rip), %0|%0, %a1@gottpoff[rip]}\"\n+  [(set_attr \"type\" \"multi\")])\n+\n ;; GNU2 TLS patterns can be split.\n \n (define_expand \"tls_dynamic_gnu2_32\""}]}