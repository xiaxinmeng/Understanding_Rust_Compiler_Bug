{"sha": "b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjQ4Mjc4OWNjYTQyYzJlMWMzZDBjN2RkMWMxNDBmZTNlNWUzMjBhMg==", "commit": {"author": {"name": "Matt Austern", "email": "austern@apple.com", "date": "2004-12-20T20:11:41Z"}, "committer": {"name": "Matt Austern", "email": "austern@gcc.gnu.org", "date": "2004-12-20T20:11:41Z"}, "message": "re PR c++/19044 (Alternate asm name for atan ignored when calling __builtin_atan)\n\n\tPR c++/19044\n\n\t* c-common.c (set_builtin_user_assembler_name): New.\n\t* c-common.h (set_builtin_user_assembler_name): Declare.\n\t* c-decl.c (finish_decl): Use set_builtin_user_assembler_name\n\n\t* decl.c (make_rtl_for_nonlocal_decl): Use set_builtin_user_assembler_name\n\n\t* g++.dg/ext/builtin6.C: New\n\nFrom-SVN: r92428", "tree": {"sha": "a8c54e7d5be9f8fb754934d667e66e6346bf3f62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a8c54e7d5be9f8fb754934d667e66e6346bf3f62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/comments", "author": null, "committer": null, "parents": [{"sha": "90e34bd6374760bfdd0a8807e8323eaa50a749f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90e34bd6374760bfdd0a8807e8323eaa50a749f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90e34bd6374760bfdd0a8807e8323eaa50a749f1"}], "stats": {"total": 66, "additions": 57, "deletions": 9}, "files": [{"sha": "db153d504ed2c297073d01187b183868ebcbc47b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -1,3 +1,10 @@\n+2004-12-20  Matt Austern  <austern@apple.com>\n+\n+\tPR c++/19044\n+\t* c-common.c (set_builtin_user_assembler_name): New.\n+\t* c-common.h (set_builtin_user_assembler_name): Declare.\n+\t* c-decl.c (finish_decl): Use set_builtin_user_assembler_name\n+\t\n 2004-12-20  Diego Novillo  <dnovillo@redhat.com>\n \n \tPR tree-optimization/19080"}, {"sha": "b4c6349cbd83009e1e1267c1efcdd1bb08fb4724", "filename": "gcc/c-common.c", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -3223,6 +3223,26 @@ c_common_nodes_and_builtins (void)\n   main_identifier_node = get_identifier (\"main\");\n }\n \n+/* Look up the function in built_in_decls that corresponds to DECL\n+   and set ASMSPEC as its user assembler name.  DECL must be a\n+   function decl that declares a builtin. */\n+\n+void\n+set_builtin_user_assembler_name (tree decl, const char *asmspec)\n+{\n+  tree builtin;\n+  gcc_assert (TREE_CODE (decl) == FUNCTION_DECL\n+\t      && DECL_BUILT_IN_CLASS (decl) == BUILT_IN_NORMAL\n+\t      && asmspec != 0);\n+\n+  builtin = built_in_decls [DECL_FUNCTION_CODE (decl)];\n+  set_user_assembler_name (builtin, asmspec);\n+  if (DECL_FUNCTION_CODE (decl) == BUILT_IN_MEMCPY)\n+    init_block_move_fn (asmspec);\n+  else if (DECL_FUNCTION_CODE (decl) == BUILT_IN_MEMSET)\n+    init_block_clear_fn (asmspec);\n+}\n+\n tree\n build_va_arg (tree expr, tree type)\n {"}, {"sha": "8ebc560169f08483547cf6987a3368727b15c7bf", "filename": "gcc/c-common.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.h?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -674,6 +674,8 @@ extern tree c_build_qualified_type (tree, int);\n    frontends.  */\n extern void c_common_nodes_and_builtins (void);\n \n+extern void set_builtin_user_assembler_name (tree decl, const char *asmspec);\n+\n extern void disable_builtin_function (const char *);\n \n extern tree build_va_arg (tree, tree);"}, {"sha": "97420d16cc2a544acda9967d608730af7d1d0a7a", "filename": "gcc/c-decl.c", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -3233,14 +3233,7 @@ finish_decl (tree decl, tree init, tree asmspec_tree)\n   if (TREE_CODE (decl) == FUNCTION_DECL && asmspec)\n     {\n       if (DECL_BUILT_IN_CLASS (decl) == BUILT_IN_NORMAL)\n-\t{\n-\t  tree builtin = built_in_decls [DECL_FUNCTION_CODE (decl)];\n-\t  set_user_assembler_name (builtin, asmspec);\n-\t   if (DECL_FUNCTION_CODE (decl) == BUILT_IN_MEMCPY)\n-\t     init_block_move_fn (asmspec);\n-\t   else if (DECL_FUNCTION_CODE (decl) == BUILT_IN_MEMSET)\n-\t     init_block_clear_fn (asmspec);\n-\t }\n+\tset_builtin_user_assembler_name (decl, asmspec);\n       set_user_assembler_name (decl, asmspec);\n     }\n "}, {"sha": "ac2a9abb684406bda66f5400bdc2f49f9949e7eb", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -1,3 +1,8 @@\n+2004-12-20  Matt Austern <austern@apple.com>\n+\n+\tPR c++/19044\n+\t* decl.c (make_rtl_for_nonlocal_decl): Use set_builtin_user_assembler_name\n+\t\n 2004-12-19  Mark Mitchell  <mark@codesourcery.com>\n \n \t* cp-tree.h (note_decl_for_pch): New function."}, {"sha": "dbaf23e23c2614d0167883678a31fa1e3b825a6d", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -4644,7 +4644,12 @@ make_rtl_for_nonlocal_decl (tree decl, tree init, const char* asmspec)\n \t  DECL_HARD_REGISTER (decl) = 1;\n \t}\n       else\n-\tset_user_assembler_name (decl, asmspec);\n+\t{\n+\t  if (TREE_CODE (decl) == FUNCTION_DECL\n+\t      && DECL_BUILT_IN_CLASS (decl) == BUILT_IN_NORMAL)\n+\t    set_builtin_user_assembler_name (decl, asmspec);\n+\t  set_user_assembler_name (decl, asmspec);\n+\t}\n     }\n \n   /* Handle non-variables up front.  */"}, {"sha": "19bbb9ad0d37361d4c5230b428343178846b144e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -1,3 +1,8 @@\n+2004-12-20  Matt Austern  <austern@apple.com>\n+\n+\tPR c++/19044\n+\t* g++.dg/ext/builtin6.C: New\n+\t\n 2004-12-20  Diego Novillo  <dnovillo@redhat.com>\n \n \tPR tree-optimization/19080"}, {"sha": "8f405b095c6d7f87589a18a495b326d033a99a9e", "filename": "gcc/testsuite/g++.dg/ext/builtin6.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fbuiltin6.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fbuiltin6.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fbuiltin6.C?ref=b482789cca42c2e1c3d0c7dd1c140fe3e5e320a2", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/19044\n+// Verify that alternate asm name for builtin named \"foo\" also gets\n+// applied to its sibling \"__builtin_foo\".\n+\n+// { dg-do compile }\n+// { dg-final { scan-assembler \"fancy_sin\" } }\n+\n+extern \"C\" double sin(double) __asm(\"_fancy_sin\");\n+\n+double foo(double x) { return __builtin_sin(x); }\n+"}]}