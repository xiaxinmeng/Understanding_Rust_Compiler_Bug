{"sha": "7e9534bc544cd62cb587a17c50eed08f8ca68185", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2U5NTM0YmM1NDRjZDYyY2I1ODdhMTdjNTBlZWQwOGY4Y2E2ODE4NQ==", "commit": {"author": {"name": "David Daney", "email": "ddaney@avtrex.com", "date": "2005-02-16T04:16:06Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2005-02-16T04:16:06Z"}, "message": "prims.cc (_Jv_CreateJavaVM): Add comment about initialization order.\n\n2005-02-15  David Daney <ddaney@avtrex.com>\n            Bryce McKinlay  <mckinlay@redhat.com>\n\n\t* prims.cc (_Jv_CreateJavaVM): Add comment about initialization order.\n\t* posix-threads.cc (_Jv_InitThreads): Call block_sigchld() here to\n\tensure that GC threads inherit the new signal mask.\n\t(block_sigchld): Call JvFail rather than throwing exception if\n\tpthread_sigmask() fails.\n\nCo-Authored-By: Bryce McKinlay <mckinlay@redhat.com>\n\nFrom-SVN: r95095", "tree": {"sha": "f9f4f02f6bbfd331d481cf0e7a15287b74a30280", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f9f4f02f6bbfd331d481cf0e7a15287b74a30280"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7e9534bc544cd62cb587a17c50eed08f8ca68185", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e9534bc544cd62cb587a17c50eed08f8ca68185", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e9534bc544cd62cb587a17c50eed08f8ca68185", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e9534bc544cd62cb587a17c50eed08f8ca68185/comments", "author": null, "committer": null, "parents": [{"sha": "5909b0346cca73468ebde3e747bbe21453364a03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5909b0346cca73468ebde3e747bbe21453364a03", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5909b0346cca73468ebde3e747bbe21453364a03"}], "stats": {"total": 37, "additions": 26, "deletions": 11}, "files": [{"sha": "abc0d70bd84b049737b2da0eb38366b05e59ea41", "filename": "libjava/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e9534bc544cd62cb587a17c50eed08f8ca68185/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e9534bc544cd62cb587a17c50eed08f8ca68185/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=7e9534bc544cd62cb587a17c50eed08f8ca68185", "patch": "@@ -1,3 +1,12 @@\n+2005-02-15  David Daney <ddaney@avtrex.com>\n+\t    Bryce McKinlay  <mckinlay@redhat.com>\n+\t    \n+\t* prims.cc (_Jv_CreateJavaVM): Add comment about initialization order.\n+\t* posix-threads.cc (_Jv_InitThreads): Call block_sigchld() here to\n+\tensure that GC threads inherit the new signal mask.\n+\t(block_sigchld): Call JvFail rather than throwing exception if\n+\tpthread_sigmask() fails.\n+\n 2005-02-15  Mark Wielaard  <mark@klomp.org>\n \n \t* java/util/jar/Attributes.java (Name.CLASS_PATH): Document that"}, {"sha": "91da25cf38de9d9fe49557993aa7a30b33b941f5", "filename": "libjava/posix-threads.cc", "status": "modified", "additions": 15, "deletions": 11, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e9534bc544cd62cb587a17c50eed08f8ca68185/libjava%2Fposix-threads.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e9534bc544cd62cb587a17c50eed08f8ca68185/libjava%2Fposix-threads.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fposix-threads.cc?ref=7e9534bc544cd62cb587a17c50eed08f8ca68185", "patch": "@@ -281,6 +281,17 @@ handle_intr (int)\n   // Do nothing.\n }\n \n+static void\n+block_sigchld()\n+{\n+  sigset_t mask;\n+  sigemptyset (&mask);\n+  sigaddset (&mask, SIGCHLD);\n+  int c = pthread_sigmask (SIG_BLOCK, &mask, NULL);\n+  if (c != 0)\n+    JvFail (strerror (c));\n+}\n+\n void\n _Jv_InitThreads (void)\n {\n@@ -296,6 +307,10 @@ _Jv_InitThreads (void)\n   sigemptyset (&act.sa_mask);\n   act.sa_flags = 0;\n   sigaction (INTR, &act, NULL);\n+\n+  // Block SIGCHLD here to ensure that any non-Java threads inherit the new \n+  // signal mask.\n+  block_sigchld();\n }\n \n _Jv_Thread_t *\n@@ -333,17 +348,6 @@ _Jv_ThreadSetPriority (_Jv_Thread_t *data, jint prio)\n #endif\n }\n \n-static void\n-block_sigchld()\n-{\n-  sigset_t mask;\n-  sigemptyset (&mask);\n-  sigaddset (&mask, SIGCHLD);\n-  int c = pthread_sigmask (SIG_BLOCK, &mask, NULL);\n-  if (c != 0)\n-    throw new java::lang::InternalError (JvNewStringUTF (strerror (c)));\n-}\n-\n void\n _Jv_ThreadRegister (_Jv_Thread_t *data)\n {"}, {"sha": "d12a2428ef0a6deb0f72f720149e1213673e1432", "filename": "libjava/prims.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e9534bc544cd62cb587a17c50eed08f8ca68185/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e9534bc544cd62cb587a17c50eed08f8ca68185/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=7e9534bc544cd62cb587a17c50eed08f8ca68185", "patch": "@@ -921,6 +921,8 @@ _Jv_CreateJavaVM (void* /*vm_args*/)\n \n   PROCESS_GCJ_PROPERTIES;\n \n+  /* Threads must be initialized before the GC, so that it inherits the\n+     signal mask.  */\n   _Jv_InitThreads ();\n   _Jv_InitGC ();\n   _Jv_InitializeSyncMutex ();"}]}