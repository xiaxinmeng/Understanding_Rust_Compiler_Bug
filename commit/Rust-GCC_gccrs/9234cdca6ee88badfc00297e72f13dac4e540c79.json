{"sha": "9234cdca6ee88badfc00297e72f13dac4e540c79", "node_id": "C_kwDOANBUbNoAKDkyMzRjZGNhNmVlODhiYWRmYzAwMjk3ZTcyZjEzZGFjNGU1NDBjNzk", "commit": {"author": {"name": "Nick Clifton", "email": "nickc@redhat.com", "date": "2022-07-01T14:58:52Z"}, "committer": {"name": "Nick Clifton", "email": "nickc@redhat.com", "date": "2022-07-01T15:00:06Z"}, "message": "Add a recursion limit to the demangle_const function in the Rust demangler.\n\nlibiberty/\n\tPR demangler/105039\n\t* rust-demangle.c (demangle_const): Add recursion limit.", "tree": {"sha": "342cdf16f920434d3b09e2b82a0b5f9167586f77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/342cdf16f920434d3b09e2b82a0b5f9167586f77"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9234cdca6ee88badfc00297e72f13dac4e540c79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9234cdca6ee88badfc00297e72f13dac4e540c79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9234cdca6ee88badfc00297e72f13dac4e540c79", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9234cdca6ee88badfc00297e72f13dac4e540c79/comments", "author": {"login": "nickclifton", "id": 31441682, "node_id": "MDQ6VXNlcjMxNDQxNjgy", "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nickclifton", "html_url": "https://github.com/nickclifton", "followers_url": "https://api.github.com/users/nickclifton/followers", "following_url": "https://api.github.com/users/nickclifton/following{/other_user}", "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}", "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions", "organizations_url": "https://api.github.com/users/nickclifton/orgs", "repos_url": "https://api.github.com/users/nickclifton/repos", "events_url": "https://api.github.com/users/nickclifton/events{/privacy}", "received_events_url": "https://api.github.com/users/nickclifton/received_events", "type": "User", "site_admin": false}, "committer": {"login": "nickclifton", "id": 31441682, "node_id": "MDQ6VXNlcjMxNDQxNjgy", "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4", "gravatar_id": "", "url": "https://api.github.com/users/nickclifton", "html_url": "https://github.com/nickclifton", "followers_url": "https://api.github.com/users/nickclifton/followers", "following_url": "https://api.github.com/users/nickclifton/following{/other_user}", "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}", "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions", "organizations_url": "https://api.github.com/users/nickclifton/orgs", "repos_url": "https://api.github.com/users/nickclifton/repos", "events_url": "https://api.github.com/users/nickclifton/events{/privacy}", "received_events_url": "https://api.github.com/users/nickclifton/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aefe23f720a542e90ecc6629885b01d44139b043", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aefe23f720a542e90ecc6629885b01d44139b043", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aefe23f720a542e90ecc6629885b01d44139b043"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "36afcfae2780499f5db38e76b94eb24b3da4e0a7", "filename": "libiberty/rust-demangle.c", "status": "modified", "additions": 20, "deletions": 9, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9234cdca6ee88badfc00297e72f13dac4e540c79/libiberty%2Frust-demangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9234cdca6ee88badfc00297e72f13dac4e540c79/libiberty%2Frust-demangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Frust-demangle.c?ref=9234cdca6ee88badfc00297e72f13dac4e540c79", "patch": "@@ -126,7 +126,7 @@ parse_integer_62 (struct rust_demangler *rdm)\n     return 0;\n \n   x = 0;\n-  while (!eat (rdm, '_'))\n+  while (!eat (rdm, '_') && !rdm->errored)\n     {\n       c = next (rdm);\n       x *= 62;\n@@ -1148,6 +1148,15 @@ demangle_const (struct rust_demangler *rdm)\n   if (rdm->errored)\n     return;\n \n+  if (rdm->recursion != RUST_NO_RECURSION_LIMIT)\n+    {\n+      ++ rdm->recursion;\n+      if (rdm->recursion > RUST_MAX_RECURSION_COUNT)\n+\t/* FIXME: There ought to be a way to report\n+\t   that the recursion limit has been reached.  */\n+\tgoto fail_return;\n+    }\n+\n   if (eat (rdm, 'B'))\n     {\n       backref = parse_integer_62 (rdm);\n@@ -1158,7 +1167,7 @@ demangle_const (struct rust_demangler *rdm)\n           demangle_const (rdm);\n           rdm->next = old_next;\n         }\n-      return;\n+      goto pass_return;\n     }\n \n   ty_tag = next (rdm);\n@@ -1167,7 +1176,7 @@ demangle_const (struct rust_demangler *rdm)\n     /* Placeholder. */\n     case 'p':\n       PRINT (\"_\");\n-      return;\n+      goto pass_return;\n \n     /* Unsigned integer types. */\n     case 'h':\n@@ -1200,18 +1209,20 @@ demangle_const (struct rust_demangler *rdm)\n       break;\n \n     default:\n-      rdm->errored = 1;\n-      return;\n+      goto fail_return;\n     }\n \n-  if (rdm->errored)\n-    return;\n-\n-  if (rdm->verbose)\n+  if (!rdm->errored && rdm->verbose)\n     {\n       PRINT (\": \");\n       PRINT (basic_type (ty_tag));\n     }\n+\n+ fail_return:\n+  rdm->errored = 1;\n+ pass_return:\n+  if (rdm->recursion != RUST_NO_RECURSION_LIMIT)\n+    -- rdm->recursion;\n }\n \n static void"}]}