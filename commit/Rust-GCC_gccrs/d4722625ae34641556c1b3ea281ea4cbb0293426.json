{"sha": "d4722625ae34641556c1b3ea281ea4cbb0293426", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ3MjI2MjVhZTM0NjQxNTU2YzFiM2VhMjgxZWE0Y2JiMDI5MzQyNg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-12-06T23:29:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-12-06T23:29:04Z"}, "message": "re PR fortran/88377 (ICE in gfc_omp_clause_copy_ctor, at fortran/trans-openmp.c:614)\n\n\tPR fortran/88377\n\t* trans-openmp.c (gfc_omp_clause_default_ctor,\n\tgfc_omp_clause_copy_ctor, gfc_omp_clause_assign_op,\n\tgfc_omp_clause_linear_ctor, gfc_omp_clause_dtor): Only consider\n\tGFC_DECL_GET_SCALAR_ALLOCATABLE vars as scalar allocatables if they\n\thave pointer type.\n\n\t* gfortran.dg/gomp/pr88377.f90: New test.\n\nFrom-SVN: r266879", "tree": {"sha": "efd4d5b91796bb86a89e390c743bf192b63d071d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/efd4d5b91796bb86a89e390c743bf192b63d071d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d4722625ae34641556c1b3ea281ea4cbb0293426", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4722625ae34641556c1b3ea281ea4cbb0293426", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4722625ae34641556c1b3ea281ea4cbb0293426", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4722625ae34641556c1b3ea281ea4cbb0293426/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b8a003c16567ccecffce256a2b35c9210db933a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8a003c16567ccecffce256a2b35c9210db933a4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8a003c16567ccecffce256a2b35c9210db933a4"}], "stats": {"total": 42, "additions": 37, "deletions": 5}, "files": [{"sha": "9e17decbe18856b0ad8727398e3491934eaf1c64", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d4722625ae34641556c1b3ea281ea4cbb0293426", "patch": "@@ -1,3 +1,12 @@\n+2018-12-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/88377\n+\t* trans-openmp.c (gfc_omp_clause_default_ctor,\n+\tgfc_omp_clause_copy_ctor, gfc_omp_clause_assign_op,\n+\tgfc_omp_clause_linear_ctor, gfc_omp_clause_dtor): Only consider\n+\tGFC_DECL_GET_SCALAR_ALLOCATABLE vars as scalar allocatables if they\n+\thave pointer type.\n+\n 2018-12-03  Fritz Reese  <fritzoreese@gmail.com>\n \t    Mark Eggleston  <mark.eggleston@codethink.co.uk>\n "}, {"sha": "c9fc4e49c450cd3ab42639ccc521e5c8fe6e4736", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=d4722625ae34641556c1b3ea281ea4cbb0293426", "patch": "@@ -460,7 +460,8 @@ gfc_omp_clause_default_ctor (tree clause, tree decl, tree outer)\n \n   if ((! GFC_DESCRIPTOR_TYPE_P (type)\n        || GFC_TYPE_ARRAY_AKIND (type) != GFC_ARRAY_ALLOCATABLE)\n-      && !GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause)))\n+      && (!GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause))\n+\t  || !POINTER_TYPE_P (type)))\n     {\n       if (gfc_has_alloc_comps (type, OMP_CLAUSE_DECL (clause)))\n \t{\n@@ -567,7 +568,8 @@ gfc_omp_clause_copy_ctor (tree clause, tree dest, tree src)\n \n   if ((! GFC_DESCRIPTOR_TYPE_P (type)\n        || GFC_TYPE_ARRAY_AKIND (type) != GFC_ARRAY_ALLOCATABLE)\n-      && !GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause)))\n+      && (!GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause))\n+\t  || !POINTER_TYPE_P (type)))\n     {\n       if (gfc_has_alloc_comps (type, OMP_CLAUSE_DECL (clause)))\n \t{\n@@ -667,7 +669,8 @@ gfc_omp_clause_assign_op (tree clause, tree dest, tree src)\n \n   if ((! GFC_DESCRIPTOR_TYPE_P (type)\n        || GFC_TYPE_ARRAY_AKIND (type) != GFC_ARRAY_ALLOCATABLE)\n-      && !GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause)))\n+      && (!GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause))\n+\t  || !POINTER_TYPE_P (type)))\n     {\n       if (gfc_has_alloc_comps (type, OMP_CLAUSE_DECL (clause)))\n \t{\n@@ -905,7 +908,8 @@ gfc_omp_clause_linear_ctor (tree clause, tree dest, tree src, tree add)\n \n   if ((! GFC_DESCRIPTOR_TYPE_P (type)\n        || GFC_TYPE_ARRAY_AKIND (type) != GFC_ARRAY_ALLOCATABLE)\n-      && !GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause)))\n+      && (!GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause))\n+\t  || !POINTER_TYPE_P (type)))\n     {\n       gcc_assert (TREE_CODE (type) == ARRAY_TYPE);\n       if (!TYPE_DOMAIN (type)\n@@ -989,7 +993,8 @@ gfc_omp_clause_dtor (tree clause, tree decl)\n \n   if ((! GFC_DESCRIPTOR_TYPE_P (type)\n        || GFC_TYPE_ARRAY_AKIND (type) != GFC_ARRAY_ALLOCATABLE)\n-      && !GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause)))\n+      && (!GFC_DECL_GET_SCALAR_ALLOCATABLE (OMP_CLAUSE_DECL (clause))\n+\t  || !POINTER_TYPE_P (type)))\n     {\n       if (gfc_has_alloc_comps (type, OMP_CLAUSE_DECL (clause)))\n \treturn gfc_walk_alloc_comps (decl, NULL_TREE,"}, {"sha": "92bafd35d43bef5396960d363887b15efd1a802b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d4722625ae34641556c1b3ea281ea4cbb0293426", "patch": "@@ -1,5 +1,8 @@\n 2018-12-07  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/88377\n+\t* gfortran.dg/gomp/pr88377.f90: New test.\n+\n \tPR c/88367\n \t* gcc.dg/tree-ssa/pr88367.c: New test.\n "}, {"sha": "87b30b8ef237185b7bb086b1963638eaa12e5ee6", "filename": "gcc/testsuite/gfortran.dg/gomp/pr88377.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr88377.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4722625ae34641556c1b3ea281ea4cbb0293426/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr88377.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr88377.f90?ref=d4722625ae34641556c1b3ea281ea4cbb0293426", "patch": "@@ -0,0 +1,15 @@\n+! PR fortran/88377\n+! { dg-do compile }\n+\n+program pr88377\n+  call s(3)\n+contains\n+  subroutine s(n)\n+    integer :: n\n+    character(n), allocatable :: x\n+    x = 'abc'\n+    !$omp task\n+    print *, x, (x == 'abc')\n+    !$omp end task\n+  end\n+end"}]}