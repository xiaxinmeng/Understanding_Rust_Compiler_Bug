{"sha": "a35c1ac710c0bbd03f00380179a375c45c81f08a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTM1YzFhYzcxMGMwYmJkMDNmMDAzODAxNzlhMzc1YzQ1YzgxZjA4YQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2014-10-07T07:56:43Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2014-10-07T07:56:43Z"}, "message": "lto-opts.c (lto_write_options): Handle -fmath-errno, -fsigned-zeros and -ftrapping-math.\n\n\t* lto-opts.c (lto_write_options): Handle -fmath-errno, -fsigned-zeros\n\tand -ftrapping-math.\n\t* lto-wrapper.c (merge_and_complain): Likewise.\n\t(run_gcc): Likewise.\n\nFrom-SVN: r215966", "tree": {"sha": "ddfc6423ea43b158728db7853802890da8621bf1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ddfc6423ea43b158728db7853802890da8621bf1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a35c1ac710c0bbd03f00380179a375c45c81f08a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a35c1ac710c0bbd03f00380179a375c45c81f08a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a35c1ac710c0bbd03f00380179a375c45c81f08a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a35c1ac710c0bbd03f00380179a375c45c81f08a/comments", "author": null, "committer": null, "parents": [{"sha": "7a0ca710c81d249cf8346eb243120dd6f727b354", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a0ca710c81d249cf8346eb243120dd6f727b354", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a0ca710c81d249cf8346eb243120dd6f727b354"}], "stats": {"total": 81, "additions": 80, "deletions": 1}, "files": [{"sha": "9349546e524e2c5b7f8e538dde9b8d3c246596cd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -1,3 +1,10 @@\n+2014-10-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* lto-opts.c (lto_write_options): Handle -fmath-errno, -fsigned-zeros\n+\tand -ftrapping-math.\n+\t* lto-wrapper.c (merge_and_complain): Likewise.\n+\t(run_gcc): Likewise.\n+\n 2014-10-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* calls.c (expand_call): Do not use the target as the return slot if"}, {"sha": "ceccb6f44cb0c328a047be17d817c76e7270f80e", "filename": "gcc/lto-opts.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Flto-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Flto-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-opts.c?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -115,6 +115,24 @@ lto_write_options (void)\n       default:\n \tgcc_unreachable ();\n       }\n+  /* The default -fmath-errno, -fsigned-zeros and -ftrapping-math change\n+     depending on the language (they can be disabled by the Ada and Java\n+     front-ends).  Pass thru conservative standard settings.  */\n+  if (!global_options_set.x_flag_errno_math)\n+    append_to_collect_gcc_options (&temporary_obstack, &first_p,\n+\t\t\t\t   global_options.x_flag_errno_math\n+\t\t\t\t   ? \"-fmath-errno\"\n+\t\t\t\t   : \"-fno-math-errno\");\n+  if (!global_options_set.x_flag_signed_zeros)\n+    append_to_collect_gcc_options (&temporary_obstack, &first_p,\n+\t\t\t\t   global_options.x_flag_signed_zeros\n+\t\t\t\t   ? \"-fsigned-zeros\"\n+\t\t\t\t   : \"-fno-signed-zeros\");\n+  if (!global_options_set.x_flag_trapping_math)\n+    append_to_collect_gcc_options (&temporary_obstack, &first_p,\n+\t\t\t\t   global_options.x_flag_trapping_math\n+\t\t\t\t   ? \"-ftrapping-math\"\n+\t\t\t\t   : \"-fno-trapping-math\");\n   /* We need to merge -f[no-]strict-overflow, -f[no-]wrapv and -f[no-]trapv\n      conservatively, so stream out their defaults.  */\n   if (!global_options_set.x_flag_wrapv"}, {"sha": "8033b155baa661befaded2911122f369f11bf569", "filename": "gcc/lto-wrapper.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Flto-wrapper.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Flto-wrapper.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-wrapper.c?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -261,14 +261,20 @@ merge_and_complain (struct cl_decoded_option **decoded_options,\n \t    (*decoded_options)[j] = *foption;\n \t  break;\n \n+\tcase OPT_fmath_errno:\n+\tcase OPT_fsigned_zeros:\n+\tcase OPT_ftrapping_math:\n \tcase OPT_fwrapv:\n \t  /* For selected options we can merge conservatively.  */\n \t  for (j = 0; j < *decoded_options_count; ++j)\n \t    if ((*decoded_options)[j].opt_index == foption->opt_index)\n \t      break;\n \t  if (j == *decoded_options_count)\n \t    append_option (decoded_options, decoded_options_count, foption);\n-\t  /* -fwrapv > -fno-wrapv.  */\n+\t  /* -fmath-errno > -fno-math-errno,\n+\t     -fsigned-zeros > -fno-signed-zeros,\n+\t     -ftrapping-math -> -fno-trapping-math,\n+\t     -fwrapv > -fno-wrapv.  */\n \t  else if (foption->value > (*decoded_options)[j].value)\n \t    (*decoded_options)[j] = *foption;\n \t  break;\n@@ -502,6 +508,9 @@ run_gcc (unsigned argc, char *argv[])\n \tcase OPT_fpcc_struct_return:\n \tcase OPT_fshort_double:\n \tcase OPT_ffp_contract_:\n+\tcase OPT_fmath_errno:\n+\tcase OPT_fsigned_zeros:\n+\tcase OPT_ftrapping_math:\n \tcase OPT_fwrapv:\n \tcase OPT_ftrapv:\n \tcase OPT_fstrict_overflow:"}, {"sha": "21ca143c0b44e295899cb3043d1e3a38c46d3a4a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -1,3 +1,8 @@\n+2014-10-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/lto16.adb: New test.\n+\t* gnat.dg/lto16_pkg.adb: New helper.\n+\n 2014-10-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/return4.adb: New test."}, {"sha": "82d02b4116f439d46ad078a1f43c446759a045bc", "filename": "gcc/testsuite/gnat.dg/lto16.adb", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2Fgnat.dg%2Flto16.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2Fgnat.dg%2Flto16.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Flto16.adb?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -0,0 +1,17 @@\n+-- { dg-do link }\n+-- { dg-options \"-O -flto\" }\n+-- { dg-require-effective-target lto }\n+\n+with Lto16_Pkg; use Lto16_Pkg;\n+with Text_IO; use Text_IO;\n+\n+procedure Lto16 is\n+begin\n+  if F = 0.0 then\n+    Put_Line (\"zero\");\n+  else\n+    Put_Line (\"non-zero\");\n+  end if;\n+exception\n+  when others => Put_Line (\"exception\");\n+end;"}, {"sha": "edfa399369a2967b6740ede7205994412422f476", "filename": "gcc/testsuite/gnat.dg/lto16_pkg.adb", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2Fgnat.dg%2Flto16_pkg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2Fgnat.dg%2Flto16_pkg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Flto16_pkg.adb?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -0,0 +1,18 @@\n+with Ada.Calendar; use Ada.Calendar;\n+\n+package body Lto16_Pkg is\n+\n+  function F return Float is\n+    F1 : Float := Float (Seconds (Clock));\n+    F2 : Float := Float (Seconds (Clock));\n+    F  : Float;\n+  begin\n+    if F1 > F2 then\n+      F := (F2 - F1) / 2.0;\n+    else\n+      F := (F1 - F2) / 2.0;\n+    end if;\n+    return F;\n+  end;\n+\n+end Lto16_Pkg;"}, {"sha": "e9b74d39337c4d13d69595011f2e6bfa5585f917", "filename": "gcc/testsuite/gnat.dg/lto16_pkg.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2Fgnat.dg%2Flto16_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a35c1ac710c0bbd03f00380179a375c45c81f08a/gcc%2Ftestsuite%2Fgnat.dg%2Flto16_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Flto16_pkg.ads?ref=a35c1ac710c0bbd03f00380179a375c45c81f08a", "patch": "@@ -0,0 +1,5 @@\n+package Lto16_Pkg is\n+\n+  function F return Float;\n+\n+end Lto16_Pkg;"}]}