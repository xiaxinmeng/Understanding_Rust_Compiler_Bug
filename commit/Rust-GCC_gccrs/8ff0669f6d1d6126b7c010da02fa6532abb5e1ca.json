{"sha": "8ff0669f6d1d6126b7c010da02fa6532abb5e1ca", "node_id": "C_kwDOANBUbNoAKDhmZjA2NjlmNmQxZDYxMjZiN2MwMTBkYTAyZmE2NTMyYWJiNWUxY2E", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-01-26T13:17:40Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-02-01T18:28:52Z"}, "message": "[nvptx] Update default ptx isa to 6.3\n\nWith the following example, minimized from parallel-dims.c:\n...\nint\nmain (void)\n{\n  int vectors_max = -1;\n  #pragma acc parallel num_gangs (1) num_workers (1) copy (vectors_max)\n  {\n    for (int i = 0; i < 2; i++)\n      for (int j = 0; j < 2; j++)\n        #pragma acc loop vector reduction (max: vectors_max)\n        for (int k = 0; k < 32; k++)\n          vectors_max = k;\n  }\n\n  if (vectors_max != 31)\n    __builtin_abort ();\n\n  return 0;\n}\n...\nI run into (T400, driver version 470.94):\n...\nFAIL: libgomp.oacc-c/../libgomp.oacc-c-c++-common/parallel-dims.c \\\n  -DACC_DEVICE_TYPE_nvidia=1 -DACC_MEM_SHARED=0 -foffload=nvptx-none -O2 \\\n  execution test\n...\nThe FAIL does not happen with GOMP_NVPTX_JIT=-O0.\n\nThe problem seems to be that the shfl insns for the vector reduction are not\nexecuted uniformly by the warp.  Enforcing this by using shfl.sync fixes the\nproblem.\n\nFix this by setting the ptx isa to 6.3 by default, which allows the use of\nshfl.sync.\n\nTested on x86_64 with nvptx accelerator.\n\ngcc/ChangeLog:\n\n2022-01-27  Tom de Vries  <tdevries@suse.de>\n\n\t* config/nvptx/nvptx.opt (mptx): Set to PTX_VERSION_6_3 by default.", "tree": {"sha": "18bf26420bad3519dcecb79ccff84814e9978e5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/18bf26420bad3519dcecb79ccff84814e9978e5b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ff0669f6d1d6126b7c010da02fa6532abb5e1ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ff0669f6d1d6126b7c010da02fa6532abb5e1ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ff0669f6d1d6126b7c010da02fa6532abb5e1ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ff0669f6d1d6126b7c010da02fa6532abb5e1ca/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "57f971f99209cc950d7e706b7b52f4c9ef1d10b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f971f99209cc950d7e706b7b52f4c9ef1d10b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57f971f99209cc950d7e706b7b52f4c9ef1d10b0"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "6e12b1f729693c658e6600f0d18f9305d1f34a9e", "filename": "gcc/config/nvptx/nvptx.opt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ff0669f6d1d6126b7c010da02fa6532abb5e1ca/gcc%2Fconfig%2Fnvptx%2Fnvptx.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ff0669f6d1d6126b7c010da02fa6532abb5e1ca/gcc%2Fconfig%2Fnvptx%2Fnvptx.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.opt?ref=8ff0669f6d1d6126b7c010da02fa6532abb5e1ca", "patch": "@@ -89,5 +89,5 @@ EnumValue\n Enum(ptx_version) String(7.0) Value(PTX_VERSION_7_0)\n \n mptx=\n-Target RejectNegative ToLower Joined Enum(ptx_version) Var(ptx_version_option) Init(PTX_VERSION_3_1)\n+Target RejectNegative ToLower Joined Enum(ptx_version) Var(ptx_version_option) Init(PTX_VERSION_6_3)\n Specify the version of the ptx version to use."}]}