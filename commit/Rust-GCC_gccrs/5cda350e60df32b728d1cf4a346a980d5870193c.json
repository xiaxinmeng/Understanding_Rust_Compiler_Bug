{"sha": "5cda350e60df32b728d1cf4a346a980d5870193c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWNkYTM1MGU2MGRmMzJiNzI4ZDFjZjRhMzQ2YTk4MGQ1ODcwMTkzYw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2012-02-29T07:21:38Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2012-02-29T07:21:38Z"}, "message": "re PR fortran/52386 (ICE in gfc_conv_descriptor_dtyp (realloc LHS related))\n\n2012-02-29  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/52386\n\t* trans-expr.c (fcncall_realloc_result): Dereference the\n\tdescriptor if needed.\n\n2012-02-29  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/52386\n\t* gfortran.dg/realloc_on_assign_13.f90 : New test.\n\nFrom-SVN: r184651", "tree": {"sha": "6711111812b41f509f252bc2a50d75120d9584f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6711111812b41f509f252bc2a50d75120d9584f4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5cda350e60df32b728d1cf4a346a980d5870193c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cda350e60df32b728d1cf4a346a980d5870193c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5cda350e60df32b728d1cf4a346a980d5870193c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cda350e60df32b728d1cf4a346a980d5870193c/comments", "author": null, "committer": null, "parents": [{"sha": "b7c8e77fbf781f7d4a773e3aec742c27582a63f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7c8e77fbf781f7d4a773e3aec742c27582a63f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7c8e77fbf781f7d4a773e3aec742c27582a63f8"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "48670876a394a86ea81db4a6bce397f08f50e46b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=5cda350e60df32b728d1cf4a346a980d5870193c", "patch": "@@ -1,3 +1,9 @@\n+2012-02-29  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/52386\n+\t* trans-expr.c (fcncall_realloc_result): Dereference the\n+\tdescriptor if needed.\n+\n 2012-02-22  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/52335"}, {"sha": "3552da36be8b53ed2b95a4c62541361be3dc72cd", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=5cda350e60df32b728d1cf4a346a980d5870193c", "patch": "@@ -6299,6 +6299,8 @@ fcncall_realloc_result (gfc_se *se, int rank)\n   /* Use the allocation done by the library.  Substitute the lhs\n      descriptor with a copy, whose data field is nulled.*/\n   desc = build_fold_indirect_ref_loc (input_location, se->expr);\n+  if (POINTER_TYPE_P (TREE_TYPE (desc)))\n+    desc = build_fold_indirect_ref_loc (input_location, desc);\n \n   /* Unallocated, the descriptor does not have a dtype.  */\n   tmp = gfc_conv_descriptor_dtype (desc);"}, {"sha": "5ff3cd837ab8d055ab042b0e98af05165967e14b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5cda350e60df32b728d1cf4a346a980d5870193c", "patch": "@@ -1,3 +1,8 @@\n+2012-02-29  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/52386\n+\t* gfortran.dg/realloc_on_assign_13.f90 : New test.\n+\n 2012-02-28  Matthew Gretton-Dann  <matthew.gretton-dann@arm.com>\n \n \tPR target/51534"}, {"sha": "9661d724f5b6e3b41b76e07be6bdbc3c86ac59cf", "filename": "gcc/testsuite/gfortran.dg/realloc_on_assign_13.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ftestsuite%2Fgfortran.dg%2Frealloc_on_assign_13.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cda350e60df32b728d1cf4a346a980d5870193c/gcc%2Ftestsuite%2Fgfortran.dg%2Frealloc_on_assign_13.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Frealloc_on_assign_13.f90?ref=5cda350e60df32b728d1cf4a346a980d5870193c", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do compile }\n+! Test the fix for PR52386.\n+!\n+! Contributed by Juergen Reuter  <reuter@physik.uni-freiburg.de>\n+!\n+module cascades\n+  implicit none\n+  private\n+contains\n+    function reduced (array)\n+      integer, dimension(:), allocatable :: reduced\n+      integer, dimension(:), intent(in) :: array\n+      logical, dimension(size(array)) :: mask\n+      mask = .true. \n+      allocate (reduced (count (mask)))\n+      reduced = pack (array, mask)\n+    end function reduced\n+end module cascades\n+! { dg-final { cleanup-modules \"cascades\" } }\n+"}]}