{"sha": "ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "node_id": "C_kwDOANBUbNoAKGNlOGRiZTdkODM0YjkyNjRkN2E1Y2Q3NGQzY2U2Yzc1MGQyOGIzYWY", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-07-04T15:32:07Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-07-04T18:43:14Z"}, "message": "Misc conversions to vrange.\n\nThe following converts a handful of places that were irange centric.\n\nTested on x86-64 Linux.\n\ngcc/ChangeLog:\n\n\t* gimple-range-fold.cc\n\t(fold_using_range::range_of_ssa_name_with_loop_info): Restrict the\n\tcall to SCEV for irange supported types.\n\t(fold_using_range::range_of_builtin_int_call): Convert to vrange.\n\t* gimple-range.cc (gimple_ranger::prefill_stmt_dependencies): Same.\n\t* tree-ssa-dom.cc (cprop_operand): Same.", "tree": {"sha": "fb4da914116702e19d96324158147373de69facc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fb4da914116702e19d96324158147373de69facc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ac4c8f53b0f735be17aa020796602de2299da1c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac4c8f53b0f735be17aa020796602de2299da1c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac4c8f53b0f735be17aa020796602de2299da1c5"}], "stats": {"total": 45, "additions": 27, "deletions": 18}, "files": [{"sha": "6f907df5bf55f6073cd7e1ef5d0a2003a3c639f6", "filename": "gcc/gimple-range-fold.cc", "status": "modified", "additions": 18, "deletions": 14, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/gcc%2Fgimple-range-fold.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/gcc%2Fgimple-range-fold.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-range-fold.cc?ref=ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "patch": "@@ -1006,19 +1006,21 @@ fold_using_range::range_of_builtin_int_call (irange &r, gcall *call,\n   switch (func)\n     {\n     case CFN_BUILT_IN_CONSTANT_P:\n-      arg = gimple_call_arg (call, 0);\n-      if (src.get_operand (r, arg) && r.singleton_p ())\n-\t{\n-\t  r.set (build_one_cst (type), build_one_cst (type));\n-\t  return true;\n-\t}\n-      if (cfun->after_inlining)\n-\t{\n-\t  r.set_zero (type);\n-\t  // r.equiv_clear ();\n-\t  return true;\n-\t}\n-      break;\n+      {\n+\targ = gimple_call_arg (call, 0);\n+\tValue_Range tmp (TREE_TYPE (arg));\n+\tif (src.get_operand (tmp, arg) && tmp.singleton_p ())\n+\t  {\n+\t    r.set (build_one_cst (type), build_one_cst (type));\n+\t    return true;\n+\t  }\n+\tif (cfun->after_inlining)\n+\t  {\n+\t    r.set_zero (type);\n+\t    return true;\n+\t  }\n+\tbreak;\n+      }\n \n     case CFN_BUILT_IN_TOUPPER:\n       {\n@@ -1335,7 +1337,9 @@ fold_using_range::range_of_ssa_name_with_loop_info (irange &r, tree name,\n {\n   gcc_checking_assert (TREE_CODE (name) == SSA_NAME);\n   tree min, max, type = TREE_TYPE (name);\n-  if (bounds_of_var_in_loop (&min, &max, src.query (), l, phi, name))\n+  // FIXME: Remove the supports_p() once all this can handle floats, etc.\n+  if (irange::supports_p (type)\n+      && bounds_of_var_in_loop (&min, &max, src.query (), l, phi, name))\n     {\n       if (TREE_CODE (min) != INTEGER_CST)\n \t{"}, {"sha": "3a9f0b07e79e9eb57554696c9a54b2143b0bef97", "filename": "gcc/gimple-range.cc", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/gcc%2Fgimple-range.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/gcc%2Fgimple-range.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-range.cc?ref=ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "patch": "@@ -422,12 +422,17 @@ gimple_ranger::prefill_stmt_dependencies (tree ssa)\n \t{\n \t  gcc_checking_assert (range_op_handler (stmt));\n \t  tree op = gimple_range_operand2 (stmt);\n-\t  Value_Range r (TREE_TYPE (name));\n \t  if (op)\n-\t    prefill_name (r, op);\n+\t    {\n+\t      Value_Range r (TREE_TYPE (op));\n+\t      prefill_name (r, op);\n+\t    }\n \t  op = gimple_range_operand1 (stmt);\n \t  if (op)\n-\t    prefill_name (r, op);\n+\t    {\n+\t      Value_Range r (TREE_TYPE (op));\n+\t      prefill_name (r, op);\n+\t    }\n \t}\n     }\n   if (idx)"}, {"sha": "2bc2c3db7d72fa7f7f6e39a8231552df8280351e", "filename": "gcc/tree-ssa-dom.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/gcc%2Ftree-ssa-dom.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af/gcc%2Ftree-ssa-dom.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-dom.cc?ref=ce8dbe7d834b9264d7a5cd74d3ce6c750d28b3af", "patch": "@@ -1837,7 +1837,7 @@ cprop_operand (gimple *stmt, use_operand_p op_p, range_query *query)\n   val = SSA_NAME_VALUE (op);\n   if (!val)\n     {\n-      int_range<2> r;\n+      Value_Range r (TREE_TYPE (op));\n       tree single;\n       if (query->range_of_expr (r, op, stmt) && r.singleton_p (&single))\n \tval = single;"}]}