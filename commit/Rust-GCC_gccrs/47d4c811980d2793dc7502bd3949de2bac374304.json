{"sha": "47d4c811980d2793dc7502bd3949de2bac374304", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDdkNGM4MTE5ODBkMjc5M2RjNzUwMmJkMzk0OWRlMmJhYzM3NDMwNA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2003-08-20T18:00:09Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2003-08-20T18:00:09Z"}, "message": "re PR c++/11945 (Incorrect warnings issued for comma-expressions inside templates)\n\ncp:\n\tPR c++/11945\n\t* pt.c (build_non_dependent_expr): Look inside COND_EXPR and\n\tCOMPOUND_EXPR.\n\t* semantics.c (finish_expr_stmt): Always convert to void.\n\t* typeck.c (build_x_compound_exp): Always convert to void.\ntestsuite:\n\tPR c++/11945\n\t* g++.dg/warn/noeffect2.C: New test.\n\nFrom-SVN: r70606", "tree": {"sha": "5a3085908e5444b2d648003ad19dda683f9fac3c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5a3085908e5444b2d648003ad19dda683f9fac3c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47d4c811980d2793dc7502bd3949de2bac374304", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d4c811980d2793dc7502bd3949de2bac374304", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d4c811980d2793dc7502bd3949de2bac374304", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d4c811980d2793dc7502bd3949de2bac374304/comments", "author": null, "committer": null, "parents": [{"sha": "f2f3f409f6b69750caf647923bfc8c622f4dd991", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2f3f409f6b69750caf647923bfc8c622f4dd991", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2f3f409f6b69750caf647923bfc8c622f4dd991"}], "stats": {"total": 56, "additions": 51, "deletions": 5}, "files": [{"sha": "7dcf9c2dc29e3eda7ddef93a98423056f6451c7b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=47d4c811980d2793dc7502bd3949de2bac374304", "patch": "@@ -1,3 +1,11 @@\n+2003-08-20  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/11945\n+\t* pt.c (build_non_dependent_expr): Look inside COND_EXPR and\n+\tCOMPOUND_EXPR.\n+\t* semantics.c (finish_expr_stmt): Always convert to void.\n+\t* typeck.c (build_x_compound_exp): Always convert to void.\n+\n 2003-08-19  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/11684"}, {"sha": "20642c385425dee35bbfccded836611f5365f5d7", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=47d4c811980d2793dc7502bd3949de2bac374304", "patch": "@@ -11797,6 +11797,19 @@ build_non_dependent_expr (tree expr)\n      types.  */\n   if (TREE_CODE (expr) == OVERLOAD)\n     return expr;\n+\n+  if (TREE_CODE (expr) == COND_EXPR)\n+    return build (COND_EXPR,\n+\t\t  TREE_TYPE (expr),\n+\t\t  TREE_OPERAND (expr, 0),\n+\t\t  build_non_dependent_expr (TREE_OPERAND (expr, 1)),\n+\t\t  build_non_dependent_expr (TREE_OPERAND (expr, 2)));\n+  if (TREE_CODE (expr) == COMPOUND_EXPR)\n+    return build (COMPOUND_EXPR,\n+\t\t  TREE_TYPE (expr),\n+\t\t  TREE_OPERAND (expr, 0),\n+\t\t  build_non_dependent_expr (TREE_OPERAND (expr, 1)));\n+      \n   /* Otherwise, build a NON_DEPENDENT_EXPR.  \n \n      REFERENCE_TYPEs are not stripped for expressions in templates"}, {"sha": "78a7f06413ad9977fcffc7e5b979d20e5d128de5", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=47d4c811980d2793dc7502bd3949de2bac374304", "patch": "@@ -421,6 +421,8 @@ finish_expr_stmt (tree expr)\n     {\n       if (!processing_template_decl)\n \texpr = convert_to_void (expr, \"statement\");\n+      else if (!type_dependent_expression_p (expr))\n+\tconvert_to_void (build_non_dependent_expr (expr), \"statement\");\n       \n       r = add_stmt (build_stmt (EXPR_STMT, expr));\n     }"}, {"sha": "ed9b6b9450f7d38e03bbf512b4d9a1151d0ab50d", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=47d4c811980d2793dc7502bd3949de2bac374304", "patch": "@@ -4309,11 +4309,8 @@ build_x_compound_expr (tree op1, tree op2)\n tree\n build_compound_expr (tree lhs, tree rhs)\n {\n-  if (!processing_template_decl)\n-    {\n-      lhs = decl_constant_value (lhs);\n-      lhs = convert_to_void (lhs, \"left-hand operand of comma\");\n-    }\n+  lhs = decl_constant_value (lhs);\n+  lhs = convert_to_void (lhs, \"left-hand operand of comma\");\n   \n   if (lhs == error_mark_node || rhs == error_mark_node)\n     return error_mark_node;"}, {"sha": "bbbf552c530547ffd70db7704d1e1784bfe52094", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=47d4c811980d2793dc7502bd3949de2bac374304", "patch": "@@ -1,3 +1,8 @@\n+2003-08-20  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/11945\n+\t* g++.dg/warn/noeffect2.C: New test.\n+\n 2003-08-19  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/10926\n@@ -54,6 +59,9 @@\n \n 2003-08-18  Nathan Sidwell  <nathan@codesourcery.com>\n \n+\tPR c++/11957\n+\t* g++.dg/warn/noeffect1.C: New test.\n+\n \t* g++.dg/template/scope2.C: New test.\n \t* g++.dg/template/error2.C: Correct dg-error\n "}, {"sha": "7bd2925f542f0b78493cbe264f2c465c035762ee", "filename": "gcc/testsuite/g++.dg/warn/noeffect2.C", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fnoeffect2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47d4c811980d2793dc7502bd3949de2bac374304/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fnoeffect2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fnoeffect2.C?ref=47d4c811980d2793dc7502bd3949de2bac374304", "patch": "@@ -0,0 +1,18 @@\n+// { dg-do compile }\n+// { dg-options \"-Wall\" }\n+\n+// Copyright (C) 2003 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 18 Aug 2003 <nathan@codesourcery.com>\n+// Origin PR 11945 gerald@pfeifer.com\n+\n+// PR 11945 inconsistent warnings\n+\n+extern \"C\" void FormatDisk();\n+  template <class T>\n+  struct C {\n+    C(){ FormatDisk(), 0; }  // { dg-warning \"right-hand operand of comma\" \"\" }\n+  };\n+  template <class T>\n+  void f() { FormatDisk(), 0; } // { dg-warning \"right-hand operand of comma\" \"\" }\n+void g() { FormatDisk(), 0; } // { dg-warning \"right-hand operand of comma\" \"\" }\n+"}]}