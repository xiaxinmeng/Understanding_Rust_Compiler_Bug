{"sha": "950ad3c380028795a85da9e841dc9cc52a06118a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTUwYWQzYzM4MDAyODc5NWE4NWRhOWU4NDFkYzljYzUyYTA2MTE4YQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "1998-10-27T22:25:05Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "1998-10-27T22:25:05Z"}, "message": "decl.c (grokdeclarator): Use type_quals, rather than constp, consistently.\n\n\t* decl.c (grokdeclarator): Use type_quals, rather than constp,\n\tconsistently.\n\nFrom-SVN: r23372", "tree": {"sha": "1a94ee29d383df80c9e3fe40847b9e047d3ba848", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a94ee29d383df80c9e3fe40847b9e047d3ba848"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/950ad3c380028795a85da9e841dc9cc52a06118a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/950ad3c380028795a85da9e841dc9cc52a06118a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/950ad3c380028795a85da9e841dc9cc52a06118a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/950ad3c380028795a85da9e841dc9cc52a06118a/comments", "author": null, "committer": null, "parents": [{"sha": "2a5307b1a9ac135b951d60cf98a37fc78fbfbb14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a5307b1a9ac135b951d60cf98a37fc78fbfbb14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a5307b1a9ac135b951d60cf98a37fc78fbfbb14"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "4252c20a69f6f3c62518a49d76f7e339bcbe73c5", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950ad3c380028795a85da9e841dc9cc52a06118a/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950ad3c380028795a85da9e841dc9cc52a06118a/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=950ad3c380028795a85da9e841dc9cc52a06118a", "patch": "@@ -9396,7 +9396,7 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n \t{\n \t  /* It's common practice (and completely valid) to have a const\n \t     be initialized and declared extern.  */\n-\t  if (! constp)\n+\t  if (!(type_quals & TYPE_QUAL_CONST))\n \t    warning (\"`%s' initialized and declared `extern'\", name);\n \t}\n       else\n@@ -10651,8 +10651,7 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n \t\t       the rest of the compiler does not correctly\n \t\t       handle the initialization unless the member is\n \t\t       static so we make it static below.  */\n-\t\t    cp_pedwarn (\"ANSI C++ forbids initialization of %s `%D'\",\n-\t\t\t\tconstp ? \"const member\" : \"member\", \n+\t\t    cp_pedwarn (\"ANSI C++ forbids initialization of member `%D'\",\n \t\t\t\tdeclarator);\n \t\t    cp_pedwarn (\"making `%D' static\", declarator);\n \t\t    staticp = 1;\n@@ -10677,7 +10676,7 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n \t\t       ignore this declaration.  */\n \t\t    return void_type_node;\n \t\t  }\n-\t\telse if (!constp)\n+\t\telse if (!(type_quals & TYPE_QUAL_CONST))\n \t\t  cp_error (\"ANSI C++ forbids in-class initialization of non-const static member `%D'\",\n \t\t\t    declarator);\n \t\telse if (pedantic && ! INTEGRAL_TYPE_P (type) \n@@ -10808,7 +10807,9 @@ grokdeclarator (declarator, declspecs, decl_context, initialized, attrlist)\n \n \t/* An uninitialized decl with `extern' is a reference.  */\n \tdecl = grokvardecl (type, declarator, &specbits, \n-\t\t\t    initialized, constp, in_namespace);\n+\t\t\t    initialized, \n+\t\t\t    (type_quals & TYPE_QUAL_CONST) != 0, \n+\t\t\t    in_namespace);\n \tbad_specifiers (decl, \"variable\", virtualp, quals != NULL_TREE,\n \t\t\tinlinep, friendp, raises != NULL_TREE);\n "}, {"sha": "90b70d1661933bcd1c814ff3c60b1e5b9992e6fd", "filename": "gcc/testsuite/g++.old-deja/g++.other/const2.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/950ad3c380028795a85da9e841dc9cc52a06118a/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fconst2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/950ad3c380028795a85da9e841dc9cc52a06118a/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fconst2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fconst2.C?ref=950ad3c380028795a85da9e841dc9cc52a06118a", "patch": "@@ -0,0 +1,5 @@\n+// Build don't link:\n+\n+struct S {\n+  static const char* cp = \"abc\"; // ERROR - initialization of non-const\n+};"}]}