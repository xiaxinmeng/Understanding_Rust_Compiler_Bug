{"sha": "cde6f8d9b531a129e2058c23729b74c976d08c4a", "node_id": "C_kwDOANBUbNoAKGNkZTZmOGQ5YjUzMWExMjllMjA1OGMyMzcyOWI3NGM5NzZkMDhjNGE", "commit": {"author": {"name": "Sebastian Kirmayer", "email": "gnu@kirmayer.eu", "date": "2023-04-05T04:09:11Z"}, "committer": {"name": "CohenArthur", "email": "arthur.cohen@embecosm.com", "date": "2023-04-14T12:53:54Z"}, "message": "parser: macro: reject separator in `?` repetition\n\nA matcher like $(a),? is no longer accepted.\n\nFixes #2092.\n\ngcc/rust/ChangeLog:\n\n\t* parse/rust-parse-impl.h\n\t(Parser<ManagedTokenSource>::parse_macro_match_repetition):\n\treject separator in `?` repetition\n\ngcc/testsuite/ChangeLog:\n\n\t* rust/compile/macro-issue2092.rs: New test.\n\nSigned-off-by: Sebastian Kirmayer <gnu@kirmayer.eu>", "tree": {"sha": "6f84615f6d07dadbf4dd8a0fdb7ac1098ae93def", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6f84615f6d07dadbf4dd8a0fdb7ac1098ae93def"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cde6f8d9b531a129e2058c23729b74c976d08c4a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cde6f8d9b531a129e2058c23729b74c976d08c4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cde6f8d9b531a129e2058c23729b74c976d08c4a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cde6f8d9b531a129e2058c23729b74c976d08c4a/comments", "author": {"login": "kirmayer-gnu", "id": 129921229, "node_id": "U_kgDOB75wzQ", "avatar_url": "https://avatars.githubusercontent.com/u/129921229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirmayer-gnu", "html_url": "https://github.com/kirmayer-gnu", "followers_url": "https://api.github.com/users/kirmayer-gnu/followers", "following_url": "https://api.github.com/users/kirmayer-gnu/following{/other_user}", "gists_url": "https://api.github.com/users/kirmayer-gnu/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirmayer-gnu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirmayer-gnu/subscriptions", "organizations_url": "https://api.github.com/users/kirmayer-gnu/orgs", "repos_url": "https://api.github.com/users/kirmayer-gnu/repos", "events_url": "https://api.github.com/users/kirmayer-gnu/events{/privacy}", "received_events_url": "https://api.github.com/users/kirmayer-gnu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2608859a394d28ddf6dc0f31954e252c7a562318", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2608859a394d28ddf6dc0f31954e252c7a562318", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2608859a394d28ddf6dc0f31954e252c7a562318"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "85e044d8f3c4e911c92939bceff0c7d0c5321c78", "filename": "gcc/rust/parse/rust-parse-impl.h", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde6f8d9b531a129e2058c23729b74c976d08c4a/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde6f8d9b531a129e2058c23729b74c976d08c4a/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fparse%2Frust-parse-impl.h?ref=cde6f8d9b531a129e2058c23729b74c976d08c4a", "patch": "@@ -2261,6 +2261,16 @@ Parser<ManagedTokenSource>::parse_macro_match_repetition ()\n     case QUESTION_MARK:\n       op = AST::MacroMatchRepetition::ZERO_OR_ONE;\n       lexer.skip_token ();\n+\n+      if (separator != nullptr)\n+\t{\n+\t  add_error (\n+\t    Error (separator->get_locus (),\n+\t\t   \"the %<?%> macro repetition operator does not take a \"\n+\t\t   \"separator\"));\n+\t  separator = nullptr;\n+\t}\n+\n       break;\n     default:\n       add_error ("}, {"sha": "ec207430168d948c189942f005829020f004498b", "filename": "gcc/testsuite/rust/compile/macro-issue2092.rs", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde6f8d9b531a129e2058c23729b74c976d08c4a/gcc%2Ftestsuite%2Frust%2Fcompile%2Fmacro-issue2092.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde6f8d9b531a129e2058c23729b74c976d08c4a/gcc%2Ftestsuite%2Frust%2Fcompile%2Fmacro-issue2092.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fmacro-issue2092.rs?ref=cde6f8d9b531a129e2058c23729b74c976d08c4a", "patch": "@@ -0,0 +1,4 @@\n+macro_rules! foo {\n+    // { dg-error \"does not take a separator\" \"#2092\" { target *-*-*} .+1 }\n+    ($(a),?) => {};\n+}"}]}