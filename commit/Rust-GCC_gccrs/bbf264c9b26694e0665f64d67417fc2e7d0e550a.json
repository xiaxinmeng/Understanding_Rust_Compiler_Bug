{"sha": "bbf264c9b26694e0665f64d67417fc2e7d0e550a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmJmMjY0YzliMjY2OTRlMDY2NWY2NGQ2NzQxN2ZjMmU3ZDBlNTUwYQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2014-05-07T14:43:22Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2014-05-07T14:43:22Z"}, "message": "re PR libstdc++/61086 (ubsan detects undefined behaviour in the standard library)\n\n\tPR libstdc++/61086\n\t* include/bits/stl_iterator.h (__normal_iterator::_M_const_cast):\n\tRemove.\n\t* include/bits/stl_vector.h (vector::insert, vector::erase): Use\n\tarithmetic to obtain a mutable iterator from const_iterator.\n\t* include/bits/vector.tcc (vector::insert): Likewise.\n\t* include/debug/vector (vector::erase): Likewise.\n\t* testsuite/23_containers/vector/requirements/dr438/assign_neg.cc:\n\tAdjust dg-error line number.\n\t* testsuite/23_containers/vector/requirements/dr438/\n\tconstructor_1_neg.cc: Likewise.\n\t* testsuite/23_containers/vector/requirements/dr438/\n\tconstructor_2_neg.cc: Likewise.\n\t* testsuite/23_containers/vector/requirements/dr438/insert_neg.cc:\n\tLikewise.\n\nFrom-SVN: r210162", "tree": {"sha": "e4583c5961ca8fdbf421cd6f31d97e91e4b417af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4583c5961ca8fdbf421cd6f31d97e91e4b417af"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bbf264c9b26694e0665f64d67417fc2e7d0e550a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bbf264c9b26694e0665f64d67417fc2e7d0e550a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bbf264c9b26694e0665f64d67417fc2e7d0e550a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bbf264c9b26694e0665f64d67417fc2e7d0e550a/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ef2662bf65271c7723e797a11891d8085cd01fa5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef2662bf65271c7723e797a11891d8085cd01fa5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef2662bf65271c7723e797a11891d8085cd01fa5"}], "stats": {"total": 64, "additions": 37, "deletions": 27}, "files": [{"sha": "cf5d836f325277643941fc7d2b16f951f79817fc", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -5,6 +5,22 @@\n \tcomparison function.\n \t* testsuite/23_containers/set/cons/61023.cc: New.\n \n+\tPR libstdc++/61086\n+\t* include/bits/stl_iterator.h (__normal_iterator::_M_const_cast):\n+\tRemove.\n+\t* include/bits/stl_vector.h (vector::insert, vector::erase): Use\n+\tarithmetic to obtain a mutable iterator from const_iterator.\n+\t* include/bits/vector.tcc (vector::insert): Likewise.\n+\t* include/debug/vector (vector::erase): Likewise.\n+\t* testsuite/23_containers/vector/requirements/dr438/assign_neg.cc:\n+\tAdjust dg-error line number.\n+\t* testsuite/23_containers/vector/requirements/dr438/\n+\tconstructor_1_neg.cc: Likewise.\n+\t* testsuite/23_containers/vector/requirements/dr438/\n+\tconstructor_2_neg.cc: Likewise.\n+\t* testsuite/23_containers/vector/requirements/dr438/insert_neg.cc:\n+\tLikewise.\n+\n 2014-05-06  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* include/Makefile.in: Regenerate."}, {"sha": "f4522a42e72d029cc7b22bfc87c9bc124c09c43d", "filename": "libstdc++-v3/include/bits/stl_iterator.h", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_iterator.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_iterator.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_iterator.h?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -736,21 +736,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t      _Container>::__type>& __i) _GLIBCXX_NOEXCEPT\n         : _M_current(__i.base()) { }\n \n-#if __cplusplus >= 201103L\n-      __normal_iterator<typename _Container::pointer, _Container>\n-      _M_const_cast() const noexcept\n-      {\n-\tusing _PTraits = std::pointer_traits<typename _Container::pointer>;\n-\treturn __normal_iterator<typename _Container::pointer, _Container>\n-\t  (_PTraits::pointer_to(const_cast<typename _PTraits::element_type&>\n-\t\t\t\t(*_M_current)));\n-      }\n-#else\n-      __normal_iterator\n-      _M_const_cast() const\n-      { return *this; }\n-#endif\n-\n       // Forward iterator requirements\n       reference\n       operator*() const _GLIBCXX_NOEXCEPT"}, {"sha": "0a56c65ed752c202f942cb31a1f3e361b2ddd070", "filename": "libstdc++-v3/include/bits/stl_vector.h", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_vector.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_vector.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_vector.h?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -1051,7 +1051,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n       insert(const_iterator __position, size_type __n, const value_type& __x)\n       {\n \tdifference_type __offset = __position - cbegin();\n-\t_M_fill_insert(__position._M_const_cast(), __n, __x);\n+\t_M_fill_insert(begin() + __offset, __n, __x);\n \treturn begin() + __offset;\n       }\n #else\n@@ -1096,7 +1096,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \t       _InputIterator __last)\n         {\n \t  difference_type __offset = __position - cbegin();\n-\t  _M_insert_dispatch(__position._M_const_cast(),\n+\t  _M_insert_dispatch(begin() + __offset,\n \t\t\t     __first, __last, __false_type());\n \t  return begin() + __offset;\n \t}\n@@ -1144,10 +1144,11 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n       iterator\n #if __cplusplus >= 201103L\n       erase(const_iterator __position)\n+      { return _M_erase(begin() + (__position - cbegin())); }\n #else\n       erase(iterator __position)\n+      { return _M_erase(__position); }\n #endif\n-      { return _M_erase(__position._M_const_cast()); }\n \n       /**\n        *  @brief  Remove a range of elements.\n@@ -1170,10 +1171,15 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n       iterator\n #if __cplusplus >= 201103L\n       erase(const_iterator __first, const_iterator __last)\n+      {\n+\tconst auto __beg = begin();\n+\tconst auto __cbeg = cbegin();\n+\treturn _M_erase(__beg + (__first - __cbeg), __beg + (__last - __cbeg));\n+      }\n #else\n       erase(iterator __first, iterator __last)\n+      { return _M_erase(__first, __last); }\n #endif\n-      { return _M_erase(__first._M_const_cast(), __last._M_const_cast()); }\n \n       /**\n        *  @brief  Swaps data with another %vector."}, {"sha": "5c3dfae9381c3f9c1ba1f475095ec31c2d2dfe5e", "filename": "libstdc++-v3/include/bits/vector.tcc", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvector.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvector.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvector.tcc?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -121,14 +121,17 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n       else\n \t{\n #if __cplusplus >= 201103L\n+\t  const auto __pos = begin() + (__position - cbegin());\n \t  if (this->_M_impl._M_finish != this->_M_impl._M_end_of_storage)\n \t    {\n \t      _Tp __x_copy = __x;\n-\t      _M_insert_aux(__position._M_const_cast(), std::move(__x_copy));\n+\t      _M_insert_aux(__pos, std::move(__x_copy));\n \t    }\n \t  else\n+\t    _M_insert_aux(__pos, __x);\n+#else\n+\t    _M_insert_aux(__position, __x);\n #endif\n-\t    _M_insert_aux(__position._M_const_cast(), __x);\n \t}\n       return iterator(this->_M_impl._M_start + __n);\n     }\n@@ -307,7 +310,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \t    ++this->_M_impl._M_finish;\n \t  }\n \telse\n-\t  _M_insert_aux(__position._M_const_cast(),\n+\t  _M_insert_aux(begin() + (__position - cbegin()),\n \t\t\tstd::forward<_Args>(__args)...);\n \treturn iterator(this->_M_impl._M_start + __n);\n       }"}, {"sha": "f92a77fed112307639cf0b98ea7773dc0d34e886", "filename": "libstdc++-v3/include/debug/vector", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Fvector", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Fvector", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fdebug%2Fvector?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -647,7 +647,7 @@ namespace __debug\n \t  }\n \telse\n #if __cplusplus >= 201103L\n-\t  return iterator(__first.base()._M_const_cast(), this);\n+\t  return begin() + (__first.base() - cbegin().base());\n #else\n \t  return __first;\n #endif"}, {"sha": "655c7e8ad467be4dd2972fd3079a577bb69bded2", "filename": "libstdc++-v3/testsuite/23_containers/vector/requirements/dr438/assign_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fassign_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fassign_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fassign_neg.cc?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -18,7 +18,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do compile }\n-// { dg-error \"no matching\" \"\" { target *-*-* } 1320 }\n+// { dg-error \"no matching\" \"\" { target *-*-* } 1326 }\n \n #include <vector>\n "}, {"sha": "d938aa21bf2a1b008f640eccb15480e216429a11", "filename": "libstdc++-v3/testsuite/23_containers/vector/requirements/dr438/constructor_1_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fconstructor_1_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fconstructor_1_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fconstructor_1_neg.cc?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -18,7 +18,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do compile }\n-// { dg-error \"no matching\" \"\" { target *-*-* } 1246 }\n+// { dg-error \"no matching\" \"\" { target *-*-* } 1252 }\n \n #include <vector>\n "}, {"sha": "f88828562e97acf3c31a8cce317b3248155ae30b", "filename": "libstdc++-v3/testsuite/23_containers/vector/requirements/dr438/constructor_2_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fconstructor_2_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fconstructor_2_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Fconstructor_2_neg.cc?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -18,7 +18,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do compile }\n-// { dg-error \"no matching\" \"\" { target *-*-* } 1246 }\n+// { dg-error \"no matching\" \"\" { target *-*-* } 1252 }\n \n #include <vector>\n #include <utility>"}, {"sha": "316249b01881e83afa6466603cd54ee27bb5d9c7", "filename": "libstdc++-v3/testsuite/23_containers/vector/requirements/dr438/insert_neg.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Finsert_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bbf264c9b26694e0665f64d67417fc2e7d0e550a/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Finsert_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fvector%2Frequirements%2Fdr438%2Finsert_neg.cc?ref=bbf264c9b26694e0665f64d67417fc2e7d0e550a", "patch": "@@ -18,7 +18,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do compile }\n-// { dg-error \"no matching\" \"\" { target *-*-* } 1361 }\n+// { dg-error \"no matching\" \"\" { target *-*-* } 1367 }\n \n #include <vector>\n "}]}