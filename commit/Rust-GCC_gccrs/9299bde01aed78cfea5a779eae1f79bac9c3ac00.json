{"sha": "9299bde01aed78cfea5a779eae1f79bac9c3ac00", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTI5OWJkZTAxYWVkNzhjZmVhNWE3NzllYWUxZjc5YmFjOWMzYWMwMA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-03-13T09:51:52Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-03-13T09:51:52Z"}, "message": "re PR c++/60254 ([c++11] ICE with non-const expression in static_assert)\n\n/cp\n2014-03-13  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/60254\n\t* semantics.c (finish_static_assert): Call cxx_constant_value only\n\tif require_potential_rvalue_constant_expression returns true.\n\n/testsuite\n2014-03-13  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/60254\n\t* g++.dg/cpp0x/static_assert10.C: New.\n\t* g++.dg/cpp0x/static_assert11.C: Likewise.\n\t* g++.dg/cpp0x/static_assert3.C: Adjust.\n\nFrom-SVN: r208538", "tree": {"sha": "41f000d0a75618cc89cd877f4ffbf92d592a5c2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/41f000d0a75618cc89cd877f4ffbf92d592a5c2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9299bde01aed78cfea5a779eae1f79bac9c3ac00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9299bde01aed78cfea5a779eae1f79bac9c3ac00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9299bde01aed78cfea5a779eae1f79bac9c3ac00", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9299bde01aed78cfea5a779eae1f79bac9c3ac00/comments", "author": null, "committer": null, "parents": [{"sha": "eba14fca8919a408f95fadf383f8c87fb79e797c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba14fca8919a408f95fadf383f8c87fb79e797c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eba14fca8919a408f95fadf383f8c87fb79e797c"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "e5732f2d490ea0af007c34af920a5a5c3f4a9434", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=9299bde01aed78cfea5a779eae1f79bac9c3ac00", "patch": "@@ -1,3 +1,9 @@\n+2014-03-13  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/60254\n+\t* semantics.c (finish_static_assert): Call cxx_constant_value only\n+\tif require_potential_rvalue_constant_expression returns true.\n+\n 2014-03-11  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/60389"}, {"sha": "886fbb88bc94b05ff9bf5e09a4a293724b844010", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=9299bde01aed78cfea5a779eae1f79bac9c3ac00", "patch": "@@ -6860,7 +6860,8 @@ finish_static_assert (tree condition, tree message, location_t location,\n       else if (condition && condition != error_mark_node)\n \t{\n \t  error (\"non-constant condition for static assertion\");\n-\t  cxx_constant_value (condition);\n+\t  if (require_potential_rvalue_constant_expression (condition))\n+\t    cxx_constant_value (condition);\n \t}\n       input_location = saved_loc;\n     }"}, {"sha": "9cdf30dad15a563141c882660df2a32f76c97fe5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9299bde01aed78cfea5a779eae1f79bac9c3ac00", "patch": "@@ -1,3 +1,10 @@\n+2014-03-13  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/60254\n+\t* g++.dg/cpp0x/static_assert10.C: New.\n+\t* g++.dg/cpp0x/static_assert11.C: Likewise.\n+\t* g++.dg/cpp0x/static_assert3.C: Adjust.\n+\n 2014-03-13  Richard Biener  <rguenther@suse.de>\n \n \t* lib/lto.exp (lto-execute): Fix error catching for dg-final."}, {"sha": "216f2595b6bd9a29c72f75dfb2c4a44326346509", "filename": "gcc/testsuite/g++.dg/cpp0x/static_assert10.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert10.C?ref=9299bde01aed78cfea5a779eae1f79bac9c3ac00", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/60254\n+// { dg-do compile { target c++11 } }\n+\n+template<typename T> bool foo(T)\n+{\n+  int i;\n+  static_assert(foo(i), \"Error\"); // { dg-error \"non-constant condition|not usable\" }\n+}"}, {"sha": "8a7362d5f56c940e89be95ed23cf7fa349073a0f", "filename": "gcc/testsuite/g++.dg/cpp0x/static_assert11.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert11.C?ref=9299bde01aed78cfea5a779eae1f79bac9c3ac00", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/60254\n+// { dg-do compile { target c++11 } }\n+\n+struct A\n+{\n+  template<typename T> bool foo(T)\n+  {\n+    static_assert(foo(0), \"Error\"); // { dg-error \"non-constant condition|constant expression\" }\n+  }\n+};"}, {"sha": "addde13c114264345c4a4b137559b8e806f101c3", "filename": "gcc/testsuite/g++.dg/cpp0x/static_assert3.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9299bde01aed78cfea5a779eae1f79bac9c3ac00/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fstatic_assert3.C?ref=9299bde01aed78cfea5a779eae1f79bac9c3ac00", "patch": "@@ -1,4 +1,4 @@\n // { dg-do compile { target c++11 } }\n static_assert(7 / 0, \"X\"); // { dg-error \"non-constant condition\" \"non-constant\" }\n // { dg-warning \"division by zero\" \"zero\" { target *-*-* } 2 }\n-// { dg-error \"7 / 0.. is not a constant expression\" \"not a constant\" { target *-*-* } 2 }\n+// { dg-error \"division by zero is not a constant-expression\" \"not a constant\" { target *-*-* } 2 }"}]}