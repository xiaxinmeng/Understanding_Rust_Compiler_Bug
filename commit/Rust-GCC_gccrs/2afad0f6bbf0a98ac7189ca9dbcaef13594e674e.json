{"sha": "2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmFmYWQwZjZiYmYwYTk4YWM3MTg5Y2E5ZGJjYWVmMTM1OTRlNjc0ZQ==", "commit": {"author": {"name": "Douglas Gregor", "email": "doug.gregor@gmail.com", "date": "2007-11-05T12:50:21Z"}, "committer": {"name": "Doug Gregor", "email": "dgregor@gcc.gnu.org", "date": "2007-11-05T12:50:21Z"}, "message": "re PR c++/33939 (Rvalue references not deduced correctly in vararg function templates)\n\n2007-11-05  Douglas Gregor  <doug.gregor@gmail.com>\n\n\tPR c++/33939\n\t* pt.c (unify_pack_expansion): bring handling of function call\n\targuments into line with type_unification_real. \n\n2007-11-05  Douglas Gregor  <doug.gregor@gmail.com>\n\n\tPR c++/33939\n\t* g++.dg/cpp0x/variadic-rref.C: New.\n\nFrom-SVN: r129900", "tree": {"sha": "f913fbca909f5445d4d4fb618053ce82b8c78adf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f913fbca909f5445d4d4fb618053ce82b8c78adf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/comments", "author": {"login": "DougGregor", "id": 989428, "node_id": "MDQ6VXNlcjk4OTQyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/989428?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DougGregor", "html_url": "https://github.com/DougGregor", "followers_url": "https://api.github.com/users/DougGregor/followers", "following_url": "https://api.github.com/users/DougGregor/following{/other_user}", "gists_url": "https://api.github.com/users/DougGregor/gists{/gist_id}", "starred_url": "https://api.github.com/users/DougGregor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DougGregor/subscriptions", "organizations_url": "https://api.github.com/users/DougGregor/orgs", "repos_url": "https://api.github.com/users/DougGregor/repos", "events_url": "https://api.github.com/users/DougGregor/events{/privacy}", "received_events_url": "https://api.github.com/users/DougGregor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f139f5faa7063323dd3b00a0f6515e0e0683edb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f139f5faa7063323dd3b00a0f6515e0e0683edb6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f139f5faa7063323dd3b00a0f6515e0e0683edb6"}], "stats": {"total": 54, "additions": 52, "deletions": 2}, "files": [{"sha": "8923b24a21f01825a9ce4f63270d638d41317c23", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "patch": "@@ -1,3 +1,9 @@\n+2007-11-05  Douglas Gregor  <doug.gregor@gmail.com>\n+\n+\tPR c++/33939\n+\t* pt.c (unify_pack_expansion): bring handling of function call\n+\targuments into line with type_unification_real. \n+\n 2007-11-05  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \t* typeck.c (build_binary_op): Use pedwarn instead of error for"}, {"sha": "9c29f81cc5d4b39701248bea1c2b460d97eed3f7", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "patch": "@@ -12280,6 +12280,7 @@ unify_pack_expansion (tree tparms, tree targs, tree packed_parms,\n       /* Unify the pattern with the current argument.  */\n       {\n         tree arg = TREE_VEC_ELT (packed_args, i);\n+\ttree arg_expr = NULL_TREE;\n         int arg_strict = strict;\n         bool skip_arg_p = false;\n \n@@ -12330,7 +12331,8 @@ unify_pack_expansion (tree tparms, tree targs, tree packed_parms,\n \n                 if (!skip_arg_p)\n                   {\n-                    arg = TREE_TYPE (arg);\n+\t\t    arg_expr = arg;\n+                    arg = unlowered_expr_type (arg);\n                     if (arg == error_mark_node)\n                       return 1;\n                   }\n@@ -12340,7 +12342,8 @@ unify_pack_expansion (tree tparms, tree targs, tree packed_parms,\n \n             if (!subr)\n               arg_strict |= \n-                maybe_adjust_types_for_deduction (strict, &parm, &arg, NULL);\n+                maybe_adjust_types_for_deduction (strict, &parm, &arg, \n+\t\t\t\t\t\t  arg_expr);\n           }\n \n         if (!skip_arg_p)"}, {"sha": "12dd3509259a39eddafae5bf7a3410ab8002a85d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "patch": "@@ -1,3 +1,8 @@\n+2007-11-05  Douglas Gregor  <doug.gregor@gmail.com>\n+\n+\tPR c++/33939\n+\t* g++.dg/cpp0x/variadic-rref.C: New.\n+\t\n 2007-11-05  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \t* g++dg/warn/pointer-integer-comparison.C: New."}, {"sha": "08221b460fe8051212e62191531d9656cdfeaa4e", "filename": "gcc/testsuite/g++.dg/cpp0x/variadic-rref.C", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fvariadic-rref.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2afad0f6bbf0a98ac7189ca9dbcaef13594e674e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fvariadic-rref.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fvariadic-rref.C?ref=2afad0f6bbf0a98ac7189ca9dbcaef13594e674e", "patch": "@@ -0,0 +1,36 @@\n+// { dg-options \"-std=c++0x\" }\n+// PR c++/33939\n+template<typename T>\n+struct refs_only;\n+\n+template<typename T>\n+struct refs_only<T &>\n+{};\n+\n+template<typename T>\n+refs_only<T> foo( T && t)\n+{\n+    return refs_only<T>();\n+}\n+\n+template<typename... T>\n+struct va_refs_only;\n+\n+template<typename T>\n+struct va_refs_only<T>\n+  : refs_only<T>\n+{};\n+\n+template<typename... T>\n+va_refs_only<T...> bar( T &&... t)\n+{\n+    return va_refs_only<T...>();\n+}\n+\n+int main()\n+{\n+    int j = 0;\n+    foo(j);\n+    bar(j); // error: invalid use of incomplete type 'struct refs_only<int>'\n+}\n+"}]}