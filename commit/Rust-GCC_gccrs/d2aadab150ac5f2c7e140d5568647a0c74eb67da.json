{"sha": "d2aadab150ac5f2c7e140d5568647a0c74eb67da", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDJhYWRhYjE1MGFjNWYyYzdlMTQwZDU1Njg2NDdhMGM3NGViNjdkYQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2017-01-20T16:28:16Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2017-01-20T16:28:16Z"}, "message": "re PR c/79152 (-Wimplicit-fallthrough false positive triggered by goto statements)\n\n\tPR c/79152\n\t* gimplify.c (should_warn_for_implicit_fallthrough): Handle consecutive\n\tnon-case labels.\n\n\t* c-c++-common/Wimplicit-fallthrough-35.c: New test.\n\nFrom-SVN: r244726", "tree": {"sha": "2e7dbd0f9a2d2c81943c7cec1e7f5884b0fa0ade", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e7dbd0f9a2d2c81943c7cec1e7f5884b0fa0ade"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2aadab150ac5f2c7e140d5568647a0c74eb67da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2aadab150ac5f2c7e140d5568647a0c74eb67da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2aadab150ac5f2c7e140d5568647a0c74eb67da", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2aadab150ac5f2c7e140d5568647a0c74eb67da/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "776d540459c10c1cfe407a39f4460c9fe807712f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/776d540459c10c1cfe407a39f4460c9fe807712f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/776d540459c10c1cfe407a39f4460c9fe807712f"}], "stats": {"total": 81, "additions": 79, "deletions": 2}, "files": [{"sha": "67ccfa80dcc2b9ce26700978d5b0329f81fd70fe", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d2aadab150ac5f2c7e140d5568647a0c74eb67da", "patch": "@@ -1,3 +1,9 @@\n+2017-01-20  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/79152\n+\t* gimplify.c (should_warn_for_implicit_fallthrough): Handle consecutive\n+\tnon-case labels.\n+\n 2017-01-20  Alexander Monakov  <amonakov@ispras.ru>\n \n \t* omp-expand.c (expand_omp_simd): Clear PROP_gimple_lomp_dev regardless"}, {"sha": "d382eea69f85b6f2664fca3448bc33eb5e62e378", "filename": "gcc/gimplify.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=d2aadab150ac5f2c7e140d5568647a0c74eb67da", "patch": "@@ -1985,15 +1985,20 @@ should_warn_for_implicit_fallthrough (gimple_stmt_iterator *gsi_p, tree label)\n   if (FALLTHROUGH_LABEL_P (label))\n     return false;\n \n-  /* Don't warn for a non-case label followed by a statement:\n+  /* Don't warn for non-case labels followed by a statement:\n        case 0:\n \t foo ();\n        label:\n \t bar ();\n      as these are likely intentional.  */\n   if (!case_label_p (&gimplify_ctxp->case_labels, label))\n     {\n-      gsi_next (&gsi);\n+      tree l;\n+      while (!gsi_end_p (gsi)\n+\t     && gimple_code (gsi_stmt (gsi)) == GIMPLE_LABEL\n+\t     && (l = gimple_label_label (as_a <glabel *> (gsi_stmt (gsi))))\n+\t     && !case_label_p (&gimplify_ctxp->case_labels, l))\n+\tgsi_next (&gsi);\n       if (gsi_end_p (gsi) || gimple_code (gsi_stmt (gsi)) != GIMPLE_LABEL)\n \treturn false;\n     }"}, {"sha": "69ba36cc7e8f14f4fc53ede842166344f6406e30", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d2aadab150ac5f2c7e140d5568647a0c74eb67da", "patch": "@@ -1,3 +1,8 @@\n+2017-01-20  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/79152\n+\t* c-c++-common/Wimplicit-fallthrough-35.c: New test.\n+\n 2017-01-20  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \t* lib/target-supports.exp (check_configured_with): New procedure."}, {"sha": "9a0aba6bd66bf59525d9ec707044ef9878483e05", "filename": "gcc/testsuite/c-c++-common/Wimplicit-fallthrough-35.c", "status": "added", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWimplicit-fallthrough-35.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2aadab150ac5f2c7e140d5568647a0c74eb67da/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWimplicit-fallthrough-35.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWimplicit-fallthrough-35.c?ref=d2aadab150ac5f2c7e140d5568647a0c74eb67da", "patch": "@@ -0,0 +1,61 @@\n+/* PR c/79152 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wimplicit-fallthrough\" } */\n+\n+extern void foo (int);\n+\n+void\n+f (int i)\n+{\n+  switch (i)\n+    {\n+    case 0:\n+      foo (0);\n+l1:\n+      foo (1);\n+    }\n+\n+  switch (i)\n+    {\n+    case 0:\n+      foo (0);\n+l2:;\n+    }\n+\n+  switch (i)\n+    {\n+    case 0:\n+      foo (0);\n+l3:\n+l4:\n+      foo (1);\n+    }\n+\n+  switch (i)\n+    {\n+    case 0:\n+      foo (0);\n+l5:\n+l6:;\n+    }\n+\n+  switch (i)\n+    {\n+    case 0:\n+      foo (0); /* { dg-warning \"statement may fall through\" } */\n+l7:\n+l8:\n+    case 1:\n+      foo (1);\n+    }\n+\n+  switch (i)\n+    {\n+    case 0:\n+      foo (0); /* { dg-warning \"statement may fall through\" } */\n+l9:\n+    case 1:\n+l10:\n+      foo (1);\n+    }\n+}"}]}