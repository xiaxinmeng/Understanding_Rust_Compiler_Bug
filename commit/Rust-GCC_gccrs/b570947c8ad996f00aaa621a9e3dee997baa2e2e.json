{"sha": "b570947c8ad996f00aaa621a9e3dee997baa2e2e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjU3MDk0N2M4YWQ5OTZmMDBhYWE2MjFhOWUzZGVlOTk3YmFhMmUyZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-05-16T10:16:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-05-16T10:16:36Z"}, "message": "re PR middle-end/27573 (ICE with -fopenmp  -fprofile-generate)\n\n\tPR middle-end/27573\n\t* omp-low.c (expand_omp_parallel): Don't assert\n\t.OMP_DATA_I = &.OMP_DATA_O is the first statement in the block,\n\tinstead search for it.\n\n\t* gcc.dg/gomp/pr27573.c: New test.\n\t* gfortran.dg/gomp/pr27573.f90: New test.\n\nFrom-SVN: r113823", "tree": {"sha": "e28b85f2f99a2a29e7a7330a77bce84b727bb4b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e28b85f2f99a2a29e7a7330a77bce84b727bb4b0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b570947c8ad996f00aaa621a9e3dee997baa2e2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b570947c8ad996f00aaa621a9e3dee997baa2e2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b570947c8ad996f00aaa621a9e3dee997baa2e2e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b570947c8ad996f00aaa621a9e3dee997baa2e2e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4156f84bfb9e0e26701a825d52da11eec26d10ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4156f84bfb9e0e26701a825d52da11eec26d10ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4156f84bfb9e0e26701a825d52da11eec26d10ff"}], "stats": {"total": 80, "additions": 65, "deletions": 15}, "files": [{"sha": "cee2e438b5835b1e2c080172f66621b34d08e3b8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b570947c8ad996f00aaa621a9e3dee997baa2e2e", "patch": "@@ -1,5 +1,10 @@\n 2006-05-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/27573\n+\t* omp-low.c (expand_omp_parallel): Don't assert\n+\t.OMP_DATA_I = &.OMP_DATA_O is the first statement in the block,\n+\tinstead search for it.\n+\n \tPR c/27499\n \t* gimplify.c (gimplify_omp_for): Remove assertion that iteration var\n \tis signed."}, {"sha": "c1441dc44587cfb361344877515ebcb04ff7b78b", "filename": "gcc/omp-low.c", "status": "modified", "additions": 21, "deletions": 15, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=b570947c8ad996f00aaa621a9e3dee997baa2e2e", "patch": "@@ -2456,7 +2456,8 @@ expand_omp_parallel (struct omp_region *region)\n   else\n     {\n       /* If the parallel region needs data sent from the parent\n-\t function, then the very first statement of the parallel body\n+\t function, then the very first statement (except possible\n+\t tree profile counter updates) of the parallel body\n \t is a copy assignment .OMP_DATA_I = &.OMP_DATA_O.  Since\n \t &.OMP_DATA_O is passed as an argument to the child function,\n \t we need to replace it with the argument as seen by the child\n@@ -2470,21 +2471,26 @@ expand_omp_parallel (struct omp_region *region)\n       if (OMP_PARALLEL_DATA_ARG (entry_stmt))\n \t{\n \t  basic_block entry_succ_bb = single_succ (entry_bb);\n-\t  block_stmt_iterator si = bsi_start (entry_succ_bb);\n-\t  tree stmt;\n+\t  block_stmt_iterator si;\n \n-\t  gcc_assert (!bsi_end_p (si));\n-\n-\t  stmt = bsi_stmt (si);\n-\t  gcc_assert (TREE_CODE (stmt) == MODIFY_EXPR\n-\t\t      && TREE_CODE (TREE_OPERAND (stmt, 1)) == ADDR_EXPR\n-\t\t      && TREE_OPERAND (TREE_OPERAND (stmt, 1), 0)\n-\t\t\t == OMP_PARALLEL_DATA_ARG (entry_stmt));\n-\n-\t  if (TREE_OPERAND (stmt, 0) == DECL_ARGUMENTS (child_fn))\n-\t    bsi_remove (&si, true);\n-\t  else\n-\t    TREE_OPERAND (stmt, 1) = DECL_ARGUMENTS (child_fn);\n+\t  for (si = bsi_start (entry_succ_bb); ; bsi_next (&si))\n+\t    {\n+\t      tree stmt;\n+\n+\t      gcc_assert (!bsi_end_p (si));\n+\t      stmt = bsi_stmt (si);\n+\t      if (TREE_CODE (stmt) == MODIFY_EXPR\n+\t\t  && TREE_CODE (TREE_OPERAND (stmt, 1)) == ADDR_EXPR\n+\t\t  && TREE_OPERAND (TREE_OPERAND (stmt, 1), 0)\n+\t\t     == OMP_PARALLEL_DATA_ARG (entry_stmt))\n+\t\t{\n+\t\t  if (TREE_OPERAND (stmt, 0) == DECL_ARGUMENTS (child_fn))\n+\t\t    bsi_remove (&si, true);\n+\t\t  else\n+\t\t    TREE_OPERAND (stmt, 1) = DECL_ARGUMENTS (child_fn);\n+\t\t  break;\n+\t\t}\n+\t    }\n \t}\n \n       /* Declare local variables needed in CHILD_CFUN.  */"}, {"sha": "8e94d149213a86f5c4478cdcbadf68304f1acb45", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b570947c8ad996f00aaa621a9e3dee997baa2e2e", "patch": "@@ -1,5 +1,9 @@\n 2006-05-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/27573\n+\t* gcc.dg/gomp/pr27573.c: New test.\n+\t* gfortran.dg/gomp/pr27573.f90: New test.\n+\n \tPR c/27499\n \t* gcc.dg/gomp/pr27499.c: New test.\n \t* g++.dg/gomp/pr27499.C: New test."}, {"sha": "4dca4da43c662d1419bdb4d215c44e7fa15c8c48", "filename": "gcc/testsuite/gcc.dg/gomp/pr27573.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27573.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27573.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr27573.c?ref=b570947c8ad996f00aaa621a9e3dee997baa2e2e", "patch": "@@ -0,0 +1,20 @@\n+/* PR middle-end/27573 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fopenmp -fprofile-generate\" } */\n+\n+extern int puts (const char *);\n+\n+int\n+main (void)\n+{\n+  int i, j = 8;\n+#pragma omp parallel\n+  {\n+    puts (\"foo\");\n+    for (i = 1; i < j - 1; i++)\n+      ;\n+  }\n+  return 0;\n+}\n+\n+/* { dg-final { cleanup-coverage-files } } */"}, {"sha": "9d20284044be5e3a82e7cf031991fd0f41f5ac9a", "filename": "gcc/testsuite/gfortran.dg/gomp/pr27573.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr27573.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b570947c8ad996f00aaa621a9e3dee997baa2e2e/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr27573.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr27573.f90?ref=b570947c8ad996f00aaa621a9e3dee997baa2e2e", "patch": "@@ -0,0 +1,15 @@\n+! PR middle-end/27573\n+! { dg-do compile }\n+! { dg-options \"-O2 -fopenmp -fprofile-generate\" }\n+\n+program pr27573\n+  integer i,j\n+  j = 8\n+  !$omp parallel\n+    print *, \"foo\"\n+    do i = 1, j - 1\n+    end do\n+  !$omp end parallel\n+end\n+\n+! { dg-final { cleanup-coverage-files } }"}]}