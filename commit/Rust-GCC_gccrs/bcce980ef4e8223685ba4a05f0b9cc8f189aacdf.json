{"sha": "bcce980ef4e8223685ba4a05f0b9cc8f189aacdf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmNjZTk4MGVmNGU4MjIzNjg1YmE0YTA1ZjBiOWNjOGYxODlhYWNkZg==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2017-05-30T22:00:57Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2017-05-30T22:00:57Z"}, "message": "Test if host compiler supports -std=c++11 in ms-sysv.exp\n\n2017-05-30  Tom de Vries  <tom@codesourcery.com>\n\n\tPR testsuite/80910\n\t* gcc.target/x86_64/abi/ms-sysv/ms-sysv.exp: Exit with status\n\tunsupported if host compiler does not support c++11.\n\t(host_supports_c++11): New proc.\n\nFrom-SVN: r248701", "tree": {"sha": "69296084ab417145e0ef457d806aa9ba7c9cf16b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/69296084ab417145e0ef457d806aa9ba7c9cf16b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf/comments", "author": null, "committer": null, "parents": [{"sha": "ef9200aa356119b87c4e1b8d995e7d767dace57a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ef9200aa356119b87c4e1b8d995e7d767dace57a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ef9200aa356119b87c4e1b8d995e7d767dace57a"}], "stats": {"total": 43, "additions": 40, "deletions": 3}, "files": [{"sha": "1e8c11b0480f275f0080234b3c3e5537c684506a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bcce980ef4e8223685ba4a05f0b9cc8f189aacdf", "patch": "@@ -1,3 +1,10 @@\n+2017-05-30  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR testsuite/80910\n+\t* gcc.target/x86_64/abi/ms-sysv/ms-sysv.exp: Exit with status\n+\tunsupported if host compiler does not support c++11.\n+\t(host_supports_c++11): New proc.\n+\n 2017-05-30  Martin Sebor  <msebor@redhat.com>\n \n \tPR c/80731"}, {"sha": "26777e0b59f3ca4bf9d0ab2844e59b02c38f32d0", "filename": "gcc/testsuite/gcc.target/x86_64/abi/ms-sysv/ms-sysv.exp", "status": "modified", "additions": 33, "deletions": 3, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf/gcc%2Ftestsuite%2Fgcc.target%2Fx86_64%2Fabi%2Fms-sysv%2Fms-sysv.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcce980ef4e8223685ba4a05f0b9cc8f189aacdf/gcc%2Ftestsuite%2Fgcc.target%2Fx86_64%2Fabi%2Fms-sysv%2Fms-sysv.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fx86_64%2Fabi%2Fms-sysv%2Fms-sysv.exp?ref=bcce980ef4e8223685ba4a05f0b9cc8f189aacdf", "patch": "@@ -23,17 +23,47 @@\n # see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n # <http://www.gnu.org/licenses/>.\n \n+load_lib gcc-dg.exp\n+\n+proc host_supports_c++11 {} {\n+    global HOSTCXX HOSTCXXFLAGS\n+\n+    set pidstr [pid]\n+    set src \"host_supports_c++11_$pidstr.C\"\n+    set asm \"host_supports_c++11_$pidstr.s\"\n+\n+    set f [open $src \"w\"]\n+    puts $f \"\"\n+    close $f\n+\n+    set cxx \"$HOSTCXX $HOSTCXXFLAGS\"\n+\n+    # Temporarily switch to the environment for the host compiler.\n+    restore_ld_library_path_env_vars\n+    set status [remote_exec host \"$cxx -S $src -std=c++11 -o $asm\"]\n+    # And switch back.\n+    set_ld_library_path_env_vars\n+\n+    file delete $src $asm\n+\n+    set status [lindex $status 0]\n+    if { $status != 0 } {\n+\treturn 0\n+    }\n+\n+    return 1\n+}\n+\n # Exit immediately if this isn't a native x86_64 target.\n if { (![istarget x86_64-*-*] && ![istarget i?86-*-*])\n-     || ![is-effective-target lp64] || ![isnative] } then {\n+     || ![is-effective-target lp64] || ![isnative]\n+     || ![host_supports_c++11] } then {\n     unsupported \"$subdir\"\n     return\n }\n \n global GCC_RUNTEST_PARALLELIZE_DIR\n \n-load_lib gcc-dg.exp\n-\n proc runtest_ms_sysv { cflags generator_args } {\n     global GCC_UNDER_TEST HOSTCXX HOSTCXXFLAGS tmpdir srcdir subdir \\\n \t   parallel_dir next_test"}]}