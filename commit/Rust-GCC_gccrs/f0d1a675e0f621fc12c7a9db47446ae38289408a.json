{"sha": "f0d1a675e0f621fc12c7a9db47446ae38289408a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjBkMWE2NzVlMGY2MjFmYzEyYzdhOWRiNDc0NDZhZTM4Mjg5NDA4YQ==", "commit": {"author": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2021-06-06T04:44:13Z"}, "committer": {"name": "Jeff Law", "email": "jeffreyalaw@gmail.com", "date": "2021-06-07T14:43:17Z"}, "message": "Use moves to eliminate redundant test/compare instructions\n\ngcc/\n\n\t* config/h8300/movepush.md: Change most _clobber_flags\n\tpatterns to instead use <cczn> subst.\n\t(movsi_cczn): New pattern with usable CC cases split out.\n\t(movsi_h8sx_cczn): Likewise.", "tree": {"sha": "54785466e3677377e560bd35b8eea7e873cbad97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54785466e3677377e560bd35b8eea7e873cbad97"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f0d1a675e0f621fc12c7a9db47446ae38289408a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0d1a675e0f621fc12c7a9db47446ae38289408a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0d1a675e0f621fc12c7a9db47446ae38289408a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0d1a675e0f621fc12c7a9db47446ae38289408a/comments", "author": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "JeffreyALaw", "id": 14062506, "node_id": "MDQ6VXNlcjE0MDYyNTA2", "avatar_url": "https://avatars.githubusercontent.com/u/14062506?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JeffreyALaw", "html_url": "https://github.com/JeffreyALaw", "followers_url": "https://api.github.com/users/JeffreyALaw/followers", "following_url": "https://api.github.com/users/JeffreyALaw/following{/other_user}", "gists_url": "https://api.github.com/users/JeffreyALaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/JeffreyALaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JeffreyALaw/subscriptions", "organizations_url": "https://api.github.com/users/JeffreyALaw/orgs", "repos_url": "https://api.github.com/users/JeffreyALaw/repos", "events_url": "https://api.github.com/users/JeffreyALaw/events{/privacy}", "received_events_url": "https://api.github.com/users/JeffreyALaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d3907c222646174ec7e405491435aefc50bf1bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d3907c222646174ec7e405491435aefc50bf1bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d3907c222646174ec7e405491435aefc50bf1bb"}], "stats": {"total": 53, "additions": 44, "deletions": 9}, "files": [{"sha": "ada4ddd0beb3efbc60eb7112944c0dd7aa94dfd1", "filename": "gcc/config/h8300/movepush.md", "status": "modified", "additions": 44, "deletions": 9, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0d1a675e0f621fc12c7a9db47446ae38289408a/gcc%2Fconfig%2Fh8300%2Fmovepush.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0d1a675e0f621fc12c7a9db47446ae38289408a/gcc%2Fconfig%2Fh8300%2Fmovepush.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fmovepush.md?ref=f0d1a675e0f621fc12c7a9db47446ae38289408a", "patch": "@@ -13,7 +13,7 @@\n   [(parallel [(set (match_dup 0) (match_dup 1))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*movqi_clobber_flags\"\n+(define_insn \"*movqi<cczn>\"\n   [(set (match_operand:QI 0 \"general_operand_dst\" \"=r,r ,<,r,r,m\")\n \t(match_operand:QI 1 \"general_operand_src\" \" I,r>,r,n,m,r\"))\n    (clobber (reg:CC CC_REG))]\n@@ -36,7 +36,7 @@\n   [(parallel [(set (match_dup 0) (match_dup 1))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*movqi_h8sx_clobber_flags\"\n+(define_insn \"*movqi_h8sx<cczn>\"\n   [(set (match_operand:QI 0 \"general_operand_dst\" \"=Z,rQ\")\n \t(match_operand:QI 1 \"general_operand_src\" \"P4>X,rQi\"))\n    (clobber (reg:CC CC_REG))]\n@@ -74,7 +74,7 @@\n \t      (clobber (reg:CC CC_REG))])])\n \n \n-(define_insn \"movstrictqi_clobber_flags\"\n+(define_insn \"*movstrictqi<cczn>\"\n   [(set (strict_low_part (match_operand:QI 0 \"general_operand_dst\" \"+r,r\"))\n \t\t\t (match_operand:QI 1 \"general_operand_src\" \"I,rmi>\"))\n    (clobber (reg:CC CC_REG))]\n@@ -97,7 +97,7 @@\n   [(parallel [(set (match_dup 0) (match_dup 1))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*movhi_clobber_flags\"\n+(define_insn \"*movhi<cczn>\"\n   [(set (match_operand:HI 0 \"general_operand_dst\" \"=r,r,<,r,r,m\")\n \t(match_operand:HI 1 \"general_operand_src\" \"I,r>,r,i,m,r\"))\n    (clobber (reg:CC CC_REG))]\n@@ -121,7 +121,7 @@\n   [(parallel [(set (match_dup 0) (match_dup 1))\n \t      (clobber (reg:CC CC_REG))])])\n   \n-(define_insn \"*movhi_h8sx_clobber_flags\"\n+(define_insn \"*movhi_h8sx<cczn>\"\n   [(set (match_operand:HI 0 \"general_operand_dst\" \"=r,r,Z,Q,rQ\")\n \t(match_operand:HI 1 \"general_operand_src\" \"I,P3>X,P4>X,IP8>X,rQi\"))\n    (clobber (reg:CC CC_REG))]\n@@ -144,7 +144,7 @@\n   [(parallel [(set (strict_low_part (match_dup 0)) (match_dup 1))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"movstricthi_clobber_flags\"\n+(define_insn \"*movstricthi<cczn>\"\n   [(set (strict_low_part (match_operand:HI 0 \"general_operand_dst\" \"+r,r,r\"))\n \t\t\t (match_operand:HI 1 \"general_operand_src\" \"I,P3>X,rmi\"))\n    (clobber (reg:CC CC_REG))]\n@@ -168,8 +168,8 @@\n \t      (clobber (reg:CC CC_REG))])])\n \n (define_insn \"*movsi_clobber_flags\"\n-  [(set (match_operand:SI 0 \"general_operand_dst\" \"=r,r,r,<,r,r,m,*a,*a,r\")\n-\t(match_operand:SI 1 \"general_operand_src\" \"I,r,i,r,>,m,r,I,r,*a\"))\n+  [(set (match_operand:SI 0 \"general_operand_dst\" \"=r,r,r,<,r,r,m,*a,*a, r\")\n+\t(match_operand:SI 1 \"general_operand_src\" \" I,r,i,r,>,m,r, I, r,*a\"))\n    (clobber (reg:CC CC_REG))]\n   \"(TARGET_H8300S || TARGET_H8300H) && !TARGET_H8300SX\n     && h8300_move_ok (operands[0], operands[1])\"\n@@ -235,6 +235,25 @@\n }\n   [(set (attr \"length\") (symbol_ref \"compute_mov_length (operands)\"))])\n \n+(define_insn \"*movsi_cczn\"\n+  [(set (reg:CCZN CC_REG)\n+\t(compare:CCZN\n+\t  (match_operand:SI 1 \"general_operand_src\" \" I,r,i,r,>,m,r\")\n+\t  (const_int 0)))\n+   (set (match_operand:SI 0 \"general_operand_dst\" \"=r,r,r,<,r,r,m\")\n+\t(match_dup 1))]\n+  \"(TARGET_H8300S || TARGET_H8300H) && !TARGET_H8300SX\n+    && h8300_move_ok (operands[0], operands[1])\"\n+  \"@\n+   sub.l\t%S0,%S0\n+   mov.l\t%S1,%S0\n+   mov.l\t%S1,%S0\n+   mov.l\t%S1,%S0\n+   mov.l\t%S1,%S0\n+   mov.l\t%S1,%S0\n+   mov.l\t%S1,%S0\"\n+  [(set (attr \"length\") (symbol_ref \"compute_mov_length (operands)\"))])\n+\n (define_insn_and_split \"*movsi_h8sx\"\n   [(set (match_operand:SI 0 \"general_operand_dst\" \"=r,r,Q,rQ,*a,*a,r\")\n \t(match_operand:SI 1 \"general_operand_src\" \"I,P3>X,IP8>X,rQi,I,r,*a\"))]\n@@ -260,6 +279,22 @@\n   [(set_attr \"length_table\" \"*,*,short_immediate,movl,*,*,*\")\n    (set_attr \"length\" \"2,2,*,*,2,6,4\")])\n \n+(define_insn \"*movsi_h8sx_ccnz\"\n+  [(set (reg:CCZN CC_REG)\n+\t(compare:CCZN\n+\t  (match_operand:SI 1 \"general_operand_src\" \"I,P3>X,IP8>X,rQi\")\n+\t  (const_int 0)))\n+   (set (match_operand:SI 0 \"general_operand_dst\" \"=r,r,Q,rQ\")\n+\t(match_dup 1))]\n+  \"TARGET_H8300SX\"\n+  \"@\n+   sub.l\t%S0,%S0\n+   mov.l\t%S1:3,%S0\n+   mov.l\t%S1,%S0\n+   mov.l\t%S1,%S0\"\n+  [(set_attr \"length_table\" \"*,*,short_immediate,movl\")\n+   (set_attr \"length\" \"2,2,*,*\")])\n+\n (define_insn_and_split \"*movsf_h8sx\"\n   [(set (match_operand:SF 0 \"general_operand_dst\" \"=r,rQ\")\n \t(match_operand:SF 1 \"general_operand_src\" \"G,rQi\"))]\n@@ -326,7 +361,7 @@\n \t\t   (match_dup 0))\n \t      (clobber (reg:CC CC_REG))])])\n \n-(define_insn \"*push1_<QHI:mode>_clobber_flags\"\n+(define_insn \"*push1_<QHI:mode><cczn>\"\n   [(set (mem:QHI\n \t(pre_modify:P\n \t  (reg:P SP_REG)"}]}