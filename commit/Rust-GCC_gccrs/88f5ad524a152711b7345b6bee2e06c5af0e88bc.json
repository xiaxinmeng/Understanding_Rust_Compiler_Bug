{"sha": "88f5ad524a152711b7345b6bee2e06c5af0e88bc", "node_id": "C_kwDOANBUbNoAKDg4ZjVhZDUyNGExNTI3MTFiNzM0NWI2YmVlMmUwNmM1YWYwZTg4YmM", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-10-12T07:32:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-10-12T07:32:28Z"}, "message": "openmp: Add testsuite coverage for omp_{get_max,set_num}_threads and omp_{s,g}et_teams_thread_limit\n\nThis adds (C/C++ only) testsuite coverage for these new OpenMP 5.1 APIs.\n\n2021-10-12  Jakub Jelinek  <jakub@redhat.com>\n\n\t* testsuite/libgomp.c-c++-common/icv-3.c: New test.\n\t* testsuite/libgomp.c-c++-common/icv-4.c: New test.", "tree": {"sha": "3a60bcd78209cda9dde3c522bfa9305e771b040a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a60bcd78209cda9dde3c522bfa9305e771b040a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88f5ad524a152711b7345b6bee2e06c5af0e88bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88f5ad524a152711b7345b6bee2e06c5af0e88bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88f5ad524a152711b7345b6bee2e06c5af0e88bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88f5ad524a152711b7345b6bee2e06c5af0e88bc/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "342aedf0e5f324cc2fb026466a8cc5cc7f839183", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/342aedf0e5f324cc2fb026466a8cc5cc7f839183", "html_url": "https://github.com/Rust-GCC/gccrs/commit/342aedf0e5f324cc2fb026466a8cc5cc7f839183"}], "stats": {"total": 94, "additions": 94, "deletions": 0}, "files": [{"sha": "54cbf99b5974534ddd0024277ec4309c7abf85f0", "filename": "libgomp/testsuite/libgomp.c-c++-common/icv-3.c", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f5ad524a152711b7345b6bee2e06c5af0e88bc/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ficv-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f5ad524a152711b7345b6bee2e06c5af0e88bc/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ficv-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ficv-3.c?ref=88f5ad524a152711b7345b6bee2e06c5af0e88bc", "patch": "@@ -0,0 +1,54 @@\n+#include <omp.h>\n+#include <stdlib.h>\n+\n+int\n+main ()\n+{\n+  if (getenv (\"OMP_NUM_TEAMS\") == NULL\n+      && omp_get_max_teams () != 0)\n+    abort ();\n+  omp_set_num_teams (7);\n+  if (omp_get_max_teams () != 7)\n+    abort ();\n+  if (getenv (\"OMP_TEAMS_THREAD_LIMIT\") == NULL\n+      && omp_get_teams_thread_limit () != 0)\n+    abort ();\n+  omp_set_teams_thread_limit (15);\n+  if (omp_get_teams_thread_limit () != 15)\n+    abort ();\n+  #pragma omp teams\n+  {\n+    if (omp_get_max_teams () != 7\n+\t|| omp_get_teams_thread_limit () != 15\n+\t|| omp_get_num_teams () < 1\n+\t|| omp_get_num_teams () > 7\n+\t|| omp_get_team_num () < 0\n+\t|| omp_get_team_num () >= omp_get_num_teams ()\n+\t|| omp_get_thread_limit () < 1\n+\t|| omp_get_thread_limit () > 15)\n+      abort ();\n+  }\n+  #pragma omp teams num_teams(5) thread_limit (13)\n+  {\n+    if (omp_get_max_teams () != 7\n+\t|| omp_get_teams_thread_limit () != 15\n+\t|| omp_get_num_teams () != 5\n+\t|| omp_get_team_num () < 0\n+\t|| omp_get_team_num () >= omp_get_num_teams ()\n+\t|| omp_get_thread_limit () < 1\n+\t|| omp_get_thread_limit () > 13)\n+      abort ();\n+  }\n+  #pragma omp teams num_teams(8) thread_limit (16)\n+  {\n+    if (omp_get_max_teams () != 7\n+\t|| omp_get_teams_thread_limit () != 15\n+\t|| omp_get_num_teams () != 8\n+\t|| omp_get_team_num () < 0\n+\t|| omp_get_team_num () >= omp_get_num_teams ()\n+\t|| omp_get_thread_limit () < 1\n+\t|| omp_get_thread_limit () > 16)\n+      abort ();\n+  }\n+  return 0;\n+}"}, {"sha": "6cb671d8ac74c87bc4184ca79b93a37e2d8c1307", "filename": "libgomp/testsuite/libgomp.c-c++-common/icv-4.c", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88f5ad524a152711b7345b6bee2e06c5af0e88bc/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ficv-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88f5ad524a152711b7345b6bee2e06c5af0e88bc/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ficv-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c-c%2B%2B-common%2Ficv-4.c?ref=88f5ad524a152711b7345b6bee2e06c5af0e88bc", "patch": "@@ -0,0 +1,40 @@\n+/* { dg-set-target-env-var OMP_NUM_TEAMS \"6\" } */\n+/* { dg-set-target-env-var OMP_TEAMS_THREAD_LIMIT \"12\" } */\n+\n+#include <omp.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+int\n+main ()\n+{\n+  if (getenv (\"OMP_NUM_TEAMS\") != NULL\n+      && strcmp (getenv (\"OMP_NUM_TEAMS\"), \"6\") == 0)\n+    {\n+      if (omp_get_max_teams () != 6)\n+\tabort ();\n+    }\n+  else\n+    omp_set_num_teams (6);\n+  if (getenv (\"OMP_TEAMS_THREAD_LIMIT\") == NULL\n+      && strcmp (getenv (\"OMP_TEAMS_THREAD_LIMIT\"), \"12\") == 0)\n+    {\n+      if (omp_get_teams_thread_limit () != 12)\n+\tabort ();\n+    }\n+  else\n+    omp_set_teams_thread_limit (12);\n+  #pragma omp teams\n+  {\n+    if (omp_get_max_teams () != 6\n+\t|| omp_get_teams_thread_limit () != 12\n+\t|| omp_get_num_teams () < 1\n+\t|| omp_get_num_teams () > 6\n+\t|| omp_get_team_num () < 0\n+\t|| omp_get_team_num () >= omp_get_num_teams ()\n+\t|| omp_get_thread_limit () < 1\n+\t|| omp_get_thread_limit () > 12)\n+      abort ();\n+  }\n+  return 0;\n+}"}]}