{"sha": "d586d6d1f6afb26b105aca56336217594549bf80", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDU4NmQ2ZDFmNmFmYjI2YjEwNWFjYTU2MzM2MjE3NTk0NTQ5YmY4MA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2006-12-30T12:02:09Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2006-12-30T12:02:09Z"}, "message": "tree-ssa-alias.c (create_structure_vars): When in SSA, update operand caches.\n\n\t* tree-ssa-alias.c (create_structure_vars): When in SSA, update operand\n\tcaches.\n\t* tree-ssa-operands.c (build_ssa_operands): Recompute addresses_taken\n\tbitmap.\n\nFrom-SVN: r120284", "tree": {"sha": "a1ec2dcdcfc29c5e53fc7abed01106497d065f6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a1ec2dcdcfc29c5e53fc7abed01106497d065f6b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d586d6d1f6afb26b105aca56336217594549bf80", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d586d6d1f6afb26b105aca56336217594549bf80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d586d6d1f6afb26b105aca56336217594549bf80", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d586d6d1f6afb26b105aca56336217594549bf80/comments", "author": null, "committer": null, "parents": [{"sha": "4b73962b7e164ed118806f9c70bc75a4799df467", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b73962b7e164ed118806f9c70bc75a4799df467", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b73962b7e164ed118806f9c70bc75a4799df467"}], "stats": {"total": 64, "additions": 64, "deletions": 0}, "files": [{"sha": "93be53d2592c983091c08174270721840b74979a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d586d6d1f6afb26b105aca56336217594549bf80/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d586d6d1f6afb26b105aca56336217594549bf80/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d586d6d1f6afb26b105aca56336217594549bf80", "patch": "@@ -1,3 +1,10 @@\n+2006-12-30  Jan Hubicka  <jh@suse.cz>\n+\n+\t* tree-ssa-alias.c (create_structure_vars): When in SSA, update operand\n+\tcaches.\n+\t* tree-ssa-operands.c (build_ssa_operands): Recompute addresses_taken\n+\tbitmap.\n+\n 2006-12-30  Jan Hubicka  <jh@suse.cz>\n \t    Vladimir Yanovsky <volodyan@gmail.com>\n \t"}, {"sha": "2ef529707cdff95a4cc6c21130ecb6cc72283d41", "filename": "gcc/tree-ssa-alias.c", "status": "modified", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d586d6d1f6afb26b105aca56336217594549bf80/gcc%2Ftree-ssa-alias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d586d6d1f6afb26b105aca56336217594549bf80/gcc%2Ftree-ssa-alias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-alias.c?ref=d586d6d1f6afb26b105aca56336217594549bf80", "patch": "@@ -3188,6 +3188,58 @@ create_structure_vars (void)\n     }\n   htab_delete (used_portions);\n   VEC_free (tree, heap, varvec);\n+\n+  /* Update SSA operands of statememnts mentioning varibales we split.  */\n+  if (gimple_in_ssa_p (cfun))\n+    FOR_EACH_BB (bb)\n+      {\n+\tblock_stmt_iterator bsi;\n+\tfor (bsi = bsi_start (bb); !bsi_end_p (bsi); bsi_next (&bsi))\n+\t  {\n+\t    tree stmt = bsi_stmt (bsi);\n+\t    bool update = false;\n+\t    unsigned int i;\n+\t    bitmap_iterator bi;\n+\n+\t    if (STORED_SYMS (stmt))\n+\t       EXECUTE_IF_SET_IN_BITMAP (STORED_SYMS (stmt), 0, i, bi)\n+\t\t{\n+\t\t  tree sym = referenced_var_lookup (i);\n+\t\t  if (get_subvars_for_var (sym))\n+\t\t    {\n+\t\t      update=true;\n+\t\t      break;\n+\t\t    }\n+\t\t}\n+\n+\t    if (LOADED_SYMS (stmt) && !update)\n+\t       EXECUTE_IF_SET_IN_BITMAP (LOADED_SYMS (stmt), 0, i, bi)\n+\t\t{\n+\t\t  tree sym = referenced_var_lookup (i);\n+\t\t  if (get_subvars_for_var (sym))\n+\t\t    {\n+\t\t      update=true;\n+\t\t      break;\n+\t\t    }\n+\t\t}\n+\n+\t    if (stmt_ann (stmt)->addresses_taken && !update)\n+\t       EXECUTE_IF_SET_IN_BITMAP (stmt_ann (stmt)->addresses_taken,\n+\t\t\t\t\t 0, i, bi)\n+\t\t{\n+\t\t  tree sym = referenced_var_lookup (i);\n+\t\t  if (get_subvars_for_var (sym))\n+\t\t    {\n+\t\t      update=true;\n+\t\t      break;\n+\t\t    }\n+\t\t}\n+\n+\t    if (update)\n+\t      update_stmt (stmt);\n+\t  }\n+      }\n+  \n   return 0;\n }\n "}, {"sha": "9d4b84cc709a20ef94d4c6ac291c1ddc57fb2d8e", "filename": "gcc/tree-ssa-operands.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d586d6d1f6afb26b105aca56336217594549bf80/gcc%2Ftree-ssa-operands.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d586d6d1f6afb26b105aca56336217594549bf80/gcc%2Ftree-ssa-operands.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-operands.c?ref=d586d6d1f6afb26b105aca56336217594549bf80", "patch": "@@ -2337,13 +2337,18 @@ build_ssa_operands (tree stmt)\n      makes no memory references.  */\n   ann->has_volatile_ops = false;\n   ann->references_memory = false;\n+  /* Just clear the bitmap so we don't end up reallocating it over and over.  */\n+  if (ann->addresses_taken)\n+    bitmap_clear (ann->addresses_taken);\n \n   start_ssa_stmt_operands ();\n   parse_ssa_operands (stmt);\n   operand_build_sort_virtual (build_vuses);\n   operand_build_sort_virtual (build_vdefs);\n   finalize_ssa_stmt_operands (stmt);\n \n+  if (ann->addresses_taken && bitmap_empty_p (ann->addresses_taken))\n+    ann->addresses_taken = NULL;\n   /* For added safety, assume that statements with volatile operands\n      also reference memory.  */\n   if (ann->has_volatile_ops)"}]}