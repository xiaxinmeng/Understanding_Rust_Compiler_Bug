{"sha": "5525ed38b494c33e6c693f1f16bd49abb454d45f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTUyNWVkMzhiNDk0YzMzZTZjNjkzZjFmMTZiZDQ5YWJiNDU0ZDQ1Zg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-03-05T08:46:31Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-03-05T08:46:31Z"}, "message": "re PR lto/60404 (wrong code by LTO on x86_64-linux-gnu)\n\n\tPR lto/60404\n\t* cfgexpand.c (expand_used_vars): Do not assume all SSA_NAMEs\n\tof PARM/RESULT_DECLs must be coalesced with optimize && in_lto_p.\n\t* tree-ssa-coalesce.c (coalesce_ssa_name): Use MUST_COALESCE_COST - 1\n\tcost for in_lto_p.\n\n\t* gcc.dg/lto/pr60404_0.c: New test.\n\t* gcc.dg/lto/pr60404_1.c: New file.\n\t* gcc.dg/lto/pr60404_2.c: New file.\n\nFrom-SVN: r208340", "tree": {"sha": "d9e72aff796794255618b803a9b18bc740312cc7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d9e72aff796794255618b803a9b18bc740312cc7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5525ed38b494c33e6c693f1f16bd49abb454d45f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5525ed38b494c33e6c693f1f16bd49abb454d45f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5525ed38b494c33e6c693f1f16bd49abb454d45f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5525ed38b494c33e6c693f1f16bd49abb454d45f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7af9985b2d8850584c543d9ff5f09ee4e29ed0df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7af9985b2d8850584c543d9ff5f09ee4e29ed0df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7af9985b2d8850584c543d9ff5f09ee4e29ed0df"}], "stats": {"total": 56, "additions": 52, "deletions": 4}, "files": [{"sha": "2ef225e192b5d1aa9bc3117aa0313444c7a080eb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -1,3 +1,11 @@\n+2014-03-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR lto/60404\n+\t* cfgexpand.c (expand_used_vars): Do not assume all SSA_NAMEs\n+\tof PARM/RESULT_DECLs must be coalesced with optimize && in_lto_p.\n+\t* tree-ssa-coalesce.c (coalesce_ssa_name): Use MUST_COALESCE_COST - 1\n+\tcost for in_lto_p.\n+\n 2014-03-04  Heiher  <r@hev.cc>\n \n \t* config/mips/mips-cpus.def (loongson3a): Mark as a MIPS64r2 processor."}, {"sha": "dd163a5f8c5e76e1adea1f211cfc9198f500e95f", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -1652,10 +1652,12 @@ expand_used_vars (void)\n \t debug info, there is no need to do so if optimization is disabled\n \t because all the SSA_NAMEs based on these DECLs have been coalesced\n \t into a single partition, which is thus assigned the canonical RTL\n-\t location of the DECLs.  */\n+\t location of the DECLs.  If in_lto_p, we can't rely on optimize,\n+\t a function could be compiled with -O1 -flto first and only the\n+\t link performed at -O0.  */\n       if (TREE_CODE (SSA_NAME_VAR (var)) == VAR_DECL)\n \texpand_one_var (var, true, true);\n-      else if (DECL_IGNORED_P (SSA_NAME_VAR (var)) || optimize)\n+      else if (DECL_IGNORED_P (SSA_NAME_VAR (var)) || optimize || in_lto_p)\n \t{\n \t  /* This is a PARM_DECL or RESULT_DECL.  For those partitions that\n \t     contain the default def (representing the parm or result itself)"}, {"sha": "e9258f3da830fa0497be867d1728a0113b10b4c0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -1,3 +1,10 @@\n+2014-03-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR lto/60404\n+\t* gcc.dg/lto/pr60404_0.c: New test.\n+\t* gcc.dg/lto/pr60404_1.c: New file.\n+\t* gcc.dg/lto/pr60404_2.c: New file.\n+\n 2014-03-04  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* gcc.dg/vmx/extract-vsx.c: Replace \"vector long\" with \"vector"}, {"sha": "a22216db20780bd317443417041634a86b961b39", "filename": "gcc/testsuite/gcc.dg/lto/pr60404_0.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_0.c?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-lto-do run } */\n+/* { dg-lto-options { { -O1 -flto } } } */\n+/* { dg-extra-ld-options { -O0 } } */\n+\n+extern void fn2 (int);\n+int a[1], b;\n+\n+int\n+main ()\n+{\n+  fn2 (0);\n+  if (b != 0 || a[b] != 0)\n+    __builtin_abort ();\n+  return 0;\n+}"}, {"sha": "8c1259803f53d1330633cfe133830360e6e59393", "filename": "gcc/testsuite/gcc.dg/lto/pr60404_1.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_1.c?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -0,0 +1,4 @@\n+void\n+fn1 (int p)\n+{\n+}"}, {"sha": "e1db02409a8ea4168caf849e024b233ce106c694", "filename": "gcc/testsuite/gcc.dg/lto/pr60404_2.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr60404_2.c?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -0,0 +1,9 @@\n+extern int b;\n+extern void fn1 (int);\n+\n+void\n+fn2 (int p)\n+{\n+  b = p++;\n+  fn1 (p);\n+}"}, {"sha": "9a1ac67bf7767cb359eae702b0fefc27cde2666d", "filename": "gcc/tree-ssa-coalesce.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftree-ssa-coalesce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5525ed38b494c33e6c693f1f16bd49abb454d45f/gcc%2Ftree-ssa-coalesce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-coalesce.c?ref=5525ed38b494c33e6c693f1f16bd49abb454d45f", "patch": "@@ -1289,9 +1289,12 @@ coalesce_ssa_name (void)\n \t\t     _require_ that all the names originating from it be\n \t\t     coalesced, because there must be a single partition\n \t\t     containing all the names so that it can be assigned\n-\t\t     the canonical RTL location of the DECL safely.  */\n+\t\t     the canonical RTL location of the DECL safely.\n+\t\t     If in_lto_p, a function could have been compiled\n+\t\t     originally with optimizations and only the link\n+\t\t     performed at -O0, so we can't actually require it.  */\n \t\t  const int cost\n-\t\t    = TREE_CODE (SSA_NAME_VAR (a)) == VAR_DECL\n+\t\t    = (TREE_CODE (SSA_NAME_VAR (a)) == VAR_DECL || in_lto_p)\n \t\t      ? MUST_COALESCE_COST - 1 : MUST_COALESCE_COST;\n \t\t  add_coalesce (cl, SSA_NAME_VERSION (a),\n \t\t\t\tSSA_NAME_VERSION (*slot), cost);"}]}