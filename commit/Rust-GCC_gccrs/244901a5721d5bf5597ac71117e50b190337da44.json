{"sha": "244901a5721d5bf5597ac71117e50b190337da44", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjQ0OTAxYTU3MjFkNWJmNTU5N2FjNzExMTdlNTBiMTkwMzM3ZGE0NA==", "commit": {"author": {"name": "Tim Shen", "email": "timshen@google.com", "date": "2016-02-17T03:33:02Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2016-02-17T03:33:02Z"}, "message": "re PR libstdc++/69794 (std::regex_search match failure with regex object with flags grep|icase)\n\n2016-02-16  Tim Shen  <timshen@google.com>\n\n\tPR libstdc++/69794\n\t* include/bits/regex_scanner.h: Add different special character\n\tsets for grep and egrep regex.\n\t* include/bits/regex_scanner.tcc: Use _M_spec_char more uniformly.\n\t* testsuite/28_regex/regression.cc: Add new testcase.\n\nFrom-SVN: r233482", "tree": {"sha": "4fabb7ea3ef08e47e8444d88cdcce5d007ab1362", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4fabb7ea3ef08e47e8444d88cdcce5d007ab1362"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/244901a5721d5bf5597ac71117e50b190337da44", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/244901a5721d5bf5597ac71117e50b190337da44", "html_url": "https://github.com/Rust-GCC/gccrs/commit/244901a5721d5bf5597ac71117e50b190337da44", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/244901a5721d5bf5597ac71117e50b190337da44/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6bab4c63c4277ce8831c9d1cb6161f12f557f7f6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6bab4c63c4277ce8831c9d1cb6161f12f557f7f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6bab4c63c4277ce8831c9d1cb6161f12f557f7f6"}], "stats": {"total": 49, "additions": 38, "deletions": 11}, "files": [{"sha": "be4e95cbb4341a05d78f71e94af090d288609261", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=244901a5721d5bf5597ac71117e50b190337da44", "patch": "@@ -1,3 +1,11 @@\n+2016-02-16  Tim Shen  <timshen@google.com>\n+\n+\tPR libstdc++/69794\n+\t* include/bits/regex_scanner.h: Add different special character\n+\tsets for grep and egrep regex.\n+\t* include/bits/regex_scanner.tcc: Use _M_spec_char more uniformly.\n+\t* testsuite/28_regex/regression.cc: Add new testcase.\n+\n 2016-02-08  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* acinclude.m4 (GLIBCXX_CHECK_MATH11_PROTO): Remove accidentally"}, {"sha": "37dea840d5be575d25a2d69acd53565f152043bf", "filename": "libstdc++-v3/include/bits/regex_scanner.h", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_scanner.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_scanner.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_scanner.h?ref=244901a5721d5bf5597ac71117e50b190337da44", "patch": "@@ -95,11 +95,19 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t  : _M_awk_escape_tbl),\n     _M_spec_char(_M_is_ecma()\n \t\t ? _M_ecma_spec_char\n-\t\t : _M_is_basic()\n+\t\t : _M_flags & regex_constants::basic\n \t\t ? _M_basic_spec_char\n-\t\t : _M_extended_spec_char),\n+\t\t : _M_flags & regex_constants::extended\n+\t\t ? _M_extended_spec_char\n+\t\t : _M_flags & regex_constants::grep\n+\t\t ?  \".[\\\\*^$\\n\"\n+\t\t : _M_flags & regex_constants::egrep\n+\t\t ? \".[\\\\()*+?{|^$\\n\"\n+\t\t : _M_flags & regex_constants::awk\n+\t\t ? _M_extended_spec_char\n+\t\t : nullptr),\n     _M_at_bracket_start(false)\n-    { }\n+    { __glibcxx_assert(_M_spec_char); }\n \n   protected:\n     const char*\n@@ -137,6 +145,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     { return _M_flags & regex_constants::awk; }\n \n   protected:\n+    // TODO: Make them static in the next abi change.\n     const std::pair<char, _TokenT> _M_token_tbl[9] =\n       {\n \t{'^', _S_token_line_begin},"}, {"sha": "fedba09a71396f06199b3d81b6c250629d5a3626", "filename": "libstdc++-v3/include/bits/regex_scanner.tcc", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_scanner.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_scanner.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_scanner.tcc?ref=244901a5721d5bf5597ac71117e50b190337da44", "patch": "@@ -97,9 +97,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     _M_scan_normal()\n     {\n       auto __c = *_M_current++;\n-      const char* __pos;\n \n-      if (std::strchr(_M_spec_char, _M_ctype.narrow(__c, '\\0')) == nullptr)\n+      if (std::strchr(_M_spec_char, _M_ctype.narrow(__c, ' ')) == nullptr)\n \t{\n \t  _M_token = _S_token_ord_char;\n \t  _M_value.assign(1, __c);\n@@ -177,12 +176,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  _M_state = _S_state_in_brace;\n \t  _M_token = _S_token_interval_begin;\n \t}\n-      else if (((__pos = std::strchr(_M_spec_char, _M_ctype.narrow(__c, '\\0')))\n-\t\t  != nullptr\n-\t\t&& *__pos != '\\0'\n-\t\t&& __c != ']'\n-\t\t&& __c != '}')\n-\t       || (_M_is_grep() && __c == '\\n'))\n+      else if (__c != ']' && __c != '}')\n \t{\n \t  auto __it = _M_token_tbl;\n \t  auto __narrowc = _M_ctype.narrow(__c, '\\0');"}, {"sha": "c9a3402011ef447e29c6c1ded07bd372e79c98ee", "filename": "libstdc++-v3/testsuite/28_regex/regression.cc", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fregression.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/244901a5721d5bf5597ac71117e50b190337da44/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fregression.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fregression.cc?ref=244901a5721d5bf5597ac71117e50b190337da44", "patch": "@@ -33,10 +33,26 @@ test01()\n   regex re(\"((.)\", regex_constants::basic);\n }\n \n+void\n+test02()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  std::string re_str\n+    {\n+      \"/abcd\" \"\\n\"\n+      \"/aecf\" \"\\n\"\n+      \"/ghci\"\n+    };\n+  auto rx = std::regex(re_str, std::regex_constants::grep | std::regex_constants::icase);\n+  VERIFY(std::regex_search(\"/abcd\", rx));\n+}\n+\n int\n main()\n {\n   test01();\n+  test02();\n   return 0;\n }\n "}]}