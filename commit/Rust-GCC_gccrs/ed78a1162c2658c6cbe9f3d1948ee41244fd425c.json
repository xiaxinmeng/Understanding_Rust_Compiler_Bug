{"sha": "ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWQ3OGExMTYyYzI2NThjNmNiZTlmM2QxOTQ4ZWU0MTI0NGZkNDI1Yw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2006-02-16T07:04:13Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2006-02-16T07:04:13Z"}, "message": "re PR fortran/24557 (ICE: PRINTing function result of size depending on assumed length CHARACTER dummy)\n\n2005-02-16  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/24557\n\t* trans-expr.c (gfc_add_interface_mapping): Use the actual argument\n\tfor character(*) arrays, rather than casting to the type and kind\n\tparameters of the formal argument.\n\n2005-02-16  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/24557\n        * gfortran.dg/assumed_charlen_needed_1.f90: New test.\n\nFrom-SVN: r111130", "tree": {"sha": "ce717e2105716a8c1631ac2cc1cd0ee39d308c7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce717e2105716a8c1631ac2cc1cd0ee39d308c7c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/comments", "author": null, "committer": null, "parents": [{"sha": "1929b9988c98e9a806b57e73fd3a9885b63643e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1929b9988c98e9a806b57e73fd3a9885b63643e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1929b9988c98e9a806b57e73fd3a9885b63643e0"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "0755ee768381992f8e1f8c19c55454e3bf1c4e56", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "patch": "@@ -1,3 +1,10 @@\n+2005-02-16  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/24557\n+\t* trans-expr.c (gfc_add_interface_mapping): Use the actual argument\n+\tfor character(*) arrays, rather than casting to the type and kind\n+\tparameters of the formal argument.\n+\n 2006-02-15  Toon Moene  <toon@moene.indiv.nluug.nl>\n \n \tPR fortran/26054"}, {"sha": "9f5774bf815801ed1e0eefeeb9ec7a13db4a3f7e", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "patch": "@@ -1346,6 +1346,10 @@ gfc_add_interface_mapping (gfc_interface_mapping * mapping,\n   /* If the argument is a scalar or a pointer to an array, dereference it.  */\n   else if (!sym->attr.dimension || sym->attr.pointer)\n     value = build_fold_indirect_ref (se->expr);\n+  \n+  /* For character(*), use the actual argument's descriptor.  */  \n+  else if (sym->ts.type == BT_CHARACTER && !new_sym->ts.cl->length)\n+    value = build_fold_indirect_ref (se->expr);\n \n   /* If the argument is an array descriptor, use it to determine\n      information about the actual argument's shape.  */"}, {"sha": "7f464ab718850a33ce4e8acdbc2dee214ce27e8b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "patch": "@@ -1,3 +1,8 @@\n+2005-02-16  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/24557\n+        * gfortran.dg/assumed_charlen_needed_1.f90: New test.\n+\n 2006-02-15  Toon Moene  <toon@moene.indiv.nluug.nl>\n \n \tPR fortran/26054"}, {"sha": "759e3e780a7904d7d151d8c3c59ac1bf56940b40", "filename": "gcc/testsuite/gfortran.dg/assumed_charlen_needed_1.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ftestsuite%2Fgfortran.dg%2Fassumed_charlen_needed_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ed78a1162c2658c6cbe9f3d1948ee41244fd425c/gcc%2Ftestsuite%2Fgfortran.dg%2Fassumed_charlen_needed_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fassumed_charlen_needed_1.f90?ref=ed78a1162c2658c6cbe9f3d1948ee41244fd425c", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do compile }\n+! Tests the fix for PR24557 in which the return of a\n+! temporary character(*) array would cause an ICE.\n+!\n+! Test case provided by Erik Edelmann  <eedelmann@gcc.gnu.org>\n+!\n+  character(4) :: a(2)\n+  print *, fun (a)\n+contains\n+  function fun (arg)\n+    character (*) :: arg (10)\n+    integer :: fun(size(arg))\n+    fun = 1\n+  end function fun\n+end"}]}