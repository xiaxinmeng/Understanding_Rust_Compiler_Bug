{"sha": "322131422949bce3246db4b2031a9032858080e4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzIyMTMxNDIyOTQ5YmNlMzI0NmRiNGIyMDMxYTkwMzI4NTgwODBlNA==", "commit": {"author": {"name": "Robert Dewar", "email": "dewar@gnat.com", "date": "2001-12-05T01:48:56Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-12-05T01:48:56Z"}, "message": "* sem_attr.adb:\n\n\t(Compile_Time_Known_Attribute): New procedure.\n\t(Eval_Attribute, case Size): Use Compile_Time_Known_Attribute to ensure\n\t proper range check.\n\nFrom-SVN: r47646", "tree": {"sha": "b9000903169872607ad0e809a969f4b9ffdee53c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b9000903169872607ad0e809a969f4b9ffdee53c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/322131422949bce3246db4b2031a9032858080e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/322131422949bce3246db4b2031a9032858080e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/322131422949bce3246db4b2031a9032858080e4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/322131422949bce3246db4b2031a9032858080e4/comments", "author": null, "committer": null, "parents": [{"sha": "c0def2adcc412435120f1b4e5cb7749aa0491bec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0def2adcc412435120f1b4e5cb7749aa0491bec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0def2adcc412435120f1b4e5cb7749aa0491bec"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "3b6f176baafbf41262c2178d0232ada6a6c884c2", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322131422949bce3246db4b2031a9032858080e4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322131422949bce3246db4b2031a9032858080e4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=322131422949bce3246db4b2031a9032858080e4", "patch": "@@ -1,3 +1,10 @@\n+2001-12-04  Robert Dewar <dewar@gnat.com>\n+\n+\t* sem_attr.adb:\n+\t(Compile_Time_Known_Attribute): New procedure.\n+\t(Eval_Attribute, case Size): Use Compile_Time_Known_Attribute to ensure\n+\t proper range check.\n+\n 2001-12-04  Ed Schonberg <schonber@gnat.com>\n \n \t* sem_ch7.adb (New_Private_Type): Set Is_Tagged_Type flag before "}, {"sha": "9cf41f92e4c0b658f7e1e241eba74dd56ced1d89", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 36, "deletions": 5, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322131422949bce3246db4b2031a9032858080e4/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322131422949bce3246db4b2031a9032858080e4/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=322131422949bce3246db4b2031a9032858080e4", "patch": "@@ -3682,6 +3682,11 @@ package body Sem_Attr is\n       --  any, of the attribute, are in a non-static context. This procedure\n       --  performs the required additional checks.\n \n+      procedure Compile_Time_Known_Attribute (N : Node_Id; Val : Uint);\n+      --  This procedure is called when the attribute N has a non-static\n+      --  but compile time known value given by Val. It includes the\n+      --  necessary checks for out of range values.\n+\n       procedure Float_Attribute_Universal_Integer\n         (IEEES_Val : Int;\n          IEEEL_Val : Int;\n@@ -3755,6 +3760,34 @@ package body Sem_Attr is\n          end loop;\n       end Check_Expressions;\n \n+      ----------------------------------\n+      -- Compile_Time_Known_Attribute --\n+      ----------------------------------\n+\n+      procedure Compile_Time_Known_Attribute (N : Node_Id; Val : Uint) is\n+         T : constant Entity_Id := Etype (N);\n+\n+      begin\n+         Fold_Uint (N, Val);\n+         Set_Is_Static_Expression (N, False);\n+\n+         --  Check that result is in bounds of the type if it is static\n+\n+         if Is_In_Range (N, T) then\n+            null;\n+\n+         elsif Is_Out_Of_Range (N, T) then\n+            Apply_Compile_Time_Constraint_Error\n+              (N, \"value not in range of}?\");\n+\n+         elsif not Range_Checks_Suppressed (T) then\n+            Enable_Range_Check (N);\n+\n+         else\n+            Set_Do_Range_Check (N, False);\n+         end if;\n+      end Compile_Time_Known_Attribute;\n+\n       ---------------------------------------\n       -- Float_Attribute_Universal_Integer --\n       ---------------------------------------\n@@ -4065,8 +4098,7 @@ package body Sem_Attr is\n             if Is_Entity_Name (P)\n               and then Known_Esize (Entity (P))\n             then\n-               Fold_Uint (N, Esize (Entity (P)));\n-               Set_Is_Static_Expression (N, False);\n+               Compile_Time_Known_Attribute (N, Esize (Entity (P)));\n                return;\n \n             else\n@@ -4178,8 +4210,7 @@ package body Sem_Attr is\n         and then (not Is_Generic_Type (P_Entity))\n         and then Known_Static_RM_Size (P_Entity)\n       then\n-         Fold_Uint (N, RM_Size (P_Entity));\n-         Set_Is_Static_Expression (N, False);\n+         Compile_Time_Known_Attribute (N, RM_Size (P_Entity));\n          return;\n \n       --  No other cases are foldable (they certainly aren't static, and at\n@@ -6270,6 +6301,7 @@ package body Sem_Attr is\n                end if;\n \n                if Is_Tagged_Type (Designated_Type (Typ)) then\n+\n                   --  If the attribute is in the context of an access\n                   --  parameter, then the prefix is allowed to be of\n                   --  the class-wide type (by AI-127).\n@@ -6278,7 +6310,6 @@ package body Sem_Attr is\n                      if not Covers (Designated_Type (Typ), Nom_Subt)\n                        and then not Covers (Nom_Subt, Designated_Type (Typ))\n                      then\n-\n                         declare\n                            Desig : Entity_Id;\n "}]}