{"sha": "77f4ead72e55094fca78530bff75f83eb0faadbd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzdmNGVhZDcyZTU1MDk0ZmNhNzg1MzBiZmY3NWY4M2ViMGZhYWRiZA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2017-10-31T20:40:10Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2017-10-31T20:40:10Z"}, "message": "jit: add a way to preserve testsuite executables\n\ngcc/jit/ChangeLog:\n\t* docs/internals/index.rst (Running the test suite): Document\n\tPRESERVE_EXECUTABLES.\n\t(Running under valgrind): Add markup to RUN_UNDER_VALGRIND.\n\t* docs/_build/texinfo/libgccjit.texi: Regenerate.\n\ngcc/testsuite/ChangeLog:\n\t* jit.dg/jit.exp (jit-dg-test): If PRESERVE_EXECUTABLES is set in\n\tthe environment, don't delete the generated executable.\n\nFrom-SVN: r254282", "tree": {"sha": "948ebc9e41f6bf42946a6d4cfebf912145df61fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/948ebc9e41f6bf42946a6d4cfebf912145df61fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/77f4ead72e55094fca78530bff75f83eb0faadbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77f4ead72e55094fca78530bff75f83eb0faadbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77f4ead72e55094fca78530bff75f83eb0faadbd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77f4ead72e55094fca78530bff75f83eb0faadbd/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "84ffba1283c323e559d487f5a44012e2481f7c85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84ffba1283c323e559d487f5a44012e2481f7c85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84ffba1283c323e559d487f5a44012e2481f7c85"}], "stats": {"total": 49, "additions": 42, "deletions": 7}, "files": [{"sha": "87b5473922abc2c6aa54ad30d688014278c567a9", "filename": "gcc/jit/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Fjit%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Fjit%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2FChangeLog?ref=77f4ead72e55094fca78530bff75f83eb0faadbd", "patch": "@@ -1,3 +1,10 @@\n+2017-10-31  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* docs/internals/index.rst (Running the test suite): Document\n+\tPRESERVE_EXECUTABLES.\n+\t(Running under valgrind): Add markup to RUN_UNDER_VALGRIND.\n+\t* docs/_build/texinfo/libgccjit.texi: Regenerate.\n+\n 2017-10-04  David Malcolm  <dmalcolm@redhat.com>\n \n \t* docs/cp/topics/expressions.rst (Vector expressions): New"}, {"sha": "a3b206f2dd4ee40f4467068bd8455ab0655f304b", "filename": "gcc/jit/docs/_build/texinfo/libgccjit.texi", "status": "modified", "additions": 14, "deletions": 4, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Fjit%2Fdocs%2F_build%2Ftexinfo%2Flibgccjit.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Fjit%2Fdocs%2F_build%2Ftexinfo%2Flibgccjit.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Fdocs%2F_build%2Ftexinfo%2Flibgccjit.texi?ref=77f4ead72e55094fca78530bff75f83eb0faadbd", "patch": "@@ -19,7 +19,7 @@\n \n @copying\n @quotation\n-libgccjit 8.0.0 (experimental 20171004), October 04, 2017\n+libgccjit 8.0.0 (experimental 20171031), October 31, 2017\n \n David Malcolm\n \n@@ -15016,7 +15016,12 @@ jit/build/gcc/testsuite/jit/jit.log\n \n @noindent\n \n-The test executables can be seen as:\n+The test executables are normally deleted after each test is run.  For\n+debugging, they can be preserved by setting \n+@geindex PRESERVE_EXECUTABLES\n+@geindex environment variable; PRESERVE_EXECUTABLES\n+@code{PRESERVE_EXECUTABLES}\n+in the environment.  If so, they can then be seen as:\n \n @example\n jit/build/gcc/testsuite/jit/*.exe\n@@ -15029,7 +15034,9 @@ which can be run independently.\n You can compile and run individual tests by passing \"jit.exp=TESTNAME\" to RUNTESTFLAGS e.g.:\n \n @example\n-[gcc] $ make check-jit RUNTESTFLAGS=\"-v -v -v jit.exp=test-factorial.c\"\n+[gcc] $ PRESERVE_EXECUTABLES= \\\n+          make check-jit \\\n+            RUNTESTFLAGS=\"-v -v -v jit.exp=test-factorial.c\"\n @end example\n \n @noindent\n@@ -15056,7 +15063,10 @@ and once a test has been compiled, you can debug it directly:\n @subsection Running under valgrind\n \n \n-The jit testsuite detects if RUN_UNDER_VALGRIND is present in the\n+The jit testsuite detects if \n+@geindex RUN_UNDER_VALGRIND\n+@geindex environment variable; RUN_UNDER_VALGRIND\n+@code{RUN_UNDER_VALGRIND} is present in the\n environment (with any value).  If it is present, it runs the test client\n code under valgrind@footnote{http://valgrind.org},\n specifcally, the default"}, {"sha": "4ad7f61f77491a250c616f5e71698e209cfca815", "filename": "gcc/jit/docs/internals/index.rst", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Fjit%2Fdocs%2Finternals%2Findex.rst", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Fjit%2Fdocs%2Finternals%2Findex.rst", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Fdocs%2Finternals%2Findex.rst?ref=77f4ead72e55094fca78530bff75f83eb0faadbd", "patch": "@@ -103,7 +103,9 @@ and detailed logs in:\n \n   jit/build/gcc/testsuite/jit/jit.log\n \n-The test executables can be seen as:\n+The test executables are normally deleted after each test is run.  For\n+debugging, they can be preserved by setting :envvar:`PRESERVE_EXECUTABLES`\n+in the environment.  If so, they can then be seen as:\n \n .. code-block:: console\n \n@@ -115,7 +117,9 @@ You can compile and run individual tests by passing \"jit.exp=TESTNAME\" to RUNTES\n \n .. code-block:: console\n \n-   [gcc] $ make check-jit RUNTESTFLAGS=\"-v -v -v jit.exp=test-factorial.c\"\n+   [gcc] $ PRESERVE_EXECUTABLES= \\\n+             make check-jit \\\n+               RUNTESTFLAGS=\"-v -v -v jit.exp=test-factorial.c\"\n \n and once a test has been compiled, you can debug it directly:\n \n@@ -130,7 +134,7 @@ and once a test has been compiled, you can debug it directly:\n Running under valgrind\n **********************\n \n-The jit testsuite detects if RUN_UNDER_VALGRIND is present in the\n+The jit testsuite detects if :envvar:`RUN_UNDER_VALGRIND` is present in the\n environment (with any value).  If it is present, it runs the test client\n code under `valgrind <http://valgrind.org>`_,\n specifcally, the default"}, {"sha": "1af4fd2da432fad840e2e82baf4a44b3e9887e3c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=77f4ead72e55094fca78530bff75f83eb0faadbd", "patch": "@@ -1,3 +1,8 @@\n+2017-10-31  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* jit.dg/jit.exp (jit-dg-test): If PRESERVE_EXECUTABLES is set in\n+\tthe environment, don't delete the generated executable.\n+\n 2017-10-31  David Malcolm  <dmalcolm@redhat.com>\n \n \t* g++.dg/cpp0x/auto21.C: Update dg-error to reflect addition of"}, {"sha": "869d9f693a0145632dc21c8e5b23a96b6eac8e6b", "filename": "gcc/testsuite/jit.dg/jit.exp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Ftestsuite%2Fjit.dg%2Fjit.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/77f4ead72e55094fca78530bff75f83eb0faadbd/gcc%2Ftestsuite%2Fjit.dg%2Fjit.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Fjit.exp?ref=77f4ead72e55094fca78530bff75f83eb0faadbd", "patch": "@@ -580,6 +580,15 @@ proc jit-dg-test { prog do_what extra_tool_flags } {\n \tverbose \"$name is not meant to generate a reproducer\"\n     }\n \n+    # Normally we would return $comp_output and $output_file to the\n+    # caller, which would delete $output_file, the generated executable.\n+    # If we need to debug, it's handy to be able to suppress this behavior,\n+    # keeping the executable around.\n+    set preserve_executables [info exists env(PRESERVE_EXECUTABLES)]\n+    if $preserve_executables {\n+\tset output_file \"\"\n+    }\n+    \n     return [list $comp_output $output_file]\n }\n "}]}