{"sha": "b6c00353648731a6f4dd6bb3e726f6ed1a75d701", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZjMDAzNTM2NDg3MzFhNmY0ZGQ2YmIzZTcyNmY2ZWQxYTc1ZDcwMQ==", "commit": {"author": {"name": "Teresa Johnson", "email": "tejohnson@google.com", "date": "2013-10-29T20:39:49Z"}, "committer": {"name": "Teresa Johnson", "email": "tejohnson@gcc.gnu.org", "date": "2013-10-29T20:39:49Z"}, "message": "re PR ipa/58862 (LTO profiledbootstrap failure: lto1: ICE in edge_badness, at ipa-inline.c:1008)\n\n2013-10-29  Teresa Johnson  <tejohnson@google.com>\n\n\tPR ipa/58862\n\t* tree-ssa-tail-merge.c (replace_block_by): Tolerate profile\n\tinsanities when updating probabilities.\n\nFrom-SVN: r204178", "tree": {"sha": "cd09d98196fdcbec83ad291dd14cd15021fce136", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cd09d98196fdcbec83ad291dd14cd15021fce136"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6c00353648731a6f4dd6bb3e726f6ed1a75d701", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6c00353648731a6f4dd6bb3e726f6ed1a75d701", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6c00353648731a6f4dd6bb3e726f6ed1a75d701", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6c00353648731a6f4dd6bb3e726f6ed1a75d701/comments", "author": {"login": "teresajohnson", "id": 20446403, "node_id": "MDQ6VXNlcjIwNDQ2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/20446403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teresajohnson", "html_url": "https://github.com/teresajohnson", "followers_url": "https://api.github.com/users/teresajohnson/followers", "following_url": "https://api.github.com/users/teresajohnson/following{/other_user}", "gists_url": "https://api.github.com/users/teresajohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/teresajohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teresajohnson/subscriptions", "organizations_url": "https://api.github.com/users/teresajohnson/orgs", "repos_url": "https://api.github.com/users/teresajohnson/repos", "events_url": "https://api.github.com/users/teresajohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/teresajohnson/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "258125712b073aa7407e716f45524beed39ec840", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/258125712b073aa7407e716f45524beed39ec840", "html_url": "https://github.com/Rust-GCC/gccrs/commit/258125712b073aa7407e716f45524beed39ec840"}], "stats": {"total": 22, "additions": 17, "deletions": 5}, "files": [{"sha": "d7be352cb881773498bee4547a975d7392bf46f8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6c00353648731a6f4dd6bb3e726f6ed1a75d701/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6c00353648731a6f4dd6bb3e726f6ed1a75d701/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b6c00353648731a6f4dd6bb3e726f6ed1a75d701", "patch": "@@ -1,3 +1,9 @@\n+2013-10-29  Teresa Johnson  <tejohnson@google.com>\n+\n+\tPR ipa/58862\n+\t* tree-ssa-tail-merge.c (replace_block_by): Tolerate profile\n+\tinsanities when updating probabilities.\n+\n 2013-10-29  David Malcolm  <dmalcolm@redhat.com>\n \n \t* gdbhooks.py (CGraphNodePrinter.to_string): Update gdb"}, {"sha": "db95ce1059c16b660fd390d31324e70f32007c9f", "filename": "gcc/tree-ssa-tail-merge.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6c00353648731a6f4dd6bb3e726f6ed1a75d701/gcc%2Ftree-ssa-tail-merge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6c00353648731a6f4dd6bb3e726f6ed1a75d701/gcc%2Ftree-ssa-tail-merge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-tail-merge.c?ref=b6c00353648731a6f4dd6bb3e726f6ed1a75d701", "patch": "@@ -1467,7 +1467,7 @@ static void\n replace_block_by (basic_block bb1, basic_block bb2)\n {\n   edge pred_edge;\n-  edge e1;\n+  edge e1, e2;\n   edge_iterator ei;\n   unsigned int i;\n   gimple bb2_phi;\n@@ -1502,15 +1502,21 @@ replace_block_by (basic_block bb1, basic_block bb2)\n   bb2->count += bb1->count;\n \n   /* Merge the outgoing edge counts from bb1 onto bb2.  */\n+  gcov_type out_sum = 0;\n   FOR_EACH_EDGE (e1, ei, bb1->succs)\n     {\n-      edge e2;\n       e2 = find_edge (bb2, e1->dest);\n       gcc_assert (e2);\n       e2->count += e1->count;\n-      /* Recompute the probability from the new merged edge count (bb2->count\n-         was updated above).  */\n-      e2->probability = GCOV_COMPUTE_SCALE (e2->count, bb2->count);\n+      out_sum += e2->count;\n+    }\n+  /* Recompute the edge probabilities from the new merged edge count.\n+     Use the sum of the new merged edge counts computed above instead\n+     of bb2's merged count, in case there are profile count insanities\n+     making the bb count inconsistent with the edge weights.  */\n+  FOR_EACH_EDGE (e2, ei, bb2->succs)\n+    {\n+      e2->probability = GCOV_COMPUTE_SCALE (e2->count, out_sum);\n     }\n \n   /* Do updates that use bb1, before deleting bb1.  */"}]}