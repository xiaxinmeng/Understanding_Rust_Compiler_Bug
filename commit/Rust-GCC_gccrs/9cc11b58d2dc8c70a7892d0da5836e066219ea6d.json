{"sha": "9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNjMTFiNThkMmRjOGM3MGE3ODkyZDBkYTU4MzZlMDY2MjE5ZWE2ZA==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2007-12-07T14:37:36Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2007-12-07T14:37:36Z"}, "message": "sem_ch3.adb (Analyze_Object_Declaration): Signal an error when an access to constant is used to initialize an access value.\n\n    gcc/ada/\n\t* sem_ch3.adb (Analyze_Object_Declaration): Signal an error\n\twhen an access to constant is used to initialize an access\n\tvalue.\n\n    gcc/testsuite/\n\t* gnat.dg/specs/access_constant_decl.ads: New test.\n\nFrom-SVN: r130677", "tree": {"sha": "a36f694cec9ce46a29cc1dc0435422f8a015f6fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a36f694cec9ce46a29cc1dc0435422f8a015f6fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2eb160f205ce2a807ecdef95b2e88652a5e3f0ed"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "cd4e3a07d149b2ac263068a99bd59e73e8dc38ba", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "patch": "@@ -4,6 +4,10 @@\n \t* sem_ch6.adb (Process_Formals): Prevent an access type formal\n \tto be initialized with an access to constant object.\n \n+\t* sem_ch3.adb (Analyze_Object_Declaration): Signal an error\n+\twhen an access to constant is used to initialize an access\n+\tvalue.\n+\n 2007-12-07  Olivier Hainque  <hainque@adacore.com>\n \n \tPR ada/34173"}, {"sha": "c16b4066d84b105b4ab7e8015a92f6f63b9fe7d6", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "patch": "@@ -2364,6 +2364,20 @@ package body Sem_Ch3 is\n \n          Set_Is_True_Constant (Id, True);\n \n+         --  If the initialization expression is an access to constant,\n+         --  it cannot be used with an access type.\n+\n+         if Is_Access_Type (Etype (E))\n+           and then Is_Access_Constant (Etype (E))\n+           and then Is_Access_Type (T)\n+           and then not Is_Access_Constant (T)\n+         then\n+            Error_Msg_NE (\"object of type& cannot be initialized with \" &\n+                          \"an access-to-constant expression\",\n+                          E,\n+                          T);\n+         end if;\n+\n          --  If we are analyzing a constant declaration, set its completion\n          --  flag after analyzing the expression.\n "}, {"sha": "2dcabc16d61f76b8a6dbebd96ccb24b8cac0c825", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "patch": "@@ -3,6 +3,8 @@\n \tPR ada/15805\n \t* gnat.dg/specs/access_constants.ads: New test.\n \n+\t* gnat.dg/specs/access_constant_decl.ads: New test.\n+\n 2007-12-07  Olivier Hainque  <hainque@adacore.com>\n \n \tPR ada/34173"}, {"sha": "aec40e6db828a95ccb4cfadc6c69f95acb6058f9", "filename": "gcc/testsuite/gnat.dg/specs/access_constant_decl.ads", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Faccess_constant_decl.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9cc11b58d2dc8c70a7892d0da5836e066219ea6d/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Faccess_constant_decl.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Faccess_constant_decl.ads?ref=9cc11b58d2dc8c70a7892d0da5836e066219ea6d", "patch": "@@ -0,0 +1,11 @@\n+-- { dg-do compile }\n+package Access_Constant_Decl is\n+\n+   c: aliased constant integer := 3;\n+\n+   type const_ptr is access constant integer;\n+   cp : const_ptr := c'access;\n+\n+   x : access integer := cp; -- { dg-error \"access-to-constant\" }\n+\n+end Access_Constant_Decl;"}]}