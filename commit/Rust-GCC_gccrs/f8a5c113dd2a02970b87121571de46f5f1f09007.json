{"sha": "f8a5c113dd2a02970b87121571de46f5f1f09007", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjhhNWMxMTNkZDJhMDI5NzBiODcxMjE1NzFkZTQ2ZjVmMWYwOTAwNw==", "commit": {"author": {"name": "Stan Cox", "email": "coxs@gnu.org", "date": "1996-08-02T21:27:07Z"}, "committer": {"name": "Stan Cox", "email": "coxs@gnu.org", "date": "1996-08-02T21:27:07Z"}, "message": "Added TARGET_CMOVE check for fcomi.\n\n(sgt+1,slt+1,sge+1,sle+1,bgt+1,blt+1,bge+1,ble+1,bleu+4)\nAdded TARGET_CMOVE check for fcomi.\n(movsicc_1+1,movhicc_1+1): Added to handle the general case.\n\nFrom-SVN: r12583", "tree": {"sha": "84588f4249b3b72924bee9987cb1784f074649dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/84588f4249b3b72924bee9987cb1784f074649dc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f8a5c113dd2a02970b87121571de46f5f1f09007", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8a5c113dd2a02970b87121571de46f5f1f09007", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8a5c113dd2a02970b87121571de46f5f1f09007", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8a5c113dd2a02970b87121571de46f5f1f09007/comments", "author": null, "committer": null, "parents": [{"sha": "d773e0157583ea8026ad87d9f2c61508adb0ab37", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d773e0157583ea8026ad87d9f2c61508adb0ab37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d773e0157583ea8026ad87d9f2c61508adb0ab37"}], "stats": {"total": 82, "additions": 50, "deletions": 32}, "files": [{"sha": "e9cc5d5cbddbf5238df29901279abb294a92f09a", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 50, "deletions": 32, "changes": 82, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f8a5c113dd2a02970b87121571de46f5f1f09007/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f8a5c113dd2a02970b87121571de46f5f1f09007/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=f8a5c113dd2a02970b87121571de46f5f1f09007", "patch": "@@ -4960,7 +4960,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (sete,%0);\n \n   OUTPUT_JUMP (\\\"setg %0\\\", \\\"seta %0\\\", NULL_PTR);\n@@ -4992,7 +4992,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (sete,%0);\n \n   OUTPUT_JUMP (\\\"setl %0\\\", \\\"setb %0\\\", \\\"sets %0\\\");\n@@ -5024,7 +5024,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (sete,%0);\n \n   OUTPUT_JUMP (\\\"setge %0\\\", \\\"setae %0\\\", \\\"setns %0\\\");\n@@ -5056,7 +5056,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (setb,%0);\n \n   OUTPUT_JUMP (\\\"setle %0\\\", \\\"setbe %0\\\", NULL_PTR);\n@@ -5180,7 +5180,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (je,%l0);\n \n   if (cc_prev_status.flags & CC_TEST_AX)\n@@ -5231,7 +5231,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (je,%l0);\n \n   if (cc_prev_status.flags & CC_TEST_AX)\n@@ -5282,7 +5282,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (je,%l0);\n   if (cc_prev_status.flags & CC_TEST_AX)\n     {\n@@ -5332,7 +5332,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (jb,%l0);\n   if (cc_prev_status.flags & CC_TEST_AX)\n     {\n@@ -5419,7 +5419,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (jne,%l0);\n   if (cc_prev_status.flags & CC_TEST_AX)\n     {\n@@ -5449,7 +5449,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (jne,%l0);\n   if (cc_prev_status.flags & CC_TEST_AX)\n     {\n@@ -5480,7 +5480,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (jne,%l0);\n   if (cc_prev_status.flags & CC_TEST_AX)\n     {\n@@ -5510,7 +5510,7 @@\n   \"\"\n   \"*\n {\n-  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387))\n+  if (TARGET_IEEE_FP && (cc_prev_status.flags & CC_IN_80387) && !TARGET_CMOVE)\n     return AS1 (jae,%l0);\n \n   if (cc_prev_status.flags & CC_TEST_AX)\n@@ -6743,8 +6743,8 @@\n   [(match_dup 4)\n    (set (match_operand 0 \"register_operand\" \"\")\n \t(if_then_else:SI (match_operand 1 \"comparison_operator\" \"\")\n-\t\t\t (match_operand:SI 2 \"nonimmediate_operand\" \"\")\n-\t\t\t (match_operand:SI 3 \"nonimmediate_operand\" \"\")))]\n+\t\t\t (match_operand:SI 2 \"general_operand\" \"\")\n+\t\t\t (match_operand:SI 3 \"general_operand\" \"\")))]\n   \"TARGET_CMOVE\"\n   \"\n {\n@@ -6755,20 +6755,20 @@\n   [(match_dup 4)\n    (set (match_operand 0 \"register_operand\" \"\")\n \t(if_then_else:HI (match_operand 1 \"comparison_operator\" \"\")\n-\t\t\t (match_operand:HI 2 \"nonimmediate_operand\" \"\")\n-\t\t\t (match_operand:HI 3 \"nonimmediate_operand\" \"\")))]\n+\t\t\t (match_operand:HI 2 \"general_operand\" \"\")\n+\t\t\t (match_operand:HI 3 \"general_operand\" \"\")))]\n   \"TARGET_CMOVE\"\n   \"\n {\n   operands[4] = i386_compare_gen (i386_compare_op0, i386_compare_op1);\n }\")\n \n (define_insn \"movsicc_1\"\n-  [(set (match_operand:SI 0 \"register_operand\" \"=r,r,&r,&r\")\n+  [(set (match_operand:SI 0 \"register_operand\" \"=r,r,&r\")\n \t(if_then_else:SI (match_operator 1 \"comparison_operator\" \n \t\t\t\t[(cc0) (const_int 0)])\n-\t\t      (match_operand:SI 2 \"nonimmediate_operand\" \"rm,0,rm,g\")\n-\t\t      (match_operand:SI 3 \"nonimmediate_operand\" \"0,rm,rm,g\")))]\n+\t\t      (match_operand:SI 2 \"nonimmediate_operand\" \"rm,0,rm\")\n+\t\t      (match_operand:SI 3 \"nonimmediate_operand\" \"0,rm,rm\")))]\n   \"TARGET_CMOVE\"\n   \"*\n {\n@@ -6791,24 +6791,33 @@\n       output_asm_insn (AS2 (cmov%C1,%2,%0), operands);\n       output_asm_insn (AS2 (cmov%c1,%3,%0), operands);\n     }\n-  else \n-    {\n+  RET;\n+}\")\n+\n+(define_insn \"\"\n+  [(set (match_operand:SI 0 \"register_operand\" \"r\")\n+\t(if_then_else:SI (match_operator 1 \"comparison_operator\" \n+\t\t\t\t[(cc0) (const_int 0)])\n+\t\t      (match_operand:SI 2 \"general_operand\" \"\")\n+\t\t      (match_operand:SI 3 \"general_operand\" \"\")))]\n+  \"TARGET_CMOVE\"\n+  \"*\n+{\n       /* r <- cond ? arg1 : arg2 */\n       operands[4] = gen_label_rtx ();\n       output_asm_insn (AS2 (mov%L0,%2,%0), operands);\n       output_asm_insn (\\\"j%C1 %l4\\\", operands);\n       output_asm_insn (AS2 (mov%L0,%3,%0), operands);\n       ASM_OUTPUT_INTERNAL_LABEL (asm_out_file, \\\"L\\\", CODE_LABEL_NUMBER (operands[4]));\n-    }\n   RET;\n }\")\n \n (define_insn \"movhicc_1\"\n-  [(set (match_operand:HI 0 \"register_operand\" \"=r,r,&r,&r\")\n+  [(set (match_operand:HI 0 \"register_operand\" \"=r,r,&r\")\n \t(if_then_else:HI (match_operator 1 \"comparison_operator\" \n \t\t\t\t[(cc0) (const_int 0)])\n-\t\t      (match_operand:HI 2 \"nonimmediate_operand\" \"rm,0,rm,g\")\n-\t\t      (match_operand:HI 3 \"nonimmediate_operand\" \"0,rm,rm,g\")))]\n+\t\t      (match_operand:HI 2 \"nonimmediate_operand\" \"rm,0,rm\")\n+\t\t      (match_operand:HI 3 \"nonimmediate_operand\" \"0,rm,rm\")))]\n   \"TARGET_CMOVE\"\n   \"*\n {\n@@ -6831,15 +6840,24 @@\n       output_asm_insn (AS2 (cmov%C1,%2,%0), operands);\n       output_asm_insn (AS2 (cmov%c1,%3,%0), operands);\n     }\n-  else \n-    {\n+  RET;\n+}\")\n+\n+(define_insn \"\"\n+  [(set (match_operand:HI 0 \"register_operand\" \"r\")\n+\t(if_then_else:HI (match_operator 1 \"comparison_operator\" \n+\t\t\t\t[(cc0) (const_int 0)])\n+\t\t      (match_operand:HI 2 \"general_operand\" \"\")\n+\t\t      (match_operand:HI 3 \"general_operand\" \"\")))]\n+  \"TARGET_CMOVE\"\n+  \"*\n+{\n       /* r <- cond ? arg1 : arg2 */\n       operands[4] = gen_label_rtx ();\n       output_asm_insn (AS2 (mov%L0,%2,%0), operands);\n       output_asm_insn (\\\"j%C1 %l4\\\", operands);\n       output_asm_insn (AS2 (mov%L0,%3,%0), operands);\n       ASM_OUTPUT_INTERNAL_LABEL (asm_out_file, \\\"L\\\", CODE_LABEL_NUMBER (operands[4]));\n-    }\n   RET;\n }\")\n \n@@ -6913,12 +6931,12 @@\n   if (which_alternative == 0)\n     {\n       /* r <- cond ? arg : r */\n-      output_asm_insn (AS2 (fcmov%F1,%3,%0), operands);\n+      output_asm_insn (AS2 (fcmov%f1,%3,%0), operands);\n     }\n   else if (which_alternative == 1)\n     {\n       /* r <- cond ? r : arg */\n-      output_asm_insn (AS2 (fcmov%f1,%2,%0), operands);\n+      output_asm_insn (AS2 (fcmov%F1,%2,%0), operands);\n     }\n   RET;\n }\")\n@@ -6935,12 +6953,12 @@\n   if (which_alternative == 0)\n     {\n       /* r <- cond ? arg : r */\n-      output_asm_insn (AS2 (fcmov%F1,%3,%0), operands);\n+      output_asm_insn (AS2 (fcmov%f1,%3,%0), operands);\n     }\n   else if (which_alternative == 1)\n     {\n       /* r <- cond ? r : arg */\n-      output_asm_insn (AS2 (fcmov%f1,%2,%0), operands);\n+      output_asm_insn (AS2 (fcmov%F1,%2,%0), operands);\n     }\n   RET;\n }\")"}]}