{"sha": "1422dce0656c7e745454cf2cb7a72503351b5221", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQyMmRjZTA2NTZjN2U3NDU0NTRjZjJjYjdhNzI1MDMzNTFiNTIyMQ==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1992-10-08T08:42:53Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1992-10-08T08:42:53Z"}, "message": "(mark_target_live_regs): Look at USE insns made by update_block when scanning forward past target.\n\n(mark_target_live_regs): Look at USE insns made by update_block when scanning\nforward past target.\n(mark_target_live_regs, dbr_schedule): Use GET_RTX_CLASS.\n\nFrom-SVN: r2366", "tree": {"sha": "02ba44e8a6d3be496f1cb781ed198f549387669f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02ba44e8a6d3be496f1cb781ed198f549387669f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1422dce0656c7e745454cf2cb7a72503351b5221", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1422dce0656c7e745454cf2cb7a72503351b5221", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1422dce0656c7e745454cf2cb7a72503351b5221", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1422dce0656c7e745454cf2cb7a72503351b5221/comments", "author": null, "committer": null, "parents": [{"sha": "3f78332988a7f8beb96dee105a46828fbb7950fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f78332988a7f8beb96dee105a46828fbb7950fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f78332988a7f8beb96dee105a46828fbb7950fe"}], "stats": {"total": 34, "additions": 25, "deletions": 9}, "files": [{"sha": "869c79af7d40426a9f25dbccb0571d884bad4f66", "filename": "gcc/reorg.c", "status": "modified", "additions": 25, "deletions": 9, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1422dce0656c7e745454cf2cb7a72503351b5221/gcc%2Freorg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1422dce0656c7e745454cf2cb7a72503351b5221/gcc%2Freorg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freorg.c?ref=1422dce0656c7e745454cf2cb7a72503351b5221", "patch": "@@ -2051,9 +2051,7 @@ mark_target_live_regs (target, res)\n \t  /* If this insn is a USE made by update_block, we care about the\n \t     underlying insn.  */\n \t  if (GET_CODE (insn) == INSN && GET_CODE (PATTERN (insn)) == USE\n-\t      && (GET_CODE (XEXP (PATTERN (insn), 0)) == INSN\n-\t\t  || GET_CODE (XEXP (PATTERN (insn), 0)) == CALL_INSN\n-\t\t  || GET_CODE (XEXP (PATTERN (insn), 0)) == JUMP_INSN))\n+\t      && GET_RTX_CLASS (GET_CODE (XEXP (PATTERN (insn), 0))) == 'i')\n \t      real_insn = XEXP (PATTERN (insn), 0);\n \n \t  if (GET_CODE (real_insn) == CALL_INSN)\n@@ -2170,10 +2168,30 @@ mark_target_live_regs (target, res)\n \t  continue;\n \n \tcase INSN:\n-\t  if (GET_CODE (PATTERN (insn)) == USE\n-\t      || GET_CODE (PATTERN (insn)) == CLOBBER)\n+\t  if (GET_CODE (PATTERN (insn)) == USE)\n+\t    {\n+\t      /* If INSN is a USE made by update_block, we care about the\n+\t\t underlying insn.  Any registers set or referenced by the\n+\t\t underlying insn should be treated as if the insn were\n+\t\t located here without the USE.  */\n+\t      if (GET_RTX_CLASS (GET_CODE (XEXP (PATTERN (insn), 0))) == 'i')\n+\t\t{\n+\t\t  rtx inner = XEXP (PATTERN (insn), 0);\n+\n+\t\t  mark_referenced_resources (inner, &needed, 1);\n+\t\t  mark_set_resources (inner, &set, 0, 1);\n+\n+\t\t  COPY_HARD_REG_SET (scratch, set.regs);\n+\t\t  AND_COMPL_HARD_REG_SET (scratch, needed.regs);\n+\t\t  AND_COMPL_HARD_REG_SET (res->regs, scratch);\n+\t\t}\n+\n+\t      /* All other USE insns are to be ignored.  */\n+\t      continue;\n+\t    }\n+\t  else if (GET_CODE (PATTERN (insn)) == CLOBBER)\n \t    continue;\n-\t  if (GET_CODE (PATTERN (insn)) == SEQUENCE)\n+\t  else if (GET_CODE (PATTERN (insn)) == SEQUENCE)\n \t    {\n \t      /* An unconditional jump can be used to fill the delay slot\n \t\t of a call, so search for a JUMP_INSN in any position.  */\n@@ -3663,9 +3681,7 @@ dbr_schedule (first, file)\n       next = NEXT_INSN (insn);\n \n       if (GET_CODE (insn) == INSN && GET_CODE (PATTERN (insn)) == USE\n-\t  && (GET_CODE (XEXP (PATTERN (insn), 0)) == INSN\n-\t      || GET_CODE (XEXP (PATTERN (insn), 0)) == JUMP_INSN\n-\t      || GET_CODE (XEXP (PATTERN (insn), 0)) == CALL_INSN))\n+\t  && GET_RTX_CLASS (GET_CODE (XEXP (PATTERN (insn), 0))) == 'i')\n \tnext = delete_insn (insn);\n     }\n "}]}