{"sha": "c8e20bd09307de2a787351a88c93458b32d45363", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzhlMjBiZDA5MzA3ZGUyYTc4NzM1MWE4OGM5MzQ1OGIzMmQ0NTM2Mw==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobias.schlueter@physik.uni-muenchen.de", "date": "2004-05-15T20:29:06Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2004-05-15T20:29:06Z"}, "message": "re PR fortran/13742 (Not Implemented: initial values for COMMON or EQUIVALENCE)\n\nPR fortran/13742\n* decl.c (add_init_expr_to_sym): Verify that COMMON variable is\nnot initialized in a disallowed fashion.\n* match.c (gfc_match_common): Likewise.\n(var_element): Verify that variable is not in the blank COMMON,\nif it is in a common.\n\nFrom-SVN: r81899", "tree": {"sha": "29c7072477abd32069be234fddbeb7a4e4cdd0ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29c7072477abd32069be234fddbeb7a4e4cdd0ae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c8e20bd09307de2a787351a88c93458b32d45363", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8e20bd09307de2a787351a88c93458b32d45363", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8e20bd09307de2a787351a88c93458b32d45363", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8e20bd09307de2a787351a88c93458b32d45363/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3a906f0433a126420f5e98a1b9b9b53e60f361ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a906f0433a126420f5e98a1b9b9b53e60f361ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a906f0433a126420f5e98a1b9b9b53e60f361ef"}], "stats": {"total": 51, "additions": 48, "deletions": 3}, "files": [{"sha": "ee25a940b77b5d504235c0cba121dcea8d6eceb8", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8e20bd09307de2a787351a88c93458b32d45363/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8e20bd09307de2a787351a88c93458b32d45363/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=c8e20bd09307de2a787351a88c93458b32d45363", "patch": "@@ -1,3 +1,12 @@\n+2004-05-15  Tobias Schlueter <tobias.schlueter@physik.uni-muenchen.de>\n+\n+\tPR fortran/13742\n+\t* decl.c (add_init_expr_to_sym): Verify that COMMON variable is\n+\tnot initialized in a disallowed fashion.\n+\t* match.c (gfc_match_common): Likewise.\n+\t(var_element): Verify that variable is not in the blank COMMON,\n+\tif it is in a common. \n+\n 2004-05-15  Joseph S. Myers  <jsm@polyomino.org.uk>\n \n \t* Make-lang.in (f95.generated-manpages): Remove."}, {"sha": "ff87bee144aa429dc3f25fcf4ccf9a8a4db2cf2f", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8e20bd09307de2a787351a88c93458b32d45363/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8e20bd09307de2a787351a88c93458b32d45363/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=c8e20bd09307de2a787351a88c93458b32d45363", "patch": "@@ -276,6 +276,15 @@ add_init_expr_to_sym (const char *name, gfc_expr ** initp,\n       return FAILURE;\n     }\n \n+  if (attr.in_common\n+      && !attr.data\n+      && *initp != NULL)\n+    {\n+      gfc_error (\"Initializer not allowed for COMMON variable '%s' at %C\",\n+\t\t sym->name);\n+      return FAILURE;\n+    }\n+\n   if (init == NULL)\n     {\n       /* An initializer is required for PARAMETER declarations.  */"}, {"sha": "6c7251f05c0314aea9285f0d2004f2bb8024e52a", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 30, "deletions": 3, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8e20bd09307de2a787351a88c93458b32d45363/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8e20bd09307de2a787351a88c93458b32d45363/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=c8e20bd09307de2a787351a88c93458b32d45363", "patch": "@@ -2338,6 +2338,19 @@ gfc_match_common (void)\n \t      goto cleanup;\n \t    }\n \n+\t  if (sym->value != NULL\n+\t      && (common_name == NULL || !sym->attr.data))\n+\t    {\n+\t      if (common_name == NULL)\n+\t\tgfc_error (\"Previously initialized symbol '%s' in \"\n+\t\t\t   \"blank COMMON block at %C\", sym->name);\n+\t      else\n+\t\tgfc_error (\"Previously initialized symbol '%s' in \"\n+\t\t\t   \"COMMON block '%s' at %C\", sym->name,\n+\t\t\t   common_name->name);\n+\t      goto cleanup;\n+\t    }\n+\n \t  if (gfc_add_in_common (&sym->attr, NULL) == FAILURE)\n \t    goto cleanup;\n \n@@ -2814,6 +2827,7 @@ static match\n var_element (gfc_data_variable * new)\n {\n   match m;\n+  gfc_symbol *sym, *t;\n \n   memset (new, '\\0', sizeof (gfc_data_variable));\n \n@@ -2824,14 +2838,27 @@ var_element (gfc_data_variable * new)\n   if (m != MATCH_YES)\n     return m;\n \n-  if (new->expr->symtree->n.sym->value != NULL)\n+  sym = new->expr->symtree->n.sym;\n+\n+  if(sym->value != NULL)\n     {\n       gfc_error (\"Variable '%s' at %C already has an initialization\",\n-\t\t new->expr->symtree->n.sym->name);\n+\t\t sym->name);\n       return MATCH_ERROR;\n     }\n \n-  new->expr->symtree->n.sym->attr.data = 1;\n+  if (sym->attr.in_common)\n+    /* See if sym is in the blank common block.  */\n+    for (t = sym->ns->blank_common; t; t = t->common_next)\n+      if (sym == t)\n+\t{\n+\t  gfc_error (\"DATA statement at %C may not initialize variable \"\n+\t\t     \"'%s' from blank COMMON\", sym->name);\n+\t  return MATCH_ERROR;\n+\t}\n+\n+  sym->attr.data = 1;\n+\n   return MATCH_YES;\n }\n "}]}