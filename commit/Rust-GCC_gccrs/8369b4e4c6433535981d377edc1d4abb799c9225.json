{"sha": "8369b4e4c6433535981d377edc1d4abb799c9225", "node_id": "C_kwDOANBUbNoAKDgzNjliNGU0YzY0MzM1MzU5ODFkMzc3ZWRjMWQ0YWJiNzk5YzkyMjU", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-14T01:56:03Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-14T01:56:43Z"}, "message": "c++: alignment of local typedef in template [PR65211]\n\nBecause common_handle_aligned_attribute only applies the alignment to the\nTREE_TYPE of a typedef, not the DECL_ORIGINAL_TYPE, we need to copy it\nexplicitly in tsubst.\n\n\tPR c++/65211\n\ngcc/cp/ChangeLog:\n\n\t* pt.cc (tsubst_decl) [TYPE_DECL]: Copy TYPE_ALIGN.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.target/i386/vec-tmpl1.C: New test.", "tree": {"sha": "f8c984355172013ae244a8055c54f29bd5729df4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8c984355172013ae244a8055c54f29bd5729df4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8369b4e4c6433535981d377edc1d4abb799c9225", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8369b4e4c6433535981d377edc1d4abb799c9225", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8369b4e4c6433535981d377edc1d4abb799c9225", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8369b4e4c6433535981d377edc1d4abb799c9225/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1824da60663b4532199ecd051d8ba6da8995821d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1824da60663b4532199ecd051d8ba6da8995821d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1824da60663b4532199ecd051d8ba6da8995821d"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "dde62ee052daedaf1920187b2cbfc99467274d67", "filename": "gcc/cp/pt.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8369b4e4c6433535981d377edc1d4abb799c9225/gcc%2Fcp%2Fpt.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8369b4e4c6433535981d377edc1d4abb799c9225/gcc%2Fcp%2Fpt.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.cc?ref=8369b4e4c6433535981d377edc1d4abb799c9225", "patch": "@@ -15084,6 +15084,12 @@ tsubst_decl (tree t, tree args, tsubst_flags_t complain)\n \t  {\n \t    DECL_ORIGINAL_TYPE (r) = NULL_TREE;\n \t    set_underlying_type (r);\n+\n+\t    /* common_handle_aligned_attribute doesn't apply the alignment\n+\t       to DECL_ORIGINAL_TYPE.  */\n+\t    if (TYPE_USER_ALIGN (TREE_TYPE (t)))\n+\t      TREE_TYPE (r) = build_aligned_type (TREE_TYPE (r),\n+\t\t\t\t\t\t  TYPE_ALIGN (TREE_TYPE (t)));\n \t  }\n \n \tlayout_decl (r, 0);"}, {"sha": "d512072a2a2c40fa356f2d07cbe3888e914a94a7", "filename": "gcc/testsuite/g++.target/i386/vec-tmpl1.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8369b4e4c6433535981d377edc1d4abb799c9225/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fvec-tmpl1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8369b4e4c6433535981d377edc1d4abb799c9225/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fvec-tmpl1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.target%2Fi386%2Fvec-tmpl1.C?ref=8369b4e4c6433535981d377edc1d4abb799c9225", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/65211\n+// { dg-final { scan-assembler-not \"movdqa\" } }\n+\n+typedef unsigned v4ui __attribute__ ((vector_size(16), aligned (16)));\n+\n+template<int I>\n+static v4ui t1(unsigned *dest_data)\n+{\n+  typedef unsigned v4ui_1 __attribute__ ((vector_size (16), aligned (4)));\n+  return ((const v4ui_1*)dest_data)[0];\n+}\n+\n+v4ui f(unsigned int *array)\n+{\n+    return t1<1>(array+7);\n+}"}]}