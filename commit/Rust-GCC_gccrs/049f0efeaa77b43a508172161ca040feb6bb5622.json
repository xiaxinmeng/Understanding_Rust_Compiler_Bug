{"sha": "049f0efeaa77b43a508172161ca040feb6bb5622", "node_id": "C_kwDOANBUbNoAKDA0OWYwZWZlYWE3N2I0M2E1MDgxNzIxNjFjYTA0MGZlYjZiYjU2MjI", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-11-17T16:31:40Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-11-17T16:31:40Z"}, "message": "libcpp: Fix up handling of block comments in -fdirectives-only mode [PR103130]\n\nNormal preprocessing, -fdirectives-only preprocessing before the Nathan's\nrewrite, and all other compilers I've tried on godbolt treat even \\*/\nas end of a block comment, but the new -fdirectives-only handling doesn't.\n\n2021-11-17  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR preprocessor/103130\n\t* lex.c (cpp_directive_only_process): Treat even \\*/ as end of block\n\tcomment.\n\n\t* c-c++-common/cpp/dir-only-9.c: New test.", "tree": {"sha": "ede32552574c9f51489803abf5e0add7258ca92d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ede32552574c9f51489803abf5e0add7258ca92d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/049f0efeaa77b43a508172161ca040feb6bb5622", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/049f0efeaa77b43a508172161ca040feb6bb5622", "html_url": "https://github.com/Rust-GCC/gccrs/commit/049f0efeaa77b43a508172161ca040feb6bb5622", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/049f0efeaa77b43a508172161ca040feb6bb5622/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd159a4167ca19b5ff26e7156333c88e854943bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd159a4167ca19b5ff26e7156333c88e854943bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd159a4167ca19b5ff26e7156333c88e854943bf"}], "stats": {"total": 15, "additions": 14, "deletions": 1}, "files": [{"sha": "d11cd97cb718132f2f98756fc7dd015527a09aa2", "filename": "gcc/testsuite/c-c++-common/cpp/dir-only-9.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/049f0efeaa77b43a508172161ca040feb6bb5622/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fdir-only-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/049f0efeaa77b43a508172161ca040feb6bb5622/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fdir-only-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fdir-only-9.c?ref=049f0efeaa77b43a508172161ca040feb6bb5622", "patch": "@@ -0,0 +1,13 @@\n+/* PR preprocessor/103130 */\n+/* { dg-do preprocess } */\n+/* { dg-options -fdirectives-only } */\n+\n+/*\\\n+ * this is a comment\n+\\*/\n+\n+int\n+main ()\n+{\n+  return 0;\n+}"}, {"sha": "8188e33b07d3dfef97d085722d24d03947f94caa", "filename": "libcpp/lex.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/049f0efeaa77b43a508172161ca040feb6bb5622/libcpp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/049f0efeaa77b43a508172161ca040feb6bb5622/libcpp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Flex.c?ref=049f0efeaa77b43a508172161ca040feb6bb5622", "patch": "@@ -4891,7 +4891,7 @@ cpp_directive_only_process (cpp_reader *pfile,\n \t\t\tbreak;\n \n \t\t      case '*':\n-\t\t\tif (pos > peek && !esc)\n+\t\t\tif (pos > peek)\n \t\t\t  star = is_block;\n \t\t\tesc = false;\n \t\t\tbreak;"}]}