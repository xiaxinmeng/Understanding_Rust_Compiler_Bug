{"sha": "34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzRjNWMwZTE4Yzg2MTg1NmJlZjRiYjhjNDIwNGQ1ZGNmNGE5ZGQ0Zg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@dcc.unicamp.br", "date": "1999-08-01T00:14:32Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-08-01T00:14:32Z"}, "message": "configure.in: Check for struct hostent_data and need for -D_REENTRANT for gethostbyname_r...\n\n1999-07-31  Alexandre Oliva  <oliva@dcc.unicamp.br>\n\n\t* configure.in: Check for struct hostent_data and need for\n\t-D_REENTRANT for gethostbyname_r declaration.\n\t* java/net/natInetAddress.cc: Define _REENTRANT if needed.\n\t(lookup): Use hostent_data for fixed_buffer.\n\t* configure, include/config.h.in: Rebuilt.\n\nFrom-SVN: r28369", "tree": {"sha": "83d44668e24d60cd0ba72a110c5c6db1266ca3cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/83d44668e24d60cd0ba72a110c5c6db1266ca3cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/comments", "author": null, "committer": null, "parents": [{"sha": "5f67f48f90c767a2a8371bc4ddb5034a202e7488", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5f67f48f90c767a2a8371bc4ddb5034a202e7488", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5f67f48f90c767a2a8371bc4ddb5034a202e7488"}], "stats": {"total": 352, "additions": 268, "deletions": 84}, "files": [{"sha": "351fa4e136fcc6acb3e7cf443b6ba10c73511c55", "filename": "libjava/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "patch": "@@ -1,3 +1,11 @@\n+1999-07-31  Alexandre Oliva  <oliva@dcc.unicamp.br>\n+\n+\t* configure.in: Check for struct hostent_data and need for\n+\t-D_REENTRANT for gethostbyname_r declaration.\n+\t* java/net/natInetAddress.cc: Define _REENTRANT if needed.\n+\t(lookup): Use hostent_data for fixed_buffer.\n+\t* configure, include/config.h.in: Rebuilt.\n+\n 1999-07-31  Alexandre Oliva  <oliva@dcc.unicamp.br>\n \n \t* java/lang/natSystem.cc (arraycopy): Use bcopy if memmove is not"}, {"sha": "e0af1c841b58361dc048f5511eeec1846f3165c8", "filename": "libjava/configure", "status": "modified", "additions": 194, "deletions": 81, "changes": 275, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure?ref=34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "patch": "@@ -3477,6 +3477,119 @@ EOF\n fi\n rm -f conftest*\n \n+\n+     case \" $GCINCS \" in\n+     *\" -D_REENTRANT \"*) ;;\n+     *)\n+\t\techo $ac_n \"checking whether gethostbyname_r declaration requires -D_REENTRANT\"\"... $ac_c\" 1>&6\n+echo \"configure:3486: checking whether gethostbyname_r declaration requires -D_REENTRANT\" >&5\n+if eval \"test \\\"`echo '$''{'libjava_cv_gethostbyname_r_needs_reentrant'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+   \n+\t  ac_ext=C\n+# CXXFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n+ac_cpp='$CXXCPP $CPPFLAGS'\n+ac_compile='${CXX-g++} -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'\n+ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n+cross_compiling=$ac_cv_prog_cxx_cross\n+\n+\t  cat > conftest.$ac_ext <<EOF\n+#line 3499 \"configure\"\n+#include \"confdefs.h\"\n+#include <netdb.h>\n+int main() {\n+gethostbyname_r(\"\", 0, 0);\n+; return 0; }\n+EOF\n+if { (eval echo configure:3506: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  libjava_cv_gethostbyname_r_needs_reentrant=no\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  \t\tCPPFLAGS_SAVE=\"$CPPFLAGS\"\n+\t\tCPPFLAGS=\"$CPPFLAGS -D_REENTRANT\"\n+\t\tcat > conftest.$ac_ext <<EOF\n+#line 3516 \"configure\"\n+#include \"confdefs.h\"\n+#include <netdb.h>\n+int main() {\n+gethostbyname_r(\"\", 0, 0);\n+; return 0; }\n+EOF\n+if { (eval echo configure:3523: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  libjava_cv_gethostbyname_r_needs_reentrant=yes\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  libjava_cv_gethostbyname_r_needs_reentrant=fail\n+fi\n+rm -f conftest*\n+\t\tCPPFLAGS=\"$CPPFLAGS_SAVE\"\n+\t  \n+fi\n+rm -f conftest*\n+\t  ac_ext=c\n+# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'\n+ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'\n+cross_compiling=$ac_cv_prog_cc_cross\n+\n+\t\n+fi\n+\n+echo \"$ac_t\"\"$libjava_cv_gethostbyname_r_needs_reentrant\" 1>&6\n+\tif test \"x$libjava_cv_gethostbyname_r_needs_reentrant\" = xyes; then\n+\t  cat >> confdefs.h <<\\EOF\n+#define GETHOSTBYNAME_R_NEEDS_REENTRANT 1\n+EOF\n+\n+\tfi\n+     ;;\n+     esac\n+\n+     echo $ac_n \"checking for struct hostent_data\"\"... $ac_c\" 1>&6\n+echo \"configure:3558: checking for struct hostent_data\" >&5\n+if eval \"test \\\"`echo '$''{'libjava_cv_struct_hostent_data'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  \tcat > conftest.$ac_ext <<EOF\n+#line 3563 \"configure\"\n+#include \"confdefs.h\"\n+\n+#if GETHOSTBYNAME_R_NEEDS_REENTRANT && !defined(_REENTRANT)\n+# define _REENTRANT 1\n+#endif\n+#include <netdb.h>\n+int main() {\n+struct hostent_data data;\n+; return 0; }\n+EOF\n+if { (eval echo configure:3574: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+  rm -rf conftest*\n+  libjava_cv_struct_hostent_data=yes\n+else\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  libjava_cv_struct_hostent_data=no\n+fi\n+rm -f conftest*\n+fi\n+\n+echo \"$ac_t\"\"$libjava_cv_struct_hostent_data\" 1>&6\n+     if test \"x$libjava_cv_struct_hostent_data\" = xyes; then\n+       cat >> confdefs.h <<\\EOF\n+#define HAVE_STRUCT_HOSTENT_DATA 1\n+EOF\n+\n+     fi\n+   \n else\n   echo \"$ac_t\"\"no\" 1>&6\n fi\n@@ -3486,12 +3599,12 @@ done\n    for ac_func in gethostbyaddr_r\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3490: checking for $ac_func\" >&5\n+echo \"configure:3603: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3495 \"configure\"\n+#line 3608 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3514,7 +3627,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3518: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3631: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3541,7 +3654,7 @@ EOF\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      cat > conftest.$ac_ext <<EOF\n-#line 3545 \"configure\"\n+#line 3658 \"configure\"\n #include \"confdefs.h\"\n #include <netdb.h>\n EOF\n@@ -3565,12 +3678,12 @@ done\n    for ac_func in gethostname\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3569: checking for $ac_func\" >&5\n+echo \"configure:3682: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3574 \"configure\"\n+#line 3687 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3593,7 +3706,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3597: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3710: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3617,7 +3730,7 @@ EOF\n EOF\n \n      cat > conftest.$ac_ext <<EOF\n-#line 3621 \"configure\"\n+#line 3734 \"configure\"\n #include \"confdefs.h\"\n #include <unistd.h>\n EOF\n@@ -3644,12 +3757,12 @@ done\n    for ac_func in pthread_mutexattr_settype pthread_mutexattr_setkind_np sched_yield\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3648: checking for $ac_func\" >&5\n+echo \"configure:3761: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3653 \"configure\"\n+#line 3766 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3672,7 +3785,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3676: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3789: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3700,12 +3813,12 @@ done\n    for ac_func in sched_yield\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3704: checking for $ac_func\" >&5\n+echo \"configure:3817: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3709 \"configure\"\n+#line 3822 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3728,7 +3841,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3732: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3845: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3750,15 +3863,15 @@ EOF\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for sched_yield in -lposix4\"\"... $ac_c\" 1>&6\n-echo \"configure:3754: checking for sched_yield in -lposix4\" >&5\n+echo \"configure:3867: checking for sched_yield in -lposix4\" >&5\n ac_lib_var=`echo posix4'_'sched_yield | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lposix4  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 3762 \"configure\"\n+#line 3875 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -3769,7 +3882,7 @@ int main() {\n sched_yield()\n ; return 0; }\n EOF\n-if { (eval echo configure:3773: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3886: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -3804,12 +3917,12 @@ done\n    for ac_func in gettimeofday time ftime\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3808: checking for $ac_func\" >&5\n+echo \"configure:3921: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3813 \"configure\"\n+#line 3926 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3832,7 +3945,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3836: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:3949: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3863,12 +3976,12 @@ done\n    for ac_func in memmove\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3867: checking for $ac_func\" >&5\n+echo \"configure:3980: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3872 \"configure\"\n+#line 3985 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3891,7 +4004,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3895: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4008: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3921,12 +4034,12 @@ done\n    for ac_func in memcpy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:3925: checking for $ac_func\" >&5\n+echo \"configure:4038: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 3930 \"configure\"\n+#line 4043 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -3949,7 +4062,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:3953: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4066: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -3997,20 +4110,20 @@ done\n    #--------------------------------------------------------------------\n \n    echo $ac_n \"checking for socket libraries\"\"... $ac_c\" 1>&6\n-echo \"configure:4001: checking for socket libraries\" >&5\n+echo \"configure:4114: checking for socket libraries\" >&5\n if eval \"test \\\"`echo '$''{'gcj_cv_lib_sockets'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   gcj_cv_lib_sockets=\n      gcj_checkBoth=0\n      unset ac_cv_func_connect\n      echo $ac_n \"checking for connect\"\"... $ac_c\" 1>&6\n-echo \"configure:4009: checking for connect\" >&5\n+echo \"configure:4122: checking for connect\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_connect'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4014 \"configure\"\n+#line 4127 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char connect(); below.  */\n@@ -4033,7 +4146,7 @@ connect();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4037: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4150: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_connect=yes\"\n else\n@@ -4056,22 +4169,22 @@ fi\n      if test \"$gcj_checkSocket\" = 1; then\n \t unset ac_cv_func_connect\n \t echo $ac_n \"checking for main in -lsocket\"\"... $ac_c\" 1>&6\n-echo \"configure:4060: checking for main in -lsocket\" >&5\n+echo \"configure:4173: checking for main in -lsocket\" >&5\n ac_lib_var=`echo socket'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lsocket  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4068 \"configure\"\n+#line 4181 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4075: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4188: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4098,12 +4211,12 @@ fi\n \t LIBS=\"$LIBS -lsocket -lnsl\"\n \t unset ac_cv_func_accept\n \t echo $ac_n \"checking for accept\"\"... $ac_c\" 1>&6\n-echo \"configure:4102: checking for accept\" >&5\n+echo \"configure:4215: checking for accept\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_accept'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4107 \"configure\"\n+#line 4220 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char accept(); below.  */\n@@ -4126,7 +4239,7 @@ accept();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4130: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4243: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_accept=yes\"\n else\n@@ -4153,12 +4266,12 @@ fi\n      gcj_oldLibs=$LIBS\n      LIBS=\"$LIBS $gcj_cv_lib_sockets\"\n      echo $ac_n \"checking for gethostbyname\"\"... $ac_c\" 1>&6\n-echo \"configure:4157: checking for gethostbyname\" >&5\n+echo \"configure:4270: checking for gethostbyname\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4162 \"configure\"\n+#line 4275 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char gethostbyname(); below.  */\n@@ -4181,7 +4294,7 @@ gethostbyname();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4185: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4298: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_gethostbyname=yes\"\n else\n@@ -4199,22 +4312,22 @@ if eval \"test \\\"`echo '$ac_cv_func_'gethostbyname`\\\" = yes\"; then\n else\n   echo \"$ac_t\"\"no\" 1>&6\n echo $ac_n \"checking for main in -lnsl\"\"... $ac_c\" 1>&6\n-echo \"configure:4203: checking for main in -lnsl\" >&5\n+echo \"configure:4316: checking for main in -lnsl\" >&5\n ac_lib_var=`echo nsl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lnsl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4211 \"configure\"\n+#line 4324 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4218: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4331: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4246,15 +4359,15 @@ echo \"$ac_t\"\"$gcj_cv_lib_sockets\" 1>&6\n \n    if test \"$with_system_zlib\" = yes; then\n       echo $ac_n \"checking for deflate in -lz\"\"... $ac_c\" 1>&6\n-echo \"configure:4250: checking for deflate in -lz\" >&5\n+echo \"configure:4363: checking for deflate in -lz\" >&5\n ac_lib_var=`echo z'_'deflate | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-lz  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4258 \"configure\"\n+#line 4371 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -4265,7 +4378,7 @@ int main() {\n deflate()\n ; return 0; }\n EOF\n-if { (eval echo configure:4269: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4382: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4294,22 +4407,22 @@ fi\n    # requires -ldl.\n    if test \"$GC\" = boehm; then\n       echo $ac_n \"checking for main in -ldl\"\"... $ac_c\" 1>&6\n-echo \"configure:4298: checking for main in -ldl\" >&5\n+echo \"configure:4411: checking for main in -ldl\" >&5\n ac_lib_var=`echo dl'_'main | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-ldl  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 4306 \"configure\"\n+#line 4419 \"configure\"\n #include \"confdefs.h\"\n \n int main() {\n main()\n ; return 0; }\n EOF\n-if { (eval echo configure:4313: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4426: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -4418,17 +4531,17 @@ for ac_hdr in unistd.h sys/time.h sys/types.h fcntl.h sys/ioctl.h sys/filio.h sy\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:4422: checking for $ac_hdr\" >&5\n+echo \"configure:4535: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4427 \"configure\"\n+#line 4540 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4432: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4545: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4458,17 +4571,17 @@ for ac_hdr in dirent.h\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:4462: checking for $ac_hdr\" >&5\n+echo \"configure:4575: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4467 \"configure\"\n+#line 4580 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:4472: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:4585: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out | grep -v \"^conftest.${ac_ext}\\$\"`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -4496,16 +4609,16 @@ done\n \n \n echo $ac_n \"checking whether struct sockaddr_in6 is in netinet/in.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4500: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n+echo \"configure:4613: checking whether struct sockaddr_in6 is in netinet/in.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4502 \"configure\"\n+#line 4615 \"configure\"\n #include \"confdefs.h\"\n #include <netinet/in.h>\n int main() {\n struct sockaddr_in6 addr6;\n ; return 0; }\n EOF\n-if { (eval echo configure:4509: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4622: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_INET6 1\n@@ -4521,16 +4634,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for socklen_t in sys/socket.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4525: checking for socklen_t in sys/socket.h\" >&5\n+echo \"configure:4638: checking for socklen_t in sys/socket.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4527 \"configure\"\n+#line 4640 \"configure\"\n #include \"confdefs.h\"\n #include <sys/socket.h>\n int main() {\n socklen_t x = 5;\n ; return 0; }\n EOF\n-if { (eval echo configure:4534: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4647: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_SOCKLEN_T 1\n@@ -4546,16 +4659,16 @@ fi\n rm -f conftest*\n \n echo $ac_n \"checking for tm_gmtoff in struct tm\"\"... $ac_c\" 1>&6\n-echo \"configure:4550: checking for tm_gmtoff in struct tm\" >&5\n+echo \"configure:4663: checking for tm_gmtoff in struct tm\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 4552 \"configure\"\n+#line 4665 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n struct tm tim; tim.tm_gmtoff = 0;\n ; return 0; }\n EOF\n-if { (eval echo configure:4559: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4672: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define STRUCT_TM_HAS_GMTOFF 1\n@@ -4568,16 +4681,16 @@ else\n   rm -rf conftest*\n   echo \"$ac_t\"\"no\" 1>&6\n    echo $ac_n \"checking for global timezone variable\"\"... $ac_c\" 1>&6\n-echo \"configure:4572: checking for global timezone variable\" >&5\n+echo \"configure:4685: checking for global timezone variable\" >&5\n             cat > conftest.$ac_ext <<EOF\n-#line 4574 \"configure\"\n+#line 4687 \"configure\"\n #include \"confdefs.h\"\n #include <time.h>\n int main() {\n long z2 = timezone;\n ; return 0; }\n EOF\n-if { (eval echo configure:4581: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:4694: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<\\EOF\n #define HAVE_TIMEZONE 1\n@@ -4597,19 +4710,19 @@ rm -f conftest*\n # The Ultrix 4.2 mips builtin alloca declared by alloca.h only works\n # for constant arguments.  Useless!\n echo $ac_n \"checking for working alloca.h\"\"... $ac_c\" 1>&6\n-echo \"configure:4601: checking for working alloca.h\" >&5\n+echo \"configure:4714: checking for working alloca.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_alloca_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4606 \"configure\"\n+#line 4719 \"configure\"\n #include \"confdefs.h\"\n #include <alloca.h>\n int main() {\n char *p = alloca(2 * sizeof(int));\n ; return 0; }\n EOF\n-if { (eval echo configure:4613: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4726: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_header_alloca_h=yes\n else\n@@ -4630,12 +4743,12 @@ EOF\n fi\n \n echo $ac_n \"checking for alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:4634: checking for alloca\" >&5\n+echo \"configure:4747: checking for alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_alloca_works'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4639 \"configure\"\n+#line 4752 \"configure\"\n #include \"confdefs.h\"\n \n #ifdef __GNUC__\n@@ -4663,7 +4776,7 @@ int main() {\n char *p = (char *) alloca(1);\n ; return 0; }\n EOF\n-if { (eval echo configure:4667: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4780: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   ac_cv_func_alloca_works=yes\n else\n@@ -4695,12 +4808,12 @@ EOF\n \n \n echo $ac_n \"checking whether alloca needs Cray hooks\"\"... $ac_c\" 1>&6\n-echo \"configure:4699: checking whether alloca needs Cray hooks\" >&5\n+echo \"configure:4812: checking whether alloca needs Cray hooks\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_os_cray'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4704 \"configure\"\n+#line 4817 \"configure\"\n #include \"confdefs.h\"\n #if defined(CRAY) && ! defined(CRAY2)\n webecray\n@@ -4725,12 +4838,12 @@ echo \"$ac_t\"\"$ac_cv_os_cray\" 1>&6\n if test $ac_cv_os_cray = yes; then\n for ac_func in _getb67 GETB67 getb67; do\n   echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:4729: checking for $ac_func\" >&5\n+echo \"configure:4842: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4734 \"configure\"\n+#line 4847 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -4753,7 +4866,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:4757: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:4870: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -4780,15 +4893,15 @@ done\n fi\n \n echo $ac_n \"checking stack direction for C alloca\"\"... $ac_c\" 1>&6\n-echo \"configure:4784: checking stack direction for C alloca\" >&5\n+echo \"configure:4897: checking stack direction for C alloca\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_c_stack_direction'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   if test \"$cross_compiling\" = yes; then\n   ac_cv_c_stack_direction=0\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 4792 \"configure\"\n+#line 4905 \"configure\"\n #include \"confdefs.h\"\n find_stack_direction ()\n {\n@@ -4807,7 +4920,7 @@ main ()\n   exit (find_stack_direction() < 0);\n }\n EOF\n-if { (eval echo configure:4811: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:4924: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null\n then\n   ac_cv_c_stack_direction=1\n else\n@@ -4834,7 +4947,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4838: checking for $ac_word\" >&5\n+echo \"configure:4951: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_PERL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else"}, {"sha": "0d62de63926dfc1c20601181dc5801f80656b5d7", "filename": "libjava/configure.in", "status": "modified", "additions": 42, "deletions": 1, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.in?ref=34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "patch": "@@ -309,7 +309,48 @@ else\n      # We look for the one that returns `int'.\n      # Hopefully this check is robust enough.\n      AC_EGREP_HEADER(int.*gethostbyname_r, netdb.h, [\n-       AC_DEFINE(GETHOSTBYNAME_R_RETURNS_INT)])])\n+       AC_DEFINE(GETHOSTBYNAME_R_RETURNS_INT)])\n+\n+     case \" $GCINCS \" in\n+     *\" -D_REENTRANT \"*) ;;\n+     *)\n+\tdnl On DU4.0, gethostbyname_r is only declared with -D_REENTRANT\n+\tAC_CACHE_CHECK([whether gethostbyname_r declaration requires -D_REENTRANT],\n+\t[libjava_cv_gethostbyname_r_needs_reentrant],\n+\t[ AC_LANG_SAVE\n+\t  AC_LANG_CPLUSPLUS\n+\t  AC_TRY_COMPILE([#include <netdb.h>],\n+\t    [gethostbyname_r(\"\", 0, 0);],\n+\t    [libjava_cv_gethostbyname_r_needs_reentrant=no], [dnl\n+\t\tCPPFLAGS_SAVE=\"$CPPFLAGS\"\n+\t\tCPPFLAGS=\"$CPPFLAGS -D_REENTRANT\"\n+\t\tAC_TRY_COMPILE([#include <netdb.h>], [gethostbyname_r(\"\", 0, 0);],\n+\t\t    [libjava_cv_gethostbyname_r_needs_reentrant=yes],\n+\t\t    [libjava_cv_gethostbyname_r_needs_reentrant=fail])\n+\t\tCPPFLAGS=\"$CPPFLAGS_SAVE\"\n+\t  ])\n+\t  AC_LANG_RESTORE\n+\t])\n+\tif test \"x$libjava_cv_gethostbyname_r_needs_reentrant\" = xyes; then\n+\t  AC_DEFINE(GETHOSTBYNAME_R_NEEDS_REENTRANT, 1, [Define if gethostbyname_r is only declared if _REENTRANT is defined])\n+\tfi\n+     ;;\n+     esac\n+\n+     AC_CACHE_CHECK([for struct hostent_data],\n+\t[libjava_cv_struct_hostent_data], [dnl\n+\tAC_TRY_COMPILE([\n+#if GETHOSTBYNAME_R_NEEDS_REENTRANT && !defined(_REENTRANT)\n+# define _REENTRANT 1\n+#endif\n+#include <netdb.h>], [struct hostent_data data;],\n+\t  [libjava_cv_struct_hostent_data=yes],\n+\t  [libjava_cv_struct_hostent_data=no])])\n+     if test \"x$libjava_cv_struct_hostent_data\" = xyes; then\n+       AC_DEFINE(HAVE_STRUCT_HOSTENT_DATA, 1,\n+         [Define if struct hostent_data is defined in netdb.h])\n+     fi\n+   ])\n \n    AC_CHECK_FUNCS(gethostbyaddr_r, [\n      AC_DEFINE(HAVE_GETHOSTBYADDR_R)"}, {"sha": "bd43c75905b09827802744100ad96d4e7620adc7", "filename": "libjava/include/config.h.in", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Finclude%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Finclude%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fconfig.h.in?ref=34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "patch": "@@ -268,3 +268,9 @@\n /* Version number of package */\n #undef VERSION\n \n+/* Define if gethostbyname_r is only declared if _REENTRANT is defined */\n+#undef GETHOSTBYNAME_R_NEEDS_REENTRANT\n+\n+/* Define if struct hostent_data is defined in netdb.h */\n+#undef HAVE_STRUCT_HOSTENT_DATA\n+"}, {"sha": "b15590a0ebc70cb6d8908efd3f8f2b99a56ddbc5", "filename": "libjava/java/net/natInetAddress.cc", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Fjava%2Fnet%2FnatInetAddress.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f/libjava%2Fjava%2Fnet%2FnatInetAddress.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fnet%2FnatInetAddress.cc?ref=34c5c0e18c861856bef4bb8c4204d5dcf4a9dd4f", "patch": "@@ -10,6 +10,10 @@ details.  */\n \n #include <config.h>\n \n+#if GETHOSTBYNAME_R_NEEDS_REENTRANT && !defined(_REENTRANT)\n+# define _REENTRANT 1\n+#endif\n+\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n@@ -97,6 +101,9 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n   struct hostent *hptr = NULL;\n #if defined (HAVE_GETHOSTBYNAME_R) || defined (HAVE_GETHOSTBYADDR_R)\n   struct hostent hent_r;\n+#if HAVE_STRUCT_HOSTENT_DATA\n+  struct hostent_data fixed_buffer, *buffer_r = &fixed_buffer;\n+#else\n #if defined (__GLIBC__) \n   // FIXME: in glibc, gethostbyname_r returns NETDB_INTERNAL to herr and\n   // ERANGE to errno if the buffer size is too small, rather than what is \n@@ -108,6 +115,7 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n #endif\n   char *buffer_r = fixed_buffer;\n   int size_r = sizeof (fixed_buffer);\n+#endif\n #endif\n \n   if (host != NULL)\n@@ -122,10 +130,13 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n       JvGetStringUTFRegion (host, 0, host->length(), hostname);\n       buf[len] = '\\0';\n #ifdef HAVE_GETHOSTBYNAME_R\n-      int herr = 0;\n       while (true)\n \t{\n \t  int ok;\n+#if HAVE_STRUCT_HOSTENT_DATA\n+\t  ok = ! gethostbyname_r (hostname, &hent_r, buffer_r);\n+#else\n+\t  int herr = 0;\n #ifdef GETHOSTBYNAME_R_RETURNS_INT\n \t  ok = ! gethostbyname_r (hostname, &hent_r, buffer_r, size_r,\n \t\t\t\t  &hptr, &herr);\n@@ -139,6 +150,7 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n \t      buffer_r = (char *) _Jv_AllocBytesChecked (size_r);\n \t    }\n \t  else\n+#endif /* HAVE_STRUCT_HOSTENT_DATA */\n \t    break;\n \t}\n #else\n@@ -171,10 +183,13 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n \tJvFail (\"unrecognized size\");\n \n #ifdef HAVE_GETHOSTBYADDR_R\n-      int herr = 0;\n       while (true)\n \t{\n \t  int ok;\n+#if HAVE_STRUCT_HOSTENT_DATA\n+\t  ok = ! gethostbyaddr_r (val, len, type, &hent_r, buffer_r);\n+#else\n+\t  int herr = 0;\n #ifdef GETHOSTBYADDR_R_RETURNS_INT\n \t  ok = ! gethostbyaddr_r (val, len, type, &hent_r,\n \t\t\t\t  buffer_r, size_r, &hptr, &herr);\n@@ -189,6 +204,7 @@ java::net::InetAddress::lookup (jstring host, java::net::InetAddress* iaddr,\n \t      buffer_r = (char *) _Jv_AllocBytesChecked (size_r);\n \t    }\n \t  else \n+#endif /* HAVE_STRUCT_HOSTENT_DATA */\n \t    break;\n \t}\n #else /* HAVE_GETHOSTBYADDR_R */"}]}