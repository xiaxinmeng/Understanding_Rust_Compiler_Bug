{"sha": "063c8f4c01bc1a5e6960c8624077df7137dc5dad", "node_id": "C_kwDOANBUbNoAKDA2M2M4ZjRjMDFiYzFhNWU2OTYwYzg2MjQwNzdkZjcxMzdkYzVkYWQ", "commit": {"author": {"name": "Steve Baird", "email": "baird@adacore.com", "date": "2022-05-24T23:03:58Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-07-04T07:45:54Z"}, "message": "[Ada] Compiler rejects legal allocator in record component constraint expression\n\nIn some cases when a legal allocator which defines a new subtype for the\nallocated object occurs as part of a record component constraint\nexpression, the compiler would incorrectly reject the allocator.\n\ngcc/ada/\n\n\t* sem_ch4.adb (Analyze_Allocator): After calling Insert_Action\n\tto insert a subtype declaration associated with an allocator,\n\tthe subtype declaration will usually be analyzed. But not\n\talways. Add an explicit call to Preanalyze to cope with the\n\tunusual case. The subtype declaration must be at least\n\tpreanalyzed before the call to Sem_Ch3.Process_Subtype a little\n\twhile later, during which we analyze an identifier that refers\n\tto the subtype.", "tree": {"sha": "543c17e33905d5c5a3bb934dab64c17093adc330", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/543c17e33905d5c5a3bb934dab64c17093adc330"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/063c8f4c01bc1a5e6960c8624077df7137dc5dad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/063c8f4c01bc1a5e6960c8624077df7137dc5dad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/063c8f4c01bc1a5e6960c8624077df7137dc5dad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/063c8f4c01bc1a5e6960c8624077df7137dc5dad/comments", "author": {"login": "swbaird", "id": 50751052, "node_id": "MDQ6VXNlcjUwNzUxMDUy", "avatar_url": "https://avatars.githubusercontent.com/u/50751052?v=4", "gravatar_id": "", "url": "https://api.github.com/users/swbaird", "html_url": "https://github.com/swbaird", "followers_url": "https://api.github.com/users/swbaird/followers", "following_url": "https://api.github.com/users/swbaird/following{/other_user}", "gists_url": "https://api.github.com/users/swbaird/gists{/gist_id}", "starred_url": "https://api.github.com/users/swbaird/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/swbaird/subscriptions", "organizations_url": "https://api.github.com/users/swbaird/orgs", "repos_url": "https://api.github.com/users/swbaird/repos", "events_url": "https://api.github.com/users/swbaird/events{/privacy}", "received_events_url": "https://api.github.com/users/swbaird/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7c05e82037356ac4610e9e5d1365b345a17d0f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7c05e82037356ac4610e9e5d1365b345a17d0f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7c05e82037356ac4610e9e5d1365b345a17d0f7"}], "stats": {"total": 17, "additions": 13, "deletions": 4}, "files": [{"sha": "4bc3696f673d2a479a4e222ec132e3e4debe9c69", "filename": "gcc/ada/sem_ch4.adb", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/063c8f4c01bc1a5e6960c8624077df7137dc5dad/gcc%2Fada%2Fsem_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/063c8f4c01bc1a5e6960c8624077df7137dc5dad/gcc%2Fada%2Fsem_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch4.adb?ref=063c8f4c01bc1a5e6960c8624077df7137dc5dad", "patch": "@@ -670,10 +670,19 @@ package body Sem_Ch4 is\n                then\n                   Def_Id := Make_Temporary (Loc, 'S');\n \n-                  Insert_Action (E,\n-                    Make_Subtype_Declaration (Loc,\n-                      Defining_Identifier => Def_Id,\n-                      Subtype_Indication  => Relocate_Node (E)));\n+                  declare\n+                     Subtype_Decl : constant Node_Id :=\n+                       Make_Subtype_Declaration (Loc,\n+                         Defining_Identifier => Def_Id,\n+                         Subtype_Indication  => Relocate_Node (E));\n+                  begin\n+                     Insert_Action (E, Subtype_Decl);\n+\n+                     --  Handle unusual case where Insert_Action does not\n+                     --  analyze the declaration. Subtype_Decl must be\n+                     --  preanalyzed before call to Process_Subtype below.\n+                     Preanalyze (Subtype_Decl);\n+                  end;\n \n                   if Sav_Errs /= Serious_Errors_Detected\n                     and then Nkind (Constraint (E)) ="}]}