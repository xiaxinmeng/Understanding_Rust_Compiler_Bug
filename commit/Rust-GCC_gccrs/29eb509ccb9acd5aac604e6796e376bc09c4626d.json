{"sha": "29eb509ccb9acd5aac604e6796e376bc09c4626d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjllYjUwOWNjYjlhY2Q1YWFjNjA0ZTY3OTZlMzc2YmMwOWM0NjI2ZA==", "commit": {"author": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-07-15T09:28:47Z"}, "committer": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-07-15T09:28:47Z"}, "message": "re PR fortran/71807 (Internal compiler error with NULL() reference in structure constructor)\n\ngcc/fortran/ChangeLog:\n\n2016-07-15  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/71807\n\t* trans-expr.c (gfc_trans_subcomponent_assign): Special casing\n\twhen allocatable component is set to null() in initializer.\n\ngcc/testsuite/ChangeLog:\n\n2016-07-15  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\tPR fortran/71807\n\t* gfortran.dg/null_9.f90: New test.\n\nFrom-SVN: r238368", "tree": {"sha": "cb05c4e1d65c3529218ea419f580af1e8a5238b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cb05c4e1d65c3529218ea419f580af1e8a5238b9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29eb509ccb9acd5aac604e6796e376bc09c4626d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29eb509ccb9acd5aac604e6796e376bc09c4626d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29eb509ccb9acd5aac604e6796e376bc09c4626d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29eb509ccb9acd5aac604e6796e376bc09c4626d/comments", "author": null, "committer": null, "parents": [{"sha": "43aabfcfd4139e4c9e7b868199e09b97e66010bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43aabfcfd4139e4c9e7b868199e09b97e66010bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/43aabfcfd4139e4c9e7b868199e09b97e66010bc"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "22ca4f4e48897f4f751163e121ef629da05791f4", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=29eb509ccb9acd5aac604e6796e376bc09c4626d", "patch": "@@ -1,3 +1,9 @@\n+2016-07-15  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/71807\n+\t* trans-expr.c (gfc_trans_subcomponent_assign): Special casing\n+\twhen allocatable component is set to null() in initializer.\n+\n 2016-07-14  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/29819"}, {"sha": "e3559f4e00e8f22effde9d16438acff3205e288c", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=29eb509ccb9acd5aac604e6796e376bc09c4626d", "patch": "@@ -7200,6 +7200,12 @@ gfc_trans_subcomponent_assign (tree dest, gfc_component * cm, gfc_expr * expr,\n       tmp = gfc_trans_alloc_subarray_assign (tmp, cm, expr);\n       gfc_add_expr_to_block (&block, tmp);\n     }\n+  else if (init && cm->attr.allocatable && expr->expr_type == EXPR_NULL)\n+    {\n+      /* NULL initialization for allocatable components.  */\n+      gfc_add_modify (&block, dest, fold_convert (TREE_TYPE (dest),\n+\t\t\t\t\t\t  null_pointer_node));\n+    }\n   else if (init && (cm->attr.allocatable\n \t   || (cm->ts.type == BT_CLASS && CLASS_DATA (cm)->attr.allocatable\n \t       && expr->ts.type != BT_CLASS)))"}, {"sha": "5ad50f944d8808d5f1e47100aea3f0e6c36b16b3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=29eb509ccb9acd5aac604e6796e376bc09c4626d", "patch": "@@ -1,3 +1,8 @@\n+2016-07-15  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tPR fortran/71807\n+\t* gfortran.dg/null_9.f90: New test.\n+\n 2016-07-15  Bin Cheng  <bin.cheng@arm.com>\n \n \t* gcc.dg/tree-ssa/loop-41.c: New test."}, {"sha": "9afd93801ccedcde0e64d9120e8a31f91fad4199", "filename": "gcc/testsuite/gfortran.dg/null_9.f90", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ftestsuite%2Fgfortran.dg%2Fnull_9.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29eb509ccb9acd5aac604e6796e376bc09c4626d/gcc%2Ftestsuite%2Fgfortran.dg%2Fnull_9.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fnull_9.f90?ref=29eb509ccb9acd5aac604e6796e376bc09c4626d", "patch": "@@ -0,0 +1,30 @@\n+! { dg-do run }\n+\n+MODULE fold_convert_loc_ice\n+  IMPLICIT NONE\n+  PRIVATE\n+\n+  TYPE, PUBLIC :: ta\n+    PRIVATE\n+    INTEGER :: a_comp\n+  END TYPE ta\n+\n+  TYPE, PUBLIC :: tb\n+    TYPE(ta), ALLOCATABLE :: b_comp\n+  END TYPE tb\n+\n+  PUBLIC :: proc\n+CONTAINS\n+  SUBROUTINE proc\n+    TYPE(tb) :: b\n+\n+    b = tb(null())\n+    if (allocated( b%b_comp )) call abort()\n+  END SUBROUTINE proc\n+END MODULE fold_convert_loc_ice\n+\n+  USE fold_convert_loc_ice\n+\n+  call proc()\n+END\n+"}]}