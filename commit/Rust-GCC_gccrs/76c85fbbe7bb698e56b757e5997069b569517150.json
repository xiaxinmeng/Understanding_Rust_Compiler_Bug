{"sha": "76c85fbbe7bb698e56b757e5997069b569517150", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzZjODVmYmJlN2JiNjk4ZTU2Yjc1N2U1OTk3MDY5YjU2OTUxNzE1MA==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-02-05T14:36:44Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2016-02-05T14:36:44Z"}, "message": "Fix PR c++/68948 (wrong code generation due to invalid constructor call)\n\ngcc/cp/ChangeLog:\n\n\tPR c++/68948\n\t* pt.c (tsubst_baselink): Diagnose an invalid constructor call\n\tif lookup_fnfields returns NULL_TREE and the name being looked\n\tup has the form A::A.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/68948\n\t* g++.dg/template/pr68948.C: New test.\n\nFrom-SVN: r233176", "tree": {"sha": "0181155bb6cece13a7eb6076ea743a1511e1350b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0181155bb6cece13a7eb6076ea743a1511e1350b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/76c85fbbe7bb698e56b757e5997069b569517150", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76c85fbbe7bb698e56b757e5997069b569517150", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76c85fbbe7bb698e56b757e5997069b569517150", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76c85fbbe7bb698e56b757e5997069b569517150/comments", "author": null, "committer": null, "parents": [{"sha": "dfcfe1846a2ee22f317ad955b87fd1a7a5ca8fe1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfcfe1846a2ee22f317ad955b87fd1a7a5ca8fe1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfcfe1846a2ee22f317ad955b87fd1a7a5ca8fe1"}], "stats": {"total": 63, "additions": 62, "deletions": 1}, "files": [{"sha": "74e7cb17c0c7a53fdaf88f0136f645902ee563ab", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=76c85fbbe7bb698e56b757e5997069b569517150", "patch": "@@ -1,3 +1,10 @@\n+2016-02-05  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/68948\n+\t* pt.c (tsubst_baselink): Diagnose an invalid constructor call\n+\tif lookup_fnfields returns NULL_TREE and the name being looked\n+\tup has the form A::A.\n+\n 2016-02-04  Patrick Palka  <ppalka@gcc.gnu.org>\n \n \t* constexpr.c (cxx_eval_binary_expression): Fold equality"}, {"sha": "76a6019a29e9fef35b57d65e1ec316aba42f1be5", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=76c85fbbe7bb698e56b757e5997069b569517150", "patch": "@@ -13583,7 +13583,15 @@ tsubst_baselink (tree baselink, tree object_type,\n       name = mangle_conv_op_name_for_type (optype);\n     baselink = lookup_fnfields (qualifying_scope, name, /*protect=*/1);\n     if (!baselink)\n-      return error_mark_node;\n+      {\n+\tif (constructor_name_p (name, qualifying_scope))\n+\t  {\n+\t    if (complain & tf_error)\n+\t      error (\"cannot call constructor %<%T::%D%> directly\",\n+\t\t     qualifying_scope, name);\n+\t  }\n+\treturn error_mark_node;\n+      }\n \n     /* If lookup found a single function, mark it as used at this\n        point.  (If it lookup found multiple functions the one selected"}, {"sha": "344b7d34f3842ed6b217c0cab22559c90495af5c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=76c85fbbe7bb698e56b757e5997069b569517150", "patch": "@@ -1,3 +1,8 @@\n+2016-02-05  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/68948\n+\t* g++.dg/template/pr68948.C: New test.\n+\n 2016-02-05  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n \n \t* gcc.dg/tree-ssa/ssa-dom-cse-2.c: Remove -march=z13 for s390"}, {"sha": "3cb684417afaad36f78ab0c6b1f5825fc636e8ad", "filename": "gcc/testsuite/g++.dg/template/pr68948.C", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr68948.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76c85fbbe7bb698e56b757e5997069b569517150/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr68948.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr68948.C?ref=76c85fbbe7bb698e56b757e5997069b569517150", "patch": "@@ -0,0 +1,41 @@\n+// PR c++/68948\n+\n+struct B { B (); B (int); };\n+\n+struct Time : B { };\n+\n+/* Here, A and B are unrelated types.  */\n+\n+template <typename>\n+struct A\n+{\n+  void TestBody ()\n+  {\n+    B::B (); // { dg-error \"cannot call constructor .B::B.\" }\n+    B::B::B (); // { dg-error \"cannot call constructor .B::B.\" }\n+    B::B (0); // { dg-error \"cannot call constructor .B::B.\" }\n+  }\n+};\n+\n+/* Here, C is (indirectly) derived from B.  */\n+\n+template <typename g>\n+struct C : Time\n+{\n+  void TestBody ()\n+  {\n+    B::B (); // { dg-error \"cannot call constructor .B::B.\" }\n+    B::B::B (); // { dg-error \"cannot call constructor .B::B.\" }\n+    B::B (0); // { dg-error \"cannot call constructor .B::B.\" }\n+    Time::B (0);\n+  }\n+};\n+\n+int\n+main (void)\n+{\n+  A<int> a;\n+  C<int> c;\n+  a.TestBody ();\n+  c.TestBody ();\n+}"}]}