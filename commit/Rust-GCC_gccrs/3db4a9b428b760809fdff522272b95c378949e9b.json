{"sha": "3db4a9b428b760809fdff522272b95c378949e9b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2RiNGE5YjQyOGI3NjA4MDlmZGZmNTIyMjcyYjk1YzM3ODk0OWU5Yg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2004-06-24T20:07:23Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2004-06-24T20:07:23Z"}, "message": "re PR tree-optimization/16115 (double-destruction problem with argument passing via temporary (breaks auto_ptr))\n\n        PR c++/16115\n        * decl.c (grokparms): Give the PARM_DECL reference type if the\n        parameter is passed by invisible reference.\n\nFrom-SVN: r83609", "tree": {"sha": "f23d2ae011d1f97ca7d6a6cfbab603fd1b9babf1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f23d2ae011d1f97ca7d6a6cfbab603fd1b9babf1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3db4a9b428b760809fdff522272b95c378949e9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3db4a9b428b760809fdff522272b95c378949e9b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3db4a9b428b760809fdff522272b95c378949e9b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3db4a9b428b760809fdff522272b95c378949e9b/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "de7c79cc7771f311aa451103162436077aa1699a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de7c79cc7771f311aa451103162436077aa1699a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de7c79cc7771f311aa451103162436077aa1699a"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "fee6c9a122340f64ad660e6c92dbbd01d41d0e57", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3db4a9b428b760809fdff522272b95c378949e9b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3db4a9b428b760809fdff522272b95c378949e9b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3db4a9b428b760809fdff522272b95c378949e9b", "patch": "@@ -1,3 +1,9 @@\n+2004-06-24  Jason Merrill  <jason@redhat.com>\n+\n+\tPR c++/16115\n+\t* decl.c (grokparms): Give the PARM_DECL reference type if the\n+\tparameter is passed by invisible reference.\n+\n 2004-06-24  Andreas Schwab  <schwab@suse.de>\n \n \t* cp-tree.h (enum cp_storage_class): Remove trailing comma."}, {"sha": "2798440816f068c76304e4a29fac6ee3fcbcf269", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3db4a9b428b760809fdff522272b95c378949e9b/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3db4a9b428b760809fdff522272b95c378949e9b/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=3db4a9b428b760809fdff522272b95c378949e9b", "patch": "@@ -8224,6 +8224,13 @@ grokparms (cp_parameter_declarator *first_parm, tree *parms)\n \n       if (type != error_mark_node)\n \t{\n+\t  /* If this type is passed by invisible reference, make the PARM_DECL\n+\t     reflect that so that alias analysis knows that the actual object\n+\t     is external to the function.  */\n+\t  if (TREE_ADDRESSABLE (type))\n+\t    decl = build_decl (PARM_DECL, DECL_NAME (decl),\n+\t\t\t       build_reference_type (type));\n+\n \t  /* Top-level qualifiers on the parameters are\n \t     ignored for function types.  */\n \t  type = cp_build_qualified_type (type, 0);\n@@ -8258,7 +8265,7 @@ grokparms (cp_parameter_declarator *first_parm, tree *parms)\n \t    }\n \n \t  if (!any_error && init)\n-\t    init = check_default_argument (decl, init);\n+\t    init = check_default_argument (type, init);\n \t  else\n \t    init = NULL_TREE;\n \t}"}, {"sha": "15b700fca8e42211166890753b42ce6c7813ffa9", "filename": "gcc/testsuite/g++.dg/init/call1.C", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3db4a9b428b760809fdff522272b95c378949e9b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fcall1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3db4a9b428b760809fdff522272b95c378949e9b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fcall1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fcall1.C?ref=3db4a9b428b760809fdff522272b95c378949e9b", "patch": "@@ -0,0 +1,35 @@\n+// Bug c++/16115\n+// { dg-do run }\n+\n+extern \"C\" void abort(); \n+ \n+int count = 0; \n+ \n+struct T { \n+    T() { count++; } \n+    T(const T&) { count++; } \n+    ~T() { if (count==0) abort(); --count; } \n+}; \n+ \n+struct auto_ptr { \n+    T* p; \n+ \n+    auto_ptr(T* __p) : p(__p) { } \n+    ~auto_ptr() { delete p; } \n+ \n+    T* release() { \n+      T* t = p; \n+      p = 0; \n+      return t; \n+    } \n+}; \n+ \n+void destroy (auto_ptr a) { \n+  delete a.release(); \n+} \n+ \n+ \n+int main () \n+{ \n+  destroy (new T); \n+}"}]}