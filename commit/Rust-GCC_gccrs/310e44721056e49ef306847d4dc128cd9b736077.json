{"sha": "310e44721056e49ef306847d4dc128cd9b736077", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzEwZTQ0NzIxMDU2ZTQ5ZWYzMDY4NDdkNGRjMTI4Y2Q5YjczNjA3Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-04-19T21:51:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-04-19T21:51:28Z"}, "message": "re PR fortran/43339 (Incorrect output for pgm checking data sharing attributes)\n\n\tPR fortran/43339\n\t* openmp.c (gfc_resolve_do_iterator): Only make iteration vars for\n\tsequential loops private in the innermost containing task region.\n\n\t* gfortran.dg/gomp/sharing-2.f90: Adjust for iteration vars\n\tof sequential loops being private only in the innermost containing\n\ttask region.\n\nFrom-SVN: r158528", "tree": {"sha": "0d30e48f995fb8fd50a8c3b308cc3360a4071a89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d30e48f995fb8fd50a8c3b308cc3360a4071a89"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/310e44721056e49ef306847d4dc128cd9b736077", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/310e44721056e49ef306847d4dc128cd9b736077", "html_url": "https://github.com/Rust-GCC/gccrs/commit/310e44721056e49ef306847d4dc128cd9b736077", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/310e44721056e49ef306847d4dc128cd9b736077/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fd2e4e99d810ae5f0ecac7954db4602343ca2ec7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd2e4e99d810ae5f0ecac7954db4602343ca2ec7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd2e4e99d810ae5f0ecac7954db4602343ca2ec7"}], "stats": {"total": 52, "additions": 31, "deletions": 21}, "files": [{"sha": "b9a4ebbcbd0e76bf21b2787ca4c8afed0277bb27", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=310e44721056e49ef306847d4dc128cd9b736077", "patch": "@@ -1,3 +1,9 @@\n+2010-04-19  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/43339\n+\t* openmp.c (gfc_resolve_do_iterator): Only make iteration vars for\n+\tsequential loops private in the innermost containing task region.\n+\n 2010-04-18  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* f95-lang.c (gfc_init_decl_processing): Remove second argument in call"}, {"sha": "c00e1b41e28c092f80c4454414cadce74350a1b8", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 14, "deletions": 15, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=310e44721056e49ef306847d4dc128cd9b736077", "patch": "@@ -1,5 +1,5 @@\n /* OpenMP directive matching and resolving.\n-   Copyright (C) 2005, 2006, 2007, 2008\n+   Copyright (C) 2005, 2006, 2007, 2008, 2010\n    Free Software Foundation, Inc.\n    Contributed by Jakub Jelinek\n \n@@ -1367,7 +1367,6 @@ gfc_resolve_omp_parallel_blocks (gfc_code *code, gfc_namespace *ns)\n void\n gfc_resolve_do_iterator (gfc_code *code, gfc_symbol *sym)\n {\n-  struct omp_context *ctx;\n   int i = omp_current_do_collapse;\n   gfc_code *c = omp_current_do_code;\n \n@@ -1386,21 +1385,21 @@ gfc_resolve_do_iterator (gfc_code *code, gfc_symbol *sym)\n       c = c->block->next;\n     }\n \n-  for (ctx = omp_current_ctx; ctx; ctx = ctx->previous)\n-    {\n-      if (pointer_set_contains (ctx->sharing_clauses, sym))\n-\tcontinue;\n+  if (omp_current_ctx == NULL)\n+    return;\n \n-      if (! pointer_set_insert (ctx->private_iterators, sym))\n-\t{\n-\t  gfc_omp_clauses *omp_clauses = ctx->code->ext.omp_clauses;\n-\t  gfc_namelist *p;\n+  if (pointer_set_contains (omp_current_ctx->sharing_clauses, sym))\n+    return;\n \n-\t  p = gfc_get_namelist ();\n-\t  p->sym = sym;\n-\t  p->next = omp_clauses->lists[OMP_LIST_PRIVATE];\n-\t  omp_clauses->lists[OMP_LIST_PRIVATE] = p;\n-\t}\n+  if (! pointer_set_insert (omp_current_ctx->private_iterators, sym))\n+    {\n+      gfc_omp_clauses *omp_clauses = omp_current_ctx->code->ext.omp_clauses;\n+      gfc_namelist *p;\n+\n+      p = gfc_get_namelist ();\n+      p->sym = sym;\n+      p->next = omp_clauses->lists[OMP_LIST_PRIVATE];\n+      omp_clauses->lists[OMP_LIST_PRIVATE] = p;\n     }\n }\n "}, {"sha": "dbde6351fac0f9b2fae635648e8d23e3eacf97bc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=310e44721056e49ef306847d4dc128cd9b736077", "patch": "@@ -1,5 +1,10 @@\n 2010-04-19  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/43339\n+\t* gfortran.dg/gomp/sharing-2.f90: Adjust for iteration vars\n+\tof sequential loops being private only in the innermost containing\n+\ttask region.\n+\n \tPR middle-end/43337\n \t* gfortran.dg/gomp/pr43337.f90: New test.\n "}, {"sha": "b7d7e0729754aa77a1711c1a8765958a76bbdb3e", "filename": "gcc/testsuite/gfortran.dg/gomp/sharing-2.f90", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fsharing-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/310e44721056e49ef306847d4dc128cd9b736077/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fsharing-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fsharing-2.f90?ref=310e44721056e49ef306847d4dc128cd9b736077", "patch": "@@ -28,10 +28,10 @@\n   end do\n !$omp end single\n !$omp end parallel\n-!$omp parallel default (none) shared (a)\n-  i = 1\n-  j = 1\n-  k = 1\n+!$omp parallel default (none) shared (a) ! { dg-error \"enclosing parallel\" }\n+  i = 1\t\t! { dg-error \"not specified in\" }\n+  j = 1\t\t! { dg-error \"not specified in\" }\n+  k = 1\t\t! { dg-error \"not specified in\" }\n !$omp parallel default (none) shared (a)\n   i = 1\n   j = 1\n@@ -68,8 +68,8 @@\n     a(i, 1) = i + 1\n   end do\n !$omp end parallel\n-!$omp parallel default (none) shared (a)\n-  i = 1\n+!$omp parallel default (none) shared (a) ! { dg-error \"enclosing parallel\" }\n+  i = 1\t\t! { dg-error \"not specified in\" }\n !$omp parallel default (none) shared (a, i)\n   i = 2\n !$omp parallel default (none) shared (a)"}]}