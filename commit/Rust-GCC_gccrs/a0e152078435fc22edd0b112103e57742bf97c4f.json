{"sha": "a0e152078435fc22edd0b112103e57742bf97c4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTBlMTUyMDc4NDM1ZmMyMmVkZDBiMTEyMTAzZTU3NzQyYmY5N2M0Zg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-02-08T20:55:02Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-02-08T20:55:02Z"}, "message": "re PR go/47378 (ld warning linking with libgo.so: relocation bound to a symbol with STV_PROTECTED visibility)\n\n\tPR go/47378\nDon't use protected visibility for type descriptors.\n\nFrom-SVN: r169946", "tree": {"sha": "1cd187fbdb5eb26cf7724804c273ac0478ce04d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1cd187fbdb5eb26cf7724804c273ac0478ce04d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0e152078435fc22edd0b112103e57742bf97c4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0e152078435fc22edd0b112103e57742bf97c4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0e152078435fc22edd0b112103e57742bf97c4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0e152078435fc22edd0b112103e57742bf97c4f/comments", "author": null, "committer": null, "parents": [{"sha": "76eddcf660ac7d52811f28a7e0a5262142c0a2b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76eddcf660ac7d52811f28a7e0a5262142c0a2b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76eddcf660ac7d52811f28a7e0a5262142c0a2b9"}], "stats": {"total": 32, "additions": 5, "deletions": 27}, "files": [{"sha": "ec5f65ac24ea89eb1756aef12425d2f76f5e0c0d", "filename": "gcc/go/gofrontend/gogo-tree.cc", "status": "modified", "additions": 5, "deletions": 27, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0e152078435fc22edd0b112103e57742bf97c4f/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0e152078435fc22edd0b112103e57742bf97c4f/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc?ref=a0e152078435fc22edd0b112103e57742bf97c4f", "patch": "@@ -2633,26 +2633,14 @@ Gogo::build_type_descriptor_decl(const Type* type, Expression* initializer,\n \n   DECL_INITIAL(decl) = constructor;\n \n-  if (type_descriptor_location == TYPE_DESCRIPTOR_COMMON)\n+  if (type_descriptor_location == TYPE_DESCRIPTOR_DEFINED)\n+    TREE_PUBLIC(decl) = 1;\n+  else\n     {\n+      gcc_assert(type_descriptor_location == TYPE_DESCRIPTOR_COMMON);\n       make_decl_one_only(decl, DECL_ASSEMBLER_NAME(decl));\n       resolve_unique_section(decl, 1, 0);\n     }\n-  else\n-    {\n-#ifdef OBJECT_FORMAT_ELF\n-      // Give the decl protected visibility.  This avoids out-of-range\n-      // references with shared libraries with the x86_64 small model\n-      // when the type descriptor gets a COPY reloc into the main\n-      // executable.  There is no need to have unique pointers to type\n-      // descriptors, as the runtime code compares reflection strings\n-      // if necessary.\n-      DECL_VISIBILITY(decl) = VISIBILITY_PROTECTED;\n-      DECL_VISIBILITY_SPECIFIED(decl) = 1;\n-#endif\n-\n-      TREE_PUBLIC(decl) = 1;\n-    }\n \n   rest_of_decl_compilation(decl, 1, 0);\n }\n@@ -2764,17 +2752,7 @@ Gogo::interface_method_table_for_type(const Interface_type* interface,\n   // definition of the table.  Otherwise it is a comdat table which\n   // may be defined in multiple packages.\n   if (has_hidden_methods)\n-    {\n-#ifdef OBJECT_FORMAT_ELF\n-      // Give the decl protected visibility.  This avoids out-of-range\n-      // references with shared libraries with the x86_64 small model\n-      // when the table gets a COPY reloc into the main executable.\n-      DECL_VISIBILITY(decl) = VISIBILITY_PROTECTED;\n-      DECL_VISIBILITY_SPECIFIED(decl) = 1;\n-#endif\n-\n-      TREE_PUBLIC(decl) = 1;\n-    }\n+    TREE_PUBLIC(decl) = 1;\n   else\n     {\n       make_decl_one_only(decl, DECL_ASSEMBLER_NAME(decl));"}]}