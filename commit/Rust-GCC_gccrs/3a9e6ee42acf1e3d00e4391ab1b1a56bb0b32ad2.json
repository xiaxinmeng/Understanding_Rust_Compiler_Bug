{"sha": "3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2E5ZTZlZTQyYWNmMWUzZDAwZTQzOTFhYjFiMWE1NmJiMGIzMmFkMg==", "commit": {"author": {"name": "Mark Wielaard", "email": "mark@klomp.org", "date": "2020-10-06T15:41:19Z"}, "committer": {"name": "Mark Wielaard", "email": "mark@klomp.org", "date": "2020-10-08T15:17:00Z"}, "message": "debug: Make sure to output .file 0 when generating DWARF5.\n\nWhen gas outputs DWARF5 .debug_line[_str] then we have to tell it the\ncomp_dir and main file name for the zero entry line table. Otherwise\ngas has to guess at the CU compilation directory and file.\n\nBefore a gcc -gdwarf-5 ../src/hello.c line table looked like:\n\nDirectory table:\n 0     ../src (24)\n 1     ../src (24)\n 2     /usr/include (31)\n\nFile name table:\n 0     hello.c (16),  0\n 1     hello.c (16),  1\n 2     stdio.h (44),  2\n\nWith this patch it looks like:\n\nDirectory table:\n 0     /tmp/obj (0)\n 1     ../src (24)\n 2     /usr/include (31)\n\nFile name table:\n 0     ../src/hello.c (9),  0\n 1     hello.c (16),  1\n 2     stdio.h (44),  2\n\ngcc/ChangeLog:\n\n\t* dwarf2out.c (dwarf2out_finish): Emit .file 0 entry when\n\tgenerating DWARF5 .debug_line table through gas.", "tree": {"sha": "991e9c0e4571b7cd7048c5ad6c19b378d6a876bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/991e9c0e4571b7cd7048c5ad6c19b378d6a876bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2/comments", "author": null, "committer": null, "parents": [{"sha": "baf4750feaa6a5fa502ae7bc0b90f31640af6f47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/baf4750feaa6a5fa502ae7bc0b90f31640af6f47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/baf4750feaa6a5fa502ae7bc0b90f31640af6f47"}], "stats": {"total": 21, "additions": 21, "deletions": 0}, "files": [{"sha": "ba93a6c3d81c85272b440ce52776fa0e927acbab", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=3a9e6ee42acf1e3d00e4391ab1b1a56bb0b32ad2", "patch": "@@ -31768,6 +31768,27 @@ dwarf2out_finish (const char *filename)\n   ASM_OUTPUT_LABEL (asm_out_file, debug_line_section_label);\n   if (! output_asm_line_debug_info ())\n     output_line_info (false);\n+  else if (asm_outputs_debug_line_str ())\n+    {\n+      /* When gas outputs DWARF5 .debug_line[_str] then we have to\n+\t tell it the comp_dir and main file name for the zero entry\n+\t line table.  */\n+      const char *comp_dir, *filename0;\n+\n+      comp_dir = comp_dir_string ();\n+      if (comp_dir == NULL)\n+\tcomp_dir = \"\";\n+\n+      filename0 = get_AT_string (comp_unit_die (), DW_AT_name);\n+      if (filename0 == NULL)\n+\tfilename0 = \"\";\n+\n+      fprintf (asm_out_file, \"\\t.file 0 \");\n+      output_quoted_string (asm_out_file, remap_debug_filename (comp_dir));\n+      fputc (' ', asm_out_file);\n+      output_quoted_string (asm_out_file, remap_debug_filename (filename0));\n+      fputc ('\\n', asm_out_file);\n+    }\n \n   if (dwarf_split_debug_info && info_section_emitted)\n     {"}]}