{"sha": "df867456d79fcb8d136e9e64e6caff4435eb5ca7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGY4Njc0NTZkNzlmY2I4ZDEzNmU5ZTY0ZTZjYWZmNDQzNWViNWNhNw==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2002-03-12T23:32:47Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2002-03-12T23:32:47Z"}, "message": "re PR c++/5659 (default access for class/struct bug)\n\ncp:\n\tPR c++/5659\n\t* decl.c (xref_tag): Don't set CLASSTYPE_DECLARED_CLASS here.\n\t* decl2.c (handle_class_head): Set CLASSTYPE_DECLARED_CLASS for\n\tdefinitions.\ntestsuite:\n\t* g++.dg/other/access1.C: New test.\n\nFrom-SVN: r50692", "tree": {"sha": "43e771810125bfcb9dfe317ea9f8984be22db3a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/43e771810125bfcb9dfe317ea9f8984be22db3a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/df867456d79fcb8d136e9e64e6caff4435eb5ca7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df867456d79fcb8d136e9e64e6caff4435eb5ca7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df867456d79fcb8d136e9e64e6caff4435eb5ca7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df867456d79fcb8d136e9e64e6caff4435eb5ca7/comments", "author": null, "committer": null, "parents": [{"sha": "35bb2beeac02c760aac69d0eff9605bf9c2f2204", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35bb2beeac02c760aac69d0eff9605bf9c2f2204", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35bb2beeac02c760aac69d0eff9605bf9c2f2204"}], "stats": {"total": 58, "additions": 44, "deletions": 14}, "files": [{"sha": "e9d8283d014f8b7f68348ab8fe6e70b472ac2f8a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=df867456d79fcb8d136e9e64e6caff4435eb5ca7", "patch": "@@ -1,3 +1,10 @@\n+2002-03-12  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/5659\n+\t* decl.c (xref_tag): Don't set CLASSTYPE_DECLARED_CLASS here.\n+\t* decl2.c (handle_class_head): Set CLASSTYPE_DECLARED_CLASS for\n+\tdefinitions.\n+\n 2002-03-11  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tRevert 2001-03-26  Nathan Sidwell  <nathan@codesourcery.com>,"}, {"sha": "9b5d3e96975bb41e88676ec68483ef0c8bf28b56", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=df867456d79fcb8d136e9e64e6caff4435eb5ca7", "patch": "@@ -12858,19 +12858,6 @@ xref_tag (code_type_node, name, globalize)\n \tredeclare_class_template (ref, current_template_parms);\n     }\n \n-  /* Until the type is defined, tentatively accept whatever\n-     structure tag the user hands us.  */\n-  if (!COMPLETE_TYPE_P (ref)\n-      && ref != current_class_type\n-      /* Have to check this, in case we have contradictory tag info.  */\n-      && IS_AGGR_TYPE_CODE (TREE_CODE (ref)))\n-    {\n-      if (tag_code == class_type)\n-\tCLASSTYPE_DECLARED_CLASS (ref) = 1;\n-      else if (tag_code == record_type)\n-\tCLASSTYPE_DECLARED_CLASS (ref) = 0;\n-    }\n-\n   TYPE_ATTRIBUTES (ref) = attributes;\n \n   return ref;"}, {"sha": "8841dec2e2b9870a44a78bd1d087d5e5623ee4d7", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=df867456d79fcb8d136e9e64e6caff4435eb5ca7", "patch": "@@ -5252,7 +5252,13 @@ handle_class_head (aggr, scope, id, defn_p, new_type_p)\n \t\t     && TREE_CODE (context) != BOUND_TEMPLATE_TEMPLATE_PARM);\n       if (*new_type_p)\n \tpush_scope (context);\n-  \n+\n+      if (TREE_CODE (TREE_TYPE (decl)) == RECORD_TYPE)\n+\t/* It is legal to define a class with a different class key,\n+\t   and this changes the default member access.  */\n+\tCLASSTYPE_DECLARED_CLASS (TREE_TYPE (decl))\n+\t  = aggr == class_type_node;\n+\t\n       if (!xrefd_p && PROCESSING_REAL_TEMPLATE_DECL_P ())\n \tdecl = push_template_decl (decl);\n     }"}, {"sha": "cde8e627840d51201e6b24afa4f1269e41cf4c93", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=df867456d79fcb8d136e9e64e6caff4435eb5ca7", "patch": "@@ -1,3 +1,7 @@\n+2002-03-12  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* g++.dg/other/access1.C: New test.\n+\n 2002-03-12  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.c-torture/execute/wchar_t-1.c: New test."}, {"sha": "ee3239b93f2bd31a6f63dd551f6cd5f3b8d21345", "filename": "gcc/testsuite/g++.dg/other/access1.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Faccess1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df867456d79fcb8d136e9e64e6caff4435eb5ca7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Faccess1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Faccess1.C?ref=df867456d79fcb8d136e9e64e6caff4435eb5ca7", "patch": "@@ -0,0 +1,26 @@\n+// { dg-do compile }\n+\n+// Copyright (C) 2002 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 12 Mar 2002 <nathan@codesourcery.com>\n+\n+// PR c++/5659. Failed to notice default accessed changed\n+\n+class Foo;\n+struct Foo \n+{\n+  static int m;\n+};\n+\n+class Outer {\n+  private:\n+  class Inner;\n+  Inner *i;\n+  public:\n+  void pub();\n+};\n+\n+struct Outer::Inner {\n+  Inner(int i);\n+};\n+\n+void Outer::pub() { i = new Inner(Foo::m); }"}]}