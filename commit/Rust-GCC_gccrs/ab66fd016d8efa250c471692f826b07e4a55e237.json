{"sha": "ab66fd016d8efa250c471692f826b07e4a55e237", "node_id": "C_kwDOANBUbNoAKGFiNjZmZDAxNmQ4ZWZhMjUwYzQ3MTY5MmY4MjZiMDdlNGE1NWUyMzc", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-05-11T14:07:25Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-06-16T06:23:06Z"}, "message": "opts: improve option suggestion\n\nIn case where we have 2 equally good candidates like\n-ftrivial-auto-var-init=\n-Wtrivial-auto-var-init\n\nfor -ftrivial-auto-var-init, we should take the candidate that\nhas a difference in trailing sign symbol.\n\n\tPR driver/105564\n\ngcc/ChangeLog:\n\n\t* spellcheck.cc (test_find_closest_string): Add new test.\n\t* spellcheck.h (class best_match): Prefer a difference in\n\ttrailing sign symbol.", "tree": {"sha": "45b33fca45bceb9bdb8900bc8d3e9fa25b2346cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/45b33fca45bceb9bdb8900bc8d3e9fa25b2346cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ab66fd016d8efa250c471692f826b07e4a55e237", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab66fd016d8efa250c471692f826b07e4a55e237", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab66fd016d8efa250c471692f826b07e4a55e237", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab66fd016d8efa250c471692f826b07e4a55e237/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b18e5d7e5f9df69759f0fbc2bed91d5e51313e79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b18e5d7e5f9df69759f0fbc2bed91d5e51313e79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b18e5d7e5f9df69759f0fbc2bed91d5e51313e79"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "6930c0ed90359cc424216e5f274277170e050979", "filename": "gcc/spellcheck.cc", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab66fd016d8efa250c471692f826b07e4a55e237/gcc%2Fspellcheck.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab66fd016d8efa250c471692f826b07e4a55e237/gcc%2Fspellcheck.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fspellcheck.cc?ref=ab66fd016d8efa250c471692f826b07e4a55e237", "patch": "@@ -464,6 +464,15 @@ test_find_closest_string ()\n   ASSERT_STREQ (\"DWARF_GNAT_ENCODINGS_ALL\",\n \t\tfind_closest_string (\"DWARF_GNAT_ENCODINGS_all\",\n \t\t\t\t     &candidates));\n+\n+  /* Example from PR 105564 where option name with missing equal\n+     sign should win.  */\n+  candidates.truncate (0);\n+  candidates.safe_push (\"-Wtrivial-auto-var-init\");\n+  candidates.safe_push (\"-ftrivial-auto-var-init=\");\n+  ASSERT_STREQ (\"-ftrivial-auto-var-init=\",\n+\t\tfind_closest_string (\"-ftrivial-auto-var-init\",\n+\t\t\t\t     &candidates));\n }\n \n /* Test data for test_metric_conditions.  */"}, {"sha": "3706de38a9db18fede6f61eae06ef7a0ef368319", "filename": "gcc/spellcheck.h", "status": "modified", "additions": 21, "deletions": 3, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab66fd016d8efa250c471692f826b07e4a55e237/gcc%2Fspellcheck.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab66fd016d8efa250c471692f826b07e4a55e237/gcc%2Fspellcheck.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fspellcheck.h?ref=ab66fd016d8efa250c471692f826b07e4a55e237", "patch": "@@ -128,11 +128,29 @@ class best_match\n \n     /* Otherwise, compute the distance and see if the candidate\n        has beaten the previous best value.  */\n+    const char *candidate_str = candidate_traits::get_string (candidate);\n     edit_distance_t dist\n-      = get_edit_distance (m_goal, m_goal_len,\n-\t\t\t   candidate_traits::get_string (candidate),\n-\t\t\t   candidate_len);\n+      = get_edit_distance (m_goal, m_goal_len, candidate_str, candidate_len);\n+\n+    bool is_better = false;\n     if (dist < m_best_distance)\n+      is_better = true;\n+    else if (dist == m_best_distance)\n+      {\n+\t/* Prefer a candidate that inserts a trailing '=',\n+\t   so that for\n+\t   \"-ftrivial-auto-var-init\"\n+\t   we suggest\n+\t   \"-ftrivial-auto-var-init=\"\n+\t   rather than\n+\t   \"-Wtrivial-auto-var-init\".  */\n+\t/* Prefer a candidate has a difference in trailing sign character.  */\n+\tif (candidate_str[candidate_len - 1] == '='\n+\t    && m_goal[m_goal_len - 1] != '=')\n+\t  is_better = true;\n+      }\n+\n+    if (is_better)\n       {\n \tm_best_distance = dist;\n \tm_best_candidate = candidate;"}]}