{"sha": "c0cc62b32d95caca25a8854e0d2b6f11f5674d30", "node_id": "C_kwDOANBUbNoAKGMwY2M2MmIzMmQ5NWNhY2EyNWE4ODU0ZTBkMmI2ZjExZjU2NzRkMzA", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-09-23T08:27:01Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-09-23T09:17:33Z"}, "message": "tree-optimization/102448 - clear copied alignment info from vect\n\nThis fixes the previous change which removed setting alignment info\nfrom the vectorizers idea of how a pointer is being used but left\nin place the copied info from DR_PTR_INFO without realizing that this\nis in fact _not_ the alignment of the access but the alignment of\na base pointer contained in it.\n\nThe following makes sure to not use that info.\n\n2021-09-23  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/102448\n\t* tree-vect-data-refs.c (vect_duplicate_ssa_name_ptr_info):\n\tClear alignment info copied from DR_PTR_INFO.", "tree": {"sha": "884f5649c42528dcdab58f422f075d5d5c4983b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/884f5649c42528dcdab58f422f075d5d5c4983b6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c0cc62b32d95caca25a8854e0d2b6f11f5674d30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0cc62b32d95caca25a8854e0d2b6f11f5674d30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0cc62b32d95caca25a8854e0d2b6f11f5674d30", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0cc62b32d95caca25a8854e0d2b6f11f5674d30/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ce500289a69d48cf7b2ea633e4d99565fed5a64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ce500289a69d48cf7b2ea633e4d99565fed5a64", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ce500289a69d48cf7b2ea633e4d99565fed5a64"}], "stats": {"total": 11, "additions": 5, "deletions": 6}, "files": [{"sha": "bdff6ea54ac09782283dddbfa951b9779fdba6cb", "filename": "gcc/tree-vect-data-refs.c", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0cc62b32d95caca25a8854e0d2b6f11f5674d30/gcc%2Ftree-vect-data-refs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0cc62b32d95caca25a8854e0d2b6f11f5674d30/gcc%2Ftree-vect-data-refs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-data-refs.c?ref=c0cc62b32d95caca25a8854e0d2b6f11f5674d30", "patch": "@@ -4629,12 +4629,15 @@ vect_get_new_ssa_name (tree type, enum vect_var_kind var_kind, const char *name)\n   return new_vect_var;\n }\n \n-/* Duplicate ptr info and set alignment/misaligment on NAME from DR_INFO.  */\n+/* Duplicate points-to info on NAME from DR_INFO.  */\n \n static void\n vect_duplicate_ssa_name_ptr_info (tree name, dr_vec_info *dr_info)\n {\n   duplicate_ssa_name_ptr_info (name, DR_PTR_INFO (dr_info->dr));\n+  /* DR_PTR_INFO is for a base SSA name, not including constant or\n+     variable offsets in the ref so its alignment info does not apply.  */\n+  mark_ptr_info_alignment_unknown (SSA_NAME_PTR_INFO (name));\n }\n \n /* Function vect_create_addr_base_for_vector_ref.\n@@ -4738,11 +4741,7 @@ vect_create_addr_base_for_vector_ref (vec_info *vinfo, stmt_vec_info stmt_info,\n   if (DR_PTR_INFO (dr)\n       && TREE_CODE (addr_base) == SSA_NAME\n       && !SSA_NAME_PTR_INFO (addr_base))\n-    {\n-      vect_duplicate_ssa_name_ptr_info (addr_base, dr_info);\n-      if (offset || byte_offset)\n-\tmark_ptr_info_alignment_unknown (SSA_NAME_PTR_INFO (addr_base));\n-    }\n+    vect_duplicate_ssa_name_ptr_info (addr_base, dr_info);\n \n   if (dump_enabled_p ())\n     dump_printf_loc (MSG_NOTE, vect_location, \"created %T\\n\", addr_base);"}]}