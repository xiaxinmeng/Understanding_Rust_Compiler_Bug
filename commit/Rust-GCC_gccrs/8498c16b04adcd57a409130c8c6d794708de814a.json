{"sha": "8498c16b04adcd57a409130c8c6d794708de814a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODQ5OGMxNmIwNGFkY2Q1N2E0MDkxMzBjOGM2ZDc5NDcwOGRlODE0YQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2015-12-08T14:17:42Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2015-12-08T14:17:42Z"}, "message": "Clear restrict in install_var_field\n\n2015-12-08  Tom de Vries  <tom@codesourcery.com>\n\n\tPR tree-optimization/68640\n\t* omp-low.c (install_var_field): Clear the restrict qualifier on the var\n\ttype.\n\nFrom-SVN: r231411", "tree": {"sha": "5d5e873c64683eb03b2bf89542e520f9abc5af4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5d5e873c64683eb03b2bf89542e520f9abc5af4e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8498c16b04adcd57a409130c8c6d794708de814a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8498c16b04adcd57a409130c8c6d794708de814a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8498c16b04adcd57a409130c8c6d794708de814a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8498c16b04adcd57a409130c8c6d794708de814a/comments", "author": null, "committer": null, "parents": [{"sha": "9b340934694e541e99701346263cb0f6c53b4438", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b340934694e541e99701346263cb0f6c53b4438", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b340934694e541e99701346263cb0f6c53b4438"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "94331edf3aa76fd1895b45764d9341629967999c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8498c16b04adcd57a409130c8c6d794708de814a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8498c16b04adcd57a409130c8c6d794708de814a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8498c16b04adcd57a409130c8c6d794708de814a", "patch": "@@ -1,3 +1,9 @@\n+2015-12-08  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR tree-optimization/68640\n+\t* omp-low.c (install_var_field): Clear the restrict qualifier on the var\n+\ttype.\n+\n 2015-12-08  Kirill Yukhin  <kirill.yukhin@intel.com>\n \n \t* config/i386/sse.md (define_insn \"<avx512>_vec_dup<mode>_1\"): Fix"}, {"sha": "56434805cfeed878f30dd736167e1b771ab30422", "filename": "gcc/omp-low.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8498c16b04adcd57a409130c8c6d794708de814a/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8498c16b04adcd57a409130c8c6d794708de814a/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=8498c16b04adcd57a409130c8c6d794708de814a", "patch": "@@ -1389,6 +1389,13 @@ install_var_field (tree var, bool by_ref, int mask, omp_context *ctx,\n \t      || !is_gimple_omp_oacc (ctx->stmt));\n \n   type = TREE_TYPE (var);\n+  /* Prevent redeclaring the var in the split-off function with a restrict\n+     pointer type.  Note that we only clear type itself, restrict qualifiers in\n+     the pointed-to type will be ignored by points-to analysis.  */\n+  if (POINTER_TYPE_P (type)\n+      && TYPE_RESTRICT (type))\n+    type = build_qualified_type (type, TYPE_QUALS (type) & ~TYPE_QUAL_RESTRICT);\n+\n   if (mask & 4)\n     {\n       gcc_assert (TREE_CODE (type) == ARRAY_TYPE);"}, {"sha": "f333db0923a40f317853289b24487bbbc8ed85dc", "filename": "gcc/testsuite/gcc.dg/gomp/pr68640.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8498c16b04adcd57a409130c8c6d794708de814a/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr68640.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8498c16b04adcd57a409130c8c6d794708de814a/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr68640.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr68640.c?ref=8498c16b04adcd57a409130c8c6d794708de814a", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fopenmp -fdump-tree-ealias-all\" } */\n+\n+#define N 1024\n+\n+int\n+foo (int *__restrict__ ap)\n+{\n+  int *bp = ap;\n+#pragma omp parallel for\n+  for (unsigned int idx = 0; idx < N; idx++)\n+    ap[idx] = bp[idx];\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"clique 1 base 1\" 2 \"ealias\" } } */\n+/* { dg-final { scan-tree-dump-times \"(?n)clique .* base .*\" 2 \"ealias\" } } */"}]}