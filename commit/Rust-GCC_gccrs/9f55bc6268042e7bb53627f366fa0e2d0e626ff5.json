{"sha": "9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWY1NWJjNjI2ODA0MmU3YmI1MzYyN2YzNjZmYTBlMmQwZTYyNmZmNQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-09-01T13:55:43Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-09-01T13:55:43Z"}, "message": "[multiple changes]\n\n2011-09-01  Robert Dewar  <dewar@adacore.com>\n\n\t* sem_ch3.adb, s-taprop-linux.adb, gnatls.adb: Minor reformatting.\n\n2011-09-01  Jose Ruiz  <ruiz@adacore.com>\n\n\t* adaint.h (__gnat_cpu_free): Fix the name of this profile.\n\t* adaint.c (__gnat_cpu_alloc, __gnat_cpu_alloc_size, __gnat_cpu_free,\n\t__gnat_cpu_zero, __gnat_cpu_set): Create version of these subprograms\n\tspecific for systems where their glibc version does not define the\n\troutines to handle dynamically allocated CPU sets.\n\n2011-09-01  Vincent Celier  <celier@adacore.com>\n\n\t* prj-proc.adb, prj.ads, prj-nmsc.adb, prj-util.adb, prj-util.ads,\n\tprj-env.adb: Implement inheritance of naming exceptions in extending\n\tprojects.\n\nFrom-SVN: r178418", "tree": {"sha": "894bb96665c4da61e1c1a8cc7d06587a70198889", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/894bb96665c4da61e1c1a8cc7d06587a70198889"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/comments", "author": null, "committer": null, "parents": [{"sha": "d7386a7a07949458aad3cfe7fdeb4a6b9024b11c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7386a7a07949458aad3cfe7fdeb4a6b9024b11c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7386a7a07949458aad3cfe7fdeb4a6b9024b11c"}], "stats": {"total": 387, "additions": 260, "deletions": 127}, "files": [{"sha": "ae711f09834cc520808995b71e27ab59bce1d3bf", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -1,3 +1,21 @@\n+2011-09-01  Robert Dewar  <dewar@adacore.com>\n+\n+\t* sem_ch3.adb, s-taprop-linux.adb, gnatls.adb: Minor reformatting.\n+\n+2011-09-01  Jose Ruiz  <ruiz@adacore.com>\n+\n+\t* adaint.h (__gnat_cpu_free): Fix the name of this profile.\n+\t* adaint.c (__gnat_cpu_alloc, __gnat_cpu_alloc_size, __gnat_cpu_free,\n+\t__gnat_cpu_zero, __gnat_cpu_set): Create version of these subprograms\n+\tspecific for systems where their glibc version does not define the\n+\troutines to handle dynamically allocated CPU sets.\n+\n+2011-09-01  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-proc.adb, prj.ads, prj-nmsc.adb, prj-util.adb, prj-util.ads,\n+\tprj-env.adb: Implement inheritance of naming exceptions in extending\n+\tprojects.\n+\n 2011-09-01  Romain Berrendonner  <berrendo@adacore.com>\n \n \t* gnatls.adb: Display simple message instead of content of"}, {"sha": "e470369443cdcd5aacd7e8e58d72b3d0c05a0380", "filename": "gcc/ada/adaint.c", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fadaint.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fadaint.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.c?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -3790,6 +3790,14 @@ void *__gnat_lwp_self (void)\n \n #include <sched.h>\n \n+/* glibc versions earlier than 2.7 do not define the routines to handle\n+   dynamically allocated CPU sets. For these targets, we use the static\n+   versions. */\n+\n+#ifdef CPU_ALLOC\n+\n+/* Dynamic cpu sets */\n+\n cpu_set_t *__gnat_cpu_alloc (size_t count)\n {\n   return CPU_ALLOC (count);\n@@ -3816,6 +3824,37 @@ void __gnat_cpu_set (int cpu, size_t count, cpu_set_t *set)\n      CPU by a 0, so we need to adjust. */\n   CPU_SET_S (cpu - 1, count, set);\n }\n+\n+#else\n+\n+/* Static cpu sets */\n+\n+cpu_set_t *__gnat_cpu_alloc (size_t count ATTRIBUTE_UNUSED)\n+{\n+  return (cpu_set_t *) xmalloc (sizeof (cpu_set_t));\n+}\n+\n+size_t __gnat_cpu_alloc_size (size_t count ATTRIBUTE_UNUSED)\n+{\n+  return sizeof (cpu_set_t);\n+}\n+\n+void __gnat_cpu_free (cpu_set_t *set)\n+{\n+  free (set);\n+}\n+\n+void __gnat_cpu_zero (size_t count ATTRIBUTE_UNUSED, cpu_set_t *set)\n+{\n+  CPU_ZERO (set);\n+}\n+\n+void __gnat_cpu_set (int cpu, size_t count ATTRIBUTE_UNUSED, cpu_set_t *set)\n+{\n+  /* Ada handles CPU numbers starting from 1, while C identifies the first\n+     CPU by a 0, so we need to adjust. */\n+  CPU_SET (cpu - 1, set);\n+}\n #endif\n \n #ifdef __cplusplus"}, {"sha": "5f18095cbb349a4f9ae67ee83991066cdf2f5da5", "filename": "gcc/ada/adaint.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fadaint.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fadaint.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.h?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -254,7 +254,7 @@ extern void   *__gnat_lwp_self\t\t\t   (void);\n \n extern cpu_set_t *__gnat_cpu_alloc                 (size_t);\n extern size_t __gnat_cpu_alloc_size                (size_t);\n-extern void   __gnat_cpu_set_free                  (cpu_set_t *);\n+extern void   __gnat_cpu_free                  (cpu_set_t *);\n extern void   __gnat_cpu_zero                      (size_t, cpu_set_t *);\n extern void   __gnat_cpu_set                       (int, size_t, cpu_set_t *);\n #endif"}, {"sha": "0fbf3b418fbdb07aad752f2b6252cd896c4d032f", "filename": "gcc/ada/gnatls.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fgnatls.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fgnatls.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnatls.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -829,6 +829,7 @@ procedure Gnatls is\n                      & \" GNAT Tracker at http://www.adacore.com/\"\n                      & \" for license terms.\");\n             Write_Eol;\n+\n          when others =>\n             Write_Str (\"Please refer to file COPYING in your distribution\"\n                      & \" for license terms.\");"}, {"sha": "c60fa377291dc1def94856db62da5afd2cae89cd", "filename": "gcc/ada/prj-env.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-env.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-env.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -529,7 +529,7 @@ package body Prj.Env is\n             if not Source.Locally_Removed\n               and then Source.Unit /= null\n               and then\n-                (Source.Index >= 1 or else Source.Naming_Exception)\n+                (Source.Index >= 1 or else Source.Naming_Exception /= No)\n             then\n                Put (Source);\n             end if;\n@@ -1344,6 +1344,7 @@ package body Prj.Env is\n \n          while Unit /= null loop\n             if Unit.File_Names (Spec) /= null\n+              and then not Unit.File_Names (Spec).Locally_Removed\n               and then Unit.File_Names (Spec).File /= No_File\n               and then\n                 (Namet.Get_Name_String\n@@ -1368,6 +1369,7 @@ package body Prj.Env is\n \n             elsif Unit.File_Names (Impl) /= null\n               and then Unit.File_Names (Impl).File /= No_File\n+              and then not Unit.File_Names (Impl).Locally_Removed\n               and then\n                 (Namet.Get_Name_String\n                    (Unit.File_Names (Impl).File) = Original_Name"}, {"sha": "1858c5d8133317c67a6d7dfa3f5de2ac7b92b6f0", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 130, "deletions": 58, "changes": 188, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -252,13 +252,13 @@ package body Prj.Nmsc is\n       Kind                : Source_Kind;\n       File_Name           : File_Name_Type;\n       Display_File        : File_Name_Type;\n-      Naming_Exception    : Boolean          := False;\n-      Path                : Path_Information := No_Path_Information;\n-      Alternate_Languages : Language_List    := null;\n-      Unit                : Name_Id          := No_Name;\n-      Index               : Int              := 0;\n-      Locally_Removed     : Boolean          := False;\n-      Location            : Source_Ptr       := No_Location);\n+      Naming_Exception    : Naming_Exception_Type := No;\n+      Path                : Path_Information      := No_Path_Information;\n+      Alternate_Languages : Language_List         := null;\n+      Unit                : Name_Id               := No_Name;\n+      Index               : Int                   := 0;\n+      Locally_Removed     : Boolean               := False;\n+      Location            : Source_Ptr            := No_Location);\n    --  Add a new source to the different lists: list of all sources in the\n    --  project tree, list of source of a project and list of sources of a\n    --  language. If Path is specified, the file is also added to\n@@ -628,13 +628,13 @@ package body Prj.Nmsc is\n       Kind                : Source_Kind;\n       File_Name           : File_Name_Type;\n       Display_File        : File_Name_Type;\n-      Naming_Exception    : Boolean          := False;\n-      Path                : Path_Information := No_Path_Information;\n-      Alternate_Languages : Language_List    := null;\n-      Unit                : Name_Id          := No_Name;\n-      Index               : Int              := 0;\n-      Locally_Removed     : Boolean          := False;\n-      Location            : Source_Ptr       := No_Location)\n+      Naming_Exception    : Naming_Exception_Type := No;\n+      Path                : Path_Information      := No_Path_Information;\n+      Alternate_Languages : Language_List         := null;\n+      Unit                : Name_Id               := No_Name;\n+      Index               : Int                   := 0;\n+      Locally_Removed     : Boolean               := False;\n+      Location            : Source_Ptr            := No_Location)\n    is\n       Config    : constant Language_Config := Lang_Id.Config;\n       UData     : Unit_Index;\n@@ -725,7 +725,7 @@ package body Prj.Nmsc is\n             --  file name in unrelated projects.\n \n          elsif Is_Extending (Project, Source.Project) then\n-            if not Locally_Removed then\n+            if not Locally_Removed and then Naming_Exception /= Inherited then\n                Source_To_Replace := Source;\n             end if;\n \n@@ -854,14 +854,19 @@ package body Prj.Nmsc is\n          if UData = No_Unit_Index then\n             UData := new Unit_Data;\n             UData.Name := Unit;\n-            Units_Htable.Set (Data.Tree.Units_HT, Unit, UData);\n+\n+            if Naming_Exception /= Inherited then\n+               Units_Htable.Set (Data.Tree.Units_HT, Unit, UData);\n+            end if;\n          end if;\n \n          Id.Unit := UData;\n \n          --  Note that this updates Unit information as well\n \n-         Override_Kind (Id, Kind);\n+         if Naming_Exception /= Inherited then\n+            Override_Kind (Id, Kind);\n+         end if;\n       end if;\n \n       if Path /= No_Path_Information then\n@@ -2329,7 +2334,7 @@ package body Prj.Nmsc is\n \n                      when Name_Runtime_Source_Dir =>\n \n-                        --  Attribute Runtime_Library_Dir (<language>)\n+                        --  Attribute Runtime_Source_Dir (<language>)\n \n                         Lang_Index.Config.Runtime_Source_Dir :=\n                           Element.Value.Value;\n@@ -3714,7 +3719,7 @@ package body Prj.Nmsc is\n                      Kind             => Kind,\n                      File_Name        => File_Name,\n                      Display_File     => File_Name_Type (Element.Value),\n-                     Naming_Exception => True,\n+                     Naming_Exception => Yes,\n                      Location         => Element.Location);\n \n                else\n@@ -3760,6 +3765,8 @@ package body Prj.Nmsc is\n          File_Name  : File_Name_Type;\n          Source     : Source_Id;\n \n+         Naming_Exception : Naming_Exception_Type;\n+\n       begin\n          case Kind is\n             when Impl | Sep =>\n@@ -3787,14 +3794,21 @@ package body Prj.Nmsc is\n                if Exceptions = No_Array_Element then\n                   Exceptions :=\n                     Value_Of\n-                      (Name_Spec,\n+                      (Name_Specification,\n                        In_Arrays => Naming.Decl.Arrays,\n                        Shared    => Shared);\n                end if;\n          end case;\n \n          while Exceptions /= No_Array_Element loop\n             Element   := Shared.Array_Elements.Table (Exceptions);\n+\n+            if Element.Restricted then\n+               Naming_Exception := Inherited;\n+            else\n+               Naming_Exception := Yes;\n+            end if;\n+\n             File_Name := Canonical_Case_File_Name (Element.Value.Value);\n \n             Get_Name_String (Element.Index);\n@@ -3827,7 +3841,7 @@ package body Prj.Nmsc is\n                   Unit             => Unit,\n                   Index            => Index,\n                   Location         => Element.Value.Location,\n-                  Naming_Exception => True);\n+                  Naming_Exception => Naming_Exception);\n             end if;\n \n             Exceptions := Element.Next;\n@@ -6326,7 +6340,7 @@ package body Prj.Nmsc is\n                   Source := Prj.Element (Iter);\n                   exit Source_Loop when Source = No_Source;\n \n-                  if Source.Naming_Exception then\n+                  if Source.Naming_Exception /= No then\n                      NL := Source_Names_Htable.Get\n                        (Project.Source_Names, Source.File);\n \n@@ -6383,51 +6397,54 @@ package body Prj.Nmsc is\n             --      the same file has received the full path, so we need to\n             --      propagate it.\n \n-            if Source.Naming_Exception\n-              and then Source.Path = No_Path_Information\n-            then\n-               if Source.Unit /= No_Unit_Index then\n-                  Found := False;\n+            if Source.Path = No_Path_Information then\n+               if Source.Naming_Exception = Yes then\n+                  if Source.Unit /= No_Unit_Index then\n+                     Found := False;\n \n-                  if Source.Index /= 0 then  --  Only multi-unit files\n-                     declare\n-                        S : Source_Id :=\n-                          Source_Files_Htable.Get\n-                            (Data.Tree.Source_Files_HT, Source.File);\n-                     begin\n-                        while S /= null loop\n-                           if S.Path /= No_Path_Information then\n-                              Source.Path := S.Path;\n-                              Found := True;\n+                     if Source.Index /= 0 then  --  Only multi-unit files\n+                        declare\n+                           S : Source_Id :=\n+                             Source_Files_Htable.Get\n+                               (Data.Tree.Source_Files_HT, Source.File);\n+                        begin\n+                           while S /= null loop\n+                              if S.Path /= No_Path_Information then\n+                                 Source.Path := S.Path;\n+                                 Found := True;\n+\n+                                 if Current_Verbosity = High then\n+                                    Debug_Output\n+                                      (\"setting full path for \"\n+                                       & Get_Name_String (Source.File)\n+                                       & \" at\" & Source.Index'Img\n+                                       & \" to \"\n+                                       & Get_Name_String (Source.Path.Name));\n+                                 end if;\n \n-                              if Current_Verbosity = High then\n-                                 Debug_Output\n-                                   (\"setting full path for \"\n-                                    & Get_Name_String (Source.File)\n-                                    & \" at\" & Source.Index'Img\n-                                    & \" to \"\n-                                    & Get_Name_String (Source.Path.Name));\n+                                 exit;\n                               end if;\n \n-                              exit;\n-                           end if;\n+                              S := S.Next_With_File_Name;\n+                           end loop;\n+                        end;\n+                     end if;\n \n-                           S := S.Next_With_File_Name;\n-                        end loop;\n-                     end;\n+                     if not Found then\n+                        Error_Msg_Name_1 := Name_Id (Source.Display_File);\n+                        Error_Msg_Name_2 := Source.Unit.Name;\n+                        Error_Or_Warning\n+                          (Data.Flags, Data.Flags.Missing_Source_Files,\n+                           \"source file %% for unit %% not found\",\n+                           No_Location, Project.Project);\n+                     end if;\n                   end if;\n \n-                  if not Found then\n-                     Error_Msg_Name_1 := Name_Id (Source.Display_File);\n-                     Error_Msg_Name_2 := Source.Unit.Name;\n-                     Error_Or_Warning\n-                       (Data.Flags, Data.Flags.Missing_Source_Files,\n-                        \"source file %% for unit %% not found\",\n-                        No_Location, Project.Project);\n+                  if Source.Path = No_Path_Information then\n+                     Remove_Source (Data.Tree, Source, No_Source);\n                   end if;\n-               end if;\n \n-               if Source.Path = No_Path_Information then\n+               elsif Source.Naming_Exception = Inherited then\n                   Remove_Source (Data.Tree, Source, No_Source);\n                end if;\n             end if;\n@@ -6660,6 +6677,8 @@ package body Prj.Nmsc is\n          --  If we had another file referencing the same unit (for instance it\n          --  was in an extended project), that source file is in fact invisible\n          --  from now on, and in particular doesn't belong to the same unit.\n+         --  If the source is an inherited naming exception, then it may not\n+         --  really exist: the source potentially replaced is left untouched.\n \n          if Source.Unit.File_Names (Source.Kind) /= Source then\n             Source.Unit.File_Names (Source.Kind).Unit := No_Unit_Index;\n@@ -6773,6 +6792,50 @@ package body Prj.Nmsc is\n                      Override_Kind (Name_Loc.Source, Sep);\n                   end if;\n                end if;\n+\n+               --  If this is an inherited naming exception, make sure that\n+               --  the naming exception it replaces is no longer a source.\n+\n+               if Name_Loc.Source.Naming_Exception = Inherited then\n+                  declare\n+                     Proj  : Project_Id := Name_Loc.Source.Project.Extends;\n+                     Iter  : Source_Iterator;\n+                     Src   : Source_Id;\n+                  begin\n+                     while Proj /= No_Project loop\n+                        Iter := For_Each_Source (Data.Tree, Proj);\n+                        Src := Prj.Element (Iter);\n+                        while Src /= No_Source loop\n+                           if Src.File = Name_Loc.Source.File then\n+                              Src.Replaced_By := Name_Loc.Source;\n+                              exit;\n+                           end if;\n+\n+                           Next (Iter);\n+                           Src := Prj.Element (Iter);\n+                        end loop;\n+\n+                        Proj := Proj.Extends;\n+                     end loop;\n+                  end;\n+\n+                  if Name_Loc.Source.Unit /= No_Unit_Index then\n+                     if Name_Loc.Source.Kind = Spec then\n+                        Name_Loc.Source.Unit.File_Names (Spec) :=\n+                          Name_Loc.Source;\n+\n+                     elsif Name_Loc.Source.Kind = Impl then\n+                        Name_Loc.Source.Unit.File_Names (Impl) :=\n+                          Name_Loc.Source;\n+                     end if;\n+\n+                     Units_Htable.Set\n+                       (Data.Tree.Units_HT,\n+                        Name_Loc.Source.Unit.Name,\n+                        Name_Loc.Source.Unit);\n+                  end if;\n+\n+               end if;\n             end if;\n          end if;\n       end if;\n@@ -6825,7 +6888,15 @@ package body Prj.Nmsc is\n                Name_Loc.Source := Source;\n                Source_Names_Htable.Set\n                  (Project.Source_Names, File_Name, Name_Loc);\n+\n             end if;\n+\n+--            if Source /= No_Source and then Source.Unit /= No_Unit_Index then\n+--               Units_Htable.Set\n+--                 (Data.Tree.Units_HT,\n+--                  Source.Unit.Name,\n+--                  Source.Unit);\n+--            end if;\n          end if;\n       end if;\n \n@@ -7518,6 +7589,7 @@ package body Prj.Nmsc is\n \n          if Source /= No_Source\n            and then Source.Path /= Src.Path\n+           and then Src.Project = Source.Project\n          then\n             Error_Msg_File_1 := Src.File;\n             Error_Msg_File_2 := Source.File;"}, {"sha": "cbe5142d1916649708b7aa1a57fe694bed0e3985", "filename": "gcc/ada/prj-proc.adb", "status": "modified", "additions": 39, "deletions": 45, "changes": 84, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-proc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-proc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -398,69 +398,62 @@ package body Prj.Proc is\n          Arr := Shared.Arrays.Table (A1);\n          A1  := Arr.Next;\n \n-         if not Restricted\n-           or else\n-             (Arr.Name /= Snames.Name_Body           and then\n-              Arr.Name /= Snames.Name_Spec           and then\n-              Arr.Name /= Snames.Name_Implementation and then\n-              Arr.Name /= Snames.Name_Specification)\n-         then\n-            --  Remove the Next component\n+         --  Remove the Next component\n \n-            Arr.Next := No_Array;\n-            Array_Table.Increment_Last (Shared.Arrays);\n+         Arr.Next := No_Array;\n+         Array_Table.Increment_Last (Shared.Arrays);\n \n-            --  Create new Array declaration\n+         --  Create new Array declaration\n \n-            if To.Arrays = No_Array then\n-               To.Arrays := Array_Table.Last (Shared.Arrays);\n-            else\n-               Shared.Arrays.Table (A2).Next :=\n-                 Array_Table.Last (Shared.Arrays);\n-            end if;\n+         if To.Arrays = No_Array then\n+            To.Arrays := Array_Table.Last (Shared.Arrays);\n+         else\n+            Shared.Arrays.Table (A2).Next :=\n+              Array_Table.Last (Shared.Arrays);\n+         end if;\n \n-            A2 := Array_Table.Last (Shared.Arrays);\n+         A2 := Array_Table.Last (Shared.Arrays);\n \n-            --  Don't store the array as its first element has not been set yet\n+         --  Don't store the array as its first element has not been set yet\n \n-            --  Copy the array elements of the array\n+         --  Copy the array elements of the array\n \n-            E1 := Arr.Value;\n-            Arr.Value := No_Array_Element;\n-            while E1 /= No_Array_Element loop\n+         E1 := Arr.Value;\n+         Arr.Value := No_Array_Element;\n+         while E1 /= No_Array_Element loop\n \n-               --  Copy the array element\n+            --  Copy the array element\n \n-               Elm := Shared.Array_Elements.Table (E1);\n-               E1 := Elm.Next;\n+            Elm := Shared.Array_Elements.Table (E1);\n+            E1 := Elm.Next;\n \n-               --  Remove the Next component\n+            --  Remove the Next component\n \n-               Elm.Next := No_Array_Element;\n+            Elm.Next := No_Array_Element;\n \n-               --  Change the location\n+            Elm.Restricted := Restricted;\n+            --  Change the location\n \n-               Elm.Value.Location := New_Loc;\n-               Array_Element_Table.Increment_Last (Shared.Array_Elements);\n+            Elm.Value.Location := New_Loc;\n+            Array_Element_Table.Increment_Last (Shared.Array_Elements);\n \n-               --  Create new array element\n+            --  Create new array element\n \n-               if Arr.Value = No_Array_Element then\n-                  Arr.Value :=\n-                    Array_Element_Table.Last (Shared.Array_Elements);\n-               else\n-                  Shared.Array_Elements.Table (E2).Next :=\n-                    Array_Element_Table.Last (Shared.Array_Elements);\n-               end if;\n+            if Arr.Value = No_Array_Element then\n+               Arr.Value :=\n+                 Array_Element_Table.Last (Shared.Array_Elements);\n+            else\n+               Shared.Array_Elements.Table (E2).Next :=\n+                 Array_Element_Table.Last (Shared.Array_Elements);\n+            end if;\n \n-               E2 := Array_Element_Table.Last (Shared.Array_Elements);\n-               Shared.Array_Elements.Table (E2) := Elm;\n-            end loop;\n+            E2 := Array_Element_Table.Last (Shared.Array_Elements);\n+            Shared.Array_Elements.Table (E2) := Elm;\n+         end loop;\n \n-            --  Finally, store the new array\n+         --  Finally, store the new array\n \n-            Shared.Arrays.Table (A2) := Arr;\n-         end if;\n+         Shared.Arrays.Table (A2) := Arr;\n       end loop;\n    end Copy_Package_Declarations;\n \n@@ -1940,6 +1933,7 @@ package body Prj.Proc is\n             Shared.Array_Elements.Table\n               (Elem) :=\n               (Index                => Index_Name,\n+               Restricted           => False,\n                Src_Index            => Source_Index,\n                Index_Case_Sensitive =>\n                   not Case_Insensitive (Current, Node_Tree),"}, {"sha": "c1f9409de1526b258b5aef6e9065793fdeaa58e3", "filename": "gcc/ada/prj-util.adb", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-util.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -757,8 +757,11 @@ package body Prj.Util is\n                elsif Name_Buffer (1 .. 2) = \"I=\" then\n                   Info.Info.Index := Int'Value (Name_Buffer (3 .. Name_Len));\n \n-               elsif Name_Buffer (1 .. Name_Len) = \"N=T\" then\n-                  Info.Info.Naming_Exception := True;\n+               elsif Name_Buffer (1 .. Name_Len) = \"N=Y\" then\n+                  Info.Info.Naming_Exception := Yes;\n+\n+               elsif Name_Buffer (1 .. Name_Len) = \"N=I\" then\n+                  Info.Info.Naming_Exception := Inherited;\n \n                else\n                   Report_Error;\n@@ -1116,8 +1119,11 @@ package body Prj.Util is\n \n             --  Naming exception (\"N=T\");\n \n-            if Source.Naming_Exception then\n-               Put_Line (File, \"N=T\");\n+            if Source.Naming_Exception = Yes then\n+               Put_Line (File, \"N=Y\");\n+\n+            elsif Source.Naming_Exception = Inherited then\n+               Put_Line (File, \"N=I\");\n             end if;\n \n             --  Empty line to indicate end of info on this source"}, {"sha": "b457a5ea1f7450f80591ba3edf00be2e4cea0fd6", "filename": "gcc/ada/prj-util.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-util.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj-util.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-util.ads?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -210,7 +210,7 @@ package Prj.Util is\n       Path_Name           : Name_Id;\n       Unit_Name           : Name_Id := No_Name;\n       Index               : Int := 0;\n-      Naming_Exception    : Boolean := False;\n+      Naming_Exception    : Naming_Exception_Type := No;\n    end record;\n    --  Data read from a source info file for a single source\n "}, {"sha": "0c404201c0f61a8545871af6e8c4bf69fdd09e08", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -187,6 +187,7 @@ package Prj is\n    No_Array_Element : constant Array_Element_Id := 0;\n    type Array_Element is record\n       Index                : Name_Id;\n+      Restricted : Boolean := False;\n       Src_Index            : Int := 0;\n       Index_Case_Sensitive : Boolean := True;\n       Value                : Variable_Value;\n@@ -679,6 +680,8 @@ package Prj is\n    --  corresponding to an Ada file). In general, these are dependencies that\n    --  cannot be computed automatically by the builder.\n \n+   type Naming_Exception_Type is (No, Yes, Inherited);\n+\n    --  Structure to define source data\n \n    type Source_Data is record\n@@ -791,7 +794,7 @@ package Prj is\n       Switches_TS : Time_Stamp_Type := Empty_Time_Stamp;\n       --  Switches file time stamp\n \n-      Naming_Exception : Boolean := False;\n+      Naming_Exception : Naming_Exception_Type := No;\n       --  True if the source has an exceptional name\n \n       Duplicate_Unit : Boolean := False;\n@@ -840,7 +843,7 @@ package Prj is\n                        Switches               => No_File,\n                        Switches_Path          => No_Path,\n                        Switches_TS            => Empty_Time_Stamp,\n-                       Naming_Exception       => False,\n+                       Naming_Exception       => No,\n                        Duplicate_Unit         => False,\n                        Next_In_Lang           => No_Source,\n                        Next_With_File_Name    => No_Source,\n@@ -864,14 +867,6 @@ package Prj is\n       Equal      => \"=\");\n    --  Mapping of source paths to source ids\n \n-   package Unit_Sources_Htable is new Simple_HTable\n-     (Header_Num => Header_Num,\n-      Element    => Source_Id,\n-      No_Element => No_Source,\n-      Key        => Name_Id,\n-      Hash       => Hash,\n-      Equal      => \"=\");\n-\n    type Lib_Kind is (Static, Dynamic, Relocatable);\n \n    type Policy is (Autonomous, Compliant, Controlled, Restricted, Direct);"}, {"sha": "6eeaf62a014ea7d60e9a4cf98a4f4db5ba7a81d7", "filename": "gcc/ada/s-taprop-linux.adb", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fs-taprop-linux.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fs-taprop-linux.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-taprop-linux.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -870,7 +870,8 @@ package body System.Task_Primitives.Operations is\n       elsif T.Common.Base_CPU /= System.Multiprocessors.Not_A_Specific_CPU then\n          declare\n             CPUs    : constant size_t :=\n-              Interfaces.C.size_t (System.Multiprocessors.Number_Of_CPUs);\n+                        Interfaces.C.size_t\n+                          (System.Multiprocessors.Number_Of_CPUs);\n             CPU_Set : constant cpu_set_t_ptr := CPU_ALLOC (CPUs);\n             Size    : constant size_t := CPU_ALLOC_SIZE (CPUs);\n \n@@ -909,7 +910,8 @@ package body System.Task_Primitives.Operations is\n       then\n          declare\n             CPUs    : constant size_t :=\n-              Interfaces.C.size_t (System.Multiprocessors.Number_Of_CPUs);\n+                        Interfaces.C.size_t\n+                          (System.Multiprocessors.Number_Of_CPUs);\n             CPU_Set : constant cpu_set_t_ptr := CPU_ALLOC (CPUs);\n             Size    : constant size_t := CPU_ALLOC_SIZE (CPUs);\n \n@@ -943,6 +945,7 @@ package body System.Task_Primitives.Operations is\n          Attributes'Access,\n          Thread_Body_Access (Wrapper),\n          To_Address (T));\n+\n       pragma Assert\n         (Result = 0 or else Result = EAGAIN or else Result = ENOMEM);\n \n@@ -985,6 +988,7 @@ package body System.Task_Primitives.Operations is\n       if T.Known_Tasks_Index /= -1 then\n          Known_Tasks (T.Known_Tasks_Index) := null;\n       end if;\n+\n       SC.Invalidate_Stack_Cache (T.Common.Compiler_Data.Pri_Stack_Info'Access);\n       Free (Tmp);\n \n@@ -1403,7 +1407,8 @@ package body System.Task_Primitives.Operations is\n       then\n          declare\n             CPUs    : constant size_t :=\n-              Interfaces.C.size_t (System.Multiprocessors.Number_Of_CPUs);\n+                        Interfaces.C.size_t\n+                          (System.Multiprocessors.Number_Of_CPUs);\n             CPU_Set : cpu_set_t_ptr := null;\n             Size    : constant size_t := CPU_ALLOC_SIZE (CPUs);\n "}, {"sha": "91e30e65d3998c9895f6e63edd94c01e047ae383", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f55bc6268042e7bb53627f366fa0e2d0e626ff5/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=9f55bc6268042e7bb53627f366fa0e2d0e626ff5", "patch": "@@ -15761,7 +15761,7 @@ package body Sem_Ch3 is\n                Set_Anonymous_Type (New_C);\n \n             elsif (Is_Private_Type (Derived_Base)\n-                     and then not Is_Generic_Type (Derived_Base))\n+                    and then not Is_Generic_Type (Derived_Base))\n               or else (Is_Empty_Elmt_List (Discs)\n                          and then not Expander_Active)\n             then\n@@ -15784,9 +15784,10 @@ package body Sem_Ch3 is\n                --        type T_2 is new Pack_1.T_1 with ...;\n                --     end Pack_2;\n \n-               Set_Etype (New_C,\n-                 Constrain_Component_Type\n-                   (Old_C, Derived_Base, N, Parent_Base, Discs));\n+               Set_Etype\n+                 (New_C,\n+                  Constrain_Component_Type\n+                    (Old_C, Derived_Base, N, Parent_Base, Discs));\n             end if;\n          end if;\n "}]}