{"sha": "d3f3c68099db421a58a9b8989781e0c4db31c61e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDNmM2M2ODA5OWRiNDIxYTU4YTliODk4OTc4MWUwYzRkYjMxYzYxZQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-08-08T13:09:19Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-08-08T13:09:19Z"}, "message": "PR libstdc++/86597 directory_entry observers should clear error_code\n\n\tPR libstdc++/86597\n\t* include/bits/fs_dir.h (directory_entry::_M_file_type(error_code&)):\n\tClear error_code when cached type is used.\n\t* testsuite/27_io/filesystem/directory_entry/86597.cc: New test.\n\nFrom-SVN: r263397", "tree": {"sha": "29adf3859b0ee19fd8c4b9249d7b7b0c61f48086", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29adf3859b0ee19fd8c4b9249d7b7b0c61f48086"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d3f3c68099db421a58a9b8989781e0c4db31c61e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3f3c68099db421a58a9b8989781e0c4db31c61e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3f3c68099db421a58a9b8989781e0c4db31c61e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3f3c68099db421a58a9b8989781e0c4db31c61e/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f3c21d62131d5b7224de862061d133d3dba6514", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f3c21d62131d5b7224de862061d133d3dba6514", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f3c21d62131d5b7224de862061d133d3dba6514"}], "stats": {"total": 86, "additions": 85, "deletions": 1}, "files": [{"sha": "8ac6a729a0651f8c0408e33de5871037758caa6d", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3f3c68099db421a58a9b8989781e0c4db31c61e/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3f3c68099db421a58a9b8989781e0c4db31c61e/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=d3f3c68099db421a58a9b8989781e0c4db31c61e", "patch": "@@ -1,3 +1,10 @@\n+2018-08-08  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/86597\n+\t* include/bits/fs_dir.h (directory_entry::_M_file_type(error_code&)):\n+\tClear error_code when cached type is used.\n+\t* testsuite/27_io/filesystem/directory_entry/86597.cc: New test.\n+\n 2018-08-07  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/86874"}, {"sha": "9ee1cb66b611c91ed63159baba79d5abd4345817", "filename": "libstdc++-v3/include/bits/fs_dir.h", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3f3c68099db421a58a9b8989781e0c4db31c61e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffs_dir.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3f3c68099db421a58a9b8989781e0c4db31c61e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffs_dir.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffs_dir.h?ref=d3f3c68099db421a58a9b8989781e0c4db31c61e", "patch": "@@ -318,7 +318,10 @@ _GLIBCXX_BEGIN_NAMESPACE_CXX11\n     _M_file_type(error_code& __ec) const noexcept\n     {\n       if (_M_type != file_type::none && _M_type != file_type::symlink)\n-\treturn _M_type;\n+\t{\n+\t  __ec.clear();\n+\t  return _M_type;\n+\t}\n       return status(__ec).type();\n     }\n "}, {"sha": "6ca635e16e33cc8d8b22e90cdd6b77a24614bcdb", "filename": "libstdc++-v3/testsuite/27_io/filesystem/directory_entry/86597.cc", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3f3c68099db421a58a9b8989781e0c4db31c61e/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fdirectory_entry%2F86597.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3f3c68099db421a58a9b8989781e0c4db31c61e/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fdirectory_entry%2F86597.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fdirectory_entry%2F86597.cc?ref=d3f3c68099db421a58a9b8989781e0c4db31c61e", "patch": "@@ -0,0 +1,74 @@\n+// Copyright (C) 2018 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++17 -lstdc++fs\" }\n+// { dg-do run { target c++17 } }\n+// { dg-require-filesystem-ts \"\" }\n+\n+#include <filesystem>\n+#include <system_error>\n+#include <testsuite_hooks.h>\n+#include <testsuite_fs.h>\n+\n+// PR libstdc++/86597\n+\n+void\n+test01()\n+{\n+  const auto bad_ec = make_error_code(std::errc::address_in_use);\n+  std::error_code ec;\n+  std::filesystem::directory_entry ent(\".\");\n+\n+  ec = bad_ec;\n+  VERIFY( ent.exists(ec) );\n+  VERIFY( !ec );\n+\n+  ec = bad_ec;\n+  VERIFY( ent.is_directory(ec) );\n+  VERIFY( !ec );\n+\n+  ec = bad_ec;\n+  VERIFY( !ent.is_regular_file(ec) );\n+  VERIFY( !ec );\n+}\n+\n+void\n+test02()\n+{\n+  const auto bad_ec = make_error_code(std::errc::address_in_use);\n+  std::error_code ec;\n+  std::filesystem::directory_entry ent(__gnu_test::nonexistent_path());\n+\n+  ec = bad_ec;\n+  VERIFY( !ent.exists(ec) );\n+  VERIFY( !ec );\n+\n+  ec = bad_ec;\n+  VERIFY( !ent.is_directory(ec) );\n+  VERIFY( !ec );\n+\n+  ec = bad_ec;\n+  VERIFY( !ent.is_regular_file(ec) );\n+  VERIFY( !ec );\n+}\n+\n+int\n+main()\n+{\n+  test01();\n+  test02();\n+}"}]}