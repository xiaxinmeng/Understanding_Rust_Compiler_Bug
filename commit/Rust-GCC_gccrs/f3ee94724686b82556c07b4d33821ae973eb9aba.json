{"sha": "f3ee94724686b82556c07b4d33821ae973eb9aba", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjNlZTk0NzI0Njg2YjgyNTU2YzA3YjRkMzM4MjFhZTk3M2ViOWFiYQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2020-10-15T16:54:16Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2020-10-15T17:27:37Z"}, "message": "c++: Fix [[deprecated]] and implicit operator==. [PR97358]\n\nTrying to diagnose the problem with an implicit copy function breaks if the\nfunction isn't actually a copy function.\n\ngcc/cp/ChangeLog:\n\n\tPR c++/95844\n\t* decl.c (copy_fn_p): Return false for a function that is neither a\n\tconstructor nor an assignment operator.\n\t(move_signature_fn_p): Likewise.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/95844\n\t* g++.dg/cpp2a/spaceship-eq10.C: New test.", "tree": {"sha": "c95ec49d46d3521bd44cd22bdc5bb386ea2fb5cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c95ec49d46d3521bd44cd22bdc5bb386ea2fb5cd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f3ee94724686b82556c07b4d33821ae973eb9aba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3ee94724686b82556c07b4d33821ae973eb9aba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f3ee94724686b82556c07b4d33821ae973eb9aba", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3ee94724686b82556c07b4d33821ae973eb9aba/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "782ebeaa681163cfd0c59f03cd850fdd52287b79", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/782ebeaa681163cfd0c59f03cd850fdd52287b79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/782ebeaa681163cfd0c59f03cd850fdd52287b79"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "5f370e60b4e809d7de45f23c697627cb239488f0", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3ee94724686b82556c07b4d33821ae973eb9aba/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3ee94724686b82556c07b4d33821ae973eb9aba/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=f3ee94724686b82556c07b4d33821ae973eb9aba", "patch": "@@ -14169,6 +14169,10 @@ copy_fn_p (const_tree d)\n        accept those as copy functions.  */\n     return 0;\n \n+  if (!DECL_CONSTRUCTOR_P (d)\n+      && DECL_NAME (d) != assign_op_identifier)\n+    return 0;\n+\n   args = FUNCTION_FIRST_USER_PARMTYPE (d);\n   if (!args)\n     return 0;\n@@ -14242,6 +14246,10 @@ move_signature_fn_p (const_tree d)\n   tree arg_type;\n   bool result = false;\n \n+  if (!DECL_CONSTRUCTOR_P (d)\n+      && DECL_NAME (d) != assign_op_identifier)\n+    return 0;\n+\n   args = FUNCTION_FIRST_USER_PARMTYPE (d);\n   if (!args)\n     return 0;"}, {"sha": "93f5e253af4babac09d635ebb14007a6af119ef4", "filename": "gcc/testsuite/g++.dg/cpp2a/spaceship-eq10.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3ee94724686b82556c07b4d33821ae973eb9aba/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fspaceship-eq10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3ee94724686b82556c07b4d33821ae973eb9aba/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fspaceship-eq10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fspaceship-eq10.C?ref=f3ee94724686b82556c07b4d33821ae973eb9aba", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/95844\n+// { dg-do compile { target c++20 } }\n+\n+#include <compare>\n+\n+struct F {\n+  [[deprecated(\"oh no\")]] std::strong_ordering operator<=>(const F&) const = default; // { dg-message \"\" }\n+};\n+void use_f(F f) {\n+  void(f == f);\t\t\t// { dg-warning \"deprecated\" }\n+}"}]}