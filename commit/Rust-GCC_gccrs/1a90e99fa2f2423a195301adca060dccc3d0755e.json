{"sha": "1a90e99fa2f2423a195301adca060dccc3d0755e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWE5MGU5OWZhMmYyNDIzYTE5NTMwMWFkY2EwNjBkY2NjM2QwNzU1ZQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-11-13T20:15:40Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-11-13T20:15:40Z"}, "message": "Fix modref insertion hook.\n\n\t* ipa-modref.c (modref_summaries::insert,\n\tmodref_summaries_lto::insert): Remove summary if ipa-modref is disabled.", "tree": {"sha": "6194970631a13326d219fb8685ce4da06b77d4b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6194970631a13326d219fb8685ce4da06b77d4b1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a90e99fa2f2423a195301adca060dccc3d0755e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a90e99fa2f2423a195301adca060dccc3d0755e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a90e99fa2f2423a195301adca060dccc3d0755e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a90e99fa2f2423a195301adca060dccc3d0755e/comments", "author": null, "committer": null, "parents": [{"sha": "8fca8142bc0b7b7831644f8c7f6d24ebb8a72dbe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fca8142bc0b7b7831644f8c7f6d24ebb8a72dbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8fca8142bc0b7b7831644f8c7f6d24ebb8a72dbe"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "a9797b26b8da2b48012fc06e254746829b2679df", "filename": "gcc/ipa-modref.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a90e99fa2f2423a195301adca060dccc3d0755e/gcc%2Fipa-modref.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a90e99fa2f2423a195301adca060dccc3d0755e/gcc%2Fipa-modref.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-modref.c?ref=1a90e99fa2f2423a195301adca060dccc3d0755e", "patch": "@@ -1273,7 +1273,8 @@ modref_summaries::insert (struct cgraph_node *node, modref_summary *)\n       optimization_summaries->remove (node);\n       return;\n     }\n-  if (!DECL_STRUCT_FUNCTION (node->decl))\n+  if (!DECL_STRUCT_FUNCTION (node->decl)\n+      || !opt_for_fn (node->decl, flag_ipa_modref))\n     {\n       summaries->remove (node);\n       return;\n@@ -1292,6 +1293,7 @@ modref_summaries_lto::insert (struct cgraph_node *node, modref_summary_lto *)\n      propagated.  This is done only by SIMD cloning that is not very\n      critical.  */\n   if (!DECL_STRUCT_FUNCTION (node->decl)\n+      || !opt_for_fn (node->decl, flag_ipa_modref)\n       || propagated)\n     {\n       summaries_lto->remove (node);"}]}