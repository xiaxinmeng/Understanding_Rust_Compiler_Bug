{"sha": "2821fc6b76973dd6cb956229027e8e065a020424", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjgyMWZjNmI3Njk3M2RkNmNiOTU2MjI5MDI3ZThlMDY1YTAyMDQyNA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2015-04-20T21:46:59Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2015-04-20T21:46:59Z"}, "message": "re PR c++/65801 (Allow -Wno-narrowing to silence stricter C++11 narrowing rules)\n\n/cp\n2015-04-20  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/65801\n\t* typeck2.c (check_narrowing): In C++11 mode too, -Wno-narrowing\n\tsuppresses the diagnostic.\n\n2015-04-20  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/65801\n\t* doc/invoke.texi ([-Wnarrowing]): Update.\n\n/testsuite\n2015-04-20  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/65801\n\t* g++.dg/cpp0x/Wnarrowing2.C: New.\n\nFrom-SVN: r222249", "tree": {"sha": "c480f351c7ba24f67f191101ecd98811337923b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c480f351c7ba24f67f191101ecd98811337923b2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2821fc6b76973dd6cb956229027e8e065a020424", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2821fc6b76973dd6cb956229027e8e065a020424", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2821fc6b76973dd6cb956229027e8e065a020424", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2821fc6b76973dd6cb956229027e8e065a020424/comments", "author": null, "committer": null, "parents": [{"sha": "0cfabb3780b23de06e8fd52bfe15b2aea7b56f42", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cfabb3780b23de06e8fd52bfe15b2aea7b56f42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0cfabb3780b23de06e8fd52bfe15b2aea7b56f42"}], "stats": {"total": 39, "additions": 32, "deletions": 7}, "files": [{"sha": "659ac0133abff5646f9350d4450418438d36a6e5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2821fc6b76973dd6cb956229027e8e065a020424", "patch": "@@ -1,3 +1,8 @@\n+2015-04-20  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/65801\n+\t* doc/invoke.texi ([-Wnarrowing]): Update.\n+\n 2015-04-20  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/65658"}, {"sha": "91c389052c6f88e6fe263652b6db89d596f39722", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2821fc6b76973dd6cb956229027e8e065a020424", "patch": "@@ -1,3 +1,9 @@\n+2015-04-20  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/65801\n+\t* typeck2.c (check_narrowing): In C++11 mode too, -Wno-narrowing\n+\tsuppresses the diagnostic.\n+\n 2015-04-20  Ville Voutilainen  <ville.voutilainen@gmail.com>\n \n \tReject trailing return type for an operator auto()."}, {"sha": "884957bc9bbf19cc6df82dd63f75f0e8d7b66718", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=2821fc6b76973dd6cb956229027e8e065a020424", "patch": "@@ -957,9 +957,13 @@ check_narrowing (tree type, tree init, tsubst_flags_t complain)\n \t    }\n \t}\n       else if (complain & tf_error)\n-\terror_at (EXPR_LOC_OR_LOC (init, input_location),\n-\t\t  \"narrowing conversion of %qE from %qT to %qT inside { }\",\n-\t\t  init, ftype, type);\n+\t{\n+\t  global_dc->pedantic_errors = 1;\n+\t  pedwarn (EXPR_LOC_OR_LOC (init, input_location), OPT_Wnarrowing,\n+\t\t   \"narrowing conversion of %qE from %qT to %qT inside { }\",\n+\t\t   init, ftype, type);\n+\t  global_dc->pedantic_errors = flag_pedantic_errors;\n+\t}\n     }\n \n   return cxx_dialect == cxx98 || ok; "}, {"sha": "c20dd4d58cb193f2cc45c74697f077b6dd96a28b", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=2821fc6b76973dd6cb956229027e8e065a020424", "patch": "@@ -2706,10 +2706,10 @@ int i = @{ 2.2 @}; // error: narrowing from double to int\n \n This flag is included in @option{-Wall} and @option{-Wc++11-compat}.\n \n-With @option{-std=c++11}, @option{-Wno-narrowing} suppresses for\n-non-constants the diagnostic required by the standard.  Note that this\n-does not affect the meaning of well-formed code; narrowing conversions\n-are still considered ill-formed in SFINAE context.\n+With @option{-std=c++11}, @option{-Wno-narrowing} suppresses the diagnostic\n+required by the standard.  Note that this does not affect the meaning\n+of well-formed code; narrowing conversions are still considered\n+ill-formed in SFINAE context.\n \n @item -Wnoexcept @r{(C++ and Objective-C++ only)}\n @opindex Wnoexcept"}, {"sha": "8ffe2eac523bcdbb6d30aaa8a63b62de5bdf83a4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2821fc6b76973dd6cb956229027e8e065a020424", "patch": "@@ -1,3 +1,8 @@\n+2015-04-20  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/65801\n+\t* g++.dg/cpp0x/Wnarrowing2.C: New.\n+\n 2015-04-20  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/65658"}, {"sha": "fc806f955fa6e10ce7d9f40ae49ff6d1c95c0e7e", "filename": "gcc/testsuite/g++.dg/cpp0x/Wnarrowing2.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWnarrowing2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2821fc6b76973dd6cb956229027e8e065a020424/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWnarrowing2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2FWnarrowing2.C?ref=2821fc6b76973dd6cb956229027e8e065a020424", "patch": "@@ -0,0 +1,5 @@\n+// PR c++/65801\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-Wno-narrowing\" }\n+\n+static struct zai { unsigned int x; } x = {-1};"}]}