{"sha": "756d6ee965cd678839c99b8ada229d20ec4ca20c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzU2ZDZlZTk2NWNkNjc4ODM5Yzk5YjhhZGEyMjlkMjBlYzRjYTIwYw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2011-04-01T20:23:00Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2011-04-01T20:23:00Z"}, "message": "re PR bootstrap/48400 (powerpc-apple-darwin9 fails to bootstrap at revision 171824)\n\nPR 48400\n* dwarf2out.c (dwarf2out_source_line): Disable discriminators\nin strict mode before dwarf4.  Re-order tests to early out\nbefore switching sections.\n\nFrom-SVN: r171852", "tree": {"sha": "35958641e35ad5795a7ee6a34c2c80671ea37f14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/35958641e35ad5795a7ee6a34c2c80671ea37f14"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/756d6ee965cd678839c99b8ada229d20ec4ca20c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/756d6ee965cd678839c99b8ada229d20ec4ca20c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/756d6ee965cd678839c99b8ada229d20ec4ca20c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/756d6ee965cd678839c99b8ada229d20ec4ca20c/comments", "author": null, "committer": null, "parents": [{"sha": "ceaaaeabf66c30a14b70f2d3a86faeb9b9f68a80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ceaaaeabf66c30a14b70f2d3a86faeb9b9f68a80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ceaaaeabf66c30a14b70f2d3a86faeb9b9f68a80"}], "stats": {"total": 36, "additions": 31, "deletions": 5}, "files": [{"sha": "d5733e0e915e0f0368e3369e78a479ee0bcf711b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/756d6ee965cd678839c99b8ada229d20ec4ca20c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/756d6ee965cd678839c99b8ada229d20ec4ca20c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=756d6ee965cd678839c99b8ada229d20ec4ca20c", "patch": "@@ -1,3 +1,10 @@\n+2011-04-01  Richard Henderson  <rth@redhat.com>\n+\n+\tPR 48400\n+\t* dwarf2out.c (dwarf2out_source_line): Disable discriminators\n+\tin strict mode before dwarf4.  Re-order tests to early out\n+\tbefore switching sections.\n+\n 2011-04-01  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* config/h8300/constraints.md: New file."}, {"sha": "b299bc7926ad880e870ada6faa079baf01f5803c", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 24, "deletions": 5, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/756d6ee965cd678839c99b8ada229d20ec4ca20c/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/756d6ee965cd678839c99b8ada229d20ec4ca20c/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=756d6ee965cd678839c99b8ada229d20ec4ca20c", "patch": "@@ -22132,21 +22132,40 @@ dwarf2out_source_line (unsigned int line, const char *filename,\n   if (debug_info_level < DINFO_LEVEL_NORMAL || line == 0)\n     return;\n \n-  switch_to_section (current_function_section ());\n-\n-  /* If requested, emit something human-readable.  */\n-  if (flag_debug_asm)\n-    fprintf (asm_out_file, \"\\t%s %s:%d\\n\", ASM_COMMENT_START, filename, line);\n+  /* The discriminator column was added in dwarf4.  Simplify the below\n+     by simply removing it if we're not supposed to output it.  */\n+  if (dwarf_version < 4 && dwarf_strict)\n+    discriminator = 0;\n \n   table = cur_line_info_table;\n   file_num = maybe_emit_file (lookup_filename (filename));\n \n+  /* ??? TODO: Elide duplicate line number entries.  Traditionally,\n+     the debugger has used the second (possibly duplicate) line number\n+     at the beginning of the function to mark the end of the prologue.\n+     We could eliminate any other duplicates within the function.  For\n+     Dwarf3, we ought to include the DW_LNS_set_prologue_end mark in\n+     that second line number entry.  */\n+  /* Recall that this end-of-prologue indication is *not* the same thing\n+     as the end_prologue debug hook.  The NOTE_INSN_PROLOGUE_END note,\n+     to which the hook corresponds, follows the last insn that was \n+     emitted by gen_prologue.  What we need is to preceed the first insn\n+     that had been emitted after NOTE_INSN_FUNCTION_BEG, i.e. the first\n+     insn that corresponds to something the user wrote.  These may be\n+     very different locations once scheduling is enabled.  */\n+\n   if (0 && file_num == table->file_num\n       && line == table->line_num\n       && discriminator == table->discrim_num\n       && is_stmt == table->is_stmt)\n     return;\n \n+  switch_to_section (current_function_section ());\n+\n+  /* If requested, emit something human-readable.  */\n+  if (flag_debug_asm)\n+    fprintf (asm_out_file, \"\\t%s %s:%d\\n\", ASM_COMMENT_START, filename, line);\n+\n   if (DWARF2_ASM_LINE_DEBUG_INFO)\n     {\n       /* Emit the .loc directive understood by GNU as.  */"}]}