{"sha": "91c50487de75a5275e2e8c2e1cd4b10f3a59b7df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTFjNTA0ODdkZTc1YTUyNzVlMmU4YzJlMWNkNGIxMGYzYTU5YjdkZg==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-02-13T06:57:38Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-02-13T06:57:38Z"}, "message": "Remove a barrier when EDGE_CROSSING is removed (PR lto/88858).\n\n2019-02-13  Martin Liska  <mliska@suse.cz>\n\n\tPR lto/88858\n\t* cfgrtl.c (remove_barriers_from_footer): New function.\n\t(try_redirect_by_replacing_jump): Use it.\n\t(cfg_layout_redirect_edge_and_branch): Likewise.\n\nFrom-SVN: r268835", "tree": {"sha": "36713c68c860fd8f4790d7bedf8f020b1709bd9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36713c68c860fd8f4790d7bedf8f020b1709bd9c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d60a02c80d3b8b6295f31c7c05a03a7c9d16f5d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d60a02c80d3b8b6295f31c7c05a03a7c9d16f5d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d60a02c80d3b8b6295f31c7c05a03a7c9d16f5d6"}], "stats": {"total": 53, "additions": 34, "deletions": 19}, "files": [{"sha": "533ab59b6bbf7df7f9f2c1421d1864a6c57427d8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=91c50487de75a5275e2e8c2e1cd4b10f3a59b7df", "patch": "@@ -1,3 +1,10 @@\n+2019-02-13  Martin Liska  <mliska@suse.cz>\n+\n+\tPR lto/88858\n+\t* cfgrtl.c (remove_barriers_from_footer): New function.\n+\t(try_redirect_by_replacing_jump): Use it.\n+\t(cfg_layout_redirect_edge_and_branch): Likewise.\n+\n 2019-02-13  Xiong Hu Luo  <luoxhu@linux.vnet.ibm.com>\n \n \t* config/rs6000/altivec.h (vec_sbox_be, vec_cipher_be,"}, {"sha": "56564c2fda7aa03b0283e545fd222066dfd1dc39", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 27, "deletions": 19, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91c50487de75a5275e2e8c2e1cd4b10f3a59b7df/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=91c50487de75a5275e2e8c2e1cd4b10f3a59b7df", "patch": "@@ -988,6 +988,31 @@ block_label (basic_block block)\n   return as_a <rtx_code_label *> (BB_HEAD (block));\n }\n \n+/* Remove all barriers from BB_FOOTER of a BB.  */\n+\n+static void\n+remove_barriers_from_footer (basic_block bb)\n+{\n+  rtx_insn *insn = BB_FOOTER (bb);\n+\n+  /* Remove barriers but keep jumptables.  */\n+  while (insn)\n+    {\n+      if (BARRIER_P (insn))\n+\t{\n+\t  if (PREV_INSN (insn))\n+\t    SET_NEXT_INSN (PREV_INSN (insn)) = NEXT_INSN (insn);\n+\t  else\n+\t    BB_FOOTER (bb) = NEXT_INSN (insn);\n+\t  if (NEXT_INSN (insn))\n+\t    SET_PREV_INSN (NEXT_INSN (insn)) = PREV_INSN (insn);\n+\t}\n+      if (LABEL_P (insn))\n+\treturn;\n+      insn = NEXT_INSN (insn);\n+    }\n+}\n+\n /* Attempt to perform edge redirection by replacing possibly complex jump\n    instruction by unconditional jump or removing jump completely.  This can\n    apply only if all edges now point to the same block.  The parameters and\n@@ -1051,26 +1076,8 @@ try_redirect_by_replacing_jump (edge e, basic_block target, bool in_cfglayout)\n       /* Selectively unlink whole insn chain.  */\n       if (in_cfglayout)\n \t{\n-\t  rtx_insn *insn = BB_FOOTER (src);\n-\n \t  delete_insn_chain (kill_from, BB_END (src), false);\n-\n-\t  /* Remove barriers but keep jumptables.  */\n-\t  while (insn)\n-\t    {\n-\t      if (BARRIER_P (insn))\n-\t\t{\n-\t\t  if (PREV_INSN (insn))\n-\t\t    SET_NEXT_INSN (PREV_INSN (insn)) = NEXT_INSN (insn);\n-\t\t  else\n-\t\t    BB_FOOTER (src) = NEXT_INSN (insn);\n-\t\t  if (NEXT_INSN (insn))\n-\t\t    SET_PREV_INSN (NEXT_INSN (insn)) = PREV_INSN (insn);\n-\t\t}\n-\t      if (LABEL_P (insn))\n-\t\tbreak;\n-\t      insn = NEXT_INSN (insn);\n-\t    }\n+\t  remove_barriers_from_footer (src);\n \t}\n       else\n \tdelete_insn_chain (kill_from, PREV_INSN (BB_HEAD (target)),\n@@ -4396,6 +4403,7 @@ cfg_layout_redirect_edge_and_branch (edge e, basic_block dest)\n \t  \t \"Removing crossing jump while redirecting edge form %i to %i\\n\",\n \t\t e->src->index, dest->index);\n       delete_insn (BB_END (src));\n+      remove_barriers_from_footer (src);\n       e->flags |= EDGE_FALLTHRU;\n     }\n "}]}