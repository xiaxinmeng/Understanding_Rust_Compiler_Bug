{"sha": "b13024e6ad35ad6b55d667448846ef1d0d7aa115", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjEzMDI0ZTZhZDM1YWQ2YjU1ZDY2NzQ0ODg0NmVmMWQwZDdhYTExNQ==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2012-06-19T16:32:57Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2012-06-19T16:32:57Z"}, "message": "i386.md (FRNDINT_ROUNDING): New int iterator.\n\n\t* config/i386/i386.md (FRNDINT_ROUNDING): New int iterator.\n\t(rounding): New int attribute.\n\t(ROUNDING): Ditto.\n\t(frndintxf2_<rounding>): Macroize insn from\n\tfrndintxf2_{floor,ceil,trunc} using FRNDINT_ROUNDING int iterator.\n\t(frndintxf2_<rounding>_i387): Macroize insn from\n\tfrndintxf2_{floor,ceil,trunc}_i387 using FRNDINT_ROUNDING int iterator.\n\nFrom-SVN: r188783", "tree": {"sha": "be3a52832053409ccfd1151182d7097724967abc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be3a52832053409ccfd1151182d7097724967abc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b13024e6ad35ad6b55d667448846ef1d0d7aa115", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b13024e6ad35ad6b55d667448846ef1d0d7aa115", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b13024e6ad35ad6b55d667448846ef1d0d7aa115", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b13024e6ad35ad6b55d667448846ef1d0d7aa115/comments", "author": null, "committer": null, "parents": [{"sha": "d35d1c0fee58f7b141f535cb0f4800c471a6b00d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35d1c0fee58f7b141f535cb0f4800c471a6b00d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d35d1c0fee58f7b141f535cb0f4800c471a6b00d"}], "stats": {"total": 129, "additions": 38, "deletions": 91}, "files": [{"sha": "33379aec2094eaf1ae1d65ca819e3a19db62d7e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13024e6ad35ad6b55d667448846ef1d0d7aa115/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13024e6ad35ad6b55d667448846ef1d0d7aa115/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b13024e6ad35ad6b55d667448846ef1d0d7aa115", "patch": "@@ -1,3 +1,13 @@\n+2012-06-19  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\t* config/i386/i386.md (FRNDINT_ROUNDING): New int iterator.\n+\t(rounding): New int attribute.\n+\t(ROUNDING): Ditto.\n+\t(frndintxf2_<rounding>): Macroize insn from\n+\tfrndintxf2_{floor,ceil,trunc} using FRNDINT_ROUNDING int iterator.\n+\t(frndintxf2_<rounding>_i387): Macroize insn from\n+\tfrndintxf2_{floor,ceil,trunc}_i387 using FRNDINT_ROUNDING int iterator.\n+\n 2012-06-19  Richard Guenther  <rguenther@suse.de>\n \n \t* tree-vrp.c (union_ranges): New function.\n@@ -335,7 +345,7 @@\n \n \tPR c++/51033\n \t* c-typeck.c (c_build_vec_perm_expr): Move to c-family/c-common.c.\n-        * c-tree.h (c_build_vec_perm_expr): Move to c-family/c-common.h.\n+\t* c-tree.h (c_build_vec_perm_expr): Move to c-family/c-common.h.\n \n 2012-06-15  Georg-Johann Lay  <avr@gjlay.de>\n "}, {"sha": "153eb0b18e44f6853279bfc15593e04c563d0213", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 27, "deletions": 90, "changes": 117, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13024e6ad35ad6b55d667448846ef1d0d7aa115/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13024e6ad35ad6b55d667448846ef1d0d7aa115/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=b13024e6ad35ad6b55d667448846ef1d0d7aa115", "patch": "@@ -15099,11 +15099,26 @@\n   DONE;\n })\n \n+(define_int_iterator FRNDINT_ROUNDING\n+\t[UNSPEC_FRNDINT_FLOOR\n+\t UNSPEC_FRNDINT_CEIL\n+\t UNSPEC_FRNDINT_TRUNC])\n+\n+(define_int_attr rounding\n+\t[(UNSPEC_FRNDINT_FLOOR \"floor\")\n+\t (UNSPEC_FRNDINT_CEIL \"ceil\")\n+\t (UNSPEC_FRNDINT_TRUNC \"trunc\")])\n+\n+(define_int_attr ROUNDING\n+\t[(UNSPEC_FRNDINT_FLOOR \"FLOOR\")\n+\t (UNSPEC_FRNDINT_CEIL \"CEIL\")\n+\t (UNSPEC_FRNDINT_TRUNC \"TRUNC\")])\n+\n ;; Rounding mode control word calculation could clobber FLAGS_REG.\n-(define_insn_and_split \"frndintxf2_floor\"\n+(define_insn_and_split \"frndintxf2_<rounding>\"\n   [(set (match_operand:XF 0 \"register_operand\")\n \t(unspec:XF [(match_operand:XF 1 \"register_operand\")]\n-\t UNSPEC_FRNDINT_FLOOR))\n+\t\t   FRNDINT_ROUNDING))\n    (clobber (reg:CC FLAGS_REG))]\n   \"TARGET_USE_FANCY_MATH_387\n    && flag_unsafe_math_optimizations\n@@ -15112,30 +15127,30 @@\n   \"&& 1\"\n   [(const_int 0)]\n {\n-  ix86_optimize_mode_switching[I387_FLOOR] = 1;\n+  ix86_optimize_mode_switching[I387_<ROUNDING>] = 1;\n \n   operands[2] = assign_386_stack_local (HImode, SLOT_CW_STORED);\n-  operands[3] = assign_386_stack_local (HImode, SLOT_CW_FLOOR);\n+  operands[3] = assign_386_stack_local (HImode, SLOT_CW_<ROUNDING>);\n \n-  emit_insn (gen_frndintxf2_floor_i387 (operands[0], operands[1],\n-\t\t\t\t\toperands[2], operands[3]));\n+  emit_insn (gen_frndintxf2_<rounding>_i387 (operands[0], operands[1],\n+\t\t\t\t\t     operands[2], operands[3]));\n   DONE;\n }\n   [(set_attr \"type\" \"frndint\")\n-   (set_attr \"i387_cw\" \"floor\")\n+   (set_attr \"i387_cw\" \"<rounding>\")\n    (set_attr \"mode\" \"XF\")])\n \n-(define_insn \"frndintxf2_floor_i387\"\n+(define_insn \"frndintxf2_<rounding>_i387\"\n   [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n \t(unspec:XF [(match_operand:XF 1 \"register_operand\" \"0\")]\n-\t UNSPEC_FRNDINT_FLOOR))\n+\t\t   FRNDINT_ROUNDING))\n    (use (match_operand:HI 2 \"memory_operand\" \"m\"))\n    (use (match_operand:HI 3 \"memory_operand\" \"m\"))]\n   \"TARGET_USE_FANCY_MATH_387\n    && flag_unsafe_math_optimizations\"\n   \"fldcw\\t%3\\n\\tfrndint\\n\\tfldcw\\t%2\"\n   [(set_attr \"type\" \"frndint\")\n-   (set_attr \"i387_cw\" \"floor\")\n+   (set_attr \"i387_cw\" \"<rounding>\")\n    (set_attr \"mode\" \"XF\")])\n \n (define_expand \"floorxf2\"\n@@ -15357,45 +15372,6 @@\n   DONE;\n })\n \n-;; Rounding mode control word calculation could clobber FLAGS_REG.\n-(define_insn_and_split \"frndintxf2_ceil\"\n-  [(set (match_operand:XF 0 \"register_operand\")\n-\t(unspec:XF [(match_operand:XF 1 \"register_operand\")]\n-\t UNSPEC_FRNDINT_CEIL))\n-   (clobber (reg:CC FLAGS_REG))]\n-  \"TARGET_USE_FANCY_MATH_387\n-   && flag_unsafe_math_optimizations\n-   && can_create_pseudo_p ()\"\n-  \"#\"\n-  \"&& 1\"\n-  [(const_int 0)]\n-{\n-  ix86_optimize_mode_switching[I387_CEIL] = 1;\n-\n-  operands[2] = assign_386_stack_local (HImode, SLOT_CW_STORED);\n-  operands[3] = assign_386_stack_local (HImode, SLOT_CW_CEIL);\n-\n-  emit_insn (gen_frndintxf2_ceil_i387 (operands[0], operands[1],\n-\t\t\t\t       operands[2], operands[3]));\n-  DONE;\n-}\n-  [(set_attr \"type\" \"frndint\")\n-   (set_attr \"i387_cw\" \"ceil\")\n-   (set_attr \"mode\" \"XF\")])\n-\n-(define_insn \"frndintxf2_ceil_i387\"\n-  [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n-\t(unspec:XF [(match_operand:XF 1 \"register_operand\" \"0\")]\n-\t UNSPEC_FRNDINT_CEIL))\n-   (use (match_operand:HI 2 \"memory_operand\" \"m\"))\n-   (use (match_operand:HI 3 \"memory_operand\" \"m\"))]\n-  \"TARGET_USE_FANCY_MATH_387\n-   && flag_unsafe_math_optimizations\"\n-  \"fldcw\\t%3\\n\\tfrndint\\n\\tfldcw\\t%2\"\n-  [(set_attr \"type\" \"frndint\")\n-   (set_attr \"i387_cw\" \"ceil\")\n-   (set_attr \"mode\" \"XF\")])\n-\n (define_expand \"ceilxf2\"\n   [(use (match_operand:XF 0 \"register_operand\"))\n    (use (match_operand:XF 1 \"register_operand\"))]\n@@ -15613,45 +15589,6 @@\n   DONE;\n })\n \n-;; Rounding mode control word calculation could clobber FLAGS_REG.\n-(define_insn_and_split \"frndintxf2_trunc\"\n-  [(set (match_operand:XF 0 \"register_operand\")\n-\t(unspec:XF [(match_operand:XF 1 \"register_operand\")]\n-\t UNSPEC_FRNDINT_TRUNC))\n-   (clobber (reg:CC FLAGS_REG))]\n-  \"TARGET_USE_FANCY_MATH_387\n-   && flag_unsafe_math_optimizations\n-   && can_create_pseudo_p ()\"\n-  \"#\"\n-  \"&& 1\"\n-  [(const_int 0)]\n-{\n-  ix86_optimize_mode_switching[I387_TRUNC] = 1;\n-\n-  operands[2] = assign_386_stack_local (HImode, SLOT_CW_STORED);\n-  operands[3] = assign_386_stack_local (HImode, SLOT_CW_TRUNC);\n-\n-  emit_insn (gen_frndintxf2_trunc_i387 (operands[0], operands[1],\n-\t\t\t\t\toperands[2], operands[3]));\n-  DONE;\n-}\n-  [(set_attr \"type\" \"frndint\")\n-   (set_attr \"i387_cw\" \"trunc\")\n-   (set_attr \"mode\" \"XF\")])\n-\n-(define_insn \"frndintxf2_trunc_i387\"\n-  [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n-\t(unspec:XF [(match_operand:XF 1 \"register_operand\" \"0\")]\n-\t UNSPEC_FRNDINT_TRUNC))\n-   (use (match_operand:HI 2 \"memory_operand\" \"m\"))\n-   (use (match_operand:HI 3 \"memory_operand\" \"m\"))]\n-  \"TARGET_USE_FANCY_MATH_387\n-   && flag_unsafe_math_optimizations\"\n-  \"fldcw\\t%3\\n\\tfrndint\\n\\tfldcw\\t%2\"\n-  [(set_attr \"type\" \"frndint\")\n-   (set_attr \"i387_cw\" \"trunc\")\n-   (set_attr \"mode\" \"XF\")])\n-\n (define_expand \"btruncxf2\"\n   [(use (match_operand:XF 0 \"register_operand\"))\n    (use (match_operand:XF 1 \"register_operand\"))]\n@@ -15708,7 +15645,7 @@\n (define_insn_and_split \"frndintxf2_mask_pm\"\n   [(set (match_operand:XF 0 \"register_operand\")\n \t(unspec:XF [(match_operand:XF 1 \"register_operand\")]\n-\t UNSPEC_FRNDINT_MASK_PM))\n+\t\t   UNSPEC_FRNDINT_MASK_PM))\n    (clobber (reg:CC FLAGS_REG))]\n   \"TARGET_USE_FANCY_MATH_387\n    && flag_unsafe_math_optimizations\n@@ -15733,7 +15670,7 @@\n (define_insn \"frndintxf2_mask_pm_i387\"\n   [(set (match_operand:XF 0 \"register_operand\" \"=f\")\n \t(unspec:XF [(match_operand:XF 1 \"register_operand\" \"0\")]\n-\t UNSPEC_FRNDINT_MASK_PM))\n+\t\t   UNSPEC_FRNDINT_MASK_PM))\n    (use (match_operand:HI 2 \"memory_operand\" \"m\"))\n    (use (match_operand:HI 3 \"memory_operand\" \"m\"))]\n   \"TARGET_USE_FANCY_MATH_387"}]}