{"sha": "da17a98b19cc15739ace1f6e02a7d446f3fd8625", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGExN2E5OGIxOWNjMTU3MzlhY2UxZjZlMDJhN2Q0NDZmM2ZkODYyNQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2008-11-21T22:12:56Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2008-11-21T22:12:56Z"}, "message": "ffi.c (ffi_prep_cif_machdep): Add support for signed/unsigned int8/16 return values.\n\n\t* src/sparc/ffi.c (ffi_prep_cif_machdep): Add support for\n\tsigned/unsigned int8/16 return values.\n\t* src/sparc/v8.S (ffi_call_v8): Likewise.\n\t(ffi_closure_v8): Likewise.\n\nFrom-SVN: r142102", "tree": {"sha": "e4908e7709925a001d35bd321d109cb3865f4962", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4908e7709925a001d35bd321d109cb3865f4962"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da17a98b19cc15739ace1f6e02a7d446f3fd8625", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da17a98b19cc15739ace1f6e02a7d446f3fd8625", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da17a98b19cc15739ace1f6e02a7d446f3fd8625", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da17a98b19cc15739ace1f6e02a7d446f3fd8625/comments", "author": null, "committer": null, "parents": [{"sha": "88e091c3372048f6c3b3d41cbfedf422b5496808", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88e091c3372048f6c3b3d41cbfedf422b5496808", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88e091c3372048f6c3b3d41cbfedf422b5496808"}], "stats": {"total": 98, "additions": 78, "deletions": 20}, "files": [{"sha": "10dd1ebeb3dfa3a30c1467459458a06e1cd1897a", "filename": "libffi/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da17a98b19cc15739ace1f6e02a7d446f3fd8625/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da17a98b19cc15739ace1f6e02a7d446f3fd8625/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=da17a98b19cc15739ace1f6e02a7d446f3fd8625", "patch": "@@ -1,3 +1,10 @@\n+2008-11-21  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* src/sparc/ffi.c (ffi_prep_cif_machdep): Add support for\n+\tsigned/unsigned int8/16 return values.\n+\t* src/sparc/v8.S (ffi_call_v8): Likewise.\n+\t(ffi_closure_v8): Likewise.\n+\n 2008-09-26  Peter O'Gorman  <pogma@thewrittenword.com>\n             Steve Ellcey  <sje@cup.hp.com>\n "}, {"sha": "fea0330e4e69f3fa068e80b613c8882b9858ed09", "filename": "libffi/src/sparc/ffi.c", "status": "modified", "additions": 16, "deletions": 6, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da17a98b19cc15739ace1f6e02a7d446f3fd8625/libffi%2Fsrc%2Fsparc%2Fffi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da17a98b19cc15739ace1f6e02a7d446f3fd8625/libffi%2Fsrc%2Fsparc%2Fffi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fsparc%2Fffi.c?ref=da17a98b19cc15739ace1f6e02a7d446f3fd8625", "patch": "@@ -307,14 +307,24 @@ ffi_status ffi_prep_cif_machdep(ffi_cif *cif)\n \tcif->flags = FFI_TYPE_STRUCT;\n       break;\n \n+    case FFI_TYPE_SINT8:\n+    case FFI_TYPE_UINT8:\n+    case FFI_TYPE_SINT16:\n+    case FFI_TYPE_UINT16:\n+      if (cif->abi == FFI_V9)\n+\tcif->flags = FFI_TYPE_INT;\n+      else\n+\tcif->flags = cif->rtype->type;\n+      break;\n+\n     case FFI_TYPE_SINT64:\n     case FFI_TYPE_UINT64:\n-      if (cif->abi != FFI_V9)\n-\t{\n-\t  cif->flags = FFI_TYPE_SINT64;\n-\t  break;\n-\t}\n-      /* FALLTHROUGH */\n+      if (cif->abi == FFI_V9)\n+\tcif->flags = FFI_TYPE_INT;\n+      else\n+\tcif->flags = FFI_TYPE_SINT64;\n+      break;\n+\n     default:\n       cif->flags = FFI_TYPE_INT;\n       break;"}, {"sha": "38307599bf59ed9df3d48a02038ebcca99fb970b", "filename": "libffi/src/sparc/v8.S", "status": "modified", "additions": 55, "deletions": 14, "changes": 69, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da17a98b19cc15739ace1f6e02a7d446f3fd8625/libffi%2Fsrc%2Fsparc%2Fv8.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da17a98b19cc15739ace1f6e02a7d446f3fd8625/libffi%2Fsrc%2Fsparc%2Fv8.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fsrc%2Fsparc%2Fv8.S?ref=da17a98b19cc15739ace1f6e02a7d446f3fd8625", "patch": "@@ -72,21 +72,63 @@ _ffi_call_v8:\n \tbe,a\tdone\n \tst\t%f0, [%i4+0]\t! (delay)\n \n+\tcmp\t%i3, FFI_TYPE_DOUBLE\n+\tbe,a\tdouble\n+\tst\t%f0, [%i4+0]\t! (delay)\n+\n+\tcmp\t%i3, FFI_TYPE_SINT8\n+\tbe,a\tsint8\n+\tsll\t%o0, 24, %o0\t! (delay)\n+\n+\tcmp\t%i3, FFI_TYPE_UINT8\n+\tbe,a\tuint8\n+\tsll\t%o0, 24, %o0\t! (delay)\n+\n+\tcmp\t%i3, FFI_TYPE_SINT16\n+\tbe,a\tsint16\n+\tsll\t%o0, 16, %o0\t! (delay)\n+\n+\tcmp\t%i3, FFI_TYPE_UINT16\n+\tbe,a\tuint16\n+\tsll\t%o0, 16, %o0\t! (delay)\n+\n \tcmp\t%i3, FFI_TYPE_SINT64\n-\tbe\tlonglong\n+\tbe,a\tlonglong\n+\tst\t%o0, [%i4+0]\t! (delay)\n+done:\n+\tret\n+\trestore\n \n-\tcmp\t%i3, FFI_TYPE_DOUBLE\n-\tbne\tdone\n-\tnop\n-\tst\t%f0, [%i4+0]\n+double:\n \tst\t%f1, [%i4+4]\n-\t\n-done:\n \tret\n \trestore\n \n-longlong:\n+sint8:\n+\tsra\t%o0, 24, %o0\n+\tst\t%o0, [%i4+0]\n+\tret\n+\trestore\n+\n+uint8:\n+\tsrl\t%o0, 24, %o0\n \tst\t%o0, [%i4+0]\n+\tret\n+\trestore\n+\n+sint16:\n+\tsra\t%o0, 16, %o0\n+\tst\t%o0, [%i4+0]\n+\tret\n+\trestore\n+\n+uint16:\n+\tsrl\t%o0, 16, %o0\n+\tst\t%o0, [%i4+0]\n+\tret\n+\trestore\n+\n+longlong:\n \tst\t%o1, [%i4+4]\n \tret\n \trestore\n@@ -147,7 +189,8 @@ ffi_closure_v8:\n \tbe\tdone1\n \n \tcmp\t%o0, FFI_TYPE_INT\n-\tbe\tinteger\n+\tbe\tdone1\n+\t ld\t[%fp-8], %i0\n \n \tcmp\t%o0, FFI_TYPE_FLOAT\n \tbe,a\tdone1\n@@ -165,13 +208,11 @@ ffi_closure_v8:\n \tcmp\t%o0, FFI_TYPE_STRUCT\n \tbe\tdone2\n \n-\t! FFI_TYPE_SINT64\n-\t! FFI_TYPE_UINT64\n-\tld\t[%fp-4], %i1\n+\tcmp\t%o0, FFI_TYPE_SINT64\n+\tbe,a\tdone1\n+\t ldd\t[%fp-8], %i0\n \n-integer:\n \tld\t[%fp-8], %i0\n-\n done1:\n \tjmp\t%i7+8\n \t restore"}]}