{"sha": "c5a26133df8575533bc97def6e76bf66bec7f91a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzVhMjYxMzNkZjg1NzU1MzNiYzk3ZGVmNmU3NmJmNjZiZWM3ZjkxYQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-01T08:45:43Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-01T08:45:43Z"}, "message": "[multiple changes]\n\n2012-10-01  Robert Dewar  <dewar@adacore.com>\n\n\t* freeze.adb, sem_ch6.adb, opt.ads, sem_ch13.adb,\n\texp_ch3.adb: Minor reformatting.\n\n2012-10-01  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* checks.adb (Build_PPC_Pragma): A PPC pragma can now be properly\n\tassociated with a subprogram body.\n\nFrom-SVN: r191902", "tree": {"sha": "bc41eca22e0a81ac94816a7d59b5d89a6242b070", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc41eca22e0a81ac94816a7d59b5d89a6242b070"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c5a26133df8575533bc97def6e76bf66bec7f91a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5a26133df8575533bc97def6e76bf66bec7f91a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5a26133df8575533bc97def6e76bf66bec7f91a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5a26133df8575533bc97def6e76bf66bec7f91a/comments", "author": null, "committer": null, "parents": [{"sha": "9e1902a9e7e3cb06d33ad2c1e1e002d2ba0973ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e1902a9e7e3cb06d33ad2c1e1e002d2ba0973ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e1902a9e7e3cb06d33ad2c1e1e002d2ba0973ec"}], "stats": {"total": 92, "additions": 63, "deletions": 29}, "files": [{"sha": "db3e9b826a087c34eb6fb70b8fd65088eecd72b8", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -1,3 +1,13 @@\n+2012-10-01  Robert Dewar  <dewar@adacore.com>\n+\n+\t* freeze.adb, sem_ch6.adb, opt.ads, sem_ch13.adb,\n+\texp_ch3.adb: Minor reformatting.\n+\n+2012-10-01  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* checks.adb (Build_PPC_Pragma): A PPC pragma can now be properly\n+\tassociated with a subprogram body.\n+\n 2012-10-01  Ed Schonberg  <schonberg@adacore.com>\n \n \t* aspects.ads: Type_Invariant'class is a valid aspect."}, {"sha": "8d40abcb06e2590343e25664f8f7befcc0ec6bac", "filename": "gcc/ada/checks.adb", "status": "modified", "additions": 33, "deletions": 8, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fchecks.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fchecks.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fchecks.adb?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -1876,8 +1876,9 @@ package body Checks is\n       ----------------------\n \n       procedure Build_PPC_Pragma (PPC_Nam : Name_Id; Check : Node_Id) is\n-         Loc  : constant Source_Ptr := Sloc (Subp);\n-         Prag : Node_Id;\n+         Loc   : constant Source_Ptr := Sloc (Subp);\n+         Decls : List_Id;\n+         Prag  : Node_Id;\n \n       begin\n          Prag :=\n@@ -1904,11 +1905,34 @@ package body Checks is\n \n          if Nkind (Parent (Subp_Decl)) = N_Compilation_Unit then\n             Add_Global_Declaration (Prag);\n+            Analyze (Prag);\n+\n+         --  PPC pragmas associated with subprogram bodies must be inserted in\n+         --  the declarative part of the body.\n+\n+         elsif Nkind (Subp_Decl) = N_Subprogram_Body then\n+            Decls := Declarations (Subp_Decl);\n+\n+            if No (Decls) then\n+               Decls := New_List;\n+               Set_Declarations (Subp_Decl, Decls);\n+            end if;\n+\n+            Append_To (Decls, Prag);\n+\n+            --  Ensure the proper visibility of the subprogram body and its\n+            --  parameters.\n+\n+            Push_Scope (Subp);\n+            Analyze (Prag);\n+            Pop_Scope;\n+\n+         --  For subprogram declarations insert the PPC pragma right after the\n+         --  declarative node.\n+\n          else\n-            Insert_After (Subp_Decl, Prag);\n+            Insert_After_And_Analyze (Subp_Decl, Prag);\n          end if;\n-\n-         Analyze (Prag);\n       end Build_PPC_Pragma;\n \n       --  Local variables\n@@ -1941,10 +1965,11 @@ package body Checks is\n         or else Is_Imported (Subp)\n         or else Is_Intrinsic_Subprogram (Subp)\n \n-         --  Do not consider subprogram bodies because pre and post conditions\n-         --  cannot be associated with them.\n+         --  The PPC pragmas generated by this routine do not correspond to\n+         --  source aspects, therefore they cannot be applied to abstract\n+         --  subprograms.\n \n-        or else Nkind (Subp_Decl) /= N_Subprogram_Declaration\n+        or else Nkind (Subp_Decl) = N_Abstract_Subprogram_Declaration\n \n          --  Do not process null procedures because there is no benefit of\n          --  adding the checks to a no action routine."}, {"sha": "cf993757406d6ecf60ae960e4770d708e9670437", "filename": "gcc/ada/exp_ch3.adb", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fexp_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fexp_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch3.adb?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -3626,7 +3626,7 @@ package body Exp_Ch3 is\n       --  Name for argument of invariant procedure\n \n       Object_Entity : constant Node_Id :=\n-                        Make_Defining_Identifier (Loc, Object_Name);\n+        Make_Defining_Identifier (Loc, Object_Name);\n       --  The procedure declaration entity for the argument\n \n       Invariant_Found : Boolean;\n@@ -3681,10 +3681,10 @@ package body Exp_Ch3 is\n       begin\n          Stmts := New_List;\n          Decl := First_Non_Pragma (Component_Items (Comp_List));\n-\n          while Present (Decl) loop\n             if Nkind (Decl) = N_Component_Declaration then\n                Id  := Defining_Identifier (Decl);\n+\n                if Has_Invariants (Etype (Id)) then\n                   Append_To (Stmts, Build_Component_Invariant_Call (Id));\n                end if;\n@@ -3734,14 +3734,16 @@ package body Exp_Ch3 is\n          return Stmts;\n       end Build_Invariant_Checks;\n \n+   --  Start of processing for Build_Record_Invariant_Proc\n+\n    begin\n       Invariant_Found := False;\n       Type_Def := Type_Definition (Parent (R_Type));\n+\n       if Nkind (Type_Def) = N_Record_Definition\n-        and then  not Null_Present (Type_Def)\n+        and then not Null_Present (Type_Def)\n       then\n-         Stmts :=\n-           Build_Invariant_Checks (Component_List (Type_Def));\n+         Stmts := Build_Invariant_Checks (Component_List (Type_Def));\n       else\n          return;\n       end if;"}, {"sha": "03b275935b5e1080023ef31c207238017d02b977", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -2660,8 +2660,7 @@ package body Freeze is\n       --  storage of subprogram parameters.\n \n       if Is_Subprogram (E)\n-        and then (Check_Aliasing_Of_Parameters\n-                    or else Check_Validity_Of_Parameters)\n+        and then (Check_Aliasing_Of_Parameters or Check_Validity_Of_Parameters)\n       then\n          Apply_Parameter_Aliasing_And_Validity_Checks (E);\n       end if;"}, {"sha": "dc0d862c4dc172774eca4e8f4fd8087594d4b8b9", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -326,7 +326,7 @@ package Opt is\n    Check_Validity_Of_Parameters : Boolean := False;\n    --  GNAT\n    --  Set to True to check for proper scalar initialization of subprogram\n-   --  parameters on both entry and exit.\n+   --  parameters on both entry and exit. Turned on by??? turned off by???\n \n    Check_Withs : Boolean := False;\n    --  GNAT"}, {"sha": "c21468ffa2e4bba4e69fbfd91275aadd9105e885", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 10, "deletions": 10, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -5232,16 +5232,16 @@ package body Sem_Ch13 is\n    -- Build_Predicate_Function --\n    ------------------------------\n \n-   --  The procedure that is constructed here has the form\n-\n-   --  function typPredicate (Ixxx : typ) return Boolean is\n-   --  begin\n-   --     return\n-   --        exp1 and then exp2 and then ...\n-   --        and then typ1Predicate (typ1 (Ixxx))\n-   --        and then typ2Predicate (typ2 (Ixxx))\n-   --        and then ...;\n-   --  end typPredicate;\n+   --  The procedure that is constructed here has the form:\n+\n+   --    function typPredicate (Ixxx : typ) return Boolean is\n+   --    begin\n+   --       return\n+   --          exp1 and then exp2 and then ...\n+   --          and then typ1Predicate (typ1 (Ixxx))\n+   --          and then typ2Predicate (typ2 (Ixxx))\n+   --          and then ...;\n+   --    end typPredicate;\n \n    --  Here exp1, and exp2 are expressions from Predicate pragmas. Note that\n    --  this is the point at which these expressions get analyzed, providing the"}, {"sha": "5ace348d32508e9f5f04fa826bf19d1f9317ac21", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c5a26133df8575533bc97def6e76bf66bec7f91a/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=c5a26133df8575533bc97def6e76bf66bec7f91a", "patch": "@@ -11344,9 +11344,7 @@ package body Sem_Ch6 is\n          --  public subprogram, since we do get initializations to deal with.\n          --  Other internally generated subprograms are not public.\n \n-         if not Is_List_Member (DD)\n-           and then Is_Init_Proc (DD)\n-         then\n+         if not Is_List_Member (DD) and then Is_Init_Proc (DD) then\n             return True;\n \n          elsif not Comes_From_Source (DD) then"}]}