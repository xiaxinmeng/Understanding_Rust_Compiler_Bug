{"sha": "69fce32ff9c8ef7bcc4557253798979118d96b43", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjlmY2UzMmZmOWM4ZWY3YmNjNDU1NzI1Mzc5ODk3OTExOGQ5NmI0Mw==", "commit": {"author": {"name": "Roger Sayle", "email": "roger@eyesopen.com", "date": "2007-02-12T01:43:50Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2007-02-12T01:43:50Z"}, "message": "simplify-rtx.c (simplify_relational_operation_1): Optimize comparisons of POPCOUNT against zero.\n\n\n\t* simplify-rtx.c (simplify_relational_operation_1): Optimize\n\tcomparisons of POPCOUNT against zero.\n\t(simplify_const_relational_operation): Likewise.\n\n\t* gcc.target/ia64/builtin-popcount-1.c: New test case.\n\t* gcc.target/ia64/builtin-popcount-2.c: Likewise.\n\nFrom-SVN: r121838", "tree": {"sha": "0f422267ae47a4e1db8030365f255263615dd2c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f422267ae47a4e1db8030365f255263615dd2c6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/69fce32ff9c8ef7bcc4557253798979118d96b43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69fce32ff9c8ef7bcc4557253798979118d96b43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69fce32ff9c8ef7bcc4557253798979118d96b43", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69fce32ff9c8ef7bcc4557253798979118d96b43/comments", "author": null, "committer": null, "parents": [{"sha": "cf24243ee0d939b7685d19768f4640caa06b690f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf24243ee0d939b7685d19768f4640caa06b690f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf24243ee0d939b7685d19768f4640caa06b690f"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "a5f9960a1ae8f43bfe79797a888a092baa227f04", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=69fce32ff9c8ef7bcc4557253798979118d96b43", "patch": "@@ -1,3 +1,9 @@\n+2007-02-11  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* simplify-rtx.c (simplify_relational_operation_1): Optimize\n+\tcomparisons of POPCOUNT against zero.\n+\t(simplify_const_relational_operation): Likewise.\n+\n 2007-02-11  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \t* doc/invoke.texi (Wextra): Delete outdated paragraph."}, {"sha": "6f7c37d4c5630fb92b556c858ba4da4c56ef90e8", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=69fce32ff9c8ef7bcc4557253798979118d96b43", "patch": "@@ -3802,6 +3802,27 @@ simplify_relational_operation_1 (enum rtx_code code, enum machine_mode mode,\n \t\t\t\t    simplify_gen_binary (XOR, cmp_mode,\n \t\t\t\t\t\t\t XEXP (op0, 1), op1));\n \n+  if (op0code == POPCOUNT && op1 == const0_rtx)\n+    switch (code)\n+      {\n+      case EQ:\n+      case LE:\n+      case LEU:\n+\t/* (eq (popcount x) (const_int 0)) -> (eq x (const_int 0)).  */\n+\treturn simplify_gen_relational (EQ, mode, GET_MODE (XEXP (op0, 0)),\n+\t\t\t\t\tXEXP (op0, 0), const0_rtx);\n+\n+      case NE:\n+      case GT:\n+      case GTU:\n+\t/* (ne (popcount x) (const_int 0)) -> (ne x (const_int 0)).  */\n+\treturn simplify_gen_relational (EQ, mode, GET_MODE (XEXP (op0, 0)),\n+\t\t\t\t\tXEXP (op0, 0), const0_rtx);\n+\n+      default:\n+\tbreak;\n+      }\n+\n   return NULL_RTX;\n }\n \n@@ -4067,6 +4088,10 @@ simplify_const_relational_operation (enum rtx_code code,\n \t      if (GET_CODE (tem) == ABS)\n \t\treturn const0_rtx;\n \t    }\n+\n+\t  /* Optimize popcount (x) < 0.  */\n+\t  if (GET_CODE (trueop0) == POPCOUNT && trueop1 == const0_rtx)\n+\t    return const_true_rtx;\n \t  break;\n \n \tcase GE:\n@@ -4081,6 +4106,10 @@ simplify_const_relational_operation (enum rtx_code code,\n \t      if (GET_CODE (tem) == ABS)\n \t\treturn const_true_rtx;\n \t    }\n+\n+\t  /* Optimize popcount (x) >= 0.  */\n+\t  if (GET_CODE (trueop0) == POPCOUNT && trueop1 == const0_rtx)\n+\t    return const_true_rtx;\n \t  break;\n \n \tcase UNGE:"}, {"sha": "92670f42758a96e9f37a6813256f962ba3223fce", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=69fce32ff9c8ef7bcc4557253798979118d96b43", "patch": "@@ -1,3 +1,8 @@\n+2007-02-11  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* gcc.target/ia64/builtin-popcount-1.c: New test case.\n+\t* gcc.target/ia64/builtin-popcount-2.c: Likewise.\n+\n 2007-02-11  Tobias Schl\ufffdter  <tobi@gcc.gnu.org>\n \n \tPR fortran/30478"}, {"sha": "c9641d0e6dfeecf5f2599695de5e56eafad8deb4", "filename": "gcc/testsuite/gcc.target/ia64/builtin-popcount-1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fbuiltin-popcount-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fbuiltin-popcount-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fbuiltin-popcount-1.c?ref=69fce32ff9c8ef7bcc4557253798979118d96b43", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-final { scan-assembler \"popcnt\" } } */\n+\n+int foo (int x)\n+{\n+  return __builtin_popcount (x);\n+}\n+"}, {"sha": "50ced72e72867f8d1425e375ca99565bf4b598f5", "filename": "gcc/testsuite/gcc.target/ia64/builtin-popcount-2.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fbuiltin-popcount-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/69fce32ff9c8ef7bcc4557253798979118d96b43/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fbuiltin-popcount-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fia64%2Fbuiltin-popcount-2.c?ref=69fce32ff9c8ef7bcc4557253798979118d96b43", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-final { scan-assembler-not \"popcnt\" } } */\n+\n+int foo (int x)\n+{\n+  return __builtin_popcount (x) == 0;\n+}\n+"}]}