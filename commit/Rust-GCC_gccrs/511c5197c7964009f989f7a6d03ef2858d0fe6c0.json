{"sha": "511c5197c7964009f989f7a6d03ef2858d0fe6c0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTExYzUxOTdjNzk2NDAwOWY5ODlmN2E2ZDAzZWYyODU4ZDBmZTZjMA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-08-01T13:23:00Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-08-01T13:23:00Z"}, "message": "[multiple changes]\n\n2014-08-01  Robert Dewar  <dewar@adacore.com>\n\n\t* debug.adb: Document debug switch -gnatd.Z.\n\t* sem.adb (Semantics): Force expansion on in no or configurable\n\trun time mode.\n\n2014-08-01  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch5.adb (Analyze_Loop_Parameter_Specification): An\n\tunchecked conversion denotes an iterator specification. Such a\n\tconversion will be inserted in the context of an inlined call\n\twhen needed, and its argument is always an object.\n\nFrom-SVN: r213456", "tree": {"sha": "4fb5f7a11ed714d9091d088929c02862121e9746", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4fb5f7a11ed714d9091d088929c02862121e9746"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/511c5197c7964009f989f7a6d03ef2858d0fe6c0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/511c5197c7964009f989f7a6d03ef2858d0fe6c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/511c5197c7964009f989f7a6d03ef2858d0fe6c0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/511c5197c7964009f989f7a6d03ef2858d0fe6c0/comments", "author": null, "committer": null, "parents": [{"sha": "9741d942c2fd2ec06ef975c671eb600abb079d8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9741d942c2fd2ec06ef975c671eb600abb079d8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9741d942c2fd2ec06ef975c671eb600abb079d8a"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "de5593239c676f2eca978c254f82ab8318ef73f3", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=511c5197c7964009f989f7a6d03ef2858d0fe6c0", "patch": "@@ -1,3 +1,16 @@\n+2014-08-01  Robert Dewar  <dewar@adacore.com>\n+\n+\t* debug.adb: Document debug switch -gnatd.Z.\n+\t* sem.adb (Semantics): Force expansion on in no or configurable\n+\trun time mode.\n+\n+2014-08-01  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch5.adb (Analyze_Loop_Parameter_Specification): An\n+\tunchecked conversion denotes an iterator specification. Such a\n+\tconversion will be inserted in the context of an inlined call\n+\twhen needed, and its argument is always an object.\n+\n 2014-08-01  Robert Dewar  <dewar@adacore.com>\n \n \t* make.adb, makeutl.ads: Minor reformatting."}, {"sha": "715e44ad748810f7affa356e27448be41fab610b", "filename": "gcc/ada/debug.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2Fdebug.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2Fdebug.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fdebug.adb?ref=511c5197c7964009f989f7a6d03ef2858d0fe6c0", "patch": "@@ -143,7 +143,7 @@ package body Debug is\n    --  d.W  Print out debugging information for Walk_Library_Items\n    --  d.X  Old treatment of indexing aspects\n    --  d.Y\n-   --  d.Z\n+   --  d.Z  Do not enable expansion in configurable run-time mode\n \n    --  d1   Error msgs have node numbers where possible\n    --  d2   Eliminate error flags in verbose form error messages\n@@ -686,6 +686,12 @@ package body Debug is\n    --       is preserved temporarily for use by the modelling project under\n    --       debug flag d.X.\n \n+   --  d.Z  Normally we always enable expansion in configurable run-time mode\n+   --       to make sure we get error messages about unsupported features even\n+   --       when compiling in -gnatc mode. But expansion is turned off in this\n+   --       case if debug flag -gnatd.Z is used. This is to deal with the case\n+   --       where we discover difficulties in this new processing.\n+\n    --  d1   Error messages have node numbers where possible. Normally error\n    --       messages have only source locations. This option is useful when\n    --       debugging errors caused by expanded code, where the source location"}, {"sha": "73f345e99896bc8e4f6c1df273522bce87828b45", "filename": "gcc/ada/sem.adb", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2Fsem.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2Fsem.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem.adb?ref=511c5197c7964009f989f7a6d03ef2858d0fe6c0", "patch": "@@ -1410,11 +1410,33 @@ package body Sem is\n          GNAT_Mode := True;\n       end if;\n \n+      --  For generic main, never do expansion\n+\n       if Generic_Main then\n          Expander_Mode_Save_And_Set (False);\n+\n+      --  Non generic case\n+\n       else\n          Expander_Mode_Save_And_Set\n-           (Operating_Mode = Generate_Code or Debug_Flag_X);\n+\n+           --  Turn on expansion if generating code\n+\n+           (Operating_Mode = Generate_Code\n+\n+             --  or if special debug flag -gnatdx is set\n+\n+             or else Debug_Flag_X\n+\n+             --  Or if in configuration run-time mode. We do this so we get\n+             --  error messages about missing entities in the run-time even\n+             --  if we are compiling in -gnatc (no code generation) mode.\n+             --  Similar processing applies to No_Run_Time_Mode. However,\n+             --  don't do this if debug flag -gnatd.Z is set (this is to handle\n+             --  a situation where this new processing causes trouble).\n+\n+             or else ((Configurable_Run_Time_Mode or No_Run_Time_Mode)\n+                       and not Debug_Flag_Dot_ZZ));\n       end if;\n \n       Full_Analysis      := True;"}, {"sha": "ffdf8814e52ddd8203d7cd60f8e5d99554df46b6", "filename": "gcc/ada/sem_ch5.adb", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2Fsem_ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/511c5197c7964009f989f7a6d03ef2858d0fe6c0/gcc%2Fada%2Fsem_ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch5.adb?ref=511c5197c7964009f989f7a6d03ef2858d0fe6c0", "patch": "@@ -2510,16 +2510,21 @@ package body Sem_Ch5 is\n          --  a)  a function call,\n          --  b)  an identifier that is not a type,\n          --  c)  an attribute reference 'Old (within a postcondition)\n+         --  d)  an unchecked conversion\n \n          --  then it is an iteration over a container. It was classified as\n          --  a loop specification by the parser, and must be rewritten now\n-         --  to activate container iteration.\n+         --  to activate container iteration. The last case will occur within\n+         --  an expanded inlined call, where the expansion wraps an actual in\n+         --  an unchecked conversion when needed. The expression of the\n+         --  conversion is always an object.\n \n          if Nkind (DS_Copy) = N_Function_Call\n            or else (Is_Entity_Name (DS_Copy)\n                      and then not Is_Type (Entity (DS_Copy)))\n            or else (Nkind (DS_Copy) = N_Attribute_Reference\n                      and then Attribute_Name (DS_Copy) = Name_Old)\n+           or else Nkind (DS_Copy) = N_Unchecked_Type_Conversion\n          then\n             --  This is an iterator specification. Rewrite it as such and\n             --  analyze it to capture function calls that may require"}]}