{"sha": "4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY4MzA2NGUzYmY2NGU1YjZmZTYxNWE0OWVlODRjZjYxYjBhYzk1NA==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2016-05-19T13:43:58Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2016-05-19T13:43:58Z"}, "message": "[ARM] PR target/71056: Don't use vectorized builtins when NEON is not available\n\n\tPR target/71056\n\t* config/arm/arm-builtins.c (arm_builtin_vectorized_function): Return\n\tNULL_TREE early if NEON is not available.  Remove now redundant check\n\tin ARM_CHECK_BUILTIN_MODE.\n\n\t* gcc.target/arm/pr71056.c: New test.\n\nFrom-SVN: r236459", "tree": {"sha": "cf9f526f55cb1c7ad774f4386060c0942757e078", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf9f526f55cb1c7ad774f4386060c0942757e078"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4bf8dbe16aa168e50fa240d2d368d439e07208d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bf8dbe16aa168e50fa240d2d368d439e07208d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bf8dbe16aa168e50fa240d2d368d439e07208d8"}], "stats": {"total": 50, "additions": 49, "deletions": 1}, "files": [{"sha": "11c0dc2ec8135df0ee12fa05ac33bf34fba33547", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "patch": "@@ -1,3 +1,10 @@\n+2016-05-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR target/71056\n+\t* config/arm/arm-builtins.c (arm_builtin_vectorized_function): Return\n+\tNULL_TREE early if NEON is not available.  Remove now redundant check\n+\tin ARM_CHECK_BUILTIN_MODE.\n+\n 2016-05-19  Maxim Ostapenko  <m.ostapenko@samsung.com>\n \n \tPR sanitizer/64354"}, {"sha": "68b2839879f78e8d819444fbc11d2a91f8d6279a", "filename": "gcc/config/arm/arm-builtins.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2Fconfig%2Farm%2Farm-builtins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2Fconfig%2Farm%2Farm-builtins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-builtins.c?ref=4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "patch": "@@ -2861,6 +2861,10 @@ arm_builtin_vectorized_function (unsigned int fn, tree type_out, tree type_in)\n   int in_n, out_n;\n   bool out_unsigned_p = TYPE_UNSIGNED (type_out);\n \n+  /* Can't provide any vectorized builtins when we can't use NEON.  */\n+  if (!TARGET_NEON)\n+    return NULL_TREE;\n+\n   if (TREE_CODE (type_out) != VECTOR_TYPE\n       || TREE_CODE (type_in) != VECTOR_TYPE)\n     return NULL_TREE;\n@@ -2875,7 +2879,7 @@ arm_builtin_vectorized_function (unsigned int fn, tree type_out, tree type_in)\n    NULL_TREE is returned if no such builtin is available.  */\n #undef ARM_CHECK_BUILTIN_MODE\n #define ARM_CHECK_BUILTIN_MODE(C)    \\\n-  (TARGET_NEON && TARGET_FPU_ARMV8   \\\n+  (TARGET_FPU_ARMV8   \\\n    && flag_unsafe_math_optimizations \\\n    && ARM_CHECK_BUILTIN_MODE_1 (C))\n "}, {"sha": "e8bf513d41f36eb733ef2305e6c1067296c760ef", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "patch": "@@ -1,3 +1,8 @@\n+2016-05-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR target/71056\n+\t* gcc.target/arm/pr71056.c: New test.\n+\n 2016-05-19  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* c-c++-common/pr69669.c: Check the used mode."}, {"sha": "136754eb13c4c4f8f840001d5520cf27f3c57461", "filename": "gcc/testsuite/gcc.target/arm/pr71056.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr71056.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f83064e3bf64e5b6fe615a49ee84cf61b0ac954/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr71056.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr71056.c?ref=4f83064e3bf64e5b6fe615a49ee84cf61b0ac954", "patch": "@@ -0,0 +1,32 @@\n+/* PR target/71056.  */\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_vfp3_ok } */\n+/* { dg-options \"-O3 -mfpu=vfpv3\" } */\n+\n+/* Check that compiling for a non-NEON target doesn't try to introduce\n+   a NEON vectorized builtin.  */\n+\n+extern char *buff;\n+int f2 ();\n+struct T1\n+{\n+  int reserved[2];\n+  unsigned int ip;\n+  unsigned short cs;\n+  unsigned short rsrv2;\n+};\n+void\n+f3 (const char *p)\n+{\n+  struct T1 x;\n+  __builtin_memcpy (&x, p, sizeof (struct T1));\n+  x.reserved[0] = __builtin_bswap32 (x.reserved[0]);\n+  x.reserved[1] = __builtin_bswap32 (x.reserved[1]);\n+  x.ip = __builtin_bswap32 (x.ip);\n+  x.cs = x.cs << 8 | x.cs >> 8;\n+  x.rsrv2 = x.rsrv2 << 8 | x.rsrv2 >> 8;\n+  if (f2 ())\n+    {\n+      __builtin_memcpy (buff, \"\\n\", 1);\n+    }\n+}"}]}