{"sha": "27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjdiMmZiYzk1Y2VhMDUxMmU3MWE0Y2QzMDkwZTY4YWUyYmY0ZmUxZA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2019-08-19T08:36:07Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-19T08:36:07Z"}, "message": "[Ada] Fix internal error on subprogram instantiation with -gnatzc\n\nThis fixes a fallout of the recent change keeping the\nIs_Generic_Instance flag on the wrapper package built for the\ninstantiation of a generic subprogram.\n\nThere is no need to visit the Instance_Spec of an\nN_Subprogram_Instantiation node anymore because the regular processing\nfor an N_Package_Declaration node now does the job for instantiations of\ngeneric subprograms.\n\nThe following subprogram must compile again quietly with -gnatzc:\n\nwith Gen_Proc;\n\npackage RCI is\n   pragma Remote_Call_Interface;\n\n   procedure Inst_Proc is new Gen_Proc;\n\n   procedure P (S : String);\nend RCI;\n\ngeneric\nprocedure Gen_Proc (S : String);\npragma Remote_Call_Interface (Gen_Proc);\n\nwith Ada.Text_IO; use Ada.Text_IO;\nprocedure Gen_Proc (S : String) is\nbegin\n   Put_Line (\"Gen_Proc called: \" & S);\nend Gen_Proc;\n\n2019-08-19  Eric Botcazou  <ebotcazou@adacore.com>\n\ngcc/ada/\n\n\t* exp_dist.adb (Build_Package_Stubs): Do not specifically visit\n\tthe declarations of an N_Subprogram_Instantiation node.\n\nFrom-SVN: r274647", "tree": {"sha": "77ca99a7ab530701448747d6dd1fc47b26f99603", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77ca99a7ab530701448747d6dd1fc47b26f99603"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d/comments", "author": null, "committer": null, "parents": [{"sha": "d41f5c1facb17bd231fe4dbc122d105585281487", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d41f5c1facb17bd231fe4dbc122d105585281487", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d41f5c1facb17bd231fe4dbc122d105585281487"}], "stats": {"total": 21, "additions": 7, "deletions": 14}, "files": [{"sha": "e1342f48754d0a32a800bb6d9b0891b35074aac0", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d", "patch": "@@ -1,3 +1,8 @@\n+2019-08-19  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* exp_dist.adb (Build_Package_Stubs): Do not specifically visit\n+\tthe declarations of an N_Subprogram_Instantiation node.\n+\n 2019-08-19  Bob Duff  <duff@adacore.com>\n \n \t* doc/gnat_ugn/gnat_utility_programs.rst: Document missing"}, {"sha": "4f13d9cedaf99d68481d23cece17fb102ecee148", "filename": "gcc/ada/exp_dist.adb", "status": "modified", "additions": 2, "deletions": 14, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d/gcc%2Fada%2Fexp_dist.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d/gcc%2Fada%2Fexp_dist.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_dist.adb?ref=27b2fbc95cea0512e71a4cd3090e68ae2bf4fe1d", "patch": "@@ -963,10 +963,8 @@ package body Exp_Dist is\n             when N_Package_Declaration =>\n \n                --  Case of a nested package or package instantiation coming\n-               --  from source. Note that the anonymous wrapper package for\n-               --  subprogram instances is not flagged Is_Generic_Instance at\n-               --  this point, so there is a distinct circuit to handle them\n-               --  (see case N_Subprogram_Instantiation below).\n+               --  from source, including the wrapper package for an instance\n+               --  of a generic subprogram.\n \n                declare\n                   Pkg_Ent : constant Entity_Id :=\n@@ -982,16 +980,6 @@ package body Exp_Dist is\n                   end if;\n                end;\n \n-            when N_Subprogram_Instantiation =>\n-\n-               --  The subprogram declaration for an instance of a generic\n-               --  subprogram is wrapped in a package that does not come from\n-               --  source, so we need to explicitly traverse it here.\n-\n-               if Comes_From_Source (Decl) then\n-                  Visit_Nested_Pkg (Instance_Spec (Decl));\n-               end if;\n-\n             when others =>\n                null;\n          end case;"}]}