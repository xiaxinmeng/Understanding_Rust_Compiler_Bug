{"sha": "04d933fd48d7e7cbedb761d660229cac9f36fab2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDRkOTMzZmQ0OGQ3ZTdjYmVkYjc2MWQ2NjAyMjljYWM5ZjM2ZmFiMg==", "commit": {"author": {"name": "Olivier Hainque", "email": "hainque@adacore.com", "date": "2019-08-19T08:35:24Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-19T08:35:24Z"}, "message": "[Ada] Fix thinko in Acc_Loop_to_gnu\n\nThis fixes a glitch introduced during the initial OpenACC work import\nprocess, causing crashes on any Acc_Parallel + Acc_Loop combination.\n\n2019-08-19  Olivier Hainque  <hainque@adacore.com>\n\ngcc/ada/\n\n\t* gcc-interface/trans.c (Acc_Loop_to_gnu): Return the openacc\n\tBIND_EXPR node we have constructed on purpose.  Remove unused\n\tvariable.\n\ngcc/testsuite/\n\n\t* gnat.dg/openacc1.adb: New testcase.\n\nFrom-SVN: r274638", "tree": {"sha": "33121678fa1ee560c5164912b09ba5cef04b1dba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33121678fa1ee560c5164912b09ba5cef04b1dba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04d933fd48d7e7cbedb761d660229cac9f36fab2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04d933fd48d7e7cbedb761d660229cac9f36fab2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04d933fd48d7e7cbedb761d660229cac9f36fab2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04d933fd48d7e7cbedb761d660229cac9f36fab2/comments", "author": {"login": "hainque", "id": 18735142, "node_id": "MDQ6VXNlcjE4NzM1MTQy", "avatar_url": "https://avatars.githubusercontent.com/u/18735142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hainque", "html_url": "https://github.com/hainque", "followers_url": "https://api.github.com/users/hainque/followers", "following_url": "https://api.github.com/users/hainque/following{/other_user}", "gists_url": "https://api.github.com/users/hainque/gists{/gist_id}", "starred_url": "https://api.github.com/users/hainque/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hainque/subscriptions", "organizations_url": "https://api.github.com/users/hainque/orgs", "repos_url": "https://api.github.com/users/hainque/repos", "events_url": "https://api.github.com/users/hainque/events{/privacy}", "received_events_url": "https://api.github.com/users/hainque/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c9d57552ed85ddfa6b76c755855d112e4cfe277d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9d57552ed85ddfa6b76c755855d112e4cfe277d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9d57552ed85ddfa6b76c755855d112e4cfe277d"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "0ead3078297ba457ba8053828b3152a631dc947d", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=04d933fd48d7e7cbedb761d660229cac9f36fab2", "patch": "@@ -1,3 +1,9 @@\n+2019-08-19  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* gcc-interface/trans.c (Acc_Loop_to_gnu): Return the openacc\n+\tBIND_EXPR node we have constructed on purpose.  Remove unused\n+\tvariable.\n+\n 2019-08-19  Pierre-Marie de Rodat  <derodat@adacore.com>\n \n \t* gcc-interface/lang.opt (fdump-scos): Define."}, {"sha": "6c696b9fdee0d2a97a3398b6b5ded4102f00043d", "filename": "gcc/ada/gcc-interface/trans.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Ftrans.c?ref=04d933fd48d7e7cbedb761d660229cac9f36fab2", "patch": "@@ -3398,9 +3398,6 @@ independent_iterations_p (tree stmt_list)\n static tree\n Acc_Loop_to_gnu (Node_Id gnat_loop)\n {\n-  const struct loop_info_d * const gnu_loop_info = gnu_loop_stack->last ();\n-  tree gnu_loop_stmt = gnu_loop_info->stmt;\n-\n   tree acc_loop = make_node (OACC_LOOP);\n   tree acc_bind_expr = NULL_TREE;\n   Node_Id cur_loop = gnat_loop;\n@@ -3517,7 +3514,7 @@ Acc_Loop_to_gnu (Node_Id gnat_loop)\n \n   BIND_EXPR_BODY (acc_bind_expr) = acc_loop;\n \n-  return gnu_loop_stmt;\n+  return acc_bind_expr;\n }\n \n /* Helper for Loop_Statement_to_gnu, to translate the body of a loop not"}, {"sha": "b68ff86979df8d3433c63b39c98b8c78be892dc5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=04d933fd48d7e7cbedb761d660229cac9f36fab2", "patch": "@@ -1,3 +1,7 @@\n+2019-08-19  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* gnat.dg/openacc1.adb: New testcase.\n+\n 2019-08-19  Kito Cheng  <kito.cheng@sifive.com>\n \n \tPR target/91441"}, {"sha": "ce27a5f48244dc4665c926bcb70091f34dfb26ac", "filename": "gcc/testsuite/gnat.dg/openacc1.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Ftestsuite%2Fgnat.dg%2Fopenacc1.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04d933fd48d7e7cbedb761d660229cac9f36fab2/gcc%2Ftestsuite%2Fgnat.dg%2Fopenacc1.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fopenacc1.adb?ref=04d933fd48d7e7cbedb761d660229cac9f36fab2", "patch": "@@ -0,0 +1,12 @@\n+--  { dg-do compile }\n+\n+procedure OpenAcc1 is\n+   type Integer_Array is array (1 .. 32) of Integer;\n+   Data : Integer_Array;\n+begin\n+   for i in Data'Range loop\n+      pragma Acc_Parallel;\n+      pragma Acc_Loop(Worker);\n+      Data (i) := i;\n+   end loop;\n+end;"}]}