{"sha": "63d0d1a376737338f737587dbe0efb98a7a8101d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjNkMGQxYTM3NjczNzMzOGY3Mzc1ODdkYmUwZWZiOThhN2E4MTAxZA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-29T10:21:52Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-29T10:21:52Z"}, "message": "[multiple changes]\n\n2012-10-29  Robert Dewar  <dewar@adacore.com>\n\n\t* warnsw.adb: Complete previous change.\n\n2012-10-29  Tristan Gingold  <gingold@adacore.com>\n\n\t* bindgen.adb (Check_File_In_Partition, Check_System_Restrictions_Used):\n\tRemoved.\n\t(Check_Dispatching_Domains_Used): Removed.\n\t(Gen_Adafinal): Remove call to above procedures.\n\t(Resolve_Binder_Options): Handle system restrictions and dispatching\n\tdomains.\n\n2012-10-29  Tristan Gingold  <gingold@adacore.com>\n\n\t* s-tarest.ads, s-tarest.adb (Create_Restricted_Task): Remove\n\tChain parameter.\n\t* exp_ch9.adb (Make_Task_Create_Call): Do not add Chain parameter\n\ton restricted runtime.\n\n2012-10-29  Pascal Obry  <obry@adacore.com>\n\n\t* g-sechas.adb, g-sechas.ads: Minor code clean-up.\n\nFrom-SVN: r192920", "tree": {"sha": "2db6b0cdcdb8e86bd4b29ad8d6f7162bd1e7f412", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2db6b0cdcdb8e86bd4b29ad8d6f7162bd1e7f412"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63d0d1a376737338f737587dbe0efb98a7a8101d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63d0d1a376737338f737587dbe0efb98a7a8101d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63d0d1a376737338f737587dbe0efb98a7a8101d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63d0d1a376737338f737587dbe0efb98a7a8101d/comments", "author": null, "committer": null, "parents": [{"sha": "616547fa1d304d5ca42831def8ddc2d8a1a6aa83", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/616547fa1d304d5ca42831def8ddc2d8a1a6aa83", "html_url": "https://github.com/Rust-GCC/gccrs/commit/616547fa1d304d5ca42831def8ddc2d8a1a6aa83"}], "stats": {"total": 173, "additions": 79, "deletions": 94}, "files": [{"sha": "f148bc8ebd6f93aac36c83daf30791ea7eecf874", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -1,3 +1,27 @@\n+2012-10-29  Robert Dewar  <dewar@adacore.com>\n+\n+\t* warnsw.adb: Complete previous change.\n+\n+2012-10-29  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* bindgen.adb (Check_File_In_Partition, Check_System_Restrictions_Used):\n+\tRemoved.\n+\t(Check_Dispatching_Domains_Used): Removed.\n+\t(Gen_Adafinal): Remove call to above procedures.\n+\t(Resolve_Binder_Options): Handle system restrictions and dispatching\n+\tdomains.\n+\n+2012-10-29  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* s-tarest.ads, s-tarest.adb (Create_Restricted_Task): Remove\n+\tChain parameter.\n+\t* exp_ch9.adb (Make_Task_Create_Call): Do not add Chain parameter\n+\ton restricted runtime.\n+\n+2012-10-29  Pascal Obry  <obry@adacore.com>\n+\n+\t* g-sechas.adb, g-sechas.ads: Minor code clean-up.\n+\n 2012-10-29  Ed Schonberg  <schonberg@adacore.com>\n \n \t* sem_aux.adb (Get_Rep_Item): Treat Priority and Interrupt_Priority"}, {"sha": "08a3e8e23fe91c8a893c52a948d29e7ee6c98c41", "filename": "gcc/ada/bindgen.adb", "status": "modified", "additions": 41, "deletions": 71, "changes": 112, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fbindgen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fbindgen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fbindgen.adb?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -63,20 +63,20 @@ package body Bindgen is\n    Num_Elab_Calls : Nat := 0;\n    --  Number of generated calls to elaboration routines\n \n-   System_Restrictions_Used : Boolean;\n+   System_Restrictions_Used : Boolean := False;\n    --  Flag indicating whether the unit System.Restrictions is in the closure\n-   --  of the partition. This is set by Check_System_Restrictions_Used, and\n+   --  of the partition. This is set by Resolve_Binder_Options, and\n    --  is used to determine whether or not to initialize the restrictions\n    --  information in the body of the binder generated file (we do not want\n    --  to do this unconditionally, since it drags in the System.Restrictions\n    --  unit unconditionally, which is unpleasand, especially for ZFP etc.)\n \n-   Dispatching_Domains_Used : Boolean;\n+   Dispatching_Domains_Used : Boolean := False;\n    --  Flag indicating whether multiprocessor dispatching domains are used in\n-   --  the closure of the partition. This is set by\n-   --  Check_Dispatching_Domains_Used, and is used to call the routine to\n-   --  disallow the creation of new dispatching domains just before calling\n-   --  the main procedure from the environment task.\n+   --  the closure of the partition. This is set by Resolve_Binder_Options,\n+   --  and is used to call the routine to disallow the creation of new\n+   --  dispatching domains just before calling the main procedure from the\n+   --  environment task.\n \n    System_Tasking_Restricted_Stages_Used : Boolean := False;\n    --  Flag indicating whether the unit System.Tasking.Restricted.Stages is in\n@@ -242,21 +242,6 @@ package body Bindgen is\n    -- Local Subprograms --\n    -----------------------\n \n-   procedure Check_File_In_Partition\n-     (File_Name : String;\n-      Flag      : out Boolean);\n-   --  If the file indicated by File_Name is in the partition the Flag is set\n-   --  to True, False otherwise.\n-\n-   procedure Check_System_Restrictions_Used;\n-   --  Sets flag System_Restrictions_Used (Set to True if and only if the unit\n-   --  System.Restrictions is present in the partition, otherwise False).\n-\n-   procedure Check_Dispatching_Domains_Used;\n-   --  Sets flag Dispatching_Domains_Used to True when using the unit\n-   --  System.Multiprocessors.Dispatching_Domains is present in the partition,\n-   --  otherwise set to False.\n-\n    procedure Gen_Adainit;\n    --  Generates the Adainit procedure\n \n@@ -391,43 +376,6 @@ package body Bindgen is\n    --  First writes its argument (using Set_String (S)), then writes out the\n    --  contents of statement buffer up to Last, and reset Last to 0\n \n-   ------------------------------------\n-   -- Check_Dispatching_Domains_Used --\n-   ------------------------------------\n-\n-   procedure Check_Dispatching_Domains_Used is\n-   begin\n-      Check_File_In_Partition (\"s-mudido.ads\", Dispatching_Domains_Used);\n-   end Check_Dispatching_Domains_Used;\n-\n-   -----------------------------\n-   -- Check_File_In_Partition --\n-   -----------------------------\n-\n-   procedure Check_File_In_Partition\n-     (File_Name : String;\n-      Flag      : out Boolean)\n-   is\n-   begin\n-      for J in Units.First .. Units.Last loop\n-         if Get_Name_String (Units.Table (J).Sfile) = File_Name then\n-            Flag := True;\n-            return;\n-         end if;\n-      end loop;\n-\n-      Flag := False;\n-   end Check_File_In_Partition;\n-\n-   ------------------------------------\n-   -- Check_System_Restrictions_Used --\n-   ------------------------------------\n-\n-   procedure Check_System_Restrictions_Used is\n-   begin\n-      Check_File_In_Partition (\"s-restri.ads\", System_Restrictions_Used);\n-   end Check_System_Restrictions_Used;\n-\n    ------------------\n    -- Gen_Adafinal --\n    ------------------\n@@ -2124,9 +2072,6 @@ package body Bindgen is\n \n       --  Generate output file in appropriate language\n \n-      Check_System_Restrictions_Used;\n-      Check_Dispatching_Domains_Used;\n-\n       Gen_Output_File_Ada (Filename);\n    end Gen_Output_File;\n \n@@ -2869,6 +2814,23 @@ package body Bindgen is\n    ----------------------------\n \n    procedure Resolve_Binder_Options is\n+      procedure Check_Package (Var : in out Boolean; Name : String);\n+      --  Set Var to true iff the current identifier in Namet is Name.\n+      --  Do nothing if it doesn't match. This procedure is just an helper\n+      --  to avoid to explicitely deal with length.\n+\n+      -------------------\n+      -- Check_Package --\n+      -------------------\n+\n+      procedure Check_Package (Var : in out Boolean; Name : String) is\n+      begin\n+         if Name_Len = Name'Length\n+           and then Name_Buffer (1 .. Name_Len) = Name\n+         then\n+            Var := True;\n+         end if;\n+      end Check_Package;\n    begin\n       for E in Elab_Order.First .. Elab_Order.Last loop\n          Get_Name_String (Units.Table (Elab_Order.Table (E)).Uname);\n@@ -2878,21 +2840,29 @@ package body Bindgen is\n          --  used: system.os_interface should always be used by any tasking\n          --  application.\n \n-         if Name_Buffer (1 .. 19) = \"system.os_interface\" then\n-            With_GNARL := True;\n-         end if;\n+         Check_Package (With_GNARL, \"system.os_interface%s\");\n \n          --  Ditto for declib and the \"dec\" package\n \n-         if OpenVMS_On_Target and then Name_Buffer (1 .. 5) = \"dec%s\" then\n-            With_DECGNAT := True;\n+         if OpenVMS_On_Target then\n+            Check_Package (With_DECGNAT, \"dec%s\");\n          end if;\n \n-         --  Likewise for the use of restricted tasking\n+         --  Ditto for the use of restricted tasking\n \n-         if Name_Buffer (1 .. 34) = \"system.tasking.restricted.stages%s\" then\n-            System_Tasking_Restricted_Stages_Used := True;\n-         end if;\n+         Check_Package\n+           (System_Tasking_Restricted_Stages_Used,\n+            \"system.tasking.restricted.stages%s\");\n+\n+         --  Ditto for the use of dispatching domains\n+\n+         Check_Package\n+           (Dispatching_Domains_Used,\n+            \"system.multiprocessors.dispatching_domains%s\");\n+\n+         --  Ditto for the use of restrictions\n+\n+         Check_Package (System_Restrictions_Used, \"system.restrictions%s\");\n       end loop;\n    end Resolve_Binder_Options;\n "}, {"sha": "474429eeb6c4dfb6fd530f973cbe5e164e935058", "filename": "gcc/ada/exp_ch9.adb", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fexp_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fexp_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch9.adb?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -13912,10 +13912,13 @@ package body Exp_Ch9 is\n           Prefix => Make_Identifier (Loc, New_External_Name (Tnam, 'E')),\n           Attribute_Name => Name_Unchecked_Access));\n \n-      --  Chain parameter. This is a reference to the _Chain parameter of\n-      --  the initialization procedure.\n+      if not Restricted_Profile then\n+         --  Chain parameter. This is a reference to the _Chain parameter of\n+         --  the initialization procedure. There is no chain in restricted\n+         --  profile.\n \n-      Append_To (Args, Make_Identifier (Loc, Name_uChain));\n+         Append_To (Args, Make_Identifier (Loc, Name_uChain));\n+      end if;\n \n       --  Task name parameter. Take this from the _Task_Id parameter to the\n       --  init call unless there is a Task_Name pragma, in which case we take"}, {"sha": "921ef3e624707a605fe17dc5fb6f201214d39c3b", "filename": "gcc/ada/g-sechas.adb", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fg-sechas.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fg-sechas.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-sechas.adb?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---           Copyright (C) 2009, Free Software Foundation, Inc.             --\n+--         Copyright (C) 2009-2012, Free Software Foundation, Inc.          --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -34,8 +34,6 @@ with Interfaces; use Interfaces;\n \n package body GNAT.Secure_Hashes is\n \n-   use Ada.Streams;\n-\n    Hex_Digit : constant array (Stream_Element range 0 .. 15) of Character :=\n                  \"0123456789abcdef\";\n "}, {"sha": "243bd6038fb4e89e15eb3af2d38e1447c4983b40", "filename": "gcc/ada/g-sechas.ads", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fg-sechas.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fg-sechas.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-sechas.ads?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---           Copyright (C) 2009, Free Software Foundation, Inc.             --\n+--         Copyright (C) 2009-2012, Free Software Foundation, Inc.          --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -36,7 +36,7 @@\n --  This is an internal unit and should be not used directly in applications.\n --  Use GNAT.MD5 and GNAT.SHA* instead.\n \n-with Ada.Streams;\n+with Ada.Streams; use Ada.Streams;\n with Interfaces;\n with System;\n \n@@ -84,7 +84,7 @@ package GNAT.Secure_Hashes is\n \n       procedure To_Hash\n         (H      : State;\n-         H_Bits : out Ada.Streams.Stream_Element_Array);\n+         H_Bits : out Stream_Element_Array);\n       --  Convert H to stream representation with the given bit order.\n       --  If H_Bits is smaller than the internal hash state, then the state\n       --  is truncated.\n@@ -147,7 +147,7 @@ package GNAT.Secure_Hashes is\n       procedure Wide_Update (C : in out Context; Input : Wide_String);\n       procedure Update\n         (C     : in out Context;\n-         Input : Ada.Streams.Stream_Element_Array);\n+         Input : Stream_Element_Array);\n       --  Update C to process the given input. Successive calls to Update are\n       --  equivalent to a single call with the concatenation of the inputs. For\n       --  the Wide_String version, each Wide_Character is processed low order\n@@ -166,8 +166,7 @@ package GNAT.Secure_Hashes is\n \n       function Digest      (S : String)      return Message_Digest;\n       function Wide_Digest (W : Wide_String) return Message_Digest;\n-      function Digest\n-        (A : Ada.Streams.Stream_Element_Array) return Message_Digest;\n+      function Digest      (A : Stream_Element_Array) return Message_Digest;\n       --  These functions are equivalent to the corresponding Update (or\n       --  Wide_Update) on a default initialized Context, followed by Digest\n       --  on the resulting Context."}, {"sha": "bba83ab76a96e9367baec74a53d9859269ebc4a5", "filename": "gcc/ada/s-tarest.adb", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fs-tarest.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fs-tarest.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tarest.adb?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -462,12 +462,9 @@ package body System.Tasking.Restricted.Stages is\n       State         : Task_Procedure_Access;\n       Discriminants : System.Address;\n       Elaborated    : Access_Boolean;\n-      Chain         : in out Activation_Chain;\n       Task_Image    : String;\n       Created_Task  : Task_Id)\n    is\n-      pragma Unreferenced (Chain);\n-\n       Self_ID       : constant Task_Id := STPO.Self;\n       Base_Priority : System.Any_Priority;\n       Base_CPU      : System.Multiprocessors.CPU_Range;"}, {"sha": "af7030e9bf7ed53275a3f86a841515f09b36f1cd", "filename": "gcc/ada/s-tarest.ads", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fs-tarest.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fs-tarest.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tarest.ads?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -89,7 +89,7 @@ package System.Tasking.Restricted.Stages is\n    --         create_restricted_task (unspecified_priority, tZ,\n    --           unspecified_task_info, unspecified_cpu,\n    --           task_procedure_access!(tB'address), _init'address,\n-   --           tE'unchecked_access, _chain, _task_name, _init._task_id);\n+   --           tE'unchecked_access, _task_name, _init._task_id);\n    --         return;\n    --      end tVIP;\n \n@@ -120,8 +120,6 @@ package System.Tasking.Restricted.Stages is\n    --   t1S : constant String := \"t1\";\n    --   tIP (t1, 3, _chain, t1S, 1);\n \n-   --   activate_restricted_tasks (_chain'unchecked_access);\n-\n    procedure Create_Restricted_Task\n      (Priority      : Integer;\n       Stack_Address : System.Address;\n@@ -131,7 +129,6 @@ package System.Tasking.Restricted.Stages is\n       State         : Task_Procedure_Access;\n       Discriminants : System.Address;\n       Elaborated    : Access_Boolean;\n-      Chain         : in out Activation_Chain;\n       Task_Image    : String;\n       Created_Task  : Task_Id);\n    --  Compiler interface only. Do not call from within the RTS.\n@@ -164,10 +161,6 @@ package System.Tasking.Restricted.Stages is\n    --  Elaborated is a pointer to a Boolean that must be set to true on exit\n    --  if the task could be successfully elaborated.\n    --\n-   --  Chain is a linked list of task that needs to be created. On exit,\n-   --  Created_Task.Activation_Link will be Chain.T_ID, and Chain.T_ID will be\n-   --  Created_Task (the created task will be linked at the front of Chain).\n-   --\n    --  Task_Image is a string created by the compiler that the run time can\n    --  store to ease the debugging and the Ada.Task_Identification facility.\n    --"}, {"sha": "3b4285773544422605f4077d36707070ef22130d", "filename": "gcc/ada/warnsw.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fwarnsw.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63d0d1a376737338f737587dbe0efb98a7a8101d/gcc%2Fada%2Fwarnsw.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fwarnsw.adb?ref=63d0d1a376737338f737587dbe0efb98a7a8101d", "patch": "@@ -236,6 +236,7 @@ package body Warnsw is\n       Warn_On_Record_Holes                := False;\n       Warn_On_Redundant_Constructs        := True;\n       Warn_On_Reverse_Bit_Order           := False;\n+      Warn_On_Standard_Redefinition       := True;\n       Warn_On_Suspicious_Contract         := True;\n       Warn_On_Unchecked_Conversion        := True;\n       Warn_On_Unordered_Enumeration_Type  := False;"}]}