{"sha": "246a2730176b7ad6bc24e9397cf41ccda733f460", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjQ2YTI3MzAxNzZiN2FkNmJjMjRlOTM5N2NmNDFjY2RhNzMzZjQ2MA==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2011-03-04T19:07:49Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2011-03-04T19:07:49Z"}, "message": "PR 47802 Use builtins to check localtime_r return type\n\nFrom-SVN: r170683", "tree": {"sha": "5c113b2f153cd7081f4f600fd26e915dce0b2c07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5c113b2f153cd7081f4f600fd26e915dce0b2c07"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/246a2730176b7ad6bc24e9397cf41ccda733f460", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/246a2730176b7ad6bc24e9397cf41ccda733f460", "html_url": "https://github.com/Rust-GCC/gccrs/commit/246a2730176b7ad6bc24e9397cf41ccda733f460", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/246a2730176b7ad6bc24e9397cf41ccda733f460/comments", "author": null, "committer": null, "parents": [{"sha": "87e7b310b3ddd203c446233d1517358e3708d9d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87e7b310b3ddd203c446233d1517358e3708d9d7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/87e7b310b3ddd203c446233d1517358e3708d9d7"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "33e2836ea7ff46c2ae65170116427d6c0415e5e9", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/246a2730176b7ad6bc24e9397cf41ccda733f460/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/246a2730176b7ad6bc24e9397cf41ccda733f460/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=246a2730176b7ad6bc24e9397cf41ccda733f460", "patch": "@@ -1,3 +1,9 @@\n+2011-03-04  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR libfortran/47802\n+\t* intrinsics/ctime.c (strctime): Use builtins to check localtime_r\n+\treturn type.\n+\n 2011-03-04  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR libfortran/47802"}, {"sha": "92c0431357e5c0a25ac074954abe47b51237cea3", "filename": "libgfortran/intrinsics/ctime.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/246a2730176b7ad6bc24e9397cf41ccda733f460/libgfortran%2Fintrinsics%2Fctime.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/246a2730176b7ad6bc24e9397cf41ccda733f460/libgfortran%2Fintrinsics%2Fctime.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fintrinsics%2Fctime.c?ref=246a2730176b7ad6bc24e9397cf41ccda733f460", "patch": "@@ -40,11 +40,16 @@ strctime (char *s, size_t max, const time_t *timep)\n {\n #ifdef HAVE_STRFTIME\n   struct tm ltm;\n-  /* Note: We can't use the return value of localtime_r, as some\n-     targets provide localtime_r based on a draft of the POSIX\n+  int failed;\n+  /* Some targets provide a localtime_r based on a draft of the POSIX\n      standard where the return type is int rather than the\n      standardized struct tm*.  */\n-  localtime_r (timep, &ltm);\n+  __builtin_choose_expr (__builtin_classify_type (localtime_r (timep, &ltm)) \n+\t\t\t == 5,\n+\t\t\t failed = localtime_r (timep, &ltm) == NULL,\n+\t\t\t failed = localtime_r (timep, &ltm) != 0);\n+  if (failed)\n+    return 0;\n   return strftime (s, max, \"%c\", &ltm);\n #else\n   return 0;"}]}