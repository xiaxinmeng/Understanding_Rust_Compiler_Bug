{"sha": "bc70af526c6b2243c68242d0aa6a48da9da4003d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmM3MGFmNTI2YzZiMjI0M2M2ODI0MmQwYWE2YTQ4ZGE5ZGE0MDAzZA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2006-09-11T00:40:15Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2006-09-11T00:40:15Z"}, "message": "re PR c++/28991 (Static constructor emitted instead of initialized variable)\n\n\tPR c++/28991\n\t* cp-objcp-common.c (cxx_staticp): New function.\n\t* cp-objcp-common.h (LANG_HOOOKS_STATICP): Use it.\n\t* cp-tree.h (cxx_staticp): New function.\n\tPR c++/289991\n\t* g++.dg/init/static3.C: New test.\n\nFrom-SVN: r116838", "tree": {"sha": "638e093b62285063b24863274ca086abe9301c4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/638e093b62285063b24863274ca086abe9301c4b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bc70af526c6b2243c68242d0aa6a48da9da4003d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc70af526c6b2243c68242d0aa6a48da9da4003d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc70af526c6b2243c68242d0aa6a48da9da4003d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc70af526c6b2243c68242d0aa6a48da9da4003d/comments", "author": null, "committer": null, "parents": [{"sha": "d35763beeab40ff256e819535bc6cc8eda90e6ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35763beeab40ff256e819535bc6cc8eda90e6ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d35763beeab40ff256e819535bc6cc8eda90e6ce"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "bcb6dc8fe61eca6da5d93eef5c6804ea39e48191", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=bc70af526c6b2243c68242d0aa6a48da9da4003d", "patch": "@@ -1,3 +1,10 @@\n+2006-09-10  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/28991\n+\t* cp-objcp-common.c (cxx_staticp): New function.\n+\t* cp-objcp-common.h (LANG_HOOOKS_STATICP): Use it.\n+\t* cp-tree.h (cxx_staticp): New function.\n+\n 2006-09-09  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/28996"}, {"sha": "f40be9696956ecf48c5bbab591303cb303454b89", "filename": "gcc/cp/cp-objcp-common.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2Fcp-objcp-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2Fcp-objcp-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-objcp-common.c?ref=bc70af526c6b2243c68242d0aa6a48da9da4003d", "patch": "@@ -185,6 +185,21 @@ cxx_types_compatible_p (tree x, tree y)\n   return 0;\n }\n \n+tree\n+cxx_staticp (tree arg)\n+{\n+  switch (TREE_CODE (arg))\n+    {\n+    case BASELINK:\n+      return staticp (BASELINK_FUNCTIONS (arg));\n+\n+    default:\n+      break;\n+    }\n+  \n+  return NULL_TREE;\n+}\n+\n /* Stubs to keep c-opts.c happy.  */\n void\n push_file_scope (void)"}, {"sha": "f420d93b191f5849910c5e2cb2be17c9a14c11ae", "filename": "gcc/cp/cp-objcp-common.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2Fcp-objcp-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2Fcp-objcp-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-objcp-common.h?ref=bc70af526c6b2243c68242d0aa6a48da9da4003d", "patch": "@@ -59,6 +59,8 @@ extern tree objcp_tsubst_copy_and_build (tree, tree, tsubst_flags_t,\n #define LANG_HOOKS_EXPAND_DECL c_expand_decl\n #undef LANG_HOOKS_PARSE_FILE\n #define LANG_HOOKS_PARSE_FILE c_common_parse_file\n+#undef LANG_HOOKS_STATICP\n+#define LANG_HOOKS_STATICP cxx_staticp\n #undef LANG_HOOKS_DUP_LANG_SPECIFIC_DECL\n #define LANG_HOOKS_DUP_LANG_SPECIFIC_DECL cxx_dup_lang_specific_decl\n #undef LANG_HOOKS_SET_DECL_ASSEMBLER_NAME"}, {"sha": "8f88976e78703352e506f49ee1d2eb2878df755a", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=bc70af526c6b2243c68242d0aa6a48da9da4003d", "patch": "@@ -4519,6 +4519,7 @@ extern bool cp_var_mod_type_p\t\t\t(tree, tree);\n extern void cxx_initialize_diagnostics\t\t(struct diagnostic_context *);\n extern int cxx_types_compatible_p\t\t(tree, tree);\n extern void init_shadowed_var_for_decl\t\t(void);\n+extern tree cxx_staticp                         (tree);\n \n /* in cp-gimplify.c */\n extern int cp_gimplify_expr\t\t\t(tree *, tree *, tree *);"}, {"sha": "55c511ee075a0379448aab29e8c5708265aa1c53", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bc70af526c6b2243c68242d0aa6a48da9da4003d", "patch": "@@ -1,3 +1,8 @@\n+2006-09-10  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/28991\n+\t* g++.dg/init/static3.C: New test.\n+\n 2006-09-10  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \tPR testsuite/29007"}, {"sha": "a8e62169f30cf6682f7fa2e1744f51539b1ab171", "filename": "gcc/testsuite/g++.dg/init/static3.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fstatic3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc70af526c6b2243c68242d0aa6a48da9da4003d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fstatic3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fstatic3.C?ref=bc70af526c6b2243c68242d0aa6a48da9da4003d", "patch": "@@ -0,0 +1,26 @@\n+// { dg-do run }\n+\n+struct T\n+{\n+  static void (*handler)();\n+  static void func() {};\n+};\n+\n+bool fail;\n+\n+struct S {\n+  S() {\n+    if (T::handler != T::func)\n+      fail = true;\n+  }\n+};\n+\n+static S s;\n+\n+void (*T::handler)() = func;\n+\n+int main()\n+{\n+  if (fail)\n+    return 1;\n+}"}]}