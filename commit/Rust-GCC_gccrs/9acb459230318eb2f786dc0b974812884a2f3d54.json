{"sha": "9acb459230318eb2f786dc0b974812884a2f3d54", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWFjYjQ1OTIzMDMxOGViMmY3ODZkYzBiOTc0ODEyODg0YTJmM2Q1NA==", "commit": {"author": {"name": "Evgeny Kudryashov", "email": "kudryashov@ispras.ru", "date": "2017-09-21T12:54:38Z"}, "committer": {"name": "Alexander Monakov", "email": "amonakov@gcc.gnu.org", "date": "2017-09-21T12:54:38Z"}, "message": "ipa: fix dumping with deleted multiversioning nodes\n\n2017-09-21  Evgeny Kudryashov <kudryashov@ispras.ru>\n\n\t* cgraph.c (delete_function_version): New, broken out from...\n\t(cgraph_node::delete_function_version): ...here.  Rename to\n\tcgraph_node::delete_function_version_by_decl.  Update all uses.\n\t(cgraph_node::remove): Call delete_function_version.\n\nFrom-SVN: r253066", "tree": {"sha": "ab2d39c2d809a1092c2c032f921a8d8bfd916544", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ab2d39c2d809a1092c2c032f921a8d8bfd916544"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9acb459230318eb2f786dc0b974812884a2f3d54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9acb459230318eb2f786dc0b974812884a2f3d54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9acb459230318eb2f786dc0b974812884a2f3d54", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9acb459230318eb2f786dc0b974812884a2f3d54/comments", "author": null, "committer": null, "parents": [{"sha": "765b3379354e3018b5440693625f8aace232f44a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/765b3379354e3018b5440693625f8aace232f44a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/765b3379354e3018b5440693625f8aace232f44a"}], "stats": {"total": 42, "additions": 27, "deletions": 15}, "files": [{"sha": "90dc208d572af44361b9d754e32d24daae216445", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9acb459230318eb2f786dc0b974812884a2f3d54", "patch": "@@ -1,3 +1,10 @@\n+2017-09-21  Evgeny Kudryashov <kudryashov@ispras.ru>\n+\n+\t* cgraph.c (delete_function_version): New, broken out from...\n+\t(cgraph_node::delete_function_version): ...here.  Rename to\n+\tcgraph_node::delete_function_version_by_decl.  Update all uses.\n+\t(cgraph_node::remove): Call delete_function_version.\n+\n 2017-09-21  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR sanitizer/81715"}, {"sha": "3d0cefbd46bacc1c9cb7b1cad8ee5d09a3e7eaf0", "filename": "gcc/cgraph.c", "status": "modified", "additions": 18, "deletions": 13, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=9acb459230318eb2f786dc0b974812884a2f3d54", "patch": "@@ -190,30 +190,34 @@ cgraph_node::insert_new_function_version (void)\n   return version_info_node;\n }\n \n-/* Remove the cgraph_function_version_info and cgraph_node for DECL.  This\n-   DECL is a duplicate declaration.  */\n-void\n-cgraph_node::delete_function_version (tree decl)\n+/* Remove the cgraph_function_version_info node given by DECL_V.  */\n+static void\n+delete_function_version (cgraph_function_version_info *decl_v)\n {\n-  cgraph_node *decl_node = cgraph_node::get (decl);\n-  cgraph_function_version_info *decl_v = NULL;\n-\n-  if (decl_node == NULL)\n-    return;\n-\n-  decl_v = decl_node->function_version ();\n-\n   if (decl_v == NULL)\n     return;\n \n   if (decl_v->prev != NULL)\n-   decl_v->prev->next = decl_v->next;\n+    decl_v->prev->next = decl_v->next;\n \n   if (decl_v->next != NULL)\n     decl_v->next->prev = decl_v->prev;\n \n   if (cgraph_fnver_htab != NULL)\n     cgraph_fnver_htab->remove_elt (decl_v);\n+}\n+\n+/* Remove the cgraph_function_version_info and cgraph_node for DECL.  This\n+   DECL is a duplicate declaration.  */\n+void\n+cgraph_node::delete_function_version_by_decl (tree decl)\n+{\n+  cgraph_node *decl_node = cgraph_node::get (decl);\n+\n+  if (decl_node == NULL)\n+    return;\n+\n+  delete_function_version (decl_node->function_version ());\n \n   decl_node->remove ();\n }\n@@ -1844,6 +1848,7 @@ cgraph_node::remove (void)\n   remove_callers ();\n   remove_callees ();\n   ipa_transforms_to_apply.release ();\n+  delete_function_version (function_version ());\n \n   /* Incremental inlining access removed nodes stored in the postorder list.\n      */"}, {"sha": "1758e8b08c17fc217d703aded9a2bc584548cec7", "filename": "gcc/cgraph.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2Fcgraph.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2Fcgraph.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.h?ref=9acb459230318eb2f786dc0b974812884a2f3d54", "patch": "@@ -1272,7 +1272,7 @@ struct GTY((tag (\"SYMTAB_FUNCTION\"))) cgraph_node : public symtab_node {\n \n   /* Remove the cgraph_function_version_info and cgraph_node for DECL.  This\n      DECL is a duplicate declaration.  */\n-  static void delete_function_version (tree decl);\n+  static void delete_function_version_by_decl (tree decl);\n \n   /* Add the function FNDECL to the call graph.\n      Unlike finalize_function, this function is intended to be used"}, {"sha": "50fa1ba402ec94ed39b095dcb16d65cfdf16bbf4", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9acb459230318eb2f786dc0b974812884a2f3d54/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=9acb459230318eb2f786dc0b974812884a2f3d54", "patch": "@@ -2566,7 +2566,7 @@ next_arg:;\n       DECL_FUNCTION_VERSIONED (newdecl) = 1;\n       /* newdecl will be purged after copying to olddecl and is no longer\n          a version.  */\n-      cgraph_node::delete_function_version (newdecl);\n+      cgraph_node::delete_function_version_by_decl (newdecl);\n     }\n \n   if (TREE_CODE (newdecl) == FUNCTION_DECL)"}]}