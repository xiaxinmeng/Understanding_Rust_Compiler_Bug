{"sha": "14f26c75d255ef05b706a12d25b003da8a2f5b45", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTRmMjZjNzVkMjU1ZWYwNWI3MDZhMTJkMjViMDAzZGE4YTJmNWI0NQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-06-14T13:18:33Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-06-14T14:10:56Z"}, "message": "libstdc++: Fix std::any constraints [PR101034]\n\n\tPR libstdc++/101034\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/any (any(in_place_t<T>, initializer_list<U>, A&&...))\n\t(any::emplace<T>(initializer_list<U>, A&&...)): Fix constraint\n\tto use lvalue.\n\t* testsuite/20_util/any/cons/101034.cc: New test.", "tree": {"sha": "869f9f55d955f5bf9f7f9090f616aca1ae42f0cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/869f9f55d955f5bf9f7f9090f616aca1ae42f0cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/14f26c75d255ef05b706a12d25b003da8a2f5b45", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14f26c75d255ef05b706a12d25b003da8a2f5b45", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14f26c75d255ef05b706a12d25b003da8a2f5b45", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14f26c75d255ef05b706a12d25b003da8a2f5b45/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "046198673c3776e36ebe0542a86291ed7134fc40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/046198673c3776e36ebe0542a86291ed7134fc40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/046198673c3776e36ebe0542a86291ed7134fc40"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "a6995b79c4322525bbaa3e8020ffd121f808fbe7", "filename": "libstdc++-v3/include/std/any", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14f26c75d255ef05b706a12d25b003da8a2f5b45/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fany", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14f26c75d255ef05b706a12d25b003da8a2f5b45/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fany", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fany?ref=14f26c75d255ef05b706a12d25b003da8a2f5b45", "patch": "@@ -205,7 +205,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     /// the contained object.\n     template <typename _Tp, typename _Up, typename... _Args,\n \t      typename _VTp = decay_t<_Tp>, typename _Mgr = _Manager<_VTp>,\n-\t      __any_constructible_t<_VTp, initializer_list<_Up>,\n+\t      __any_constructible_t<_VTp, initializer_list<_Up>&,\n \t\t\t\t    _Args&&...> = false>\n       explicit\n       any(in_place_type_t<_Tp>, initializer_list<_Up> __il, _Args&&... __args)\n@@ -269,7 +269,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     /// Emplace with an object created from @p __il and @p __args as\n     /// the contained object.\n     template <typename _Tp, typename _Up, typename... _Args>\n-      __emplace_t<decay_t<_Tp>, initializer_list<_Up>, _Args&&...>\n+      __emplace_t<decay_t<_Tp>, initializer_list<_Up>&, _Args&&...>\n       emplace(initializer_list<_Up> __il, _Args&&... __args)\n       {\n \tusing _VTp = decay_t<_Tp>;"}, {"sha": "55f550a839e7e6bb2109d76703d59ff320f5b969", "filename": "libstdc++-v3/testsuite/20_util/any/cons/101034.cc", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14f26c75d255ef05b706a12d25b003da8a2f5b45/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fany%2Fcons%2F101034.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14f26c75d255ef05b706a12d25b003da8a2f5b45/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fany%2Fcons%2F101034.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fany%2Fcons%2F101034.cc?ref=14f26c75d255ef05b706a12d25b003da8a2f5b45", "patch": "@@ -0,0 +1,11 @@\n+// { dg-do compile { target c++17 } }\n+// PR libstdc++/101034 - wrong constraint in std::any's constructor\n+\n+#include <any>\n+\n+struct S {\n+  S(std::initializer_list<int>&, int) {}\n+};\n+\n+std::any a(std::in_place_type<S>, {0}, 0);\n+S& s = a.emplace<S>({0}, 0);"}]}