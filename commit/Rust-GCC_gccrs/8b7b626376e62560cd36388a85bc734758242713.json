{"sha": "8b7b626376e62560cd36388a85bc734758242713", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGI3YjYyNjM3NmU2MjU2MGNkMzYzODhhODViYzczNDc1ODI0MjcxMw==", "commit": {"author": {"name": "Ghjuvan Lacambre", "email": "lacambre@adacore.com", "date": "2021-01-12T12:57:59Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-05-05T08:19:02Z"}, "message": "[Ada] Move Build_And_Insert_CUDA_Initialization to expansion phase\n\ngcc/ada/\n\n\t* exp_ch7.adb (Expand_N_Package_Body): Add CUDA init call.\n\t* sem_ch7.adb (Analyze_Package_Body_Helper): Remove CUDA init\n\tcall.", "tree": {"sha": "c488f356fd4a0e97ac7081bed3927c3d66179e80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c488f356fd4a0e97ac7081bed3927c3d66179e80"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b7b626376e62560cd36388a85bc734758242713", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b7b626376e62560cd36388a85bc734758242713", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b7b626376e62560cd36388a85bc734758242713", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b7b626376e62560cd36388a85bc734758242713/comments", "author": {"login": "glacambre", "id": 11534587, "node_id": "MDQ6VXNlcjExNTM0NTg3", "avatar_url": "https://avatars.githubusercontent.com/u/11534587?v=4", "gravatar_id": "", "url": "https://api.github.com/users/glacambre", "html_url": "https://github.com/glacambre", "followers_url": "https://api.github.com/users/glacambre/followers", "following_url": "https://api.github.com/users/glacambre/following{/other_user}", "gists_url": "https://api.github.com/users/glacambre/gists{/gist_id}", "starred_url": "https://api.github.com/users/glacambre/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/glacambre/subscriptions", "organizations_url": "https://api.github.com/users/glacambre/orgs", "repos_url": "https://api.github.com/users/glacambre/repos", "events_url": "https://api.github.com/users/glacambre/events{/privacy}", "received_events_url": "https://api.github.com/users/glacambre/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2b075f3de988b9c3bfabd06c585d5670dbcdadf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2b075f3de988b9c3bfabd06c585d5670dbcdadf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2b075f3de988b9c3bfabd06c585d5670dbcdadf"}], "stats": {"total": 16, "additions": 8, "deletions": 8}, "files": [{"sha": "d3c7ca7c5857af1151c466d2a2aad5c8d4a5cfa5", "filename": "gcc/ada/exp_ch7.adb", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b7b626376e62560cd36388a85bc734758242713/gcc%2Fada%2Fexp_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b7b626376e62560cd36388a85bc734758242713/gcc%2Fada%2Fexp_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch7.adb?ref=8b7b626376e62560cd36388a85bc734758242713", "patch": "@@ -43,6 +43,7 @@ with Exp_Prag;  use Exp_Prag;\n with Exp_Tss;   use Exp_Tss;\n with Exp_Util;  use Exp_Util;\n with Freeze;    use Freeze;\n+with GNAT_CUDA; use GNAT_CUDA;\n with Lib;       use Lib;\n with Nlists;    use Nlists;\n with Nmake;     use Nmake;\n@@ -5756,6 +5757,13 @@ package body Exp_Ch7 is\n             Build_Static_Dispatch_Tables (N);\n          end if;\n \n+         --  If procedures marked with CUDA_Global have been defined within N,\n+         --  we need to register them with the CUDA runtime at program startup.\n+         --  This requires multiple declarations and function calls which need\n+         --  to be appended to N's declarations.\n+\n+         Build_And_Insert_CUDA_Initialization (N);\n+\n          Build_Task_Activation_Call (N);\n \n          --  Verify the run-time semantics of pragma Initial_Condition at the"}, {"sha": "dcb2af5a6ae19e74212b8fa14a3d274b39cb1f3c", "filename": "gcc/ada/sem_ch7.adb", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b7b626376e62560cd36388a85bc734758242713/gcc%2Fada%2Fsem_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b7b626376e62560cd36388a85bc734758242713/gcc%2Fada%2Fsem_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch7.adb?ref=8b7b626376e62560cd36388a85bc734758242713", "patch": "@@ -40,7 +40,6 @@ with Exp_Dist;  use Exp_Dist;\n with Exp_Dbug;  use Exp_Dbug;\n with Freeze;    use Freeze;\n with Ghost;     use Ghost;\n-with GNAT_CUDA; use GNAT_CUDA;\n with Lib;       use Lib;\n with Lib.Xref;  use Lib.Xref;\n with Namet;     use Namet;\n@@ -1000,13 +999,6 @@ package body Sem_Ch7 is\n          Analyze_List (Declarations (N));\n       end if;\n \n-      --  If procedures marked with CUDA_Global have been defined within N, we\n-      --  need to register them with the CUDA runtime at program startup. This\n-      --  requires multiple declarations and function calls which need to be\n-      --  appended to N's declarations.\n-\n-      Build_And_Insert_CUDA_Initialization (N);\n-\n       HSS := Handled_Statement_Sequence (N);\n \n       if Present (HSS) then"}]}