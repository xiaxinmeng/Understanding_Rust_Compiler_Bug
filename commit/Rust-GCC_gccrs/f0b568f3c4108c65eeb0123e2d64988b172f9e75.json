{"sha": "f0b568f3c4108c65eeb0123e2d64988b172f9e75", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjBiNTY4ZjNjNDEwOGM2NWVlYjAxMjNlMmQ2NDk4OGIxNzJmOWU3NQ==", "commit": {"author": {"name": "Stuart Henderson", "email": "shenders@gcc.gnu.org", "date": "2011-05-03T16:24:59Z"}, "committer": {"name": "Stuart Henderson", "email": "shenders@gcc.gnu.org", "date": "2011-05-03T16:24:59Z"}, "message": "2011-05-03  Stuart Henderson  <shenders@gcc.gnu.org>\n\n        From Bernd Schmidt\n        * config/bfin/t-bfin (LIB1ASMFUNCS): Add muldi3 and umulsi3_highpart.\n        * config/bfin/t-bfin-elf (LIB1ASMFUNCS): Add muldi3.\n        * config/bfin/t-bfin-linux (LIB1ASMFUNCS): Add muldi3.\n        * config/bfin/t-bfin-uclinux (LIB1ASMFUNCS): Add muldi3.\n        * config/bfin/lib1funcs.asm (___muldi3): New function.\n\nFrom-SVN: r173323", "tree": {"sha": "9d107555698857e6953f36513721495e8170bd62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d107555698857e6953f36513721495e8170bd62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f0b568f3c4108c65eeb0123e2d64988b172f9e75", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0b568f3c4108c65eeb0123e2d64988b172f9e75", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0b568f3c4108c65eeb0123e2d64988b172f9e75", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0b568f3c4108c65eeb0123e2d64988b172f9e75/comments", "author": null, "committer": null, "parents": [{"sha": "2f6c3c820613ea26afed8e6fabe10ac9a2298d3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f6c3c820613ea26afed8e6fabe10ac9a2298d3b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f6c3c820613ea26afed8e6fabe10ac9a2298d3b"}], "stats": {"total": 83, "additions": 79, "deletions": 4}, "files": [{"sha": "8124e2289d7247bf29b7dcf98bc181919bec88c2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f0b568f3c4108c65eeb0123e2d64988b172f9e75", "patch": "@@ -1,3 +1,12 @@\n+2011-05-03  Stuart Henderson  <shenders@gcc.gnu.org>\n+\n+\tFrom Bernd Schmidt\n+\t* config/bfin/t-bfin (LIB1ASMFUNCS): Add muldi3 and umulsi3_highpart.\n+\t* config/bfin/t-bfin-elf (LIB1ASMFUNCS): Add muldi3.\n+\t* config/bfin/t-bfin-linux (LIB1ASMFUNCS): Add muldi3.\n+\t* config/bfin/t-bfin-uclinux (LIB1ASMFUNCS): Add muldi3.\n+\t* config/bfin/lib1funcs.asm (___muldi3): New function.\n+\n 2011-05-03  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* config/stormy16/stormy16 (xstormy16_init_builtins): Call"}, {"sha": "c7bf4f3f05c4fcfd2f9352a9e632d1497cf83b70", "filename": "gcc/config/bfin/lib1funcs.asm", "status": "modified", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Flib1funcs.asm", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Flib1funcs.asm", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fbfin%2Flib1funcs.asm?ref=f0b568f3c4108c65eeb0123e2d64988b172f9e75", "patch": "@@ -144,3 +144,68 @@ ___smulsi3_highpart:\n \tR0 = (A0 += A1);\n \tRTS;\n #endif\n+\n+#ifdef L_muldi3\n+.align 2\n+.global ___muldi3;\n+.type ___muldi3, STT_FUNC;\n+\n+/*\n+\t   R1:R0 * R3:R2\n+\t = R1.h:R1.l:R0.h:R0.l * R3.h:R3.l:R2.h:R2.l\n+[X]\t = (R1.h * R3.h) * 2^96\n+[X]\t   + (R1.h * R3.l + R1.l * R3.h) * 2^80\n+[X]\t   + (R1.h * R2.h + R1.l * R3.l + R3.h * R0.h) * 2^64\n+[T1]\t   + (R1.h * R2.l + R3.h * R0.l + R1.l * R2.h + R3.l * R0.h) * 2^48\n+[T2]\t   + (R1.l * R2.l + R3.l * R0.l + R0.h * R2.h) * 2^32\n+[T3]\t   + (R0.l * R2.h + R2.l * R0.h) * 2^16\n+[T4]\t   + (R0.l * R2.l)\n+\n+\tWe can discard the first three lines marked \"X\" since we produce\n+\tonly a 64 bit result.  So, we need ten 16-bit multiplies.\n+\n+\tIndividual mul-acc results:\n+[E1]\t =  R1.h * R2.l + R3.h * R0.l + R1.l * R2.h + R3.l * R0.h\n+[E2]\t =  R1.l * R2.l + R3.l * R0.l + R0.h * R2.h\n+[E3]\t =  R0.l * R2.h + R2.l * R0.h\n+[E4]\t =  R0.l * R2.l\n+\n+\tWe also need to add high parts from lower-level results to higher ones:\n+\tE[n]c = E[n] + (E[n+1]c >> 16), where E4c := E4\n+\n+\tOne interesting property is that all parts of the result that depend\n+\ton the sign of the multiplication are discarded.  Those would be the\n+\tmultiplications involving R1.h and R3.h, but only the top 16 bit of\n+\tthe 32 bit result depend on the sign, and since R1.h and R3.h only\n+\toccur in E1, the top half of these results is cut off.\n+\tSo, we can just use FU mode for all of the 16-bit multiplies, and\n+\tignore questions of when to use mixed mode.  */\n+\n+___muldi3:\n+\t/* [SP] technically is part of the caller's frame, but we can\n+\t   use it as scratch space.  */\n+\tA0 = R2.H * R1.L, A1 = R2.L * R1.H (FU) || R3 = [SP + 12];\t/* E1 */\n+\tA0 += R3.H * R0.L, A1 += R3.L * R0.H (FU) || [SP] = R4;\t\t/* E1 */\n+\tA0 += A1;\t\t\t\t\t\t\t/* E1 */\n+\tR4 = A0.w;\n+\tA0 = R0.l * R3.l (FU);\t\t\t\t\t\t/* E2 */\n+\tA0 += R2.l * R1.l (FU);\t\t\t\t\t\t/* E2 */\n+\n+\tA1 = R2.L * R0.L (FU);\t\t\t\t\t\t/* E4 */\n+\tR3 = A1.w;\n+\tA1 = A1 >> 16;\t\t\t\t\t\t\t/* E3c */\n+\tA0 += R2.H * R0.H, A1 += R2.L * R0.H (FU);\t\t\t/* E2, E3c */\n+\tA1 += R0.L * R2.H (FU);\t\t\t\t\t\t/* E3c */\n+\tR0 = A1.w;\n+\tA1 = A1 >> 16;\t\t\t\t\t\t\t/* E2c */\n+\tA0 += A1;\t\t\t\t\t\t\t/* E2c */\n+\tR1 = A0.w;\n+\n+\t/* low(result) = low(E3c):low(E4) */\n+\tR0 = PACK (R0.l, R3.l);\n+\t/* high(result) = E2c + (E1 << 16) */\n+\tR1.h = R1.h + R4.l (NS) || R4 = [SP];\n+\tRTS;\n+\n+.size ___muldi3, .-___muldi3\n+#endif"}, {"sha": "90ee8f2c1f7df0ebdd85aa54653de434e4604ba8", "filename": "gcc/config/bfin/t-bfin", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fbfin%2Ft-bfin?ref=f0b568f3c4108c65eeb0123e2d64988b172f9e75", "patch": "@@ -19,7 +19,8 @@\n ## Target part of the Makefile\n \n LIB1ASMSRC = bfin/lib1funcs.asm\n-LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3\n+LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _muldi3 _umulsi3_highpart\n+LIB1ASMFUNCS += _smulsi3_highpart\n \n EXTRA_PARTS = crtbegin.o crtend.o crti.o crtn.o\n "}, {"sha": "da242a08a21b63bee0222cac647a41560969097d", "filename": "gcc/config/bfin/t-bfin-elf", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin-elf", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin-elf", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fbfin%2Ft-bfin-elf?ref=f0b568f3c4108c65eeb0123e2d64988b172f9e75", "patch": "@@ -19,7 +19,7 @@\n ## Target part of the Makefile\n \n LIB1ASMSRC = bfin/lib1funcs.asm\n-LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _umulsi3_highpart\n+LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _muldi3 _umulsi3_highpart\n LIB1ASMFUNCS += _smulsi3_highpart\n \n FPBIT = fp-bit.c"}, {"sha": "daa1e059ce4644610023c11f78a093f5cc45724d", "filename": "gcc/config/bfin/t-bfin-linux", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin-linux", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin-linux", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fbfin%2Ft-bfin-linux?ref=f0b568f3c4108c65eeb0123e2d64988b172f9e75", "patch": "@@ -19,7 +19,7 @@\n ## Target part of the Makefile\n \n LIB1ASMSRC = bfin/lib1funcs.asm\n-LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _umulsi3_highpart\n+LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _muldi3 _umulsi3_highpart\n LIB1ASMFUNCS += _smulsi3_highpart\n \n FPBIT = fp-bit.c"}, {"sha": "0be258f2f1169bdfa49a79c3c79aa463de2f888f", "filename": "gcc/config/bfin/t-bfin-uclinux", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin-uclinux", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f0b568f3c4108c65eeb0123e2d64988b172f9e75/gcc%2Fconfig%2Fbfin%2Ft-bfin-uclinux", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fbfin%2Ft-bfin-uclinux?ref=f0b568f3c4108c65eeb0123e2d64988b172f9e75", "patch": "@@ -19,7 +19,7 @@\n ## Target part of the Makefile\n \n LIB1ASMSRC = bfin/lib1funcs.asm\n-LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _umulsi3_highpart\n+LIB1ASMFUNCS = _divsi3 _udivsi3 _umodsi3 _modsi3 _muldi3 _umulsi3_highpart\n LIB1ASMFUNCS += _smulsi3_highpart\n \n FPBIT = fp-bit.c"}]}