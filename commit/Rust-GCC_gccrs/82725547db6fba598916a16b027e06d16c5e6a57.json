{"sha": "82725547db6fba598916a16b027e06d16c5e6a57", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODI3MjU1NDdkYjZmYmE1OTg5MTZhMTZiMDI3ZTA2ZDE2YzVlNmE1Nw==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2009-05-18T19:19:52Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2009-05-18T19:19:52Z"}, "message": "re PR debug/40109 (Incorrect debug info nesting for typedef statements within namespaces)\n\nFix for PR debug/40109\n\ngcc/ChangeLog:\nPR debug/40109\n* dwarf2out.c (gen_type_die_with_usage): Generate the DIE as a\nchild of the containing namespace's DIE.\n\ngcc/testsuite/ChangeLog:\nPR debug/40109\n* g++.dg/debug/dwarf2/nested-1.C: New test.\n\nFrom-SVN: r147674", "tree": {"sha": "91d9fb61dc797d4cd4f4d2aff64f4e3ab110f200", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/91d9fb61dc797d4cd4f4d2aff64f4e3ab110f200"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/82725547db6fba598916a16b027e06d16c5e6a57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82725547db6fba598916a16b027e06d16c5e6a57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82725547db6fba598916a16b027e06d16c5e6a57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82725547db6fba598916a16b027e06d16c5e6a57/comments", "author": null, "committer": null, "parents": [{"sha": "f6a1e4301a7a2038e52cae4a2f4d2e2b94dfa5fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6a1e4301a7a2038e52cae4a2f4d2e2b94dfa5fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6a1e4301a7a2038e52cae4a2f4d2e2b94dfa5fc"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "6b82ac7257d871b2e72414890e4cd0634d37d331", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=82725547db6fba598916a16b027e06d16c5e6a57", "patch": "@@ -1,3 +1,9 @@\n+2009-05-18  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR debug/40109\n+\t* dwarf2out.c (gen_type_die_with_usage): Generate the DIE as a\n+\tchild of the containing namespace's DIE.\n+\n 2009-05-18  Adam Nemet  <anemet@caviumnetworks.com>\n \n \t* config/mips/mips.md (*zero_extend<GPR:mode>_trunc<SHORT:mode>,"}, {"sha": "cb1b988906a06e7df20a7c480f49ec58a5ce961a", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=82725547db6fba598916a16b027e06d16c5e6a57", "patch": "@@ -14642,6 +14642,12 @@ gen_type_die_with_usage (tree type, dw_die_ref context_die,\n       /* Prevent broken recursion; we can't hand off to the same type.  */\n       gcc_assert (DECL_ORIGINAL_TYPE (TYPE_NAME (type)) != type);\n \n+      /* Use the DIE of the containing namespace as the parent DIE of\n+         the type description DIE we want to generate.  */\n+      if (DECL_CONTEXT (TYPE_NAME (type))\n+\t  && TREE_CODE (DECL_CONTEXT (TYPE_NAME (type))) == NAMESPACE_DECL)\n+\tcontext_die = lookup_decl_die (DECL_CONTEXT (TYPE_NAME (type)));\n+\n       TREE_ASM_WRITTEN (type) = 1;\n       gen_decl_die (TYPE_NAME (type), NULL, context_die);\n       return;"}, {"sha": "1e1c805fa2161d31ae33a3760b75fe1ed2d5f2e1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=82725547db6fba598916a16b027e06d16c5e6a57", "patch": "@@ -1,3 +1,8 @@\n+2009-05-18  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR debug/40109\n+\t* g++.dg/debug/dwarf2/nested-1.C: New test.\n+\n 2009-05-18  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR testsuite/39907"}, {"sha": "336582c112acfd950ab8bc9a005620bf2de5a841", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/nested-1.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnested-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/82725547db6fba598916a16b027e06d16c5e6a57/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnested-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnested-1.C?ref=82725547db6fba598916a16b027e06d16c5e6a57", "patch": "@@ -0,0 +1,29 @@\n+// Contributed by Dodji Seketeli <dodji@redhat.com>\n+// Origin PR debug/40109\n+// { dg-do compile }\n+// { dg-options  \"-g -dA -O0\" }\n+\n+namespace A\n+{\n+\n+  class B\n+  {\n+  };\n+  typedef A::B AB;\n+};\n+\n+int\n+main()\n+{\n+  A::AB ab;\n+  return 0;\n+}\n+\n+// { dg-final { scan-assembler \"DW_TAG_typedef\" } }\n+//\n+// What we want to do here is to be sure that the DIE of A::AB is generated\n+// as a child of the DIE of the namespace A declaration.\n+// So this test won't catch a regression on this fix yet. To write a proper\n+// test for this fix, we would need a dwarf reader written in tcl,\n+// or something along those lines.\n+"}]}