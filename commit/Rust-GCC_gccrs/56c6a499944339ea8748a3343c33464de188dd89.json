{"sha": "56c6a499944339ea8748a3343c33464de188dd89", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTZjNmE0OTk5NDQzMzllYTg3NDhhMzM0M2MzMzQ2NGRlMTg4ZGQ4OQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-01-16T15:01:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-01-16T15:01:24Z"}, "message": "re PR tree-optimization/38789 (__builtin_constant_p appears to evaluate to true for non-constant arguments.)\n\n\tPR tree-optimization/38789\n\t* tree-ssa-threadedge.c\n\t(record_temporary_equivalences_from_stmts_at_dest): Ignore calls to\n\t__builtin_constant_p.\n\n\t* gcc.c-torture/compile/pr38789.c: New test.\n\nFrom-SVN: r143435", "tree": {"sha": "9df33194fd81217f9ff87cf28b63baefa8eae26c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9df33194fd81217f9ff87cf28b63baefa8eae26c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/56c6a499944339ea8748a3343c33464de188dd89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56c6a499944339ea8748a3343c33464de188dd89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56c6a499944339ea8748a3343c33464de188dd89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56c6a499944339ea8748a3343c33464de188dd89/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cd3f1729088b40dfaca41acf2cd238c0a1e81fcd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd3f1729088b40dfaca41acf2cd238c0a1e81fcd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd3f1729088b40dfaca41acf2cd238c0a1e81fcd"}], "stats": {"total": 46, "additions": 43, "deletions": 3}, "files": [{"sha": "d2f9fe7425da1d8025d0560513d45303e327650e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c6a499944339ea8748a3343c33464de188dd89/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c6a499944339ea8748a3343c33464de188dd89/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=56c6a499944339ea8748a3343c33464de188dd89", "patch": "@@ -1,3 +1,10 @@\n+2009-01-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/38789\n+\t* tree-ssa-threadedge.c\n+\t(record_temporary_equivalences_from_stmts_at_dest): Ignore calls to\n+\t__builtin_constant_p.\n+\n 2009-01-16  Kenneth Zadeck <zadeck@naturalbridge.com>\n \n \t* dce.c (delete_unmarked_insns): Reversed the order that insns are"}, {"sha": "e8a3cc3e5d15f6f5a8e1bf8181ccd672bdc02c64", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c6a499944339ea8748a3343c33464de188dd89/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c6a499944339ea8748a3343c33464de188dd89/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=56c6a499944339ea8748a3343c33464de188dd89", "patch": "@@ -1,3 +1,8 @@\n+2009-01-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/38789\n+\t* gcc.c-torture/compile/pr38789.c: New test.\n+\n 2009-01-16  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/38152"}, {"sha": "9179f6ccd914681e1681c7391ed8a1c3f0d3c677", "filename": "gcc/testsuite/gcc.c-torture/compile/pr38789.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c6a499944339ea8748a3343c33464de188dd89/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr38789.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c6a499944339ea8748a3343c33464de188dd89/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr38789.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr38789.c?ref=56c6a499944339ea8748a3343c33464de188dd89", "patch": "@@ -0,0 +1,18 @@\n+/* PR tree-optimization/38789 */\n+\n+void\n+baz (int v)\n+{\n+  unsigned a = (v == 1) ? 1 : 2;\n+\n+  if (__builtin_constant_p (a))\n+    asm volatile (\"# constant %0\" :: \"i\" (a));\n+  else\n+    asm volatile (\"# register %0\" :: \"r\" (a));\n+\n+  a = 6;\n+  if (__builtin_constant_p (a))\n+    asm volatile (\"# constant %0\" :: \"i\" (a));\n+  else\n+    asm volatile (\"# register %0\" :: \"r\" (a));\n+}"}, {"sha": "1429c18c99832aa83926d8f1e5c2051e1641baca", "filename": "gcc/tree-ssa-threadedge.c", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c6a499944339ea8748a3343c33464de188dd89/gcc%2Ftree-ssa-threadedge.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c6a499944339ea8748a3343c33464de188dd89/gcc%2Ftree-ssa-threadedge.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-threadedge.c?ref=56c6a499944339ea8748a3343c33464de188dd89", "patch": "@@ -1,5 +1,5 @@\n /* SSA Jump Threading\n-   Copyright (C) 2005, 2006, 2007 Free Software Foundation, Inc.\n+   Copyright (C) 2005, 2006, 2007, 2008, 2009 Free Software Foundation, Inc.\n    Contributed by Jeff Law  <law@redhat.com>\n \n This file is part of GCC.\n@@ -320,12 +320,22 @@ record_temporary_equivalences_from_stmts_at_dest (edge e,\n \n \t The result of __builtin_object_size is defined to be the maximum of\n \t remaining bytes. If we use only one edge on the phi, the result will\n-\t change to be the remaining bytes for the corresponding phi argument. */\n+\t change to be the remaining bytes for the corresponding phi argument.\n+\n+\t Similarly for __builtin_constant_p:\n+\n+\t r = PHI <1(2), 2(3)>\n+\t __builtin_constant_p (r)\n+\n+\t Both PHI arguments are constant, but x ? 1 : 2 is still not\n+\t constant.  */\n \n       if (is_gimple_call (stmt))\n \t{\n \t  tree fndecl = gimple_call_fndecl (stmt);\n-\t  if (fndecl && DECL_FUNCTION_CODE (fndecl) == BUILT_IN_OBJECT_SIZE)\n+\t  if (fndecl\n+\t      && (DECL_FUNCTION_CODE (fndecl) == BUILT_IN_OBJECT_SIZE\n+\t\t  || DECL_FUNCTION_CODE (fndecl) == BUILT_IN_CONSTANT_P))\n \t    continue;\n \t}\n "}]}