{"sha": "5b15f31ae8263268f140f0ffaf214df88b36ecbc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWIxNWYzMWFlODI2MzI2OGYxNDBmMGZmYWYyMTRkZjg4YjM2ZWNiYw==", "commit": {"author": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2020-01-01T22:57:54Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2020-01-01T22:57:54Z"}, "message": "re PR target/67834 (Local references inside comdat groups)\n\n\tPR target/67834\n\t* config/pa/pa.c (pa_elf_select_rtx_section): New.  Put references to\n\tCOMDAT group function labels in .data.rel.ro.local section.\n\t* config/pa/pa32-linux.h (TARGET_ASM_SELECT_RTX_SECTION): Define.\n\nFrom-SVN: r279823", "tree": {"sha": "e2578fcc5d721b44b1d4c390473503dfadfc5ee0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e2578fcc5d721b44b1d4c390473503dfadfc5ee0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b15f31ae8263268f140f0ffaf214df88b36ecbc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b15f31ae8263268f140f0ffaf214df88b36ecbc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b15f31ae8263268f140f0ffaf214df88b36ecbc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b15f31ae8263268f140f0ffaf214df88b36ecbc/comments", "author": null, "committer": null, "parents": [{"sha": "b31f1b64ab243b3c5879479577583b813672892d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b31f1b64ab243b3c5879479577583b813672892d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b31f1b64ab243b3c5879479577583b813672892d"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "382c3004d1c413324fd36f3186cfb5018c31e475", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b15f31ae8263268f140f0ffaf214df88b36ecbc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b15f31ae8263268f140f0ffaf214df88b36ecbc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5b15f31ae8263268f140f0ffaf214df88b36ecbc", "patch": "@@ -1,5 +1,10 @@\n 2020-01-01  John David Anglin  <danglin@gcc.gnu.org>\n \n+\tPR target/67834\n+\t* config/pa/pa.c (pa_elf_select_rtx_section): New.  Put references to\n+\tCOMDAT group function labels in .data.rel.ro.local section.\n+\t* config/pa/pa32-linux.h (TARGET_ASM_SELECT_RTX_SECTION): Define.\n+\n \tPR target/93111\n \t* config/pa/pa.md (scc): Use ordered_comparison_operator instead of\n \tcomparison_operator in B and S integer comparisons.  Likewise, use"}, {"sha": "fb7e2ee110fff65970e9cb9e80577e49825df94c", "filename": "gcc/config/pa/pa.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b15f31ae8263268f140f0ffaf214df88b36ecbc/gcc%2Fconfig%2Fpa%2Fpa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b15f31ae8263268f140f0ffaf214df88b36ecbc/gcc%2Fconfig%2Fpa%2Fpa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.c?ref=5b15f31ae8263268f140f0ffaf214df88b36ecbc", "patch": "@@ -203,6 +203,7 @@ static bool pa_hard_regno_mode_ok (unsigned int, machine_mode);\n static bool pa_modes_tieable_p (machine_mode, machine_mode);\n static bool pa_can_change_mode_class (machine_mode, machine_mode, reg_class_t);\n static HOST_WIDE_INT pa_starting_frame_offset (void);\n+static section* pa_elf_select_rtx_section(machine_mode, rtx, unsigned HOST_WIDE_INT) ATTRIBUTE_UNUSED;\n \n /* The following extra sections are only used for SOM.  */\n static GTY(()) section *som_readonly_data_section;\n@@ -9838,6 +9839,26 @@ pa_select_section (tree exp, int reloc,\n     return data_section;\n }\n \n+/* Implement pa_elf_select_rtx_section.  If X is a function label operand\n+   and the function is in a COMDAT group, place the plabel reference in the\n+   .data.rel.ro.local section.  The linker ignores references to symbols in\n+   discarded sections from this section.  */\n+   \n+static section *\n+pa_elf_select_rtx_section (machine_mode mode, rtx x,\n+\t\t\t   unsigned HOST_WIDE_INT align)\n+{\n+  if (function_label_operand (x, VOIDmode))\n+    {\n+      tree decl = SYMBOL_REF_DECL (x);\n+\n+      if (DECL_P (decl) && DECL_COMDAT_GROUP (decl))\n+\treturn get_named_section (NULL, \".data.rel.ro.local\", 1);\n+    }\n+\n+  return default_elf_select_rtx_section (mode, x, align);\n+}\n+\n /* Implement pa_reloc_rw_mask.  */\n \n static int"}, {"sha": "f271bbf51a259404720f69e66725caaeade6e257", "filename": "gcc/config/pa/pa32-linux.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b15f31ae8263268f140f0ffaf214df88b36ecbc/gcc%2Fconfig%2Fpa%2Fpa32-linux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b15f31ae8263268f140f0ffaf214df88b36ecbc/gcc%2Fconfig%2Fpa%2Fpa32-linux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa32-linux.h?ref=5b15f31ae8263268f140f0ffaf214df88b36ecbc", "patch": "@@ -76,3 +76,8 @@ call_ ## FUNC (void)\t\t\t\t\t\\\n    rodata when generating non-PIC code.  */\n #undef JUMP_TABLES_IN_TEXT_SECTION\n #define JUMP_TABLES_IN_TEXT_SECTION (flag_pic)\n+\n+/* We need to override default selection to put references to functions\n+   in COMDAT groups in .data.rel.ro.local.  */\n+#undef TARGET_ASM_SELECT_RTX_SECTION\n+#define TARGET_ASM_SELECT_RTX_SECTION pa_elf_select_rtx_section"}]}