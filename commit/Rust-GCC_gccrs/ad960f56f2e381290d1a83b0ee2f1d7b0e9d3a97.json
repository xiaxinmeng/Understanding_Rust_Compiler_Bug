{"sha": "ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWQ5NjBmNTZmMmUzODEyOTBkMWE4M2IwZWUyZjFkN2IwZTlkM2E5Nw==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-06-30T12:56:43Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-06-30T12:56:43Z"}, "message": "re PR c/4076 (-Wunused doesn't warn about static function only called by itself.)\n\n2007-06-30  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR c/4076\n\t* c-typeck.c (build_external_ref): Don't mark as used if called\n\tfrom itself.\n\t* calls.c (rtx_for_function_call): Likewise.\n\ntestsuite/\n\t* gcc.dg/Wunused-function.c: New.\n\nFrom-SVN: r126144", "tree": {"sha": "6cf59c10b1848193cc5f27b945729e4c00add85d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6cf59c10b1848193cc5f27b945729e4c00add85d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/comments", "author": null, "committer": null, "parents": [{"sha": "a4fbe84bd2ae7c5cacbada14abe4d3b9a7bbe6d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4fbe84bd2ae7c5cacbada14abe4d3b9a7bbe6d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4fbe84bd2ae7c5cacbada14abe4d3b9a7bbe6d0"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "104942acd5991ace39140643ebfb5e67d5a4dc2c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "patch": "@@ -1,3 +1,10 @@\n+2007-06-30  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c/4076\n+\t* c-typeck.c (build_external_ref): Don't mark as used if called\n+\tfrom itself.\n+\t* calls.c (rtx_for_function_call): Likewise.\n+\t\n 2007-06-30  Richard Sandiford  <richard@codesourcery.com>\n \n \tRevert:"}, {"sha": "0793b6005acc604b68b4d82e86eecb924052afe8", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "patch": "@@ -2090,9 +2090,13 @@ build_external_ref (tree id, int fun, location_t loc)\n   if (TREE_DEPRECATED (ref))\n     warn_deprecated_use (ref);\n \n-  if (!skip_evaluation)\n-    assemble_external (ref);\n-  TREE_USED (ref) = 1;\n+  /* Recursive call does not count as usage.  */\n+  if (ref != current_function_decl) \n+    {\n+      if (!skip_evaluation)\n+\tassemble_external (ref);\n+      TREE_USED (ref) = 1;\n+    }\n \n   if (TREE_CODE (ref) == FUNCTION_DECL && !in_alignof)\n     {"}, {"sha": "aa63755d26d0a074929ac2b90dff4597bf0eeb42", "filename": "gcc/calls.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Fcalls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Fcalls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.c?ref=ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "patch": "@@ -1493,7 +1493,7 @@ rtx_for_function_call (tree fndecl, tree addr)\n     {\n       /* If this is the first use of the function, see if we need to\n \t make an external definition for it.  */\n-      if (! TREE_USED (fndecl))\n+      if (!TREE_USED (fndecl) && fndecl != current_function_decl)\n \t{\n \t  assemble_external (fndecl);\n \t  TREE_USED (fndecl) = 1;"}, {"sha": "5367e3f1028d1471b85d56b9ada4f3e8002b0fba", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "patch": "@@ -1,3 +1,8 @@\n+2007-06-30  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c/4076\n+\t* gcc.dg/Wunused-function.c: New.\n+\t\n 2007-06-29  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \t* gfortran.fortran-torture/compile/inline_1.f90: Fix test."}, {"sha": "1c59c50038be6ee92252d30bb4de4fdcda5529f9", "filename": "gcc/testsuite/gcc.dg/Wunused-function.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Ftestsuite%2Fgcc.dg%2FWunused-function.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97/gcc%2Ftestsuite%2Fgcc.dg%2FWunused-function.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWunused-function.c?ref=ad960f56f2e381290d1a83b0ee2f1d7b0e9d3a97", "patch": "@@ -0,0 +1,6 @@\n+/* PR c/4076  -Wunused doesn't warn about static function only called by itself.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wunused-function\" } */\n+\n+static void foo (void) {} /* { dg-warning \"'foo' defined but not used\" } */\n+static void bar (void) { bar (); } /* { dg-warning \"'bar' defined but not used\" } */"}]}