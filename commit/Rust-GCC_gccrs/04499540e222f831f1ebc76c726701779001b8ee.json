{"sha": "04499540e222f831f1ebc76c726701779001b8ee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDQ0OTk1NDBlMjIyZjgzMWYxZWJjNzZjNzI2NzAxNzc5MDAxYjhlZQ==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2006-08-17T09:07:39Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2006-08-17T09:07:39Z"}, "message": "re PR c++/28606 (Destructor accepted as return-type of constructor)\n\n\tPR c++/28606\n\t* parser.c (cp_parser_diagnose_invalid_type_name): Handle BIT_NOT_EXPR.\n\tFix formatting.\n\t(cp_parser_parse_and_diagnose_invalid_type_name): Tighten condition\n\tfor valid type-names.\n\t(cp_parser_unqualified_id): Fix error handling for destructors.\n\n\t* g++.dg/parse/dtor11.C: New test.\n\nFrom-SVN: r116217", "tree": {"sha": "0c190760dbae3e7281868aa5ab64276418b10d53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0c190760dbae3e7281868aa5ab64276418b10d53"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04499540e222f831f1ebc76c726701779001b8ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04499540e222f831f1ebc76c726701779001b8ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04499540e222f831f1ebc76c726701779001b8ee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04499540e222f831f1ebc76c726701779001b8ee/comments", "author": null, "committer": null, "parents": [{"sha": "3f1e3e7010cf18ef218f107015b8f66fc75ed4d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3f1e3e7010cf18ef218f107015b8f66fc75ed4d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3f1e3e7010cf18ef218f107015b8f66fc75ed4d9"}], "stats": {"total": 40, "additions": 34, "deletions": 6}, "files": [{"sha": "8f767b06cd9d5696ad4f0d567e9edf48aa883a33", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=04499540e222f831f1ebc76c726701779001b8ee", "patch": "@@ -1,5 +1,12 @@\n 2006-08-17  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n+\tPR c++/28606\n+\t* parser.c (cp_parser_diagnose_invalid_type_name): Handle BIT_NOT_EXPR.\n+\tFix formatting.\n+\t(cp_parser_parse_and_diagnose_invalid_type_name): Tighten condition\n+\tfor valid type-names.\n+\t(cp_parser_unqualified_id): Fix error handling for destructors.\n+\n \tPR c++/28710\n \t* decl.c (xref_tag): Improve error message.  Return early on error.\n "}, {"sha": "78e6eb69d55992aaac667a21e4c61e4101e5bdf4", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=04499540e222f831f1ebc76c726701779001b8ee", "patch": "@@ -2093,8 +2093,9 @@ cp_parser_diagnose_invalid_type_name (cp_parser *parser, tree scope, tree id)\n   /* If the lookup found a template-name, it means that the user forgot\n   to specify an argument list. Emit a useful error message.  */\n   if (TREE_CODE (decl) == TEMPLATE_DECL)\n-    error (\"invalid use of template-name %qE without an argument list\",\n-      decl);\n+    error (\"invalid use of template-name %qE without an argument list\", decl);\n+  else if (TREE_CODE (id) == BIT_NOT_EXPR)\n+    error (\"invalid use of destructor %qD as a type\", id);\n   else if (!parser->scope)\n     {\n       /* Issue an error message.  */\n@@ -2187,8 +2188,7 @@ cp_parser_parse_and_diagnose_invalid_type_name (cp_parser *parser)\n       cp_parser_abort_tentative_parse (parser);\n       return false;\n     }\n-  if (!cp_parser_parse_definitely (parser)\n-      || TREE_CODE (id) != IDENTIFIER_NODE)\n+  if (!cp_parser_parse_definitely (parser) || TREE_CODE (id) == TYPE_DECL)\n     return false;\n \n   /* Emit a diagnostic for the invalid type.  */\n@@ -3407,14 +3407,17 @@ cp_parser_unqualified_id (cp_parser* parser,\n \t/* Check for invalid scopes.  */\n \tif (scope == error_mark_node)\n \t  {\n-\t    cp_parser_skip_to_end_of_statement (parser);\n+\t    if (cp_lexer_next_token_is (parser->lexer, CPP_NAME))\n+\t      cp_lexer_consume_token (parser->lexer);\n \t    return error_mark_node;\n \t  }\n \tif (scope && TREE_CODE (scope) == NAMESPACE_DECL)\n \t  {\n \t    if (!cp_parser_uncommitted_to_tentative_parse_p (parser))\n \t      error (\"scope %qT before %<~%> is not a class-name\", scope);\n-\t    cp_parser_skip_to_end_of_statement (parser);\n+\t    cp_parser_simulate_error (parser);\n+\t    if (cp_lexer_next_token_is (parser->lexer, CPP_NAME))\n+\t      cp_lexer_consume_token (parser->lexer);\n \t    return error_mark_node;\n \t  }\n \tgcc_assert (!scope || TYPE_P (scope));\n@@ -3514,6 +3517,7 @@ cp_parser_unqualified_id (cp_parser* parser,\n \t    if (!cp_parser_uncommitted_to_tentative_parse_p (parser))\n \t      error (\"declaration of %<~%T%> as member of %qT\",\n \t\t     type_decl, scope);\n+\t    cp_parser_simulate_error (parser);\n \t    return error_mark_node;\n \t  }\n "}, {"sha": "3ccd52def7b924e46f84aa3e6236e90c8704ca95", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=04499540e222f831f1ebc76c726701779001b8ee", "patch": "@@ -1,3 +1,8 @@\n+2006-08-17  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR c++/28606\n+\t* g++.dg/parse/dtor11.C: New test.\n+\n 2006-08-17  Maxim Kuvyrkov  <mkuvyrkov@ispras.ru>\n \n \tPR rtl-optimization/28489"}, {"sha": "63ffb60bac107dfe2f8f5d9d138ac4d91de01592", "filename": "gcc/testsuite/g++.dg/parse/dtor11.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fdtor11.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04499540e222f831f1ebc76c726701779001b8ee/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fdtor11.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fdtor11.C?ref=04499540e222f831f1ebc76c726701779001b8ee", "patch": "@@ -0,0 +1,12 @@\n+// PR c++/28606\n+// { dg-do compile }\n+\n+struct A\n+{\n+  ~A A();     // { dg-error \"destructor\" }\n+};\n+\n+struct B\n+{\n+  A::~B B();  // { dg-error \"as member of\" }\n+};"}]}