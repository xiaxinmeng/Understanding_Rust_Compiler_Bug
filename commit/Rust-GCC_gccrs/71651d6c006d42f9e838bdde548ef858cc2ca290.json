{"sha": "71651d6c006d42f9e838bdde548ef858cc2ca290", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzE2NTFkNmMwMDZkNDJmOWU4MzhiZGRlNTQ4ZWY4NThjYzJjYTI5MA==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@cygnus.com", "date": "1999-11-10T01:38:24Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-11-10T01:38:24Z"}, "message": "re GNATS gcj/84 (path to classes.zip is compiled in to gcj at build time)\n\n\t* jcf-path.c: Include <sys/stat.h>.\n\t(jcf_path_init): Search for libjava.zip.  Fixes PR gcj/84.\n\t(DIR_UP): New macro.\n\nFrom-SVN: r30465", "tree": {"sha": "9de7681a0f7fb805f282cfc9cf34589ddba957a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9de7681a0f7fb805f282cfc9cf34589ddba957a3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/71651d6c006d42f9e838bdde548ef858cc2ca290", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71651d6c006d42f9e838bdde548ef858cc2ca290", "html_url": "https://github.com/Rust-GCC/gccrs/commit/71651d6c006d42f9e838bdde548ef858cc2ca290", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71651d6c006d42f9e838bdde548ef858cc2ca290/comments", "author": null, "committer": null, "parents": [{"sha": "0deb20dfd390157a38350b7d3e4a87ba9be6bcdd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0deb20dfd390157a38350b7d3e4a87ba9be6bcdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0deb20dfd390157a38350b7d3e4a87ba9be6bcdd"}], "stats": {"total": 61, "additions": 60, "deletions": 1}, "files": [{"sha": "14f65aaf75742f894154adf4429a00c45023553e", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71651d6c006d42f9e838bdde548ef858cc2ca290/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71651d6c006d42f9e838bdde548ef858cc2ca290/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=71651d6c006d42f9e838bdde548ef858cc2ca290", "patch": "@@ -1,3 +1,9 @@\n+1999-11-09  Tom Tromey  <tromey@cygnus.com>\n+\n+\t* jcf-path.c: Include <sys/stat.h>.\n+\t(jcf_path_init): Search for libjava.zip.  Fixes PR gcj/84.\n+\t(DIR_UP): New macro.\n+\n Tue Nov  9 12:12:38 1999  Alexandre Petit-Bianco  <apbianco@cygnus.com>\n \n \t* parse.y (source_end_java_method): Resume permanent allocation,"}, {"sha": "c0cd3a744ccdbdb5e3b8f033fd7ab31f3322b04c", "filename": "gcc/java/jcf-path.c", "status": "modified", "additions": 54, "deletions": 1, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71651d6c006d42f9e838bdde548ef858cc2ca290/gcc%2Fjava%2Fjcf-path.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71651d6c006d42f9e838bdde548ef858cc2ca290/gcc%2Fjava%2Fjcf-path.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fjcf-path.c?ref=71651d6c006d42f9e838bdde548ef858cc2ca290", "patch": "@@ -43,6 +43,10 @@ The Free Software Foundation is independent of Sun Microsystems, Inc.  */\n #define DIR_SEPARATOR '/'\n #endif\n \n+#ifndef DIR_UP\n+#define DIR_UP \"..\"\n+#endif\n+\n \f\n \n /* Possible flag values.  */\n@@ -223,9 +227,58 @@ void\n jcf_path_init ()\n {\n   char *cp;\n+  char *try, sep[2];\n+  struct stat stat_b;\n+  int found = 0, len;\n \n   add_entry (&sys_dirs, \".\", 0);\n-  add_entry (&sys_dirs, LIBGCJ_ZIP_FILE, 1);\n+\n+  sep[0] = DIR_SEPARATOR;\n+  sep[1] = '\\0';\n+\n+  GET_ENV_PATH_LIST (cp, \"GCC_EXEC_PREFIX\");\n+  if (cp)\n+    {\n+      try = alloca (strlen (cp) + 50);\n+      /* The exec prefix can be something like\n+\t /usr/local/bin/../lib/gcc-lib/.  We want to change this\n+\t into a pointer to the share directory.  We support two\n+\t configurations: one where prefix and exec-prefix are the\n+\t same, and one where exec-prefix is `prefix/SOMETHING'.  */\n+      strcpy (try, cp);\n+      strcat (try, DIR_UP);\n+      strcat (try, sep);\n+      strcat (try, DIR_UP);\n+      strcat (try, sep);\n+      len = strlen (try);\n+\n+      strcpy (try + len, \"share\");\n+      strcat (try, sep);\n+      strcat (try, \"libgcj.zip\");\n+      if (! stat (try, &stat_b))\n+\t{\n+\t  add_entry (&sys_dirs, try, 1);\n+\t  found = 1;\n+\t}\n+      else\n+\t{\n+\t  strcpy (try + len, DIR_UP);\n+\t  strcat (try, sep);\n+\t  strcat (try, \"share\");\n+\t  strcat (try, sep);\n+\t  strcat (try, \"libgcj.zip\");\n+\t  if (! stat (try, &stat_b))\n+\t    {\n+\t      add_entry (&sys_dirs, try, 1);\n+\t      found = 1;\n+\t    }\n+\t}\n+    }\n+  if (! found)\n+    {\n+      /* Desperation: use the installed one.  */\n+      add_entry (&sys_dirs, LIBGCJ_ZIP_FILE, 1);\n+    }\n \n   GET_ENV_PATH_LIST (cp, \"CLASSPATH\");\n   add_path (&classpath_env, cp, 0);"}]}