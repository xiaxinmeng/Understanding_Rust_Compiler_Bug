{"sha": "1a0a374429382d49830cf5759dcb6c3e82011908", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWEwYTM3NDQyOTM4MmQ0OTgzMGNmNTc1OWRjYjZjM2U4MjAxMTkwOA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2019-05-17T23:08:00Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2019-05-17T23:08:00Z"}, "message": "PR libstdc++/90520 adjust Xmethod for recent unique_ptr changes\n\n\tPR libstdc++/90520\n\t* python/libstdcxx/v6/printers.py (UniquePointerPrinter.__init__):\n\tRaise exception if unique_ptr tuple member has unknown structure.\n\t* python/libstdcxx/v6/xmethods.py (UniquePtrGetWorker.__call__):\n\tAdjust worker to support new __uniq_ptr_data base class. Do not\n\tassume field called _M_head_impl is the first tuple element.\n\nFrom-SVN: r271363", "tree": {"sha": "51602658be5e318b64c3808768457114ecacf329", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/51602658be5e318b64c3808768457114ecacf329"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a0a374429382d49830cf5759dcb6c3e82011908", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a0a374429382d49830cf5759dcb6c3e82011908", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a0a374429382d49830cf5759dcb6c3e82011908", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a0a374429382d49830cf5759dcb6c3e82011908/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b5ba95ba974d895b9de195494d947fa7effc6e48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5ba95ba974d895b9de195494d947fa7effc6e48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5ba95ba974d895b9de195494d947fa7effc6e48"}], "stats": {"total": 30, "additions": 26, "deletions": 4}, "files": [{"sha": "c7b20f10dc52d8840f98ec972f7831a6660895fa", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a0a374429382d49830cf5759dcb6c3e82011908/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a0a374429382d49830cf5759dcb6c3e82011908/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=1a0a374429382d49830cf5759dcb6c3e82011908", "patch": "@@ -1,3 +1,12 @@\n+2019-05-18  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/90520\n+\t* python/libstdcxx/v6/printers.py (UniquePointerPrinter.__init__):\n+\tRaise exception if unique_ptr tuple member has unknown structure.\n+\t* python/libstdcxx/v6/xmethods.py (UniquePtrGetWorker.__call__):\n+\tAdjust worker to support new __uniq_ptr_data base class. Do not\n+\tassume field called _M_head_impl is the first tuple element.\n+\n 2019-05-17  Fran\u00e7ois Dumont  <fdumont@gcc.gnu.org>\n \n \t* include/bits/stl_deque.h"}, {"sha": "05143153bee285bb34447d32e77c835ca2b6d575", "filename": "libstdc++-v3/python/libstdcxx/v6/printers.py", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a0a374429382d49830cf5759dcb6c3e82011908/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fprinters.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a0a374429382d49830cf5759dcb6c3e82011908/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fprinters.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fprinters.py?ref=1a0a374429382d49830cf5759dcb6c3e82011908", "patch": "@@ -197,6 +197,8 @@ def __init__ (self, typename, val):\n             self.pointer = tuple_member['_M_head_impl']\n         elif head_field.is_base_class:\n             self.pointer = tuple_member.cast(head_field.type)\n+        else:\n+            raise ValueError(\"Unsupported implementation for tuple in unique_ptr: %s\" % impl_type)\n \n     def children (self):\n         return SmartPtrIterator(self.pointer)"}, {"sha": "623cb80bc0e5e439e1662b11659ce77f506a83a4", "filename": "libstdc++-v3/python/libstdcxx/v6/xmethods.py", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a0a374429382d49830cf5759dcb6c3e82011908/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fxmethods.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a0a374429382d49830cf5759dcb6c3e82011908/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fxmethods.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fpython%2Flibstdcxx%2Fv6%2Fxmethods.py?ref=1a0a374429382d49830cf5759dcb6c3e82011908", "patch": "@@ -586,11 +586,22 @@ def _supports(self, method_name):\n \n     def __call__(self, obj):\n         impl_type = obj.dereference().type.fields()[0].type.tag\n-        if re.match('^std::(__\\d+::)?__uniq_ptr_impl<.*>$', impl_type): # New implementation\n-            return obj['_M_t']['_M_t']['_M_head_impl']\n+        # Check for new implementations first:\n+        if re.match('^std::(__\\d+::)?__uniq_ptr_(data|impl)<.*>$', impl_type):\n+            tuple_member = obj['_M_t']['_M_t']\n         elif re.match('^std::(__\\d+::)?tuple<.*>$', impl_type):\n-            return obj['_M_t']['_M_head_impl']\n-        return None\n+            tuple_member = obj['_M_t']\n+        else:\n+            return None\n+        tuple_impl_type = tuple_member.type.fields()[0].type # _Tuple_impl\n+        tuple_head_type = tuple_impl_type.fields()[1].type   # _Head_base\n+        head_field = tuple_head_type.fields()[0]\n+        if head_field.name == '_M_head_impl':\n+            return tuple_member['_M_head_impl']\n+        elif head_field.is_base_class:\n+            return tuple_member.cast(head_field.type)\n+        else:\n+            return None\n \n class UniquePtrDerefWorker(UniquePtrGetWorker):\n     \"Implements std::unique_ptr<T>::operator*()\""}]}