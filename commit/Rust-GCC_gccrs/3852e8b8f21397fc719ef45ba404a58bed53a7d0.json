{"sha": "3852e8b8f21397fc719ef45ba404a58bed53a7d0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzg1MmU4YjhmMjEzOTdmYzcxOWVmNDViYTQwNGE1OGJlZDUzYTdkMA==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2005-03-04T21:03:46Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2005-03-04T21:03:46Z"}, "message": "re PR fortran/19673 (pointer function with RESULT specified returns pointer to \"ptr\" rather than \"*ptr\")\n\nfortran/\nPR fortran/19673\n* trans-expr.c (gfc_conv_function_call): Correctly dereference\nargument from a pointer function also if it has a result clause.\n\ntestsuite/\nPR fortran/19673\n* gfortran.dg/func_result_1.f90: New test.\n\nFrom-SVN: r95901", "tree": {"sha": "f0571636b2dcf97f0a36a47d2d17869b234b465f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f0571636b2dcf97f0a36a47d2d17869b234b465f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3852e8b8f21397fc719ef45ba404a58bed53a7d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3852e8b8f21397fc719ef45ba404a58bed53a7d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3852e8b8f21397fc719ef45ba404a58bed53a7d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3852e8b8f21397fc719ef45ba404a58bed53a7d0/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a873fcb4353a4d03318eecec0252c344d2cd3a77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a873fcb4353a4d03318eecec0252c344d2cd3a77", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a873fcb4353a4d03318eecec0252c344d2cd3a77"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "db94aa67b27dab7042f63f528c73b97e3b8e29ab", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3852e8b8f21397fc719ef45ba404a58bed53a7d0", "patch": "@@ -1,4 +1,10 @@\n-Steven G. Kargl  <kargls@comcast.net>\n+2005-03-04  Tobias Schl\"uter  <tobias.schlueter@physik.uni-muenchen.de>\n+\n+\tPR fortran/19673\n+\t* trans-expr.c (gfc_conv_function_call): Correctly dereference\n+\targument from a pointer function also if it has a result clause.\n+\n+2005-03-04  Steven G. Kargl  <kargls@comcast.net>\n \n \t* expr.c (gfc_copy_shape_excluding): Change && to ||.\n "}, {"sha": "b79d0743decd0edc1424f8a8cc9f3f3f60502fd0", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=3852e8b8f21397fc719ef45ba404a58bed53a7d0", "patch": "@@ -1220,7 +1220,8 @@ gfc_conv_function_call (gfc_se * se, gfc_symbol * sym,\n      something like\n         x = f()\n      where f is pointer valued, we have to dereference the result.  */\n-  if (sym->attr.pointer && !se->want_pointer && !byref)\n+  if (!se->want_pointer && !byref\n+      && (sym->attr.pointer || (sym->result && sym->result->attr.pointer)))\n     se->expr = gfc_build_indirect_ref (se->expr);\n \n   /* A pure function may still have side-effects - it may modify its"}, {"sha": "bf945a09a5a0b7341c7d14dc8c5972e4ff18d6f2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3852e8b8f21397fc719ef45ba404a58bed53a7d0", "patch": "@@ -1,3 +1,8 @@\n+2005-03-04  Tobias Schl\"uter  <tobias.schlueter@physik.uni-muenchen.de>\n+\n+\tPR fortran/19673\n+\t* gfortran.dg/func_result_1.f90: New test.\n+\n 2005-03-04  Ben Elliston  <bje@au.ibm.com>\n \n \t* gcc.misc-tests/options.exp: New test."}, {"sha": "ce3c2e4e68566486adfbc515a8bac49699c88328", "filename": "gcc/testsuite/gfortran.dg/func_result_1.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunc_result_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3852e8b8f21397fc719ef45ba404a58bed53a7d0/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunc_result_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffunc_result_1.f90?ref=3852e8b8f21397fc719ef45ba404a58bed53a7d0", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! From PR 19673 : We didn't dereference the the result from POINTER\n+! functions with a RESULT clause\n+program ret_ptr\n+  if (foo(99) /= bar(99)) call abort ()\n+contains\n+  function foo (arg) result(ptr)\n+    integer :: arg\n+    integer, pointer :: ptr\n+    allocate (ptr)\n+    ptr = arg\n+  end function foo\n+  function bar (arg)\n+    integer :: arg\n+    integer, pointer :: bar\n+    allocate (bar)\n+    bar = arg\n+  end function bar\n+end  program ret_ptr"}]}