{"sha": "110b339d9705df530aed2e1f6ab5c895f1fb96af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTEwYjMzOWQ5NzA1ZGY1MzBhZWQyZTFmNmFiNWM4OTVmMWZiOTZhZg==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1997-06-06T19:12:09Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1997-06-06T19:12:09Z"}, "message": "(update_flow_info): When add extra REG_DEAD note for original dest...\n\n(update_flow_info): When add extra REG_DEAD note for original\ndest, handle case where last insn both uses and sets dest.\n\nFrom-SVN: r14163", "tree": {"sha": "d00ca800203654b00860dffc6b7ddb7a9b384954", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d00ca800203654b00860dffc6b7ddb7a9b384954"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/110b339d9705df530aed2e1f6ab5c895f1fb96af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/110b339d9705df530aed2e1f6ab5c895f1fb96af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/110b339d9705df530aed2e1f6ab5c895f1fb96af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/110b339d9705df530aed2e1f6ab5c895f1fb96af/comments", "author": null, "committer": null, "parents": [{"sha": "f7577fca9a4110ddfef4693912dd706e298c06cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7577fca9a4110ddfef4693912dd706e298c06cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7577fca9a4110ddfef4693912dd706e298c06cd"}], "stats": {"total": 34, "additions": 25, "deletions": 9}, "files": [{"sha": "8d258442db969d65d6575eeb3f4723cf3fef5678", "filename": "gcc/sched.c", "status": "modified", "additions": 25, "deletions": 9, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/110b339d9705df530aed2e1f6ab5c895f1fb96af/gcc%2Fsched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/110b339d9705df530aed2e1f6ab5c895f1fb96af/gcc%2Fsched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched.c?ref=110b339d9705df530aed2e1f6ab5c895f1fb96af", "patch": "@@ -4577,10 +4577,7 @@ update_flow_info (notes, first, last, orig_insn)\n   /* If any insn, except the last, uses the register set by the last insn,\n      then we need a new REG_DEAD note on that insn.  In this case, there\n      would not have been a REG_DEAD note for this register in the original\n-     insn because it was used and set within one insn.\n-\n-     There is no new REG_DEAD note needed if the last insn uses the register\n-     that it is setting.  */\n+     insn because it was used and set within one insn.  */\n \n   set = single_set (last);\n   if (set)\n@@ -4596,10 +4593,31 @@ update_flow_info (notes, first, last, orig_insn)\n \t  /* Global registers are always live, so the code below does not\n \t     apply to them.  */\n \t  && (REGNO (dest) >= FIRST_PSEUDO_REGISTER\n-\t      || ! global_regs[REGNO (dest)])\n-\t  && ! reg_overlap_mentioned_p (dest, SET_SRC (set)))\n+\t      || ! global_regs[REGNO (dest)]))\n \t{\n-\t  for (insn = PREV_INSN (last); ; insn = PREV_INSN (insn))\n+\t  rtx stop_insn = PREV_INSN (first);\n+\n+\t  /* If the last insn uses the register that it is setting, then\n+\t     we don't want to put a REG_DEAD note there.  Search backwards\n+\t     to find the first insn that sets but does not use DEST.  */\n+\n+\t  insn = last;\n+\t  if (reg_overlap_mentioned_p (dest, SET_SRC (set)))\n+\t    {\n+\t      for (insn = PREV_INSN (insn); insn != first;\n+\t\t   insn = PREV_INSN (insn))\n+\t\t{\n+\t\t  if ((set = single_set (insn))\n+\t\t      && reg_mentioned_p (dest, SET_DEST (set))\n+\t\t      && ! reg_overlap_mentioned_p (dest, SET_SRC (set)))\n+\t\t    break;\n+\t\t}\n+\t    }\n+\n+\t  /* Now find the first insn that uses but does not set DEST.  */\n+\n+\t  for (insn = PREV_INSN (insn); insn != stop_insn;\n+\t       insn = PREV_INSN (insn))\n \t    {\n \t      if (GET_RTX_CLASS (GET_CODE (insn)) == 'i'\n \t\t  && reg_mentioned_p (dest, PATTERN (insn))\n@@ -4625,8 +4643,6 @@ update_flow_info (notes, first, last, orig_insn)\n \t\t      break;\n \t\t    }\n \t\t}\n-\t      if (insn == first)\n-\t\tbreak;\n \t    }\n \t}\n     }"}]}