{"sha": "c7381debe4c5dd7878338f38db98face1cfa6f90", "node_id": "C_kwDOANBUbNoAKGM3MzgxZGViZTRjNWRkNzg3ODMzOGYzOGRiOThmYWNlMWNmYTZmOTA", "commit": {"author": {"name": "Giuliano Belinassi", "email": "gbelinassi@suse.de", "date": "2021-11-16T16:25:32Z"}, "committer": {"name": "Giuliano Belinassi", "email": "gbelinassi@suse.de", "date": "2021-11-19T14:27:21Z"}, "message": "Do not abort compilation when dump file is /dev/*\n\nThe `configure` scripts generated with autoconf often tests compiler\nfeatures by setting output to `/dev/null`, which then sets the dump\nfolder as being /dev/* and the compilation halts with an error because\nGCC cannot create files in /dev/. This is a problem when configure is\ntesting for compiler features because it cannot tell if the failure was\ndue to unsupported features or any other problem, and disable it even\nif it is working.\n\nAs an example, running configure overriding CFLAGS=\"-fdump-ipa-clones\"\nwill result in several compiler-features as being disabled because of\ngcc halting with an error creating files in /dev/*.\n\nThis commit fixes this issue by checking if the output file is\n/dev/null or /dev/zero. In this case we use the current working\ndirectory for dump output instead of the directory of the output\nfile because we cannot write to /dev/*.\n\ngcc/ChangeLog\n2021-11-16  Giuliano Belinassi  <gbelinassi@suse.de>\n\n\t* gcc.c (process_command): Skip dumpdir override if file is a\n\tnot_actual_file_p.\n\t* doc/invoke.texi: Update -dumpdir documentation.\n\ngcc/testsuite/ChangeLog\n2021-11-16  Giuliano Belinassi  <gbelinassi@suse.de>\n\n\t* gcc.dg/devnull-dump.c: New.\n\nSigned-off-by: Giuliano Belinassi <gbelinassi@suse.de>", "tree": {"sha": "470e16f5fcf854a2d4591a9552e00acb41686233", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/470e16f5fcf854a2d4591a9552e00acb41686233"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c7381debe4c5dd7878338f38db98face1cfa6f90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7381debe4c5dd7878338f38db98face1cfa6f90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7381debe4c5dd7878338f38db98face1cfa6f90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7381debe4c5dd7878338f38db98face1cfa6f90/comments", "author": null, "committer": null, "parents": [{"sha": "cb09215ad0bbc96fd67aac16004d2131739df096", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb09215ad0bbc96fd67aac16004d2131739df096", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb09215ad0bbc96fd67aac16004d2131739df096"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "49c8befd58a4ba60752bb9c5657b84367a353836", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7381debe4c5dd7878338f38db98face1cfa6f90/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7381debe4c5dd7878338f38db98face1cfa6f90/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=c7381debe4c5dd7878338f38db98face1cfa6f90", "patch": "@@ -1880,7 +1880,8 @@ named @file{dir/bar.*}, combining the given @var{dumppfx} with the\n default @var{dumpbase} derived from the primary output name.  Dump\n outputs also take the input name suffix: @file{dir/bar.c.*}.\n \n-It defaults to the location of the output file; options\n+It defaults to the location of the output file, unless the output\n+file is a special file like @code{/dev/null}. Options\n @option{-save-temps=cwd} and @option{-save-temps=obj} override this\n default, just like an explicit @option{-dumpdir} option.  In case\n multiple such options are given, the last one prevails:"}, {"sha": "6ff22781042506450be791c83b4f37f2b7d7ecb6", "filename": "gcc/gcc.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7381debe4c5dd7878338f38db98face1cfa6f90/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7381debe4c5dd7878338f38db98face1cfa6f90/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=c7381debe4c5dd7878338f38db98face1cfa6f90", "patch": "@@ -5098,7 +5098,8 @@ process_command (unsigned int decoded_options_count,\n \n   bool explicit_dumpdir = dumpdir;\n \n-  if (!save_temps_overrides_dumpdir && explicit_dumpdir)\n+  if ((!save_temps_overrides_dumpdir && explicit_dumpdir)\n+      || (output_file && not_actual_file_p (output_file)))\n     {\n       /* Do nothing.  */\n     }"}, {"sha": "378e0901c28ce31f5609da177ec79c5090ae75bb", "filename": "gcc/testsuite/gcc.dg/devnull-dump.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7381debe4c5dd7878338f38db98face1cfa6f90/gcc%2Ftestsuite%2Fgcc.dg%2Fdevnull-dump.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7381debe4c5dd7878338f38db98face1cfa6f90/gcc%2Ftestsuite%2Fgcc.dg%2Fdevnull-dump.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdevnull-dump.c?ref=c7381debe4c5dd7878338f38db98face1cfa6f90", "patch": "@@ -0,0 +1,7 @@\n+/* { dg-do assemble } */\n+/* { dg-options \"-fdump-ipa-clones -o /dev/null\" } */\n+\n+int main()\n+{\n+  return 0;\n+}"}]}