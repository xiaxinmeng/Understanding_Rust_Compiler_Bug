{"sha": "a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTdmZDQzYzM4Zjc0NjlhM2VmNWVlMzBlODg5ZDYwZTEzNzZkNGRmYw==", "commit": {"author": {"name": "Mark Eggleston", "email": "markeggleston@gcc.gnu.org", "date": "2020-05-07T07:15:26Z"}, "committer": {"name": "Mark Eggleston", "email": "markeggleston@gcc.gnu.org", "date": "2020-05-27T14:46:23Z"}, "message": "Fortran  : ICE in gfc_trans_label_assign PR50392\n\nA function may contain an assigned goto.  If the the return variable\nis an integer a statement can be assigned to it.  Prior to this fix\nthis resulted in an ICE.\n\n2020-05-27  Tobias Burnus  <tobias@codesourcery.com>\n\ngcc/fortran/\n\n\tPR fortran/50392\n\t* trans-decl.c (gfc_get_symbol_decl): Remove unnecessary block\n\tdelimiters.  Add auxiliary variables if a label is assigned to\n\ta return variable. (gfc_gat_fake_result): If the symbol has an\n\tassign attribute set declaration from the symbol's backend\n\tdeclaration.\n\n2020-05-27  Mark Eggleston  <markeggleston@gnu.gcc.org>\n\ngcc/testsuite/\n\n\tPR fortran/50392\n\t* gfortran.dg/pr50392.f: New test.", "tree": {"sha": "833f5547ead1fee4d014c62a7a5f3a0f4e20e46d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/833f5547ead1fee4d014c62a7a5f3a0f4e20e46d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc/comments", "author": null, "committer": null, "parents": [{"sha": "240198fe0812402e6085033e43d34decdec3c0cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/240198fe0812402e6085033e43d34decdec3c0cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/240198fe0812402e6085033e43d34decdec3c0cf"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "e10122e6e0cf90f98c55d04314090fdd690af6f8", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc", "patch": "@@ -1682,16 +1682,18 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n \n       TREE_USED (sym->backend_decl) = 1;\n       if (sym->attr.assign && GFC_DECL_ASSIGN (sym->backend_decl) == 0)\n-\t{\n-\t  gfc_add_assign_aux_vars (sym);\n-\t}\n+\tgfc_add_assign_aux_vars (sym);\n \n       if (sym->ts.type == BT_CLASS && sym->backend_decl)\n \tGFC_DECL_CLASS(sym->backend_decl) = 1;\n \n      return sym->backend_decl;\n     }\n \n+  if (sym->result == sym && sym->attr.assign\n+      && GFC_DECL_ASSIGN (sym->backend_decl) == 0)\n+    gfc_add_assign_aux_vars (sym);\n+\n   if (sym->backend_decl)\n     return sym->backend_decl;\n \n@@ -3196,6 +3198,9 @@ gfc_get_fake_result_decl (gfc_symbol * sym, int parent_flag)\n   else\n     current_fake_result_decl = build_tree_list (NULL, decl);\n \n+  if (sym->attr.assign)\n+    DECL_LANG_SPECIFIC (decl) = DECL_LANG_SPECIFIC (sym->backend_decl);\n+\n   return decl;\n }\n "}, {"sha": "2cb883e41a32c8aa2350c358b6da562013c44ded", "filename": "gcc/testsuite/gfortran.dg/pr50392.f", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr50392.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr50392.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr50392.f?ref=a7fd43c38f7469a3ef5ee30e889d60e1376d4dfc", "patch": "@@ -0,0 +1,12 @@\n+! { dg-do compile }\n+! \n+      function kf()\n+      integer kf\n+      assign 1 to kf ! { dg-warning \"Deleted feature: ASSIGN statement at\" }\n+      kf = 2\n+      goto kf ! { dg-warning \"Deleted feature: Assigned GOTO statement at\" }\n+      kf = 1\n+ 1    continue\n+      kf = 0\n+      end\n+"}]}