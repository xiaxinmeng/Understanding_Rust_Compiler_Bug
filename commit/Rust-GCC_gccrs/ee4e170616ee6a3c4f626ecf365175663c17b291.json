{"sha": "ee4e170616ee6a3c4f626ecf365175663c17b291", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWU0ZTE3MDYxNmVlNmEzYzRmNjI2ZWNmMzY1MTc1NjYzYzE3YjI5MQ==", "commit": {"author": {"name": "Wei Guozhi", "email": "carrot@google.com", "date": "2010-05-25T01:08:35Z"}, "committer": {"name": "Wei Guozhi", "email": "carrot@gcc.gnu.org", "date": "2010-05-25T01:08:35Z"}, "message": "thumb2.md (thumb2_tlobits_cbranch): Add constraint to tst instruction and a new alternative.\n\n\t* config/arm/thumb2.md (thumb2_tlobits_cbranch): Add constraint to\n\ttst instruction and a new alternative.\n\t* config/arm/constraints.md (Pu): New constraint.\n\nFrom-SVN: r159806", "tree": {"sha": "22a4cdbe68f2eb4f61e68371ab01ca7225d7d338", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/22a4cdbe68f2eb4f61e68371ab01ca7225d7d338"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ee4e170616ee6a3c4f626ecf365175663c17b291", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee4e170616ee6a3c4f626ecf365175663c17b291", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee4e170616ee6a3c4f626ecf365175663c17b291", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee4e170616ee6a3c4f626ecf365175663c17b291/comments", "author": {"login": "weiguozhi", "id": 57237827, "node_id": "MDQ6VXNlcjU3MjM3ODI3", "avatar_url": "https://avatars.githubusercontent.com/u/57237827?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weiguozhi", "html_url": "https://github.com/weiguozhi", "followers_url": "https://api.github.com/users/weiguozhi/followers", "following_url": "https://api.github.com/users/weiguozhi/following{/other_user}", "gists_url": "https://api.github.com/users/weiguozhi/gists{/gist_id}", "starred_url": "https://api.github.com/users/weiguozhi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weiguozhi/subscriptions", "organizations_url": "https://api.github.com/users/weiguozhi/orgs", "repos_url": "https://api.github.com/users/weiguozhi/repos", "events_url": "https://api.github.com/users/weiguozhi/events{/privacy}", "received_events_url": "https://api.github.com/users/weiguozhi/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cf3b8ee3abe1b4b0bcf156a67547341a425bba5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf3b8ee3abe1b4b0bcf156a67547341a425bba5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf3b8ee3abe1b4b0bcf156a67547341a425bba5d"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "9b44b2bd6345d2e6869ac757bd0ed864d222eb2b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee4e170616ee6a3c4f626ecf365175663c17b291/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee4e170616ee6a3c4f626ecf365175663c17b291/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ee4e170616ee6a3c4f626ecf365175663c17b291", "patch": "@@ -1,3 +1,9 @@\n+2010-05-25  Wei Guozhi  <carrot@google.com>\n+\n+\t* config/arm/thumb2.md (thumb2_tlobits_cbranch): Add constraint to\n+\ttst instruction and a new alternative.\n+\t* config/arm/constraints.md (Pu): New constraint.\n+\n 2010-05-24  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* function.c (assign_stack_local_1): Initialize variable"}, {"sha": "77883e6a34dfb5b2fad0f75c1b0f6b2c39e77fd8", "filename": "gcc/config/arm/constraints.md", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee4e170616ee6a3c4f626ecf365175663c17b291/gcc%2Fconfig%2Farm%2Fconstraints.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee4e170616ee6a3c4f626ecf365175663c17b291/gcc%2Fconfig%2Farm%2Fconstraints.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fconstraints.md?ref=ee4e170616ee6a3c4f626ecf365175663c17b291", "patch": "@@ -31,7 +31,7 @@\n ;; The following multi-letter normal constraints have been used:\n ;; in ARM/Thumb-2 state: Da, Db, Dc, Dn, Dl, DL, Dv, Dy\n ;; in Thumb-1 state: Pa, Pb\n-;; in Thumb-2 state: Ps, Pt\n+;; in Thumb-2 state: Ps, Pt, Pu\n \n ;; The following memory constraints have been used:\n ;; in ARM/Thumb-2 state: Q, Ut, Uv, Uy, Un, Um, Us\n@@ -158,6 +158,11 @@\n   (and (match_code \"const_int\")\n        (match_test \"TARGET_THUMB2 && ival >= -7 && ival <= 7\")))\n \n+(define_constraint \"Pu\"\n+  \"@internal In Thumb-2 state a constant in the range +1 to +8\"\n+  (and (match_code \"const_int\")\n+       (match_test \"TARGET_THUMB2 && ival >= 1 && ival <= 8\")))\n+\n (define_constraint \"G\"\n  \"In ARM/Thumb-2 state a valid FPA immediate constant.\"\n  (and (match_code \"const_double\")"}, {"sha": "30291b30e213b5d0be17228b1f43ad1d98290e6d", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 19, "deletions": 7, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ee4e170616ee6a3c4f626ecf365175663c17b291/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ee4e170616ee6a3c4f626ecf365175663c17b291/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=ee4e170616ee6a3c4f626ecf365175663c17b291", "patch": "@@ -1460,13 +1460,14 @@\n   [(set (pc)\n \t(if_then_else\n \t (match_operator 0 \"equality_operator\"\n-\t  [(zero_extract:SI (match_operand:SI 1 \"s_register_operand\" \"l,?h\")\n-\t\t\t    (match_operand:SI 2 \"const_int_operand\" \"i,i\")\n+\t  [(zero_extract:SI (match_operand:SI 1 \"s_register_operand\" \"l,h,h\")\n+\t\t\t    (match_operand:SI 2 \"const_int_operand\" \"i,Pu,i\")\n \t\t\t    (const_int 0))\n \t   (const_int 0)])\n \t (label_ref (match_operand 3 \"\" \"\"))\n \t (pc)))\n-   (clobber (match_scratch:SI 4 \"=l,X\"))]\n+   (clobber (match_scratch:SI 4 \"=l,X,r\"))\n+   (clobber (reg:CC CC_REGNUM))]\n   \"TARGET_THUMB2\"\n   \"*\n   {\n@@ -1487,11 +1488,22 @@\n     }\n   else\n     {\n-      rtx op[2];\n-      op[0] = operands[1];\n-      op[1] = GEN_INT ((1 << INTVAL (operands[2])) - 1);\n+      rtx op[3];\n+\n+      if (which_alternative == 1)\n+\t{\n+\t  op[0] = operands[1];\n+\t  op[1] = GEN_INT ((1 << INTVAL (operands[2])) - 1);\n+\t  output_asm_insn (\\\"tst\\\\t%0, %1\\\", op);\n+\t}\n+      else\n+\t{\n+\t  op[0] = operands[4];\n+\t  op[1] = operands[1];\n+\t  op[2] = GEN_INT (32 - INTVAL (operands[2]));\n+\t  output_asm_insn (\\\"lsls\\\\t%0, %1, %2\\\", op);\n+\t}\n \n-      output_asm_insn (\\\"tst\\\\t%0, %1\\\", op);\n       switch (get_attr_length (insn))\n \t{\n \t  case 6:  return \\\"b%d0\\\\t%l3\\\";"}]}