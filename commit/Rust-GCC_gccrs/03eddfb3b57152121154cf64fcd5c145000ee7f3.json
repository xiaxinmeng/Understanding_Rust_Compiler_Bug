{"sha": "03eddfb3b57152121154cf64fcd5c145000ee7f3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDNlZGRmYjNiNTcxNTIxMjExNTRjZjY0ZmNkNWMxNDUwMDBlZTdmMw==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2019-07-03T18:43:55Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-07-03T18:43:55Z"}, "message": "[Darwin] Revise pie,no-pie and rdynamic driver specs.\n\nProcessing these early and pushing the corresponding Xlinker lines\nhas the effect that the driver then supposes that there are linker\ninputs, and causes a link line to be created when it is not needed \n\nThe solution is to place these drive specs into the link spec and\nclaim them at the end of that.\n\n2019-07-03  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config/darwin.h (DRIVER_SELF_SPECS): Remove the linker cases.\n\t(RDYNAMIC): Rename to, DARWIN_RDYNAMIC.\n\t(DARWIN_PIE_SPEC, DARWIN_NOPIE_SPEC): Adjust to remove the Xlinker\n\tclauses.\n\t(LINK_COMMAND_SPEC_A): Add DARWIN_RDYNAMIC, DARWIN_PIE_SPEC and\n\tDARWIN_NOPIE_SPEC.\n\nFrom-SVN: r273017", "tree": {"sha": "941ec8ffc2065e4cb26e569a13d6414ab18b2258", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/941ec8ffc2065e4cb26e569a13d6414ab18b2258"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/03eddfb3b57152121154cf64fcd5c145000ee7f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03eddfb3b57152121154cf64fcd5c145000ee7f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03eddfb3b57152121154cf64fcd5c145000ee7f3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03eddfb3b57152121154cf64fcd5c145000ee7f3/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "179c7ef523f4331036fe70c298c2f5f46e4ba3b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/179c7ef523f4331036fe70c298c2f5f46e4ba3b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/179c7ef523f4331036fe70c298c2f5f46e4ba3b1"}], "stats": {"total": 33, "additions": 20, "deletions": 13}, "files": [{"sha": "d22753db1ec97bd89385e33ea9041b7ccbc7bfbd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03eddfb3b57152121154cf64fcd5c145000ee7f3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03eddfb3b57152121154cf64fcd5c145000ee7f3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=03eddfb3b57152121154cf64fcd5c145000ee7f3", "patch": "@@ -1,3 +1,12 @@\n+2019-07-03  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/darwin.h (DRIVER_SELF_SPECS): Remove the linker cases.\n+\t(RDYNAMIC): Rename to, DARWIN_RDYNAMIC.\n+\t(DARWIN_PIE_SPEC, DARWIN_NOPIE_SPEC): Adjust to remove the Xlinker\n+\tclauses.\n+\t(LINK_COMMAND_SPEC_A): Add DARWIN_RDYNAMIC, DARWIN_PIE_SPEC and\n+\tDARWIN_NOPIE_SPEC.\n+\n 2019-07-03  Iain Sandoe  <iain@sandoe.co.uk>\n \n \t* config/darwin.h (REAL_LIBGCC_SPEC): Adjust for earlier Darwin."}, {"sha": "e17bc64af156bcf80967760fa672b568832c1e1f", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 11, "deletions": 13, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03eddfb3b57152121154cf64fcd5c145000ee7f3/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03eddfb3b57152121154cf64fcd5c145000ee7f3/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=03eddfb3b57152121154cf64fcd5c145000ee7f3", "patch": "@@ -124,30 +124,25 @@ extern GTY(()) int darwin_ms_struct;\n   \"%{fapple-kext|mkernel:-static}\",\t\t\t\t\\\n   \"%{shared:-Zdynamiclib} %<shared\",                            \\\n   \"%{gsplit-dwarf:%ngsplit-dwarf is not supported on this platform} \\\n-     %<gsplit-dwarf\",\t\t\t\t\t\t\\\n-  DARWIN_PIE_SPEC,\t\t\t\t\t\t\\\n-  DARWIN_NOPIE_SPEC,\t\t\t\t\t\t\\\n-  RDYNAMIC\n+     %<gsplit-dwarf\"\n \n #if LD64_HAS_EXPORT_DYNAMIC\n-#define RDYNAMIC \"%{rdynamic:-Xlinker -export_dynamic} %<rdynamic\"\n+#define DARWIN_RDYNAMIC \"%{rdynamic:-export_dynamic}\"\n #else\n-#define RDYNAMIC \"%{rdynamic:%nrdynamic is not supported} %<rdynamic\"\n+#define DARWIN_RDYNAMIC \"%{rdynamic:%nrdynamic is not supported}\"\n #endif\n \n /* FIXME: we should check that the linker supports the -pie and -no_pie.\n    options.  */\n #define DARWIN_PIE_SPEC \\\n-\"%{pie|fpie|fPIE: \\\n+\"%{pie|fpie|fPIE:\\\n    %{mdynamic-no-pic: \\\n-       %n'-mdynamic-no-pic' overrides '-pie', '-fpie' or '-fPIE'; \\\n-     : %:version-compare(>= 10.5 mmacosx-version-min= -Xlinker) \\\n-       %:version-compare(>= 10.5 mmacosx-version-min= -pie) }} %<pie \"\n+     %n'-mdynamic-no-pic' overrides '-pie', '-fpie' or '-fPIE'; \\\n+     :%:version-compare(>= 10.5 mmacosx-version-min= -pie) }} \"\n \n #define DARWIN_NOPIE_SPEC \\\n \"%{no-pie|fno-pie|fno-PIE: \\\n-   %:version-compare(>= 10.7 mmacosx-version-min= -Xlinker ) \\\n-   %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } %<no-pie \"\n+   %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) }\"\n \n #define DARWIN_CC1_SPEC\t\t\t\t\t\t\t\\\n   \"%{findirect-virtual-calls: -fapple-kext} %<findirect-virtual-calls \" \\\n@@ -227,8 +222,11 @@ extern GTY(()) int darwin_ms_struct;\n       %(link_gcc_c_sequence) \\\n     }}}\\\n     %{!nostdlib:%{!r:%{!nostartfiles:%E}}} %{T*} %{F*} \"\\\n+    DARWIN_PIE_SPEC \\\n+    DARWIN_NOPIE_SPEC \\\n+    DARWIN_RDYNAMIC \\\n     DARWIN_NOCOMPACT_UNWIND \\\n-    \"}}}}}}}\"\n+    \"}}}}}}} %<pie %<no-pie %<rdynamic \"\n \n #define DSYMUTIL \"\\ndsymutil\"\n "}]}