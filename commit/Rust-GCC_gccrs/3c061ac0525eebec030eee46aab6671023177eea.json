{"sha": "3c061ac0525eebec030eee46aab6671023177eea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2MwNjFhYzA1MjVlZWJlYzAzMGVlZTQ2YWFiNjY3MTAyMzE3N2VlYQ==", "commit": {"author": {"name": "Than McIntosh", "email": "thanm@google.com", "date": "2016-10-11T00:11:43Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2016-10-11T00:11:43Z"}, "message": "compiler: move Backend/Linemap creation out of front end.\n\n    \n    Push the calls to create Backend and Linemap object out\n    of the front end into the back end, and instead pass pointers to\n    these objects in the go_create_gogo_args struct. This allows\n    for more flexibility in the interfaces used to create the\n    objects.\n    \n    Reviewed-on: https://go-review.googlesource.com/30698\n\n\t* go-gcc.h: New file.\n\t* go-c.h (struct go_create_gogo_args): Add backend and linemap\n\tfields.\n\t* go-lang.c: Include \"go-gcc.h\".\n\t(go_langhook_init): Set linemap and backend fields of args.\n\t* go-gcc.cc: Include \"go-gcc.h\".\n\t* go-linemap.cc: Include \"go-gcc.h\".\n\nFrom-SVN: r240959", "tree": {"sha": "2cb8646afabaf58b7f77d2990aa7cd375f662850", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2cb8646afabaf58b7f77d2990aa7cd375f662850"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3c061ac0525eebec030eee46aab6671023177eea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c061ac0525eebec030eee46aab6671023177eea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c061ac0525eebec030eee46aab6671023177eea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c061ac0525eebec030eee46aab6671023177eea/comments", "author": {"login": "thanm", "id": 12280172, "node_id": "MDQ6VXNlcjEyMjgwMTcy", "avatar_url": "https://avatars.githubusercontent.com/u/12280172?v=4", "gravatar_id": "", "url": "https://api.github.com/users/thanm", "html_url": "https://github.com/thanm", "followers_url": "https://api.github.com/users/thanm/followers", "following_url": "https://api.github.com/users/thanm/following{/other_user}", "gists_url": "https://api.github.com/users/thanm/gists{/gist_id}", "starred_url": "https://api.github.com/users/thanm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/thanm/subscriptions", "organizations_url": "https://api.github.com/users/thanm/orgs", "repos_url": "https://api.github.com/users/thanm/repos", "events_url": "https://api.github.com/users/thanm/events{/privacy}", "received_events_url": "https://api.github.com/users/thanm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "abe08b7d909d27884e9f5f2cb879739e2c909106", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abe08b7d909d27884e9f5f2cb879739e2c909106", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abe08b7d909d27884e9f5f2cb879739e2c909106"}], "stats": {"total": 72, "additions": 58, "deletions": 14}, "files": [{"sha": "93bf4c12c2b1f76d32a498894aaa33e6bdd2c59c", "filename": "gcc/go/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2FChangeLog?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -1,3 +1,13 @@\n+2016-10-10  Than McIntosh  <thanm@google.com>\n+\n+\t* go-gcc.h: New file.\n+\t* go-c.h (struct go_create_gogo_args): Add backend and linemap\n+\tfields.\n+\t* go-lang.c: Include \"go-gcc.h\".\n+\t(go_langhook_init): Set linemap and backend fields of args.\n+\t* go-gcc.cc: Include \"go-gcc.h\".\n+\t* go-linemap.cc: Include \"go-gcc.h\".\n+\n 2016-10-10  Than McIntosh  <thanm@google.com>\n \n \t* go-linemap.cc (Gcc_linemap::location_line): New method."}, {"sha": "74e89463c43aef8c3c29a1e38b9c9ad27abfb791", "filename": "gcc/go/go-c.h", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-c.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-c.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgo-c.h?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -22,6 +22,8 @@ along with GCC; see the file COPYING3.  If not see\n \n #define GO_EXTERN_C\n \n+class Linemap;\n+class Backend;\n \n /* Functions defined in the Go frontend proper called by the GCC\n    interface.  */\n@@ -36,9 +38,11 @@ struct go_create_gogo_args\n   int int_type_size;\n   int pointer_size;\n   const char* pkgpath;\n-  const char *prefix;\n-  const char *relative_import_path;\n-  const char *c_header;\n+  const char* prefix;\n+  const char* relative_import_path;\n+  const char* c_header;\n+  Backend* backend;\n+  Linemap* linemap;\n   bool check_divide_by_zero;\n   bool check_divide_overflow;\n   bool compiling_runtime;"}, {"sha": "44daaa0aecef3ac52ddf6acb792065650367b50f", "filename": "gcc/go/go-gcc.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-gcc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-gcc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgo-gcc.cc?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -43,6 +43,7 @@\n #include \"builtins.h\"\n \n #include \"go-c.h\"\n+#include \"go-gcc.h\"\n \n #include \"gogo.h\"\n #include \"backend.h\""}, {"sha": "0dfd3927f102d1b7614063d85dd68bc2c412556e", "filename": "gcc/go/go-gcc.h", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-gcc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-gcc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgo-gcc.h?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -0,0 +1,33 @@\n+/* go-gcc.h -- Header file for go backend-specific interfaces.\n+   Copyright (C) 2016 Free Software Foundation, Inc.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify it under\n+the terms of the GNU General Public License as published by the Free\n+Software Foundation; either version 3, or (at your option) any later\n+version.\n+\n+GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GCC; see the file COPYING3.  If not see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#ifndef GO_GO_GCC_BACKEND_H\n+#define GO_GO_GCC_BACKEND_H\n+\n+class Backend;\n+\n+// Create and return a Backend object for use with the GCC backend.\n+\n+extern Backend *go_get_backend();\n+\n+// Create and return a Linemap object for use with the GCC backend.\n+\n+extern Linemap *go_get_linemap();\n+\n+#endif // !defined(GO_GCC_BACKEND_H)"}, {"sha": "8d66ee0e176af560af5612f4958ed9c614eb17aa", "filename": "gcc/go/go-lang.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgo-lang.c?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -37,6 +37,7 @@ along with GCC; see the file COPYING3.  If not see\n #include <mpfr.h>\n \n #include \"go-c.h\"\n+#include \"go-gcc.h\"\n \n /* Language-dependent contents of a type.  */\n \n@@ -111,6 +112,8 @@ go_langhook_init (void)\n   args.check_divide_overflow = go_check_divide_overflow;\n   args.compiling_runtime = go_compiling_runtime;\n   args.debug_escape_level = go_debug_escape_level;\n+  args.linemap = go_get_linemap();\n+  args.backend = go_get_backend();\n   go_create_gogo (&args);\n \n   build_common_builtin_nodes ();"}, {"sha": "2accb95e5c476d66e83360f6ae8385c12863adf0", "filename": "gcc/go/go-linemap.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-linemap.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgo-linemap.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgo-linemap.cc?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -6,6 +6,8 @@\n \n #include \"go-linemap.h\"\n \n+#include \"go-gcc.h\"\n+\n // This class implements the Linemap interface defined by the\n // frontend.\n "}, {"sha": "66b1b856c7eda2794cab6112d6944668b631877b", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -1,4 +1,4 @@\n-ecf9b645cefc5c3b4e6339adeb452b2d8642cf3e\n+a700fa1908aa2a36f05b3ee09932f814fd94a10d\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "8c45b6493b74e26b966bb3f768c37bea848aeba0", "filename": "gcc/go/gofrontend/backend.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2Fbackend.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2Fbackend.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fbackend.h?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -740,8 +740,4 @@ class Backend\n                            const std::vector<Bvariable*>& variable_decls) = 0;\n };\n \n-// The backend interface has to define this function.\n-\n-extern Backend* go_get_backend();\n-\n #endif // !defined(GO_BACKEND_H)"}, {"sha": "704efdbfa53f92f6dc2e6ebea05312e19f3d70e0", "filename": "gcc/go/gofrontend/go-linemap.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2Fgo-linemap.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2Fgo-linemap.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgo-linemap.h?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -149,8 +149,4 @@ class Linemap\n   }\n };\n \n-// The backend interface must define this function.  It should return\n-// a fully implemented instance of Linemap.\n-extern Linemap* go_get_linemap();\n-\n #endif // !defined(GO_LINEMAP_H)"}, {"sha": "e0e84e3adc2510bf019c2fb715a19ce82d49896a", "filename": "gcc/go/gofrontend/go.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2Fgo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c061ac0525eebec030eee46aab6671023177eea/gcc%2Fgo%2Fgofrontend%2Fgo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgo.cc?ref=3c061ac0525eebec030eee46aab6671023177eea", "patch": "@@ -24,8 +24,7 @@ void\n go_create_gogo(const struct go_create_gogo_args* args)\n {\n   go_assert(::gogo == NULL);\n-  Linemap* linemap = go_get_linemap();\n-  ::gogo = new Gogo(go_get_backend(), linemap, args->int_type_size,\n+  ::gogo = new Gogo(args->backend, args->linemap, args->int_type_size,\n \t\t    args->pointer_size);\n \n   if (args->pkgpath != NULL)"}]}