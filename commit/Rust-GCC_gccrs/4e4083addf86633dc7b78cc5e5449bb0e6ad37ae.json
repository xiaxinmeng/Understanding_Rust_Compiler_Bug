{"sha": "4e4083addf86633dc7b78cc5e5449bb0e6ad37ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGU0MDgzYWRkZjg2NjMzZGM3Yjc4Y2M1ZTU0NDliYjBlNmFkMzdhZQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@wasabisystems.com", "date": "2004-03-15T22:47:57Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2004-03-15T22:47:57Z"}, "message": "host-darwin.c (darwin_rs6000_gt_pch_use_address): Fix the check for abort and only do the mmap if we can.\n\n2004-03-15  Ian Lance Taylor  <ian@wasabisystems.com>\n\n        * config/rs6000/host-darwin.c (darwin_rs6000_gt_pch_use_address):\n        Fix the check for abort and only do the mmap if we can.\n\nFrom-SVN: r79512", "tree": {"sha": "1c68f2a4e4fed6295e32c116aea91c381a4e0ca0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1c68f2a4e4fed6295e32c116aea91c381a4e0ca0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae/comments", "author": null, "committer": null, "parents": [{"sha": "74a568a4c57b8d8af0926448bf793fc13d4fa1dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74a568a4c57b8d8af0926448bf793fc13d4fa1dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74a568a4c57b8d8af0926448bf793fc13d4fa1dc"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "458ae138e717fd1d51dce8ee7900a4d54a11deee", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4e4083addf86633dc7b78cc5e5449bb0e6ad37ae", "patch": "@@ -1,3 +1,8 @@\n+2004-03-15  Ian Lance Taylor  <ian@wasabisystems.com>\n+\n+\t* config/rs6000/host-darwin.c (darwin_rs6000_gt_pch_use_address):\n+\tFix the check for abort and only do the mmap if we can.\n+\n 2004-03-15  Eric Botcazou  <ebotcazou@act-europe.fr>\n \n \t* config/sparc/sparc.h: Rework comments about the code model"}, {"sha": "9f47cac937d450559b2a0784ef9a96e93564ff42", "filename": "gcc/config/rs6000/host-darwin.c", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae/gcc%2Fconfig%2Frs6000%2Fhost-darwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4e4083addf86633dc7b78cc5e5449bb0e6ad37ae/gcc%2Fconfig%2Frs6000%2Fhost-darwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fhost-darwin.c?ref=4e4083addf86633dc7b78cc5e5449bb0e6ad37ae", "patch": "@@ -180,16 +180,19 @@ darwin_rs6000_gt_pch_use_address (void *addr, size_t sz, int fd, size_t off)\n   if (munmap (pch_address_space + sz, sizeof (pch_address_space) - sz) != 0)\n     fatal_error (\"couldn't unmap pch_address_space: %m\\n\");\n \n-  mmap_result = mmap (addr, sz,\n-\t\t      PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_FIXED,\n-\t\t      fd, off);\n+  if (ret)\n+    {\n+      mmap_result = mmap (addr, sz,\n+\t\t\t  PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_FIXED,\n+\t\t\t  fd, off);\n \n-  /* The file might not be mmap-able.  */\n-  ret = mmap_result == (void *) MAP_FAILED;\n+      /* The file might not be mmap-able.  */\n+      ret = mmap_result == (void *) MAP_FAILED;\n \n-  /* Sanity check for broken MAP_FIXED.  */\n-  if (ret && mmap_result != addr)\n-    abort ();\n+      /* Sanity check for broken MAP_FIXED.  */\n+      if (!ret && mmap_result != addr)\n+\tabort ();\n+    }\n \n   return ret;\n }"}]}