{"sha": "31fcb30fe6b1c157846247b2f6b809e8d9e50460", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzFmY2IzMGZlNmIxYzE1Nzg0NjI0N2IyZjZiODA5ZThkOWU1MDQ2MA==", "commit": {"author": {"name": "Doug Rupp", "email": "rupp@adacore.com", "date": "2008-08-06T07:57:04Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2008-08-06T07:57:04Z"}, "message": "2008-08-06  Doug Rupp  <rupp@adacore.com>\n\n\t* gcc-interface/utils2.c (snames.h) Include\n\t(TARGET_ABI_OPEN_VMS): Initialize.\n\t(build_call_alloc_dealloc); [TARGET_ABI_OPEN_VMS] Allocate on 32bit heap\n\tfor Convention C.\n\nFrom-SVN: r138767", "tree": {"sha": "71efd33f5f59a832e3b2d81100410ebdd6557ba1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/71efd33f5f59a832e3b2d81100410ebdd6557ba1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/31fcb30fe6b1c157846247b2f6b809e8d9e50460", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31fcb30fe6b1c157846247b2f6b809e8d9e50460", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31fcb30fe6b1c157846247b2f6b809e8d9e50460", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31fcb30fe6b1c157846247b2f6b809e8d9e50460/comments", "author": {"login": "Cementitious", "id": 115579865, "node_id": "U_kgDOBuOb2Q", "avatar_url": "https://avatars.githubusercontent.com/u/115579865?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cementitious", "html_url": "https://github.com/Cementitious", "followers_url": "https://api.github.com/users/Cementitious/followers", "following_url": "https://api.github.com/users/Cementitious/following{/other_user}", "gists_url": "https://api.github.com/users/Cementitious/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cementitious/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cementitious/subscriptions", "organizations_url": "https://api.github.com/users/Cementitious/orgs", "repos_url": "https://api.github.com/users/Cementitious/repos", "events_url": "https://api.github.com/users/Cementitious/events{/privacy}", "received_events_url": "https://api.github.com/users/Cementitious/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ea08fcdc9403743570d9a278bf91f4a5491373b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea08fcdc9403743570d9a278bf91f4a5491373b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea08fcdc9403743570d9a278bf91f4a5491373b6"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "72bbd6b393c92149b96dbafcda056406034da4f7", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31fcb30fe6b1c157846247b2f6b809e8d9e50460/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31fcb30fe6b1c157846247b2f6b809e8d9e50460/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=31fcb30fe6b1c157846247b2f6b809e8d9e50460", "patch": "@@ -1,3 +1,10 @@\n+2008-08-06  Doug Rupp  <rupp@adacore.com>\n+\n+\t* gcc-interface/utils2.c (snames.h) Include\n+\t(TARGET_ABI_OPEN_VMS): Initialize.\n+\t(build_call_alloc_dealloc); [TARGET_ABI_OPEN_VMS] Allocate on 32bit heap\n+\tfor Convention C.\n+\n 2008-08-06  Ed Schonberg  <schonberg@adacore.com>\n \n \t* sem_ch3.adb (Process_Discriminants): diagnose redundant or improper"}, {"sha": "84d5a587f5bd92194146c985c31c3d2739d1ce4d", "filename": "gcc/ada/gcc-interface/utils2.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31fcb30fe6b1c157846247b2f6b809e8d9e50460/gcc%2Fada%2Fgcc-interface%2Futils2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31fcb30fe6b1c157846247b2f6b809e8d9e50460/gcc%2Fada%2Fgcc-interface%2Futils2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils2.c?ref=31fcb30fe6b1c157846247b2f6b809e8d9e50460", "patch": "@@ -45,6 +45,13 @@\n #include \"einfo.h\"\n #include \"ada-tree.h\"\n #include \"gigi.h\"\n+#include \"snames.h\"\n+\n+/* Let code below know whether we are targetting VMS without need of\n+   intrusive preprocessor directives.  */\n+#ifndef TARGET_ABI_OPEN_VMS\n+#define TARGET_ABI_OPEN_VMS 0\n+#endif\n \n static tree find_common_type (tree, tree);\n static bool contains_save_expr_p (tree);\n@@ -1950,7 +1957,9 @@ build_call_alloc_dealloc (tree gnu_obj, tree gnu_size, unsigned align,\n       /* If the allocator size is 32bits but the pointer size is 64bits then\n \t allocate 32bit memory (sometimes necessary on 64bit VMS). Otherwise\n \t default to standard malloc. */\n-      if (UI_To_Int (Esize (Etype (gnat_node))) == 32 && POINTER_SIZE == 64)\n+      if (TARGET_ABI_OPEN_VMS && POINTER_SIZE == 64\n+\t  && (UI_To_Int (Esize (Etype (gnat_node))) == 32\n+\t      || Convention (Etype (gnat_node)) == Convention_C))\n         return build_call_1_expr (malloc32_decl, gnu_size);\n       else\n         return build_call_1_expr (malloc_decl, gnu_size);"}]}