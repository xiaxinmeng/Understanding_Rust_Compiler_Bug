{"sha": "955cd057454b323419e06affa7df7d59dc3cd1fb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTU1Y2QwNTc0NTRiMzIzNDE5ZTA2YWZmYTdkZjdkNTlkYzNjZDFmYg==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2019-11-04T22:29:11Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2019-11-04T22:29:11Z"}, "message": "Add gcc/config/gcn/t-omp-device for OpenMP declare variant kind/arch/isa\n\n        gcc/\n        * config/gcn/gcn.c (gcn_omp_device_kind_arch_isa): New function.\n        (TARGET_OMP_DEVICE_KIND_ARCH_ISA): Redefine to\n        gcn_omp_device_kind_arch_isa.\n        * config/gcn/t-omp-device: New file.\n        * configure.ac: Support gcn for omp_device_property.\n        * configure: Regenerate.\n\nFrom-SVN: r277797", "tree": {"sha": "66884b067b9afbb1e0c765c0b1e2235f9744f975", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/66884b067b9afbb1e0c765c0b1e2235f9744f975"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/955cd057454b323419e06affa7df7d59dc3cd1fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/955cd057454b323419e06affa7df7d59dc3cd1fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/955cd057454b323419e06affa7df7d59dc3cd1fb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/955cd057454b323419e06affa7df7d59dc3cd1fb/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9ac6cb7eb016da3419f68cbd176769f6f10584bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ac6cb7eb016da3419f68cbd176769f6f10584bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ac6cb7eb016da3419f68cbd176769f6f10584bb"}], "stats": {"total": 53, "additions": 51, "deletions": 2}, "files": [{"sha": "a11c08f17deb85b03822c366a93193a439ac7944", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=955cd057454b323419e06affa7df7d59dc3cd1fb", "patch": "@@ -1,3 +1,12 @@\n+2019-11-04  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\t* config/gcn/gcn.c (gcn_omp_device_kind_arch_isa): New function.\n+\t(TARGET_OMP_DEVICE_KIND_ARCH_ISA): Redefine to\n+\tgcn_omp_device_kind_arch_isa.\n+\t* config/gcn/t-omp-device: New file.\n+\t* configure.ac: Support gcn for omp_device_property.\n+\t* configure: Regenerate.\n+\n 2019-11-04  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* tree-vrp.h (vrp_val_min): Remove handle_pointers argument."}, {"sha": "cdd24277cf6dc32303dcc827c4abab6b3e3e1355", "filename": "gcc/config/gcn/gcn.c", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2Fconfig%2Fgcn%2Fgcn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2Fconfig%2Fgcn%2Fgcn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fgcn%2Fgcn.c?ref=955cd057454b323419e06affa7df7d59dc3cd1fb", "patch": "@@ -2516,6 +2516,36 @@ gcn_gimplify_va_arg_expr (tree valist, tree type,\n   return t;\n }\n \n+/* Return 1 if TRAIT NAME is present in the OpenMP context's\n+   device trait set, return 0 if not present in any OpenMP context in the\n+   whole translation unit, or -1 if not present in the current OpenMP context\n+   but might be present in another OpenMP context in the same TU.  */\n+\n+int\n+gcn_omp_device_kind_arch_isa (enum omp_device_kind_arch_isa trait,\n+\t\t\t      const char *name)\n+{\n+  switch (trait)\n+    {\n+    case omp_device_kind:\n+      return strcmp (name, \"gpu\") == 0;\n+    case omp_device_arch:\n+      return strcmp (name, \"gcn\") == 0;\n+    case omp_device_isa:\n+      if (strcmp (name, \"carrizo\") == 0)\n+\treturn gcn_arch == PROCESSOR_CARRIZO;\n+      if (strcmp (name, \"fiji\") == 0)\n+\treturn gcn_arch == PROCESSOR_FIJI;\n+      if (strcmp (name, \"gfx900\") == 0)\n+\treturn gcn_arch == PROCESSOR_VEGA;\n+      if (strcmp (name, \"gfx906\") == 0)\n+\treturn gcn_arch == PROCESSOR_VEGA;\n+      return 0;\n+    default:\n+      gcc_unreachable ();\n+    }\n+}\n+\n /* Calculate stack offsets needed to create prologues and epilogues.  */\n \n static struct machine_function *\n@@ -6030,6 +6060,8 @@ print_operand (FILE *file, rtx x, int code)\n #define TARGET_FUNCTION_VALUE_REGNO_P gcn_function_value_regno_p\n #undef  TARGET_GIMPLIFY_VA_ARG_EXPR\n #define TARGET_GIMPLIFY_VA_ARG_EXPR gcn_gimplify_va_arg_expr\n+#undef TARGET_OMP_DEVICE_KIND_ARCH_ISA\n+#define TARGET_OMP_DEVICE_KIND_ARCH_ISA gcn_omp_device_kind_arch_isa\n #undef  TARGET_GOACC_ADJUST_PROPAGATION_RECORD\n #define TARGET_GOACC_ADJUST_PROPAGATION_RECORD \\\n   gcn_goacc_adjust_propagation_record"}, {"sha": "a2df82e021f5ef190a44f52ab8e07d5be24ab214", "filename": "gcc/configure", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=955cd057454b323419e06affa7df7d59dc3cd1fb", "patch": "@@ -7896,6 +7896,10 @@ for tgt in `echo $enable_offload_targets | sed 's/,/ /g'`; do\n \tomp_device_property=omp-device-properties-i386\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/i386/t-omp-device\"\n \t;;\n+      gcn*-*)\n+\tomp_device_property=omp-device-properties-gcn\n+\tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/gcn/t-omp-device\"\n+\t;;\n       nvptx*-*)\n \tomp_device_property=omp-device-properties-nvptx\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/nvptx/t-omp-device\"\n@@ -18933,7 +18937,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18936 \"configure\"\n+#line 18940 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -19039,7 +19043,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 19042 \"configure\"\n+#line 19046 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "5f32fd4d5e4df75f9bb7addb070e90665e0ee3bf", "filename": "gcc/configure.ac", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/955cd057454b323419e06affa7df7d59dc3cd1fb/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=955cd057454b323419e06affa7df7d59dc3cd1fb", "patch": "@@ -1037,6 +1037,10 @@ for tgt in `echo $enable_offload_targets | sed 's/,/ /g'`; do\n \tomp_device_property=omp-device-properties-i386\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/i386/t-omp-device\"\n \t;;\n+      gcn*-*)\n+\tomp_device_property=omp-device-properties-gcn\n+\tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/gcn/t-omp-device\"\n+\t;;\n       nvptx*-*)\n \tomp_device_property=omp-device-properties-nvptx\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/nvptx/t-omp-device\""}]}