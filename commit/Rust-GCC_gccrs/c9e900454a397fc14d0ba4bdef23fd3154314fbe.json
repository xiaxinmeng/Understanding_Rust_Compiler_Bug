{"sha": "c9e900454a397fc14d0ba4bdef23fd3154314fbe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzllOTAwNDU0YTM5N2ZjMTRkMGJhNGJkZWYyM2ZkMzE1NDMxNGZiZQ==", "commit": {"author": {"name": "Dodji Seketeli", "email": "dodji@redhat.com", "date": "2009-12-11T12:25:19Z"}, "committer": {"name": "Dodji Seketeli", "email": "dodji@gcc.gnu.org", "date": "2009-12-11T12:25:19Z"}, "message": "re PR c++/42251 (failure detecting constant integral expression)\n\nFix PR c++/42251\n\ngcc/cp/ChangeLog:\n\tPR c++/42251\n\t* pt.c (convert_template_argument): Avoid missing folding of SCOPE_REFs.\n\ngcc/testsuite/ChangeLog:\n\tPR c++/42251\n\t* g++.dg/template/const3.C: New test.\n\nFrom-SVN: r155159", "tree": {"sha": "47ca36bdaed6504bec92cf44422a699d05be52d4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47ca36bdaed6504bec92cf44422a699d05be52d4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c9e900454a397fc14d0ba4bdef23fd3154314fbe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9e900454a397fc14d0ba4bdef23fd3154314fbe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9e900454a397fc14d0ba4bdef23fd3154314fbe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9e900454a397fc14d0ba4bdef23fd3154314fbe/comments", "author": null, "committer": null, "parents": [{"sha": "8a8d675f4148d4fbccba88f514da8656bf1f27f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a8d675f4148d4fbccba88f514da8656bf1f27f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a8d675f4148d4fbccba88f514da8656bf1f27f2"}], "stats": {"total": 46, "additions": 39, "deletions": 7}, "files": [{"sha": "19e751d5d600a93cd5434382169cba0ec10158c5", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c9e900454a397fc14d0ba4bdef23fd3154314fbe", "patch": "@@ -1,3 +1,8 @@\n+2009-12-11  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/42251\n+\t* pt.c (convert_template_argument): Avoid missing folding of SCOPE_REFs.\n+\n 2009-12-10  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/42317"}, {"sha": "6f76d46d527bd826b41f479dd4221fe4b057c436", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=c9e900454a397fc14d0ba4bdef23fd3154314fbe", "patch": "@@ -5526,13 +5526,6 @@ convert_template_argument (tree parm,\n       if (TYPE_P (val))\n \tval = strip_typedefs (val);\n     }\n-  else if (TREE_CODE (orig_arg) == SCOPE_REF)\n-    {\n-      /* Strip typedefs from the SCOPE_REF.  */\n-      tree type = strip_typedefs (TREE_TYPE (orig_arg));\n-      tree scope = strip_typedefs (TREE_OPERAND (orig_arg, 0));\n-      val = build2 (SCOPE_REF, type, scope, TREE_OPERAND (orig_arg, 1));\n-    }\n   else\n     {\n       tree t = tsubst (TREE_TYPE (parm), args, complain, in_decl);\n@@ -5571,6 +5564,15 @@ convert_template_argument (tree parm,\n \tval = error_mark_node;\n       else if (val == error_mark_node && (complain & tf_error))\n \terror (\"could not convert template argument %qE to %qT\",  orig_arg, t);\n+\n+      if (TREE_CODE (val) == SCOPE_REF)\n+\t{\n+\t  /* Strip typedefs from the SCOPE_REF.  */\n+\t  tree type = strip_typedefs (TREE_TYPE (val));\n+\t  tree scope = strip_typedefs (TREE_OPERAND (val, 0));\n+\t  val = build_qualified_name (type, scope, TREE_OPERAND (val, 1),\n+\t\t\t\t      QUALIFIED_NAME_IS_TEMPLATE (val));\n+\t}\n     }\n \n   return val;"}, {"sha": "98744464556216f3b69649b4d6d7c42ccce1f8c8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c9e900454a397fc14d0ba4bdef23fd3154314fbe", "patch": "@@ -1,3 +1,8 @@\n+2009-12-11  Dodji Seketeli  <dodji@redhat.com>\n+\n+\tPR c++/42251\n+\t* g++.dg/template/const3.C: New test.\n+\n 2009-12-11  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/42320"}, {"sha": "5ef27315a51b862449d9374029de846ddaac07e3", "filename": "gcc/testsuite/g++.dg/template/const3.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fconst3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9e900454a397fc14d0ba4bdef23fd3154314fbe/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fconst3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fconst3.C?ref=c9e900454a397fc14d0ba4bdef23fd3154314fbe", "patch": "@@ -0,0 +1,20 @@\n+// Contributed by Dodji Seketeli <dodji@redhat.com>\n+// Origin PR c++/42251\n+// { dg-do \"compile\" }\n+\n+struct foo\n+{\n+    static const bool b = false;\n+};\n+\n+template<bool x>\n+struct S1\n+{\n+};\n+\n+template<bool x>\n+struct S2\n+    : S1<foo::b>\n+{\n+};\n+"}]}