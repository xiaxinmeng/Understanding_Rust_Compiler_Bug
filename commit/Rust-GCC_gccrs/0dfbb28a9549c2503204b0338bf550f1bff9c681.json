{"sha": "0dfbb28a9549c2503204b0338bf550f1bff9c681", "node_id": "C_kwDOANBUbNoAKDBkZmJiMjhhOTU0OWMyNTAzMjA0YjAzMzhiZjU1MGYxYmZmOWM2ODE", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-04-03T22:23:58Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-04-04T03:20:27Z"}, "message": "c++: friend template matching [PR107484]\n\nHere friend matching tries to find a matching non-template friend and fails,\nso we mark the friend as a template specialization to be determined later.\nThen cplus_decl_attributes tries again to find a matching function and gets\nconfused by DECL_TEMPLATE_INSTANTIATION without DECL_TEMPLATE_INFO.  But it\ndoesn't make sense for find_last_decl to be trying to match anything with\nDECL_USE_TEMPLATE set; those are matched elsewhere.\n\n\tPR c++/107484\n\ngcc/cp/ChangeLog:\n\n\t* decl2.cc (find_last_decl): Return early if DECL_USE_TEMPLATE.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/lookup/friend25.C: New test.", "tree": {"sha": "5ec58c937f3e815881de0cb4ce0eaa522172eaaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5ec58c937f3e815881de0cb4ce0eaa522172eaaa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0dfbb28a9549c2503204b0338bf550f1bff9c681", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0dfbb28a9549c2503204b0338bf550f1bff9c681", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0dfbb28a9549c2503204b0338bf550f1bff9c681", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0dfbb28a9549c2503204b0338bf550f1bff9c681/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "59b4a555c3f1c3dba376da1c4886a9ea18ad208d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59b4a555c3f1c3dba376da1c4886a9ea18ad208d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/59b4a555c3f1c3dba376da1c4886a9ea18ad208d"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "9594be4092c3c00fddc9d4c6da5931ea3b7e8792", "filename": "gcc/cp/decl2.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0dfbb28a9549c2503204b0338bf550f1bff9c681/gcc%2Fcp%2Fdecl2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0dfbb28a9549c2503204b0338bf550f1bff9c681/gcc%2Fcp%2Fdecl2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.cc?ref=0dfbb28a9549c2503204b0338bf550f1bff9c681", "patch": "@@ -1613,6 +1613,11 @@ find_last_decl (tree decl)\n \n   if (tree name = DECL_P (decl) ? DECL_NAME (decl) : NULL_TREE)\n     {\n+      /* Template specializations are matched elsewhere.  */\n+      if (DECL_LANG_SPECIFIC (decl)\n+\t  && DECL_USE_TEMPLATE (decl))\n+\treturn NULL_TREE;\n+\n       /* Look up the declaration in its scope.  */\n       tree pushed_scope = NULL_TREE;\n       if (tree ctype = DECL_CONTEXT (decl))"}, {"sha": "74cf5dc343197fc7c085d9f8f96a7cc76f846dbb", "filename": "gcc/testsuite/g++.dg/lookup/friend25.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0dfbb28a9549c2503204b0338bf550f1bff9c681/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Ffriend25.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0dfbb28a9549c2503204b0338bf550f1bff9c681/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Ffriend25.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Ffriend25.C?ref=0dfbb28a9549c2503204b0338bf550f1bff9c681", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/107484\n+\n+namespace qualified_friend_no_match {\n+  void f(int);\n+  template<typename T> void f(T*);\n+  struct X {\n+    friend void qualified_friend_no_match::f(double); // { dg-error \"does not match any template\" }\n+  };\n+}"}]}