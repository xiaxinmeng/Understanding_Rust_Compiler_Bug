{"sha": "94fb7608441bd960315df71ce953d9a88a9f74a3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTRmYjc2MDg0NDFiZDk2MDMxNWRmNzFjZTk1M2Q5YTg4YTlmNzRhMw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-29T09:28:10Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-29T09:28:10Z"}, "message": "[multiple changes]\n\n2011-08-29  Thomas Quinot  <quinot@adacore.com>\n\n\t* get_scos.adb: When reading a P statement SCO without a pragma name\n\t(from an older ALI file), ensure that the Pragma_Name component is set\n\tto Unknown_Pragma (not left uninitialized).\n\n2011-08-29  Vincent Celier  <celier@adacore.com>\n\n\t* makeutl.adb (Get_Directories): New procedure moved from Buildgpr and\n\tmodified to compute correctly the object path of a SAL project that is\n\textending another library project.\n\t(Write_Path_File): New procedure.\n\t* makeutl.ads (Directories): New table moved from Buildgpr\n\t(Get_Directories): New procedure moved from Buildgpr\n\t(Write_Path_File): New procedure\n\t* mlib-prj.adb (Build_Library): Use Makeutl.Get_Directories to set the\n\tpaths before binding SALs, instead of Set_Ada_Paths.\n\t* prj-env.adb (Set_Path_File_Var): Procedure has been moved to package\n\tPrj.\n\t* prj.adb (Set_Path_File_Var): New procedure moved from Prj.Env\n\t(Current_Source_Path_File_Of): New function\n\t(Set_Current_Object_Path_File_Of): New procedure\n\t(Current_Source_Object_File_Of): New function\n\t(Set_Current_Object_Path_File_Of): New procedure\n\t* prj.ads (Set_Path_File_Var): New procedure moved from Prj.Env\n\t(Current_Source_Path_File_Of): New function\n\t(Set_Current_Object_Path_File_Of): New procedure\n\t(Current_Source_Object_File_Of): New function\n\t(Set_Current_Object_Path_File_Of): New procedure\n\n2011-08-29  Ed Schonberg  <schonberg@adacore.com>\n\n\t* exp_ch5.adb (Expand_N_Assignment_Statement): For an assignment to a\n\tpacked entity, use a bit-field assignment only if there is no change of\n\trepresentation.\n\nFrom-SVN: r178177", "tree": {"sha": "e80bc0010abd61710289dc0d21c3388988b71aeb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e80bc0010abd61710289dc0d21c3388988b71aeb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94fb7608441bd960315df71ce953d9a88a9f74a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94fb7608441bd960315df71ce953d9a88a9f74a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94fb7608441bd960315df71ce953d9a88a9f74a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94fb7608441bd960315df71ce953d9a88a9f74a3/comments", "author": null, "committer": null, "parents": [{"sha": "c5ecd6b73c89668590555d62b39f954618c27978", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5ecd6b73c89668590555d62b39f954618c27978", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5ecd6b73c89668590555d62b39f954618c27978"}], "stats": {"total": 429, "additions": 384, "deletions": 45}, "files": [{"sha": "fffc645326ec0f57d20783cb8bc8244d5dde60a5", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -1,3 +1,39 @@\n+2011-08-29  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* get_scos.adb: When reading a P statement SCO without a pragma name\n+\t(from an older ALI file), ensure that the Pragma_Name component is set\n+\tto Unknown_Pragma (not left uninitialized).\n+\n+2011-08-29  Vincent Celier  <celier@adacore.com>\n+\n+\t* makeutl.adb (Get_Directories): New procedure moved from Buildgpr and\n+\tmodified to compute correctly the object path of a SAL project that is\n+\textending another library project.\n+\t(Write_Path_File): New procedure.\n+\t* makeutl.ads (Directories): New table moved from Buildgpr\n+\t(Get_Directories): New procedure moved from Buildgpr\n+\t(Write_Path_File): New procedure\n+\t* mlib-prj.adb (Build_Library): Use Makeutl.Get_Directories to set the\n+\tpaths before binding SALs, instead of Set_Ada_Paths.\n+\t* prj-env.adb (Set_Path_File_Var): Procedure has been moved to package\n+\tPrj.\n+\t* prj.adb (Set_Path_File_Var): New procedure moved from Prj.Env\n+\t(Current_Source_Path_File_Of): New function\n+\t(Set_Current_Object_Path_File_Of): New procedure\n+\t(Current_Source_Object_File_Of): New function\n+\t(Set_Current_Object_Path_File_Of): New procedure\n+\t* prj.ads (Set_Path_File_Var): New procedure moved from Prj.Env\n+\t(Current_Source_Path_File_Of): New function\n+\t(Set_Current_Object_Path_File_Of): New procedure\n+\t(Current_Source_Object_File_Of): New function\n+\t(Set_Current_Object_Path_File_Of): New procedure\n+\n+2011-08-29  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* exp_ch5.adb (Expand_N_Assignment_Statement): For an assignment to a\n+\tpacked entity, use a bit-field assignment only if there is no change of\n+\trepresentation.\n+\n 2011-08-29  Thomas Quinot  <quinot@adacore.com>\n \n \t* rtsfind.ads, exp_ch3.adb (In_Runtime): Minor code improvement, use"}, {"sha": "7dd2800d0746a705738892d4f3fa7171a916e049", "filename": "gcc/ada/exp_ch5.adb", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fexp_ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fexp_ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch5.adb?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -1511,6 +1511,7 @@ package body Exp_Ch5 is\n \n    procedure Expand_N_Assignment_Statement (N : Node_Id) is\n       Loc  : constant Source_Ptr := Sloc (N);\n+      Crep : constant Boolean    := Change_Of_Representation (N);\n       Lhs  : constant Node_Id    := Name (N);\n       Rhs  : constant Node_Id    := Expression (N);\n       Typ  : constant Entity_Id  := Underlying_Type (Etype (Lhs));\n@@ -1780,7 +1781,7 @@ package body Exp_Ch5 is\n          --  Skip discriminant check if change of representation. Will be\n          --  done when the change of representation is expanded out.\n \n-         if not Change_Of_Representation (N) then\n+         if not Crep then\n             Apply_Discriminant_Check (Rhs, Etype (Lhs), Lhs);\n          end if;\n \n@@ -1830,7 +1831,7 @@ package body Exp_Ch5 is\n             --  Skip discriminant check if change of representation. Will be\n             --  done when the change of representation is expanded out.\n \n-            if not Change_Of_Representation (N) then\n+            if not Crep then\n                Apply_Discriminant_Check (Rhs, Etype (Lhs));\n             end if;\n \n@@ -1883,10 +1884,13 @@ package body Exp_Ch5 is\n          Apply_Constraint_Check (Rhs, Etype (Lhs));\n       end if;\n \n-      --  Case of assignment to a bit packed array element\n+      --  Case of assignment to a bit packed array element. If there is a\n+      --  change of representation this must be expanded into components,\n+      --  otherwise this is a bit-field assignment.\n \n       if Nkind (Lhs) = N_Indexed_Component\n         and then Is_Bit_Packed_Array (Etype (Prefix (Lhs)))\n+        and then not Crep\n       then\n          Expand_Bit_Packed_Element_Set (N);\n          return;"}, {"sha": "8ad5a44e4bfff9e60ec7cdde6225f532cffa24f1", "filename": "gcc/ada/get_scos.adb", "status": "modified", "additions": 22, "deletions": 16, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fget_scos.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fget_scos.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fget_scos.adb?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -293,22 +293,28 @@ begin\n                      Typ := ' ';\n                   else\n                      Skipc;\n-                     if Typ = 'P' and then Nextc not in '1' .. '9' then\n-                        N := 1;\n-                        loop\n-                           Buf (N) := Getc;\n-                           exit when Nextc = ':';\n-                           N := N + 1;\n-                        end loop;\n-\n-                        begin\n-                           Pid := Pragma_Id'Value (Buf (1 .. N));\n-                        exception\n-                           when Constraint_Error =>\n-                              Pid := Unknown_Pragma;\n-                        end;\n-\n-                        Skipc;\n+                     if Typ = 'P' then\n+                        Pid := Unknown_Pragma;\n+\n+                        if Nextc not in '1' .. '9' then\n+                           N := 1;\n+                           loop\n+                              Buf (N) := Getc;\n+                              exit when Nextc = ':';\n+                              N := N + 1;\n+                           end loop;\n+                           Skipc;\n+\n+                           begin\n+                              Pid := Pragma_Id'Value (Buf (1 .. N));\n+                           exception\n+                              when Constraint_Error =>\n+\n+                                 --  Pid remains set to Unknown_Pragma\n+\n+                                 null;\n+                           end;\n+                        end if;\n                      end if;\n                   end if;\n "}, {"sha": "b3474975dfed87b574d31c4cb1c2a78f75a8362b", "filename": "gcc/ada/makeutl.adb", "status": "modified", "additions": 142, "deletions": 2, "changes": 144, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fmakeutl.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fmakeutl.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeutl.adb?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -32,12 +32,11 @@ with Hostparm;\n with Osint;    use Osint;\n with Output;   use Output;\n with Opt;      use Opt;\n+with Prj.Com;\n with Prj.Err;\n with Prj.Ext;\n with Prj.Util; use Prj.Util;\n with Sinput.P;\n-with Snames;   use Snames;\n-with Table;\n with Tempdir;\n \n with Ada.Command_Line;           use Ada.Command_Line;\n@@ -681,6 +680,118 @@ package body Makeutl is\n       return False;\n    end File_Not_A_Source_Of;\n \n+   ---------------------\n+   -- Get_Directories --\n+   ---------------------\n+\n+   procedure Get_Directories\n+     (Project_Tree : Project_Tree_Ref;\n+      For_Project  : Project_Id;\n+      Activity     : Activity_Type;\n+      Languages    : Name_Ids)\n+   is\n+\n+      procedure Recursive_Add\n+        (Project  : Project_Id;\n+         Tree     : Project_Tree_Ref;\n+         Extended : in out Boolean);\n+      --  Add all the source directories of a project to the path only if\n+      --  this project has not been visited. Calls itself recursively for\n+      --  projects being extended, and imported projects.\n+\n+      procedure Add_Dir (Value : Path_Name_Type);\n+      --  Add directory Value in table Directories, if it is defined and not\n+      --  already there.\n+\n+      -------------\n+      -- Add_Dir --\n+      -------------\n+\n+      procedure Add_Dir (Value : Path_Name_Type) is\n+         Add_It : Boolean := True;\n+\n+      begin\n+         if Value /= No_Path then\n+            for Index in 1 .. Directories.Last loop\n+               if Directories.Table (Index) = Value then\n+                  Add_It := False;\n+                  exit;\n+               end if;\n+            end loop;\n+\n+            if Add_It then\n+               Directories.Increment_Last;\n+               Directories.Table (Directories.Last) := Value;\n+            end if;\n+         end if;\n+      end Add_Dir;\n+\n+      -------------------\n+      -- Recursive_Add --\n+      -------------------\n+\n+      procedure Recursive_Add\n+        (Project  : Project_Id;\n+         Tree     : Project_Tree_Ref;\n+         Extended : in out Boolean)\n+      is\n+         Current   : String_List_Id;\n+         Dir       : String_Element;\n+         OK        : Boolean := False;\n+         Lang_Proc : Language_Ptr := Project.Languages;\n+      begin\n+         --  Add to path all directories of this project\n+\n+         if Activity = Compilation then\n+            Lang_Loop :\n+            while Lang_Proc /= No_Language_Index loop\n+               for J in Languages'Range loop\n+                  OK := Lang_Proc.Name = Languages (J);\n+                  exit Lang_Loop when OK;\n+               end loop;\n+\n+               Lang_Proc := Lang_Proc.Next;\n+            end loop Lang_Loop;\n+\n+            if OK then\n+               Current := Project.Source_Dirs;\n+\n+               while Current /= Nil_String loop\n+                  Dir := Tree.Shared.String_Elements.Table (Current);\n+                  Add_Dir (Path_Name_Type (Dir.Value));\n+                  Current := Dir.Next;\n+               end loop;\n+            end if;\n+\n+         elsif Project.Library then\n+            if Activity = SAL_Binding and then Extended then\n+               Add_Dir (Project.Object_Directory.Display_Name);\n+\n+            else\n+               Add_Dir (Project.Library_ALI_Dir.Display_Name);\n+            end if;\n+\n+         else\n+            Add_Dir (Project.Object_Directory.Display_Name);\n+         end if;\n+\n+         if Project.Extends = No_Project then\n+            Extended := False;\n+         end if;\n+      end Recursive_Add;\n+\n+      procedure For_All_Projects is\n+        new For_Every_Project_Imported (Boolean, Recursive_Add);\n+\n+      Extended : Boolean := True;\n+\n+      --  Start of processing for Get_Directories\n+\n+   begin\n+      Directories.Init;\n+      For_All_Projects (For_Project, Project_Tree, Extended);\n+   end Get_Directories;\n+\n    ------------------\n    -- Get_Switches --\n    ------------------\n@@ -3208,4 +3319,33 @@ package body Makeutl is\n       end if;\n    end Compute_Builder_Switches;\n \n+   ---------------------\n+   -- Write_Path_File --\n+   ---------------------\n+\n+   procedure Write_Path_File (FD : File_Descriptor) is\n+      Last : Natural;\n+      Status : Boolean;\n+   begin\n+      Name_Len := 0;\n+\n+      for Index in Directories.First .. Directories.Last loop\n+         Add_Str_To_Name_Buffer (Get_Name_String (Directories.Table (Index)));\n+         Add_Char_To_Name_Buffer (ASCII.LF);\n+      end loop;\n+\n+      Last := Write (FD, Name_Buffer (1)'Address, Name_Len);\n+\n+      if Last = Name_Len then\n+         Close (FD, Status);\n+\n+      else\n+         Status := False;\n+      end if;\n+\n+      if not Status then\n+         Prj.Com.Fail (\"could not write temporary file\");\n+      end if;\n+   end Write_Path_File;\n+\n end Makeutl;"}, {"sha": "f7eadacc603b0f37b10808ef259b8cd1685598d1", "filename": "gcc/ada/makeutl.ads", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fmakeutl.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fmakeutl.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeutl.ads?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -33,6 +33,8 @@ with Opt;\n with Osint;\n with Prj;      use Prj;\n with Prj.Tree;\n+with Snames;   use Snames;\n+with Table;\n with Types;    use Types;\n \n with GNAT.OS_Lib; use GNAT.OS_Lib;\n@@ -65,6 +67,16 @@ package Makeutl is\n    Create_Map_File_Switch : constant String := \"--create-map-file\";\n    --  Switch to create a map file when an executable is linked\n \n+   package Directories is new Table.Table\n+     (Table_Component_Type => Path_Name_Type,\n+      Table_Index_Type     => Integer,\n+      Table_Low_Bound      => 1,\n+      Table_Initial        => 200,\n+      Table_Increment      => 100,\n+      Table_Name           => \"Makegpr.Directories\");\n+   --  Table of all the source or object directories, filled up by\n+   --  Get_Directories.\n+\n    procedure Add\n      (Option : String_Access;\n       To     : in out String_List_Access;\n@@ -159,6 +171,30 @@ package Makeutl is\n    --  is printed last. Both N1 and N2 are printed in quotation marks. The two\n    --  forms differ only in taking Name_Id or File_name_Type arguments.\n \n+   type Name_Ids is array (Positive range <>) of Name_Id;\n+   No_Names : constant Name_Ids := (1 .. 0 => No_Name);\n+   --  Name_Ids is used for list of language names in procedure Get_Directories\n+   --  below.\n+   Ada_Only : constant Name_Ids := (1 => Name_Ada);\n+   --  Used to invoke Get_Directories in gnatmake\n+\n+   type Activity_Type is (Compilation, Executable_Binding, SAL_Binding);\n+\n+   procedure Get_Directories\n+     (Project_Tree : Project_Tree_Ref;\n+      For_Project  : Project_Id;\n+      Activity     : Activity_Type;\n+      Languages    : Name_Ids);\n+   --  Put in table Directories the source (when Sources is True) or\n+   --  object/library (when Sources is False) directories of project\n+   --  For_Project and of all the project it imports directly or indirectly.\n+   --  The source directories of imported projects are only included if one\n+   --  of the declared languages is in the list Languages.\n+\n+   procedure Write_Path_File (FD : File_Descriptor);\n+   --  Write in the specified open path file the directories in table\n+   --  Directories, then closed the path file.\n+\n    procedure Get_Switches\n      (Source       : Source_Id;\n       Pkg_Name     : Name_Id;"}, {"sha": "b01ad9d1ea2364b8dac015bf8ec77f10d67ef4bf", "filename": "gcc/ada/mlib-prj.adb", "status": "modified", "additions": 54, "deletions": 4, "changes": 58, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fmlib-prj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fmlib-prj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-prj.adb?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -25,6 +25,7 @@\n \n with ALI;      use ALI;\n with Gnatvsn;  use Gnatvsn;\n+with Makeutl;  use Makeutl;\n with MLib.Fil; use MLib.Fil;\n with MLib.Tgt; use MLib.Tgt;\n with MLib.Utl; use MLib.Utl;\n@@ -802,6 +803,9 @@ package body MLib.Prj is\n          end loop;\n       end Process_Imported_Libraries;\n \n+      Path_FD : File_Descriptor := Invalid_FD;\n+      --  Used for setting the source and object paths\n+\n    --  Start of processing for Build_Library\n \n    begin\n@@ -1044,10 +1048,56 @@ package body MLib.Prj is\n \n             --  Set the paths\n \n-            Set_Ada_Paths\n-              (Project             => For_Project,\n-               In_Tree             => In_Tree,\n-               Including_Libraries => True);\n+            --  First the source path\n+\n+            if For_Project.Include_Path_File = No_Path then\n+               Get_Directories\n+                 (Project_Tree => In_Tree,\n+                  For_Project  => For_Project,\n+                  Activity     => Compilation,\n+                  Languages    => Ada_Only);\n+\n+               Create_New_Path_File\n+                 (In_Tree.Shared, Path_FD, For_Project.Include_Path_File);\n+\n+               Write_Path_File (Path_FD);\n+               Path_FD := Invalid_FD;\n+\n+            end if;\n+\n+            if Current_Source_Path_File_Of (In_Tree.Shared) /=\n+              For_Project.Include_Path_File\n+            then\n+               Set_Current_Source_Path_File_Of\n+                 (In_Tree.Shared,\n+                 For_Project.Include_Path_File);\n+               Set_Path_File_Var\n+                 (Project_Include_Path_File,\n+                  Get_Name_String (For_Project.Include_Path_File));\n+            end if;\n+\n+            --  Then, the object path\n+\n+            Get_Directories\n+              (Project_Tree => In_Tree,\n+               For_Project  => For_Project,\n+               Activity     => SAL_Binding,\n+               Languages    => Ada_Only);\n+\n+            declare\n+               Path_File_Name : Path_Name_Type;\n+            begin\n+               Create_New_Path_File (In_Tree.Shared, Path_FD, Path_File_Name);\n+\n+               Write_Path_File (Path_FD);\n+               Path_FD := Invalid_FD;\n+\n+               Set_Path_File_Var\n+                 (Project_Objects_Path_File,\n+                  Get_Name_String (Path_File_Name));\n+               Set_Current_Source_Path_File_Of\n+                 (In_Tree.Shared, Path_File_Name);\n+            end;\n \n             --  Display the gnatbind command, if not in quiet output\n "}, {"sha": "40f4ae5cb13715ab62b2157341133481689a5975", "filename": "gcc/ada/prj-env.adb", "status": "modified", "additions": 0, "deletions": 19, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fprj-env.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fprj-env.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.adb?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -102,9 +102,6 @@ package body Prj.Env is\n    --  Add Object_Dir to object path table. Make sure it is not duplicate\n    --  and it is the last one in the current table.\n \n-   procedure Set_Path_File_Var (Name : String; Value : String);\n-   --  Call Setenv, after calling To_Host_File_Spec\n-\n    ----------------------\n    -- Ada_Include_Path --\n    ----------------------\n@@ -1776,22 +1773,6 @@ package body Prj.Env is\n       Free (Buffer);\n    end Set_Ada_Paths;\n \n-   -----------------------\n-   -- Set_Path_File_Var --\n-   -----------------------\n-\n-   procedure Set_Path_File_Var (Name : String; Value : String) is\n-      Host_Spec : String_Access := To_Host_File_Spec (Value);\n-   begin\n-      if Host_Spec = null then\n-         Prj.Com.Fail\n-           (\"could not convert file name \"\"\" & Value & \"\"\" to host spec\");\n-      else\n-         Setenv (Name, Host_Spec.all);\n-         Free (Host_Spec);\n-      end if;\n-   end Set_Path_File_Var;\n-\n    ---------------------\n    -- Add_Directories --\n    ---------------------"}, {"sha": "e69d52975ce5e56cee6b790c7ad407224a219a29", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -27,6 +27,7 @@ with Debug;\n with Osint;    use Osint;\n with Output;   use Output;\n with Prj.Attr;\n+with Prj.Com;\n with Prj.Err;  use Prj.Err;\n with Snames;   use Snames;\n with Uintp;    use Uintp;\n@@ -113,6 +114,28 @@ package body Prj is\n       Last := Last + S'Length;\n    end Add_To_Buffer;\n \n+   ---------------------------------\n+   -- Current_Object_Path_File_Of --\n+   ---------------------------------\n+\n+   function Current_Object_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access)\n+      return Path_Name_Type is\n+   begin\n+      return Shared.Private_Part.Current_Object_Path_File;\n+   end Current_Object_Path_File_Of;\n+\n+   ---------------------------------\n+   -- Current_Source_Path_File_Of --\n+   ---------------------------------\n+\n+   function Current_Source_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access)\n+      return Path_Name_Type is\n+   begin\n+      return Shared.Private_Part.Current_Source_Path_File;\n+   end Current_Source_Path_File_Of;\n+\n    ---------------------------\n    -- Delete_Temporary_File --\n    ---------------------------\n@@ -1029,6 +1052,46 @@ package body Prj is\n       Free_Units (Tree.Units_HT);\n    end Reset;\n \n+   -------------------------------------\n+   -- Set_Current_Object_Path_File_Of --\n+   -------------------------------------\n+\n+   procedure Set_Current_Object_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access;\n+      To     : Path_Name_Type)\n+   is\n+   begin\n+      Shared.Private_Part.Current_Object_Path_File := To;\n+   end Set_Current_Object_Path_File_Of;\n+\n+   -------------------------------------\n+   -- Set_Current_Source_Path_File_Of --\n+   -------------------------------------\n+\n+   procedure Set_Current_Source_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access;\n+      To     : Path_Name_Type)\n+   is\n+   begin\n+      Shared.Private_Part.Current_Source_Path_File := To;\n+   end Set_Current_Source_Path_File_Of;\n+\n+   -----------------------\n+   -- Set_Path_File_Var --\n+   -----------------------\n+\n+   procedure Set_Path_File_Var (Name : String; Value : String) is\n+      Host_Spec : String_Access := To_Host_File_Spec (Value);\n+   begin\n+      if Host_Spec = null then\n+         Prj.Com.Fail\n+           (\"could not convert file name \"\"\" & Value & \"\"\" to host spec\");\n+      else\n+         Setenv (Name, Host_Spec.all);\n+         Free (Host_Spec);\n+      end if;\n+   end Set_Path_File_Var;\n+\n    -------------------\n    -- Switches_Name --\n    -------------------"}, {"sha": "131a45b896b7cf28f1b0f258f07890ea2b1df61e", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94fb7608441bd960315df71ce953d9a88a9f74a3/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=94fb7608441bd960315df71ce953d9a88a9f74a3", "patch": "@@ -1595,6 +1595,29 @@ package Prj is\n      (Source_File_Name : File_Name_Type) return File_Name_Type;\n    --  Returns the switches file name corresponding to a source file name\n \n+   procedure Set_Path_File_Var (Name : String; Value : String);\n+   --  Call Setenv, after calling To_Host_File_Spec\n+\n+   function Current_Source_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access)\n+      return Path_Name_Type;\n+   --  Get the current include path file name\n+\n+   procedure Set_Current_Source_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access;\n+      To     : Path_Name_Type);\n+   --  Record the current include path file name\n+\n+   function Current_Object_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access)\n+      return Path_Name_Type;\n+   --  Get the current object path file name\n+\n+   procedure Set_Current_Object_Path_File_Of\n+     (Shared : Shared_Project_Tree_Data_Access;\n+      To     : Path_Name_Type);\n+   --  Record the current object path file name\n+\n    -----------\n    -- Flags --\n    -----------\n@@ -1676,7 +1699,7 @@ package Prj is\n    --  resolved will simply be ignored. However, in such a case, the flag\n    --  Incomplete_With in the project tree will be set to True.\n    --  This is meant for use by tools so that they can properly set the\n-   --  project path in such a case:\n+   --  project path in such a case:Shared_\n    --       * no \"gnatls\" found (so no default project path)\n    --       * user project sets Project.IDE'gnatls attribute to a cross gnatls\n    --       * user project also includes a \"with\" that can only be resolved"}]}