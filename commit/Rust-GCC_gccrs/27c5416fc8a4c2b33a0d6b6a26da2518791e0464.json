{"sha": "27c5416fc8a4c2b33a0d6b6a26da2518791e0464", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjdjNTQxNmZjOGE0YzJiMzNhMGQ2YjZhMjZkYTI1MTg3OTFlMDQ2NA==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2020-11-20T21:35:25Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2020-11-20T21:35:25Z"}, "message": "PR middle-end/97861 - ICE on an invalid redeclaration of a function with attribute access\n\ngcc/c-family/ChangeLog:\n\t* c-warn.c (warn_parm_array_mismatch): Bail on invalid redeclarations\n\twith fewer arguments.\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/attr-access-4.c: New test.", "tree": {"sha": "793b046a37ba17a2477970f92ea36c6f07ce5eac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/793b046a37ba17a2477970f92ea36c6f07ce5eac"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/27c5416fc8a4c2b33a0d6b6a26da2518791e0464", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27c5416fc8a4c2b33a0d6b6a26da2518791e0464", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27c5416fc8a4c2b33a0d6b6a26da2518791e0464", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27c5416fc8a4c2b33a0d6b6a26da2518791e0464/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ba23e045fcb820e8d32dee361c4d048604d8d599", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba23e045fcb820e8d32dee361c4d048604d8d599", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba23e045fcb820e8d32dee361c4d048604d8d599"}], "stats": {"total": 24, "additions": 17, "deletions": 7}, "files": [{"sha": "6d22a113ad0acc3b10258be14ec9355e3b6473e8", "filename": "gcc/c-family/c-warn.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27c5416fc8a4c2b33a0d6b6a26da2518791e0464/gcc%2Fc-family%2Fc-warn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27c5416fc8a4c2b33a0d6b6a26da2518791e0464/gcc%2Fc-family%2Fc-warn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-warn.c?ref=27c5416fc8a4c2b33a0d6b6a26da2518791e0464", "patch": "@@ -3374,18 +3374,20 @@ warn_parm_array_mismatch (location_t origloc, tree fndecl, tree newparms)\n   for (tree curp = curparms, newp = newparms; curp;\n        curp = TREE_CHAIN (curp), newp = TREE_CHAIN (newp), ++parmpos)\n     {\n+      if (!newp)\n+\t/* Bail on invalid redeclarations with fewer arguments.  */\n+\treturn;\n+\n       /* Only check pointers and C++ references.  */\n       tree newptype = TREE_TYPE (newp);\n       if (!POINTER_TYPE_P (newptype))\n \tcontinue;\n \n-      {\n-\t/* Skip mismatches in __builtin_va_list that is commonly\n-\t   an array but that in declarations of built-ins decays\n-\t   to a pointer.  */\n-\tif (builtin && TREE_TYPE (newptype) == TREE_TYPE (va_list_type_node))\n-\t  continue;\n-      }\n+      /* Skip mismatches in __builtin_va_list that is commonly\n+\t an array but that in declarations of built-ins decays\n+\t to a pointer.  */\n+      if (builtin && TREE_TYPE (newptype) == TREE_TYPE (va_list_type_node))\n+\tcontinue;\n \n       /* Access specs for the argument on the current (previous) and\n \t new (to replace the current) declarations.  Either may be null,"}, {"sha": "7a2870a0ee43f94b1827b02352a79fc9a68634ce", "filename": "gcc/testsuite/gcc.dg/attr-access-4.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27c5416fc8a4c2b33a0d6b6a26da2518791e0464/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-access-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27c5416fc8a4c2b33a0d6b6a26da2518791e0464/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-access-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-access-4.c?ref=27c5416fc8a4c2b33a0d6b6a26da2518791e0464", "patch": "@@ -0,0 +1,8 @@\n+/* PR middle-end/97861 - ICE on an invalid redeclaration of a function\n+   with attribute access\n+   { dg-do compile }\n+   { dg-options \"-Wall\" } */\n+\n+__attribute__ ((access (read_only, 2)))\n+void f (int, int*);\n+void f (int a) { }  // { dg-error \"conflicting types for 'f'\" }"}]}