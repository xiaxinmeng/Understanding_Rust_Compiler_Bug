{"sha": "97269a2340c812667bc083a1927f646d76d90b37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTcyNjlhMjM0MGM4MTI2NjdiYzA4M2ExOTI3ZjY0NmQ3NmQ5MGIzNw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2011-06-28T22:03:44Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2011-06-28T22:03:44Z"}, "message": "sync.md (*stbar): Delete.\n\n\t* config/sparc/sync.md (*stbar): Delete.\n\t(*membar_v8): New insn to implement UNSPEC_MEMBAR in SPARC-V8.\n\nFrom-SVN: r175604", "tree": {"sha": "c8ae101d1719fb0c8279bb0fd67a8bf20739f912", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c8ae101d1719fb0c8279bb0fd67a8bf20739f912"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/97269a2340c812667bc083a1927f646d76d90b37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97269a2340c812667bc083a1927f646d76d90b37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97269a2340c812667bc083a1927f646d76d90b37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97269a2340c812667bc083a1927f646d76d90b37/comments", "author": null, "committer": null, "parents": [{"sha": "4a9206ce4a426add4b27afebb24a6e8fa0e392bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a9206ce4a426add4b27afebb24a6e8fa0e392bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a9206ce4a426add4b27afebb24a6e8fa0e392bd"}], "stats": {"total": 18, "additions": 14, "deletions": 4}, "files": [{"sha": "c5759af0d48888916b742e9374869e7b46e8159f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97269a2340c812667bc083a1927f646d76d90b37/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97269a2340c812667bc083a1927f646d76d90b37/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=97269a2340c812667bc083a1927f646d76d90b37", "patch": "@@ -1,3 +1,8 @@\n+2011-06-28  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* config/sparc/sync.md (*stbar): Delete.\n+\t(*membar_v8): New insn to implement UNSPEC_MEMBAR in SPARC-V8.\n+\n 2011-06-28  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* tree-ssa-dom.c (initialize_hash_element): Fix oversight."}, {"sha": "a7380ab3c7013a0516066e466c57efb6a5b96c3d", "filename": "gcc/config/sparc/sync.md", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97269a2340c812667bc083a1927f646d76d90b37/gcc%2Fconfig%2Fsparc%2Fsync.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97269a2340c812667bc083a1927f646d76d90b37/gcc%2Fconfig%2Fsparc%2Fsync.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsync.md?ref=97269a2340c812667bc083a1927f646d76d90b37", "patch": "@@ -30,15 +30,20 @@\n {\n   operands[0] = gen_rtx_MEM (BLKmode, gen_rtx_SCRATCH (Pmode));\n   MEM_VOLATILE_P (operands[0]) = 1;\n-\n })\n \n-(define_insn \"*stbar\"\n+;; In V8, loads are blocking and ordered wrt earlier loads, i.e. every load\n+;; is virtually followed by a load barrier (membar #LoadStore | #LoadLoad).\n+;; In PSO, stbar orders the stores (membar #StoreStore).\n+;; In TSO, ldstub orders the stores wrt subsequent loads (membar #StoreLoad).\n+;; The combination of the three yields a full memory barrier in all cases.\n+(define_insn \"*membar_v8\"\n   [(set (match_operand:BLK 0 \"\" \"\")\n \t(unspec:BLK [(match_dup 0)] UNSPEC_MEMBAR))]\n   \"TARGET_V8\"\n-  \"stbar\"\n-  [(set_attr \"type\" \"multi\")])\n+  \"stbar\\n\\tldstub\\t[%%sp-1], %%g0\"\n+  [(set_attr \"type\" \"multi\")\n+   (set_attr \"length\" \"2\")])\n \n ;; membar #StoreStore | #LoadStore | #StoreLoad | #LoadLoad\n (define_insn \"*membar\""}]}