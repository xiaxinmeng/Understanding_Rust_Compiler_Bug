{"sha": "a2a9e21c333495766fc733fedbf1821b9b333840", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTJhOWUyMWMzMzM0OTU3NjZmYzczM2ZlZGJmMTgyMWI5YjMzMzg0MA==", "commit": {"author": {"name": "Gabriel Dos Reis", "email": "gdr@integrable-solutions.net", "date": "2003-09-07T18:52:53Z"}, "committer": {"name": "Gabriel Dos Reis", "email": "gdr@gcc.gnu.org", "date": "2003-09-07T18:52:53Z"}, "message": "re PR c++/11762 (namespace aliasing ICE in warn_extern_redeclared_static)\n\n\t* c-pretty-print.h (pp_c_left_brace): Declare.\n\t(pp_c_right_brace): Likewise.\n\t* c-pretty-print.c (pp_c_left_brace): Now a function\n\t(pp_c_right_brace): Likewise.\n\ncp/\n\tPR c++/11762\n\t* error.c (dump_decl): Handle namespace-alias-definition.\n\t* decl.c (warn_extern_redeclared_static): There is no point in\n\tchecking changes in storage class specifier for a namespace\n\tdeclaration.\n\t(duplicate_decls): Tidy diagnostic message.\n\t* cxx-pretty-print.c (pp_cxx_left_brace): New macro.\n\t(pp_cxx_right_brace): Likewise.\n\t(pp_cxx_original_namespace_definition): New function.\n\t(pp_cxx_namespace_alias_definition): Likewise.\n\t(pp_cxx_declaration): Use them.  Handle NAMESPACE_DECLs.\n\nFrom-SVN: r71175", "tree": {"sha": "a053051804681d6afd59965f85bf34dfc364a70f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a053051804681d6afd59965f85bf34dfc364a70f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2a9e21c333495766fc733fedbf1821b9b333840", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2a9e21c333495766fc733fedbf1821b9b333840", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2a9e21c333495766fc733fedbf1821b9b333840", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2a9e21c333495766fc733fedbf1821b9b333840/comments", "author": {"login": "cxx-undef", "id": 5528103, "node_id": "MDQ6VXNlcjU1MjgxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5528103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cxx-undef", "html_url": "https://github.com/cxx-undef", "followers_url": "https://api.github.com/users/cxx-undef/followers", "following_url": "https://api.github.com/users/cxx-undef/following{/other_user}", "gists_url": "https://api.github.com/users/cxx-undef/gists{/gist_id}", "starred_url": "https://api.github.com/users/cxx-undef/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cxx-undef/subscriptions", "organizations_url": "https://api.github.com/users/cxx-undef/orgs", "repos_url": "https://api.github.com/users/cxx-undef/repos", "events_url": "https://api.github.com/users/cxx-undef/events{/privacy}", "received_events_url": "https://api.github.com/users/cxx-undef/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1ab237dfa3b2afa84b952ac457eb01df96638757", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ab237dfa3b2afa84b952ac457eb01df96638757", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ab237dfa3b2afa84b952ac457eb01df96638757"}], "stats": {"total": 131, "additions": 107, "deletions": 24}, "files": [{"sha": "d907564ec68457615b7a5181b15868fc4e7a277b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -1,3 +1,10 @@\n+2003-09-07  Gabriel Dos Reis  <gcc@integrable-solutions.net>\n+\n+\t* c-pretty-print.h (pp_c_left_brace): Declare.\n+\t(pp_c_right_brace): Likewise.\n+\t* c-pretty-print.c (pp_c_left_brace): Now a function\n+\t(pp_c_right_brace): Likewise.\n+\n Sun Sep  7 14:50:03 CEST 2003  Jan Hubicka  <jh@suse.cz>\n \n \t* cfgcleanup.c (try_simplify_condjump): Fix again the preivous patch."}, {"sha": "0fd5bb1e9331e6fbd520fce5319aeabe5885e767", "filename": "gcc/c-pretty-print.c", "status": "modified", "additions": 14, "deletions": 12, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fc-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fc-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-pretty-print.c?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -41,18 +41,6 @@ Software Foundation, 59 Temple Place - Suite 330, Boston, MA\n        pp_c_whitespace (PP);                 \\\n    } while (0)\n \n-#define pp_c_left_brace(PP)           \\\n-  do {                                \\\n-    pp_left_brace (PP);               \\\n-    pp_base (PP)->padding = pp_none;  \\\n-  } while (0)\n-\n-#define pp_c_right_brace(PP)          \\\n-  do {                                \\\n-    pp_right_brace (PP);              \\\n-    pp_base (PP)->padding = pp_none;  \\\n-  } while (0)\n-\n #define pp_c_left_bracket(PP)         \\\n   do {                                \\\n     pp_left_bracket (PP);             \\\n@@ -115,6 +103,20 @@ pp_c_right_paren (c_pretty_printer *pp)\n   pp_base (pp)->padding = pp_none;\n }\n \n+void\n+pp_c_left_brace (c_pretty_printer *pp)\n+{\n+  pp_left_brace (pp);\n+  pp_base (pp)->padding = pp_none;\n+}\n+\n+void\n+pp_c_right_brace (c_pretty_printer *pp)\n+{\n+  pp_right_brace (pp);\n+  pp_base (pp)->padding = pp_none;\n+}\n+\n void\n pp_c_dot (c_pretty_printer *pp)\n {"}, {"sha": "2bc1dbc168a55aec40b353529409982d01a7b7b5", "filename": "gcc/c-pretty-print.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fc-pretty-print.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fc-pretty-print.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-pretty-print.h?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -157,6 +157,8 @@ extern void pp_c_pretty_printer_init (c_pretty_printer *);\n void pp_c_whitespace (c_pretty_printer *);\n void pp_c_left_paren (c_pretty_printer *);\n void pp_c_right_paren (c_pretty_printer *);\n+void pp_c_left_brace (c_pretty_printer *);\n+void pp_c_right_brace (c_pretty_printer *);\n void pp_c_dot (c_pretty_printer *);\n void pp_c_ampersand (c_pretty_printer *);\n void pp_c_arrow (c_pretty_printer *);"}, {"sha": "5dbfab44205bd053b807d2bd72484b7a2979827c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -1,3 +1,17 @@\n+2003-09-07  Gabriel Dos Reis  <gcc@integrable-solutions.net>\n+\n+\tPR c++/11762\n+\t* error.c (dump_decl): Handle namespace-alias-definition.\n+\t* decl.c (warn_extern_redeclared_static): There is no point in\n+\tchecking changes in storage class specifier for a namespace\n+\tdeclaration. \n+\t(duplicate_decls): Tidy diagnostic message.\n+\t* cxx-pretty-print.c (pp_cxx_left_brace): New macro.\n+\t(pp_cxx_right_brace): Likewise.\n+\t(pp_cxx_original_namespace_definition): New function.\n+\t(pp_cxx_namespace_alias_definition): Likewise.\n+\t(pp_cxx_declaration): Use them.  Handle NAMESPACE_DECLs.\n+\n Sun Sep  7 13:15:14 CEST 2003  Jan Hubicka  <jh@suse.cz>\n \n \t* decl2.c (maybe_emit_vtables, write_out_vars, finish_file):"}, {"sha": "975ace6070d4368f3965bcc5e1a4c82db91f5576", "filename": "gcc/cp/cxx-pretty-print.c", "status": "modified", "additions": 53, "deletions": 3, "changes": 56, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2Fcxx-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2Fcxx-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcxx-pretty-print.c?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -45,6 +45,8 @@ static void pp_cxx_template_parameter (cxx_pretty_printer *, tree);\n #define pp_cxx_whitespace(PP)  pp_c_whitespace (pp_c_base (PP))\n #define pp_cxx_left_paren(PP)  pp_c_left_paren (pp_c_base (PP))\n #define pp_cxx_right_paren(PP) pp_c_right_paren (pp_c_base (PP))\n+#define pp_cxx_left_brace(PP)  pp_c_left_brace (pp_c_base (PP))\n+#define pp_cxx_right_brace(PP) pp_c_right_brace (pp_c_base (PP))\n #define pp_cxx_dot(PP)         pp_c_dot (pp_c_base (PP))\n #define pp_cxx_arrow(PP)       pp_c_arrow (pp_c_base (PP))\n #define pp_cxx_semicolon(PP)   pp_c_semicolon (pp_c_base (PP))\n@@ -1471,6 +1473,45 @@ pp_cxx_statement (cxx_pretty_printer *pp, tree t)\n     }\n }\n \n+/* original-namespace-definition:\n+      namespace identifier { namespace-body }\n+\n+  As an edge case, we also handle unnamed namespace definition here.  */\n+\n+static void\n+pp_cxx_original_namespace_definition (cxx_pretty_printer *pp, tree t)\n+{\n+  pp_cxx_identifier (pp, \"namespace\");\n+  if (DECL_NAME (t) != anonymous_namespace_name)\n+    pp_cxx_unqualified_id (pp, t);\n+  pp_cxx_whitespace (pp);\n+  pp_cxx_left_brace (pp);\n+  /* We do not print the namespace-body.  */\n+  pp_cxx_whitespace (pp);\n+  pp_cxx_right_brace (pp);\n+}\n+\n+/* namespace-alias:\n+      identifier\n+\n+   namespace-alias-definition:\n+      namespace identifier = qualified-namespace-specifier ;\n+\n+   qualified-namespace-specifier:\n+      ::(opt) nested-name-specifier(opt) namespace-name   */\n+\n+static void\n+pp_cxx_namespace_alias_definition (cxx_pretty_printer *pp, tree t)\n+{\n+  pp_cxx_identifier (pp, \"namespace\");\n+  pp_cxx_unqualified_id (pp, t);\n+  pp_cxx_whitespace (pp);\n+  pp_equal (pp);\n+  pp_cxx_whitespace (pp);\n+  pp_cxx_qualified_id (pp, DECL_NAMESPACE_ALIAS (t));\n+  pp_cxx_semicolon (pp);\n+}\n+\n /* simple-declaration:\n       decl-specifier-seq(opt) init-declarator-list(opt)  */\n static void\n@@ -1618,9 +1659,13 @@ pp_cxx_declaration (cxx_pretty_printer *pp, tree t)\n {\n   if (!DECL_LANG_SPECIFIC (t))\n     pp_cxx_simple_declaration (pp, t);\n-  else if (DECL_USE_TEMPLATE (t) > 1)\n+  else if (DECL_USE_TEMPLATE (t))\n     switch (DECL_USE_TEMPLATE (t))\n       {\n+      case 1:\n+        pp_cxx_template_declaration (pp, t);\n+        break;\n+        \n       case 2:\n         pp_cxx_explicit_specialization (pp, t);\n         break;\n@@ -1632,8 +1677,6 @@ pp_cxx_declaration (cxx_pretty_printer *pp, tree t)\n       default:\n         break;\n       }\n-  else if (DECL_TEMPLATE_INFO (t))\n-    pp_cxx_template_declaration (pp, t);\n   else switch (TREE_CODE (t))\n     {\n     case VAR_DECL:\n@@ -1648,6 +1691,13 @@ pp_cxx_declaration (cxx_pretty_printer *pp, tree t)\n         pp_cxx_simple_declaration (pp, t);\n       break;\n \n+    case NAMESPACE_DECL:\n+      if (DECL_NAMESPACE_ALIAS (t))\n+        pp_cxx_namespace_alias_definition (pp, t);\n+      else\n+        pp_cxx_original_namespace_definition (pp, t);\n+      break;\n+\n     default:\n       pp_unsupported_tree (pp, t);\n       break;"}, {"sha": "ca137909577e716ae53a56a40325f629d44e502a", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -2736,7 +2736,8 @@ warn_extern_redeclared_static (tree newdecl, tree olddecl)\n \n   if (TREE_CODE (newdecl) == TYPE_DECL\n       || TREE_CODE (newdecl) == TEMPLATE_DECL\n-      || TREE_CODE (newdecl) == CONST_DECL)\n+      || TREE_CODE (newdecl) == CONST_DECL\n+      || TREE_CODE (newdecl) == NAMESPACE_DECL)\n     return;\n \n   /* Don't get confused by static member functions; that's a different\n@@ -3004,8 +3005,10 @@ duplicate_decls (tree newdecl, tree olddecl)\n       else if (current_class_type == NULL_TREE\n \t  || IDENTIFIER_ERROR_LOCUS (DECL_ASSEMBLER_NAME (newdecl)) != current_class_type)\n \t{\n-\t  error (\"conflicting types for `%#D'\", newdecl);\n-\t  cp_error_at (\"previous declaration as `%#D'\", olddecl);\n+\t  error (\"conflicting declaration '%#D'\", newdecl);\n+\t  cp_error_at (\"'%D' has a previous declaration as `%#D'\",\n+                       olddecl, olddecl);\n+          return false;\n \t}\n     }\n   else if (TREE_CODE (newdecl) == FUNCTION_DECL"}, {"sha": "5c94d758716d95ed701030a8e656500076f3041d", "filename": "gcc/cp/error.c", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Fcp%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ferror.c?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -831,11 +831,16 @@ dump_decl (tree t, int flags)\n       break;\n \n     case NAMESPACE_DECL:\n-      dump_scope (CP_DECL_CONTEXT (t), flags);\n-      if (DECL_NAME (t) == anonymous_namespace_name)\n-\tpp_identifier (cxx_pp, \"<unnamed>\");\n+      if (flags & TFF_DECL_SPECIFIERS)\n+        pp_cxx_declaration (cxx_pp, t);\n       else\n-\tpp_tree_identifier (cxx_pp, DECL_NAME (t));\n+        {\n+          dump_scope (CP_DECL_CONTEXT (t), flags);\n+          if (DECL_NAME (t) == anonymous_namespace_name)\n+            pp_identifier (cxx_pp, \"<unnamed>\");\n+          else\n+            pp_tree_identifier (cxx_pp, DECL_NAME (t));\n+        }\n       break;\n \n     case SCOPE_REF:"}, {"sha": "dd8d54b85d8fb3a1278ec87b5a91e8af842dc78b", "filename": "gcc/testsuite/g++.dg/lookup/struct1.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fstruct1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2a9e21c333495766fc733fedbf1821b9b333840/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fstruct1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fstruct1.C?ref=a2a9e21c333495766fc733fedbf1821b9b333840", "patch": "@@ -3,10 +3,10 @@\n \n struct A;\n typedef struct A B;\t\t// { dg-error \"previous declaration\" }\n-struct B;\t\t\t// { dg-error \"conflicting types\" }\n+struct B;\t\t\t// { dg-error \"conflicting declaration\" }\n \n typedef struct { int i; } C;\t// { dg-error \"previous declaration\" }\n-struct C;\t\t\t// { dg-error \"conflicting types\" }\n+struct C;\t\t\t// { dg-error \"conflicting declaration\" }\n \n struct D;\n typedef struct D D;"}]}