{"sha": "a08f265625e525fa937dd6bc59f37da122df9f82", "node_id": "C_kwDOANBUbNoAKGEwOGYyNjU2MjVlNTI1ZmE5MzdkZDZiYzU5ZjM3ZGExMjJkZjlmODI", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-10-11T09:38:55Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2023-02-21T11:36:33Z"}, "message": "gccrs: mappings: Add MacroInvocation -> MacroRulesDef mappings\n\ngcc/rust/ChangeLog:\n\n\t* util/rust-hir-map.h: Add new mappings.\n\t* util/rust-hir-map.cc (Mappings::insert_macro_invocation): Add insertion\n\tfunction into mappings.\n\t(Mappings::lookup_macro_invocation): Add lookup function for mappings.", "tree": {"sha": "fd7a0bb9e6df851429bcca7c77f785add3f1cf7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd7a0bb9e6df851429bcca7c77f785add3f1cf7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a08f265625e525fa937dd6bc59f37da122df9f82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a08f265625e525fa937dd6bc59f37da122df9f82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a08f265625e525fa937dd6bc59f37da122df9f82", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a08f265625e525fa937dd6bc59f37da122df9f82/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "570415e75c42a6346724859d12f38ec3faa9edd8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/570415e75c42a6346724859d12f38ec3faa9edd8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/570415e75c42a6346724859d12f38ec3faa9edd8"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "7ea782ed4c46e1a9e68928a91f0d65e8f38c55e7", "filename": "gcc/rust/util/rust-hir-map.cc", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a08f265625e525fa937dd6bc59f37da122df9f82/gcc%2Frust%2Futil%2Frust-hir-map.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a08f265625e525fa937dd6bc59f37da122df9f82/gcc%2Frust%2Futil%2Frust-hir-map.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.cc?ref=a08f265625e525fa937dd6bc59f37da122df9f82", "patch": "@@ -866,6 +866,28 @@ Mappings::lookup_macro_def (NodeId id, AST::MacroRulesDefinition **def)\n   return true;\n }\n \n+void\n+Mappings::insert_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\t   AST::MacroRulesDefinition *def)\n+{\n+  auto it = macroInvocations.find (invoc.get_macro_node_id ());\n+  rust_assert (it == macroInvocations.end ());\n+\n+  macroInvocations[invoc.get_macro_node_id ()] = def;\n+}\n+\n+bool\n+Mappings::lookup_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\t   AST::MacroRulesDefinition **def)\n+{\n+  auto it = macroInvocations.find (invoc.get_macro_node_id ());\n+  if (it == macroInvocations.end ())\n+    return false;\n+\n+  *def = it->second;\n+  return true;\n+}\n+\n void\n Mappings::insert_visibility (NodeId id, Privacy::ModuleVisibility visibility)\n {"}, {"sha": "addd9efc3b089d225d7b536ceda6c9a9edd29f69", "filename": "gcc/rust/util/rust-hir-map.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a08f265625e525fa937dd6bc59f37da122df9f82/gcc%2Frust%2Futil%2Frust-hir-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a08f265625e525fa937dd6bc59f37da122df9f82/gcc%2Frust%2Futil%2Frust-hir-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Futil%2Frust-hir-map.h?ref=a08f265625e525fa937dd6bc59f37da122df9f82", "patch": "@@ -269,6 +269,11 @@ class Mappings\n \n   bool lookup_macro_def (NodeId id, AST::MacroRulesDefinition **def);\n \n+  void insert_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\tAST::MacroRulesDefinition *def);\n+  bool lookup_macro_invocation (AST::MacroInvocation &invoc,\n+\t\t\t\tAST::MacroRulesDefinition **def);\n+\n   void insert_visibility (NodeId id, Privacy::ModuleVisibility visibility);\n   bool lookup_visibility (NodeId id, Privacy::ModuleVisibility &def);\n \n@@ -334,6 +339,7 @@ class Mappings\n \n   // macros\n   std::map<NodeId, AST::MacroRulesDefinition *> macroMappings;\n+  std::map<NodeId, AST::MacroRulesDefinition *> macroInvocations;\n \n   // crate names\n   std::map<CrateNum, std::string> crate_names;"}]}