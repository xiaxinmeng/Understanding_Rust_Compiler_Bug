{"sha": "714c800f1f3f8b75e5b86c298464692f0bf434ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzE0YzgwMGYxZjNmOGI3NWU1Yjg2YzI5ODQ2NDY5MmYwYmY0MzRlYQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2014-06-21T02:46:34Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2014-06-21T02:46:34Z"}, "message": "cgraph.h (tls_model_names): New variable.\n\n\n\t* cgraph.h (tls_model_names): New variable.\n\t* print-tree.c (print_node): Simplify.\n\t* varpool.c (tls_model_names): New variable.\n\t(dump_varpool_node): Output tls model.\n\n\t* lto-symtab.c (lto_varpool_replace_node): Report TLS model conflicts.\n\nFrom-SVN: r211865", "tree": {"sha": "e3a0076599ad858c565005019a89d35abb96c47b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e3a0076599ad858c565005019a89d35abb96c47b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/714c800f1f3f8b75e5b86c298464692f0bf434ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/714c800f1f3f8b75e5b86c298464692f0bf434ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/714c800f1f3f8b75e5b86c298464692f0bf434ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/714c800f1f3f8b75e5b86c298464692f0bf434ea/comments", "author": null, "committer": null, "parents": [{"sha": "b48972129f88f590aea38bf2617649c61a8424c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b48972129f88f590aea38bf2617649c61a8424c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b48972129f88f590aea38bf2617649c61a8424c7"}], "stats": {"total": 47, "additions": 29, "deletions": 18}, "files": [{"sha": "1691cc0022e4a9e76b78b551886fed78fa8ad631", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=714c800f1f3f8b75e5b86c298464692f0bf434ea", "patch": "@@ -1,3 +1,10 @@\n+2014-06-20  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* cgraph.h (tls_model_names): New variable.\n+\t* print-tree.c (print_node): Simplify.\n+\t* varpool.c (tls_model_names): New variable.\n+\t(dump_varpool_node): Output tls model.\n+\n 2014-06-20  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-visibility.c (function_and_variable_visibility): Disable"}, {"sha": "2fad1931c1867cc9afddf71f7f47dc375fc8229f", "filename": "gcc/cgraph.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Fcgraph.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Fcgraph.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.h?ref=714c800f1f3f8b75e5b86c298464692f0bf434ea", "patch": "@@ -244,6 +244,7 @@ struct lto_file_decl_data;\n \n extern const char * const cgraph_availability_names[];\n extern const char * const ld_plugin_symbol_resolution_names[];\n+extern const char * const tls_model_names[];\n \n /* Information about thunk, used only for same body aliases.  */\n "}, {"sha": "4086b2134eb53624f134e1fb281e78d49a2b697f", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=714c800f1f3f8b75e5b86c298464692f0bf434ea", "patch": "@@ -1,3 +1,7 @@\n+2014-06-20  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* lto-symtab.c (lto_varpool_replace_node): Report TLS model conflicts.\n+\n 2014-06-20  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto.c (compare_tree_sccs_1): Do not compare priorities."}, {"sha": "c02f987aaeaef5be74fe972a48706dd42c4c76f3", "filename": "gcc/lto/lto-symtab.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Flto%2Flto-symtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Flto%2Flto-symtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-symtab.c?ref=714c800f1f3f8b75e5b86c298464692f0bf434ea", "patch": "@@ -116,6 +116,15 @@ lto_varpool_replace_node (varpool_node *vnode,\n   if (DECL_INITIAL (vnode->decl)\n       && vnode->decl != prevailing_node->decl)\n     DECL_INITIAL (vnode->decl) = error_mark_node;\n+\n+  if (vnode->tls_model != prevailing_node->tls_model)\n+    {\n+      error_at (DECL_SOURCE_LOCATION (vnode->decl),\n+\t\t\"%qD is defined as %s\", vnode->decl, tls_model_names [vnode->tls_model]);\n+      inform (DECL_SOURCE_LOCATION (prevailing_node->decl),\n+\t      \"previously defined here as %s\",\n+\t      tls_model_names [prevailing_node->tls_model]);\n+    }\n   /* Finally remove the replaced node.  */\n   varpool_remove_node (vnode);\n }"}, {"sha": "91d88c2835d2de480ecefad5446760a11246523b", "filename": "gcc/print-tree.c", "status": "modified", "additions": 2, "deletions": 18, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Fprint-tree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Fprint-tree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprint-tree.c?ref=714c800f1f3f8b75e5b86c298464692f0bf434ea", "patch": "@@ -418,24 +418,8 @@ print_node (FILE *file, const char *prefix, tree node, int indent)\n \tfputs (\" common\", file);\n       if (code == VAR_DECL && DECL_THREAD_LOCAL_P (node))\n \t{\n-\t  enum tls_model kind = DECL_TLS_MODEL (node);\n-\t  switch (kind)\n-\t    {\n-\t      case TLS_MODEL_GLOBAL_DYNAMIC:\n-\t\tfputs (\" tls-global-dynamic\", file);\n-\t\tbreak;\n-\t      case TLS_MODEL_LOCAL_DYNAMIC:\n-\t\tfputs (\" tls-local-dynamic\", file);\n-\t\tbreak;\n-\t      case TLS_MODEL_INITIAL_EXEC:\n-\t\tfputs (\" tls-initial-exec\", file);\n-\t\tbreak;\n-\t      case TLS_MODEL_LOCAL_EXEC:\n-\t\tfputs (\" tls-local-exec\", file);\n-\t\tbreak;\n-\t      default:\n-\t\tgcc_unreachable ();\n-\t    }\n+\t  fputs (\" \", file);\n+\t  fputs (tls_model_names[DECL_TLS_MODEL (node)], file);\n \t}\n \n       if (CODE_CONTAINS_STRUCT (code, TS_DECL_COMMON))"}, {"sha": "f6f836539e8173a285964429b0d168a898af9add", "filename": "gcc/varpool.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Fvarpool.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/714c800f1f3f8b75e5b86c298464692f0bf434ea/gcc%2Fvarpool.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarpool.c?ref=714c800f1f3f8b75e5b86c298464692f0bf434ea", "patch": "@@ -36,6 +36,10 @@ along with GCC; see the file COPYING3.  If not see\n #include \"flags.h\"\n #include \"pointer-set.h\"\n \n+const char * const tls_model_names[]={\"none\", \"tls-emulated\", \"tls-real\",\n+\t\t\t\t      \"tls-global-dynamic\", \"tls-local-dynamic\",\n+\t\t\t\t      \"tls-initial-exec\", \"tls-local-exec\"};\n+\n /* List of hooks triggered on varpool_node events.  */\n struct varpool_node_hook_list {\n   varpool_node_hook hook;\n@@ -213,6 +217,8 @@ dump_varpool_node (FILE *f, varpool_node *node)\n     fprintf (f, \" const-value-known\");\n   if (node->writeonly)\n     fprintf (f, \" write-only\");\n+  if (node->tls_model)\n+    fprintf (f, \" %s\", tls_model_names [node->tls_model]);\n   fprintf (f, \"\\n\");\n }\n "}]}