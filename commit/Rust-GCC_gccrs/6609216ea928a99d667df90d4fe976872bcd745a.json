{"sha": "6609216ea928a99d667df90d4fe976872bcd745a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjYwOTIxNmVhOTI4YTk5ZDY2N2RmOTBkNGZlOTc2ODcyYmNkNzQ1YQ==", "commit": {"author": {"name": "Georg-Johann Lay", "email": "avr@gjlay.de", "date": "2011-02-27T08:36:55Z"}, "committer": {"name": "Denis Chertykov", "email": "denisc@gcc.gnu.org", "date": "2011-02-27T08:36:55Z"}, "message": "re PR target/42240 (wrong epilogue on naked function)\n\n2011-02-22  Georg-Johann Lay  <avr@gjlay.de>\n\n\tPR target/42240\n\t* config/avr/avr.c (avr_cannot_modify_jumps_p): New function.\n\t(TARGET_CANNOT_MODIFY_JUMPS_P): Define.\n\nFrom-SVN: r170534", "tree": {"sha": "acb0e40b7c8c43b8bca49678c8f728c770575479", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/acb0e40b7c8c43b8bca49678c8f728c770575479"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6609216ea928a99d667df90d4fe976872bcd745a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6609216ea928a99d667df90d4fe976872bcd745a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6609216ea928a99d667df90d4fe976872bcd745a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6609216ea928a99d667df90d4fe976872bcd745a/comments", "author": null, "committer": null, "parents": [{"sha": "e7dc5734a82ce4794027871556dfdd4bf1be2c25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7dc5734a82ce4794027871556dfdd4bf1be2c25", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7dc5734a82ce4794027871556dfdd4bf1be2c25"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "88d3eddaeea297f791fcb949a21785c51f361296", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6609216ea928a99d667df90d4fe976872bcd745a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6609216ea928a99d667df90d4fe976872bcd745a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6609216ea928a99d667df90d4fe976872bcd745a", "patch": "@@ -1,3 +1,9 @@\n+2011-02-22  Georg-Johann Lay  <avr@gjlay.de>\n+\n+\tPR target/42240\n+\t* config/avr/avr.c (avr_cannot_modify_jumps_p): New function.\n+\t(TARGET_CANNOT_MODIFY_JUMPS_P): Define.\n+\n 2011-02-26  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* doc/invoke.texi (ARC Options): Use CPU instead of cpu."}, {"sha": "c6f60b4e8df755367d941dd5d27e6cefa233adb5", "filename": "gcc/config/avr/avr.c", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6609216ea928a99d667df90d4fe976872bcd745a/gcc%2Fconfig%2Favr%2Favr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6609216ea928a99d667df90d4fe976872bcd745a/gcc%2Fconfig%2Favr%2Favr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Favr%2Favr.c?ref=6609216ea928a99d667df90d4fe976872bcd745a", "patch": "@@ -73,6 +73,7 @@ static void avr_file_end (void);\n static bool avr_legitimate_address_p (enum machine_mode, rtx, bool);\n static void avr_asm_function_end_prologue (FILE *);\n static void avr_asm_function_begin_epilogue (FILE *);\n+static bool avr_cannot_modify_jumps_p (void);\n static rtx avr_function_value (const_tree, const_tree, bool);\n static void avr_insert_attributes (tree, tree *);\n static void avr_asm_init_sections (void);\n@@ -217,6 +218,9 @@ static const struct default_options avr_option_optimization_table[] =\n #undef TARGET_OPTION_OPTIMIZATION_TABLE\n #define TARGET_OPTION_OPTIMIZATION_TABLE avr_option_optimization_table\n \n+#undef TARGET_CANNOT_MODIFY_JUMPS_P\n+#define TARGET_CANNOT_MODIFY_JUMPS_P avr_cannot_modify_jumps_p\n+\n struct gcc_target targetm = TARGET_INITIALIZER;\n \f\n static void\n@@ -980,6 +984,27 @@ avr_asm_function_begin_epilogue (FILE *file)\n   fprintf (file, \"/* epilogue start */\\n\");\n }\n \n+\n+/* Implement TARGET_CANNOT_MODITY_JUMPS_P */\n+\n+static bool\n+avr_cannot_modify_jumps_p (void)\n+{\n+\n+  /* Naked Functions must not have any instructions after\n+     their epilogue, see PR42240 */\n+     \n+  if (reload_completed\n+      && cfun->machine\n+      && cfun->machine->is_naked)\n+    {\n+      return true;\n+    }\n+\n+  return false;\n+}\n+\n+\n /* Return nonzero if X (an RTX) is a legitimate memory address on the target\n    machine for a memory operand of mode MODE.  */\n "}]}