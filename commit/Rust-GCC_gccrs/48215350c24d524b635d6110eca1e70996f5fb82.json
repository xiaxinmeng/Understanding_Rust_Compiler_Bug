{"sha": "48215350c24d524b635d6110eca1e70996f5fb82", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDgyMTUzNTBjMjRkNTI0YjYzNWQ2MTEwZWNhMWU3MDk5NmY1ZmI4Mg==", "commit": {"author": {"name": "Dave Korn", "email": "davek@gcc.gnu.org", "date": "2010-11-03T09:14:32Z"}, "committer": {"name": "Dave Korn", "email": "davek@gcc.gnu.org", "date": "2010-11-03T09:14:32Z"}, "message": "re PR lto/46273 (Failed to bootstrap)\n\nChangeLog:\n\n2010-11-03  Ian Lance Taylor  <iant@google.com>\n\t    Dave Korn  <dave.korn.cygwin@gmail.com>\n\n\tPR lto/46273\n\t* configure.ac: Remove libelf tests.  Build lto-plugin on ELF always\n\tand on other supported platforms whenever LTO is enabled.\n\t* configure: Rebuild.\n\ngcc/ChangeLog:\n\n2010-11-03  Ian Lance Taylor  <iant@google.com>\n\n\tPR lto/46273\n\t* gcc/config.gcc: Don't set lto_binary_reader.\n\t* doc/install.texi (Prerequisites): Remove libelf paragraphs.\n\t(Configuration): Mention --disable-lto.  Remove --with-libelf\n\tparagraph.\n\nlto-plugin/ChangeLog:\n\n2010-11-03  Dave Korn  <dave.korn.cygwin@gmail.com>\n\n\tPR lto/46273\n\t* lto-plugin.h: Delete.\n\t* lto-plugin-elf.c: Likewise.\n\t* lto-plugin-coff.c: Likewise.\n\t* configure.ac: Don't use libelf, don't source config.gcc.\n\t(LIBELFLIBS): Delete.\n\t(LIBELFINC): Delete.\n\t(LTO_FORMAT): Delete.\n\t(SYM_STYLE): Add AC_DEFINE var, set based on $target.\n\t(config.h): Add AC_CONFIG_HEADERS directive.\n\t* Makefile.am (LIBELFLIBS): Delete.\n\t(LIBELFINC): Delete.\n\t(LTO_FORMAT): Delete.\n\t(DEFS): Import.\n\t(AM_CPPFLAGS): Use it.  Don't use LIBELFINC.\n\t(liblto_plugin_la_SOURCES): Don't use LTO_FORMAT, don't include\n\tany object-format-specific source file in the link.\n\t(liblto_plugin_la_LIBADD): Don't use LIBELFLIBS.\n\t* config.h.in: Generate.\n\t* configure: Regenerate.\n\t* Makefile.in: Likewise.\n\t* lto-plugin.c (O_BINARY): Definition moved here from lto-plugin.h.\n\t(LTO_SEGMENT_NAME): New definition.\n\t(LTO_SECTION_PREFIX): Definition moved here from lto-plugin.h.\n\t(LTO_SECTION_PREFIX_LEN): New definition.\n\t(struct sym_aux): Struct definition moved here from lto-plugin.h.\n\t(struct plugin_symtab): Likewise.\n\t(struct plugin_objfile): Likewise.\n\t(struct plugin_objfile): New struct def.\n\t(enum symbol_style): New enum type.\n\t(add_symbols): Make static.\n\t(claimed_files): Likewise.\n\t(num_claimed_files): Likewise.\n\t(sym_style): New global.\n\t(check): Make static.\n\t(parse_table_entry): Likewise.  Respect sym_style when extracting\n\tsymbol from symtab entry.\n\t(translate): Make static.\n\t(resolve_conflicts): Likewise.\n\t(process_symtab): New function, per-section callback version of\n\told object-format-specific handling from deleted lto-plugin-elf.c.\n\t(claim_file_handler): Convert ELF-specific version from deleted\n\tlto-plugin-elf.c to simple_object interface and move here.\n\t(process_options): Allow new '-sym-style=' option.\n\t(onload): Don't call deleted onload_format_checks hook.\n\nFrom-SVN: r166233", "tree": {"sha": "727195368f3f7531be4fdf5a82d599ea20456d83", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/727195368f3f7531be4fdf5a82d599ea20456d83"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/48215350c24d524b635d6110eca1e70996f5fb82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48215350c24d524b635d6110eca1e70996f5fb82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48215350c24d524b635d6110eca1e70996f5fb82", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48215350c24d524b635d6110eca1e70996f5fb82/comments", "author": null, "committer": null, "parents": [{"sha": "03f43d3d3c6909ead8325e86a947f66ba8b83141", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03f43d3d3c6909ead8325e86a947f66ba8b83141", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03f43d3d3c6909ead8325e86a947f66ba8b83141"}], "stats": {"total": 2122, "additions": 655, "deletions": 1467}, "files": [{"sha": "7e4760a41da8c74f4994765fb0f4c9097d62d009", "filename": "ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -1,3 +1,11 @@\n+2010-11-03  Ian Lance Taylor  <iant@google.com>\n+\t    Dave Korn  <dave.korn.cygwin@gmail.com>\n+\n+\tPR lto/46273\n+\t* configure.ac: Remove libelf tests.  Build lto-plugin on ELF always\n+\tand on other supported platforms whenever LTO is enabled.\n+\t* configure: Rebuild.\n+\n 2010-11-02  Alan Modra  <amodra@gmail.com>\n \n \tPR binutils/12110"}, {"sha": "f3bfee20897b3426be0abdc6ebb4027be733532f", "filename": "configure", "status": "modified", "additions": 6, "deletions": 896, "changes": 902, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -553,42 +553,6 @@ PACKAGE_URL=\n \n ac_unique_file=\"move-if-change\"\n enable_option_checking=no\n-# Factoring default headers for most tests.\n-ac_includes_default=\"\\\n-#include <stdio.h>\n-#ifdef HAVE_SYS_TYPES_H\n-# include <sys/types.h>\n-#endif\n-#ifdef HAVE_SYS_STAT_H\n-# include <sys/stat.h>\n-#endif\n-#ifdef STDC_HEADERS\n-# include <stdlib.h>\n-# include <stddef.h>\n-#else\n-# ifdef HAVE_STDLIB_H\n-#  include <stdlib.h>\n-# endif\n-#endif\n-#ifdef HAVE_STRING_H\n-# if !defined STDC_HEADERS && defined HAVE_MEMORY_H\n-#  include <memory.h>\n-# endif\n-# include <string.h>\n-#endif\n-#ifdef HAVE_STRINGS_H\n-# include <strings.h>\n-#endif\n-#ifdef HAVE_INTTYPES_H\n-# include <inttypes.h>\n-#endif\n-#ifdef HAVE_STDINT_H\n-# include <stdint.h>\n-#endif\n-#ifdef HAVE_UNISTD_H\n-# include <unistd.h>\n-#endif\"\n-\n ac_subst_vars='LTLIBOBJS\n LIBOBJS\n compare_exclusions\n@@ -675,11 +639,6 @@ DEBUG_PREFIX_CFLAGS_FOR_TARGET\n SYSROOT_CFLAGS_FOR_TARGET\n stage1_languages\n extra_host_libiberty_configure_flags\n-libelfinc\n-libelflibs\n-EGREP\n-GREP\n-CPP\n clooginc\n clooglibs\n pplinc\n@@ -808,9 +767,6 @@ with_cloog_include\n with_cloog_lib\n enable_cloog_version_check\n enable_lto\n-with_libelf\n-with_libelf_include\n-with_libelf_lib\n enable_stage1_languages\n enable_objc_gc\n with_build_sysroot\n@@ -834,7 +790,6 @@ CPPFLAGS\n CXX\n CXXFLAGS\n CCC\n-CPP\n build_configargs\n host_configargs\n target_configargs\n@@ -1552,11 +1507,6 @@ Optional Packages:\n                           plus --with-cloog-lib=PATH/lib\n   --with-cloog-include=PATH Specify directory for installed CLooG include files\n   --with-cloog-lib=PATH   Specify the directory for the installed CLooG library\n-  --with-libelf=PATH       Specify prefix directory for the installed libelf package\n-                          Equivalent to --with-libelf-include=PATH/include\n-                          plus --with-libelf-lib=PATH/lib\n-  --with-libelf-include=PATH Specify directory for installed libelf include files\n-  --with-libelf-lib=PATH   Specify the directory for the installed libelf library\n   --with-build-sysroot=SYSROOT\n                           use sysroot as the system root during the build\n   --with-debug-prefix-map='A=B C=D ...'\n@@ -1576,7 +1526,6 @@ Some influential environment variables:\n               you have headers in a nonstandard directory <include dir>\n   CXX         C++ compiler command\n   CXXFLAGS    C++ compiler flags\n-  CPP         C preprocessor\n   build_configargs\n               additional configure arguments for build directories\n   host_configargs\n@@ -1829,203 +1778,6 @@ fi\n   return $ac_retval\n \n } # ac_fn_c_try_link\n-\n-# ac_fn_c_try_cpp LINENO\n-# ----------------------\n-# Try to preprocess conftest.$ac_ext, and return whether this succeeded.\n-ac_fn_c_try_cpp ()\n-{\n-  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n-  if { { ac_try=\"$ac_cpp conftest.$ac_ext\"\n-case \"(($ac_try\" in\n-  *\\\"* | *\\`* | *\\\\*) ac_try_echo=\\$ac_try;;\n-  *) ac_try_echo=$ac_try;;\n-esac\n-eval ac_try_echo=\"\\\"\\$as_me:${as_lineno-$LINENO}: $ac_try_echo\\\"\"\n-$as_echo \"$ac_try_echo\"; } >&5\n-  (eval \"$ac_cpp conftest.$ac_ext\") 2>conftest.err\n-  ac_status=$?\n-  if test -s conftest.err; then\n-    grep -v '^ *+' conftest.err >conftest.er1\n-    cat conftest.er1 >&5\n-    mv -f conftest.er1 conftest.err\n-  fi\n-  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n-  test $ac_status = 0; } >/dev/null && {\n-\t test -z \"$ac_c_preproc_warn_flag$ac_c_werror_flag\" ||\n-\t test ! -s conftest.err\n-       }; then :\n-  ac_retval=0\n-else\n-  $as_echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-    ac_retval=1\n-fi\n-  eval $as_lineno_stack; test \"x$as_lineno_stack\" = x && { as_lineno=; unset as_lineno;}\n-  return $ac_retval\n-\n-} # ac_fn_c_try_cpp\n-\n-# ac_fn_c_check_header_mongrel LINENO HEADER VAR INCLUDES\n-# -------------------------------------------------------\n-# Tests whether HEADER exists, giving a warning if it cannot be compiled using\n-# the include files in INCLUDES and setting the cache variable VAR\n-# accordingly.\n-ac_fn_c_check_header_mongrel ()\n-{\n-  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n-  if { as_var=$3; eval \"test \\\"\\${$as_var+set}\\\" = set\"; }; then :\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $2\" >&5\n-$as_echo_n \"checking for $2... \" >&6; }\n-if { as_var=$3; eval \"test \\\"\\${$as_var+set}\\\" = set\"; }; then :\n-  $as_echo_n \"(cached) \" >&6\n-fi\n-eval ac_res=\\$$3\n-\t       { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_res\" >&5\n-$as_echo \"$ac_res\" >&6; }\n-else\n-  # Is the header compilable?\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking $2 usability\" >&5\n-$as_echo_n \"checking $2 usability... \" >&6; }\n-cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-$4\n-#include <$2>\n-_ACEOF\n-if ac_fn_c_try_compile \"$LINENO\"; then :\n-  ac_header_compiler=yes\n-else\n-  ac_header_compiler=no\n-fi\n-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_header_compiler\" >&5\n-$as_echo \"$ac_header_compiler\" >&6; }\n-\n-# Is the header present?\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking $2 presence\" >&5\n-$as_echo_n \"checking $2 presence... \" >&6; }\n-cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <$2>\n-_ACEOF\n-if ac_fn_c_try_cpp \"$LINENO\"; then :\n-  ac_header_preproc=yes\n-else\n-  ac_header_preproc=no\n-fi\n-rm -f conftest.err conftest.$ac_ext\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_header_preproc\" >&5\n-$as_echo \"$ac_header_preproc\" >&6; }\n-\n-# So?  What about this header?\n-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in #((\n-  yes:no: )\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: accepted by the compiler, rejected by the preprocessor!\" >&5\n-$as_echo \"$as_me: WARNING: $2: accepted by the compiler, rejected by the preprocessor!\" >&2;}\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result\" >&5\n-$as_echo \"$as_me: WARNING: $2: proceeding with the compiler's result\" >&2;}\n-    ;;\n-  no:yes:* )\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: present but cannot be compiled\" >&5\n-$as_echo \"$as_me: WARNING: $2: present but cannot be compiled\" >&2;}\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2:     check for missing prerequisite headers?\" >&5\n-$as_echo \"$as_me: WARNING: $2:     check for missing prerequisite headers?\" >&2;}\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: see the Autoconf documentation\" >&5\n-$as_echo \"$as_me: WARNING: $2: see the Autoconf documentation\" >&2;}\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2:     section \\\"Present But Cannot Be Compiled\\\"\" >&5\n-$as_echo \"$as_me: WARNING: $2:     section \\\"Present But Cannot Be Compiled\\\"\" >&2;}\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: $2: proceeding with the compiler's result\" >&5\n-$as_echo \"$as_me: WARNING: $2: proceeding with the compiler's result\" >&2;}\n-    ;;\n-esac\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $2\" >&5\n-$as_echo_n \"checking for $2... \" >&6; }\n-if { as_var=$3; eval \"test \\\"\\${$as_var+set}\\\" = set\"; }; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-  eval \"$3=\\$ac_header_compiler\"\n-fi\n-eval ac_res=\\$$3\n-\t       { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_res\" >&5\n-$as_echo \"$ac_res\" >&6; }\n-fi\n-  eval $as_lineno_stack; test \"x$as_lineno_stack\" = x && { as_lineno=; unset as_lineno;}\n-\n-} # ac_fn_c_check_header_mongrel\n-\n-# ac_fn_c_try_run LINENO\n-# ----------------------\n-# Try to link conftest.$ac_ext, and return whether this succeeded. Assumes\n-# that executables *can* be run.\n-ac_fn_c_try_run ()\n-{\n-  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n-  if { { ac_try=\"$ac_link\"\n-case \"(($ac_try\" in\n-  *\\\"* | *\\`* | *\\\\*) ac_try_echo=\\$ac_try;;\n-  *) ac_try_echo=$ac_try;;\n-esac\n-eval ac_try_echo=\"\\\"\\$as_me:${as_lineno-$LINENO}: $ac_try_echo\\\"\"\n-$as_echo \"$ac_try_echo\"; } >&5\n-  (eval \"$ac_link\") 2>&5\n-  ac_status=$?\n-  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n-  test $ac_status = 0; } && { ac_try='./conftest$ac_exeext'\n-  { { case \"(($ac_try\" in\n-  *\\\"* | *\\`* | *\\\\*) ac_try_echo=\\$ac_try;;\n-  *) ac_try_echo=$ac_try;;\n-esac\n-eval ac_try_echo=\"\\\"\\$as_me:${as_lineno-$LINENO}: $ac_try_echo\\\"\"\n-$as_echo \"$ac_try_echo\"; } >&5\n-  (eval \"$ac_try\") 2>&5\n-  ac_status=$?\n-  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n-  test $ac_status = 0; }; }; then :\n-  ac_retval=0\n-else\n-  $as_echo \"$as_me: program exited with status $ac_status\" >&5\n-       $as_echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-       ac_retval=$ac_status\n-fi\n-  rm -rf conftest.dSYM conftest_ipa8_conftest.oo\n-  eval $as_lineno_stack; test \"x$as_lineno_stack\" = x && { as_lineno=; unset as_lineno;}\n-  return $ac_retval\n-\n-} # ac_fn_c_try_run\n-\n-# ac_fn_c_check_header_compile LINENO HEADER VAR INCLUDES\n-# -------------------------------------------------------\n-# Tests whether HEADER exists and can be compiled using the include files in\n-# INCLUDES, setting the cache variable VAR accordingly.\n-ac_fn_c_check_header_compile ()\n-{\n-  as_lineno=${as_lineno-\"$1\"} as_lineno_stack=as_lineno_stack=$as_lineno_stack\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $2\" >&5\n-$as_echo_n \"checking for $2... \" >&6; }\n-if { as_var=$3; eval \"test \\\"\\${$as_var+set}\\\" = set\"; }; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-$4\n-#include <$2>\n-_ACEOF\n-if ac_fn_c_try_compile \"$LINENO\"; then :\n-  eval \"$3=yes\"\n-else\n-  eval \"$3=no\"\n-fi\n-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n-fi\n-eval ac_res=\\$$3\n-\t       { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_res\" >&5\n-$as_echo \"$ac_res\" >&6; }\n-  eval $as_lineno_stack; test \"x$as_lineno_stack\" = x && { as_lineno=; unset as_lineno;}\n-\n-} # ac_fn_c_check_header_compile\n cat >config.log <<_ACEOF\n This file contains any messages produced by compilers while\n running configure, to aid debugging if configure makes a mistake.\n@@ -6023,405 +5775,6 @@ fi\n \n \n \n-ac_ext=c\n-ac_cpp='$CPP $CPPFLAGS'\n-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_c_compiler_gnu\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking how to run the C preprocessor\" >&5\n-$as_echo_n \"checking how to run the C preprocessor... \" >&6; }\n-# On Suns, sometimes $CPP names a directory.\n-if test -n \"$CPP\" && test -d \"$CPP\"; then\n-  CPP=\n-fi\n-if test -z \"$CPP\"; then\n-  if test \"${ac_cv_prog_CPP+set}\" = set; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-      # Double quotes because CPP needs to be expanded\n-    for CPP in \"$CC -E\" \"$CC -E -traditional-cpp\" \"/lib/cpp\"\n-    do\n-      ac_preproc_ok=false\n-for ac_c_preproc_warn_flag in '' yes\n-do\n-  # Use a header file that comes with gcc, so configuring glibc\n-  # with a fresh cross-compiler works.\n-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since\n-  # <limits.h> exists even on freestanding compilers.\n-  # On the NeXT, cc -E runs the code through the compiler's parser,\n-  # not just through cpp. \"Syntax error\" is here to catch this case.\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#ifdef __STDC__\n-# include <limits.h>\n-#else\n-# include <assert.h>\n-#endif\n-\t\t     Syntax error\n-_ACEOF\n-if ac_fn_c_try_cpp \"$LINENO\"; then :\n-\n-else\n-  # Broken: fails on valid input.\n-continue\n-fi\n-rm -f conftest.err conftest.$ac_ext\n-\n-  # OK, works on sane cases.  Now check whether nonexistent headers\n-  # can be detected and how.\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <ac_nonexistent.h>\n-_ACEOF\n-if ac_fn_c_try_cpp \"$LINENO\"; then :\n-  # Broken: success on invalid input.\n-continue\n-else\n-  # Passes both tests.\n-ac_preproc_ok=:\n-break\n-fi\n-rm -f conftest.err conftest.$ac_ext\n-\n-done\n-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.\n-rm -f conftest.err conftest.$ac_ext\n-if $ac_preproc_ok; then :\n-  break\n-fi\n-\n-    done\n-    ac_cv_prog_CPP=$CPP\n-\n-fi\n-  CPP=$ac_cv_prog_CPP\n-else\n-  ac_cv_prog_CPP=$CPP\n-fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $CPP\" >&5\n-$as_echo \"$CPP\" >&6; }\n-ac_preproc_ok=false\n-for ac_c_preproc_warn_flag in '' yes\n-do\n-  # Use a header file that comes with gcc, so configuring glibc\n-  # with a fresh cross-compiler works.\n-  # Prefer <limits.h> to <assert.h> if __STDC__ is defined, since\n-  # <limits.h> exists even on freestanding compilers.\n-  # On the NeXT, cc -E runs the code through the compiler's parser,\n-  # not just through cpp. \"Syntax error\" is here to catch this case.\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#ifdef __STDC__\n-# include <limits.h>\n-#else\n-# include <assert.h>\n-#endif\n-\t\t     Syntax error\n-_ACEOF\n-if ac_fn_c_try_cpp \"$LINENO\"; then :\n-\n-else\n-  # Broken: fails on valid input.\n-continue\n-fi\n-rm -f conftest.err conftest.$ac_ext\n-\n-  # OK, works on sane cases.  Now check whether nonexistent headers\n-  # can be detected and how.\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <ac_nonexistent.h>\n-_ACEOF\n-if ac_fn_c_try_cpp \"$LINENO\"; then :\n-  # Broken: success on invalid input.\n-continue\n-else\n-  # Passes both tests.\n-ac_preproc_ok=:\n-break\n-fi\n-rm -f conftest.err conftest.$ac_ext\n-\n-done\n-# Because of `break', _AC_PREPROC_IFELSE's cleaning code was skipped.\n-rm -f conftest.err conftest.$ac_ext\n-if $ac_preproc_ok; then :\n-\n-else\n-  { { $as_echo \"$as_me:${as_lineno-$LINENO}: error: in \\`$ac_pwd':\" >&5\n-$as_echo \"$as_me: error: in \\`$ac_pwd':\" >&2;}\n-as_fn_error \"C preprocessor \\\"$CPP\\\" fails sanity check\n-See \\`config.log' for more details.\" \"$LINENO\" 5; }\n-fi\n-\n-ac_ext=c\n-ac_cpp='$CPP $CPPFLAGS'\n-ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n-ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n-ac_compiler_gnu=$ac_cv_c_compiler_gnu\n-\n-\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for grep that handles long lines and -e\" >&5\n-$as_echo_n \"checking for grep that handles long lines and -e... \" >&6; }\n-if test \"${ac_cv_path_GREP+set}\" = set; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-  if test -z \"$GREP\"; then\n-  ac_path_GREP_found=false\n-  # Loop through the user's path and test for each of PROGNAME-LIST\n-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin\n-do\n-  IFS=$as_save_IFS\n-  test -z \"$as_dir\" && as_dir=.\n-    for ac_prog in grep ggrep; do\n-    for ac_exec_ext in '' $ac_executable_extensions; do\n-      ac_path_GREP=\"$as_dir/$ac_prog$ac_exec_ext\"\n-      { test -f \"$ac_path_GREP\" && $as_test_x \"$ac_path_GREP\"; } || continue\n-# Check for GNU ac_path_GREP and select it if it is found.\n-  # Check for GNU $ac_path_GREP\n-case `\"$ac_path_GREP\" --version 2>&1` in\n-*GNU*)\n-  ac_cv_path_GREP=\"$ac_path_GREP\" ac_path_GREP_found=:;;\n-*)\n-  ac_count=0\n-  $as_echo_n 0123456789 >\"conftest.in\"\n-  while :\n-  do\n-    cat \"conftest.in\" \"conftest.in\" >\"conftest.tmp\"\n-    mv \"conftest.tmp\" \"conftest.in\"\n-    cp \"conftest.in\" \"conftest.nl\"\n-    $as_echo 'GREP' >> \"conftest.nl\"\n-    \"$ac_path_GREP\" -e 'GREP$' -e '-(cannot match)-' < \"conftest.nl\" >\"conftest.out\" 2>/dev/null || break\n-    diff \"conftest.out\" \"conftest.nl\" >/dev/null 2>&1 || break\n-    as_fn_arith $ac_count + 1 && ac_count=$as_val\n-    if test $ac_count -gt ${ac_path_GREP_max-0}; then\n-      # Best one so far, save it but keep looking for a better one\n-      ac_cv_path_GREP=\"$ac_path_GREP\"\n-      ac_path_GREP_max=$ac_count\n-    fi\n-    # 10*(2^10) chars as input seems more than enough\n-    test $ac_count -gt 10 && break\n-  done\n-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;\n-esac\n-\n-      $ac_path_GREP_found && break 3\n-    done\n-  done\n-  done\n-IFS=$as_save_IFS\n-  if test -z \"$ac_cv_path_GREP\"; then\n-    as_fn_error \"no acceptable grep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin\" \"$LINENO\" 5\n-  fi\n-else\n-  ac_cv_path_GREP=$GREP\n-fi\n-\n-fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_GREP\" >&5\n-$as_echo \"$ac_cv_path_GREP\" >&6; }\n- GREP=\"$ac_cv_path_GREP\"\n-\n-\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for egrep\" >&5\n-$as_echo_n \"checking for egrep... \" >&6; }\n-if test \"${ac_cv_path_EGREP+set}\" = set; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-  if echo a | $GREP -E '(a|b)' >/dev/null 2>&1\n-   then ac_cv_path_EGREP=\"$GREP -E\"\n-   else\n-     if test -z \"$EGREP\"; then\n-  ac_path_EGREP_found=false\n-  # Loop through the user's path and test for each of PROGNAME-LIST\n-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n-for as_dir in $PATH$PATH_SEPARATOR/usr/xpg4/bin\n-do\n-  IFS=$as_save_IFS\n-  test -z \"$as_dir\" && as_dir=.\n-    for ac_prog in egrep; do\n-    for ac_exec_ext in '' $ac_executable_extensions; do\n-      ac_path_EGREP=\"$as_dir/$ac_prog$ac_exec_ext\"\n-      { test -f \"$ac_path_EGREP\" && $as_test_x \"$ac_path_EGREP\"; } || continue\n-# Check for GNU ac_path_EGREP and select it if it is found.\n-  # Check for GNU $ac_path_EGREP\n-case `\"$ac_path_EGREP\" --version 2>&1` in\n-*GNU*)\n-  ac_cv_path_EGREP=\"$ac_path_EGREP\" ac_path_EGREP_found=:;;\n-*)\n-  ac_count=0\n-  $as_echo_n 0123456789 >\"conftest.in\"\n-  while :\n-  do\n-    cat \"conftest.in\" \"conftest.in\" >\"conftest.tmp\"\n-    mv \"conftest.tmp\" \"conftest.in\"\n-    cp \"conftest.in\" \"conftest.nl\"\n-    $as_echo 'EGREP' >> \"conftest.nl\"\n-    \"$ac_path_EGREP\" 'EGREP$' < \"conftest.nl\" >\"conftest.out\" 2>/dev/null || break\n-    diff \"conftest.out\" \"conftest.nl\" >/dev/null 2>&1 || break\n-    as_fn_arith $ac_count + 1 && ac_count=$as_val\n-    if test $ac_count -gt ${ac_path_EGREP_max-0}; then\n-      # Best one so far, save it but keep looking for a better one\n-      ac_cv_path_EGREP=\"$ac_path_EGREP\"\n-      ac_path_EGREP_max=$ac_count\n-    fi\n-    # 10*(2^10) chars as input seems more than enough\n-    test $ac_count -gt 10 && break\n-  done\n-  rm -f conftest.in conftest.tmp conftest.nl conftest.out;;\n-esac\n-\n-      $ac_path_EGREP_found && break 3\n-    done\n-  done\n-  done\n-IFS=$as_save_IFS\n-  if test -z \"$ac_cv_path_EGREP\"; then\n-    as_fn_error \"no acceptable egrep could be found in $PATH$PATH_SEPARATOR/usr/xpg4/bin\" \"$LINENO\" 5\n-  fi\n-else\n-  ac_cv_path_EGREP=$EGREP\n-fi\n-\n-   fi\n-fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_path_EGREP\" >&5\n-$as_echo \"$ac_cv_path_EGREP\" >&6; }\n- EGREP=\"$ac_cv_path_EGREP\"\n-\n-\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for ANSI C header files\" >&5\n-$as_echo_n \"checking for ANSI C header files... \" >&6; }\n-if test \"${ac_cv_header_stdc+set}\" = set; then :\n-  $as_echo_n \"(cached) \" >&6\n-else\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <stdlib.h>\n-#include <stdarg.h>\n-#include <string.h>\n-#include <float.h>\n-\n-int\n-main ()\n-{\n-\n-  ;\n-  return 0;\n-}\n-_ACEOF\n-if ac_fn_c_try_compile \"$LINENO\"; then :\n-  ac_cv_header_stdc=yes\n-else\n-  ac_cv_header_stdc=no\n-fi\n-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n-\n-if test $ac_cv_header_stdc = yes; then\n-  # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <string.h>\n-\n-_ACEOF\n-if (eval \"$ac_cpp conftest.$ac_ext\") 2>&5 |\n-  $EGREP \"memchr\" >/dev/null 2>&1; then :\n-\n-else\n-  ac_cv_header_stdc=no\n-fi\n-rm -f conftest*\n-\n-fi\n-\n-if test $ac_cv_header_stdc = yes; then\n-  # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <stdlib.h>\n-\n-_ACEOF\n-if (eval \"$ac_cpp conftest.$ac_ext\") 2>&5 |\n-  $EGREP \"free\" >/dev/null 2>&1; then :\n-\n-else\n-  ac_cv_header_stdc=no\n-fi\n-rm -f conftest*\n-\n-fi\n-\n-if test $ac_cv_header_stdc = yes; then\n-  # /bin/cc in Irix-4.0.5 gets non-ANSI ctype macros unless using -ansi.\n-  if test \"$cross_compiling\" = yes; then :\n-  :\n-else\n-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <ctype.h>\n-#include <stdlib.h>\n-#if ((' ' & 0x0FF) == 0x020)\n-# define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n-# define TOUPPER(c) (ISLOWER(c) ? 'A' + ((c) - 'a') : (c))\n-#else\n-# define ISLOWER(c) \\\n-\t\t   (('a' <= (c) && (c) <= 'i') \\\n-\t\t     || ('j' <= (c) && (c) <= 'r') \\\n-\t\t     || ('s' <= (c) && (c) <= 'z'))\n-# define TOUPPER(c) (ISLOWER(c) ? ((c) | 0x40) : (c))\n-#endif\n-\n-#define XOR(e, f) (((e) && !(f)) || (!(e) && (f)))\n-int\n-main ()\n-{\n-  int i;\n-  for (i = 0; i < 256; i++)\n-    if (XOR (islower (i), ISLOWER (i))\n-\t|| toupper (i) != TOUPPER (i))\n-      return 2;\n-  return 0;\n-}\n-_ACEOF\n-if ac_fn_c_try_run \"$LINENO\"; then :\n-\n-else\n-  ac_cv_header_stdc=no\n-fi\n-rm -f core *.core core.conftest.* gmon.out bb.out conftest$ac_exeext \\\n-  conftest.$ac_objext conftest.beam conftest.$ac_ext\n-fi\n-\n-fi\n-fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_header_stdc\" >&5\n-$as_echo \"$ac_cv_header_stdc\" >&6; }\n-if test $ac_cv_header_stdc = yes; then\n-\n-$as_echo \"#define STDC_HEADERS 1\" >>confdefs.h\n-\n-fi\n-\n-# On IRIX 5.3, sys/types and inttypes.h are conflicting.\n-for ac_header in sys/types.h sys/stat.h stdlib.h string.h memory.h strings.h \\\n-\t\t  inttypes.h stdint.h unistd.h\n-do :\n-  as_ac_Header=`$as_echo \"ac_cv_header_$ac_header\" | $as_tr_sh`\n-ac_fn_c_check_header_compile \"$LINENO\" \"$ac_header\" \"$as_ac_Header\" \"$ac_includes_default\n-\"\n-eval as_val=\\$$as_ac_Header\n-   if test \"x$as_val\" = x\"\"yes; then :\n-  cat >>confdefs.h <<_ACEOF\n-#define `$as_echo \"HAVE_$ac_header\" | $as_tr_cpp` 1\n-_ACEOF\n-\n-fi\n-\n-done\n-\n-\n-\n \n \n target_elf=no\n@@ -6437,258 +5790,14 @@ case $target in\n esac\n \n if test $target_elf = yes; then :\n-  if test x\"$enable_lto\" = x\"yes\" ; then\n-  # Make sure that libelf.h and gelf.h are available.\n-\n-# Check whether --with-libelf was given.\n-if test \"${with_libelf+set}\" = set; then :\n-  withval=$with_libelf;\n-fi\n-\n-\n-\n-# Check whether --with-libelf_include was given.\n-if test \"${with_libelf_include+set}\" = set; then :\n-  withval=$with_libelf_include;\n-fi\n-\n-\n+  # ELF platforms build the lto-plugin always.\n+  build_lto_plugin=yes\n \n-# Check whether --with-libelf_lib was given.\n-if test \"${with_libelf_lib+set}\" = set; then :\n-  withval=$with_libelf_lib;\n-fi\n-\n-\n-  saved_CFLAGS=\"$CFLAGS\"\n-  saved_CPPFLAGS=\"$CPPFLAGS\"\n-  saved_LIBS=\"$LIBS\"\n-\n-  case $with_libelf in\n-    \"\")\n-      libelflibs=\"-lelf\"\n-      libelfinc=\"-I/usr/include/libelf\"\n-      ;;\n-    *)\n-      libelflibs=\"-L$with_libelf/lib -lelf\"\n-      libelfinc=\"-I$with_libelf/include -I$with_libelf/include/libelf\"\n-      LIBS=\"$libelflibs $LIBS\"\n-      ;;\n-  esac\n-\n-  if test \"x$with_libelf_include\" != x; then\n-    libelfinc=\"-I$with_libelf_include\"\n-  fi\n-\n-  if test \"x$with_libelf_lib\" != x; then\n-    libelflibs=\"-L$with_libelf_lib -lelf\"\n-    LIBS=\"$libelflibs $LIBS\"\n-  fi\n-\n-  if test \"x$with_libelf$with_libelf_include$with_libelf_lib\" = x \\\n-     && test -d ${srcdir}/libelf; then\n-    libelflibs='-L$$r/$(HOST_SUBDIR)/libelf/lib -lelf '\n-    libelfinc='-D__LIBELF_INTERNAL__ -I$$r/$(HOST_SUBDIR)/libelf/lib -I$$s/libelf/lib'\n-    LIBS=\"$libelflibs $LIBS\"\n-\n- else\n-\n-  CFLAGS=\"$CFLAGS $libelfinc\"\n-  CPPFLAGS=\"$CPPFLAGS $libelfinc\"\n-  LIBS=\"$LIBS $libelflibs\"\n-\n-  for ac_header in libelf.h\n-do :\n-  ac_fn_c_check_header_mongrel \"$LINENO\" \"libelf.h\" \"ac_cv_header_libelf_h\" \"$ac_includes_default\"\n-if test \"x$ac_cv_header_libelf_h\" = x\"\"yes; then :\n-  cat >>confdefs.h <<_ACEOF\n-#define HAVE_LIBELF_H 1\n-_ACEOF\n- have_libelf_h=yes\n-fi\n-\n-done\n-\n-  for ac_header in gelf.h\n-do :\n-  ac_fn_c_check_header_mongrel \"$LINENO\" \"gelf.h\" \"ac_cv_header_gelf_h\" \"$ac_includes_default\"\n-if test \"x$ac_cv_header_gelf_h\" = x\"\"yes; then :\n-  cat >>confdefs.h <<_ACEOF\n-#define HAVE_GELF_H 1\n-_ACEOF\n- have_gelf_h=yes\n-fi\n-\n-done\n-\n-\n-  for ac_header in libelf/libelf.h\n-do :\n-  ac_fn_c_check_header_mongrel \"$LINENO\" \"libelf/libelf.h\" \"ac_cv_header_libelf_libelf_h\" \"$ac_includes_default\"\n-if test \"x$ac_cv_header_libelf_libelf_h\" = x\"\"yes; then :\n-  cat >>confdefs.h <<_ACEOF\n-#define HAVE_LIBELF_LIBELF_H 1\n-_ACEOF\n- have_libelf_libelf_h=yes\n-fi\n-\n-done\n-\n-  for ac_header in libelf/gelf.h\n-do :\n-  ac_fn_c_check_header_mongrel \"$LINENO\" \"libelf/gelf.h\" \"ac_cv_header_libelf_gelf_h\" \"$ac_includes_default\"\n-if test \"x$ac_cv_header_libelf_gelf_h\" = x\"\"yes; then :\n-  cat >>confdefs.h <<_ACEOF\n-#define HAVE_LIBELF_GELF_H 1\n-_ACEOF\n- have_libelf_gelf_h=yes\n-fi\n-\n-done\n-\n-\n-  # If we couldn't find libelf.h and the user forced it, emit an error.\n-  if test x\"$have_libelf_h\" != x\"yes\" \\\n-     && test x\"$have_libelf_libelf_h\" != x\"yes\" ; then\n-    if test x\"$default_enable_lto\" != x\"yes\" ; then\n-      as_fn_error \"LTO support requires libelf.h or libelf/libelf.h.\" \"$LINENO\" 5\n-    else\n-      enable_lto=no\n-      libelflibs=\n-      libelfinc=\n-    fi\n-  fi\n-\n-  # If we couldn't find gelf.h and the user forced it, emit an error.\n-  if test x\"$have_gelf_h\" != x\"yes\" \\\n-     && test x\"$have_libelf_gelf_h\" != x\"yes\" ; then\n-    if test x\"$default_enable_lto\" != x\"yes\" ; then\n-      as_fn_error \"LTO support requires gelf.h or libelf/gelf.h.\" \"$LINENO\" 5\n-    else\n-      enable_lto=no\n-      libelflibs=\n-      libelfinc=\n-    fi\n-  fi\n-\n-  # Check that the detected libelf has the functions we need.  We cannot\n-  # rely on just detecting the headers since they do not include\n-  # versioning information.  Add functions, if needed.\n-  if test x\"$enable_lto\" = x\"yes\" ; then\n-    { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for the correct version of libelf\" >&5\n-$as_echo_n \"checking for the correct version of libelf... \" >&6; }\n-    cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <libelf.h>\n-int\n-main ()\n-{\n-\n-      elf_errmsg (0);\n-      elf_getscn (0, 0);\n-      elf_nextscn (0, 0);\n-      elf_strptr (0, 0, 0);\n-      elf_getident (0, 0);\n-      elf_begin (0, 0, 0);\n-      elf_ndxscn (0);\n-      elf_end (0);\n-\n-  ;\n-  return 0;\n-}\n-_ACEOF\n-if ac_fn_c_try_link \"$LINENO\"; then :\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\n-$as_echo \"yes\" >&6; };\n-else\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n-$as_echo \"no\" >&6; }; enable_lto=no; libelflibs= ; libelfinc=\n-\n-fi\n-rm -f core conftest.err conftest.$ac_objext \\\n-    conftest$ac_exeext conftest.$ac_ext\n-\n-    # Check for elf_getshdrstrndx or elf_getshstrndx.  The latter's flavor\n-    # is determined in gcc/configure.ac.\n-    if test x\"$enable_lto\" = x\"yes\" ; then\n-      { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for elf_getshdrstrndx\" >&5\n-$as_echo_n \"checking for elf_getshdrstrndx... \" >&6; }\n-      cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <libelf.h>\n-int\n-main ()\n-{\n-\n-\telf_getshdrstrndx (0, 0);\n-\n-  ;\n-  return 0;\n-}\n-_ACEOF\n-if ac_fn_c_try_link \"$LINENO\"; then :\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\n-$as_echo \"yes\" >&6; };\n-else\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n-$as_echo \"no\" >&6; };\n-\t { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for elf_getshstrndx\" >&5\n-$as_echo_n \"checking for elf_getshstrndx... \" >&6; }\n-         cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n-/* end confdefs.h.  */\n-#include <libelf.h>\n-int\n-main ()\n-{\n-\n-\t   elf_getshstrndx (0, 0);\n-\n-  ;\n-  return 0;\n-}\n-_ACEOF\n-if ac_fn_c_try_link \"$LINENO\"; then :\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\n-$as_echo \"yes\" >&6; };\n-else\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n-$as_echo \"no\" >&6; }; enable_lto=no; libelflibs= ; libelfinc=\n-\n-fi\n-rm -f core conftest.err conftest.$ac_objext \\\n-    conftest$ac_exeext conftest.$ac_ext\n-\n-fi\n-rm -f core conftest.err conftest.$ac_objext \\\n-    conftest$ac_exeext conftest.$ac_ext\n-    fi\n-\n-    # If we couldn't enable LTO and the user forced it, emit an error.\n-    if test x\"$enable_lto\" = x\"no\" \\\n-       && test x\"$default_enable_lto\" != x\"yes\" ; then\n-      as_fn_error \"To enable LTO, GCC requires libelf v0.8.12+.\n-Try the --with-libelf, --with-libelf-include and --with-libelf-lib options\n-to specify its location.\" \"$LINENO\" 5\n-    fi\n-  fi\n-\n-  CFLAGS=\"$saved_CFLAGS\"\n-  CPPFLAGS=\"$saved_CPPFLAGS\"\n-  LIBS=\"$saved_LIBS\"\n-\n- fi\n-\n-  # Flags needed for libelf.\n-\n-\n-  # ELF platforms build the lto-plugin when GOLD is in use.\n-  build_lto_plugin=${ENABLE_GOLD}\n-fi\n else\n   if test x\"$default_enable_lto\" = x\"yes\" ; then\n     case $target in\n       *-apple-darwin* | *-cygwin* | *-mingw*) ;;\n-      # On other non-ELF platforms, LTO must be explicitly enabled.\n+      # On other non-ELF platforms, LTO has yet to be validated.\n       *) enable_lto=no ;;\n     esac\n   else\n@@ -6706,11 +5815,12 @@ else\n     esac\n   fi\n   # Among non-ELF, only Windows platforms support the lto-plugin so far.\n+  # Build it unless LTO was explicitly disabled.\n   case $target in\n-    *-cygwin* | *-mingw*) build_lto_plugin=yes ;;\n+    *-cygwin* | *-mingw*) build_lto_plugin=$enable_lto ;;\n     *) ;;\n   esac\n-  default_enable_lto=no\n+\n fi\n \n "}, {"sha": "c0e7384fdb6cb3bf4c13c656ba1cf9534794ca0b", "filename": "configure.ac", "status": "modified", "additions": 7, "deletions": 143, "changes": 150, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/configure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/configure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.ac?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -1656,149 +1656,12 @@ AC_ARG_ENABLE(lto,\n enable_lto=$enableval,\n enable_lto=yes; default_enable_lto=yes)\n \n-\n-ACX_ELF_TARGET_IFELSE([if test x\"$enable_lto\" = x\"yes\" ; then\n-  # Make sure that libelf.h and gelf.h are available.\n-  AC_ARG_WITH(libelf, [  --with-libelf=PATH       Specify prefix directory for the installed libelf package\n-                          Equivalent to --with-libelf-include=PATH/include\n-                          plus --with-libelf-lib=PATH/lib])\n-\n-  AC_ARG_WITH(libelf_include, [  --with-libelf-include=PATH Specify directory for installed libelf include files])\n-\n-  AC_ARG_WITH(libelf_lib, [  --with-libelf-lib=PATH   Specify the directory for the installed libelf library])\n-\n-  saved_CFLAGS=\"$CFLAGS\"\n-  saved_CPPFLAGS=\"$CPPFLAGS\"\n-  saved_LIBS=\"$LIBS\"\n-\n-  case $with_libelf in \n-    \"\")\n-      libelflibs=\"-lelf\"\n-      libelfinc=\"-I/usr/include/libelf\"\n-      ;;\n-    *)\n-      libelflibs=\"-L$with_libelf/lib -lelf\"\n-      libelfinc=\"-I$with_libelf/include -I$with_libelf/include/libelf\"\n-      LIBS=\"$libelflibs $LIBS\"\n-      ;;\n-  esac\n-\n-  if test \"x$with_libelf_include\" != x; then\n-    libelfinc=\"-I$with_libelf_include\"\n-  fi\n-\n-  if test \"x$with_libelf_lib\" != x; then\n-    libelflibs=\"-L$with_libelf_lib -lelf\"\n-    LIBS=\"$libelflibs $LIBS\"\n-  fi\n-\n-  if test \"x$with_libelf$with_libelf_include$with_libelf_lib\" = x \\\n-     && test -d ${srcdir}/libelf; then\n-    libelflibs='-L$$r/$(HOST_SUBDIR)/libelf/lib -lelf '\n-    libelfinc='-D__LIBELF_INTERNAL__ -I$$r/$(HOST_SUBDIR)/libelf/lib -I$$s/libelf/lib'\n-    LIBS=\"$libelflibs $LIBS\"\n-\n- else\n-\n-  CFLAGS=\"$CFLAGS $libelfinc\"\n-  CPPFLAGS=\"$CPPFLAGS $libelfinc\"\n-  LIBS=\"$LIBS $libelflibs\"\n-\n-  AC_CHECK_HEADERS(libelf.h, [have_libelf_h=yes])\n-  AC_CHECK_HEADERS(gelf.h, [have_gelf_h=yes])\n-\n-  AC_CHECK_HEADERS(libelf/libelf.h, [have_libelf_libelf_h=yes])\n-  AC_CHECK_HEADERS(libelf/gelf.h, [have_libelf_gelf_h=yes])\n-\n-  # If we couldn't find libelf.h and the user forced it, emit an error.\n-  if test x\"$have_libelf_h\" != x\"yes\" \\\n-     && test x\"$have_libelf_libelf_h\" != x\"yes\" ; then\n-    if test x\"$default_enable_lto\" != x\"yes\" ; then\n-      AC_MSG_ERROR([LTO support requires libelf.h or libelf/libelf.h.])\n-    else\n-      enable_lto=no\n-      libelflibs=\n-      libelfinc=\n-    fi\n-  fi\n-\n-  # If we couldn't find gelf.h and the user forced it, emit an error.\n-  if test x\"$have_gelf_h\" != x\"yes\" \\\n-     && test x\"$have_libelf_gelf_h\" != x\"yes\" ; then\n-    if test x\"$default_enable_lto\" != x\"yes\" ; then\n-      AC_MSG_ERROR([LTO support requires gelf.h or libelf/gelf.h.])\n-    else\n-      enable_lto=no\n-      libelflibs=\n-      libelfinc=\n-    fi\n-  fi\n-\n-  # Check that the detected libelf has the functions we need.  We cannot\n-  # rely on just detecting the headers since they do not include \n-  # versioning information.  Add functions, if needed.\n-  if test x\"$enable_lto\" = x\"yes\" ; then\n-    AC_MSG_CHECKING([for the correct version of libelf])\n-    AC_TRY_LINK(\n-      [#include <libelf.h>],[\n-      elf_errmsg (0);\n-      elf_getscn (0, 0);\n-      elf_nextscn (0, 0);\n-      elf_strptr (0, 0, 0);\n-      elf_getident (0, 0);\n-      elf_begin (0, 0, 0);\n-      elf_ndxscn (0);\n-      elf_end (0);\n-      ],\n-      [AC_MSG_RESULT([yes]);],\n-      [AC_MSG_RESULT([no]); enable_lto=no; libelflibs= ; libelfinc= ]\n-    )\n-\n-    # Check for elf_getshdrstrndx or elf_getshstrndx.  The latter's flavor\n-    # is determined in gcc/configure.ac.\n-    if test x\"$enable_lto\" = x\"yes\" ; then\n-      AC_MSG_CHECKING([for elf_getshdrstrndx])\n-      AC_TRY_LINK(\n-        [#include <libelf.h>],[\n-\telf_getshdrstrndx (0, 0);\n-        ],\n-        [AC_MSG_RESULT([yes]);],\n-        [AC_MSG_RESULT([no]);\n-\t AC_MSG_CHECKING([for elf_getshstrndx])\n-         AC_TRY_LINK(\n-           [#include <libelf.h>],[\n-\t   elf_getshstrndx (0, 0);\n-           ],\n-           [AC_MSG_RESULT([yes]);],\n-           [AC_MSG_RESULT([no]); enable_lto=no; libelflibs= ; libelfinc= ]\n-         )]\n-      )\n-    fi\n-\n-    # If we couldn't enable LTO and the user forced it, emit an error.\n-    if test x\"$enable_lto\" = x\"no\" \\\n-       && test x\"$default_enable_lto\" != x\"yes\" ; then\n-      AC_MSG_ERROR([To enable LTO, GCC requires libelf v0.8.12+.\n-Try the --with-libelf, --with-libelf-include and --with-libelf-lib options\n-to specify its location.])\n-    fi\n-  fi\n-\n-  CFLAGS=\"$saved_CFLAGS\"\n-  CPPFLAGS=\"$saved_CPPFLAGS\"\n-  LIBS=\"$saved_LIBS\"\n-\n- fi\n-\n-  # Flags needed for libelf.\n-  AC_SUBST(libelflibs)\n-  AC_SUBST(libelfinc)\n-  # ELF platforms build the lto-plugin when GOLD is in use.\n-  build_lto_plugin=${ENABLE_GOLD}\n-fi],[if test x\"$default_enable_lto\" = x\"yes\" ; then\n+ACX_ELF_TARGET_IFELSE([# ELF platforms build the lto-plugin always.\n+  build_lto_plugin=yes\n+],[if test x\"$default_enable_lto\" = x\"yes\" ; then\n     case $target in\n       *-apple-darwin* | *-cygwin* | *-mingw*) ;;\n-      # On other non-ELF platforms, LTO must be explicitly enabled.\n+      # On other non-ELF platforms, LTO has yet to be validated.\n       *) enable_lto=no ;;\n     esac\n   else\n@@ -1816,11 +1679,12 @@ fi],[if test x\"$default_enable_lto\" = x\"yes\" ; then\n     esac\n   fi\n   # Among non-ELF, only Windows platforms support the lto-plugin so far.\n+  # Build it unless LTO was explicitly disabled.\n   case $target in\n-    *-cygwin* | *-mingw*) build_lto_plugin=yes ;;\n+    *-cygwin* | *-mingw*) build_lto_plugin=$enable_lto ;;\n     *) ;;\n   esac\n-  default_enable_lto=no])\n+])\n \n \n # By default, C is the only stage 1 language."}, {"sha": "154ad56f1db9fdbdee6acab165acf0039ae6eafc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -1,3 +1,11 @@\n+2010-11-03  Ian Lance Taylor  <iant@google.com>\n+\n+\tPR lto/46273\n+\t* gcc/config.gcc: Don't set lto_binary_reader.\n+\t* doc/install.texi (Prerequisites): Remove libelf paragraphs.\n+\t(Configuration): Mention --disable-lto.  Remove --with-libelf\n+\tparagraph.\n+\n 2010-11-03  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/46252"}, {"sha": "9b8e0a4291180539ca8378b826256b3ca39b24f4", "filename": "gcc/config.gcc", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -219,8 +219,6 @@ default_gnu_indirect_function=no\n target_gtfiles=\n need_64bit_hwint=\n need_64bit_isa=\n-# Selects the object file format reader/writer used by LTO.\n-lto_binary_reader=lto-elf\n \n # Don't carry these over build->host->target.  Please.\n xm_file=\n@@ -1160,13 +1158,11 @@ i[34567]86-*-darwin*)\n \t# support.\n \twith_cpu=${with_cpu:-generic}\n \ttmake_file=\"${tmake_file} t-slibgcc-darwin i386/t-crtpc i386/t-crtfm\"\n-\tlto_binary_reader=lto-macho\n \t;;\n x86_64-*-darwin*)\n \twith_cpu=${with_cpu:-generic}\n \ttmake_file=\"${tmake_file} ${cpu_type}/t-darwin64 t-slibgcc-darwin i386/t-crtpc i386/t-crtfm\"\n \ttm_file=\"${tm_file} ${cpu_type}/darwin64.h\"\n-\tlto_binary_reader=lto-macho\n \t;;\n i[34567]86-*-elf*)\n \ttm_file=\"${tm_file} i386/unix.h i386/att.h dbxelf.h elfos.h newlib-stdint.h i386/i386elf.h\"\n@@ -1421,7 +1417,6 @@ i[34567]86-*-pe | i[34567]86-*-cygwin*)\n \t\tthread_file='posix'\n \tfi\n \tuse_gcc_stdint=wrap\n-\tlto_binary_reader=lto-coff\n \t;;\n i[34567]86-*-mingw* | x86_64-*-mingw*)\n \ttm_file=\"${tm_file} i386/unix.h i386/bsd.h i386/gas.h dbxcoff.h i386/cygming.h i386/mingw32.h\"\n@@ -1494,7 +1489,6 @@ i[34567]86-*-mingw* | x86_64-*-mingw*)\n \tcxx_target_objs=\"${cxx_target_objs} winnt-cxx.o msformat-c.o\"\n \tdefault_use_cxa_atexit=yes\n \tuse_gcc_stdint=wrap\n-\tlto_binary_reader=lto-coff\n \tcase ${enable_threads} in\n \t  \"\" | yes | win32)\t  thread_file='win32'\n \t  tmake_file=\"${tmake_file} i386/t-gthr-win32\"\n@@ -2006,15 +2000,13 @@ powerpc-*-darwin*)\n \t    ;;\n \tesac\n \ttmake_file=\"${tmake_file} t-slibgcc-darwin\"\n-\tlto_binary_reader=lto-macho\n \textra_headers=altivec.h\n \t;;\n powerpc64-*-darwin*)\n \textra_options=\"${extra_options} ${cpu_type}/darwin.opt\"\n \textra_parts=\"crt2.o\"\n \ttmake_file=\"${tmake_file} ${cpu_type}/t-darwin64 t-slibgcc-darwin\"\n \ttm_file=\"${tm_file} ${cpu_type}/darwin8.h ${cpu_type}/darwin64.h\"\n-\tlto_binary_reader=lto-macho\n \textra_headers=altivec.h\n \t;;\n powerpc*-*-freebsd*)"}, {"sha": "77d36eb243bc9cc4c7681fd2df2e9b8207642022", "filename": "gcc/doc/install.texi", "status": "modified", "additions": 2, "deletions": 24, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/gcc%2Fdoc%2Finstall.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/gcc%2Fdoc%2Finstall.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finstall.texi?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -355,17 +355,6 @@ not installed in your default library search path.\n \n Necessary to build libgcj, the GCJ runtime.\n \n-@item libelf version 0.8.12 (or later)\n-\n-Necessary to build link-time optimization (LTO) support.  It can be\n-downloaded from @uref{http://www.mr511.de/software/libelf-0.8.12.tar.gz},\n-though it is commonly available in several systems.  The version in\n-IRIX 6.5 doesn't work since it lacks @file{gelf.h}.  The version in\n-Solaris 2 does work.\n-\n-The @option{--with-libelf} configure option should be used if libelf is\n-not installed in your default library search patch.\n-\n @end table\n \n @heading Tools/packages necessary for modifying GCC\n@@ -1650,20 +1639,9 @@ default for a native toolchain with an assembler that accepts it and\n GLIBC 2.11 or above, otherwise disabled.\n \n @item --enable-lto\n+@itemx --disable-lto\n Enable support for link-time optimization (LTO).  This is enabled by\n-default if a working libelf implementation is found (see\n-@option{--with-libelf}).\n-\n-@item --with-libelf=@var{pathname}\n-@itemx --with-libelf-include=@var{pathname}\n-@itemx --with-libelf-lib=@var{pathname}\n-If you do not have libelf installed in a standard location and you\n-want to enable support for link-time optimization (LTO), you can\n-explicitly specify the directory where libelf is installed\n-(@samp{--with-libelf=@var{libelfinstalldir}}).  The\n-@option{--with-libelf=@var{libelfinstalldir}} option is shorthand for\n-@option{--with-libelf-include=@var{libelfinstalldir}/include}\n-@option{--with-libelf-lib=@var{libelfinstalldir}/lib}.\n+default, and may be disabled using @option{--disable-lto}.\n \n @item --enable-gold\n Enable support for using @command{gold} as the linker.  If gold support is"}, {"sha": "690970f8524242e8848ff1cd5fd589c4d94d6d58", "filename": "lto-plugin/ChangeLog", "status": "modified", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2FChangeLog?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -1,3 +1,51 @@\n+2010-11-03  Dave Korn  <dave.korn.cygwin@gmail.com>\n+\n+\tPR lto/46273\n+\t* lto-plugin.h: Delete.\n+\t* lto-plugin-elf.c: Likewise.\n+\t* lto-plugin-coff.c: Likewise.\n+\t* configure.ac: Don't use libelf, don't source config.gcc.\n+\t(LIBELFLIBS): Delete.\n+\t(LIBELFINC): Delete.\n+\t(LTO_FORMAT): Delete.\n+\t(SYM_STYLE): Add AC_DEFINE var, set based on $target.\n+\t(config.h): Add AC_CONFIG_HEADERS directive.\n+\t* Makefile.am (LIBELFLIBS): Delete.\n+\t(LIBELFINC): Delete.\n+\t(LTO_FORMAT): Delete.\n+\t(DEFS): Import.\n+\t(AM_CPPFLAGS): Use it.  Don't use LIBELFINC.\n+\t(liblto_plugin_la_SOURCES): Don't use LTO_FORMAT, don't include\n+\tany object-format-specific source file in the link.\n+\t(liblto_plugin_la_LIBADD): Don't use LIBELFLIBS.\n+\t* config.h.in: Generate.\n+\t* configure: Regenerate.\n+\t* Makefile.in: Likewise.\n+\t* lto-plugin.c (O_BINARY): Definition moved here from lto-plugin.h.\n+\t(LTO_SEGMENT_NAME): New definition.\n+\t(LTO_SECTION_PREFIX): Definition moved here from lto-plugin.h.\n+\t(LTO_SECTION_PREFIX_LEN): New definition.\n+\t(struct sym_aux): Struct definition moved here from lto-plugin.h.\n+\t(struct plugin_symtab): Likewise.\n+\t(struct plugin_objfile): Likewise.\n+\t(struct plugin_objfile): New struct def.\n+\t(enum symbol_style): New enum type.\n+\t(add_symbols): Make static.\n+\t(claimed_files): Likewise.\n+\t(num_claimed_files): Likewise.\n+\t(sym_style): New global.\n+\t(check): Make static.\n+\t(parse_table_entry): Likewise.  Respect sym_style when extracting\n+\tsymbol from symtab entry.\n+\t(translate): Make static.\n+\t(resolve_conflicts): Likewise.\n+\t(process_symtab): New function, per-section callback version of\n+\told object-format-specific handling from deleted lto-plugin-elf.c.\n+\t(claim_file_handler): Convert ELF-specific version from deleted\n+\tlto-plugin-elf.c to simple_object interface and move here.\n+\t(process_options): Allow new '-sym-style=' option.\n+\t(onload): Don't call deleted onload_format_checks hook.\n+\n 2010-10-11  Kai Tietz  <kai.tietz@onevision.com>\n \n \t* lto-plugin.c (dump_symtab): Correct printf argument type."}, {"sha": "fb1d6c20f1886ffa9f9c2c11f476feaf3789ecd1", "filename": "lto-plugin/Makefile.am", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2FMakefile.am?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -7,20 +7,13 @@ gcc_version := $(shell cat $(top_srcdir)/../gcc/BASE-VER)\n target_noncanonical := @target_noncanonical@\n libexecsubdir := $(libexecdir)/gcc/$(target_noncanonical)/$(gcc_version)\n \n-# How to find libelf\n-LIBELFLIBS = @LIBELFLIBS@\n-LIBELFINC = @LIBELFINC@\n-\n-# Which object format to parse.\n-LTO_FORMAT = @LTO_FORMAT@\n-\n-AM_CPPFLAGS = -I$(top_srcdir)/../include $(LIBELFINC)\n+AM_CPPFLAGS = -I$(top_srcdir)/../include $(DEFS)\n AM_CFLAGS = -Wall -Werror\n \n libexecsub_LTLIBRARIES = liblto_plugin.la\n \n-liblto_plugin_la_SOURCES = lto-plugin.c lto-plugin-$(LTO_FORMAT).c\n-liblto_plugin_la_LIBADD = $(LIBELFLIBS) \\\n+liblto_plugin_la_SOURCES = lto-plugin.c\n+liblto_plugin_la_LIBADD = \\\n \t$(if $(wildcard ../libiberty/pic/libiberty.a),../libiberty/pic/libiberty.a,)\n liblto_plugin_la_LDFLAGS = -no-undefined -bindir $(libexecsubdir) \\\n \t$(if $(wildcard ../libiberty/pic/libiberty.a),,-Wc,../libiberty/libiberty.a)"}, {"sha": "a35191328334471db345602526483e87e40ba40a", "filename": "lto-plugin/Makefile.in", "status": "modified", "additions": 39, "deletions": 24, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2FMakefile.in?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -36,10 +36,11 @@ PRE_UNINSTALL = :\n POST_UNINSTALL = :\n build_triplet = @build@\n host_triplet = @host@\n+target_triplet = @target@\n subdir = .\n DIST_COMMON = ChangeLog $(srcdir)/Makefile.in $(srcdir)/Makefile.am \\\n \t$(top_srcdir)/configure $(am__configure_deps) \\\n-\t$(srcdir)/../mkinstalldirs\n+\t$(srcdir)/config.h.in $(srcdir)/../mkinstalldirs\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n \t$(top_srcdir)/../config/depstand.m4 \\\n@@ -53,6 +54,7 @@ am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \\\n  configure.lineno config.status.lineno\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs\n+CONFIG_HEADER = config.h\n CONFIG_CLEAN_FILES =\n CONFIG_CLEAN_VPATH_FILES =\n am__vpath_adj_setup = srcdirstrip=`echo \"$(srcdir)\" | sed 's|.|.|g'`;\n@@ -78,11 +80,9 @@ am__base_list = \\\n   sed '$$!N;$$!N;$$!N;$$!N;s/\\n/ /g'\n am__installdirs = \"$(DESTDIR)$(libexecsubdir)\"\n LTLIBRARIES = $(libexecsub_LTLIBRARIES)\n-am__DEPENDENCIES_1 =\n-liblto_plugin_la_DEPENDENCIES = $(am__DEPENDENCIES_1) $(if $(wildcard \\\n+liblto_plugin_la_DEPENDENCIES = $(if $(wildcard \\\n \t../libiberty/pic/libiberty.a),../libiberty/pic/libiberty.a,)\n-am_liblto_plugin_la_OBJECTS = lto-plugin.lo \\\n-\tlto-plugin-$(LTO_FORMAT).lo\n+am_liblto_plugin_la_OBJECTS = lto-plugin.lo\n liblto_plugin_la_OBJECTS = $(am_liblto_plugin_la_OBJECTS)\n liblto_plugin_la_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) \\\n \t$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \\\n@@ -133,19 +133,12 @@ INSTALL_SCRIPT = @INSTALL_SCRIPT@\n INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@\n LD = @LD@\n LDFLAGS = @LDFLAGS@\n-LIBELFINC = @LIBELFINC@\n-\n-# How to find libelf\n-LIBELFLIBS = @LIBELFLIBS@\n LIBOBJS = @LIBOBJS@\n LIBS = @LIBS@\n LIBTOOL = @LIBTOOL@\n LIPO = @LIPO@\n LN_S = @LN_S@\n LTLIBOBJS = @LTLIBOBJS@\n-\n-# Which object format to parse.\n-LTO_FORMAT = @LTO_FORMAT@\n MAINT = @MAINT@\n MAKEINFO = @MAKEINFO@\n MKDIR_P = @MKDIR_P@\n@@ -219,27 +212,32 @@ sbindir = @sbindir@\n sharedstatedir = @sharedstatedir@\n srcdir = @srcdir@\n sysconfdir = @sysconfdir@\n+target = @target@\n target_alias = @target_alias@\n+target_cpu = @target_cpu@\n target_noncanonical := @target_noncanonical@\n+target_os = @target_os@\n target_subdir = @target_subdir@\n+target_vendor = @target_vendor@\n top_build_prefix = @top_build_prefix@\n top_builddir = @top_builddir@\n top_srcdir = @top_srcdir@\n ACLOCAL_AMFLAGS = -I .. -I ../config\n AUTOMAKE_OPTIONS = no-dependencies\n gcc_version := $(shell cat $(top_srcdir)/../gcc/BASE-VER)\n libexecsubdir := $(libexecdir)/gcc/$(target_noncanonical)/$(gcc_version)\n-AM_CPPFLAGS = -I$(top_srcdir)/../include $(LIBELFINC)\n+AM_CPPFLAGS = -I$(top_srcdir)/../include $(DEFS)\n AM_CFLAGS = -Wall -Werror\n libexecsub_LTLIBRARIES = liblto_plugin.la\n-liblto_plugin_la_SOURCES = lto-plugin.c lto-plugin-$(LTO_FORMAT).c\n-liblto_plugin_la_LIBADD = $(LIBELFLIBS) \\\n+liblto_plugin_la_SOURCES = lto-plugin.c\n+liblto_plugin_la_LIBADD = \\\n \t$(if $(wildcard ../libiberty/pic/libiberty.a),../libiberty/pic/libiberty.a,)\n \n liblto_plugin_la_LDFLAGS = -no-undefined -bindir $(libexecsubdir) \\\n \t$(if $(wildcard ../libiberty/pic/libiberty.a),,-Wc,../libiberty/libiberty.a)\n \n-all: all-am\n+all: config.h\n+\t$(MAKE) $(AM_MAKEFLAGS) all-am\n \n .SUFFIXES:\n .SUFFIXES: .c .lo .o .obj\n@@ -277,6 +275,23 @@ $(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)\n $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)\n \t$(am__cd) $(srcdir) && $(ACLOCAL) $(ACLOCAL_AMFLAGS)\n $(am__aclocal_m4_deps):\n+\n+config.h: stamp-h1\n+\t@if test ! -f $@; then \\\n+\t  rm -f stamp-h1; \\\n+\t  $(MAKE) $(AM_MAKEFLAGS) stamp-h1; \\\n+\telse :; fi\n+\n+stamp-h1: $(srcdir)/config.h.in $(top_builddir)/config.status\n+\t@rm -f stamp-h1\n+\tcd $(top_builddir) && $(SHELL) ./config.status config.h\n+$(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@ $(am__configure_deps) \n+\t($(am__cd) $(top_srcdir) && $(AUTOHEADER))\n+\trm -f stamp-h1\n+\ttouch $@\n+\n+distclean-hdr:\n+\t-rm -f config.h stamp-h1\n install-libexecsubLTLIBRARIES: $(libexecsub_LTLIBRARIES)\n \t@$(NORMAL_INSTALL)\n \ttest -z \"$(libexecsubdir)\" || $(MKDIR_P) \"$(DESTDIR)$(libexecsubdir)\"\n@@ -345,11 +360,11 @@ ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)\n \tmkid -fID $$unique\n tags: TAGS\n \n-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \\\n+TAGS:  $(HEADERS) $(SOURCES) config.h.in $(TAGS_DEPENDENCIES) \\\n \t\t$(TAGS_FILES) $(LISP)\n \tset x; \\\n \there=`pwd`; \\\n-\tlist='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \\\n+\tlist='$(SOURCES) $(HEADERS) config.h.in $(LISP) $(TAGS_FILES)'; \\\n \tunique=`for i in $$list; do \\\n \t    if test -f \"$$i\"; then echo $$i; else echo $(srcdir)/$$i; fi; \\\n \t  done | \\\n@@ -367,9 +382,9 @@ TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \\\n \t  fi; \\\n \tfi\n ctags: CTAGS\n-CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \\\n+CTAGS:  $(HEADERS) $(SOURCES) config.h.in $(TAGS_DEPENDENCIES) \\\n \t\t$(TAGS_FILES) $(LISP)\n-\tlist='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \\\n+\tlist='$(SOURCES) $(HEADERS) config.h.in $(LISP) $(TAGS_FILES)'; \\\n \tunique=`for i in $$list; do \\\n \t    if test -f \"$$i\"; then echo $$i; else echo $(srcdir)/$$i; fi; \\\n \t  done | \\\n@@ -388,7 +403,7 @@ distclean-tags:\n \t-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags\n check-am: all-am\n check: check-am\n-all-am: Makefile $(LTLIBRARIES)\n+all-am: Makefile $(LTLIBRARIES) config.h\n installdirs:\n \tfor dir in \"$(DESTDIR)$(libexecsubdir)\"; do \\\n \t  test -z \"$$dir\" || $(MKDIR_P) \"$$dir\"; \\\n@@ -427,7 +442,7 @@ distclean: distclean-am\n \t-rm -f $(am__CONFIG_DISTCLEAN_FILES)\n \t-rm -f Makefile\n distclean-am: clean-am distclean-compile distclean-generic \\\n-\tdistclean-libtool distclean-tags\n+\tdistclean-hdr distclean-libtool distclean-tags\n \n dvi: dvi-am\n \n@@ -490,11 +505,11 @@ ps-am:\n \n uninstall-am: uninstall-libexecsubLTLIBRARIES\n \n-.MAKE: install-am install-strip\n+.MAKE: all install-am install-strip\n \n .PHONY: CTAGS GTAGS all all-am am--refresh check check-am clean \\\n \tclean-generic clean-libexecsubLTLIBRARIES clean-libtool ctags \\\n-\tdistclean distclean-compile distclean-generic \\\n+\tdistclean distclean-compile distclean-generic distclean-hdr \\\n \tdistclean-libtool distclean-tags dvi dvi-am html html-am info \\\n \tinfo-am install install-am install-data install-data-am \\\n \tinstall-dvi install-dvi-am install-exec install-exec-am \\"}, {"sha": "d7750f1e9e8020ae8964bb96bdc4dd86e68303f4", "filename": "lto-plugin/config.h.in", "status": "added", "additions": 80, "deletions": 0, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Fconfig.h.in?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -0,0 +1,80 @@\n+/* config.h.in.  Generated from configure.ac by autoheader.  */\n+\n+/* Define to 1 if you have the <dlfcn.h> header file. */\n+#undef HAVE_DLFCN_H\n+\n+/* Define to 1 if you have the <inttypes.h> header file. */\n+#undef HAVE_INTTYPES_H\n+\n+/* Define to 1 if you have the <memory.h> header file. */\n+#undef HAVE_MEMORY_H\n+\n+/* Define to 1 if you have the <stdint.h> header file. */\n+#undef HAVE_STDINT_H\n+\n+/* Define to 1 if you have the <stdlib.h> header file. */\n+#undef HAVE_STDLIB_H\n+\n+/* Define to 1 if you have the <strings.h> header file. */\n+#undef HAVE_STRINGS_H\n+\n+/* Define to 1 if you have the <string.h> header file. */\n+#undef HAVE_STRING_H\n+\n+/* Define to 1 if you have the <sys/stat.h> header file. */\n+#undef HAVE_SYS_STAT_H\n+\n+/* Define to 1 if you have the <sys/types.h> header file. */\n+#undef HAVE_SYS_TYPES_H\n+\n+/* Define to 1 if you have the <unistd.h> header file. */\n+#undef HAVE_UNISTD_H\n+\n+/* Define to the sub-directory in which libtool stores uninstalled libraries.\n+   */\n+#undef LT_OBJDIR\n+\n+/* Name of package */\n+#undef PACKAGE\n+\n+/* Define to the address where bug reports for this package should be sent. */\n+#undef PACKAGE_BUGREPORT\n+\n+/* Define to the full name of this package. */\n+#undef PACKAGE_NAME\n+\n+/* Define to the full name and version of this package. */\n+#undef PACKAGE_STRING\n+\n+/* Define to the one symbol short name of this package. */\n+#undef PACKAGE_TARNAME\n+\n+/* Define to the home page for this package. */\n+#undef PACKAGE_URL\n+\n+/* Define to the version of this package. */\n+#undef PACKAGE_VERSION\n+\n+/* Define to 1 if you have the ANSI C header files. */\n+#undef STDC_HEADERS\n+\n+/* Default symbol style */\n+#undef SYM_STYLE\n+\n+/* Version number of package */\n+#undef VERSION\n+\n+/* Number of bits in a file offset, on hosts where this is settable. */\n+#undef _FILE_OFFSET_BITS\n+\n+/* Define for large files, on AIX-style hosts. */\n+#undef _LARGE_FILES\n+\n+/* Define for Solaris 2.5.1 so the uint64_t typedef from <sys/synch.h>,\n+   <pthread.h>, or <semaphore.h> is not used. If the typedef were allowed, the\n+   #define below would cause a syntax error. */\n+#undef _UINT64_T\n+\n+/* Define to the type of an unsigned integer type of width exactly 64 bits if\n+   such a type exists and the standard includes do not define it. */\n+#undef uint64_t"}, {"sha": "78948f90db4b6744f76f3f86839ddd6a265dfb14", "filename": "lto-plugin/configure", "status": "modified", "additions": 211, "deletions": 57, "changes": 268, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Fconfigure?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -601,7 +601,6 @@ ac_subst_vars='am__EXEEXT_FALSE\n am__EXEEXT_TRUE\n LTLIBOBJS\n LIBOBJS\n-LTO_FORMAT\n target_noncanonical\n CPP\n OTOOL64\n@@ -622,8 +621,6 @@ EGREP\n GREP\n SED\n LIBTOOL\n-LIBELFINC\n-LIBELFLIBS\n am__fastdepCC_FALSE\n am__fastdepCC_TRUE\n CCDEPMODE\n@@ -742,8 +739,6 @@ CFLAGS\n LDFLAGS\n LIBS\n CPPFLAGS\n-LIBELFLIBS\n-LIBELFINC\n CPP'\n \n \n@@ -1392,8 +1387,6 @@ Some influential environment variables:\n   LIBS        libraries to pass to the linker, e.g. -l<library>\n   CPPFLAGS    C/C++/Objective C preprocessor flags, e.g. -I<include dir> if\n               you have headers in a nonstandard directory <include dir>\n-  LIBELFLIBS  How to link libelf\n-  LIBELFINC   How to find libelf include files\n   CPP         C preprocessor\n \n Use these variables to override the choices made by `configure' or to help\n@@ -3975,8 +3968,6 @@ rm -rf conftest*\n   fi\n fi\n \n-\n-\n case `pwd` in\n   *\\ * | *\\\t*)\n     { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: Libtool does not cope well with whitespace in \\`pwd\\`\" >&5\n@@ -10443,7 +10434,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 10446 \"configure\"\n+#line 10437 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -10549,7 +10540,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 10552 \"configure\"\n+#line 10543 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -10787,14 +10778,24 @@ CC=\"$lt_save_CC\"\n \n \n \n-. ${srcdir}/../gcc/config.gcc\n-case ${lto_binary_reader} in\n-  *coff*) LTO_FORMAT=coff ;;\n-  *elf*)  LTO_FORMAT=elf ;;\n-  *) as_fn_error \"LTO plugin is not supported on this target.\" \"$LINENO\" 5 ;;\n-esac\n+# Trying to get this information from gcc's config is tricky.\n+case $target in\n+  x86_64*-mingw*)\n+\n+$as_echo \"#define SYM_STYLE ss_none\" >>confdefs.h\n+\n+    ;;\n+  *-cygwin* | i?86*-mingw* )\n \n+$as_echo \"#define SYM_STYLE ss_win32\" >>confdefs.h\n \n+    ;;\n+  *)\n+\n+$as_echo \"#define SYM_STYLE ss_none\" >>confdefs.h\n+\n+    ;;\n+esac\n ac_fn_c_find_uintX_t \"$LINENO\" \"64\" \"ac_cv_c_uint64_t\"\n case $ac_cv_c_uint64_t in #(\n   no|yes) ;; #(\n@@ -10811,6 +10812,8 @@ _ACEOF\n \n ac_config_files=\"$ac_config_files Makefile\"\n \n+ac_config_headers=\"$ac_config_headers config.h\"\n+\n cat >confcache <<\\_ACEOF\n # This file is a shell script that caches the results of configure\n # tests run on this system so they can be shared between configure\n@@ -10890,43 +10893,7 @@ test \"x$prefix\" = xNONE && prefix=$ac_default_prefix\n # Let make expand exec_prefix.\n test \"x$exec_prefix\" = xNONE && exec_prefix='${prefix}'\n \n-# Transform confdefs.h into DEFS.\n-# Protect against shell expansion while executing Makefile rules.\n-# Protect against Makefile macro expansion.\n-#\n-# If the first sed substitution is executed (which looks for macros that\n-# take arguments), then branch to the quote section.  Otherwise,\n-# look for a macro that doesn't take arguments.\n-ac_script='\n-:mline\n-/\\\\$/{\n- N\n- s,\\\\\\n,,\n- b mline\n-}\n-t clear\n-:clear\n-s/^[\t ]*#[\t ]*define[\t ][\t ]*\\([^\t (][^\t (]*([^)]*)\\)[\t ]*\\(.*\\)/-D\\1=\\2/g\n-t quote\n-s/^[\t ]*#[\t ]*define[\t ][\t ]*\\([^\t ][^\t ]*\\)[\t ]*\\(.*\\)/-D\\1=\\2/g\n-t quote\n-b any\n-:quote\n-s/[\t `~#$^&*(){}\\\\|;'\\''\"<>?]/\\\\&/g\n-s/\\[/\\\\&/g\n-s/\\]/\\\\&/g\n-s/\\$/$$/g\n-H\n-:any\n-${\n-\tg\n-\ts/^\\n//\n-\ts/\\n/ /g\n-\tp\n-}\n-'\n-DEFS=`sed -n \"$ac_script\" confdefs.h`\n-\n+DEFS=-DHAVE_CONFIG_H\n \n ac_libobjs=\n ac_ltlibobjs=\n@@ -11390,11 +11357,15 @@ case $ac_config_files in *\"\n \"*) set x $ac_config_files; shift; ac_config_files=$*;;\n esac\n \n+case $ac_config_headers in *\"\n+\"*) set x $ac_config_headers; shift; ac_config_headers=$*;;\n+esac\n \n \n cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1\n # Files that config.status was made for.\n config_files=\"$ac_config_files\"\n+config_headers=\"$ac_config_headers\"\n config_commands=\"$ac_config_commands\"\n \n _ACEOF\n@@ -11415,10 +11386,15 @@ Usage: $0 [OPTION]... [TAG]...\n       --recheck    update $as_me by reconfiguring in the same conditions\n       --file=FILE[:TEMPLATE]\n                    instantiate the configuration file FILE\n+      --header=FILE[:TEMPLATE]\n+                   instantiate the configuration header FILE\n \n Configuration files:\n $config_files\n \n+Configuration headers:\n+$config_headers\n+\n Configuration commands:\n $config_commands\n \n@@ -11476,7 +11452,18 @@ do\n     esac\n     as_fn_append CONFIG_FILES \" '$ac_optarg'\"\n     ac_need_defaults=false;;\n-  --he | --h |  --help | --hel | -h )\n+  --header | --heade | --head | --hea )\n+    $ac_shift\n+    case $ac_optarg in\n+    *\\'*) ac_optarg=`$as_echo \"$ac_optarg\" | sed \"s/'/'\\\\\\\\\\\\\\\\''/g\"` ;;\n+    esac\n+    as_fn_append CONFIG_HEADERS \" '$ac_optarg'\"\n+    ac_need_defaults=false;;\n+  --he | --h)\n+    # Conflict between --help and --header\n+    as_fn_error \"ambiguous option: \\`$1'\n+Try \\`$0 --help' for more information.\";;\n+  --help | --hel | -h )\n     $as_echo \"$ac_cs_usage\"; exit ;;\n   -q | -quiet | --quiet | --quie | --qui | --qu | --q \\\n   | -silent | --silent | --silen | --sile | --sil | --si | --s)\n@@ -11800,6 +11787,7 @@ do\n     \"depfiles\") CONFIG_COMMANDS=\"$CONFIG_COMMANDS depfiles\" ;;\n     \"libtool\") CONFIG_COMMANDS=\"$CONFIG_COMMANDS libtool\" ;;\n     \"Makefile\") CONFIG_FILES=\"$CONFIG_FILES Makefile\" ;;\n+    \"config.h\") CONFIG_HEADERS=\"$CONFIG_HEADERS config.h\" ;;\n \n   *) as_fn_error \"invalid argument: \\`$ac_config_target'\" \"$LINENO\" 5;;\n   esac\n@@ -11812,6 +11800,7 @@ done\n # bizarre bug on SunOS 4.1.3.\n if $ac_need_defaults; then\n   test \"${CONFIG_FILES+set}\" = set || CONFIG_FILES=$config_files\n+  test \"${CONFIG_HEADERS+set}\" = set || CONFIG_HEADERS=$config_headers\n   test \"${CONFIG_COMMANDS+set}\" = set || CONFIG_COMMANDS=$config_commands\n fi\n \n@@ -11990,8 +11979,116 @@ fi\n cat >>$CONFIG_STATUS <<\\_ACEOF || ac_write_fail=1\n fi # test -n \"$CONFIG_FILES\"\n \n+# Set up the scripts for CONFIG_HEADERS section.\n+# No need to generate them if there are no CONFIG_HEADERS.\n+# This happens for instance with `./config.status Makefile'.\n+if test -n \"$CONFIG_HEADERS\"; then\n+cat >\"$tmp/defines.awk\" <<\\_ACAWK ||\n+BEGIN {\n+_ACEOF\n+\n+# Transform confdefs.h into an awk script `defines.awk', embedded as\n+# here-document in config.status, that substitutes the proper values into\n+# config.h.in to produce config.h.\n \n-eval set X \"  :F $CONFIG_FILES      :C $CONFIG_COMMANDS\"\n+# Create a delimiter string that does not exist in confdefs.h, to ease\n+# handling of long lines.\n+ac_delim='%!_!# '\n+for ac_last_try in false false :; do\n+  ac_t=`sed -n \"/$ac_delim/p\" confdefs.h`\n+  if test -z \"$ac_t\"; then\n+    break\n+  elif $ac_last_try; then\n+    as_fn_error \"could not make $CONFIG_HEADERS\" \"$LINENO\" 5\n+  else\n+    ac_delim=\"$ac_delim!$ac_delim _$ac_delim!! \"\n+  fi\n+done\n+\n+# For the awk script, D is an array of macro values keyed by name,\n+# likewise P contains macro parameters if any.  Preserve backslash\n+# newline sequences.\n+\n+ac_word_re=[_$as_cr_Letters][_$as_cr_alnum]*\n+sed -n '\n+s/.\\{148\\}/&'\"$ac_delim\"'/g\n+t rset\n+:rset\n+s/^[\t ]*#[\t ]*define[\t ][\t ]*/ /\n+t def\n+d\n+:def\n+s/\\\\$//\n+t bsnl\n+s/[\"\\\\]/\\\\&/g\n+s/^ \\('\"$ac_word_re\"'\\)\\(([^()]*)\\)[\t ]*\\(.*\\)/P[\"\\1\"]=\"\\2\"\\\n+D[\"\\1\"]=\" \\3\"/p\n+s/^ \\('\"$ac_word_re\"'\\)[\t ]*\\(.*\\)/D[\"\\1\"]=\" \\2\"/p\n+d\n+:bsnl\n+s/[\"\\\\]/\\\\&/g\n+s/^ \\('\"$ac_word_re\"'\\)\\(([^()]*)\\)[\t ]*\\(.*\\)/P[\"\\1\"]=\"\\2\"\\\n+D[\"\\1\"]=\" \\3\\\\\\\\\\\\n\"\\\\/p\n+t cont\n+s/^ \\('\"$ac_word_re\"'\\)[\t ]*\\(.*\\)/D[\"\\1\"]=\" \\2\\\\\\\\\\\\n\"\\\\/p\n+t cont\n+d\n+:cont\n+n\n+s/.\\{148\\}/&'\"$ac_delim\"'/g\n+t clear\n+:clear\n+s/\\\\$//\n+t bsnlc\n+s/[\"\\\\]/\\\\&/g; s/^/\"/; s/$/\"/p\n+d\n+:bsnlc\n+s/[\"\\\\]/\\\\&/g; s/^/\"/; s/$/\\\\\\\\\\\\n\"\\\\/p\n+b cont\n+' <confdefs.h | sed '\n+s/'\"$ac_delim\"'/\"\\\\\\\n+\"/g' >>$CONFIG_STATUS || ac_write_fail=1\n+\n+cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1\n+  for (key in D) D_is_set[key] = 1\n+  FS = \"\u0007\"\n+}\n+/^[\\t ]*#[\\t ]*(define|undef)[\\t ]+$ac_word_re([\\t (]|\\$)/ {\n+  line = \\$ 0\n+  split(line, arg, \" \")\n+  if (arg[1] == \"#\") {\n+    defundef = arg[2]\n+    mac1 = arg[3]\n+  } else {\n+    defundef = substr(arg[1], 2)\n+    mac1 = arg[2]\n+  }\n+  split(mac1, mac2, \"(\") #)\n+  macro = mac2[1]\n+  prefix = substr(line, 1, index(line, defundef) - 1)\n+  if (D_is_set[macro]) {\n+    # Preserve the white space surrounding the \"#\".\n+    print prefix \"define\", macro P[macro] D[macro]\n+    next\n+  } else {\n+    # Replace #undef with comments.  This is necessary, for example,\n+    # in the case of _POSIX_SOURCE, which is predefined and required\n+    # on some systems where configure will not decide to define it.\n+    if (defundef == \"undef\") {\n+      print \"/*\", prefix defundef, macro, \"*/\"\n+      next\n+    }\n+  }\n+}\n+{ print }\n+_ACAWK\n+_ACEOF\n+cat >>$CONFIG_STATUS <<\\_ACEOF || ac_write_fail=1\n+  as_fn_error \"could not setup config headers machinery\" \"$LINENO\" 5\n+fi # test -n \"$CONFIG_HEADERS\"\n+\n+\n+eval set X \"  :F $CONFIG_FILES  :H $CONFIG_HEADERS    :C $CONFIG_COMMANDS\"\n shift\n for ac_tag\n do\n@@ -12209,7 +12306,64 @@ which seems to be undefined.  Please make sure it is defined.\" >&2;}\n   esac \\\n   || as_fn_error \"could not create $ac_file\" \"$LINENO\" 5\n  ;;\n-\n+  :H)\n+  #\n+  # CONFIG_HEADER\n+  #\n+  if test x\"$ac_file\" != x-; then\n+    {\n+      $as_echo \"/* $configure_input  */\" \\\n+      && eval '$AWK -f \"$tmp/defines.awk\"' \"$ac_file_inputs\"\n+    } >\"$tmp/config.h\" \\\n+      || as_fn_error \"could not create $ac_file\" \"$LINENO\" 5\n+    if diff \"$ac_file\" \"$tmp/config.h\" >/dev/null 2>&1; then\n+      { $as_echo \"$as_me:${as_lineno-$LINENO}: $ac_file is unchanged\" >&5\n+$as_echo \"$as_me: $ac_file is unchanged\" >&6;}\n+    else\n+      rm -f \"$ac_file\"\n+      mv \"$tmp/config.h\" \"$ac_file\" \\\n+\t|| as_fn_error \"could not create $ac_file\" \"$LINENO\" 5\n+    fi\n+  else\n+    $as_echo \"/* $configure_input  */\" \\\n+      && eval '$AWK -f \"$tmp/defines.awk\"' \"$ac_file_inputs\" \\\n+      || as_fn_error \"could not create -\" \"$LINENO\" 5\n+  fi\n+# Compute \"$ac_file\"'s index in $config_headers.\n+_am_arg=\"$ac_file\"\n+_am_stamp_count=1\n+for _am_header in $config_headers :; do\n+  case $_am_header in\n+    $_am_arg | $_am_arg:* )\n+      break ;;\n+    * )\n+      _am_stamp_count=`expr $_am_stamp_count + 1` ;;\n+  esac\n+done\n+echo \"timestamp for $_am_arg\" >`$as_dirname -- \"$_am_arg\" ||\n+$as_expr X\"$_am_arg\" : 'X\\(.*[^/]\\)//*[^/][^/]*/*$' \\| \\\n+\t X\"$_am_arg\" : 'X\\(//\\)[^/]' \\| \\\n+\t X\"$_am_arg\" : 'X\\(//\\)$' \\| \\\n+\t X\"$_am_arg\" : 'X\\(/\\)' \\| . 2>/dev/null ||\n+$as_echo X\"$_am_arg\" |\n+    sed '/^X\\(.*[^/]\\)\\/\\/*[^/][^/]*\\/*$/{\n+\t    s//\\1/\n+\t    q\n+\t  }\n+\t  /^X\\(\\/\\/\\)[^/].*/{\n+\t    s//\\1/\n+\t    q\n+\t  }\n+\t  /^X\\(\\/\\/\\)$/{\n+\t    s//\\1/\n+\t    q\n+\t  }\n+\t  /^X\\(\\/\\).*/{\n+\t    s//\\1/\n+\t    q\n+\t  }\n+\t  s/.*/./; q'`/stamp-h$_am_stamp_count\n+ ;;\n \n   :C)  { $as_echo \"$as_me:${as_lineno-$LINENO}: executing $ac_file commands\" >&5\n $as_echo \"$as_me: executing $ac_file commands\" >&6;}"}, {"sha": "282115fddfc9bc83782c03020258051e58dfc242", "filename": "lto-plugin/configure.ac", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Fconfigure.ac?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -6,18 +6,21 @@ AM_INIT_AUTOMAKE([foreign no-dist])\n AM_MAINTAINER_MODE\n AC_PROG_CC\n AC_SYS_LARGEFILE\n-AC_ARG_VAR(LIBELFLIBS,[How to link libelf])\n-AC_ARG_VAR(LIBELFINC,[How to find libelf include files])\n AM_PROG_LIBTOOL\n AC_SUBST(target_noncanonical)\n-. ${srcdir}/../gcc/config.gcc\n-case ${lto_binary_reader} in\n-  *coff*) LTO_FORMAT=coff ;;\n-  *elf*)  LTO_FORMAT=elf ;;\n-  *) AC_MSG_ERROR([LTO plugin is not supported on this target.]) ;;\n+# Trying to get this information from gcc's config is tricky.\n+case $target in\n+  x86_64*-mingw*)\n+    AC_DEFINE([SYM_STYLE], [ss_none], [Default symbol style])\n+    ;;\n+  *-cygwin* | i?86*-mingw* )\n+    AC_DEFINE([SYM_STYLE], [ss_win32], [Default symbol style])\n+    ;;\n+  *)\n+    AC_DEFINE([SYM_STYLE], [ss_none], [Default symbol style])\n+    ;;\n esac\n-\n-AC_SUBST(LTO_FORMAT)\n AC_TYPE_UINT64_T\n AC_CONFIG_FILES(Makefile)\n+AC_CONFIG_HEADERS(config.h)\n AC_OUTPUT"}, {"sha": "acaff5979f2172c912ba645bbb4ae8e36be5af6e", "filename": "lto-plugin/lto-plugin-coff.c", "status": "removed", "additions": 0, "deletions": 38, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03f43d3d3c6909ead8325e86a947f66ba8b83141/lto-plugin%2Flto-plugin-coff.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03f43d3d3c6909ead8325e86a947f66ba8b83141/lto-plugin%2Flto-plugin-coff.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Flto-plugin-coff.c?ref=03f43d3d3c6909ead8325e86a947f66ba8b83141", "patch": "@@ -1,38 +0,0 @@\n-/* LTO plugin for gold.\n-   Copyright (C) 2010 Free Software Foundation, Inc.\n-\n-This program is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-This program is distributed in the hope that it will be useful, but\n-WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with this program; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-/* Common definitions that the object format dependent code needs.  */\n-#include \"lto-plugin.h\"\n-\n-/* Callback used by gold to check if the plugin will claim FILE. Writes\n-   the result in CLAIMED. */\n-\n-enum ld_plugin_status\n-claim_file_handler (const struct ld_plugin_input_file *file, int *claimed)\n-{\n-  /* To be implemented; for now, simply do nothing.  */\n-  return LDPS_OK;\n-}\n-\n-/* Method called first thing at onload time to perform sanity checks.  */\n-\n-enum ld_plugin_status\n-onload_format_checks (struct ld_plugin_tv *tv)\n-{\n-  return LDPS_OK;\n-}\n-"}, {"sha": "afd79dac05687a6ba19cfaa1565e8eabab21887d", "filename": "lto-plugin/lto-plugin-elf.c", "status": "removed", "additions": 0, "deletions": 157, "changes": 157, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03f43d3d3c6909ead8325e86a947f66ba8b83141/lto-plugin%2Flto-plugin-elf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03f43d3d3c6909ead8325e86a947f66ba8b83141/lto-plugin%2Flto-plugin-elf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Flto-plugin-elf.c?ref=03f43d3d3c6909ead8325e86a947f66ba8b83141", "patch": "@@ -1,157 +0,0 @@\n-/* LTO plugin for gold.\n-   Copyright (C) 2009, 2010 Free Software Foundation, Inc.\n-   Contributed by Rafael Avila de Espindola (espindola@google.com).\n-\n-This program is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-This program is distributed in the hope that it will be useful, but\n-WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with this program; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#include <assert.h>\n-#include <string.h>\n-#include <stdio.h>\n-#include <libiberty.h>\n-#include <stdlib.h>\n-#include <inttypes.h>\n-\n-/* The presence of gelf.h is checked by the toplevel configure script.  */\n-#include <gelf.h>\n-\n-/* Common definitions that the object format dependent code needs.  */\n-#include \"lto-plugin.h\"\n-\n-/* Process all lto symtabs of file ELF. */\n-\n-static int\n-process_symtab (Elf *elf, struct plugin_symtab *out)\n-{\n-  int found = 0;\n-  Elf_Scn *section = 0;\n-  GElf_Ehdr header;\n-  GElf_Ehdr *t = gelf_getehdr (elf, &header);\n-  if (t == NULL)\n-    return 0;\n-  assert (t == &header);\n-\n-  while ((section = elf_nextscn(elf, section)) != 0)\n-    {\n-      GElf_Shdr shdr;\n-      GElf_Shdr *tshdr = gelf_getshdr (section, &shdr);\n-      Elf_Data *symtab;\n-      const char *t;\n-      assert (tshdr == &shdr);\n-      t = elf_strptr (elf, header.e_shstrndx, shdr.sh_name);\n-      assert (t != NULL);\n-      if (strncmp (t, LTO_SECTION_PREFIX, strlen (LTO_SECTION_PREFIX)) == 0) \n-\t{\n-\t  char *s = strrchr (t, '.');\n-\t  if (s)\n-\t      sscanf (s, \".%x\", &out->id);\n-\t  symtab = elf_getdata (section, NULL);\n-\t  translate (symtab->d_buf, symtab->d_buf + symtab->d_size, out);\n-\t  found++;\n-\t}\n-    }\n-  return found;\n-}\n-\n-/* Callback used by gold to check if the plugin will claim FILE. Writes\n-   the result in CLAIMED. */\n-\n-enum ld_plugin_status\n-claim_file_handler (const struct ld_plugin_input_file *file, int *claimed)\n-{\n-  enum ld_plugin_status status;\n-  Elf *elf;\n-  struct plugin_file_info lto_file;\n-  int n;\n-\n-  memset (&lto_file, 0, sizeof (struct plugin_file_info));\n-\n-  if (file->offset != 0)\n-    {\n-      char *objname;\n-      Elf *archive;\n-      off_t offset;\n-      /* We pass the offset of the actual file, not the archive header. */\n-      int t = asprintf (&objname, \"%s@0x%\" PRIx64, file->name,\n-                        (int64_t) file->offset);\n-      check (t >= 0, LDPL_FATAL, \"asprintf failed\");\n-      lto_file.name = objname;\n-\n-      archive = elf_begin (file->fd, ELF_C_READ, NULL);\n-      check (elf_kind (archive) == ELF_K_AR, LDPL_FATAL,\n-             \"Not an archive and offset not 0\");\n-\n-      /* elf_rand expects the offset to point to the ar header, not the\n-         object itself. Subtract the size of the ar header (60 bytes).\n-         We don't uses sizeof (struct ar_hd) to avoid including ar.h */\n-\n-      offset = file->offset - 60;\n-      check (offset == elf_rand (archive, offset), LDPL_FATAL,\n-             \"could not seek in archive\");\n-      elf = elf_begin (file->fd, ELF_C_READ, archive);\n-      check (elf != NULL, LDPL_FATAL, \"could not find archive member\");\n-      elf_end (archive);\n-    }\n-  else\n-    {\n-      lto_file.name = xstrdup (file->name);\n-      elf = elf_begin (file->fd, ELF_C_READ, NULL);\n-    }\n-  lto_file.handle = file->handle;\n-\n-  *claimed = 0;\n-\n-  if (!elf)\n-    goto err;\n-\n-  n = process_symtab (elf, &lto_file.symtab);\n-  if (n == 0)\n-    goto err;\n-\n-  if (n > 1)\n-    resolve_conflicts (&lto_file.symtab, &lto_file.conflicts);\n-\n-  status = add_symbols (file->handle, lto_file.symtab.nsyms,\n-\t\t\tlto_file.symtab.syms);\n-  check (status == LDPS_OK, LDPL_FATAL, \"could not add symbols\");\n-\n-  *claimed = 1;\n-  num_claimed_files++;\n-  claimed_files =\n-    xrealloc (claimed_files,\n-\t      num_claimed_files * sizeof (struct plugin_file_info));\n-  claimed_files[num_claimed_files - 1] = lto_file;\n-\n-  goto cleanup;\n-\n- err:\n-  free (lto_file.name);\n-\n- cleanup:\n-  if (elf)\n-    elf_end (elf);\n-\n-  return LDPS_OK;\n-}\n-\n-/* Method called first thing at onload time to perform sanity checks.  */\n-\n-enum ld_plugin_status\n-onload_format_checks (struct ld_plugin_tv *tv)\n-{\n-  unsigned version = elf_version (EV_CURRENT);\n-  check (version != EV_NONE, LDPL_FATAL, \"invalid ELF version\");\n-  return LDPS_OK;\n-}\n-"}, {"sha": "7df0d6f3c01128f52c2ce551d0b341145549e321", "filename": "lto-plugin/lto-plugin.c", "status": "modified", "additions": 231, "deletions": 17, "changes": 248, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Flto-plugin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48215350c24d524b635d6110eca1e70996f5fb82/lto-plugin%2Flto-plugin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Flto-plugin.c?ref=48215350c24d524b635d6110eca1e70996f5fb82", "patch": "@@ -32,6 +32,9 @@ along with this program; see the file COPYING3.  If not see\n    -nop: Instead of running lto-wrapper, pass the original to the plugin. This\n    only works if the input files are hybrid.  */\n \n+#ifdef HAVE_CONFIG_H\n+#include \"config.h\"\n+#endif\n #include <assert.h>\n #include <string.h>\n #include <stdlib.h>\n@@ -46,9 +49,72 @@ along with this program; see the file COPYING3.  If not see\n #include <libiberty.h>\n #include <hashtab.h>\n #include \"../gcc/lto/common.h\"\n+#include \"simple-object.h\"\n+#include \"plugin-api.h\"\n \n-/* Common definitions for/from the object format dependent code.  */\n-#include \"lto-plugin.h\"\n+/* Handle opening elf files on hosts, such as Windows, that may use\n+   text file handling that will break binary access.  */\n+#ifndef O_BINARY\n+# define O_BINARY 0\n+#endif\n+\n+/* Segment name for LTO sections.  This is only used for Mach-O.\n+   FIXME: This needs to be kept in sync with darwin.c.  */\n+\n+#define LTO_SEGMENT_NAME \"__GNU_LTO\"\n+\n+/* LTO magic section name.  */\n+\n+#define LTO_SECTION_PREFIX\t\".gnu.lto_.symtab\"\n+#define LTO_SECTION_PREFIX_LEN\t(sizeof (LTO_SECTION_PREFIX) - 1)\n+\n+/* The part of the symbol table the plugin has to keep track of. Note that we\n+   must keep SYMS until all_symbols_read is called to give the linker time to\n+   copy the symbol information. */\n+\n+struct sym_aux\n+{\n+  uint32_t slot;\n+  unsigned id;\n+  unsigned next_conflict;\n+};\n+\n+struct plugin_symtab\n+{\n+  int nsyms;\n+  struct sym_aux *aux;\n+  struct ld_plugin_symbol *syms;\n+  unsigned id;\n+};\n+\n+/* Encapsulates object file data during symbol scan.  */\n+struct plugin_objfile\n+{\n+  int found;\n+  simple_object_read *objfile;\n+  struct plugin_symtab *out;\n+  const struct ld_plugin_input_file *file;\n+};\n+\n+/* All that we have to remember about a file. */\n+\n+struct plugin_file_info\n+{\n+  char *name;\n+  void *handle;\n+  struct plugin_symtab symtab;\n+  struct plugin_symtab conflicts;\n+};\n+\n+/* Until ASM_OUTPUT_LABELREF can be hookized and decoupled from\n+   stdio file streams, we do simple label translation here.  */\n+\n+enum symbol_style\n+{\n+  ss_none,\t/* No underscore prefix. */\n+  ss_win32,\t/* Underscore prefix any symbol not beginning with '@'.  */\n+  ss_uscore,\t/* Underscore prefix all symbols.  */\n+};\n \n static char *arguments_file_name;\n static ld_plugin_register_claim_file register_claim_file;\n@@ -58,13 +124,10 @@ static ld_plugin_register_cleanup register_cleanup;\n static ld_plugin_add_input_file add_input_file;\n static ld_plugin_add_input_library add_input_library;\n static ld_plugin_message message;\n+static ld_plugin_add_symbols add_symbols;\n \n-/* These are not static because the object format dependent\n-   claim_file hooks in lto-plugin-{coff,elf}.c need them.  */\n-ld_plugin_add_symbols add_symbols;\n-\n-struct plugin_file_info *claimed_files = NULL;\n-unsigned int num_claimed_files = 0;\n+static struct plugin_file_info *claimed_files = NULL;\n+static unsigned int num_claimed_files = 0;\n \n static char **output_files = NULL;\n static unsigned int num_output_files = 0;\n@@ -79,7 +142,12 @@ static bool debug;\n static bool nop;\n static char *resolution_file = NULL;\n \n-void\n+/* Set by default from configure.ac, but can be overridden at runtime\n+   by using -plugin-opt=-sym-style={none,win32,underscore|uscore}\n+   (in fact, only first letter of style arg is checked.)  */\n+static enum symbol_style sym_style = SYM_STYLE;\n+\n+static void\n check (bool gate, enum ld_plugin_level level, const char *text)\n {\n   if (gate)\n@@ -100,7 +168,7 @@ check (bool gate, enum ld_plugin_level level, const char *text)\n    by P and the result is written in ENTRY. The slot number is stored in SLOT.\n    Returns the address of the next entry. */\n \n-char *\n+static char *\n parse_table_entry (char *p, struct ld_plugin_symbol *entry, \n \t\t   struct sym_aux *aux)\n {\n@@ -122,7 +190,24 @@ parse_table_entry (char *p, struct ld_plugin_symbol *entry,\n       LDPV_HIDDEN\n     };\n \n-  entry->name = xstrdup (p);\n+  switch (sym_style)\n+    {\n+    case ss_win32:\n+      if (p[0] == '@')\n+\t{\n+    /* cf. Duff's device.  */\n+    case ss_none:\n+\t  entry->name = xstrdup (p);\n+\t  break;\n+\t}\n+    /* FALL-THROUGH.  */\n+    case ss_uscore:\n+      entry->name = concat (\"_\", p, NULL);\n+      break;\n+    default:\n+      check (false, LDPL_FATAL, \"invalid symbol style requested\");\n+      break;\n+    }\n   while (*p)\n     p++;\n   p++;\n@@ -165,7 +250,7 @@ parse_table_entry (char *p, struct ld_plugin_symbol *entry,\n /* Translate the IL symbol table located between DATA and END. Append the\n    slots and symbols to OUT. */\n \n-void\n+static void\n translate (char *data, char *end, struct plugin_symtab *out)\n {\n   struct sym_aux *aux;\n@@ -621,7 +706,7 @@ static int symbol_strength (struct ld_plugin_symbol *s)\n    \n    XXX how to handle common? */\n \n-void\n+static void\n resolve_conflicts (struct plugin_symtab *t, struct plugin_symtab *conflicts)\n {\n   htab_t symtab = htab_create (t->nsyms, hash_sym, eq_sym, NULL);\n@@ -689,6 +774,124 @@ resolve_conflicts (struct plugin_symtab *t, struct plugin_symtab *conflicts)\n   htab_delete (symtab);\n }\n \n+/* Process one section of an object file.  */\n+\n+static int \n+process_symtab (void *data, const char *name, off_t offset, off_t length)\n+{\n+  struct plugin_objfile *obj = (struct plugin_objfile *)data;\n+  char *s;\n+  char *secdata;\n+\n+  if (strncmp (name, LTO_SECTION_PREFIX, LTO_SECTION_PREFIX_LEN) != 0)\n+    return 1;\n+\n+  s = strrchr (name, '.');\n+  if (s)\n+    sscanf (s, \".%x\", &obj->out->id);\n+  secdata = xmalloc (length);\n+  offset += obj->file->offset;\n+  if (offset != lseek (obj->file->fd, offset, SEEK_SET)\n+\t|| length != read (obj->file->fd, secdata, length))\n+    {\n+      if (message)\n+\tmessage (LDPL_FATAL, \"%s: corrupt object file\", obj->file->name);\n+      /* Force claim_file_handler to abandon this file.  */\n+      obj->found = 0;\n+      free (secdata);\n+      return 0;\n+    }\n+\n+  translate (secdata, secdata + length, obj->out);\n+  obj->found++;\n+  free (secdata);\n+  return 1;\n+}\n+\n+/* Callback used by gold to check if the plugin will claim FILE. Writes\n+   the result in CLAIMED. */\n+\n+static enum ld_plugin_status\n+claim_file_handler (const struct ld_plugin_input_file *file, int *claimed)\n+{\n+  enum ld_plugin_status status;\n+  struct plugin_objfile obj;\n+  struct plugin_file_info lto_file;\n+  int err;\n+  const char *errmsg;\n+\n+  memset (&lto_file, 0, sizeof (struct plugin_file_info));\n+\n+  if (file->offset != 0)\n+    {\n+      char *objname;\n+      /* We pass the offset of the actual file, not the archive header. */\n+      int t = asprintf (&objname, \"%s@0x%\" PRIx64, file->name,\n+                        (int64_t) file->offset);\n+      check (t >= 0, LDPL_FATAL, \"asprintf failed\");\n+      lto_file.name = objname;\n+    }\n+  else\n+    {\n+      lto_file.name = xstrdup (file->name);\n+    }\n+  lto_file.handle = file->handle;\n+\n+  *claimed = 0;\n+  obj.file = file;\n+  obj.found = 0;\n+  obj.out = &lto_file.symtab;\n+  errmsg = NULL;\n+  obj.objfile = simple_object_start_read (file->fd, file->offset, LTO_SEGMENT_NAME,\n+\t\t\t&errmsg, &err);\n+  /* No file, but also no error code means unrecognized format; just skip it.  */\n+  if (!obj.objfile && !err)\n+    goto err;\n+\n+  if (obj.objfile)\n+    errmsg = simple_object_find_sections (obj.objfile, process_symtab, &obj, &err);\n+\n+  if (!obj.objfile || errmsg)\n+    {\n+      if (err && message)\n+\tmessage (LDPL_FATAL, \"%s: %s: %s\", file->name, errmsg,\n+\t\txstrerror (err));\n+      else if (message)\n+\tmessage (LDPL_FATAL, \"%s: %s\", file->name, errmsg);\n+      goto err;\n+    }\n+\n+  if (obj.found == 0)\n+    goto err;\n+\n+  if (obj.found > 1)\n+    resolve_conflicts (&lto_file.symtab, &lto_file.conflicts);\n+\n+  status = add_symbols (file->handle, lto_file.symtab.nsyms,\n+\t\t\tlto_file.symtab.syms);\n+  check (status == LDPS_OK, LDPL_FATAL, \"could not add symbols\");\n+\n+  *claimed = 1;\n+  num_claimed_files++;\n+  claimed_files =\n+    xrealloc (claimed_files,\n+\t      num_claimed_files * sizeof (struct plugin_file_info));\n+  claimed_files[num_claimed_files - 1] = lto_file;\n+\n+  goto cleanup;\n+\n+ err:\n+  free (lto_file.name);\n+\n+ cleanup:\n+  if (obj.objfile)\n+    simple_object_release_read (obj.objfile);\n+  if (file->fd >= 0)\n+    close (file->fd);\n+\n+  return LDPS_OK;\n+}\n+\n /* Parse the plugin options. */\n \n static void\n@@ -706,6 +909,21 @@ process_option (const char *option)\n       pass_through_items[num_pass_through_items - 1] =\n           xstrdup (option + strlen (\"-pass-through=\"));\n     }\n+  else if (!strncmp (option, \"-sym-style=\", sizeof (\"-sym-style=\") - 1))\n+    {\n+      switch (option[sizeof (\"-sym-style=\") - 1])\n+\t{\n+\tcase 'w':\n+\t  sym_style = ss_win32;\n+\t  break;\n+\tcase 'u':\n+\t  sym_style = ss_uscore;\n+\t  break;\n+\tdefault:\n+\t  sym_style = ss_none;\n+\t  break;\n+\t}\n+    }\n   else\n     {\n       int size;\n@@ -727,10 +945,6 @@ onload (struct ld_plugin_tv *tv)\n   struct ld_plugin_tv *p;\n   enum ld_plugin_status status;\n \n-  status = onload_format_checks (tv);\n-  if (status != LDPS_OK)\n-    return status;\n-\n   p = tv;\n   while (p->tv_tag)\n     {"}, {"sha": "09eb85003a7b5d14606c48af360c59c9d3a71065", "filename": "lto-plugin/lto-plugin.h", "status": "removed", "additions": 0, "deletions": 84, "changes": 84, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03f43d3d3c6909ead8325e86a947f66ba8b83141/lto-plugin%2Flto-plugin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03f43d3d3c6909ead8325e86a947f66ba8b83141/lto-plugin%2Flto-plugin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/lto-plugin%2Flto-plugin.h?ref=03f43d3d3c6909ead8325e86a947f66ba8b83141", "patch": "@@ -1,84 +0,0 @@\n-/* Common declarations for LTO plugin for gold and/or GNU ld.\n-   Copyright (C) 2009, 2010 Free Software Foundation, Inc.\n-   Contributed by Rafael Avila de Espindola (espindola@google.com).\n-\n-This program is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3, or (at your option)\n-any later version.\n-\n-This program is distributed in the hope that it will be useful, but\n-WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with this program; see the file COPYING3.  If not see\n-<http://www.gnu.org/licenses/>.  */\n-\n-#include <stdbool.h>\n-#include \"plugin-api.h\"\n-\n-/* LTO magic section name.  */\n-\n-#define LTO_SECTION_PREFIX \".gnu.lto_.symtab\"\n-\n-/* The part of the symbol table the plugin has to keep track of. Note that we\n-   must keep SYMS until all_symbols_read is called to give the linker time to\n-   copy the symbol information. */\n-\n-struct sym_aux\n-{\n-  uint32_t slot;\n-  unsigned id;\n-  unsigned next_conflict;\n-};\n-\n-struct plugin_symtab\n-{\n-  int nsyms;\n-  struct sym_aux *aux;\n-  struct ld_plugin_symbol *syms;\n-  unsigned id;\n-};\n-\n-/* All that we have to remember about a file. */\n-\n-struct plugin_file_info\n-{\n-  char *name;\n-  void *handle;\n-  struct plugin_symtab symtab;\n-  struct plugin_symtab conflicts;\n-};\n-\n-/* These are the methods supplied by one of the object format\n-   dependent files lto-plugin-elf.c or lto-plugin-coff.c  */\n-\n-extern enum ld_plugin_status claim_file_handler \n-\t\t(const struct ld_plugin_input_file *file, int *claimed);\n-\n-extern enum ld_plugin_status onload_format_checks (struct ld_plugin_tv *tv);\n-\n-/* These methods are made available to the object format\n-   dependent files.  */\n-\n-extern void check (bool gate, enum ld_plugin_level level, const char *text);\n-\n-extern void translate (char *data, char *end, struct plugin_symtab *out);\n-\n-extern char *parse_table_entry (char *p, struct ld_plugin_symbol *entry,\n-\t\t\tstruct sym_aux *aux);\n-\n-extern void resolve_conflicts (struct plugin_symtab *t,\n-\t\t\tstruct plugin_symtab *conflicts);\n-\n-/* And this callback function is exposed.  */\n-\n-extern ld_plugin_add_symbols add_symbols;\n-\n-/* Along with these two variables.  */\n-\n-extern struct plugin_file_info *claimed_files;\n-extern unsigned int num_claimed_files;\n-"}]}