{"sha": "2f0610acbc056052a108e4a46911fc21d0dca2ab", "node_id": "C_kwDOANBUbNoAKDJmMDYxMGFjYmMwNTYwNTJhMTA4ZTRhNDY5MTFmYzIxZDBkY2EyYWI", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-04T11:56:32Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-04-04T11:56:32Z"}, "message": "aarch64: Restrict aarch64-tune.md regeneration to --enable-maintainer-mode [PR105144]\n\nNormally updates to the source directory files are guarded with\n--enable-maintainer-mode, e.g. we don't regenerate configure, config.h,\nMakefile.in in directories that use automake etc. unless gcc is configured\nthat way.  Otherwise the source tree can't be e.g. stored on a read-only\nfilesystem etc.\nIn gcc/Makefile.in we use @MAINT@ for that but that works because\ngcc/Makefile is generated by configure.  In config/*/t-* files we need to\ncheck $(ENABLE_MAINTAINER_RULES):\n # The following provides the variable ENABLE_MAINTAINER_RULES that can\n # be used in language Make-lang.in makefile fragments to enable\n # maintainer rules.  So, ENABLE_MAINTAINER_RULES is 'true' in\n # maintainer mode, and '' otherwise.\n @MAINT@ ENABLE_MAINTAINER_RULES = true\n\nOn Mon, Apr 04, 2022 at 11:10:14AM +0100, Richard Sandiford wrote:\n> I guess the risk is that it will become even easier to forget\n> to commit an updated aarch64-tune.md.  Perhaps we should have a\n> non-maintainer rule to build aarch64-tune.md locally and check it\n> against the source-directory version, and fail the build if there's\n> a mismatch.  Or maybe we should just generate aarch64-tune.md in the\n> build directory and remove the source directory version.\n\nI've tried if aarch64-tune.md will be read from the build dir, but it is\nnot.  The gen* files can use -I options to add additional directories, but\nthey don't use them.\n\nHere is a variant patch which will complain and fail if there is a change\nand --enable-maintainer-mode is not enabled.\n\n2022-04-04  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/105144\n\t* config/aarch64/t-aarch64 (s-aarch64-tune-md): Do move-if-change\n\tonly if configured with --enable-maintainer-mode, otherwise compare\n\ttmp-aarch64-tune.md with $(srcdir)/config/aarch64/aarch64-tune.md and\n\tif they differ, emit a message and fail.", "tree": {"sha": "f8f680efdfa08c0acd76e3fd62e5408a1f9e460e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8f680efdfa08c0acd76e3fd62e5408a1f9e460e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f0610acbc056052a108e4a46911fc21d0dca2ab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f0610acbc056052a108e4a46911fc21d0dca2ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f0610acbc056052a108e4a46911fc21d0dca2ab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f0610acbc056052a108e4a46911fc21d0dca2ab/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "88cffa1a07d04187be1975238dfdca51a8ef5d65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88cffa1a07d04187be1975238dfdca51a8ef5d65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88cffa1a07d04187be1975238dfdca51a8ef5d65"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "ba74abc0a43657e98184b5d1aab3640f56e99abd", "filename": "gcc/config/aarch64/t-aarch64", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f0610acbc056052a108e4a46911fc21d0dca2ab/gcc%2Fconfig%2Faarch64%2Ft-aarch64", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f0610acbc056052a108e4a46911fc21d0dca2ab/gcc%2Fconfig%2Faarch64%2Ft-aarch64", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Ft-aarch64?ref=2f0610acbc056052a108e4a46911fc21d0dca2ab", "patch": "@@ -30,8 +30,18 @@ s-aarch64-tune-md: $(srcdir)/config/aarch64/gentune.sh \\\n \t$(SHELL) $(srcdir)/config/aarch64/gentune.sh \\\n \t\t$(srcdir)/config/aarch64/aarch64-cores.def > \\\n \t\ttmp-aarch64-tune.md\n+ifneq ($(strip $(ENABLE_MAINTAINER_RULES)),)\n \t$(SHELL) $(srcdir)/../move-if-change tmp-aarch64-tune.md \\\n \t\t$(srcdir)/config/aarch64/aarch64-tune.md\n+else\n+\t@if ! cmp -s tmp-aarch64-tune.md \\\n+\t  $(srcdir)/config/aarch64/aarch64-tune.md; then \\\n+\t  echo \"aarch64-tune.md has changed; either\"; \\\n+\t  echo \"configure with --enable-maintainer-mode\"; \\\n+\t  echo \"or copy tmp-aarch64-tune.md to $(srcdir)/config/aarch64/aarch64-tune.md\"; \\\n+\t  exit 1; \\\n+\tfi\n+endif\n \t$(STAMP) s-aarch64-tune-md\n \n s-mddeps: s-aarch64-tune-md"}]}