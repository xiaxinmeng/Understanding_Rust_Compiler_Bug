{"sha": "7b39e3c24f912f274ea2127ca7fc3133bf97a911", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2IzOWUzYzI0ZjkxMmYyNzRlYTIxMjdjYTdmYzMxMzNiZjk3YTkxMQ==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-12-03T03:26:09Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-12-03T03:26:09Z"}, "message": "re PR fortran/83225 (runtime error in transfer.c)\n\n2017-12-02  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libgfortran/83225\n\t* io/io.h (is_internal_unit): Use the unit_is_internal bit.\n\t* io/transfer.c (data_transfer_init): Set the bit to true for\n\tinternal umits. Use that bit for checks for internal unit\n\tinitializations.\n\t* io/unit.c (insert_unit): As a precaution, set the\n\tinternal_unit_kind to zero when a unit structure is first created.\n\nFrom-SVN: r255362", "tree": {"sha": "af7bfb1c126c7ac0f9cba1f37be28fd90041d885", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/af7bfb1c126c7ac0f9cba1f37be28fd90041d885"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b39e3c24f912f274ea2127ca7fc3133bf97a911", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b39e3c24f912f274ea2127ca7fc3133bf97a911", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b39e3c24f912f274ea2127ca7fc3133bf97a911", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b39e3c24f912f274ea2127ca7fc3133bf97a911/comments", "author": null, "committer": null, "parents": [{"sha": "acffd4fd6404bee31508007af5942192a78ab016", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acffd4fd6404bee31508007af5942192a78ab016", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acffd4fd6404bee31508007af5942192a78ab016"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "37b5281bde6e5890e8b1d9a1c7f720965c968762", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=7b39e3c24f912f274ea2127ca7fc3133bf97a911", "patch": "@@ -1,3 +1,13 @@\n+2017-12-02  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/83225\n+\t* io/io.h (is_internal_unit): Use the unit_is_internal bit.\n+\t* io/transfer.c (data_transfer_init): Set the bit to true for\n+\tinternal umits. Use that bit for checks for internal unit\n+\tinitializations.\n+\t* io/unit.c (insert_unit): As a precaution, set the\n+\tinternal_unit_kind to zero when a unit structure is first created.\n+\n 2017-11-28  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR fortran/53796"}, {"sha": "c5e73d80eadb7b487ce5d953e63e9195666ba3ac", "filename": "libgfortran/io/io.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2Fio%2Fio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2Fio%2Fio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fio.h?ref=7b39e3c24f912f274ea2127ca7fc3133bf97a911", "patch": "@@ -69,7 +69,7 @@ internal_proto(old_locale_lock);\n \n #define is_array_io(dtp) ((dtp)->internal_unit_desc)\n \n-#define is_internal_unit(dtp) ((dtp)->u.p.current_unit->internal_unit_kind)\n+#define is_internal_unit(dtp) ((dtp)->u.p.unit_is_internal)\n \n #define is_stream_io(dtp) ((dtp)->u.p.current_unit->flags.access == ACCESS_STREAM)\n "}, {"sha": "5429a8555416c9016d7ee69e9eb323bf16cf0499", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=7b39e3c24f912f274ea2127ca7fc3133bf97a911", "patch": "@@ -2764,6 +2764,8 @@ data_transfer_init (st_parameter_dt *dtp, int read_flag)\n       else\n \tdtp->u.p.current_unit->has_size = false;\n     }\n+  else if (dtp->u.p.current_unit->internal_unit_kind > 0)\n+    dtp->u.p.unit_is_internal = 1;\n \n   /* Check the action.  */\n \n@@ -4085,7 +4087,7 @@ st_read_done (st_parameter_dt *dtp)\n   if (dtp->u.p.current_unit != NULL\n       && dtp->u.p.current_unit->child_dtio == 0)\n     {\n-      if (is_internal_unit (dtp))\n+      if (dtp->u.p.unit_is_internal)\n \t{\n \t  if ((dtp->common.flags & IOPARM_DT_HAS_UDTIO) == 0)\n \t    {\n@@ -4099,7 +4101,7 @@ st_read_done (st_parameter_dt *dtp)\n \t    }\n \t  newunit_free (dtp->common.unit);\n \t}\n-      if (is_internal_unit (dtp) || dtp->u.p.format_not_saved)\n+      if (dtp->u.p.unit_is_internal || dtp->u.p.format_not_saved)\n \t{\n \t  free_format_data (dtp->u.p.fmt);\n \t  free_format (dtp);\n@@ -4156,7 +4158,7 @@ st_write_done (st_parameter_dt *dtp)\n \n       /* If this is a parent WRITE statement we do not need to retain the\n \t internal unit structure for child use.  */\n-      if (is_internal_unit (dtp))\n+      if (dtp->u.p.unit_is_internal)\n \t{\n \t  if ((dtp->common.flags & IOPARM_DT_HAS_UDTIO) == 0)\n \t    {\n@@ -4170,7 +4172,7 @@ st_write_done (st_parameter_dt *dtp)\n \t    }\n \t  newunit_free (dtp->common.unit);\n \t}\n-      if (is_internal_unit (dtp) || dtp->u.p.format_not_saved)\n+      if (dtp->u.p.unit_is_internal || dtp->u.p.format_not_saved)\n \t{\n \t  free_format_data (dtp->u.p.fmt);\n \t  free_format (dtp);"}, {"sha": "66cd12dcdcd9f2c0310b2173f5ce9fd2fc950965", "filename": "libgfortran/io/unit.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2Fio%2Funit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b39e3c24f912f274ea2127ca7fc3133bf97a911/libgfortran%2Fio%2Funit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funit.c?ref=7b39e3c24f912f274ea2127ca7fc3133bf97a911", "patch": "@@ -231,6 +231,7 @@ insert_unit (int n)\n {\n   gfc_unit *u = xcalloc (1, sizeof (gfc_unit));\n   u->unit_number = n;\n+  u->internal_unit_kind = 0;\n #ifdef __GTHREAD_MUTEX_INIT\n   {\n     __gthread_mutex_t tmp = __GTHREAD_MUTEX_INIT;"}]}