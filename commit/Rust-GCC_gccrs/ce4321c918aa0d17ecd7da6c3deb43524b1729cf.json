{"sha": "ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2U0MzIxYzkxOGFhMGQxN2VjZDdkYTZjM2RlYjQzNTI0YjE3MjljZg==", "commit": {"author": {"name": "Nikhil Benesch", "email": "nikhil.benesch@gmail.com", "date": "2019-02-06T04:48:35Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-02-06T04:48:35Z"}, "message": "re PR go/89019 (LTO and gccgo cause ICE during free_lang_data)\n\ngcc/go:\n        PR go/89019\n        * go-gcc.cc (Gcc_backend::placeholder_struct_type): Mark\n        placeholder structs as requiring structural equality.\n        (Gcc_backend::set_placeholder_pointer_type): Propagate the\n\tcanonical type from the desired pointer type to the placeholder\n\tpointer type.\ngcc/testsuite/:\n        * lib/go-torture.exp: Test compiling with -flto.\n\nFrom-SVN: r268572", "tree": {"sha": "33a6eb37062d4aecdffb413b9a1a362331168574", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33a6eb37062d4aecdffb413b9a1a362331168574"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/comments", "author": {"login": "benesch", "id": 882976, "node_id": "MDQ6VXNlcjg4Mjk3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/882976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benesch", "html_url": "https://github.com/benesch", "followers_url": "https://api.github.com/users/benesch/followers", "following_url": "https://api.github.com/users/benesch/following{/other_user}", "gists_url": "https://api.github.com/users/benesch/gists{/gist_id}", "starred_url": "https://api.github.com/users/benesch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benesch/subscriptions", "organizations_url": "https://api.github.com/users/benesch/orgs", "repos_url": "https://api.github.com/users/benesch/repos", "events_url": "https://api.github.com/users/benesch/events{/privacy}", "received_events_url": "https://api.github.com/users/benesch/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fbe83e6b4d0308f547ab11de6dc0eda2741cc11f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbe83e6b4d0308f547ab11de6dc0eda2741cc11f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbe83e6b4d0308f547ab11de6dc0eda2741cc11f"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "d75aea951f5dc8cdd95e5712099f8677238851d6", "filename": "gcc/go/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Fgo%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Fgo%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2FChangeLog?ref=ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "patch": "@@ -1,3 +1,12 @@\n+2019-02-05  Nikhil Benesch  <nikhil.benesch@gmail.com>\n+\n+        PR go/89019\n+        * go-gcc.cc (Gcc_backend::placeholder_struct_type): Mark\n+        placeholder structs as requiring structural equality.\n+        (Gcc_backend::set_placeholder_pointer_type): Propagate the\n+\tcanonical type from the desired pointer type to the placeholder\n+\tpointer type.\n+\n 2019-01-09  Ian Lance Taylor  <iant@golang.org>\n \n \tPR go/86343"}, {"sha": "4e9e0e3026a64413e80c43349561e8b4f442a87b", "filename": "gcc/go/go-gcc.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Fgo%2Fgo-gcc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Fgo%2Fgo-gcc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgo-gcc.cc?ref=ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "patch": "@@ -1049,6 +1049,7 @@ Gcc_backend::set_placeholder_pointer_type(Btype* placeholder,\n     }\n   gcc_assert(TREE_CODE(tt) == POINTER_TYPE);\n   TREE_TYPE(pt) = TREE_TYPE(tt);\n+  TYPE_CANONICAL(pt) = TYPE_CANONICAL(tt);\n   if (TYPE_NAME(pt) != NULL_TREE)\n     {\n       // Build the data structure gcc wants to see for a typedef.\n@@ -1080,6 +1081,12 @@ Gcc_backend::placeholder_struct_type(const std::string& name,\n \t\t\t     get_identifier_from_string(name),\n \t\t\t     ret);\n       TYPE_NAME(ret) = decl;\n+\n+      // The struct type that eventually replaces this placeholder will require\n+      // structural equality. The placeholder must too, so that the requirement\n+      // for structural equality propagates to references that are constructed\n+      // before the replacement occurs.\n+      SET_TYPE_STRUCTURAL_EQUALITY(ret);\n     }\n   return this->make_type(ret);\n }"}, {"sha": "0dd171c9647bd12c164c5201346cd27f2d016836", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "patch": "@@ -1,3 +1,8 @@\n+2019-02-05  Nikhil Benesch  <nikhil.benesch@gmail.com>\n+\n+        PR go/89019\n+        * lib/go-torture.exp: Test compiling with -flto.\n+\n 2019-02-06  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR c/88584"}, {"sha": "a7eca1844167f791788c0821a9f404740d2e95f9", "filename": "gcc/testsuite/lib/go-torture.exp", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Ftestsuite%2Flib%2Fgo-torture.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ce4321c918aa0d17ecd7da6c3deb43524b1729cf/gcc%2Ftestsuite%2Flib%2Fgo-torture.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgo-torture.exp?ref=ce4321c918aa0d17ecd7da6c3deb43524b1729cf", "patch": "@@ -34,7 +34,8 @@ if ![info exists TORTURE_OPTIONS] {\n \t{ -O2 -fomit-frame-pointer -finline-functions -funroll-loops } \\\n \t{ -O2 -fbounds-check } \\\n \t{ -O3 -g } \\\n-\t{ -Os }]\n+\t{ -Os } \\\n+\t{ -flto }]\n }\n \n "}]}