{"sha": "c288810f69853733df4452f25b78baaae0350a6c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzI4ODgxMGY2OTg1MzczM2RmNDQ1MmYyNWI3OGJhYWFlMDM1MGE2Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-10-31T11:18:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-10-31T11:18:13Z"}, "message": "re PR sanitizer/63697 (-fsanitize=undefined doesn't detect some subtraction overflows)\n\n\tPR sanitizer/63697\n\t* tree-vrp.c (simplify_internal_call_using_ranges): For subcode ==\n\tMINUS_EXPR, check overflow on vr0.min - vr1.max and vr0.max - vr1.min\n\tinstead of vr0.min - vr1.min and vr0.max - vr1.max.\n\n\t* c-c++-common/ubsan/overflow-sub-3.c: New test.\n\nFrom-SVN: r216962", "tree": {"sha": "ff9d28eec53e7130189a016c309bdf94e61e8086", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff9d28eec53e7130189a016c309bdf94e61e8086"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c288810f69853733df4452f25b78baaae0350a6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c288810f69853733df4452f25b78baaae0350a6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c288810f69853733df4452f25b78baaae0350a6c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c288810f69853733df4452f25b78baaae0350a6c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6fd52b789342ed9e37869891e07cd445b8f3e0bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fd52b789342ed9e37869891e07cd445b8f3e0bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6fd52b789342ed9e37869891e07cd445b8f3e0bd"}], "stats": {"total": 52, "additions": 50, "deletions": 2}, "files": [{"sha": "5ffc217e6347c8a4719e8c7b6c87aba5604e5c61", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c288810f69853733df4452f25b78baaae0350a6c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c288810f69853733df4452f25b78baaae0350a6c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c288810f69853733df4452f25b78baaae0350a6c", "patch": "@@ -1,3 +1,10 @@\n+2014-10-31  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/63697\n+\t* tree-vrp.c (simplify_internal_call_using_ranges): For subcode ==\n+\tMINUS_EXPR, check overflow on vr0.min - vr1.max and vr0.max - vr1.min\n+\tinstead of vr0.min - vr1.min and vr0.max - vr1.max.\n+\n 2014-10-31  Max Ostapenko  <m.ostapenko@partner.samsung.com>\n \n \tPR ipa/63696"}, {"sha": "7892292e078315a9e6feabb125ab2c48a46a2192", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c288810f69853733df4452f25b78baaae0350a6c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c288810f69853733df4452f25b78baaae0350a6c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c288810f69853733df4452f25b78baaae0350a6c", "patch": "@@ -1,3 +1,8 @@\n+2014-10-31  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/63697\n+\t* c-c++-common/ubsan/overflow-sub-3.c: New test.\n+\n 2014-10-30  Marek Polacek  <polacek@redhat.com>\n \n \t* gcc.dg/diag-aka-1.c: New test."}, {"sha": "deec5c411ba0f2f41b5936263ad4017484168d91", "filename": "gcc/testsuite/c-c++-common/ubsan/overflow-sub-3.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c288810f69853733df4452f25b78baaae0350a6c/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Foverflow-sub-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c288810f69853733df4452f25b78baaae0350a6c/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Foverflow-sub-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Foverflow-sub-3.c?ref=c288810f69853733df4452f25b78baaae0350a6c", "patch": "@@ -0,0 +1,34 @@\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=signed-integer-overflow\" } */\n+\n+__attribute__((noinline, noclone)) int\n+foo1 (int x, int y)\n+{\n+  return x - y;\n+}\n+\n+__attribute__((noinline, noclone)) int\n+foo2 (int x, int y)\n+{\n+  unsigned int xa = (unsigned int) x - (__INT_MAX__ - 3);\n+  xa &= 3;\n+  x = __INT_MAX__ - 3 + xa;\n+  unsigned int ya = y + 1U;\n+  ya &= 1;\n+  y = ya - 1;\n+  return x - y;\n+}\n+\n+int\n+main ()\n+{\n+  int xm1, y;\n+  for (xm1 = __INT_MAX__ - 4; xm1 < __INT_MAX__; xm1++)\n+    for (y = -1; y <= 0; y++)\n+      if (foo1 (xm1 + 1, y) != (int) (xm1 + 1U - y)\n+\t  || foo2 (xm1 + 1, y) != (int) (xm1 + 1U - y))\n+\t__builtin_abort ();\n+  return 0;\n+}\n+/* { dg-output \":7:\\[0-9]\\[^\\n\\r]*signed integer overflow: 2147483647 - -1 cannot be represented in type 'int'\\[^\\n\\r]*(\\n|\\r\\n|\\r)\" } */\n+/* { dg-output \"\\[^\\n\\r]*:19:\\[0-9]\\[^\\n\\r]*signed integer overflow: 2147483647 - -1 cannot be represented in type 'int'\" } */"}, {"sha": "fe67230bedf516efe1ed8bc31d3a20c6ac400b83", "filename": "gcc/tree-vrp.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c288810f69853733df4452f25b78baaae0350a6c/gcc%2Ftree-vrp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c288810f69853733df4452f25b78baaae0350a6c/gcc%2Ftree-vrp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vrp.c?ref=c288810f69853733df4452f25b78baaae0350a6c", "patch": "@@ -9538,8 +9538,10 @@ simplify_internal_call_using_ranges (gimple_stmt_iterator *gsi, gimple stmt)\n     }\n   else\n     {\n-      tree r1 = int_const_binop (subcode, vr0.min, vr1.min);\n-      tree r2 = int_const_binop (subcode, vr0.max, vr1.max);\n+      tree r1 = int_const_binop (subcode, vr0.min,\n+\t\t\t\t subcode == MINUS_EXPR ? vr1.max : vr1.min);\n+      tree r2 = int_const_binop (subcode, vr0.max,\n+\t\t\t\t subcode == MINUS_EXPR ? vr1.min : vr1.max);\n       if (r1 == NULL_TREE || TREE_OVERFLOW (r1)\n \t  || r2 == NULL_TREE || TREE_OVERFLOW (r2))\n \treturn false;"}]}