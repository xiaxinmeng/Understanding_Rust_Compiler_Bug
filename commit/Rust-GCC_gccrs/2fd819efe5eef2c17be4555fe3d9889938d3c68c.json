{"sha": "2fd819efe5eef2c17be4555fe3d9889938d3c68c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZkODE5ZWZlNWVlZjJjMTdiZTQ1NTVmZTNkOTg4OTkzOGQzYzY4Yw==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2002-05-03T18:22:58Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2002-05-03T18:22:58Z"}, "message": "re PR libstdc++/6549 (std::getline(std::cin,s) work wrong at FreeBSD 4.5)\n\n\n2002-05-03  Benjamin Kosnik  <bkoz@redhat.com>\n\n\tPR libstdc++/6549.\n\t* include/bits/fstream.tcc (filebuf::_M_underflow_common): Revert.\n\t* testsuite/27_io/narrow_stream_objects.cc (test07): Add.\n\nFrom-SVN: r53107", "tree": {"sha": "7b7d0dd3f477f7eba8209b63ad147c86c33dca85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7b7d0dd3f477f7eba8209b63ad147c86c33dca85"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fd819efe5eef2c17be4555fe3d9889938d3c68c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fd819efe5eef2c17be4555fe3d9889938d3c68c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fd819efe5eef2c17be4555fe3d9889938d3c68c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fd819efe5eef2c17be4555fe3d9889938d3c68c/comments", "author": null, "committer": null, "parents": [{"sha": "8157303b1e8961a18aa8779a99aea6a7d8dc7116", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8157303b1e8961a18aa8779a99aea6a7d8dc7116", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8157303b1e8961a18aa8779a99aea6a7d8dc7116"}], "stats": {"total": 40, "additions": 25, "deletions": 15}, "files": [{"sha": "cb6dfa94ebac23b1f7e9f2ea14cc4e7a4fe5702d", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd819efe5eef2c17be4555fe3d9889938d3c68c/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd819efe5eef2c17be4555fe3d9889938d3c68c/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=2fd819efe5eef2c17be4555fe3d9889938d3c68c", "patch": "@@ -1,3 +1,9 @@\n+2002-05-03  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\tPR libstdc++/6549.\n+\t* include/bits/fstream.tcc (filebuf::_M_underflow_common): Revert.\n+\t* testsuite/27_io/narrow_stream_objects.cc (test07): Add.\n+\t\n 2002-05-03  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* config/os/irix/irix5.2/bits/ctype_noninline.h (classic_table):"}, {"sha": "90850f54f0d70baad7ff4a1da0e5e1d566ffaf8a", "filename": "libstdc++-v3/include/bits/fstream.tcc", "status": "modified", "additions": 8, "deletions": 15, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd819efe5eef2c17be4555fe3d9889938d3c68c/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd819efe5eef2c17be4555fe3d9889938d3c68c/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc?ref=2fd819efe5eef2c17be4555fe3d9889938d3c68c", "patch": "@@ -182,21 +182,6 @@ namespace std\n \t\treturn traits_type::to_int_type(*_M_in_cur);\n \t    }\n \n-\t  // Check for unbuffered stream.\n-\t  if (_M_buf_size == 1)\n-\t    {\n-\t      int_type __c = _M_file.sys_getc();\n-\t      if (__c != __ret)\n-\t\t{\n-\t\t  __ret = __c;\n-\t\t  *_M_in_cur = traits_type::to_char_type(__c);\n-\t\t  _M_set_determinate(1);\n-\t\t  if (__testout)\n-\t\t    _M_out_cur = _M_in_cur;\n-\t\t}\n-\t      return __ret;\n-\t    }\n-\n \t  // Sync internal and external buffers.\n \t  // NB: __testget -> __testput as _M_buf_unified here.\n \t  bool __testget = _M_in_cur && _M_in_beg < _M_in_cur;\n@@ -251,6 +236,14 @@ namespace std\n \t\t  __ret = traits_type::to_int_type(*_M_in_cur);\n \t\t  if (__bump)\n \t\t    _M_in_cur_move(1);\n+\t\t  else if (_M_buf_size == 1)\n+\t\t    {\n+\t\t      // If we are synced with stdio, we have to unget the\n+\t\t      // character we just read so that the file pointer\n+\t\t      // doesn't move.\n+\t\t      _M_file.sys_ungetc(*_M_in_cur);\n+\t\t      _M_set_indeterminate();\n+\t\t    }\n \t\t}\t   \n \t    }\n \t}"}, {"sha": "016a982c8efc221adc1aa16d7df666570015849e", "filename": "libstdc++-v3/testsuite/27_io/narrow_stream_objects.cc", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fd819efe5eef2c17be4555fe3d9889938d3c68c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fnarrow_stream_objects.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fd819efe5eef2c17be4555fe3d9889938d3c68c/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fnarrow_stream_objects.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fnarrow_stream_objects.cc?ref=2fd819efe5eef2c17be4555fe3d9889938d3c68c", "patch": "@@ -165,6 +165,16 @@ void test06()\n     cerr << \"i == \" << i << endl;\n }\n \n+// libstdc++/6548\n+void test07()\n+{\n+  bool test = true;\n+  std::cout << \"Please, enter 'test':\";\n+  std::string s;\n+  std::getline(std::cin, s, '\\n');\n+  VERIFY( s == \"test\" );\n+}\n+\n int \n main()\n {\n@@ -175,5 +185,6 @@ main()\n   // test04();\n   // test05();\n   // test06();\n+  // test07();\n   return 0;\n }"}]}