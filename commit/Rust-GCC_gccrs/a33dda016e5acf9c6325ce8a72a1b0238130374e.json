{"sha": "a33dda016e5acf9c6325ce8a72a1b0238130374e", "node_id": "C_kwDOANBUbNoAKGEzM2RkYTAxNmU1YWNmOWM2MzI1Y2U4YTcyYTFiMDIzODEzMDM3NGU", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2022-06-22T02:11:02Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2022-06-22T02:11:02Z"}, "message": "libstdc++: eh_globals: gthreads: reset _S_init before deleting key\n\nClear __eh_globals_init's _S_init in the dtor before deleting the\ngthread key.\n\nThis ensures that, in case any code involved in deleting the key\ninteracts with eh_globals, the key that is being deleted won't be\nused, and the non-thread-specific eh_globals fallback will.\n\n\nfor  libstdc++-v3/ChangeLog\n\n\t* libsupc++/eh_globals.cc [!_GLIBCXX_HAVE_TLS]\n\t(__eh_globals_init::~__eh_globals_init): Clear _S_init first.", "tree": {"sha": "349030e6295e9ff0f8c7aa6558add14ceb816073", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/349030e6295e9ff0f8c7aa6558add14ceb816073"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a33dda016e5acf9c6325ce8a72a1b0238130374e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a33dda016e5acf9c6325ce8a72a1b0238130374e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a33dda016e5acf9c6325ce8a72a1b0238130374e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a33dda016e5acf9c6325ce8a72a1b0238130374e/comments", "author": null, "committer": null, "parents": [{"sha": "f129628e8f261b66a34a9626e1f5b0293548a6a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f129628e8f261b66a34a9626e1f5b0293548a6a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f129628e8f261b66a34a9626e1f5b0293548a6a8"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "0aadb692a962516f037a5080ef36dfb17f9cd3ea", "filename": "libstdc++-v3/libsupc++/eh_globals.cc", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a33dda016e5acf9c6325ce8a72a1b0238130374e/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a33dda016e5acf9c6325ce8a72a1b0238130374e/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_globals.cc?ref=a33dda016e5acf9c6325ce8a72a1b0238130374e", "patch": "@@ -119,8 +119,13 @@ struct __eh_globals_init\n   ~__eh_globals_init()\n   {\n     if (_S_init)\n-      __gthread_key_delete(_M_key);\n-    _S_init = false;\n+      {\n+\t/* Set it before the call, so that, should\n+\t   __gthread_key_delete throw an exception, it won't rely on\n+\t   the key being deleted.  */\n+\t_S_init = false;\n+\t__gthread_key_delete(_M_key);\n+      }\n   }\n \n   __eh_globals_init(const __eh_globals_init&) = delete;"}]}