{"sha": "1f94e1d88efeb405a810a72ad61ab637becb3761", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWY5NGUxZDg4ZWZlYjQwNWE4MTBhNzJhZDYxYWI2MzdiZWNiMzc2MQ==", "commit": {"author": {"name": "Francois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-10-19T04:10:58Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-10-19T04:10:58Z"}, "message": "re PR fortran/33795 (Environment variable GFORTRAN_UNBUFFERED_<number> not working)\n\n2007-10-18  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n\t    Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libfortran/33795\n\t* libgfortran.h: Add unbuffered_preconnected.\n\t* io/unix.c (output_stream): Set stream unbuffered flag if\n\toptions.unbuffered_preconnected has been set.\n\t(error_stream): Ditto.\n\t* runtime/environ.c (variable_table): Add to environment variable table\n\tthe entry: GFORTRAN_UNBUFFERED_PRECONNECTED. \n\nCo-Authored-By: Jerry DeLisle <jvdelisle@gcc.gnu.org>\n\nFrom-SVN: r129470", "tree": {"sha": "e8f95541146ff846daf5d9ce7654cb1a96a92a80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8f95541146ff846daf5d9ce7654cb1a96a92a80"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1f94e1d88efeb405a810a72ad61ab637becb3761", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f94e1d88efeb405a810a72ad61ab637becb3761", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f94e1d88efeb405a810a72ad61ab637becb3761", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f94e1d88efeb405a810a72ad61ab637becb3761/comments", "author": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9a832b6f869f95dea2cc2c4840f6d66ef725d9f6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a832b6f869f95dea2cc2c4840f6d66ef725d9f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a832b6f869f95dea2cc2c4840f6d66ef725d9f6"}], "stats": {"total": 59, "additions": 30, "deletions": 29}, "files": [{"sha": "a5415a0ae9a1d82ba324e211455c65a38426a5c3", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=1f94e1d88efeb405a810a72ad61ab637becb3761", "patch": "@@ -1,3 +1,14 @@\n+2007-10-18  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\t    Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libfortran/33795\n+\t* libgfortran.h: Add unbuffered_preconnected.\n+\t* io/unix.c (output_stream): Set stream unbuffered flag if\n+\toptions.unbuffered_preconnected has been set.\n+\t(error_stream): Ditto.\n+\t* runtime/environ.c (variable_table): Add to environment variable table\n+\tthe entry: GFORTRAN_UNBUFFERED_PRECONNECTED. \n+\t\n 2007-10-18  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR libfortran/32021"}, {"sha": "93484ea014c153b797ec7b75f5fdf42bdc36a952", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=1f94e1d88efeb405a810a72ad61ab637becb3761", "patch": "@@ -1411,10 +1411,16 @@ input_stream (void)\n stream *\n output_stream (void)\n {\n+  stream * s;\n+\n #if defined(HAVE_CRLF) && defined(HAVE_SETMODE)\n   setmode (STDOUT_FILENO, O_BINARY);\n #endif\n-  return fd_to_stream (STDOUT_FILENO, PROT_WRITE);\n+\n+  s = fd_to_stream (STDOUT_FILENO, PROT_WRITE);\n+  if (options.unbuffered_preconnected)\n+    ((unix_stream *) s)->unbuffered = 1;\n+  return s;\n }\n \n \n@@ -1424,10 +1430,16 @@ output_stream (void)\n stream *\n error_stream (void)\n {\n+  stream * s;\n+\n #if defined(HAVE_CRLF) && defined(HAVE_SETMODE)\n   setmode (STDERR_FILENO, O_BINARY);\n #endif\n-  return fd_to_stream (STDERR_FILENO, PROT_WRITE);\n+\n+  s = fd_to_stream (STDERR_FILENO, PROT_WRITE);\n+  if (options.unbuffered_preconnected)\n+    ((unix_stream *) s)->unbuffered = 1;\n+  return s;\n }\n \n "}, {"sha": "a30ab19ab6bdbc334c6594ba13e7d7bb2886a436", "filename": "libgfortran/libgfortran.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2Flibgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2Flibgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Flibgfortran.h?ref=1f94e1d88efeb405a810a72ad61ab637becb3761", "patch": "@@ -349,7 +349,7 @@ typedef struct\n   int separator_len;\n   const char *separator;\n \n-  int use_stderr, all_unbuffered, default_recl;\n+  int use_stderr, all_unbuffered, unbuffered_preconnected, default_recl;\n   int fpe, dump_core, backtrace;\n }\n options_t;"}, {"sha": "ba8283e68aa417b99f92b1c59bfcfa0c921d0805", "filename": "libgfortran/runtime/environ.c", "status": "modified", "additions": 4, "deletions": 26, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2Fruntime%2Fenviron.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f94e1d88efeb405a810a72ad61ab637becb3761/libgfortran%2Fruntime%2Fenviron.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2Fenviron.c?ref=1f94e1d88efeb405a810a72ad61ab637becb3761", "patch": "@@ -299,6 +299,10 @@ static variable variable_table[] = {\n    \"If TRUE, all output is unbuffered.  This will slow down large writes \"\n    \"but can be\\nuseful for forcing data to be displayed immediately.\", 0},\n \n+  {\"GFORTRAN_UNBUFFERED_PRECONNECTED\", 0, &options.unbuffered_preconnected,\n+   init_boolean, show_boolean,\n+   \"If TRUE, output to preconnected units is unbuffered.\", 0},\n+\n   {\"GFORTRAN_SHOW_LOCUS\", 1, &options.locus, init_boolean, show_boolean,\n    \"If TRUE, print filename and line number where runtime errors happen.\", 0},\n \n@@ -346,32 +350,6 @@ init_variables (void)\n }\n \n \n-/* check_buffered()-- Given an unit number n, determine if an override\n- * for the stream exists.  Returns zero for unbuffered, one for\n- * buffered or two for not set. */\n-\n-int\n-check_buffered (int n)\n-{\n-  char name[22 + sizeof (n) * 3];\n-  variable v;\n-  int rv;\n-\n-  if (options.all_unbuffered)\n-    return 0;\n-\n-  sprintf (name, \"GFORTRAN_UNBUFFERED_%d\", n);\n-\n-  v.name = name;\n-  v.value = 2;\n-  v.var = &rv;\n-\n-  init_boolean (&v);\n-\n-  return rv;\n-}\n-\n-\n void\n show_variables (void)\n {"}]}