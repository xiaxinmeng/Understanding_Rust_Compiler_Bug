{"sha": "97463b2b878556e244a9aadad64228f9895ac735", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTc0NjNiMmI4Nzg1NTZlMjQ0YTlhYWRhZDY0MjI4Zjk4OTVhYzczNQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2013-09-12T11:18:46Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2013-09-12T11:18:46Z"}, "message": "re PR tree-optimization/58396 (heap-use-after-free at gcc/tree-loop-distribution.c:1959)\n\n2013-09-12  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/58396\n\t* tree-loop-distribution.c (create_rdg_edges): Free unused DDRs.\n\t(build_rdg): Take a loop-nest parameter, fix memleaks.\n\t(distribute_loop): Compute loop-nest here and pass it to build_rdg.\n\nFrom-SVN: r202521", "tree": {"sha": "088579a3a6b4780aa6d680643741245c04c9ff4d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/088579a3a6b4780aa6d680643741245c04c9ff4d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/97463b2b878556e244a9aadad64228f9895ac735", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97463b2b878556e244a9aadad64228f9895ac735", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97463b2b878556e244a9aadad64228f9895ac735", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97463b2b878556e244a9aadad64228f9895ac735/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "80ecd89daba634ae7725ccc5e53fc3099273de8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80ecd89daba634ae7725ccc5e53fc3099273de8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80ecd89daba634ae7725ccc5e53fc3099273de8d"}], "stats": {"total": 46, "additions": 30, "deletions": 16}, "files": [{"sha": "2e5d31aa32427b91722334fb15fa308971057db7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97463b2b878556e244a9aadad64228f9895ac735/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97463b2b878556e244a9aadad64228f9895ac735/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=97463b2b878556e244a9aadad64228f9895ac735", "patch": "@@ -1,3 +1,10 @@\n+2013-09-12  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/58396\n+\t* tree-loop-distribution.c (create_rdg_edges): Free unused DDRs.\n+\t(build_rdg): Take a loop-nest parameter, fix memleaks.\n+\t(distribute_loop): Compute loop-nest here and pass it to build_rdg.\n+\n 2013-09-12  Yuri Rumyantsev  <ysrumyan@gmail.com>\n \n \t* config/i386/x86-tune.def: Turn on X86_TUNE_AVOID_MEM_OPND_FOR_CMOVE"}, {"sha": "a404e00c2944db4d76cbc8b1e62397f8e8d6940c", "filename": "gcc/tree-loop-distribution.c", "status": "modified", "additions": 23, "deletions": 16, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97463b2b878556e244a9aadad64228f9895ac735/gcc%2Ftree-loop-distribution.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97463b2b878556e244a9aadad64228f9895ac735/gcc%2Ftree-loop-distribution.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-loop-distribution.c?ref=97463b2b878556e244a9aadad64228f9895ac735", "patch": "@@ -383,6 +383,8 @@ create_rdg_edges (struct graph *rdg, vec<ddr_p> ddrs)\n   FOR_EACH_VEC_ELT (ddrs, i, ddr)\n     if (DDR_ARE_DEPENDENT (ddr) == NULL_TREE)\n       create_rdg_edge_for_ddr (rdg, ddr);\n+    else\n+      free_dependence_relation (ddr);\n \n   for (i = 0; i < rdg->n_vertices; i++)\n     FOR_EACH_PHI_OR_STMT_DEF (def_p, RDG_STMT (rdg, i),\n@@ -519,50 +521,45 @@ free_rdg (struct graph *rdg)\n }\n \n /* Build the Reduced Dependence Graph (RDG) with one vertex per\n-   statement of the loop nest, and one edge per data dependence or\n+   statement of the loop nest LOOP_NEST, and one edge per data dependence or\n    scalar dependence.  */\n \n static struct graph *\n-build_rdg (struct loop *loop)\n+build_rdg (vec<loop_p> loop_nest)\n {\n   struct graph *rdg;\n-  vec<loop_p> loop_nest;\n   vec<gimple> stmts;\n   vec<data_reference_p> datarefs;\n   vec<ddr_p> dependence_relations;\n \n-  loop_nest.create (3);\n-  if (!find_loop_nest (loop, &loop_nest))\n-    {\n-      loop_nest.release ();\n-      return NULL;\n-    }\n-\n+  /* Create the RDG vertices from the stmts of the loop nest.  */\n   stmts.create (10);\n-  stmts_from_loop (loop, &stmts);\n+  stmts_from_loop (loop_nest[0], &stmts);\n   rdg = build_empty_rdg (stmts.length ());\n   datarefs.create (10);\n-  if (!create_rdg_vertices (rdg, stmts, loop, &datarefs))\n+  if (!create_rdg_vertices (rdg, stmts, loop_nest[0], &datarefs))\n     {\n       stmts.release ();\n+      datarefs.release ();\n       free_rdg (rdg);\n       return NULL;\n     }\n   stmts.release ();\n+\n+  /* Create the RDG edges from the data dependences in the loop nest.  */\n   dependence_relations.create (100);\n   if (!compute_all_dependences (datarefs, &dependence_relations, loop_nest,\n \t\t\t\tfalse)\n       || !known_dependences_p (dependence_relations))\n     {\n-      loop_nest.release ();\n+      free_dependence_relations (dependence_relations);\n       datarefs.release ();\n-      dependence_relations.release ();\n       free_rdg (rdg);\n       return NULL;\n     }\n-  loop_nest.release ();\n   create_rdg_edges (rdg, dependence_relations);\n   dependence_relations.release ();\n+  datarefs.release ();\n \n   return rdg;\n }\n@@ -1809,15 +1806,24 @@ distribute_loop (struct loop *loop, vec<gimple> stmts)\n   gimple s;\n   unsigned i;\n   vec<int> vertices;\n+  vec<loop_p> loop_nest;\n \n-  rdg = build_rdg (loop);\n+  loop_nest.create (3);\n+  if (!find_loop_nest (loop, &loop_nest))\n+    {\n+      loop_nest.release ();\n+      return 0;\n+    }\n+\n+  rdg = build_rdg (loop_nest);\n   if (!rdg)\n     {\n       if (dump_file && (dump_flags & TDF_DETAILS))\n \tfprintf (dump_file,\n \t\t \"FIXME: Loop %d not distributed: failed to build the RDG.\\n\",\n \t\t loop->num);\n \n+      loop_nest.release ();\n       return res;\n     }\n \n@@ -1843,6 +1849,7 @@ distribute_loop (struct loop *loop, vec<gimple> stmts)\n   res = ldist_gen (loop, rdg, vertices);\n   vertices.release ();\n   free_rdg (rdg);\n+  loop_nest.release ();\n   return res;\n }\n "}]}