{"sha": "fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmQyOGY2N2IyZjJiYjhiMDY0MjM5OTZmZmMzYTNmZjNkMTgyMjdjZA==", "commit": {"author": {"name": "Jeff Sturm", "email": "jsturm@one-point.com", "date": "2002-03-25T18:08:57Z"}, "committer": {"name": "Jeff Sturm", "email": "jsturm@gcc.gnu.org", "date": "2002-03-25T18:08:57Z"}, "message": "* linux_threads.c (GC_get_nprocs): Close file descriptor.\n\nFrom-SVN: r51321", "tree": {"sha": "3a8b4d4ce0f6188e56999c2f3c5b0cb8b7a97439", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3a8b4d4ce0f6188e56999c2f3c5b0cb8b7a97439"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd/comments", "author": null, "committer": null, "parents": [{"sha": "813b848cf20dd3d75def12cf317243a7996b2e67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/813b848cf20dd3d75def12cf317243a7996b2e67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/813b848cf20dd3d75def12cf317243a7996b2e67"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "304c94a145257fb50ece23a49eb3e5b9ed9d88b5", "filename": "boehm-gc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd/boehm-gc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd/boehm-gc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/boehm-gc%2FChangeLog?ref=fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd", "patch": "@@ -1,3 +1,7 @@\n+2002-03-25  Jeff Sturm  <jsturm@one-point.com>\n+\n+\t* linux_threads.c (GC_get_nprocs): Close file descriptor.\n+\n 2002-03-21  Loren J. Rittle  <ljrittle@acm.org>\n \n \t* include/private/gcconfig.h: Add unified test for FreeBSD."}, {"sha": "0bc0f131b106b50ace796ea2ca0318e4839c58a0", "filename": "boehm-gc/linux_threads.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd/boehm-gc%2Flinux_threads.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd/boehm-gc%2Flinux_threads.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/boehm-gc%2Flinux_threads.c?ref=fd28f67b2f2bb8b06423996ffc3a3ff3d18227cd", "patch": "@@ -1015,6 +1015,7 @@ int GC_get_nprocs()\n \tWARN(\"Couldn't read /proc/stat\\n\", 0);\n \treturn -1;\n     }\n+    close(f);\n     for (i = 0; i < len - 100; ++i) {\n         if (stat_buf[i] == '\\n' && stat_buf[i+1] == 'c'\n \t    && stat_buf[i+2] == 'p' && stat_buf[i+3] == 'u') {\n@@ -1358,6 +1359,9 @@ void * GC_start_routine(void * arg)\n \tGC_printf1(\"start_routine = 0x%lx\\n\", start);\n #   endif\n     start_arg = si -> arg;\n+#   ifdef DEBUG_THREADS\n+        GC_printf1(\"sem_post from 0x%lx\\n\", my_pthread);\n+#   endif\n     sem_post(&(si -> registered));\t/* Last action on si.\t*/\n     \t\t\t\t\t/* OK to deallocate.\t*/\n     pthread_cleanup_push(GC_thread_exit_proc, 0);\n@@ -1426,6 +1430,10 @@ WRAP_FUNC(pthread_create)(pthread_t *new_thread,\n         while (0 != sem_wait(&(si -> registered))) {\n \t    if (EINTR != errno) ABORT(\"sem_wait failed\");\n \t}\n+#   ifdef DEBUG_THREADS\n+        GC_printf1(\"sem_wait complete from thread 0x%X\\n\",\n+\t\t   pthread_self());\n+#   endif\n         sem_destroy(&(si -> registered));\n \tLOCK();\n \tGC_INTERNAL_FREE(si);"}]}