{"sha": "5474092c9afbd76cbd457facce3757d8d2fad07b", "node_id": "C_kwDOANBUbNoAKDU0NzQwOTJjOWFmYmQ3NmNiZDQ1N2ZhY2NlMzc1N2Q4ZDJmYWQwN2I", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-12-20T21:01:05Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2021-12-22T18:34:20Z"}, "message": "Fortran: CASE selector expressions must be scalar\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/103776\n\t* match.c (match_case_selector): Reject expressions in CASE\n\tselector which are not scalar.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/103776\n\t* gfortran.dg/select_10.f90: New test.", "tree": {"sha": "de2451b1cfb440bb987eb8e72abe35d04adbf4d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de2451b1cfb440bb987eb8e72abe35d04adbf4d0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5474092c9afbd76cbd457facce3757d8d2fad07b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5474092c9afbd76cbd457facce3757d8d2fad07b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5474092c9afbd76cbd457facce3757d8d2fad07b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5474092c9afbd76cbd457facce3757d8d2fad07b/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c1ce17bc4aed37bc42bbe47210c562ea4fa6864", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c1ce17bc4aed37bc42bbe47210c562ea4fa6864", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c1ce17bc4aed37bc42bbe47210c562ea4fa6864"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "617fb35c9cd1379cf42290bd018c32cf9c5865ed", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5474092c9afbd76cbd457facce3757d8d2fad07b/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5474092c9afbd76cbd457facce3757d8d2fad07b/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=5474092c9afbd76cbd457facce3757d8d2fad07b", "patch": "@@ -6088,6 +6088,19 @@ match_case_selector (gfc_case **cp)\n \t}\n     }\n \n+  if (c->low && c->low->rank != 0)\n+    {\n+      gfc_error (\"Expression in CASE selector at %L must be scalar\",\n+\t\t &c->low->where);\n+      goto cleanup;\n+    }\n+  if (c->high && c->high->rank != 0)\n+    {\n+      gfc_error (\"Expression in CASE selector at %L must be scalar\",\n+\t\t &c->high->where);\n+      goto cleanup;\n+    }\n+\n   *cp = c;\n   return MATCH_YES;\n "}, {"sha": "2d9b0170ce9d4f6c858cc195d758fe3d8f7b6076", "filename": "gcc/testsuite/gfortran.dg/select_10.f90", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5474092c9afbd76cbd457facce3757d8d2fad07b/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_10.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5474092c9afbd76cbd457facce3757d8d2fad07b/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_10.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fselect_10.f90?ref=5474092c9afbd76cbd457facce3757d8d2fad07b", "patch": "@@ -0,0 +1,25 @@\n+! { dg-do compile }\n+! PR fortran/103776 - ICE in gfc_compare_string\n+! Contributed by G.Steinmetz\n+\n+program p\n+  integer :: n\n+  select case (n)\n+  case ([1])        ! { dg-error \"must be scalar\" }\n+  end select\n+  select case (n)\n+  case (:[2])       ! { dg-error \"must be scalar\" }\n+  end select\n+  select case (n)\n+  case (['1'])      ! { dg-error \"must be scalar\" }\n+  end select\n+  select case (n)\n+  case (['1']:2)    ! { dg-error \"must be scalar\" }\n+  end select\n+  select case (n)\n+  case(['1']:['2']) ! { dg-error \"must be scalar\" }\n+  end select\n+  select case (n)\n+  case(1:['2'])     ! { dg-error \"must be scalar\" }\n+  end select\n+end"}]}