{"sha": "b14127e69159d5138b9f345d5275cfbd3a762c4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjE0MTI3ZTY5MTU5ZDUxMzhiOWYzNDVkNTI3NWNmYmQzYTc2MmM0Zg==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonber@gnat.com", "date": "2001-10-12T01:11:33Z"}, "committer": {"name": "Geert Bosch", "email": "bosch@gcc.gnu.org", "date": "2001-10-12T01:11:33Z"}, "message": "exp_ch8.adb (Expand_N_Object_Renaming_Declaration): Bugfix in renaming of discriminant for mutable record type.\n\n\t* exp_ch8.adb (Expand_N_Object_Renaming_Declaration): Bugfix in\n\trenaming of discriminant for mutable record type.\n\nFrom-SVN: r46222", "tree": {"sha": "02db8b5033ed15f2f8fff1feae8780c5ff581f92", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02db8b5033ed15f2f8fff1feae8780c5ff581f92"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b14127e69159d5138b9f345d5275cfbd3a762c4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b14127e69159d5138b9f345d5275cfbd3a762c4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b14127e69159d5138b9f345d5275cfbd3a762c4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b14127e69159d5138b9f345d5275cfbd3a762c4f/comments", "author": null, "committer": null, "parents": [{"sha": "e70ee92a44a5ab3fc7ecaacab4ccc0f826982ff2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e70ee92a44a5ab3fc7ecaacab4ccc0f826982ff2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e70ee92a44a5ab3fc7ecaacab4ccc0f826982ff2"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "be4689941d9dac7d9a4e54aafa24f5d20dc1364a", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b14127e69159d5138b9f345d5275cfbd3a762c4f/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b14127e69159d5138b9f345d5275cfbd3a762c4f/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b14127e69159d5138b9f345d5275cfbd3a762c4f", "patch": "@@ -1,3 +1,8 @@\n+2001-10-11  Ed Schonberg  <schonber@gnat.com>\n+\n+\t* exp_ch8.adb (Expand_N_Object_Renaming_Declaration): Bugfix in \n+\trenaming of discriminant for mutable record type.\n+\n 2001-10-11  Robert Dewar  <dewar@gnat.com>\n \n \t* validsw.adb: Properly save -gnatVn status."}, {"sha": "e59b17fdff5c11a21771d275bd984d5ee24e2fd4", "filename": "gcc/ada/exp_ch8.adb", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b14127e69159d5138b9f345d5275cfbd3a762c4f/gcc%2Fada%2Fexp_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b14127e69159d5138b9f345d5275cfbd3a762c4f/gcc%2Fada%2Fexp_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch8.adb?ref=b14127e69159d5138b9f345d5275cfbd3a762c4f", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---                            $Revision: 1.27 $\n+--                            $Revision$\n --                                                                          --\n --          Copyright (C) 1992-2001 Free Software Foundation, Inc.          --\n --                                                                          --\n@@ -67,6 +67,16 @@ package body Exp_Ch8 is\n    --  to the object will be handled by macro substitution in the front\n    --  end, and the back end will know to ignore the renaming declaration.\n \n+   --  An additional odd case that requires processing by expansion is\n+   --  the renaming of a discriminant of a mutable record type. The object\n+   --  is a constant because it renames something that cannot be assigned to,\n+   --  but in fact the underlying value can change and must be reevaluated\n+   --  at each reference. Gigi does have a notion of a \"constant view\" of\n+   --  an object, and therefore the front-end must perform the expansion.\n+   --  For simplicity, and to bypass some obscure code-generation problem,\n+   --  we use macro substitution for all renamed discriminants, whether the\n+   --  enclosing type is constrained or not.\n+\n    --  The other special processing required is for the case of renaming\n    --  of an object of a class wide type, where it is necessary to build\n    --  the appropriate subtype for the renamed object.\n@@ -203,6 +213,13 @@ package body Exp_Ch8 is\n          elsif Nkind (Nam) = N_Selected_Component then\n             if Present (Component_Clause (Entity (Selector_Name (Nam)))) then\n                return True;\n+\n+            elsif Ekind (Entity (Selector_Name (Nam))) = E_Discriminant\n+              and then Is_Record_Type (Etype (Prefix (Nam)))\n+              and then not Is_Concurrent_Record_Type (Etype (Prefix (Nam)))\n+            then\n+               return True;\n+\n             else\n                return Evaluation_Required (Prefix (Nam));\n             end if;"}]}