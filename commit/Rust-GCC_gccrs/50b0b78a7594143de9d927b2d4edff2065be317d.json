{"sha": "50b0b78a7594143de9d927b2d4edff2065be317d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBiMGI3OGE3NTk0MTQzZGU5ZDkyN2IyZDRlZGZmMjA2NWJlMzE3ZA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2011-11-22T10:19:19Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2011-11-22T10:19:19Z"}, "message": "target.def (tm_clone_table_section): New hook.\n\n\ngcc:\n\n\t* target.def (tm_clone_table_section): New hook.\n\t* doc/tm.texi.in (TARGET_ASM_TM_CLONE_TABLE_SECTION): Define.\n\t* doc/tm.texi: Regenerate.\n\t* varasm.c (dump_tm_clone_pairs): Use target tm_clone_table_section.\n\t* output.h (default_clone_table_section): New prototype.\n\t* config/darwin.h (TARGET_ASM_TM_CLONE_TABLE_SECTION): New.\n\t* config/darwin-protos.h (darwin_tm_clone_table_section): New prototype.\n\t* config/darwin.c (darwin_tm_clone_table_section): New.\n\ngcc/testsuite:\n\n     * gcc.dg/tm/20100615.c: Adjust for Darwin tm_clone_table section name.\n\nFrom-SVN: r181613", "tree": {"sha": "85b8f52e7ea0bebc7684ced5669af4e90f0ec345", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/85b8f52e7ea0bebc7684ced5669af4e90f0ec345"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50b0b78a7594143de9d927b2d4edff2065be317d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50b0b78a7594143de9d927b2d4edff2065be317d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50b0b78a7594143de9d927b2d4edff2065be317d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50b0b78a7594143de9d927b2d4edff2065be317d/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b41ebef72631ec8cf5ffd16537d1274c3fd6800"}], "stats": {"total": 55, "additions": 53, "deletions": 2}, "files": [{"sha": "7b8b19fe518ae8abddb7b0da6291e4f85a60f434", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -1,3 +1,14 @@\n+2011-11-22  Iain Sandoe  <iains@gcc.gnu.org>\n+\n+\t* target.def (tm_clone_table_section): New hook.\n+\t* doc/tm.texi.in (TARGET_ASM_TM_CLONE_TABLE_SECTION): Define.\n+\t* doc/tm.texi: Regenerate.\n+\t* varasm.c (dump_tm_clone_pairs): Use target tm_clone_table_section.\n+\t* output.h (default_clone_table_section): New prototype.\n+\t* config/darwin.h (TARGET_ASM_TM_CLONE_TABLE_SECTION): New.\n+\t* config/darwin-protos.h (darwin_tm_clone_table_section): New prototype.\n+\t* config/darwin.c (darwin_tm_clone_table_section): New.\n+\n 2011-11-21  Torvald Riegel  <triegel@redhat.com>\n \n \t* trans-mem.c (diagnose_tm_1): Print an expression instead of a"}, {"sha": "e0220864facf7f556bdee3a2ff0559d621f80b35", "filename": "gcc/config/darwin-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fconfig%2Fdarwin-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fconfig%2Fdarwin-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-protos.h?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -58,6 +58,7 @@ extern int machopic_reloc_rw_mask (void);\n extern section *machopic_select_section (tree, int, unsigned HOST_WIDE_INT);\n \n extern section *darwin_function_section (tree, enum node_frequency, bool, bool); \n+extern section *darwin_tm_clone_table_section (void);\n extern void darwin_function_switched_text_sections (FILE *, tree, bool);\n \n extern void darwin_unique_section (tree decl, int reloc);"}, {"sha": "b1038f406601527b4f0855d4b4969ac7cb91726c", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -1265,6 +1265,14 @@ darwin_mergeable_constant_section (tree exp,\n   return readonly_data_section;\n }\n \n+section *\n+darwin_tm_clone_table_section (void)\n+{\n+  return get_named_section (NULL,\n+\t\t\t    \"__DATA,__tm_clone_table,regular,no_dead_strip\",\n+\t\t\t    3);\n+}\n+\n int\n machopic_reloc_rw_mask (void)\n {"}, {"sha": "efff4c9a4355577accc4463548d046270d40dc2e", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -697,6 +697,10 @@ extern GTY(()) section * darwin_sections[NUM_DARWIN_SECTIONS];\n #define TARGET_ASM_UNIQUE_SECTION darwin_unique_section\n #undef  TARGET_ASM_FUNCTION_RODATA_SECTION\n #define TARGET_ASM_FUNCTION_RODATA_SECTION default_no_function_rodata_section\n+\n+#undef  TARGET_ASM_TM_CLONE_TABLE_SECTION\n+#define TARGET_ASM_TM_CLONE_TABLE_SECTION darwin_tm_clone_table_section\n+\n #undef  TARGET_ASM_RELOC_RW_MASK\n #define TARGET_ASM_RELOC_RW_MASK machopic_reloc_rw_mask\n "}, {"sha": "c079ce29b7e3d0d9b3c637eb62826e0821c2ec2b", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -7090,6 +7090,10 @@ section names for mergeable constant data.  Define this macro to override\n the string if a different section name should be used.\n @end deftypevr\n \n+@deftypefn {Target Hook} {section *} TARGET_ASM_TM_CLONE_TABLE_SECTION (void)\n+Return the section that should be used for transactional memory clone  tables.\n+@end deftypefn\n+\n @deftypefn {Target Hook} {section *} TARGET_ASM_SELECT_RTX_SECTION (enum machine_mode @var{mode}, rtx @var{x}, unsigned HOST_WIDE_INT @var{align})\n Return the section into which a constant @var{x}, of mode @var{mode},\n should be placed.  You can assume that @var{x} is some kind of"}, {"sha": "d03d7f656a2f2d039c3f736e4b4c1eb7af185470", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -7013,6 +7013,8 @@ otherwise.\n \n @hook TARGET_ASM_MERGEABLE_RODATA_PREFIX\n \n+@hook TARGET_ASM_TM_CLONE_TABLE_SECTION\n+\n @hook TARGET_ASM_SELECT_RTX_SECTION\n Return the section into which a constant @var{x}, of mode @var{mode},\n should be placed.  You can assume that @var{x} is some kind of"}, {"sha": "bc8c9d97825d561ba62d2c3eeb92eb7bf2dbb125", "filename": "gcc/output.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Foutput.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Foutput.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foutput.h?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -638,6 +638,7 @@ extern section *default_elf_select_section (tree, int, unsigned HOST_WIDE_INT);\n extern void default_unique_section (tree, int);\n extern section *default_function_rodata_section (tree);\n extern section *default_no_function_rodata_section (tree);\n+extern section *default_clone_table_section (void);\n extern section *default_select_rtx_section (enum machine_mode, rtx,\n \t\t\t\t\t    unsigned HOST_WIDE_INT);\n extern section *default_elf_select_rtx_section (enum machine_mode, rtx,"}, {"sha": "f5a5d54904af6e11a55d2019c984578e0c5237c9", "filename": "gcc/target.def", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Ftarget.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Ftarget.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget.def?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -305,6 +305,13 @@ section names for mergeable constant data.  Define this macro to override\\n\\\n the string if a different section name should be used.\",\n  const char *, \".rodata\")\n \n+/* Return the section to be used for transactional memory clone tables.  */\n+DEFHOOK\n+(tm_clone_table_section,\n+ \"Return the section that should be used for transactional memory clone\\\n+  tables.\",\n+ section *, (void), default_clone_table_section)\n+\n /* Output a constructor for a symbol with a given priority.  */\n DEFHOOK\n (constructor,"}, {"sha": "9e3d5c843616d1c36dde95e111c9e5b5592a80a3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -1,3 +1,7 @@\n+2011-11-22  Iain Sandoe  <iains@gcc.gnu.org>\n+\n+     * gcc.dg/tm/20100615.c: Adjust for Darwin tm_clone_table section name.\n+\n 2011-11-22  Iain Sandoe  <iains@gcc.gnu.org>\n \n \t* gcc.misc-tests/gcov-16.c: Adjust scan-assembler for Darwin."}, {"sha": "26964d43367cde92a03342cb1672768b7cb8bc1f", "filename": "gcc/testsuite/gcc.dg/tm/20100615.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2F20100615.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2F20100615.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2F20100615.c?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -3,7 +3,8 @@\n \n /* Since the non TM version of new_node() gets optimized away, it\n    shouldn't appear in the clone table either.  */\n-/* { dg-final { scan-assembler-not \"tm_clone_table\" } } */\n+/* { dg-final { scan-assembler-not \"tm_clone_table\" { target { ! *-*-darwin*  } } } } */\n+/* { dg-final { scan-assembler-not \"__DATA,__tm_clone_table\" { target *-*-darwin*  } } } */\n \n #define NULL 0\n extern void *malloc (__SIZE_TYPE__);"}, {"sha": "2c31af91b9aad10dcc9fc9ef3e7f1d8d2f9939be", "filename": "gcc/varasm.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50b0b78a7594143de9d927b2d4edff2065be317d/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=50b0b78a7594143de9d927b2d4edff2065be317d", "patch": "@@ -5961,7 +5961,7 @@ dump_tm_clone_pairs (VEC(tm_alias_pair,heap) *tm_alias_pairs)\n \n       if (!switched)\n \t{\n-\t  switch_to_section (get_named_section (NULL, \".tm_clone_table\", 3));\n+\t  switch_to_section (targetm.asm_out.tm_clone_table_section ());\n \t  assemble_align (POINTER_SIZE);\n \t  switched = true;\n \t}\n@@ -5973,6 +5973,14 @@ dump_tm_clone_pairs (VEC(tm_alias_pair,heap) *tm_alias_pairs)\n     }\n }\n \n+/* Provide a default for the tm_clone_table section.  */\n+\n+section *\n+default_clone_table_section (void)\n+{\n+  return get_named_section (NULL, \".tm_clone_table\", 3);\n+}\n+\n /* Helper comparison function for qsorting by the DECL_UID stored in\n    alias_pair->emitted_diags.  */\n "}]}