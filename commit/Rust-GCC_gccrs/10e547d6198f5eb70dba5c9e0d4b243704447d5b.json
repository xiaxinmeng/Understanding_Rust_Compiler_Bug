{"sha": "10e547d6198f5eb70dba5c9e0d4b243704447d5b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTBlNTQ3ZDYxOThmNWViNzBkYmE1YzllMGQ0YjI0MzcwNDQ0N2Q1Yg==", "commit": {"author": {"name": "Bernd Schmidt", "email": "bernds@redhat.com", "date": "2016-04-15T13:35:12Z"}, "committer": {"name": "Bernd Schmidt", "email": "bernds@gcc.gnu.org", "date": "2016-04-15T13:35:12Z"}, "message": "i386: Don't convert stack operations to pushes if using a redzone.\n\n\t* config/i386/i386-protos.h (ix86_using_red_zone): Declare.\n\t* config/i386/i386.c (ix86_using_red_zone): No longer static.\n\t* config/i386/i386.md (stack decrement to push peepholes): Guard\n\twith !x86_using_red_zone ().\n\ntestsuite/\n\t* gcc.target/i386/pr46470.c: Add -mno-red-zone to dg-options for\n\tx86_64.\n\nFrom-SVN: r235028", "tree": {"sha": "478163cf1c70042b4249ec6e744a4e504dbaf05b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/478163cf1c70042b4249ec6e744a4e504dbaf05b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10e547d6198f5eb70dba5c9e0d4b243704447d5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10e547d6198f5eb70dba5c9e0d4b243704447d5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10e547d6198f5eb70dba5c9e0d4b243704447d5b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10e547d6198f5eb70dba5c9e0d4b243704447d5b/comments", "author": null, "committer": null, "parents": [{"sha": "1e77281b13f7422dda5c2e9f2e72efc364a1d156", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1e77281b13f7422dda5c2e9f2e72efc364a1d156", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1e77281b13f7422dda5c2e9f2e72efc364a1d156"}], "stats": {"total": 30, "additions": 24, "deletions": 6}, "files": [{"sha": "92e2a83182c5ad93ff4c598b430f092e38a69d87", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=10e547d6198f5eb70dba5c9e0d4b243704447d5b", "patch": "@@ -1,3 +1,10 @@\n+2016-04-15  Bernd Schmidt  <bschmidt@redhat.com>\n+\n+\t* config/i386/i386-protos.h (ix86_using_red_zone): Declare.\n+\t* config/i386/i386.c (ix86_using_red_zone): No longer static.\n+\t* config/i386/i386.md (stack decrement to push peepholes): Guard\n+\twith !x86_using_red_zone ().\n+\n 2016-04-15  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/70675"}, {"sha": "ff47bc15600dafdd08c237c785d634e7d7c2c3ec", "filename": "gcc/config/i386/i386-protos.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-protos.h?ref=10e547d6198f5eb70dba5c9e0d4b243704447d5b", "patch": "@@ -44,6 +44,8 @@ extern bool ix86_use_pseudo_pic_reg (void);\n \n extern void ix86_reset_previous_fndecl (void);\n \n+extern bool ix86_using_red_zone (void);\n+\n #ifdef RTX_CODE\n extern int standard_80387_constant_p (rtx);\n extern const char *standard_80387_constant_opcode (rtx);"}, {"sha": "3d044e8bd685d5cd534b170ffa1bf34f32995886", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=10e547d6198f5eb70dba5c9e0d4b243704447d5b", "patch": "@@ -3709,7 +3709,7 @@ make_pass_stv (gcc::context *ctxt)\n \n /* Return true if a red-zone is in use.  */\n \n-static inline bool\n+bool\n ix86_using_red_zone (void)\n {\n   return TARGET_RED_ZONE && !TARGET_64BIT_MS_ABI;"}, {"sha": "cf29e5d39d562d812283471d88b4db2c7588c806", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=10e547d6198f5eb70dba5c9e0d4b243704447d5b", "patch": "@@ -18240,7 +18240,8 @@\n \t      (clobber (reg:CC FLAGS_REG))\n \t      (clobber (mem:BLK (scratch)))])]\n   \"(TARGET_SINGLE_PUSH || optimize_insn_for_size_p ())\n-   && INTVAL (operands[0]) == -GET_MODE_SIZE (word_mode)\"\n+   && INTVAL (operands[0]) == -GET_MODE_SIZE (word_mode)\n+   && !ix86_using_red_zone ()\"\n   [(clobber (match_dup 1))\n    (parallel [(set (mem:W (pre_dec:P (reg:P SP_REG))) (match_dup 1))\n \t      (clobber (mem:BLK (scratch)))])])\n@@ -18253,7 +18254,8 @@\n \t      (clobber (reg:CC FLAGS_REG))\n \t      (clobber (mem:BLK (scratch)))])]\n   \"(TARGET_DOUBLE_PUSH || optimize_insn_for_size_p ())\n-   && INTVAL (operands[0]) == -2*GET_MODE_SIZE (word_mode)\"\n+   && INTVAL (operands[0]) == -2*GET_MODE_SIZE (word_mode)\n+   && !ix86_using_red_zone ()\"\n   [(clobber (match_dup 1))\n    (set (mem:W (pre_dec:P (reg:P SP_REG))) (match_dup 1))\n    (parallel [(set (mem:W (pre_dec:P (reg:P SP_REG))) (match_dup 1))\n@@ -18267,7 +18269,8 @@\n \t\t\t   (match_operand:P 0 \"const_int_operand\")))\n \t      (clobber (reg:CC FLAGS_REG))])]\n   \"(TARGET_SINGLE_PUSH || optimize_insn_for_size_p ())\n-   && INTVAL (operands[0]) == -GET_MODE_SIZE (word_mode)\"\n+   && INTVAL (operands[0]) == -GET_MODE_SIZE (word_mode)\n+   && !ix86_using_red_zone ()\"\n   [(clobber (match_dup 1))\n    (set (mem:W (pre_dec:P (reg:P SP_REG))) (match_dup 1))])\n \n@@ -18278,7 +18281,8 @@\n \t\t\t   (match_operand:P 0 \"const_int_operand\")))\n \t      (clobber (reg:CC FLAGS_REG))])]\n   \"(TARGET_DOUBLE_PUSH || optimize_insn_for_size_p ())\n-   && INTVAL (operands[0]) == -2*GET_MODE_SIZE (word_mode)\"\n+   && INTVAL (operands[0]) == -2*GET_MODE_SIZE (word_mode)\n+   && !ix86_using_red_zone ()\"\n   [(clobber (match_dup 1))\n    (set (mem:W (pre_dec:P (reg:P SP_REG))) (match_dup 1))\n    (set (mem:W (pre_dec:P (reg:P SP_REG))) (match_dup 1))])"}, {"sha": "61c8f1289786bee8b5abcf1ab07d69f79abfc5c7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=10e547d6198f5eb70dba5c9e0d4b243704447d5b", "patch": "@@ -1,3 +1,8 @@\n+2016-04-15  Bernd Schmidt  <bschmidt@redhat.com>\n+\n+\t* gcc.target/i386/pr46470.c: Add -mno-red-zone to dg-options for\n+\tx86_64.\n+\n 2016-04-15  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/70651"}, {"sha": "8d6b5ca5d5e98e17913d47c9f6bba5d14852dc33", "filename": "gcc/testsuite/gcc.target/i386/pr46470.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr46470.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10e547d6198f5eb70dba5c9e0d4b243704447d5b/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr46470.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr46470.c?ref=10e547d6198f5eb70dba5c9e0d4b243704447d5b", "patch": "@@ -4,7 +4,7 @@\n /* These options are selected to ensure 1 word needs to be allocated\n    on the stack to maintain alignment for the call.  This should be\n    transformed to push+pop.  We also want to force unwind info updates.  */\n-/* { dg-options \"-Os -fomit-frame-pointer -fasynchronous-unwind-tables\" } */\n+/* { dg-options \"-Os -fomit-frame-pointer -fasynchronous-unwind-tables -mno-red-zone\" } */\n /* { dg-options \"-Os -fomit-frame-pointer -mpreferred-stack-boundary=3 -fasynchronous-unwind-tables\" { target ia32 } } */\n /* ms_abi has reserved stack-region.  */\n /* { dg-skip-if \"\" { x86_64-*-mingw* } { \"*\" } { \"\" } } */"}]}