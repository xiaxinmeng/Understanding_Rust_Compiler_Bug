{"sha": "df24c2b88d3ca69d5a7fe29d8a527714fb3aec16", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGYyNGMyYjg4ZDNjYTY5ZDVhN2ZlMjlkOGE1Mjc3MTRmYjNhZWMxNg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-05-28T15:56:16Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-05-28T15:56:16Z"}, "message": "ipa-reference.c (add_static_var): Remove redundant all_module_statics check.\n\n\t* ipa-reference.c (add_static_var): Remove redundant all_module_statics check.\n\t(ipa_reference_write_optimization_summary): Call is_proper_for_analysis only\n\ton local statics.\n\nFrom-SVN: r159982", "tree": {"sha": "08c90220d0cfdceddc947963eabaabf4be929223", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/08c90220d0cfdceddc947963eabaabf4be929223"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16/comments", "author": null, "committer": null, "parents": [{"sha": "c3a9a336d0552e81136f97dd22e8e1f7e8fd9216", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3a9a336d0552e81136f97dd22e8e1f7e8fd9216", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3a9a336d0552e81136f97dd22e8e1f7e8fd9216"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "dff48eee06ec285960b39ac3a94e4cf9bca347c1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=df24c2b88d3ca69d5a7fe29d8a527714fb3aec16", "patch": "@@ -1,3 +1,9 @@\n+2010-05-28  Jan Hubicka  <jh@suse.cz>\n+\n+\t* ipa-reference.c (add_static_var): Remove redundant all_module_statics check.\n+\t(ipa_reference_write_optimization_summary): Call is_proper_for_analysis only\n+\ton local statics.\n+\n 2010-05-28  Iain Sandoe  <iains@gcc.gnu.org>\n \n         * config.gcc (*-*-darwin*): Adjust t-make fragments for Darwin."}, {"sha": "2fc9bed2cabe0eddb8e4563a684df7737b166bb4", "filename": "gcc/ipa-reference.c", "status": "modified", "additions": 11, "deletions": 14, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16/gcc%2Fipa-reference.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df24c2b88d3ca69d5a7fe29d8a527714fb3aec16/gcc%2Fipa-reference.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-reference.c?ref=df24c2b88d3ca69d5a7fe29d8a527714fb3aec16", "patch": "@@ -239,13 +239,10 @@ add_static_var (tree var)\n {\n   int uid = DECL_UID (var);\n   gcc_assert (TREE_CODE (var) == VAR_DECL);\n-  if (!bitmap_bit_p (all_module_statics, uid))\n-    {\n-      if (dump_file)\n-\tsplay_tree_insert (reference_vars_to_consider,\n-\t\t\t   uid, (splay_tree_value)var);\n-      bitmap_set_bit (all_module_statics, uid);\n-    }\n+  if (dump_file)\n+    splay_tree_insert (reference_vars_to_consider,\n+\t\t       uid, (splay_tree_value)var);\n+  bitmap_set_bit (all_module_statics, uid);\n }\n \n /* Return true if the variable T is the right kind of static variable to\n@@ -962,15 +959,15 @@ ipa_reference_write_optimization_summary (cgraph_node_set set,\n \n   /* See what variables we are interested in.  */\n   for (vnode = varpool_nodes; vnode; vnode = vnode->next)\n-    if (referenced_from_this_partition_p (&vnode->ref_list, set, vset))\n+    if (!vnode->externally_visible\n+\t&& vnode->analyzed\n+\t&& is_proper_for_analysis (vnode->decl)\n+\t&& referenced_from_this_partition_p (&vnode->ref_list, set, vset))\n       {\n \ttree decl = vnode->decl;\n-\tif (is_proper_for_analysis (decl))\n-\t  {\n-\t    bitmap_set_bit (ltrans_statics, DECL_UID (decl));\n-\t    splay_tree_insert (reference_vars_to_consider,\n-\t\t\t       DECL_UID (decl), (splay_tree_value)decl);\n-\t  }\n+\tbitmap_set_bit (ltrans_statics, DECL_UID (decl));\n+\tsplay_tree_insert (reference_vars_to_consider,\n+\t\t\t   DECL_UID (decl), (splay_tree_value)decl);\n       }\n \n   for (node = cgraph_nodes; node; node = node->next)"}]}