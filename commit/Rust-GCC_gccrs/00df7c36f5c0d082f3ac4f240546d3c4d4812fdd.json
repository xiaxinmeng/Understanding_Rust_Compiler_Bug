{"sha": "00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDBkZjdjMzZmNWMwZDA4MmYzYWM0ZjI0MDU0NmQzYzRkNDgxMmZkZA==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-03-08T00:42:41Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-03-08T00:42:41Z"}, "message": "re PR fortran/64124 ([F95] Valid constant expr rejected)\n\n2018-03-07  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/64124\n\tPR fortran/70409\n\t* decl.c (gfc_match_char_spec): Try to reduce a charlen to a constant.\n\n2018-03-07  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/64124\n\tPR fortran/70409\n\t* gfortran.dg/pr64124.f90: New tests.\n\t* gfortran.dg/pr70409.f90: New tests.\n\nFrom-SVN: r258347", "tree": {"sha": "9886dae8a401f36eda0fc1a13250e60c8158ffb1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9886dae8a401f36eda0fc1a13250e60c8158ffb1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/comments", "author": null, "committer": null, "parents": [{"sha": "4b7b455cf985aa9be1ce294bd9719d1d5d8c5e74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b7b455cf985aa9be1ce294bd9719d1d5d8c5e74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b7b455cf985aa9be1ce294bd9719d1d5d8c5e74"}], "stats": {"total": 60, "additions": 59, "deletions": 1}, "files": [{"sha": "796b58dd6f31c8da235705ac72a3753e248364a3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "patch": "@@ -1,3 +1,9 @@\n+2018-03-07  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/64124\n+\tPR fortran/70409\n+\t* decl.c (gfc_match_char_spec): Try to reduce a charlen to a constant.\n+\n 2017-03-06  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/84697"}, {"sha": "160964399fc75c25c15a61d2e2d4a4dddefb3ce8", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "patch": "@@ -3147,7 +3147,24 @@ gfc_match_char_spec (gfc_typespec *ts)\n   if (seen_length == 0)\n     cl->length = gfc_get_int_expr (gfc_charlen_int_kind, NULL, 1);\n   else\n-    cl->length = len;\n+    {\n+      /* If gfortran ends up here, then the len may be reducible to a\n+\t constant.  Try to do that here.  If it does not reduce, simply\n+\t assign len to the charlen.  */\n+      if (len && len->expr_type != EXPR_CONSTANT)\n+\t{\n+\t  gfc_expr *e;\n+\t  e = gfc_copy_expr (len);\n+\t  gfc_reduce_init_expr (e);\n+\t  if (e->expr_type == EXPR_CONSTANT)\n+\t    gfc_replace_expr (len, e);\n+\t  else\n+\t    gfc_free_expr (e);\n+\t  cl->length = len;\n+\t}\n+      else\n+\tcl->length = len;\n+    }\n \n   ts->u.cl = cl;\n   ts->kind = kind == 0 ? gfc_default_character_kind : kind;"}, {"sha": "d795f0d9a71fc4018eb57901c36183c8237f3b32", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "patch": "@@ -1,3 +1,10 @@\n+2018-03-07  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/64124\n+\tPR fortran/70409\n+\t* gfortran.dg/pr64124.f90: New tests.\n+\t* gfortran.dg/pr70409.f90: New tests.\n+\n 2018-03-07  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR target/82411"}, {"sha": "349c20de204c72fe20fc6324efdc50111c742099", "filename": "gcc/testsuite/gfortran.dg/pr64124.f90", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr64124.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr64124.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr64124.f90?ref=00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "patch": "@@ -0,0 +1,5 @@\n+! { dg-do compile }\n+! PR fortran/64124.f90\n+  character(len=kind(1)) x\n+  integer(len(x)) y\n+  end"}, {"sha": "0372f6e9632632c691235bae3b7932cc0b1142a4", "filename": "gcc/testsuite/gfortran.dg/pr70409.f90", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr70409.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00df7c36f5c0d082f3ac4f240546d3c4d4812fdd/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr70409.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr70409.f90?ref=00df7c36f5c0d082f3ac4f240546d3c4d4812fdd", "patch": "@@ -0,0 +1,23 @@\n+! { dg-do run }\n+! PR fortran/70409\n+! Contriubted by Harald Anlauf  <anlauf at gmx dot de>\n+program foo\n+  integer, parameter :: huge_1 = huge(0_1)\n+  character(    huge_1      ), parameter :: x = 'abc'\n+  character(    huge(0_1)   ), parameter :: y = 'abc'\n+  character(    huge(0_1)+0 ), parameter :: z = 'abcdef'\n+  character(    huge(0_1)   )            :: a = 'abc'\n+  integer, parameter :: huge_2 = huge(0_2)\n+  character(    huge_2      ), parameter :: u = 'abc'\n+  character(    huge(0_2)   ), parameter :: v = 'abc'\n+  character(int(huge(0_2),4)), parameter :: w = 'abcdef'\n+  character(    huge(0_2)   )            :: b = 'abc'\n+  if (len(x) /= huge_1) stop 1\n+  if (len(y) /= huge_1) stop 2\n+  if (len(z) /= huge_1) stop 3\n+  if (len(a) /= huge_1) stop 4\n+  if (len(u) /= huge_2) stop 5\n+  if (len(v) /= huge_2) stop 6\n+  if (len(w) /= huge_2) stop 7\n+  if (len(b) /= huge_2) stop 8\n+end program foo"}]}