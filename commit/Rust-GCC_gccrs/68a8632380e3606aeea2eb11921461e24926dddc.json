{"sha": "68a8632380e3606aeea2eb11921461e24926dddc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjhhODYzMjM4MGUzNjA2YWVlYTJlYjExOTIxNDYxZTI0OTI2ZGRkYw==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2016-06-24T12:46:19Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2016-06-24T12:46:19Z"}, "message": "[ARM][1/4] Replace uses of int_log2 by exact_log2\n\n\t* config/arm/arm.c (int_log2): Delete definition and prototype.\n\t(shift_op): Use exact_log2 instead of int_log2.\n\t(vfp3_const_double_for_fract_bits): Likewise.\n\nFrom-SVN: r237757", "tree": {"sha": "96126f7d5aca829faff5c28e8579d83f5f0a0341", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96126f7d5aca829faff5c28e8579d83f5f0a0341"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68a8632380e3606aeea2eb11921461e24926dddc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68a8632380e3606aeea2eb11921461e24926dddc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68a8632380e3606aeea2eb11921461e24926dddc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68a8632380e3606aeea2eb11921461e24926dddc/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dfee28703668e4aa85de36e4f4bd0cac7a04146d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dfee28703668e4aa85de36e4f4bd0cac7a04146d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dfee28703668e4aa85de36e4f4bd0cac7a04146d"}], "stats": {"total": 32, "additions": 13, "deletions": 19}, "files": [{"sha": "2c55cb3f0bc5f5a2ee9d1487fa2117eb7859a4ff", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68a8632380e3606aeea2eb11921461e24926dddc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68a8632380e3606aeea2eb11921461e24926dddc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=68a8632380e3606aeea2eb11921461e24926dddc", "patch": "@@ -1,3 +1,9 @@\n+2016-06-24  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* config/arm/arm.c (int_log2): Delete definition and prototype.\n+\t(shift_op): Use exact_log2 instead of int_log2.\n+\t(vfp3_const_double_for_fract_bits): Likewise.\n+\n 2016-06-24  Jakub Jelinek  <jakub@redhat.com>\n \n \t* internal-fn.c (expand_arith_set_overflow): New function."}, {"sha": "f60955438d6f1cc5d996e7eacd4b453213044181", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 7, "deletions": 19, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68a8632380e3606aeea2eb11921461e24926dddc/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68a8632380e3606aeea2eb11921461e24926dddc/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=68a8632380e3606aeea2eb11921461e24926dddc", "patch": "@@ -104,7 +104,6 @@ static void arm_print_operand_address (FILE *, machine_mode, rtx);\n static bool arm_print_operand_punct_valid_p (unsigned char code);\n static const char *fp_const_from_val (REAL_VALUE_TYPE *);\n static arm_cc get_arm_condition_code (rtx);\n-static HOST_WIDE_INT int_log2 (HOST_WIDE_INT);\n static const char *output_multi_immediate (rtx *, const char *, const char *,\n \t\t\t\t\t   int, HOST_WIDE_INT);\n static const char *shift_op (rtx, HOST_WIDE_INT *);\n@@ -19094,7 +19093,8 @@ shift_op (rtx op, HOST_WIDE_INT *amountp)\n \t  return NULL;\n \t}\n \n-      *amountp = int_log2 (*amountp);\n+      *amountp = exact_log2 (*amountp);\n+      gcc_assert (IN_RANGE (*amountp, 0, 31));\n       return ARM_LSL_NAME;\n \n     default:\n@@ -19126,22 +19126,6 @@ shift_op (rtx op, HOST_WIDE_INT *amountp)\n   return mnem;\n }\n \n-/* Obtain the shift from the POWER of two.  */\n-\n-static HOST_WIDE_INT\n-int_log2 (HOST_WIDE_INT power)\n-{\n-  HOST_WIDE_INT shift = 0;\n-\n-  while ((((HOST_WIDE_INT) 1 << shift) & power) == 0)\n-    {\n-      gcc_assert (shift <= 31);\n-      shift++;\n-    }\n-\n-  return shift;\n-}\n-\n /* Output a .ascii pseudo-op, keeping track of lengths.  This is\n    because /bin/as is horribly restrictive.  The judgement about\n    whether or not each character is 'printable' (and can be output as\n@@ -27931,7 +27915,11 @@ vfp3_const_double_for_fract_bits (rtx operand)\n \t  HOST_WIDE_INT value = real_to_integer (&r0);\n \t  value = value & 0xffffffff;\n \t  if ((value != 0) && ( (value & (value - 1)) == 0))\n-\t    return int_log2 (value);\n+\t    {\n+\t      int ret = exact_log2 (value);\n+\t      gcc_assert (IN_RANGE (ret, 0, 31));\n+\t      return ret;\n+\t    }\n \t}\n     }\n   return 0;"}]}