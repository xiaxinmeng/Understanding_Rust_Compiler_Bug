{"sha": "8ec139af5ea9657c7517c1483c7a577815bea48e", "node_id": "C_kwDOANBUbNoAKDhlYzEzOWFmNWVhOTY1N2M3NTE3YzE0ODNjN2E1Nzc4MTViZWE0OGU", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2022-12-24T10:59:26Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2022-12-24T17:51:48Z"}, "message": "libstdc++: Test for tzdata.zi before fallback version files.\n\nSeveral systems/distributions do not provide the raw tzdata.zi file in\ntheir zoneinfo installation.  However, we might provide an alternate\ninstallation path at configure time, so that we should check for the\ntzdata.zi file first and then fall back to system-specific files like\n+VERSION etc. on those systems.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\nlibstdc++-v3/ChangeLog:\n\n\t* src/c++20/tzdb.cc (remote_version): Look for the tzdata.zi\n\tfile before falling back to system-specific ones on Darwin and\n\tBSD.", "tree": {"sha": "be2d6568657ec53457b4b75ea40a615f2aa96ca8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be2d6568657ec53457b4b75ea40a615f2aa96ca8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ec139af5ea9657c7517c1483c7a577815bea48e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ec139af5ea9657c7517c1483c7a577815bea48e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ec139af5ea9657c7517c1483c7a577815bea48e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ec139af5ea9657c7517c1483c7a577815bea48e/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4c3a036be5f4dd68e0e4d8fb3a152c06538f5872", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c3a036be5f4dd68e0e4d8fb3a152c06538f5872", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c3a036be5f4dd68e0e4d8fb3a152c06538f5872"}], "stats": {"total": 17, "additions": 10, "deletions": 7}, "files": [{"sha": "2a4e213d3d957e8605269558067795c1050c863e", "filename": "libstdc++-v3/src/c++20/tzdb.cc", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ec139af5ea9657c7517c1483c7a577815bea48e/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B20%2Ftzdb.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ec139af5ea9657c7517c1483c7a577815bea48e/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B20%2Ftzdb.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Fc%2B%2B20%2Ftzdb.cc?ref=8ec139af5ea9657c7517c1483c7a577815bea48e", "patch": "@@ -1060,16 +1060,11 @@ namespace std::chrono\n   namespace\n   {\n     // Read the version number from a tzdata.zi file.\n+    // Note that some systems do not have this file available by default\n+    // but we can configure the library to point to an alternate installation.\n     string\n     remote_version(istream* zif)\n     {\n-#if defined __NetBSD__\n-    if (string ver; ifstream(zoneinfo_dir() + \"/TZDATA_VERSION\") >> ver)\n-      return ver;\n-#elif defined __APPLE__\n-    if (string ver; ifstream(zoneinfo_dir() + \"/+VERSION\") >> ver)\n-      return ver;\n-#else\n       ifstream f;\n       if (!zif)\n \t{\n@@ -1082,6 +1077,14 @@ namespace std::chrono\n       if (*zif >> hash >> label >> version)\n \tif (hash == '#' && label == \"version\")\n \t  return version;\n+#if defined __NetBSD__\n+      if (string ver; ifstream(zoneinfo_dir() + \"/TZDATA_VERSION\") >> ver)\n+\treturn ver;\n+#elif defined __APPLE__\n+      // The standard install on macOS has no tzdata.zi, but we can find the\n+      // version from +VERSION.\n+      if (string ver; ifstream(zoneinfo_dir() + \"/+VERSION\") >> ver)\n+\treturn ver;\n #endif\n       __throw_runtime_error(\"tzdb: no version found in tzdata.zi\");\n     }"}]}