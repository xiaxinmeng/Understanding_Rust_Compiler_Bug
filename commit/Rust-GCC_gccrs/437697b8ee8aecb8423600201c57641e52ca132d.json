{"sha": "437697b8ee8aecb8423600201c57641e52ca132d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDM3Njk3YjhlZThhZWNiODQyMzYwMDIwMWM1NzY0MWU1MmNhMTMyZA==", "commit": {"author": {"name": "Rodrigo Rivas Costa", "email": "rodrigorivascosta@gmail.com", "date": "2011-03-15T18:27:19Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2011-03-15T18:27:19Z"}, "message": "decl2.c (cp_check_const_attributes): New.\n\n\t* decl2.c (cp_check_const_attributes): New.\n\t(cplus_decl_attributes): Call cp_check_const_attributes.\n\nFrom-SVN: r171010", "tree": {"sha": "9c95f0f24a7348f98ef084f2f896d8e03f803f5e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c95f0f24a7348f98ef084f2f896d8e03f803f5e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/437697b8ee8aecb8423600201c57641e52ca132d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/437697b8ee8aecb8423600201c57641e52ca132d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/437697b8ee8aecb8423600201c57641e52ca132d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/437697b8ee8aecb8423600201c57641e52ca132d/comments", "author": {"login": "rodrigorc", "id": 1128630, "node_id": "MDQ6VXNlcjExMjg2MzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1128630?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rodrigorc", "html_url": "https://github.com/rodrigorc", "followers_url": "https://api.github.com/users/rodrigorc/followers", "following_url": "https://api.github.com/users/rodrigorc/following{/other_user}", "gists_url": "https://api.github.com/users/rodrigorc/gists{/gist_id}", "starred_url": "https://api.github.com/users/rodrigorc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rodrigorc/subscriptions", "organizations_url": "https://api.github.com/users/rodrigorc/orgs", "repos_url": "https://api.github.com/users/rodrigorc/repos", "events_url": "https://api.github.com/users/rodrigorc/events{/privacy}", "received_events_url": "https://api.github.com/users/rodrigorc/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4c66d85a558f15893d846c0d7d5e9885b8cdf842", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c66d85a558f15893d846c0d7d5e9885b8cdf842", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c66d85a558f15893d846c0d7d5e9885b8cdf842"}], "stats": {"total": 93, "additions": 93, "deletions": 0}, "files": [{"sha": "bbc56629363a737611b65bf348ccfded08b5315a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=437697b8ee8aecb8423600201c57641e52ca132d", "patch": "@@ -1,3 +1,8 @@\n+2011-03-15  Rodrigo Rivas Costa  <rodrigorivascosta@gmail.com>\n+\n+\t* decl2.c (cp_check_const_attributes): New.\n+\t(cplus_decl_attributes): Call cp_check_const_attributes.\n+\n 2011-03-15  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/34758"}, {"sha": "f62f9134b313b7025710cab2f9a91aeb6d002348", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=437697b8ee8aecb8423600201c57641e52ca132d", "patch": "@@ -1264,6 +1264,25 @@ cp_reconstruct_complex_type (tree type, tree bottom)\n   return cp_build_qualified_type (outer, cp_type_quals (type));\n }\n \n+/* Replaces any constexpr expression that may be into the attributes\n+   arguments with their reduced value.  */\n+\n+static void\n+cp_check_const_attributes (tree attributes)\n+{\n+  tree attr;\n+  for (attr = attributes; attr; attr = TREE_CHAIN (attr))\n+    {\n+      tree arg;\n+      for (arg = TREE_VALUE (attr); arg; arg = TREE_CHAIN (arg))\n+\t{\n+\t  tree expr = TREE_VALUE (arg);\n+\t  if (EXPR_P (expr))\n+\t    TREE_VALUE (arg) = maybe_constant_value (expr);\n+\t}\n+    }\n+}\n+\n /* Like decl_attributes, but handle C++ complexity.  */\n \n void\n@@ -1284,6 +1303,8 @@ cplus_decl_attributes (tree *decl, tree attributes, int flags)\n \treturn;\n     }\n \n+  cp_check_const_attributes (attributes);\n+\n   if (TREE_CODE (*decl) == TEMPLATE_DECL)\n     decl = &DECL_TEMPLATE_RESULT (*decl);\n "}, {"sha": "40c5316415897e30350e45519658f046f6a1a3a5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=437697b8ee8aecb8423600201c57641e52ca132d", "patch": "@@ -1,3 +1,7 @@\n+2011-03-15  Rodrigo Rivas Costa  <rodrigorivascosta@gmail.com>\n+\n+       * g++.dg/cpp0x/constexpr-attribute.C: New.\n+\n 2011-03-15  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n \n \t* g++.dg/parse/pr34758.C: New."}, {"sha": "ac85c076d3ea60b62a1d07984f49dd6bf27105ca", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-attribute.C", "status": "added", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-attribute.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/437697b8ee8aecb8423600201c57641e52ca132d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-attribute.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-attribute.C?ref=437697b8ee8aecb8423600201c57641e52ca132d", "patch": "@@ -0,0 +1,63 @@\n+// { dg-options -std=c++0x }\n+\n+//A few constexpr's\n+constexpr int foo() { return __alignof__(int); }\n+\n+template<typename T>\n+constexpr int fooT() { return __alignof__(T); }\n+\n+template<int N>\n+constexpr int fooN() { return N; }\n+\n+//Now the attributes\n+\n+//with normal variables,\n+int a __attribute__((aligned(foo())));\n+int b __attribute__((aligned(fooT<int>())));\n+int c __attribute__((aligned(fooN<__alignof__(int)>())));\n+\n+//with variables inside a template,\n+template <typename T>\n+void fun()\n+{\n+    T a __attribute__((aligned(foo())));\n+    T b __attribute__((aligned(fooT<T>())));\n+    T c __attribute__((aligned(fooN<__alignof__(T)>())));\n+    T d __attribute__((aligned(fooT<int>())));\n+    T e __attribute__((aligned(fooN<__alignof__(int)>())));\n+}\n+\n+//instantiate it,\n+void bar()\n+{\n+    fun<int>();\n+}\n+\n+//with classes\n+struct __attribute__((aligned(foo()))) S0\n+{\n+    char dummy;\n+};\n+S0 s0;\n+\n+struct __attribute__((aligned(fooT<int>()))) S1\n+{\n+    char dummy;\n+};\n+S1 s1;\n+\n+//and class templates\n+template <typename T>\n+struct __attribute__((aligned(foo()))) S2\n+{\n+    char dummy;\n+};\n+\n+S2<int> s2;\n+\n+template <typename T>\n+struct __attribute__((aligned(fooT<T>()))) S3\n+{\n+    char dummy;\n+};\n+S3<int> s3;"}]}