{"sha": "283268809829d27d5f54909bc3a79e8e54fc48eb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjgzMjY4ODA5ODI5ZDI3ZDVmNTQ5MDliYzNhNzllOGU1NGZjNDhlYg==", "commit": {"author": {"name": "Olivier Hainque", "email": "hainque@adacore.com", "date": "2009-06-22T09:08:58Z"}, "committer": {"name": "Olivier Hainque", "email": "hainque@gcc.gnu.org", "date": "2009-06-22T09:08:58Z"}, "message": "pa.c (output_call): Don't optimize post call jumps into return address adjustments if...\n\n\t* config/pa/pa.c (output_call): Don't optimize post call jumps\n\tinto return address adjustments if the call may throw.\n\n\ttestsuite/\n\t* gnat.dg/raise_ce.adb: Helper for ...\n\t* gnat.dg/handle_and_return.adb: New test.\n\nFrom-SVN: r148780", "tree": {"sha": "0608f8bdc0b348c96a90ad8cff963d50ce91c87c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0608f8bdc0b348c96a90ad8cff963d50ce91c87c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/283268809829d27d5f54909bc3a79e8e54fc48eb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/283268809829d27d5f54909bc3a79e8e54fc48eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/283268809829d27d5f54909bc3a79e8e54fc48eb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/283268809829d27d5f54909bc3a79e8e54fc48eb/comments", "author": {"login": "hainque", "id": 18735142, "node_id": "MDQ6VXNlcjE4NzM1MTQy", "avatar_url": "https://avatars.githubusercontent.com/u/18735142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hainque", "html_url": "https://github.com/hainque", "followers_url": "https://api.github.com/users/hainque/followers", "following_url": "https://api.github.com/users/hainque/following{/other_user}", "gists_url": "https://api.github.com/users/hainque/gists{/gist_id}", "starred_url": "https://api.github.com/users/hainque/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hainque/subscriptions", "organizations_url": "https://api.github.com/users/hainque/orgs", "repos_url": "https://api.github.com/users/hainque/repos", "events_url": "https://api.github.com/users/hainque/events{/privacy}", "received_events_url": "https://api.github.com/users/hainque/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "59366db692450991e990991ac8c369e6cfa9cbe7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59366db692450991e990991ac8c369e6cfa9cbe7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/59366db692450991e990991ac8c369e6cfa9cbe7"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "8d171708bebc1c79809c05b3b55681a555bb8767", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=283268809829d27d5f54909bc3a79e8e54fc48eb", "patch": "@@ -1,3 +1,8 @@\n+2009-06-22  Olivier Hainque  <hainque@adacore.com>\n+\t\n+\t* config/pa/pa.c (output_call): Don't optimize post call jumps\n+\tinto return address adjustments if the call may throw.\n+\n 2009-06-21  Richard Earnshaw  <rearnsha@arm.com>\n \n \t* arm.c (thumb1_output_casesi): New function."}, {"sha": "c8cf714d21df476b7d560e2928b9bb7f9b7cb5b9", "filename": "gcc/config/pa/pa.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Fconfig%2Fpa%2Fpa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Fconfig%2Fpa%2Fpa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.c?ref=283268809829d27d5f54909bc3a79e8e54fc48eb", "patch": "@@ -7701,12 +7701,15 @@ output_call (rtx insn, rtx call_dest, int sibcall)\n   if (!delay_slot_filled && INSN_ADDRESSES_SET_P ())\n     {\n       /* See if the return address can be adjusted.  Use the containing\n-         sequence insn's address.  */\n+         sequence insn's address.  This would break the regular call/return@\n+         relationship assumed by the table based eh unwinder, so only do that\n+         if the call is not possibly throwing.  */\n       rtx seq_insn = NEXT_INSN (PREV_INSN (XVECEXP (final_sequence, 0, 0)));\n       int distance = (INSN_ADDRESSES (INSN_UID (JUMP_LABEL (NEXT_INSN (insn))))\n \t\t      - INSN_ADDRESSES (INSN_UID (seq_insn)) - 8);\n \n-      if (VAL_14_BITS_P (distance))\n+      if (VAL_14_BITS_P (distance)\n+\t  && !(can_throw_internal (insn) || can_throw_external (insn)))\n \t{\n \t  xoperands[1] = gen_label_rtx ();\n \t  output_asm_insn (\"ldo %0-%1(%%r2),%%r2\", xoperands);"}, {"sha": "089d9b48c111baf0b3e85b3c8e424c5f86af9aed", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=283268809829d27d5f54909bc3a79e8e54fc48eb", "patch": "@@ -1,3 +1,8 @@\n+2009-06-22  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* gnat.dg/raise_ce.adb: Helper for ...\n+\t* gnat.dg/handle_and_return.adb: New test.\n+\n 2009-06-22  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/40443"}, {"sha": "b40dbafb37dd87e22bb313952d850f9dd9d1dc8e", "filename": "gcc/testsuite/gnat.dg/handle_and_return.adb", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Ftestsuite%2Fgnat.dg%2Fhandle_and_return.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Ftestsuite%2Fgnat.dg%2Fhandle_and_return.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fhandle_and_return.adb?ref=283268809829d27d5f54909bc3a79e8e54fc48eb", "patch": "@@ -0,0 +1,21 @@\n+-- { dg-do run }\n+-- { dg-options \"-gnatp -O2\" }\n+\n+with Raise_Ce;\n+\n+procedure Handle_And_Return is\n+begin\n+   begin\n+      Raise_CE;\n+      return;\n+   exception\n+      when others => null;\n+   end;\n+\n+   begin\n+      Raise_CE;\n+      return;\n+   exception\n+      when others => null;\n+   end;\n+end;"}, {"sha": "f526beef50efd2b272b87b9dc90a66ed26deeedc", "filename": "gcc/testsuite/gnat.dg/raise_ce.adb", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Ftestsuite%2Fgnat.dg%2Fraise_ce.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/283268809829d27d5f54909bc3a79e8e54fc48eb/gcc%2Ftestsuite%2Fgnat.dg%2Fraise_ce.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fraise_ce.adb?ref=283268809829d27d5f54909bc3a79e8e54fc48eb", "patch": "@@ -0,0 +1,4 @@\n+procedure Raise_CE is\n+begin\n+   raise Constraint_Error;\n+end;"}]}