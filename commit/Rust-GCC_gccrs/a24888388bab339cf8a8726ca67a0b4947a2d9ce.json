{"sha": "a24888388bab339cf8a8726ca67a0b4947a2d9ce", "node_id": "C_kwDOANBUbNoAKGEyNDg4ODM4OGJhYjMzOWNmOGE4NzI2Y2E2N2EwYjQ5NDdhMmQ5Y2U", "commit": {"author": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-01-05T14:13:43Z"}, "committer": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-01-05T14:13:43Z"}, "message": "Add missing declarations to gcc/m2/gm2-libs-min/M2RTS.{def,mod}\n\nThis patch adds two missing procedures to\ngcc/m2/gm2-libs-min/M2RTS.{def,mod} required for linking.  The\npatch also includes test code, changes to\ngcc/testsuite/lib/gm2.exp and an expect tcl script to test the\nmin libraries.\n\ngcc/m2/ChangeLog:\n\n\t* gm2-libs-min/M2RTS.def (ConstructModules): New procedure\n\tdeclaration.\n\t(DeconstructModules): New procedure declaration.\n\t* gm2-libs-min/M2RTS.mod (ConstructModules): New procedure\n\tdummy implementation.\n\t(DeconstructModules): New procedure dummy implementation.\n\ngcc/testsuite:\n\n\t* lib/gm2.exp (gm2_init_minx): New procedure.\n\t(gm2_init_min): New procedure calls gm2_init_min with\n\tdialect flags.\n\t* gm2/link/min/pass/tiny.mod: New test case.\n\t* gm2/link/min/pass/link-min-pass.exp: New file.\n\nSigned-off-by: Gaius Mulley <gaiusmod2@gmail.com>", "tree": {"sha": "c53284daa55670030eff5d543c87d56f84103a50", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c53284daa55670030eff5d543c87d56f84103a50"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a24888388bab339cf8a8726ca67a0b4947a2d9ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a24888388bab339cf8a8726ca67a0b4947a2d9ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a24888388bab339cf8a8726ca67a0b4947a2d9ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a24888388bab339cf8a8726ca67a0b4947a2d9ce/comments", "author": null, "committer": null, "parents": [{"sha": "dd77b04999534f61825cc810a5bc428707b8106b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd77b04999534f61825cc810a5bc428707b8106b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd77b04999534f61825cc810a5bc428707b8106b"}], "stats": {"total": 99, "additions": 99, "deletions": 0}, "files": [{"sha": "147024ebe787659aa21d79b47af4a1afa5e97ffc", "filename": "gcc/m2/gm2-libs-min/M2RTS.def", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Fm2%2Fgm2-libs-min%2FM2RTS.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Fm2%2Fgm2-libs-min%2FM2RTS.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs-min%2FM2RTS.def?ref=a24888388bab339cf8a8726ca67a0b4947a2d9ce", "patch": "@@ -38,6 +38,10 @@ TYPE\n    all these procedures do nothing except satisfy the linker.\n *)\n \n+PROCEDURE ConstructModules (applicationmodule: ADDRESS;\n+                            argc: INTEGER; argv, envp: ADDRESS) ;\n+PROCEDURE DeconstructModules (applicationmodule: ADDRESS;\n+                              argc: INTEGER; argv, envp: ADDRESS) ;\n PROCEDURE RegisterModule (name: ADDRESS;\n                           init, fini:  ArgCVEnvP;\n                           dependencies: PROC) ;"}, {"sha": "8400567e4bd16e930540a18fbdff43df4db44188", "filename": "gcc/m2/gm2-libs-min/M2RTS.mod", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Fm2%2Fgm2-libs-min%2FM2RTS.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Fm2%2Fgm2-libs-min%2FM2RTS.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs-min%2FM2RTS.mod?ref=a24888388bab339cf8a8726ca67a0b4947a2d9ce", "patch": "@@ -30,6 +30,18 @@ IMPORT libc, SYSTEM ;\n (* we reference these to ensure they are dragged in to the link *)\n \n \n+PROCEDURE ConstructModules (applicationmodule: ADDRESS;\n+                            argc: INTEGER; argv, envp: ADDRESS) ;\n+BEGIN\n+END ConstructModules ;\n+\n+\n+PROCEDURE DeconstructModules (applicationmodule: ADDRESS;\n+                              argc: INTEGER; argv, envp: ADDRESS) ;\n+BEGIN\n+END DeconstructModules ;\n+\n+\n (* all these procedures do nothing except satisfy the linker.  *)\n \n PROCEDURE ExecuteTerminationProcedures ;"}, {"sha": "6a6051ff7876bd171c4b84c660aed0156c011d1c", "filename": "gcc/testsuite/gm2/link/min/pass/link-min-pass.exp", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Ftestsuite%2Fgm2%2Flink%2Fmin%2Fpass%2Flink-min-pass.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Ftestsuite%2Fgm2%2Flink%2Fmin%2Fpass%2Flink-min-pass.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgm2%2Flink%2Fmin%2Fpass%2Flink-min-pass.exp?ref=a24888388bab339cf8a8726ca67a0b4947a2d9ce", "patch": "@@ -0,0 +1,37 @@\n+# Expect driver script for GCC Regression Tests\n+# Copyright (C) 2023 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with GCC; see the file COPYING3.  If not see\n+# <http://www.gnu.org/licenses/>.\n+\n+# This file was written by Gaius Mulley (gaiusmod2@gmail.com)\n+# for GNU Modula-2.\n+\n+if $tracelevel then {\n+    strace $tracelevel\n+}\n+\n+# load support procs\n+load_lib gm2-torture.exp\n+\n+gm2_init_min \"${srcdir}/gm2/min/pass\"\n+\n+foreach testcase [lsort [glob -nocomplain $srcdir/$subdir/*.mod]] {\n+    # If we're only testing specific files and this isn't one of them, skip it.\n+    if ![runtest_file_p $runtests $testcase] then {\n+\tcontinue\n+    }\n+\n+    gm2-torture $testcase\n+}"}, {"sha": "e1165edbe4a1972aa20dd91155be54ec5f7e9364", "filename": "gcc/testsuite/gm2/link/min/pass/tiny.mod", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Ftestsuite%2Fgm2%2Flink%2Fmin%2Fpass%2Ftiny.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Ftestsuite%2Fgm2%2Flink%2Fmin%2Fpass%2Ftiny.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgm2%2Flink%2Fmin%2Fpass%2Ftiny.mod?ref=a24888388bab339cf8a8726ca67a0b4947a2d9ce", "patch": "@@ -0,0 +1,7 @@\n+MODULE tiny ;\n+\n+(* Does nothing at all, but it should link if -flibs=min is used.  *)\n+\n+BEGIN\n+\n+END tiny."}, {"sha": "9eba195291a105e46153c35fecf16fd4ed5be3e3", "filename": "gcc/testsuite/lib/gm2.exp", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Ftestsuite%2Flib%2Fgm2.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a24888388bab339cf8a8726ca67a0b4947a2d9ce/gcc%2Ftestsuite%2Flib%2Fgm2.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgm2.exp?ref=a24888388bab339cf8a8726ca67a0b4947a2d9ce", "patch": "@@ -496,3 +496,42 @@ proc gm2_init_cor { {path \"\"} args } {\n     gm2_link_lib \"m2cor m2pim m2iso\"\n     gm2_init {*}${theIpath} -fpim {*}${theLpath} {*}${args};\n }\n+\n+\n+#\n+#  gm2_init_minx - set the default libraries to choose MIN library and\n+#                  choose Modula-2, dialect.\n+#\n+#\n+\n+proc gm2_init_minx { dialect {path \"\"} args } {\n+    global srcdir;\n+    global gccpath;\n+\n+    set gm2src ${srcdir}/../m2;\n+\n+    send_log \"srcdir is $srcdir\\n\"\n+    send_log \"gccpath is $gccpath\\n\"\n+    send_log \"gm2src is $gm2src\\n\"\n+\n+    set minIpath \"${gccpath}/libgm2/libm2min\";\n+    set minLpath \"${gccpath}/libgm2/libm2min/.libs\";\n+\n+    set theIpath \"-I${minIpath}\";\n+    set theLpath \"-L${minLpath}\";\n+\n+    if { $path != \"\" } then {\n+\tappend theIpath \" -I\"\n+\tappend theIpath ${path}\n+    }\n+    gm2_init {*}${theIpath} {*}${dialect} {*}${theLpath} {*}${args};\n+}\n+\n+#\n+#  gm2_init_min - set the default libraries to choose MIN libraries\n+#                 and pim dialect.\n+#\n+\n+proc gm2_init_min { {path \"\"} args } {\n+    gm2_init_minx -fpim {*}${path} {*}${args};\n+}"}]}