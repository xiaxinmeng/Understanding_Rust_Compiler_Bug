{"sha": "bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmNiMzhjYzE4MGQxZjU2ZWFiNTM4Zjc2YzJhNjA4ZTZkZmQ2MWRhOQ==", "commit": {"author": {"name": "Kaveh R. Ghazi", "email": "ghazi@caip.rutgers.edu", "date": "2000-10-31T18:27:42Z"}, "committer": {"name": "Kaveh Ghazi", "email": "ghazi@gcc.gnu.org", "date": "2000-10-31T18:27:42Z"}, "message": "builtins.c (expand_builtin_fputs): When deleting NOP calls to builtin fputs...\n\n\t* builtins.c (expand_builtin_fputs): When deleting NOP calls to\n\tbuiltin fputs, ensure we still evaluate the stream in case it\n\thas side-effects.\n\ntestsuite:\n\t* gcc.c-torture/execute/stdio-opt-1.c: New test.\n\nFrom-SVN: r37162", "tree": {"sha": "36069d01197f46a9e613f71dc306dcb1c4138213", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36069d01197f46a9e613f71dc306dcb1c4138213"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/comments", "author": null, "committer": null, "parents": [{"sha": "bc359d3a5d3e8e6a5ad489b9da8740c2cf7bf301", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc359d3a5d3e8e6a5ad489b9da8740c2cf7bf301", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc359d3a5d3e8e6a5ad489b9da8740c2cf7bf301"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "fcc65c8b8f28aa818d5eb46a952614b228aeede4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "patch": "@@ -1,3 +1,9 @@\n+2000-10-31  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n+\n+\t* builtins.c (expand_builtin_fputs): When deleting NOP calls to\n+\tbuiltin fputs, ensure we still evaluate the stream in case it\n+\thas side-effects.\n+\n 2000-10-31  Jakub Jelinek  <jakub@redhat.com>\n \n \t* expr.c (do_store_flag): Pass operand_mode instead of GET_MODE (op0)"}, {"sha": "3304b68a46a81d26a677e4cfd492948c408c4f15", "filename": "gcc/builtins.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "patch": "@@ -2351,7 +2351,13 @@ expand_builtin_fputs (arglist, ignore)\n   switch (compare_tree_int (len, 1))\n     {\n     case -1: /* length is 0, delete the call entirely .  */\n-      return const0_rtx;\n+      {\n+\t/* Evaluate and ignore the argument in case it has\n+           side-effects.  */\n+\texpand_expr (TREE_VALUE (TREE_CHAIN (arglist)), const0_rtx,\n+\t\t     VOIDmode, EXPAND_NORMAL);\n+\treturn const0_rtx;\n+      }\n     case 0: /* length is 1, call fputc.  */\n       {\n \ttree stripped_string = TREE_VALUE (arglist);"}, {"sha": "6097ca2cc2eedfb3ae17b1bf006291b2a98cbc9e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "patch": "@@ -1,3 +1,7 @@\n+2000-10-31  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n+\n+\t* gcc.c-torture/execute/stdio-opt-1.c: New test.\n+\n 2000-10-31  Jakub Jelinek  <jakub@redhat.com>\n \n \t* g++.old-deja/g++.other/inline16.C: New test."}, {"sha": "aeb7302dc9339192eeb47fa65fe8b38b7771a57d", "filename": "gcc/testsuite/gcc.c-torture/execute/stdio-opt-1.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fstdio-opt-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb38cc180d1f56eab538f76c2a608e6dfd61da9/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fstdio-opt-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fstdio-opt-1.c?ref=bcb38cc180d1f56eab538f76c2a608e6dfd61da9", "patch": "@@ -0,0 +1,28 @@\n+/* Copyright (C) 2000  Free Software Foundation.\n+\n+   When eliminating NOP calls to builtin fputs, ensure that we still\n+   evaluate the stream argument in case it has side effects.\n+   Written by Kaveh R. Ghazi, 10/30/2000.  */\n+\n+#include <stdio.h>\n+\n+int main()\n+{\n+  FILE *s_array[3] = {stdout, NULL, stdout}, **s_ptr = s_array;\n+  \n+  /* Increment the stream pointer once.  */\n+  fputs (\"\", *s_ptr++);\n+\n+  /* Increment the stream pointer a second time.  */\n+  s_ptr++;\n+\n+  /* If we failed to increment the stream pointer twice, then the\n+     stream passed in here will be NULL and we should crash.  */\n+  fputs (\"hello world\\n\", *s_ptr);\n+  \n+  /* Just in case, If *s_ptr is NULL abort anyway.  */\n+  if (*s_ptr == 0)\n+    abort();\n+\n+  return 0;\n+}"}]}