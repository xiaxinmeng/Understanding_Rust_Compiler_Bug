{"sha": "1fc93860a54772c3302ba755eed504d3b00c88ef", "node_id": "C_kwDOANBUbNoAKDFmYzkzODYwYTU0NzcyYzMzMDJiYTc1NWVlZDUwNGQzYjAwYzg4ZWY", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2021-11-29T10:04:36Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-01-05T11:32:33Z"}, "message": "[Ada] Reduce runtime dependencies on stage1\n\ngcc/ada/\n\n\t* osint.adb (File_Names_Equal): Declare To_Lower locally.\n\t* osint.ads (Null_FD): New.\n\t* fmap.adb, sinput-l.adb, targparm.adb: Adapt to changes above.\n\t* switch-b.adb (Scan_Debug_Switches): Use Is_Regular_File to\n\tsimplify the bootstrap dependencies.", "tree": {"sha": "2077aa1486a3713a9efba5df5fccabfae743a450", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2077aa1486a3713a9efba5df5fccabfae743a450"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1fc93860a54772c3302ba755eed504d3b00c88ef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc93860a54772c3302ba755eed504d3b00c88ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1fc93860a54772c3302ba755eed504d3b00c88ef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc93860a54772c3302ba755eed504d3b00c88ef/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1021b72bf6542f3c08e5404b65063216ee1b06f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1021b72bf6542f3c08e5404b65063216ee1b06f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1021b72bf6542f3c08e5404b65063216ee1b06f7"}], "stats": {"total": 27, "additions": 23, "deletions": 4}, "files": [{"sha": "7597eba9cd88e9e8a9ab56e4b0453790d263739b", "filename": "gcc/ada/fmap.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Ffmap.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Ffmap.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffmap.adb?ref=1fc93860a54772c3302ba755eed504d3b00c88ef", "patch": "@@ -301,7 +301,7 @@ package body Fmap is\n       Read_Source_File (Name_Enter (File_Name), 1, Hi, Src, FD, Config);\n \n       if Null_Source_Buffer_Ptr (Src) then\n-         if FD = Null_FD then\n+         if FD = Osint.Null_FD then\n             Write_Str (\"warning: could not locate mapping file \"\"\");\n          else\n             Write_Str (\"warning: no read access for mapping file \"\"\");"}, {"sha": "a8a6801f9e4045d6bf34ea24d38178b5bbbbe08b", "filename": "gcc/ada/osint.adb", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fosint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fosint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint.adb?ref=1fc93860a54772c3302ba755eed504d3b00c88ef", "patch": "@@ -1059,6 +1059,21 @@ package body Osint is\n    ----------------------\n \n    function File_Names_Equal (File1, File2 : String) return Boolean is\n+\n+      function To_Lower (A : String) return String;\n+      --  For bootstrap reasons, we cannot use To_Lower from System.Case_Util\n+\n+      --------------\n+      -- To_Lower --\n+      --------------\n+\n+      function To_Lower (A : String) return String is\n+         Result : String := A;\n+      begin\n+         To_Lower (Result);\n+         return Result;\n+      end To_Lower;\n+\n    begin\n       if File_Names_Case_Sensitive then\n          return File1 = File2;"}, {"sha": "f733e65d330f69cb64ea4680c4aa952f59764962", "filename": "gcc/ada/osint.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fosint.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fosint.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint.ads?ref=1fc93860a54772c3302ba755eed504d3b00c88ef", "patch": "@@ -52,6 +52,10 @@ package Osint is\n    Project_Include_Path_File : constant String := \"ADA_PRJ_INCLUDE_FILE\";\n    Project_Objects_Path_File : constant String := \"ADA_PRJ_OBJECTS_FILE\";\n \n+   Null_FD : constant File_Descriptor := -2;\n+   --  Uninitialized file descriptor. Copied from System.OS_Lib for bootstrap\n+   --  reasons.\n+\n    Output_FD : File_Descriptor;\n    --  File descriptor for current library info, list, tree, C, H, or binder\n    --  output. Only one of these is open at a time, so we need only one FD."}, {"sha": "6a939bc6a880e8f65372155a624805177136efb0", "filename": "gcc/ada/sinput-l.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fsinput-l.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fsinput-l.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsinput-l.adb?ref=1fc93860a54772c3302ba755eed504d3b00c88ef", "patch": "@@ -420,7 +420,7 @@ package body Sinput.L is\n       if Null_Source_Buffer_Ptr (Src) then\n          Source_File.Decrement_Last;\n \n-         if FD = Null_FD then\n+         if FD = Osint.Null_FD then\n             return No_Source_File;\n          else\n             return No_Access_To_Source_File;"}, {"sha": "bea6ab3dc6c28aedaa7888f86ca5cb6a3d3971a2", "filename": "gcc/ada/switch-b.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fswitch-b.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Fswitch-b.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fswitch-b.adb?ref=1fc93860a54772c3302ba755eed504d3b00c88ef", "patch": "@@ -312,7 +312,7 @@ package body Switch.B is\n \n             Ptr := Max + 1;\n \n-            if not Is_Read_Accessible_File (Force_Elab_Order_File.all) then\n+            if not Is_Regular_File (Force_Elab_Order_File.all) then\n                Osint.Fail (Force_Elab_Order_File.all & \": file not found\");\n             end if;\n "}, {"sha": "ade05c25795251ccd405b52835d953c1f1638011", "filename": "gcc/ada/targparm.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Ftargparm.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc93860a54772c3302ba755eed504d3b00c88ef/gcc%2Fada%2Ftargparm.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ftargparm.adb?ref=1fc93860a54772c3302ba755eed504d3b00c88ef", "patch": "@@ -165,7 +165,7 @@ package body Targparm is\n       if Null_Source_Buffer_Ptr (Text) then\n          Write_Line (\"fatal error, run-time library not installed correctly\");\n \n-         if FD = Null_FD then\n+         if FD = Osint.Null_FD then\n             Write_Line (\"cannot locate file system.ads\");\n          else\n             Write_Line (\"no read access for file system.ads\");"}]}