{"sha": "a635db3debd75b2fe1bd839d6470bc6a313c3494", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTYzNWRiM2RlYmQ3NWIyZmUxYmQ4MzlkNjQ3MGJjNmEzMTNjMzQ5NA==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2006-05-20T00:28:14Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2006-05-20T00:28:14Z"}, "message": "re PR fortran/27662 ([4.1 only]: Transpose doesn't work on function return)\n\ngcc/fortran/\n\n2006-05-19  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR fortran/27662\n\t* trans-array.c (gfc_conv_expr_descriptor): Don't zere the\n\tfirst stride to indicate a temporary.\n\t* trans-expr.c (gfc_conv_function_call): Likewise.\n\ngcc/testsuite/\n\n2006-05-19  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR fortran/27662\n\t* gfortran.dg/temporary_1.f90: New file.\n\nFrom-SVN: r113922", "tree": {"sha": "c31024deb2fff1611d809b67b595eaa74195a96d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c31024deb2fff1611d809b67b595eaa74195a96d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a635db3debd75b2fe1bd839d6470bc6a313c3494", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a635db3debd75b2fe1bd839d6470bc6a313c3494", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a635db3debd75b2fe1bd839d6470bc6a313c3494", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a635db3debd75b2fe1bd839d6470bc6a313c3494/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ab9ddafbc03f7af9c4954ca18a4f44cb1cfaed63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab9ddafbc03f7af9c4954ca18a4f44cb1cfaed63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab9ddafbc03f7af9c4954ca18a4f44cb1cfaed63"}], "stats": {"total": 48, "additions": 40, "deletions": 8}, "files": [{"sha": "94db2b47d246ecd0c0b438d45de60baee9971bb3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a635db3debd75b2fe1bd839d6470bc6a313c3494", "patch": "@@ -1,3 +1,10 @@\n+2006-05-19  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR fortran/27662\n+\t* trans-array.c (gfc_conv_expr_descriptor): Don't zere the\n+\tfirst stride to indicate a temporary.\n+\t* trans-expr.c (gfc_conv_function_call): Likewise.\n+\n 2006-05-18  Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n \t    Feng Wang  <fengwang@nudt.edu.cn>\n "}, {"sha": "32283a3df06d074b5de9be680ea66f13dc6dae19", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=a635db3debd75b2fe1bd839d6470bc6a313c3494", "patch": "@@ -4108,10 +4108,7 @@ gfc_conv_expr_descriptor (gfc_se * se, gfc_expr * expr, gfc_ss * ss)\n       /* Finish the copying loops.  */\n       gfc_trans_scalarizing_loops (&loop, &block);\n \n-      /* Set the first stride component to zero to indicate a temporary.  */\n       desc = loop.temp_ss->data.info.descriptor;\n-      tmp = gfc_conv_descriptor_stride (desc, gfc_rank_cst[0]);\n-      gfc_add_modify_expr (&loop.pre, tmp, gfc_index_zero_node);\n \n       gcc_assert (is_gimple_lvalue (desc));\n     }"}, {"sha": "b91ebf6a663baab70f4bedf6a98d522b42c83c6f", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 0, "deletions": 5, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=a635db3debd75b2fe1bd839d6470bc6a313c3494", "patch": "@@ -2038,11 +2038,6 @@ gfc_conv_function_call (gfc_se * se, gfc_symbol * sym,\n \t  gfc_trans_create_temp_array (&se->pre, &se->post, se->loop, info, tmp,\n \t\t\t\t       false, !sym->attr.pointer, callee_alloc);\n \n-\t  /* Zero the first stride to indicate a temporary.  */\n-\t  tmp = gfc_conv_descriptor_stride (info->descriptor, gfc_rank_cst[0]);\n-\t  gfc_add_modify_expr (&se->pre, tmp,\n-\t\t\t       convert (TREE_TYPE (tmp), integer_zero_node));\n-\n \t  /* Pass the temporary as the first argument.  */\n \t  tmp = info->descriptor;\n \t  tmp = build_fold_addr_expr (tmp);"}, {"sha": "c5b0bffc9fc1c24789a65d4721faa8e50b612c83", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a635db3debd75b2fe1bd839d6470bc6a313c3494", "patch": "@@ -1,3 +1,8 @@\n+2006-05-19  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR fortran/27662\n+\t* gfortran.dg/temporary_1.f90: New file.\n+\n 2006-05-19  Andreas Schwab  <schwab@suse.de>\n \n \t* g++.dg/other/unused1.C: Also match \"stringz\"."}, {"sha": "e255efdb7a88bf90d754804d534054f16c20cfa8", "filename": "gcc/testsuite/gfortran.dg/temporary_1.f90", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ftestsuite%2Fgfortran.dg%2Ftemporary_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a635db3debd75b2fe1bd839d6470bc6a313c3494/gcc%2Ftestsuite%2Fgfortran.dg%2Ftemporary_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftemporary_1.f90?ref=a635db3debd75b2fe1bd839d6470bc6a313c3494", "patch": "@@ -0,0 +1,28 @@\n+! { dg-do run }\n+! PR 27662. Don't zero the first stride to indicate a temporary. It\n+! may be used later.\n+program pr27662\n+ implicit none\n+ real(kind=kind(1.0d0)), dimension (2, 2):: x, y, z;\n+ integer i, j\n+ x(1,1) = 1.d0 \n+ x(2,1) = 0.d0\n+ x(1,2) = 0.d0\n+ x(2,2) = 1.d0 \n+ z = matmul (x, transpose (test ()))\n+ do i = 1, size (x, 1)\n+   do j = 1, size (x, 2)\n+     if (x (i, j) .ne. z (i, j)) call abort ()\n+   end do\n+ end do\n+ close (10)\n+\n+contains\n+ function test () result (res)\n+   real(kind=kind(1.0d0)), dimension(2,2) :: res\n+   res(1,1) = 1.d0 \n+   res(2,1) = 0.d0\n+   res(1,2) = 0.d0\n+   res(2,2) = 1.d0 \n+ end function\n+end"}]}