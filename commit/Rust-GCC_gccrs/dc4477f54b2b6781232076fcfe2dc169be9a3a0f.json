{"sha": "dc4477f54b2b6781232076fcfe2dc169be9a3a0f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM0NDc3ZjU0YjJiNjc4MTIzMjA3NmZjZmUyZGMxNjliZTlhM2EwZg==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel1@de.ibm.com", "date": "2005-08-12T11:58:05Z"}, "committer": {"name": "Ulrich Weigand", "email": "uweigand@gcc.gnu.org", "date": "2005-08-12T11:58:05Z"}, "message": "s390.c (s390_split_branches, [...]): Don't set save_return_addr_p.\n\n2005-08-12  Andreas Krebbel  <krebbel1@de.ibm.com>\n\n\t* config/s390/s390.c (s390_split_branches, s390_init_frame_layout):\n\tDon't set save_return_addr_p.\n\t(s390_register_info): Make clobbered_regs not depending on\n\tsave_return_addr_p.\n\nFrom-SVN: r103025", "tree": {"sha": "f7cd58dea77485f0981d31174e5bb7291811abd5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f7cd58dea77485f0981d31174e5bb7291811abd5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc4477f54b2b6781232076fcfe2dc169be9a3a0f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc4477f54b2b6781232076fcfe2dc169be9a3a0f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc4477f54b2b6781232076fcfe2dc169be9a3a0f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc4477f54b2b6781232076fcfe2dc169be9a3a0f/comments", "author": null, "committer": null, "parents": [{"sha": "f0ed20083b9f18a27a81f8d01b44a826bc08521b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0ed20083b9f18a27a81f8d01b44a826bc08521b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0ed20083b9f18a27a81f8d01b44a826bc08521b"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "c6deedc0b3e1e4de3a2de2c2eef6a736bd7e4968", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc4477f54b2b6781232076fcfe2dc169be9a3a0f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc4477f54b2b6781232076fcfe2dc169be9a3a0f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dc4477f54b2b6781232076fcfe2dc169be9a3a0f", "patch": "@@ -1,3 +1,10 @@\n+2005-08-12  Andreas Krebbel  <krebbel1@de.ibm.com>\n+\n+\t* config/s390/s390.c (s390_split_branches, s390_init_frame_layout): \n+\tDon't set save_return_addr_p.\n+\t(s390_register_info): Make clobbered_regs not depending on\n+\tsave_return_addr_p.\n+\n 2005-08-12  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \t* gcc.c (LINK_SSP_SPEC): Remove space before a trailing }."}, {"sha": "fec7a3d747e20678418c6b94f9fbc173093bc04b", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 10, "deletions": 14, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc4477f54b2b6781232076fcfe2dc169be9a3a0f/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc4477f54b2b6781232076fcfe2dc169be9a3a0f/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=dc4477f54b2b6781232076fcfe2dc169be9a3a0f", "patch": "@@ -224,7 +224,10 @@ struct s390_frame_layout GTY (())\n   /* Number of floating point registers f8-f15 which must be saved.  */\n   int high_fprs;\n \n-  /* Set if return address needs to be saved.  */\n+  /* Set if return address needs to be saved.\n+     This flag is set by s390_return_addr_rtx if it could not use\n+     the initial value of r14 and therefore depends on r14 saved\n+     to the stack.  */\n   bool save_return_addr_p;\n \n   /* Size of stack frame.  */\n@@ -4405,10 +4408,6 @@ s390_split_branches (void)\n       if (get_attr_length (insn) <= 4)\n \tcontinue;\n \n-      /* We are going to use the return register as scratch register,\n-\t make sure it will be saved/restored by the prologue/epilogue.  */\n-      cfun_frame_layout.save_return_addr_p = 1;\n-\n       if (!flag_pic)\n \t{\n \t  new_literal = 1;\n@@ -5818,8 +5817,12 @@ s390_register_info (int clobbered_regs[])\n       && REGNO (cfun->machine->base_reg) == BASE_REGNUM;\n \n   clobbered_regs[RETURN_REGNUM]\n-    = cfun->machine->split_branches_pending_p\n-      || cfun_frame_layout.save_return_addr_p;\n+    |= (cfun->machine->split_branches_pending_p\n+\t|| cfun_frame_layout.save_return_addr_p\n+\t|| TARGET_TPF_PROFILING\n+\t|| !current_function_is_leaf\n+\t|| current_function_stdarg\n+\t|| current_function_calls_eh_return);\n \n   clobbered_regs[STACK_POINTER_REGNUM]\n     = !current_function_is_leaf\n@@ -6021,13 +6024,6 @@ s390_init_frame_layout (void)\n   /* If return address register is explicitly used, we need to save it.  */\n   s390_regs_ever_clobbered (clobbered_regs);\n \n-  if (clobbered_regs[RETURN_REGNUM]\n-      || !current_function_is_leaf\n-      || TARGET_TPF_PROFILING\n-      || current_function_stdarg\n-      || current_function_calls_eh_return)\n-    cfun_frame_layout.save_return_addr_p = true;\n-\n   /* On S/390 machines, we may need to perform branch splitting, which\n      will require both base and return address register.  We have no\n      choice but to assume we're going to need them until right at the"}]}