{"sha": "8d039470f6ddd258edc714519a25a39b270c09d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGQwMzk0NzBmNmRkZDI1OGVkYzcxNDUxOWEyNWEzOWIyNzBjMDlkMw==", "commit": {"author": {"name": "Mike Stump", "email": "mrs@apple.com", "date": "2005-07-28T18:06:47Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2005-07-28T18:06:47Z"}, "message": "pt.c (check_explicit_specialization): Add visibility logic.\n\n        * pt.c (check_explicit_specialization): Add visibility logic.\n        (lookup_template_class): Likewise.\n        (instantiate_class_template): Likewise.\n\n        * g++.old-deja/g++.mike/visibility-1.C: New test.\nRadar 4182971.\n\nFrom-SVN: r102499", "tree": {"sha": "a9c4159958e86a9067086f3ae21d9b874a0042be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9c4159958e86a9067086f3ae21d9b874a0042be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8d039470f6ddd258edc714519a25a39b270c09d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d039470f6ddd258edc714519a25a39b270c09d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d039470f6ddd258edc714519a25a39b270c09d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d039470f6ddd258edc714519a25a39b270c09d3/comments", "author": null, "committer": null, "parents": [{"sha": "facc20ee9b776ac4829a49a0bc1be1267b8358f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/facc20ee9b776ac4829a49a0bc1be1267b8358f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/facc20ee9b776ac4829a49a0bc1be1267b8358f4"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "31e3d97e6b8aa71792b8383fac1f7d07dd3e5379", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8d039470f6ddd258edc714519a25a39b270c09d3", "patch": "@@ -1,3 +1,9 @@\n+2005-07-28  Mike Stump  <mrs@apple.com>\n+\n+\t* pt.c (check_explicit_specialization): Add visibility logic.\n+\t(lookup_template_class): Likewise.\n+\t(instantiate_class_template): Likewise.\n+\n 2005-07-27  Devang Patel  <dpatel@apple.com>\n \n \t* name-lookup.c (pushtag): Do no set DECL_IGNORED_P bit."}, {"sha": "3403e8bf2d1be1192893eee482526db2cd290285", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=8d039470f6ddd258edc714519a25a39b270c09d3", "patch": "@@ -2087,6 +2087,14 @@ check_explicit_specialization (tree declarator,\n \t  TREE_PRIVATE (decl) = TREE_PRIVATE (gen_tmpl);\n \t  TREE_PROTECTED (decl) = TREE_PROTECTED (gen_tmpl);\n \n+\t  /* The specialization has the same visibility as the\n+\t     template it specializes.  */\n+\t  if (DECL_VISIBILITY_SPECIFIED (gen_tmpl))\n+\t    {\n+\t      DECL_VISIBILITY_SPECIFIED (decl) = 1;\n+\t      DECL_VISIBILITY (decl) = DECL_VISIBILITY (gen_tmpl);\n+\t    }\n+\n \t  if (is_friend && !have_def)\n \t    /* This is not really a declaration of a specialization.\n \t       It's just the name of an instantiation.  But, it's not\n@@ -4606,6 +4614,11 @@ lookup_template_class (tree d1,\n \t= TREE_PROTECTED (TYPE_STUB_DECL (template_type));\n       DECL_IN_SYSTEM_HEADER (type_decl)\n \t= DECL_IN_SYSTEM_HEADER (template);\n+      if (CLASSTYPE_VISIBILITY_SPECIFIED (template_type))\n+\t{\n+\t  DECL_VISIBILITY_SPECIFIED (type_decl) = 1;\n+\t  DECL_VISIBILITY (type_decl) = CLASSTYPE_VISIBILITY (template_type);\n+\t}\n \n       /* Set up the template information.  We have to figure out which\n \t template is the immediate parent if this is a full\n@@ -5525,6 +5538,11 @@ instantiate_class_template (tree type)\n   TYPE_FOR_JAVA (type) = TYPE_FOR_JAVA (pattern); /* For libjava's JArray<T> */\n   if (ANON_AGGR_TYPE_P (pattern))\n     SET_ANON_AGGR_TYPE_P (type);\n+  if (CLASSTYPE_VISIBILITY_SPECIFIED (pattern))\n+    {\n+      CLASSTYPE_VISIBILITY_SPECIFIED (type) = 1;\n+      CLASSTYPE_VISIBILITY (type) = CLASSTYPE_VISIBILITY (pattern);\n+    }\n \n   pbinfo = TYPE_BINFO (pattern);\n "}, {"sha": "64fa8fe6f40487258f30f1d8b9256fe0b552471d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8d039470f6ddd258edc714519a25a39b270c09d3", "patch": "@@ -1,3 +1,7 @@\n+2005-07-28  Mike Stump  <mrs@apple.com>\n+\n+\t* g++.old-deja/g++.mike/visibility-1.C: New test.\n+\n 2005-07-28  Richard Sandiford  <richard@codesourcery.com>\n \n \tPR c/20187"}, {"sha": "40e742708bd6922b848d59242d22689b226dddf1", "filename": "gcc/testsuite/g++.old-deja/g++.mike/visibility-1.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fvisibility-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d039470f6ddd258edc714519a25a39b270c09d3/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fvisibility-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fvisibility-1.C?ref=8d039470f6ddd258edc714519a25a39b270c09d3", "patch": "@@ -0,0 +1,22 @@\n+/* Test visibility attribute on template member function\n+   instantiations. */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-fvisibility=hidden\" } */\n+/* { dg-require-visibility \"\" } */\n+/* { dg-final { scan-not-hidden \"_ZN7myClassIiE3maxEii\" } } */\n+\n+#define EXPORT __attribute__((visibility(\"default\")))\n+\n+template <class T>\n+class EXPORT myClass {\n+public:\n+  T max (T t1, T t2);\n+};\n+\n+template <class T>\n+T myClass<T>::max (T t1, T t2) {\n+  return (t1 > t2 ? t1 : t2);\n+}\n+\n+template class myClass<int>;"}]}