{"sha": "bef016bff7ed63c87dedfcdeac0e00653de3565a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmVmMDE2YmZmN2VkNjNjODdkZWRmY2RlYWMwZTAwNjUzZGUzNTY1YQ==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-08-22T01:02:15Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-08-22T01:02:15Z"}, "message": "re PR fortran/81296 (derived type I/o problem)\n\n2017-08-21  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/81296\n\t* trans-io.c (get_dtio_proc): Add check for format label and set\n\tformatted flag accordingly. Reorganize the code a little.\n\n\t* gfortran.dg/dtio_12.f90: Update test.\n\nFrom-SVN: r251254", "tree": {"sha": "7dbdbdbd1d20c200d72d383fb98cd9534dc3e20e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7dbdbdbd1d20c200d72d383fb98cd9534dc3e20e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bef016bff7ed63c87dedfcdeac0e00653de3565a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bef016bff7ed63c87dedfcdeac0e00653de3565a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bef016bff7ed63c87dedfcdeac0e00653de3565a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bef016bff7ed63c87dedfcdeac0e00653de3565a/comments", "author": null, "committer": null, "parents": [{"sha": "4f1aa9fbd40bc474ca1f757f8787762626e5e80a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f1aa9fbd40bc474ca1f757f8787762626e5e80a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f1aa9fbd40bc474ca1f757f8787762626e5e80a"}], "stats": {"total": 43, "additions": 33, "deletions": 10}, "files": [{"sha": "1b2b4c9375374f408c63b86d5585c69c5f07559c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=bef016bff7ed63c87dedfcdeac0e00653de3565a", "patch": "@@ -1,3 +1,9 @@\n+2017-08-21  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/81296\n+\t* trans-io.c (get_dtio_proc): Add check for format label and set\n+\tformatted flag accordingly. Reorganize the code a little.\n+\n 2017-08-16  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/81116"}, {"sha": "aa974eb3805661ead84096e17cff25479a0b4a8f", "filename": "gcc/fortran/trans-io.c", "status": "modified", "additions": 16, "deletions": 10, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ffortran%2Ftrans-io.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ffortran%2Ftrans-io.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-io.c?ref=bef016bff7ed63c87dedfcdeac0e00653de3565a", "patch": "@@ -2214,18 +2214,24 @@ get_dtio_proc (gfc_typespec * ts, gfc_code * code, gfc_symbol **dtio_sub)\n   bool formatted = false;\n   gfc_dt *dt = code->ext.dt;\n \n-  if (dt && dt->format_expr)\n+  if (dt)\n     {\n-      char *fmt;\n-      fmt = gfc_widechar_to_char (dt->format_expr->value.character.string,\n-\t\t\t\t  -1);\n-      if (strtok (fmt, \"DT\") != NULL)\n+      char *fmt = NULL;\n+\n+      if (dt->format_label == &format_asterisk)\n+\t{\n+\t  /* List directed io must call the formatted DTIO procedure.  */\n+\t  formatted = true;\n+\t}\n+      else if (dt->format_expr)\n+\tfmt = gfc_widechar_to_char (dt->format_expr->value.character.string,\n+\t\t\t\t      -1);\n+      else if (dt->format_label)\n+\tfmt = gfc_widechar_to_char (dt->format_label->format->value.character.string,\n+\t\t\t\t      -1);\n+      if (fmt && strtok (fmt, \"DT\") != NULL)\n \tformatted = true;\n-    }\n-  else if (dt && dt->format_label == &format_asterisk)\n-    {\n-      /* List directed io must call the formatted DTIO procedure.  */\n-      formatted = true;\n+\n     }\n \n   if (ts->type == BT_CLASS)"}, {"sha": "ed19baca4046edf2ff10afb31bda80240d6dbda9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bef016bff7ed63c87dedfcdeac0e00653de3565a", "patch": "@@ -1,3 +1,8 @@\n+2017-08-21  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/81296\n+\t* gfortran.dg/dtio_12.f90: Update test.\n+\n 2017-08-21  Nathan Sidwell  <nathan@acm.org>\n \n \t* g++.dg/template/pr81899.C: Fix c++03."}, {"sha": "cf1bfe38e2f6690c11a3f9978e69851dd405b0e8", "filename": "gcc/testsuite/gfortran.dg/dtio_12.f90", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ftestsuite%2Fgfortran.dg%2Fdtio_12.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bef016bff7ed63c87dedfcdeac0e00653de3565a/gcc%2Ftestsuite%2Fgfortran.dg%2Fdtio_12.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdtio_12.f90?ref=bef016bff7ed63c87dedfcdeac0e00653de3565a", "patch": "@@ -67,6 +67,12 @@ subroutine write_formatted(this,unit,iotype,vlist,iostat,iomsg)\n   if (trim (msg) .ne. \"42\") call abort\n   rewind (10)\n   write (10,\"(DT)\") child (77)                         ! The original testcase\n+  rewind (10)\n+  read (10, *) msg\n+  if (trim (msg) .ne. \"77\") call abort\n+  rewind (10)\n+  write (10,40) child (77)                         ! Modified using format label\n+40 format(DT)\n   rewind (10)\n   read (10, *) msg\n   if (trim (msg) .ne. \"77\") call abort"}]}