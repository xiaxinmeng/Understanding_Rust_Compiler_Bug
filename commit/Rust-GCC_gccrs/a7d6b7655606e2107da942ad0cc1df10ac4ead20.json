{"sha": "a7d6b7655606e2107da942ad0cc1df10ac4ead20", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTdkNmI3NjU1NjA2ZTIxMDdkYTk0MmFkMGNjMWRmMTBhYzRlYWQyMA==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2006-02-13T21:31:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-02-13T21:31:18Z"}, "message": "re PR fortran/26246 (return string length is being marked as TREE_STATIC and TREE_PUBLIC)\n\n2006-02-13  Andrew Pinski  <pinskia@physics.uc.edu>\n\t    Jakub Jelinek  <jakub@redhat.com>\n\n\tPR fortran/26246\n\t* trans-decl.c (gfc_get_symbol_decl, gfc_get_fake_result_decl): Use\n\tgfc_add_decl_to_function rather than gfc_finish_var_decl on length.\n\n\t* gfortran.dg/pr26246_1.f90: New test.\n\t* gfortran.dg/pr26246_2.f90: New test.\n\nFrom-SVN: r110929", "tree": {"sha": "a794ae1237b5805a753aa941e0560320e6deceec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a794ae1237b5805a753aa941e0560320e6deceec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7d6b7655606e2107da942ad0cc1df10ac4ead20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7d6b7655606e2107da942ad0cc1df10ac4ead20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7d6b7655606e2107da942ad0cc1df10ac4ead20", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7d6b7655606e2107da942ad0cc1df10ac4ead20/comments", "author": null, "committer": null, "parents": [{"sha": "6f538523d1e363cb51f08b52e31062304352e543", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f538523d1e363cb51f08b52e31062304352e543", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f538523d1e363cb51f08b52e31062304352e543"}], "stats": {"total": 46, "additions": 44, "deletions": 2}, "files": [{"sha": "d4a2720c6bf1caeec2f434a120f5efd2b98ea1a6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a7d6b7655606e2107da942ad0cc1df10ac4ead20", "patch": "@@ -1,3 +1,10 @@\n+2006-02-13  Andrew Pinski  <pinskia@physics.uc.edu>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/26246\n+\t* trans-decl.c (gfc_get_symbol_decl, gfc_get_fake_result_decl): Use\n+\tgfc_add_decl_to_function rather than gfc_finish_var_decl on length.\n+\n 2006-02-13  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/26074"}, {"sha": "3d43c66fa70bc1bfca1458f4cb4c435533501735", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=a7d6b7655606e2107da942ad0cc1df10ac4ead20", "patch": "@@ -873,7 +873,7 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n \t  if (TREE_CODE (length) == VAR_DECL\n \t      && DECL_CONTEXT (length) == NULL_TREE)\n \t    {\n-\t      gfc_finish_var_decl (length, sym);\n+\t      gfc_add_decl_to_function (length);\n \t      gfc_defer_symbol_init (sym);\n \t    }\n \t}\n@@ -1779,7 +1779,7 @@ gfc_get_fake_result_decl (gfc_symbol * sym)\n \tlength = sym->ts.cl->backend_decl;\n       if (TREE_CODE (length) == VAR_DECL\n \t  && DECL_CONTEXT (length) == NULL_TREE)\n-\tgfc_finish_var_decl (length, sym);\n+\tgfc_add_decl_to_function (length);\n     }\n \n   if (gfc_return_by_reference (sym))"}, {"sha": "9cfac859828d3a15d7ceafb7daa0636492a330a2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a7d6b7655606e2107da942ad0cc1df10ac4ead20", "patch": "@@ -1,5 +1,9 @@\n 2006-02-13  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/26246\n+\t* gfortran.dg/pr26246_1.f90: New test.\n+\t* gfortran.dg/pr26246_2.f90: New test.\n+\n \tPR middle-end/26092\n \t* gcc.c-torture/compile/20060208-1.c: New test.\n "}, {"sha": "a1cb45535fe047f78c9c5ad36c3ff154dd50ef80", "filename": "gcc/testsuite/gfortran.dg/pr26246_1.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr26246_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr26246_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr26246_1.f90?ref=a7d6b7655606e2107da942ad0cc1df10ac4ead20", "patch": "@@ -0,0 +1,18 @@\n+! PR fortran/26246\n+! { dg-options \"-fdump-tree-original\" }\n+! { dg-do compile }\n+\n+module pr26246_1\n+  implicit none\n+  contains\n+    function foo(string)\n+    character(*), intent(in) :: string\n+    character(len=len(string)+2) :: foo\n+    if (index(trim(string), '\"').ne.0) then\n+      foo = \"'\" // trim(string) // \"'\"\n+    end if\n+  end function foo\n+end module pr26246_1\n+\n+! { dg-final { scan-tree-dump-times \"static int\" 0 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }"}, {"sha": "440e868561c7908afc029ff75ddce33c5f1f53af", "filename": "gcc/testsuite/gfortran.dg/pr26246_2.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr26246_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7d6b7655606e2107da942ad0cc1df10ac4ead20/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr26246_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr26246_2.f90?ref=a7d6b7655606e2107da942ad0cc1df10ac4ead20", "patch": "@@ -0,0 +1,13 @@\n+! PR fortran/26246\n+! { dg-options \"-fdump-tree-original -fno-automatic\" }\n+! { dg-do compile }\n+\n+subroutine foo(string, n)\n+  implicit none\n+  integer :: n\n+  character(len=n + 6), intent(in) :: string\n+  if (string .eq. 'abc') call abort\n+end subroutine foo\n+\n+! { dg-final { scan-tree-dump-times \"static int\" 0 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }"}]}