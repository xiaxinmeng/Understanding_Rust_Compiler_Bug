{"sha": "b9dd1a79284dd9883c1eec0412145108135e3d75", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjlkZDFhNzkyODRkZDk4ODNjMWVlYzA0MTIxNDUxMDgxMzVlM2Q3NQ==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2018-04-12T09:14:57Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2018-04-12T09:14:57Z"}, "message": "IBM Z: Spectre: Prevent thunk cfi to be emitted with -fno-dwarf2-cfi-asm\n\nThe CFI magic we emit as part of the indirect branch thunks in order to\nhave somewhat sane unwind information must not be emitted with\n-fno-dwarf2-cfi-asm.\n\ngcc/ChangeLog:\n\n2018-04-12  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\t* config/s390/s390.c (s390_output_indirect_thunk_function): Check\n\talso for flag_dwarf2_cfi_asm.\n\ngcc/testsuite/ChangeLog:\n\n2018-04-12  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\t* gcc.target/s390/nobp-no-dwarf2-cfi.c: New test.\n\nFrom-SVN: r259340", "tree": {"sha": "8cc85a16fe626b1297e2c269ba4d36e8fc19286b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8cc85a16fe626b1297e2c269ba4d36e8fc19286b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b9dd1a79284dd9883c1eec0412145108135e3d75", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9dd1a79284dd9883c1eec0412145108135e3d75", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9dd1a79284dd9883c1eec0412145108135e3d75", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9dd1a79284dd9883c1eec0412145108135e3d75/comments", "author": null, "committer": null, "parents": [{"sha": "c72a0e67a2fe102d9b40463ab01c9080a996a09f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c72a0e67a2fe102d9b40463ab01c9080a996a09f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c72a0e67a2fe102d9b40463ab01c9080a996a09f"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "5d10cbf8716d8b3778abaf36558a24ed6a8a2067", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b9dd1a79284dd9883c1eec0412145108135e3d75", "patch": "@@ -1,3 +1,8 @@\n+2018-04-12  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\t* config/s390/s390.c (s390_output_indirect_thunk_function): Check\n+\talso for flag_dwarf2_cfi_asm.\n+\n 2018-04-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/85342"}, {"sha": "5add59858664e944cd8b0bd3fc3e6144f68d76b6", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=b9dd1a79284dd9883c1eec0412145108135e3d75", "patch": "@@ -16522,7 +16522,7 @@ s390_output_indirect_thunk_function (unsigned int regno, bool z10_p)\n      Stopping in the thunk: backtrace will point to the thunk target\n      is if it was interrupted by a signal.  For a call this means that\n      the call chain will be: caller->callee->thunk   */\n-  if (flag_asynchronous_unwind_tables)\n+  if (flag_asynchronous_unwind_tables && flag_dwarf2_cfi_asm)\n     {\n       fputs (\"\\t.cfi_signal_frame\\n\", asm_out_file);\n       fprintf (asm_out_file, \"\\t.cfi_return_column %d\\n\", regno);"}, {"sha": "d6cdfd4bc2893568e2c5fd052a49beef45d5259a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b9dd1a79284dd9883c1eec0412145108135e3d75", "patch": "@@ -1,3 +1,7 @@\n+2018-04-12  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\t* gcc.target/s390/nobp-no-dwarf2-cfi.c: New test.\n+\n 2018-04-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/85342"}, {"sha": "75e32a1c7c0087ab349602565be8994bae6646f9", "filename": "gcc/testsuite/gcc.target/s390/nobp-no-dwarf2-cfi.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fnobp-no-dwarf2-cfi.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9dd1a79284dd9883c1eec0412145108135e3d75/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fnobp-no-dwarf2-cfi.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fnobp-no-dwarf2-cfi.c?ref=b9dd1a79284dd9883c1eec0412145108135e3d75", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O3 -march=z900 --save-temps -mfunction-return-reg=thunk -mindirect-branch-table -fno-dwarf2-cfi-asm\" } */\n+\n+/* Make sure that we do not emit .cfi directives when -fno-dwarf2-cfi-asm is being used.  */\n+\n+int\n+main ()\n+{\n+  return 0;\n+}\n+\n+/* 1 x main\n+/* { dg-final { scan-assembler-times \"jg\\t__s390_indirect_jump\" 1 } } */\n+/* { dg-final { scan-assembler \"ex\\t\" } } */\n+\n+/* { dg-final { scan-assembler-not \"section\\t.s390_indirect_jump\" } } */\n+/* { dg-final { scan-assembler-not \"section\\t.s390_indirect_call\" } } */\n+/* { dg-final { scan-assembler     \"section\\t.s390_return_reg\" } } */\n+/* { dg-final { scan-assembler-not \"section\\t.s390_return_mem\" } } */"}]}