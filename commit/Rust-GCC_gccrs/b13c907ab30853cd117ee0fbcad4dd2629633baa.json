{"sha": "b13c907ab30853cd117ee0fbcad4dd2629633baa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjEzYzkwN2FiMzA4NTNjZDExN2VlMGZiY2FkNGRkMjYyOTYzM2JhYQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2015-03-12T08:48:32Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2015-03-12T08:48:32Z"}, "message": "tree-cfg.c (gimple_split_block): Remove loop finding stmt to split on.\n\n2015-03-12  Richard Biener  <rguenther@suse.de>\n\n\t* tree-cfg.c (gimple_split_block): Remove loop finding stmt\n\tto split on.\n\t* omp-low.c (expand_omp_taskreg): Split block before removing\n\tthe stmt.\n\t(expand_omp_target): Likewise.\n\t* ubsan.c (ubsan_expand_null_ifn): Adjust stmt if we replaced it.\n\t* tree-parloops.c (create_call_for_reduction_1): Pass a proper\n\tstmt to split_block.\n\nFrom-SVN: r221377", "tree": {"sha": "96cf4512c45734f7ca303c37449d8c368c5cb258", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96cf4512c45734f7ca303c37449d8c368c5cb258"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b13c907ab30853cd117ee0fbcad4dd2629633baa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b13c907ab30853cd117ee0fbcad4dd2629633baa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b13c907ab30853cd117ee0fbcad4dd2629633baa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b13c907ab30853cd117ee0fbcad4dd2629633baa/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cb599e7d76f71c8bcb7f9484916f6be88527f8a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb599e7d76f71c8bcb7f9484916f6be88527f8a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb599e7d76f71c8bcb7f9484916f6be88527f8a6"}], "stats": {"total": 46, "additions": 24, "deletions": 22}, "files": [{"sha": "e800af187578fd43223b52e017f1f08c80c64c34", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b13c907ab30853cd117ee0fbcad4dd2629633baa", "patch": "@@ -1,3 +1,14 @@\n+2015-03-12  Richard Biener  <rguenther@suse.de>\n+\n+\t* tree-cfg.c (gimple_split_block): Remove loop finding stmt\n+\tto split on.\n+\t* omp-low.c (expand_omp_taskreg): Split block before removing\n+\tthe stmt.\n+\t(expand_omp_target): Likewise.\n+\t* ubsan.c (ubsan_expand_null_ifn): Adjust stmt if we replaced it.\n+\t* tree-parloops.c (create_call_for_reduction_1): Pass a proper\n+\tstmt to split_block.\n+\n 2015-03-12  Tom de Vries  <tom@codesourcery.com>\n \n \tPR rtl-optimization/64895"}, {"sha": "2d64a74e3eaf89c46b9e859ee624c98d292f6521", "filename": "gcc/omp-low.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=b13c907ab30853cd117ee0fbcad4dd2629633baa", "patch": "@@ -5514,8 +5514,8 @@ expand_omp_taskreg (struct omp_region *region)\n       stmt = gsi_stmt (gsi);\n       gcc_assert (stmt && (gimple_code (stmt) == GIMPLE_OMP_PARALLEL\n \t\t\t   || gimple_code (stmt) == GIMPLE_OMP_TASK));\n-      gsi_remove (&gsi, true);\n       e = split_block (entry_bb, stmt);\n+      gsi_remove (&gsi, true);\n       entry_bb = e->dest;\n       single_succ_edge (entry_bb)->flags = EDGE_FALLTHRU;\n \n@@ -8889,8 +8889,8 @@ expand_omp_target (struct omp_region *region)\n       stmt = gsi_stmt (gsi);\n       gcc_assert (stmt\n \t\t  && gimple_code (stmt) == gimple_code (entry_stmt));\n-      gsi_remove (&gsi, true);\n       e = split_block (entry_bb, stmt);\n+      gsi_remove (&gsi, true);\n       entry_bb = e->dest;\n       single_succ_edge (entry_bb)->flags = EDGE_FALLTHRU;\n "}, {"sha": "e1bc14351baf749d359d7c9aef9548d8799f8f58", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 8, "deletions": 19, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=b13c907ab30853cd117ee0fbcad4dd2629633baa", "patch": "@@ -5683,7 +5683,6 @@ gimple_split_block (basic_block bb, void *stmt)\n {\n   gimple_stmt_iterator gsi;\n   gimple_stmt_iterator gsi_tgt;\n-  gimple act;\n   gimple_seq list;\n   basic_block new_bb;\n   edge e;\n@@ -5697,26 +5696,16 @@ gimple_split_block (basic_block bb, void *stmt)\n   FOR_EACH_EDGE (e, ei, new_bb->succs)\n     e->src = new_bb;\n \n-  if (stmt && gimple_code ((gimple) stmt) == GIMPLE_LABEL)\n-    stmt = NULL;\n-\n-  /* Move everything from GSI to the new basic block.  */\n-  for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&gsi))\n+  /* Get a stmt iterator pointing to the first stmt to move.  */\n+  if (!stmt || gimple_code ((gimple) stmt) == GIMPLE_LABEL)\n+    gsi = gsi_after_labels (bb);\n+  else\n     {\n-      act = gsi_stmt (gsi);\n-      if (gimple_code (act) == GIMPLE_LABEL)\n-\tcontinue;\n-\n-      if (!stmt)\n-\tbreak;\n-\n-      if (stmt == act)\n-\t{\n-\t  gsi_next (&gsi);\n-\t  break;\n-\t}\n+      gsi = gsi_for_stmt ((gimple) stmt);\n+      gsi_next (&gsi);\n     }\n-\n+ \n+  /* Move everything from GSI to the new basic block.  */\n   if (gsi_end_p (gsi))\n     return new_bb;\n "}, {"sha": "fbb9eebddcf23e0c3498668e7aaa4708d302f255", "filename": "gcc/tree-parloops.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Ftree-parloops.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Ftree-parloops.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-parloops.c?ref=b13c907ab30853cd117ee0fbcad4dd2629633baa", "patch": "@@ -1111,7 +1111,8 @@ create_call_for_reduction_1 (reduction_info **slot, struct clsn_data *clsn_data)\n   /* Create phi node.  */\n   bb = clsn_data->load_bb;\n \n-  e = split_block (bb, t);\n+  gsi = gsi_last_bb (bb);\n+  e = split_block (bb, gsi_stmt (gsi));\n   new_bb = e->dest;\n \n   tmp_load = create_tmp_var (TREE_TYPE (TREE_TYPE (addr)));"}, {"sha": "0e23d919744de85acd93193db5ae3ad79013c73f", "filename": "gcc/ubsan.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Fubsan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b13c907ab30853cd117ee0fbcad4dd2629633baa/gcc%2Fubsan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fubsan.c?ref=b13c907ab30853cd117ee0fbcad4dd2629633baa", "patch": "@@ -864,6 +864,7 @@ ubsan_expand_null_ifn (gimple_stmt_iterator *gsip)\n \n       /* Replace the UBSAN_NULL with a GIMPLE_COND stmt.  */\n       gsi_replace (&gsi, g, false);\n+      stmt = g;\n     }\n \n   if (check_align)"}]}