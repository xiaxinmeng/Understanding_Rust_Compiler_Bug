{"sha": "5cd3514cddd76e0a33208f85c3a623c7fb53470c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWNkMzUxNGNkZGQ3NmUwYTMzMjA4Zjg1YzNhNjIzYzdmYjUzNDcwYw==", "commit": {"author": {"name": "Hans-Peter Nilsson", "email": "hp@axis.com", "date": "2012-02-14T22:06:56Z"}, "committer": {"name": "Hans-Peter Nilsson", "email": "hp@gcc.gnu.org", "date": "2012-02-14T22:06:56Z"}, "message": "target-supports.exp (check_effective_target_fgnu_tm): New proc.\n\n\t* lib/target-supports.exp (check_effective_target_fgnu_tm): New\n\tproc.\n\t* gfortran.dg/trans-mem-skel.f90: Gate test on effective_target\n\tfgnu_tm. \n\t* gcc.dg/lto/trans-mem-1_0.c, gcc.dg/lto/trans-mem-2_0.c,\n\tgcc.dg/lto/trans-mem-3_0.c, gcc.dg/lto/trans-mem-4_0.c: Ditto.\n\t* gcc.dg/tm/tm.exp: Gate the whole of gcc.dg/tm on\n\teffective_target fgnu_tm.\n\t* g++.dg/tm/tm.exp: Ditto for g++.dg/tm.\n\nFrom-SVN: r184237", "tree": {"sha": "250c7bee258347e13b4186f79db8f18d6e627e41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/250c7bee258347e13b4186f79db8f18d6e627e41"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5cd3514cddd76e0a33208f85c3a623c7fb53470c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd3514cddd76e0a33208f85c3a623c7fb53470c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5cd3514cddd76e0a33208f85c3a623c7fb53470c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd3514cddd76e0a33208f85c3a623c7fb53470c/comments", "author": {"login": "hpataxisdotcom", "id": 80339731, "node_id": "MDQ6VXNlcjgwMzM5NzMx", "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hpataxisdotcom", "html_url": "https://github.com/hpataxisdotcom", "followers_url": "https://api.github.com/users/hpataxisdotcom/followers", "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}", "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}", "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions", "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs", "repos_url": "https://api.github.com/users/hpataxisdotcom/repos", "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}", "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "169264b3729134eaa40121199180979395181657", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/169264b3729134eaa40121199180979395181657", "html_url": "https://github.com/Rust-GCC/gccrs/commit/169264b3729134eaa40121199180979395181657"}], "stats": {"total": 34, "additions": 34, "deletions": 0}, "files": [{"sha": "1a583e5ed2f74f51b62d52988721a847c8170d2e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -1,3 +1,15 @@\n+2012-02-14  Hans-Peter Nilsson  <hp@axis.com>\n+\n+\t* lib/target-supports.exp (check_effective_target_fgnu_tm): New\n+\tproc.\n+\t* gfortran.dg/trans-mem-skel.f90: Gate test on effective_target\n+\tfgnu_tm. \n+\t* gcc.dg/lto/trans-mem-1_0.c, gcc.dg/lto/trans-mem-2_0.c,\n+\tgcc.dg/lto/trans-mem-3_0.c, gcc.dg/lto/trans-mem-4_0.c: Ditto.\n+\t* gcc.dg/tm/tm.exp: Gate the whole of gcc.dg/tm on\n+\teffective_target fgnu_tm.\n+\t* g++.dg/tm/tm.exp: Ditto for g++.dg/tm.\n+\n 2012-02-14  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/52247"}, {"sha": "f191abc9c1c09d73dbeffbe2f11ab12313413a39", "filename": "gcc/testsuite/g++.dg/tm/tm.exp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftm%2Ftm.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftm%2Ftm.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftm%2Ftm.exp?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -19,6 +19,10 @@\n # Load support procs.\n load_lib g++-dg.exp\n \n+if ![check_effective_target_fgnu_tm] {\n+  return\n+}\n+\n # If a testcase doesn't have special options, use these.\n global DEFAULT_CXXFLAGS\n if ![info exists DEFAULT_CXXFLAGS] then {"}, {"sha": "379f4ea84da4800ac51f40e4a11455f0ba61a3b5", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-1_0.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_0.c?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -1,6 +1,7 @@\n /* { dg-lto-options {{-flto -fgnu-tm}} } */\n /* { dg-lto-do link } */\n /* { dg-require-effective-target stdint_types } */\n+/* { dg-require-effective-target fgnu_tm } */\n \n int i;\n "}, {"sha": "f86d44426853261942e384eed1582f3b01c5ecaa", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-2_0.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_0.c?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -1,6 +1,7 @@\n /* { dg-lto-options {{-flto -fgnu-tm}} } */\n /* { dg-lto-do link } */\n /* { dg-require-effective-target stdint_types } */\n+/* { dg-require-effective-target fgnu_tm } */\n \n #include \"trans-mem.h\"\n "}, {"sha": "f622823dc5b315c4c06e0dfa94e486b3a5a099a6", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-3_0.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-3_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-3_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-3_0.c?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -1,6 +1,7 @@\n /* { dg-lto-options {{-flto}} } */\n /* { dg-lto-do link } */\n /* { dg-require-effective-target stdint_types } */\n+/* { dg-require-effective-target fgnu_tm } */\n \n /* Test that we can build one object file with -fgnu-tm\n    (trans-mem-3_1.c), but do the final link of all objects without"}, {"sha": "e3f471f23c3a4abc3aa1eb2a5ff7a9727f7b40ea", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-4_0.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-4_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-4_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-4_0.c?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -1,6 +1,7 @@\n /* { dg-lto-options {{-flto -fgnu-tm}} } */\n /* { dg-lto-do link } */\n /* { dg-require-effective-target stdint_types } */\n+/* { dg-require-effective-target fgnu_tm } */\n \n extern void foo() __attribute__((transaction_safe));\n "}, {"sha": "07c1493652050bb1fea7c220f9f85764b78b34c5", "filename": "gcc/testsuite/gcc.dg/tm/tm.exp", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Ftm.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Ftm.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Ftm.exp?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -19,6 +19,10 @@\n # Load support procs.\n load_lib gcc-dg.exp\n \n+if ![check_effective_target_fgnu_tm] {\n+  return\n+}\n+\n # If a testcase doesn't have special options, use these.\n global DEFAULT_CFLAGS\n if ![info exists DEFAULT_CFLAGS] then {"}, {"sha": "f02dfaf352394e43320dfeec4d35e9ee096cbe5f", "filename": "gcc/testsuite/gfortran.dg/trans-mem-skel.f90", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgfortran.dg%2Ftrans-mem-skel.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Fgfortran.dg%2Ftrans-mem-skel.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftrans-mem-skel.f90?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -1,5 +1,6 @@\n ! { dg-do compile }\n ! { dg-options \"-fgnu-tm\" }\n+! { dg-require-effective-target fgnu_tm }\n program foo\n       real x\n end program foo"}, {"sha": "13f68df49ed1a0f216ac87a1884c37011f018e8b", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd3514cddd76e0a33208f85c3a623c7fb53470c/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=5cd3514cddd76e0a33208f85c3a623c7fb53470c", "patch": "@@ -716,6 +716,15 @@ proc check_effective_target_fopenmp {} {\n     } \"-fopenmp\"]\n }\n \n+# Return 1 if compilation with -fgnu-tm is error-free for trivial\n+# code, 0 otherwise.\n+\n+proc check_effective_target_fgnu_tm {} {\n+    return [check_no_compiler_messages fgnu_tm object {\n+\tvoid foo (void) { }\n+    } \"-fgnu-tm\"]\n+}\n+\n # Return 1 if the target supports mmap, 0 otherwise.\n \n proc check_effective_target_mmap {} {"}]}