{"sha": "4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGYxZjMzYWE4MjU1MjcxZTU1MDRjYTZhMGRjZGVhMGY0ZjliMGI3OQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-12-10T22:49:43Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-12-10T22:49:43Z"}, "message": "re PR tree-optimization/34371 (verify_stmts failed (incorrect sharing of tree nodes))\n\n\tPR tree-optimization/34371\n\t* tree-vectorizer.h (struct _loop_vec_info): Add num_iters_unchanged\n\tfield.\n\t(LOOP_VINFO_NITERS_UNCHANGED): Define to num_iters_unchanged field.\n\t* tree-vectorizer.c (set_prologue_iterations,\n\tslpeel_tree_peel_loop_to_edge): Call unshare_expr on\n\tLOOP_VINFO_NITERS_UNCHANGED before using it.\n\n\t* gcc.c-torture/compile/20071207-1.c: New test.\n\nFrom-SVN: r130755", "tree": {"sha": "b3d2088e27b5f07e19b2e68b56260c2086c9d5ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b3d2088e27b5f07e19b2e68b56260c2086c9d5ae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0197270c6e3826925ce65bcca780ea218b770bf6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0197270c6e3826925ce65bcca780ea218b770bf6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0197270c6e3826925ce65bcca780ea218b770bf6"}], "stats": {"total": 43, "additions": 37, "deletions": 6}, "files": [{"sha": "c2c01545aa91a6430ea056e025182c0f275c2314", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "patch": "@@ -1,3 +1,13 @@\n+2007-12-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/34371\n+\t* tree-vectorizer.h (struct _loop_vec_info): Add num_iters_unchanged\n+\tfield.\n+\t(LOOP_VINFO_NITERS_UNCHANGED): Define to num_iters_unchanged field.\n+\t* tree-vectorizer.c (set_prologue_iterations,\n+\tslpeel_tree_peel_loop_to_edge): Call unshare_expr on\n+\tLOOP_VINFO_NITERS_UNCHANGED before using it.\n+\n 2007-12-10  Eric Botcazou  <ebotcazou@libertysurf.fr>\n \n \tPR target/34403"}, {"sha": "4774d300efc6f54c12ff9b83cdcd8ac19578f5f7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "patch": "@@ -1,3 +1,8 @@\n+2007-12-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/34371\n+\t* gcc.c-torture/compile/20071207-1.c: New test.\n+\n 2007-12-10  Simon Martin  <simartin@users.sourceforge.net>\n \n \tPR c++/34059"}, {"sha": "27b871616b1ac17d648d7839e88ed0a5b1820523", "filename": "gcc/testsuite/gcc.c-torture/compile/20071207-1.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20071207-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20071207-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20071207-1.c?ref=4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "patch": "@@ -0,0 +1,14 @@\n+/* PR tree-optimization/34371 */\n+/* Testcase by Martin Michlmayr <tbm@cyrius.com> */\n+\n+void centerln (int width, int ch, char *s)\n+{\n+  unsigned int sidebar;\n+  int i;\n+  char linet1[1000];\n+  char linet2[100];\n+  sidebar = (width - __builtin_strlen (s)) / 2;\n+  for (i = 0; i < sidebar; i++)\n+    linet2[i] = ch;\n+  __builtin_strcpy (linet1, linet2);\n+}"}, {"sha": "0131b9a4aaf41f5cf6de4d2f673de6ad134cb65d", "filename": "gcc/tree-vectorizer.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftree-vectorizer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftree-vectorizer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.c?ref=4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "patch": "@@ -1037,7 +1037,7 @@ set_prologue_iterations (basic_block bb_before_first_loop,\n   tree gimplify_stmt_list;\n   tree cost_pre_condition = NULL_TREE;\n   tree scalar_loop_iters = \n-    LOOP_VINFO_NITERS_UNCHANGED (loop_vec_info_for_loop (loop));\n+    unshare_expr (LOOP_VINFO_NITERS_UNCHANGED (loop_vec_info_for_loop (loop)));\n \n   e = single_pred_edge (bb_before_first_loop);\n   cond_bb = split_edge(e);\n@@ -1154,8 +1154,6 @@ slpeel_tree_peel_loop_to_edge (struct loop *loop,\n   edge exit_e = single_exit (loop);\n   LOC loop_loc;\n   tree cost_pre_condition = NULL_TREE;\n-  tree scalar_loop_iters = \n-    LOOP_VINFO_NITERS_UNCHANGED (loop_vec_info_for_loop (loop));\n   \n   if (!slpeel_can_duplicate_loop_p (loop, e))\n     return NULL;\n@@ -1307,10 +1305,13 @@ slpeel_tree_peel_loop_to_edge (struct loop *loop,\n \t\t     build_int_cst (TREE_TYPE (first_niters), 0));\n       if (check_profitability)\n \t{\n-\t    cost_pre_condition = \n+\t  tree scalar_loop_iters\n+\t    = unshare_expr (LOOP_VINFO_NITERS_UNCHANGED\n+\t\t\t\t\t(loop_vec_info_for_loop (loop)));\n+\t  cost_pre_condition = \n \t    build2 (LE_EXPR, boolean_type_node, scalar_loop_iters, \n \t\t    build_int_cst (TREE_TYPE (scalar_loop_iters), th));\n-  \n+\n \t  pre_condition = fold_build2 (TRUTH_OR_EXPR, boolean_type_node,\n \t\t\t\t       cost_pre_condition, pre_condition);\n \t}"}, {"sha": "0f3c34ef62ae89b0cdd079cd605afb962f0d3fb4", "filename": "gcc/tree-vectorizer.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftree-vectorizer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79/gcc%2Ftree-vectorizer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.h?ref=4f1f33aa8255271e5504ca6a0dcdea0f4f9b0b79", "patch": "@@ -164,6 +164,7 @@ typedef struct _loop_vec_info {\n \n   /* Number of iterations.  */\n   tree num_iters;\n+  tree num_iters_unchanged;\n \n   /* Minimum number of iterations below which vectorization is expected to\n      not be profitable (as estimated by the cost model). \n@@ -230,7 +231,7 @@ typedef struct _loop_vec_info {\n #define LOOP_VINFO_NITERS(L)          (L)->num_iters\n /* Since LOOP_VINFO_NITERS can change after prologue peeling\n    retain total unchanged scalar loop iterations for cost model.  */\n-#define LOOP_VINFO_NITERS_UNCHANGED(L)          (L)->num_iters\n+#define LOOP_VINFO_NITERS_UNCHANGED(L)          (L)->num_iters_unchanged\n #define LOOP_VINFO_COST_MODEL_MIN_ITERS(L)\t(L)->min_profitable_iters\n #define LOOP_VINFO_VECTORIZABLE_P(L)  (L)->vectorizable\n #define LOOP_VINFO_VECT_FACTOR(L)     (L)->vectorization_factor"}]}