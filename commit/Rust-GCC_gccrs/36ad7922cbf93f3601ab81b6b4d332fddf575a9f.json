{"sha": "36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzZhZDc5MjJjYmY5M2YzNjAxYWI4MWI2YjRkMzMyZmRkZjU3NWE5Zg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-12-03T22:35:39Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-12-03T22:35:39Z"}, "message": "re PR tree-optimization/33453 (ICE in build2_stat, at tree.c:3110 with -ftree-parallelize-loops=4 -ftree-vectorize)\n\n\tPR tree-optimization/33453\n\t* tree-data-ref.c (split_constant_offset): Use POINTER_PLUS_EXPR\n\tfor pointer addition.\n\t* tree-parloops.c (canonicalize_loop_ivs): Likewise.\n\t(separate_decls_in_loop_name): Copy DECL_GIMPLE_REG_P from var to\n\tvar_copy.\n\n\t* gcc.c-torture/compile/20071203-1.c: New test.\n\nFrom-SVN: r130588", "tree": {"sha": "2d895fa1824f3bcdddf0dd88ec2b8c169f4f8c40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d895fa1824f3bcdddf0dd88ec2b8c169f4f8c40"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/comments", "author": null, "committer": null, "parents": [{"sha": "d56a25e1303343451091b473db4877e312b96c4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d56a25e1303343451091b473db4877e312b96c4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d56a25e1303343451091b473db4877e312b96c4b"}], "stats": {"total": 52, "additions": 41, "deletions": 11}, "files": [{"sha": "2d405bc333110b746308060272b0d524b83eefa9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "patch": "@@ -1,12 +1,20 @@\n+2007-12-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/33453\n+\t* tree-data-ref.c (split_constant_offset): Use POINTER_PLUS_EXPR\n+\tfor pointer addition.\n+\t* tree-parloops.c (canonicalize_loop_ivs): Likewise.\n+\t(separate_decls_in_loop_name): Copy DECL_GIMPLE_REG_P from var to\n+\tvar_copy.\n+\n 2007-12-03  Bernd Schmidt  <bernd.schmidt@analog.com>\n \n \t* config/bfin/bfin.h (TARGET_CPU_CPP_BUILTINS): Define __FDPIC__ as\n \tnecessary.\n \n 2007-12-03  Razya Ladelsky <razya@il.ibm.com>\n \n-    * doc/invoke.texi (fipa-cp, fipa-matrix-reorg): Add documentation.\n-\n+\t* doc/invoke.texi (fipa-cp, fipa-matrix-reorg): Add documentation.\n \n 2007-12-03  Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "dc8bb82bf1f6e87ba0b407e8834b31013060f114", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "patch": "@@ -1,3 +1,8 @@\n+2007-12-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/33453\n+\t* gcc.c-torture/compile/20071203-1.c: New test.\n+\n 2007-12-03  Robert Dewar <dewar@adacore.com>\n             Samuel Tardieu  <sam@rfc1149.net>\n "}, {"sha": "154b28bc9b2bbf21543cd7aa1d4744cf685978af", "filename": "gcc/testsuite/gcc.c-torture/compile/20071203-1.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20071203-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20071203-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20071203-1.c?ref=36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "patch": "@@ -0,0 +1,12 @@\n+/* Testcase by Martin Michlmayr <tbm@cyrius.com> */\n+\n+struct User { char username[10]; };\n+\n+void\n+auth_set_username (struct User *user)\n+{\n+  char *d;\n+  char ch;\n+  d = user->username + (user->username[0] == '~');\n+  while ((ch = *d++) != '\\0') /* do nothing */ ;\n+}"}, {"sha": "89a0039355f0f55f2cc536f0c5f75a631bd30f41", "filename": "gcc/tree-data-ref.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftree-data-ref.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftree-data-ref.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-data-ref.c?ref=36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "patch": "@@ -555,9 +555,12 @@ split_constant_offset (tree exp, tree *var, tree *off)\n \t  {\n \t    split_constant_offset (poffset, &poffset, &off1);\n \t    off0 = size_binop (PLUS_EXPR, off0, off1);\n-\t    base = fold_build2 (PLUS_EXPR, TREE_TYPE (base),\n-\t\t\t\tbase,\n-\t\t\t\tfold_convert (TREE_TYPE (base), poffset));\n+\t    if (POINTER_TYPE_P (TREE_TYPE (base)))\n+\t      base = fold_build2 (POINTER_PLUS_EXPR, TREE_TYPE (base),\n+\t\t\t\t  base, fold_convert (sizetype, poffset));\n+\t    else\n+\t      base = fold_build2 (PLUS_EXPR, TREE_TYPE (base), base,\n+\t\t\t\t  fold_convert (TREE_TYPE (base), poffset));\n \t  }\n \n \tvar0 = fold_convert (type, base);"}, {"sha": "b4f85193ebfa8a3a8fc295cef7de69d6a180731f", "filename": "gcc/tree-parloops.c", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftree-parloops.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36ad7922cbf93f3601ab81b6b4d332fddf575a9f/gcc%2Ftree-parloops.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-parloops.c?ref=36ad7922cbf93f3601ab81b6b4d332fddf575a9f", "patch": "@@ -687,6 +687,7 @@ separate_decls_in_loop_name (tree name,\n   if (!*dslot)\n     {\n       var_copy = create_tmp_var (TREE_TYPE (var), get_name (var));\n+      DECL_GIMPLE_REG_P (var_copy) = DECL_GIMPLE_REG_P (var);\n       add_referenced_var (var_copy);\n       nielt = XNEW (struct int_tree_map);\n       nielt->uid = uid;\n@@ -1266,7 +1267,7 @@ static void\n canonicalize_loop_ivs (struct loop *loop, htab_t reduction_list, tree nit)\n {\n   unsigned precision = TYPE_PRECISION (TREE_TYPE (nit));\n-  tree phi, prev, res, type, var_before, val, atype, t, next;\n+  tree phi, prev, res, type, var_before, val, atype, mtype, t, next;\n   block_stmt_iterator bsi;\n   bool ok;\n   affine_iv iv;\n@@ -1313,11 +1314,12 @@ canonicalize_loop_ivs (struct loop *loop, htab_t reduction_list, tree nit)\n       remove_phi_node (phi, prev, false);\n \n       atype = TREE_TYPE (res);\n-      val = fold_build2 (PLUS_EXPR, atype,\n-\t\t\t unshare_expr (iv.base),\n-\t\t\t fold_build2 (MULT_EXPR, atype,\n-\t\t\t\t      unshare_expr (iv.step),\n-\t\t\t\t      fold_convert (atype, var_before)));\n+      mtype = POINTER_TYPE_P (atype) ? sizetype : atype;\n+      val = fold_build2 (MULT_EXPR, mtype, unshare_expr (iv.step),\n+\t\t\t fold_convert (mtype, var_before));\n+      val = fold_build2 (POINTER_TYPE_P (atype)\n+\t\t\t ? POINTER_PLUS_EXPR : PLUS_EXPR,\n+\t\t\t atype, unshare_expr (iv.base), val);\n       val = force_gimple_operand_bsi (&bsi, val, false, NULL_TREE, true,\n \t\t\t\t      BSI_SAME_STMT);\n       t = build_gimple_modify_stmt (res, val);"}]}