{"sha": "9096b279c220a45ee1a369a46661b366db767502", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTA5NmIyNzljMjIwYTQ1ZWUxYTM2OWE0NjY2MWIzNjZkYjc2NzUwMg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@cygnus.com", "date": "1999-05-05T14:19:24Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-05-05T14:19:24Z"}, "message": "Makefile.in: Rebuilt.\n\n\t* Makefile.in: Rebuilt.\n\t* Makefile.am (CLEANFILES): Don't mention $(class_files).\n\t(clean-local): New target\n\t* java/lang/natRuntime.cc: Include <ltdl.h> if required.\n\t(load, loadLibrary): Now native.\n\t(init): New method.\n\t* java/lang/Runtime.java (load, loadLibrary): Now native.\n\t(init): New native method.\n\t(Runtime): Use init.\n\t* prims.cc: Include <ltdl.h> if required.\n\t(JvRunMain): Call LTDL_SET_PRELOADED_SYMBOLS.\n\nFrom-SVN: r26785", "tree": {"sha": "14b0eb7b6f562102ad5e5179e72ba9ffe7a1066c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14b0eb7b6f562102ad5e5179e72ba9ffe7a1066c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9096b279c220a45ee1a369a46661b366db767502", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9096b279c220a45ee1a369a46661b366db767502", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9096b279c220a45ee1a369a46661b366db767502", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9096b279c220a45ee1a369a46661b366db767502/comments", "author": null, "committer": null, "parents": [{"sha": "8b04083becc6a7703c24f9802cd943da33de2a4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b04083becc6a7703c24f9802cd943da33de2a4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b04083becc6a7703c24f9802cd943da33de2a4a"}], "stats": {"total": 110, "additions": 94, "deletions": 16}, "files": [{"sha": "44320c84d4f1851bd83e85db2ad988b99acdc488", "filename": "libjava/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9096b279c220a45ee1a369a46661b366db767502/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9096b279c220a45ee1a369a46661b366db767502/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=9096b279c220a45ee1a369a46661b366db767502", "patch": "@@ -1,3 +1,18 @@\n+1999-05-05  Tom Tromey  <tromey@cygnus.com>\n+\n+\t* Makefile.in: Rebuilt.\n+\t* Makefile.am (CLEANFILES): Don't mention $(class_files).\n+\t(clean-local): New target\n+\n+\t* java/lang/natRuntime.cc: Include <ltdl.h> if required.\n+\t(load, loadLibrary): Now native.\n+\t(init): New method.\n+\t* java/lang/Runtime.java (load, loadLibrary): Now native.\n+\t(init): New native method.\n+\t(Runtime): Use init.\n+\t* prims.cc: Include <ltdl.h> if required.\n+\t(JvRunMain): Call LTDL_SET_PRELOADED_SYMBOLS.\n+\n 1999-05-05  Gilles Zunino  <Gilles.Zunino@hei.fr>\n \n \t* configure.in: Switch from irix threads to posix threads"}, {"sha": "da9cce25cd51db72daa2383a50075032d75d6d29", "filename": "libjava/Makefile.am", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9096b279c220a45ee1a369a46661b366db767502/libjava%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9096b279c220a45ee1a369a46661b366db767502/libjava%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.am?ref=9096b279c220a45ee1a369a46661b366db767502", "patch": "@@ -120,7 +120,11 @@ libgcj.zip: $(java_source_files)\n \t$(ZIP) -r libgcj java gnu -n .class -i '*.class' -i '*/'\n \n MOSTLYCLEANFILES = $(javao_files) $(nat_files) $(nat_headers) $(c_files)\n-CLEANFILES = libgcj.zip $(class_files)\n+CLEANFILES = libgcj.zip\n+\n+clean-local:\n+## We just remove every .class file that was created.\n+\tfind . -name '*.class' -print | xargs rm -f\n \n SUFFIXES = .class .java .h\n "}, {"sha": "5c9bf0a0ac9f494a1775002410f3f93d0f8980d8", "filename": "libjava/Makefile.in", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9096b279c220a45ee1a369a46661b366db767502/libjava%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9096b279c220a45ee1a369a46661b366db767502/libjava%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.in?ref=9096b279c220a45ee1a369a46661b366db767502", "patch": "@@ -163,7 +163,7 @@ libgcj_la_LIBADD = $(javao_files) $(nat_files) $(c_files) $(GCOBJS) \\\n libgcj_la_LDFLAGS = -rpath $(toolexeclibdir) -release $(VERSION)\n \n MOSTLYCLEANFILES = $(javao_files) $(nat_files) $(nat_headers) $(c_files)\n-CLEANFILES = libgcj.zip $(class_files)\n+CLEANFILES = libgcj.zip\n \n SUFFIXES = .class .java .h\n \n@@ -1196,7 +1196,8 @@ mostlyclean: mostlyclean-recursive\n \n clean-am:  clean-hdr clean-toolexeclibLTLIBRARIES clean-compile \\\n \t\tclean-libtool clean-binPROGRAMS clean-noinstPROGRAMS \\\n-\t\tclean-tags clean-depend clean-generic mostlyclean-am\n+\t\tclean-tags clean-depend clean-generic mostlyclean-am \\\n+\t\tclean-local\n \n clean: clean-recursive\n \n@@ -1258,6 +1259,9 @@ libgcj.zip: $(java_source_files)\n \t-@rm -f libgcj.zip\n \t$(ZIP) -r libgcj java gnu -n .class -i '*.class' -i '*/'\n \n+clean-local:\n+\tfind . -name '*.class' -print | xargs rm -f\n+\n .class.lo:\n \t$(GCJCOMPILE) -o $@ $<\n "}, {"sha": "94e7770e7e8e66ec0f41ba7bc57bda8c2c4594de", "filename": "libjava/java/lang/Runtime.java", "status": "modified", "additions": 6, "deletions": 13, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9096b279c220a45ee1a369a46661b366db767502/libjava%2Fjava%2Flang%2FRuntime.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9096b279c220a45ee1a369a46661b366db767502/libjava%2Fjava%2Flang%2FRuntime.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FRuntime.java?ref=9096b279c220a45ee1a369a46661b366db767502", "patch": "@@ -94,18 +94,8 @@ private final void checkLink (String lib)\n       s.checkLink(lib);\n   }\n \n-  public synchronized void load (String pathname)\n-  {\n-    checkLink (pathname);\n-    // FIXME.\n-    throw new UnsatisfiedLinkError (\"Runtime.load not implemented\");\n-  }\n-  public synchronized void loadLibrary (String libname)\n-  {\n-    checkLink (libname);\n-    // FIXME.\n-    throw new UnsatisfiedLinkError (\"Runtime.loadLibrary not implemented\");\n-  }\n+  public native void load (String pathname);\n+  public native void loadLibrary (String libname);\n \n   public native void runFinalization ();\n \n@@ -122,10 +112,13 @@ public static void runFinalizersOnExit (boolean run)\n   public native void traceInstructions (boolean on);\n   public native void traceMethodCalls (boolean on);\n \n+  // A helper for the constructor.\n+  private final native void init ();\n+\n   // The sole constructor.\n   private Runtime ()\n   {\n-    finalize_on_exit = false;\n+    init ();\n   }\n \n   // Private data."}, {"sha": "f8b050c4d58e592a0209e659a2b6c06af35801b2", "filename": "libjava/java/lang/natRuntime.cc", "status": "modified", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9096b279c220a45ee1a369a46661b366db767502/libjava%2Fjava%2Flang%2FnatRuntime.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9096b279c220a45ee1a369a46661b366db767502/libjava%2Fjava%2Flang%2FnatRuntime.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatRuntime.cc?ref=9096b279c220a45ee1a369a46661b366db767502", "patch": "@@ -15,6 +15,12 @@ details.  */\n #include <cni.h>\n #include <jvm.h>\n #include <java/lang/Runtime.h>\n+#include <java/lang/UnknownError.h>\n+#include <java/lang/UnsatisfiedLinkError.h>\n+\n+#ifdef USE_LTDL\n+#include <ltdl.h>\n+#endif\n \n void\n java::lang::Runtime::exit (jint status)\n@@ -43,6 +49,55 @@ java::lang::Runtime::gc (void)\n   _Jv_RunGC ();\n }\n \n+void\n+java::lang::Runtime::load (jstring path)\n+{\n+  JvSynchronize sync (this);\n+  checkLink (path);\n+  using namespace java::lang;\n+#ifdef USE_LTDL\n+  // FIXME: make sure path is absolute.\n+  lt_dlhandle h = lt_dlopen (FIXME);\n+  if (h == NULL)\n+    {\n+      const char *msg = lt_dlerror ();\n+      _Jv_Throw (new UnsatisfiedLinkError (JvNewStringLatin1 (msg)));\n+    }\n+#else\n+  _Jv_Throw (new UnknownError\n+\t     (JvNewStringLatin1 (\"Runtime.load not implemented\")));\n+#endif /* USE_LTDL */\n+}\n+\n+void\n+java::lang::Runtime::loadLibrary (jstring lib)\n+{\n+  JvSynchronize sync (this);\n+  checkLink (lib);\n+  using namespace java::lang;\n+#ifdef USE_LTDL\n+  // FIXME: make sure path is absolute.\n+  lt_dlhandle h = lt_dlopenext (FIXME);\n+  if (h == NULL)\n+    {\n+      const char *msg = lt_dlerror ();\n+      _Jv_Throw (new UnsatisfiedLinkError (JvNewStringLatin1 (msg)));\n+    }\n+#else\n+  _Jv_Throw (new UnknownError\n+\t     (JvNewStringLatin1 (\"Runtime.loadLibrary not implemented\")));\n+#endif /* USE_LTDL */\n+}\n+\n+void\n+java::lang::Runtime::init (void)\n+{\n+  finalize_on_exit = false;\n+#ifdef USE_LTDL\n+  lt_dlinit ();\n+#endif\n+}\n+\n void\n java::lang::Runtime::runFinalization (void)\n {"}, {"sha": "4cc31cdd0caab7f1f3bdc328c4f55a47703750ec", "filename": "libjava/prims.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9096b279c220a45ee1a369a46661b366db767502/libjava%2Fprims.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9096b279c220a45ee1a369a46661b366db767502/libjava%2Fprims.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fprims.cc?ref=9096b279c220a45ee1a369a46661b366db767502", "patch": "@@ -39,6 +39,9 @@ details.  */\n #include <java/lang/reflect/Modifier.h>\n #include <java/io/PrintStream.h>\n \n+#ifdef USE_LTDL\n+#include <ltdl.h>\n+#endif\n \n #define ObjectClass _CL_Q34java4lang6Object\n extern java::lang::Class ObjectClass;\n@@ -571,6 +574,10 @@ JvRunMain (jclass klass, int argc, const char **argv)\n \n   no_memory = new java::lang::OutOfMemoryError;\n \n+#ifdef USE_LTDL\n+  LTDL_SET_PRELOADED_SYMBOLS ();\n+#endif\n+\n   arg_vec = JvConvertArgv (argc - 1, argv + 1);\n   main_group = new java::lang::ThreadGroup (23);\n   main_thread = new java::lang::FirstThread (main_group, klass, arg_vec);"}]}