{"sha": "c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzFjNWUwZmFhODRiZDAxYzg2NmY3ZjI5MzBjYzYyOGE3NzBiM2MyYQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-16T13:09:14Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-16T13:09:14Z"}, "message": "[multiple changes]\n\n2009-04-16  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch12.adb (Preanalyze_Actuals): If the instance is a child unit\n\tthat hides an outer homograph, make that homograph invisible when\n\tanalyzing the actuals, to to prevent illegal direct visibility on it.\n\n2009-04-16  Eric Botcazou  <ebotcazou@adacore.com>\n\n\t* g-pehage.adb (Initialize): Fix off-by-one error.\n\nFrom-SVN: r146186", "tree": {"sha": "f3a07e9782740e8755f1c247c90dbdfc719b140a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f3a07e9782740e8755f1c247c90dbdfc719b140a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/comments", "author": null, "committer": null, "parents": [{"sha": "b72d8ad5dd2004077a3abe777461afeb8851ee42", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b72d8ad5dd2004077a3abe777461afeb8851ee42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b72d8ad5dd2004077a3abe777461afeb8851ee42"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "fa835267d9dabfb15caf81a50f6997931f36b817", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "patch": "@@ -1,3 +1,13 @@\n+2009-04-16  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch12.adb (Preanalyze_Actuals): If the instance is a child unit\n+\tthat hides an outer homograph, make that homograph invisible when\n+\tanalyzing the actuals, to to prevent illegal direct visibility on it.\n+\n+2009-04-16  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* g-pehage.adb (Initialize): Fix off-by-one error.\n+\n 2009-04-16  Tristan Gingold  <gingold@adacore.com>\n \n \t* init.c: Detect real stack overflow on Darwin."}, {"sha": "93f05b824606168489a0739e2827b3cbd5517693", "filename": "gcc/ada/g-pehage.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/gcc%2Fada%2Fg-pehage.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/gcc%2Fada%2Fg-pehage.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-pehage.adb?ref=c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "patch": "@@ -1146,7 +1146,7 @@ package body GNAT.Perfect_Hash_Generators is\n       --  words already there because a previous computation failed. We are\n       --  currently retrying and the reduced words have to be deallocated.\n \n-      for W in NK .. WT.Last loop\n+      for W in Reduced (0) .. WT.Last loop\n          Free_Word (WT.Table (W));\n       end loop;\n       IT.Init;"}, {"sha": "21da8901fcd045f5eb23a7be33dbdc703bfa33ce", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 38, "deletions": 2, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c1c5e0faa84bd01c866f7f2930cc628a770b3c2a/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=c1c5e0faa84bd01c866f7f2930cc628a770b3c2a", "patch": "@@ -10888,8 +10888,31 @@ package body Sem_Ch12 is\n       Act   : Node_Id;\n       Errs  : constant Int := Serious_Errors_Detected;\n \n+      Cur   : Entity_Id := Empty;\n+      --  Current homograph of the instance name\n+\n+      Vis   : Boolean;\n+      --  Saved visibility status of the current homograph\n+\n    begin\n       Assoc := First (Generic_Associations (N));\n+\n+      --  If the instance is a child unit, its name may hide an outer homonym,\n+      --  so make it invisible to perform name resolution on the actuals.\n+\n+      if Nkind (Defining_Unit_Name (N)) = N_Defining_Program_Unit_Name\n+        and then Present\n+          (Current_Entity (Defining_Identifier (Defining_Unit_Name (N))))\n+      then\n+         Cur := Current_Entity (Defining_Identifier (Defining_Unit_Name (N)));\n+         if Is_Compilation_Unit (Cur) then\n+            Vis := Is_Immediately_Visible (Cur);\n+            Set_Is_Immediately_Visible (Cur, False);\n+         else\n+            Cur := Empty;\n+         end if;\n+      end if;\n+\n       while Present (Assoc) loop\n          if Nkind (Assoc) /= N_Others_Choice then\n             Act := Explicit_Generic_Actual_Parameter (Assoc);\n@@ -10924,8 +10947,8 @@ package body Sem_Ch12 is\n                   if Nkind (Expr) = N_Subtype_Indication then\n                      Analyze (Subtype_Mark (Expr));\n \n-                     --  Analyze separately each discriminant constraint,\n-                     --  when given with a named association.\n+                     --  Analyze separately each discriminant constraint, when\n+                     --  given with a named association.\n \n                      declare\n                         Constr : Node_Id;\n@@ -10967,12 +10990,25 @@ package body Sem_Ch12 is\n                   Set_Is_Instantiated (Entity (Name (N)));\n                end if;\n \n+               if Present (Cur) then\n+                  --  For the case of a child instance hiding an outer homonym,\n+                  --  provide additional warning which might explain the error.\n+\n+                  Set_Is_Immediately_Visible (Cur, Vis);\n+                  Error_Msg_NE (\"& hides outer unit with the same name?\",\n+                    N, Defining_Unit_Name (N));\n+               end if;\n+\n                Abandon_Instantiation (Act);\n             end if;\n          end if;\n \n          Next (Assoc);\n       end loop;\n+\n+      if Present (Cur) then\n+         Set_Is_Immediately_Visible (Cur, Vis);\n+      end if;\n    end Preanalyze_Actuals;\n \n    -------------------"}]}