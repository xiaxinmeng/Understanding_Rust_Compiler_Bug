{"sha": "f6702584aa372de7790b3f2be9e4b5a5423eb9fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjY3MDI1ODRhYTM3MmRlNzc5MGIzZjJiZTllNGI1YTU0MjNlYjlmYQ==", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2020-11-26T09:20:40Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2020-11-26T11:05:43Z"}, "message": "rs6000: Set param_vect_partial_vector_usage as 1 for P10\n\nDue to the unexpected performance on Power9 of those vector\nwith length instructions, we didn't enable vectorization with\npartial vectors before.\n\nSome recent testings show that they perform expectedly on\nPower10 now.  This patch is to set\nparam_vect_partial_vector_usage as 1 for P10 or later.\n\nThe performance evaluation on the whole SPEC2017 with option\nset power10/Ofast/unroll shows it can speed up 525.x264_r by\n10.80% and 554.roms_r by 1.94%.\n\nBootstrapped/regtested on powerpc64le-linux-gnu P10.\n\ngcc/ChangeLog:\n\n\t* config/rs6000/rs6000.c (rs6000_option_override_internal):\n\tSet param_vect_partial_vector_usage as 1 for Power10 and up\n\tby default.", "tree": {"sha": "63b600c7a23b318fa0d585340e6e64e24b5690f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/63b600c7a23b318fa0d585340e6e64e24b5690f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f6702584aa372de7790b3f2be9e4b5a5423eb9fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6702584aa372de7790b3f2be9e4b5a5423eb9fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6702584aa372de7790b3f2be9e4b5a5423eb9fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6702584aa372de7790b3f2be9e4b5a5423eb9fa/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a386566118054e08bb733f1248649fb6847c407e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a386566118054e08bb733f1248649fb6847c407e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a386566118054e08bb733f1248649fb6847c407e"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "50261b3ad7f70afbce21aab357832f81178c18f9", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 7, "deletions": 4, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6702584aa372de7790b3f2be9e4b5a5423eb9fa/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6702584aa372de7790b3f2be9e4b5a5423eb9fa/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=f6702584aa372de7790b3f2be9e4b5a5423eb9fa", "patch": "@@ -4781,10 +4781,13 @@ rs6000_option_override_internal (bool global_init_p)\n       SET_OPTION_IF_UNSET (&global_options, &global_options_set,\n \t\t\t   param_max_completely_peeled_insns, 400);\n \n-      /* Temporarily disable it for now since lxvl/stxvl on the default\n-\t supported hardware Power9 has unexpected performance behaviors.  */\n-      SET_OPTION_IF_UNSET (&global_options, &global_options_set,\n-\t\t\t   param_vect_partial_vector_usage, 0);\n+      /* The lxvl/stxvl instructions don't perform well before Power10.  */\n+      if (TARGET_POWER10)\n+\tSET_OPTION_IF_UNSET (&global_options, &global_options_set,\n+\t\t\t     param_vect_partial_vector_usage, 1);\n+      else\n+\tSET_OPTION_IF_UNSET (&global_options, &global_options_set,\n+\t\t\t     param_vect_partial_vector_usage, 0);\n \n       /* Use the 'model' -fsched-pressure algorithm by default.  */\n       SET_OPTION_IF_UNSET (&global_options, &global_options_set,"}]}