{"sha": "f303a996311673f8c9178f6593bf4c804077a8ec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjMwM2E5OTYzMTE2NzNmOGM5MTc4ZjY1OTNiZjRjODA0MDc3YThlYw==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2005-08-08T14:22:35Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2005-08-08T14:22:35Z"}, "message": "re PR c++/21166 (g++ gives error on reference to packed structure elements)\n\n.:\tPR c++/21166\n\t* stor-layout.c (finalize_type_size): Undo DECL_PACKED when possible.\ntestsuite:\n\tPR c++/21166\n\t* g++.dg/other/crash-4.C: Adjust\n\t* g++/dg/ext/packed9.C: New.\n\nFrom-SVN: r102858", "tree": {"sha": "2061e9e62bc833d5825ee342b6f3929525652c9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2061e9e62bc833d5825ee342b6f3929525652c9e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f303a996311673f8c9178f6593bf4c804077a8ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f303a996311673f8c9178f6593bf4c804077a8ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f303a996311673f8c9178f6593bf4c804077a8ec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f303a996311673f8c9178f6593bf4c804077a8ec/comments", "author": null, "committer": null, "parents": [{"sha": "4de997d1376a22a139c43ab64ab0c1482b5b4487", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4de997d1376a22a139c43ab64ab0c1482b5b4487", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4de997d1376a22a139c43ab64ab0c1482b5b4487"}], "stats": {"total": 44, "additions": 44, "deletions": 0}, "files": [{"sha": "0996eced0df8f1dc61e0eb368a1d32ee6cec21c9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f303a996311673f8c9178f6593bf4c804077a8ec", "patch": "@@ -1,3 +1,8 @@\n+2005-08-08  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/21166\n+\t* stor-layout.c (finalize_type_size): Undo DECL_PACKED when possible.\n+\n 2005-08-07  James A. Morrison  <phython@gcc.gnu.org>\n \n \t* tree-vrp.c (simplify_div_or_mod_using_range): Use build2."}, {"sha": "321a4d24ca440c5def80d0ab20eec3bc6a1fb542", "filename": "gcc/stor-layout.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Fstor-layout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Fstor-layout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstor-layout.c?ref=f303a996311673f8c9178f6593bf4c804077a8ec", "patch": "@@ -1477,6 +1477,8 @@ finalize_type_size (tree type)\n void\n finish_record_layout (record_layout_info rli, int free_p)\n {\n+  tree field;\n+  \n   /* Compute the final size.  */\n   finalize_record_size (rli);\n \n@@ -1486,6 +1488,15 @@ finish_record_layout (record_layout_info rli, int free_p)\n   /* Perform any last tweaks to the TYPE_SIZE, etc.  */\n   finalize_type_size (rli->t);\n \n+  /* We might be able to clear DECL_PACKED on any members that happen\n+     to be suitably aligned (not forgetting the alignment of the type\n+     itself).  */\n+  for (field = TYPE_FIELDS (rli->t); field; field = TREE_CHAIN (field))\n+    if (TREE_CODE (field) == FIELD_DECL && DECL_PACKED (field)\n+\t&& DECL_OFFSET_ALIGN (field) >= TYPE_ALIGN (TREE_TYPE (field))\n+\t&& TYPE_ALIGN (rli->t) >= TYPE_ALIGN (TREE_TYPE (field)))\n+      DECL_PACKED (field) = 0;\n+  \n   /* Lay out any static members.  This is done now because their type\n      may use the record's type.  */\n   while (rli->pending_statics)"}, {"sha": "77cf6334b684150c1dcaad2f203c99b05a0d7aa5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f303a996311673f8c9178f6593bf4c804077a8ec", "patch": "@@ -1,3 +1,9 @@\n+2005-08-08  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/21166\n+\t* g++.dg/other/crash-4.C: Adjust\n+\t* g++/dg/ext/packed9.C: New.\n+\n 2005-08-08  Richard Sandiford  <richard@codesourcery.com>\n \n \tPR middle-end/21964"}, {"sha": "ba5d4ab044f7f79077e5812d97f1f27f8c4795e8", "filename": "gcc/testsuite/g++.dg/ext/packed9.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpacked9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpacked9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpacked9.C?ref=f303a996311673f8c9178f6593bf4c804077a8ec", "patch": "@@ -0,0 +1,20 @@\n+// Copyright (C) 2005 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 26 Apr 2005 <nathan@codesourcery.com>\n+\n+// DR21166. unnecessary error on packed char\n+\n+struct s1 {\n+        char    c1;\n+} __attribute__((packed));\n+\n+char&\n+f(struct s1 *s)\n+{\n+        return s->c1;\n+}\n+\n+char *\n+g(struct s1 *s)\n+{\n+        return &s->c1;\n+}"}, {"sha": "986c498e654ff79230c74efcd1b1a8bde7d7fd98", "filename": "gcc/testsuite/g++.dg/other/crash-4.C", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fcrash-4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f303a996311673f8c9178f6593bf4c804077a8ec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fcrash-4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fcrash-4.C?ref=f303a996311673f8c9178f6593bf4c804077a8ec", "patch": "@@ -6,10 +6,12 @@\n \n struct a\n {\n+  int m;\n   a(const a&);\n };\n struct b\n { // { dg-error \"cannot bind packed field\" }\n+  char c;\n   a aa __attribute__((packed));\n };\n struct c"}]}