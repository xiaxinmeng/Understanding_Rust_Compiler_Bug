{"sha": "da98b11a83c2d996b984bdb19d50d24b853ae120", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGE5OGIxMWE4M2MyZDk5NmI5ODRiZGIxOWQ1MGQyNGI4NTNhZTEyMA==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2002-11-19T21:59:41Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2002-11-19T21:59:41Z"}, "message": "natReference.cc (add_to_hash): Look at `copy', not `referent'.\n\n\t* java/lang/ref/natReference.cc (add_to_hash): Look at `copy', not\n\t`referent'.\n\t(finalize_referred_to_object): Don't modify `referent' or `copy'\n\tfields.\n\t(add_to_hash): Correctly set `n->next' when updating list.\n\t* java/lang/ref/Reference.java (enqueue): Return false if already\n\tenqueued.\n\nFrom-SVN: r59278", "tree": {"sha": "2aca38439a45060ae45c6484bdf8f4b238cde70d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2aca38439a45060ae45c6484bdf8f4b238cde70d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da98b11a83c2d996b984bdb19d50d24b853ae120", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da98b11a83c2d996b984bdb19d50d24b853ae120", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da98b11a83c2d996b984bdb19d50d24b853ae120", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da98b11a83c2d996b984bdb19d50d24b853ae120/comments", "author": null, "committer": null, "parents": [{"sha": "93745862c47eb16f9935989a4299a080335d8309", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93745862c47eb16f9935989a4299a080335d8309", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93745862c47eb16f9935989a4299a080335d8309"}], "stats": {"total": 29, "additions": 17, "deletions": 12}, "files": [{"sha": "addc3bdeb68b29c5fdd30752d2f632e27eb27145", "filename": "libjava/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da98b11a83c2d996b984bdb19d50d24b853ae120/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da98b11a83c2d996b984bdb19d50d24b853ae120/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=da98b11a83c2d996b984bdb19d50d24b853ae120", "patch": "@@ -1,3 +1,13 @@\n+2002-11-19  Tom Tromey  <tromey@redhat.com>\n+\n+\t* java/lang/ref/natReference.cc (add_to_hash): Look at `copy', not\n+\t`referent'.\n+\t(finalize_referred_to_object): Don't modify `referent' or `copy'\n+\tfields.\n+\t(add_to_hash): Correctly set `n->next' when updating list.\n+\t* java/lang/ref/Reference.java (enqueue): Return false if already\n+\tenqueued.\n+\n 2002-11-19  Ranjit Mathew <rmathew@hotmail.com>\n \n \t* include/jni.h: Add missing JNICALL and JNIEXPORT attributes"}, {"sha": "b02a4ed577550deb87577caa3bbb93d28f2f2c76", "filename": "libjava/java/lang/ref/Reference.java", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da98b11a83c2d996b984bdb19d50d24b853ae120/libjava%2Fjava%2Flang%2Fref%2FReference.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da98b11a83c2d996b984bdb19d50d24b853ae120/libjava%2Fjava%2Flang%2Fref%2FReference.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2Fref%2FReference.java?ref=da98b11a83c2d996b984bdb19d50d24b853ae120", "patch": "@@ -1,5 +1,5 @@\n /* java.lang.ref.Reference\n-   Copyright (C) 1999 Free Software Foundation, Inc.\n+   Copyright (C) 1999, 2002 Free Software Foundation, Inc.\n \n This file is part of GNU Classpath.\n \n@@ -185,7 +185,7 @@ public boolean isEnqueued()\n    */\n   public boolean enqueue() \n   {\n-    if (queue != null)\n+    if (queue != null && nextOnQueue == null)\n       {\n \tqueue.enqueue(this);\n \tqueue = null;"}, {"sha": "64262f900cbe59160322833b93b222ed47b90712", "filename": "libjava/java/lang/ref/natReference.cc", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da98b11a83c2d996b984bdb19d50d24b853ae120/libjava%2Fjava%2Flang%2Fref%2FnatReference.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da98b11a83c2d996b984bdb19d50d24b853ae120/libjava%2Fjava%2Flang%2Fref%2FnatReference.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2Fref%2FnatReference.cc?ref=da98b11a83c2d996b984bdb19d50d24b853ae120", "patch": "@@ -1,6 +1,6 @@\n // natReference.cc - Native code for References\n \n-/* Copyright (C) 2001  Free Software Foundation\n+/* Copyright (C) 2001, 2002  Free Software Foundation\n \n    This file is part of libgcj.\n \n@@ -165,7 +165,8 @@ add_to_hash (java::lang::ref::Reference *the_reference)\n   if (3 * hash_count >= 2 * hash_size)\n     rehash ();\n \n-  jobject referent = the_reference->referent;\n+  // Use `copy' here because the `referent' field has been cleared.\n+  jobject referent = the_reference->copy;\n   object_list *item = find_slot (referent);\n   if (item->reference == NULL)\n     {\n@@ -197,7 +198,7 @@ add_to_hash (java::lang::ref::Reference *the_reference)\n       link = &iter->next;\n       iter = *link;\n     }\n-  n->next = (*link) ? (*link)->next : NULL;\n+  n->next = *link;\n   *link = n;\n }\n \n@@ -249,13 +250,7 @@ finalize_referred_to_object (jobject obj)\n \t  // If the copy is already NULL then the user must have\n \t  // called Reference.clear().\n \t  if (ref->copy != NULL)\n-\t    {\n-\t      if (w == PHANTOM)\n-\t\tref->referent = ref->copy;\n-\t      else\n-\t\tref->copy = NULL;\n-\t      ref->enqueue ();\n-\t    }\n+\t    ref->enqueue ();\n \n \t  object_list *next = head->next;\n \t  _Jv_Free (head);"}]}