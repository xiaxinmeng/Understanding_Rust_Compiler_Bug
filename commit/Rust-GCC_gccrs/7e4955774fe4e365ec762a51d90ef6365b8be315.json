{"sha": "7e4955774fe4e365ec762a51d90ef6365b8be315", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2U0OTU1Nzc0ZmU0ZTM2NWVjNzYyYTUxZDkwZWY2MzY1YjhiZTMxNQ==", "commit": {"author": {"name": "Alexander Ivchenko", "email": "alexander.ivchenko@intel.com", "date": "2016-09-09T21:38:06Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2016-09-09T21:38:06Z"}, "message": "re PR target/77267 (MPX does not work in a presence of \"-Wl,-as-needed\" option (Ubuntu default))\n\nFix PR target/77267\n\n2016-09-10  Alexander Ivchenko  <alexander.ivchenko@intel.com>\n\n\tPR target/77267\n\t* config.in: Regenerate.\n\t* config/i386/linux-common.h (MPX_LD_AS_NEEDED_GUARD_PUSH):\n\tNew macro.\n\t(MPX_LD_AS_NEEDED_GUARD_PUSH): Ditto.\n\t(LIBMPXWRAPPERS_SPEC): Remove \"--no-whole-archive\" from\n\tstatic-libmpxwrappers case.\n\t(LIBMPX_SPEC): Add guards with MPX_LD_AS_NEEDED_GUARD_PUSH and\n\tMPX_LD_AS_NEEDED_GUARD_POP.\n\t* configure: Regenerate.\n\t* configure.ac (HAVE_LD_PUSHPOPSTATE_SUPPORT): New variable.\n\tdefined if linker support \"--push-state\"/\"--pop-state\".\n\nFrom-SVN: r240057", "tree": {"sha": "7fffb6b63dfdd2d0db6edabc6cacba2f58086af7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7fffb6b63dfdd2d0db6edabc6cacba2f58086af7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7e4955774fe4e365ec762a51d90ef6365b8be315", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e4955774fe4e365ec762a51d90ef6365b8be315", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e4955774fe4e365ec762a51d90ef6365b8be315", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e4955774fe4e365ec762a51d90ef6365b8be315/comments", "author": null, "committer": null, "parents": [{"sha": "af63ba4b309ea3ff8946be59e8dba7333594f4ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af63ba4b309ea3ff8946be59e8dba7333594f4ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af63ba4b309ea3ff8946be59e8dba7333594f4ff"}], "stats": {"total": 82, "additions": 79, "deletions": 3}, "files": [{"sha": "29d329ef080f6c2fdc4e7b195dd019d05f0d4a6f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7e4955774fe4e365ec762a51d90ef6365b8be315", "patch": "@@ -1,3 +1,18 @@\n+2016-09-10  Alexander Ivchenko  <alexander.ivchenko@intel.com>\n+\n+\tPR target/77267\n+\t* config.in: Regenerate.\n+\t* config/i386/linux-common.h (MPX_LD_AS_NEEDED_GUARD_PUSH):\n+\tNew macro.\n+\t(MPX_LD_AS_NEEDED_GUARD_PUSH): Ditto.\n+\t(LIBMPXWRAPPERS_SPEC): Remove \"--no-whole-archive\" from\n+\tstatic-libmpxwrappers case.\n+\t(LIBMPX_SPEC): Add guards with MPX_LD_AS_NEEDED_GUARD_PUSH and\n+\tMPX_LD_AS_NEEDED_GUARD_POP.\n+\t* configure: Regenerate.\n+\t* configure.ac (HAVE_LD_PUSHPOPSTATE_SUPPORT): New variable.\n+\tdefined if linker support \"--push-state\"/\"--pop-state\".\n+\n 2016-09-09  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* doc/cpp.texi (__*_WIDTH__): Small wording fixes."}, {"sha": "a736de3a82be644558beebedbe120b4b5212fb25", "filename": "gcc/config.in", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=7e4955774fe4e365ec762a51d90ef6365b8be315", "patch": "@@ -1538,6 +1538,12 @@\n #endif\n \n \n+/* Define if your linker supports --push-state/--pop-state */\n+#ifndef USED_FOR_TARGET\n+#undef HAVE_LD_PUSHPOPSTATE_SUPPORT\n+#endif\n+\n+\n /* Define if your linker links a mix of read-only and read-write sections into\n    a read-write section. */\n #ifndef USED_FOR_TARGET"}, {"sha": "22731706a25b1ebf5a2ac0bddea1ac90a81a2147", "filename": "gcc/config/i386/linux-common.h", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfig%2Fi386%2Flinux-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfig%2Fi386%2Flinux-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Flinux-common.h?ref=7e4955774fe4e365ec762a51d90ef6365b8be315", "patch": "@@ -79,13 +79,23 @@ along with GCC; see the file COPYING3.  If not see\n #endif\n #endif\n \n+#ifdef HAVE_LD_PUSHPOPSTATE_SUPPORT\n+#define MPX_LD_AS_NEEDED_GUARD_PUSH \"--push-state --no-as-needed\"\n+#define MPX_LD_AS_NEEDED_GUARD_POP \"--pop-state\"\n+#else\n+#define MPX_LD_AS_NEEDED_GUARD_PUSH \"\"\n+#define MPX_LD_AS_NEEDED_GUARD_POP \"\"\n+#endif\n+\n #ifndef LIBMPX_SPEC\n #if defined(HAVE_LD_STATIC_DYNAMIC)\n #define LIBMPX_SPEC \"\\\n %{mmpx:%{fcheck-pointer-bounds:\\\n     %{static:--whole-archive -lmpx --no-whole-archive\" LIBMPX_LIBS \"}\\\n     %{!static:%{static-libmpx:\" LD_STATIC_OPTION \" --whole-archive}\\\n-    -lmpx %{static-libmpx:--no-whole-archive \" LD_DYNAMIC_OPTION \\\n+    %{!static-libmpx:\" MPX_LD_AS_NEEDED_GUARD_PUSH \"} -lmpx \\\n+    %{!static-libmpx:\" MPX_LD_AS_NEEDED_GUARD_POP \"} \\\n+    %{static-libmpx:--no-whole-archive \" LD_DYNAMIC_OPTION \\\n     LIBMPX_LIBS \"}}}}\"\n #else\n #define LIBMPX_SPEC \"\\\n@@ -98,8 +108,8 @@ along with GCC; see the file COPYING3.  If not see\n #define LIBMPXWRAPPERS_SPEC \"\\\n %{mmpx:%{fcheck-pointer-bounds:%{!fno-chkp-use-wrappers:\\\n     %{static:-lmpxwrappers}\\\n-    %{!static:%{static-libmpxwrappers:\" LD_STATIC_OPTION \" --whole-archive}\\\n-    -lmpxwrappers %{static-libmpxwrappers:--no-whole-archive \"\\\n+    %{!static:%{static-libmpxwrappers:\" LD_STATIC_OPTION \"}\\\n+    -lmpxwrappers %{static-libmpxwrappers: \"\\\n     LD_DYNAMIC_OPTION \"}}}}}\"\n #else\n #define LIBMPXWRAPPERS_SPEC \"\\"}, {"sha": "0eeee94307e62455c8eae9a8f67d9ababa9b9de7", "filename": "gcc/configure", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=7e4955774fe4e365ec762a51d90ef6365b8be315", "patch": "@@ -29609,6 +29609,30 @@ fi\n { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ld_bndplt_support\" >&5\n $as_echo \"$ld_bndplt_support\" >&6; }\n \n+# Check linker supports '--push-state'/'--pop-state'\n+ld_pushpopstate_support=no\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking linker --push-state/--pop-state options\" >&5\n+$as_echo_n \"checking linker --push-state/--pop-state options... \" >&6; }\n+if test x\"$ld_is_gold\" = xno; then\n+  if test $in_tree_ld = yes ; then\n+    if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 25 -o \"$gcc_cv_gld_major_version\" -gt 2; then\n+      ld_pushpopstate_support=yes\n+    fi\n+  elif test x$gcc_cv_ld != x; then\n+    # Check if linker supports --push-state/--pop-state options\n+    if $gcc_cv_ld --help 2>/dev/null | grep -- '--push-state' > /dev/null; then\n+      ld_pushpopstate_support=yes\n+    fi\n+  fi\n+fi\n+if test x\"$ld_pushpopstate_support\" = xyes; then\n+\n+$as_echo \"#define HAVE_LD_PUSHPOPSTATE_SUPPORT 1\" >>confdefs.h\n+\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ld_pushpopstate_support\" >&5\n+$as_echo \"$ld_pushpopstate_support\" >&6; }\n+\n # Configure the subdirectories\n # AC_CONFIG_SUBDIRS($subdirs)\n "}, {"sha": "93af766a57c49e873e462fb22df9546354538a1f", "filename": "gcc/configure.ac", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e4955774fe4e365ec762a51d90ef6365b8be315/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=7e4955774fe4e365ec762a51d90ef6365b8be315", "patch": "@@ -6237,6 +6237,27 @@ if test x\"$ld_bndplt_support\" = xyes; then\n fi\n AC_MSG_RESULT($ld_bndplt_support)\n \n+# Check linker supports '--push-state'/'--pop-state'\n+ld_pushpopstate_support=no\n+AC_MSG_CHECKING(linker --push-state/--pop-state options)\n+if test x\"$ld_is_gold\" = xno; then\n+  if test $in_tree_ld = yes ; then\n+    if test \"$gcc_cv_gld_major_version\" -eq 2 -a \"$gcc_cv_gld_minor_version\" -ge 25 -o \"$gcc_cv_gld_major_version\" -gt 2; then\n+      ld_pushpopstate_support=yes\n+    fi\n+  elif test x$gcc_cv_ld != x; then\n+    # Check if linker supports --push-state/--pop-state options\n+    if $gcc_cv_ld --help 2>/dev/null | grep -- '--push-state' > /dev/null; then\n+      ld_pushpopstate_support=yes\n+    fi\n+  fi\n+fi\n+if test x\"$ld_pushpopstate_support\" = xyes; then\n+  AC_DEFINE(HAVE_LD_PUSHPOPSTATE_SUPPORT, 1,\n+\t[Define if your linker supports --push-state/--pop-state])\n+fi\n+AC_MSG_RESULT($ld_pushpopstate_support)\n+\n # Configure the subdirectories\n # AC_CONFIG_SUBDIRS($subdirs)\n "}]}