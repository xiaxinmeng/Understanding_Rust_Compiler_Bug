{"sha": "9bac66390c0c838594e42877f938bca441665937", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWJhYzY2MzkwYzBjODM4NTk0ZTQyODc3ZjkzOGJjYTQ0MTY2NTkzNw==", "commit": {"author": {"name": "Nikhil Benesch", "email": "nikhil.benesch@gmail.com", "date": "2020-12-16T13:41:20Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-12-21T04:16:50Z"}, "message": "libgo: adjust sysinfo scripts for changed -fdump-go-spec\n\nThe -fdump-go-spec flag to GCC recently changed to be more fastidious\nabout handling incomplete types. This caused some breakage in\nmk[r]sysinfo.sh on Solaris. This commit adjusts for the new behavior.\nSpecifically:\n\n  * Types that refer to _in6_addr may be hidden behind a typedef and can\n    no longer be filtered out with `grep -v in6_addr`. Instead just\n    rewrite the definition of _in6_addr to [16]byte wherever it appears.\n\n  * timestruc_t is now (correctly) emitted as an alias for timespec, so this\n    case is handled specially.\n\n  * stdio.h is included in sysinfo.c to avoid emitting an incomplete\n    definition of the FILE type.\n\n  * Dummy definitions for _u?pad128_t are now emitted automatically,\n    which conflict with the definitions installed by mk[r]sysinfo.sh.\n    These definitions were actually dead code, so just remove them.\n\nReviewed-on: https://go-review.googlesource.com/c/gofrontend/+/278672", "tree": {"sha": "f43532f5dfd01ef11335fb88ab6ac7fc1ce4829e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f43532f5dfd01ef11335fb88ab6ac7fc1ce4829e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9bac66390c0c838594e42877f938bca441665937", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bac66390c0c838594e42877f938bca441665937", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9bac66390c0c838594e42877f938bca441665937", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bac66390c0c838594e42877f938bca441665937/comments", "author": {"login": "benesch", "id": 882976, "node_id": "MDQ6VXNlcjg4Mjk3Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/882976?v=4", "gravatar_id": "", "url": "https://api.github.com/users/benesch", "html_url": "https://github.com/benesch", "followers_url": "https://api.github.com/users/benesch/followers", "following_url": "https://api.github.com/users/benesch/following{/other_user}", "gists_url": "https://api.github.com/users/benesch/gists{/gist_id}", "starred_url": "https://api.github.com/users/benesch/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/benesch/subscriptions", "organizations_url": "https://api.github.com/users/benesch/orgs", "repos_url": "https://api.github.com/users/benesch/repos", "events_url": "https://api.github.com/users/benesch/events{/privacy}", "received_events_url": "https://api.github.com/users/benesch/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "108beb75da0011b7e2cba65ee172fa4eefab9e41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/108beb75da0011b7e2cba65ee172fa4eefab9e41", "html_url": "https://github.com/Rust-GCC/gccrs/commit/108beb75da0011b7e2cba65ee172fa4eefab9e41"}], "stats": {"total": 114, "additions": 22, "deletions": 92}, "files": [{"sha": "81deef2cb79e38a19a5c65376716913201f3fca3", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bac66390c0c838594e42877f938bca441665937/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bac66390c0c838594e42877f938bca441665937/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=9bac66390c0c838594e42877f938bca441665937", "patch": "@@ -1,4 +1,4 @@\n-1317de50147304a226b3ec5c4d81376470c358e5\n+f9e44c6e510df9f047dbe28eb5fa19642e350f8f\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "18643370645727eb690109766dc73e5948438370", "filename": "libgo/mkrsysinfo.sh", "status": "modified", "additions": 8, "deletions": 45, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bac66390c0c838594e42877f938bca441665937/libgo%2Fmkrsysinfo.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bac66390c0c838594e42877f938bca441665937/libgo%2Fmkrsysinfo.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fmkrsysinfo.sh?ref=9bac66390c0c838594e42877f938bca441665937", "patch": "@@ -24,12 +24,19 @@ grep -v '^// ' gen-sysinfo.go | \\\n   grep -v '^type _timespec ' | \\\n   grep -v '^type _epoll_' | \\\n   grep -v '^type _*locale[_ ]' | \\\n-  grep -v 'in6_addr' | \\\n+  grep -v '^type _in6_addr' | \\\n   grep -v 'sockaddr_in6' | \\\n   egrep -v '^const _*FLT(64|128)_(NORM_)?MAX' | \\\n   sed -e 's/\\([^a-zA-Z0-9_]\\)_timeval\\([^a-zA-Z0-9_]\\)/\\1timeval\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timeval$/\\1timeval/g' \\\n       -e 's/\\([^a-zA-Z0-9_]\\)_timespec_t\\([^a-zA-Z0-9_]\\)/\\1timespec\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timespec_t$/\\1timespec_t/g' \\\n       -e 's/\\([^a-zA-Z0-9_]\\)_timespec\\([^a-zA-Z0-9_]\\)/\\1timespec\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timespec$/\\1timespec/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr\\([^a-zA-Z0-9_]\\)/\\1[16]byte\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr$/\\1[16]byte/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr_t\\([^a-zA-Z0-9_]\\)/\\1[16]byte\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr_t$/\\1[16]byte/g' \\\n     >> ${OUT}\n \n # The C long type, needed because that is the type that ptrace returns.\n@@ -45,16 +52,6 @@ else\n   exit 1\n fi\n \n-# On AIX, the _arpcom struct, is filtered by the above grep sequence, as it as\n-# a field of type _in6_addr, but other types depend on _arpcom, so we need to\n-# put it back.\n-grep '^type _arpcom ' gen-sysinfo.go | \\\n-  sed -e 's/_in6_addr/[16]byte/' >> ${OUT}\n-\n-# Same on Solaris for _mld_hdr_t.\n-grep '^type _mld_hdr_t ' gen-sysinfo.go | \\\n-  sed -e 's/_in6_addr/[16]byte/' >> ${OUT}\n-\n # The time structures need special handling: we need to name the\n # types, so that we can cast integers to the right types when\n # assigning to the structures.\n@@ -166,40 +163,6 @@ fi\n grep '^type _sem_t ' gen-sysinfo.go | \\\n     sed -e 's/_sem_t/semt/' >> ${OUT}\n \n-# Solaris 2 needs _u?pad128_t, but its default definition in terms of long\n-# double is commented by -fdump-go-spec.\n-if grep \"^// type _pad128_t\" gen-sysinfo.go > /dev/null 2>&1; then\n-  echo \"type _pad128_t struct { _l [4]int32; }\" >> ${OUT}\n-fi\n-if grep \"^// type _upad128_t\" gen-sysinfo.go > /dev/null 2>&1; then\n-  echo \"type _upad128_t struct { _l [4]uint32; }\" >> ${OUT}\n-fi\n-\n-# The Solaris 11 Update 1 _zone_net_addr_t struct.\n-grep '^type _zone_net_addr_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr/[16]byte/' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.4 _flow_arp_desc_t struct.\n-grep '^type _flow_arp_desc_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.4 _flow_l3_desc_t struct.\n-grep '^type _flow_l3_desc_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.3 _mac_ipaddr_t struct.\n-grep '^type _mac_ipaddr_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.3 _mactun_info_t struct.\n-grep '^type _mactun_info_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n # The Solaris port_event_t struct.\n grep '^type _port_event_t ' gen-sysinfo.go | \\\n     sed -e s'/_port_event_t/portevent/' \\"}, {"sha": "0c52ea5d71a9032eb7bbf596b43db906fadc85ff", "filename": "libgo/mksysinfo.sh", "status": "modified", "additions": 12, "deletions": 46, "changes": 58, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bac66390c0c838594e42877f938bca441665937/libgo%2Fmksysinfo.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bac66390c0c838594e42877f938bca441665937/libgo%2Fmksysinfo.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fmksysinfo.sh?ref=9bac66390c0c838594e42877f938bca441665937", "patch": "@@ -36,25 +36,23 @@ grep -v '^// ' gen-sysinfo.go | \\\n   grep -v '^type _timestruc_t ' | \\\n   grep -v '^type _epoll_' | \\\n   grep -v '^type _*locale[_ ]' | \\\n-  grep -v 'in6_addr' | \\\n+  grep -v '^type _in6_addr' | \\\n   grep -v 'sockaddr_in6' | \\\n   egrep -v '^const _*FLT(64|128)_(NORM_)?MAX' | \\\n   sed -e 's/\\([^a-zA-Z0-9_]\\)_timeval\\([^a-zA-Z0-9_]\\)/\\1Timeval\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timeval$/\\1Timeval/g' \\\n       -e 's/\\([^a-zA-Z0-9_]\\)_timespec_t\\([^a-zA-Z0-9_]\\)/\\1Timespec\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timespec_t$/\\1Timespec/g' \\\n       -e 's/\\([^a-zA-Z0-9_]\\)_timespec\\([^a-zA-Z0-9_]\\)/\\1Timespec\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timespec$/\\1Timespec/g' \\\n       -e 's/\\([^a-zA-Z0-9_]\\)_timestruc_t\\([^a-zA-Z0-9_]\\)/\\1Timestruc\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_timestruc_t$/\\1Timestruc/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr\\([^a-zA-Z0-9_]\\)/\\1[16]byte\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr$/\\1[16]byte/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr_t\\([^a-zA-Z0-9_]\\)/\\1[16]byte\\2/g' \\\n+      -e 's/\\([^a-zA-Z0-9_]\\)_in6_addr_t$/\\1[16]byte/g' \\\n     >> ${OUT}\n \n-# On AIX, the _arpcom struct, is filtered by the above grep sequence, as it as\n-# a field of type _in6_addr, but other types depend on _arpcom, so we need to\n-# put it back.\n-grep '^type _arpcom ' gen-sysinfo.go | \\\n-  sed -e 's/_in6_addr/[16]byte/' >> ${OUT}\n-\n-# Same on Solaris for _mld_hdr_t.\n-grep '^type _mld_hdr_t ' gen-sysinfo.go | \\\n-  sed -e 's/_in6_addr/[16]byte/' >> ${OUT}\n-\n # The errno constants.  These get type Errno.\n egrep '#define E[A-Z0-9_]+ [0-9E]' errno.i | \\\n   sed -e 's/^#define \\(E[A-Z0-9_]*\\) .*$/const \\1 = Errno(_\\1)/' >> ${OUT}\n@@ -442,15 +440,6 @@ else\n   exit 1\n fi\n \n-# Solaris 2 needs _u?pad128_t, but its default definition in terms of long\n-# double is commented by -fdump-go-spec.\n-if grep \"^// type _pad128_t\" gen-sysinfo.go > /dev/null 2>&1; then\n-  echo \"type _pad128_t struct { _l [4]int32; }\" >> ${OUT}\n-fi\n-if grep \"^// type _upad128_t\" gen-sysinfo.go > /dev/null 2>&1; then\n-  echo \"type _upad128_t struct { _l [4]uint32; }\" >> ${OUT}\n-fi\n-\n # The time_t type.\n if grep '^type _time_t ' gen-sysinfo.go > /dev/null 2>&1; then\n   echo 'type Time_t _time_t' >> ${OUT}\n@@ -484,7 +473,9 @@ echo $timespec | \\\n       -e 's/tv_nsec *[a-zA-Z0-9_]*/Nsec Timespec_nsec_t/' >> ${OUT}\n \n timestruc=`grep '^type _timestruc_t ' gen-sysinfo.go || true`\n-if test \"$timestruc\" != \"\"; then\n+if test \"$timestruc\" = \"type _timestruc_t _timespec\"; then\n+  echo \"type Timestruc Timespec\" >> ${OUT}\n+elif test \"$timestruc\" != \"\"; then\n   timestruc_sec=`echo $timestruc | sed -n -e 's/^.*tv_sec \\([^ ]*\\);.*$/\\1/p'`\n   timestruc_nsec=`echo $timestruc | sed -n -e 's/^.*tv_nsec \\([^ ]*\\);.*$/\\1/p'`\n   echo \"type Timestruc_sec_t = $timestruc_sec\" >> ${OUT}\n@@ -1524,31 +1515,6 @@ if ! grep 'const SizeofICMPv6Filter ' ${OUT} >/dev/null 2>&1; then\n     echo 'const SizeofICMPv6Filter = 32' >> ${OUT}\n fi\n \n-# The Solaris 11 Update 1 _zone_net_addr_t struct.\n-grep '^type _zone_net_addr_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr/[16]byte/' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.4 _flow_arp_desc_t struct.\n-grep '^type _flow_arp_desc_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.4 _flow_l3_desc_t struct.\n-grep '^type _flow_l3_desc_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.3 _mac_ipaddr_t struct.\n-grep '^type _mac_ipaddr_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n-# The Solaris 11.3 _mactun_info_t struct.\n-grep '^type _mactun_info_t ' gen-sysinfo.go | \\\n-    sed -e 's/_in6_addr_t/[16]byte/g' \\\n-    >> ${OUT}\n-\n # Type 'uint128' is needed in a couple of type definitions on arm64,such\n # as _user_fpsimd_struct, _elf_fpregset_t, etc.\n if ! grep '^type uint128' ${OUT} > /dev/null 2>&1; then"}, {"sha": "8ce061e2f5fdeb7389dcaf3dc0047c905d8434cf", "filename": "libgo/sysinfo.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bac66390c0c838594e42877f938bca441665937/libgo%2Fsysinfo.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bac66390c0c838594e42877f938bca441665937/libgo%2Fsysinfo.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fsysinfo.c?ref=9bac66390c0c838594e42877f938bca441665937", "patch": "@@ -11,6 +11,7 @@\n \n #include <stddef.h>\n #include <stdlib.h>\n+#include <stdio.h>\n #include <sys/types.h>\n #include <dirent.h>\n #include <errno.h>"}]}