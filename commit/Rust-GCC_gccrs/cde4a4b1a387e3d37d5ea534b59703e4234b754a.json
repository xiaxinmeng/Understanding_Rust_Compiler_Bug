{"sha": "cde4a4b1a387e3d37d5ea534b59703e4234b754a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2RlNGE0YjFhMzg3ZTNkMzdkNWVhNTM0YjU5NzAzZTQyMzRiNzU0YQ==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2007-06-06T10:27:01Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-06-06T10:27:01Z"}, "message": "exp_imgv.adb (Expand_Value_Attribute): Disable compilation of this attribute compiling package Ada.Tags under...\n\n2007-04-20  Javier Miranda  <miranda@adacore.com>\n\n\t* exp_imgv.adb (Expand_Value_Attribute): Disable compilation of this\n\tattribute compiling package Ada.Tags under No_Run_Time_Mode.\n\nFrom-SVN: r125405", "tree": {"sha": "9b7f267eea33730c15f0b02b11bc2659e1e40cb2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9b7f267eea33730c15f0b02b11bc2659e1e40cb2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cde4a4b1a387e3d37d5ea534b59703e4234b754a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cde4a4b1a387e3d37d5ea534b59703e4234b754a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cde4a4b1a387e3d37d5ea534b59703e4234b754a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cde4a4b1a387e3d37d5ea534b59703e4234b754a/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1091ce145a5a251bab1e31f848521b630c26522a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1091ce145a5a251bab1e31f848521b630c26522a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1091ce145a5a251bab1e31f848521b630c26522a"}], "stats": {"total": 33, "additions": 27, "deletions": 6}, "files": [{"sha": "2e669dffbef4f019b84afde6958b4973aa283d74", "filename": "gcc/ada/exp_imgv.adb", "status": "modified", "additions": 27, "deletions": 6, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cde4a4b1a387e3d37d5ea534b59703e4234b754a/gcc%2Fada%2Fexp_imgv.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cde4a4b1a387e3d37d5ea534b59703e4234b754a/gcc%2Fada%2Fexp_imgv.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_imgv.adb?ref=cde4a4b1a387e3d37d5ea534b59703e4234b754a", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2006, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -29,6 +29,7 @@ with Casing;   use Casing;\n with Checks;   use Checks;\n with Einfo;    use Einfo;\n with Exp_Util; use Exp_Util;\n+with Lib;      use Lib;\n with Namet;    use Namet;\n with Nmake;    use Nmake;\n with Nlists;   use Nlists;\n@@ -633,11 +634,31 @@ package body Exp_Imgv is\n       --  and decimal types, with Vid set to the Id of the entity for the\n       --  Value routine and Args set to the list of parameters for the call.\n \n-      Rewrite (N,\n-        Convert_To (Btyp,\n-          Make_Function_Call (Loc,\n-            Name => New_Reference_To (RTE (Vid), Loc),\n-            Parameter_Associations => Args)));\n+      --  Compiling package Ada.Tags under No_Run_Time_Mode we disable the\n+      --  expansion of the attribute into the function call statement to avoid\n+      --  generating spurious errors caused by the use of Integer_Address'Value\n+      --  in our implementation of Ada.Tags.Internal_Tag\n+\n+      --  Seems like a bit of a kludge, there should be a better way ???\n+\n+      --  There is a better way, you should also test RTE_Available ???\n+\n+      if No_Run_Time_Mode\n+        and then Rtyp = RTE (RE_Integer_Address)\n+        and then RTU_Loaded (Ada_Tags)\n+        and then Cunit_Entity (Current_Sem_Unit)\n+                   = Body_Entity (RTU_Entity (Ada_Tags))\n+      then\n+         Rewrite (N,\n+           Unchecked_Convert_To (Rtyp,\n+             Make_Integer_Literal (Loc, Uint_0)));\n+      else\n+         Rewrite (N,\n+           Convert_To (Btyp,\n+             Make_Function_Call (Loc,\n+               Name => New_Reference_To (RTE (Vid), Loc),\n+               Parameter_Associations => Args)));\n+      end if;\n \n       Analyze_And_Resolve (N, Btyp);\n    end Expand_Value_Attribute;"}]}