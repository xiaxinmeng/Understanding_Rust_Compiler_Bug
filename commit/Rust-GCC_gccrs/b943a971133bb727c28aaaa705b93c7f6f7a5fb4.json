{"sha": "b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjk0M2E5NzExMzNiYjcyN2MyOGFhYWE3MDViOTNjN2Y2ZjdhNWZiNA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2016-04-21T08:30:19Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2016-04-21T08:30:19Z"}, "message": "[multiple changes]\n\n2016-04-21  Gary Dismukes  <dismukes@adacore.com>\n\n\t* exp_attr.adb (Is_Inline_Floating_Point_Attribute): Suppress\n\texpansion of Attribute_Machine and Attribute_Model for AAMP.\n\n2016-04-21  Ed Schonberg  <schonberg@adacore.com>\n\n\t* freeze.adb: Disable previous change for now.\n\n2016-04-21  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch8.adb (Find_Selected_Component): If prefix has an\n\taccess type and designated type is a limited view, introduce\n\tan explicit dereference before continuing the analysis, and\n\tset its type to the non-limited view of the designated type,\n\tif we are in context where it is available.\n\nFrom-SVN: r235311", "tree": {"sha": "accf5886233e15eff8cbec4962a1a6d4e3d7350c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/accf5886233e15eff8cbec4962a1a6d4e3d7350c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/comments", "author": null, "committer": null, "parents": [{"sha": "b1d8d2290fc30f9a25da4c7dececc52c9161eddd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1d8d2290fc30f9a25da4c7dececc52c9161eddd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1d8d2290fc30f9a25da4c7dececc52c9161eddd"}], "stats": {"total": 71, "additions": 55, "deletions": 16}, "files": [{"sha": "d0cc96ae9cab88ce960acc6eacd132a7f6c42dc6", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "patch": "@@ -1,3 +1,20 @@\n+2016-04-21  Gary Dismukes  <dismukes@adacore.com>\n+\n+\t* exp_attr.adb (Is_Inline_Floating_Point_Attribute): Suppress\n+\texpansion of Attribute_Machine and Attribute_Model for AAMP.\n+\n+2016-04-21  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* freeze.adb: Disable previous change for now.\n+\n+2016-04-21  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch8.adb (Find_Selected_Component): If prefix has an\n+\taccess type and designated type is a limited view, introduce\n+\tan explicit dereference before continuing the analysis, and\n+\tset its type to the non-limited view of the designated type,\n+\tif we are in context where it is available.\n+\n 2016-04-21  Ed Schonberg  <schonberg@adacore.com>\n \n \t* freeze.adb: Freeze profile in ASIS mode."}, {"sha": "28e1f65f646903bf7f0dcf866b468705f87546de", "filename": "gcc/ada/exp_attr.adb", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2Fexp_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2Fexp_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_attr.adb?ref=b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2015, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2016, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -7993,13 +7993,13 @@ package body Exp_Attr is\n            and then not Generate_C_Code;\n       end Is_GCC_Target;\n \n-   --  Start of processing for Exp_Attr\n+   --  Start of processing for Is_Inline_Floating_Point_Attribute\n \n    begin\n-      --  Machine and Model can be expanded by the GCC backend only\n+      --  Machine and Model can be expanded by the GCC and AAMP back ends only\n \n       if Id = Attribute_Machine or else Id = Attribute_Model then\n-         return Is_GCC_Target;\n+         return Is_GCC_Target or else AAMP_On_Target;\n \n       --  Remaining cases handled by all back ends are Rounding and Truncation\n       --  when appearing as the operand of a conversion to some integer type."}, {"sha": "ba95f269c598dd82ad434e1c0e4aee0f0a7d91c5", "filename": "gcc/ada/freeze.adb", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2Ffreeze.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2Ffreeze.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ffreeze.adb?ref=b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "patch": "@@ -5008,11 +5008,13 @@ package body Freeze is\n             --  Other constructs that should not freeze ???\n \n             --  This processing doesn't apply to internal entities (see below)\n-            --  In ASIS mode the profile is frozen unconditionally, to prevent\n-            --  backend anomalies.\n+\n+            --  Disable this mechanism for now, to fix regressions in ASIS and\n+            --  various ACATS tests. Implementation of AI05-019 remains\n+            --  unsolved ???\n \n             if not Is_Internal (E)\n-              and then (Do_Freeze_Profile or ASIS_Mode)\n+              and then (Do_Freeze_Profile or else True)\n             then\n                if not Freeze_Profile (E) then\n                   Ghost_Mode := Save_Ghost_Mode;"}, {"sha": "842bb23a2f5e1510ff0138f6c23ddf7ec4c65ec3", "filename": "gcc/ada/sem_ch8.adb", "status": "modified", "additions": 29, "deletions": 9, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2Fsem_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b943a971133bb727c28aaaa705b93c7f6f7a5fb4/gcc%2Fada%2Fsem_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch8.adb?ref=b943a971133bb727c28aaaa705b93c7f6f7a5fb4", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2015, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2016, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -6729,17 +6729,27 @@ package body Sem_Ch8 is\n \n          --  The designated type may be a limited view with no components.\n          --  Check whether the non-limited view is available, because in some\n-         --  cases this will not be set when installing the context.\n+         --  cases this will not be set when installing the context. Rewrite\n+         --  the node by introducing an explicit dereference at once, and\n+         --  setting the type of the rewritten prefix to the non-limited view\n+         --  of the original designated type.\n \n          if Is_Access_Type (P_Type) then\n             declare\n-               D : constant Entity_Id := Directly_Designated_Type (P_Type);\n+               Desig_Typ : constant Entity_Id :=\n+                             Directly_Designated_Type (P_Type);\n+\n             begin\n-               if Is_Incomplete_Type (D)\n-                 and then From_Limited_With (D)\n-                 and then Present (Non_Limited_View (D))\n+               if Is_Incomplete_Type (Desig_Typ)\n+                 and then From_Limited_With (Desig_Typ)\n+                 and then Present (Non_Limited_View (Desig_Typ))\n                then\n-                  Set_Directly_Designated_Type (P_Type,  Non_Limited_View (D));\n+                  Rewrite (P,\n+                    Make_Explicit_Dereference (Sloc (P),\n+                      Prefix => Relocate_Node (P)));\n+\n+                  Set_Etype (P, Get_Full_View (Non_Limited_View (Desig_Typ)));\n+                  P_Type := Etype (P);\n                end if;\n             end;\n          end if;\n@@ -6930,9 +6940,19 @@ package body Sem_Ch8 is\n          else\n             --  Format node as expanded name, to avoid cascaded errors\n \n+            --  If the limited_with transformation was applied earlier,\n+            --  restore source for proper error reporting.\n+\n+            if not Comes_From_Source (P)\n+              and then Nkind (P) = N_Explicit_Dereference\n+            then\n+               Rewrite (P, Prefix (P));\n+               P_Type := Etype (P);\n+            end if;\n+\n             Change_Selected_Component_To_Expanded_Name (N);\n-            Set_Entity  (N, Any_Id);\n-            Set_Etype   (N, Any_Type);\n+            Set_Entity (N, Any_Id);\n+            Set_Etype  (N, Any_Type);\n \n             --  Issue error message, but avoid this if error issued already.\n             --  Use identifier of prefix if one is available."}]}