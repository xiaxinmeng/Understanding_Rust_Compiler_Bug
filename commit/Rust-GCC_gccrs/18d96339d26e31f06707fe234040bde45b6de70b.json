{"sha": "18d96339d26e31f06707fe234040bde45b6de70b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MThkOTYzMzlkMjZlMzFmMDY3MDdmZTIzNDA0MGJkZTQ1YjZkZTcwYg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-07-22T15:01:45Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-07-22T15:43:25Z"}, "message": "preprocessor: add_path simplifications\n\nI noticed add_path was calling strlen more than once on the same\nstring.  Let's not do that.\n\n\tgcc/\n\t* incpath.c (add_path): Avoid multiple strlen calls.", "tree": {"sha": "e1144045835cebe090a42afeed2951f4520f527e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e1144045835cebe090a42afeed2951f4520f527e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/18d96339d26e31f06707fe234040bde45b6de70b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18d96339d26e31f06707fe234040bde45b6de70b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18d96339d26e31f06707fe234040bde45b6de70b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18d96339d26e31f06707fe234040bde45b6de70b/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5980c0dcc6b3c2bb2f01f2140f48beb3fe3ffee6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5980c0dcc6b3c2bb2f01f2140f48beb3fe3ffee6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5980c0dcc6b3c2bb2f01f2140f48beb3fe3ffee6"}], "stats": {"total": 8, "additions": 5, "deletions": 3}, "files": [{"sha": "8437939bf1e88d6363d78482874f53474dcf3339", "filename": "gcc/incpath.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/18d96339d26e31f06707fe234040bde45b6de70b/gcc%2Fincpath.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/18d96339d26e31f06707fe234040bde45b6de70b/gcc%2Fincpath.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fincpath.c?ref=18d96339d26e31f06707fe234040bde45b6de70b", "patch": "@@ -52,8 +52,8 @@ static void free_path (struct cpp_dir *, int);\n static void merge_include_chains (const char *, cpp_reader *, int);\n static void add_sysroot_to_chain (const char *, int);\n static struct cpp_dir *remove_duplicates (cpp_reader *, struct cpp_dir *,\n-\t\t\t\t\t   struct cpp_dir *,\n-\t\t\t\t\t   struct cpp_dir *, int);\n+\t\t\t\t\t  struct cpp_dir *, struct cpp_dir *,\n+\t\t\t\t\t  int);\n \n /* Include chains heads and tails.  */\n static struct cpp_dir *heads[INC_MAX];\n@@ -432,25 +432,27 @@ void\n add_path (char *path, incpath_kind chain, int cxx_aware, bool user_supplied_p)\n {\n   cpp_dir *p;\n+  size_t pathlen = strlen (path);\n \n #if defined (HAVE_DOS_BASED_FILE_SYSTEM)\n   /* Remove unnecessary trailing slashes.  On some versions of MS\n      Windows, trailing  _forward_ slashes cause no problems for stat().\n      On newer versions, stat() does not recognize a directory that ends\n      in a '\\\\' or '/', unless it is a drive root dir, such as \"c:/\",\n      where it is obligatory.  */\n-  int pathlen = strlen (path);\n   char* end = path + pathlen - 1;\n   /* Preserve the lead '/' or lead \"c:/\".  */\n   char* start = path + (pathlen > 2 && path[1] == ':' ? 3 : 1);\n \n   for (; end > start && IS_DIR_SEPARATOR (*end); end--)\n     *end = 0;\n+  pathlen = end - path;\n #endif\n \n   p = XNEW (cpp_dir);\n   p->next = NULL;\n   p->name = path;\n+  p->len = pathlen;\n #ifndef INO_T_EQ\n   p->canonical_name = lrealpath (path);\n #endif"}]}