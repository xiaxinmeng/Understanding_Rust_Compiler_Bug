{"sha": "078c5aff5ed83e9c237f3090e947860314838e00", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc4YzVhZmY1ZWQ4M2U5YzIzN2YzMDkwZTk0Nzg2MDMxNDgzOGUwMA==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-04-02T16:47:48Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-04-02T16:47:48Z"}, "message": "re PR fortran/85102 (ICE in gfc_conv_intrinsic_dot_product, at fortran/trans-intrinsic.c:4464)\n\n2018-04-02  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/85102\n\t* decl.c (variable_decl): If upper or lower bounds simplify\n\tto a constant, use that.\n\n2018-04-02  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/85102\n\t* gfortran.dg/array_simplify_2.f90: New test.\n\nFrom-SVN: r259014", "tree": {"sha": "b81a2e4f6cf9728908b1970f8a5c4ef93655ee7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b81a2e4f6cf9728908b1970f8a5c4ef93655ee7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/078c5aff5ed83e9c237f3090e947860314838e00", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/078c5aff5ed83e9c237f3090e947860314838e00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/078c5aff5ed83e9c237f3090e947860314838e00", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/078c5aff5ed83e9c237f3090e947860314838e00/comments", "author": null, "committer": null, "parents": [{"sha": "c54a138f843e86571ff8a3ff29dbddf1d4489849", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c54a138f843e86571ff8a3ff29dbddf1d4489849", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c54a138f843e86571ff8a3ff29dbddf1d4489849"}], "stats": {"total": 49, "additions": 49, "deletions": 0}, "files": [{"sha": "1d90f4fa317fd67f97e0f06530b713d72f80c2f8", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=078c5aff5ed83e9c237f3090e947860314838e00", "patch": "@@ -1,3 +1,9 @@\n+2018-04-02  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/85102\n+\t* decl.c (variable_decl): If upper or lower bounds simplify\n+\tto a constant, use that.\n+\n 2018-03-30  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/84931"}, {"sha": "192910dfe65984d1f3e032425d53b328f233ebea", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=078c5aff5ed83e9c237f3090e947860314838e00", "patch": "@@ -2424,6 +2424,33 @@ variable_decl (int elem)\n \t      goto cleanup;\n \t    }\n \t}\n+      if (as->type == AS_EXPLICIT)\n+\t{\n+\t  for (int i = 0; i < as->rank; i++)\n+\t    {\n+\t      gfc_expr *e, *n;\n+\t      e = as->lower[i];\n+\t      if (e->expr_type != EXPR_CONSTANT)\n+\t\t{\n+\t\t  n = gfc_copy_expr (e);\n+\t\t  gfc_simplify_expr (n, 1);\n+\t\t  if (n->expr_type == EXPR_CONSTANT)\n+\t\t    gfc_replace_expr (e, n);\n+\t\t  else\n+\t\t    gfc_free_expr (n);\n+\t\t}\n+\t      e = as->upper[i];\n+\t      if (e->expr_type != EXPR_CONSTANT)\n+\t\t{\n+\t\t  n = gfc_copy_expr (e);\n+\t\t  gfc_simplify_expr (n, 1);\n+\t\t  if (n->expr_type == EXPR_CONSTANT)\n+\t\t    gfc_replace_expr (e, n);\n+\t\t  else\n+\t\t    gfc_free_expr (n);\n+\t\t}\n+\t    }\n+\t}\n     }\n \n   char_len = NULL;"}, {"sha": "ca5953f2234cc338d9b5e03f624e378ad73671f3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=078c5aff5ed83e9c237f3090e947860314838e00", "patch": "@@ -1,3 +1,8 @@\n+2018-04-02  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/85102\n+\t* gfortran.dg/array_simplify_2.f90: New test.\n+\n 2018-04-01  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/85090"}, {"sha": "36454044ee2c7704990300e503fd257d1efff9ec", "filename": "gcc/testsuite/gfortran.dg/array_simplify_2.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_simplify_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/078c5aff5ed83e9c237f3090e947860314838e00/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_simplify_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Farray_simplify_2.f90?ref=078c5aff5ed83e9c237f3090e947860314838e00", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do  run }\n+! PR 85102 - this used to ICE\n+! Original test case by Gerhard Steinmetz\n+program p\n+   integer, parameter :: a((1+2)) = 1\n+   integer, parameter :: b((1+1)+1) = 1\n+   integer, parameter :: c = dot_product(a, a)\n+   integer, parameter :: d = dot_product(b,b)\n+   if (c /= 3) stop 1\n+   if (d /= 3) stop 2\n+ end program p"}]}