{"sha": "81de8b03e081561c474924ef9ad705921648f1f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODFkZThiMDNlMDgxNTYxYzQ3NDkyNGVmOWFkNzA1OTIxNjQ4ZjFmNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2012-03-15T23:46:34Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2012-03-15T23:46:34Z"}, "message": "re PR target/52568 (suboptimal __builtin_shuffle on cycles with AVX)\n\n\tPR target/52568\n\t* config/i386/i386.c (expand_vec_perm_vperm2f128_vblend): New\n\tfunction.\n\t(ix86_expand_vec_perm_const_1): Use it.\n\n\t* gcc.dg/torture/vshuf-4.inc: Add two new tests.\n\t* gcc.dg/torture/vshuf-8.inc: Likewise.\n\t* gcc.dg/torture/vshuf-16.inc: Likewise.\n\t* gcc.dg/torture/vshuf-32.inc: Likewise.\n\nFrom-SVN: r185447", "tree": {"sha": "2c00e66ff7d5c03422892fb1b020e0ba7af93142", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2c00e66ff7d5c03422892fb1b020e0ba7af93142"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81de8b03e081561c474924ef9ad705921648f1f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81de8b03e081561c474924ef9ad705921648f1f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81de8b03e081561c474924ef9ad705921648f1f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81de8b03e081561c474924ef9ad705921648f1f4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b82277395eb57ad0f2fd4d129e3497c74fb74fe0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b82277395eb57ad0f2fd4d129e3497c74fb74fe0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b82277395eb57ad0f2fd4d129e3497c74fb74fe0"}], "stats": {"total": 99, "additions": 95, "deletions": 4}, "files": [{"sha": "798088a0aece627f3feeea1eaff3e5c7b8f522a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -1,5 +1,10 @@\n 2012-03-15  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/52568\n+\t* config/i386/i386.c (expand_vec_perm_vperm2f128_vblend): New\n+\tfunction.\n+\t(ix86_expand_vec_perm_const_1): Use it.\n+\n \tPR target/52568\n \t* config/i386/sse.md (UNSPEC_VPERMDF): Remove.\n \t(avx2_permv4df): Remove."}, {"sha": "3f007a5bbdf57b26ec7c209a6e5ce5a9d80db184", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 70, "deletions": 0, "changes": 70, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -36638,6 +36638,73 @@ expand_vec_perm_interleave3 (struct expand_vec_perm_d *d)\n   return true;\n }\n \n+/* A subroutine of ix86_expand_vec_perm_builtin_1.  Try to implement\n+   a single vector permutation using a single intra-lane vector\n+   permutation, vperm2f128 swapping the lanes and vblend* insn blending\n+   the non-swapped and swapped vectors together.  */\n+\n+static bool\n+expand_vec_perm_vperm2f128_vblend (struct expand_vec_perm_d *d)\n+{\n+  struct expand_vec_perm_d dfirst, dsecond;\n+  unsigned i, j, msk, nelt = d->nelt, nelt2 = nelt / 2;\n+  rtx seq;\n+  bool ok;\n+  rtx (*blend) (rtx, rtx, rtx, rtx) = NULL;\n+\n+  if (!TARGET_AVX\n+      || TARGET_AVX2\n+      || (d->vmode != V8SFmode && d->vmode != V4DFmode)\n+      || d->op0 != d->op1)\n+    return false;\n+\n+  dfirst = *d;\n+  for (i = 0; i < nelt; i++)\n+    dfirst.perm[i] = 0xff;\n+  for (i = 0, msk = 0; i < nelt; i++)\n+    {\n+      j = (d->perm[i] & nelt2) ? i | nelt2 : i & ~nelt2;\n+      if (dfirst.perm[j] != 0xff && dfirst.perm[j] != d->perm[i])\n+\treturn false;\n+      dfirst.perm[j] = d->perm[i];\n+      if (j != i)\n+\tmsk |= (1 << i);\n+    }\n+  for (i = 0; i < nelt; i++)\n+    if (dfirst.perm[i] == 0xff)\n+      dfirst.perm[i] = i;\n+\n+  if (!d->testing_p)\n+    dfirst.target = gen_reg_rtx (dfirst.vmode);\n+\n+  start_sequence ();\n+  ok = expand_vec_perm_1 (&dfirst);\n+  seq = get_insns ();\n+  end_sequence ();\n+\n+  if (!ok)\n+    return false;\n+\n+  if (d->testing_p)\n+    return true;\n+\n+  emit_insn (seq);\n+\n+  dsecond = *d;\n+  dsecond.op0 = dfirst.target;\n+  dsecond.op1 = dfirst.target;\n+  dsecond.target = gen_reg_rtx (dsecond.vmode);\n+  for (i = 0; i < nelt; i++)\n+    dsecond.perm[i] = i ^ nelt2;\n+\n+  ok = expand_vec_perm_1 (&dsecond);\n+  gcc_assert (ok);\n+\n+  blend = d->vmode == V8SFmode ? gen_avx_blendps256 : gen_avx_blendpd256;\n+  emit_insn (blend (d->target, dfirst.target, dsecond.target, GEN_INT (msk)));\n+  return true;\n+}\n+\n /* A subroutine of expand_vec_perm_even_odd_1.  Implement the double-word\n    permutation with two pshufb insns and an ior.  We should have already\n    failed all two instruction sequences.  */\n@@ -37289,6 +37356,9 @@ ix86_expand_vec_perm_const_1 (struct expand_vec_perm_d *d)\n   if (expand_vec_perm_interleave3 (d))\n     return true;\n \n+  if (expand_vec_perm_vperm2f128_vblend (d))\n+    return true;\n+\n   /* Try sequences of four instructions.  */\n \n   if (expand_vec_perm_vpshufb2_vpermq (d))"}, {"sha": "b79bdcc7c264979b17e5ff219eb0c87d564af1f8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -1,3 +1,11 @@\n+2012-03-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/52568\n+\t* gcc.dg/torture/vshuf-4.inc: Add two new tests.\n+\t* gcc.dg/torture/vshuf-8.inc: Likewise.\n+\t* gcc.dg/torture/vshuf-16.inc: Likewise.\n+\t* gcc.dg/torture/vshuf-32.inc: Likewise.\n+\n 2012-03-15  Jason Merrill  <jason@redhat.com>\n \n \t* g++.dg/torture/pr52582.C: New."}, {"sha": "f04b8ddedd303c957d11bd26401cdde7394d4e61", "filename": "gcc/testsuite/gcc.dg/torture/vshuf-16.inc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-16.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-16.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-16.inc?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -21,7 +21,9 @@ T (17,\t1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31) \\\n T (18,\t3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3) \\\n T (19,\t15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0) \\\n T (20,\t0, 16, 1, 17, 2, 18, 3, 19, 4, 20, 5, 21, 6, 22, 7, 23) \\\n-T (21,\t8, 24, 9, 25, 10, 26, 11, 27, 12, 28, 13, 29, 14, 30, 15, 31)\n+T (21,\t8, 24, 9, 25, 10, 26, 11, 27, 12, 28, 13, 29, 14, 30, 15, 31) \\\n+T (22,\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 0) \\\n+T (23,\t14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 15)\n #define EXPTESTS \\\n T (116,\t28, 13, 27, 11, 21, 1, 5, 22, 29, 14, 15, 6, 3, 10, 16, 30) \\\n T (117,\t22, 26, 1, 13, 29, 3, 18, 18, 11, 21, 12, 28, 19, 5, 7, 4) \\"}, {"sha": "c7fced062389197ac6c632314ab17c621de2b49a", "filename": "gcc/testsuite/gcc.dg/torture/vshuf-32.inc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-32.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-32.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-32.inc?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -21,7 +21,9 @@ T (17,\t1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25, 27, 29, 31, 33, 35, 37, 39\n T (18,\t3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3) \\\n T (19,\t31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0) \\\n T (20,\t0, 32, 1, 33, 2, 34, 3, 35, 4, 36, 5, 37, 6, 38, 7, 39, 8, 40, 9, 41, 10, 42, 11, 43, 12, 44, 13, 45, 14, 46, 15, 47) \\\n-T (21,\t16, 48, 17, 49, 18, 50, 19, 51, 20, 52, 21, 53, 22, 54, 23, 55, 24, 56, 25, 57, 26, 58, 27, 59, 28, 60, 29, 61, 30, 62, 31, 63)\n+T (21,\t16, 48, 17, 49, 18, 50, 19, 51, 20, 52, 21, 53, 22, 54, 23, 55, 24, 56, 25, 57, 26, 58, 27, 59, 28, 60, 29, 61, 30, 62, 31, 63) \\\n+T (22,\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 0) \\\n+T (23,\t30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 31)\n #define EXPTESTS \\\n T (116,\t13, 38, 47, 3, 17, 8, 38, 20, 59, 61, 39, 26, 7, 49, 63, 43, 57, 16, 40, 19, 4, 32, 27, 7, 52, 19, 46, 55, 36, 41, 48, 6) \\\n T (117,\t39, 35, 59, 20, 56, 18, 58, 63, 57, 14, 2, 16, 5, 61, 35, 4, 53, 9, 52, 51, 27, 33, 61, 12, 3, 35, 36, 40, 37, 7, 45, 42) \\"}, {"sha": "c50fa8e9dd573b82597bf4930b6f2f8545dede52", "filename": "gcc/testsuite/gcc.dg/torture/vshuf-4.inc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-4.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-4.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-4.inc?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -21,7 +21,9 @@ T (17,\t1, 3, 5, 7) \\\n T (18,\t3, 3, 3, 3) \\\n T (19,\t3, 2, 1, 0) \\\n T (20,\t0, 4, 1, 5) \\\n-T (21,\t2, 6, 3, 7)\n+T (21,\t2, 6, 3, 7) \\\n+T (22,\t1, 2, 3, 0) \\\n+T (23,\t2, 1, 0, 3)\n #define EXPTESTS \\\n T (116,\t1, 2, 4, 3) \\\n T (117,\t7, 3, 3, 0) \\"}, {"sha": "a39d71da6c8dd22e989afb5b20287ab3dcaa9357", "filename": "gcc/testsuite/gcc.dg/torture/vshuf-8.inc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-8.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81de8b03e081561c474924ef9ad705921648f1f4/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-8.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fvshuf-8.inc?ref=81de8b03e081561c474924ef9ad705921648f1f4", "patch": "@@ -21,7 +21,9 @@ T (17,\t1, 3, 5, 7, 9, 11, 13, 15) \\\n T (18,\t3, 3, 3, 3, 3, 3, 3, 3) \\\n T (19,\t7, 6, 5, 4, 3, 2, 1, 0) \\\n T (20,\t0, 8, 1, 9, 2, 10, 3, 11) \\\n-T (21,\t4, 12, 5, 13, 6, 14, 7, 15)\n+T (21,\t4, 12, 5, 13, 6, 14, 7, 15) \\\n+T (22,\t1, 2, 3, 4, 5, 6, 7, 0) \\\n+T (23,\t6, 5, 4, 3, 2, 1, 0, 7)\n #define EXPTESTS \\\n T (116,\t9, 3, 9, 4, 7, 0, 0, 6) \\\n T (117,\t4, 14, 12, 8, 9, 6, 0, 10) \\"}]}