{"sha": "2b4171c331d0875e411ea19b63b04a41a263c10c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmI0MTcxYzMzMWQwODc1ZTQxMWVhMTliNjNiMDRhNDFhMjYzYzEwYw==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2013-06-21T17:56:49Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2013-06-21T17:56:49Z"}, "message": "compiler: do not skip compilation of blank-named functions.\n\nFixes issue 22.\n\nFrom-SVN: r200316", "tree": {"sha": "20a8b74bc4292f765ed786f8f9254c9a2702c51b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/20a8b74bc4292f765ed786f8f9254c9a2702c51b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2b4171c331d0875e411ea19b63b04a41a263c10c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b4171c331d0875e411ea19b63b04a41a263c10c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b4171c331d0875e411ea19b63b04a41a263c10c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b4171c331d0875e411ea19b63b04a41a263c10c/comments", "author": null, "committer": null, "parents": [{"sha": "b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "06fd4f0bb2291ff572a93a5c04ca8e780af61ddb", "filename": "gcc/go/gofrontend/gogo-tree.cc", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b4171c331d0875e411ea19b63b04a41a263c10c/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b4171c331d0875e411ea19b63b04a41a263c10c/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo-tree.cc?ref=2b4171c331d0875e411ea19b63b04a41a263c10c", "patch": "@@ -829,6 +829,14 @@ Gogo::write_globals()\n \t    }\n \t}\n \n+      // Skip blank named functions.\n+      if (no->is_function() && no->func_value()->is_sink())\n+        {\n+          --i;\n+          --count;\n+          continue;\n+        }\n+\n       if (!no->is_variable())\n \t{\n \t  vec[i] = no->get_tree(this, NULL);"}, {"sha": "948b11f54dd715c4020046802b31f069d08eadd9", "filename": "gcc/go/gofrontend/gogo.cc", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b4171c331d0875e411ea19b63b04a41a263c10c/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b4171c331d0875e411ea19b63b04a41a263c10c/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.cc?ref=2b4171c331d0875e411ea19b63b04a41a263c10c", "patch": "@@ -819,7 +819,8 @@ Gogo::start_function(const std::string& name, Function_type* type,\n       char buf[30];\n       snprintf(buf, sizeof buf, \".$sink%d\", sink_count);\n       ++sink_count;\n-      ret = Named_object::make_function(buf, NULL, function);\n+      ret = this->package_->bindings()->add_function(buf, NULL, function);\n+      ret->func_value()->set_is_sink();\n     }\n   else if (!type->is_method())\n     {\n@@ -3253,8 +3254,8 @@ Function::Function(Function_type* type, Function* enclosing, Block* block,\n   : type_(type), enclosing_(enclosing), results_(NULL),\n     closure_var_(NULL), block_(block), location_(location), labels_(),\n     local_type_count_(0), descriptor_(NULL), fndecl_(NULL), defer_stack_(NULL),\n-    results_are_named_(false), nointerface_(false), calls_recover_(false),\n-    is_recover_thunk_(false), has_recover_thunk_(false),\n+    is_sink_(false), results_are_named_(false), nointerface_(false),\n+    calls_recover_(false), is_recover_thunk_(false), has_recover_thunk_(false),\n     in_unique_section_(false), is_descriptor_wrapper_(false)\n {\n }"}, {"sha": "7f55470a3fe36e5d3279a9dc4be7110f86ea5e63", "filename": "gcc/go/gofrontend/gogo.h", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b4171c331d0875e411ea19b63b04a41a263c10c/gcc%2Fgo%2Fgofrontend%2Fgogo.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b4171c331d0875e411ea19b63b04a41a263c10c/gcc%2Fgo%2Fgofrontend%2Fgogo.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.h?ref=2b4171c331d0875e411ea19b63b04a41a263c10c", "patch": "@@ -911,6 +911,14 @@ class Function\n   result_variables()\n   { return this->results_; }\n \n+  bool\n+  is_sink() const\n+  { return this->is_sink_; }\n+\n+  void\n+  set_is_sink()\n+  { this->is_sink_ = true; }\n+\n   // Whether the result variables have names.\n   bool\n   results_are_named() const\n@@ -1167,6 +1175,8 @@ class Function\n   // distinguish the defer stack for one function from another.  This\n   // is NULL unless we actually need a defer stack.\n   Temporary_statement* defer_stack_;\n+  // True if this function is sink-named.  No code is generated.\n+  bool is_sink_ : 1;\n   // True if the result variables are named.\n   bool results_are_named_ : 1;\n   // True if this method should not be included in the type descriptor."}]}