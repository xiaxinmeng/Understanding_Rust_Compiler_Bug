{"sha": "c43e95f8f5f67265f05633813f3950624bb4064b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzQzZTk1ZjhmNWY2NzI2NWYwNTYzMzgxM2YzOTUwNjI0YmI0MDY0Yg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2005-09-27T23:31:57Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2005-09-27T23:31:57Z"}, "message": "re PR c++/22147 (ICE in get_bindings)\n\n\tPR c++/22147\n\t* name-lookup.c (maybe_process_template_type_declaration): Don't\n\ttreat forward declarations of classes as templates just because\n\twe're processing_template_decl.\n\t* pt.c (tsubst_decl): Clear DECL_TEMPLATE_INFO for friend\n\tfunctions.\n\n\tPR c++/22147\n\t* g++.dg/template/friend37.C: New test.\n\t* g++.dg/parse/crash28.C: Adjust error markers.\n\nFrom-SVN: r104713", "tree": {"sha": "1d48bc0ddc17e9104af7209393174573d9ace1ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1d48bc0ddc17e9104af7209393174573d9ace1ff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c43e95f8f5f67265f05633813f3950624bb4064b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c43e95f8f5f67265f05633813f3950624bb4064b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c43e95f8f5f67265f05633813f3950624bb4064b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c43e95f8f5f67265f05633813f3950624bb4064b/comments", "author": null, "committer": null, "parents": [{"sha": "57f0d086d592e6c9bb44c330939b9dda63d24934", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57f0d086d592e6c9bb44c330939b9dda63d24934", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57f0d086d592e6c9bb44c330939b9dda63d24934"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "0c429cff6d0c0340c37ac772f442c04c03be83e0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c43e95f8f5f67265f05633813f3950624bb4064b", "patch": "@@ -1,3 +1,12 @@\n+2005-09-27  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/22147\n+\t* name-lookup.c (maybe_process_template_type_declaration): Don't\n+\ttreat forward declarations of classes as templates just because\n+\twe're processing_template_decl.\n+\t* pt.c (tsubst_decl): Clear DECL_TEMPLATE_INFO for friend\n+\tfunctions. \n+\n 2005-09-26  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/13764"}, {"sha": "29e5f2b2be6fbb566372189e7131fb5459783723", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=c43e95f8f5f67265f05633813f3950624bb4064b", "patch": "@@ -4689,6 +4689,11 @@ maybe_process_template_type_declaration (tree type, int is_friend,\n \n        is a forward-declaration of `A'.  */\n     ;\n+  else if (b->kind == sk_namespace\n+\t   && current_binding_level->kind != sk_namespace)\n+    /* If this new type is being injected into a containing scope,\n+       then it's not a template type.  */\n+    ;\n   else\n     {\n       gcc_assert (IS_AGGR_TYPE (type) || TREE_CODE (type) == ENUMERAL_TYPE);"}, {"sha": "1217580f75f844fc6058515aaa323d3c46428688", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=c43e95f8f5f67265f05633813f3950624bb4064b", "patch": "@@ -6510,6 +6510,8 @@ tsubst_decl (tree t, tree args, tsubst_flags_t complain)\n \t\t&& !uses_template_parms (argvec))\n \t      tsubst_default_arguments (r);\n \t  }\n+\telse\n+\t  DECL_TEMPLATE_INFO (r) = NULL_TREE;\n \n \t/* Copy the list of befriending classes.  */\n \tfor (friends = &DECL_BEFRIENDING_CLASSES (r);"}, {"sha": "74cb23fe2fb9322f6ee3b33cbf209318322b1b3d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c43e95f8f5f67265f05633813f3950624bb4064b", "patch": "@@ -1,3 +1,9 @@\n+2005-09-27  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/22147\n+\t* g++.dg/template/friend37.C: New test.\n+\t* g++.dg/parse/crash28.C: Adjust error markers.\n+\t\n 2005-09-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR fortran/18518"}, {"sha": "bc491655768541770335ecb985a8d660a0da4ad0", "filename": "gcc/testsuite/g++.dg/parse/crash28.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash28.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash28.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash28.C?ref=c43e95f8f5f67265f05633813f3950624bb4064b", "patch": "@@ -6,9 +6,9 @@\n //        Volker Reichelt <reichelt@gcc.gnu.org>\n \n template <class _Tp> class insert_iterator<slist<_Tp> > {}; // { dg-error \"not a template|not declared in this scope|expected unqualified-id|extra\" }\n-template <class _Value> class insert_iterator<int > { // { dg-error \"template parameters not used|_Value\" }\n+template <class _Value> class insert_iterator<int > { // { dg-error \"template\" }\n   hash_set<_Value>; // { dg-error \"no type|expected\" }\n };\n \n template<int> struct A<X<> > {}; // { dg-error \"not a template|not declared in this scope|expected unqualified-id|extra\" }\n-struct A {}; // { dg-error \"template argument required\" }\n+struct A {};"}, {"sha": "7c868290660dccc1a27acc0538efb9f6a1a8c836", "filename": "gcc/testsuite/g++.dg/template/friend37.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend37.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c43e95f8f5f67265f05633813f3950624bb4064b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend37.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffriend37.C?ref=c43e95f8f5f67265f05633813f3950624bb4064b", "patch": "@@ -0,0 +1,15 @@\n+// PR c++/22147\n+\n+template<typename> struct A;\n+\n+template<typename T> void foo(A<T>* p) { *p; }\n+\n+template<typename> struct A\n+{\n+  friend void foo<class X>(A<X>*);\n+};\n+\n+void bar()\n+{\n+  foo<int>(0);\n+}"}]}