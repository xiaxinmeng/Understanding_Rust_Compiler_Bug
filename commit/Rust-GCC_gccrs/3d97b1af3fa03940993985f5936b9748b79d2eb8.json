{"sha": "3d97b1af3fa03940993985f5936b9748b79d2eb8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2Q5N2IxYWYzZmEwMzk0MDk5Mzk4NWY1OTM2Yjk3NDhiNzlkMmViOA==", "commit": {"author": {"name": "Francois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-08-05T10:18:38Z"}, "committer": {"name": "Fran\u00e7ois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-08-05T10:18:38Z"}, "message": "re PR fortran/32979 (Implement vendor-specific ISNAN() intrinsic function)\n\n        PR fortran/32979\n\n        * intrinsic.h (gfc_check_isnan): Add prototype.\n        * gfortran.h (gfc_isym_id): Add GFC_ISYM_ISNAN.\n        * intrinsic.c (add_functions): Add ISNAN intrinsic.\n        * check.c (gfc_check_isnan): New function.\n        * trans-intrinsic.c (gfc_conv_intrinsic_isnan): New function.\n        (gfc_conv_intrinsic_function): Call gfc_conv_intrinsic_isnan\n        to translate ISNAN.\n        * intrinsic.texi: Document ISNAN.\n\n        * gfortran.dg/isnan_1.f90: New test.\n\nCo-Authored-By: Tobias Burnus <burnus@gcc.gnu.org>\n\nFrom-SVN: r127224", "tree": {"sha": "8fbc4df09bb7056308d0cdaf08f97a757f42143a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8fbc4df09bb7056308d0cdaf08f97a757f42143a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d97b1af3fa03940993985f5936b9748b79d2eb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d97b1af3fa03940993985f5936b9748b79d2eb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d97b1af3fa03940993985f5936b9748b79d2eb8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d97b1af3fa03940993985f5936b9748b79d2eb8/comments", "author": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "517d76faeff9ae24c5c0dc6b87ffe3868c038d29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/517d76faeff9ae24c5c0dc6b87ffe3868c038d29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/517d76faeff9ae24c5c0dc6b87ffe3868c038d29"}], "stats": {"total": 113, "additions": 113, "deletions": 0}, "files": [{"sha": "618242411875aebac6af9b0461292b182651bf7b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -1,3 +1,16 @@\n+2007-08-05  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\t    Tobias Burnus  <burnus@gcc.gnu.org>\n+\n+\tPR fortran/32979\n+\t* intrinsic.h (gfc_check_isnan): Add prototype.\n+\t* gfortran.h (gfc_isym_id): Add GFC_ISYM_ISNAN.\n+\t* intrinsic.c (add_functions): Add ISNAN intrinsic.\n+\t* check.c (gfc_check_isnan): New function.\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_isnan): New function.\n+\t(gfc_conv_intrinsic_function): Call gfc_conv_intrinsic_isnan\n+\tto translate ISNAN.\n+\t* intrinsic.texi: Document ISNAN.\n+\n 2007-08-04  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/31214"}, {"sha": "e792773f9281a7a6a907ace5e48a15738f5123f9", "filename": "gcc/fortran/check.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fcheck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fcheck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.c?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -3303,6 +3303,16 @@ gfc_check_isatty (gfc_expr *unit)\n }\n \n \n+try\n+gfc_check_isnan (gfc_expr *x)\n+{\n+  if (type_check (x, 0, BT_REAL) == FAILURE)\n+    return FAILURE;\n+\n+  return SUCCESS;\n+}\n+\n+\n try\n gfc_check_perror (gfc_expr *string)\n {"}, {"sha": "dd1647dcfbf1ecc8e5b63bc18afcc1f2c3600f98", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -422,6 +422,7 @@ enum gfc_isym_id\n   GFC_ISYM_IOR,\n   GFC_ISYM_IRAND,\n   GFC_ISYM_ISATTY,\n+  GFC_ISYM_ISNAN,\n   GFC_ISYM_ISHFT,\n   GFC_ISYM_ISHFTC,\n   GFC_ISYM_ITIME,"}, {"sha": "e175dd678b95c7df53aa8b6c2ecd5d9745d70188", "filename": "gcc/fortran/intrinsic.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fintrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fintrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.c?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -1617,6 +1617,12 @@ add_functions (void)\n \n   make_generic (\"isatty\", GFC_ISYM_ISATTY, GFC_STD_GNU);\n \n+  add_sym_1 (\"isnan\", GFC_ISYM_ISNAN, CLASS_ELEMENTAL, ACTUAL_NO, BT_LOGICAL,\n+\t     dl, GFC_STD_GNU, gfc_check_isnan, NULL, NULL,\n+\t     x, BT_REAL, 0, REQUIRED);\n+\n+  make_generic (\"isnan\", GFC_ISYM_ISNAN, GFC_STD_GNU);\n+\n   add_sym_2 (\"rshift\", GFC_ISYM_RSHIFT, CLASS_ELEMENTAL, ACTUAL_NO, BT_INTEGER, di, GFC_STD_GNU,\n \t     gfc_check_ishft, NULL, gfc_resolve_rshift,\n \t     i, BT_INTEGER, di, REQUIRED, sh, BT_INTEGER, di, REQUIRED);"}, {"sha": "c8548d14bdf0afb0100a291816af9e08c8873e85", "filename": "gcc/fortran/intrinsic.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fintrinsic.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fintrinsic.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.h?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -78,6 +78,7 @@ try gfc_check_intconv (gfc_expr *);\n try gfc_check_ior (gfc_expr *, gfc_expr *);\n try gfc_check_irand (gfc_expr *);\n try gfc_check_isatty (gfc_expr *);\n+try gfc_check_isnan (gfc_expr *);\n try gfc_check_ishft (gfc_expr *, gfc_expr *);\n try gfc_check_ishftc (gfc_expr *, gfc_expr *, gfc_expr *);\n try gfc_check_kill (gfc_expr *, gfc_expr *);"}, {"sha": "8b9f9c2cb01b759075214f5c490820a325c6ee5c", "filename": "gcc/fortran/intrinsic.texi", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fintrinsic.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Fintrinsic.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.texi?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -154,6 +154,7 @@ Some basic guidelines for editing this document:\n * @code{ISATTY}:        ISATTY,    Whether a unit is a terminal device\n * @code{ISHFT}:         ISHFT,     Shift bits\n * @code{ISHFTC}:        ISHFTC,    Shift bits circularly\n+* @code{ISNAN}:         ISNAN,     Tests for a NaN\n * @code{ITIME}:         ITIME,     Current local time (hour/minutes/seconds)\n * @code{KILL}:          KILL,      Send a signal to a process\n * @code{KIND}:          KIND,      Kind of an entity\n@@ -5927,6 +5928,48 @@ The return value is of type @code{INTEGER(*)} and of the same kind as\n \n \n \n+@node ISNAN\n+@section @code{ISNAN} --- Test for a NaN\n+@fnindex ISNAN\n+@cindex IEEE, ISNAN\n+\n+@table @asis\n+@item @emph{Description}:\n+@code{ISNAN} tests whether a floating-point value is an IEEE\n+Not-a-Number (NaN).\n+@item @emph{Standard}:\n+GNU extension\n+\n+@item @emph{Class}:\n+Elemental function\n+\n+@item @emph{Syntax}:\n+@code{ISNAN(X)}\n+\n+@item @emph{Arguments}:\n+@multitable @columnfractions .15 .70\n+@item @var{X} @tab Variable of the type @code{REAL}.\n+\n+@end multitable\n+\n+@item @emph{Return value}:\n+Returns a default-kind @code{LOGICAL}. The returned value is @code{TRUE}\n+if @var{X} is a NaN and @code{FALSE} otherwise.\n+\n+@item @emph{Example}:\n+@smallexample\n+program test_nan\n+  implicit none\n+  real :: x\n+  x = -1.0\n+  x = sqrt(x)\n+  if (isnan(x)) stop '\"x\" is a NaN'\n+end program test_nan\n+@end smallexample\n+@end table\n+\n+\n+\n @node ITIME\n @section @code{ITIME} --- Get current local time subroutine (hour/minutes/seconds) \n @fnindex ITIME"}, {"sha": "dcdc3c7be41ffadd9b717e7a0ef3246543fef4ba", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -2765,6 +2765,18 @@ gfc_conv_intrinsic_ichar (gfc_se * se, gfc_expr * expr)\n }\n \n \n+/* Intrinsic ISNAN calls __builtin_isnan.  */\n+\n+static void\n+gfc_conv_intrinsic_isnan (gfc_se * se, gfc_expr * expr)\n+{\n+  tree arg;\n+\n+  gfc_conv_intrinsic_function_args (se, expr, &arg, 1);\n+  se->expr = build_call_expr (built_in_decls[BUILT_IN_ISNAN], 1, arg);\n+  se->expr = fold_convert (gfc_typenode_for_spec (&expr->ts), se->expr);\n+}\n+\n /* MERGE (tsource, fsource, mask) = mask ? tsource : fsource.  */\n \n static void\n@@ -3987,6 +3999,10 @@ gfc_conv_intrinsic_function (gfc_se * se, gfc_expr * expr)\n       gfc_conv_intrinsic_bitop (se, expr, BIT_IOR_EXPR);\n       break;\n \n+    case GFC_ISYM_ISNAN:\n+      gfc_conv_intrinsic_isnan (se, expr);\n+      break;\n+\n     case GFC_ISYM_LSHIFT:\n       gfc_conv_intrinsic_rlshift (se, expr, 0);\n       break;"}, {"sha": "f32d54a7f5f0f4071982a563e3b97afa30da741c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -1,3 +1,8 @@\n+2007-08-05  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/32979\n+\t* gfortran.dg/isnan_1.f90: New test.\n+\n 2007-08-05  Vladimir Yanovsky  <yanov@il.ibm.com>\n             Revital Eres <eres@il.ibm.com>\n "}, {"sha": "fc0a3d0d873324ed18f2478a95fe4b38d8fc196c", "filename": "gcc/testsuite/gfortran.dg/isnan_1.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ftestsuite%2Fgfortran.dg%2Fisnan_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d97b1af3fa03940993985f5936b9748b79d2eb8/gcc%2Ftestsuite%2Fgfortran.dg%2Fisnan_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fisnan_1.f90?ref=3d97b1af3fa03940993985f5936b9748b79d2eb8", "patch": "@@ -0,0 +1,18 @@\n+! Test for the ISNAN intrinsic\n+!\n+! { dg-do run }\n+  implicit none\n+  real :: x\n+  x = -1.0\n+  x = sqrt(x)\n+  if (.not. isnan(x)) call abort\n+  x = 0.0\n+  x = x / x\n+  if (.not. isnan(x)) call abort\n+\n+  x = 5.0\n+  if (isnan(x)) call abort\n+  x = huge(x)\n+  x = 2*x\n+  if (isnan(x)) call abort\n+end"}]}