{"sha": "d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDFmZmJkNDNlODhiNzQ1NjNkOGJkZWIxNTQ1MWY5ZjBkOTZhMzI4Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-12-21T19:17:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-12-21T19:17:13Z"}, "message": "re PR middle-end/85594 (ICE during expand when compiling with -fwrapv -fopenmp)\n\n\tPR middle-end/85594\n\tPR middle-end/88553\n\t* omp-expand.c (extract_omp_for_update_vars): Regimplify the condition\n\tif needed.\n\t(expand_omp_for_generic): Don't clobber t temporary for ordered loops.\n\n\t* gcc.dg/gomp/pr85594.c: New test.\n\t* gcc.dg/gomp/pr88553.c: New test.\n\nFrom-SVN: r267339", "tree": {"sha": "e92f7fc2d860387d7fdd0add4dd5282e0ffe9e5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e92f7fc2d860387d7fdd0add4dd5282e0ffe9e5f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ffdcdc0b5a529a830cbde79e921960b27d69652e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffdcdc0b5a529a830cbde79e921960b27d69652e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ffdcdc0b5a529a830cbde79e921960b27d69652e"}], "stats": {"total": 45, "additions": 38, "deletions": 7}, "files": [{"sha": "2db37e78c757f07156ca2244d38513a8631d976c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "patch": "@@ -1,3 +1,11 @@\n+2018-12-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/85594\n+\tPR middle-end/88553\n+\t* omp-expand.c (extract_omp_for_update_vars): Regimplify the condition\n+\tif needed.\n+\t(expand_omp_for_generic): Don't clobber t temporary for ordered loops.\n+\n 2018-12-15  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR ipa/88561"}, {"sha": "b5cb4241508ecd9471a892794f2e6c815b6b7340", "filename": "gcc/omp-expand.c", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Fomp-expand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Fomp-expand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-expand.c?ref=d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "patch": "@@ -2076,6 +2076,11 @@ extract_omp_for_update_vars (struct omp_for_data *fd, basic_block cont_bb,\n \t  t = fold_build2 (fd->loops[i].cond_code, boolean_type_node, v, t);\n \t  stmt = gimple_build_cond_empty (t);\n \t  gsi_insert_after (&gsi, stmt, GSI_CONTINUE_LINKING);\n+\t  if (walk_tree (gimple_cond_lhs_ptr (as_a <gcond *> (stmt)),\n+\t\t\t expand_omp_regimplify_p, NULL, NULL)\n+\t      || walk_tree (gimple_cond_rhs_ptr (as_a <gcond *> (stmt)),\n+\t\t\t    expand_omp_regimplify_p, NULL, NULL))\n+\t    gimple_regimplify_operands (stmt, &gsi);\n \t  e = make_edge (bb, body_bb, EDGE_TRUE_VALUE);\n \t  e->probability = profile_probability::guessed_always ().apply_scale (7, 8);\n \t}\n@@ -3209,20 +3214,21 @@ expand_omp_for_generic (struct omp_region *region,\n \n \t  if (fd->ordered && counts[fd->collapse - 1] == NULL_TREE)\n \t    {\n+\t      tree tem;\n \t      if (fd->collapse > 1)\n-\t\tt = fd->loop.v;\n+\t\ttem = fd->loop.v;\n \t      else\n \t\t{\n-\t\t  t = fold_build2 (MINUS_EXPR, TREE_TYPE (fd->loops[0].v),\n-\t\t\t\t   fd->loops[0].v, fd->loops[0].n1);\n-\t\t  t = fold_convert (fd->iter_type, t);\n+\t\t  tem = fold_build2 (MINUS_EXPR, TREE_TYPE (fd->loops[0].v),\n+\t\t\t\t     fd->loops[0].v, fd->loops[0].n1);\n+\t\t  tem = fold_convert (fd->iter_type, tem);\n \t\t}\n \t      tree aref = build4 (ARRAY_REF, fd->iter_type,\n \t\t\t\t  counts[fd->ordered], size_zero_node,\n \t\t\t\t  NULL_TREE, NULL_TREE);\n-\t      t = force_gimple_operand_gsi (&gsi, t, true, NULL_TREE,\n-\t\t\t\t\t    true, GSI_SAME_STMT);\n-\t      expand_omp_build_assign (&gsi, aref, t);\n+\t      tem = force_gimple_operand_gsi (&gsi, tem, true, NULL_TREE,\n+\t\t\t\t\t      true, GSI_SAME_STMT);\n+\t      expand_omp_build_assign (&gsi, aref, tem);\n \t    }\n \n \t  t = build2 (fd->loop.cond_code, boolean_type_node,"}, {"sha": "e5928ecec61d14f6ad2002b1f37406da369b7d34", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "patch": "@@ -1,3 +1,10 @@\n+2018-12-21  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/85594\n+\tPR middle-end/88553\n+\t* gcc.dg/gomp/pr85594.c: New test.\n+\t* gcc.dg/gomp/pr88553.c: New test.\n+\n 2018-12-15  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR ipa/88561"}, {"sha": "5577a33eb18453c1557b2e0afcc938571163d6aa", "filename": "gcc/testsuite/gcc.dg/gomp/pr85594.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr85594.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr85594.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr85594.c?ref=d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "patch": "@@ -0,0 +1,5 @@\n+/* PR middle-end/85594 */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-fwrapv\" } */\n+\n+#include \"pr81768-2.c\""}, {"sha": "6252defef9bc8ddda26d0669e53bac66535da99d", "filename": "gcc/testsuite/gcc.dg/gomp/pr88553.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr88553.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1ffbd43e88b74563d8bdeb15451f9f0d96a328c/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr88553.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr88553.c?ref=d1ffbd43e88b74563d8bdeb15451f9f0d96a328c", "patch": "@@ -0,0 +1,5 @@\n+/* PR middle-end/88553 */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-O1 -ftree-loop-vectorize -fwrapv\" } */\n+\n+#include \"pr81768-2.c\""}]}