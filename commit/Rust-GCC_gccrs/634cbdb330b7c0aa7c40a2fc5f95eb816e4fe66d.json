{"sha": "634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM0Y2JkYjMzMGI3YzBhYTdjNDBhMmZjNWY5NWViODE2ZTRmZTY2ZA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-07-09T09:50:10Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-07-09T09:50:10Z"}, "message": "mn10300-protos.h (mn10300_va_arg): Remove.\n\n        * config/mn10300/mn10300-protos.h (mn10300_va_arg): Remove.\n        * config/mn10300/mn10300.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n        (mn10300_gimplify_va_arg_expr): Rewrite from mn10300_va_arg.\n        * config/mn10300/mn10300.h (EXPAND_BUILTIN_VA_ARG): Remove.\n\nFrom-SVN: r84353", "tree": {"sha": "4fc3a4bfbfd38dd7a624e4f02488b766ef059f72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4fc3a4bfbfd38dd7a624e4f02488b766ef059f72"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/comments", "author": null, "committer": null, "parents": [{"sha": "854f240ee0246d13c0a471a1919003b462bde00b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/854f240ee0246d13c0a471a1919003b462bde00b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/854f240ee0246d13c0a471a1919003b462bde00b"}], "stats": {"total": 56, "additions": 15, "deletions": 41}, "files": [{"sha": "0d86377c70fb44ffecc17600bd99ce3c65118b8b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "patch": "@@ -1,3 +1,10 @@\n+2004-07-09  Richard Henderson  <rth@redhat.com>\n+\n+\t* config/mn10300/mn10300-protos.h (mn10300_va_arg): Remove.\n+\t* config/mn10300/mn10300.c (TARGET_GIMPLIFY_VA_ARG_EXPR): New.\n+\t(mn10300_gimplify_va_arg_expr): Rewrite from mn10300_va_arg.\n+\t* config/mn10300/mn10300.h (EXPAND_BUILTIN_VA_ARG): Remove.\n+\n 2004-07-09  Eric Botcazou  <ebotcazou@libertysurf.fr>\n \n \t* config/sparc/sparc.md (return): Rewrite length formula."}, {"sha": "3767115a416a072ee179748f2e48b296ef2e691c", "filename": "gcc/config/mn10300/mn10300-protos.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2Fconfig%2Fmn10300%2Fmn10300-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2Fconfig%2Fmn10300%2Fmn10300-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmn10300%2Fmn10300-protos.h?ref=634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "patch": "@@ -52,7 +52,6 @@ extern struct rtx_def *function_arg (CUMULATIVE_ARGS *,\n \t\t\t\t     enum machine_mode, tree, int);\n extern int function_arg_partial_nregs (CUMULATIVE_ARGS *,\n \t\t\t\t       enum machine_mode, tree, int);\n-extern struct rtx_def *mn10300_va_arg (tree, tree);\n #endif /* TREE_CODE */\n \n extern void expand_prologue (void);"}, {"sha": "22fc6794b855d060302857dd8b50b121f77a931b", "filename": "gcc/config/mn10300/mn10300.c", "status": "modified", "additions": 8, "deletions": 33, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2Fconfig%2Fmn10300%2Fmn10300.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2Fconfig%2Fmn10300%2Fmn10300.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmn10300%2Fmn10300.c?ref=634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "patch": "@@ -71,7 +71,7 @@ static bool mn10300_rtx_costs (rtx, int, int, int *);\n static void mn10300_file_start (void);\n static bool mn10300_return_in_memory (tree, tree);\n static rtx mn10300_builtin_saveregs (void);\n-\n+static tree mn10300_gimplify_va_arg_expr (tree, tree, tree *, tree *);\n \f\n /* Initialize the GCC target structure.  */\n #undef TARGET_ASM_ALIGNED_HI_OP\n@@ -98,6 +98,8 @@ static rtx mn10300_builtin_saveregs (void);\n \n #undef TARGET_EXPAND_BUILTIN_SAVEREGS\n #define TARGET_EXPAND_BUILTIN_SAVEREGS mn10300_builtin_saveregs\n+#undef TARGET_GIMPLIFY_VA_ARG_EXPR\n+#define TARGET_GIMPLIFY_VA_ARG_EXPR mn10300_gimplify_va_arg_expr\n \n static void mn10300_encode_section_info (tree, rtx, int);\n struct gcc_target targetm = TARGET_INITIALIZER;\n@@ -1457,40 +1459,13 @@ mn10300_va_start (tree valist, rtx nextarg)\n   std_expand_builtin_va_start (valist, nextarg);\n }\n \n-rtx\n-mn10300_va_arg (tree valist, tree type)\n+static tree\n+mn10300_gimplify_va_arg_expr (tree valist, tree type, tree *pre_p, tree *post_p)\n {\n-  HOST_WIDE_INT align, rsize;\n-  tree t, ptr, pptr;\n-\n-  /* Compute the rounded size of the type.  */\n-  align = PARM_BOUNDARY / BITS_PER_UNIT;\n-  rsize = (((int_size_in_bytes (type) + align - 1) / align) * align);\n-\n-  t = build (POSTINCREMENT_EXPR, TREE_TYPE (valist), valist, \n-\t     build_int_2 ((rsize > 8 ? 4 : rsize), 0));\n-  TREE_SIDE_EFFECTS (t) = 1;\n-\n-  ptr = build_pointer_type (type);\n-\n-  /* \"Large\" types are passed by reference.  */\n-  if (rsize > 8)\n-    {\n-      pptr = build_pointer_type (ptr);\n-      t = build1 (NOP_EXPR, pptr, t);\n-      TREE_SIDE_EFFECTS (t) = 1;\n-\n-      t = build1 (INDIRECT_REF, ptr, t);\n-      TREE_SIDE_EFFECTS (t) = 1;\n-    }\n+  if (FUNCTION_ARG_PASS_BY_REFERENCE (dummy, TYPE_MODE (type), type, dummy))\n+    return ind_gimplify_va_arg_expr (valist, type, pre_p, post_p);\n   else\n-    {\n-      t = build1 (NOP_EXPR, ptr, t);\n-      TREE_SIDE_EFFECTS (t) = 1;\n-    }\n-\n-  /* Calculate!  */\n-  return expand_expr (t, NULL_RTX, Pmode, EXPAND_NORMAL);\n+    return std_gimplify_va_arg_expr (valist, type, pre_p, post_p);\n }\n \n /* Return an RTX to represent where a value with mode MODE will be returned"}, {"sha": "e831e28035a92bfa93eaf1fea94f0f2e7c2b1659", "filename": "gcc/config/mn10300/mn10300.h", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2Fconfig%2Fmn10300%2Fmn10300.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d/gcc%2Fconfig%2Fmn10300%2Fmn10300.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmn10300%2Fmn10300.h?ref=634cbdb330b7c0aa7c40a2fc5f95eb816e4fe66d", "patch": "@@ -697,13 +697,6 @@ struct cum_arg {int nbytes; };\n /* Implement `va_start' for varargs and stdarg.  */\n #define EXPAND_BUILTIN_VA_START(valist, nextarg) \\\n   mn10300_va_start (valist, nextarg)\n-\n-/* Implement `va_arg'.  */\n-#define EXPAND_BUILTIN_VA_ARG(valist, type) \\\n-  mn10300_va_arg (valist, type)\n-\n-/* Addressing modes, and classification of registers for them.  */\n-\n \f\n /* 1 if X is an rtx for a constant that is a valid address.  */\n "}]}