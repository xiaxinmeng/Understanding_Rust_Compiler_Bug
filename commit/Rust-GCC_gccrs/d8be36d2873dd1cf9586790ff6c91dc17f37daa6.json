{"sha": "d8be36d2873dd1cf9586790ff6c91dc17f37daa6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDhiZTM2ZDI4NzNkZDFjZjk1ODY3OTBmZjZjOTFkYzE3ZjM3ZGFhNg==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2019-07-04T08:05:27Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-04T08:05:27Z"}, "message": "[Ada] Keep assertions in internal units enabled for GNATprove\n\nIn GNATprove mode the assertion policy is now always enabled, even when\nanalysing internal units. Otherwise, assertion expressions (e.g.\nDefault_Initial_Condition) in internal units (e.g. Ada.Text_IO)\ndisappear in the semantic analysis phase of the frontend and the\nGNATprove backend can't see them.\n\nNo frontend test provided, because only the GNATprove backend is\naffected (and there appear to be no difference in the output with -gnatG\nswitch, because the expansion of Default_Initial_Condition is not\nattached to the AST).\n\n2019-07-04  Piotr Trojanek  <trojanek@adacore.com>\n\ngcc/ada/\n\n\t* opt.adb (Set_Config_Switches): Keep assertions policy as\n\tenabled when analysing internal units in GNATprove mode.\n\nFrom-SVN: r273048", "tree": {"sha": "a214c57ccdb62bcbd45ac510a4760f3b80687ef3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a214c57ccdb62bcbd45ac510a4760f3b80687ef3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8be36d2873dd1cf9586790ff6c91dc17f37daa6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8be36d2873dd1cf9586790ff6c91dc17f37daa6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8be36d2873dd1cf9586790ff6c91dc17f37daa6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8be36d2873dd1cf9586790ff6c91dc17f37daa6/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a0766a8258f014ac2715d8c49fcaf83b3eb62a00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0766a8258f014ac2715d8c49fcaf83b3eb62a00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0766a8258f014ac2715d8c49fcaf83b3eb62a00"}], "stats": {"total": 13, "additions": 12, "deletions": 1}, "files": [{"sha": "ea1d75df7e01a1e922d4f97708dfbb71fbe2565c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8be36d2873dd1cf9586790ff6c91dc17f37daa6/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8be36d2873dd1cf9586790ff6c91dc17f37daa6/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=d8be36d2873dd1cf9586790ff6c91dc17f37daa6", "patch": "@@ -1,3 +1,8 @@\n+2019-07-04  Piotr Trojanek  <trojanek@adacore.com>\n+\n+\t* opt.adb (Set_Config_Switches): Keep assertions policy as\n+\tenabled when analysing internal units in GNATprove mode.\n+\n 2019-07-04  Arnaud Charlet  <charlet@adacore.com>\n \n \t* exp_ch4.adb (Expand_Short_Circuit_Operator): Strip"}, {"sha": "05f9059eaa0de64b5e9946ca32af23a752ffe5c1", "filename": "gcc/ada/opt.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8be36d2873dd1cf9586790ff6c91dc17f37daa6/gcc%2Fada%2Fopt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8be36d2873dd1cf9586790ff6c91dc17f37daa6/gcc%2Fada%2Fopt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.adb?ref=d8be36d2873dd1cf9586790ff6c91dc17f37daa6", "patch": "@@ -248,7 +248,13 @@ package body Opt is\n             SPARK_Mode_Pragma        := SPARK_Mode_Pragma_Config;\n \n          else\n-            if GNAT_Mode_Config then\n+            --  In GNATprove mode assertions should be always enabled, even\n+            --  when analysing internal units.\n+\n+            if GNATprove_Mode then\n+               pragma Assert (Assertions_Enabled);\n+               null;\n+            elsif GNAT_Mode_Config then\n                Assertions_Enabled    := Assertions_Enabled_Config;\n             else\n                Assertions_Enabled    := False;"}]}