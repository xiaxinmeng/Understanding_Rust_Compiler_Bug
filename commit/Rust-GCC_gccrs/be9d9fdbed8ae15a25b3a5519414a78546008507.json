{"sha": "be9d9fdbed8ae15a25b3a5519414a78546008507", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmU5ZDlmZGJlZDhhZTE1YTI1YjNhNTUxOTQxNGE3ODU0NjAwODUwNw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-01-18T11:30:56Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-01-18T11:30:56Z"}, "message": "Describe better version mismatch in libgcov driver.\n\n2019-01-18  Martin Liska  <mliska@suse.cz>\n\n\t* libgcov-driver.c (gcov_version_string): New function.\n\t(gcov_version): Convert version integer into string.\n\nFrom-SVN: r268069", "tree": {"sha": "aae7e26933a4ff527dc3202b8e65aed6f3270eb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aae7e26933a4ff527dc3202b8e65aed6f3270eb0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/be9d9fdbed8ae15a25b3a5519414a78546008507", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be9d9fdbed8ae15a25b3a5519414a78546008507", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be9d9fdbed8ae15a25b3a5519414a78546008507", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be9d9fdbed8ae15a25b3a5519414a78546008507/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cd0b2d361df82c848dc7e1c3078651bb0624c3c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd0b2d361df82c848dc7e1c3078651bb0624c3c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd0b2d361df82c848dc7e1c3078651bb0624c3c6"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "055836fb2b075782277791bd8b5080fc90d7577f", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be9d9fdbed8ae15a25b3a5519414a78546008507/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be9d9fdbed8ae15a25b3a5519414a78546008507/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=be9d9fdbed8ae15a25b3a5519414a78546008507", "patch": "@@ -1,3 +1,8 @@\n+2019-01-18  Martin Liska  <mliska@suse.cz>\n+\n+\t* libgcov-driver.c (gcov_version_string): New function.\n+\t(gcov_version): Convert version integer into string.\n+\n 2019-01-17  Andrew Stubbs  <ams@codesourcery.com>\n \t    Kwok Cheung Yeung  <kcy@codesourcery.com>\n \t    Julian Brown  <julian@codesourcery.com>"}, {"sha": "41d28ace92658c4d81914d6f6d635b6366d254ef", "filename": "libgcc/libgcov-driver.c", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be9d9fdbed8ae15a25b3a5519414a78546008507/libgcc%2Flibgcov-driver.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be9d9fdbed8ae15a25b3a5519414a78546008507/libgcc%2Flibgcov-driver.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Flibgcov-driver.c?ref=be9d9fdbed8ae15a25b3a5519414a78546008507", "patch": "@@ -157,6 +157,27 @@ buffer_fn_data (const char *filename, const struct gcov_info *gi_ptr,\n   return (struct gcov_fn_buffer **)free_fn_data (gi_ptr, fn_buffer, ix);\n }\n \n+/* Convert VERSION into a string description and return the it.\n+   BUFFER is used for storage of the string.  The code should be\n+   aligned wit gcov-iov.c.  */\n+\n+static char *\n+gcov_version_string (char *buffer, char version[4])\n+{\n+  if (version[0] < 'A' || version[0] > 'Z'\n+      || version[1] < '0' || version[1] > '9'\n+      || version[2] < '0' || version[2] > '9')\n+    sprintf (buffer, \"(unknown)\");\n+  else\n+    {\n+      unsigned major = 10 * (version[0] - 'A') + (version[1] - '0');\n+      unsigned minor = version[2] - '0';\n+      sprintf (buffer, \"%u.%u (%s)\", major, minor,\n+\t       version[3] == '*' ? \"release\" : \"experimental\");\n+    }\n+  return buffer;\n+}\n+\n /* Check if VERSION of the info block PTR matches libgcov one.\n    Return 1 on success, or zero in case of versions mismatch.\n    If FILENAME is not NULL, its value used for reporting purposes\n@@ -169,12 +190,16 @@ gcov_version (struct gcov_info *ptr, gcov_unsigned_t version,\n   if (version != GCOV_VERSION)\n     {\n       char v[4], e[4];\n+      char version_string[128], expected_string[128];\n \n       GCOV_UNSIGNED2STRING (v, version);\n       GCOV_UNSIGNED2STRING (e, GCOV_VERSION);\n \n-      gcov_error (\"profiling:%s:Version mismatch - expected %.4s got %.4s\\n\",\n-                  filename? filename : ptr->filename, e, v);\n+      gcov_error (\"profiling:%s:Version mismatch - expected %s (%.4s) \"\n+\t\t  \"got %s (%.4s)\\n\",\n+\t\t  filename? filename : ptr->filename,\n+\t\t  gcov_version_string (expected_string, e), e,\n+\t\t  gcov_version_string (version_string, v), v);\n       return 0;\n     }\n   return 1;"}]}