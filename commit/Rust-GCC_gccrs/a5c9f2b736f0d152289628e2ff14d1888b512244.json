{"sha": "a5c9f2b736f0d152289628e2ff14d1888b512244", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTVjOWYyYjczNmYwZDE1MjI4OTYyOGUyZmYxNGQxODg4YjUxMjI0NA==", "commit": {"author": {"name": "Trevor Saunders", "email": "tbsaunde+gcc@tbsaunde.org", "date": "2017-05-14T00:38:35Z"}, "committer": {"name": "Trevor Saunders", "email": "tbsaunde@gcc.gnu.org", "date": "2017-05-14T00:38:35Z"}, "message": "allow constructing a auto_vec with a preallocation, and a possibly larger actual allocation size\n\nThis allows us to set the capacity of the vector when we construct it,\nand still use a stack buffer when the size is small enough.\n\ngcc/ChangeLog:\n\n2017-05-13  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n\n\t* genrecog.c (int_set::int_set): Explicitly construct our\n\tauto_vec base class.\n\t* vec.h (auto_vec::auto_vec): New constructor.\n\nFrom-SVN: r248019", "tree": {"sha": "0234dc61e7e025e37e28cf53905d52df3be73340", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0234dc61e7e025e37e28cf53905d52df3be73340"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a5c9f2b736f0d152289628e2ff14d1888b512244", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5c9f2b736f0d152289628e2ff14d1888b512244", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5c9f2b736f0d152289628e2ff14d1888b512244", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5c9f2b736f0d152289628e2ff14d1888b512244/comments", "author": null, "committer": null, "parents": [{"sha": "4b5c84f497a052cdba704492d4a4a46e21264779", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b5c84f497a052cdba704492d4a4a46e21264779", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b5c84f497a052cdba704492d4a4a46e21264779"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "1f0c05aa3d4b23f0173eb69167d7f7e87f7041ef", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c9f2b736f0d152289628e2ff14d1888b512244/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c9f2b736f0d152289628e2ff14d1888b512244/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a5c9f2b736f0d152289628e2ff14d1888b512244", "patch": "@@ -1,3 +1,9 @@\n+2017-05-13  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n+\n+\t* genrecog.c (int_set::int_set): Explicitly construct our\n+\tauto_vec base class.\n+\t* vec.h (auto_vec::auto_vec): New constructor.\n+\n 2017-05-13  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n \n \t* bitmap.h (class auto_bitmap): New constructor taking"}, {"sha": "b69043f0d0227616c224540064659ebd41d749da", "filename": "gcc/genrecog.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c9f2b736f0d152289628e2ff14d1888b512244/gcc%2Fgenrecog.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c9f2b736f0d152289628e2ff14d1888b512244/gcc%2Fgenrecog.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgenrecog.c?ref=a5c9f2b736f0d152289628e2ff14d1888b512244", "patch": "@@ -1407,14 +1407,16 @@ struct int_set : public auto_vec <uint64_t, 1>\n   iterator end ();\n };\n \n-int_set::int_set () {}\n+int_set::int_set () : auto_vec<uint64_t, 1> () {}\n \n-int_set::int_set (uint64_t label)\n+int_set::int_set (uint64_t label) :\n+  auto_vec<uint64_t, 1> ()\n {\n   safe_push (label);\n }\n \n-int_set::int_set (const int_set &other)\n+int_set::int_set (const int_set &other) :\n+  auto_vec<uint64_t, 1> ()\n {\n   safe_splice (other);\n }"}, {"sha": "914f89c350c87d95acda70cb2a8475b50929035d", "filename": "gcc/vec.h", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c9f2b736f0d152289628e2ff14d1888b512244/gcc%2Fvec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c9f2b736f0d152289628e2ff14d1888b512244/gcc%2Fvec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvec.h?ref=a5c9f2b736f0d152289628e2ff14d1888b512244", "patch": "@@ -1272,6 +1272,18 @@ class auto_vec : public vec<T, va_heap>\n     this->m_vec = &m_auto;\n   }\n \n+  auto_vec (size_t s)\n+  {\n+    if (s > N)\n+      {\n+\tthis->create (s);\n+\treturn;\n+      }\n+\n+    m_auto.embedded_init (MAX (N, 2), 0, 1);\n+    this->m_vec = &m_auto;\n+  }\n+\n   ~auto_vec ()\n   {\n     this->release ();"}]}