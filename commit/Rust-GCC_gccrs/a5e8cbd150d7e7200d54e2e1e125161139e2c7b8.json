{"sha": "a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTVlOGNiZDE1MGQ3ZTcyMDBkNTRlMmUxZTEyNTE2MTEzOWUyYzdiOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-02-06T20:03:15Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-02-06T20:03:15Z"}, "message": "re PR c++/79372 (ICE on C++ code with illegal decomposition declaration on x86_64-linux-gnu: in tsubst_decomp_names, at cp/pt.c:15599)\n\n\tPR c++/79372\n\t* decl.c (cp_finish_decomp): On error set decl type to error_mark_node.\n\t* pt.c (tsubst_expr): Don't call tsubst_decomp_names on decompositions\n\twith error_mark_node type.\n\n\t* g++.dg/cpp1z/decomp25.C: New test.\n\nFrom-SVN: r245218", "tree": {"sha": "77dc53b736e0bcccd7d0f3a5540ae17b6d0b4996", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77dc53b736e0bcccd7d0f3a5540ae17b6d0b4996"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6f26f15f136506e40bb7a3a4f1cd5ca171322928", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f26f15f136506e40bb7a3a4f1cd5ca171322928", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f26f15f136506e40bb7a3a4f1cd5ca171322928"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "9889c171b017451013d0929d411f583315d78262", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "patch": "@@ -1,3 +1,10 @@\n+2017-02-06  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/79372\n+\t* decl.c (cp_finish_decomp): On error set decl type to error_mark_node.\n+\t* pt.c (tsubst_expr): Don't call tsubst_decomp_names on decompositions\n+\twith error_mark_node type.\n+\n 2017-02-03  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/78689 - ICE on constructor with label"}, {"sha": "d1d485a4fed5585273bd37080a37435fa2adb2eb", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "patch": "@@ -7378,6 +7378,7 @@ cp_finish_decomp (tree decl, tree first, unsigned int count)\n \t    }\n \t  first = DECL_CHAIN (first);\n \t}\n+      TREE_TYPE (decl) = error_mark_node;\n       if (DECL_P (decl) && DECL_NAMESPACE_SCOPE_P (decl))\n \tSET_DECL_ASSEMBLER_NAME (decl, get_identifier (\"<decomp>\"));\n       return;"}, {"sha": "6072432382d51afa304f7a791e57e5cd2098f761", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "patch": "@@ -15765,7 +15765,9 @@ tsubst_expr (tree t, tree args, tsubst_flags_t complain, tree in_decl,\n \t\t      const_init = (DECL_INITIALIZED_BY_CONSTANT_EXPRESSION_P\n \t\t\t\t    (pattern_decl));\n \t\t    cp_finish_decl (decl, init, const_init, NULL_TREE, 0);\n-\t\t    if (VAR_P (decl) && DECL_DECOMPOSITION_P (decl))\n+\t\t    if (VAR_P (decl)\n+\t\t\t&& DECL_DECOMPOSITION_P (decl)\n+\t\t\t&& TREE_TYPE (pattern_decl) != error_mark_node)\n \t\t      {\n \t\t\tunsigned int cnt;\n \t\t\ttree first;"}, {"sha": "954851b961dc34e1b776a920d3b5781fc6423f9d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "patch": "@@ -1,5 +1,8 @@\n 2017-02-06  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/79372\n+\t* g++.dg/cpp1z/decomp25.C: New test.\n+\n \tPR tree-optimization/79284\n \t* gcc.c-torture/compile/pr79284.c: New test.\n "}, {"sha": "c99273613bcab1df702ed63a00ddd1f4862498f5", "filename": "gcc/testsuite/g++.dg/cpp1z/decomp25.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp25.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5e8cbd150d7e7200d54e2e1e125161139e2c7b8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp25.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fdecomp25.C?ref=a5e8cbd150d7e7200d54e2e1e125161139e2c7b8", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/79372\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"\" }\n+\n+template <typename T>\n+struct S\n+{\n+  enum E { A };\n+  void f () { auto [x] = 0; x++; }\t// { dg-error \"cannot decompose non-array non-class type\" }\n+\t\t\t\t\t// { dg-warning \"decomposition declaration only available with\" \"\" { target c++14_down } .-1 }\n+  void g (T t) { auto [y] = t; y++; }\t// { dg-error \"cannot decompose non-array non-class type\" }\n+};\t\t\t\t\t// { dg-warning \"decomposition declaration only available with\" \"\" { target c++14_down } .-1 }\n+\n+int\n+main ()\n+{\n+  S <int> s;\n+  s.f ();\n+  s.g (5);\n+}"}]}