{"sha": "0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGMxNWViZjFiZDBkN2VjODExMWFjZmVjZjcxNTQyYWNhYzQxMTViMQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2019-05-15T18:02:36Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2019-05-15T18:02:36Z"}, "message": "Allow opening file on multiple units\n\nAs of Fortran 2018 it's allowed to open the same file on multiple\nunits.\n\nlibgfortran/ChangeLog:\n\n2019-05-15  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/90461\n        * io/open.c (new_unit): Don't check if the file is already open\n\tfor F2018.\n\ntestsuite/ChangeLog:\n\n2019-05-15  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/90461\n        * gfortran.dg/open_errors_2.f90: Add -std=f2008, adjust line number.\n\t* gfortran.dg/open_errors_3.f90: New test.\n\nFrom-SVN: r271260", "tree": {"sha": "d8d96f02445161f81d85ccf4298ddc0a5f9fa39e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d8d96f02445161f81d85ccf4298ddc0a5f9fa39e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/comments", "author": null, "committer": null, "parents": [{"sha": "40c81f845c6f1c5e6df74442ca59279090ac1e8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40c81f845c6f1c5e6df74442ca59279090ac1e8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40c81f845c6f1c5e6df74442ca59279090ac1e8d"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "ffba7ba33394fe459c501c3447396048b18c59a3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "patch": "@@ -1,3 +1,9 @@\n+2019-05-15  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR fortran/90461\n+        * gfortran.dg/open_errors_2.f90: Add -std=f2008, adjust line number.\n+\t* gfortran.dg/open_errors_3.f90: New test.\n+\n 2019-05-15  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/89021"}, {"sha": "72d63bb3a39f6936e063c4aca974940ffe1f3e6e", "filename": "gcc/testsuite/gfortran.dg/open_errors_2.f90", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_errors_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_errors_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_errors_2.f90?ref=0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "patch": "@@ -1,6 +1,7 @@\n ! { dg-do run }\n+! { dg-options \"-std=f2008\" }\n ! { dg-shouldfail \"runtime error\" }\n-! { dg-output \"At line 13.*File already opened\" }\n+! { dg-output \"At line 14.*File already opened\" }\n \n ! PR 65563 - this used to segfault for some versions.\n   variable_1 = 0"}, {"sha": "da9495610d4593b3c40628199a7f247f07f4e5be", "filename": "gcc/testsuite/gfortran.dg/open_errors_3.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_errors_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_errors_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fopen_errors_3.f90?ref=0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do  run }\n+! PR 90461 Open file on multiple units as of F2018\n+program openmult\n+  implicit none\n+  character(len=*), parameter :: fname=\"pr90461.dat\"\n+  open(10, file=fname, form=\"unformatted\")\n+  open(11, file=fname, form=\"unformatted\")\n+  close(11)\n+  close(10, status=\"delete\")\n+end program openmult\n+! { dg-final { remote_file build delete \"pr90461.dat\" } }"}, {"sha": "4b5194f4406b7b1c0d192257147a41a8fddbd64d", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "patch": "@@ -1,3 +1,9 @@\n+2019-05-15  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR fortran/90461\n+        * io/open.c (new_unit): Don't check if the file is already open\n+\tfor F2018.\n+\n 2019-05-02  Jakub Jelinek  <jakub@redhat.com>\n \n \t* Makefile.am (gfor_cdir): Remove $(MULTISUBDIR)."}, {"sha": "d3bb11f5965113417849cb2c6214c8f6f2d713ef", "filename": "libgfortran/io/open.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/libgfortran%2Fio%2Fopen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0c15ebf1bd0d7ec8111acfecf71542acac4115b1/libgfortran%2Fio%2Fopen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fopen.c?ref=0c15ebf1bd0d7ec8111acfecf71542acac4115b1", "patch": "@@ -515,7 +515,8 @@ new_unit (st_parameter_open *opp, gfc_unit *u, unit_flags *flags)\n      Do not error if opening file preconnected to stdin, stdout, stderr.  */\n \n   u2 = NULL;\n-  if ((opp->common.flags & IOPARM_OPEN_HAS_FILE) != 0)\n+  if ((opp->common.flags & IOPARM_OPEN_HAS_FILE) != 0\n+      && !(compile_options.allow_std & GFC_STD_F2018))\n     u2 = find_file (opp->file, opp->file_len);\n   if (u2 != NULL\n       && (options.stdin_unit < 0 || u2->unit_number != options.stdin_unit)"}]}