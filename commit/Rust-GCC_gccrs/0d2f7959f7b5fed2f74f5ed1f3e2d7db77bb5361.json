{"sha": "0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGQyZjc5NTlmN2I1ZmVkMmY3NGY1ZWQxZjNlMmQ3ZGI3N2JiNTM2MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-04-03T21:42:51Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-04-03T21:42:51Z"}, "message": "re PR tree-optimization/85156 (ICE with -O1 -g: gimplification failed)\n\n\tPR tree-optimization/85156\n\t* builtins.c (fold_builtin_expect): Use save_expr on arg1 to avoid\n\tevaluating the argument multiple times.\n\n\t* c-c++-common/pr85156.c: New test.\n\t* gcc.c-torture/execute/pr85156.c: New test.\n\nFrom-SVN: r259057", "tree": {"sha": "52968a0319c6f87b841240b400e66ef4b54f813a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/52968a0319c6f87b841240b400e66ef4b54f813a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8d0d49f8b457d47539898886e3f94aaee9c572d6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d0d49f8b457d47539898886e3f94aaee9c572d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d0d49f8b457d47539898886e3f94aaee9c572d6"}], "stats": {"total": 45, "additions": 45, "deletions": 0}, "files": [{"sha": "78d14afe1717a6193a47328a6c7879074876fcb0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "patch": "@@ -1,3 +1,9 @@\n+2018-04-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/85156\n+\t* builtins.c (fold_builtin_expect): Use save_expr on arg1 to avoid\n+\tevaluating the argument multiple times.\n+\n 2018-04-03  Bill Schmidt  <wschmidt@linux.ibm.com>\n \n \t* config/rs6000/emmintrin.h (_mm_cvtpd_epi32): Use __vector rather"}, {"sha": "e0f6c2a1c0fd0fffcd5f3959f4af87dd0a77a70b", "filename": "gcc/builtins.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "patch": "@@ -7998,6 +7998,7 @@ fold_builtin_expect (location_t loc, tree arg0, tree arg1, tree arg2)\n     {\n       tree op0 = TREE_OPERAND (inner, 0);\n       tree op1 = TREE_OPERAND (inner, 1);\n+      arg1 = save_expr (arg1);\n \n       op0 = build_builtin_expect_predicate (loc, op0, arg1, arg2);\n       op1 = build_builtin_expect_predicate (loc, op1, arg1, arg2);"}, {"sha": "6d1322cb076d009bb3e78d4949fc7580ead92bdb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "patch": "@@ -1,3 +1,9 @@\n+2018-04-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/85156\n+\t* c-c++-common/pr85156.c: New test.\n+\t* gcc.c-torture/execute/pr85156.c: New test.\n+\n 2018-04-03  Bill Schmidt  <wschmidt@linux.ibm.com>\n \n \t* gcc.target/powerpc/powerpc.exp: Add .C suffix for main loop."}, {"sha": "4f5986ba48b73095b62b7518d1e3e5d16f033ab4", "filename": "gcc/testsuite/c-c++-common/pr85156.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr85156.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr85156.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr85156.c?ref=0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "patch": "@@ -0,0 +1,11 @@\n+/* PR tree-optimization/85156 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -g\" } */\n+\n+int a, b;\n+\n+int\n+foo (void)\n+{\n+  return __builtin_expect (a ? b != 0 : 0, ({ 1; }));\n+}"}, {"sha": "a2968370283080d91a06ab3692410b8104d9a666", "filename": "gcc/testsuite/gcc.c-torture/execute/pr85156.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr85156.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr85156.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr85156.c?ref=0d2f7959f7b5fed2f74f5ed1f3e2d7db77bb5361", "patch": "@@ -0,0 +1,21 @@\n+/* PR tree-optimization/85156 */\n+\n+int x, y;\n+\n+__attribute__((noipa)) int\n+foo (int z)\n+{\n+  if (__builtin_expect (x ? y != 0 : 0, z++))\n+    return 7;\n+  return z;\n+}\n+\n+int\n+main ()\n+{\n+  x = 1;\n+  asm volatile (\"\" : \"+m\" (x), \"+m\" (y));\n+  if (foo (10) != 11)\n+    __builtin_abort ();\n+  return 0;\n+}"}]}