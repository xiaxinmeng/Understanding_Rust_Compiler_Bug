{"sha": "315adedaf3f2072b55095f101d7df04c39d4e3ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzE1YWRlZGFmM2YyMDcyYjU1MDk1ZjEwMWQ3ZGYwNGMzOWQ0ZTNhZQ==", "commit": {"author": {"name": "Michael Matz", "email": "matz@suse.de", "date": "2009-11-27T15:35:50Z"}, "committer": {"name": "Michael Matz", "email": "matz@gcc.gnu.org", "date": "2009-11-27T15:35:50Z"}, "message": "re PR rtl-optimization/42084 (Wrong result with -Os -fno-delete-null-pointer-checks)\n\n        PR rtl-optimization/42084\n        * cfgexpand.c (maybe_cleanup_end_of_block): Add new parameter,\n        use it to stop walking.\n        (expand_gimple_cond): Adjust call to above.\n\ntestsuite/\n        * gcc.dg/pr42084.c: New test.\n\nFrom-SVN: r154709", "tree": {"sha": "75f1e805d2291b932c884eafc2b6f80e724af630", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/75f1e805d2291b932c884eafc2b6f80e724af630"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/315adedaf3f2072b55095f101d7df04c39d4e3ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/315adedaf3f2072b55095f101d7df04c39d4e3ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/315adedaf3f2072b55095f101d7df04c39d4e3ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/315adedaf3f2072b55095f101d7df04c39d4e3ae/comments", "author": {"login": "susematz", "id": 4117296, "node_id": "MDQ6VXNlcjQxMTcyOTY=", "avatar_url": "https://avatars.githubusercontent.com/u/4117296?v=4", "gravatar_id": "", "url": "https://api.github.com/users/susematz", "html_url": "https://github.com/susematz", "followers_url": "https://api.github.com/users/susematz/followers", "following_url": "https://api.github.com/users/susematz/following{/other_user}", "gists_url": "https://api.github.com/users/susematz/gists{/gist_id}", "starred_url": "https://api.github.com/users/susematz/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/susematz/subscriptions", "organizations_url": "https://api.github.com/users/susematz/orgs", "repos_url": "https://api.github.com/users/susematz/repos", "events_url": "https://api.github.com/users/susematz/events{/privacy}", "received_events_url": "https://api.github.com/users/susematz/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "67c330aec42b2b57cf42abc7ceb46865d51cd789", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67c330aec42b2b57cf42abc7ceb46865d51cd789", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67c330aec42b2b57cf42abc7ceb46865d51cd789"}], "stats": {"total": 46, "additions": 40, "deletions": 6}, "files": [{"sha": "8165df587af3744a0ed62a97cd61803268a65d69", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=315adedaf3f2072b55095f101d7df04c39d4e3ae", "patch": "@@ -1,3 +1,10 @@\n+2009-11-27  Michael Matz  <matz@suse.de>\n+\n+\tPR rtl-optimization/42084\n+\t* cfgexpand.c (maybe_cleanup_end_of_block): Add new parameter,\n+\tuse it to stop walking.\n+\t(expand_gimple_cond): Adjust call to above.\n+\n 2009-11-27  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR target/41810"}, {"sha": "95f694855000e39981ad882bec94b3f6341b99a4", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=315adedaf3f2072b55095f101d7df04c39d4e3ae", "patch": "@@ -1586,10 +1586,11 @@ label_rtx_for_bb (basic_block bb ATTRIBUTE_UNUSED)\n \n /* A subroutine of expand_gimple_cond.  Given E, a fallthrough edge\n    of a basic block where we just expanded the conditional at the end,\n-   possibly clean up the CFG and instruction sequence.  */\n+   possibly clean up the CFG and instruction sequence.  LAST is the\n+   last instruction before the just emitted jump sequence.  */\n \n static void\n-maybe_cleanup_end_of_block (edge e)\n+maybe_cleanup_end_of_block (edge e, rtx last)\n {\n   /* Special case: when jumpif decides that the condition is\n      trivial it emits an unconditional jump (and the necessary\n@@ -1604,7 +1605,6 @@ maybe_cleanup_end_of_block (edge e)\n      normally isn't there in a cleaned CFG), fix it here.  */\n   if (BARRIER_P (get_last_insn ()))\n     {\n-      basic_block bb = e->src;\n       rtx insn;\n       remove_edge (e);\n       /* Now, we have a single successor block, if we have insns to\n@@ -1620,7 +1620,7 @@ maybe_cleanup_end_of_block (edge e)\n       /* Make sure we have an unconditional jump.  Otherwise we're\n \t confused.  */\n       gcc_assert (JUMP_P (insn) && !any_condjump_p (insn));\n-      for (insn = PREV_INSN (insn); insn != BB_HEAD (bb);)\n+      for (insn = PREV_INSN (insn); insn != last;)\n \t{\n \t  insn = PREV_INSN (insn);\n \t  if (JUMP_P (NEXT_INSN (insn)))\n@@ -1699,7 +1699,7 @@ expand_gimple_cond (basic_block bb, gimple stmt)\n \t}\n       true_edge->goto_block = NULL;\n       false_edge->flags |= EDGE_FALLTHRU;\n-      maybe_cleanup_end_of_block (false_edge);\n+      maybe_cleanup_end_of_block (false_edge, last);\n       return NULL;\n     }\n   if (true_edge->dest == bb->next_bb)\n@@ -1715,7 +1715,7 @@ expand_gimple_cond (basic_block bb, gimple stmt)\n \t}\n       false_edge->goto_block = NULL;\n       true_edge->flags |= EDGE_FALLTHRU;\n-      maybe_cleanup_end_of_block (true_edge);\n+      maybe_cleanup_end_of_block (true_edge, last);\n       return NULL;\n     }\n "}, {"sha": "d0532ff65563a84cb85d57ffaf9f10dcc3e70c3c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=315adedaf3f2072b55095f101d7df04c39d4e3ae", "patch": "@@ -1,3 +1,8 @@\n+2009-11-27  Michael Matz  <matz@suse.de>\n+\n+\tPR rtl-optimization/42084\n+\t* gcc.dg/pr42084.c: New test.\n+\n 2009-11-27  Michael Matz  <matz@suse.de>\n \n \tPR c++/41906"}, {"sha": "d5aad9642cc00a9099859f891f6c04cb94e4f26b", "filename": "gcc/testsuite/gcc.dg/pr42084.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42084.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/315adedaf3f2072b55095f101d7df04c39d4e3ae/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42084.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42084.c?ref=315adedaf3f2072b55095f101d7df04c39d4e3ae", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O1 -fno-delete-null-pointer-checks\" } */\n+extern void abort (void);\n+int g = 0;\n+static int __attribute__((noinline)) f (long long a, long long b)\n+{\n+  int cmp;\n+  cmp = a > b;\n+  if (&g == 0)\n+    cmp-=2;\n+  else\n+    cmp++;\n+  return cmp;\n+}\n+\n+int main (void)\n+{\n+  int ret = f (2, 1);\n+  if (ret != 2)\n+    abort ();\n+  return 0;\n+}"}]}