{"sha": "1a79b5788df0515f13f9ba262809dcc804692874", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWE3OWI1Nzg4ZGYwNTE1ZjEzZjliYTI2MjgwOWRjYzgwNDY5Mjg3NA==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2019-12-18T17:02:10Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2019-12-18T17:02:10Z"}, "message": "[OpenACC] Refactor 'GOACC_enter_exit_data' to call 'goacc_enter_data', 'goacc_exit_data'\n\nNo functional changes.\n\n\tlibgomp/\n\t* oacc-mem.c (GOACC_enter_exit_data): Refactor code to call\n\t'goacc_enter_data', 'goacc_exit_data'.\n\nFrom-SVN: r279537", "tree": {"sha": "0a8833d2c46b5f2f5ccccc8025f1ed03e80b9abc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0a8833d2c46b5f2f5ccccc8025f1ed03e80b9abc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a79b5788df0515f13f9ba262809dcc804692874", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a79b5788df0515f13f9ba262809dcc804692874", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a79b5788df0515f13f9ba262809dcc804692874", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a79b5788df0515f13f9ba262809dcc804692874/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "34cfe31e1da108a2d6f6a7d120d3a9dac377649d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34cfe31e1da108a2d6f6a7d120d3a9dac377649d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34cfe31e1da108a2d6f6a7d120d3a9dac377649d"}], "stats": {"total": 27, "additions": 10, "deletions": 17}, "files": [{"sha": "9bb22e932ecce2006b3bca314bf0d36b14a6362e", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a79b5788df0515f13f9ba262809dcc804692874/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a79b5788df0515f13f9ba262809dcc804692874/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=1a79b5788df0515f13f9ba262809dcc804692874", "patch": "@@ -1,5 +1,8 @@\n 2019-12-18  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\t* oacc-mem.c (GOACC_enter_exit_data): Refactor code to call\n+\t'goacc_enter_data', 'goacc_exit_data'.\n+\n \t* oacc-mem.c (delete_copyout): Refactor into...\n \t(goacc_exit_data): ... this.  Adjust all users.\n "}, {"sha": "6509bd7882115f2c978b65e4b3cf21035aca4aae", "filename": "libgomp/oacc-mem.c", "status": "modified", "additions": 7, "deletions": 17, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a79b5788df0515f13f9ba262809dcc804692874/libgomp%2Foacc-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a79b5788df0515f13f9ba262809dcc804692874/libgomp%2Foacc-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Foacc-mem.c?ref=1a79b5788df0515f13f9ba262809dcc804692874", "patch": "@@ -1158,28 +1158,26 @@ GOACC_enter_exit_data (int flags_m, size_t mapnum, void **hostaddrs,\n     {\n       for (i = 0; i < mapnum; i++)\n \t{\n-\t  unsigned char kind = kinds[i] & 0xff;\n-\n \t  /* Scan for pointers and PSETs.  */\n \t  int pointer = find_pointer (i, mapnum, kinds);\n \n \t  if (!pointer)\n \t    {\n+\t      unsigned char kind = kinds[i] & 0xff;\n \t      switch (kind)\n \t\t{\n \t\tcase GOMP_MAP_ALLOC:\n \t\tcase GOMP_MAP_FORCE_ALLOC:\n-\t\t  acc_create_async (hostaddrs[i], sizes[i], async);\n-\t\t  break;\n \t\tcase GOMP_MAP_TO:\n \t\tcase GOMP_MAP_FORCE_TO:\n-\t\t  acc_copyin_async (hostaddrs[i], sizes[i], async);\n \t\t  break;\n \t\tdefault:\n \t\t  gomp_fatal (\">>>> GOACC_enter_exit_data UNHANDLED kind 0x%.2x\",\n \t\t\t      kind);\n \t\t  break;\n \t\t}\n+\n+\t      goacc_enter_data (hostaddrs[i], sizes[i], kinds[i], async);\n \t    }\n \t  else\n \t    {\n@@ -1198,9 +1196,6 @@ GOACC_enter_exit_data (int flags_m, size_t mapnum, void **hostaddrs,\n       {\n \tunsigned char kind = kinds[i] & 0xff;\n \n-\tbool finalize = (kind == GOMP_MAP_DELETE\n-\t\t\t || kind == GOMP_MAP_FORCE_FROM);\n-\n \tint pointer = find_pointer (i, mapnum, kinds);\n \n \tif (!pointer)\n@@ -1209,26 +1204,21 @@ GOACC_enter_exit_data (int flags_m, size_t mapnum, void **hostaddrs,\n \t      {\n \t      case GOMP_MAP_RELEASE:\n \t      case GOMP_MAP_DELETE:\n-\t\tif (finalize)\n-\t\t  acc_delete_finalize_async (hostaddrs[i], sizes[i], async);\n-\t\telse\n-\t\t  acc_delete_async (hostaddrs[i], sizes[i], async);\n-\t\tbreak;\n \t      case GOMP_MAP_FROM:\n \t      case GOMP_MAP_FORCE_FROM:\n-\t\tif (finalize)\n-\t\t  acc_copyout_finalize_async (hostaddrs[i], sizes[i], async);\n-\t\telse\n-\t\t  acc_copyout_async (hostaddrs[i], sizes[i], async);\n \t\tbreak;\n \t      default:\n \t\tgomp_fatal (\">>>> GOACC_enter_exit_data UNHANDLED kind 0x%.2x\",\n \t\t\t    kind);\n \t\tbreak;\n \t      }\n+\n+\t    goacc_exit_data (hostaddrs[i], sizes[i], kinds[i], async);\n \t  }\n \telse\n \t  {\n+\t    bool finalize = (kind == GOMP_MAP_DELETE\n+\t\t\t     || kind == GOMP_MAP_FORCE_FROM);\n \t    bool copyfrom = (kind == GOMP_MAP_FORCE_FROM\n \t\t\t     || kind == GOMP_MAP_FROM);\n \t    goacc_remove_pointer (hostaddrs[i], sizes[i], copyfrom, async,"}]}