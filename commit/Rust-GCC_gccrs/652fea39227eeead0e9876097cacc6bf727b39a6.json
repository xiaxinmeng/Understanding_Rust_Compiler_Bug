{"sha": "652fea39227eeead0e9876097cacc6bf727b39a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjUyZmVhMzkyMjdlZWVhZDBlOTg3NjA5N2NhY2M2YmY3MjdiMzlhNg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-01-23T13:32:19Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-01-23T13:32:19Z"}, "message": "re PR middle-end/58809 (ICE with complex variable in OpenMP reduction clause)\n\n\tPR middle-end/58809\n\t* c-typeck.c (c_finish_omp_clause): Reject MIN_EXPR, MAX_EXPR,\n\tBIT_AND_EXPR, BIT_IOR_EXPR and BIT_XOR_EXPR on COMPLEX_TYPEs.\n\n\t* semantics.c (finish_omp_reduction_clause): Reject\n\tBIT_AND_EXPR, BIT_IOR_EXPR and BIT_XOR_EXPR on COMPLEX_TYPEs.\n\n\t* c-c++-common/gomp/pr58809.c: New test.\n\nFrom-SVN: r206962", "tree": {"sha": "9505605dd378270b29575a896d9fbad7e53955f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9505605dd378270b29575a896d9fbad7e53955f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/652fea39227eeead0e9876097cacc6bf727b39a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/652fea39227eeead0e9876097cacc6bf727b39a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/652fea39227eeead0e9876097cacc6bf727b39a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/652fea39227eeead0e9876097cacc6bf727b39a6/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7fd841e250f6b82ee566a4d74d9c9306c6aa37f6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fd841e250f6b82ee566a4d74d9c9306c6aa37f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7fd841e250f6b82ee566a4d74d9c9306c6aa37f6"}], "stats": {"total": 67, "additions": 64, "deletions": 3}, "files": [{"sha": "dca35d4c7ea9d60e4522c9866d6a7b18698fa7b3", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=652fea39227eeead0e9876097cacc6bf727b39a6", "patch": "@@ -1,3 +1,9 @@\n+2014-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/58809\n+\t* c-typeck.c (c_finish_omp_clause): Reject MIN_EXPR, MAX_EXPR,\n+\tBIT_AND_EXPR, BIT_IOR_EXPR and BIT_XOR_EXPR on COMPLEX_TYPEs.\n+\n 2014-01-22  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/59891"}, {"sha": "92304b0db9ec7cb7c67fac2650c845396e048daf", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=652fea39227eeead0e9876097cacc6bf727b39a6", "patch": "@@ -11713,7 +11713,8 @@ c_finish_omp_clauses (tree clauses)\n \t  need_implicitly_determined = true;\n \t  t = OMP_CLAUSE_DECL (c);\n \t  if (OMP_CLAUSE_REDUCTION_PLACEHOLDER (c) == NULL_TREE\n-\t      && FLOAT_TYPE_P (TREE_TYPE (t)))\n+\t      && (FLOAT_TYPE_P (TREE_TYPE (t))\n+\t\t  || TREE_CODE (TREE_TYPE (t)) == COMPLEX_TYPE))\n \t    {\n \t      enum tree_code r_code = OMP_CLAUSE_REDUCTION_CODE (c);\n \t      const char *r_name = NULL;\n@@ -11723,8 +11724,14 @@ c_finish_omp_clauses (tree clauses)\n \t\tcase PLUS_EXPR:\n \t\tcase MULT_EXPR:\n \t\tcase MINUS_EXPR:\n+\t\t  break;\n \t\tcase MIN_EXPR:\n+\t\t  if (TREE_CODE (TREE_TYPE (t)) == COMPLEX_TYPE)\n+\t\t    r_name = \"min\";\n+\t\t  break;\n \t\tcase MAX_EXPR:\n+\t\t  if (TREE_CODE (TREE_TYPE (t)) == COMPLEX_TYPE)\n+\t\t    r_name = \"max\";\n \t\t  break;\n \t\tcase BIT_AND_EXPR:\n \t\t  r_name = \"&\";\n@@ -11736,10 +11743,12 @@ c_finish_omp_clauses (tree clauses)\n \t\t  r_name = \"|\";\n \t\t  break;\n \t\tcase TRUTH_ANDIF_EXPR:\n-\t\t  r_name = \"&&\";\n+\t\t  if (FLOAT_TYPE_P (TREE_TYPE (t)))\n+\t\t    r_name = \"&&\";\n \t\t  break;\n \t\tcase TRUTH_ORIF_EXPR:\n-\t\t  r_name = \"||\";\n+\t\t  if (FLOAT_TYPE_P (TREE_TYPE (t)))\n+\t\t    r_name = \"||\";\n \t\t  break;\n \t\tdefault:\n \t\t  gcc_unreachable ();"}, {"sha": "a16eb66a322c2924a028674808eb9f1f7d4b3406", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=652fea39227eeead0e9876097cacc6bf727b39a6", "patch": "@@ -1,3 +1,9 @@\n+2014-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/58809\n+\t* semantics.c (finish_omp_reduction_clause): Reject\n+\tBIT_AND_EXPR, BIT_IOR_EXPR and BIT_XOR_EXPR on COMPLEX_TYPEs.\n+\n 2014-01-22  Ville Voutilainen  <ville.voutilainen@gmail.com>\n \n \tPR c++/59482"}, {"sha": "bba00f4839aeac0431e177d25a53335af1f4864a", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=652fea39227eeead0e9876097cacc6bf727b39a6", "patch": "@@ -4971,6 +4971,10 @@ finish_omp_reduction_clause (tree c, bool *need_default_ctor, bool *need_dtor)\n       case BIT_AND_EXPR:\n       case BIT_IOR_EXPR:\n       case BIT_XOR_EXPR:\n+\tif (FLOAT_TYPE_P (type) || TREE_CODE (type) == COMPLEX_TYPE)\n+\t  break;\n+\tpredefined = true;\n+\tbreak;\n       case TRUTH_ANDIF_EXPR:\n       case TRUTH_ORIF_EXPR:\n \tif (FLOAT_TYPE_P (type))"}, {"sha": "2180cb81980df8c360749d5b1f332fa9f6b449de", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=652fea39227eeead0e9876097cacc6bf727b39a6", "patch": "@@ -1,3 +1,8 @@\n+2014-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/58809\n+\t* c-c++-common/gomp/pr58809.c: New test.\n+\n 2014-01-23  Dominique Dhumieres  <dominiq@lps.ens.fr>\n \n \tPR sanitizer/59897"}, {"sha": "f4fd7c4834d4d3247adf1eec77d0e8644ede106c", "filename": "gcc/testsuite/c-c++-common/gomp/pr58809.c", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr58809.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/652fea39227eeead0e9876097cacc6bf727b39a6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr58809.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr58809.c?ref=652fea39227eeead0e9876097cacc6bf727b39a6", "patch": "@@ -0,0 +1,31 @@\n+/* PR middle-end/58809 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp\" } */\n+\n+_Complex int j;\n+_Complex double d;\n+\n+void\n+foo (void)\n+{\n+  #pragma omp parallel reduction (&:j)\t/* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (|:j)\t/* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (^:j)\t/* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (min:j) /* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (max:j) /* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (&:d)\t/* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (|:d)\t/* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (^:d)\t/* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (min:d) /* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+  #pragma omp parallel reduction (max:d) /* { dg-error \"has invalid type for|user defined reduction not found for\" } */\n+    ;\n+}"}]}