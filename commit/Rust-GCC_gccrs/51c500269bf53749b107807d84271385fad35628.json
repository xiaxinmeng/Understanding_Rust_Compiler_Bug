{"sha": "51c500269bf53749b107807d84271385fad35628", "node_id": "C_kwDOANBUbNoAKDUxYzUwMDI2OWJmNTM3NDliMTA3ODA3ZDg0MjcxMzg1ZmFkMzU2Mjg", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-10-06T18:33:59Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-11-17T02:56:16Z"}, "message": "libcpp: Implement -Wbidi-chars for CVE-2021-42574 [PR103026]\n\nFrom a link below:\n\"An issue was discovered in the Bidirectional Algorithm in the Unicode\nSpecification through 14.0. It permits the visual reordering of\ncharacters via control sequences, which can be used to craft source code\nthat renders different logic than the logical ordering of tokens\ningested by compilers and interpreters. Adversaries can leverage this to\nencode source code for compilers accepting Unicode such that targeted\nvulnerabilities are introduced invisibly to human reviewers.\"\n\nMore info:\nhttps://nvd.nist.gov/vuln/detail/CVE-2021-42574\nhttps://trojansource.codes/\n\nThis is not a compiler bug.  However, to mitigate the problem, this patch\nimplements -Wbidi-chars=[none|unpaired|any] to warn about possibly\nmisleading Unicode bidirectional control characters the preprocessor may\nencounter.\n\nThe default is =unpaired, which warns about improperly terminated\nbidirectional control characters; e.g. a LRE without its corresponding PDF.\nThe level =any warns about any use of bidirectional control characters.\n\nThis patch handles both UCNs and UTF-8 characters.  UCNs designating\nbidi characters in identifiers are accepted since r204886.  Then r217144\nenabled -fextended-identifiers by default.  Extended characters in C/C++\nidentifiers have been accepted since r275979.  However, this patch still\nwarns about mixing UTF-8 and UCN bidi characters; there seems to be no\ngood reason to allow mixing them.\n\nWe warn in different contexts: comments (both C and C++-style), string\nliterals, character constants, and identifiers.  Expectedly, UCNs are ignored\nin comments and raw string literals.  The bidirectional control characters\ncan nest so this patch handles that as well.\n\nI have not included nor tested this at all with Fortran (which also has\nstring literals and line comments).\n\nDave M. posted patches improving diagnostic involving Unicode characters.\nThis patch does not make use of this new infrastructure yet.\n\n\tPR preprocessor/103026\n\ngcc/c-family/ChangeLog:\n\n\t* c.opt (Wbidi-chars, Wbidi-chars=): New option.\n\ngcc/ChangeLog:\n\n\t* doc/invoke.texi: Document -Wbidi-chars.\n\nlibcpp/ChangeLog:\n\n\t* include/cpplib.h (enum cpp_bidirectional_level): New.\n\t(struct cpp_options): Add cpp_warn_bidirectional.\n\t(enum cpp_warning_reason): Add CPP_W_BIDIRECTIONAL.\n\t* internal.h (struct cpp_reader): Add warn_bidi_p member\n\tfunction.\n\t* init.c (cpp_create_reader): Set cpp_warn_bidirectional.\n\t* lex.c (bidi): New namespace.\n\t(get_bidi_utf8): New function.\n\t(get_bidi_ucn): Likewise.\n\t(maybe_warn_bidi_on_close): Likewise.\n\t(maybe_warn_bidi_on_char): Likewise.\n\t(_cpp_skip_block_comment): Implement warning about bidirectional\n\tcontrol characters.\n\t(skip_line_comment): Likewise.\n\t(forms_identifier_p): Likewise.\n\t(lex_identifier): Likewise.\n\t(lex_string): Likewise.\n\t(lex_raw_string): Likewise.\n\ngcc/testsuite/ChangeLog:\n\n\t* c-c++-common/Wbidi-chars-1.c: New test.\n\t* c-c++-common/Wbidi-chars-2.c: New test.\n\t* c-c++-common/Wbidi-chars-3.c: New test.\n\t* c-c++-common/Wbidi-chars-4.c: New test.\n\t* c-c++-common/Wbidi-chars-5.c: New test.\n\t* c-c++-common/Wbidi-chars-6.c: New test.\n\t* c-c++-common/Wbidi-chars-7.c: New test.\n\t* c-c++-common/Wbidi-chars-8.c: New test.\n\t* c-c++-common/Wbidi-chars-9.c: New test.\n\t* c-c++-common/Wbidi-chars-10.c: New test.\n\t* c-c++-common/Wbidi-chars-11.c: New test.\n\t* c-c++-common/Wbidi-chars-12.c: New test.\n\t* c-c++-common/Wbidi-chars-13.c: New test.\n\t* c-c++-common/Wbidi-chars-14.c: New test.\n\t* c-c++-common/Wbidi-chars-15.c: New test.\n\t* c-c++-common/Wbidi-chars-16.c: New test.\n\t* c-c++-common/Wbidi-chars-17.c: New test.", "tree": {"sha": "b7fd2eeed15448294f60989bed252e3488b251e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b7fd2eeed15448294f60989bed252e3488b251e0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/51c500269bf53749b107807d84271385fad35628", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51c500269bf53749b107807d84271385fad35628", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51c500269bf53749b107807d84271385fad35628", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51c500269bf53749b107807d84271385fad35628/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "111fd515f2894d7cddf62f80c69765c43ae18577", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/111fd515f2894d7cddf62f80c69765c43ae18577", "html_url": "https://github.com/Rust-GCC/gccrs/commit/111fd515f2894d7cddf62f80c69765c43ae18577"}], "stats": {"total": 1322, "additions": 1315, "deletions": 7}, "files": [{"sha": "3976fc368dba58b5cefd6d7591e8247cd6178817", "filename": "gcc/c-family/c.opt", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Fc-family%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Fc-family%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc.opt?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -374,6 +374,30 @@ Wbad-function-cast\n C ObjC Var(warn_bad_function_cast) Warning\n Warn about casting functions to incompatible types.\n \n+Wbidi-chars\n+C ObjC C++ ObjC++ Warning Alias(Wbidi-chars=,any,none)\n+;\n+\n+Wbidi-chars=\n+C ObjC C++ ObjC++ RejectNegative Joined Warning CPP(cpp_warn_bidirectional) CppReason(CPP_W_BIDIRECTIONAL) Var(warn_bidirectional) Init(bidirectional_unpaired) Enum(cpp_bidirectional_level)\n+-Wbidi-chars=[none|unpaired|any] Warn about UTF-8 bidirectional control characters.\n+\n+; Required for these enum values.\n+SourceInclude\n+cpplib.h\n+\n+Enum\n+Name(cpp_bidirectional_level) Type(int) UnknownError(argument %qs to %<-Wbidi-chars%> not recognized)\n+\n+EnumValue\n+Enum(cpp_bidirectional_level) String(none) Value(bidirectional_none)\n+\n+EnumValue\n+Enum(cpp_bidirectional_level) String(unpaired) Value(bidirectional_unpaired)\n+\n+EnumValue\n+Enum(cpp_bidirectional_level) String(any) Value(bidirectional_any)\n+\n Wbool-compare\n C ObjC C++ ObjC++ Var(warn_bool_compare) Warning LangEnabledBy(C ObjC C++ ObjC++,Wall)\n Warn about boolean expression compared with an integer value different from true/false."}, {"sha": "a22758d18ee4652c3fb0e2e275b635bbb8631bf3", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -327,7 +327,9 @@ Objective-C and Objective-C++ Dialects}.\n -Warith-conversion @gol\n -Warray-bounds  -Warray-bounds=@var{n}  -Warray-compare @gol\n -Wno-attributes  -Wattribute-alias=@var{n} -Wno-attribute-alias @gol\n--Wno-attribute-warning  -Wbool-compare  -Wbool-operation @gol\n+-Wno-attribute-warning  @gol\n+-Wbidi-chars=@r{[}none@r{|}unpaired@r{|}any@r{]} @gol\n+-Wbool-compare  -Wbool-operation @gol\n -Wno-builtin-declaration-mismatch @gol\n -Wno-builtin-macro-redefined  -Wc90-c99-compat  -Wc99-c11-compat @gol\n -Wc11-c2x-compat @gol\n@@ -7678,6 +7680,23 @@ Attributes considered include @code{alloc_align}, @code{alloc_size},\n This is the default.  You can disable these warnings with either\n @option{-Wno-attribute-alias} or @option{-Wattribute-alias=0}.\n \n+@item -Wbidi-chars=@r{[}none@r{|}unpaired@r{|}any@r{]}\n+@opindex Wbidi-chars=\n+@opindex Wbidi-chars\n+@opindex Wno-bidi-chars\n+Warn about possibly misleading UTF-8 bidirectional control characters in\n+comments, string literals, character constants, and identifiers.  Such\n+characters can change left-to-right writing direction into right-to-left\n+(and vice versa), which can cause confusion between the logical order and\n+visual order.  This may be dangerous; for instance, it may seem that a piece\n+of code is not commented out, whereas it in fact is.\n+\n+There are three levels of warning supported by GCC@.  The default is\n+@option{-Wbidi-chars=unpaired}, which warns about improperly terminated\n+bidi contexts.  @option{-Wbidi-chars=none} turns the warning off.\n+@option{-Wbidi-chars=any} warns about any use of bidirectional control\n+characters.\n+\n @item -Wbool-compare\n @opindex Wno-bool-compare\n @opindex Wbool-compare"}, {"sha": "34f5ac19271d8931900d57dbb05cd7f7f2de4c72", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-1.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-1.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,12 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+\n+int main() {\n+    int isAdmin = 0;\n+    /*\u202e } \u2066if (isAdmin)\u2069 \u2066 begin admins only */\n+/* { dg-warning \"bidirectional\" \"\" { target *-*-* } .-1 } */\n+        __builtin_printf(\"You are an admin.\\n\");\n+    /* end admins only \u202e { \u2066*/\n+/* { dg-warning \"bidirectional\" \"\" { target *-*-* } .-1 } */\n+    return 0;\n+}"}, {"sha": "3f851b69e658104caddeb027b396b91d1face28c", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-10.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-10.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,27 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* More nesting testing.  */\n+\n+/* RLE\u202b LRI\u2066 PDF\u202c PDI\u2069*/\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int LRE_\\u202a_PDF_\\u202c;\n+int LRE_\\u202a_PDF_\\u202c_LRE_\\u202a_PDF_\\u202c;\n+int LRE_\\u202a_LRI_\\u2066_PDF_\\u202c_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLE_\\u202b_RLI_\\u2067_PDF_\\u202c_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLE_\\u202b_RLI_\\u2067_PDI_\\u2069_PDF_\\u202c;\n+int FSI_\\u2068_LRO_\\u202d_PDI_\\u2069_PDF_\\u202c;\n+int FSI_\\u2068;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int FSI_\\u2068_PDI_\\u2069;\n+int FSI_\\u2068_FSI_\\u2068_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069;\n+int RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDF_\\u202c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_RLI_\\u2067_FSI_\\u2068_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "270ce2368a95f994dc5521b5f0bbf0771826e982", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-11.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-11.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,13 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test that we warn when mixing UCN and UTF-8.  */\n+\n+int LRE_\u202a_PDF_\\u202c;\n+/* { dg-warning \"mismatch\" \"\" { target *-*-* } .-1 } */\n+int LRE_\\u202a_PDF_\u202c_;\n+/* { dg-warning \"mismatch\" \"\" { target *-*-* } .-1 } */\n+const char *s1 = \"LRE_\u202a_PDF_\\u202c\";\n+/* { dg-warning \"mismatch\" \"\" { target *-*-* } .-1 } */\n+const char *s2 = \"LRE_\\u202a_PDF_\u202c\";\n+/* { dg-warning \"mismatch\" \"\" { target *-*-* } .-1 } */"}, {"sha": "b07eec1da91629b8bf7e714b4f199f80063c5c4f", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-12.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-12.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,19 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile { target { c || c++11 } } } */\n+/* { dg-options \"-Wbidi-chars=any\" } */\n+/* Test raw strings.  */\n+\n+const char *s1 = R\"(a b c LRE\u202a 1 2 3 PDF\u202c x y z)\";\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+const char *s2 = R\"(a b c RLE\u202b 1 2 3 PDF\u202c x y z)\";\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+const char *s3 = R\"(a b c LRO\u202d 1 2 3 PDF\u202c x y z)\";\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+const char *s4 = R\"(a b c RLO\u202e 1 2 3 PDF\u202c x y z)\";\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+const char *s7 = R\"(a b c FSI\u2068 1 2 3 PDI\u2069 x y) z\";\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+const char *s8 = R\"(a b c PDI\u2069 x y )z\";\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-1 } */\n+const char *s9 = R\"(a b c PDF\u202c x y z)\";\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */"}, {"sha": "b2dd9fde752a293402e7adcaeb41f2063b2d8116", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-13.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-13.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-13.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-13.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,17 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile { target { c || c++11 } } } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test raw strings.  */\n+\n+const char *s1 = R\"(a b c LRE\u202a 1 2 3)\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s2 = R\"(a b c RLE\u202b 1 2 3)\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s3 = R\"(a b c LRO\u202d 1 2 3)\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s4 = R\"(a b c FSI\u2068 1 2 3)\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s5 = R\"(a b c LRI\u2066 1 2 3)\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s6 = R\"(a b c RLI\u2067 1 2 3)\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "ba5f75d9553cfefdd3fc9a1d998cfc75da302b0e", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-14.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-14.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-14.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-14.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,38 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test PDI handling, which also pops any subsequent LREs, RLEs, LROs,\n+   or RLOs.  */\n+\n+/* LRI_\u2066_LRI_\u2066_RLE_\u202b_RLE_\u202b_RLE_\u202b_PDI_\u2069*/\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// LRI_\u2066_RLE_\u202b_RLE_\u202b_RLE_\u202b_PDI_\u2069\n+// LRI_\u2066_RLO_\u202e_RLE_\u202b_RLE_\u202b_PDI_\u2069\n+// LRI_\u2066_RLO_\u202e_RLE_\u202b_PDI_\u2069\n+// FSI_\u2068_RLO_\u202e_PDI_\u2069\n+// FSI_\u2068_FSI_\u2068_RLO_\u202e_PDI_\u2069\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+int LRI_\\u2066_LRI_\\u2066_LRE_\\u202a_LRE_\\u202a_LRE_\\u202a_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int LRI_\\u2066_LRI_\\u2066_LRE_\\u202a_LRE_\\u202a_LRE_\\u202a_PDI_\\u2069_PDI_\\u2069;\n+int LRI_\\u2066_LRI_\\u2066_LRI_\\u2066_LRE_\\u202a_LRE_\\u202a_LRE_\\u202a_PDI_\\u2069_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int PDI_\\u2069;\n+int LRI_\\u2066_PDI_\\u2069;\n+int RLI_\\u2067_PDI_\\u2069;\n+int LRE_\\u202a_LRI_\\u2066_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int LRI_\\u2066_LRE_\\u202a_PDF_\\u202c_PDI_\\u2069;\n+int LRI_\\u2066_LRE_\\u202a_LRE_\\u202a_PDF_\\u202c_PDI_\\u2069;\n+int RLI_\\u2067_LRI_\\u2066_LRE_\\u202a_LRE_\\u202a_PDF_\\u202c_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int FSI_\\u2068_LRI_\\u2066_LRE_\\u202a_LRE_\\u202a_PDF_\\u202c_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLO_\\u202e_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int RLI_\\u2067_PDI_\\u2069_RLI_\\u2067;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int FSI_\\u2068_PDF_\\u202c_PDI_\\u2069;\n+int FSI_\\u2068_FSI_\\u2068_PDF_\\u202c_PDI_\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "a0ce8ff5e2c60df1472ca7173e9f0c5d57a71547", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-15.c", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-15.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,59 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test unpaired bidi control chars in multiline comments.  */\n+\n+/*\n+ * LRE\u202a end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/*\n+ * RLE\u202b end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/*\n+ * LRO\u202d end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/*\n+ * RLO\u202e end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/*\n+ * LRI\u2066 end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/*\n+ * RLI\u2067 end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/*\n+ * FSI\u2068 end\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/* LRE\u202a\n+   PDF\u202c */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/* FSI\u2068\n+   PDI\u2069 */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+\n+/* LRE<\u202a>\n+ *\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-3 } */\n+\n+/*\n+ * LRE<\u202a>\n+ */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+\n+/*\n+ *\n+ * LRE<\u202a> */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+/* RLI<\u2067> */ /* PDI<\u2069> */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* LRE<\u202a> */ /* PDF<\u202c> */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "baa0159861c099fc0dc0cac34f95f7cdd8150e28", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-16.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-16.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,26 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=any\" } */\n+/* Test LTR/RTL chars.  */\n+\n+/* LTR<\u200e> */\n+/* { dg-warning \"U\\\\+200E\" \"\" { target *-*-* } .-1 } */\n+// LTR<\u200e>\n+/* { dg-warning \"U\\\\+200E\" \"\" { target *-*-* } .-1 } */\n+/* RTL<\u200f> */\n+/* { dg-warning \"U\\\\+200F\" \"\" { target *-*-* } .-1 } */\n+// RTL<\u200f>\n+/* { dg-warning \"U\\\\+200F\" \"\" { target *-*-* } .-1 } */\n+\n+const char *s1 = \"LTR<\u200e>\";\n+/* { dg-warning \"U\\\\+200E\" \"\" { target *-*-* } .-1 } */\n+const char *s2 = \"LTR\\u200e\";\n+/* { dg-warning \"U\\\\+200E\" \"\" { target *-*-* } .-1 } */\n+const char *s3 = \"LTR\\u200E\";\n+/* { dg-warning \"U\\\\+200E\" \"\" { target *-*-* } .-1 } */\n+const char *s4 = \"RTL<\u200f>\";\n+/* { dg-warning \"U\\\\+200F\" \"\" { target *-*-* } .-1 } */\n+const char *s5 = \"RTL\\u200f\";\n+/* { dg-warning \"U\\\\+200F\" \"\" { target *-*-* } .-1 } */\n+const char *s6 = \"RTL\\u200F\";\n+/* { dg-warning \"U\\\\+200F\" \"\" { target *-*-* } .-1 } */"}, {"sha": "07cb4321f964522f7ac44afec956b20e6928b149", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-17.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-17.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,30 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test LTR/RTL chars.  */\n+\n+/* LTR<\u200e> */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// LTR<\u200e>\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* RTL<\u200f> */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// RTL<\u200f>\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int ltr_\\u200e;\n+/* { dg-error \"universal character \" \"\" { target *-*-* } .-1 } */\n+int rtl_\\u200f;\n+/* { dg-error \"universal character \" \"\" { target *-*-* } .-1 } */\n+\n+const char *s1 = \"LTR<\u200e>\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s2 = \"LTR\\u200e\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s3 = \"LTR\\u200E\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s4 = \"RTL<\u200f>\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s5 = \"RTL\\u200f\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s6 = \"RTL\\u200F\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "2340374f2767f1b8a7e72d79acc8905333281790", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-2.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-2.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,9 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+\n+int main() {\n+    /* Say hello; newline\u2067/*/ return 0 ;\n+/* { dg-warning \"bidirectional\" \"\" { target *-*-* } .-1 } */\n+    __builtin_printf(\"Hello world.\\n\");\n+    return 0;\n+}"}, {"sha": "9dc7edb6e64ded37cfa174295ec8965b803bd0b5", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-3.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-3.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,11 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+\n+int main() {\n+    const char* access_level = \"user\";\n+    if (__builtin_strcmp(access_level, \"user\u202e \u2066// Check if admin\u2069 \u2066\")) {\n+/* { dg-warning \"bidirectional\" \"\" { target *-*-* } .-1 } */\n+        __builtin_printf(\"You are an admin.\\n\");\n+    }\n+    return 0;\n+}"}, {"sha": "639e5c62e8886515754c2ebf00198f40e526304e", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-4.c", "status": "added", "additions": 188, "deletions": 0, "changes": 188, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-4.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,188 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=any -Wno-multichar -Wno-overflow\" } */\n+/* Test all bidi chars in various contexts (identifiers, comments,\n+   string literals, character constants), both UCN and UTF-8.  The bidi\n+   chars here are properly terminated, except for the character constants.  */\n+\n+/* a b c LRE\u202a 1 2 3 PDF\u202c x y z */\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLE\u202b 1 2 3 PDF\u202c x y z */\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+/* a b c LRO\u202d 1 2 3 PDF\u202c x y z */\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLO\u202e 1 2 3 PDF\u202c x y z */\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+/* a b c LRI\u2066 1 2 3 PDI\u2069 x y z */\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLI\u2067 1 2 3 PDI\u2069 x y */\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+/* a b c FSI\u2068 1 2 3 PDI\u2069 x y z */\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+\n+/* Same but C++ comments instead.  */\n+// a b c LRE\u202a 1 2 3 PDF\u202c x y z\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+// a b c RLE\u202b 1 2 3 PDF\u202c x y z\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+// a b c LRO\u202d 1 2 3 PDF\u202c x y z\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+// a b c RLO\u202e 1 2 3 PDF\u202c x y z\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+// a b c LRI\u2066 1 2 3 PDI\u2069 x y z\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+// a b c RLI\u2067 1 2 3 PDI\u2069 x y\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+// a b c FSI\u2068 1 2 3 PDI\u2069 x y z\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+\n+/* Here we're closing an unopened context, warn when =any.  */\n+/* a b c PDI\u2069 x y z */\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-1 } */\n+/* a b c PDF\u202c x y z */\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+// a b c PDI\u2069 x y z\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-1 } */\n+// a b c PDF\u202c x y z\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+\n+/* Multiline comments.  */\n+/* a b c PDI\u2069 x y z\n+   */\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-2 } */\n+/* a b c PDF\u202c x y z\n+   */\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-2 } */\n+/* first\n+   a b c PDI\u2069 x y z\n+   */\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-2 } */\n+/* first\n+   a b c PDF\u202c x y z\n+   */\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-2 } */\n+/* first\n+   a b c PDI\u2069 x y z */\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-1 } */\n+/* first\n+   a b c PDF\u202c x y z */\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+\n+void\n+g1 ()\n+{\n+  const char *s1 = \"a b c LRE\u202a 1 2 3 PDF\u202c x y z\";\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+  const char *s2 = \"a b c RLE\u202b 1 2 3 PDF\u202c x y z\";\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+  const char *s3 = \"a b c LRO\u202d 1 2 3 PDF\u202c x y z\";\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+  const char *s4 = \"a b c RLO\u202e 1 2 3 PDF\u202c x y z\";\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+  const char *s5 = \"a b c LRI\u2066 1 2 3 PDI\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+  const char *s6 = \"a b c RLI\u2067 1 2 3 PDI\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+  const char *s7 = \"a b c FSI\u2068 1 2 3 PDI\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+  const char *s8 = \"a b c PDI\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-1 } */\n+  const char *s9 = \"a b c PDF\u202c x y z\";\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+\n+  const char *s10 = \"a b c LRE\\u202a 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+  const char *s11 = \"a b c LRE\\u202A 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+  const char *s12 = \"a b c RLE\\u202b 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+  const char *s13 = \"a b c RLE\\u202B 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+  const char *s14 = \"a b c LRO\\u202d 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+  const char *s15 = \"a b c LRO\\u202D 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+  const char *s16 = \"a b c RLO\\u202e 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+  const char *s17 = \"a b c RLO\\u202E 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+  const char *s18 = \"a b c LRI\\u2066 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+  const char *s19 = \"a b c RLI\\u2067 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+  const char *s20 = \"a b c FSI\\u2068 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+}\n+\n+void\n+g2 ()\n+{\n+  const char c1 = '\\u202a';\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+  const char c2 = '\\u202A';\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+  const char c3 = '\\u202b';\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+  const char c4 = '\\u202B';\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+  const char c5 = '\\u202d';\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+  const char c6 = '\\u202D';\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+  const char c7 = '\\u202e';\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+  const char c8 = '\\u202E';\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+  const char c9 = '\\u2066';\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+  const char c10 = '\\u2067';\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+  const char c11 = '\\u2068';\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+}\n+\n+int a\u202ab\u202cc;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+int a\u202bb\u202cc;\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+int a\u202db\u202cc;\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+int a\u202eb\u202cc;\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+int a\u2066b\u2069c;\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+int a\u2067b\u2069c;\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+int a\u2068b\u2069c;\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+int A\u202cX;\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+int A\\u202cY;\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+int A\\u202CY2;\n+/* { dg-warning \"U\\\\+202C\" \"\" { target *-*-* } .-1 } */\n+\n+int d\\u202ae\\u202cf;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+int d\\u202Ae\\u202cf2;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+int d\\u202be\\u202cf;\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+int d\\u202Be\\u202cf2;\n+/* { dg-warning \"U\\\\+202B\" \"\" { target *-*-* } .-1 } */\n+int d\\u202de\\u202cf;\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+int d\\u202De\\u202cf2;\n+/* { dg-warning \"U\\\\+202D\" \"\" { target *-*-* } .-1 } */\n+int d\\u202ee\\u202cf;\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+int d\\u202Ee\\u202cf2;\n+/* { dg-warning \"U\\\\+202E\" \"\" { target *-*-* } .-1 } */\n+int d\\u2066e\\u2069f;\n+/* { dg-warning \"U\\\\+2066\" \"\" { target *-*-* } .-1 } */\n+int d\\u2067e\\u2069f;\n+/* { dg-warning \"U\\\\+2067\" \"\" { target *-*-* } .-1 } */\n+int d\\u2068e\\u2069f;\n+/* { dg-warning \"U\\\\+2068\" \"\" { target *-*-* } .-1 } */\n+int X\\u2069;\n+/* { dg-warning \"U\\\\+2069\" \"\" { target *-*-* } .-1 } */"}, {"sha": "68cb053144ba46a72f30a5252bf3bfdb35ab75fe", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-5.c", "status": "added", "additions": 188, "deletions": 0, "changes": 188, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-5.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,188 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired -Wno-multichar -Wno-overflow\" } */\n+/* Test all bidi chars in various contexts (identifiers, comments,\n+   string literals, character constants), both UCN and UTF-8.  The bidi\n+   chars here are properly terminated, except for the character constants.  */\n+\n+/* a b c LRE\u202a 1 2 3 PDF\u202c x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLE\u202b 1 2 3 PDF\u202c x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c LRO\u202d 1 2 3 PDF\u202c x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLO\u202e 1 2 3 PDF\u202c x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c LRI\u2066 1 2 3 PDI\u2069 x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLI\u2067 1 2 3 PDI\u2069 x y */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c FSI\u2068 1 2 3 PDI\u2069 x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+/* Same but C++ comments instead.  */\n+// a b c LRE\u202a 1 2 3 PDF\u202c x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c RLE\u202b 1 2 3 PDF\u202c x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c LRO\u202d 1 2 3 PDF\u202c x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c RLO\u202e 1 2 3 PDF\u202c x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c LRI\u2066 1 2 3 PDI\u2069 x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c RLI\u2067 1 2 3 PDI\u2069 x y\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c FSI\u2068 1 2 3 PDI\u2069 x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+/* Here we're closing an unopened context, warn when =any.  */\n+/* a b c PDI\u2069 x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c PDF\u202c x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c PDI\u2069 x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c PDF\u202c x y z\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+/* Multiline comments.  */\n+/* a b c PDI\u2069 x y z\n+   */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/* a b c PDF\u202c x y z\n+   */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/* first\n+   a b c PDI\u2069 x y z\n+   */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/* first\n+   a b c PDF\u202c x y z\n+   */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-2 } */\n+/* first\n+   a b c PDI\u2069 x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* first\n+   a b c PDF\u202c x y z */\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+void\n+g1 ()\n+{\n+  const char *s1 = \"a b c LRE\u202a 1 2 3 PDF\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s2 = \"a b c RLE\u202b 1 2 3 PDF\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s3 = \"a b c LRO\u202d 1 2 3 PDF\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s4 = \"a b c RLO\u202e 1 2 3 PDF\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s5 = \"a b c LRI\u2066 1 2 3 PDI\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s6 = \"a b c RLI\u2067 1 2 3 PDI\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s7 = \"a b c FSI\u2068 1 2 3 PDI\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s8 = \"a b c PDI\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s9 = \"a b c PDF\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+  const char *s10 = \"a b c LRE\\u202a 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s11 = \"a b c LRE\\u202A 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s12 = \"a b c RLE\\u202b 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s13 = \"a b c RLE\\u202B 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s14 = \"a b c LRO\\u202d 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s15 = \"a b c LRO\\u202D 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s16 = \"a b c RLO\\u202e 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s17 = \"a b c RLO\\u202E 1 2 3 PDF\\u202c x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s18 = \"a b c LRI\\u2066 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s19 = \"a b c RLI\\u2067 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s20 = \"a b c FSI\\u2068 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+}\n+\n+void\n+g2 ()\n+{\n+  const char c1 = '\\u202a';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c2 = '\\u202A';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c3 = '\\u202b';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c4 = '\\u202B';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c5 = '\\u202d';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c6 = '\\u202D';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c7 = '\\u202e';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c8 = '\\u202E';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c9 = '\\u2066';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c10 = '\\u2067';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char c11 = '\\u2068';\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+}\n+\n+int a\u202ab\u202cc;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\u202bb\u202cc;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\u202db\u202cc;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\u202eb\u202cc;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\u2066b\u2069c;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\u2067b\u2069c;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\u2068b\u2069c;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int A\u202cX;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int A\\u202cY;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int A\\u202CY2;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+int d\\u202ae\\u202cf;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202Ae\\u202cf2;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202be\\u202cf;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202Be\\u202cf2;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202de\\u202cf;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202De\\u202cf2;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202ee\\u202cf;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u202Ee\\u202cf2;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u2066e\\u2069f;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u2067e\\u2069f;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int d\\u2068e\\u2069f;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int X\\u2069;\n+/* { dg-bogus \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "0ce6fff2deed0643a2191bd2a1f952d38ab4d7c5", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-6.c", "status": "added", "additions": 155, "deletions": 0, "changes": 155, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-6.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,155 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test nesting of bidi chars in various contexts.  */\n+\n+/* Terminated by the wrong char:  */\n+/* a b c LRE\u202a 1 2 3 PDI\u2069 x y z */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLE\u202b 1 2 3 PDI\u2069 x y  z*/\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c LRO\u202d 1 2 3 PDI\u2069 x y z */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLO\u202e 1 2 3 PDI\u2069 x y z */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c LRI\u2066 1 2 3 PDF\u202c x y z */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c RLI\u2067 1 2 3 PDF\u202c x y z */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* a b c FSI\u2068 1 2 3 PDF\u202c x y  z*/\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+/* LRE\u202a PDF\u202c */\n+/* LRE\u202a LRE\u202a PDF\u202c PDF\u202c */\n+/* PDF\u202c LRE\u202a PDF\u202c */\n+/* LRE\u202a PDF\u202c LRE\u202a PDF\u202c */\n+/* LRE\u202a LRE\u202a PDF\u202c */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* PDF\u202c LRE\u202a */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+// a b c LRE\u202a 1 2 3 PDI\u2069 x y z\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c RLE\u202b 1 2 3 PDI\u2069 x y  z*/\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c LRO\u202d 1 2 3 PDI\u2069 x y z \n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c RLO\u202e 1 2 3 PDI\u2069 x y z \n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c LRI\u2066 1 2 3 PDF\u202c x y z \n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c RLI\u2067 1 2 3 PDF\u202c x y z \n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// a b c FSI\u2068 1 2 3 PDF\u202c x y  z\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+// LRE\u202a PDF\u202c \n+// LRE\u202a LRE\u202a PDF\u202c PDF\u202c\n+// PDF\u202c LRE\u202a PDF\u202c\n+// LRE\u202a PDF\u202c LRE\u202a PDF\u202c\n+// LRE\u202a LRE\u202a PDF\u202c\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+// PDF\u202c LRE\u202a\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+void\n+g1 ()\n+{\n+  const char *s1 = \"a b c LRE\u202a 1 2 3 PDI\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s2 = \"a b c LRE\\u202a 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s3 = \"a b c RLE\u202b 1 2 3 PDI\u2069 x y \";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s4 = \"a b c RLE\\u202b 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s5 = \"a b c LRO\u202d 1 2 3 PDI\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s6 = \"a b c LRO\\u202d 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s7 = \"a b c RLO\u202e 1 2 3 PDI\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s8 = \"a b c RLO\\u202e 1 2 3 PDI\\u2069 x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s9 = \"a b c LRI\u2066 1 2 3 PDF\u202c x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s10 = \"a b c LRI\\u2066 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s11 = \"a b c RLI\u2067 1 2 3 PDF\u202c x y z\\\n+    \";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+  const char *s12 = \"a b c RLI\\u2067 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s13 = \"a b c FSI\u2068 1 2 3 PDF\u202c x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s14 = \"a b c FSI\\u2068 1 2 3 PDF\\u202c x y z\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s15 = \"PDF\u202c LRE\u202a\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s16 = \"PDF\\u202c LRE\\u202a\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s17 = \"LRE\u202a PDF\u202c\";\n+  const char *s18 = \"LRE\\u202a PDF\\u202c\";\n+  const char *s19 = \"LRE\u202a LRE\u202a PDF\u202c PDF\u202c\";\n+  const char *s20 = \"LRE\\u202a LRE\\u202a PDF\\u202c PDF\\u202c\";\n+  const char *s21 = \"PDF\u202c LRE\u202a PDF\u202c\";\n+  const char *s22 = \"PDF\\u202c LRE\\u202a PDF\\u202c\";\n+  const char *s23 = \"LRE\u202a LRE\u202a PDF\u202c\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s24 = \"LRE\\u202a LRE\\u202a PDF\\u202c\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s25 = \"PDF\u202c LRE\u202a\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s26 = \"PDF\\u202c LRE\\u202a\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s27 = \"PDF\u202c LRE\\u202a\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+  const char *s28 = \"PDF\\u202c LRE\u202a\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+}\n+\n+int aLRE\u202abPDI\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int A\\u202aB\\u2069C;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aRLE\u202bbPDI\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\\u202bB\\u2069c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aLRO\u202dbPDI\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\\u202db\\u2069c2;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aRLO\u202ebPDI\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\\u202eb\\u2069;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aLRI\u2066bPDF\u202c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\\u2066b\\u202c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aRLI\u2067bPDF\u202cc\n+;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-2 } */\n+int a\\u2067b\\u202c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aFSI\u2068bPDF\u202c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a\\u2068b\\u202c;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aFSI\u2068bPD\\u202C;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aFSI\\u2068bPDF\u202c_;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int aLRE\u202abPDF\u202cb; \n+int A\\u202aB\\u202c;\n+int a_LRE\u202a_LRE\u202a_b_PDF\u202c_PDF\u202c;\n+int A\\u202aA\\u202aB\\u202cB\\u202c;\n+int aPDF\u202cbLREadPDF\u202c;\n+int a_\\u202C_\\u202a_\\u202c;\n+int a_LRE\u202a_b_PDF\u202c_c_LRE\u202a_PDF\u202c;\n+int a_\\u202a_\\u202c_\\u202a_\\u202c_;\n+int a_LRE\u202a_b_PDF\u202c_c_LRE\u202a;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int a_\\u202a_\\u202c_\\u202a_;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "d012d420ec04fe1755965ddd853d86da3746a84a", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-7.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-7.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,9 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=any\" } */\n+/* Test we ignore UCNs in comments.  */\n+\n+// a b c \\u202a 1 2 3\n+// a b c \\u202A 1 2 3\n+/* a b c \\u202a 1 2 3 */\n+/* a b c \\u202A 1 2 3 */"}, {"sha": "4f54c5092eca1296f8953d44bef37f37564d6bad", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-8.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-8.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,13 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=any\" } */\n+/* Test \\u vs \\U.  */\n+\n+int a_\\u202A;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+int a_\\u202a_2;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+int a_\\U0000202A_3;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */\n+int a_\\U0000202a_4;\n+/* { dg-warning \"U\\\\+202A\" \"\" { target *-*-* } .-1 } */"}, {"sha": "e2af1b1ca97f77d6048ad044c7b5ef54450ef831", "filename": "gcc/testsuite/c-c++-common/Wbidi-chars-9.c", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbidi-chars-9.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -0,0 +1,29 @@\n+/* PR preprocessor/103026 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wbidi-chars=unpaired\" } */\n+/* Test that we properly separate bidi contexts (comment/identifier/character\n+   constant/string literal).  */\n+\n+/* LRE ->\u202a<- */ int pdf_\\u202c_1;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* RLE ->\u202b<- */ int pdf_\\u202c_2;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* LRO ->\u202d<- */ int pdf_\\u202c_3;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* RLO ->\u202e<- */ int pdf_\\u202c_4;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* LRI ->\u2066<-*/ int pdi_\\u2069_1;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* RLI ->\u2067<- */ int pdi_\\u2069_12;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* FSI ->\u2068<- */ int pdi_\\u2069_3;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+\n+const char *s1 = \"LRE\\u202a\"; /* PDF ->\u202c<- */\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+/* LRE ->\u202a<- */ const char *s2 = \"PDF\\u202c\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+const char *s3 = \"LRE\\u202a\"; int pdf_\\u202c_5;\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */\n+int lre_\\u202a; const char *s4 = \"PDF\\u202c\";\n+/* { dg-warning \"unpaired\" \"\" { target *-*-* } .-1 } */"}, {"sha": "112b9c24751725971950f63a632bece00cb95d4b", "filename": "libcpp/include/cpplib.h", "status": "modified", "additions": 17, "deletions": 1, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/libcpp%2Finclude%2Fcpplib.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/libcpp%2Finclude%2Fcpplib.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finclude%2Fcpplib.h?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -319,6 +319,17 @@ enum cpp_main_search\n   CMS_system,  /* Search the system INCLUDE path.  */\n };\n \n+/* The possible bidirectional control characters checking levels, from least\n+   restrictive to most.  */\n+enum cpp_bidirectional_level {\n+  /* No checking.  */\n+  bidirectional_none,\n+  /* Only detect unpaired uses of bidirectional control characters.  */\n+  bidirectional_unpaired,\n+  /* Detect any use of bidirectional control characters.  */\n+  bidirectional_any\n+};\n+\n /* This structure is nested inside struct cpp_reader, and\n    carries all the options visible to the command line.  */\n struct cpp_options\n@@ -539,6 +550,10 @@ struct cpp_options\n   /* True if warn about differences between C++98 and C++11.  */\n   bool cpp_warn_cxx11_compat;\n \n+  /* Nonzero if bidirectional control characters checking is on.  See enum\n+     cpp_bidirectional_level.  */\n+  unsigned char cpp_warn_bidirectional;\n+\n   /* Dependency generation.  */\n   struct\n   {\n@@ -643,7 +658,8 @@ enum cpp_warning_reason {\n   CPP_W_C90_C99_COMPAT,\n   CPP_W_C11_C2X_COMPAT,\n   CPP_W_CXX11_COMPAT,\n-  CPP_W_EXPANSION_TO_DEFINED\n+  CPP_W_EXPANSION_TO_DEFINED,\n+  CPP_W_BIDIRECTIONAL\n };\n \n /* Callback for header lookup for HEADER, which is the name of a"}, {"sha": "f9a8f5f088f36ec662aae8fbbb86b390582b7d6f", "filename": "libcpp/init.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/libcpp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/libcpp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finit.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -223,6 +223,7 @@ cpp_create_reader (enum c_lang lang, cpp_hash_table *table,\n       = ENABLE_CANONICAL_SYSTEM_HEADERS;\n   CPP_OPTION (pfile, ext_numeric_literals) = 1;\n   CPP_OPTION (pfile, warn_date_time) = 0;\n+  CPP_OPTION (pfile, cpp_warn_bidirectional) = bidirectional_unpaired;\n \n   /* Default CPP arithmetic to something sensible for the host for the\n      benefit of dumb users like fix-header.  */"}, {"sha": "0ce0246c5a244f770d7a6196a7d7a3e472676af3", "filename": "libcpp/internal.h", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/libcpp%2Finternal.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/libcpp%2Finternal.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Finternal.h?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -597,6 +597,13 @@ struct cpp_reader\n   /* Location identifying the main source file -- intended to be line\n      zero of said file.  */\n   location_t main_loc;\n+\n+  /* Returns true iff we should warn about UTF-8 bidirectional control\n+     characters.  */\n+  bool warn_bidi_p () const\n+  {\n+    return CPP_OPTION (this, cpp_warn_bidirectional) != bidirectional_none;\n+  }\n };\n \n /* Character classes.  Based on the more primitive macros in safe-ctype.h."}, {"sha": "6a4fbce6030c00ce84c8c9ac9eb7ed9bcac87324", "filename": "libcpp/lex.c", "status": "modified", "additions": 403, "deletions": 5, "changes": 408, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51c500269bf53749b107807d84271385fad35628/libcpp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51c500269bf53749b107807d84271385fad35628/libcpp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Flex.c?ref=51c500269bf53749b107807d84271385fad35628", "patch": "@@ -1164,6 +1164,324 @@ _cpp_process_line_notes (cpp_reader *pfile, int in_comment)\n     }\n }\n \n+namespace bidi {\n+  enum class kind {\n+    NONE, LRE, RLE, LRO, RLO, LRI, RLI, FSI, PDF, PDI, LTR, RTL\n+  };\n+\n+  /* All the UTF-8 encodings of bidi characters start with E2.  */\n+  constexpr uchar utf8_start = 0xe2;\n+\n+  /* A vector holding currently open bidi contexts.  We use a char for\n+     each context, its LSB is 1 if it represents a PDF context, 0 if it\n+     represents a PDI context.  The next bit is 1 if this context was open\n+     by a bidi character written as a UCN, and 0 when it was UTF-8.  */\n+  semi_embedded_vec <unsigned char, 16> vec;\n+\n+  /* Close the whole comment/identifier/string literal/character constant\n+     context.  */\n+  void on_close ()\n+  {\n+    vec.truncate (0);\n+  }\n+\n+  /* Pop the last element in the vector.  */\n+  void pop ()\n+  {\n+    unsigned int len = vec.count ();\n+    gcc_checking_assert (len > 0);\n+    vec.truncate (len - 1);\n+  }\n+\n+  /* Return the context of the Ith element.  */\n+  kind ctx_at (unsigned int i)\n+  {\n+    return (vec[i] & 1) ? kind::PDF : kind::PDI;\n+  }\n+\n+  /* Return which context is currently opened.  */\n+  kind current_ctx ()\n+  {\n+    unsigned int len = vec.count ();\n+    if (len == 0)\n+      return kind::NONE;\n+    return ctx_at (len - 1);\n+  }\n+\n+  /* Return true if the current context comes from a UCN origin, that is,\n+     the bidi char which started this bidi context was written as a UCN.  */\n+  bool current_ctx_ucn_p ()\n+  {\n+    unsigned int len = vec.count ();\n+    gcc_checking_assert (len > 0);\n+    return (vec[len - 1] >> 1) & 1;\n+  }\n+\n+  /* We've read a bidi char, update the current vector as necessary.  */\n+  void on_char (kind k, bool ucn_p)\n+  {\n+    switch (k)\n+      {\n+      case kind::LRE:\n+      case kind::RLE:\n+      case kind::LRO:\n+      case kind::RLO:\n+\tvec.push (ucn_p ? 3u : 1u);\n+\tbreak;\n+      case kind::LRI:\n+      case kind::RLI:\n+      case kind::FSI:\n+\tvec.push (ucn_p ? 2u : 0u);\n+\tbreak;\n+      /* PDF terminates the scope of the last LRE, RLE, LRO, or RLO\n+\t whose scope has not yet been terminated.  */\n+      case kind::PDF:\n+\tif (current_ctx () == kind::PDF)\n+\t  pop ();\n+\tbreak;\n+      /* PDI terminates the scope of the last LRI, RLI, or FSI whose\n+\t scope has not yet been terminated, as well as the scopes of\n+\t any subsequent LREs, RLEs, LROs, or RLOs whose scopes have not\n+\t yet been terminated.  */\n+      case kind::PDI:\n+\tfor (int i = vec.count () - 1; i >= 0; --i)\n+\t  if (ctx_at (i) == kind::PDI)\n+\t    {\n+\t      vec.truncate (i);\n+\t      break;\n+\t    }\n+\tbreak;\n+      case kind::LTR:\n+      case kind::RTL:\n+\t/* These aren't popped by a PDF/PDI.  */\n+\tbreak;\n+      [[likely]] case kind::NONE:\n+\tbreak;\n+      default:\n+\tabort ();\n+      }\n+  }\n+\n+  /* Return a descriptive string for K.  */\n+  const char *to_str (kind k)\n+  {\n+    switch (k)\n+      {\n+      case kind::LRE:\n+\treturn \"U+202A (LEFT-TO-RIGHT EMBEDDING)\";\n+      case kind::RLE:\n+\treturn \"U+202B (RIGHT-TO-LEFT EMBEDDING)\";\n+      case kind::LRO:\n+\treturn \"U+202D (LEFT-TO-RIGHT OVERRIDE)\";\n+      case kind::RLO:\n+\treturn \"U+202E (RIGHT-TO-LEFT OVERRIDE)\";\n+      case kind::LRI:\n+\treturn \"U+2066 (LEFT-TO-RIGHT ISOLATE)\";\n+      case kind::RLI:\n+\treturn \"U+2067 (RIGHT-TO-LEFT ISOLATE)\";\n+      case kind::FSI:\n+\treturn \"U+2068 (FIRST STRONG ISOLATE)\";\n+      case kind::PDF:\n+\treturn \"U+202C (POP DIRECTIONAL FORMATTING)\";\n+      case kind::PDI:\n+\treturn \"U+2069 (POP DIRECTIONAL ISOLATE)\";\n+      case kind::LTR:\n+\treturn \"U+200E (LEFT-TO-RIGHT MARK)\";\n+      case kind::RTL:\n+\treturn \"U+200F (RIGHT-TO-LEFT MARK)\";\n+      default:\n+\tabort ();\n+      }\n+  }\n+}\n+\n+/* Parse a sequence of 3 bytes starting with P and return its bidi code.  */\n+\n+static bidi::kind\n+get_bidi_utf8 (const unsigned char *const p)\n+{\n+  gcc_checking_assert (p[0] == bidi::utf8_start);\n+\n+  if (p[1] == 0x80)\n+    switch (p[2])\n+      {\n+      case 0xaa:\n+\treturn bidi::kind::LRE;\n+      case 0xab:\n+\treturn bidi::kind::RLE;\n+      case 0xac:\n+\treturn bidi::kind::PDF;\n+      case 0xad:\n+\treturn bidi::kind::LRO;\n+      case 0xae:\n+\treturn bidi::kind::RLO;\n+      case 0x8e:\n+\treturn bidi::kind::LTR;\n+      case 0x8f:\n+\treturn bidi::kind::RTL;\n+      default:\n+\tbreak;\n+      }\n+  else if (p[1] == 0x81)\n+    switch (p[2])\n+      {\n+      case 0xa6:\n+\treturn bidi::kind::LRI;\n+      case 0xa7:\n+\treturn bidi::kind::RLI;\n+      case 0xa8:\n+\treturn bidi::kind::FSI;\n+      case 0xa9:\n+\treturn bidi::kind::PDI;\n+      default:\n+\tbreak;\n+      }\n+\n+  return bidi::kind::NONE;\n+}\n+\n+/* Parse a UCN where P points just past \\u or \\U and return its bidi code.  */\n+\n+static bidi::kind\n+get_bidi_ucn (const unsigned char *p, bool is_U)\n+{\n+  /* 6.4.3 Universal Character Names\n+      \\u hex-quad\n+      \\U hex-quad hex-quad\n+     where \\unnnn means \\U0000nnnn.  */\n+\n+  if (is_U)\n+    {\n+      if (p[0] != '0' || p[1] != '0' || p[2] != '0' || p[3] != '0')\n+\treturn bidi::kind::NONE;\n+      /* Skip 4B so we can treat \\u and \\U the same below.  */\n+      p += 4;\n+    }\n+\n+  /* All code points we are looking for start with 20xx.  */\n+  if (p[0] != '2' || p[1] != '0')\n+    return bidi::kind::NONE;\n+  else if (p[2] == '2')\n+    switch (p[3])\n+      {\n+      case 'a':\n+      case 'A':\n+\treturn bidi::kind::LRE;\n+      case 'b':\n+      case 'B':\n+\treturn bidi::kind::RLE;\n+      case 'c':\n+      case 'C':\n+\treturn bidi::kind::PDF;\n+      case 'd':\n+      case 'D':\n+\treturn bidi::kind::LRO;\n+      case 'e':\n+      case 'E':\n+\treturn bidi::kind::RLO;\n+      default:\n+\tbreak;\n+      }\n+  else if (p[2] == '6')\n+    switch (p[3])\n+      {\n+      case '6':\n+\treturn bidi::kind::LRI;\n+      case '7':\n+\treturn bidi::kind::RLI;\n+      case '8':\n+\treturn bidi::kind::FSI;\n+      case '9':\n+\treturn bidi::kind::PDI;\n+      default:\n+\tbreak;\n+      }\n+  else if (p[2] == '0')\n+    switch (p[3])\n+      {\n+      case 'e':\n+      case 'E':\n+\treturn bidi::kind::LTR;\n+      case 'f':\n+      case 'F':\n+\treturn bidi::kind::RTL;\n+      default:\n+\tbreak;\n+      }\n+\n+  return bidi::kind::NONE;\n+}\n+\n+/* We're closing a bidi context, that is, we've encountered a newline,\n+   are closing a C-style comment, or are at the end of a string literal,\n+   character constant, or identifier.  Warn if this context was not\n+   properly terminated by a PDI or PDF.  P points to the last character\n+   in this context.  */\n+\n+static void\n+maybe_warn_bidi_on_close (cpp_reader *pfile, const uchar *p)\n+{\n+  if (CPP_OPTION (pfile, cpp_warn_bidirectional) == bidirectional_unpaired\n+      && bidi::vec.count () > 0)\n+    {\n+      const location_t loc\n+\t= linemap_position_for_column (pfile->line_table,\n+\t\t\t\t       CPP_BUF_COLUMN (pfile->buffer, p));\n+      cpp_warning_with_line (pfile, CPP_W_BIDIRECTIONAL, loc, 0,\n+\t\t\t     \"unpaired UTF-8 bidirectional control character \"\n+\t\t\t     \"detected\");\n+    }\n+  /* We're done with this context.  */\n+  bidi::on_close ();\n+}\n+\n+/* We're at the beginning or in the middle of an identifier/comment/string\n+   literal/character constant.  Warn if we've encountered a bidi character.\n+   KIND says which bidi character it was; P points to it in the character\n+   stream.  UCN_P is true iff this bidi character was written as a UCN.  */\n+\n+static void\n+maybe_warn_bidi_on_char (cpp_reader *pfile, const uchar *p, bidi::kind kind,\n+\t\t\t bool ucn_p)\n+{\n+  if (__builtin_expect (kind == bidi::kind::NONE, 1))\n+    return;\n+\n+  const auto warn_bidi = CPP_OPTION (pfile, cpp_warn_bidirectional);\n+\n+  if (warn_bidi != bidirectional_none)\n+    {\n+      const location_t loc\n+\t= linemap_position_for_column (pfile->line_table,\n+\t\t\t\t       CPP_BUF_COLUMN (pfile->buffer, p));\n+      /* It seems excessive to warn about a PDI/PDF that is closing\n+\t an opened context because we've already warned about the\n+\t opening character.  Except warn when we have a UCN x UTF-8\n+\t mismatch.  */\n+      if (kind == bidi::current_ctx ())\n+\t{\n+\t  if (warn_bidi == bidirectional_unpaired\n+\t      && bidi::current_ctx_ucn_p () != ucn_p)\n+\t    cpp_warning_with_line (pfile, CPP_W_BIDIRECTIONAL, loc, 0,\n+\t\t\t\t   \"UTF-8 vs UCN mismatch when closing \"\n+\t\t\t\t   \"a context by \\\"%s\\\"\", bidi::to_str (kind));\n+\t}\n+      else if (warn_bidi == bidirectional_any)\n+\t{\n+\t  if (kind == bidi::kind::PDF || kind == bidi::kind::PDI)\n+\t    cpp_warning_with_line (pfile, CPP_W_BIDIRECTIONAL, loc, 0,\n+\t\t\t\t   \"\\\"%s\\\" is closing an unopened context\",\n+\t\t\t\t   bidi::to_str (kind));\n+\t  else\n+\t    cpp_warning_with_line (pfile, CPP_W_BIDIRECTIONAL, loc, 0,\n+\t\t\t\t   \"found problematic Unicode character \\\"%s\\\"\",\n+\t\t\t\t   bidi::to_str (kind));\n+\t}\n+    }\n+  /* We're done with this context.  */\n+  bidi::on_char (kind, ucn_p);\n+}\n+\n /* Skip a C-style block comment.  We find the end of the comment by\n    seeing if an asterisk is before every '/' we encounter.  Returns\n    nonzero if comment terminated by EOF, zero otherwise.\n@@ -1175,6 +1493,7 @@ _cpp_skip_block_comment (cpp_reader *pfile)\n   cpp_buffer *buffer = pfile->buffer;\n   const uchar *cur = buffer->cur;\n   uchar c;\n+  const bool warn_bidi_p = pfile->warn_bidi_p ();\n \n   cur++;\n   if (*cur == '/')\n@@ -1189,7 +1508,11 @@ _cpp_skip_block_comment (cpp_reader *pfile)\n       if (c == '/')\n \t{\n \t  if (cur[-2] == '*')\n-\t    break;\n+\t    {\n+\t      if (warn_bidi_p)\n+\t\tmaybe_warn_bidi_on_close (pfile, cur);\n+\t      break;\n+\t    }\n \n \t  /* Warn about potential nested comments, but not if the '/'\n \t     comes immediately before the true comment delimiter.\n@@ -1208,6 +1531,8 @@ _cpp_skip_block_comment (cpp_reader *pfile)\n \t{\n \t  unsigned int cols;\n \t  buffer->cur = cur - 1;\n+\t  if (warn_bidi_p)\n+\t    maybe_warn_bidi_on_close (pfile, cur);\n \t  _cpp_process_line_notes (pfile, true);\n \t  if (buffer->next_line >= buffer->rlimit)\n \t    return true;\n@@ -1218,6 +1543,13 @@ _cpp_skip_block_comment (cpp_reader *pfile)\n \n \t  cur = buffer->cur;\n \t}\n+      /* If this is a beginning of a UTF-8 encoding, it might be\n+\t a bidirectional control character.  */\n+      else if (__builtin_expect (c == bidi::utf8_start, 0) && warn_bidi_p)\n+\t{\n+\t  bidi::kind kind = get_bidi_utf8 (cur - 1);\n+\t  maybe_warn_bidi_on_char (pfile, cur, kind, /*ucn_p=*/false);\n+\t}\n     }\n \n   buffer->cur = cur;\n@@ -1233,9 +1565,31 @@ skip_line_comment (cpp_reader *pfile)\n {\n   cpp_buffer *buffer = pfile->buffer;\n   location_t orig_line = pfile->line_table->highest_line;\n+  const bool warn_bidi_p = pfile->warn_bidi_p ();\n \n-  while (*buffer->cur != '\\n')\n-    buffer->cur++;\n+  if (!warn_bidi_p)\n+    while (*buffer->cur != '\\n')\n+      buffer->cur++;\n+  else\n+    {\n+      while (*buffer->cur != '\\n'\n+\t     && *buffer->cur != bidi::utf8_start)\n+\tbuffer->cur++;\n+      if (__builtin_expect (*buffer->cur == bidi::utf8_start, 0))\n+\t{\n+\t  while (*buffer->cur != '\\n')\n+\t    {\n+\t      if (__builtin_expect (*buffer->cur == bidi::utf8_start, 0))\n+\t\t{\n+\t\t  bidi::kind kind = get_bidi_utf8 (buffer->cur);\n+\t\t  maybe_warn_bidi_on_char (pfile, buffer->cur, kind,\n+\t\t\t\t\t   /*ucn_p=*/false);\n+\t\t}\n+\t      buffer->cur++;\n+\t    }\n+\t  maybe_warn_bidi_on_close (pfile, buffer->cur);\n+\t}\n+    }\n \n   _cpp_process_line_notes (pfile, true);\n   return orig_line != pfile->line_table->highest_line;\n@@ -1346,11 +1700,13 @@ static const cppchar_t utf8_signifier = 0xC0;\n \n /* Returns TRUE if the sequence starting at buffer->cur is valid in\n    an identifier.  FIRST is TRUE if this starts an identifier.  */\n+\n static bool\n forms_identifier_p (cpp_reader *pfile, int first,\n \t\t    struct normalize_state *state)\n {\n   cpp_buffer *buffer = pfile->buffer;\n+  const bool warn_bidi_p = pfile->warn_bidi_p ();\n \n   if (*buffer->cur == '$')\n     {\n@@ -1373,6 +1729,13 @@ forms_identifier_p (cpp_reader *pfile, int first,\n       cppchar_t s;\n       if (*buffer->cur >= utf8_signifier)\n \t{\n+\t  if (__builtin_expect (*buffer->cur == bidi::utf8_start, 0)\n+\t      && warn_bidi_p)\n+\t    {\n+\t      bidi::kind kind = get_bidi_utf8 (buffer->cur);\n+\t      maybe_warn_bidi_on_char (pfile, buffer->cur, kind,\n+\t\t\t\t       /*ucn_p=*/false);\n+\t    }\n \t  if (_cpp_valid_utf8 (pfile, &buffer->cur, buffer->rlimit, 1 + !first,\n \t\t\t       state, &s))\n \t    return true;\n@@ -1381,6 +1744,13 @@ forms_identifier_p (cpp_reader *pfile, int first,\n \t       && (buffer->cur[1] == 'u' || buffer->cur[1] == 'U'))\n \t{\n \t  buffer->cur += 2;\n+\t  if (warn_bidi_p)\n+\t    {\n+\t      bidi::kind kind = get_bidi_ucn (buffer->cur,\n+\t\t\t\t\t      buffer->cur[-1] == 'U');\n+\t      maybe_warn_bidi_on_char (pfile, buffer->cur, kind,\n+\t\t\t\t       /*ucn_p=*/true);\n+\t    }\n \t  if (_cpp_valid_ucn (pfile, &buffer->cur, buffer->rlimit, 1 + !first,\n \t\t\t      state, &s, NULL, NULL))\n \t    return true;\n@@ -1489,6 +1859,7 @@ lex_identifier (cpp_reader *pfile, const uchar *base, bool starts_ucn,\n   const uchar *cur;\n   unsigned int len;\n   unsigned int hash = HT_HASHSTEP (0, *base);\n+  const bool warn_bidi_p = pfile->warn_bidi_p ();\n \n   cur = pfile->buffer->cur;\n   if (! starts_ucn)\n@@ -1512,6 +1883,8 @@ lex_identifier (cpp_reader *pfile, const uchar *base, bool starts_ucn,\n \t    pfile->buffer->cur++;\n \t  }\n       } while (forms_identifier_p (pfile, false, nst));\n+      if (warn_bidi_p)\n+\tmaybe_warn_bidi_on_close (pfile, pfile->buffer->cur);\n       result = _cpp_interpret_identifier (pfile, base,\n \t\t\t\t\t  pfile->buffer->cur - base);\n       *spelling = cpp_lookup (pfile, base, pfile->buffer->cur - base);\n@@ -1758,6 +2131,7 @@ static void\n lex_raw_string (cpp_reader *pfile, cpp_token *token, const uchar *base)\n {\n   const uchar *pos = base;\n+  const bool warn_bidi_p = pfile->warn_bidi_p ();\n \n   /* 'tis a pity this information isn't passed down from the lexer's\n      initial categorization of the token.  */\n@@ -1994,8 +2368,15 @@ lex_raw_string (cpp_reader *pfile, cpp_token *token, const uchar *base)\n \t  pos = base = pfile->buffer->cur;\n \t  note = &pfile->buffer->notes[pfile->buffer->cur_note];\n \t}\n+      else if (__builtin_expect ((unsigned char) c == bidi::utf8_start, 0)\n+\t       && warn_bidi_p)\n+\tmaybe_warn_bidi_on_char (pfile, pos - 1, get_bidi_utf8 (pos - 1),\n+\t\t\t\t /*ucn_p=*/false);\n     }\n \n+  if (warn_bidi_p)\n+    maybe_warn_bidi_on_close (pfile, pos);\n+\n   if (CPP_OPTION (pfile, user_literals))\n     {\n       /* If a string format macro, say from inttypes.h, is placed touching\n@@ -2090,15 +2471,27 @@ lex_string (cpp_reader *pfile, cpp_token *token, const uchar *base)\n   else\n     terminator = '>', type = CPP_HEADER_NAME;\n \n+  const bool warn_bidi_p = pfile->warn_bidi_p ();\n   for (;;)\n     {\n       cppchar_t c = *cur++;\n \n       /* In #include-style directives, terminators are not escapable.  */\n       if (c == '\\\\' && !pfile->state.angled_headers && *cur != '\\n')\n-\tcur++;\n+\t{\n+\t  if ((cur[0] == 'u' || cur[0] == 'U') && warn_bidi_p)\n+\t    {\n+\t      bidi::kind kind = get_bidi_ucn (cur + 1, cur[0] == 'U');\n+\t      maybe_warn_bidi_on_char (pfile, cur, kind, /*ucn_p=*/true);\n+\t    }\n+\t  cur++;\n+\t}\n       else if (c == terminator)\n-\tbreak;\n+\t{\n+\t  if (warn_bidi_p)\n+\t    maybe_warn_bidi_on_close (pfile, cur - 1);\n+\t  break;\n+\t}\n       else if (c == '\\n')\n \t{\n \t  cur--;\n@@ -2115,6 +2508,11 @@ lex_string (cpp_reader *pfile, cpp_token *token, const uchar *base)\n \t}\n       else if (c == '\\0')\n \tsaw_NUL = true;\n+      else if (__builtin_expect (c == bidi::utf8_start, 0) && warn_bidi_p)\n+\t{\n+\t  bidi::kind kind = get_bidi_utf8 (cur - 1);\n+\t  maybe_warn_bidi_on_char (pfile, cur - 1, kind, /*ucn_p=*/false);\n+\t}\n     }\n \n   if (saw_NUL && !pfile->state.skipping)"}]}