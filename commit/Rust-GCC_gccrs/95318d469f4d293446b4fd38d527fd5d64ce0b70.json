{"sha": "95318d469f4d293446b4fd38d527fd5d64ce0b70", "node_id": "C_kwDOANBUbNoAKDk1MzE4ZDQ2OWY0ZDI5MzQ0NmI0ZmQzOGQ1MjdmZDVkNjRjZTBiNzA", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2021-11-04T08:28:44Z"}, "committer": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2021-11-04T08:28:44Z"}, "message": "Fix RTL frontend handling of const_vectors\n\nThe RTL frontend makes sure that CONST_INTs use shared rtxes where\nappropriate.  We should do the same thing for CONST_VECTORs,\nreusing CONST0_RTX, CONST1_RTX and CONSTM1_RTX.  This also has\nthe effect of setting CONST_VECTOR_NELTS_PER_PATTERN and\nCONST_VECTOR_NPATTERNS.\n\nWhile looking at where to add that, I noticed we had some dead #includes\nin read-rtl.c.  Some of the stuff that read-rtl-function.c does was once\nin that file instead.\n\ngcc/\n\t* read-rtl.c: Remove dead !GENERATOR_FILE block.\n\t* read-rtl-function.c (function_reader::consolidate_singletons):\n\tGenerate canonical CONST_VECTORs.", "tree": {"sha": "1564afa1b39d7bd657b2087bd4a7e9062b3a8dde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1564afa1b39d7bd657b2087bd4a7e9062b3a8dde"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/95318d469f4d293446b4fd38d527fd5d64ce0b70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95318d469f4d293446b4fd38d527fd5d64ce0b70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95318d469f4d293446b4fd38d527fd5d64ce0b70", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95318d469f4d293446b4fd38d527fd5d64ce0b70/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bc9c8e5f8af08c513a4a4c329c50ba6559ff6d5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc9c8e5f8af08c513a4a4c329c50ba6559ff6d5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc9c8e5f8af08c513a4a4c329c50ba6559ff6d5c"}], "stats": {"total": 9, "additions": 3, "deletions": 6}, "files": [{"sha": "5699f574a376139891f7b429ed67d558b1593e0b", "filename": "gcc/read-rtl-function.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95318d469f4d293446b4fd38d527fd5d64ce0b70/gcc%2Fread-rtl-function.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95318d469f4d293446b4fd38d527fd5d64ce0b70/gcc%2Fread-rtl-function.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fread-rtl-function.c?ref=95318d469f4d293446b4fd38d527fd5d64ce0b70", "patch": "@@ -1498,6 +1498,9 @@ function_reader::consolidate_singletons (rtx x)\n     case CONST_INT:\n       return gen_rtx_CONST_INT (GET_MODE (x), INTVAL (x));\n \n+    case CONST_VECTOR:\n+      return gen_rtx_CONST_VECTOR (GET_MODE (x), XVEC (x, 0));\n+\n     default:\n       break;\n     }"}, {"sha": "b33dee0684257b154b96555634ef14e0c27c0ee1", "filename": "gcc/read-rtl.c", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95318d469f4d293446b4fd38d527fd5d64ce0b70/gcc%2Fread-rtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95318d469f4d293446b4fd38d527fd5d64ce0b70/gcc%2Fread-rtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fread-rtl.c?ref=95318d469f4d293446b4fd38d527fd5d64ce0b70", "patch": "@@ -36,12 +36,6 @@ along with GCC; see the file COPYING3.  If not see\n #include \"read-md.h\"\n #include \"gensupport.h\"\n \n-#ifndef GENERATOR_FILE\n-#include \"function.h\"\n-#include \"memmodel.h\"\n-#include \"emit-rtl.h\"\n-#endif\n-\n /* One element in a singly-linked list of (integer, string) pairs.  */\n struct map_value {\n   struct map_value *next;"}]}