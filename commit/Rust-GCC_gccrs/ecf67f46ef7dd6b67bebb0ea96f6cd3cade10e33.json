{"sha": "ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWNmNjdmNDZlZjdkZDZiNjdiZWJiMGVhOTZmNmNkM2NhZGUxMGUzMw==", "commit": {"author": {"name": "Kim Ho", "email": "kho@redhat.com", "date": "2004-01-26T13:56:59Z"}, "committer": {"name": "Kim Ho", "email": "kho@gcc.gnu.org", "date": "2004-01-26T13:56:59Z"}, "message": "GtkFramePeer.java (menuBarHeight): Mark private.\n\n2004-01-26  Kim Ho  <kho@redhat.com>\n\n        * gnu/java/awt/peer/gtk/GtkFramePeer.java (menuBarHeight): Mark\n        private.\n        (setMenuBar): Grab MenuBar height and change insets.\n        (setBounds): Account for MenuBar height.\n        (postInsetsChangedEvent): Ditto.\n        (postSizeAllocateEvent): Remove.\n        * jni/gtk-peer/gnu_java_awt_peer_gtk_GtkWindowPeer.c\n        (menubar_resize_cb): Remove\n        (setMenuBarPeer): Remove callback.\n        (getMenuBarHeight): Use size requisition instead of\n        allocation.\n\nFrom-SVN: r76633", "tree": {"sha": "af2d0b064eb6be32012de5c017a698aeae7486bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/af2d0b064eb6be32012de5c017a698aeae7486bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/comments", "author": {"login": "biscuitsandscones", "id": 133805869, "node_id": "U_kgDOB_m3LQ", "avatar_url": "https://avatars.githubusercontent.com/u/133805869?v=4", "gravatar_id": "", "url": "https://api.github.com/users/biscuitsandscones", "html_url": "https://github.com/biscuitsandscones", "followers_url": "https://api.github.com/users/biscuitsandscones/followers", "following_url": "https://api.github.com/users/biscuitsandscones/following{/other_user}", "gists_url": "https://api.github.com/users/biscuitsandscones/gists{/gist_id}", "starred_url": "https://api.github.com/users/biscuitsandscones/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/biscuitsandscones/subscriptions", "organizations_url": "https://api.github.com/users/biscuitsandscones/orgs", "repos_url": "https://api.github.com/users/biscuitsandscones/repos", "events_url": "https://api.github.com/users/biscuitsandscones/events{/privacy}", "received_events_url": "https://api.github.com/users/biscuitsandscones/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4d39d873e0664935c3638dad36828cba877cb1f2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d39d873e0664935c3638dad36828cba877cb1f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d39d873e0664935c3638dad36828cba877cb1f2"}], "stats": {"total": 81, "additions": 39, "deletions": 42}, "files": [{"sha": "f59d55f8235b8d93ff3817dc7f15d8fa076da32b", "filename": "libjava/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "patch": "@@ -1,3 +1,17 @@\n+2004-01-26  Kim Ho  <kho@redhat.com>\n+\n+\t* gnu/java/awt/peer/gtk/GtkFramePeer.java (menuBarHeight): Mark\n+\tprivate.\n+\t(setMenuBar): Grab MenuBar height and change insets.\n+\t(setBounds): Account for MenuBar height.\n+\t(postInsetsChangedEvent): Ditto.\n+\t(postSizeAllocateEvent): Remove.\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkWindowPeer.c\n+\t(menubar_resize_cb): Remove\n+\t(setMenuBarPeer): Remove callback.\n+\t(getMenuBarHeight): Use size requisition instead of\n+\tallocation.\n+\n 2004-01-25  Thomas Fitzsimmons  <fitzsim@redhat.com>\n \n \t* java/awt/TextArea.java: Fix indentation.  Flesh out javadocs."}, {"sha": "3b69b029baede5f1ff7ebdf565a3c7925a418796", "filename": "libjava/gnu/java/awt/peer/gtk/GtkFramePeer.java", "status": "modified", "additions": 20, "deletions": 12, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkFramePeer.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkFramePeer.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FGtkFramePeer.java?ref=ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "patch": "@@ -53,7 +53,7 @@\n public class GtkFramePeer extends GtkWindowPeer\n     implements FramePeer\n {\n-  int menuBarHeight = 0;\n+  private int menuBarHeight;\n   private MenuBarPeer menuBar;\n   native int getMenuBarHeight (MenuBarPeer bar);\n \n@@ -76,9 +76,20 @@ else if (bar != null)\n         removeMenuBarPeer(menuBar);\n       menuBar = (MenuBarPeer) ((MenuBar) bar).getPeer();\n       setMenuBarPeer(menuBar);      \n+      menuBarHeight = getMenuBarHeight (menuBar);\n+      insets.top += menuBarHeight;\n+      awtComponent.doLayout();\n     }\n   }\n \n+  public void setBounds (int x, int y, int width, int height)\n+  {\n+    nativeSetBounds (x, y,\n+\t\t     width - insets.left - insets.right,\n+\t\t     height - insets.top - insets.bottom\n+\t\t     + menuBarHeight);\n+  }  \n+  \n   public void setResizable (boolean resizable)\n   {\n     // Call setSize; otherwise when resizable is changed from true to\n@@ -89,18 +100,15 @@ public void setResizable (boolean resizable)\n              + menuBarHeight);\n     set (\"allow_shrink\", resizable);\n     set (\"allow_grow\", resizable);\n-  }\n-\n-  protected void postSizeAllocateEvent()\n+  }  \n+  \n+  protected void postInsetsChangedEvent (int top, int left,\n+\t\t\t\t\t int bottom, int right)\n   {\n-    if (menuBar != null)\n-    {\n-      if (menuBarHeight != 0)\n-        insets.top -= menuBarHeight;\n-      menuBarHeight = getMenuBarHeight(menuBar);\n-      insets.top += menuBarHeight;\n-    }\n-    awtComponent.doLayout();\n+    insets.top = top + menuBarHeight;\n+    insets.left = left;\n+    insets.bottom = bottom;\n+    insets.right = right;\n   }\n \n   public GtkFramePeer (Frame frame)"}, {"sha": "610fc142f855db278713eeec22052e537a1520d4", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkWindowPeer.c", "status": "modified", "additions": 5, "deletions": 30, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkWindowPeer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkWindowPeer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkWindowPeer.c?ref=ecf67f46ef7dd6b67bebb0ea96f6cd3cade10e33", "patch": "@@ -72,8 +72,6 @@ static jint window_get_new_state (GtkWidget *widget);\n static gboolean window_property_changed_cb (GtkWidget *widget,\n \t\t\t\t\t    GdkEventProperty *event,\n \t\t\t\t\t    jobject peer);\n-static void menubar_resize_cb (GtkWidget *widget, GtkAllocation *alloc, \n-                               jobject peer);\t\t\t\t\t    \n \n /*\n  * Make a new window.\n@@ -402,15 +400,12 @@ Java_gnu_java_awt_peer_gtk_GtkFramePeer_setMenuBarPeer\n   void *wptr;\n   GtkWidget *mptr;\n   GtkWidget *box;\n-  jobject *gref = NSA_GET_GLOBAL_REF (env, obj);\n-  \n+\n   wptr = NSA_GET_PTR (env, obj);\n   mptr = NSA_GET_PTR (env, menubar);\n   \n   gdk_threads_enter ();\n \n-  g_signal_connect (G_OBJECT (mptr), \"size-allocate\", \n-                    G_CALLBACK (menubar_resize_cb), *gref);    \n   box = GTK_BIN (wptr)->child;\t\t    \n   gtk_box_pack_start (GTK_BOX (box), mptr, 0, 0, 0);\n  \n@@ -426,11 +421,14 @@ Java_gnu_java_awt_peer_gtk_GtkFramePeer_getMenuBarHeight\n {\n   GtkWidget *ptr;\n   jint height;\n+  GtkRequisition gtkreq;\n   \n   ptr = NSA_GET_PTR (env, menubar);\n \n   gdk_threads_enter ();\n-  height = ptr->allocation.height;\n+  gtk_widget_size_request (ptr, &gtkreq);\n+\n+  height = gtkreq.height;\n   gdk_threads_leave ();\n   return height;\n }\n@@ -733,26 +731,3 @@ window_property_changed_cb (GtkWidget *widget __attribute__((unused)),\n \n   return FALSE;\n }\n-\n-static void menubar_resize_cb (GtkWidget *widget __attribute__((unused)), \n-                               GtkAllocation *alloc __attribute__((unused)), \n-                               jobject peer)\n-{\n-  static int id_set = 0;\n-  static jmethodID postSizeAllocateEventID;\n-  \n-  if (!id_set)\n-    {\n-      jclass gtkframepeer = (*gdk_env)->FindClass (gdk_env,\n-                                \"gnu/java/awt/peer/gtk/GtkFramePeer\");\n-      postSizeAllocateEventID = (*gdk_env)->GetMethodID (gdk_env,\n-                                                     gtkframepeer,\n-                                                     \"postSizeAllocateEvent\",\n-                                                     \"()V\");\n-      id_set = 1;\n-    }\n-  gdk_threads_leave();\n-  (*gdk_env)->CallVoidMethod (gdk_env, peer,\n-                              postSizeAllocateEventID);\n-  gdk_threads_enter();\n-}"}]}