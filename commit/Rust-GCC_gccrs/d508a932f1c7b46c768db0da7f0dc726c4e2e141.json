{"sha": "d508a932f1c7b46c768db0da7f0dc726c4e2e141", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDUwOGE5MzJmMWM3YjQ2Yzc2OGRiMGRhN2YwZGM3MjZjNGUyZTE0MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-01-12T20:04:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-01-12T20:04:14Z"}, "message": "regrename.c (regrename_do_replace): If replacing the same reg multiple times, try to reuse last created gen_raw_REG.\n\n\t* regrename.c (regrename_do_replace): If replacing the same\n\treg multiple times, try to reuse last created gen_raw_REG.\n\nFrom-SVN: r256596", "tree": {"sha": "53ac19b200822ae3cb46fd98384376e7fad1b01a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53ac19b200822ae3cb46fd98384376e7fad1b01a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d508a932f1c7b46c768db0da7f0dc726c4e2e141", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d508a932f1c7b46c768db0da7f0dc726c4e2e141", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d508a932f1c7b46c768db0da7f0dc726c4e2e141", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d508a932f1c7b46c768db0da7f0dc726c4e2e141/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "708c4094eea2574473207a45d747994c9c2cbb56", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/708c4094eea2574473207a45d747994c9c2cbb56", "html_url": "https://github.com/Rust-GCC/gccrs/commit/708c4094eea2574473207a45d747994c9c2cbb56"}], "stats": {"total": 22, "additions": 15, "deletions": 7}, "files": [{"sha": "d3bd144258842d0e32e3abde43c3611149822628", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d508a932f1c7b46c768db0da7f0dc726c4e2e141/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d508a932f1c7b46c768db0da7f0dc726c4e2e141/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d508a932f1c7b46c768db0da7f0dc726c4e2e141", "patch": "@@ -1,5 +1,8 @@\n 2018-01-12  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* regrename.c (regrename_do_replace): If replacing the same\n+\treg multiple times, try to reuse last created gen_raw_REG.\n+\n \tPR debug/81155\n \t* bb-reorder.c (pass_partition_blocks::gate): In lto don't partition\n \tmain to workaround a bug in GDB.\n@@ -1394,7 +1397,7 @@\n 2018-01-04  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/83666\n-\t* cfgexpand.c (expand_dbeug_expr) <case BIT_FIELD_REF>: Punt if mode\n+\t* cfgexpand.c (expand_debug_expr) <case BIT_FIELD_REF>: Punt if mode\n \tis BLKmode and bitpos not zero or mode change is needed.\n \n 2018-01-04  Richard Sandiford  <richard.sandiford@linaro.org>"}, {"sha": "dcec77adf75e94584c8e5b5fcfcb419675096656", "filename": "gcc/regrename.c", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d508a932f1c7b46c768db0da7f0dc726c4e2e141/gcc%2Fregrename.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d508a932f1c7b46c768db0da7f0dc726c4e2e141/gcc%2Fregrename.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fregrename.c?ref=d508a932f1c7b46c768db0da7f0dc726c4e2e141", "patch": "@@ -963,6 +963,7 @@ regrename_do_replace (struct du_head *head, int reg)\n   struct du_chain *chain;\n   unsigned int base_regno = head->regno;\n   machine_mode mode;\n+  rtx last_reg = NULL_RTX, last_repl = NULL_RTX;\n \n   for (chain = head->first; chain; chain = chain->next_use)\n     {\n@@ -975,12 +976,16 @@ regrename_do_replace (struct du_head *head, int reg)\n \t\t\t gen_rtx_UNKNOWN_VAR_LOC (), true);\n       else\n \t{\n-\t  validate_change (chain->insn, chain->loc, \n-\t\t\t   gen_raw_REG (GET_MODE (*chain->loc), reg), true);\n-\t  if (regno >= FIRST_PSEUDO_REGISTER)\n-\t    ORIGINAL_REGNO (*chain->loc) = regno;\n-\t  REG_ATTRS (*chain->loc) = attr;\n-\t  REG_POINTER (*chain->loc) = reg_ptr;\n+\t  if (*chain->loc != last_reg)\n+\t    {\n+\t      last_repl = gen_raw_REG (GET_MODE (*chain->loc), reg);\n+\t      if (regno >= FIRST_PSEUDO_REGISTER)\n+\t\tORIGINAL_REGNO (last_repl) = regno;\n+\t      REG_ATTRS (last_repl) = attr;\n+\t      REG_POINTER (last_repl) = reg_ptr;\n+\t      last_reg = *chain->loc;\n+\t    }\n+\t  validate_change (chain->insn, chain->loc, last_repl, true);\n \t}\n     }\n "}]}