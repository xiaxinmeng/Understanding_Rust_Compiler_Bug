{"sha": "b5e962556704ca9d18aeaea01ee4cb41bebfb318", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjVlOTYyNTU2NzA0Y2E5ZDE4YWVhZWEwMWVlNGNiNDFiZWJmYjMxOA==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-09-28T22:57:44Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1993-09-28T22:57:44Z"}, "message": "(schedule_insns): Don't zero reg_n_calls_crossed for\npseudos live across multiple blocks.\n\nFrom-SVN: r5515", "tree": {"sha": "06c304a7fa983850644e6cc50b5c881df2132047", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/06c304a7fa983850644e6cc50b5c881df2132047"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b5e962556704ca9d18aeaea01ee4cb41bebfb318", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5e962556704ca9d18aeaea01ee4cb41bebfb318", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5e962556704ca9d18aeaea01ee4cb41bebfb318", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5e962556704ca9d18aeaea01ee4cb41bebfb318/comments", "author": null, "committer": null, "parents": [{"sha": "3b8b3c98b0c3cd47b29cc4fd966ab4cce9840d82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b8b3c98b0c3cd47b29cc4fd966ab4cce9840d82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b8b3c98b0c3cd47b29cc4fd966ab4cce9840d82"}], "stats": {"total": 32, "additions": 25, "deletions": 7}, "files": [{"sha": "a56aa47cd2e0b4e924a252d762a568acaf72cf19", "filename": "gcc/sched.c", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5e962556704ca9d18aeaea01ee4cb41bebfb318/gcc%2Fsched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5e962556704ca9d18aeaea01ee4cb41bebfb318/gcc%2Fsched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched.c?ref=b5e962556704ca9d18aeaea01ee4cb41bebfb318", "patch": "@@ -4678,20 +4678,38 @@ schedule_insns (dump_file)\n \t\t\t   regno, reg_live_length[regno],\n \t\t\t   sched_reg_live_length[regno]);\n \n-\t\tif (reg_n_calls_crossed[regno]\n-\t\t    && ! sched_reg_n_calls_crossed[regno])\n-\t\t  fprintf (dump_file,\n-\t\t\t   \";; register %d no longer crosses calls\\n\", regno);\n-\t\telse if (! reg_n_calls_crossed[regno]\n-\t\t\t && sched_reg_n_calls_crossed[regno])\n+\t\tif (! reg_n_calls_crossed[regno]\n+\t\t    && sched_reg_n_calls_crossed[regno])\n \t\t  fprintf (dump_file,\n \t\t\t   \";; register %d now crosses calls\\n\", regno);\n+\t\telse if (reg_n_calls_crossed[regno]\n+\t\t\t && ! sched_reg_n_calls_crossed[regno]\n+\t\t\t && reg_basic_block[regno] != REG_BLOCK_GLOBAL)\n+\t\t  fprintf (dump_file,\n+\t\t\t   \";; register %d no longer crosses calls\\n\", regno);\n+\n \t      }\n \t    /* Negative values are special; don't overwrite the current\n \t       reg_live_length value if it is negative.  */\n \t    if (reg_live_length[regno] >= 0)\n \t      reg_live_length[regno] = sched_reg_live_length[regno];\n-\t    reg_n_calls_crossed[regno] = sched_reg_n_calls_crossed[regno];\n+\n+\t    /* We can't change the value of reg_n_calls_crossed to zero for\n+\t       pseudos which are live in more than one block.\n+\n+\t       This is because combine might have made an optimization which\n+\t       invalidated basic_block_live_at_start and reg_n_calls_crossed,\n+\t       but it does not update them.  If we update reg_n_calls_crossed\n+\t       here, the two variables are now inconsistent, and this might\n+\t       confuse the caller-save code into saving a register that doesn't\n+\t       need to be saved.  This is only a problem when we zero calls\n+\t       crossed for a pseudo live in multiple basic blocks.\n+\n+\t       Alternatively, we could try to correctly update basic block live\n+\t       at start here in sched, but that seems complicated.  */\n+\t    if (sched_reg_n_calls_crossed[regno]\n+\t\t|| reg_basic_block[regno] != REG_BLOCK_GLOBAL)\n+\t      reg_n_calls_crossed[regno] = sched_reg_n_calls_crossed[regno];\n \t  }\n     }\n }"}]}