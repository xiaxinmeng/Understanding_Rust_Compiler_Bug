{"sha": "53e38f0275f495b20e274cedeaf8647b8005feca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTNlMzhmMDI3NWY0OTViMjBlMjc0Y2VkZWFmODY0N2I4MDA1ZmVjYQ==", "commit": {"author": {"name": "Renlin Li", "email": "renlin.li@arm.com", "date": "2015-05-05T10:16:46Z"}, "committer": {"name": "Renlin Li", "email": "renlin@gcc.gnu.org", "date": "2015-05-05T10:16:46Z"}, "message": "[PATCH][AARCH64]Use mov for add with large immediate.\n\ngcc/\n\n2015-05-05  Renlin Li  <renlin.li@arm.com>\n\n\t* config/aarch64/aarch64.md (add<mode>3): Use mov when allowed.\n\nFrom-SVN: r222800", "tree": {"sha": "2d2d560bae7b3ce85372ddce13bd7c7e76c5de73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d2d560bae7b3ce85372ddce13bd7c7e76c5de73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/53e38f0275f495b20e274cedeaf8647b8005feca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53e38f0275f495b20e274cedeaf8647b8005feca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53e38f0275f495b20e274cedeaf8647b8005feca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53e38f0275f495b20e274cedeaf8647b8005feca/comments", "author": null, "committer": null, "parents": [{"sha": "ae8ffbbb8dde0c7c184270865949af463e769826", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae8ffbbb8dde0c7c184270865949af463e769826", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae8ffbbb8dde0c7c184270865949af463e769826"}], "stats": {"total": 32, "additions": 23, "deletions": 9}, "files": [{"sha": "5667dd45f737af394e88ce526dc298bbdf40d21b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/53e38f0275f495b20e274cedeaf8647b8005feca/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/53e38f0275f495b20e274cedeaf8647b8005feca/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=53e38f0275f495b20e274cedeaf8647b8005feca", "patch": "@@ -1,3 +1,7 @@\n+2015-05-05  Renlin Li  <renlin.li@arm.com>\n+\n+\t* config/aarch64/aarch64.md (add<mode>3): Use mov when allowed.\n+\n 2015-05-05  Yvan Roux  <yvan.roux@linaro.org>\n \n \t* config/aarch64/aarch64-elf-raw.h (CA53_ERR_843419_SPEC): Define."}, {"sha": "1c2c5fba4c3a4f7a4136764d3dbed7b5eaa62341", "filename": "gcc/config/aarch64/aarch64.md", "status": "modified", "additions": 19, "deletions": 9, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/53e38f0275f495b20e274cedeaf8647b8005feca/gcc%2Fconfig%2Faarch64%2Faarch64.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/53e38f0275f495b20e274cedeaf8647b8005feca/gcc%2Fconfig%2Faarch64%2Faarch64.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64.md?ref=53e38f0275f495b20e274cedeaf8647b8005feca", "patch": "@@ -1414,18 +1414,28 @@\n   \"\n   if (! aarch64_plus_operand (operands[2], VOIDmode))\n     {\n-      rtx subtarget = ((optimize && can_create_pseudo_p ())\n-\t\t       ? gen_reg_rtx (<MODE>mode) : operands[0]);\n       HOST_WIDE_INT imm = INTVAL (operands[2]);\n \n-      if (imm < 0)\n-\timm = -(-imm & ~0xfff);\n+      if (aarch64_move_imm (imm, <MODE>mode) && can_create_pseudo_p ())\n+        {\n+\t  rtx tmp = gen_reg_rtx (<MODE>mode);\n+\t  emit_move_insn (tmp, operands[2]);\n+\t  operands[2] = tmp;\n+        }\n       else\n-        imm &= ~0xfff;\n-\n-      emit_insn (gen_add<mode>3 (subtarget, operands[1], GEN_INT (imm)));\n-      operands[1] = subtarget;\n-      operands[2] = GEN_INT (INTVAL (operands[2]) - imm);\n+        {\n+\t  rtx subtarget = ((optimize && can_create_pseudo_p ())\n+\t\t\t   ? gen_reg_rtx (<MODE>mode) : operands[0]);\n+\n+\t  if (imm < 0)\n+\t    imm = -(-imm & ~0xfff);\n+\t  else\n+\t    imm &= ~0xfff;\n+\n+\t  emit_insn (gen_add<mode>3 (subtarget, operands[1], GEN_INT (imm)));\n+\t  operands[1] = subtarget;\n+\t  operands[2] = GEN_INT (INTVAL (operands[2]) - imm);\n+        }\n     }\n   \"\n )"}]}