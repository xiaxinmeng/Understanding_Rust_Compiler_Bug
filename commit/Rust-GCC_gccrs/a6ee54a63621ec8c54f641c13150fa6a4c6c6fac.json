{"sha": "a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTZlZTU0YTYzNjIxZWM4YzU0ZjY0MWMxMzE1MGZhNmE0YzZjNmZhYw==", "commit": {"author": {"name": "Francis Kung", "email": "fkung@redhat.com", "date": "2007-04-28T01:58:23Z"}, "committer": {"name": "Thomas Fitzsimmons", "email": "fitzsim@gcc.gnu.org", "date": "2007-04-28T01:58:23Z"}, "message": "2007-04-04  Francis Kung  <fkung@redhat.com>\n\n        * gnu/java/awt/peer/gtk/ComponentGraphics.java\n        (cairoDrawGlyphVector): Removed method.\n        (cairoSetFont): Removed method.\n        (disposeNative): Removed method.\n        * native/jni/gtk-peer/gnu_java_awt_peer_gtk_CairoGraphics2D.c\n        (Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoDrawGlyphVector): Added\n        locking.\n        (Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoSetFont): Added locking.\n        (Java_gnu_java_awt_peer_gtk_CairoGraphics2D_disposeNative): Added locking.\n\nFrom-SVN: r124251", "tree": {"sha": "bd7fc58030fed2d59ec96166c27e6a9cfcd46c71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bd7fc58030fed2d59ec96166c27e6a9cfcd46c71"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/comments", "author": null, "committer": null, "parents": [{"sha": "9898e8391f88fc5b583fc27a4d2fa3bdfd13f396", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9898e8391f88fc5b583fc27a4d2fa3bdfd13f396", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9898e8391f88fc5b583fc27a4d2fa3bdfd13f396"}], "stats": {"total": 77, "additions": 32, "deletions": 45}, "files": [{"sha": "ad9f90829124e721cca478a952abed07f4f06dbd", "filename": "libjava/classpath/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2FChangeLog?ref=a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "patch": "@@ -1,3 +1,15 @@\n+2007-04-04  Francis Kung  <fkung@redhat.com>\n+\n+\t* gnu/java/awt/peer/gtk/ComponentGraphics.java\n+\t(cairoDrawGlyphVector): Removed method.\n+\t(cairoSetFont): Removed method.\n+\t(disposeNative): Removed method.\n+\t* native/jni/gtk-peer/gnu_java_awt_peer_gtk_CairoGraphics2D.c\n+\t(Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoDrawGlyphVector): Added\n+\tlocking.\n+\t(Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoSetFont): Added locking.\n+\t(Java_gnu_java_awt_peer_gtk_CairoGraphics2D_disposeNative): Added locking.\n+\n 2007-04-27  Keith Seitz  <keiths@redhat.com>\n \n \t* gnu/classpath/jdwp/event/EventManager.java"}, {"sha": "8adf275ad442634b8338c1e09bfe72487ad93e6b", "filename": "libjava/classpath/gnu/java/awt/peer/gtk/ComponentGraphics.java", "status": "modified", "additions": 11, "deletions": 44, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.java?ref=a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "patch": "@@ -544,6 +544,17 @@ protected ColorModel getNativeCM()\n    * methods ends up being called, we will deadlock.  The lock is only reentrant\n    * when called via our lock() method. \n    */\n+  \n+  /* These methods are already locked in the superclass CairoGraphics2D\n+   * so they do not need to be overridden:\n+   * \n+   * public void disposeNative\n+   *\n+   * protected void cairoDrawGlyphVector\n+   * \n+   * protected void cairoSetFont\n+   */\n+  \n   @Override\n   protected long init(long pointer)\n   {\n@@ -562,20 +573,6 @@ protected long init(long pointer)\n     return ret;\n   }\n   \n-  @Override\n-  public void disposeNative(long pointer)\n-  {\n-    try\n-    {\n-      lock();\n-      super.disposeNative(pointer);\n-    }\n-    finally\n-    {\n-      unlock();\n-    }\n-  }\n-  \n   @Override\n   protected void drawPixels(long pointer, int[] pixels, int w, int h,\n                             int stride, double[] i2u, double alpha,\n@@ -727,36 +724,6 @@ protected void cairoSetDash(long pointer, double[] dashes, int ndash,\n     }\n   }\n   \n-  @Override\n-  protected void cairoDrawGlyphVector(long pointer, GdkFontPeer font,\n-                                      float x, float y, int n,\n-                                      int[] codes, float[] positions)\n-  {\n-    try\n-    {\n-      lock();\n-      super.cairoDrawGlyphVector(pointer, font, x, y, n, codes, positions);\n-    }\n-    finally\n-    {\n-      unlock();\n-    }\n-  }\n-  \n-  @Override\n-  protected void cairoSetFont(long pointer, GdkFontPeer font)\n-  {\n-    try\n-    {\n-      lock();\n-      super.cairoSetFont(pointer, font);\n-    }\n-    finally\n-    {\n-      unlock();\n-    }\n-  }\n-  \n   @Override\n   protected void cairoRectangle(long pointer, double x, double y,\n                                 double width, double height)"}, {"sha": "c5d4d0090941773b8b30a1af724968b482057a02", "filename": "libjava/classpath/lib/gnu/java/awt/peer/gtk/ComponentGraphics.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2Flib%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2Flib%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fgnu%2Fjava%2Fawt%2Fpeer%2Fgtk%2FComponentGraphics.class?ref=a6ee54a63621ec8c54f641c13150fa6a4c6c6fac"}, {"sha": "2da68e0e4e07a797fa03d45d8deb86566cd89c22", "filename": "libjava/classpath/native/jni/gtk-peer/gnu_java_awt_peer_gtk_CairoGraphics2D.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2Fnative%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_CairoGraphics2D.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6ee54a63621ec8c54f641c13150fa6a4c6c6fac/libjava%2Fclasspath%2Fnative%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_CairoGraphics2D.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fnative%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_CairoGraphics2D.c?ref=a6ee54a63621ec8c54f641c13150fa6a4c6c6fac", "patch": "@@ -87,7 +87,11 @@ Java_gnu_java_awt_peer_gtk_CairoGraphics2D_disposeNative\n     return;\n \n   if (gr->cr)\n-    cairo_destroy (gr->cr);\n+    {\n+      gdk_threads_enter();\n+      cairo_destroy (gr->cr);\n+      gdk_threads_leave();\n+    }\n \n   if (gr->pattern)\n     cairo_pattern_destroy (gr->pattern);\n@@ -343,9 +347,11 @@ Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoDrawGlyphVector\n   (*env)->ReleaseFloatArrayElements (env, java_positions, native_positions, 0);\n   (*env)->ReleaseIntArrayElements (env, java_codes, native_codes, 0);\n \n+  gdk_threads_enter ();\n   pango_fc_font_lock_face( (PangoFcFont *)pfont->font );\n   cairo_show_glyphs (gr->cr, glyphs, n);\n   pango_fc_font_unlock_face( (PangoFcFont *)pfont->font );\n+  gdk_threads_leave ();\n \n   g_free(glyphs);\n }\n@@ -367,6 +373,7 @@ Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoSetFont\n   pfont = (struct peerfont *)NSA_GET_FONT_PTR (env, font);\n   g_assert (pfont != NULL);\n \n+  gdk_threads_enter();\n   face = pango_fc_font_lock_face( (PangoFcFont *)pfont->font );\n   g_assert (face != NULL);\n \n@@ -380,6 +387,7 @@ Java_gnu_java_awt_peer_gtk_CairoGraphics2D_cairoSetFont\n                        \n   cairo_font_face_destroy (ft);\n   pango_fc_font_unlock_face((PangoFcFont *)pfont->font);\n+  gdk_threads_leave();\n }\n \n JNIEXPORT void JNICALL"}]}