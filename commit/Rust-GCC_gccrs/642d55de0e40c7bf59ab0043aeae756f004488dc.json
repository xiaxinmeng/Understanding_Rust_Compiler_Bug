{"sha": "642d55de0e40c7bf59ab0043aeae756f004488dc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjQyZDU1ZGUwZTQwYzdiZjU5YWIwMDQzYWVhZTc1NmYwMDQ0ODhkYw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2010-06-09T21:49:44Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2010-06-09T21:49:44Z"}, "message": "re PR rtl-optimization/42461 (missed optimization for pure functions)\n\n\tPR rtl-optimization/42461\n\t* dce.c (deletable_insn_p): Return true for const or pure calls again.\n\t* except.c (insn_could_throw_p): Return false if !flag_exceptions.\n\nFrom-SVN: r160507", "tree": {"sha": "94bae21be77c1e10d071c24ca7c48b99738ab87d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94bae21be77c1e10d071c24ca7c48b99738ab87d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/642d55de0e40c7bf59ab0043aeae756f004488dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/642d55de0e40c7bf59ab0043aeae756f004488dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/642d55de0e40c7bf59ab0043aeae756f004488dc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/642d55de0e40c7bf59ab0043aeae756f004488dc/comments", "author": null, "committer": null, "parents": [{"sha": "70987f6299983c5a764c37827a95f71f831087f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70987f6299983c5a764c37827a95f71f831087f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70987f6299983c5a764c37827a95f71f831087f0"}], "stats": {"total": 46, "additions": 36, "deletions": 10}, "files": [{"sha": "409e3ca62e6d942ae79bbc4b43593bcf77b539be", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=642d55de0e40c7bf59ab0043aeae756f004488dc", "patch": "@@ -1,3 +1,9 @@\n+2010-06-09  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\tPR rtl-optimization/42461\n+\t* dce.c (deletable_insn_p): Return true for const or pure calls again.\n+\t* except.c (insn_could_throw_p): Return false if !flag_exceptions.\n+\n 2010-06-09  Jan Hubicka  <jh@suse.cz>\n \n \t* bitmap.c (bitmap_and): Walk array forward."}, {"sha": "ee18b58c4ab87c9f9547b6d3b6e4b9e94b0c252d", "filename": "gcc/dce.c", "status": "modified", "additions": 8, "deletions": 8, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Fdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Fdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdce.c?ref=642d55de0e40c7bf59ab0043aeae756f004488dc", "patch": "@@ -94,14 +94,6 @@ deletable_insn_p (rtx insn, bool fast, bitmap arg_stores)\n   rtx body, x;\n   int i;\n \n-  /* Don't delete jumps, notes and the like.  */\n-  if (!NONJUMP_INSN_P (insn))\n-    return false;\n-\n-  /* Don't delete insns that can throw.  */\n-  if (!insn_nothrow_p (insn))\n-    return false;\n-\n   if (CALL_P (insn)\n       /* We cannot delete calls inside of the recursive dce because\n \t this may cause basic blocks to be deleted and this messes up\n@@ -116,6 +108,14 @@ deletable_insn_p (rtx insn, bool fast, bitmap arg_stores)\n \t  && !RTL_LOOPING_CONST_OR_PURE_CALL_P (insn)))\n     return find_call_stack_args (insn, false, fast, arg_stores);\n \n+  /* Don't delete jumps, notes and the like.  */\n+  if (!NONJUMP_INSN_P (insn))\n+    return false;\n+\n+  /* Don't delete insns that can throw.  */\n+  if (!insn_nothrow_p (insn))\n+    return false;\n+\n   body = PATTERN (insn);\n   switch (GET_CODE (body))\n     {"}, {"sha": "16a02473a12bc6028114ebe822a0786b276c111b", "filename": "gcc/except.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Fexcept.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Fexcept.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexcept.c?ref=642d55de0e40c7bf59ab0043aeae756f004488dc", "patch": "@@ -1617,6 +1617,8 @@ make_reg_eh_region_note_nothrow_nononlocal (rtx insn)\n bool\n insn_could_throw_p (const_rtx insn)\n {\n+  if (!flag_exceptions)\n+    return false;\n   if (CALL_P (insn))\n     return true;\n   if (INSN_P (insn) && cfun->can_throw_non_call_exceptions)"}, {"sha": "1f4d5527d1725457c2d5ded0f69d31462f4824e8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=642d55de0e40c7bf59ab0043aeae756f004488dc", "patch": "@@ -1,7 +1,11 @@\n+2010-06-09  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc.dg/pr42461.c: New test.\n+\n 2010-06-09  Daniel Franke  <franke.daniel@gmail.com>\n \n-        PR fortran/44347\n-        * gfortran.dg/selected_real_kind_1.f90: New.\n+\tPR fortran/44347\n+\t* gfortran.dg/selected_real_kind_1.f90: New.\n \n 2010-06-09  Daniel Franke  <franke.daniel@gmail.com>\n "}, {"sha": "9d23ad972926a2bdad342518d26555cfee2a68e5", "filename": "gcc/testsuite/gcc.dg/pr42461.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42461.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/642d55de0e40c7bf59ab0043aeae756f004488dc/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42461.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr42461.c?ref=642d55de0e40c7bf59ab0043aeae756f004488dc", "patch": "@@ -0,0 +1,14 @@\n+/* PR rtl-optimization/42461 */\n+/* Reported by Patrick Pelissier <patrick.pelissier@gmail.com> */\n+\n+/* { dg-do link } */\n+/* { dg-options \"-O\" } */\n+\n+extern int link_failure (int) __attribute__ ((pure));\n+\n+int main (void)\n+{\n+  if (link_failure (0) < 1)\n+    __builtin_unreachable ();\n+  return 0;\n+}"}]}