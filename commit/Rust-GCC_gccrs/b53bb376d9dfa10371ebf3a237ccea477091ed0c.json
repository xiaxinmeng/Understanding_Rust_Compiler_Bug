{"sha": "b53bb376d9dfa10371ebf3a237ccea477091ed0c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjUzYmIzNzZkOWRmYTEwMzcxZWJmM2EyMzdjY2VhNDc3MDkxZWQwYw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2002-05-26T03:38:37Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2002-05-26T03:38:37Z"}, "message": "c-pragma.c (apply_pragma_weak): Convert value identifier to string for decl_attributes.\n\n        * c-pragma.c (apply_pragma_weak): Convert value identifier to\n        string for decl_attributes.\n        (handle_pragma_weak): Call assemble_alias if we're modifying\n        an existing decl.\n\nFrom-SVN: r53884", "tree": {"sha": "c8dc7fde9389dae3158d0518dd428fab00360346", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c8dc7fde9389dae3158d0518dd428fab00360346"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b53bb376d9dfa10371ebf3a237ccea477091ed0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b53bb376d9dfa10371ebf3a237ccea477091ed0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b53bb376d9dfa10371ebf3a237ccea477091ed0c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b53bb376d9dfa10371ebf3a237ccea477091ed0c/comments", "author": null, "committer": null, "parents": [{"sha": "94fdf99db022bc426a4d27a5aef89a093bb3cffc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94fdf99db022bc426a4d27a5aef89a093bb3cffc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94fdf99db022bc426a4d27a5aef89a093bb3cffc"}], "stats": {"total": 52, "additions": 48, "deletions": 4}, "files": [{"sha": "34ab44dd5a61cbbea12e57157fd4a1f6346936e9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53bb376d9dfa10371ebf3a237ccea477091ed0c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53bb376d9dfa10371ebf3a237ccea477091ed0c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b53bb376d9dfa10371ebf3a237ccea477091ed0c", "patch": "@@ -1,3 +1,10 @@\n+2002-05-25  Richard Henderson  <rth@redhat.com>\n+\n+\t* c-pragma.c (apply_pragma_weak): Convert value identifier to\n+\tstring for decl_attributes.\n+\t(handle_pragma_weak): Call assemble_alias if we're modifying\n+\tan existing decl.\n+\n 2002-05-25  Richard Henderson  <rth@redhat.com>\n \n \tPR target/6788"}, {"sha": "1a016b8b2201982498daaf658cb5217ba73a29db", "filename": "gcc/c-pragma.c", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53bb376d9dfa10371ebf3a237ccea477091ed0c/gcc%2Fc-pragma.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53bb376d9dfa10371ebf3a237ccea477091ed0c/gcc%2Fc-pragma.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-pragma.c?ref=b53bb376d9dfa10371ebf3a237ccea477091ed0c", "patch": "@@ -283,9 +283,14 @@ apply_pragma_weak (decl, value)\n      tree decl, value;\n {\n   if (value)\n-    decl_attributes (&decl, build_tree_list (get_identifier (\"alias\"),\n-\t\t\t\t             build_tree_list (NULL, value)),\n-\t\t     0);\n+    {\n+      value = build_string (IDENTIFIER_LENGTH (value),\n+\t\t\t    IDENTIFIER_POINTER (value));\n+      decl_attributes (&decl, build_tree_list (get_identifier (\"alias\"),\n+\t\t\t\t\t       build_tree_list (NULL, value)),\n+\t\t       0);\n+    }\n+\n   if (SUPPORTS_WEAK && DECL_EXTERNAL (decl) && TREE_USED (decl)\n       && TREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (decl)))\n     warning_with_decl (decl, \"applying #pragma weak `%s' after first use results in unspecified behavior\");\n@@ -342,7 +347,11 @@ handle_pragma_weak (dummy)\n \n   decl = identifier_global_value (name);\n   if (decl && TREE_CODE_CLASS (TREE_CODE (decl)) == 'd')\n-    apply_pragma_weak (decl, value);\n+    {\n+      apply_pragma_weak (decl, value);\n+      if (value)\n+\tassemble_alias (decl, value);\n+    }\n   else\n     pending_weaks = tree_cons (name, value, pending_weaks);\n }"}, {"sha": "dd5f6256693fe5cee3b1ddf2469c2773cd2931c3", "filename": "gcc/testsuite/gcc.dg/weak-9.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53bb376d9dfa10371ebf3a237ccea477091ed0c/gcc%2Ftestsuite%2Fgcc.dg%2Fweak-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53bb376d9dfa10371ebf3a237ccea477091ed0c/gcc%2Ftestsuite%2Fgcc.dg%2Fweak-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fweak-9.c?ref=b53bb376d9dfa10371ebf3a237ccea477091ed0c", "patch": "@@ -0,0 +1,28 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fno-common\" } */\n+\n+/* COFF does not support weak, and dg doesn't support UNSUPPORTED.  */\n+/* { dg-do compile { xfail *-*-coff i?86-pc-cygwin h8300-*-hms } } */\n+\n+/* { dg-final { global target_triplet } } */\n+/* { dg-final { if [string match h8300-*-hms $target_triplet ] {return} } } */\n+/* { dg-final { if [string match i?86-pc-cygwin $target_triplet ] {return} } } *\n+/\n+/* { dg-final { if [string match *-*-coff $target_triplet ] {return} } } */\n+/* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?f1\" } } */\n+/* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?f2\" } } */\n+/* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?f3\" } } */\n+/* { dg-final { scan-assembler \"weak\\[^ \\t\\]*\\[ \\t\\]_?f4\" } } */\n+/* { dg-final { scan-assembler \"notf1\" } } */\n+/* { dg-final { scan-assembler \"notf2\" } } */\n+/* { dg-final { scan-assembler \"notf3\" } } */\n+/* { dg-final { scan-assembler \"notf4\" } } */\n+\n+void f1() __attribute__((weak, alias(\"notf1\")));\n+void f2() __attribute__((alias(\"notf2\"), weak));\n+\n+#pragma weak f3=notf3\n+void f3();\n+\n+void f4();\n+#pragma weak f4=notf4"}]}