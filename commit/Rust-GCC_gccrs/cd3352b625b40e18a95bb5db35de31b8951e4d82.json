{"sha": "cd3352b625b40e18a95bb5db35de31b8951e4d82", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2QzMzUyYjYyNWI0MGUxOGE5NWJiNWRiMzVkZTMxYjg5NTFlNGQ4Mg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2005-06-01T19:58:25Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2005-06-01T19:58:25Z"}, "message": "re PR libgcj/21785 (ClassNotFound during deserialization)\n\n\tPR libgcj/21785:\n\t* java/io/natObjectInputStream.cc (currentClassLoader): Removed.\n\t(currentLoader): New method.\n\t* java/io/ObjectInputStream.java (resolveProxyClass): Use\n\tcurrentLoader.\n\t(currentLoader): Now native.\n\t(currentClassLoader): Removed.\n\t* testsuite/libjava.lang/pr21785.java: New file.\n\t* testsuite/libjava.lang/pr21785.out: New file.\n\nFrom-SVN: r100462", "tree": {"sha": "12419b4dbd84dc19200216a422ba5bca825d6f32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/12419b4dbd84dc19200216a422ba5bca825d6f32"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd3352b625b40e18a95bb5db35de31b8951e4d82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd3352b625b40e18a95bb5db35de31b8951e4d82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd3352b625b40e18a95bb5db35de31b8951e4d82", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd3352b625b40e18a95bb5db35de31b8951e4d82/comments", "author": null, "committer": null, "parents": [{"sha": "c3a29423de8cfb7e2b5642b9d44eb21e4b286aec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3a29423de8cfb7e2b5642b9d44eb21e4b286aec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3a29423de8cfb7e2b5642b9d44eb21e4b286aec"}], "stats": {"total": 80, "additions": 46, "deletions": 34}, "files": [{"sha": "a22d52061c097c659f0bd60348f39e44edff9b69", "filename": "libjava/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=cd3352b625b40e18a95bb5db35de31b8951e4d82", "patch": "@@ -1,3 +1,15 @@\n+2005-06-01  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR libgcj/21785:\n+\t* java/io/natObjectInputStream.cc (currentClassLoader): Removed.\n+\t(currentLoader): New method.\n+\t* java/io/ObjectInputStream.java (resolveProxyClass): Use\n+\tcurrentLoader.\n+\t(currentLoader): Now native.\n+\t(currentClassLoader): Removed.\n+\t* testsuite/libjava.lang/pr21785.java: New file.\n+\t* testsuite/libjava.lang/pr21785.out: New file.\n+\n 2005-06-01  Tom Tromey  <tromey@redhat.com>\n \n \tPR libgcj/21753:"}, {"sha": "0a97486d1bbdbd8ddfd3d8bdda4240ad6ea6e049", "filename": "libjava/java/io/ObjectInputStream.java", "status": "modified", "additions": 5, "deletions": 29, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Fjava%2Fio%2FObjectInputStream.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Fjava%2Fio%2FObjectInputStream.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FObjectInputStream.java?ref=cd3352b625b40e18a95bb5db35de31b8951e4d82", "patch": "@@ -783,21 +783,11 @@ protected Class resolveClass(ObjectStreamClass osc)\n   }\n \n   /**\n-   * This method invokes the method currentClassLoader for the\n-   * current security manager (or build an empty one if it is not\n-   * present).\n-   *\n-   * @return The most recent non-system ClassLoader on the execution stack.\n-   * @see java.lang.SecurityManager#currentClassLoader()\n+   * Returns he most recent user defined ClassLoader on the execution stack\n+   * or null of none is found.\n    */\n-  private ClassLoader currentLoader()\n-  {\n-    SecurityManager sm = System.getSecurityManager();\n-    if (sm == null)\n-      sm = new SecurityManager () {};\n-    \n-    return currentClassLoader(sm);\n-  }\n+  // GCJ LOCAL: native method.\n+  private native ClassLoader currentLoader();\n \n   /**\n    * Lookup a class stored in the local hashtable. If it is not\n@@ -883,12 +873,7 @@ protected Object resolveObject(Object obj) throws IOException\n   protected Class resolveProxyClass(String[] intfs)\n     throws IOException, ClassNotFoundException\n   {\n-    SecurityManager sm = System.getSecurityManager();\n-    \n-    if (sm == null)\n-      sm = new SecurityManager() {};\n-    \n-    ClassLoader cl = currentClassLoader(sm);\n+    ClassLoader cl = currentLoader();\n     \n     Class[] clss = new Class[intfs.length];\n     if(cl == null)\n@@ -1866,15 +1851,6 @@ private void invokeValidators() throws InvalidObjectException\n       }\n   }\n \n-  /**\n-   * This native method is used to get access to the protected method\n-   * of the same name in SecurityManger.\n-   *\n-   * @param sm SecurityManager instance which should be called.\n-   * @return The current class loader in the calling stack.\n-   */\n-  private static native ClassLoader currentClassLoader (SecurityManager sm);\n-\n   private void callReadMethod (Method readObject, Class klass, Object obj)\n     throws ClassNotFoundException, IOException\n   {"}, {"sha": "2d1a55665d1e1b6098a9bd61d68f844a40e95bb1", "filename": "libjava/java/io/natObjectInputStream.cc", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Fjava%2Fio%2FnatObjectInputStream.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Fjava%2Fio%2FnatObjectInputStream.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FnatObjectInputStream.cc?ref=cd3352b625b40e18a95bb5db35de31b8951e4d82", "patch": "@@ -1,6 +1,6 @@\n // natObjectInputStream.cc - Native part of ObjectInputStream class.\n \n-/* Copyright (C) 1998, 1999, 2000, 2001  Free Software Foundation\n+/* Copyright (C) 1998, 1999, 2000, 2001, 2005  Free Software Foundation\n \n    This ObjectInputStream is part of libgcj.\n \n@@ -24,6 +24,7 @@ details.  */\n #include <java/lang/SecurityManager.h>\n #include <java/lang/reflect/Constructor.h>\n #include <java/lang/reflect/Method.h>\n+#include <java-stack.h>\n \n #ifdef DEBUG\n #include <java/lang/System.h>\n@@ -69,9 +70,11 @@ java::io::ObjectInputStream::allocateObject (jclass klass, jclass,\n   return obj;\n }\n \n-java::lang::ClassLoader*\n-java::io::ObjectInputStream::currentClassLoader (::java::lang::SecurityManager *sm)\n+java::lang::ClassLoader *\n+java::io::ObjectInputStream::currentLoader ()\n {\n-  return sm->currentClassLoader ();\n+  jclass caller = _Jv_StackTrace::GetCallingClass (&ObjectInputStream::class$);\n+  if (caller)\n+    return caller->getClassLoaderInternal();\n+  return NULL;\n }\n-"}, {"sha": "7869754977aa4ee30d134f0ba1a677a08a288c37", "filename": "libjava/testsuite/libjava.lang/pr21785.java", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Ftestsuite%2Flibjava.lang%2Fpr21785.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Ftestsuite%2Flibjava.lang%2Fpr21785.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2Flibjava.lang%2Fpr21785.java?ref=cd3352b625b40e18a95bb5db35de31b8951e4d82", "patch": "@@ -0,0 +1,21 @@\n+import java.io.*;\n+\n+public class pr21785 implements Serializable\n+{\n+  public static void main(String[] args)\n+  {\n+    try {\n+      ByteArrayOutputStream outb = new ByteArrayOutputStream();\n+      ObjectOutputStream outs = new ObjectOutputStream(outb);\n+      outs.writeObject(new pr21785());\n+      byte[] store = outb.toByteArray();\n+\n+      ByteArrayInputStream inb = new ByteArrayInputStream(store);\n+      ObjectInputStream ins = new ObjectInputStream(inb);\n+      ins.readObject();\n+    }\n+    catch (Throwable e) {\n+      throw new Error(e);\n+    }\n+  }\n+}"}, {"sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391", "filename": "libjava/testsuite/libjava.lang/pr21785.out", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Ftestsuite%2Flibjava.lang%2Fpr21785.out", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd3352b625b40e18a95bb5db35de31b8951e4d82/libjava%2Ftestsuite%2Flibjava.lang%2Fpr21785.out", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2Flibjava.lang%2Fpr21785.out?ref=cd3352b625b40e18a95bb5db35de31b8951e4d82"}]}