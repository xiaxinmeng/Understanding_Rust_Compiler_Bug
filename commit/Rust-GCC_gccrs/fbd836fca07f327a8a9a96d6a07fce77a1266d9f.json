{"sha": "fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmJkODM2ZmNhMDdmMzI3YThhOWE5NmQ2YTA3ZmNlNzdhMTI2NmQ5Zg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@cygnus.com", "date": "1998-10-08T23:32:31Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1998-10-08T23:32:31Z"}, "message": "Various libtool updates from devo, including update to libtool 1.2b\n\nFrom-SVN: r22947", "tree": {"sha": "f0003a1d26ef1ee9ee657a00c8394b216eb56a7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f0003a1d26ef1ee9ee657a00c8394b216eb56a7e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/comments", "author": null, "committer": null, "parents": [{"sha": "8af142753690529708d7da54d2a5a371ecd6d406", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8af142753690529708d7da54d2a5a371ecd6d406", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8af142753690529708d7da54d2a5a371ecd6d406"}], "stats": {"total": 795, "additions": 513, "deletions": 282}, "files": [{"sha": "9f67a401a05129c733550dd9954b0e304b6d4799", "filename": "ChangeLog", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "patch": "@@ -115,6 +115,24 @@ Fri Jul 17 13:30:18 1998  Ian Lance Taylor  <ian@cygnus.com>\n         * ylwrap: Don't use a full path name if the source file is in the\n         same directory.  From hjl@lucon.org (H.J. Lu).\n \n+Tue Jul 14 13:22:18 1998  Ian Lance Taylor  <ian@cygnus.com>\n+\n+\t* ltmain.sh: Add some hacks to make SunOS --enable-shared work\n+\twhen using GNU ld.\n+\n+Fri Jul 10 13:18:23 1998  Ian Lance Taylor  <ian@cygnus.com>\n+\n+\t* ltmain.sh: Correct install when using a different shell.\n+\n+Tue Jul  7 15:24:38 1998  Ian Lance Taylor  <ian@cygnus.com>\n+\n+\t* ltconfig, ltmain.sh: Update to libtool 1.2b.\n+\n+\n+Wed Jul  1 16:45:21 1998  Ian Lance Taylor  <ian@cygnus.com>\n+\n+\t* ltconfig: Update to correct AIX handling.\n+\n Sat Jun 27 22:46:32 1998  Jeffrey A Law  (law@cygnus.com)\n \n \t* Makefile.in (BASE_FLAGS_TO_PASS): Add TARGET_SUBDIR.\n@@ -175,6 +193,13 @@ Wed Jun 10 11:19:47 1998  Ian Lance Taylor  <ian@cygnus.com>\n \n \t* missing: Update to version from automake 1.3.\n \n+\t* ltmain.sh: On installation, don't get confused if the same name\n+\tappears more than once in the list of library names.\n+\n+Thu May 28 19:31:13 1998  Ian Lance Taylor  <ian@cygnus.com>\n+\n+\t* ltconfig, ltmain.sh: Bring in Visual C++ support.\n+\n Sat May 23 23:44:13 1998  Alexandre Oliva <oliva@dcc.unicamp.br>\n \n \t* Makefile.in (boostrap2-lean, bootstrap3-lean,"}, {"sha": "ef2c23aa78f495dec2c75c6700568c0f33ca4c8d", "filename": "ltconfig", "status": "modified", "additions": 163, "deletions": 67, "changes": 230, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/ltconfig", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/ltconfig", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltconfig?ref=fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "patch": "@@ -27,10 +27,14 @@\n \n # Check that we are running under the correct shell.\n SHELL=${CONFIG_SHELL-/bin/sh}\n-if test \"X$1\" = \"X--no-reexec\"; then\n+echo=echo\n+if test \"X$1\" = X--no-reexec; then\n   # Discard the --no-reexec flag, and continue.\n   shift\n-elif test \"X$SHELL\" != X/bin/sh; then\n+elif test \"X`($echo '\\t') 2>/dev/null`\" = 'X\\t'; then\n+  # Yippee, $echo works!\n+  :\n+else\n   # Restart under the correct shell.\n   exec \"$SHELL\" \"$0\" --no-reexec ${1+\"$@\"}\n fi\n@@ -39,9 +43,7 @@ fi\n # if CDPATH is set.\n if test \"${CDPATH+set}\" = set; then CDPATH=; export CDPATH; fi\n \n-echo=echo\n-if test \"X`($echo '\\t') 2>/dev/null`\" = 'X\\t'; then :\n-else\n+if test \"X`($echo '\\t') 2>/dev/null`\" != 'X\\t'; then\n   # The Solaris, AIX, and Digital Unix default echo programs unquote\n   # backslashes.  This makes it impossible to quote backslashes using\n   #   echo \"$something\" | sed 's/\\\\/\\\\\\\\/g'\n@@ -61,16 +63,15 @@ else\n     if test \"X`(print -r '\\t') 2>/dev/null`\" = 'X\\t'; then\n       # This shell has a builtin print -r that does the trick.\n       echo='print -r'\n-#    elif test -f /bin/ksh && test \"X$CONFIG_SHELL\" != X/bin/ksh; then\n-#      # If we have ksh, try running ltconfig again with it.\n-#      CONFIG_SHELL=/bin/ksh\n-#      export CONFIG_SHELL\n-#      exec \"$CONFIG_SHELL\" \"$0\" --no-reexec ${1+\"$@\"}\n+    elif test -f /bin/ksh && test \"X$CONFIG_SHELL\" != X/bin/ksh; then\n+      # If we have ksh, try running ltconfig again with it.\n+      CONFIG_SHELL=/bin/ksh\n+      export CONFIG_SHELL\n+      exec \"$CONFIG_SHELL\" \"$0\" --no-reexec ${1+\"$@\"}\n     else\n       # Try using printf.\n       echo='printf %s\\n'\n-      if test \"X`($echo '\\t') 2>/dev/null`\" = 'X\\t'; then :\n-      else\n+      if test \"X`($echo '\\t') 2>/dev/null`\" != 'X\\t'; then\n         # Oops.  We lost completely, so just stick with echo.\n         echo=echo\n       fi\n@@ -92,7 +93,7 @@ progname=`$echo \"X$0\" | $Xsed -e 's%^.*/%%'`\n # Constants:\n PROGRAM=ltconfig\n PACKAGE=libtool\n-VERSION=1.2a\n+VERSION=1.2b\n ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.c 1>&5'\n ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.c $LIBS 1>&5'\n rm=\"rm -f\"\n@@ -116,6 +117,8 @@ ofile=\"$default_ofile\"\n verify_host=yes\n with_gcc=no\n with_gnu_ld=no\n+objext=o\n+libext=a\n \n old_AR=\"$AR\"\n old_CC=\"$CC\"\n@@ -225,8 +228,7 @@ if test -z \"$ltmain\"; then\n   exit 1\n fi\n \n-if test -f \"$ltmain\"; then :\n-else\n+if test ! -f \"$ltmain\"; then\n   echo \"$progname: \\`$ltmain' does not exist\" 1>&2\n   echo \"$help\" 1>&2\n   exit 1\n@@ -304,7 +306,7 @@ if test \"$verify_host\" = yes; then\n   ac_config_sub=$ac_aux_dir/config.sub\n \n   # Make sure we can run config.sub.\n-  if $ac_config_sub sun4 >/dev/null 2>&1; then :\n+  if $SHELL $ac_config_sub sun4 >/dev/null 2>&1; then :\n   else\n     echo \"$progname: cannot run $ac_config_sub\" 1>&2\n     echo \"$help\" 1>&2\n@@ -316,14 +318,14 @@ if test \"$verify_host\" = yes; then\n   host_alias=$host\n   case \"$host_alias\" in\n   \"\")\n-    if host_alias=`$ac_config_guess`; then :\n+    if host_alias=`$SHELL $ac_config_guess`; then :\n     else\n       echo \"$progname: cannot guess host type; you must specify one\" 1>&2\n       echo \"$help\" 1>&2\n       exit 1\n     fi ;;\n   esac\n-  host=`$ac_config_sub $host_alias`\n+  host=`$SHELL $ac_config_sub $host_alias`\n   echo \"$ac_t$host\" 1>&6\n \n   # Make sure the host verified.\n@@ -465,15 +467,15 @@ if test \"$with_gcc\" != yes || test -z \"$CC\"; then\n   # Now see if the compiler is really GCC.\n   with_gcc=no\n   echo $ac_n \"checking whether we are using GNU C... $ac_c\" 1>&6\n-  echo \"$progname:468: checking whether we are using GNU C\" >&5\n+  echo \"$progname:470: checking whether we are using GNU C\" >&5\n \n   $rm conftest.c\n   cat > conftest.c <<EOF\n #ifdef __GNUC__\n   yes;\n #endif\n EOF\n-  if { ac_try='${CC-cc} -E conftest.c'; { (eval echo $progname:476: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+  if { ac_try='${CC-cc} -E conftest.c'; { (eval echo $progname:478: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n     with_gcc=yes\n   fi\n   $rm conftest.c\n@@ -484,6 +486,28 @@ fi\n set dummy $CC\n compiler=\"$2\"\n \n+echo $ac_n \"checking for object suffix... $ac_c\" 1>&6\n+$rm conftest*\n+echo 'int i = 1;' > conftest.c\n+echo \"$progname:492: checking for object suffix\" >& 5\n+if { (eval echo $progname:493: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>conftest.err; }; then\n+  # Append any warnings to the config.log.\n+  cat conftest.err 1>&5\n+\n+  for ac_file in conftest.*; do\n+    case $ac_file in\n+    *.c) ;;\n+    *) objext=`echo $ac_file | sed -e s/conftest.//` ;;\n+    esac\n+  done\n+else\n+  cat conftest.err 1>&5\n+  echo \"$progname: failed program was:\" >&5\n+  cat conftest.c >&5\n+fi\n+$rm conftest*\n+echo \"$ac_t$objext\" 1>&6\n+\n echo $ac_n \"checking for $compiler option to produce PIC... $ac_c\" 1>&6\n pic_flag=\n special_shlib_compile_flags=\n@@ -500,7 +524,7 @@ if test \"$with_gcc\" = yes; then\n   aix3* | aix4* | irix5* | irix6* | osf3* | osf4*)\n     # PIC is the default for these OSes.\n     ;;\n-  cygwin32* | os2*)\n+  cygwin32* | mingw32* | os2*)\n     # We can build DLLs from non-PIC.\n     ;;\n   amigaos*)\n@@ -534,7 +558,7 @@ else\n     # PIC (with -KPIC) is the default.\n     ;;\n \n-  cygwin32* | os2*)\n+  cygwin32* | mingw32* | os2*)\n     # We can build DLLs from non-PIC.\n     ;;\n \n@@ -588,8 +612,8 @@ if test -n \"$pic_flag\"; then\n   echo \"int some_variable = 0;\" > conftest.c\n   save_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\"$CFLAGS $pic_flag -DPIC\"\n-  echo \"$progname:591: checking if $compiler PIC flag $pic_flag works\" >&5\n-  if { (eval echo $progname:592: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>conftest.err; } && test -s conftest.o; then\n+  echo \"$progname:615: checking if $compiler PIC flag $pic_flag works\" >&5\n+  if { (eval echo $progname:616: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>conftest.err; } && test -s conftest.$objext; then\n     # Append any warnings to the config.log.\n     cat conftest.err 1>&5\n \n@@ -632,8 +656,8 @@ $rm conftest*\n echo 'main(){return(0);}' > conftest.c\n save_LDFLAGS=\"$LDFLAGS\"\n LDFLAGS=\"$LDFLAGS $link_static_flag\"\n-echo \"$progname:635: checking if $compiler static flag $link_static_flag works\" >&5\n-if { (eval echo $progname:636: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+echo \"$progname:659: checking if $compiler static flag $link_static_flag works\" >&5\n+if { (eval echo $progname:660: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   echo \"$ac_t$link_static_flag\" 1>&6\n else\n   echo \"$ac_t\"none 1>&6\n@@ -665,11 +689,11 @@ if test -z \"$LD\"; then\n   if test \"$with_gcc\" = yes; then\n     # Check if gcc -print-prog-name=ld gives a path.\n     echo $ac_n \"checking for ld used by GCC... $ac_c\" 1>&6\n-    echo \"$progname:668: checking for ld used by GCC\" >&5\n+    echo \"$progname:692: checking for ld used by GCC\" >&5\n     ac_prog=`($CC -print-prog-name=ld) 2>&5`\n     case \"$ac_prog\" in\n     # Accept absolute paths.\n-    /* | [A-Za-z]:\\\\*)\n+    /* | [A-Za-z]:[/\\\\]*)\n       test -z \"$LD\" && LD=\"$ac_prog\"\n       ;;\n     \"\")\n@@ -683,10 +707,10 @@ if test -z \"$LD\"; then\n     esac\n   elif test \"$with_gnu_ld\" = yes; then\n     echo $ac_n \"checking for GNU ld... $ac_c\" 1>&6\n-    echo \"$progname:686: checking for GNU ld\" >&5\n+    echo \"$progname:710: checking for GNU ld\" >&5\n   else\n     echo $ac_n \"checking for non-GNU ld\"\"... $ac_c\" 1>&6\n-    echo \"$progname:689: checking for non-GNU ld\" >&5\n+    echo \"$progname:713: checking for non-GNU ld\" >&5\n   fi\n \n   if test -z \"$LD\"; then\n@@ -738,12 +762,21 @@ no_undefined_flag=\n archive_cmds=\n old_archive_from_new_cmds=\n export_dynamic_flag_spec=\n+whole_archive_flag_spec=\n hardcode_libdir_flag_spec=\n hardcode_libdir_separator=\n hardcode_direct=no\n hardcode_minus_L=no\n hardcode_shlibpath_var=unsupported\n runpath_var=\n+fix_srcfile_path=\n+\n+case \"$host_os\" in\n+aix3* | aix4*)\n+  # On AIX, the GNU linker works like the native linker.\n+  with_gnu_ld=no\n+  ;;\n+esac\n \n ld_shlibs=yes\n if test \"$with_gnu_ld\" = yes; then\n@@ -758,15 +791,22 @@ if test \"$with_gnu_ld\" = yes; then\n \n   sunos4*)\n     archive_cmds='$LD -assert pure-text -Bstatic -o $lib$libobjs'\n+    hardcode_direct=yes\n+    # The GNU linker will only hardcode -L options if -rpath is not\n+    # used, but we will be using -rpath because we set\n+    # hardcode_libdir_flag_spec below.\n+    hardcode_minus_L=no\n+    hardcode_shlibpath_var=no\n     ;;\n \n-  cygwin32*)\n-    # hardcode_libdir_flag_spec is actually meaningless, as there is\n-    # no search path for DLLs.\n-    hardcode_libdir_flag_spec='-L$libdir'\n-    allow_undefined_flag=unsupported\n-    # Very, very bogus.\n-    echo '\n+  cygwin32* | mingw32*)\n+    if test \"$with_gcc\" = yes; then\n+      # hardcode_libdir_flag_spec is actually meaningless, as there is\n+      # no search path for DLLs.\n+      hardcode_libdir_flag_spec='-L$libdir'\n+      allow_undefined_flag=unsupported\n+      # Very, very bogus.\n+      echo '\n #include <windows.h>\n \n struct _reent *_impure_ptr;\n@@ -777,8 +817,26 @@ __dll_entry (HINSTANCE hinst, DWORD reason, LPVOID reserved)\n   _impure_ptr = __imp_reent_data;\n }\n ' > libtool.c\n-    archive_cmds='$CC -c '\"`pwd`\"'/libtool.c;echo EXPORTS > $soname-def;$NM$libobjs | $global_symbol_pipe | sed '\\''s/.* //'\\'' >> $soname-def;$LD -s --base-file $soname-base --dll -e ___dll_entry@12 -o $lib libtool.o$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD -s --base-file $soname-base $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.o$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.o$libobjs$deplibs;$rm libtool.o $soname-base $soname-exp'\n-    old_archive_from_new_cmds='$DLLTOOL --as=$AS --dllname $soname --def $soname-def --output-lib $objdir/$libname.a;$rm $soname-def'\n+      archive_cmds='$CC -c '\"`pwd`\"'/libtool.c;echo EXPORTS > $soname-def;$NM$libobjs | $global_symbol_pipe | sed '\\''s/.* //'\\'' >> $soname-def;$LD -s --base-file $soname-base --dll -e ___dll_entry@12 -o $lib libtool.$objext$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD -s --base-file $soname-base $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.$objext$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.$objext$libobjs$deplibs;$rm libtool.$objext $soname-base $soname-exp'\n+      old_archive_from_new_cmds='$DLLTOOL --as=$AS --dllname $soname --def $soname-def --output-lib $objdir/$libname.a;$rm $soname-def'\n+    else\n+      # When not using gcc, we currently assume that we are using\n+      # Microsoft Visual C++.\n+      with_gnu_ld=no\n+      # hardcode_libdir_flag_spec is actually meaningless, as there is\n+      # no search path for DLLs.\n+      hardcode_libdir_flag_spec=' '\n+      allow_undefined_flag=unsupported\n+      # Tell ltmain to make .lib files, not .a files.\n+      libext=lib\n+      # FIXME: Setting linknames here is a bad hack.\n+      archive_cmds='$CC -o $lib$libobjs`echo \"$deplibs\" | sed -e '\\''s/ -lc$//'\\''` -link -dll;linknames='\n+      # The linker will automatically build a .lib file if we build a DLL.\n+      old_archive_from_new_cmds='true'\n+      # FIXME: Should let the user specify the lib program.\n+      old_archive_cmds='lib /OUT:$oldlib$oldobjs'\n+      fix_srcfile_path='`cygpath -w $srcfile`'\n+    fi\n     ;;\n \n   *)\n@@ -790,10 +848,11 @@ __dll_entry (HINSTANCE hinst, DWORD reason, LPVOID reserved)\n     ;;\n   esac\n \n-  if test \"$ld_shlibs\" = yes; then\n+  if test \"$ld_shlibs\" = yes && test \"$with_gnu_ld\" = yes; then\n     runpath_var=LD_RUN_PATH\n     hardcode_libdir_flag_spec='${wl}--rpath ${wl}$libdir'\n     export_dynamic_flag_spec='${wl}--export-dynamic'\n+    whole_archive_flag_spec='${wl}--whole-archive$convenience ${wl}--no-whole-archive'\n   fi\n else\n   # PORTME fill in a description of your system's linker (not GNU ld)\n@@ -824,13 +883,14 @@ else\n     hardcode_minus_L=yes\n     ;;\n \n-  cygwin32*)\n-    # hardcode_libdir_flag_spec is actually meaningless, as there is\n-    # no search path for DLLs.\n-    hardcode_libdir_flag_spec='-L$libdir'\n-    allow_undefined_flag=unsupported\n-    # Very, very bogus.\n-    echo '\n+  cygwin32* | mingw32*)\n+    if test \"$with_gcc\" = yes; then\n+      # hardcode_libdir_flag_spec is actually meaningless, as there is\n+      # no search path for DLLs.\n+      hardcode_libdir_flag_spec='-L$libdir'\n+      allow_undefined_flag=unsupported\n+      # Very, very bogus.\n+      echo '\n #include <windows.h>\n \n struct _reent *_impure_ptr;\n@@ -841,8 +901,25 @@ __dll_entry (HINSTANCE hinst, DWORD reason, LPVOID reserved)\n   _impure_ptr = __imp_reent_data;\n }\n ' > libtool.c\n-    archive_cmds='$CC -c '\"`pwd`\"'/libtool.c;echo EXPORTS > $soname-def;$NM$libobjs | $global_symbol_pipe | sed '\\''s/.* //'\\'' >> $soname-def;$LD -s --base-file $soname-base --dll -e ___dll_entry@12 -o $lib libtool.o$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD -s --base-file $soname-base $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.o$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.o$libobjs$deplibs;$rm libtool.o $soname-base $soname-exp'\n-    old_archive_from_new_cmds='$DLLTOOL --as=$AS --dllname $soname --def $soname-def --output-lib $objdir/$libname.a;$rm $soname-def'\n+      archive_cmds='$CC -c '\"`pwd`\"'/libtool.c;echo EXPORTS > $soname-def;$NM$libobjs | $global_symbol_pipe | sed '\\''s/.* //'\\'' >> $soname-def;$LD -s --base-file $soname-base --dll -e ___dll_entry@12 -o $lib libtool.$objext$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD -s --base-file $soname-base $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.$objext$libobjs$deplibs;$DLLTOOL --as=$AS --dllname $soname --def $soname-def --base-file $soname-base --output-exp $soname-exp;$LD $soname-exp --dll -e ___dll_entry@12 -o $lib libtool.$objext$libobjs$deplibs;$rm libtool.$objext $soname-base $soname-exp'\n+      old_archive_from_new_cmds='$DLLTOOL --as=$AS --dllname $soname --def $soname-def --output-lib $objdir/$libname.a;$rm $soname-def'\n+    else\n+      # When not using gcc, we currently assume that we are using\n+      # Microsoft Visual C++.\n+      # hardcode_libdir_flag_spec is actually meaningless, as there is\n+      # no search path for DLLs.\n+      hardcode_libdir_flag_spec=' '\n+      allow_undefined_flag=unsupported\n+      # Tell ltmain to make .lib files, not .a files.\n+      libext=lib\n+      # FIXME: Setting linknames here is a bad hack.\n+      archive_cmds='$CC -o $lib$libobjs`echo \"$deplibs\" | sed -e '\\''s/ -lc$//'\\''` -link -dll;linknames='\n+      # The linker will automatically build a .lib file if we build a DLL.\n+      old_archive_from_new_cmds='true'\n+      # FIXME: Should let the user specify the lib program.\n+      old_archive_cmds='lib /OUT:$oldlib$oldobjs'\n+      fix_srcfile_path='`cygpath -w $srcfile`'\n+    fi\n     ;;\n \n   # FreeBSD 2.2.[012] allows us to include c++rt0.o to get C++ constructor\n@@ -870,7 +947,7 @@ __dll_entry (HINSTANCE hinst, DWORD reason, LPVOID reserved)\n     archive_cmds='$CC -shared -o $lib$libobjs'\n     hardcode_libdir_flag_spec='-R$libdir'\n     hardcode_direct=yes\n-    hardcode_minus_L=yes\n+    hardcode_minus_L=no\n     hardcode_shlibpath_var=no\n     ;;\n \n@@ -975,7 +1052,7 @@ echo \"$ac_t$ld_shlibs\" 1>&6\n if test -z \"$NM\"; then\n   echo $ac_n \"checking for BSD-compatible nm... $ac_c\" 1>&6\n   case \"$NM\" in\n-  /* | [A-Za-z]:\\\\*) ;; # Let the user override the test with a path.\n+  /* | [A-Za-z]:[/\\\\]*) ;; # Let the user override the test with a path.\n   *)\n     IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n     for ac_dir in /usr/ucb /usr/ccs/bin $PATH /bin; do\n@@ -1021,7 +1098,7 @@ case \"$host_os\" in\n aix*)\n   symcode='[BCDTU]'\n   ;;\n-cygwin32*)\n+cygwin32* | mingw32*)\n   sympat='_\\([_A-Za-z][_A-Za-z0-9]*\\)'\n   symxfrm='_\\1 \\1'\n   ;;\n@@ -1040,7 +1117,7 @@ if $NM -V 2>&1 | egrep '(GNU|with BFD)' > /dev/null; then\n fi\n \n case \"$host_os\" in\n-cygwin32*)\n+cygwin32* | mingw32*)\n   # We do not want undefined symbols on cygwin32.  The user must\n   # arrange to define them via -l arguments.\n   symcode='[ABCDGISTW]'\n@@ -1065,11 +1142,11 @@ void nm_test_func(){}\n main(){nm_test_var='a';nm_test_func();return(0);}\n EOF\n \n-echo \"$progname:1068: checking if global_symbol_pipe works\" >&5\n-if { (eval echo $progname:1069: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; } && test -s conftest.o; then\n+echo \"$progname:1145: checking if global_symbol_pipe works\" >&5\n+if { (eval echo $progname:1146: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; } && test -s conftest.$objext; then\n   # Now try to grab the symbols.\n   nlist=conftest.nm\n-  if { echo \"$progname:1072: eval \\\"$NM conftest.o | $global_symbol_pipe > $nlist\\\"\" >&5; eval \"$NM conftest.o | $global_symbol_pipe > $nlist 2>&5\"; } && test -s \"$nlist\"; then\n+  if { echo \"$progname:1149: eval \\\"$NM conftest.$objext | $global_symbol_pipe > $nlist\\\"\" >&5; eval \"$NM conftest.$objext | $global_symbol_pipe > $nlist 2>&5\"; } && test -s \"$nlist\"; then\n \n     # Try sorting and uniquifying the output.\n     if sort \"$nlist\" | uniq > \"$nlist\"T; then\n@@ -1122,12 +1199,12 @@ EOF\n #endif\n EOF\n         # Now try linking the two files.\n-        mv conftest.o conftestm.o\n+        mv conftest.$objext conftestm.$objext\n \tsave_LIBS=\"$LIBS\"\n \tsave_CFLAGS=\"$CFLAGS\"\n-        LIBS='conftestm.o'\n+        LIBS=\"conftestm.$objext\"\n \tCFLAGS=\"$CFLAGS$no_builtin_flag\"\n-        if { (eval echo $progname:1130: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+        if { (eval echo $progname:1207: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n           pipe_works=yes\n         else\n           echo \"$progname: failed program was:\" >&5\n@@ -1215,9 +1292,13 @@ amigaos*)\n   finish_eval='for lib in `ls $libdir/*.ixlibrary 2>/dev/null`; do libname=`$echo \"X$lib\" | $Xsed -e '\\''s%^.*/\\([^/]*\\)\\.ixlibrary$%\\1%'\\''`; test $rm /sys/libs/${libname}_ixlibrary.a; $show \"(cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a)\"; (cd /sys/libs && $LN_S $lib ${libname}_ixlibrary.a) || exit 1; done'\n   ;;\n \n-cygwin32*)\n+cygwin32* | mingw32*)\n   version_type=windows\n-  library_names_spec='${libname}`echo ${release} | sed -e 's/[.]/-/g'`${versuffix}.dll $libname.a'\n+  if test \"$with_gcc\" = yes; then\n+    library_names_spec='${libname}`echo ${release} | sed -e 's/[.]/-/g'`${versuffix}.dll $libname.a'\n+  else\n+    library_names_spec='${libname}`echo ${release} | sed -e 's/[.]/-/g'`${versuffix}.dll $libname.lib'\n+  fi\n   dynamic_linker='Win32 ld.exe'\n   shlibpath_var=PATH\n   ;;\n@@ -1230,8 +1311,8 @@ freebsd2* | freebsd3*)\n   ;;\n \n gnu*)\n-  version_type=sunos\n-  library_names_spec='${libname}${release}.so$versuffix'\n+  version_type=linux\n+  library_names_spec='${libname}${release}.so$versuffix ${libname}.so'\n   shlibpath_var=LD_LIBRARY_PATH\n   ;;\n \n@@ -1311,11 +1392,13 @@ solaris2*)\n   library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'\n   soname_spec='${libname}${release}.so$major'\n   shlibpath_var=LD_LIBRARY_PATH\n+  # ldd complains unless libraries are executable\n+  postinstall_cmds='chmod +x $lib'\n   ;;\n \n sunos4*)\n   version_type=sunos\n-  library_names_spec='${libname}${release}.so$versuffix'\n+  library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'\n   finish_cmds='PATH=\"\\$PATH:/usr/etc\" ldconfig $libdir'\n   shlibpath_var=LD_LIBRARY_PATH\n   ;;\n@@ -1386,11 +1469,12 @@ ltecho=\"$echo\"\n for var in ltecho old_CC old_CFLAGS old_CPPFLAGS old_LD old_NM old_RANLIB \\\n   old_LN_S old_DLLTOOL old_AS AR CC LD LN_S NM DLLTOOL AS reload_flag \\\n   reload_cmds wl pic_flag link_static_flag no_builtin_flag \\\n-  export_dynamic_flag_spec libname_spec library_names_spec soname_spec RANLIB \\\n+  export_dynamic_flag_spec whole_archive_flag_spec libname_spec \\\n+  library_names_spec soname_spec RANLIB \\\n   old_archive_cmds old_archive_from_new_cmds old_postinstall_cmds \\\n   old_postuninstall_cmds archive_cmds postinstall_cmds postuninstall_cmds \\\n-  allow_undefined_flag no_undefined_flag \\\n-  finish_cmds finish_eval global_symbol_pipe \\\n+  allow_undefined_flag no_undefined_flag objext libext \\\n+  finish_cmds finish_eval global_symbol_pipe fix_srcfile_path \\\n   hardcode_libdir_flag_spec hardcode_libdir_separator; do\n \n   case \"$var\" in\n@@ -1506,6 +1590,12 @@ reload_cmds=\"$reload_cmds\"\n # How to pass a linker flag through the compiler.\n wl=\"$wl\"\n \n+# Object file suffix (normally \"o\").\n+objext=\"$objext\"\n+\n+# Old archive suffix (normally \"a\").\n+libext=\"$libext\"\n+\n # Additional compiler flags for building library objects.\n pic_flag=\"$pic_flag\"\n \n@@ -1518,6 +1608,9 @@ no_builtin_flag=\"$no_builtin_flag\"\n # Compiler flag to allow reflexive dlopens.\n export_dynamic_flag_spec=\"$export_dynamic_flag_spec\"\n \n+# Compiler flag to generate shared objects directly from archives.\n+whole_archive_flag_spec=\"$whole_archive_flag_spec\"\n+\n # Library versioning type.\n version_type=$version_type\n \n@@ -1587,6 +1680,9 @@ hardcode_minus_L=$hardcode_minus_L\n # Set to yes if using SHLIBPATH_VAR=DIR during linking hardcodes DIR into\n # the resulting binary.\n hardcode_shlibpath_var=$hardcode_shlibpath_var\n+\n+# Fix the shell variable \\$srcfile for the compiler.\n+fix_srcfile_path=\"$fix_srcfile_path\"\n EOF\n \n case \"$host_os\" in"}, {"sha": "eee5763387b3d353de096ab878b1a7a53f2a92e0", "filename": "ltmain.sh", "status": "modified", "additions": 325, "deletions": 215, "changes": 540, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/ltmain.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbd836fca07f327a8a9a96d6a07fce77a1266d9f/ltmain.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ltmain.sh?ref=fbd836fca07f327a8a9a96d6a07fce77a1266d9f", "patch": "@@ -23,14 +23,26 @@\n # configuration script generated by Autoconf, you may include it under\n # the same distribution terms that you use for the rest of that program.\n \n+# Check that we have a working $echo.\n+if test \"X$1\" = X--no-reexec; then\n+  # Discard the --no-reexec flag, and continue.\n+  shift\n+elif test \"X`($echo '\\t') 2>/dev/null`\" = 'X\\t'; then\n+  # Yippee, $echo works!\n+  :\n+else\n+  # Restart under the correct shell, and then maybe $echo will work.\n+  exec $SHELL \"$0\" --no-reexec ${1+\"$@\"}\n+fi\n+\n # The name of this program.\n progname=`$echo \"$0\" | sed 's%^.*/%%'`\n modename=\"$progname\"\n \n # Constants.\n PROGRAM=ltmain.sh\n PACKAGE=libtool\n-VERSION=1.2a\n+VERSION=1.2b\n \n default_mode=\n help=\"Try \\`$progname --help' for more information.\"\n@@ -48,8 +60,13 @@ sed_quote_subst='s/\\([\\\\`\\\\\"$\\\\\\\\]\\)/\\\\\\1/g'\n # Only set LANG and LC_ALL to C if already set.\n # These must not be set unconditionally because not all systems understand\n # e.g. LANG=C (notably SCO).\n-if test \"${LC_ALL+set}\" = set; then LC_ALL=C; export LC_ALL; fi\n-if test \"${LANG+set}\"   = set; then LANG=C;   export LANG;   fi\n+# We save the old values to restore during execute mode.\n+if test \"${LC_ALL+set}\" = set; then\n+  save_LC_ALL=\"$LC_ALL\"; LC_ALL=C; export LC_ALL\n+fi\n+if test \"${LANG+set}\" = set; then\n+  save_LANG=\"$LANG\"; LANG=C; export LANG\n+fi\n \n if test \"$LTCONFIG_VERSION\" != \"$VERSION\"; then\n   echo \"$modename: ltconfig version \\`$LTCONFIG_VERSION' does not match $PROGRAM version \\`$VERSION'\" 1>&2\n@@ -72,6 +89,8 @@ run=\n show=\"$echo\"\n show_help=\n execute_dlfiles=\n+lo2o=\"s/\\\\.lo\\$/.${objext}/\"\n+los2o=\"s/\\\\.lo /.${objext} /g\"\n \n # Parse our command line options once, thoroughly.\n while test $# -gt 0\n@@ -190,7 +209,7 @@ if test -z \"$show_help\"; then\n         esac\n       done\n       ;;\n-    *db | *dbx)\n+    *db | *dbx | *strace | *truss)\n       mode=execute\n       ;;\n     *install*|cp|mv)\n@@ -248,7 +267,6 @@ if test -z \"$show_help\"; then\n \t;;\n \n       -static)\n-\tbuild_libtool_libs=no\n \tbuild_old_libs=yes\n \tcontinue\n \t;;\n@@ -303,7 +321,7 @@ if test -z \"$show_help\"; then\n     libobj=`$echo \"X$libobj\" | $Xsed -e \"s/\\.$xform$/.lo/\"`\n \n     case \"$libobj\" in\n-    *.lo) obj=`$echo \"X$libobj\" | $Xsed -e 's/\\.lo$/.o/'` ;;\n+    *.lo) obj=`$echo \"X$libobj\" | $Xsed -e \"$lo2o\"` ;;\n     *)\n       $echo \"$modename: cannot determine name of library object from \\`$srcfile'\" 1>&2\n       exit 1\n@@ -325,6 +343,10 @@ if test -z \"$show_help\"; then\n       trap \"$run $rm $libobj; exit 1\" 1 2 15\n     fi\n \n+    if test -n \"$fix_srcfile_path\"; then\n+      eval srcfile=\\\"$fix_srcfile_path\\\"\n+    fi\n+\n     # Only build a PIC object if we are building libtool libraries.\n     if test \"$build_libtool_libs\" = yes; then\n       # Without this assignment, base_compile gets emptied.\n@@ -347,7 +369,7 @@ if test -z \"$show_help\"; then\n \n       # Just move the object, then go on to compile the next one\n       $show \"$mv $obj $libobj\"\n-      $run $mv $obj $libobj || exit 1\n+      $run $mv $obj $libobj || exit $?\n \n       # Allow error messages only from the first compilation.\n       suppress_output=' >/dev/null 2>&1'\n@@ -384,10 +406,13 @@ if test -z \"$show_help\"; then\n \n     compile_shlibpath=\n     finalize_shlibpath=\n+    convenience=\n+    old_convenience=\n     deplibs=\n     dlfiles=\n     dlprefiles=\n     export_dynamic=no\n+    generated=\n     hardcode_libdirs=\n     libobjs=\n     link_against_libtool_libs=\n@@ -420,8 +445,10 @@ if test -z \"$show_help\"; then\n     test -n \"$old_archive_from_new_cmds\" && build_old_libs=yes\n \n     # Go through the arguments, transforming them on the way.\n-    for arg\n-    do\n+    while test $# -gt 0; do\n+      arg=\"$1\"\n+      shift\n+\n       # If the previous option needs an argument, assign it.\n       if test -n \"$prev\"; then\n         case \"$prev\" in\n@@ -505,7 +532,7 @@ if test -z \"$show_help\"; then\n       -L*)\n         dir=`$echo \"X$arg\" | $Xsed -e 's%^-L\\(.*\\)$%\\1%'`\n         case \"$dir\" in\n-        /* | [A-Za-z]:\\\\*)\n+        /* | [A-Za-z]:[/\\\\]*)\n \t  # Add the corresponding hardcode_libdir_flag, if it is not identical.\n           ;;\n         *)\n@@ -561,7 +588,7 @@ if test -z \"$show_help\"; then\n \tesac\n         ;;\n \n-      *.o | *.a)\n+      *.o | *.obj | *.a | *.lib)\n         # A standard object.\n         objs=\"$objs $arg\"\n         ;;\n@@ -581,7 +608,7 @@ if test -z \"$show_help\"; then\n \n \tif test \"$prev\" = dlprefiles; then\n \t  # Preload the old-style object.\n-\t  dlprefiles=\"$dlprefiles \"`$echo \"X$arg\" | $Xsed -e 's/\\.lo$/.o/'`\n+\t  dlprefiles=\"$dlprefiles \"`$echo \"X$arg\" | $Xsed -e \"$lo2o\"`\n \t  prev=\n \tfi\n \tlibobjs=\"$libobjs $arg\"\n@@ -608,11 +635,6 @@ if test -z \"$show_help\"; then\n         *) . ./$arg ;;\n         esac\n \n-        if test -z \"$libdir\"; then\n-          $echo \"$modename: \\`$arg' contains no -rpath information\" 1>&2\n-          exit 1\n-        fi\n-\n         # Get the name of the library we link against.\n         linklib=\n         for l in $old_library $library_names; do\n@@ -633,6 +655,15 @@ if test -z \"$show_help\"; then\n           dir=\"$dir/$objdir\"\n         fi\n \n+        if test -z \"$libdir\"; then\n+\t  # It is a libtool convenience library, so add in its objects.\n+\t  convenience=\"$convenience $dir/$old_library\"l\n+\t  old_convenience=\"$old_convenience $dir/$old_library\"\n+\t  compile_command=\"$compile_command $dir/$old_library\"\n+\t  finalize_command=\"$finalize_command $dir/$old_library\"\n+\t  continue\n+\tfi\n+\n         # This library was specified with -dlopen.\n         if test \"$prev\" = dlfiles; then\n           dlfiles=\"$dlfiles $arg\"\n@@ -706,22 +737,30 @@ if test -z \"$show_help\"; then\n           fi\n \n \n+\t  lib_linked=yes\n           case \"$hardcode_action\" in\n-          immediate)\n+          immediate | unsupported)\n             if test \"$hardcode_direct\" = no; then\n               compile_command=\"$compile_command $dir/$linklib\"\n             elif test \"$hardcode_minus_L\" = no; then\n+\t      case \"$host\" in\n+\t      *-*-sunos*)\n+                compile_shlibpath=\"$compile_shlibpath$dir:\"\n+\t\t;;\n+\t      esac\n               compile_command=\"$compile_command -L$dir -l$name\"\n             elif test \"$hardcode_shlibpath_var\" = no; then\n               compile_shlibpath=\"$compile_shlibpath$dir:\"\n               compile_command=\"$compile_command -l$name\"\n+\t    else\n+\t      lib_linked=no\n             fi\n             ;;\n \n           relink)\n             # We need an absolute path.\n             case \"$dir\" in\n-            /* | [A-Za-z]:\\\\*) ;;\n+            /* | [A-Za-z]:[/\\\\]*) ;;\n             *)\n               absdir=`cd \"$dir\" && pwd`\n               if test -z \"$absdir\"; then\n@@ -739,10 +778,21 @@ if test -z \"$show_help\"; then\n             elif test \"$hardcode_shlibpath_var\" = yes; then\n               compile_shlibpath=\"$compile_shlibpath$dir:\"\n               compile_command=\"$compile_command -l$name\"\n+\t    else\n+\t      lib_linked=no\n             fi\n             ;;\n+\n+\t  *)\n+\t    lib_linked=no\n+\t    ;;\n           esac\n \n+\t  if test \"$lib_linked\" != yes; then\n+\t    $echo \"$modename: configuration error: unsupported hardcode properties\"\n+\t    exit 1\n+\t  fi\n+\n           # Finalize command for both is simple: just hardcode it.\n           if test \"$hardcode_direct\" = yes; then\n             finalize_command=\"$finalize_command $libdir/$linklib\"\n@@ -807,14 +857,7 @@ if test -z \"$show_help\"; then\n       exit 1\n     fi\n \n-    if test -n \"$vinfo\" && test -n \"$release\"; then\n-      $echo \"$modename: you cannot specify both \\`-version-info' and \\`-release'\" 1>&2\n-      $echo \"$help\" 1>&2\n-      exit 1\n-    fi\n-\n-    oldlib=\n-    oldobjs=\n+    oldlibs=\n     case \"$output\" in\n     \"\")\n       $echo \"$modename: you must specify an output file\" 1>&2\n@@ -824,24 +867,47 @@ if test -z \"$show_help\"; then\n \n     */* | *\\\\*)\n       $echo \"$modename: output file \\`$output' must have no directory components\" 1>&2\n+      $echo \"$help\" 1>&2\n       exit 1\n       ;;\n \n-    *.a)\n+    *.a | *.lib)\n+      if test -n \"$link_against_libtool_libs\"; then\n+        $echo \"$modename: error: cannot link libtool libraries into archives\" 1>&2\n+        exit 1\n+      fi\n+\n+      if test -n \"$deplibs\"; then\n+        $echo \"$modename: warning: \\`-l' and \\`-L' are ignored for archives\" 1>&2\n+      fi\n+\n+      if test -n \"$dlfiles$dlprefiles\"; then\n+        $echo \"$modename: warning: \\`-dlopen' is ignored for archives\" 1>&2\n+      fi\n+\n+      if test -n \"$rpath\"; then\n+        $echo \"$modename: warning: \\`-rpath' is ignored for archives\" 1>&2\n+      fi\n+\n+      if test -n \"$vinfo\"; then\n+        $echo \"$modename: warning: \\`-version-info' is ignored for archives\" 1>&2\n+      fi\n+\n+      if test -n \"$release\"; then\n+        $echo \"$modename: warning: \\`-release' is ignored for archives\" 1>&2\n+      fi\n+\n       # Now set the variables for building old libraries.\n       build_libtool_libs=no\n-      build_old_libs=yes\n-      oldlib=\"$output\"\n-      $show \"$rm $oldlib\"\n-      $run $rm $oldlib\n+      oldlibs=\"$output\"\n       ;;\n \n     *.la)\n       # Make sure we only generate libraries of the form `libNAME.la'.\n       case \"$output\" in\n       lib*) ;;\n       *)\n-\t$echo \"$modename: libtool library \\`$arg' must begin with \\`lib'\" 1>&2\n+\t$echo \"$modename: libtool library \\`$output' must begin with \\`lib'\" 1>&2\n \t$echo \"$help\" 1>&2\n \texit 1\n \t;;\n@@ -854,9 +920,6 @@ if test -z \"$show_help\"; then\n       library_names=\n       old_library=\n       dlname=\n-      current=0\n-      revision=0\n-      age=0\n \n       if test -n \"$objs\"; then\n         $echo \"$modename: cannot build libtool library \\`$output' from non-libtool objects:$objs\" 2>&1\n@@ -865,21 +928,12 @@ if test -z \"$show_help\"; then\n \n       # How the heck are we supposed to write a wrapper for a shared library?\n       if test -n \"$link_against_libtool_libs\"; then\n-        $echo \"$modename: libtool library \\`$output' may not depend on uninstalled libraries:$link_against_libtool_libs\" 1>&2\n+        $echo \"$modename: error: cannot link shared libraries into libtool libraries\" 1>&2\n         exit 1\n       fi\n \n       if test -n \"$dlfiles$dlprefiles\"; then\n-        $echo \"$modename: warning: \\`-dlopen' is ignored while creating libtool libraries\" 1>&2\n-        # Nullify the symbol file.\n-        compile_command=`$echo \"X$compile_command\" | $Xsed -e \"s% @SYMFILE@%%\"`\n-        finalize_command=`$echo \"X$finalize_command\" | $Xsed -e \"s% @SYMFILE@%%\"`\n-      fi\n-\n-      if test -z \"$rpath\"; then\n-        $echo \"$modename: you must specify an installation directory with \\`-rpath'\" 1>&2\n-\t$echo \"$help\" 1>&2\n-        exit 1\n+        $echo \"$modename: warning: \\`-dlopen' is ignored for libtool libraries\" 1>&2\n       fi\n \n       set dummy $rpath\n@@ -888,22 +942,36 @@ if test -z \"$show_help\"; then\n       fi\n       install_libdir=\"$2\"\n \n-      if test -n \"$vinfo\"; then\n+      # Now set the variables for building old libraries.\n+      oldlibs=\"$objdir/$libname.$libext\"\n+      if test -z \"$rpath\"; then\n+\t# Building a libtool convenience library.\n+\toldlibs=\"$objdir/$libname.al $oldlibs\"\n+\tbuild_libtool_libs=convenience\n+\n+\tif test -n \"$vinfo\"; then\n+\t  $echo \"$modename: warning: \\`-version-info' is ignored for convenience libraries\" 1>&2\n+\tfi\n+\n+\tif test -n \"$release\"; then\n+\t  $echo \"$modename: warning: \\`-release' is ignored for convenience libraries\" 1>&2\n+\tfi\n+      else\n \n \t# Parse the version information argument.\n \tIFS=\"${IFS= \t}\"; save_ifs=\"$IFS\"; IFS=':'\n-\tset dummy $vinfo\n+\tset dummy $vinfo 0 0 0\n \tIFS=\"$save_ifs\"\n \n-\tif test -n \"$5\"; then\n+\tif test -n \"$8\"; then\n \t  $echo \"$modename: too many parameters to \\`-version-info'\" 1>&2\n \t  $echo \"$help\" 1>&2\n \t  exit 1\n \tfi\n \n-\ttest -n \"$2\" && current=\"$2\"\n-\ttest -n \"$3\" && revision=\"$3\"\n-\ttest -n \"$4\" && age=\"$4\"\n+\tcurrent=\"$2\"\n+\trevision=\"$3\"\n+\tage=\"$4\"\n \n \t# Check that each of the things are valid numbers.\n \tcase \"$current\" in\n@@ -940,20 +1008,20 @@ if test -z \"$show_help\"; then\n \tfi\n \n \t# Calculate the version variables.\n-\tversion_vars=\"version_type current age revision\"\n+\tmajor=\n+\tversuffix=\n+\tverstring=\n \tcase \"$version_type\" in\n \tnone) ;;\n \n \tlinux)\n-\t  version_vars=\"$version_vars major versuffix\"\n \t  major=.`expr $current - $age`\n-\t  versuffix=\".$major.$age.$revision\"\n+\t  versuffix=\"$major.$age.$revision\"\n \t  ;;\n \n \tosf)\n-\t  version_vars=\"$version_vars versuffix verstring\"\n-\t  major=.`expr $current - $age`\n-\t  versuffix=.\"$current.$age.$revision\"\n+\t  major=`expr $current - $age`\n+\t  versuffix=\".$current.$age.$revision\"\n \t  verstring=\"$current.$age.$revision\"\n \n \t  # Add in all the interfaces that we are compatible with.\n@@ -969,15 +1037,13 @@ if test -z \"$show_help\"; then\n \t  ;;\n \n \tsunos)\n-\t  version_vars=\"$version_vars major versuffix\"\n-\t  major=.\"$current\"\n-\t  versuffix=.\"$current.$revision\"\n+\t  major=\".$current\"\n+\t  versuffix=\".$current.$revision\"\n \t  ;;\n \n \twindows)\n \t  # Like Linux, but with '-' rather than '.', since we only\n \t  # want one extension on Windows 95.\n-\t  version_vars=\"$version_vars major versuffix\"\n \t  major=`expr $current - $age`\n \t  versuffix=\"-$major-$age-$revision\"\n \t  ;;\n@@ -988,157 +1054,150 @@ if test -z \"$show_help\"; then\n \t  exit 1\n \t  ;;\n \tesac\n-      else\n-\n-        # No version information.\n-\tversion_vars=\n-\n-\tcase \"$version_type\" in\n-\tnone) ;;\n \n-\tlinux)\n-\t  version_vars=\"$version_vars versuffix major\"\n-\t  major=\n-\t  versuffix=\n-\t  ;;\n-\n-\tosf)\n-\t  version_vars=\"$version_vars versuffix verstring\"\n-\t  major=\n-\t  versuffix=\n-\t  verstring=\":0.0\"\n-\t  ;;\n-\n-\tsunos)\n-\t  version_vars=\"$version_vars major versuffix\"\n+\t# Clear the version info if we defaulted, and they specified a release.\n+\tif test -z \"$vinfo\" && test -n \"$release\"; then\n \t  major=\n \t  versuffix=\n-\t  ;;\n+\t  verstring=\"0.0\"\n+\t  case \"$host\" in\n+\t  *-*-sunos*)\n+\t    versuffix=\".0.0\"\n+\t    ;;\n+\t  esac\n+\tfi\n \n-\twindows)\n-\t  # Like Linux, but with '-' rather than '.', and with a leading\n-\t  # '-', since we only want one extension on Windows 95.\n-\t  version_vars=\"$version_vars major versuffix\"\n-\t  major=\n-\t  versuffix=\n-\t  ;;\n+\t# Check to see if the archive will have undefined symbols.\n+\tif test \"$allow_undefined\" = yes; then\n+\t  if test \"$allow_undefined_flag\" = unsupported; then\n+\t    $echo \"$modename: warning: undefined symbols not allowed in $host shared libraries\" 1>&2\n+\t    build_libtool_libs=no\n+\t    build_old_libs=yes\n+\t  fi\n+\telse\n+\t  # Don't allow undefined symbols.\n+\t  allow_undefined_flag=\"$no_undefined_flag\"\n+\tfi\n \n-\t*)\n-\t  $echo \"$modename: unknown library version type \\`$version_type'\" 1>&2\n-\t  echo \"Fatal configuration error.  See the $PACKAGE docs for more information.\" 1>&2\n-\t  exit 1\n-\t  ;;\n-\tesac\n+\t# Add libc to deplibs on all systems.\n+\tdependency_libs=\"$deplibs\"\n+\tdeplibs=\"$deplibs -lc\"\n       fi\n \n       # Create the output directory, or remove our outputs if we need to.\n       if test -d $objdir; then\n-        $show \"$rm $objdir/$output $objdir/$libname.* $objdir/${libname}${release}.*\"\n-        $run $rm $objdir/$output $objdir/$libname.* $objdir/${libname}${release}.*\n+        $show \"${rm}r $objdir/$output $objdir/$libname.* $objdir/${libname}${release}.*\"\n+\t$run ${rm}r $objdir/$output $objdir/$libname.* $objdir/${libname}${release}.*\n       else\n         $show \"$mkdir $objdir\"\n         $run $mkdir $objdir\n-\tstatus=$?\n-\tif test $status -eq 0 || test -d $objdir; then :\n-\telse\n-\t  exit $status\n-\tfi\n-      fi\n-\n-      # Check to see if the archive will have undefined symbols.\n-      if test \"$allow_undefined\" = yes; then\n-        if test \"$allow_undefined_flag\" = unsupported; then\n-          $echo \"$modename: warning: undefined symbols not allowed in $host shared libraries\" 1>&2\n-          build_libtool_libs=no\n-\t  build_old_libs=yes\n+        status=$?\n+        if test $status -ne 0 && test ! -d $objdir; then\n+          exit $status\n         fi\n-      else\n-        # Don't allow undefined symbols.\n-        allow_undefined_flag=\"$no_undefined_flag\"\n       fi\n \n-      # Add libc to deplibs on all systems.\n-      dependency_libs=\"$deplibs\"\n-      deplibs=\"$deplibs -lc\"\n-\n       if test \"$build_libtool_libs\" = yes; then\n-        # Get the real and link names of the library.\n-        eval library_names=\\\"$library_names_spec\\\"\n-        set dummy $library_names\n-        realname=\"$2\"\n-        shift; shift\n-\n-        if test -n \"$soname_spec\"; then\n-          eval soname=\\\"$soname_spec\\\"\n-        else\n-          soname=\"$realname\"\n-        fi\n+\t# Get the real and link names of the library.\n+\teval library_names=\\\"$library_names_spec\\\"\n+\tset dummy $library_names\n+\trealname=\"$2\"\n+\tshift; shift\n+\n+\tif test -n \"$soname_spec\"; then\n+\t  eval soname=\\\"$soname_spec\\\"\n+\telse\n+\t  soname=\"$realname\"\n+\tfi\n \n-        lib=\"$objdir/$realname\"\n+\tlib=\"$objdir/$realname\"\n \tfor link\n \tdo\n \t  linknames=\"$linknames $link\"\n \tdone\n \n-        # Use standard objects if they are PIC.\n-        test -z \"$pic_flag\" && libobjs=`$echo \"X$libobjs \" | $Xsed -e 's/\\.lo /.o /g' -e 's/ $//g'`\n+\t# Use standard objects if they are PIC.\n+\ttest -z \"$pic_flag\" && libobjs=`$echo \"X$libobjs \" | $Xsed -e \"$los2o\" -e 's/ $//g'`\n \n-        # Do each of the archive commands.\n-        eval cmds=\\\"$archive_cmds\\\"\n-        IFS=\"${IFS= \t}\"; save_ifs=\"$IFS\"; IFS=';'\n-        for cmd in $cmds; do\n-          IFS=\"$save_ifs\"\n-          $show \"$cmd\"\n-          $run eval \"$cmd\" || exit $?\n-        done\n-        IFS=\"$save_ifs\"\n+\t# Transform .lo files to .o files.\n+\ttest \"$build_old_libs\" = yes && oldobjs=\"$objs\"`$echo \"X$libobjs \" | $Xsed -e 's/[^   ]*\\.a //g' -e 's/[^   ]*\\.lib //g' -e \"$los2o\" -e 's/ $//g'`\n \n-        # Create links to the real library.\n-        for linkname in $linknames; do\n+\tif test -n \"$whole_archive_flag_spec\"; then\n+\t  if test -n \"$convenience\"; then\n+\t    eval libobjs=\\\"\\$libobjs $whole_archive_flag_spec\\\"\n+\t  fi\n+\telse\n+\t  for xlib in $convenience; do\n+\t    # Extract the objects.\n+\t    xdir=\"$xlib\"x\n+\t    generated=\"$generated $xdir\"\n+\t    xlib=`echo \"$xlib\" | $Xsed -e 's%^.*/%%'`\n+\n+\t    $show \"${rm}r $xdir\"\n+\t    $run ${rm}r \"$xdir\"\n+\t    $show \"mkdir $xdir\"\n+\t    $run mkdir \"$xdir\"\n+\t    status=$?\n+\t    if test $status -ne 0 && test ! -d \"$xdir\"; then\n+\t      exit $status\n+\t    fi\n+\t    $show \"(cd $xdir && $AR x ../$xlib)\"\n+\t    $run eval \"(cd \\$xdir && $AR x ../\\$xlib)\" || exit $?\n+\n+\t    libobjs=\"$libobjs `echo $xdir/*`\"\n+\t  done\n+\tfi\n+\n+\t# Do each of the archive commands.\n+\teval cmds=\\\"$archive_cmds\\\"\n+\tIFS=\"${IFS= \t}\"; save_ifs=\"$IFS\"; IFS=';'\n+\tfor cmd in $cmds; do\n+\t  IFS=\"$save_ifs\"\n+\t  $show \"$cmd\"\n+\t  $run eval \"$cmd\" || exit $?\n+\tdone\n+\tIFS=\"$save_ifs\"\n+\n+\t# Create links to the real library.\n+\tfor linkname in $linknames; do\n \t  if test \"$realname\" != \"$linkname\"; then\n-            $show \"(cd $objdir && $LN_S $realname $linkname)\"\n-            $run eval '(cd $objdir && $LN_S $realname $linkname)' || exit $?\n-          fi\n-        done\n+\t    $show \"(cd $objdir && $LN_S $realname $linkname)\"\n+\t    $run eval '(cd $objdir && $LN_S $realname $linkname)' || exit $?\n+\t  fi\n+\tdone\n \n-        # If -export-dynamic was specified, set the dlname.\n-        if test \"$export_dynamic\" = yes; then\n-          # On all known operating systems, these are identical.\n-          dlname=\"$soname\"\n-        fi\n+\t# If -export-dynamic was specified, set the dlname.\n+\tif test \"$export_dynamic\" = yes; then\n+\t  # On all known operating systems, these are identical.\n+\t  dlname=\"$soname\"\n+\tfi\n       fi\n-\n-      # Now set the variables for building old libraries.\n-      oldlib=\"$objdir/$libname.a\"\n       ;;\n \n-    *.lo | *.o)\n+    *.lo | *.o | *.obj)\n       if test -n \"$link_against_libtool_libs\"; then\n-        $echo \"$modename: error: cannot link libtool libraries into reloadable objects\" 1>&2\n+        $echo \"$modename: error: cannot link libtool libraries into objects\" 1>&2\n         exit 1\n       fi\n \n       if test -n \"$deplibs\"; then\n-        $echo \"$modename: warning: \\`-l' and \\`-L' are ignored while creating objects\" 1>&2\n+        $echo \"$modename: warning: \\`-l' and \\`-L' are ignored for objects\" 1>&2\n       fi\n \n       if test -n \"$dlfiles$dlprefiles\"; then\n-        $echo \"$modename: warning: \\`-dlopen' is ignored while creating objects\" 1>&2\n-        # Nullify the symbol file.\n-        compile_command=`$echo \"X$compile_command\" | $Xsed -e \"s% @SYMFILE@%%\"`\n-        finalize_command=`$echo \"X$finalize_command\" | $Xsed -e \"s% @SYMFILE@%%\"`\n+        $echo \"$modename: warning: \\`-dlopen' is ignored for objects\" 1>&2\n       fi\n \n       if test -n \"$rpath\"; then\n-        $echo \"$modename: warning: \\`-rpath' is ignored while creating objects\" 1>&2\n+        $echo \"$modename: warning: \\`-rpath' is ignored for objects\" 1>&2\n       fi\n \n       if test -n \"$vinfo\"; then\n-        $echo \"$modename: warning: \\`-version-info' is ignored while creating objects\" 1>&2\n+        $echo \"$modename: warning: \\`-version-info' is ignored for objects\" 1>&2\n       fi\n \n       if test -n \"$release\"; then\n-        $echo \"$modename: warning: \\`-release' is ignored while creating objects\" 1>&2\n+        $echo \"$modename: warning: \\`-release' is ignored for objects\" 1>&2\n       fi\n \n       case \"$output\" in\n@@ -1148,7 +1207,7 @@ if test -z \"$show_help\"; then\n           exit 1\n         fi\n         libobj=\"$output\"\n-        obj=`$echo \"X$output\" | $Xsed -e 's/\\.lo$/.o/'`\n+        obj=`$echo \"X$output\" | $Xsed -e \"$lo2o\"`\n         ;;\n       *)\n         libobj=\n@@ -1160,7 +1219,7 @@ if test -z \"$show_help\"; then\n       $run $rm $obj $libobj\n \n       # Create the old-style object.\n-      reload_objs=\"$objs\"`$echo \"X$libobjs \" | $Xsed -e 's/[^       ]*\\.a //g' -e 's/\\.lo /.o /g' -e 's/ $//g'`\n+      reload_objs=\"$objs\"`$echo \"X$libobjs \" | $Xsed -e 's/[^       ]*\\.a //g' -e 's/[^       ]*\\.lib //g' -e \"$los2o\" -e 's/ $//g'`\n \n       output=\"$obj\"\n       eval cmds=\\\"$reload_cmds\\\"\n@@ -1198,19 +1257,19 @@ if test -z \"$show_help\"; then\n       else\n         # Just create a symlink.\n         $show \"$LN_S $obj $libobj\"\n-        $run $LN_S $obj $libobj || exit 1\n+        $run $LN_S $obj $libobj || exit $?\n       fi\n \n       exit 0\n       ;;\n \n     *)\n       if test -n \"$vinfo\"; then\n-        $echo \"$modename: warning: \\`-version-info' is ignored while linking programs\" 1>&2\n+        $echo \"$modename: warning: \\`-version-info' is ignored for programs\" 1>&2\n       fi\n \n       if test -n \"$release\"; then\n-        $echo \"$modename: warning: \\`-release' is ignored while creating objects\" 1>&2\n+        $echo \"$modename: warning: \\`-release' is ignored for programs\" 1>&2\n       fi\n \n       if test -n \"$rpath\"; then\n@@ -1258,8 +1317,8 @@ if test -z \"$show_help\"; then\n \n       if test -n \"$libobjs\" && test \"$build_old_libs\" = yes; then\n         # Transform all the library objects into standard objects.\n-        compile_command=`$echo \"X$compile_command \" | $Xsed -e 's/\\.lo /.o /g' -e 's/ $//'`\n-        finalize_command=`$echo \"X$finalize_command \" | $Xsed -e 's/\\.lo /.o /g' -e 's/ $//'`\n+        compile_command=`$echo \"X$compile_command \" | $Xsed -e \"$los2o\" -e 's/ $//'`\n+        finalize_command=`$echo \"X$finalize_command \" | $Xsed -e \"$los2o\" -e 's/ $//'`\n       fi\n \n       if test \"$export_dynamic\" = yes && test -n \"$NM\" && test -n \"$global_symbol_pipe\"; then\n@@ -1270,7 +1329,7 @@ if test -z \"$show_help\"; then\n \n       if test -n \"$dlsyms\"; then\n         # Add our own program objects to the preloaded list.\n-        dlprefiles=`$echo \"X$objs$dlprefiles \" | $Xsed -e 's/\\.lo /.o /g' -e 's/ $//'`\n+        dlprefiles=`$echo \"X$objs$dlprefiles \" | $Xsed -e \"$los2o\" -e 's/ $//'`\n \n \t# Discover the nlist of each of the dlfiles.\n         nlist=\"$objdir/${output}.nm\"\n@@ -1282,8 +1341,7 @@ if test -z \"$show_help\"; then\n \t  $show \"$mkdir $objdir\"\n \t  $run $mkdir $objdir\n \t  status=$?\n-\t  if test $status -eq 0 || test -d $objdir; then :\n-\t  else\n+\t  if test $status -ne 0 && test ! -d $objdir; then\n \t    exit $status\n \t  fi\n \tfi\n@@ -1383,8 +1441,8 @@ dld_preloaded_symbols[] =\n         $run eval '(cd $objdir && $CC -c$no_builtin_flag \"$dlsyms\")' || exit $?\n \n         # Transform the symbol file into the correct name.\n-        compile_command=`$echo \"X$compile_command\" | $Xsed -e \"s%@SYMFILE@%$objdir/${output}S.o%\"`\n-        finalize_command=`$echo \"X$finalize_command\" | $Xsed -e \"s%@SYMFILE@%$objdir/${output}S.o%\"`\n+        compile_command=`$echo \"X$compile_command\" | $Xsed -e \"s%@SYMFILE@%$objdir/${output}S.${objext}%\"`\n+        finalize_command=`$echo \"X$finalize_command\" | $Xsed -e \"s%@SYMFILE@%$objdir/${output}S.${objext}%\"`\n       elif test \"$export_dynamic\" != yes; then\n         test -n \"$dlfiles$dlprefiles\" && $echo \"$modename: warning: \\`-dlopen' and \\`-dlpreopen' are ignored without \\`-export-dynamic'\" 1>&2\n       else\n@@ -1414,13 +1472,11 @@ dld_preloaded_symbols[] =\n       finalize_command=`$echo \"X$finalize_command\" | $Xsed -e 's%@OUTPUT@%'\"$objdir/$output\"'T%g'`\n \n       # Create the binary in the object directory, then wrap it.\n-      if test -d $objdir; then :\n-      else\n+      if test ! -d $objdir; then\n         $show \"$mkdir $objdir\"\n \t$run $mkdir $objdir\n \tstatus=$?\n-\tif test $status -eq 0 || test -d $objdir; then :\n-\telse\n+\tif test $status -ne 0 && test ! -d $objdir; then\n \t  exit $status\n \tfi\n       fi\n@@ -1430,7 +1486,7 @@ dld_preloaded_symbols[] =\n         rpath=\n         for dir in $temp_rpath; do\n           case \"$dir\" in\n-          /* | [A-Za-z]:\\\\*)\n+          /* | [A-Za-z]:[/\\\\]*)\n             # Absolute path.\n             rpath=\"$rpath$dir:\"\n             ;;\n@@ -1514,10 +1570,20 @@ if test \\\"\\$libtool_install_magic\\\" = \\\"$magic\\\"; then\n   finalize_command=\\\"$finalize_command\\\"\n else\n   # When we are sourced in execute mode, \\$file and \\$echo are already set.\n-  if test \\\"\\$libtool_execute_magic\\\" = \\\"$magic\\\"; then :\n-  else\n+  if test \\\"\\$libtool_execute_magic\\\" != \\\"$magic\\\"; then\n     echo=\\\"$qecho\\\"\n     file=\\\"\\$0\\\"\n+    # Make sure echo works.\n+    if test \\\"X\\$1\\\" = X--no-reexec; then\n+      # Discard the --no-reexec flag, and continue.\n+      shift\n+    elif test \\\"X\\`(\\$echo '\\t') 2>/dev/null\\`\\\" = 'X\\t'; then\n+      # Yippee, \\$echo works!\n+      :\n+    else\n+      # Restart under the correct shell, and then maybe \\$echo will work.\n+      exec $SHELL \\\"\\$0\\\" --no-reexec \\${1+\\\"\\$@\\\"}\n+    fi\n   fi\\\n \"\n         $echo >> $output \"\\\n@@ -1534,7 +1600,7 @@ else\n     # If there was a directory component, then change thisdir.\n     if test \\\"x\\$destdir\\\" != \\\"x\\$file\\\"; then\n       case \\\"\\$destdir\\\" in\n-      /* | [A-Za-z]:\\\\*) thisdir=\\\"\\$destdir\\\" ;;\n+      /* | [A-Za-z]:[/\\\\]*) thisdir=\\\"\\$destdir\\\" ;;\n       *) thisdir=\\\"\\$thisdir/\\$destdir\\\" ;;\n       esac\n     fi\n@@ -1594,9 +1660,37 @@ fi\\\n     esac\n \n     # See if we need to build an old-fashioned archive.\n-    if test \"$build_old_libs\" = \"yes\"; then\n-      # Transform .lo files to .o files.\n-      oldobjs=\"$objs\"`$echo \"X$libobjs \" | $Xsed -e 's/[^   ]*\\.a //g' -e 's/\\.lo /.o /g' -e 's/ $//g'`\n+    for oldlib in $oldlibs; do\n+\n+      if test \"$build_libtool_libs\" = convenience; then\n+\toldobjs=\"$libobjs\"\n+\taddlibs=\"$convenience\"\n+\tbuild_libtool_libs=no\n+      else\n+\toldobjs=\"$objs\"`$echo \"X$libobjs \" | $Xsed -e 's/[^   ]*\\.a //g' -e 's/[^   ]*\\.lib //g' -e \"$los2o\" -e 's/ $//g'`\n+\taddlibs=\"$old_convenience\"\n+      fi\n+\n+      # Add in members from convenience archives.\n+      for xlib in $addlibs; do\n+\t# Extract the objects.\n+\txdir=\"$xlib\"x\n+\tgenerated=\"$generated $xdir\"\n+\txlib=`echo \"$xlib\" | $Xsed -e 's%^.*/%%'`\n+\n+\t$show \"${rm}r $xdir\"\n+\t$run ${rm}r \"$xdir\"\n+\t$show \"mkdir $xdir\"\n+\t$run mkdir \"$xdir\"\n+\tstatus=$?\n+\tif test $status -ne 0 && test ! -d \"$xdir\"; then\n+\t  exit $status\n+\tfi\n+\t$show \"(cd $xdir && $AR x ../$xlib)\"\n+\t$run eval \"(cd \\$xdir && $AR x ../\\$xlib)\" || exit $?\n+\n+\toldobjs=\"$oldobjs `echo $xdir/*`\"\n+      done\n \n       # Do each command in the archive commands.\n       if test -n \"$old_archive_from_new_cmds\" && test \"$build_libtool_libs\" = yes; then\n@@ -1611,14 +1705,18 @@ fi\\\n         $run eval \"$cmd\" || exit $?\n       done\n       IFS=\"$save_ifs\"\n+    done\n+\n+    if test -n \"$generated\"; then\n+      $show \"${rm}r$generated\"\n+      $run ${rm}r$generated\n     fi\n \n     # Now create the libtool archive.\n     case \"$output\" in\n     *.la)\n       old_library=\n-      test \"$build_old_libs\" = yes && old_library=\"$libname.a\"\n-\n+      test \"$build_old_libs\" = yes && old_library=\"$libname.$libext\"\n       $show \"creating $output\"\n \n       # Only create the output if not a dry run.\n@@ -1652,7 +1750,7 @@ libdir='$install_libdir'\\\n       # Do a symbolic link so that the libtool archive can be found in\n       # LD_LIBRARY_PATH before the program is installed.\n       $show \"(cd $objdir && $LN_S ../$output $output)\"\n-      $run eval \"(cd $objdir && $LN_S ../$output $output)\" || exit 1\n+      $run eval \"(cd $objdir && $LN_S ../$output $output)\" || exit $?\n       ;;\n     esac\n     exit 0\n@@ -1664,7 +1762,7 @@ libdir='$install_libdir'\\\n \n     # There may be an optional sh(1) argument at the beginning of\n     # install_prog (especially on Windows NT).\n-    if test \"$nonopt\" = \"$SHELL\"; then\n+    if test \"$nonopt\" = \"$SHELL\" || test \"$nonopt\" = \"/bin/sh\"; then\n       # Aesthetically quote it.\n       arg=`$echo \"X$nonopt\" | $Xsed -e \"$sed_quote_subst\"`\n       case \"$arg\" in\n@@ -1783,7 +1881,7 @@ libdir='$install_libdir'\\\n       fi\n     fi\n     case \"$destdir\" in\n-    /* | [A-Za-z]:\\\\*) ;;\n+    /* | [A-Za-z]:[/\\\\]*) ;;\n     *)\n       for file in $files; do\n         case \"$file\" in\n@@ -1809,7 +1907,7 @@ libdir='$install_libdir'\\\n \n       # Do each installation.\n       case \"$file\" in\n-      *.a)\n+      *.a | *.lib)\n         # Do the static libraries later.\n         staticlibs=\"$staticlibs $file\"\n         ;;\n@@ -1866,17 +1964,21 @@ libdir='$install_libdir'\\\n             rmcmd=\"$rm\"\n             for linkname\n             do\n-              rmcmd=\"$rmcmd $destdir/$linkname\"\n+\t      if test \"X$linkname\" != \"X$realname\"; then\n+                rmcmd=\"$rmcmd $destdir/$linkname\"\n+\t      fi\n             done\n             $show \"$rmcmd\"\n             $run $rmcmd\n \n             # ... and create new ones.\n             for linkname\n             do\n-              test \"X$dlname\" = \"X$linkname\" && dlname=\n-              $show \"(cd $destdir && $LN_S $realname $linkname)\"\n-              $run eval \"(cd $destdir && $LN_S $realname $linkname)\"\n+\t      if test \"X$linkname\" != \"X$realname\"; then\n+                test \"X$dlname\" = \"X$linkname\" && dlname=\n+                $show \"(cd $destdir && $LN_S $realname $linkname)\"\n+                $run eval \"(cd $destdir && $LN_S $realname $linkname)\"\n+\t      fi\n             done\n           fi\n \n@@ -1921,9 +2023,9 @@ libdir='$install_libdir'\\\n         # Deduce the name of the destination old-style object file.\n         case \"$destfile\" in\n         *.lo)\n-          staticdest=`$echo \"X$destfile\" | $Xsed -e 's/\\.lo$/.o/'`\n+          staticdest=`$echo \"X$destfile\" | $Xsed -e \"$lo2o\"`\n           ;;\n-        *.o)\n+        *.o | *.obj)\n           staticdest=\"$destfile\"\n           destfile=\n           ;;\n@@ -1943,7 +2045,7 @@ libdir='$install_libdir'\\\n         # Install the old object if enabled.\n         if test \"$build_old_libs\" = yes; then\n           # Deduce the name of the old-style object file.\n-          staticobj=`$echo \"X$file\" | $Xsed -e 's/\\.lo$/.o/'`\n+          staticobj=`$echo \"X$file\" | $Xsed -e \"$lo2o\"`\n \n           $show \"$install_prog $staticobj $staticdest\"\n           $run eval \"$install_prog \\$staticobj \\$staticdest\" || exit $?\n@@ -1989,10 +2091,7 @@ libdir='$install_libdir'\\\n               esac\n             fi\n             libfile=\"$libdir/`$echo \"X$lib\" | $Xsed -e 's%^.*/%%g'`\"\n-            if test -z \"$libdir\"; then\n-              $echo \"$modename: warning: \\`$lib' contains no -rpath information\" 1>&2\n-            elif test -f \"$libfile\"; then :\n-            else\n+            if test -n \"$libdir\" && test ! -f \"$libfile\"; then\n               $echo \"$modename: warning: \\`$lib' has not been installed in \\`$libdir'\" 1>&2\n               finalize=no\n             fi\n@@ -2142,8 +2241,7 @@ libdir='$install_libdir'\\\n \n     # Handle -dlopen flags immediately.\n     for file in $execute_dlfiles; do\n-      if test -f \"$file\"; then :\n-      else\n+      if test ! -f \"$file\"; then\n \t$echo \"$modename: \\`$file' is not a file\" 1>&2\n \t$echo \"$help\" 1>&2\n \texit 1\n@@ -2245,6 +2343,14 @@ libdir='$install_libdir'\\\n       # Export the shlibpath_var.\n       eval \"export $shlibpath_var\"\n \n+      # Restore saved enviroment variables\n+      if test \"${save_LC_ALL+set}\" = set; then\n+        LC_ALL=\"$save_LC_ALL\"; export LC_ALL\n+      fi\n+      if test \"${save_LANG+set}\" = set; then\n+        LANG=\"$save_LANG\"; export LANG\n+      fi\n+\n       # Now actually exec the command.\n       eval \"exec \\$cmd$args\"\n \n@@ -2333,7 +2439,7 @@ libdir='$install_libdir'\\\n \n       *.lo)\n         if test \"$build_old_libs\" = yes; then\n-          oldobj=`$echo \"X$name\" | $Xsed -e 's/\\.lo$/.o/'`\n+          oldobj=`$echo \"X$name\" | $Xsed -e \"$lo2o\"`\n           rmfiles=\"$rmfiles $dir/$oldobj\"\n         fi\n \t$show \"$rm $rmfiles\"\n@@ -2399,6 +2505,10 @@ compile)\n \n Compile a source file into a libtool library object.\n \n+This mode accepts the following additional options:\n+\n+  -static           always build a \\`.o' file suitable for static linking\n+\n COMPILE-COMMAND is a command to be used in creating a \\`standard' object file\n from the given SOURCEFILE.\n \n@@ -2487,11 +2597,11 @@ object files.\n If the OUTPUT-FILE ends in \\`.la', then a libtool library is created, only\n library objects (\\`.lo' files) may be specified, and \\`-rpath' is required.\n \n-If OUTPUT-FILE ends in \\`.a', then a standard library is created using \\`ar'\n-and \\`ranlib'.\n+If OUTPUT-FILE ends in \\`.a' or \\`.lib', then a standard library is created\n+using \\`ar' and \\`ranlib', or on WIndows using \\`lib'.\n \n-If OUTPUT-FILE ends in \\`.lo' or \\`.o', then a reloadable object file is\n-created, otherwise an executable program is created.\"\n+If OUTPUT-FILE ends in \\`.lo' or \\`.${objext}', then a reloadable object file\n+is created, otherwise an executable program is created.\"\n   ;;\n \n uninstall)"}]}