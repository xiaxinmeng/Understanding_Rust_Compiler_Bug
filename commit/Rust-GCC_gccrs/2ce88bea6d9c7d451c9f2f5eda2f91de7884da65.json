{"sha": "2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmNlODhiZWE2ZDljN2Q0NTFjOWYyZjVlZGEyZjkxZGU3ODg0ZGE2NQ==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-03-15T22:45:17Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-03-15T22:45:17Z"}, "message": "re PR c++/30891 (poor diagnostic with namespace in the function scope)\n\n2007-03-15  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR c++/30891\ncp/\n\t* parser.c (cp_parser_statement): If 'namespace' is found, this\n\tonly can be a namespace alias definition, so parse it now.\n\t(cp_parser_namespace_alias_definition): if we find an open brace\n\tinstead of '=', then this is actually a misplaced namespace\n\tdefinition.\ntestsuite/\n\t* g++.dg/parse/namespace-definition.C: New.\n\nFrom-SVN: r122962", "tree": {"sha": "9ad6ddd1ac48e6d49a9f4b8b3b4912f4dbe71d00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ad6ddd1ac48e6d49a9f4b8b3b4912f4dbe71d00"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/comments", "author": null, "committer": null, "parents": [{"sha": "9b439fe168ff6dacb3aa606f43a2103b68b89ded", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b439fe168ff6dacb3aa606f43a2103b68b89ded", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b439fe168ff6dacb3aa606f43a2103b68b89ded"}], "stats": {"total": 39, "additions": 39, "deletions": 0}, "files": [{"sha": "730c59e9af99128c4090bc2d3157a103bc7f65d2", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "patch": "@@ -1,3 +1,12 @@\n+2007-03-15  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/30891\n+\t* parser.c (cp_parser_statement): If 'namespace' is found, this\n+\tonly can be a namespace alias definition, so parse it now.\n+\t(cp_parser_namespace_alias_definition): if we find an open brace\n+\tinstead of '=', then this is actually a misplaced namespace\n+\tdefinition.\n+\t\n 2007-03-15  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \tPR c++/24924"}, {"sha": "e1230471a625b88cb9c29ebe2f58e1a5774b900d", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "patch": "@@ -6373,6 +6373,11 @@ cp_parser_statement (cp_parser* parser, tree in_statement_expr,\n \t  statement = cp_parser_try_block (parser);\n \t  break;\n \n+\tcase RID_NAMESPACE:\n+\t  /* This must be a namespace alias definition.  */\n+\t  cp_parser_declaration_statement (parser);\n+\t  return;\n+\t  \n \tdefault:\n \t  /* It might be a keyword like `int' that can start a\n \t     declaration-statement.  */\n@@ -11040,6 +11045,16 @@ cp_parser_namespace_alias_definition (cp_parser* parser)\n   if (identifier == error_mark_node)\n     return;\n   /* Look for the `=' token.  */\n+  if (!cp_parser_uncommitted_to_tentative_parse_p (parser)\n+      && cp_lexer_next_token_is (parser->lexer, CPP_OPEN_BRACE)) \n+    {\n+      error (\"%<namespace%> definition is not allowed here\");\n+      /* Skip the definition.  */\n+      cp_lexer_consume_token (parser->lexer);\n+      cp_parser_skip_to_closing_brace (parser);\n+      cp_lexer_consume_token (parser->lexer);\n+      return;\n+    }\n   cp_parser_require (parser, CPP_EQ, \"`='\");\n   /* Look for the qualified-namespace-specifier.  */\n   namespace_specifier"}, {"sha": "b56294f0df68534fbfcb515beea869401a9dfa96", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "patch": "@@ -1,3 +1,8 @@\n+2007-03-15  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/30891\n+\t* g++.dg/parse/namespace-definition.C: New.\n+\t\n 2007-03-15  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \tPR c++/24924"}, {"sha": "b7d4034cd7b2d548e0363028d839b1e66332b1c0", "filename": "gcc/testsuite/g++.dg/parse/namespace-definition.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-definition.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ce88bea6d9c7d451c9f2f5eda2f91de7884da65/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-definition.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-definition.C?ref=2ce88bea6d9c7d451c9f2f5eda2f91de7884da65", "patch": "@@ -0,0 +1,10 @@\n+// PR 30891\n+// { dg-do compile }\n+\n+int main() {\n+  int i = 0;\n+  namespace foo { // { dg-error \"'namespace' definition is not allowed here\" } \n+    int j = 0;\n+  }\n+  return 0;\n+}"}]}