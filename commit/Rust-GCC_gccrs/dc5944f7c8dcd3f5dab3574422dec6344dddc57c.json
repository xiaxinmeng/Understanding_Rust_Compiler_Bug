{"sha": "dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM1OTQ0ZjdjOGRjZDNmNWRhYjM1NzQ0MjJkZWM2MzQ0ZGRkYzU3Yw==", "commit": {"author": {"name": "Janis Johnson", "email": "janis187@us.ibm.com", "date": "2005-02-01T21:33:28Z"}, "committer": {"name": "Janis Johnson", "email": "janis@gcc.gnu.org", "date": "2005-02-01T21:33:28Z"}, "message": "simd-2.C: Check for AltiVec HW support at runtime.\n\n\t* g++.dg/eh/simd-2.C: Check for AltiVec HW support at runtime.\n\t* g++.dg/eh/check-vect.h: New.\n\nFrom-SVN: r94565", "tree": {"sha": "f352e772150e4ba3bcbd23b01400b62ff93171dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f352e772150e4ba3bcbd23b01400b62ff93171dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/comments", "author": null, "committer": null, "parents": [{"sha": "dd1d184d74508646d4b6b2fb33de72c18807b97e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1d184d74508646d4b6b2fb33de72c18807b97e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd1d184d74508646d4b6b2fb33de72c18807b97e"}], "stats": {"total": 41, "additions": 35, "deletions": 6}, "files": [{"sha": "537f38a0e4e804b66ce9d9a5740f49a92679790f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "patch": "@@ -1,5 +1,8 @@\n 2005-02-01  Janis Johnson  <janis187@us.ibm.com>\n \n+\t* g++.dg/eh/simd-2.C: Check for AltiVec HW support at runtime.\n+\t* g++.dg/eh/check-vect.h: New.\n+\n \t* gcc.dg/vect/vect-77.c: Replace xfail selector with expression.\n \t* gcc.dg/vect/vect-78.c: Ditto.\n \t* gcc.dg/vect/vect.exp (check_effective_target_lp64_or_vect_no_align):"}, {"sha": "4321be0a4a650a395ec13850c3f80e30a5edf7e5", "filename": "gcc/testsuite/g++.dg/eh/check-vect.h", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fcheck-vect.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fcheck-vect.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fcheck-vect.h?ref=dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "patch": "@@ -0,0 +1,26 @@\n+/* Check if system supports SIMD.  Copied from gcc.dg/vect/tree-vect.h.  */\n+#include <signal.h>\n+\n+extern \"C\" void abort (void);\n+extern \"C\" void exit (int);\n+\n+void\n+sig_ill_handler (int sig)\n+{\n+  exit(0);\n+}\n+\n+void check_vect (void)\n+{\n+  signal(SIGILL, sig_ill_handler);\n+#if defined(__ppc__) || defined(__ppc64__) || defined(__powerpc__) || defined(powerpc)\n+  /* Altivec instruction, 'vor %v0,%v0,%v0'.  */\n+  asm volatile (\".long 0x10000484\");\n+#elif defined(__i386__) || defined(__x86_64__)\n+  /* SSE2 instruction: movsd %xmm0,%xmm0 */\n+  asm volatile (\".byte 0xf2,0x0f,0x10,0xc0\");\n+#elif defined(__sparc__)\n+  asm volatile (\".word\\t0x81b007c0\");\n+#endif\n+  signal (SIGILL, SIG_DFL);\n+}"}, {"sha": "9d9dce509bd8ae00d933128806ed013034427272", "filename": "gcc/testsuite/g++.dg/eh/simd-2.C", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fsimd-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc5944f7c8dcd3f5dab3574422dec6344dddc57c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fsimd-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fsimd-2.C?ref=dc5944f7c8dcd3f5dab3574422dec6344dddc57c", "patch": "@@ -2,8 +2,10 @@\n // Contributed by Aldy Hernandez (aldy@quesejoda.com).\n // { dg-options \"-O\" }\n // { dg-options \"-O -w\" { target i?86-*-* } }\n-// { dg-options \"-O -w -maltivec\" { target powerpc64-*-linux* } }\n-// { dg-do run { xfail \"powerpc64-*-linux*\"}  }\n+// { dg-options \"-O -w -maltivec\" { target powerpc*-*-linux* } }\n+// { dg-do run }\n+\n+#include \"check-vect.h\"\n \n typedef int __attribute__((vector_size (16))) vecint;\n \n@@ -43,10 +45,8 @@ void f1 (void)\n \n int main ()\n {\n-#if defined(__powerpc64__) && defined(__linux__)\n-  // Don't run on ppc64-linux, since not always AltiVec regs available   \n-  return -1;  \n-#endif\n+  /* Exit with zero if the hardware does not support AltiVec instructions.  */\n+  check_vect ();\n   f1 ();\n   return 0;\n }"}]}