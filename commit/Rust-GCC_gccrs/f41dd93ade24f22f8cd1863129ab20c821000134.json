{"sha": "f41dd93ade24f22f8cd1863129ab20c821000134", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQxZGQ5M2FkZTI0ZjIyZjhjZDE4NjMxMjlhYjIwYzgyMTAwMDEzNA==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-12-08T18:17:16Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-12-08T18:17:48Z"}, "message": "libgcc: block signals when releasing split-stack memory\n\n\t* generic-morestack-thread.c (free_segments): Block signals during\n\tthread exit.", "tree": {"sha": "0ef3090bf53a06032bd7848367ffbed864dd0dc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0ef3090bf53a06032bd7848367ffbed864dd0dc4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f41dd93ade24f22f8cd1863129ab20c821000134", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f41dd93ade24f22f8cd1863129ab20c821000134", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f41dd93ade24f22f8cd1863129ab20c821000134", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f41dd93ade24f22f8cd1863129ab20c821000134/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c0ed52d3e0044630b57a2145be78de199539d995", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0ed52d3e0044630b57a2145be78de199539d995", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0ed52d3e0044630b57a2145be78de199539d995"}], "stats": {"total": 14, "additions": 14, "deletions": 0}, "files": [{"sha": "fd391bb2e1f7b9af86b9da6a2279a571536aada6", "filename": "libgcc/generic-morestack-thread.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f41dd93ade24f22f8cd1863129ab20c821000134/libgcc%2Fgeneric-morestack-thread.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f41dd93ade24f22f8cd1863129ab20c821000134/libgcc%2Fgeneric-morestack-thread.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fgeneric-morestack-thread.c?ref=f41dd93ade24f22f8cd1863129ab20c821000134", "patch": "@@ -38,6 +38,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #ifndef inhibit_libc\n \n #include <errno.h>\n+#include <signal.h>\n #include <pthread.h>\n \n #include \"generic-morestack.h\"\n@@ -54,6 +55,9 @@ extern int pthread_key_create (pthread_key_t *, void (*) (void *))\n extern int pthread_setspecific (pthread_key_t, const void *)\n   __attribute__ ((weak));\n \n+extern int pthread_sigmask (int, const sigset_t *, sigset_t *)\n+  __attribute__ ((weak));\n+\n /* The key for the list of stack segments to free when the thread\n    exits.  This is created by pthread_key_create.  */\n \n@@ -70,6 +74,16 @@ static pthread_once_t create_key_once = PTHREAD_ONCE_INIT;\n static void\n free_segments (void* arg)\n {\n+  /* We must block signals in case the signal handler tries to split\n+     the stack.  We leave them blocked while the thread exits.  */\n+  if (pthread_sigmask)\n+    {\n+      sigset_t mask;\n+\n+      sigfillset (&mask);\n+      pthread_sigmask (SIG_BLOCK, &mask, NULL);\n+    }\n+\n   __morestack_release_segments ((struct stack_segment **) arg, 1);\n }\n "}]}