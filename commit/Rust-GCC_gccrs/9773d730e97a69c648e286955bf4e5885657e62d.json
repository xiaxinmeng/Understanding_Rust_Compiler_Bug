{"sha": "9773d730e97a69c648e286955bf4e5885657e62d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTc3M2Q3MzBlOTdhNjljNjQ4ZTI4Njk1NWJmNGU1ODg1NjU3ZTYyZA==", "commit": {"author": {"name": "Sebastian Pop", "email": "sebastian.pop@amd.com", "date": "2010-08-11T20:25:34Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2010-08-11T20:25:34Z"}, "message": "Run rewrite_cross_bb_phi_deps before rewrite_cross_bb_scalar_deps.\n\n2010-06-23  Sebastian Pop  <sebastian.pop@amd.com>\n\n\t* graphite-sese-to-poly.c (rewrite_reductions_out_of_ssa): Moved up.\n\t(rewrite_cross_bb_phi_deps): Split out of rewrite_cross_bb_scalar_deps.\n\t(rewrite_cross_bb_scalar_deps_out_of_ssa): Run rewrite_cross_bb_phi_deps\n\tbefore rewrite_cross_bb_scalar_deps.\n\nFrom-SVN: r163126", "tree": {"sha": "6f81299ab8aa5626d5416dd19e99e4402a912b18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6f81299ab8aa5626d5416dd19e99e4402a912b18"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9773d730e97a69c648e286955bf4e5885657e62d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9773d730e97a69c648e286955bf4e5885657e62d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9773d730e97a69c648e286955bf4e5885657e62d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9773d730e97a69c648e286955bf4e5885657e62d/comments", "author": null, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cc5889707861a7f94cb3dbba61a224d45742d3d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc5889707861a7f94cb3dbba61a224d45742d3d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc5889707861a7f94cb3dbba61a224d45742d3d2"}], "stats": {"total": 110, "additions": 77, "deletions": 33}, "files": [{"sha": "7eba14dc012c73d83c0c9c6c9de3164fa484e776", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9773d730e97a69c648e286955bf4e5885657e62d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9773d730e97a69c648e286955bf4e5885657e62d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9773d730e97a69c648e286955bf4e5885657e62d", "patch": "@@ -1,3 +1,10 @@\n+2010-08-02  Sebastian Pop  <sebastian.pop@amd.com>\n+\n+\t* graphite-sese-to-poly.c (rewrite_reductions_out_of_ssa): Moved up.\n+\t(rewrite_cross_bb_phi_deps): Split out of rewrite_cross_bb_scalar_deps.\n+\t(rewrite_cross_bb_scalar_deps_out_of_ssa): Run rewrite_cross_bb_phi_deps\n+\tbefore rewrite_cross_bb_scalar_deps.\n+\n 2010-08-02  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* graphite-sese-to-poly.c (rewrite_commutative_reductions_out_of_ssa):"}, {"sha": "d73689582a6b2583151a3e24a2ab2aff3b9c35a1", "filename": "gcc/ChangeLog.graphite", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9773d730e97a69c648e286955bf4e5885657e62d/gcc%2FChangeLog.graphite", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9773d730e97a69c648e286955bf4e5885657e62d/gcc%2FChangeLog.graphite", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog.graphite?ref=9773d730e97a69c648e286955bf4e5885657e62d", "patch": "@@ -1,3 +1,10 @@\n+2010-06-23  Sebastian Pop  <sebastian.pop@amd.com>\n+\n+\t* graphite-sese-to-poly.c (rewrite_reductions_out_of_ssa): Moved up.\n+\t(rewrite_cross_bb_phi_deps): Split out of rewrite_cross_bb_scalar_deps.\n+\t(rewrite_cross_bb_scalar_deps_out_of_ssa): Run rewrite_cross_bb_phi_deps\n+\tbefore rewrite_cross_bb_scalar_deps.\n+\n 2010-06-23  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* graphite-sese-to-poly.c (rewrite_commutative_reductions_out_of_ssa):"}, {"sha": "5f99f656f4c2248d2a1fd05fd0ca7af1c21a2129", "filename": "gcc/graphite-sese-to-poly.c", "status": "modified", "additions": 63, "deletions": 33, "changes": 96, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9773d730e97a69c648e286955bf4e5885657e62d/gcc%2Fgraphite-sese-to-poly.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9773d730e97a69c648e286955bf4e5885657e62d/gcc%2Fgraphite-sese-to-poly.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-sese-to-poly.c?ref=9773d730e97a69c648e286955bf4e5885657e62d", "patch": "@@ -2272,6 +2272,31 @@ rewrite_phi_out_of_ssa (gimple_stmt_iterator *psi)\n   gsi_insert_seq_before (&gsi, stmts, GSI_NEW_STMT);\n }\n \n+/* Rewrite out of SSA all the reduction phi nodes of SCOP.  */\n+\n+void\n+rewrite_reductions_out_of_ssa (scop_p scop)\n+{\n+  basic_block bb;\n+  gimple_stmt_iterator psi;\n+  sese region = SCOP_REGION (scop);\n+\n+  FOR_EACH_BB (bb)\n+    if (bb_in_sese_p (bb, region))\n+      for (psi = gsi_start_phis (bb); !gsi_end_p (psi);)\n+\t{\n+\t  if (scalar_close_phi_node_p (gsi_stmt (psi)))\n+\t    rewrite_close_phi_out_of_ssa (&psi);\n+\t  else if (reduction_phi_p (region, &psi))\n+\t    rewrite_phi_out_of_ssa (&psi);\n+\t}\n+\n+  update_ssa (TODO_update_ssa);\n+#ifdef ENABLE_CHECKING\n+  verify_loop_closed_ssa (true);\n+#endif\n+}\n+\n /* Return true when DEF can be analyzed in REGION by the scalar\n    evolution analyzer.  */\n \n@@ -2314,16 +2339,16 @@ rewrite_cross_bb_scalar_dependence (tree zero_dim_array, tree def, gimple use_st\n }\n \n /* Rewrite the scalar dependences crossing the boundary of the BB\n-   containing STMT with an array.  */\n+   containing STMT with an array.  GSI points to a definition that is\n+   used in a PHI node.  */\n \n static void\n-rewrite_cross_bb_scalar_deps (sese region, gimple_stmt_iterator *gsi)\n+rewrite_cross_bb_phi_deps (sese region, gimple_stmt_iterator gsi)\n {\n-  gimple stmt = gsi_stmt (*gsi);\n+  gimple stmt = gsi_stmt (gsi);\n   imm_use_iterator imm_iter;\n   tree def;\n   basic_block def_bb;\n-  tree zero_dim_array = NULL_TREE;\n   gimple use_stmt;\n \n   if (gimple_code (stmt) != GIMPLE_ASSIGN)\n@@ -2342,9 +2367,37 @@ rewrite_cross_bb_scalar_deps (sese region, gimple_stmt_iterator *gsi)\n \tgimple_stmt_iterator si = gsi_for_stmt (use_stmt);\n \trewrite_phi_out_of_ssa (&si);\n       }\n-    else if (def_bb != gimple_bb (use_stmt)\n-\t     && !is_gimple_debug (use_stmt))\n+}\n+\n+/* Rewrite the scalar dependences crossing the boundary of the BB\n+   containing STMT with an array.  */\n+\n+static void\n+rewrite_cross_bb_scalar_deps (sese region, gimple_stmt_iterator *gsi)\n+{\n+  gimple stmt = gsi_stmt (*gsi);\n+  imm_use_iterator imm_iter;\n+  tree def;\n+  basic_block def_bb;\n+  tree zero_dim_array = NULL_TREE;\n+  gimple use_stmt;\n+\n+  if (gimple_code (stmt) != GIMPLE_ASSIGN)\n+    return;\n+\n+  def = gimple_assign_lhs (stmt);\n+  if (!is_gimple_reg (def)\n+      || scev_analyzable_p (def, region))\n+    return;\n+\n+  def_bb = gimple_bb (stmt);\n+\n+  FOR_EACH_IMM_USE_STMT (use_stmt, imm_iter, def)\n+    if (def_bb != gimple_bb (use_stmt)\n+\t&& !is_gimple_debug (use_stmt))\n       {\n+\tgcc_assert (gimple_code (use_stmt) != GIMPLE_PHI);\n+\n \tif (!zero_dim_array)\n \t  {\n \t    zero_dim_array = create_zero_dim_array\n@@ -2358,32 +2411,6 @@ rewrite_cross_bb_scalar_deps (sese region, gimple_stmt_iterator *gsi)\n       }\n }\n \n-/* Rewrite out of SSA all the reduction phi nodes of SCOP.  */\n-\n-void\n-rewrite_reductions_out_of_ssa (scop_p scop)\n-{\n-  basic_block bb;\n-  gimple_stmt_iterator psi;\n-  sese region = SCOP_REGION (scop);\n-\n-  FOR_EACH_BB (bb)\n-    if (bb_in_sese_p (bb, region))\n-      for (psi = gsi_start_phis (bb); !gsi_end_p (psi);)\n-\t{\n-\t  if (scalar_close_phi_node_p (gsi_stmt (psi)))\n-\t    rewrite_close_phi_out_of_ssa (&psi);\n-\t  else if (reduction_phi_p (region, &psi))\n-\t    rewrite_phi_out_of_ssa (&psi);\n-\t}\n-\n-  update_ssa (TODO_update_ssa);\n-#ifdef ENABLE_CHECKING\n-  verify_loop_closed_ssa (true);\n-#endif\n-}\n-\n-\n /* Rewrite out of SSA all the reduction phi nodes of SCOP.  */\n \n void\n@@ -2396,7 +2423,10 @@ rewrite_cross_bb_scalar_deps_out_of_ssa (scop_p scop)\n   FOR_EACH_BB (bb)\n     if (bb_in_sese_p (bb, region))\n       for (psi = gsi_start_bb (bb); !gsi_end_p (psi); gsi_next (&psi))\n-\trewrite_cross_bb_scalar_deps (region, &psi);\n+\t{\n+\t  rewrite_cross_bb_phi_deps (region, psi);\n+\t  rewrite_cross_bb_scalar_deps (region, &psi);\n+\t}\n \n   update_ssa (TODO_update_ssa);\n #ifdef ENABLE_CHECKING"}]}