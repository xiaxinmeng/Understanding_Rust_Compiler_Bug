{"sha": "fae4d8398825d0d0f7cb641dcd286885058d3a88", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmFlNGQ4Mzk4ODI1ZDBkMGY3Y2I2NDFkY2QyODY4ODUwNThkM2E4OA==", "commit": {"author": {"name": "Gary Dismukes", "email": "dismukes@adacore.com", "date": "2007-12-13T10:25:50Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-12-13T10:25:50Z"}, "message": "exp_ch8.ads, [...] (Expand_N_Subprogram_Renaming_Declaration): In the case where the renamed subprogram is a dereference...\n\n2007-12-06  Gary Dismukes  <dismukes@adacore.com>\n\n\t* exp_ch8.ads, exp_ch8.adb (Expand_N_Subprogram_Renaming_Declaration):\n\tIn the case where the renamed subprogram is a dereference, call\n\tForce_Evaluation on the prefix.\n\nFrom-SVN: r130833", "tree": {"sha": "21f162f9ce7b625ec950f58e55711ef6c7f94898", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/21f162f9ce7b625ec950f58e55711ef6c7f94898"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fae4d8398825d0d0f7cb641dcd286885058d3a88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fae4d8398825d0d0f7cb641dcd286885058d3a88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fae4d8398825d0d0f7cb641dcd286885058d3a88", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fae4d8398825d0d0f7cb641dcd286885058d3a88/comments", "author": {"login": "dismukes", "id": 50880541, "node_id": "MDQ6VXNlcjUwODgwNTQx", "avatar_url": "https://avatars.githubusercontent.com/u/50880541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dismukes", "html_url": "https://github.com/dismukes", "followers_url": "https://api.github.com/users/dismukes/followers", "following_url": "https://api.github.com/users/dismukes/following{/other_user}", "gists_url": "https://api.github.com/users/dismukes/gists{/gist_id}", "starred_url": "https://api.github.com/users/dismukes/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dismukes/subscriptions", "organizations_url": "https://api.github.com/users/dismukes/orgs", "repos_url": "https://api.github.com/users/dismukes/repos", "events_url": "https://api.github.com/users/dismukes/events{/privacy}", "received_events_url": "https://api.github.com/users/dismukes/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d07e197c8751b00c2d3f204fcda4bdbe23889d82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d07e197c8751b00c2d3f204fcda4bdbe23889d82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d07e197c8751b00c2d3f204fcda4bdbe23889d82"}], "stats": {"total": 35, "additions": 29, "deletions": 6}, "files": [{"sha": "68fa50eb6e58d9a349e0b396c101121646586c21", "filename": "gcc/ada/exp_ch8.adb", "status": "modified", "additions": 28, "deletions": 6, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fae4d8398825d0d0f7cb641dcd286885058d3a88/gcc%2Fada%2Fexp_ch8.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fae4d8398825d0d0f7cb641dcd286885058d3a88/gcc%2Fada%2Fexp_ch8.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch8.adb?ref=fae4d8398825d0d0f7cb641dcd286885058d3a88", "patch": "@@ -131,9 +131,7 @@ package body Exp_Ch8 is\n          --  the prefix, which is itself a name, recursively, and then force\n          --  the evaluation of all the subscripts (or attribute expressions).\n \n-         elsif K = N_Indexed_Component\n-           or else K = N_Attribute_Reference\n-         then\n+         elsif Nkind_In (K, N_Indexed_Component, N_Attribute_Reference) then\n             Evaluate_Name (Prefix (Fname));\n \n             E := First (Expressions (Fname));\n@@ -203,9 +201,7 @@ package body Exp_Ch8 is\n \n       function Evaluation_Required (Nam : Node_Id) return Boolean is\n       begin\n-         if Nkind (Nam) = N_Indexed_Component\n-           or else Nkind (Nam) = N_Slice\n-         then\n+         if Nkind_In (Nam, N_Indexed_Component, N_Slice) then\n             if Is_Packed (Etype (Prefix (Nam))) then\n                return True;\n             else\n@@ -337,4 +333,30 @@ package body Exp_Ch8 is\n       end if;\n    end Expand_N_Package_Renaming_Declaration;\n \n+   ----------------------------------------------\n+   -- Expand_N_Subprogram_Renaming_Declaration --\n+   ----------------------------------------------\n+\n+   procedure Expand_N_Subprogram_Renaming_Declaration (N : Node_Id) is\n+      Nam : constant Node_Id := Name (N);\n+\n+   begin\n+      --  When the prefix of the name is a function call, we must force the\n+      --  call to be made by removing side effects from the call, since we\n+      --  must only call the function once.\n+\n+      if Nkind (Nam) = N_Selected_Component\n+        and then Nkind (Prefix (Nam)) = N_Function_Call\n+      then\n+         Remove_Side_Effects (Prefix (Nam));\n+\n+      --  For an explicit dereference, the prefix must be captured to prevent\n+      --  reevaluation on calls through the renaming, which could result in\n+      --  calling the wrong subprogram if the access value were to be changed.\n+\n+      elsif Nkind (Nam) = N_Explicit_Dereference then\n+         Force_Evaluation (Prefix (Nam));\n+      end if;\n+   end Expand_N_Subprogram_Renaming_Declaration;\n+\n end Exp_Ch8;"}, {"sha": "7df54f3069adddb2e1b11e87b4e4fe85fb01e0f1", "filename": "gcc/ada/exp_ch8.ads", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fae4d8398825d0d0f7cb641dcd286885058d3a88/gcc%2Fada%2Fexp_ch8.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fae4d8398825d0d0f7cb641dcd286885058d3a88/gcc%2Fada%2Fexp_ch8.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch8.ads?ref=fae4d8398825d0d0f7cb641dcd286885058d3a88", "patch": "@@ -31,4 +31,5 @@ package Exp_Ch8 is\n    procedure Expand_N_Exception_Renaming_Declaration  (N : Node_Id);\n    procedure Expand_N_Object_Renaming_Declaration     (N : Node_Id);\n    procedure Expand_N_Package_Renaming_Declaration    (N : Node_Id);\n+   procedure Expand_N_Subprogram_Renaming_Declaration (N : Node_Id);\n end Exp_Ch8;"}]}