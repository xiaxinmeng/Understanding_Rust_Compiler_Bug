{"sha": "c23aea6edc9e28578992112503e6118e3450bea4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzIzYWVhNmVkYzllMjg1Nzg5OTIxMTI1MDNlNjExOGUzNDUwYmVhNA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-01-13T10:55:29Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-01-13T10:57:14Z"}, "message": "gcc-changelog: Allow modifications to old ChangeLogs without entry\n\ncontrib/ChangeLog:\n\n\t* gcc-changelog/git_commit.py: Allow modifications of older\n\tChangeLog (or specific) files without need to make a ChangeLog\n\tentry.\n\t* gcc-changelog/test_email.py: Test it.\n\t* gcc-changelog/test_patches.txt: Add new patch.", "tree": {"sha": "ee7f2df32202394f5c183de3febbbe65e42d2d53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee7f2df32202394f5c183de3febbbe65e42d2d53"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c23aea6edc9e28578992112503e6118e3450bea4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c23aea6edc9e28578992112503e6118e3450bea4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c23aea6edc9e28578992112503e6118e3450bea4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c23aea6edc9e28578992112503e6118e3450bea4/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b356e689c334ca4765a9ffd95a76cf715447200", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b356e689c334ca4765a9ffd95a76cf715447200", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b356e689c334ca4765a9ffd95a76cf715447200"}], "stats": {"total": 36, "additions": 33, "deletions": 3}, "files": [{"sha": "59f478670d7d97447f312532323ed53fcbc1eb21", "filename": "contrib/gcc-changelog/git_commit.py", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23aea6edc9e28578992112503e6118e3450bea4/contrib%2Fgcc-changelog%2Fgit_commit.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23aea6edc9e28578992112503e6118e3450bea4/contrib%2Fgcc-changelog%2Fgit_commit.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Fgit_commit.py?ref=c23aea6edc9e28578992112503e6118e3450bea4", "patch": "@@ -308,7 +308,7 @@ def __init__(self, info, strict=True, commit_to_info_hook=None):\n             self.info = self.commit_to_info_hook(self.revert_commit)\n \n         project_files = [f for f in self.info.modified_files\n-                         if self.is_changelog_filename(f[0])\n+                         if self.is_changelog_filename(f[0], allow_suffix=True)\n                          or f[0] in misc_files]\n         ignored_files = [f for f in self.info.modified_files\n                          if self.in_ignored_location(f[0])]\n@@ -343,8 +343,14 @@ def new_files(self):\n         return [x[0] for x in self.info.modified_files if x[1] == 'A']\n \n     @classmethod\n-    def is_changelog_filename(cls, path):\n-        return path.endswith('/ChangeLog') or path == 'ChangeLog'\n+    def is_changelog_filename(cls, path, allow_suffix=False):\n+        basename = os.path.basename(path)\n+        if basename == 'ChangeLog':\n+            return True\n+        elif allow_suffix and basename.startswith('ChangeLog'):\n+            return True\n+        else:\n+            return False\n \n     @classmethod\n     def find_changelog_location(cls, name):"}, {"sha": "532ed6a79831ab3b8f50afc663bc5ccd3fd5f083", "filename": "contrib/gcc-changelog/test_email.py", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23aea6edc9e28578992112503e6118e3450bea4/contrib%2Fgcc-changelog%2Ftest_email.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23aea6edc9e28578992112503e6118e3450bea4/contrib%2Fgcc-changelog%2Ftest_email.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Ftest_email.py?ref=c23aea6edc9e28578992112503e6118e3450bea4", "patch": "@@ -404,3 +404,7 @@ def test_bad_unicode_chars_in_filename(self):\n         email = self.from_patch_glob('0001-Add-horse2.patch')\n         assert not email.errors\n         assert email.changelog_entries[0].files == ['kon\u00ed\u010dek.txt']\n+\n+    def test_modification_of_old_changelog(self):\n+        email = self.from_patch_glob('0001-fix-old-ChangeLog.patch')\n+        assert not email.errors"}, {"sha": "6b75e488903baf47f0e478f34f58081bcd990a8e", "filename": "contrib/gcc-changelog/test_patches.txt", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c23aea6edc9e28578992112503e6118e3450bea4/contrib%2Fgcc-changelog%2Ftest_patches.txt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c23aea6edc9e28578992112503e6118e3450bea4/contrib%2Fgcc-changelog%2Ftest_patches.txt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Ftest_patches.txt?ref=c23aea6edc9e28578992112503e6118e3450bea4", "patch": "@@ -3398,4 +3398,24 @@ index 00000000000..56c67f58752\n -- \n 2.29.2\n \n+=== 0001-fix-old-ChangeLog.patch ===\n+From fd498465b2801203089616be9a0e3c1f4fc065a0 Mon Sep 17 00:00:00 2001\n+From: Martin Liska <mliska@suse.cz>\n+Date: Wed, 13 Jan 2021 11:45:37 +0100\n+Subject: [PATCH] Fix a changelog.\n+\n+---\n+ gcc/ChangeLog-2020 | 1 +\n+ 1 file changed, 1 insertion(+)\n+\n+diff --git a/gcc/ChangeLog-2020 b/gcc/ChangeLog-2020\n+index 6553720acad..2c170ef014a 100644\n+--- a/gcc/ChangeLog-2020\n++++ b/gcc/ChangeLog-2020\n+@@ -1 +1,2 @@\n+ \n++\n+ \n+-- \n+2.29.2\n "}]}