{"sha": "e5ba9b702f14441f43a577e9f44192c14a43cd7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTViYTliNzAyZjE0NDQxZjQzYTU3N2U5ZjQ0MTkyYzE0YTQzY2Q3Yg==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2018-09-08T17:36:08Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2018-09-08T17:36:08Z"}, "message": "PR c++/87150 - wrong ctor with maybe-rvalue semantics.\n\n\t* call.c (struct conversion): Update commentary.\n\t(standard_conversion): Set rvaluedness_matches_p if LOOKUP_PREFER_RVALUE\n\tfor ck_base.\n\n\t* g++.dg/cpp0x/move-return2.C: New test.\n\nFrom-SVN: r264172", "tree": {"sha": "45b847e27dbdc2175a5265187b18b8d173e28302", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/45b847e27dbdc2175a5265187b18b8d173e28302"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5ba9b702f14441f43a577e9f44192c14a43cd7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5ba9b702f14441f43a577e9f44192c14a43cd7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5ba9b702f14441f43a577e9f44192c14a43cd7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5ba9b702f14441f43a577e9f44192c14a43cd7b/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3075affdbcb3232fe549fbeed87bd94114c14758", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3075affdbcb3232fe549fbeed87bd94114c14758", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3075affdbcb3232fe549fbeed87bd94114c14758"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "76fe61eff64f6c253aacd18c1aae22b08f752b34", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e5ba9b702f14441f43a577e9f44192c14a43cd7b", "patch": "@@ -1,3 +1,10 @@\n+2018-09-08  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/87150 - wrong ctor with maybe-rvalue semantics.\n+\t* call.c (struct conversion): Update commentary.\n+\t(standard_conversion): Set rvaluedness_matches_p if LOOKUP_PREFER_RVALUE\n+\tfor ck_base.\n+\n 2018-09-08  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/86678 - constexpr function with non-constant after return."}, {"sha": "03b4c5ab224fc35c37e36a1706fb1e2f811396d5", "filename": "gcc/cp/call.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=e5ba9b702f14441f43a577e9f44192c14a43cd7b", "patch": "@@ -102,10 +102,10 @@ struct conversion {\n   BOOL_BITFIELD base_p : 1;\n   /* If KIND is ck_ref_bind, true when either an lvalue reference is\n      being bound to an lvalue expression or an rvalue reference is\n-     being bound to an rvalue expression.  If KIND is ck_rvalue,\n+     being bound to an rvalue expression.  If KIND is ck_rvalue or ck_base,\n      true when we are treating an lvalue as an rvalue (12.8p33).  If\n-     KIND is ck_base, always false.  If ck_identity, we will be\n-     binding a reference directly or decaying to a pointer.  */\n+     ck_identity, we will be binding a reference directly or decaying to\n+     a pointer.  */\n   BOOL_BITFIELD rvaluedness_matches_p: 1;\n   BOOL_BITFIELD check_narrowing: 1;\n   /* Whether check_narrowing should only check TREE_CONSTANTs; used\n@@ -1425,6 +1425,9 @@ standard_conversion (tree to, tree from, tree expr, bool c_cast_p,\n \t type.  A temporary object is created to hold the result of\n \t the conversion unless we're binding directly to a reference.  */\n       conv->need_temporary_p = !(flags & LOOKUP_NO_TEMP_BIND);\n+      if (flags & LOOKUP_PREFER_RVALUE)\n+\t/* Tell convert_like_real to set LOOKUP_PREFER_RVALUE.  */\n+\tconv->rvaluedness_matches_p = true;\n     }\n   else\n     return NULL;"}, {"sha": "0c038441a8c5089c38abbd7bc7670c9fa3c4a332", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e5ba9b702f14441f43a577e9f44192c14a43cd7b", "patch": "@@ -1,3 +1,8 @@\n+2018-09-08  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/87150 - wrong ctor with maybe-rvalue semantics.\n+\t* g++.dg/cpp0x/move-return2.C: New test.\n+\n 2018-09-08  Marek Polacek  <polacek@redhat.com>\n \n \t* c-c++-common/array-init.c: Add dg-prune-output."}, {"sha": "681e9ecaca10cd318f6e21d409727dca8c46b9ba", "filename": "gcc/testsuite/g++.dg/cpp0x/move-return2.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fmove-return2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5ba9b702f14441f43a577e9f44192c14a43cd7b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fmove-return2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fmove-return2.C?ref=e5ba9b702f14441f43a577e9f44192c14a43cd7b", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/87150\n+// { dg-do compile { target c++11 } }\n+\n+struct S1 { S1(S1 &&); };\n+struct S2 : S1 {};\n+\n+S1\n+f (S2 s)\n+{\n+  return s; // { dg-error \"use of deleted function\" }\n+}"}]}