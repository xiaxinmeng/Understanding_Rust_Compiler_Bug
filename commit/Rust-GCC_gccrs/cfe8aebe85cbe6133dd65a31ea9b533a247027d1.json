{"sha": "cfe8aebe85cbe6133dd65a31ea9b533a247027d1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2ZlOGFlYmU4NWNiZTYxMzNkZDY1YTMxZWE5YjUzM2EyNDcwMjdkMQ==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@arm.com", "date": "2016-03-23T15:24:20Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2016-03-23T15:24:20Z"}, "message": "re PR tree-optimization/69042 (Missed optimization in ivopts)\n\n\n\tPR tree-optimization/69042\n\t* tree-ssa-loop-ivopts.c (add_iv_candidate_for_use): Add IV cand\n\tfor use with constant offset stripped in base.\n\nFrom-SVN: r234429", "tree": {"sha": "a4e24ee53b5daf4b5e8003fcab8eafd02682d5bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a4e24ee53b5daf4b5e8003fcab8eafd02682d5bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cfe8aebe85cbe6133dd65a31ea9b533a247027d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfe8aebe85cbe6133dd65a31ea9b533a247027d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cfe8aebe85cbe6133dd65a31ea9b533a247027d1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfe8aebe85cbe6133dd65a31ea9b533a247027d1/comments", "author": null, "committer": null, "parents": [{"sha": "b6d1f2b546079eb367b497228ca54d97dddc8921", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6d1f2b546079eb367b497228ca54d97dddc8921", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6d1f2b546079eb367b497228ca54d97dddc8921"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "e035f1b678af0315e30733a18d1f10cb1fd984d0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe8aebe85cbe6133dd65a31ea9b533a247027d1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe8aebe85cbe6133dd65a31ea9b533a247027d1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cfe8aebe85cbe6133dd65a31ea9b533a247027d1", "patch": "@@ -1,3 +1,9 @@\n+2016-03-23  Bin Cheng  <bin.cheng@arm.com>\n+\n+\tPR tree-optimization/69042\n+\t* tree-ssa-loop-ivopts.c (add_iv_candidate_for_use): Add IV cand\n+\tfor use with constant offset stripped in base.\n+\n 2016-03-23  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/70251"}, {"sha": "99dd4d0b7ec25220dc545137dfaf9cf547454f5b", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfe8aebe85cbe6133dd65a31ea9b533a247027d1/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfe8aebe85cbe6133dd65a31ea9b533a247027d1/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=cfe8aebe85cbe6133dd65a31ea9b533a247027d1", "patch": "@@ -3232,11 +3232,13 @@ add_iv_candidate_for_use (struct ivopts_data *data, struct iv_use *use)\n     basetype = sizetype;\n   record_common_cand (data, build_int_cst (basetype, 0), iv->step, use);\n \n-  /* Record common candidate with constant offset stripped in base.  */\n+  /* Record common candidate with constant offset stripped in base.\n+     Like the use itself, we also add candidate directly for it.  */\n+  base = strip_offset (iv->base, &offset);\n+  if (offset || base != iv->base)\n     {\n-      base = strip_offset (iv->base, &offset);\n-      if (offset || base != iv->base)\n-\trecord_common_cand (data, base, iv->step, use);\n+      record_common_cand (data, base, iv->step, use);\n+      add_candidate (data, base, iv->step, false, use);\n     }\n \n   /* Record common candidate with base_object removed in base.  */"}]}