{"sha": "29c4d22b06b699bbea8d57b9bfa8c12ada569261", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjljNGQyMmIwNmI2OTliYmVhOGQ1N2I5YmZhOGMxMmFkYTU2OTI2MQ==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2004-10-01T15:22:26Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2004-10-01T15:22:26Z"}, "message": "re PR tree-optimization/17343 (a dispatch table can be shortened for certain switch statements)\n\n2004-10-01  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR tree-opt/17343\n        * gcc.dg/tree-ssa/pr17343.c: New test.\n\n2004-10-01  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR tree-opt/17343\n        * tree-cfg.c (group_case_labels): Get the label and not\n        the case expr for the default case.\n        When the label we looking at is the default, decrement the\n        new_size.\n\nFrom-SVN: r88397", "tree": {"sha": "54b57557dcba247480b883bc8ddbb7cdf25e55e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54b57557dcba247480b883bc8ddbb7cdf25e55e0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29c4d22b06b699bbea8d57b9bfa8c12ada569261", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29c4d22b06b699bbea8d57b9bfa8c12ada569261", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29c4d22b06b699bbea8d57b9bfa8c12ada569261", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29c4d22b06b699bbea8d57b9bfa8c12ada569261/comments", "author": null, "committer": null, "parents": [{"sha": "0f0377f6dde05e7bc08025824b24ce8917cbcee7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f0377f6dde05e7bc08025824b24ce8917cbcee7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f0377f6dde05e7bc08025824b24ce8917cbcee7"}], "stats": {"total": 57, "additions": 56, "deletions": 1}, "files": [{"sha": "f32a14bd156a97d71ff94ea795811e8a085e2067", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=29c4d22b06b699bbea8d57b9bfa8c12ada569261", "patch": "@@ -1,3 +1,11 @@\n+2004-10-01  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR tree-opt/17343\n+\t* tree-cfg.c (group_case_labels): Get the label and not\n+\tthe case expr for the default case.\n+\tWhen the label we looking at is the default, decrement the\n+\tnew_size.\n+\n 2004-10-01  Jan Hubicka  <jh@suse.cz>\n \n \t* c-decl.c (c_expand_body): Update call tree_rest_of_compilation."}, {"sha": "cf4646c1c41788fc33e5b9b6ba1e9d86a65586ed", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=29c4d22b06b699bbea8d57b9bfa8c12ada569261", "patch": "@@ -1,3 +1,8 @@\n+2004-10-01  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR tree-opt/17343\n+\t* gcc.dg/tree-ssa/pr17343.c: New test.\n+\n 2004-10-01  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.dg/tree-ssa/stdarg-1.c: Removed."}, {"sha": "b415d667615167cba4e32be267801f0fe3e01715", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr17343.c", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr17343.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr17343.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr17343.c?ref=29c4d22b06b699bbea8d57b9bfa8c12ada569261", "patch": "@@ -0,0 +1,36 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O1 -fdump-tree-optimized\" } */\n+void foo0(void);\n+void foo1(void);\n+void foo2(void);\n+void foo3(void);\n+\n+void\n+foo (int a)\n+{\n+  switch (a)\n+    {\n+    case 10:\n+    case 11:\n+    case 12:\n+    case 13:\n+      goto ddd;\n+    case 14:\n+      foo1();\n+      break;\n+    case 15:\n+      foo2();\n+      break;\n+    case 16:\n+      foo3();\n+      break;\n+    default:\n+    ddd:\n+      foo0();\n+      break;\n+    }\n+}\n+/* There should be precisely two references to ddd.  One in the switch\n+   and one for the label, we used not to combine the case 10-13 into\n+   the default case.  */\n+/* { dg-final { scan-tree-dump-times \"ddd\" 1 \"optimized\"} } */"}, {"sha": "e047943cb42a27e31d10fcc0d56cb5436997d3f8", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29c4d22b06b699bbea8d57b9bfa8c12ada569261/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=29c4d22b06b699bbea8d57b9bfa8c12ada569261", "patch": "@@ -941,7 +941,12 @@ group_case_labels (void)\n \t  tree labels = SWITCH_LABELS (stmt);\n \t  int old_size = TREE_VEC_LENGTH (labels);\n \t  int i, j, new_size = old_size;\n-\t  tree default_label = TREE_VEC_ELT (labels, old_size - 1);\n+\t  tree default_case = TREE_VEC_ELT (labels, old_size - 1);\n+ \t  tree default_label;\n+\n+\t  /* The default lable is always the last case in a switch\n+\t     statement after gimplification.  */\n+\t  default_label = CASE_LABEL (default_case);\n \n \t  /* Look for possible opportunities to merge cases.\n \t     Ignore the last element of the label vector because it\n@@ -961,6 +966,7 @@ group_case_labels (void)\n \t\t{\n \t\t  TREE_VEC_ELT (labels, i) = NULL_TREE;\n \t\t  i++;\n+\t\t  new_size--;\n \t\t  continue;\n \t\t}\n "}]}