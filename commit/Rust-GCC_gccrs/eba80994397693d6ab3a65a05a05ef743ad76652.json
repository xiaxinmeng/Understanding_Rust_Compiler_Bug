{"sha": "eba80994397693d6ab3a65a05a05ef743ad76652", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWJhODA5OTQzOTc2OTNkNmFiM2E2NWEwNWEwNWVmNzQzYWQ3NjY1Mg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@multimania.com", "date": "2002-03-22T02:03:46Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2002-03-22T02:03:46Z"}, "message": "re PR c/5597 ([regression from 2.95.3] Initialization of flexible char array member segfaults)\n\n        PR c/5597\n        * c-typeck.c (process_init_element): Flag non-static\n        initialization of a flexible array member as illegal.\n\nFrom-SVN: r51156", "tree": {"sha": "487636832b303f5c58b5f3e01233b424c5621084", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/487636832b303f5c58b5f3e01233b424c5621084"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eba80994397693d6ab3a65a05a05ef743ad76652", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba80994397693d6ab3a65a05a05ef743ad76652", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eba80994397693d6ab3a65a05a05ef743ad76652", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eba80994397693d6ab3a65a05a05ef743ad76652/comments", "author": null, "committer": null, "parents": [{"sha": "bac015e7922ccedbaeab8ab7bef539ddddd93c19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bac015e7922ccedbaeab8ab7bef539ddddd93c19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bac015e7922ccedbaeab8ab7bef539ddddd93c19"}], "stats": {"total": 50, "additions": 42, "deletions": 8}, "files": [{"sha": "96c4fcad84350b688a291f6a9d3fbfbd00bc996f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba80994397693d6ab3a65a05a05ef743ad76652/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba80994397693d6ab3a65a05a05ef743ad76652/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=eba80994397693d6ab3a65a05a05ef743ad76652", "patch": "@@ -1,3 +1,9 @@\n+2002-03-21  Eric Botcazou <ebotcazou@multimania.com>\n+\n+\tPR c/5597\n+\t* c-typeck.c (process_init_element): Flag non-static\n+\tinitialization of a flexible array member as illegal.\n+\n 2002-03-22  Alan Modra  <amodra@bigpond.net.au>\n \n \t* config/rs6000/t-linux64: New.\n@@ -10,19 +16,19 @@\n \n 2002-03-21  Aldy Hernandez  <aldyh@redhat.com>\n \n-        * langhooks.c (lhd_tree_inlining_cannot_inline_tree_fn): Check\n-        flag_really_no_inline instead of optimize == 0.\n+\t* langhooks.c (lhd_tree_inlining_cannot_inline_tree_fn): Check\n+\tflag_really_no_inline instead of optimize == 0.\n \n-        * c-objc-common.c (c_cannot_inline_tree_fn): Same.\n+\t* c-objc-common.c (c_cannot_inline_tree_fn): Same.\n \n-        * cp/tree.c (cp_cannot_inline_tree_fn): Same.\n+\t* cp/tree.c (cp_cannot_inline_tree_fn): Same.\n \n-        * flags.h (flag_really_no_inline): New.\n+\t* flags.h (flag_really_no_inline): New.\n \n-        * c-common.c (c_common_post_options): Initialzie\n-        flag_really_no_inline.\n+\t* c-common.c (c_common_post_options): Initialzie\n+\tflag_really_no_inline.\n \n-        * toplev.c (flag_really_no_inline): New.\n+\t* toplev.c (flag_really_no_inline): New.\n \n 2002-03-21  Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "297b0f9e188d4952590fcf823b00219b7b4dc18f", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba80994397693d6ab3a65a05a05ef743ad76652/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba80994397693d6ab3a65a05a05ef743ad76652/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=eba80994397693d6ab3a65a05a05ef743ad76652", "patch": "@@ -6537,6 +6537,16 @@ process_init_element (value)\n \t    fieldtype = TYPE_MAIN_VARIANT (fieldtype);\n \t  fieldcode = TREE_CODE (fieldtype);\n \n+\t  /* Error for non-static initialization of a flexible array member.  */\n+\t  if (fieldcode == ARRAY_TYPE\n+\t      && !require_constant_value\n+\t      && TYPE_SIZE (fieldtype) == NULL_TREE\n+\t      && TREE_CHAIN (constructor_fields) == NULL_TREE)\n+\t    {\n+\t      error_init (\"non-static initialization of a flexible array member\");\n+\t      break;\n+\t    }\n+\n \t  /* Accept a string constant to initialize a subarray.  */\n \t  if (value != 0\n \t      && fieldcode == ARRAY_TYPE"}, {"sha": "6ef64625b964ec73bed3203bd83fde3dfb723a6b", "filename": "gcc/testsuite/gcc.dg/array-6.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eba80994397693d6ab3a65a05a05ef743ad76652/gcc%2Ftestsuite%2Fgcc.dg%2Farray-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eba80994397693d6ab3a65a05a05ef743ad76652/gcc%2Ftestsuite%2Fgcc.dg%2Farray-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Farray-6.c?ref=eba80994397693d6ab3a65a05a05ef743ad76652", "patch": "@@ -0,0 +1,18 @@\n+/* PR c/5597 */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+/* Verify that GCC forbids non-static initialization of\n+   flexible array members. */\n+\n+struct str { int len; char s[]; };\n+\n+struct str a = { 2, \"a\" };\n+\n+void foo()\n+{\n+  static struct str b = { 2, \"b\" };\n+  struct str c = { 2, \"c\" }; /* { dg-error \"(non-static)|(near initialization)\" } */\n+  struct str d = (struct str) { 2, \"d\" }; /* { dg-error \"(non-static)|(near initialization)\" } */\n+  struct str e = (struct str) { d.len, \"e\" }; /* { dg-error \"(non-static)|(initialization)\" } */\n+}"}]}