{"sha": "b15b83fb3bf49df836c84730431b68d498082825", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjE1YjgzZmIzYmY0OWRmODM2Yzg0NzMwNDMxYjY4ZDQ5ODA4MjgyNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2005-11-30T08:32:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2005-11-30T08:32:16Z"}, "message": "ia64.c (ia64_expand_tls_address): Add ORIG_OP1 argument.\n\n\t* config/ia64/ia64.c (ia64_expand_tls_address): Add ORIG_OP1 argument.\n\tMove ADDEND_{HI,LO} computation into TLS_MODEL_INITIAL_EXEC case.\n\t(ia64_expand_move): Adjust caller.\n\n\t* gcc.dg/tls/opt-11.c: New test.\n\nFrom-SVN: r107704", "tree": {"sha": "1e311d2e2f202b73e7190f1e81193daf76fd4f66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e311d2e2f202b73e7190f1e81193daf76fd4f66"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b15b83fb3bf49df836c84730431b68d498082825", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b15b83fb3bf49df836c84730431b68d498082825", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b15b83fb3bf49df836c84730431b68d498082825", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b15b83fb3bf49df836c84730431b68d498082825/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dca1376799471fb6005a43f3a8836f45db5b78c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dca1376799471fb6005a43f3a8836f45db5b78c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dca1376799471fb6005a43f3a8836f45db5b78c9"}], "stats": {"total": 52, "additions": 46, "deletions": 6}, "files": [{"sha": "4c2e7bed6abfeb2b36357ef8a46c4ddcb3a3ef93", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b15b83fb3bf49df836c84730431b68d498082825/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b15b83fb3bf49df836c84730431b68d498082825/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b15b83fb3bf49df836c84730431b68d498082825", "patch": "@@ -1,5 +1,9 @@\n 2005-11-30  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* config/ia64/ia64.c (ia64_expand_tls_address): Add ORIG_OP1 argument.\n+\tMove ADDEND_{HI,LO} computation into TLS_MODEL_INITIAL_EXEC case.\n+\t(ia64_expand_move): Adjust caller.\n+\n \t* config/ia64/ia64.c (ia64_expand_atomic_op): Only use\n \tfetchadd{4,8}.acq instruction if CODE is PLUS or MINUS, for MINUS\n \tnegate VAL."}, {"sha": "95a4cdbd39f414af306e8c08568cd13752e3332b", "filename": "gcc/config/ia64/ia64.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b15b83fb3bf49df836c84730431b68d498082825/gcc%2Fconfig%2Fia64%2Fia64.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b15b83fb3bf49df836c84730431b68d498082825/gcc%2Fconfig%2Fia64%2Fia64.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fia64%2Fia64.c?ref=b15b83fb3bf49df836c84730431b68d498082825", "patch": "@@ -891,15 +891,12 @@ gen_thread_pointer (void)\n \n static rtx\n ia64_expand_tls_address (enum tls_model tls_kind, rtx op0, rtx op1,\n-\t\t\t HOST_WIDE_INT addend)\n+\t\t\t rtx orig_op1, HOST_WIDE_INT addend)\n {\n   rtx tga_op1, tga_op2, tga_ret, tga_eqv, tmp, insns;\n-  rtx orig_op0 = op0, orig_op1 = op1;\n+  rtx orig_op0 = op0;\n   HOST_WIDE_INT addend_lo, addend_hi;\n \n-  addend_lo = ((addend & 0x3fff) ^ 0x2000) - 0x2000;\n-  addend_hi = addend - addend_lo;\n-\n   switch (tls_kind)\n     {\n     case TLS_MODEL_GLOBAL_DYNAMIC:\n@@ -959,6 +956,9 @@ ia64_expand_tls_address (enum tls_model tls_kind, rtx op0, rtx op1,\n       break;\n \n     case TLS_MODEL_INITIAL_EXEC:\n+      addend_lo = ((addend & 0x3fff) ^ 0x2000) - 0x2000;\n+      addend_hi = addend - addend_lo;\n+\n       op1 = plus_constant (op1, addend_hi);\n       addend = addend_lo;\n \n@@ -1023,7 +1023,7 @@ ia64_expand_move (rtx op0, rtx op1)\n \n       tls_kind = tls_symbolic_operand_type (sym);\n       if (tls_kind)\n-\treturn ia64_expand_tls_address (tls_kind, op0, sym, addend);\n+\treturn ia64_expand_tls_address (tls_kind, op0, sym, op1, addend);\n \n       if (any_offset_symbol_operand (sym, mode))\n \taddend = 0;"}, {"sha": "57ea16df284cd9714fc8198a9062193da1009796", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b15b83fb3bf49df836c84730431b68d498082825/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b15b83fb3bf49df836c84730431b68d498082825/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b15b83fb3bf49df836c84730431b68d498082825", "patch": "@@ -1,3 +1,7 @@\n+2005-11-30  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.dg/tls/opt-11.c: New test.\n+\n 2005-11-29  Joseph S. Myers  <joseph@codesourcery.com>\n \n \t* gcc.dg/torture/fp-int-convert-timode.c: XFAIL only on lp64"}, {"sha": "5b2cd5c98faa33d324caccb1cf32f300e2c1ad85", "filename": "gcc/testsuite/gcc.dg/tls/opt-11.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b15b83fb3bf49df836c84730431b68d498082825/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b15b83fb3bf49df836c84730431b68d498082825/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-11.c?ref=b15b83fb3bf49df836c84730431b68d498082825", "patch": "@@ -0,0 +1,32 @@\n+/* { dg-do run } */\n+\n+extern void abort (void);\n+extern void *memset (void *, int, __SIZE_TYPE__);\n+\n+struct A\n+{\n+  char pad[48];\n+  int i;\n+  int pad2;\n+  int j;\n+};\n+__thread struct A a;\n+\n+int *\n+__attribute__((noinline))\n+foo (void)\n+{\n+  return &a.i;\n+}\n+\n+int\n+main (void)\n+{\n+  int *p = foo ();\n+  memset (&a, 0, sizeof (a));\n+  a.i = 6;\n+  a.j = 8;\n+  if (p[0] != 6 || p[1] != 0 || p[2] != 8)\n+    abort ();\n+  return 0;\n+}"}]}