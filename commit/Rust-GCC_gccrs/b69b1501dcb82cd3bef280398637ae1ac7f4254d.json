{"sha": "b69b1501dcb82cd3bef280398637ae1ac7f4254d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjY5YjE1MDFkY2I4MmNkM2JlZjI4MDM5ODYzN2FlMWFjN2Y0MjU0ZA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mmitchell@usa.net", "date": "1998-04-28T13:24:00Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "1998-04-28T13:24:00Z"}, "message": "semantics.c (begin_stmt_expr): Avoid duplicating the effect of the expression in templates.\n\n\t* semantics.c (begin_stmt_expr): Avoid duplicating the effect of\n\tthe expression in templates.\n\t(finish_stmt_expr): Likewise.\n\nFrom-SVN: r19469", "tree": {"sha": "a1d223f3c63c9e5142c933628fda85f989cfb3d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a1d223f3c63c9e5142c933628fda85f989cfb3d9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b69b1501dcb82cd3bef280398637ae1ac7f4254d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b69b1501dcb82cd3bef280398637ae1ac7f4254d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b69b1501dcb82cd3bef280398637ae1ac7f4254d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b69b1501dcb82cd3bef280398637ae1ac7f4254d/comments", "author": null, "committer": null, "parents": [{"sha": "69fa83cfbbbbf834f54d8b0926ea1f355ea0ee46", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69fa83cfbbbbf834f54d8b0926ea1f355ea0ee46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69fa83cfbbbbf834f54d8b0926ea1f355ea0ee46"}], "stats": {"total": 48, "additions": 45, "deletions": 3}, "files": [{"sha": "c9c51bb48cdd6489a73cf43db5bb05bb043abf2f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b69b1501dcb82cd3bef280398637ae1ac7f4254d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b69b1501dcb82cd3bef280398637ae1ac7f4254d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b69b1501dcb82cd3bef280398637ae1ac7f4254d", "patch": "@@ -1,3 +1,9 @@\n+Tue Apr 28 13:22:01 1998  Mark Mitchell  <mmitchell@usa.net>\n+\n+\t* semantics.c (begin_stmt_expr): Avoid duplicating the effect of\n+\tthe expression in templates.\n+\t(finish_stmt_expr): Likewise.\n+\n 1998-04-28  Brendan Kehoe  <brendan@cygnus.com>\n \n \t* decl2.c (ambiguous_decl): Fix NAME parm to be a tree, not int."}, {"sha": "e7b738a2d3c6960b08506f931faa6d44648dfb4b", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b69b1501dcb82cd3bef280398637ae1ac7f4254d/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b69b1501dcb82cd3bef280398637ae1ac7f4254d/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=b69b1501dcb82cd3bef280398637ae1ac7f4254d", "patch": "@@ -761,14 +761,18 @@ finish_parenthesized_expr (expr)\n   return expr;\n }\n \n-/* Begin a statement-expression.  Returns a new RTL_EXPR if\n-   appropriate. */\n+/* Begin a statement-expression.  The value returned must be passed to\n+   finish_stmt_expr.  */\n \n tree \n begin_stmt_expr ()\n {\n   keep_next_level ();\n-  return processing_template_decl ? NULL_TREE : expand_start_stmt_expr(); \n+  /* If we're processing_template_decl, then the upcoming compound\n+     statement will be chained onto the tree structure, starting at\n+     last_tree.  We return last_tree so that we can later unhook the\n+     compound statement.  */\n+  return processing_template_decl ? last_tree : expand_start_stmt_expr(); \n }\n \n /* Finish a statement-expression.  RTL_EXPR should be the value\n@@ -807,6 +811,14 @@ finish_stmt_expr (rtl_expr, expr)\n     }\n   else\n     result = expr;\n+\n+  if (processing_template_decl)\n+    {\n+      /* Remove the compound statement from the tree structure; it is\n+\t now saved in the BIND_EXPR.  */\n+      last_tree = rtl_expr;\n+      TREE_CHAIN (last_tree) = NULL_TREE;\n+    }\n   \n   return result;\n }"}, {"sha": "475ad72dda1d30beab032c60280c11faf2145ef0", "filename": "gcc/testsuite/g++.old-deja/g++.pt/stmtexpr2.C", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b69b1501dcb82cd3bef280398637ae1ac7f4254d/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fstmtexpr2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b69b1501dcb82cd3bef280398637ae1ac7f4254d/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fstmtexpr2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fstmtexpr2.C?ref=b69b1501dcb82cd3bef280398637ae1ac7f4254d", "patch": "@@ -0,0 +1,24 @@\n+extern \"C\" void abort();\n+\n+int i;\n+\n+void g()\n+{\n+  i++;\n+}\n+\n+template <class T>\n+void f(T)\n+{\n+  __extension__ ({g();});\n+}\n+\n+int main()\n+{\n+  f(3.0);\n+  if (i != 1)\n+    abort();\n+\n+  return 0;\n+}\n+ "}]}