{"sha": "755fa6662d06f5ab2f32043bab4728bbf654d29d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzU1ZmE2NjYyZDA2ZjVhYjJmMzIwNDNiYWI0NzI4YmJmNjU0ZDI5ZA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-06-13T20:58:08Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-06-13T20:58:08Z"}, "message": "selftest: show values when ASSERT_STREQ fails\n\nRework ASSERT_STREQ so that it prints the actual and expected values\nto stderr when it fails (by moving it to a helper function).\n\ngcc/ChangeLog:\n\t* selftest.c (selftest::fail_formatted): New function.\n\t(selftest::assert_streq): New function.\n\t* selftest.h (selftests::fail_formatted): New decl.\n\t(selftest::assert_streq): New decl.\n\t(ASSERT_STREQ): Reimplement in terms of selftest::assert_streq.\n\nFrom-SVN: r237404", "tree": {"sha": "a014daaa092f85dfc9fc4901e27b06537f61aa15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a014daaa092f85dfc9fc4901e27b06537f61aa15"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/755fa6662d06f5ab2f32043bab4728bbf654d29d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/755fa6662d06f5ab2f32043bab4728bbf654d29d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/755fa6662d06f5ab2f32043bab4728bbf654d29d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/755fa6662d06f5ab2f32043bab4728bbf654d29d/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a73786e39ff86e8e1d186baaf802b99f8675bbeb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a73786e39ff86e8e1d186baaf802b99f8675bbeb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a73786e39ff86e8e1d186baaf802b99f8675bbeb"}], "stats": {"total": 64, "additions": 55, "deletions": 9}, "files": [{"sha": "dc16da7879f965c5b12737eea0429d00e5b6d88e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755fa6662d06f5ab2f32043bab4728bbf654d29d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755fa6662d06f5ab2f32043bab4728bbf654d29d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=755fa6662d06f5ab2f32043bab4728bbf654d29d", "patch": "@@ -1,3 +1,11 @@\n+2016-06-13  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* selftest.c (selftest::fail_formatted): New function.\n+\t(selftest::assert_streq): New function.\n+\t* selftest.h (selftests::fail_formatted): New decl.\n+\t(selftest::assert_streq): New decl.\n+\t(ASSERT_STREQ): Reimplement in terms of selftest::assert_streq.\n+\n 2016-06-13  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/71403"}, {"sha": "e5332db2a0bc8807678891d30056bfd6c4ca377c", "filename": "gcc/selftest.c", "status": "modified", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755fa6662d06f5ab2f32043bab4728bbf654d29d/gcc%2Fselftest.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755fa6662d06f5ab2f32043bab4728bbf654d29d/gcc%2Fselftest.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fselftest.c?ref=755fa6662d06f5ab2f32043bab4728bbf654d29d", "patch": "@@ -44,4 +44,36 @@ selftest::fail (const char *file, int line, const char *msg)\n   abort ();\n }\n \n+/* As \"fail\", but using printf-style formatted output.  */\n+\n+void\n+selftest::fail_formatted (const char *file, int line, const char *fmt, ...)\n+{\n+  va_list ap;\n+\n+  fprintf (stderr, \"%s:%i: FAIL: \", file, line);\n+  /* TODO: add calling function name as well?  */\n+  va_start (ap, fmt);\n+  vfprintf (stderr, fmt, ap);\n+  va_end (ap);\n+  fprintf (stderr, \"\\n\");\n+  abort ();\n+}\n+\n+/* Implementation detail of ASSERT_STREQ.  */\n+\n+void\n+selftest::assert_streq (const char *file, int line,\n+\t\t\tconst char *desc_expected, const char *desc_actual,\n+\t\t\tconst char *val_expected, const char *val_actual)\n+{\n+  if (0 == strcmp (val_expected, val_actual))\n+    ::selftest::pass (file, line, \"ASSERT_STREQ\");\n+  else\n+    ::selftest::fail_formatted\n+\t(file, line, \"ASSERT_STREQ (%s, %s) expected=\\\"%s\\\" actual=\\\"%s\\\"\",\n+\t desc_expected, desc_actual, val_expected, val_actual);\n+}\n+\n+\n #endif /* #if CHECKING_P */"}, {"sha": "6759734162359e0617a323ac5e2e24ee2adf089b", "filename": "gcc/selftest.h", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755fa6662d06f5ab2f32043bab4728bbf654d29d/gcc%2Fselftest.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755fa6662d06f5ab2f32043bab4728bbf654d29d/gcc%2Fselftest.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fselftest.h?ref=755fa6662d06f5ab2f32043bab4728bbf654d29d", "patch": "@@ -39,6 +39,17 @@ extern void pass (const char *file, int line, const char *msg);\n \n extern void fail (const char *file, int line, const char *msg);\n \n+/* As \"fail\", but using printf-style formatted output.  */\n+\n+extern void fail_formatted (const char *file, int line, const char *fmt, ...)\n+ ATTRIBUTE_PRINTF_3;\n+\n+/* Implementation detail of ASSERT_STREQ.  */\n+\n+extern void assert_streq (const char *file, int line,\n+\t\t\t  const char *desc_expected, const char *desc_actual,\n+\t\t\t  const char *val_expected, const char *val_actual);\n+\n /* Declarations for specific families of tests (by source file), in\n    alphabetical order.  */\n extern void bitmap_c_tests ();\n@@ -123,15 +134,10 @@ extern int num_passes;\n    ::selftest::pass if they are equal,\n    ::selftest::fail if they are non-equal.  */\n \n-#define ASSERT_STREQ(EXPECTED, ACTUAL)\t\t\t       \\\n-  SELFTEST_BEGIN_STMT\t\t\t\t\t       \\\n-  const char *desc = \"ASSERT_STREQ (\" #EXPECTED \", \" #ACTUAL \")\"; \\\n-  const char *expected_ = (EXPECTED);\t\t\t\t  \\\n-  const char *actual_ = (ACTUAL);\t\t\t\t  \\\n-  if (0 == strcmp (expected_, actual_))\t\t\t\t  \\\n-    ::selftest::pass (__FILE__, __LINE__, desc);\t\t\t       \\\n-  else\t\t\t\t\t\t\t       \\\n-    ::selftest::fail (__FILE__, __LINE__, desc);\t\t\t       \\\n+#define ASSERT_STREQ(EXPECTED, ACTUAL)\t\t\t\t    \\\n+  SELFTEST_BEGIN_STMT\t\t\t\t\t\t    \\\n+  ::selftest::assert_streq (__FILE__, __LINE__, #EXPECTED, #ACTUAL, \\\n+\t\t\t    (EXPECTED), (ACTUAL));\t\t    \\\n   SELFTEST_END_STMT\n \n /* Evaluate PRED1 (VAL1), calling ::selftest::pass if it is true,"}]}