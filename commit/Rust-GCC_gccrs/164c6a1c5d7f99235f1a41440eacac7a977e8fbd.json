{"sha": "164c6a1c5d7f99235f1a41440eacac7a977e8fbd", "node_id": "C_kwDOANBUbNoAKDE2NGM2YTFjNWQ3Zjk5MjM1ZjFhNDE0NDBlYWNhYzdhOTc3ZThmYmQ", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-12T20:06:18Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-12T20:45:41Z"}, "message": "c++: non-array new alignment [PR102071]\n\nWhile considering the PR102071 patch for backporting, I noticed that I was\nconsidering the alignment of the array new cookie even when there isn't one\nbecause we aren't allocating an array.\n\n\tPR c++/102071\n\ngcc/cp/ChangeLog:\n\n\t* init.cc (build_new_1): Check array_p for alignment.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp1z/aligned-new9.C: Add single-object test.", "tree": {"sha": "b1bc9e232808f648390684d2099a6976c3070e46", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1bc9e232808f648390684d2099a6976c3070e46"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/164c6a1c5d7f99235f1a41440eacac7a977e8fbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/164c6a1c5d7f99235f1a41440eacac7a977e8fbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/164c6a1c5d7f99235f1a41440eacac7a977e8fbd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/164c6a1c5d7f99235f1a41440eacac7a977e8fbd/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aa7874596b9f12b25a3214b0a143b040fafa1f10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa7874596b9f12b25a3214b0a143b040fafa1f10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa7874596b9f12b25a3214b0a143b040fafa1f10"}], "stats": {"total": 6, "additions": 5, "deletions": 1}, "files": [{"sha": "7ce8d3a46e5b0156a766d0e80a7de5a7f1cfad94", "filename": "gcc/cp/init.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/164c6a1c5d7f99235f1a41440eacac7a977e8fbd/gcc%2Fcp%2Finit.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/164c6a1c5d7f99235f1a41440eacac7a977e8fbd/gcc%2Fcp%2Finit.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.cc?ref=164c6a1c5d7f99235f1a41440eacac7a977e8fbd", "patch": "@@ -3292,7 +3292,7 @@ build_new_1 (vec<tree, va_gc> **placement, tree type, tree nelts,\n     {\n       unsigned align = TYPE_ALIGN_UNIT (elt_type);\n       /* Also consider the alignment of the cookie, if any.  */\n-      if (TYPE_VEC_NEW_USES_COOKIE (elt_type))\n+      if (array_p && TYPE_VEC_NEW_USES_COOKIE (elt_type))\n \talign = MAX (align, TYPE_ALIGN_UNIT (size_type_node));\n       align_arg = build_int_cst (align_type_node, align);\n     }"}, {"sha": "3fa0ed996bd321ae3cffce16fdf7a9820cbd11d7", "filename": "gcc/testsuite/g++.dg/cpp1z/aligned-new9.C", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/164c6a1c5d7f99235f1a41440eacac7a977e8fbd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Faligned-new9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/164c6a1c5d7f99235f1a41440eacac7a977e8fbd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Faligned-new9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Faligned-new9.C?ref=164c6a1c5d7f99235f1a41440eacac7a977e8fbd", "patch": "@@ -23,4 +23,8 @@ int main()\n   X *p = new X[n];\n   if (nalign != align)\n     __builtin_abort ();\n+\n+  X *p2 = new X;\n+  if (nalign != alignof (X))\n+    __builtin_abort ();\n }"}]}