{"sha": "94e9831662a5824b2cc403cba23829ae61616a29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTRlOTgzMTY2MmE1ODI0YjJjYzQwM2NiYTIzODI5YWU2MTYxNmEyOQ==", "commit": {"author": {"name": "Andrew Pinski", "email": "andrew_pinski@playstation.sony.com", "date": "2008-03-21T22:16:49Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2008-03-21T22:16:49Z"}, "message": "re PR target/27946 (double to long long and back to double stores to the stack)\n\n2008-03-21  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n\n        PR target/27947\n        * config/rs6000/rs6000.md (floatdidf2): Discouraging fprs and\n        encouraging but not allowing gprs for input;\n        change the input constraint to !f#r.\n        (fix_truncdfdi2): Discouraging fprs and encouraging but not allowing\n        gprs for output;\n        change the output constraint to !f#r.\n\n\n2008-03-21  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n\n        PR target/27947\n        * gcc.target/powerpc/ppc64-double-1.c: New testcase.\n\nFrom-SVN: r133438", "tree": {"sha": "92fc4bf19a3a6425535a760dbbe3f1f526102995", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/92fc4bf19a3a6425535a760dbbe3f1f526102995"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94e9831662a5824b2cc403cba23829ae61616a29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94e9831662a5824b2cc403cba23829ae61616a29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94e9831662a5824b2cc403cba23829ae61616a29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94e9831662a5824b2cc403cba23829ae61616a29/comments", "author": null, "committer": null, "parents": [{"sha": "042a12f4e88525f8438f47b149415f0d035c40fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/042a12f4e88525f8438f47b149415f0d035c40fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/042a12f4e88525f8438f47b149415f0d035c40fc"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "b26a46ac24ed96e214d0baedb4b43e4cb5913541", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=94e9831662a5824b2cc403cba23829ae61616a29", "patch": "@@ -1,3 +1,13 @@\n+2008-03-21  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n+\n+\tPR target/27947\n+\t* config/rs6000/rs6000.md (floatdidf2): Discouraging fprs and\n+\tencouraging but not allowing gprs for input;\n+\tchange the input constraint to !f#r.\n+\t(fix_truncdfdi2): Discouraging fprs and encouraging but not allowing\n+\tgprs for output;\n+\tchange the output constraint to !f#r.\n+\n 2008-03-21  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/13958"}, {"sha": "cac5fd1f36b3a7c081deafdd6dfe7548f4793c86", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=94e9831662a5824b2cc403cba23829ae61616a29", "patch": "@@ -6126,7 +6126,7 @@\n \n (define_insn \"floatdidf2\"\n   [(set (match_operand:DF 0 \"gpc_reg_operand\" \"=f\")\n-\t(float:DF (match_operand:DI 1 \"gpc_reg_operand\" \"*f\")))]\n+\t(float:DF (match_operand:DI 1 \"gpc_reg_operand\" \"!f#r\")))]\n   \"TARGET_POWERPC64 && TARGET_HARD_FLOAT && TARGET_FPRS\"\n   \"fcfid %0,%1\"\n   [(set_attr \"type\" \"fp\")])\n@@ -6173,7 +6173,7 @@\n   \"\")\n \n (define_insn \"fix_truncdfdi2\"\n-  [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=*f\")\n+  [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=!f#r\")\n \t(fix:DI (match_operand:DF 1 \"gpc_reg_operand\" \"f\")))]\n   \"TARGET_POWERPC64 && TARGET_HARD_FLOAT && TARGET_FPRS\"\n   \"fctidz %0,%1\"\n@@ -6202,7 +6202,7 @@\n ;; from double rounding.\n (define_insn_and_split \"floatdisf2_internal1\"\n   [(set (match_operand:SF 0 \"gpc_reg_operand\" \"=f\")\n-        (float:SF (match_operand:DI 1 \"gpc_reg_operand\" \"*f\")))\n+        (float:SF (match_operand:DI 1 \"gpc_reg_operand\" \"!f#r\")))\n    (clobber (match_scratch:DF 2 \"=f\"))]\n   \"TARGET_POWERPC64 && TARGET_HARD_FLOAT && TARGET_FPRS\"\n   \"#\""}, {"sha": "9b650a55e00bca6f1fc75da0760a47cac1065c5c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=94e9831662a5824b2cc403cba23829ae61616a29", "patch": "@@ -1,3 +1,8 @@\n+2008-03-21  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n+\n+\tPR target/27947\n+\t* gcc.target/powerpc/ppc64-double-1.c: New testcase.\n+\n 2008-03-21  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR libfortran/32972"}, {"sha": "6672b10e9ccdc36a9997a3d86bee8963f8e128cc", "filename": "gcc/testsuite/gcc.target/powerpc/ppc64-double-1.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc64-double-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94e9831662a5824b2cc403cba23829ae61616a29/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc64-double-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fppc64-double-1.c?ref=94e9831662a5824b2cc403cba23829ae61616a29", "patch": "@@ -0,0 +1,11 @@\n+// { dg-do compile }\n+// { dg-options \"-O2 -mpowerpc64\" }\n+// { dg-final { scan-assembler-not \"stfd\"  }  }\n+\n+// The register allocator should have allocated the temporary long long value in a floating point register.\n+\n+double\n+d2ll2d (double d)\n+{\n+        return (double)(long long)d;\n+}"}]}