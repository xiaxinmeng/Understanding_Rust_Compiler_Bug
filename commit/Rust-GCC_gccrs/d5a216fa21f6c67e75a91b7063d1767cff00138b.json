{"sha": "d5a216fa21f6c67e75a91b7063d1767cff00138b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDVhMjE2ZmEyMWY2YzY3ZTc1YTkxYjcwNjNkMTc2N2NmZjAwMTM4Yg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-03-02T09:19:28Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-03-02T09:19:28Z"}, "message": "re PR tree-optimization/79345 (passing yet-uninitialized member as argument to base class constructor should warn (-Wunitialized))\n\n\tPR tree-optimization/79345\n\t* gensupport.h (struct pattern_stats): Add min_scratch_opno field.\n\t* gensupport.c (get_pattern_stats_1) <case MATCH_SCRATCH>: Update it.\n\t(get_pattern_stats): Initialize it.\n\t* genemit.c (gen_expand): Verify match_scratch numbers come after\n\tmatch_operand/match_dup numbers.\n\t* config/i386/i386.md (<s>mul<mode>3_highpart): Swap match_dup and\n\tmatch_scratch numbers.\n\t* config/i386/sse.md (avx2_gathersi<mode>, avx2_gatherdi<mode>):\n\tLikewise.\n\t* config/s390/s390.md (trunctdsd2): Likewise.\n\nFrom-SVN: r245833", "tree": {"sha": "9bdb7b7a6aa1ef3d390e533d7e1b59fb6cab5053", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9bdb7b7a6aa1ef3d390e533d7e1b59fb6cab5053"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d5a216fa21f6c67e75a91b7063d1767cff00138b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5a216fa21f6c67e75a91b7063d1767cff00138b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5a216fa21f6c67e75a91b7063d1767cff00138b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5a216fa21f6c67e75a91b7063d1767cff00138b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "da403f3178095ddf49c62994874f52650e3f5a4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da403f3178095ddf49c62994874f52650e3f5a4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da403f3178095ddf49c62994874f52650e3f5a4a"}], "stats": {"total": 56, "additions": 39, "deletions": 17}, "files": [{"sha": "0909183385fb7b8bb93dfc9cfde7ba16d37982dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -1,3 +1,17 @@\n+2017-03-02  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/79345\n+\t* gensupport.h (struct pattern_stats): Add min_scratch_opno field.\n+\t* gensupport.c (get_pattern_stats_1) <case MATCH_SCRATCH>: Update it.\n+\t(get_pattern_stats): Initialize it.\n+\t* genemit.c (gen_expand): Verify match_scratch numbers come after\n+\tmatch_operand/match_dup numbers.\n+\t* config/i386/i386.md (<s>mul<mode>3_highpart): Swap match_dup and\n+\tmatch_scratch numbers.\n+\t* config/i386/sse.md (avx2_gathersi<mode>, avx2_gatherdi<mode>):\n+\tLikewise.\n+\t* config/s390/s390.md (trunctdsd2): Likewise.\n+\n 2017-03-02  Richard Biener  <rguenther@suse.de>\n \n \t* wide-int.h (wide_int_storage::operator=): Implement in terms"}, {"sha": "f23c2d54cd831c01d5ac655aadc82393138bb0b6", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -7364,11 +7364,11 @@\n \t\t\t   (match_operand:SWI48 1 \"nonimmediate_operand\"))\n \t\t\t (any_extend:<DWI>\n \t\t\t   (match_operand:SWI48 2 \"register_operand\")))\n-\t\t       (match_dup 4))))\n-\t      (clobber (match_scratch:SWI48 3))\n+\t\t       (match_dup 3))))\n+\t      (clobber (match_scratch:SWI48 4))\n \t      (clobber (reg:CC FLAGS_REG))])]\n   \"\"\n-  \"operands[4] = GEN_INT (GET_MODE_BITSIZE (<MODE>mode));\")\n+  \"operands[3] = GEN_INT (GET_MODE_BITSIZE (<MODE>mode));\")\n \n (define_insn \"*<s>muldi3_highpart_1\"\n   [(set (match_operand:DI 0 \"register_operand\" \"=d\")"}, {"sha": "a6f1de79c4b842176d6ed066fa1705250050fba3", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -18873,18 +18873,18 @@\n \t\t   (unspec:VEC_GATHER_MODE\n \t\t     [(match_operand:VEC_GATHER_MODE 1 \"register_operand\")\n \t\t      (mem:<ssescalarmode>\n-\t\t\t(match_par_dup 7\n+\t\t\t(match_par_dup 6\n \t\t\t  [(match_operand 2 \"vsib_address_operand\")\n \t\t\t   (match_operand:<VEC_GATHER_IDXSI>\n \t\t\t      3 \"register_operand\")\n \t\t\t   (match_operand:SI 5 \"const1248_operand \")]))\n \t\t      (mem:BLK (scratch))\n \t\t      (match_operand:VEC_GATHER_MODE 4 \"register_operand\")]\n \t\t     UNSPEC_GATHER))\n-\t      (clobber (match_scratch:VEC_GATHER_MODE 6))])]\n+\t      (clobber (match_scratch:VEC_GATHER_MODE 7))])]\n   \"TARGET_AVX2\"\n {\n-  operands[7]\n+  operands[6]\n     = gen_rtx_UNSPEC (Pmode, gen_rtvec (3, operands[2], operands[3],\n \t\t\t\t\toperands[5]), UNSPEC_VSIBADDR);\n })\n@@ -18934,18 +18934,18 @@\n \t\t   (unspec:VEC_GATHER_MODE\n \t\t     [(match_operand:<VEC_GATHER_SRCDI> 1 \"register_operand\")\n \t\t      (mem:<ssescalarmode>\n-\t\t\t(match_par_dup 7\n+\t\t\t(match_par_dup 6\n \t\t\t  [(match_operand 2 \"vsib_address_operand\")\n \t\t\t   (match_operand:<VEC_GATHER_IDXDI>\n \t\t\t      3 \"register_operand\")\n \t\t\t   (match_operand:SI 5 \"const1248_operand \")]))\n \t\t      (mem:BLK (scratch))\n \t\t      (match_operand:<VEC_GATHER_SRCDI> 4 \"register_operand\")]\n \t\t     UNSPEC_GATHER))\n-\t      (clobber (match_scratch:VEC_GATHER_MODE 6))])]\n+\t      (clobber (match_scratch:VEC_GATHER_MODE 7))])]\n   \"TARGET_AVX2\"\n {\n-  operands[7]\n+  operands[6]\n     = gen_rtx_UNSPEC (Pmode, gen_rtvec (3, operands[2], operands[3],\n \t\t\t\t\toperands[5]), UNSPEC_VSIBADDR);\n })"}, {"sha": "7d2659e884b9f9dbcd9de611fb097103c22545bd", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -5074,15 +5074,15 @@\n \n (define_expand \"trunctdsd2\"\n   [(parallel\n-    [(set (match_dup 3)\n+    [(set (match_dup 2)\n \t  (float_truncate:DD (match_operand:TD 1 \"register_operand\" \"\")))\n      (unspec:DI [(const_int DFP_RND_PREP_FOR_SHORT_PREC)] UNSPEC_ROUND)\n-     (clobber (match_scratch:TD 2 \"\"))])\n+     (clobber (match_scratch:TD 3 \"\"))])\n    (set (match_operand:SD 0 \"register_operand\" \"\")\n-\t(float_truncate:SD (match_dup 3)))]\n+\t(float_truncate:SD (match_dup 2)))]\n   \"TARGET_HARD_DFP\"\n {\n-  operands[3] = gen_reg_rtx (DDmode);\n+  operands[2] = gen_reg_rtx (DDmode);\n })\n \n ;"}, {"sha": "7bf745d17276eca1ac280a79632e0e8325563caa", "filename": "gcc/genemit.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fgenemit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fgenemit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgenemit.c?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -448,6 +448,10 @@ gen_expand (md_rtx_info *info)\n \n   /* Find out how many operands this function has.  */\n   get_pattern_stats (&stats, XVEC (expand, 1));\n+  if (stats.min_scratch_opno != -1\n+      && stats.min_scratch_opno <= MAX (stats.max_opno, stats.max_dup_opno))\n+    fatal_at (info->loc, \"define_expand for %s needs to have match_scratch \"\n+\t\t\t \"numbers above all other operands\", XSTR (expand, 0));\n \n   /* Output the function name and argument declarations.  */\n   printf (\"rtx\\ngen_%s (\", XSTR (expand, 0));\n@@ -479,8 +483,6 @@ gen_expand (md_rtx_info *info)\n      make a local variable.  */\n   for (i = stats.num_generator_args; i <= stats.max_dup_opno; i++)\n     printf (\"  rtx operand%d;\\n\", i);\n-  for (; i <= stats.max_scratch_opno; i++)\n-    printf (\"  rtx operand%d ATTRIBUTE_UNUSED;\\n\", i);\n   printf (\"  rtx_insn *_val = 0;\\n\");\n   printf (\"  start_sequence ();\\n\");\n \n@@ -516,7 +518,7 @@ gen_expand (md_rtx_info *info)\n \t (unless we aren't going to use them at all).  */\n       if (XVEC (expand, 1) != 0)\n \t{\n-\t  for (i = 0; i < stats.num_operand_vars; i++)\n+\t  for (i = 0; i <= MAX (stats.max_opno, stats.max_dup_opno); i++)\n \t    {\n \t      printf (\"    operand%d = operands[%d];\\n\", i, i);\n \t      printf (\"    (void) operand%d;\\n\", i);"}, {"sha": "874e677fa0021c10061b3febeb1c3eeb1d492373", "filename": "gcc/gensupport.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fgensupport.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fgensupport.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgensupport.c?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -3000,6 +3000,10 @@ get_pattern_stats_1 (struct pattern_stats *stats, rtx x)\n       break;\n \n     case MATCH_SCRATCH:\n+      if (stats->min_scratch_opno == -1)\n+\tstats->min_scratch_opno = XINT (x, 0);\n+      else\n+\tstats->min_scratch_opno = MIN (stats->min_scratch_opno, XINT (x, 0));\n       stats->max_scratch_opno = MAX (stats->max_scratch_opno, XINT (x, 0));\n       break;\n \n@@ -3032,6 +3036,7 @@ get_pattern_stats (struct pattern_stats *stats, rtvec pattern)\n \n   stats->max_opno = -1;\n   stats->max_dup_opno = -1;\n+  stats->min_scratch_opno = -1;\n   stats->max_scratch_opno = -1;\n   stats->num_dups = 0;\n "}, {"sha": "5db6b0f0a3091aae952b9f5fd2b00fffabbf4d83", "filename": "gcc/gensupport.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fgensupport.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5a216fa21f6c67e75a91b7063d1767cff00138b/gcc%2Fgensupport.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgensupport.h?ref=d5a216fa21f6c67e75a91b7063d1767cff00138b", "patch": "@@ -199,7 +199,8 @@ struct pattern_stats\n   /* The largest match_dup, match_op_dup or match_par_dup number found.  */\n   int max_dup_opno;\n \n-  /* The largest match_scratch number found.  */\n+  /* The smallest and largest match_scratch number found.  */\n+  int min_scratch_opno;\n   int max_scratch_opno;\n \n   /* The number of times match_dup, match_op_dup or match_par_dup appears"}]}