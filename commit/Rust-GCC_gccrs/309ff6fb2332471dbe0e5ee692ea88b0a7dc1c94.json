{"sha": "309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzA5ZmY2ZmIyMzMyNDcxZGJlMGU1ZWU2OTJlYTg4YjBhN2RjMWM5NA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2019-12-13T09:05:13Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-12-13T09:05:13Z"}, "message": "[Ada] Fix support for > 24 hours image in Ada.Calendar.Formatting\n\n2019-12-13  Arnaud Charlet  <charlet@adacore.com>\n\ngcc/ada/\n\n\t* libgnat/a-calfor.ads, libgnat/a-calfor.adb (Split_Duration):\n\tNew procedure.\n\t(Split, Image): Use Split_Duration. Update Image spec.\n\nFrom-SVN: r279362", "tree": {"sha": "fc9a80ce2ea6cd947fdb4b4d0527d71ad29aad06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fc9a80ce2ea6cd947fdb4b4d0527d71ad29aad06"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3af796b550ebadbdba31dccea948b52fad7287dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3af796b550ebadbdba31dccea948b52fad7287dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3af796b550ebadbdba31dccea948b52fad7287dc"}], "stats": {"total": 70, "additions": 51, "deletions": 19}, "files": [{"sha": "9f49f8674ae2d1610ea6f54f8965e903ac58ff95", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "patch": "@@ -1,3 +1,9 @@\n+2019-12-13  Arnaud Charlet  <charlet@adacore.com>\n+\n+\t* libgnat/a-calfor.ads, libgnat/a-calfor.adb (Split_Duration):\n+\tNew procedure.\n+\t(Split, Image): Use Split_Duration. Update Image spec.\n+\n 2019-12-13  Javier Miranda  <miranda@adacore.com>\n \n \t* exp_unst.adb (Unnest_Subprogram): Generate an extra temporary"}, {"sha": "5cc151db705a6681163766a21f7211a52a20b206", "filename": "gcc/ada/libgnat/a-calfor.adb", "status": "modified", "additions": 44, "deletions": 18, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/gcc%2Fada%2Flibgnat%2Fa-calfor.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/gcc%2Fada%2Flibgnat%2Fa-calfor.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fa-calfor.adb?ref=309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "patch": "@@ -52,6 +52,15 @@ package body Ada.Calendar.Formatting is\n    --  such as 1983-*1-j3 u5:n7:k9 which should be 1983-01-03 05:07:09. Raise\n    --  Constraint_Error if there is a mismatch.\n \n+   procedure Split_Duration\n+     (Seconds    : Duration;\n+      Hour       : out Natural;\n+      Minute     : out Minute_Number;\n+      Second     : out Second_Number;\n+      Sub_Second : out Second_Duration);\n+   --  Version of Split that allows durations < 100 hours.\n+   --  Will raise Time_Error if Seconds >= 100 hours.\n+\n    ----------------\n    -- Check_Char --\n    ----------------\n@@ -140,7 +149,7 @@ package body Ada.Calendar.Formatting is\n       Include_Time_Fraction : Boolean := False) return String\n    is\n       To_Char    : constant array (0 .. 9) of Character := \"0123456789\";\n-      Hour       : Hour_Number;\n+      Hour       : Natural;\n       Minute     : Minute_Number;\n       Second     : Second_Number;\n       Sub_Second : Duration;\n@@ -155,7 +164,7 @@ package body Ada.Calendar.Formatting is\n       Result : String := \"-00:00:00.00\";\n \n    begin\n-      Split (abs (Elapsed_Time), Hour, Minute, Second, Sub_Second);\n+      Split_Duration (abs Elapsed_Time, Hour, Minute, Second, Sub_Second);\n \n       --  Hour processing, positions 2 and 3\n \n@@ -361,6 +370,34 @@ package body Ada.Calendar.Formatting is\n              Sub_Second;\n    end Seconds_Of;\n \n+   --------------------\n+   -- Split_Duration --\n+   --------------------\n+\n+   procedure Split_Duration\n+     (Seconds    : Duration;\n+      Hour       : out Natural;\n+      Minute     : out Minute_Number;\n+      Second     : out Second_Number;\n+      Sub_Second : out Second_Duration)\n+   is\n+      Secs : Natural;\n+   begin\n+      --  Check that Seconds is below 100 hours\n+\n+      if Seconds >= 3600.0 * 100.0 then\n+         raise Time_Error;\n+      end if;\n+\n+      Secs := (if Seconds = 0.0 then 0 else Natural (Seconds - 0.5));\n+\n+      Sub_Second := Second_Duration (Seconds - Duration (Secs));\n+      Hour       := Natural (Secs / 3_600);\n+      Secs       := Secs mod 3_600;\n+      Minute     := Minute_Number (Secs / 60);\n+      Second     := Second_Number (Secs mod 60);\n+   end Split_Duration;\n+\n    -----------\n    -- Split --\n    -----------\n@@ -372,32 +409,21 @@ package body Ada.Calendar.Formatting is\n       Second     : out Second_Number;\n       Sub_Second : out Second_Duration)\n    is\n-      Secs : Natural;\n-\n+      Unchecked_Hour : Natural;\n    begin\n       --  Validity checks\n \n       if not Seconds'Valid then\n          raise Constraint_Error;\n       end if;\n \n-      Secs := (if Seconds = 0.0 then 0 else Natural (Seconds - 0.5));\n-\n-      Sub_Second := Second_Duration (Seconds - Day_Duration (Secs));\n-      Hour       := Hour_Number (Secs / 3_600);\n-      Secs       := Secs mod 3_600;\n-      Minute     := Minute_Number (Secs / 60);\n-      Second     := Second_Number (Secs mod 60);\n-\n-      --  Validity checks\n+      Split_Duration (Seconds, Unchecked_Hour, Minute, Second, Sub_Second);\n \n-      if not Hour'Valid\n-        or else not Minute'Valid\n-        or else not Second'Valid\n-        or else not Sub_Second'Valid\n-      then\n+      if Unchecked_Hour > Hour_Number'Last then\n          raise Time_Error;\n       end if;\n+\n+      Hour := Unchecked_Hour;\n    end Split;\n \n    -----------"}, {"sha": "60a586e79f11ef45be8f2d703355eae0c5c8d51c", "filename": "gcc/ada/libgnat/a-calfor.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/gcc%2Fada%2Flibgnat%2Fa-calfor.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94/gcc%2Fada%2Flibgnat%2Fa-calfor.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fa-calfor.ads?ref=309ff6fb2332471dbe0e5ee692ea88b0a7dc1c94", "patch": "@@ -204,7 +204,7 @@ package Ada.Calendar.Formatting is\n    --  to the string as a point followed by a 2-digit value. If Elapsed_Time <\n    --  0.0, the result is Image (abs Elapsed_Time, Include_Time_Fraction)\n    --  prefixed with a minus sign. If abs Elapsed_Time represents 100 hours or\n-   --  more, the result is implementation-defined.\n+   --  more, Time_Error is raised.\n \n    function Value (Elapsed_Time : String) return Duration;\n    --  Returns a Duration value for the image given as Elapsed_Time."}]}