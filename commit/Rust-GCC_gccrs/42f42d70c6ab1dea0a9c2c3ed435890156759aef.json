{"sha": "42f42d70c6ab1dea0a9c2c3ed435890156759aef", "node_id": "C_kwDOANBUbNoAKDQyZjQyZDcwYzZhYjFkZWEwYTljMmMzZWQ0MzU4OTAxNTY3NTlhZWY", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2022-11-07T16:08:21Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2022-11-07T18:26:02Z"}, "message": "C++: Template lambda mangling testcases\n\nI found some additional cases when working on the demangler.  May as\nwell check their mangling.\n\n\tgcc/testsuite/\n\t* g++.dg/abi/lambda-tpl1.h: Add more cases.\n\t* g++.dg/abi/lambda-tpl1-17.C: Add checks.\n\t* g++.dg/abi/lambda-tpl1-18.C: Likewise.\n\t* g++.dg/abi/lambda-tpl1-18vs17.C: Likewise.", "tree": {"sha": "b58cf2f76e71b80244c3b5c736582baf845bc77e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b58cf2f76e71b80244c3b5c736582baf845bc77e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/42f42d70c6ab1dea0a9c2c3ed435890156759aef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42f42d70c6ab1dea0a9c2c3ed435890156759aef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42f42d70c6ab1dea0a9c2c3ed435890156759aef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42f42d70c6ab1dea0a9c2c3ed435890156759aef/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9aa1b63a5554563b7a3081391358d6cedcabea88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9aa1b63a5554563b7a3081391358d6cedcabea88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9aa1b63a5554563b7a3081391358d6cedcabea88"}], "stats": {"total": 28, "additions": 28, "deletions": 0}, "files": [{"sha": "010f622215189c1d1ce46922516187c0ed0eb6e9", "filename": "gcc/testsuite/g++.dg/abi/lambda-tpl1-17.C", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-17.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-17.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-17.C?ref=42f42d70c6ab1dea0a9c2c3ed435890156759aef", "patch": "@@ -18,3 +18,9 @@\n // { dg-final { scan-assembler {_ZNK6l_var3MUlRT_IJXspT0_EEEE_clI1XJLi1ELi2ELi3EEEEDaS1_:} } }\n // { dg-final { scan-assembler {_ZNK6l_var4MUlR1YIJDpT_EEE_clIJ1US6_EEEDaS3_:} } }\n // { dg-final { scan-assembler {_ZZ2FnILi1EEvvENKUlT_E_clIiEEDaS0_:} } }\n+\n+// { dg-final { scan-assembler {_ZZ1fvENKUlT_E_clIcLc0EEEDaS_:} } }\n+// { dg-final { scan-assembler {_ZZ1fvENKUlT_E_clIiLi0EEEDaS_:} } }\n+// { dg-final { scan-assembler {_ZZZ1fvENKUlT_E_clIcLc0EEEDaS_ENKUlcS_E_clIcEEDacS_:} } }\n+// { dg-final { scan-assembler {_ZZZ1fvENKUlT_E_clIiLi0EEEDaS_ENKUliS_E_clIiEEDaiS_:} } }\n+// { dg-final { scan-assembler {_ZZ1fvENKUlP1UIT_Lj0EEPS_IiLj0EEE0_clIcEEDaS2_S4_:} } }"}, {"sha": "66cce9aa2662fb1b19bf0c4f771cf4372b497f1a", "filename": "gcc/testsuite/g++.dg/abi/lambda-tpl1-18.C", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-18.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-18.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-18.C?ref=42f42d70c6ab1dea0a9c2c3ed435890156759aef", "patch": "@@ -23,3 +23,9 @@\n // https://github.com/llvm/llvm-project/issues/58631\n \n // { dg-final { scan-assembler {_ZZ2FnILi1EEvvENKUlTyT_E_clIiEEDaS0_:} } }\n+\n+// { dg-final { scan-assembler {_ZZ1fvENKUlTyTnT_S_E_clIcLc0EEEDaS_:} } }\n+// { dg-final { scan-assembler {_ZZ1fvENKUlTyTnT_S_E_clIiLi0EEEDaS_:} } }\n+// { dg-final { scan-assembler {_ZZZ1fvENKUlTyTnT_S_E_clIcLc0EEEDaS_ENKUlTycS_E_clIcEEDacS_:} } }\n+// { dg-final { scan-assembler {_ZZZ1fvENKUlTyTnT_S_E_clIiLi0EEEDaS_ENKUlTyiS_E_clIiEEDaiS_:} } }\n+// { dg-final { scan-assembler {_ZZ1fvENKUlTyP1UIT_Lj0EEPS_IiLj0EEE_clIcEEDaS2_S4_:} } }"}, {"sha": "6489db9e442a05aee8166c850d5c3f1c8a3c9cc4", "filename": "gcc/testsuite/g++.dg/abi/lambda-tpl1-18vs17.C", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-18vs17.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-18vs17.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1-18vs17.C?ref=42f42d70c6ab1dea0a9c2c3ed435890156759aef", "patch": "@@ -14,3 +14,8 @@\n // { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZNK10l_tpl_autoMUlT_T0_E_clIiiEEDaS_S0_'\\) and '-fabi-version=18' \\('_ZNK10l_tpl_autoMUlTyT_T0_E_clIiiEEDaS0_S1_'\\) [^\\n]*\\n} }\n // { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZNK5l_tplMUlT_E_clIiEEDaS_'\\) and '-fabi-version=18' \\('_ZNK5l_tplMUlTyT_E_clIiEEDaS0_'\\) [^\\n]*\\n} }\n // { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZNK6l_autoMUlT_E_clIiEEDaS_'\\) and '-fabi-version=18' \\('_ZNK6l_autoMUlT_E_clIiEEDaS0_'\\) [^\\n]*\\n} }\n+// { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZZ1fvENKUlT_E_clIiLi0EEEDaS_'\\) and '-fabi-version=18' \\('_ZZ1fvENKUlTyTnT_S_E_clIiLi0EEEDaS_'\\) [^\\n]*\\n} }\n+// { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZZZ1fvENKUlT_E_clIiLi0EEEDaS_ENKUliS_E_clIiEEDaiS_'\\) and '-fabi-version=18' \\('_ZZZ1fvENKUlTyTnT_S_E_clIiLi0EEEDaS_ENKUlTyiS_E_clIiEEDaiS_'\\) [^\\n]*\\n} }\n+// { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZZ1fvENKUlT_E_clIcLc0EEEDaS_'\\) and '-fabi-version=18' \\('_ZZ1fvENKUlTyTnT_S_E_clIcLc0EEEDaS_'\\) [^\\n]*\\n} }\n+// { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZZZ1fvENKUlT_E_clIcLc0EEEDaS_ENKUlcS_E_clIcEEDacS_'\\) and '-fabi-version=18' \\('_ZZZ1fvENKUlTyTnT_S_E_clIcLc0EEEDaS_ENKUlTycS_E_clIcEEDacS_'\\) [^\\n]*\\n} }\n+// { dg-regexp {[^\\n]*lambda-tpl1.h:[:0-9]* warning: the mangled name [^\\n]* \\('_ZZ1fvENKUlP1UIT_Lj0EEPS_IiLj0EEE0_clIcEEDaS2_S4_'\\) and '-fabi-version=18' \\('_ZZ1fvENKUlTyP1UIT_Lj0EEPS_IiLj0EEE_clIcEEDaS2_S4_'\\) [^\\n]*\\n} }"}, {"sha": "376c3f6a2f4ef15766c4e4cfc61e466f4e614248", "filename": "gcc/testsuite/g++.dg/abi/lambda-tpl1.h", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42f42d70c6ab1dea0a9c2c3ed435890156759aef/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fabi%2Flambda-tpl1.h?ref=42f42d70c6ab1dea0a9c2c3ed435890156759aef", "patch": "@@ -56,4 +56,15 @@ void f ()\n   l_var4 (y);\n \n   Fn<1> ();\n+\n+  auto l1 = []<typename T, T v = T(0)> (T a) {\n+    auto l2 = []<typename U> (T a, U b) {};\n+\n+    l2 (a, v);\n+  };\n+  auto l3 = []<typename T>(U<T, 0> *, U<int, 0> *) {};\n+\n+  l1 (1);\n+  l1 ('1');\n+  l3 ((U<char, 0> *)nullptr, nullptr);\n }"}]}