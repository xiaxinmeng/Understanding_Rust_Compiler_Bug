{"sha": "c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzcxMWJhOGUyZWRiNjlkM2Y2ZmE1OGNmYmExZDZkYzQ5ODQ3YWZjZA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2002-05-22T23:31:48Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2002-05-22T23:31:48Z"}, "message": "varasm.c (default_section_type_flags): Handle tls data and default sections.\n\n        * varasm.c (default_section_type_flags): Handle tls data and\n        default sections.\n        (default_unique_section): Handle tls sections.\n\nFrom-SVN: r53753", "tree": {"sha": "fd763eccaad53e4915d2b3e3ecc5dce5c401fc50", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fd763eccaad53e4915d2b3e3ecc5dce5c401fc50"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/comments", "author": null, "committer": null, "parents": [{"sha": "343f59d980bf21e62d4e2de75396e7921cd3bd20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/343f59d980bf21e62d4e2de75396e7921cd3bd20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/343f59d980bf21e62d4e2de75396e7921cd3bd20"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "9ededbccd394511e8f7bafb0fd180c83354429e0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "patch": "@@ -1,3 +1,9 @@\n+2002-05-22  Richard Henderson  <rth@redhat.com>\n+\n+\t* varasm.c (default_section_type_flags): Handle tls data and\n+\tdefault sections.\n+\t(default_unique_section): Handle tls sections.\n+\n 2002-05-23  Alan Modra  <amodra@bigpond.net.au>\n \n \t* configure.in (CROSS): Define NATIVE_CROSS."}, {"sha": "741eadba5366baf3a5bddcc0bbd7f923cee66340", "filename": "gcc/testsuite/gcc.dg/tls/section-1.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fsection-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fsection-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fsection-1.c?ref=c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "patch": "@@ -0,0 +1,11 @@\n+/* Verify that we get errors for trying to put TLS data in \n+   sections which can't work.  */\n+\n+#define A(X)\t__attribute__((section(X)))\n+\n+__thread int i A(\"foo\");\t\t/* Ok */\n+\n+__thread int j A(\".data\");  /* { dg-error \"causes a section type conflict\" \"conflict with .data section\" { xfail *-*-* } } */\n+\n+int k A(\"bar\");\n+__thread int l A(\"bar\");  /* { dg-error \"causes a section type conflict\" \"conflict with user-defined section\" } */"}, {"sha": "0c4b3cd942b0f580777d12d27f8d2434a0550d5c", "filename": "gcc/varasm.c", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=c711ba8e2edb69d3f6fa58cfba1d6dc49847afcd", "patch": "@@ -5105,17 +5105,23 @@ default_section_type_flags (decl, name, reloc)\n   if (decl && DECL_ONE_ONLY (decl))\n     flags |= SECTION_LINKONCE;\n \n+  if (decl && DECL_THREAD_LOCAL (decl))\n+    flags |= SECTION_TLS | SECTION_WRITE;\n+\n   if (strcmp (name, \".bss\") == 0\n       || strncmp (name, \".bss.\", 5) == 0\n       || strncmp (name, \".gnu.linkonce.b.\", 16) == 0\n       || strcmp (name, \".sbss\") == 0\n       || strncmp (name, \".sbss.\", 6) == 0\n       || strncmp (name, \".gnu.linkonce.sb.\", 17) == 0\n-      || strcmp (name, \".tbss\") == 0)\n+      || strcmp (name, \".tbss\") == 0\n+      || strncmp (name, \".gnu.linkonce.tb.\", 17) == 0)\n     flags |= SECTION_BSS;\n \n   if (strcmp (name, \".tdata\") == 0\n-      || strcmp (name, \".tbss\") == 0)\n+      || strcmp (name, \".tbss\") == 0\n+      || strncmp (name, \".gnu.linkonce.td.\", 17) == 0\n+      || strncmp (name, \".gnu.linkonce.tb.\", 17) == 0)\n     flags |= SECTION_TLS;\n \n   return flags;\n@@ -5495,7 +5501,11 @@ default_unique_section (decl, reloc)\n       prefix = one_only ? \".gnu.linkonce.sb.\" : \".sbss.\";\n       break;\n     case SECCAT_TDATA:\n+      prefix = one_only ? \".gnu.linkonce.td.\" : \".tdata.\";\n+      break;\n     case SECCAT_TBSS:\n+      prefix = one_only ? \".gnu.linkonce.tb.\" : \".tbss.\";\n+      break;\n     default:\n       abort ();\n     }"}]}