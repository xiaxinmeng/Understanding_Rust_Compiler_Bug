{"sha": "403697abae1166766b3e4681487a5dfcfef2ce52", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDAzNjk3YWJhZTExNjY3NjZiM2U0NjgxNDg3YTVkZmNmZWYyY2U1Mg==", "commit": {"author": {"name": "David Edelsohn", "email": "dje@gcc.gnu.org", "date": "2015-02-16T15:33:09Z"}, "committer": {"name": "David Edelsohn", "email": "dje@gcc.gnu.org", "date": "2015-02-16T15:33:09Z"}, "message": "[multiple changes]\n\n2015-02-16  Michael Haubenwallner  <michael.haubenwallner@ssi-schaefer.com>\n            David Edelsohn  <dje.gcc@gmail.com>\n\n        PR target/65058\n        * config/rs6000/rs6000.c (rs6000_output_symbol_ref): Append storage\n        mapping class to external variable or function reference.\n        * config/rs6000/xcoff.h (ASM_OUTPUT_EXTERNAL): Do not append storage\n        mapping class.\n\n2015-02-16  David Eelsohn  <dje.gcc@gmail.com>\n\n        PR target/53348\n        * config/rs6000/rs6000.c (rs6000_declare_alias): Only use\n        ASM_WEAKEN_DECL if defined.\n\nFrom-SVN: r220737", "tree": {"sha": "2dfbc0d9d2411f592462292e7384b57ff0438d0c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2dfbc0d9d2411f592462292e7384b57ff0438d0c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/403697abae1166766b3e4681487a5dfcfef2ce52", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/403697abae1166766b3e4681487a5dfcfef2ce52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/403697abae1166766b3e4681487a5dfcfef2ce52", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/403697abae1166766b3e4681487a5dfcfef2ce52/comments", "author": null, "committer": null, "parents": [{"sha": "266c722fafc54178f854179003260053b11d00a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/266c722fafc54178f854179003260053b11d00a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/266c722fafc54178f854179003260053b11d00a3"}], "stats": {"total": 40, "additions": 31, "deletions": 9}, "files": [{"sha": "04ac1192bd1f3a4eff91e91036762dad5f022732", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/403697abae1166766b3e4681487a5dfcfef2ce52/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/403697abae1166766b3e4681487a5dfcfef2ce52/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=403697abae1166766b3e4681487a5dfcfef2ce52", "patch": "@@ -1,3 +1,18 @@\n+2015-02-16  Michael Haubenwallner  <michael.haubenwallner@ssi-schaefer.com>\n+\t    David Edelsohn  <dje.gcc@gmail.com>\n+\n+\tPR target/65058\n+\t* config/rs6000/rs6000.c (rs6000_output_symbol_ref): Append storage\n+\tmapping class to external variable or function reference.\n+\t* config/rs6000/xcoff.h (ASM_OUTPUT_EXTERNAL): Do not append storage\n+\tmapping class.\n+\n+2015-02-16  David Eelsohn  <dje.gcc@gmail.com>\n+\n+\tPR target/53348\n+\t* config/rs6000/rs6000.c (rs6000_declare_alias): Only use\n+\tASM_WEAKEN_DECL if defined.\n+\n 2015-02-16  Richard Biener  <rguenther@suse.de>\n \n \tPR lto/65015"}, {"sha": "e482547aecc09e55cd5c19fbd76ef6501e5d861d", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/403697abae1166766b3e4681487a5dfcfef2ce52/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/403697abae1166766b3e4681487a5dfcfef2ce52/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=403697abae1166766b3e4681487a5dfcfef2ce52", "patch": "@@ -26030,6 +26030,20 @@ rs6000_output_symbol_ref (FILE *file, rtx x)\n      section.  */\n   const char *name = XSTR (x, 0);\n \n+  tree decl = SYMBOL_REF_DECL (x);\n+  if (decl /* sync condition with assemble_external () */\n+      && DECL_P (decl) && DECL_EXTERNAL (decl) && TREE_PUBLIC (decl)\n+      && (TREE_CODE (decl) == VAR_DECL\n+\t  || TREE_CODE (decl) == FUNCTION_DECL)\n+      && name[strlen (name) - 1] != ']')\n+    {\n+      name = concat (name,\n+\t\t     (TREE_CODE (decl) == FUNCTION_DECL\n+\t\t      ? \"[DS]\" : \"[UA]\"),\n+\t\t     NULL);\n+      XSTR (x, 0) = name;\n+    }\n+\n   if (VTABLE_NAME_P (name))\n     {\n       RS6000_OUTPUT_BASENAME (file, name);\n@@ -30081,8 +30095,10 @@ rs6000_declare_alias (struct symtab_node *n, void *d)\n \t  RS6000_OUTPUT_BASENAME (data->file, buffer);\n \t  putc ('\\n', data->file);\n \t}\n+#ifdef ASM_WEAKEN_DECL\n       else if (DECL_WEAK (n->decl) && !data->function_descriptor)\n \tASM_WEAKEN_DECL (data->file, n->decl, name, NULL);\n+#endif\n     }\n   else\n     {"}, {"sha": "db024fcaceeea40d5de2ee2845a30b3481fcd855", "filename": "gcc/config/rs6000/xcoff.h", "status": "modified", "additions": 0, "deletions": 9, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/403697abae1166766b3e4681487a5dfcfef2ce52/gcc%2Fconfig%2Frs6000%2Fxcoff.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/403697abae1166766b3e4681487a5dfcfef2ce52/gcc%2Fconfig%2Frs6000%2Fxcoff.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fxcoff.h?ref=403697abae1166766b3e4681487a5dfcfef2ce52", "patch": "@@ -170,15 +170,6 @@\n       putc ('\\n', FILE);\t\t\t\t\t\t\\\n       fprintf(FILE, \"\\t.rename .%s,\\\".%s\\\"\\n\", buffer, NAME);\t\t\\\n     }\t\t\t\t\t\t\t\t\t\\\n-  if ((TREE_CODE (DECL) == VAR_DECL\t\t\t\t\t\\\n-       || TREE_CODE (DECL) == FUNCTION_DECL)\t\t\t\t\\\n-      && (NAME)[strlen (NAME) - 1] != ']')\t\t\t\t\\\n-    {\t\t\t\t\t\t\t\t\t\\\n-      XSTR (_symref, 0) = concat (XSTR (_symref, 0),\t\t\t\\\n-\t\t\t\t  (TREE_CODE (DECL) == FUNCTION_DECL\t\\\n-\t\t\t\t   ? \"[DS]\" : \"[RW]\"),\t\t\t\\\n-\t\t\t\t  NULL);\t\t\t\t\\\n-    }\t\t\t\t\t\t\t\t\t\\\n }\n \n /* This is how to output a reference to a user-level label named NAME."}]}