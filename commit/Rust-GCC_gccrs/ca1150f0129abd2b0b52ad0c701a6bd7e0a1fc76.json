{"sha": "ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2ExMTUwZjAxMjlhYmQyYjBiNTJhZDBjNzAxYTZiZDdlMGExZmM3Ng==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-09-04T08:11:44Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-09-04T08:11:44Z"}, "message": "re PR sanitizer/81981 (-fsanitize=undefined makes a -Wmaybe-uninitialized warning disappear)\n\n\tPR sanitizer/81981\n\t* gimple-fold.c (gimple_fold_call): Optimize away useless UBSAN_PTR\n\tand UBSAN_BOUNDS internal calls.  Clean up IFN_UBSAN_OBJECT_SIZE\n\thandling.  Use replace_call_with_value with NULL instead of\n\tgsi_replace, unlink_stmt_vdef and release_defs.\n\n\t* gcc.dg/ubsan/pr81981.c: New test.\n\nFrom-SVN: r251641", "tree": {"sha": "5b5f269d8ebdc8d44079151eb4288310ab65b1c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b5f269d8ebdc8d44079151eb4288310ab65b1c4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "40008742c5f7c84ddd16f7da562bebca1a179d4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40008742c5f7c84ddd16f7da562bebca1a179d4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40008742c5f7c84ddd16f7da562bebca1a179d4b"}], "stats": {"total": 71, "additions": 63, "deletions": 8}, "files": [{"sha": "50d5e26f96a9848aa0dc107fc204db80c41bfba7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "patch": "@@ -1,5 +1,11 @@\n 2017-09-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR sanitizer/81981\n+\t* gimple-fold.c (gimple_fold_call): Optimize away useless UBSAN_PTR\n+\tand UBSAN_BOUNDS internal calls.  Clean up IFN_UBSAN_OBJECT_SIZE\n+\thandling.  Use replace_call_with_value with NULL instead of\n+\tgsi_replace, unlink_stmt_vdef and release_defs.\n+\n \t* gdbhooks.py (OptMachineModePrinter.to_string): Use 8 spaces\n \tinstead of tab.\n "}, {"sha": "8366e4b50b8a42a677d3dd8b39746b3f2cf46bdd", "filename": "gcc/gimple-fold.c", "status": "modified", "additions": 33, "deletions": 8, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2Fgimple-fold.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2Fgimple-fold.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-fold.c?ref=ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "patch": "@@ -3936,18 +3936,43 @@ gimple_fold_call (gimple_stmt_iterator *gsi, bool inplace)\n \t\t\t\t\tgimple_call_arg (stmt, 2));\n \t  break;\n \tcase IFN_UBSAN_OBJECT_SIZE:\n-\t  if (integer_all_onesp (gimple_call_arg (stmt, 2))\n-\t      || (TREE_CODE (gimple_call_arg (stmt, 1)) == INTEGER_CST\n-\t\t  && TREE_CODE (gimple_call_arg (stmt, 2)) == INTEGER_CST\n-\t\t  && tree_int_cst_le (gimple_call_arg (stmt, 1),\n-\t\t\t\t      gimple_call_arg (stmt, 2))))\n+\t  {\n+\t    tree offset = gimple_call_arg (stmt, 1);\n+\t    tree objsize = gimple_call_arg (stmt, 2);\n+\t    if (integer_all_onesp (objsize)\n+\t\t|| (TREE_CODE (offset) == INTEGER_CST\n+\t\t    && TREE_CODE (objsize) == INTEGER_CST\n+\t\t    && tree_int_cst_le (offset, objsize)))\n+\t      {\n+\t\treplace_call_with_value (gsi, NULL_TREE);\n+\t\treturn true;\n+\t      }\n+\t  }\n+\t  break;\n+\tcase IFN_UBSAN_PTR:\n+\t  if (integer_zerop (gimple_call_arg (stmt, 1)))\n \t    {\n-\t      gsi_replace (gsi, gimple_build_nop (), false);\n-\t      unlink_stmt_vdef (stmt);\n-\t      release_defs (stmt);\n+\t      replace_call_with_value (gsi, NULL_TREE);\n \t      return true;\n \t    }\n \t  break;\n+\tcase IFN_UBSAN_BOUNDS:\n+\t  {\n+\t    tree index = gimple_call_arg (stmt, 1);\n+\t    tree bound = gimple_call_arg (stmt, 2);\n+\t    if (TREE_CODE (index) == INTEGER_CST\n+\t\t&& TREE_CODE (bound) == INTEGER_CST)\n+\t      {\n+\t\tindex = fold_convert (TREE_TYPE (bound), index);\n+\t\tif (TREE_CODE (index) == INTEGER_CST\n+\t\t    && tree_int_cst_le (index, bound))\n+\t\t  {\n+\t\t    replace_call_with_value (gsi, NULL_TREE);\n+\t\t    return true;\n+\t\t  }\n+\t      }\n+\t  }\n+\t  break;\n \tcase IFN_GOACC_DIM_SIZE:\n \tcase IFN_GOACC_DIM_POS:\n \t  result = fold_internal_goacc_dim (stmt);"}, {"sha": "cd7ac1d84e7161d7d7bd0c88ec5d1949c388ef68", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "patch": "@@ -1,5 +1,8 @@\n 2017-09-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR sanitizer/81981\n+\t* gcc.dg/ubsan/pr81981.c: New test.\n+\n \tPR tree-optimization/70043\n \tPR testsuite/82093\n \t* gfortran.dg/vect/pr70043.f90 (fn1): Start loop from 1 instead of 0."}, {"sha": "b2636d4c9344a919ebfa0ecbc72fee7cf4899c03", "filename": "gcc/testsuite/gcc.dg/ubsan/pr81981.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr81981.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr81981.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr81981.c?ref=ca1150f0129abd2b0b52ad0c701a6bd7e0a1fc76", "patch": "@@ -0,0 +1,21 @@\n+/* PR sanitizer/81981 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wmaybe-uninitialized -fsanitize=undefined -ffat-lto-objects\" } */\n+\n+int v;\n+\n+int\n+foo (int i)\n+{\n+  int t[1], u[1];\n+  int n = 0;\n+\n+  if (i)\n+    {\n+      t[n] = i;\n+      u[0] = i;\n+    }\n+\n+  v = u[0];\t\t/* { dg-warning \"may be used uninitialized in this function\" } */\n+  return t[0];\t\t/* { dg-warning \"may be used uninitialized in this function\" } */\n+}"}]}