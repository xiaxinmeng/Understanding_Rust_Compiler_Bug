{"sha": "4efb91dfc345f1f98a49c07873e2b68f6b6237a3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGVmYjkxZGZjMzQ1ZjFmOThhNDljMDc4NzNlMmI2OGY2YjYyMzdhMw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2011-10-06T22:22:11Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2011-10-06T22:22:11Z"}, "message": "re PR middle-end/50632 (FAIL: gcc.dg/pr50132.c)\n\nPR 50632\n\n        * combine-stack-adjust.c (maybe_move_args_size_note): Add after\n        parameter; use it to decide whether to merge two notes.\n        (combine_stack_adjustments_for_block): Use maybe_move_args_size_note\n        for the deallocation case as well.\n\nFrom-SVN: r179637", "tree": {"sha": "5903c05e6219c8777f1f6d6aa856a5b515bf40f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5903c05e6219c8777f1f6d6aa856a5b515bf40f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4efb91dfc345f1f98a49c07873e2b68f6b6237a3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4efb91dfc345f1f98a49c07873e2b68f6b6237a3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4efb91dfc345f1f98a49c07873e2b68f6b6237a3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4efb91dfc345f1f98a49c07873e2b68f6b6237a3/comments", "author": null, "committer": null, "parents": [{"sha": "7e8ec1ec7028923fb402a5f0db4c86352afd1f6e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e8ec1ec7028923fb402a5f0db4c86352afd1f6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e8ec1ec7028923fb402a5f0db4c86352afd1f6e"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "2af56eb47f22160d5f570a09fb9f555f9aed75d4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efb91dfc345f1f98a49c07873e2b68f6b6237a3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efb91dfc345f1f98a49c07873e2b68f6b6237a3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4efb91dfc345f1f98a49c07873e2b68f6b6237a3", "patch": "@@ -1,3 +1,10 @@\n+2011-10-06  Richard Henderson  <rth@redhat.com>\n+\n+\t* combine-stack-adjust.c (maybe_move_args_size_note): Add after\n+\tparameter; use it to decide whether to merge two notes.\n+\t(combine_stack_adjustments_for_block): Use maybe_move_args_size_note\n+\tfor the deallocation case as well.\n+\n 2011-10-06  Anatoly Sokolov  <aesok@post.ru>\n \n \t* system.h (OUTPUT_ADDR_CONST_EXTRA): Poison."}, {"sha": "3cffd662f9294a456a10eb25e985d02bc53a312b", "filename": "gcc/combine-stack-adj.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4efb91dfc345f1f98a49c07873e2b68f6b6237a3/gcc%2Fcombine-stack-adj.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4efb91dfc345f1f98a49c07873e2b68f6b6237a3/gcc%2Fcombine-stack-adj.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine-stack-adj.c?ref=4efb91dfc345f1f98a49c07873e2b68f6b6237a3", "patch": "@@ -296,10 +296,11 @@ record_stack_refs (rtx *xp, void *data)\n   return 0;\n }\n \n-/* If INSN has a REG_ARGS_SIZE note, move it to LAST.  */\n+/* If INSN has a REG_ARGS_SIZE note, move it to LAST.\n+   AFTER is true iff LAST follows INSN in the instruction stream.  */\n \n static void\n-maybe_move_args_size_note (rtx last, rtx insn)\n+maybe_move_args_size_note (rtx last, rtx insn, bool after)\n {\n   rtx note, last_note;\n \n@@ -309,7 +310,12 @@ maybe_move_args_size_note (rtx last, rtx insn)\n \n   last_note = find_reg_note (last, REG_ARGS_SIZE, NULL_RTX);\n   if (last_note)\n-    XEXP (last_note, 0) = XEXP (note, 0);\n+    {\n+      /* The ARGS_SIZE notes are *not* cumulative.  They represent an\n+\t absolute value, and the \"most recent\" note wins.  */\n+      if (!after)\n+        XEXP (last_note, 0) = XEXP (note, 0);\n+    }\n   else\n     add_reg_note (last, REG_ARGS_SIZE, XEXP (note, 0));\n }\n@@ -385,7 +391,7 @@ combine_stack_adjustments_for_block (basic_block bb)\n \t\t\t\t\t\t  last_sp_adjust + this_adjust,\n \t\t\t\t\t\t  this_adjust))\n \t\t    {\n-\t\t      maybe_move_args_size_note (last_sp_set, insn);\n+\t\t      maybe_move_args_size_note (last_sp_set, insn, false);\n \n \t\t      /* It worked!  */\n \t\t      delete_insn (insn);\n@@ -403,6 +409,8 @@ combine_stack_adjustments_for_block (basic_block bb)\n \t\t\t\t\t\t  last_sp_adjust + this_adjust,\n \t\t\t\t\t\t  -last_sp_adjust))\n \t\t    {\n+\t\t      maybe_move_args_size_note (insn, last_sp_set, true);\n+\n \t\t      /* It worked!  */\n \t\t      delete_insn (last_sp_set);\n \t\t      last_sp_set = insn;"}]}