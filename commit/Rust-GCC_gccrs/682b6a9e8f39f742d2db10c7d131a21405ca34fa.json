{"sha": "682b6a9e8f39f742d2db10c7d131a21405ca34fa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjgyYjZhOWU4ZjM5Zjc0MmQyZGIxMGM3ZDEzMWEyMTQwNWNhMzRmYQ==", "commit": {"author": {"name": "Maxim Kuvyrkov", "email": "mkuvyrkov@ispras.ru", "date": "2006-03-30T15:33:18Z"}, "committer": {"name": "Maxim Kuvyrkov", "email": "mkuvyrkov@gcc.gnu.org", "date": "2006-03-30T15:33:18Z"}, "message": "haifa-sched.c (try_ready): Change condition to restore non-speculative pattern\tof the instruction.\n\n2006-03-30  Maxim Kuvyrkov  <mkuvyrkov@ispras.ru>\n\n\t* haifa-sched.c (try_ready): Change condition to restore\n\tnon-speculative pattern\tof the instruction.\n\t(process_insn_depend_be_in_spec): Code to keep probability of the\n\tspeculative dependence non-decreasing.\n\nFrom-SVN: r112537", "tree": {"sha": "dbed31a44e1dfb141866940a1e2a936d2d37c2fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dbed31a44e1dfb141866940a1e2a936d2d37c2fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/682b6a9e8f39f742d2db10c7d131a21405ca34fa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/682b6a9e8f39f742d2db10c7d131a21405ca34fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/682b6a9e8f39f742d2db10c7d131a21405ca34fa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/682b6a9e8f39f742d2db10c7d131a21405ca34fa/comments", "author": null, "committer": null, "parents": [{"sha": "144f83156707c5a7ef6bda84264274f525572209", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/144f83156707c5a7ef6bda84264274f525572209", "html_url": "https://github.com/Rust-GCC/gccrs/commit/144f83156707c5a7ef6bda84264274f525572209"}], "stats": {"total": 56, "additions": 42, "deletions": 14}, "files": [{"sha": "902cf75af3acf54bd7be0bb48b0bfb2bd4107a63", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682b6a9e8f39f742d2db10c7d131a21405ca34fa/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682b6a9e8f39f742d2db10c7d131a21405ca34fa/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=682b6a9e8f39f742d2db10c7d131a21405ca34fa", "patch": "@@ -1,3 +1,10 @@\n+2006-03-30  Maxim Kuvyrkov  <mkuvyrkov@ispras.ru>\n+\n+\t* haifa-sched.c (try_ready): Change condition to restore\n+\tnon-speculative pattern\tof the instruction.\n+\t(process_insn_depend_be_in_spec): Code to keep probability of the\n+\tspeculative dependence non-decreasing.\n+\n 2006-03-30  Jie Zhang  <jie.zhang@analog.com>\n \n \t* config/bfin/bfin.c (single_move_for_strmov): Renamed to..."}, {"sha": "4825189b03402789f122795bf79b34ddb86bd0d7", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 35, "deletions": 14, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682b6a9e8f39f742d2db10c7d131a21405ca34fa/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682b6a9e8f39f742d2db10c7d131a21405ca34fa/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=682b6a9e8f39f742d2db10c7d131a21405ca34fa", "patch": "@@ -1,6 +1,6 @@\n /* Instruction scheduling pass.\n-   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.\n+   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,\n+   2000, 2001, 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.\n    Contributed by Michael Tiemann (tiemann@cygnus.com) Enhanced by,\n    and currently maintained by, Jim Wilson (wilson@cygnus.com)\n \n@@ -3055,16 +3055,6 @@ try_ready (rtx next)\n \t      || !RECOVERY_BLOCK (next)\n \t      || RECOVERY_BLOCK (next) == EXIT_BLOCK_PTR);\n   \n-  if (*ts == 0 && ORIG_PAT (next) && !RECOVERY_BLOCK (next))\n-    /* We should change pattern of every previously speculative \n-       instruction - and we determine if NEXT was speculative by using\n-       ORIG_PAT field.  Except one case - simple checks have ORIG_PAT\n-       pat too, hence we also check for the RECOVERY_BLOCK.  */\n-    {\n-      change_pattern (next, ORIG_PAT (next));\n-      ORIG_PAT (next) = 0;\n-    }\n-\n   if (*ts & HARD_DEP)\n     {\n       /* We can't assert (QUEUE_INDEX (next) == QUEUE_NOWHERE) here because\n@@ -3075,6 +3065,15 @@ try_ready (rtx next)\n       change_queue_index (next, QUEUE_NOWHERE);\n       return -1;\n     }\n+  else if (!(*ts & BEGIN_SPEC) && ORIG_PAT (next) && !RECOVERY_BLOCK (next))\n+    /* We should change pattern of every previously speculative \n+       instruction - and we determine if NEXT was speculative by using\n+       ORIG_PAT field.  Except one case - simple checks have ORIG_PAT\n+       pat too, hence we also check for the RECOVERY_BLOCK.  */\n+    {\n+      change_pattern (next, ORIG_PAT (next));\n+      ORIG_PAT (next) = 0;\n+    }\n \n   if (sched_verbose >= 2)\n     {\t      \n@@ -3312,8 +3311,30 @@ process_insn_depend_be_in_spec (rtx link, rtx twin, ds_t fs)\n \n       ds = DEP_STATUS (link);\n \n-      if (fs && (ds & DEP_TYPES) == DEP_TRUE)\n-\tds = (ds & ~BEGIN_SPEC) | fs;\n+      if (/* If we want to create speculative dep.  */\n+\t  fs\n+\t  /* And we can do that because this is a true dep.  */\n+\t  && (ds & DEP_TYPES) == DEP_TRUE)\n+\t{\n+\t  gcc_assert (!(ds & BE_IN_SPEC));\n+\n+\t  if (/* If this dep can be overcomed with 'begin speculation'.  */\n+\t      ds & BEGIN_SPEC)\n+\t    /* Then we have a choice: keep the dep 'begin speculative'\n+\t       or transform it into 'be in speculative'.  */\n+\t    {\n+\t      if (/* In try_ready we assert that if insn once became ready\n+\t\t     it can be removed from the ready (or queue) list only\n+\t\t     due to backend decision.  Hence we can't let the\n+\t\t     probability of the speculative dep to decrease.  */\n+\t\t  dep_weak (ds) <= dep_weak (fs))\n+\t\t/* Transform it to be in speculative.  */\n+\t\tds = (ds & ~BEGIN_SPEC) | fs;\n+\t    }\n+\t  else\n+\t    /* Mark the dep as 'be in speculative'.  */\n+\t    ds |= fs;\n+\t}\n \n       add_back_forw_dep (consumer, twin, REG_NOTE_KIND (link), ds);\n     }"}]}