{"sha": "7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2YxYmE3MTZhMmIwZWIyZGI1ZTY0MWY3MzliZjQ2MTkxMmU3ZWY4OQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2006-12-06T05:12:46Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2006-12-06T05:12:46Z"}, "message": "re PR c++/29729 (ICE with template class in template function)\n\n\tPR c++/29729\n\t* decl2.c (check_member_template): Move check for member\n\ttemplates in local classes to ...\n\t* parser.c (cp_parser_template_declaration_after_export):\n\t... here.\n\tPR c++/29729\n\t* g++.dg/template/crash63.C: New test.\n\nFrom-SVN: r119575", "tree": {"sha": "8687d2f642a0080d050842e20ef8361d9010c77b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8687d2f642a0080d050842e20ef8361d9010c77b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/comments", "author": null, "committer": null, "parents": [{"sha": "f75709c6f83fbf654b8bc283f27ddd8d4f894227", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f75709c6f83fbf654b8bc283f27ddd8d4f894227", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f75709c6f83fbf654b8bc283f27ddd8d4f894227"}], "stats": {"total": 39, "additions": 32, "deletions": 7}, "files": [{"sha": "9e63aca5e8a1cf93ee6ac848fc9a9a5294f173da", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "patch": "@@ -1,5 +1,11 @@\n 2006-12-05  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/29729\n+\t* decl2.c (check_member_template): Move check for member\n+\ttemplates in local classes to ...\n+\t* parser.c (cp_parser_template_declaration_after_export):\n+\t... here.\n+\n \tPR c++/29728\n \t* decl.c (check_array_designated_initializer): New function.\n \t(maybe_deduce_size_from_array_init): Use it."}, {"sha": "b2a97ff9dc2c213372ba6ee93f85bb9b943d7c13", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "patch": "@@ -445,13 +445,8 @@ check_member_template (tree tmpl)\n       || (TREE_CODE (decl) == TYPE_DECL\n \t  && IS_AGGR_TYPE (TREE_TYPE (decl))))\n     {\n-      if (current_function_decl)\n-\t/* 14.5.2.2 [temp.mem]\n-\n-\t   A local class shall not have member templates.  */\n-\terror (\"invalid declaration of member template %q#D in local class\",\n-\t       decl);\n-\n+      /* The parser rejects template declarations in local classes.  */\n+      gcc_assert (!current_function_decl);\n       /* The parser rejects any use of virtual in a function template.  */\n       gcc_assert (!(TREE_CODE (decl) == FUNCTION_DECL\n \t\t    && DECL_VIRTUAL_P (decl)));"}, {"sha": "82ee8873355adace8ac39de8932f21d53fce9bfe", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "patch": "@@ -15696,6 +15696,15 @@ cp_parser_template_declaration_after_export (cp_parser* parser, bool member_p)\n   /* And the `<'.  */\n   if (!cp_parser_require (parser, CPP_LESS, \"`<'\"))\n     return;\n+  if (at_class_scope_p () && current_function_decl)\n+    {\n+      /* 14.5.2.2 [temp.mem]\n+\n+         A local class shall not have member templates.  */\n+      error (\"invalid declaration of member template in local class\");\n+      cp_parser_skip_to_end_of_block_or_statement (parser);\n+      return;\n+    }\n   /* [temp]\n \n      A template ... shall not have C linkage.  */"}, {"sha": "089232fa404a7d28fc4b89311dc5a3568f678da5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "patch": "@@ -1,5 +1,8 @@\n 2006-12-05  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++/29729\n+\t* g++.dg/template/crash63.C: New test.\n+\n \tPR c++/29728\n \t* g++.dg/template/crash62.C: New test.\n "}, {"sha": "b7056e8d85e7f0ee2a0a6f65b21995665094d8ec", "filename": "gcc/testsuite/g++.dg/template/crash63.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash63.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f1ba716a2b0eb2db5e641f739bf461912e7ef89/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash63.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fcrash63.C?ref=7f1ba716a2b0eb2db5e641f739bf461912e7ef89", "patch": "@@ -0,0 +1,12 @@\n+// PR c++/29729\n+\n+template<typename T> void foo(T)\n+{\n+  struct A\n+  {\n+    template<int> struct B // { dg-error \"local class\" }\n+    {\n+      typedef B<0> C;\n+    }\n+  };\n+}"}]}