{"sha": "084128583212bd64308f50c2ab5f4c03be40e48c", "node_id": "C_kwDOANBUbNoAKDA4NDEyODU4MzIxMmJkNjQzMDhmNTBjMmFiNWY0YzAzYmU0MGU0OGM", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-10-28T11:50:57Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-10-28T13:07:02Z"}, "message": "tree-optimization/107435 - ICE with recurrence vectorization\n\nThis implements the missed conversion from pointer to integer.\n\n\tPR tree-optimization/107435\n\t* tree-vect-loop.cc (vectorizable_recurr): Convert initial\n\tvalue to vector component type.\n\n\t* gcc.dg/torture/pr107435.c: New testcase.", "tree": {"sha": "bc8dafad8ec688878a9a6fc072c96710e5a08396", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc8dafad8ec688878a9a6fc072c96710e5a08396"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/084128583212bd64308f50c2ab5f4c03be40e48c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/084128583212bd64308f50c2ab5f4c03be40e48c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/084128583212bd64308f50c2ab5f4c03be40e48c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/084128583212bd64308f50c2ab5f4c03be40e48c/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89999f2358724fa4e71c7c3b4de340582c0e43da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89999f2358724fa4e71c7c3b4de340582c0e43da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89999f2358724fa4e71c7c3b4de340582c0e43da"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "1012896919120f415cc9071ed974fc9b3f76f8a2", "filename": "gcc/testsuite/gcc.dg/torture/pr107435.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/084128583212bd64308f50c2ab5f4c03be40e48c/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr107435.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/084128583212bd64308f50c2ab5f4c03be40e48c/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr107435.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr107435.c?ref=084128583212bd64308f50c2ab5f4c03be40e48c", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-mavx2\" { target x86_64-*-* i?86-*-* } } */\n+\n+struct qlist_head {\n+  struct qlist_head *next;\n+};\n+void\n+qlist_add (struct qlist_head *new, struct qlist_head *head)\n+{\n+  struct qlist_head *prev = head;\n+  new->next = head->next;\n+  prev->next = new;\n+}\n+struct {\n+  struct qlist_head queue_link;\n+} free_list, prealloc[64];\n+void\n+dbpf_open_cache_initialize()\n+{\n+  int i = 0;\n+  for (; i < 64; i++)\n+    qlist_add(&prealloc[i].queue_link, &free_list.queue_link);\n+}"}, {"sha": "aacbb12580c89a7a12b11cc096502d669a9e1e21", "filename": "gcc/tree-vect-loop.cc", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/084128583212bd64308f50c2ab5f4c03be40e48c/gcc%2Ftree-vect-loop.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/084128583212bd64308f50c2ab5f4c03be40e48c/gcc%2Ftree-vect-loop.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.cc?ref=084128583212bd64308f50c2ab5f4c03be40e48c", "patch": "@@ -8469,6 +8469,12 @@ vectorizable_recurr (loop_vec_info loop_vinfo, stmt_vec_info stmt_info,\n   edge pe = loop_preheader_edge (LOOP_VINFO_LOOP (loop_vinfo));\n   basic_block bb = gimple_bb (phi);\n   tree preheader = PHI_ARG_DEF_FROM_EDGE (phi, pe);\n+  if (!useless_type_conversion_p (TREE_TYPE (vectype), TREE_TYPE (preheader)))\n+    {\n+      gimple_seq stmts = NULL;\n+      preheader = gimple_convert (&stmts, TREE_TYPE (vectype), preheader);\n+      gsi_insert_seq_on_edge_immediate (pe, stmts);\n+    }\n   tree vec_init = build_vector_from_val (vectype, preheader);\n   vec_init = vect_init_vector (loop_vinfo, stmt_info, vec_init, vectype, NULL);\n "}]}