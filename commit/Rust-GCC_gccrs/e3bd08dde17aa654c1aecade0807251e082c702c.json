{"sha": "e3bd08dde17aa654c1aecade0807251e082c702c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTNiZDA4ZGRlMTdhYTY1NGMxYWVjYWRlMDgwNzI1MWUwODJjNzAyYw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2019-11-09T17:45:29Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2019-11-09T17:45:29Z"}, "message": "ipa-fnsummary.c (ipa_call_context::estimate_size_and_time): Fix calculation of min_size.\n\n\n\t* ipa-fnsummary.c (ipa_call_context::estimate_size_and_time): Fix\n\tcalculation of min_size.\n\t(ipa_update_overall_fn_summary): Likewise.\n\nFrom-SVN: r278006", "tree": {"sha": "04a0c294937be77420220a3bf3bfdbaa26c2bb83", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/04a0c294937be77420220a3bf3bfdbaa26c2bb83"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3bd08dde17aa654c1aecade0807251e082c702c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3bd08dde17aa654c1aecade0807251e082c702c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3bd08dde17aa654c1aecade0807251e082c702c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3bd08dde17aa654c1aecade0807251e082c702c/comments", "author": null, "committer": null, "parents": [{"sha": "83263ef536402228e0a6cdf5f0fae8055b8b472d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83263ef536402228e0a6cdf5f0fae8055b8b472d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83263ef536402228e0a6cdf5f0fae8055b8b472d"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "e2bef8bc2a03a67e78e8daac1315e33e1660f41b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3bd08dde17aa654c1aecade0807251e082c702c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3bd08dde17aa654c1aecade0807251e082c702c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e3bd08dde17aa654c1aecade0807251e082c702c", "patch": "@@ -1,3 +1,9 @@\n+2019-11-09  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-fnsummary.c (ipa_call_context::estimate_size_and_time): Fix\n+\tcalculation of min_size.\n+\t(ipa_update_overall_fn_summary): Likewise.\n+\n 2019-11-09  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* ipa-fnsummary.c (estimate_edge_size_and_time): Do not call"}, {"sha": "941e732359f2917d1cb479466e937c4b9a06f556", "filename": "gcc/ipa-fnsummary.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3bd08dde17aa654c1aecade0807251e082c702c/gcc%2Fipa-fnsummary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3bd08dde17aa654c1aecade0807251e082c702c/gcc%2Fipa-fnsummary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-fnsummary.c?ref=e3bd08dde17aa654c1aecade0807251e082c702c", "patch": "@@ -3243,6 +3243,7 @@ ipa_call_context::estimate_size_and_time (int *ret_size,\n \n   sreal nonspecialized_time = time;\n \n+  min_size += (*info->size_time_table)[0].size;\n   for (i = 0; vec_safe_iterate (info->size_time_table, i, &e); i++)\n     {\n       bool exec = e->exec_predicate.evaluate (m_nonspec_possible_truths);\n@@ -3288,7 +3289,7 @@ ipa_call_context::estimate_size_and_time (int *ret_size,\n      }\n   gcc_checking_assert ((*info->size_time_table)[0].exec_predicate == true);\n   gcc_checking_assert ((*info->size_time_table)[0].nonconst_predicate == true);\n-  min_size = (*info->size_time_table)[0].size;\n+  gcc_checking_assert (min_size >= 0);\n   gcc_checking_assert (size >= 0);\n   gcc_checking_assert (time >= 0);\n   /* nonspecialized_time should be always bigger than specialized time.\n@@ -3685,12 +3686,13 @@ ipa_update_overall_fn_summary (struct cgraph_node *node)\n       size_info->size += e->size;\n       info->time += e->time;\n     }\n+  info->min_size = (*info->size_time_table)[0].size;\n   estimate_calls_size_and_time (node, &size_info->size, &info->min_size,\n \t\t\t\t&info->time, NULL,\n \t\t\t\t~(clause_t) (1 << predicate::false_condition),\n \t\t\t\tvNULL, vNULL, vNULL);\n-  size_info->size = (size_info->size + ipa_fn_summary::size_scale / 2)\n-\t\t    / ipa_fn_summary::size_scale;\n+  size_info->size = RDIV (size_info->size, ipa_fn_summary::size_scale);\n+  info->min_size = RDIV (info->min_size, ipa_fn_summary::size_scale);\n }\n \n "}]}