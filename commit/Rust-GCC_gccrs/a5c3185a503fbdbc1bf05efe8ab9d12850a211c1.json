{"sha": "a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTVjMzE4NWE1MDNmYmRiYzFiZjA1ZWZlOGFiOWQxMjg1MGEyMTFjMQ==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2019-10-21T06:40:41Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2019-10-21T06:40:41Z"}, "message": "Pass a vec_info to vect_supportable_shift\n\n2019-10-21  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/\n\t* tree-vectorizer.h (vect_supportable_shift): Take a vec_info.\n\t* tree-vect-stmts.c (vect_supportable_shift): Likewise.\n\t* tree-vect-patterns.c (vect_synth_mult_by_constant): Update call\n\taccordingly.\n\nFrom-SVN: r277224", "tree": {"sha": "383672aa374f933c27f605ea79951260df11ca8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/383672aa374f933c27f605ea79951260df11ca8e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "da157e2ee9e12348df78246ee33b244b7cc334df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da157e2ee9e12348df78246ee33b244b7cc334df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da157e2ee9e12348df78246ee33b244b7cc334df"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "529a562d82f8c8f01ca9e6d7a9a89ef63bff0e9c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "patch": "@@ -1,3 +1,10 @@\n+2019-10-21  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-vectorizer.h (vect_supportable_shift): Take a vec_info.\n+\t* tree-vect-stmts.c (vect_supportable_shift): Likewise.\n+\t* tree-vect-patterns.c (vect_synth_mult_by_constant): Update call\n+\taccordingly.\n+\n 2019-10-21  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* tree-vectorizer.c (get_vec_alignment_for_array_type): Use"}, {"sha": "4faa6e7ddd8700e0cccb026eb1620b079933df57", "filename": "gcc/tree-vect-patterns.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2Ftree-vect-patterns.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2Ftree-vect-patterns.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-patterns.c?ref=a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "patch": "@@ -2720,6 +2720,7 @@ static gimple *\n vect_synth_mult_by_constant (tree op, tree val,\n \t\t\t     stmt_vec_info stmt_vinfo)\n {\n+  vec_info *vinfo = stmt_vinfo->vinfo;\n   tree itype = TREE_TYPE (op);\n   machine_mode mode = TYPE_MODE (itype);\n   struct algorithm alg;\n@@ -2738,7 +2739,7 @@ vect_synth_mult_by_constant (tree op, tree val,\n \n   /* Targets that don't support vector shifts but support vector additions\n      can synthesize shifts that way.  */\n-  bool synth_shift_p = !vect_supportable_shift (LSHIFT_EXPR, multtype);\n+  bool synth_shift_p = !vect_supportable_shift (vinfo, LSHIFT_EXPR, multtype);\n \n   HOST_WIDE_INT hwval = tree_to_shwi (val);\n   /* Use MAX_COST here as we don't want to limit the sequence on rtx costs."}, {"sha": "f76b5d4aac709e3b66515c263f05199cc9a6133d", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "patch": "@@ -5465,7 +5465,7 @@ vectorizable_assignment (stmt_vec_info stmt_info, gimple_stmt_iterator *gsi,\n    either as shift by a scalar or by a vector.  */\n \n bool\n-vect_supportable_shift (enum tree_code code, tree scalar_type)\n+vect_supportable_shift (vec_info *, enum tree_code code, tree scalar_type)\n {\n \n   machine_mode vec_mode;"}, {"sha": "e1016d875f7266687d322b5bf078c76319a44e19", "filename": "gcc/tree-vectorizer.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2Ftree-vectorizer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5c3185a503fbdbc1bf05efe8ab9d12850a211c1/gcc%2Ftree-vectorizer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.h?ref=a5c3185a503fbdbc1bf05efe8ab9d12850a211c1", "patch": "@@ -1634,7 +1634,7 @@ extern void vect_get_load_cost (stmt_vec_info, int, bool,\n \t\t\t\tstmt_vector_for_cost *, bool);\n extern void vect_get_store_cost (stmt_vec_info, int,\n \t\t\t\t unsigned int *, stmt_vector_for_cost *);\n-extern bool vect_supportable_shift (enum tree_code, tree);\n+extern bool vect_supportable_shift (vec_info *, enum tree_code, tree);\n extern tree vect_gen_perm_mask_any (tree, const vec_perm_indices &);\n extern tree vect_gen_perm_mask_checked (tree, const vec_perm_indices &);\n extern void optimize_mask_stores (class loop*);"}]}