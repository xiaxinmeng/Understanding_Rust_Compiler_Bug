{"sha": "80a13af724aedfb360893dcc16aa7cc12ca49799", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODBhMTNhZjcyNGFlZGZiMzYwODkzZGNjMTZhYTdjYzEyY2E0OTc5OQ==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2020-03-12T18:38:42Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2020-03-13T14:30:36Z"}, "message": "c++: Redundant -Wdeprecated-declarations warning in build_over_call [PR67960]\n\nIn build_over_call, we are emitting a redundant -Wdeprecated-declarations\nwarning about the deprecated callee function, first from mark_used and again\nfrom build_addr_func <- decay_conversion <- cp_build_addr_expr <- mark_used.\n\nIt seems this second deprecation warning coming from build_addr_func will always\nbe redundant, so we can safely use a warning_sentinel to disable it before\ncalling build_addr_func.  (And any deprecation warning that could come from\nbuild_addr_func would be for FN, so we wouldn't be suppressing too much.)\n\ngcc/cp/ChangeLog:\n\n\tPR c++/67960\n\t* call.c (build_over_call): Use a warning_sentinel to disable\n\twarn_deprecated_decl before calling build_addr_func.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/67960\n\t* g++.dg/diagnostic/pr67960.C: New test.\n\t* g++.dg/diagnostic/pr67960-2.C: New test.", "tree": {"sha": "bc95d793f4402174bed2e31fca4c5299ffcb470a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc95d793f4402174bed2e31fca4c5299ffcb470a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/80a13af724aedfb360893dcc16aa7cc12ca49799", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80a13af724aedfb360893dcc16aa7cc12ca49799", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80a13af724aedfb360893dcc16aa7cc12ca49799", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80a13af724aedfb360893dcc16aa7cc12ca49799/comments", "author": null, "committer": null, "parents": [{"sha": "3604480a6fe493c51d6ebd53d9b1abeebbbb828f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3604480a6fe493c51d6ebd53d9b1abeebbbb828f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3604480a6fe493c51d6ebd53d9b1abeebbbb828f"}], "stats": {"total": 43, "additions": 43, "deletions": 0}, "files": [{"sha": "eea795de2185bd139c81b3ccc8b1ad12922d2ed6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=80a13af724aedfb360893dcc16aa7cc12ca49799", "patch": "@@ -1,3 +1,9 @@\n+2020-03-13  Patrick Palka  <ppalka@redhat.com>\n+\n+\tPR c++/67960\n+\t* call.c (build_over_call): Use a warning_sentinel to disable\n+\twarn_deprecated_decl before calling build_addr_func.\n+\n 2020-03-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/94124"}, {"sha": "1715acc0ec35dd003156464347255cad12608c46", "filename": "gcc/cp/call.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=80a13af724aedfb360893dcc16aa7cc12ca49799", "patch": "@@ -9062,6 +9062,11 @@ build_over_call (struct z_candidate *cand, int flags, tsubst_flags_t complain)\n     }\n   else\n     {\n+      /* If FN is marked deprecated, then we've already issued a deprecated-use\n+\t warning from mark_used above, so avoid redundantly issuing another one\n+\t from build_addr_func.  */\n+      warning_sentinel w (warn_deprecated_decl);\n+\n       fn = build_addr_func (fn, complain);\n       if (fn == error_mark_node)\n \treturn error_mark_node;"}, {"sha": "2f738fadd8019c260d37aba2fb200d0efcbffc58", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=80a13af724aedfb360893dcc16aa7cc12ca49799", "patch": "@@ -1,3 +1,9 @@\n+2020-03-13  Patrick Palka  <ppalka@redhat.com>\n+\n+\tPR c++/67960\n+\t* g++.dg/diagnostic/pr67960.C: New test.\n+\t* g++.dg/diagnostic/pr67960-2.C: New test.\n+\n 2020-03-13  Martin Liska  <mliska@suse.cz>\n \n \tPR lto/94157"}, {"sha": "d2ba509534ff5f00cbdcc46abb1ab4ae41a20e55", "filename": "gcc/testsuite/g++.dg/diagnostic/pr67960-2.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr67960-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr67960-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr67960-2.C?ref=80a13af724aedfb360893dcc16aa7cc12ca49799", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/67960\n+// { dg-do compile }\n+// { dg-additional-options \"-Werror -fmax-errors=1\" }\n+__attribute__((deprecated)) void doNothing(){}\n+\n+int\n+main()\n+{\n+  doNothing(); // { dg-error \"is deprecated\" }\n+}\n+\n+// { dg-message \"all warnings being treated as errors\" \"\" { target *-*-* } 0 }\n+// { dg-bogus \"compilation terminated\" \"\" { target *-*-* } 0 }"}, {"sha": "d7b1a2d0811308c256f950c2add61402631741a5", "filename": "gcc/testsuite/g++.dg/diagnostic/pr67960.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr67960.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/80a13af724aedfb360893dcc16aa7cc12ca49799/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr67960.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr67960.C?ref=80a13af724aedfb360893dcc16aa7cc12ca49799", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/67960\n+// { dg-do compile { target c++14 } }\n+// { dg-additional-options \"-Werror -fmax-errors=1\" }\n+[[deprecated]] void doNothing(){}\n+\n+int\n+main()\n+{\n+  doNothing(); // { dg-error \"is deprecated\" }\n+}\n+\n+// { dg-message \"all warnings being treated as errors\" \"\" { target *-*-* } 0 }\n+// { dg-bogus \"compilation terminated\" \"\" { target *-*-* } 0 }"}]}