{"sha": "85539630e3abdad70f84d87eb0a4458f44961e03", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODU1Mzk2MzBlM2FiZGFkNzBmODRkODdlYjBhNDQ1OGY0NDk2MWUwMw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2009-11-27T10:44:49Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2009-11-27T10:44:49Z"}, "message": "re PR c++/35112 (ICE and broken diagnostic with ambiguous class name)\n\n/cp\n2009-11-27  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/35112\n\t* pt.c (print_overloaded_functions): New.\n\t(print_candidates): Call the latter.\n\t* parser.c (cp_parser_class_name): Do not duplicate the diagnostics\n\tafter the cp_parser_lookup_name call.\n\n/testsuite\n2009-11-27  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/35112\n\t* g++.dg/parse/crash53.C: New.\n\t* g++.dg/parse/error17.C: Adjust, error messages are not\n\tduplicated anymore.\n\t* g++.dg/template/dtor7.C: Remove xfail-ed dg-bogus directives.\n\nFrom-SVN: r154698", "tree": {"sha": "59ae17451dd4756e0353b1b70eebf9b16b659d14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/59ae17451dd4756e0353b1b70eebf9b16b659d14"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/85539630e3abdad70f84d87eb0a4458f44961e03", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85539630e3abdad70f84d87eb0a4458f44961e03", "html_url": "https://github.com/Rust-GCC/gccrs/commit/85539630e3abdad70f84d87eb0a4458f44961e03", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85539630e3abdad70f84d87eb0a4458f44961e03/comments", "author": null, "committer": null, "parents": [{"sha": "58b9741ecbe673531ce7757810a1b24e1a01a96b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58b9741ecbe673531ce7757810a1b24e1a01a96b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58b9741ecbe673531ce7757810a1b24e1a01a96b"}], "stats": {"total": 84, "additions": 55, "deletions": 29}, "files": [{"sha": "032afa0e6e192ed2388c69ed167804d509c550c8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -1,3 +1,11 @@\n+2009-11-27  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/35112\n+\t* pt.c (print_overloaded_functions): New.\n+\t(print_candidates): Call the latter.\n+\t* parser.c (cp_parser_class_name): Do not duplicate the diagnostics\n+\tafter the cp_parser_lookup_name call.\n+\n 2009-11-26  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/42026, DR 239"}, {"sha": "5c8dbcb155e70f6f95e5277e0dd2255888a82cf2", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -15738,14 +15738,8 @@ cp_parser_class_name (cp_parser *parser,\n \t\t\t\t\tidentifier_token->location);\n \t  if (ambiguous_decls)\n \t    {\n-\t      error_at (identifier_token->location,\n-\t\t\t\"reference to %qD is ambiguous\", identifier);\n-\t      print_candidates (ambiguous_decls);\n \t      if (cp_parser_parsing_tentatively (parser))\n-\t\t{\n-\t\t  identifier_token->ambiguous_p = true;\n-\t\t  cp_parser_simulate_error (parser);\n-\t\t}\n+\t\tcp_parser_simulate_error (parser);\n \t      return error_mark_node;\n \t    }\n \t}"}, {"sha": "db3956b180281e50954ca1053f6f1123618a0d82", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -1646,29 +1646,36 @@ explicit_class_specialization_p (tree type)\n   return !uses_template_parms (CLASSTYPE_TI_ARGS (type));\n }\n \n+/* Print the list of overloaded FNS in an error message.   */\n+\n+static void\n+print_overloaded_functions (tree fns, const char **str)\n+{\n+  tree fn;\n+  for (fn = fns; fn; fn = OVL_NEXT (fn))\n+    {\n+      if (TREE_CODE (fn) == TREE_LIST)\n+\tprint_candidates (fn);\n+      else\n+\terror (\"%s %+#D\", *str, OVL_CURRENT (fn));\n+      *str = \"               \";\n+    }\n+}\n+\n /* Print the list of candidate FNS in an error message.  */\n \n void\n print_candidates (tree fns)\n {\n-  tree fn;\n-  tree f;\n-\n   const char *str = \"candidates are:\";\n \n   if (is_overloaded_fn (fns))\n+    print_overloaded_functions (fns, &str);\n+  else\n     {\n-      for (f = fns; f; f = OVL_NEXT (f))\n-\t{\n-\t  error (\"%s %+#D\", str, OVL_CURRENT (f));\n-\t  str = \"               \";\n-\t}\n-    }\n-  else for (fn = fns; fn != NULL_TREE; fn = TREE_CHAIN (fn))\n-    {\n-      for (f = TREE_VALUE (fn); f; f = OVL_NEXT (f))\n-\terror (\"%s %+#D\", str, OVL_CURRENT (f));\n-      str = \"               \";\n+      tree fn;\n+      for (fn = fns; fn != NULL_TREE; fn = TREE_CHAIN (fn))\n+\tprint_overloaded_functions (TREE_VALUE (fn), &str);\n     }\n }\n "}, {"sha": "cd4c631b3361b8cac7b58e6ff26cc477115e86b5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -1,3 +1,11 @@\n+2009-11-27  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/35112\n+\t* g++.dg/parse/crash53.C: New.\n+\t* g++.dg/parse/error17.C: Adjust, error messages are not\n+\tduplicated anymore.\n+\t* g++.dg/template/dtor7.C: Remove xfail-ed dg-bogus directives.\n+\n 2009-11-27  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.target/i386/vperm-v4sf-1.c (dg-options): Use -msse2."}, {"sha": "de6d412f1d1b55dec824fcff472371603b67c4d1", "filename": "gcc/testsuite/g++.dg/parse/crash53.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash53.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash53.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fcrash53.C?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/35112\n+\n+namespace X { struct A; }  // { dg-error \"struct X::A\" }\n+namespace Y { struct A; }  // { dg-error \"struct Y::A\" }\n+namespace Z { struct A; }  // { dg-error \"struct Z::A\" }\n+namespace W { struct A; }  // { dg-error \"struct W::A\" }\n+\n+using namespace X;\n+using namespace Y;\n+using namespace Z;\n+using namespace W;\n+\n+A* p; // { dg-error \"reference to 'A' is ambiguous|'A' does not name a type\" }"}, {"sha": "b308c912f1e8efdfb990ed0d1d18607edf324c2c", "filename": "gcc/testsuite/g++.dg/parse/error17.C", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror17.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror17.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ferror17.C?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -2,10 +2,8 @@\n // PR c++/16965\n \n template <typename T> struct B { \n-  static int Bar(T); // { dg-error \"14:candidates are: \" \"1\" }\n-  // { dg-error \"14:with T = int\" \"2\" { target *-*-* } 5 }\n+  static int Bar(T); // { dg-error \"14:candidates are: |with T = int\" }\n }; \n struct D : B<int>, B<char> {}; \n  \n-int i2 = D::Bar(2); // { dg-error \"13:reference to 'Bar' is ambiguous\" }\n-// { dg-error \"10:reference to 'Bar' is ambiguous\" \"2\" { target *-*-* } 10 }\n+int i2 = D::Bar(2); // { dg-error \"10:reference to 'Bar' is ambiguous\" }"}, {"sha": "e96f56397ebae0fc2a6069bf7825c347bab91cc7", "filename": "gcc/testsuite/g++.dg/template/dtor7.C", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fdtor7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85539630e3abdad70f84d87eb0a4458f44961e03/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fdtor7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fdtor7.C?ref=85539630e3abdad70f84d87eb0a4458f44961e03", "patch": "@@ -1,10 +1,10 @@\n // PR c++/40373\n // { dg-compile }\n \n-struct A;\t// { dg-bogus \"candidates are\" \"\" { xfail *-*-* } }\n+struct A;\n namespace\n {\n-  struct A;\t// { dg-bogus \"struct\" \"\" { xfail *-*-* } }\n+  struct A;\n }\n \n struct B {};\n@@ -20,5 +20,3 @@ bar ()\n {\n   foo (B ());\t// { dg-bogus \"instantiated from here\" \"\" { xfail *-*-* } }\n }\n-\n-// { dg-bogus \"is ambiguous\" \"\" { xfail *-*-* } 15 }"}]}