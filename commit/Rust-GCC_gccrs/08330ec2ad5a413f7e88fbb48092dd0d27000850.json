{"sha": "08330ec2ad5a413f7e88fbb48092dd0d27000850", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDgzMzBlYzJhZDVhNDEzZjdlODhmYmI0ODA5MmRkMGQyNzAwMDg1MA==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2005-11-03T15:21:15Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2005-11-03T15:21:15Z"}, "message": "re PR middle-end/24589 (wrong code with zero sized structs on CONSTRUCTOR)\n\n2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR middle-end/24589\n        * gimplify.c (gimplify_expr) <case CONSTRUCTOR>: Add the\n        expressions to a statement list instead of gimplifying them.\n\n2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR middle-end/24589\n        * gcc.c-torture/execute/zero-struct-2.c: New test.\n\nFrom-SVN: r106436", "tree": {"sha": "93fded5899e717286d00db6895ac18a4548de59a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/93fded5899e717286d00db6895ac18a4548de59a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/08330ec2ad5a413f7e88fbb48092dd0d27000850", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08330ec2ad5a413f7e88fbb48092dd0d27000850", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08330ec2ad5a413f7e88fbb48092dd0d27000850", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08330ec2ad5a413f7e88fbb48092dd0d27000850/comments", "author": null, "committer": null, "parents": [{"sha": "b88b7ced9b63f5f77b03dcd7fe114a152ac1dbd5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b88b7ced9b63f5f77b03dcd7fe114a152ac1dbd5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b88b7ced9b63f5f77b03dcd7fe114a152ac1dbd5"}], "stats": {"total": 42, "additions": 37, "deletions": 5}, "files": [{"sha": "e449baa16ecc7c4fbe6bf445142873583660aab2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=08330ec2ad5a413f7e88fbb48092dd0d27000850", "patch": "@@ -1,3 +1,9 @@\n+2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR middle-end/24589\n+\t* gimplify.c (gimplify_expr) <case CONSTRUCTOR>: Add the\n+\texpressions to a statement list instead of gimplifying them.\n+\n 2005-11-03  Eric Botcazou  <ebotcazou@libertysurf.fr>\n \n \tPR rtl-optimization/23585"}, {"sha": "52e70bdad5ea7cdcfab6c3818a976f654270be14", "filename": "gcc/gimplify.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=08330ec2ad5a413f7e88fbb48092dd0d27000850", "patch": "@@ -4312,18 +4312,19 @@ gimplify_expr (tree *expr_p, tree *pre_p, tree *post_p,\n \t    {\n \t      unsigned HOST_WIDE_INT ix;\n \t      constructor_elt *ce;\n+\t      tree temp = NULL_TREE;\n \t      for (ix = 0;\n \t\t   VEC_iterate (constructor_elt, CONSTRUCTOR_ELTS (*expr_p),\n \t\t\t\tix, ce);\n \t\t   ix++)\n \t\tif (TREE_SIDE_EFFECTS (ce->value))\n-\t\t  gimplify_expr (&ce->value, pre_p, post_p,\n-\t\t\t\t gimple_test_f, fallback);\n+\t\t  append_to_statement_list (ce->value, &temp);\n \n-\t      *expr_p = NULL_TREE;\n+\t      *expr_p = temp;\n+\t      ret = GS_OK;\n \t    }\n-\n-\t  ret = GS_ALL_DONE;\n+\t  else\n+\t    ret = GS_ALL_DONE;\n \t  break;\n \n \t  /* The following are special cases that are not handled by the"}, {"sha": "ffb3ee094092b9f21ca907558e242595c6b241b3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=08330ec2ad5a413f7e88fbb48092dd0d27000850", "patch": "@@ -1,3 +1,8 @@\n+2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR middle-end/24589\n+\t* gcc.c-torture/execute/zero-struct-2.c: New test.\n+\n 2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \tPR c++/24582"}, {"sha": "ed1d5a027b33c639a4ee4eb619dd6f0b404ea43e", "filename": "gcc/testsuite/gcc.c-torture/execute/zero-struct-2.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fzero-struct-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08330ec2ad5a413f7e88fbb48092dd0d27000850/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fzero-struct-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fzero-struct-2.c?ref=08330ec2ad5a413f7e88fbb48092dd0d27000850", "patch": "@@ -0,0 +1,20 @@\n+void abort (void);\n+int ii;\n+typedef struct {} raw_spinlock_t;\n+typedef struct {\n+  raw_spinlock_t raw_lock;\n+} spinlock_t;\n+raw_spinlock_t one_raw_spinlock (void)\n+{\n+  raw_spinlock_t raw_lock;\n+  ii++;\n+  return raw_lock;\n+}\n+int main(void)\n+{\n+  spinlock_t lock = (spinlock_t) { .raw_lock = one_raw_spinlock() };\n+  if (ii != 1)\n+    abort ();\n+  return 0;\n+}\n+"}]}