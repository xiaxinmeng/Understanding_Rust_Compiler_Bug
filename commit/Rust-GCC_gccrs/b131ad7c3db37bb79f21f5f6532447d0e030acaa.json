{"sha": "b131ad7c3db37bb79f21f5f6532447d0e030acaa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjEzMWFkN2MzZGIzN2JiNzlmMjFmNWY2NTMyNDQ3ZDBlMDMwYWNhYQ==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-11-12T00:28:41Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-11-12T00:28:41Z"}, "message": "re PR c++/8570 (line number in error message is badly placed with illegal template friend declaration)\n\n2007-11-12  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\n\tPR c++/8570\ncp/\n\t* pt.c (redeclare_class_template): Update error message. Use a\n\tnote to show the previous declaration.\n\t(tsubst_friend_class): Use the location of the friend template as\n\tthe input location before calling redeclare_class_template.\ntestsuite/\n\t* g++.old-deja/g++.ns/template13.C: Update expected output.\n\t* g++.old-deja/g++.pt/friend23.C: Likewise.\n\t* g++.dg/warn/pr8570.C: New.\n\nFrom-SVN: r130092", "tree": {"sha": "85e9b9c7db2da544bf03730011a29b03a6bada07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/85e9b9c7db2da544bf03730011a29b03a6bada07"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b131ad7c3db37bb79f21f5f6532447d0e030acaa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b131ad7c3db37bb79f21f5f6532447d0e030acaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b131ad7c3db37bb79f21f5f6532447d0e030acaa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b131ad7c3db37bb79f21f5f6532447d0e030acaa/comments", "author": null, "committer": null, "parents": [{"sha": "acd7ad0afc0e2be08fe6582e2b46299601d6db7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acd7ad0afc0e2be08fe6582e2b46299601d6db7e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acd7ad0afc0e2be08fe6582e2b46299601d6db7e"}], "stats": {"total": 54, "additions": 44, "deletions": 10}, "files": [{"sha": "cfeea801148f97c17089e5fe06582d1454d71558", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b131ad7c3db37bb79f21f5f6532447d0e030acaa", "patch": "@@ -1,3 +1,11 @@\n+2007-11-12  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/8570\n+\t* pt.c (redeclare_class_template): Update error message. Use a\n+\tnote to show the previous declaration.\n+\t(tsubst_friend_class): Use the location of the friend template as\n+\tthe input location before calling redeclare_class_template.\n+\n 2007-11-11  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/34068"}, {"sha": "0339a8c02d3ba75145e00a5018e3cc4101a8c6e1", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=b131ad7c3db37bb79f21f5f6532447d0e030acaa", "patch": "@@ -4151,10 +4151,10 @@ redeclare_class_template (tree type, tree parms)\n \n   if (TREE_VEC_LENGTH (parms) != TREE_VEC_LENGTH (tmpl_parms))\n     {\n-      error (\"previous declaration %q+D\", tmpl);\n-      error (\"used %d template parameter(s) instead of %d\",\n-\t     TREE_VEC_LENGTH (tmpl_parms),\n-\t     TREE_VEC_LENGTH (parms));\n+      error (\"redeclared with %d template parameter(s)\", \n+             TREE_VEC_LENGTH (parms));\n+      inform (\"previous declaration %q+D used %d template parameter(s)\", \n+             tmpl, TREE_VEC_LENGTH (tmpl_parms));\n       return false;\n     }\n \n@@ -4193,7 +4193,7 @@ redeclare_class_template (tree type, tree parms)\n \t     A template-parameter may not be given default arguments\n \t     by two different declarations in the same scope.  */\n \t  error (\"redefinition of default argument for %q#D\", parm);\n-\t  error (\"%J  original definition appeared here\", tmpl_parm);\n+\t  inform (\"%Joriginal definition appeared here\", tmpl_parm);\n \t  return false;\n \t}\n \n@@ -6521,9 +6521,15 @@ tsubst_friend_class (tree friend_tmpl, tree args)\n \t  > TMPL_ARGS_DEPTH (args))\n \t{\n \t  tree parms;\n+          location_t saved_input_location;\n \t  parms = tsubst_template_parms (DECL_TEMPLATE_PARMS (friend_tmpl),\n \t\t\t\t\t args, tf_warning_or_error);\n+\n+          saved_input_location = input_location;\n+          input_location = DECL_SOURCE_LOCATION (friend_tmpl);\n \t  redeclare_class_template (TREE_TYPE (tmpl), parms);\n+          input_location = saved_input_location;\n+          \n \t}\n \n       friend_type = TREE_TYPE (tmpl);"}, {"sha": "3c9a1a09891159c1e8587f904bb08235d1d3c997", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b131ad7c3db37bb79f21f5f6532447d0e030acaa", "patch": "@@ -1,3 +1,10 @@\n+2007-11-12  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\n+\tPR c++/8570\n+\t* g++.old-deja/g++.ns/template13.C: Update expected output.\n+\t* g++.old-deja/g++.pt/friend23.C: Likewise.\n+\t* g++.dg/warn/pr8570.C: New.\n+\n 2007-11-11  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/34068"}, {"sha": "0136bb1050a0ca52b41062e44935a8fd1b0a8723", "filename": "gcc/testsuite/g++.dg/warn/pr8570.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr8570.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr8570.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr8570.C?ref=b131ad7c3db37bb79f21f5f6532447d0e030acaa", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/8570\n+// { dg-do compile }\n+// { dg-options \"\" }\n+template <typename T, typename P>\n+class X { // { dg-warning \"note: previous declaration .* used 2\" }\n+public:\n+  X() { }\n+\n+private:\n+  template <typename U> friend class X; // { dg-error \"error: .*redeclared with 1 template parameter\" }\n+};\n+\n+X<int, int> i;"}, {"sha": "7059b1949f85327f7c0d499b078a8376e4fb4cbb", "filename": "gcc/testsuite/g++.old-deja/g++.ns/template13.C", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ns%2Ftemplate13.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ns%2Ftemplate13.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.ns%2Ftemplate13.C?ref=b131ad7c3db37bb79f21f5f6532447d0e030acaa", "patch": "@@ -5,7 +5,7 @@ namespace bar\n   // trick it to provide some prior declaration\n   template<class T>\n   void foo(); // { dg-error \"definition\" }\n-  template<class T>class X; // { dg-error \"previous declaration\" }\n+  template<class T>class X; // { dg-error \"note: previous declaration\" }\n }\n \n template <typename T>\n@@ -20,4 +20,4 @@ template<> void bar::foo<int>()     // { dg-error \"different namespace\" }\n }\n \n template<class T,class U>\n-class bar::X{};         // { dg-error \"1 template parameter\" }\n+class bar::X{};         // { dg-error \"error: redeclared with 2 template parameter\" }"}, {"sha": "baf1a931cbaa7436c1dcbb55987f75a3d90c2c85", "filename": "gcc/testsuite/g++.old-deja/g++.pt/friend23.C", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ffriend23.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b131ad7c3db37bb79f21f5f6532447d0e030acaa/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ffriend23.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Ffriend23.C?ref=b131ad7c3db37bb79f21f5f6532447d0e030acaa", "patch": "@@ -1,10 +1,10 @@\n // { dg-do assemble  }\n \n-template <class T = int> // { dg-error \"\" } original definition\n+template <class T = int> // { dg-error \"note: original definition\" }\n struct S\n-{ // { dg-error \"\" } redefinition of default arg\n+{ \n   template <class U = int>\n-  friend class S;\n+  friend class S; // { dg-error \"redefinition of default argument\" }\n };\n \n template struct S<int>;"}]}