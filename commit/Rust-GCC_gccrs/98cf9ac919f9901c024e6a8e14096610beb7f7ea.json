{"sha": "98cf9ac919f9901c024e6a8e14096610beb7f7ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OThjZjlhYzkxOWY5OTAxYzAyNGU2YThlMTQwOTY2MTBiZWI3ZjdlYQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2013-08-21T19:06:05Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-08-21T19:06:05Z"}, "message": "re PR c++/56130 (__attribute__((deprecated)) does not affect C++ reference)\n\n2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* call.c (build_new_method_call_1): Use INDIRECT_REF_P.\n\t* cp-tree.h (REFERENCE_REF_P): Likewise.\n\t* semantics.c (finish_offsetof): Likewise.\n\n\n/cp\n2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/56130\n\t* semantics.c (finish_id_expression): Handle deprecated references.\n\n/testsuite\n2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/56130\n\t* g++.dg/warn/deprecated-7.C: New.\n\nFrom-SVN: r201906", "tree": {"sha": "eac762d9b0be22125e42d8ef0a46b61668e001f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eac762d9b0be22125e42d8ef0a46b61668e001f7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/98cf9ac919f9901c024e6a8e14096610beb7f7ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98cf9ac919f9901c024e6a8e14096610beb7f7ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98cf9ac919f9901c024e6a8e14096610beb7f7ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98cf9ac919f9901c024e6a8e14096610beb7f7ea/comments", "author": null, "committer": null, "parents": [{"sha": "dd5e84232f4b63d3fb56ad9be5d0fe016b075856", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd5e84232f4b63d3fb56ad9be5d0fe016b075856", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd5e84232f4b63d3fb56ad9be5d0fe016b075856"}], "stats": {"total": 45, "additions": 40, "deletions": 5}, "files": [{"sha": "c99f9483f0c119b9cf8d8409bcb6de46c51a907d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=98cf9ac919f9901c024e6a8e14096610beb7f7ea", "patch": "@@ -1,3 +1,14 @@\n+2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* call.c (build_new_method_call_1): Use INDIRECT_REF_P.\n+\t* cp-tree.h (REFERENCE_REF_P): Likewise.\n+\t* semantics.c (finish_offsetof): Likewise.\n+\n+2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/56130\n+\t* semantics.c (finish_id_expression): Handle deprecated references.\n+\n 2013-08-20  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/58119"}, {"sha": "f8fab0828132bc680a4c1b5c37cc8b6d9202be59", "filename": "gcc/cp/call.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=98cf9ac919f9901c024e6a8e14096610beb7f7ea", "patch": "@@ -7668,7 +7668,7 @@ build_new_method_call_1 (tree instance, tree fns, vec<tree, va_gc> **args,\n \n       if (init)\n \t{\n-\t  if (TREE_CODE (instance) == INDIRECT_REF\n+\t  if (INDIRECT_REF_P (instance)\n \t      && integer_zerop (TREE_OPERAND (instance, 0)))\n \t    return get_target_expr_sfinae (init, complain);\n \t  init = build2 (INIT_EXPR, TREE_TYPE (instance), instance, init);"}, {"sha": "3c5201f38fb5d4168ad80935615b45b1222aa292", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=98cf9ac919f9901c024e6a8e14096610beb7f7ea", "patch": "@@ -2975,7 +2975,7 @@ extern void decl_shadowed_for_var_insert (tree, tree);\n \n /* True if NODE is an implicit INDIRECT_EXPR from convert_from_reference.  */\n #define REFERENCE_REF_P(NODE)\t\t\t\t\\\n-  (TREE_CODE (NODE) == INDIRECT_REF\t\t\t\\\n+  (INDIRECT_REF_P (NODE)\t\t\t\t\\\n    && TREE_TYPE (TREE_OPERAND (NODE, 0))\t\t\\\n    && (TREE_CODE (TREE_TYPE (TREE_OPERAND ((NODE), 0)))\t\\\n        == REFERENCE_TYPE))"}, {"sha": "ee3503cdd772f9a9d6a5dc808cfb779875334d2a", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=98cf9ac919f9901c024e6a8e14096610beb7f7ea", "patch": "@@ -3457,8 +3457,10 @@ finish_id_expression (tree id_expression,\n \t}\n     }\n \n-  if (TREE_DEPRECATED (decl))\n-    warn_deprecated_use (decl, NULL_TREE);\n+  /* Handle references (c++/56130).  */\n+  tree t = REFERENCE_REF_P (decl) ? TREE_OPERAND (decl, 0) : decl;\n+  if (TREE_DEPRECATED (t))\n+    warn_deprecated_use (t, NULL_TREE);\n \n   return decl;\n }\n@@ -3691,7 +3693,7 @@ finish_offsetof (tree expr)\n       || TREE_CODE (TREE_TYPE (expr)) == METHOD_TYPE\n       || TREE_TYPE (expr) == unknown_type_node)\n     {\n-      if (TREE_CODE (expr) == INDIRECT_REF)\n+      if (INDIRECT_REF_P (expr))\n \terror (\"second operand of %<offsetof%> is neither a single \"\n \t       \"identifier nor a sequence of member accesses and \"\n \t       \"array references\");"}, {"sha": "e117f84ee7ec6544efe6f2fcb4e1ec7799510ef7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=98cf9ac919f9901c024e6a8e14096610beb7f7ea", "patch": "@@ -1,3 +1,8 @@\n+2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/56130\n+\t* g++.dg/warn/deprecated-7.C: New.\n+\n 2013-08-21  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* g++.dg/tree-prof/pr57451.C: Remove spurious dg-do directive."}, {"sha": "f564a1bb0a9d83a0e48937b6bcb12dbade263e39", "filename": "gcc/testsuite/g++.dg/warn/deprecated-7.C", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/98cf9ac919f9901c024e6a8e14096610beb7f7ea/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fdeprecated-7.C?ref=98cf9ac919f9901c024e6a8e14096610beb7f7ea", "patch": "@@ -0,0 +1,17 @@\n+// PR c++/56130\n+\n+int g_nn;\n+int& g_n __attribute__((deprecated)) = g_nn;\n+\n+void f()\n+{\n+  int f_nn;\n+  int& f_n __attribute__((deprecated)) = f_nn;\n+  f_n = 1;    // { dg-warning \"'f_n' is deprecated\" }\n+}\n+\n+int main()\n+{\n+  g_n = 1;    // { dg-warning \"'g_n' is deprecated\" }\n+  f();\n+}"}]}