{"sha": "400b8274e6992c348a822a99ef0c38290aede386", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDAwYjgyNzRlNjk5MmMzNDhhODIyYTk5ZWYwYzM4MjkwYWVkZTM4Ng==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2019-09-06T12:54:19Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2019-09-06T12:54:19Z"}, "message": "[preprocessor] Popping \"\" file names\n\nhttps://gcc.gnu.org/ml/gcc-patches/2019-08/msg02069.html\n\tNew # semantics for popping to \"\" name.\n\tlibcpp/\n\t* directives.c (do_linemarker): Popping to \"\" name means get the\n\tname from the include stack..\n\nFrom-SVN: r275457", "tree": {"sha": "15ee707e72667a7bc08d9754ef8502189f2cdc9a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/15ee707e72667a7bc08d9754ef8502189f2cdc9a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/400b8274e6992c348a822a99ef0c38290aede386", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/400b8274e6992c348a822a99ef0c38290aede386", "html_url": "https://github.com/Rust-GCC/gccrs/commit/400b8274e6992c348a822a99ef0c38290aede386", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/400b8274e6992c348a822a99ef0c38290aede386/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aff342a3c1808044323044506e0d034b55310bf1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aff342a3c1808044323044506e0d034b55310bf1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aff342a3c1808044323044506e0d034b55310bf1"}], "stats": {"total": 46, "additions": 43, "deletions": 3}, "files": [{"sha": "b999a79a466a6e7ef9bb38d07d78cde108a922a5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/400b8274e6992c348a822a99ef0c38290aede386/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/400b8274e6992c348a822a99ef0c38290aede386/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=400b8274e6992c348a822a99ef0c38290aede386", "patch": "@@ -1,3 +1,7 @@\n+2019-09-06  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* c-c++-common/cpp/line-1.c: New.\n+\n 2019-09-06  Martin Liska  <mliska@suse.cz>\n \n \tPR c++/91125"}, {"sha": "8e9c94130a1322d8e80803a51171b89eadbe8801", "filename": "gcc/testsuite/c-c++-common/cpp/line-1.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/400b8274e6992c348a822a99ef0c38290aede386/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fline-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/400b8274e6992c348a822a99ef0c38290aede386/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fline-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fcpp%2Fline-1.c?ref=400b8274e6992c348a822a99ef0c38290aede386", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do preprocess } */\n+/* { dg-additional-options -Wno-pedantic } */\n+\n+main-1 __FILE__\n+\n+# 7 \"inner.h\" 1\n+inner-1 __FILE__\n+# 9 \"inside.h\" 1\n+inside-1 __FILE__\n+# 11 \"\" 2\n+inner-2 __FILE__\n+#13 \"\" 2\n+main-2 __FILE__\n+\n+\n+/* { dg-final { scan-file line-1.i \"main-1 \\\"\\[^\\n]*line-1.c\\\"\\n\" } } */\n+/* { dg-final { scan-file line-1.i \"main-2 \\\"\\[^\\n]*line-1.c\\\"\\n\" } } */\n+/* { dg-final { scan-file line-1.i \"inner-1 \\\"inner.h\\\"\\n\" } } */\n+/* { dg-final { scan-file line-1.i \"inner-2 \\\"inner.h\\\"\\n\" } } */\n+/* { dg-final { scan-file line-1.i \"inside-1 \\\"inside.h\\\"\\n\" } } */"}, {"sha": "1ec8541a54ced8cdbd4bc321fcbd32644ab3e1ea", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/400b8274e6992c348a822a99ef0c38290aede386/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/400b8274e6992c348a822a99ef0c38290aede386/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=400b8274e6992c348a822a99ef0c38290aede386", "patch": "@@ -1,3 +1,10 @@\n+2019-08-30  Nathan Sidwell  <nathan@acm.org>\n+\n+\tNew # semantics for popping to \"\" name.\n+\tlibcpp/\n+\t* directives.c (do_linemarker): Popping to \"\" name means get the\n+\tname from the include stack..\n+\n 2019-09-05  Nathan Sidwell  <nathan@acm.org>\n \n \tPR preprocessor/91639"}, {"sha": "61f1fef94892511a6b25473e179b8a0420926a6a", "filename": "libcpp/directives.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/400b8274e6992c348a822a99ef0c38290aede386/libcpp%2Fdirectives.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/400b8274e6992c348a822a99ef0c38290aede386/libcpp%2Fdirectives.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fdirectives.c?ref=400b8274e6992c348a822a99ef0c38290aede386", "patch": "@@ -1088,16 +1088,25 @@ do_linemarker (cpp_reader *pfile)\n       map = LINEMAPS_LAST_ORDINARY_MAP (line_table);\n       const line_map_ordinary *from\n \t= linemap_included_from_linemap (line_table, map);\n-      if (MAIN_FILE_P (map)\n-\t  || (from\n-\t      && filename_cmp (ORDINARY_MAP_FILE_NAME (from), new_file) != 0))\n+\n+      if (!from)\n+\t/* Not nested.  */;\n+      else if (!new_file[0])\n+\t/* Leaving to \"\" means fill in the popped-to name.  */\n+\tnew_file = ORDINARY_MAP_FILE_NAME (from);\n+      else if (filename_cmp (ORDINARY_MAP_FILE_NAME (from), new_file) != 0)\n+\t/* It's the wrong name, Grommit!  */\n+\tfrom = NULL;\n+\n+      if (!from)\n \t{\n \t  cpp_warning (pfile, CPP_W_NONE,\n \t\t       \"file \\\"%s\\\" linemarker ignored due to \"\n \t\t       \"incorrect nesting\", new_file);\n \t  return;\n \t}\n     }\n+\n   /* Compensate for the increment in linemap_add that occurs in\n      _cpp_do_file_change.  We're currently at the start of the line\n      *following* the #line directive.  A separate location_t for this"}]}