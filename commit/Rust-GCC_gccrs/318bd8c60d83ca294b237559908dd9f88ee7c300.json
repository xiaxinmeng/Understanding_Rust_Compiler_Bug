{"sha": "318bd8c60d83ca294b237559908dd9f88ee7c300", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzE4YmQ4YzYwZDgzY2EyOTRiMjM3NTU5OTA4ZGQ5Zjg4ZWU3YzMwMA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2019-10-29T13:46:19Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2019-10-29T13:46:19Z"}, "message": "re PR tree-optimization/92260 (ICE in exact_div, at poly-int.h:2162)\n\n2019-10-29  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/92260\n\t* tree-vect-slp.c (vect_get_constant_vectors): Special-case\n\tlane-reducing ops.\n\n\t* gcc.dg/pr92260.c: New testcase.\n\nFrom-SVN: r277571", "tree": {"sha": "e7d041c184dd85ef4125c4541f0697a6fb8d5acb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e7d041c184dd85ef4125c4541f0697a6fb8d5acb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/318bd8c60d83ca294b237559908dd9f88ee7c300", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/318bd8c60d83ca294b237559908dd9f88ee7c300", "html_url": "https://github.com/Rust-GCC/gccrs/commit/318bd8c60d83ca294b237559908dd9f88ee7c300", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/318bd8c60d83ca294b237559908dd9f88ee7c300/comments", "author": null, "committer": null, "parents": [{"sha": "97c146036750e7cb3966d292572ec158a78f356e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97c146036750e7cb3966d292572ec158a78f356e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97c146036750e7cb3966d292572ec158a78f356e"}], "stats": {"total": 45, "additions": 40, "deletions": 5}, "files": [{"sha": "caaa5eeff6402a75bca730633d9c82fa6398fe99", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=318bd8c60d83ca294b237559908dd9f88ee7c300", "patch": "@@ -1,6 +1,12 @@\n+2019-10-29  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/92260\n+\t* tree-vect-slp.c (vect_get_constant_vectors): Special-case\n+\tlane-reducing ops.\n+\n 2019-10-29  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n \n-\tPR 88915\n+\tPR tree-optimization/88915\n \t* tree-ssa-loop-niter.h (simplify_replace_tree): Change declaration.\n \t* tree-ssa-loop-niter.c (simplify_replace_tree): Add context parameter\n \tand make the valueize function pointer also take a void pointer."}, {"sha": "24861e433742f72332032f95f3be288c32df5002", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=318bd8c60d83ca294b237559908dd9f88ee7c300", "patch": "@@ -1,3 +1,8 @@\n+2019-10-29  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/92260\n+\t* gcc.dg/pr92260.c: New testcase.\n+\n 2019-10-29  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/65930"}, {"sha": "3dd34763b1fce142b4d81c456c43bc13e5f36956", "filename": "gcc/testsuite/gcc.dg/pr92260.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2Ftestsuite%2Fgcc.dg%2Fpr92260.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2Ftestsuite%2Fgcc.dg%2Fpr92260.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr92260.c?ref=318bd8c60d83ca294b237559908dd9f88ee7c300", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3\" } */\n+\n+extern int abs(int);\n+int e(const unsigned char *g, long h, unsigned char m)\n+{\n+  int i = 0;\n+  for (int j = 0; j < h; j++)\n+    {\n+      for (int k = 0; k < 4; k++)\n+\ti += abs(g[k] - m);\n+      g += h;\n+    }\n+  return i;\n+}"}, {"sha": "9d65471ae70fe5d7db5e5d9ee20b89303af13be3", "filename": "gcc/tree-vect-slp.c", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2Ftree-vect-slp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/318bd8c60d83ca294b237559908dd9f88ee7c300/gcc%2Ftree-vect-slp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-slp.c?ref=318bd8c60d83ca294b237559908dd9f88ee7c300", "patch": "@@ -3395,10 +3395,19 @@ vect_get_constant_vectors (slp_tree op_node, slp_tree slp_node,\n   else\n     vector_type = get_vectype_for_scalar_type (vinfo, TREE_TYPE (op));\n \n-  unsigned int number_of_vectors\n-    = vect_get_num_vectors (SLP_TREE_NUMBER_OF_VEC_STMTS (slp_node)\n-\t\t\t    * TYPE_VECTOR_SUBPARTS (stmt_vectype),\n-\t\t\t    vector_type);\n+  /* ???  For lane-reducing ops we should also have the required number\n+     of vector stmts initialized rather than second-guessing here.  */\n+  unsigned int number_of_vectors;\n+  if (is_gimple_assign (stmt_vinfo->stmt)\n+      && (gimple_assign_rhs_code (stmt_vinfo->stmt) == SAD_EXPR\n+\t  || gimple_assign_rhs_code (stmt_vinfo->stmt) == DOT_PROD_EXPR\n+\t  || gimple_assign_rhs_code (stmt_vinfo->stmt) == WIDEN_SUM_EXPR))\n+    number_of_vectors = SLP_TREE_NUMBER_OF_VEC_STMTS (slp_node);\n+  else\n+    number_of_vectors\n+      = vect_get_num_vectors (SLP_TREE_NUMBER_OF_VEC_STMTS (slp_node)\n+\t\t\t      * TYPE_VECTOR_SUBPARTS (stmt_vectype),\n+\t\t\t      vector_type);\n   vec_oprnds->create (number_of_vectors);\n   auto_vec<tree> voprnds (number_of_vectors);\n "}]}