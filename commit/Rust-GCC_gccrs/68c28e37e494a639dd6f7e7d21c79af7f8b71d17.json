{"sha": "68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjhjMjhlMzdlNDk0YTYzOWRkNmY3ZTdkMjFjNzlhZjdmOGI3MWQxNw==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2019-11-28T18:33:20Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2019-11-28T18:33:20Z"}, "message": "re PR libfortran/90374 (Fortran 2018: Support d0.d, e0.d, es0.d, en0.d, g0.d and ew.d e0 edit descriptors for output)\n\n\tPR fortran/90374\n\t* io.c (check_format): Allow zero width expoenent with e0.\n\n\t* io/format.c (parse_format_list): Relax format checking to allow\n\te0 exponent specifier.\n\n\t* gfortran.dg/fmt_zero_width.f90: Update test.\n\nFrom-SVN: r278817", "tree": {"sha": "884fa1d2b27e695975cafb49ab647aacd5f22ba5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/884fa1d2b27e695975cafb49ab647aacd5f22ba5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/comments", "author": null, "committer": null, "parents": [{"sha": "9c28689a9908c56fffcf7b1acd6dec3fb8a947e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c28689a9908c56fffcf7b1acd6dec3fb8a947e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c28689a9908c56fffcf7b1acd6dec3fb8a947e2"}], "stats": {"total": 75, "additions": 57, "deletions": 18}, "files": [{"sha": "b2673866bee9f25e59b0be0f54e412b364f47c75", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -1,3 +1,8 @@\n+2019-11-28  Jerry DeLisle  <jvdelisle@gcc.ngu.org>\n+\n+\tPR fortran/90374\n+\t* io.c (check_format): Allow zero width expoenent with e0.\n+\n 2019-11-27  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR fortran/91944"}, {"sha": "8cf8c2d96af09bff9902e9e76d67f5504c5ae21f", "filename": "gcc/fortran/io.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ffortran%2Fio.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ffortran%2Fio.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fio.c?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -1007,9 +1007,22 @@ check_format (bool is_input)\n \t    goto fail;\n \t  if (u != FMT_POSINT)\n \t    {\n-\t      error = G_(\"Positive exponent width required in format string \"\n-\t\t\t \"at %L\");\n-\t      goto syntax;\n+\t      if (u == FMT_ZERO)\n+\t\t{\n+\t\t  if (!gfc_notify_std (GFC_STD_F2018,\n+\t\t\t\t      \"Positive exponent width required in \"\n+\t\t\t\t      \"format string at %L\", &format_locus))\n+\t\t    {\n+\t\t      saved_token = u;\n+\t\t      goto fail;\n+\t\t    }\n+\t\t}\n+\t      else\n+\t\t{\n+\t\t  error = G_(\"Positive exponent width required in format \"\n+\t\t\t     \"string at %L\");\n+\t\t  goto syntax;\n+\t\t}\n \t    }\n \t}\n "}, {"sha": "65e7ffc3c23d25ef0e9cfecd6691000164ddd613", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -1,3 +1,8 @@\n+2019-11-28  Jerry DeLisle  <jvdelisle@gcc.ngu.org>\n+\n+\tPR fortran/90374\n+\t* gfortran.dg/fmt_zero_width.f90: Update test.\n+\n 2019-11-28  Martin Jambor  <mjambor@suse.cz>\n \n \tPR ipa/92697"}, {"sha": "640b6735c65a72774528cc1924a3a23854356a29", "filename": "gcc/testsuite/gfortran.dg/fmt_zero_width.f90", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_zero_width.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_zero_width.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffmt_zero_width.f90?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -1,11 +1,11 @@\n ! { dg-do run }\n ! PR90374 \"5.5 d0.d, e0.d, es0.d, en0.d, g0.d and ew.d edit descriptors\n program pr90374\n+  implicit none\n   real(4) :: rn\n   character(32) :: afmt, aresult\n-  real(8) :: one = 1.0D0, zero = 0.0D0, nan, pinf, minf\n+  real(8) :: one = 1.0D0, zero = 0.0D0, pinf, minf\n \n-  nan = zero/zero\n   rn = 0.00314_4\n   afmt = \"(D0.3)\"\n   write (aresult,fmt=afmt) rn\n@@ -22,15 +22,19 @@ program pr90374\n   afmt = \"(G0.10)\"\n   write (aresult,fmt=afmt) rn\n   if (aresult /= \"0.3139999928E-02\") stop 24\n+  afmt = \"(E0.10e0)\"\n+  write (aresult,fmt=afmt) rn\n+  if (aresult /= \"0.3139999928E-02\") stop 27\n   write (aresult,fmt=\"(D0.3)\") rn\n-  if (aresult /= \"0.314D-02\") stop 26\n+  if (aresult /= \"0.314D-02\") stop 29\n   write (aresult,fmt=\"(E0.10)\") rn\n-  if (aresult /= \"0.3139999928E-02\") stop 28\n+  if (aresult /= \"0.3139999928E-02\") stop 31\n   write (aresult,fmt=\"(ES0.10)\") rn\n-  if (aresult /= \"3.1399999280E-03\") stop 30\n+  if (aresult /= \"3.1399999280E-03\") stop 33\n   write (aresult,fmt=\"(EN0.10)\") rn\n-  if (aresult /= \"3.1399999280E-03\") stop 32\n+  if (aresult /= \"3.1399999280E-03\") stop 35\n   write (aresult,fmt=\"(G0.10)\") rn\n-  if (aresult /= \"0.3139999928E-02\") stop 34\n-\n+  if (aresult /= \"0.3139999928E-02\") stop 37\n+  write (aresult,fmt=\"(E0.10e0)\") rn\n+  if (aresult /= \"0.3139999928E-02\") stop 39\n end"}, {"sha": "74e36acd1d9bdee2a45b706519d114ca202944f7", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -1,7 +1,13 @@\n+2019-11-28  Jerry DeLisle  <jvdelisle@gcc.ngu.org>\n+\n+\tPR fortran/90374\n+\t* io/format.c (parse_format_list): Relax format checking to allow\n+\te0 exponent specifier.\n+\n 2019-11-24  Jerry DeLisle  <jvdelisle@gcc.ngu.org>\n \n \tPR fortran/92100\n-\tio/transfer.c (data_transfer_init_worker): Use fbuf_reset\n+\t* io/transfer.c (data_transfer_init_worker): Use fbuf_reset\n \tinstead of fbuf_flush before the seek. Note that fbuf_reset\n \tcalls fbuf_flush and adjusts fbuf pointers.\n "}, {"sha": "dd448c83e87134250d660ab525013e92ee249e1d", "filename": "libgfortran/io/format.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/libgfortran%2Fio%2Fformat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/libgfortran%2Fio%2Fformat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fformat.c?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -1027,11 +1027,17 @@ parse_format_list (st_parameter_dt *dtp, bool *seen_dd)\n \t{\n \t  t = format_lex (fmt);\n \t  if (t != FMT_POSINT)\n-\t    {\n-\t      fmt->error = \"Positive exponent width required in format\";\n-\t      goto finished;\n-\t    }\n-\n+\t    if (t == FMT_ZERO)\n+\t      {\n+\t\tnotify_std (&dtp->common, GFC_STD_F2018,\n+\t\t\t    \"Positive exponent width required\");\n+\t      }\n+\t    else\n+\t      {\n+\t\tfmt->error = \"Positive exponent width required in \"\n+\t\t\t     \"format string at %L\";\n+\t\tgoto finished;\n+\t      }\n \t  tail->u.real.e = fmt->value;\n \t}\n "}, {"sha": "ce6aec8311479e8665526c0a4e7ce519a311c8e8", "filename": "libgfortran/io/write_float.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/libgfortran%2Fio%2Fwrite_float.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/68c28e37e494a639dd6f7e7d21c79af7f8b71d17/libgfortran%2Fio%2Fwrite_float.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fwrite_float.def?ref=68c28e37e494a639dd6f7e7d21c79af7f8b71d17", "patch": "@@ -482,7 +482,7 @@ build_float_string (st_parameter_dt *dtp, const fnode *f, char *buffer,\n       for (i = abs (e); i >= 10; i /= 10)\n \tedigits++;\n \n-      if (f->u.real.e < 0)\n+      if (f->u.real.e <= 0)\n \t{\n \t  /* Width not specified.  Must be no more than 3 digits.  */\n \t  if (e > 999 || e < -999)"}]}