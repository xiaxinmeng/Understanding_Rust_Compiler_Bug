{"sha": "9b09e453c6884f2ea391dc70c188c159f0883150", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWIwOWU0NTNjNjg4NGYyZWEzOTFkYzcwYzE4OGMxNTlmMDg4MzE1MA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2018-12-19T14:20:33Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-12-19T14:20:33Z"}, "message": "[testsuite] Add scan-offload-rtl-dump\n\nAdd scan-offload-rtl-dump, similar to scan-offload-tree-dump.\n\nBuild and reg-tested on x86_64 with nvptx accelerator.\n\n2018-12-19  Tom de Vries  <tom@codesourcery.com>\n\n\t* lib/scanoffloadrtl.exp: New file.\n\t* gcc.dg-selftests/dg-final.exp (dg_final_directive_check_num_args): Add\n\toffload-rtl.\n\n\t* doc/sourcebuild.texi (Commands for use in dg-final, Scan optimization\n\tdump files): Add offload-rtl.\n\nFrom-SVN: r267266", "tree": {"sha": "49184fb196d89d04f65b2d7ac5a2fbcb9befdc9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/49184fb196d89d04f65b2d7ac5a2fbcb9befdc9c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b09e453c6884f2ea391dc70c188c159f0883150", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b09e453c6884f2ea391dc70c188c159f0883150", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b09e453c6884f2ea391dc70c188c159f0883150", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b09e453c6884f2ea391dc70c188c159f0883150/comments", "author": null, "committer": null, "parents": [{"sha": "dc355223e465d3a2c090f34afd2ce965d20de199", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc355223e465d3a2c090f34afd2ce965d20de199", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc355223e465d3a2c090f34afd2ce965d20de199"}], "stats": {"total": 165, "additions": 163, "deletions": 2}, "files": [{"sha": "597dca78773785b376a26d25e7eaf4444cc073ce", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9b09e453c6884f2ea391dc70c188c159f0883150", "patch": "@@ -1,3 +1,8 @@\n+2018-12-19  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* doc/sourcebuild.texi (Commands for use in dg-final, Scan optimization\n+\tdump files): Add offload-rtl.\n+\n 2018-12-19  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \tPR target/88213"}, {"sha": "46ef388e109bea5a8a50349a39c886127ffa9733", "filename": "gcc/doc/sourcebuild.texi", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Fdoc%2Fsourcebuild.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Fdoc%2Fsourcebuild.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fsourcebuild.texi?ref=9b09e453c6884f2ea391dc70c188c159f0883150", "patch": "@@ -2644,7 +2644,8 @@ assembly output.\n @subsubsection Scan optimization dump files\n \n These commands are available for @var{kind} of @code{tree}, @code{ltrans-tree},\n-@code{offload-tree}, @code{rtl}, @code{ipa}, and @code{wpa-ipa}.\n+@code{offload-tree}, @code{rtl}, @code{offload-rtl}, @code{ipa}, and\n+@code{wpa-ipa}.\n \n @table @code\n @item scan-@var{kind}-dump @var{regex} @var{suffix} [@{ target/xfail @var{selector} @}]"}, {"sha": "8f1353465c331c3f420e4e6318dba188b7e98f6d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9b09e453c6884f2ea391dc70c188c159f0883150", "patch": "@@ -1,3 +1,9 @@\n+2018-12-19  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* lib/scanoffloadrtl.exp: New file.\n+\t* gcc.dg-selftests/dg-final.exp (dg_final_directive_check_num_args): Add\n+\toffload-rtl.\n+\n 2018-12-19  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/88533"}, {"sha": "90a6e894abdae4e876f8b6884a7ddb4151cc7147", "filename": "gcc/testsuite/gcc.dg-selftests/dg-final.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Ftestsuite%2Fgcc.dg-selftests%2Fdg-final.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Ftestsuite%2Fgcc.dg-selftests%2Fdg-final.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg-selftests%2Fdg-final.exp?ref=9b09e453c6884f2ea391dc70c188c159f0883150", "patch": "@@ -25,6 +25,7 @@ load_lib \"scanasm.exp\"\n load_lib \"scanwpaipa.exp\"\n load_lib \"scanltranstree.exp\"\n load_lib \"scanoffloadtree.exp\"\n+load_lib \"scanoffloadrtl.exp\"\n load_lib \"gcc-dg.exp\"\n \n proc verify_call_1 { args } {\n@@ -82,7 +83,8 @@ proc dg_final_directive_check_num_args {} {\n \tverify_call $proc_name $too_few \"too few arguments\"\n     }\n \n-    foreach kind [list \"tree\" \"rtl\" \"ipa\" \"ltrans-tree\" \"wpa-ipa\" \"offload-tree\"] {\n+    foreach kind [list \"tree\" \"rtl\" \"ipa\" \"ltrans-tree\" \"wpa-ipa\" \\\n+\t\t      \"offload-tree\" \"offload-rtl\"] {\n \tverify_args scan-$kind-dump 2 3\n \tverify_args scan-$kind-dump-times 3 4\n \tverify_args scan-$kind-dump-not 2 3"}, {"sha": "e836f6d27bb2e624a7ce5378ae0d5c59dbcdaffe", "filename": "gcc/testsuite/lib/scanoffloadrtl.exp", "status": "added", "additions": 147, "deletions": 0, "changes": 147, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Ftestsuite%2Flib%2Fscanoffloadrtl.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b09e453c6884f2ea391dc70c188c159f0883150/gcc%2Ftestsuite%2Flib%2Fscanoffloadrtl.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fscanoffloadrtl.exp?ref=9b09e453c6884f2ea391dc70c188c159f0883150", "patch": "@@ -0,0 +1,147 @@\n+#   Copyright (C) 2018 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+# \n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+# \n+# You should have received a copy of the GNU General Public License\n+# along with GCC; see the file COPYING3.  If not see\n+# <http://www.gnu.org/licenses/>.\n+\n+# Various utilities for scanning offloading rtl dump output, used by\n+# libgomp.exp.\n+\n+load_lib scandump.exp\n+\n+# Utility for scanning compiler result, invoked via dg-final.\n+# Call pass if pattern is present, otherwise fail.\n+#\n+# Argument 0 is the regexp to match\n+# Argument 1 is the name of the dumped rtl pass\n+# Argument 2 handles expected failures and the like\n+proc scan-offload-rtl-dump { args } {\n+\n+    if { [llength $args] < 2 } {\n+\terror \"scan-offload-rtl-dump: too few arguments\"\n+\treturn\n+    }\n+    if { [llength $args] > 3 } {\n+\terror \"scan-offload-rtl-dump: too many arguments\"\n+\treturn\n+    }\n+    if { [llength $args] >= 3 } {\n+\tscan-dump \"offload-rtl\" [lindex $args 0] \\\n+\t\t  \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\" \\\n+\t\t  [lindex $args 2]\n+    } else {\n+\tscan-dump \"offload-rtl\" [lindex $args 0] \\\n+\t\t  \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\"\n+    }\n+}\n+\n+# Call pass if pattern is present given number of times, otherwise fail.\n+# Argument 0 is the regexp to match\n+# Argument 1 is number of times the regexp must be found\n+# Argument 2 is the name of the dumped rtl pass\n+# Argument 3 handles expected failures and the like\n+proc scan-offload-rtl-dump-times { args } {\n+\n+    if { [llength $args] < 3 } {\n+\terror \"scan-offload-rtl-dump-times: too few arguments\"\n+\treturn\n+    }\n+    if { [llength $args] > 4 } {\n+\terror \"scan-offload-rtl-dump-times: too many arguments\"\n+\treturn\n+    }\n+    if { [llength $args] >= 4 } {\n+\tscan-dump-times \"offload-rtl\" [lindex $args 0] [lindex $args 1] \\\n+\t\t\t\"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 2]\" \".o\" \\\n+\t\t\t[lindex $args 3]\n+    } else {\n+\tscan-dump-times \"offload-rtl\" [lindex $args 0] [lindex $args 1] \\\n+\t\t\t\"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 2]\" \".o\"\n+    }\n+}\n+\n+# Call pass if pattern is not present, otherwise fail.\n+#\n+# Argument 0 is the regexp to match\n+# Argument 1 is the name of the dumped rtl pass\n+# Argument 2 handles expected failures and the like\n+proc scan-offload-rtl-dump-not { args } {\n+\n+    if { [llength $args] < 2 } {\n+\terror \"scan-offload-rtl-dump-not: too few arguments\"\n+\treturn\n+    }\n+    if { [llength $args] > 3 } {\n+\terror \"scan-offload-rtl-dump-not: too many arguments\"\n+\treturn\n+    }\n+    if { [llength $args] >= 3 } {\n+\tscan-dump-not \"offload-rtl\" [lindex $args 0] \\\n+\t\t      \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\" \\\n+\t\t      [lindex $args 2]\n+    } else {\n+\tscan-dump-not \"offload-rtl\" [lindex $args 0] \\\n+\t\t      \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\"\n+    }\n+}\n+\n+# Utility for scanning demangled compiler result, invoked via dg-final.\n+# Call pass if pattern is present, otherwise fail.\n+#\n+# Argument 0 is the regexp to match\n+# Argument 1 is the name of the dumped rtl pass\n+# Argument 2 handles expected failures and the like\n+proc scan-offload-rtl-dump-dem { args } {\n+\n+    if { [llength $args] < 2 } {\n+\terror \"scan-offload-rtl-dump-dem: too few arguments\"\n+\treturn\n+    }\n+    if { [llength $args] > 3 } {\n+\terror \"scan-offload-rtl-dump-dem: too many arguments\"\n+\treturn\n+    }\n+    if { [llength $args] >= 3 } {\n+\tscan-dump-dem \"offload-rtl\" [lindex $args 0] \\\n+\t\t      \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\" \\\n+\t\t      [lindex $args 2]\n+    } else {\n+\tscan-dump-dem \"offload-rtl\" [lindex $args 0] \\\n+\t\t      \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\"\n+    }\n+}\n+\n+# Call pass if demangled pattern is not present, otherwise fail.\n+#\n+# Argument 0 is the regexp to match\n+# Argument 1 is the name of the dumped rtl pass\n+# Argument 2 handles expected failures and the like\n+proc scan-offload-rtl-dump-dem-not { args } {\n+\n+    if { [llength $args] < 2 } {\n+\terror \"scan-offload-rtl-dump-dem-not: too few arguments\"\n+\treturn\n+    }\n+    if { [llength $args] > 3 } {\n+\terror \"scan-offload-rtl-dump-dem-not: too many arguments\"\n+\treturn\n+    }\n+    if { [llength $args] >= 3 } {\n+\tscan-dump-dem-not \"offload-rtl\" [lindex $args 0] \\\n+\t\t\t  \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\" \\\n+\t\t\t  [lindex $args 2]\n+    } else {\n+\tscan-dump-dem-not \"offload-rtl\" [lindex $args 0] \\\n+\t\t\t  \"\\[0-9\\]\\[0-9\\]\\[0-9]r.[lindex $args 1]\" \".o\"\n+    }\n+}"}]}