{"sha": "755634e60252de3270554fd06c222da98128c3ac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzU1NjM0ZTYwMjUyZGUzMjcwNTU0ZmQwNmMyMjJkYTk4MTI4YzNhYw==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2012-10-31T21:55:50Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2012-10-31T21:55:50Z"}, "message": "re PR fortran/53718 ([OOP] gfortran generates asm label twice in the same output file)\n\n2012-10-31  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/53718\n\t* trans.h (GFC_DECL_PUSH_TOPLEVEL): Removed.\n\t* trans-decl.c (gfc_get_symbol_decl,gfc_generate_function_code): Remove\n\tGFC_DECL_PUSH_TOPLEVEL.\n\t(build_function_decl): Do not push __copy procedure to toplevel.\n\n2012-10-31  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/53718\n\t* gfortran.dg/class_54.f90: New.\n\nFrom-SVN: r193048", "tree": {"sha": "b6e33fd27397f05e68dceaea242adf1b7842646d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b6e33fd27397f05e68dceaea242adf1b7842646d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/755634e60252de3270554fd06c222da98128c3ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/755634e60252de3270554fd06c222da98128c3ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/755634e60252de3270554fd06c222da98128c3ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/755634e60252de3270554fd06c222da98128c3ac/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "03b06a83441cac588cf04f494915ffd3868a9bed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03b06a83441cac588cf04f494915ffd3868a9bed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03b06a83441cac588cf04f494915ffd3868a9bed"}], "stats": {"total": 49, "additions": 38, "deletions": 11}, "files": [{"sha": "8e3e728610cc982b09947f025e8e1f86a2172d1e", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=755634e60252de3270554fd06c222da98128c3ac", "patch": "@@ -1,3 +1,11 @@\n+2012-10-31  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/53718\n+\t* trans.h (GFC_DECL_PUSH_TOPLEVEL): Removed.\n+\t* trans-decl.c (gfc_get_symbol_decl,gfc_generate_function_code): Remove\n+\tGFC_DECL_PUSH_TOPLEVEL.\n+\t(build_function_decl): Do not push __copy procedure to toplevel.\n+\n 2012-10-31  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/55134"}, {"sha": "77502170c3cd60f3edb8f05a167cf1f3eb41b357", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=755634e60252de3270554fd06c222da98128c3ac", "patch": "@@ -1488,10 +1488,7 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n \n   if (sym->attr.vtab\n       || (sym->name[0] == '_' && strncmp (\"__def_init\", sym->name, 10) == 0))\n-    {\n-      TREE_READONLY (decl) = 1;\n-      GFC_DECL_PUSH_TOPLEVEL (decl) = 1;\n-    }\n+    TREE_READONLY (decl) = 1;\n \n   return decl;\n }\n@@ -1923,8 +1920,7 @@ build_function_decl (gfc_symbol * sym, bool global)\n   /* Layout the function declaration and put it in the binding level\n      of the current function.  */\n \n-  if (global\n-      || (sym->name[0] == '_' && strncmp (\"__copy\", sym->name, 6) == 0))\n+  if (global)\n     pushdecl_top_level (fndecl);\n   else\n     pushdecl (fndecl);\n@@ -5425,10 +5421,7 @@ gfc_generate_function_code (gfc_namespace * ns)\n \n       next = DECL_CHAIN (decl);\n       DECL_CHAIN (decl) = NULL_TREE;\n-      if (GFC_DECL_PUSH_TOPLEVEL (decl))\n-\tpushdecl_top_level (decl);\n-      else\n-\tpushdecl (decl);\n+      pushdecl (decl);\n       decl = next;\n     }\n   saved_function_decls = NULL_TREE;"}, {"sha": "652893ee60c013815d7c56046d53858dd6fe10e1", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=755634e60252de3270554fd06c222da98128c3ac", "patch": "@@ -824,7 +824,6 @@ struct GTY((variable_size)) lang_decl {\n #define GFC_DECL_CRAY_POINTEE(node) DECL_LANG_FLAG_4(node)\n #define GFC_DECL_RESULT(node) DECL_LANG_FLAG_5(node)\n #define GFC_DECL_SUBREF_ARRAY_P(node) DECL_LANG_FLAG_6(node)\n-#define GFC_DECL_PUSH_TOPLEVEL(node) DECL_LANG_FLAG_7(node)\n #define GFC_DECL_CLASS(node) DECL_LANG_FLAG_8(node)\n \n /* An array descriptor.  */"}, {"sha": "77a4eaaf726892b8be328434ea1e529f1bbb2f64", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=755634e60252de3270554fd06c222da98128c3ac", "patch": "@@ -1,3 +1,8 @@\n+2012-10-31  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/53718\n+\t* gfortran.dg/class_54.f90: New.\n+\n 2012-10-31  Steven Bosscher  <steven@gcc.gnu.org>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "39c306c83d07a478d30bd56f0ba57397a7134540", "filename": "gcc/testsuite/gfortran.dg/class_54.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_54.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/755634e60252de3270554fd06c222da98128c3ac/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_54.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_54.f90?ref=755634e60252de3270554fd06c222da98128c3ac", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do compile }\n+!\n+! PR 53718: [4.7/4.8 regression] [OOP] gfortran generates asm label twice in the same output file\n+!\n+! Contributed by Adrian Prantl <adrian@llnl.gov>\n+\n+module m\n+  type t\n+  end type\n+end module\n+\n+subroutine sub1\n+  use m\n+  class(t), pointer :: a1\n+end subroutine\n+\n+subroutine sub2\n+  use m\n+  class(t), pointer :: a2\n+end subroutine\n+\n+! { dg-final { cleanup-modules \"m\" } }"}]}