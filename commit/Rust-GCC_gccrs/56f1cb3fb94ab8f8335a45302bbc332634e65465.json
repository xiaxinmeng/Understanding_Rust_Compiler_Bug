{"sha": "56f1cb3fb94ab8f8335a45302bbc332634e65465", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTZmMWNiM2ZiOTRhYjhmODMzNWE0NTMwMmJiYzMzMjYzNGU2NTQ2NQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-04-10T12:37:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-04-10T12:37:36Z"}, "message": "re PR target/85177 (wrong code with -O -fno-tree-ccp -fno-tree-sra -mavx512f)\n\n\tPR target/85177\n\tPR target/85255\n\t* config/i386/sse.md\n\t(<extract_type>_vinsert<shuffletype><extract_suf>_mask): Fix\n\tcomputation of the VEC_MERGE selector from mask.\n\t(<extract_type>_vinsert<shuffletype><extract_suf>_1<mask_name>):\n\tFix decoding of the VEC_MERGE selector into mask.\n\n\t* gcc.target/i386/avx512f-pr85177.c: New test.\n\t* gcc.target/i386/avx512f-pr85255.c: New test.\n\nFrom-SVN: r259269", "tree": {"sha": "e79b0c1b74e78f39352dd2843d10bc7d604f3a71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e79b0c1b74e78f39352dd2843d10bc7d604f3a71"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/56f1cb3fb94ab8f8335a45302bbc332634e65465", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56f1cb3fb94ab8f8335a45302bbc332634e65465", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56f1cb3fb94ab8f8335a45302bbc332634e65465", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56f1cb3fb94ab8f8335a45302bbc332634e65465/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eb38d071636da1ea2d0f9a068c86c7ceee2634b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb38d071636da1ea2d0f9a068c86c7ceee2634b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb38d071636da1ea2d0f9a068c86c7ceee2634b2"}], "stats": {"total": 88, "additions": 79, "deletions": 9}, "files": [{"sha": "c339cf975e5f32ca2c03c41a0b3a91d1de1aa8a8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=56f1cb3fb94ab8f8335a45302bbc332634e65465", "patch": "@@ -1,3 +1,13 @@\n+2018-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/85177\n+\tPR target/85255\n+\t* config/i386/sse.md\n+\t(<extract_type>_vinsert<shuffletype><extract_suf>_mask): Fix\n+\tcomputation of the VEC_MERGE selector from mask.\n+\t(<extract_type>_vinsert<shuffletype><extract_suf>_1<mask_name>):\n+\tFix decoding of the VEC_MERGE selector into mask.\n+\n 2018-04-10  Richard Sandiford  <richard.sandiford@linaro.org>\n \n \tPR tree-optimization/85286"}, {"sha": "caca42d9e0d46aab70b75f0586a6bc15b3c157b2", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=56f1cb3fb94ab8f8335a45302bbc332634e65465", "patch": "@@ -12627,11 +12627,11 @@\n    (match_operand:<avx512fmaskmode> 5 \"register_operand\")]\n   \"TARGET_AVX512F\"\n {\n-  int mask,selector;\n+  int mask, selector;\n   mask = INTVAL (operands[3]);\n-  selector = GET_MODE_UNIT_SIZE (<MODE>mode) == 4 ?\n-    0xFFFF ^ (0xF000 >> mask * 4)\n-    : 0xFF ^ (0xC0 >> mask * 2);\n+  selector = (GET_MODE_UNIT_SIZE (<MODE>mode) == 4\n+  \t      ? 0xFFFF ^ (0x000F << mask * 4)\n+\t      : 0xFF ^ (0x03 << mask * 2));\n   emit_insn (gen_<extract_type>_vinsert<shuffletype><extract_suf>_1_mask\n     (operands[0], operands[1], operands[2], GEN_INT (selector),\n      operands[4], operands[5]));\n@@ -12650,16 +12650,16 @@\n   int mask;\n   int selector = INTVAL (operands[3]);\n \n-  if (selector == 0xFFF || selector == 0x3F)\n+  if (selector == (GET_MODE_UNIT_SIZE (<MODE>mode) == 4 ? 0xFFF0 : 0xFC))\n     mask = 0;\n-  else if ( selector == 0xF0FF || selector == 0xCF)\n+  else if (selector == (GET_MODE_UNIT_SIZE (<MODE>mode) == 4 ? 0xFF0F : 0xF3))\n     mask = 1;\n-  else if ( selector == 0xFF0F || selector == 0xF3)\n+  else if (selector == (GET_MODE_UNIT_SIZE (<MODE>mode) == 4 ? 0xF0FF : 0xCF))\n     mask = 2;\n-  else if ( selector == 0xFFF0 || selector == 0xFC)\n+  else if (selector == (GET_MODE_UNIT_SIZE (<MODE>mode) == 4 ? 0x0FFF : 0x3F))\n     mask = 3;\n   else\n-      gcc_unreachable ();\n+    gcc_unreachable ();\n \n   operands[3] = GEN_INT (mask);\n "}, {"sha": "1d68b755932f0609218e016997785b0958784f49", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=56f1cb3fb94ab8f8335a45302bbc332634e65465", "patch": "@@ -1,3 +1,10 @@\n+2018-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/85177\n+\tPR target/85255\n+\t* gcc.target/i386/avx512f-pr85177.c: New test.\n+\t* gcc.target/i386/avx512f-pr85255.c: New test.\n+\n 2018-04-10  Richard Sandiford  <richard.sandiford@linaro.org>\n \n \tPR tree-optimization/85286"}, {"sha": "ab74927016cb4f2a5fa058b837bd2f104273d5e6", "filename": "gcc/testsuite/gcc.target/i386/avx512f-pr85177.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85177.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85177.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85177.c?ref=56f1cb3fb94ab8f8335a45302bbc332634e65465", "patch": "@@ -0,0 +1,30 @@\n+/* PR target/85177 */\n+/* { dg-do run { target { avx512f && int128 } } } */\n+/* { dg-options \"-O -fno-tree-ccp -fno-tree-sra -mavx512f -mno-avx512bw\" } */\n+\n+#include \"avx512f-check.h\"\n+\n+typedef short U __attribute__ ((vector_size (64)));\n+typedef __int128 V __attribute__ ((vector_size (64)));\n+\n+static inline __attribute__((always_inline)) U\n+foo (int i, U u)\n+{\n+  u[i & 1] = 1;\n+  return u;\n+}\n+\n+__attribute__((noipa)) int\n+bar ()\n+{\n+  V x = (V) foo (0, (U) { });\n+  for (unsigned i = 0; i < 4; i++)\n+    if (x[i] != (i == 0)) __builtin_abort ();\n+  return 0;\n+}\n+\n+static void\n+avx512f_test (void)\n+{\n+  bar ();\n+}"}, {"sha": "caaec14f58385a1dd446497d93936b7f41475938", "filename": "gcc/testsuite/gcc.target/i386/avx512f-pr85255.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85255.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56f1cb3fb94ab8f8335a45302bbc332634e65465/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85255.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85255.c?ref=56f1cb3fb94ab8f8335a45302bbc332634e65465", "patch": "@@ -0,0 +1,23 @@\n+/* PR target/85255 */\n+/* { dg-do run { target { avx512f } } } */\n+/* { dg-options \"-O2 -fno-tree-fre -mavx512f\" } */\n+\n+#include \"avx512f-check.h\"\n+\n+typedef short V __attribute__ ((vector_size (64)));\n+\n+V\n+foo (V v)\n+{\n+  v[v[1]] = 0;\n+  return v;\n+}\n+\n+static void\n+avx512f_test (void)\n+{\n+  V v = foo ((V) { 1 });\n+  for (unsigned i = 0; i < 32; i++)\n+    if (v[i] != 0)\n+      __builtin_abort ();\n+}"}]}