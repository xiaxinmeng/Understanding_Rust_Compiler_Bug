{"sha": "79f40de682c23a73b99efa0be50bfb2d13869f8f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzlmNDBkZTY4MmMyM2E3M2I5OWVmYTBiZTUwYmZiMmQxMzg2OWY4Zg==", "commit": {"author": {"name": "Daniel Franke", "email": "franke.daniel@gmail.com", "date": "2008-01-24T21:36:14Z"}, "committer": {"name": "Daniel Franke", "email": "dfranke@gcc.gnu.org", "date": "2008-01-24T21:36:14Z"}, "message": "re PR fortran/33375 (ICE (segfault) gfortran.dg/common_6.f90)\n\n2008-01-24  Daniel Franke  <franke.daniel@gmail.com>\n\n        PR fortran/33375\n        PR fortran/34858\n        * gfortran.h: Revert changes from 2008-01-17.\n        * match.c: Likewise.\n        * symbol.c: Likewise.\n        (gfc_undo_symbols): Undo namespace changes related to common blocks.\n\nFrom-SVN: r131811", "tree": {"sha": "002aa4e5c6d655e2dca2be8b456e05e85aacd7c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/002aa4e5c6d655e2dca2be8b456e05e85aacd7c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79f40de682c23a73b99efa0be50bfb2d13869f8f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79f40de682c23a73b99efa0be50bfb2d13869f8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79f40de682c23a73b99efa0be50bfb2d13869f8f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79f40de682c23a73b99efa0be50bfb2d13869f8f/comments", "author": {"login": "dfranke76", "id": 15729164, "node_id": "MDQ6VXNlcjE1NzI5MTY0", "avatar_url": "https://avatars.githubusercontent.com/u/15729164?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfranke76", "html_url": "https://github.com/dfranke76", "followers_url": "https://api.github.com/users/dfranke76/followers", "following_url": "https://api.github.com/users/dfranke76/following{/other_user}", "gists_url": "https://api.github.com/users/dfranke76/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfranke76/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfranke76/subscriptions", "organizations_url": "https://api.github.com/users/dfranke76/orgs", "repos_url": "https://api.github.com/users/dfranke76/repos", "events_url": "https://api.github.com/users/dfranke76/events{/privacy}", "received_events_url": "https://api.github.com/users/dfranke76/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7c8d27031551bc95dd08a0a22d78da2f15c9b528", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c8d27031551bc95dd08a0a22d78da2f15c9b528", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c8d27031551bc95dd08a0a22d78da2f15c9b528"}], "stats": {"total": 49, "additions": 41, "deletions": 8}, "files": [{"sha": "8d705f8e97f9683a9349a2da80f7015890d4ae5c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=79f40de682c23a73b99efa0be50bfb2d13869f8f", "patch": "@@ -1,3 +1,12 @@\n+2008-01-24  Daniel Franke  <franke.daniel@gmail.com>\n+\n+\tPR fortran/33375\n+\tPR fortran/34858\n+\t* gfortran.h: Revert changes from 2008-01-17.\n+\t* match.c: Likewise.\n+\t* symbol.c: Likewise.\n+\t(gfc_undo_symbols): Undo namespace changes related to common blocks.\n+\n 2008-01-24  Daniel Franke  <franke.daniel@gmail.com>\n \n \tPR fortran/34202"}, {"sha": "aac1f821334c0f184350c6cfa1d7e761eb3b01aa", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=79f40de682c23a73b99efa0be50bfb2d13869f8f", "patch": "@@ -2137,7 +2137,6 @@ int gfc_symbols_could_alias (gfc_symbol *, gfc_symbol *);\n void gfc_undo_symbols (void);\n void gfc_commit_symbols (void);\n void gfc_commit_symbol (gfc_symbol *);\n-void gfc_free_common_tree (gfc_symtree *);\n void gfc_free_namespace (gfc_namespace *);\n \n void gfc_symbol_init_2 (void);"}, {"sha": "ad636f93f3d6709e8a25a65e4914251f2dce7589", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=79f40de682c23a73b99efa0be50bfb2d13869f8f", "patch": "@@ -2951,8 +2951,6 @@ gfc_match_common (void)\n   return MATCH_YES;\n \n syntax:\n-  gfc_free_common_tree (gfc_current_ns->common_root);\n-  gfc_current_ns->common_root = NULL;\n   gfc_syntax_error (ST_COMMON);\n \n cleanup:"}, {"sha": "a802fa16dc8c05000432fc42c1f0c46aad23a9f7", "filename": "gcc/fortran/symbol.c", "status": "modified", "additions": 32, "deletions": 5, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2Fsymbol.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79f40de682c23a73b99efa0be50bfb2d13869f8f/gcc%2Ffortran%2Fsymbol.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsymbol.c?ref=79f40de682c23a73b99efa0be50bfb2d13869f8f", "patch": "@@ -2582,6 +2582,33 @@ gfc_undo_symbols (void)\n       if (p->new)\n \t{\n \t  /* Symbol was new.  */\n+\t  if (p->attr.in_common && p->common_block->head)\n+\t    {\n+\t      /* If the symbol was added to any common block, it\n+\t\t needs to be removed to stop the resolver looking\n+\t\t for a (possibly) dead symbol.  */\n+\n+\t      if (p->common_block->head == p)\n+\t        p->common_block->head = p->common_next;\n+\t      else\n+\t\t{\n+\t\t  gfc_symbol *cparent, *csym;\n+\n+\t\t  cparent = p->common_block->head;\n+\t\t  csym = cparent->common_next;\n+\n+\t\t  while (csym != p)\n+\t\t    {\n+\t\t      cparent = csym;\n+\t\t      csym = csym->common_next;\n+\t\t    }\n+\n+\t\t  gcc_assert(cparent->common_next == p);\n+\n+\t\t  cparent->common_next = csym->common_next;\n+\t\t}\n+\t    }\n+\n \t  delete_symtree (&p->ns->sym_root, p->name);\n \n \t  p->refs--;\n@@ -2726,14 +2753,14 @@ gfc_commit_symbol (gfc_symbol *sym)\n /* Recursive function that deletes an entire tree and all the common\n    head structures it points to.  */\n \n-void\n-gfc_free_common_tree (gfc_symtree * common_tree)\n+static void\n+free_common_tree (gfc_symtree * common_tree)\n {\n   if (common_tree == NULL)\n     return;\n \n-  gfc_free_common_tree (common_tree->left);\n-  gfc_free_common_tree (common_tree->right);\n+  free_common_tree (common_tree->left);\n+  free_common_tree (common_tree->right);\n \n   gfc_free (common_tree);\n }  \n@@ -2863,7 +2890,7 @@ gfc_free_namespace (gfc_namespace *ns)\n \n   free_sym_tree (ns->sym_root);\n   free_uop_tree (ns->uop_root);\n-  gfc_free_common_tree (ns->common_root);\n+  free_common_tree (ns->common_root);\n \n   for (cl = ns->cl_list; cl; cl = cl2)\n     {"}]}