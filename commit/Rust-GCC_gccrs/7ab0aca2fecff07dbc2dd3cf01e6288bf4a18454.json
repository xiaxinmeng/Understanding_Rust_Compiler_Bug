{"sha": "7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2FiMGFjYTJmZWNmZjA3ZGJjMmRkM2NmMDFlNjI4OGJmNGExODQ1NA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2007-02-12T18:46:16Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2007-02-12T18:46:16Z"}, "message": "calls.c (emit_library_call_value_1): If PROMOTE_MODE modifed the result mode of the libcall, convert back to outmode.\n\n        * calls.c (emit_library_call_value_1): If PROMOTE_MODE modifed the\n        result mode of the libcall, convert back to outmode.\n\nFrom-SVN: r121852", "tree": {"sha": "6185ee35e148de63968ad0243f38271e107885d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6185ee35e148de63968ad0243f38271e107885d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454/comments", "author": null, "committer": null, "parents": [{"sha": "d8d25baea642cfd4e4bcb4d4b9e3f2b12921ffac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8d25baea642cfd4e4bcb4d4b9e3f2b12921ffac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8d25baea642cfd4e4bcb4d4b9e3f2b12921ffac"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "e23a321898a9bf52ecb83b9e01f1d6160e6e1b2d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454", "patch": "@@ -1,3 +1,8 @@\n+2007-02-12  Richard Henderson  <rth@redhat.com>\n+\n+\t* calls.c (emit_library_call_value_1): If PROMOTE_MODE modifed the\n+\tresult mode of the libcall, convert back to outmode.\n+\n 2007-02-12  Roger Sayle  <roger@eyesopen.com>\n \n \t* config/i386/i386.md (*bswapdi2_rex): Renamed from bswapdi2."}, {"sha": "1f8ed60bf12cf1a02ec919809d61ca539f7feddc", "filename": "gcc/calls.c", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454/gcc%2Fcalls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454/gcc%2Fcalls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.c?ref=7ab0aca2fecff07dbc2dd3cf01e6288bf4a18454", "patch": "@@ -3916,10 +3916,25 @@ emit_library_call_value_1 (int retval, rtx orgfun, rtx value,\n \t    value = gen_reg_rtx (outmode);\n \t  emit_group_store (value, valreg, NULL_TREE, GET_MODE_SIZE (outmode));\n \t}\n-      else if (value != 0)\n-\temit_move_insn (value, valreg);\n       else\n-\tvalue = valreg;\n+\t{\n+\t  /* Convert to the proper mode if PROMOTE_MODE has been active.  */\n+\t  if (GET_MODE (valreg) != outmode)\n+\t    {\n+\t      int unsignedp = TYPE_UNSIGNED (tfom);\n+\n+\t      gcc_assert (targetm.calls.promote_function_return (tfom));\n+\t      gcc_assert (promote_mode (tfom, outmode, &unsignedp, 0)\n+\t\t\t  == GET_MODE (valreg));\n+\n+\t      valreg = convert_modes (outmode, GET_MODE (valreg), valreg, 0);\n+\t    }\n+\n+\t  if (value != 0)\n+\t    emit_move_insn (value, valreg);\n+\t  else\n+\t    value = valreg;\n+\t}\n     }\n \n   if (ACCUMULATE_OUTGOING_ARGS)"}]}