{"sha": "b8435aa9450e6c3b222eab7f1fa875f6238c2b99", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjg0MzVhYTk0NTBlNmMzYjIyMmVhYjdmMWZhODc1ZjYyMzhjMmI5OQ==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2012-11-05T19:46:31Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2012-11-05T19:46:31Z"}, "message": "mode-switching.c (create_pre_exit): Force late switching if __builtin_{apply,return} emitted a load that require...\n\n\t* mode-switching.c (create_pre_exit): Force late switching if\n\t__builtin_{apply,return} emitted a load that require mode,\n\tother than MODE_EXIT.\n\n\nCo-Authored-By: Vladimir Yakovlev <vladimir.b.yakovlev@intel.com>\n\nFrom-SVN: r193182", "tree": {"sha": "033e1f770ad19a6394eaed9b596b3483d80fd1bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/033e1f770ad19a6394eaed9b596b3483d80fd1bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b8435aa9450e6c3b222eab7f1fa875f6238c2b99", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8435aa9450e6c3b222eab7f1fa875f6238c2b99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8435aa9450e6c3b222eab7f1fa875f6238c2b99", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8435aa9450e6c3b222eab7f1fa875f6238c2b99/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "935ec36fdd9f1ebdb32baf7c1d94ac4e390d26c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/935ec36fdd9f1ebdb32baf7c1d94ac4e390d26c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/935ec36fdd9f1ebdb32baf7c1d94ac4e390d26c6"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "0d20017906e3a0f2f91c28292718c8560c5bbba1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8435aa9450e6c3b222eab7f1fa875f6238c2b99/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8435aa9450e6c3b222eab7f1fa875f6238c2b99/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b8435aa9450e6c3b222eab7f1fa875f6238c2b99", "patch": "@@ -1,3 +1,10 @@\n+2012-11-05  Uros Bizjak  <ubizjak@gmail.com>\n+\t    Vladimir Yakovlev  <vladimir.b.yakovlev@intel.com>\n+\n+\t* mode-switching.c (create_pre_exit): Force late switching if\n+\t__builtin_{apply,return} emitted a load that require mode,\n+\tother than MODE_EXIT.\n+\n 2012-11-05  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \tPR target/55204"}, {"sha": "2f7455a033ca492f01e06662d8b16ba5d7d5c6be", "filename": "gcc/mode-switching.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8435aa9450e6c3b222eab7f1fa875f6238c2b99/gcc%2Fmode-switching.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8435aa9450e6c3b222eab7f1fa875f6238c2b99/gcc%2Fmode-switching.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmode-switching.c?ref=b8435aa9450e6c3b222eab7f1fa875f6238c2b99", "patch": "@@ -1,6 +1,6 @@\n /* CPU mode switching\n    Copyright (C) 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2007, 2008,\n-   2009, 2010 Free Software Foundation, Inc.\n+   2009, 2010, 2012  Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -342,6 +342,16 @@ create_pre_exit (int n_entities, int *entity_map, const int *num_modes)\n \t\t      }\n \t\t    if (j >= 0)\n \t\t      {\n+\t\t\t/* __builtin_return emits a sequence of loads to all\n+\t\t\t   return registers.  One of them might require\n+\t\t\t   another mode than MODE_EXIT, even if it is\n+\t\t\t   unrelated to the return value, so we want to put\n+\t\t\t   the final mode switch after it.  */\n+\t\t\tif (maybe_builtin_apply\n+\t\t\t    && targetm.calls.function_value_regno_p\n+\t\t\t        (copy_start))\n+\t\t\t  forced_late_switch = 1;\n+\n \t\t\t/* For the SH4, floating point loads depend on fpscr,\n \t\t\t   thus we might need to put the final mode switch\n \t\t\t   after the return value copy.  That is still OK,"}]}