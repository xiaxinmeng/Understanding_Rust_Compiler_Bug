{"sha": "1622229cb182906d9375ccbb6dd6672b9cb017da", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTYyMjIyOWNiMTgyOTA2ZDkzNzVjY2JiNmRkNjY3MmI5Y2IwMTdkYQ==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2003-07-16T19:05:53Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2003-07-16T19:05:53Z"}, "message": "Partial Fix PR/10129\n\n2003-07-17  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        Partial Fix PR/10129\n        * config/darwin.c (machopic_function_base_name): Only Return \"<pic base>\".\n        (machopic_output_function_base_name): New; print the true pic label.\n        (machopic_classify_ident): Pic Base is always a defined data.\n        * config/darwin.h (ASM_OUTPUT_LABELREF): Support the pic base label.\n        * config/darwin-proto.h (machopic_output_function_base_name): Prototype.\n\nFrom-SVN: r69472", "tree": {"sha": "764c34de1b929602e5ba4745ef412025e5a8a134", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/764c34de1b929602e5ba4745ef412025e5a8a134"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1622229cb182906d9375ccbb6dd6672b9cb017da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1622229cb182906d9375ccbb6dd6672b9cb017da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1622229cb182906d9375ccbb6dd6672b9cb017da", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1622229cb182906d9375ccbb6dd6672b9cb017da/comments", "author": null, "committer": null, "parents": [{"sha": "db2f435beacd8e9e9f07616c5806acb518ff821c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db2f435beacd8e9e9f07616c5806acb518ff821c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db2f435beacd8e9e9f07616c5806acb518ff821c"}], "stats": {"total": 72, "additions": 40, "deletions": 32}, "files": [{"sha": "5a893d24b95ee92e38d4cce81156f6e9dd520f68", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1622229cb182906d9375ccbb6dd6672b9cb017da", "patch": "@@ -1,3 +1,12 @@\n+2003-07-17  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPartial Fix PR/10129\n+\t* config/darwin.c (machopic_function_base_name): Only Return \"<pic base>\".\n+\t(machopic_output_function_base_name): New; print the true pic label.\n+\t(machopic_classify_ident): Pic Base is always a defined data.\n+\t* config/darwin.h (ASM_OUTPUT_LABELREF): Support the pic base label.\n+\t* config/darwin-proto.h (machopic_output_function_base_name): Prototype.\n+\n 2003-07-16  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \t* gcse.c (gcse_constant_p): COMPARE of the same registers is a constant"}, {"sha": "f17f5ab81968d2ca3136dc15185ad7273ec71bab", "filename": "gcc/config/darwin-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2Fconfig%2Fdarwin-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2Fconfig%2Fdarwin-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-protos.h?ref=1622229cb182906d9375ccbb6dd6672b9cb017da", "patch": "@@ -23,6 +23,7 @@ extern int name_needs_quotes PARAMS ((const char *));\n extern void machopic_validate_stub_or_non_lazy_ptr PARAMS ((const char *, int));\n \n extern const char *machopic_function_base_name PARAMS ((void));\n+extern void machopic_output_function_base_name (FILE *);\n extern const char *machopic_non_lazy_ptr_name PARAMS ((const char*));\n extern const char *machopic_stub_name PARAMS ((const char*));\n "}, {"sha": "ab438ecfc1750de250cff907d4b68c0887039cb4", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 27, "deletions": 31, "changes": 58, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=1622229cb182906d9375ccbb6dd6672b9cb017da", "patch": "@@ -81,6 +81,10 @@ machopic_classify_ident (ident)\n \t\t     && name[4] == 'C'\n \t\t     && name[5] == '_'));\n   tree temp;\n+  \n+  /* The PIC base symbol is always defined. */\n+  if (! strcmp (name, \"<pic base>\"))\n+    return MACHOPIC_DEFINED_DATA;\n \n   if (name[0] != '!')\n     {\n@@ -218,54 +222,46 @@ machopic_define_name (name)\n   machopic_define_ident (get_identifier (name));\n }\n \n-/* This is a static to make inline functions work.  The rtx\n-   representing the PIC base symbol always points to here.  \n-\n-   FIXME: The rest of the compiler doesn't expect strings to change.  */\n-\n static GTY(()) char * function_base;\n-static GTY(()) const char * function_base_func_name;\n-static GTY(()) int current_pic_label_num;\n \n const char *\n machopic_function_base_name ()\n {\n   const char *current_name;\n-\n   /* if dynamic-no-pic is on, we should not get here */\n   if (MACHO_DYNAMIC_NO_PIC_P)\n     abort ();\n   current_name = \n     IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (current_function_decl));\n \n-  if (function_base_func_name != current_name)\n-    {\n-      current_function_uses_pic_offset_table = 1;\n+  if (function_base == NULL)\n+    function_base = \n+      (char *) ggc_alloc_string (\"<pic base>\", sizeof (\"<pic base>\"));\n \n-      /* Save mucho space and time.  Some of the C++ mangled names are over\n-\t 700 characters long!  Note that we produce a label containing a '-'\n-\t if the function we're compiling is an Objective-C method, as evinced\n-\t by the incredibly scientific test below.  This is because code in\n-\t rs6000.c makes the same ugly test when loading the PIC reg.  */\n- \n-      /* It's hard to describe just how ugly this is.  The reason for\n-         the '%011d' is that after a PCH load, we can't change the\n-         size of the string, because PCH will have uniqued it and\n-         allocated it in the string pool.  */\n-      if (function_base == NULL)\n-\tfunction_base = \n-\t  (char *) ggc_alloc_string (\"\", sizeof (\"*\\\"L12345678901$pb\\\"\"));\n+  current_function_uses_pic_offset_table = 1;\n \n-      ++current_pic_label_num;\n-      if (*current_name == '+' || *current_name == '-')\n-\tsprintf (function_base, \"*\\\"L-%010d$pb\\\"\", current_pic_label_num);\n-      else\n-\tsprintf (function_base, \"*\\\"L%011d$pb\\\"\", current_pic_label_num);\n+  return function_base;\n+}\n+\n+static GTY(()) const char * function_base_func_name;\n+static GTY(()) int current_pic_label_num;\n+\n+void\n+machopic_output_function_base_name (FILE *file)\n+{\n+  const char *current_name;\n \n+  /* If dynamic-no-pic is on, we should not get here. */\n+  if (MACHO_DYNAMIC_NO_PIC_P)\n+    abort ();\n+  current_name = \n+    IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (current_function_decl));\n+  if (function_base_func_name != current_name)\n+    {\n+      ++current_pic_label_num;\n       function_base_func_name = current_name;\n     }\n-\n-  return function_base;\n+  fprintf (file, \"\\\"L%011d$pb\\\"\", current_pic_label_num);\n }\n \n static GTY(()) tree machopic_non_lazy_pointers;"}, {"sha": "4f9b487fc8c51f754e831ca4bb2795739264dde0", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1622229cb182906d9375ccbb6dd6672b9cb017da/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=1622229cb182906d9375ccbb6dd6672b9cb017da", "patch": "@@ -396,7 +396,9 @@ do { text_section ();\t\t\t\t\t\t\t\\\n #define ASM_OUTPUT_LABELREF(FILE,NAME)\t\t\t\t\t     \\\n   do {\t\t\t\t\t\t\t\t\t     \\\n        const char *xname = darwin_strip_name_encoding (NAME);\t\t     \\\n-       if (xname[0] == '&' || xname[0] == '*')\t\t\t\t     \\\n+       if (! strcmp (xname, \"<pic base>\"))\t\t\t\t     \\\n+         machopic_output_function_base_name(FILE);                           \\\n+       else if (xname[0] == '&' || xname[0] == '*')\t\t\t     \\\n          {\t\t\t\t\t\t\t\t     \\\n            int len = strlen (xname);\t\t\t\t\t     \\\n \t   if (len > 6 && !strcmp (\"$stub\", xname + len - 5))\t\t     \\"}]}