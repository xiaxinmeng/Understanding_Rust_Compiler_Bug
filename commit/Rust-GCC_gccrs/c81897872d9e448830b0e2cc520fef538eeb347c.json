{"sha": "c81897872d9e448830b0e2cc520fef538eeb347c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzgxODk3ODcyZDllNDQ4ODMwYjBlMmNjNTIwZmVmNTM4ZWViMzQ3Yw==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2015-11-11T11:21:44Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2015-11-11T11:21:44Z"}, "message": "Fix various memory leaks\n\n\t* gimple-ssa-strength-reduction.c (create_phi_basis):\n\tUse auto_vec.\n\t* passes.c (release_dump_file_name): New function.\n\t(pass_init_dump_file): Used from this function.\n\t(pass_fini_dump_file): Likewise.\n\t* tree-sra.c (convert_callers_for_node): Use xstrdup_for_dump.\n\t* var-tracking.c (vt_initialize): Use pool_allocator.\n\nFrom-SVN: r230152", "tree": {"sha": "276c81537cf38e77f5739edf73cfe3a5bcddd2d0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/276c81537cf38e77f5739edf73cfe3a5bcddd2d0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c81897872d9e448830b0e2cc520fef538eeb347c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c81897872d9e448830b0e2cc520fef538eeb347c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c81897872d9e448830b0e2cc520fef538eeb347c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c81897872d9e448830b0e2cc520fef538eeb347c/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c0ab1970b9dd6e652eda830294f18d6456a3117e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0ab1970b9dd6e652eda830294f18d6456a3117e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0ab1970b9dd6e652eda830294f18d6456a3117e"}], "stats": {"total": 38, "additions": 28, "deletions": 10}, "files": [{"sha": "13ed0d8256c768e6934f8044e6f43720c6949533", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c81897872d9e448830b0e2cc520fef538eeb347c", "patch": "@@ -1,3 +1,13 @@\n+2015-11-11  Martin Liska  <mliska@suse.cz>\n+\n+\t* gimple-ssa-strength-reduction.c (create_phi_basis):\n+\tUse auto_vec.\n+\t* passes.c (release_dump_file_name): New function.\n+\t(pass_init_dump_file): Used from this function.\n+\t(pass_fini_dump_file): Likewise.\n+\t* tree-sra.c (convert_callers_for_node): Use xstrdup_for_dump.\n+\t* var-tracking.c (vt_initialize): Use pool_allocator.\n+\n 2015-11-11  Richard Biener  <rguenth@gcc.gnu.org>\n \t    Jiong Wang\t    <jiong.wang@arm.com>\n "}, {"sha": "b8078230f340241b030f48a6fade564a22859b40", "filename": "gcc/gimple-ssa-strength-reduction.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Fgimple-ssa-strength-reduction.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Fgimple-ssa-strength-reduction.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-strength-reduction.c?ref=c81897872d9e448830b0e2cc520fef538eeb347c", "patch": "@@ -2226,12 +2226,11 @@ create_phi_basis (slsr_cand_t c, gimple *from_phi, tree basis_name,\n   int i;\n   tree name, phi_arg;\n   gphi *phi;\n-  vec<tree> phi_args;\n   slsr_cand_t basis = lookup_cand (c->basis);\n   int nargs = gimple_phi_num_args (from_phi);\n   basic_block phi_bb = gimple_bb (from_phi);\n   slsr_cand_t phi_cand = base_cand_from_table (gimple_phi_result (from_phi));\n-  phi_args.create (nargs);\n+  auto_vec<tree> phi_args (nargs);\n \n   /* Process each argument of the existing phi that represents\n      conditionally-executed add candidates.  */"}, {"sha": "dd8d00ad36af11ad728a2adf975d326acc6d716e", "filename": "gcc/passes.c", "status": "modified", "additions": 14, "deletions": 5, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Fpasses.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Fpasses.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpasses.c?ref=c81897872d9e448830b0e2cc520fef538eeb347c", "patch": "@@ -2058,6 +2058,18 @@ verify_curr_properties (function *fn, void *data)\n   gcc_assert ((fn->curr_properties & props) == props);\n }\n \n+/* Release dump file name if set.  */\n+\n+static void\n+release_dump_file_name (void)\n+{\n+  if (dump_file_name)\n+    {\n+      free (CONST_CAST (char *, dump_file_name));\n+      dump_file_name = NULL;\n+    }\n+}\n+\n /* Initialize pass dump file.  */\n /* This is non-static so that the plugins can use it.  */\n \n@@ -2071,6 +2083,7 @@ pass_init_dump_file (opt_pass *pass)\n       gcc::dump_manager *dumps = g->get_dumps ();\n       bool initializing_dump =\n \t!dumps->dump_initialized_p (pass->static_pass_number);\n+      release_dump_file_name ();\n       dump_file_name = dumps->get_dump_file_name (pass->static_pass_number);\n       dumps->dump_start (pass->static_pass_number, &dump_flags);\n       if (dump_file && current_function_decl)\n@@ -2098,11 +2111,7 @@ pass_fini_dump_file (opt_pass *pass)\n   timevar_push (TV_DUMP);\n \n   /* Flush and close dump file.  */\n-  if (dump_file_name)\n-    {\n-      free (CONST_CAST (char *, dump_file_name));\n-      dump_file_name = NULL;\n-    }\n+  release_dump_file_name ();\n \n   g->get_dumps ()->dump_finish (pass->static_pass_number);\n   timevar_pop (TV_DUMP);"}, {"sha": "2835c993588bc73491d193e105109172d95cd5ae", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=c81897872d9e448830b0e2cc520fef538eeb347c", "patch": "@@ -4996,9 +4996,9 @@ convert_callers_for_node (struct cgraph_node *node,\n \n       if (dump_file)\n \tfprintf (dump_file, \"Adjusting call %s/%i -> %s/%i\\n\",\n-\t\t xstrdup (cs->caller->name ()),\n+\t\t xstrdup_for_dump (cs->caller->name ()),\n \t\t cs->caller->order,\n-\t\t xstrdup (cs->callee->name ()),\n+\t\t xstrdup_for_dump (cs->callee->name ()),\n \t\t cs->callee->order);\n \n       ipa_modify_call_arguments (cs, cs->call_stmt, *adjustments);"}, {"sha": "9185bfd39cf5c033ecf77a16a8894f36a1d52490", "filename": "gcc/var-tracking.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Fvar-tracking.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c81897872d9e448830b0e2cc520fef538eeb347c/gcc%2Fvar-tracking.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvar-tracking.c?ref=c81897872d9e448830b0e2cc520fef538eeb347c", "patch": "@@ -9814,7 +9814,7 @@ vt_initialize (void)\n \n   alloc_aux_for_blocks (sizeof (variable_tracking_info));\n \n-  empty_shared_hash = new shared_hash;\n+  empty_shared_hash = shared_hash_pool.allocate ();\n   empty_shared_hash->refcount = 1;\n   empty_shared_hash->htab = new variable_table_type (1);\n   changed_variables = new variable_table_type (10);"}]}