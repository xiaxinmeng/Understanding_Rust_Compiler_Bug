{"sha": "29421402b7e58876daa370f41f8162ea80dbee5b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjk0MjE0MDJiN2U1ODg3NmRhYTM3MGY0MWY4MTYyZWE4MGRiZWU1Yg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "1994-08-03T15:13:59Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "1994-08-03T15:13:59Z"}, "message": "Various changes to avoid clobbering glibc header files\n\nFrom-SVN: r7854", "tree": {"sha": "d7673065724e7993a353e45d50e5dcc0bc474683", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d7673065724e7993a353e45d50e5dcc0bc474683"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29421402b7e58876daa370f41f8162ea80dbee5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29421402b7e58876daa370f41f8162ea80dbee5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29421402b7e58876daa370f41f8162ea80dbee5b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29421402b7e58876daa370f41f8162ea80dbee5b/comments", "author": null, "committer": null, "parents": [{"sha": "8e0ac43b334f6d5851dd7eb9fceff79ab404cdeb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e0ac43b334f6d5851dd7eb9fceff79ab404cdeb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e0ac43b334f6d5851dd7eb9fceff79ab404cdeb"}], "stats": {"total": 45, "additions": 28, "deletions": 17}, "files": [{"sha": "daf5daa203dd5619ebed86d7864e692fe6e2a2f8", "filename": "gcc/fixincludes", "status": "modified", "additions": 28, "deletions": 17, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29421402b7e58876daa370f41f8162ea80dbee5b/gcc%2Ffixincludes", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29421402b7e58876daa370f41f8162ea80dbee5b/gcc%2Ffixincludes", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffixincludes?ref=29421402b7e58876daa370f41f8162ea80dbee5b", "patch": "@@ -317,7 +317,8 @@ while [ $# != 0 ]; do\n \t\t#undef NULL\n \t' $2/$file > $2/$file.\n \tmv $2/$file. $2/$file\n-\tif cmp $file $2/$file >/dev/null 2>&1; then\n+\tif cmp $file $2/$file >/dev/null 2>&1 \\\n+\t    || egrep 'This file is part of the GNU C Library' $2/$file >/dev/null 2>&1; then\n \t   rm $2/$file\n \telse\n \t   echo Fixed $file\n@@ -1191,8 +1192,12 @@ fi\n if [ -r ${LIB}/$file ]; then\n   echo Fixing $file, use of va_list\n   # Arrange for stdio.h to use stdarg.h to define __gnuc_va_list\n-  (echo \"#define __need___va_list\"\n-   echo \"#include <stdarg.h>\") > ${LIB}/${file}.sed\n+  if egrep \"__need___va_list\" ${LIB}/$file >/dev/null 2>&1; then\n+    touch ${LIB}/${file}.sed\n+  else\n+    (echo \"#define __need___va_list\"\n+     echo \"#include <stdarg.h>\") > ${LIB}/${file}.sed\n+  fi\n   # Use __gnuc_va_list in arg types in place of va_list.\n   # On 386BSD use __gnuc_va_list instead of _VA_LIST_. We're hoping the\n   # trailing parentheses and semicolon save all other systems from this.\n@@ -1204,9 +1209,10 @@ if [ -r ${LIB}/$file ]; then\n       -e 's@ va_list@ __va_list__@' \\\n       -e 's@\\*va_list@*__va_list__@' \\\n       -e 's@ __va_list)@ __gnuc_va_list)@' \\\n+      -e 's@GNUC_VA_LIST@GNUC_Va_LIST@' \\\n       -e 's@_NEED___VA_LIST@_NEED___Va_LIST@' \\\n       -e 's@VA_LIST@DUMMY_VA_LIST@' \\\n-      -e 's@_NEED___Va_LIST@_NEED___VA_LIST@' \\\n+      -e 's@_Va_LIST@_VA_LIST@' \\\n     ${LIB}/$file >> ${LIB}/${file}.sed\n   \n   rm -f ${LIB}/$file; mv ${LIB}/${file}.sed ${LIB}/$file\n@@ -1633,7 +1639,8 @@ if [ -r $file ] && [ ! -r ${LIB}/$file ]; then\n fi\n \n if [ -r ${LIB}/$file ]; then\n-  if egrep '\"C\"' ${LIB}/$file >/dev/null 2>/dev/null; then\n+  if egrep '\"C\"' ${LIB}/$file >/dev/null 2>&1 \\\n+     || egrep '__BEGIN_DECLS' ${LIB}/$file >/dev/null 2>&1; then\n     true\n   else\n     echo Fixing $file\n@@ -1713,18 +1720,22 @@ fi\n # Put cpp wrappers around these include files to avoid redeclaration\n # errors during multiple inclusion on m88k-tektronix-sysv3.\n for file in time.h sys/time.h ; do\n-  if [ -r $file ] && [ ! -r ${LIB}/$file ]; then\n-    cp $file ${LIB}/$file >/dev/null 2>&1 || echo \"Can't copy $file\"\n-    chmod +w ${LIB}/$file 2>/dev/null\n-  fi\n-  if [ -r ${LIB}/$file ]; then\n-    echo Fixing $file, to protect against multiple inclusion.\n-    cpp_wrapper=`echo $file | sed -e 's,\\.,_,g' -e 's,/,_,g'`\n-    (echo \"#ifndef __GCC_GOT_${cpp_wrapper}_\"\n-    echo \"#define __GCC_GOT_${cpp_wrapper}_\"\n-    cat ${LIB}/${file}\n-    echo '#endif /* !_GCC_GOT_'${cpp_wrapper}_' */')  > ${LIB}/${file}.new\n-    rm -f ${LIB}/$file; mv ${LIB}/${file}.new ${LIB}/$file\n+  if egrep '#ifndef' $file >/dev/null 2>&1; then\n+    true\n+  else\n+    if [ -r $file ] && [ ! -r ${LIB}/$file ]; then\n+      cp $file ${LIB}/$file >/dev/null 2>&1 || echo \"Can't copy $file\"\n+      chmod +w ${LIB}/$file 2>/dev/null\n+    fi\n+    if [ -r ${LIB}/$file ]; then\n+      echo Fixing $file, to protect against multiple inclusion.\n+      cpp_wrapper=`echo $file | sed -e 's,\\.,_,g' -e 's,/,_,g'`\n+      (echo \"#ifndef __GCC_GOT_${cpp_wrapper}_\"\n+      echo \"#define __GCC_GOT_${cpp_wrapper}_\"\n+      cat ${LIB}/${file}\n+      echo '#endif /* !_GCC_GOT_'${cpp_wrapper}_' */')  > ${LIB}/${file}.new\n+      rm -f ${LIB}/$file; mv ${LIB}/${file}.new ${LIB}/$file\n+    fi\n   fi\n done\n "}]}