{"sha": "358dab90186b30a5d287710f13625c327210218d", "node_id": "C_kwDOANBUbNoAKDM1OGRhYjkwMTg2YjMwYTVkMjg3NzEwZjEzNjI1YzMyNzIxMDIxOGQ", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-11-22T00:08:17Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-11-22T00:08:17Z"}, "message": "analyzer: fix ICE on writes to errno [PR107777]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/107777\n\t* call-summary.cc\n\t(call_summary_replay::convert_region_from_summary_1): Handle\n\tRK_THREAD_LOCAL and RK_ERRNO in switch.\n\t* region-model.cc (region_model::get_representative_path_var_1):\n\tLikewise.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/107777\n\t* gcc.dg/analyzer/call-summaries-errno.c: New test.\n\t* gcc.dg/analyzer/errno-pr107777.c: New test.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "f96c5076d49e9aa376dc52bed758f27aa80d88fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f96c5076d49e9aa376dc52bed758f27aa80d88fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/358dab90186b30a5d287710f13625c327210218d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/358dab90186b30a5d287710f13625c327210218d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/358dab90186b30a5d287710f13625c327210218d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/358dab90186b30a5d287710f13625c327210218d/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9ada45967b4cf543aa47091e99a760d0718013cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ada45967b4cf543aa47091e99a760d0718013cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ada45967b4cf543aa47091e99a760d0718013cc"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "4c4694b53815f45f65b7453d7bc900d1dfa00c2c", "filename": "gcc/analyzer/call-summary.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/358dab90186b30a5d287710f13625c327210218d/gcc%2Fanalyzer%2Fcall-summary.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/358dab90186b30a5d287710f13625c327210218d/gcc%2Fanalyzer%2Fcall-summary.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fcall-summary.cc?ref=358dab90186b30a5d287710f13625c327210218d", "patch": "@@ -575,13 +575,15 @@ call_summary_replay::convert_region_from_summary_1 (const region *summary_reg)\n     case RK_CODE:\n     case RK_STACK:\n     case RK_HEAP:\n+    case RK_THREAD_LOCAL:\n     case RK_ROOT:\n       /* These should never be pointed to by a region_svalue.  */\n       gcc_unreachable ();\n \n     case RK_FUNCTION:\n     case RK_LABEL:\n     case RK_STRING:\n+    case RK_ERRNO:\n     case RK_UNKNOWN:\n       /* We can reuse these regions directly.  */\n       return summary_reg;"}, {"sha": "1d5b09a68059c638c7c2d08bec5b7df01e262aaa", "filename": "gcc/analyzer/region-model.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/358dab90186b30a5d287710f13625c327210218d/gcc%2Fanalyzer%2Fregion-model.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/358dab90186b30a5d287710f13625c327210218d/gcc%2Fanalyzer%2Fregion-model.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fregion-model.cc?ref=358dab90186b30a5d287710f13625c327210218d", "patch": "@@ -4754,6 +4754,7 @@ region_model::get_representative_path_var_1 (const region *reg,\n     case RK_CODE:\n     case RK_HEAP:\n     case RK_STACK:\n+    case RK_THREAD_LOCAL:\n     case RK_ROOT:\n        /* Regions that represent memory spaces are not expressible as trees.  */\n       return path_var (NULL_TREE, 0);\n@@ -4873,6 +4874,7 @@ region_model::get_representative_path_var_1 (const region *reg,\n       }\n \n     case RK_VAR_ARG:\n+    case RK_ERRNO:\n     case RK_UNKNOWN:\n       return path_var (NULL_TREE, 0);\n     }"}, {"sha": "e4333b30bb773ccbdd25514fb6956f22cff2ba81", "filename": "gcc/testsuite/gcc.dg/analyzer/call-summaries-errno.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/358dab90186b30a5d287710f13625c327210218d/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fcall-summaries-errno.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/358dab90186b30a5d287710f13625c327210218d/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fcall-summaries-errno.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fcall-summaries-errno.c?ref=358dab90186b30a5d287710f13625c327210218d", "patch": "@@ -0,0 +1,17 @@\n+/* { dg-additional-options \"-fanalyzer-call-summaries\" } */\n+\n+#include <errno.h>\n+#include \"analyzer-decls.h\"\n+\n+void sets_errno (int x)\n+{\n+  errno = x;\n+}\n+\n+void test_sets_errno (int y)\n+{\n+  sets_errno (y);\n+  sets_errno (y);\n+\n+  __analyzer_eval (errno == y); /* { dg-warning \"TRUE\" } */  \n+}"}, {"sha": "65687393657b48f68a779ea44d4d7958ab39ce31", "filename": "gcc/testsuite/gcc.dg/analyzer/errno-pr107777.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/358dab90186b30a5d287710f13625c327210218d/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ferrno-pr107777.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/358dab90186b30a5d287710f13625c327210218d/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ferrno-pr107777.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ferrno-pr107777.c?ref=358dab90186b30a5d287710f13625c327210218d", "patch": "@@ -0,0 +1,20 @@\n+int *\n+__errno_location (void);\n+\n+long int\n+read (int, void *, unsigned long int);\n+\n+struct IOBUF {\n+  int fd;\n+};\n+\n+void\n+do_getline_end_data (struct IOBUF *iop, int tree)\n+{\n+  char end_data;\n+\n+  if (tree)\n+    *__errno_location () = 0;\n+\n+  read (iop->fd, &end_data, sizeof end_data);\n+}"}]}