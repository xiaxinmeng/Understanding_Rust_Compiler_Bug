{"sha": "344bd5a86133fcdff69396d9cc526317630c0f70", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzQ0YmQ1YTg2MTMzZmNkZmY2OTM5NmQ5Y2M1MjYzMTc2MzBjMGY3MA==", "commit": {"author": {"name": "Andrew Pinski", "email": "andrew_pinski@playstation.sony.com", "date": "2007-03-15T01:27:29Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2007-03-15T01:27:29Z"}, "message": "re PR c++/31165 (Error: symbol `an_empty_string' is already defined)\n\n2007-03-14  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n\n        PR c++/31165\n        * call.c  (convert_default_arg): Instead of copying the node,\n        unshare it.\n2007-03-14  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n\n        PR C++/31165\n        * g++.dg/other/default7.C: New test.\n\nFrom-SVN: r122941", "tree": {"sha": "40387ede534231616a096b2529605fffa90afb24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/40387ede534231616a096b2529605fffa90afb24"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/344bd5a86133fcdff69396d9cc526317630c0f70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/344bd5a86133fcdff69396d9cc526317630c0f70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/344bd5a86133fcdff69396d9cc526317630c0f70", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/344bd5a86133fcdff69396d9cc526317630c0f70/comments", "author": null, "committer": null, "parents": [{"sha": "22cbc70726b96dbdc4b5fee428af20843423190a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22cbc70726b96dbdc4b5fee428af20843423190a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22cbc70726b96dbdc4b5fee428af20843423190a"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "7d10b2da8ed6937bf1debf6aebea5479b0ce3874", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=344bd5a86133fcdff69396d9cc526317630c0f70", "patch": "@@ -1,3 +1,9 @@\n+2007-03-14  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n+\n+\tPR c++/31165\n+\t* call.c  (convert_default_arg): Instead of copying the node,\n+\tunshare it.\n+\n 2007-03-15  Dirk Mueller  <dmueller@suse.de>\n \n \tPR c++/30860"}, {"sha": "9d25298e7ddf6ff0a0d2fc04b44e62f3007cfacc", "filename": "gcc/cp/call.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=344bd5a86133fcdff69396d9cc526317630c0f70", "patch": "@@ -4683,7 +4683,7 @@ convert_default_arg (tree type, tree arg, tree fn, int parmnum)\n \t VAR_DECL.  We can avoid the copy for constants, since they\n \t are never modified in place.  */\n       if (!CONSTANT_CLASS_P (arg))\n-\targ = copy_node (arg);\n+\targ = unshare_expr (arg);\n       arg = convert_for_initialization (0, type, arg, LOOKUP_NORMAL,\n \t\t\t\t\t\"default argument\", fn, parmnum);\n       arg = convert_for_arg_passing (type, arg);"}, {"sha": "47d977040397c0e66ed6ec04aa1b325034cd9e6a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=344bd5a86133fcdff69396d9cc526317630c0f70", "patch": "@@ -1,3 +1,8 @@\n+2007-03-14  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n+\n+\tPR C++/31165\n+\t* g++.dg/other/default7.C: New test.\n+\n 2007-03-15  Dirk Mueller  <dmueller@suse.de>\n \n \t* g++.dg/warn/Wconversion2.C: New."}, {"sha": "ec523bf8901f052f6d2a64172e30e3f0cd241c81", "filename": "gcc/testsuite/g++.dg/other/default7.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdefault7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/344bd5a86133fcdff69396d9cc526317630c0f70/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdefault7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fdefault7.C?ref=344bd5a86133fcdff69396d9cc526317630c0f70", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do assemble } */\n+/* { dg-options \"-O1\" }*/\n+// This was PR C++/31165\n+// We used to copy the whole decl when we just wantted to\n+// unshare some expressions for the default argument.\n+class string {\n+  char *ptr;\n+  int len;\n+  int sz;\n+};\n+class cset { }  _cset_init;\n+string an_empty_string;\n+void f(string& = an_empty_string);\n+void\n+h (void )\n+{\n+f();\n+}\n+\n+"}]}