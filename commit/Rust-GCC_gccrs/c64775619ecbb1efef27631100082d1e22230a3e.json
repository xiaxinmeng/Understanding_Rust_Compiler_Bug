{"sha": "c64775619ecbb1efef27631100082d1e22230a3e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzY0Nzc1NjE5ZWNiYjFlZmVmMjc2MzExMDAwODJkMWUyMjIzMGEzZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-02-05T16:21:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-02-05T16:21:36Z"}, "message": "re PR target/89188 (ICE in pre_and_rev_post_order_compute, at cfganal.c:1055)\n\n\tPR target/89188\n\t* dce.c (delete_unmarked_insns): Don't remove no-op moves if they\n\tcan throw, non-call exceptions are enabled and we can't delete\n\tdead exceptions or alter cfg.  Set must_clean if\n\tdelete_insn_and_edges returns true, don't set it blindly for calls.\n\tAssert that delete_unreachable_blocks is called only if can_alter_cfg.\n\n\t* g++.dg/opt/pr89188.C: New test.\n\nFrom-SVN: r268544", "tree": {"sha": "3466f750e6949e6838f72b7b735d2b19fba1b1ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3466f750e6949e6838f72b7b735d2b19fba1b1ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c64775619ecbb1efef27631100082d1e22230a3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c64775619ecbb1efef27631100082d1e22230a3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c64775619ecbb1efef27631100082d1e22230a3e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c64775619ecbb1efef27631100082d1e22230a3e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ed99e818e02cd7b0c10c9e8cba7fec8ee17b0ca7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed99e818e02cd7b0c10c9e8cba7fec8ee17b0ca7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed99e818e02cd7b0c10c9e8cba7fec8ee17b0ca7"}], "stats": {"total": 35, "additions": 26, "deletions": 9}, "files": [{"sha": "700e3fc1b34eb6140187d3012f3d7a7b5b5d2529", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c64775619ecbb1efef27631100082d1e22230a3e", "patch": "@@ -1,5 +1,12 @@\n 2019-02-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/89188\n+\t* dce.c (delete_unmarked_insns): Don't remove no-op moves if they\n+\tcan throw, non-call exceptions are enabled and we can't delete\n+\tdead exceptions or alter cfg.  Set must_clean if\n+\tdelete_insn_and_edges returns true, don't set it blindly for calls.\n+\tAssert that delete_unreachable_blocks is called only if can_alter_cfg.\n+\n \tPR rtl-optimization/89195\n \t* combine.c (make_extraction): For MEMs, don't extract bytes outside\n \tof the original MEM."}, {"sha": "cb18e81592a381d2b96b2162f0c8ddf4f4175545", "filename": "gcc/dce.c", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2Fdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2Fdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdce.c?ref=c64775619ecbb1efef27631100082d1e22230a3e", "patch": "@@ -584,7 +584,12 @@ delete_unmarked_insns (void)\n \t  rtx turn_into_use = NULL_RTX;\n \n \t  /* Always delete no-op moves.  */\n-\t  if (noop_move_p (insn))\n+\t  if (noop_move_p (insn)\n+\t      /* Unless the no-op move can throw and we are not allowed\n+\t\t to alter cfg.  */\n+\t      && (!cfun->can_throw_non_call_exceptions\n+\t\t  || (cfun->can_delete_dead_exceptions && can_alter_cfg)\n+\t\t  || insn_nothrow_p (insn)))\n \t    {\n \t      if (RTX_FRAME_RELATED_P (insn))\n \t\tturn_into_use\n@@ -627,12 +632,6 @@ delete_unmarked_insns (void)\n \t     for the destination regs in order to avoid dangling notes.  */\n \t  remove_reg_equal_equiv_notes_for_defs (insn);\n \n-\t  /* If a pure or const call is deleted, this may make the cfg\n-\t     have unreachable blocks.  We rememeber this and call\n-\t     delete_unreachable_blocks at the end.  */\n-\t  if (CALL_P (insn))\n-\t    must_clean = true;\n-\n \t  if (turn_into_use)\n \t    {\n \t      /* Don't remove frame related noop moves if they cary\n@@ -645,12 +644,15 @@ delete_unmarked_insns (void)\n \t    }\n \t  else\n \t    /* Now delete the insn.  */\n-\t    delete_insn_and_edges (insn);\n+\t    must_clean |= delete_insn_and_edges (insn);\n \t}\n \n   /* Deleted a pure or const call.  */\n   if (must_clean)\n-    delete_unreachable_blocks ();\n+    {\n+      gcc_assert (can_alter_cfg);\n+      delete_unreachable_blocks ();\n+    }\n }\n \n "}, {"sha": "3388fbe8efe3b7c708b928a7d0da0adbae02b2f4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c64775619ecbb1efef27631100082d1e22230a3e", "patch": "@@ -1,5 +1,8 @@\n 2019-02-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/89188\n+\t* g++.dg/opt/pr89188.C: New test.\n+\n \tPR rtl-optimization/89195\n \t* gcc.c-torture/execute/pr89195.c: New test.\n "}, {"sha": "80be23763c7fd469fbefb806fa07193571052e7d", "filename": "gcc/testsuite/g++.dg/opt/pr89188.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr89188.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c64775619ecbb1efef27631100082d1e22230a3e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr89188.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr89188.C?ref=c64775619ecbb1efef27631100082d1e22230a3e", "patch": "@@ -0,0 +1,5 @@\n+// PR target/89188\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-Og -flive-range-shrinkage -fnon-call-exceptions\" }\n+\n+#include \"../torture/pr88861.C\""}]}