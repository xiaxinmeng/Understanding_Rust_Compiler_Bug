{"sha": "161e220201436a641df5f5d86fdbaebb599302fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTYxZTIyMDIwMTQzNmE2NDFkZjVmNWQ4NmZkYmFlYmI1OTkzMDJmYw==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2021-03-23T20:00:03Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-06-18T08:36:54Z"}, "message": "[Ada] Minor comment cleanups\n\ngcc/ada/\n\n\t* gen_il-gen.adb: Improve comments.\n\t* snames.ads-tmpl (Convention_Id): Remove \"--  Plenty of space\n\tfor expansion\", because that's irrelevant now that we are no\n\tlonger laying out node fields by hand.", "tree": {"sha": "48070f1858c6f801006e0e1b9f6c475079aa2623", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/48070f1858c6f801006e0e1b9f6c475079aa2623"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/161e220201436a641df5f5d86fdbaebb599302fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/161e220201436a641df5f5d86fdbaebb599302fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/161e220201436a641df5f5d86fdbaebb599302fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/161e220201436a641df5f5d86fdbaebb599302fc/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b3fa853abad9d7f2e2d5d77a200db20a4d4f0280", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3fa853abad9d7f2e2d5d77a200db20a4d4f0280", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3fa853abad9d7f2e2d5d77a200db20a4d4f0280"}], "stats": {"total": 38, "additions": 25, "deletions": 13}, "files": [{"sha": "7ef285ee458f37889cc94d2434c340997772b2c3", "filename": "gcc/ada/gen_il-gen.adb", "status": "modified", "additions": 25, "deletions": 12, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/161e220201436a641df5f5d86fdbaebb599302fc/gcc%2Fada%2Fgen_il-gen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/161e220201436a641df5f5d86fdbaebb599302fc/gcc%2Fada%2Fgen_il-gen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgen_il-gen.adb?ref=161e220201436a641df5f5d86fdbaebb599302fc", "patch": "@@ -837,20 +837,24 @@ package body Gen_IL.Gen is\n \n           when Node_Kind_Type | Entity_Kind_Type | Convention_Id => 8,\n \n-           when Mechanism_Type\n-              | List_Id\n-              | Elist_Id\n-              | Name_Id\n-              | String_Id\n-              | Uint\n-              | Ureal\n-              | Source_Ptr\n-              | Union_Id\n-              | Node_Id\n-              | Node_Or_Entity_Type => 32,\n+          when Mechanism_Type\n+             | List_Id\n+             | Elist_Id\n+             | Name_Id\n+             | String_Id\n+             | Uint\n+             | Ureal\n+             | Source_Ptr\n+             | Union_Id\n+             | Node_Id\n+             | Node_Or_Entity_Type => 32,\n \n          when Between_Special_And_Abstract_Node_Types => -- can't happen\n            Bit_Offset'Last);\n+         --  Size in bits of a a field of type T. It must be a power of 2, and\n+         --  must match the size of the type in GNAT, which sometimes requires\n+         --  a Size clause in GNAT.\n+         --\n          --  Note that this is not the same as Type_Bit_Size of the field's\n          --  type. For one thing, Type_Bit_Size only covers concrete node and\n          --  entity types, which does not include most of the above. For\n@@ -1012,11 +1016,20 @@ package body Gen_IL.Gen is\n          end loop;\n \n          --  Sort All_Fields based on how many concrete types have the field.\n+         --  This is for efficiency; we want to choose the offsets of the most\n+         --  common fields first, so they get low numbers.\n \n          Sorting.Sort (All_Fields);\n \n          --  Go through all the fields, and choose the lowest offset that is\n-         --  free in all types that have the field.\n+         --  free in all types that have the field. This is basically a\n+         --  graph-coloring algorithm on the interference graph. The\n+         --  interference graph is an undirected graph with the fields being\n+         --  nodes (not nodes in the compiler!) in the graph, and an edge\n+         --  between a pair of fields if they appear in the same node in the\n+         --  compiler. The \"colors\" are fields offsets, except that a\n+         --  complication compared to standard graph coloring is that fields\n+         --  are different sizes.\n \n          for F of All_Fields loop\n             Field_Table (F).Offset := Choose_Offset (F);"}, {"sha": "2611541dd7809a826f44c960aec566e6bb314b05", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/161e220201436a641df5f5d86fdbaebb599302fc/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/161e220201436a641df5f5d86fdbaebb599302fc/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=161e220201436a641df5f5d86fdbaebb599302fc", "patch": "@@ -1700,7 +1700,6 @@ package Snames is\n       --  in Sem_Prag.\n \n    for Convention_Id'Size use 8;\n-   --  Plenty of space for expansion\n \n    subtype Convention_C_Family is Convention_Id\n      range Convention_C .. Convention_CPP;"}]}