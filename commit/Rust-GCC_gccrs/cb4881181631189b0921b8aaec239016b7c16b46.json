{"sha": "cb4881181631189b0921b8aaec239016b7c16b46", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2I0ODgxMTgxNjMxMTg5YjA5MjFiOGFhZWMyMzkwMTZiN2MxNmI0Ng==", "commit": {"author": {"name": "Justin Squirek", "email": "squirek@adacore.com", "date": "2018-01-11T08:54:34Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-01-11T08:54:34Z"}, "message": "[Ada] No error on missing enclosing parentheses in Expression Function\n\nThis patch fixes an issue whereby an expression within an expression\nfunction declaration or completion without proper parenthesization is\nincorrectly accepted by the compiler.\n\n2018-01-11  Justin Squirek  <squirek@adacore.com>\n\ngcc/ada/\n\n\t* par-ch6.adb (Scan_Body_Or_Expression_Function): Add additional check\n\tto make sure a given expression function is properly parenthesized.\n\ngcc/testsuite/\n\n\t* gnat.dg/expr_func4.adb: New testcase.\n\nFrom-SVN: r256517", "tree": {"sha": "e43e18317e531a410047d427b06ecebe8f62b001", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e43e18317e531a410047d427b06ecebe8f62b001"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cb4881181631189b0921b8aaec239016b7c16b46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb4881181631189b0921b8aaec239016b7c16b46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb4881181631189b0921b8aaec239016b7c16b46", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb4881181631189b0921b8aaec239016b7c16b46/comments", "author": {"login": "AdaDoom3", "id": 3445599, "node_id": "MDQ6VXNlcjM0NDU1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3445599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdaDoom3", "html_url": "https://github.com/AdaDoom3", "followers_url": "https://api.github.com/users/AdaDoom3/followers", "following_url": "https://api.github.com/users/AdaDoom3/following{/other_user}", "gists_url": "https://api.github.com/users/AdaDoom3/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdaDoom3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdaDoom3/subscriptions", "organizations_url": "https://api.github.com/users/AdaDoom3/orgs", "repos_url": "https://api.github.com/users/AdaDoom3/repos", "events_url": "https://api.github.com/users/AdaDoom3/events{/privacy}", "received_events_url": "https://api.github.com/users/AdaDoom3/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ed27b86ba18a1ffed8ae002412250f0765ab3e72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ed27b86ba18a1ffed8ae002412250f0765ab3e72", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ed27b86ba18a1ffed8ae002412250f0765ab3e72"}], "stats": {"total": 39, "additions": 37, "deletions": 2}, "files": [{"sha": "f66092d7e92f2556e917f4666b6a595da3f8035c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=cb4881181631189b0921b8aaec239016b7c16b46", "patch": "@@ -1,3 +1,8 @@\n+2018-01-11  Justin Squirek  <squirek@adacore.com>\n+\n+\t* par-ch6.adb (Scan_Body_Or_Expression_Function): Add additional check\n+\tto make sure a given expression function is properly parenthesized.\n+\n 2018-01-11  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* sem_ch6.adb (Analyze_Subprogram_Body_Helper): Check the"}, {"sha": "f9a54d28d5fa649789e0d294ec3cd90141f79cfd", "filename": "gcc/ada/par-ch6.adb", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Fada%2Fpar-ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Fada%2Fpar-ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch6.adb?ref=cb4881181631189b0921b8aaec239016b7c16b46", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2017, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2018, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -873,7 +873,25 @@ package body Ch6 is\n                     New_Node\n                       (N_Expression_Function, Sloc (Specification_Node));\n                   Set_Specification (Body_Node, Specification_Node);\n-                  Set_Expression (Body_Node, P_Expression);\n+                  declare\n+                     Expr : constant Node_Id := P_Expression;\n+                  begin\n+                     Set_Expression (Body_Node, Expr);\n+\n+                     --  Check that the full expression is properly\n+                     --  parenthesized since we may have a left-operand that is\n+                     --  parenthesized but that is not one of the allowed cases\n+                     --  with syntactic parentheses.\n+\n+                     if not (Paren_Count (Expr) /= 0\n+                              or else Nkind_In (Expr, N_Aggregate,\n+                                                      N_Extension_Aggregate,\n+                                                      N_Quantified_Expression))\n+                     then\n+                        Error_Msg (\"expression function must be enclosed \"\n+                          & \"in parentheses\", Sloc (Expr));\n+                     end if;\n+                  end;\n \n                   --  Expression functions can carry pre/postconditions\n "}, {"sha": "e5d9ddea599122466158900dcaf24457b9ec439f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cb4881181631189b0921b8aaec239016b7c16b46", "patch": "@@ -1,3 +1,7 @@\n+2018-01-11  Justin Squirek  <squirek@adacore.com>\n+\n+\t* gnat.dg/expr_func4.adb: New testcase.\n+\n 2018-01-11  Hristian Kirtchev  <kirtchev@adacore.com>\n \n \t* gnat.dg/pure_subp_body.adb, gnat.dg/pure_subp_body_pkg.ads: New"}, {"sha": "79fc43707feb55e0e4c0bd33a41d8db2830e48a9", "filename": "gcc/testsuite/gnat.dg/expr_func4.adb", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Ftestsuite%2Fgnat.dg%2Fexpr_func4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb4881181631189b0921b8aaec239016b7c16b46/gcc%2Ftestsuite%2Fgnat.dg%2Fexpr_func4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fexpr_func4.adb?ref=cb4881181631189b0921b8aaec239016b7c16b46", "patch": "@@ -0,0 +1,8 @@\n+--  { dg-do compile }\n+\n+procedure Test_Exp is\n+   function X return Boolean is\n+     (Integer'Size = 32) or else (Float'Size = 32);  -- { dg-error \"expression function must be enclosed in parentheses\" }\n+begin\n+   null;\n+end;"}]}