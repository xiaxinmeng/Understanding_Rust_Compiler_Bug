{"sha": "e8186ecfef962821183f37c7f04c15e4937acfb4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTgxODZlY2ZlZjk2MjgyMTE4M2YzN2M3ZjA0YzE1ZTQ5MzdhY2ZiNA==", "commit": {"author": {"name": "Gabriel Dos Reis", "email": "gdr@codesourcery.com", "date": "2001-02-16T22:52:29Z"}, "committer": {"name": "Gabriel Dos Reis", "email": "gdr@gcc.gnu.org", "date": "2001-02-16T22:52:29Z"}, "message": "decl.c (check_tag_decl): Make sure a typedef for an anonymous class-type introduces at least a type-name.\n\ncp/\n        * decl.c (check_tag_decl): Make sure a typedef for an anonymous\n        class-type introduces at least a type-name.\n\ntestsuite/\n        * g++.old-deja/g++.other/decl9.C: New test.\n\nFrom-SVN: r39781", "tree": {"sha": "245b357fb269d110d467bf44522abd95190d56e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/245b357fb269d110d467bf44522abd95190d56e5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e8186ecfef962821183f37c7f04c15e4937acfb4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e8186ecfef962821183f37c7f04c15e4937acfb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e8186ecfef962821183f37c7f04c15e4937acfb4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e8186ecfef962821183f37c7f04c15e4937acfb4/comments", "author": null, "committer": null, "parents": [{"sha": "055adbaa1e397cd584fedb5cbe1a71651a7a0232", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/055adbaa1e397cd584fedb5cbe1a71651a7a0232", "html_url": "https://github.com/Rust-GCC/gccrs/commit/055adbaa1e397cd584fedb5cbe1a71651a7a0232"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "55f14cf5a2194c285c8becbd6d91b64739fd483b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e8186ecfef962821183f37c7f04c15e4937acfb4", "patch": "@@ -1,3 +1,8 @@\n+2001-02-16  Gabriel Dos Reis  <gdr@codesourcery.com>\n+\n+\t* decl.c (check_tag_decl): Make sure a typedef for an anonymous\n+\tclass-type introduces at least a type-name.\n+\n 2001-02-16  Jakub Jelinek  <jakub@redhat.com>\n \n \t* call.c (convert_like_real): Create a temporary for non-lvalue."}, {"sha": "7cf983b679b1d47f03c8fe1dfb823daeabe672d2", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=e8186ecfef962821183f37c7f04c15e4937acfb4", "patch": "@@ -6846,6 +6846,7 @@ check_tag_decl (declspecs)\n {\n   int found_type = 0;\n   int saw_friend = 0;\n+  int saw_typedef = 0;\n   tree ob_modifier = NULL_TREE;\n   register tree link;\n   register tree t = NULL_TREE;\n@@ -6877,6 +6878,8 @@ check_tag_decl (declspecs)\n \t      t = value;\n \t    }\n \t}\n+      else if (value == ridpointers[(int) RID_TYPEDEF])\n+        saw_typedef = 1;\n       else if (value == ridpointers[(int) RID_FRIEND])\n \t{\n \t  if (current_class_type == NULL_TREE\n@@ -6910,6 +6913,27 @@ check_tag_decl (declspecs)\n \t   && TYPE_NAME (t)\n \t   && ANON_AGGRNAME_P (TYPE_IDENTIFIER (t)))\n     {\n+      /* 7/3 In a simple-declaration, the optional init-declarator-list\n+         can be omitted only when declaring a class (clause 9) or\n+         enumeration (7.2), that is, when the decl-specifier-seq contains\n+         either a class-specifier, an elaborated-type-specifier with\n+         a class-key (9.1), or an enum-specifier.  In these cases and\n+         whenever a class-specifier or enum-specifier is present in the\n+         decl-specifier-seq, the identifiers in these specifiers are among\n+         the names being declared by the declaration (as class-name,\n+         enum-names, or enumerators, depending on the syntax).  In such\n+         cases, and except for the declaration of an unnamed bit-field (9.6),\n+         the decl-specifier-seq shall introduce one or more names into the\n+         program, or shall redeclare a name introduced by a previous\n+         declaration.  [Example:\n+             enum { };            // ill-formed\n+             typedef class { };   // ill-formed\n+         --end example]  */\n+      if (saw_typedef)\n+        {\n+          error (\"Missing type-name in typedef-declaration.\");\n+          return NULL_TREE;\n+        }\n       /* Anonymous unions are objects, so they can have specifiers.  */;\n       SET_ANON_AGGR_TYPE_P (t);\n "}, {"sha": "ff6cea8eedce39827128c8ecaa73a222e35fd8b3", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e8186ecfef962821183f37c7f04c15e4937acfb4", "patch": "@@ -1,3 +1,7 @@\n+2001-02-16  Gabriel Dos Reis <gdr@codesourcery.com>\n+\n+\t* g++.old-deja/g++.other/decl9.C: New test.\n+\t\n 2001-02-16  Jakub Jelinek  <jakub@redhat.com>\n \n \t* g++.old-deja/g++.other/init16.C: Update the test so that it does"}, {"sha": "5ec9a6e4ece0e7f78b9e3a0c402b5ea9170c984b", "filename": "gcc/testsuite/g++.old-deja/g++.other/decl9.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdecl9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8186ecfef962821183f37c7f04c15e4937acfb4/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdecl9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdecl9.C?ref=e8186ecfef962821183f37c7f04c15e4937acfb4", "patch": "@@ -0,0 +1,9 @@\n+// Build don't link\n+// Origin: batali@cogsci.ucsd.edu\n+// Contributed by Gabriel Dos Reis <gdr@codesourcery.com>\n+\n+typedef struct { } S;           // OK\n+typedef struct { };             // ERROR - Missing type-name\n+\n+typedef union { } U;            // OK\n+typedef union { };              // ERROR - Missing type-name"}]}