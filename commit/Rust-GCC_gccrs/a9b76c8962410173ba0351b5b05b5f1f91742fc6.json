{"sha": "a9b76c8962410173ba0351b5b05b5f1f91742fc6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTliNzZjODk2MjQxMDE3M2JhMDM1MWI1YjA1YjVmMWY5MTc0MmZjNg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@linaro.org", "date": "2017-11-01T08:54:22Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2017-11-01T08:54:22Z"}, "message": "Prevent invalid register mode changes in combine\n\nThis patch stops combine from changing the mode of an existing register\nin-place if doing so would change the size of the underlying register\nallocation size, as given by REGMODE_NATURAL_SIZE.  Without this,\nmany tests fail in adjust_reg_mode after SVE is added.  One example\nis gcc.c-torture/compile/20090401-1.c.\n\n2017-11-01  Richard Sandiford  <richard.sandiford@linaro.org>\n\t    Alan Hayward  <alan.hayward@arm.com>\n\t    David Sherwood  <david.sherwood@arm.com>\n\ngcc/\n\t* combine.c (can_change_dest_mode): Reject changes in\n\tREGMODE_NATURAL_SIZE.\n\nCo-Authored-By: Alan Hayward <alan.hayward@arm.com>\nCo-Authored-By: David Sherwood <david.sherwood@arm.com>\n\nFrom-SVN: r254291", "tree": {"sha": "15cc0b6bcadb90da797eecab3ad626c487496ade", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/15cc0b6bcadb90da797eecab3ad626c487496ade"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a9b76c8962410173ba0351b5b05b5f1f91742fc6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9b76c8962410173ba0351b5b05b5f1f91742fc6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a9b76c8962410173ba0351b5b05b5f1f91742fc6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9b76c8962410173ba0351b5b05b5f1f91742fc6/comments", "author": null, "committer": null, "parents": [{"sha": "6e0cb45f0c11d30f03498039b2f650ead28658bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e0cb45f0c11d30f03498039b2f650ead28658bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e0cb45f0c11d30f03498039b2f650ead28658bd"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "1886218f7b59a064db20c9d53b2a43382c09a535", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9b76c8962410173ba0351b5b05b5f1f91742fc6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9b76c8962410173ba0351b5b05b5f1f91742fc6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a9b76c8962410173ba0351b5b05b5f1f91742fc6", "patch": "@@ -1,3 +1,10 @@\n+2017-11-01  Richard Sandiford  <richard.sandiford@linaro.org>\n+\t    Alan Hayward  <alan.hayward@arm.com>\n+\t    David Sherwood  <david.sherwood@arm.com>\n+\n+\t* combine.c (can_change_dest_mode): Reject changes in\n+\tREGMODE_NATURAL_SIZE.\n+\n 2017-10-31  Sandra Loosemore  <sandra@codesourcery.com>\n \n \t* configure.ac (--enable-libssp): New."}, {"sha": "4afae213a3f129ebb4980ac3a2380a4bdeb76ade", "filename": "gcc/combine.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9b76c8962410173ba0351b5b05b5f1f91742fc6/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9b76c8962410173ba0351b5b05b5f1f91742fc6/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=a9b76c8962410173ba0351b5b05b5f1f91742fc6", "patch": "@@ -2478,6 +2478,12 @@ can_change_dest_mode (rtx x, int added_sets, machine_mode mode)\n       != REGMODE_NATURAL_SIZE (GET_MODE (x)))\n     return false;\n \n+  /* Don't change between modes with different underlying register sizes,\n+     since this could lead to invalid subregs.  */\n+  if (REGMODE_NATURAL_SIZE (mode)\n+      != REGMODE_NATURAL_SIZE (GET_MODE (x)))\n+    return false;\n+\n   regno = REGNO (x);\n   /* Allow hard registers if the new mode is legal, and occupies no more\n      registers than the old mode.  */"}]}