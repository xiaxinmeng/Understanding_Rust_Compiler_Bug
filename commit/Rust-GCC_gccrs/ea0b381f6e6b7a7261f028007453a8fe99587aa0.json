{"sha": "ea0b381f6e6b7a7261f028007453a8fe99587aa0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWEwYjM4MWY2ZTZiN2E3MjYxZjAyODAwNzQ1M2E4ZmU5OTU4N2FhMA==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2014-05-28T21:50:28Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2014-05-28T21:50:28Z"}, "message": "revert: lra-int.h (struct lra_reg): Add field actual_call_used_reg_set.\n\n2014-05-28  Tom de Vries  <tom@codesourcery.com>\n\n\tRevert:\n\t2014-05-28  Tom de Vries  <tom@codesourcery.com>\n\n\t* lra-int.h (struct lra_reg): Add field actual_call_used_reg_set.\n\t* lra.c (initialize_lra_reg_info_element): Add init of\n\tactual_call_used_reg_set field.\n\t(lra): Call lra_create_live_ranges before lra_inheritance for\n\t-fuse-caller-save.\n\t* lra-assigns.c (lra_assign): Allow call_used_regs to cross calls for\n\t-fuse-caller-save.\n\t* lra-constraints.c (need_for_call_save_p): Use actual_call_used_reg_set\n\tinstead of call_used_reg_set for -fuse-caller-save.\n\t* lra-lives.c (process_bb_lives): Calculate actual_call_used_reg_set.\n\nFrom-SVN: r211033", "tree": {"sha": "a85218b1d43ae3380e45d9f5caad31d59415b71d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a85218b1d43ae3380e45d9f5caad31d59415b71d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ea0b381f6e6b7a7261f028007453a8fe99587aa0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea0b381f6e6b7a7261f028007453a8fe99587aa0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea0b381f6e6b7a7261f028007453a8fe99587aa0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea0b381f6e6b7a7261f028007453a8fe99587aa0/comments", "author": null, "committer": null, "parents": [{"sha": "73f793e3bb4e0a2bd04536f8bbc861c34cfec945", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73f793e3bb4e0a2bd04536f8bbc861c34cfec945", "html_url": "https://github.com/Rust-GCC/gccrs/commit/73f793e3bb4e0a2bd04536f8bbc861c34cfec945"}], "stats": {"total": 65, "additions": 21, "deletions": 44}, "files": [{"sha": "024e8d6ea6aed9fbefe6d28b60ab2148e279a087", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ea0b381f6e6b7a7261f028007453a8fe99587aa0", "patch": "@@ -1,3 +1,19 @@\n+2014-05-28  Tom de Vries  <tom@codesourcery.com>\n+\n+\tRevert:\n+\t2014-05-28  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* lra-int.h (struct lra_reg): Add field actual_call_used_reg_set.\n+\t* lra.c (initialize_lra_reg_info_element): Add init of\n+\tactual_call_used_reg_set field.\n+\t(lra): Call lra_create_live_ranges before lra_inheritance for\n+\t-fuse-caller-save.\n+\t* lra-assigns.c (lra_assign): Allow call_used_regs to cross calls for\n+\t-fuse-caller-save.\n+\t* lra-constraints.c (need_for_call_save_p): Use actual_call_used_reg_set\n+\tinstead of call_used_reg_set for -fuse-caller-save.\n+\t* lra-lives.c (process_bb_lives): Calculate actual_call_used_reg_set.\n+\n 2014-05-28  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* doc/md.texi: Document that the % constraint character must"}, {"sha": "f7bb86b2160adc8173a4733f272f779bdffa7d6c", "filename": "gcc/lra-assigns.c", "status": "modified", "additions": 3, "deletions": 12, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-assigns.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-assigns.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-assigns.c?ref=ea0b381f6e6b7a7261f028007453a8fe99587aa0", "patch": "@@ -1447,7 +1447,6 @@ lra_assign (void)\n   bitmap_head insns_to_process;\n   bool no_spills_p;\n   int max_regno = max_reg_num ();\n-  unsigned int call_used_reg_crosses_call = 0;\n \n   timevar_push (TV_LRA_ASSIGN);\n   init_lives ();\n@@ -1460,22 +1459,14 @@ lra_assign (void)\n   bitmap_initialize (&all_spilled_pseudos, &reg_obstack);\n   create_live_range_start_chains ();\n   setup_live_pseudos_and_spill_after_risky_transforms (&all_spilled_pseudos);\n+#ifdef ENABLE_CHECKING\n   for (i = FIRST_PSEUDO_REGISTER; i < max_regno; i++)\n     if (lra_reg_info[i].nrefs != 0 && reg_renumber[i] >= 0\n \t&& lra_reg_info[i].call_p\n \t&& overlaps_hard_reg_set_p (call_used_reg_set,\n \t\t\t\t    PSEUDO_REGNO_MODE (i), reg_renumber[i]))\n-      {\n-\tif (!flag_use_caller_save)\n-\t  gcc_unreachable ();\n-\tcall_used_reg_crosses_call++;\n-      }\n-  if (lra_dump_file\n-      && call_used_reg_crosses_call > 0)\n-    fprintf (lra_dump_file,\n-\t     \"Found %u pseudo(s) with a call used reg crossing a call.\\n\"\n-\t     \"Allowing due to -fuse-caller-save\\n\",\n-\t     call_used_reg_crosses_call);    \n+      gcc_unreachable ();\n+#endif\n   /* Setup insns to process on the next constraint pass.  */\n   bitmap_initialize (&changed_pseudo_bitmap, &reg_obstack);\n   init_live_reload_and_inheritance_pseudos ();"}, {"sha": "2df841a97506bee1166472a5fa8acb26bc20fa95", "filename": "gcc/lra-constraints.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-constraints.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-constraints.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-constraints.c?ref=ea0b381f6e6b7a7261f028007453a8fe99587aa0", "patch": "@@ -4605,10 +4605,7 @@ need_for_call_save_p (int regno)\n   lra_assert (regno >= FIRST_PSEUDO_REGISTER && reg_renumber[regno] >= 0);\n   return (usage_insns[regno].calls_num < calls_num\n \t  && (overlaps_hard_reg_set_p\n-\t      ((flag_use_caller_save &&\n-\t\t! hard_reg_set_empty_p (lra_reg_info[regno].actual_call_used_reg_set))\n-\t       ? lra_reg_info[regno].actual_call_used_reg_set\n-\t       : call_used_reg_set,\n+\t      (call_used_reg_set,\n \t       PSEUDO_REGNO_MODE (regno), reg_renumber[regno])\n \t      || HARD_REGNO_CALL_PART_CLOBBERED (reg_renumber[regno],\n \t\t\t\t\t\t PSEUDO_REGNO_MODE (regno))));"}, {"sha": "41c98492973950f7b232071f2d15ab2c9a22e2d4", "filename": "gcc/lra-int.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-int.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-int.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-int.h?ref=ea0b381f6e6b7a7261f028007453a8fe99587aa0", "patch": "@@ -77,10 +77,6 @@ struct lra_reg\n   /* The following fields are defined only for pseudos.\t */\n   /* Hard registers with which the pseudo conflicts.  */\n   HARD_REG_SET conflict_hard_regs;\n-  /* Call used registers with which the pseudo conflicts, taking into account\n-     the registers used by functions called from calls which cross the\n-     pseudo. */\n-  HARD_REG_SET actual_call_used_reg_set;\n   /* We assign hard registers to reload pseudos which can occur in few\n      places.  So two hard register preferences are enough for them.\n      The following fields define the preferred hard registers.\tIf"}, {"sha": "8444adee6d8d3d11080c1a2b2fcad8c759f4a8df", "filename": "gcc/lra-lives.c", "status": "modified", "additions": 0, "deletions": 11, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-lives.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra-lives.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra-lives.c?ref=ea0b381f6e6b7a7261f028007453a8fe99587aa0", "patch": "@@ -624,17 +624,6 @@ process_bb_lives (basic_block bb, int &curr_point)\n \n       if (call_p)\n \t{\n-\t  if (flag_use_caller_save)\n-\t    {\n-\t      HARD_REG_SET this_call_used_reg_set;\n-\t      get_call_reg_set_usage (curr_insn, &this_call_used_reg_set,\n-\t\t\t\t      call_used_reg_set);\n-\n-\t      EXECUTE_IF_SET_IN_SPARSESET (pseudos_live, j)\n-\t\tIOR_HARD_REG_SET (lra_reg_info[j].actual_call_used_reg_set,\n-\t\t\t\t  this_call_used_reg_set);\n-\t    }\n- \n \t  sparseset_ior (pseudos_live_through_calls,\n \t\t\t pseudos_live_through_calls, pseudos_live);\n \t  if (cfun->has_nonlocal_label"}, {"sha": "ecec8908ca9f3123ec7419a0381cba837284697d", "filename": "gcc/lra.c", "status": "modified", "additions": 1, "deletions": 13, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ea0b381f6e6b7a7261f028007453a8fe99587aa0/gcc%2Flra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flra.c?ref=ea0b381f6e6b7a7261f028007453a8fe99587aa0", "patch": "@@ -1427,7 +1427,6 @@ initialize_lra_reg_info_element (int i)\n   lra_reg_info[i].no_stack_p = false;\n #endif\n   CLEAR_HARD_REG_SET (lra_reg_info[i].conflict_hard_regs);\n-  CLEAR_HARD_REG_SET (lra_reg_info[i].actual_call_used_reg_set);\n   lra_reg_info[i].preferred_hard_regno1 = -1;\n   lra_reg_info[i].preferred_hard_regno2 = -1;\n   lra_reg_info[i].preferred_hard_regno_profit1 = 0;\n@@ -2345,18 +2344,7 @@ lra (FILE *f)\n \t  lra_eliminate (false, false);\n \t  /* Do inheritance only for regular algorithms.  */\n \t  if (! lra_simple_p)\n-\t    {\n-\t      if (flag_use_caller_save)\n-\t\t{\n-\t\t  if (live_p)\n-\t\t    lra_clear_live_ranges ();\n-\t\t  /* As a side-effect of lra_create_live_ranges, we calculate\n-\t\t     actual_call_used_reg_set,  which is needed during\n-\t\t     lra_inheritance.  */\n-\t\t  lra_create_live_ranges (true);\n-\t\t}\n-\t      lra_inheritance ();\n-\t    }\n+\t    lra_inheritance ();\n \t  if (live_p)\n \t    lra_clear_live_ranges ();\n \t  /* We need live ranges for lra_assign -- so build them.  */"}]}