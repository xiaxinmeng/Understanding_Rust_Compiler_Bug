{"sha": "0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGQxZjRkZTk3ZDliNTFlMDRmNjY3ODQ0OGZiN2M3OTZhOGZiYTZiMQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2018-05-07T18:24:59Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2018-05-07T18:24:59Z"}, "message": "scanner.c (preprocessor_line): Call linemap_add after a line directive that changes the current filename.\n\n\t* scanner.c (preprocessor_line): Call linemap_add after a line\n\tdirective that changes the current filename.\n\n\t* gfortran.dg/linefile.f90: New test.\n\nFrom-SVN: r260010", "tree": {"sha": "d02b9d2d698cff5b5b95e470ba9ab2a48256219c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d02b9d2d698cff5b5b95e470ba9ab2a48256219c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/comments", "author": null, "committer": null, "parents": [{"sha": "a989f6378b1b08aa3145c7bd77477282ddc5e553", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a989f6378b1b08aa3145c7bd77477282ddc5e553", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a989f6378b1b08aa3145c7bd77477282ddc5e553"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "3735dc6a961633fbb041c2dd79bc019acfef9fba", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "patch": "@@ -1,3 +1,8 @@\n+2018-05-07  Jeff Law  <law@redhat.comg>\n+\n+\t* scanner.c (preprocessor_line): Call linemap_add after a line\n+\tdirective that changes the current filename.\n+\n 2018-05-06  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/85507"}, {"sha": "55d6dafdb5dd46d68f28da929ace3939d070e97d", "filename": "gcc/fortran/scanner.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ffortran%2Fscanner.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ffortran%2Fscanner.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fscanner.c?ref=0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "patch": "@@ -2107,6 +2107,10 @@ preprocessor_line (gfc_char_t *c)\n           in the linemap.  Alternative could be using GC or updating linemap to\n           point to the new name, but there is no API for that currently.  */\n       current_file->filename = xstrdup (filename);\n+\n+      /* We need to tell the linemap API that the filename changed.  Just\n+\t changing current_file is insufficient.  */\n+      linemap_add (line_table, LC_RENAME, false, current_file->filename, line);\n     }\n \n   /* Set new line number.  */"}, {"sha": "e8b417ad29ebcf6b98bd3c4c492b1db9b44ca032", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "patch": "@@ -1,3 +1,7 @@\n+2018-05-07  Jeff Law  <law@redhat.com>\n+\n+\t* gfortran.dg/linefile.f90: New test.\n+\n 2018-05-07  Christophe Lyon  <christophe.lyon@linaro.org>\n \n \t* gcc.dg/nextafter-2.c: Add c99_runtime effective target"}, {"sha": "8e1366b0802a57b1740ab2b490fa14f64eeae8f5", "filename": "gcc/testsuite/gfortran.dg/linefile.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ftestsuite%2Fgfortran.dg%2Flinefile.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d1f4de97d9b51e04f6678448fb7c796a8fba6b1/gcc%2Ftestsuite%2Fgfortran.dg%2Flinefile.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Flinefile.f90?ref=0d1f4de97d9b51e04f6678448fb7c796a8fba6b1", "patch": "@@ -0,0 +1,18 @@\n+! { dg-do compile }\n+! { dg-options \"-Wall\" }\n+\n+! This will verify that the # <line> <file> directive later does not\n+! mess up the diagnostic on this line\n+SUBROUTINE s(dummy) ! { dg-warning \"Unused\" }\n+  INTEGER, INTENT(in) :: dummy\n+END SUBROUTINE\n+\n+# 12345 \"foo-f\"\n+SUBROUTINE s2(dummy)\n+  INTEGER, INTENT(in) :: dummy\n+END SUBROUTINE\n+! We want to check that the # directive changes the filename in the\n+! diagnostic.  Nothing else really matters here.  dg-regexp allows us\n+! to see the entire diagnostic.  We just have to make sure to consume\n+! the entire message.\n+! { dg-regexp \"foo-f\\[^\\n]*\" }"}]}