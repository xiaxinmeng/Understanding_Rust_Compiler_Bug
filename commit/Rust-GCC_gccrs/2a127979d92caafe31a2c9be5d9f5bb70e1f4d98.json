{"sha": "2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmExMjc5NzlkOTJjYWFmZTMxYTJjOWJlNWQ5ZjViYjcwZTFmNGQ5OA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2019-08-14T09:51:39Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-14T09:51:39Z"}, "message": "[Ada] Fix internal error on inlined subprogram instance\n\nThis fixes a long-standing oddity in the procedure analyzing the\ninstantiation of a generic subprogram, which would set the\nIs_Generic_Instance flag on the enclosing package generated for the\ninstantiation but only to reset it a few lines below.  Now this flag is\nrelied upon by the machinery which computes the set of public entities\nto be exposed by a package.\n\n2019-08-14  Eric Botcazou  <ebotcazou@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch12.adb (Analyze_Instance_And_Renamings): Do not reset\n\tthe Is_Generic_Instance flag previously set on the package\n\tgenerated for the instantiation of a generic subprogram.\n\ngcc/testsuite/\n\n\t* gnat.dg/generic_inst11.adb, gnat.dg/generic_inst11_pkg.adb,\n\tgnat.dg/generic_inst11_pkg.ads: New testcase.\n\nFrom-SVN: r274457", "tree": {"sha": "5123dc681526f854a38f8fd7859fcf521025e66c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5123dc681526f854a38f8fd7859fcf521025e66c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/comments", "author": null, "committer": null, "parents": [{"sha": "16b9e3c32d0c52334644021e5e0465b1c43d190e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16b9e3c32d0c52334644021e5e0465b1c43d190e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16b9e3c32d0c52334644021e5e0465b1c43d190e"}], "stats": {"total": 50, "additions": 46, "deletions": 4}, "files": [{"sha": "a36a83ab3d2910d3fb27dc1ed4c4bb937387bbce", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "patch": "@@ -1,3 +1,9 @@\n+2019-08-14  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* sem_ch12.adb (Analyze_Instance_And_Renamings): Do not reset\n+\tthe Is_Generic_Instance flag previously set on the package\n+\tgenerated for the instantiation of a generic subprogram.\n+\n 2019-08-14  Ed Schonberg  <schonberg@adacore.com>\n \n \t* exp_ch4.adb (Expand_N_Quantified_Expression): Freeze"}, {"sha": "5f290acbe32f610baf1cd2cd4fef50864fa7af88", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "patch": "@@ -5264,10 +5264,6 @@ package body Sem_Ch12 is\n \n          Analyze (Pack_Decl);\n          Check_Formal_Packages (Pack_Id);\n-         Set_Is_Generic_Instance (Pack_Id, False);\n-\n-         --  Why do we clear Is_Generic_Instance??? We set it 20 lines\n-         --  above???\n \n          --  Body of the enclosing package is supplied when instantiating the\n          --  subprogram body, after semantic analysis is completed."}, {"sha": "89a92fa258328afeb90f8a3e90704ca7eae1231b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "patch": "@@ -1,3 +1,8 @@\n+2019-08-14  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/generic_inst11.adb, gnat.dg/generic_inst11_pkg.adb,\n+\tgnat.dg/generic_inst11_pkg.ads: New testcase.\n+\n 2019-08-14  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/assert2.adb, gnat.dg/assert2.ads: New testcase."}, {"sha": "75c19a590bef20b4f782b0969917c276b4737c7d", "filename": "gcc/testsuite/gnat.dg/generic_inst11.adb", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11.adb?ref=2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "patch": "@@ -0,0 +1,9 @@\n+--  { dg-do compile }\n+--  { dg-options \"-O -gnatn\" }\n+\n+with Generic_Inst11_Pkg;\n+\n+procedure Generic_Inst11 is\n+begin\n+   Generic_Inst11_Pkg.Proc;\n+end;"}, {"sha": "b90f8bb982b6a0ecbc25054224de7a9e8c13f324", "filename": "gcc/testsuite/gnat.dg/generic_inst11_pkg.adb", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11_pkg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11_pkg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11_pkg.adb?ref=2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "patch": "@@ -0,0 +1,21 @@\n+with System;\n+\n+package body Generic_Inst11_Pkg is\n+\n+   Data : Integer;\n+\n+   generic\n+      Reg_Address : System.Address;\n+   procedure Inner_G with Inline;\n+\n+   procedure Inner_G is\n+      Reg : Integer with Address => Reg_Address;\n+   begin\n+      null;\n+   end;\n+\n+   procedure My_Inner_G is new Inner_G (Data'Address);\n+\n+   procedure Proc renames My_Inner_G;\n+\n+end Generic_Inst11_Pkg;"}, {"sha": "07ee9f64a3e8ce447c00e30a360453b73159abcc", "filename": "gcc/testsuite/gnat.dg/generic_inst11_pkg.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a127979d92caafe31a2c9be5d9f5bb70e1f4d98/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fgeneric_inst11_pkg.ads?ref=2a127979d92caafe31a2c9be5d9f5bb70e1f4d98", "patch": "@@ -0,0 +1,5 @@\n+package Generic_Inst11_Pkg is\n+\n+   procedure Proc with Inline;\n+\n+end Generic_Inst11_Pkg;"}]}