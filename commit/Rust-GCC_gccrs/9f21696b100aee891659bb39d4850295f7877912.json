{"sha": "9f21696b100aee891659bb39d4850295f7877912", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWYyMTY5NmIxMDBhZWU4OTE2NTliYjM5ZDQ4NTAyOTVmNzg3NzkxMg==", "commit": {"author": {"name": "Jason Merrill", "email": "merrill@gnu.org", "date": "1995-02-13T20:21:44Z"}, "committer": {"name": "Jason Merrill", "email": "merrill@gnu.org", "date": "1995-02-13T20:21:44Z"}, "message": "Fix collecting under AIX\n\nFrom-SVN: r8933", "tree": {"sha": "c3773f34c1bfdd99f54d975ffef28d44d0a9d281", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c3773f34c1bfdd99f54d975ffef28d44d0a9d281"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f21696b100aee891659bb39d4850295f7877912", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f21696b100aee891659bb39d4850295f7877912", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f21696b100aee891659bb39d4850295f7877912", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f21696b100aee891659bb39d4850295f7877912/comments", "author": null, "committer": null, "parents": [{"sha": "d1e1adfb128e33b98deb622af8e33844c1d98d2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1e1adfb128e33b98deb622af8e33844c1d98d2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1e1adfb128e33b98deb622af8e33844c1d98d2b"}], "stats": {"total": 31, "additions": 24, "deletions": 7}, "files": [{"sha": "c47a1678b86f7883b2e28dfde2a4f544d7c07bcb", "filename": "gcc/collect2.c", "status": "modified", "additions": 20, "deletions": 7, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f21696b100aee891659bb39d4850295f7877912/gcc%2Fcollect2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f21696b100aee891659bb39d4850295f7877912/gcc%2Fcollect2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcollect2.c?ref=9f21696b100aee891659bb39d4850295f7877912", "patch": "@@ -824,6 +824,8 @@ main (argc, argv)\n   char **ld1\t\t= ld1_argv;\n   char **ld2_argv\t= (char **) xcalloc (sizeof (char *), argc+5);\n   char **ld2\t\t= ld2_argv;\n+  char **object_lst\t= (char **) xcalloc (sizeof (char *), argc);\n+  char **object\t\t= object_lst;\n   int first_file;\n   int num_c_args\t= argc+7;\n \n@@ -1154,15 +1156,19 @@ main (argc, argv)\n \t      break;\n \t    }\n \t}\n-      else if (first_file\n-\t       && (p = rindex (arg, '.')) != (char *)0\n+      else if ((p = rindex (arg, '.')) != (char *)0\n \t       && (strcmp (p, \".o\") == 0 || strcmp (p, \".a\") == 0))\n \t{\n-\t  first_file = 0;\n-\t  /* place o_file BEFORE this argument! */\n-\t  ld2--;\n-\t  *ld2++ = o_file;\n-\t  *ld2++ = arg;\n+\t  if (first_file)\n+\t    {\n+\t      first_file = 0;\n+\t      /* place o_file BEFORE this argument! */\n+\t      ld2--;\n+\t      *ld2++ = o_file;\n+\t      *ld2++ = arg;\n+\t    }\n+\t  if (p[1] == 'o')\n+\t    *object++ = arg;\n \t}\n     }\n \n@@ -1261,6 +1267,13 @@ main (argc, argv)\n   if (rflag)\n     return 0;\n \n+#ifdef COLLECT_SCAN_OBJECTS\n+  /* The AIX linker will discard static constructors in object files if\n+     nothing else in the file is referenced, so look at them first.  */\n+  while (object_lst < object)\n+    scan_prog_file (*object_lst++, PASS_FIRST);\n+#endif\n+\n   scan_prog_file (output_file, PASS_FIRST);\n \n #ifdef SCAN_LIBRARIES"}, {"sha": "099dda09eab1d399f7912b8a6861d9716e785262", "filename": "gcc/config/rs6000/rs6000.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f21696b100aee891659bb39d4850295f7877912/gcc%2Fconfig%2Frs6000%2Frs6000.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f21696b100aee891659bb39d4850295f7877912/gcc%2Fconfig%2Frs6000%2Frs6000.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.h?ref=9f21696b100aee891659bb39d4850295f7877912", "patch": "@@ -98,6 +98,10 @@ the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.  */\n /* Don't turn -B into -L if the argument specifies a relative file name.  */\n #define RELATIVE_PREFIX_NOT_LINKDIR\n \n+/* The AIX linker will discard static constructors in object files before\n+   collect has a chance to see them, so scan the object files directly.  */\n+#define COLLECT_SCAN_OBJECTS\n+\n /* Architecture type.  */\n \n extern int target_flags;"}]}