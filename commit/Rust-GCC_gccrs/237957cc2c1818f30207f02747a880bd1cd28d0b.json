{"sha": "237957cc2c1818f30207f02747a880bd1cd28d0b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM3OTU3Y2MyYzE4MThmMzAyMDdmMDI3NDdhODgwYmQxY2QyOGQwYg==", "commit": {"author": {"name": "Andrew Stubbs", "email": "ams@codesourcery.com", "date": "2019-11-13T12:38:18Z"}, "committer": {"name": "Andrew Stubbs", "email": "ams@gcc.gnu.org", "date": "2019-11-13T12:38:18Z"}, "message": "GCN Libgomp Plugin\n\n2019-11-13  Andrew Stubbs  <ams@codesourcery.com>\n\t    Kwok Cheung Yeung  <kcy@codesourcery.com>\n\t    Julian Brown  <julian@codesourcery.com>\n\t    Tom de Vries  <tom@codesourcery.com>\n\n\tlibgomp/\n\t* plugin/Makefrag.am: Add amdgcn plugin support.\n\t* plugin/configfrag.ac: Likewise.\n\t* plugin/plugin-gcn.c: New file.\n\t* configure: Regenerate.\n\t* Makefile.in: Regenerate.\n\t* testsuite/Makefile.in: Regenerate.\n\nCo-Authored-By: Julian Brown <julian@codesourcery.com>\nCo-Authored-By: Kwok Cheung Yeung <kcy@codesourcery.com>\nCo-Authored-By: Tom de Vries <tom@codesourcery.com>\n\nFrom-SVN: r278138", "tree": {"sha": "5e61460a8322b39562ed270b776a8cdafb660dcb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5e61460a8322b39562ed270b776a8cdafb660dcb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/237957cc2c1818f30207f02747a880bd1cd28d0b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/237957cc2c1818f30207f02747a880bd1cd28d0b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/237957cc2c1818f30207f02747a880bd1cd28d0b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/237957cc2c1818f30207f02747a880bd1cd28d0b/comments", "author": {"login": "ams-cs", "id": 2235130, "node_id": "MDQ6VXNlcjIyMzUxMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2235130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ams-cs", "html_url": "https://github.com/ams-cs", "followers_url": "https://api.github.com/users/ams-cs/followers", "following_url": "https://api.github.com/users/ams-cs/following{/other_user}", "gists_url": "https://api.github.com/users/ams-cs/gists{/gist_id}", "starred_url": "https://api.github.com/users/ams-cs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ams-cs/subscriptions", "organizations_url": "https://api.github.com/users/ams-cs/orgs", "repos_url": "https://api.github.com/users/ams-cs/repos", "events_url": "https://api.github.com/users/ams-cs/events{/privacy}", "received_events_url": "https://api.github.com/users/ams-cs/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "fe22e0d4f1d705fef8ad037bcc8c6092c139b298", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fe22e0d4f1d705fef8ad037bcc8c6092c139b298", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fe22e0d4f1d705fef8ad037bcc8c6092c139b298"}], "stats": {"total": 4166, "additions": 4156, "deletions": 10}, "files": [{"sha": "bcd14fa7a0790731274c9985a909e7afd29cdac6", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=237957cc2c1818f30207f02747a880bd1cd28d0b", "patch": "@@ -1,3 +1,15 @@\n+2019-11-13  Andrew Stubbs  <ams@codesourcery.com>\n+\t    Kwok Cheung Yeung  <kcy@codesourcery.com>\n+\t    Julian Brown  <julian@codesourcery.com>\n+\t    Tom de Vries  <tom@codesourcery.com>\n+\n+\t* plugin/Makefrag.am: Add amdgcn plugin support.\n+\t* plugin/configfrag.ac: Likewise.\n+\t* plugin/plugin-gcn.c: New file.\n+\t* configure: Regenerate.\n+\t* Makefile.in: Regenerate.\n+\t* testsuite/Makefile.in: Regenerate.\n+\n 2019-11-13  Andrew Stubbs  <ams@codesourcery.com>\n \n \t* config/gcn/team.c (gomp_gcn_enter_kernel): Set up the team arena"}, {"sha": "3d772ee3007ef4a3091ef62707c814d5657ba08b", "filename": "libgomp/Makefile.in", "status": "modified", "additions": 49, "deletions": 8, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FMakefile.in?ref=237957cc2c1818f30207f02747a880bd1cd28d0b", "patch": "@@ -120,7 +120,8 @@ host_triplet = @host@\n target_triplet = @target@\n @PLUGIN_NVPTX_TRUE@am__append_1 = libgomp-plugin-nvptx.la\n @PLUGIN_HSA_TRUE@am__append_2 = libgomp-plugin-hsa.la\n-@USE_FORTRAN_TRUE@am__append_3 = openacc.f90\n+@PLUGIN_GCN_TRUE@am__append_3 = libgomp-plugin-gcn.la\n+@USE_FORTRAN_TRUE@am__append_4 = openacc.f90\n subdir = .\n ACLOCAL_M4 = $(top_srcdir)/aclocal.m4\n am__aclocal_m4_deps = $(top_srcdir)/../config/acx.m4 \\\n@@ -180,15 +181,26 @@ am__installdirs = \"$(DESTDIR)$(toolexeclibdir)\" \"$(DESTDIR)$(infodir)\" \\\n \t\"$(DESTDIR)$(toolexeclibdir)\"\n LTLIBRARIES = $(toolexeclib_LTLIBRARIES)\n am__DEPENDENCIES_1 =\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_la_DEPENDENCIES = libgomp.la \\\n+@PLUGIN_GCN_TRUE@\t$(am__DEPENDENCIES_1)\n+@PLUGIN_GCN_TRUE@am_libgomp_plugin_gcn_la_OBJECTS =  \\\n+@PLUGIN_GCN_TRUE@\tlibgomp_plugin_gcn_la-plugin-gcn.lo\n+libgomp_plugin_gcn_la_OBJECTS = $(am_libgomp_plugin_gcn_la_OBJECTS)\n+AM_V_lt = $(am__v_lt_@AM_V@)\n+am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)\n+am__v_lt_0 = --silent\n+am__v_lt_1 = \n+libgomp_plugin_gcn_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \\\n+\t$(libgomp_plugin_gcn_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \\\n+\t--mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \\\n+\t$(libgomp_plugin_gcn_la_LDFLAGS) $(LDFLAGS) -o $@\n+@PLUGIN_GCN_TRUE@am_libgomp_plugin_gcn_la_rpath = -rpath \\\n+@PLUGIN_GCN_TRUE@\t$(toolexeclibdir)\n @PLUGIN_HSA_TRUE@libgomp_plugin_hsa_la_DEPENDENCIES = libgomp.la \\\n @PLUGIN_HSA_TRUE@\t$(am__DEPENDENCIES_1)\n @PLUGIN_HSA_TRUE@am_libgomp_plugin_hsa_la_OBJECTS =  \\\n @PLUGIN_HSA_TRUE@\tlibgomp_plugin_hsa_la-plugin-hsa.lo\n libgomp_plugin_hsa_la_OBJECTS = $(am_libgomp_plugin_hsa_la_OBJECTS)\n-AM_V_lt = $(am__v_lt_@AM_V@)\n-am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)\n-am__v_lt_0 = --silent\n-am__v_lt_1 = \n libgomp_plugin_hsa_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \\\n \t$(libgomp_plugin_hsa_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \\\n \t--mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \\\n@@ -265,7 +277,8 @@ AM_V_FCLD = $(am__v_FCLD_@AM_V@)\n am__v_FCLD_ = $(am__v_FCLD_@AM_DEFAULT_V@)\n am__v_FCLD_0 = @echo \"  FCLD    \" $@;\n am__v_FCLD_1 = \n-SOURCES = $(libgomp_plugin_hsa_la_SOURCES) \\\n+SOURCES = $(libgomp_plugin_gcn_la_SOURCES) \\\n+\t$(libgomp_plugin_hsa_la_SOURCES) \\\n \t$(libgomp_plugin_nvptx_la_SOURCES) $(libgomp_la_SOURCES)\n AM_V_DVIPS = $(am__v_DVIPS_@AM_V@)\n am__v_DVIPS_ = $(am__v_DVIPS_@AM_DEFAULT_V@)\n@@ -428,6 +441,10 @@ PACKAGE_URL = @PACKAGE_URL@\n PACKAGE_VERSION = @PACKAGE_VERSION@\n PATH_SEPARATOR = @PATH_SEPARATOR@\n PERL = @PERL@\n+PLUGIN_GCN = @PLUGIN_GCN@\n+PLUGIN_GCN_CPPFLAGS = @PLUGIN_GCN_CPPFLAGS@\n+PLUGIN_GCN_LDFLAGS = @PLUGIN_GCN_LDFLAGS@\n+PLUGIN_GCN_LIBS = @PLUGIN_GCN_LIBS@\n PLUGIN_HSA = @PLUGIN_HSA@\n PLUGIN_HSA_CPPFLAGS = @PLUGIN_HSA_CPPFLAGS@\n PLUGIN_HSA_LDFLAGS = @PLUGIN_HSA_LDFLAGS@\n@@ -527,7 +544,8 @@ libsubincludedir = $(libdir)/gcc/$(target_alias)/$(gcc_version)/include\n AM_CPPFLAGS = $(addprefix -I, $(search_path))\n AM_CFLAGS = $(XCFLAGS)\n AM_LDFLAGS = $(XLDFLAGS) $(SECTION_LDFLAGS) $(OPT_LDFLAGS)\n-toolexeclib_LTLIBRARIES = libgomp.la $(am__append_1) $(am__append_2)\n+toolexeclib_LTLIBRARIES = libgomp.la $(am__append_1) $(am__append_2) \\\n+\t$(am__append_3)\n nodist_toolexeclib_HEADERS = libgomp.spec\n \n # -Wc is only a libtool option.\n@@ -553,7 +571,7 @@ libgomp_la_SOURCES = alloc.c atomic.c barrier.c critical.c env.c \\\n \toacc-parallel.c oacc-host.c oacc-init.c oacc-mem.c \\\n \toacc-async.c oacc-plugin.c oacc-cuda.c priority_queue.c \\\n \taffinity-fmt.c teams.c oacc-profiling.c oacc-target.c \\\n-\t$(am__append_3)\n+\t$(am__append_4)\n \n # Nvidia PTX OpenACC plugin.\n @PLUGIN_NVPTX_TRUE@libgomp_plugin_nvptx_version_info = -version-info $(libtool_VERSION)\n@@ -576,6 +594,18 @@ libgomp_la_SOURCES = alloc.c atomic.c barrier.c critical.c env.c \\\n @PLUGIN_HSA_TRUE@\t$(lt_host_flags) $(PLUGIN_HSA_LDFLAGS)\n @PLUGIN_HSA_TRUE@libgomp_plugin_hsa_la_LIBADD = libgomp.la $(PLUGIN_HSA_LIBS)\n @PLUGIN_HSA_TRUE@libgomp_plugin_hsa_la_LIBTOOLFLAGS = --tag=disable-static\n+\n+# AMD GCN plugin\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_version_info = -version-info $(libtool_VERSION)\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_la_SOURCES = plugin/plugin-gcn.c\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_la_CPPFLAGS = $(AM_CPPFLAGS) $(PLUGIN_GCN_CPPFLAGS) \\\n+@PLUGIN_GCN_TRUE@\t-D_GNU_SOURCE\n+\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_la_LDFLAGS =  \\\n+@PLUGIN_GCN_TRUE@\t$(libgomp_plugin_gcn_version_info) \\\n+@PLUGIN_GCN_TRUE@\t$(lt_host_flags) $(PLUGIN_GCN_LDFLAGS)\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_la_LIBADD = libgomp.la $(PLUGIN_GCN_LIBS)\n+@PLUGIN_GCN_TRUE@libgomp_plugin_gcn_la_LIBTOOLFLAGS = --tag=disable-static\n nodist_noinst_HEADERS = libgomp_f.h\n nodist_libsubinclude_HEADERS = omp.h openacc.h acc_prof.h\n @USE_FORTRAN_TRUE@nodist_finclude_HEADERS = omp_lib.h omp_lib.f90 omp_lib.mod omp_lib_kinds.mod \\\n@@ -712,6 +742,9 @@ clean-toolexeclibLTLIBRARIES:\n \t  rm -f $${locs}; \\\n \t}\n \n+libgomp-plugin-gcn.la: $(libgomp_plugin_gcn_la_OBJECTS) $(libgomp_plugin_gcn_la_DEPENDENCIES) $(EXTRA_libgomp_plugin_gcn_la_DEPENDENCIES) \n+\t$(AM_V_CCLD)$(libgomp_plugin_gcn_la_LINK) $(am_libgomp_plugin_gcn_la_rpath) $(libgomp_plugin_gcn_la_OBJECTS) $(libgomp_plugin_gcn_la_LIBADD) $(LIBS)\n+\n libgomp-plugin-hsa.la: $(libgomp_plugin_hsa_la_OBJECTS) $(libgomp_plugin_hsa_la_DEPENDENCIES) $(EXTRA_libgomp_plugin_hsa_la_DEPENDENCIES) \n \t$(AM_V_CCLD)$(libgomp_plugin_hsa_la_LINK) $(am_libgomp_plugin_hsa_la_rpath) $(libgomp_plugin_hsa_la_OBJECTS) $(libgomp_plugin_hsa_la_LIBADD) $(LIBS)\n \n@@ -742,6 +775,7 @@ distclean-compile:\n @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/iter.Plo@am__quote@\n @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/iter_ull.Plo@am__quote@\n @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgomp-plugin.Plo@am__quote@\n+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgomp_plugin_gcn_la-plugin-gcn.Plo@am__quote@\n @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgomp_plugin_hsa_la-plugin-hsa.Plo@am__quote@\n @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgomp_plugin_nvptx_la-plugin-nvptx.Plo@am__quote@\n @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lock.Plo@am__quote@\n@@ -794,6 +828,13 @@ distclean-compile:\n @AMDEP_TRUE@@am__fastdepCC_FALSE@\tDEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@\n @am__fastdepCC_FALSE@\t$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<\n \n+libgomp_plugin_gcn_la-plugin-gcn.lo: plugin/plugin-gcn.c\n+@am__fastdepCC_TRUE@\t$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgomp_plugin_gcn_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libgomp_plugin_gcn_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT libgomp_plugin_gcn_la-plugin-gcn.lo -MD -MP -MF $(DEPDIR)/libgomp_plugin_gcn_la-plugin-gcn.Tpo -c -o libgomp_plugin_gcn_la-plugin-gcn.lo `test -f 'plugin/plugin-gcn.c' || echo '$(srcdir)/'`plugin/plugin-gcn.c\n+@am__fastdepCC_TRUE@\t$(AM_V_at)$(am__mv) $(DEPDIR)/libgomp_plugin_gcn_la-plugin-gcn.Tpo $(DEPDIR)/libgomp_plugin_gcn_la-plugin-gcn.Plo\n+@AMDEP_TRUE@@am__fastdepCC_FALSE@\t$(AM_V_CC)source='plugin/plugin-gcn.c' object='libgomp_plugin_gcn_la-plugin-gcn.lo' libtool=yes @AMDEPBACKSLASH@\n+@AMDEP_TRUE@@am__fastdepCC_FALSE@\tDEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@\n+@am__fastdepCC_FALSE@\t$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgomp_plugin_gcn_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libgomp_plugin_gcn_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o libgomp_plugin_gcn_la-plugin-gcn.lo `test -f 'plugin/plugin-gcn.c' || echo '$(srcdir)/'`plugin/plugin-gcn.c\n+\n libgomp_plugin_hsa_la-plugin-hsa.lo: plugin/plugin-hsa.c\n @am__fastdepCC_TRUE@\t$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgomp_plugin_hsa_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(libgomp_plugin_hsa_la_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT libgomp_plugin_hsa_la-plugin-hsa.lo -MD -MP -MF $(DEPDIR)/libgomp_plugin_hsa_la-plugin-hsa.Tpo -c -o libgomp_plugin_hsa_la-plugin-hsa.lo `test -f 'plugin/plugin-hsa.c' || echo '$(srcdir)/'`plugin/plugin-hsa.c\n @am__fastdepCC_TRUE@\t$(AM_V_at)$(am__mv) $(DEPDIR)/libgomp_plugin_hsa_la-plugin-hsa.Tpo $(DEPDIR)/libgomp_plugin_hsa_la-plugin-hsa.Plo"}, {"sha": "04a6fd96610092e865e6bc39193770f8e6604712", "filename": "libgomp/configure", "status": "modified", "additions": 57, "deletions": 2, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure?ref=237957cc2c1818f30207f02747a880bd1cd28d0b", "patch": "@@ -662,6 +662,8 @@ LIBGOMP_BUILD_VERSIONED_SHLIB_FALSE\n LIBGOMP_BUILD_VERSIONED_SHLIB_TRUE\n OPT_LDFLAGS\n SECTION_LDFLAGS\n+PLUGIN_GCN_FALSE\n+PLUGIN_GCN_TRUE\n PLUGIN_HSA_FALSE\n PLUGIN_HSA_TRUE\n PLUGIN_NVPTX_FALSE\n@@ -670,6 +672,10 @@ offload_additional_lib_paths\n offload_additional_options\n offload_targets\n offload_plugins\n+PLUGIN_GCN_LIBS\n+PLUGIN_GCN_LDFLAGS\n+PLUGIN_GCN_CPPFLAGS\n+PLUGIN_GCN\n PLUGIN_HSA_LIBS\n PLUGIN_HSA_LDFLAGS\n PLUGIN_HSA_CPPFLAGS\n@@ -11399,7 +11405,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11402 \"configure\"\n+#line 11408 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11505,7 +11511,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11508 \"configure\"\n+#line 11514 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -15229,6 +15235,15 @@ PLUGIN_HSA_LIBS=\n \n \n \n+PLUGIN_GCN=0\n+PLUGIN_GCN_CPPFLAGS=\n+PLUGIN_GCN_LDFLAGS=\n+PLUGIN_GCN_LIBS=\n+\n+\n+\n+\n+\n # Parse '--enable-offload-targets', figure out the corresponding libgomp\n # plugins, and configure to find the corresponding offload compilers.\n # 'offload_plugins' and 'offload_targets' will be populated in the same order.\n@@ -15340,6 +15355,29 @@ rm -f core conftest.err conftest.$ac_objext \\\n             ;;\n         esac\n         ;;\n+\n+      amdgcn*)\n+\tcase \"${target}\" in\n+\t  x86_64-*-*)\n+\t    case \" ${CC} ${CFLAGS} \" in\n+\t      *\" -m32 \"*)\n+\t\tPLUGIN_GCN=0\n+\t\t;;\n+\t      *)\n+\t\ttgt_plugin=gcn\n+\t\tPLUGIN_GCN=$tgt\n+\t\tPLUGIN_GCN_CPPFLAGS=$HSA_RUNTIME_CPPFLAGS\n+\t\tPLUGIN_GCN_LDFLAGS=\"$HSA_RUNTIME_LDFLAGS\"\n+\t\tPLUGIN_GCN_LIBS=\"-ldl\"\n+\t\tPLUGIN_GCN=1\n+\t\t;;\n+\t      esac\n+\t    ;;\n+\t  *-*-*)\n+\t    PLUGIN_GCN=0\n+\t     ;;\n+\tesac\n+\t;;\n       *)\n \tas_fn_error $? \"unknown offload target specified\" \"$LINENO\" 5\n \t;;\n@@ -15404,6 +15442,19 @@ cat >>confdefs.h <<_ACEOF\n #define PLUGIN_HSA $PLUGIN_HSA\n _ACEOF\n \n+ if test $PLUGIN_GCN = 1; then\n+  PLUGIN_GCN_TRUE=\n+  PLUGIN_GCN_FALSE='#'\n+else\n+  PLUGIN_GCN_TRUE='#'\n+  PLUGIN_GCN_FALSE=\n+fi\n+\n+\n+cat >>confdefs.h <<_ACEOF\n+#define PLUGIN_GCN $PLUGIN_GCN\n+_ACEOF\n+\n \n if test \"$HSA_RUNTIME_LIB\" != \"\"; then\n   HSA_RUNTIME_LIB=\"$HSA_RUNTIME_LIB/\"\n@@ -17122,6 +17173,10 @@ if test -z \"${PLUGIN_HSA_TRUE}\" && test -z \"${PLUGIN_HSA_FALSE}\"; then\n   as_fn_error $? \"conditional \\\"PLUGIN_HSA\\\" was never defined.\n Usually this means the macro was only invoked conditionally.\" \"$LINENO\" 5\n fi\n+if test -z \"${PLUGIN_GCN_TRUE}\" && test -z \"${PLUGIN_GCN_FALSE}\"; then\n+  as_fn_error $? \"conditional \\\"PLUGIN_GCN\\\" was never defined.\n+Usually this means the macro was only invoked conditionally.\" \"$LINENO\" 5\n+fi\n if test -z \"${LIBGOMP_BUILD_VERSIONED_SHLIB_TRUE}\" && test -z \"${LIBGOMP_BUILD_VERSIONED_SHLIB_FALSE}\"; then\n   as_fn_error $? \"conditional \\\"LIBGOMP_BUILD_VERSIONED_SHLIB\\\" was never defined.\n Usually this means the macro was only invoked conditionally.\" \"$LINENO\" 5"}, {"sha": "45ed043e333dfd38f2aa0893598477ef16472092", "filename": "libgomp/plugin/Makefrag.am", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fplugin%2FMakefrag.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fplugin%2FMakefrag.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2FMakefrag.am?ref=237957cc2c1818f30207f02747a880bd1cd28d0b", "patch": "@@ -52,3 +52,17 @@ libgomp_plugin_hsa_la_LDFLAGS += $(PLUGIN_HSA_LDFLAGS)\n libgomp_plugin_hsa_la_LIBADD = libgomp.la $(PLUGIN_HSA_LIBS)\n libgomp_plugin_hsa_la_LIBTOOLFLAGS = --tag=disable-static\n endif\n+\n+if PLUGIN_GCN\n+# AMD GCN plugin\n+libgomp_plugin_gcn_version_info = -version-info $(libtool_VERSION)\n+toolexeclib_LTLIBRARIES += libgomp-plugin-gcn.la\n+libgomp_plugin_gcn_la_SOURCES = plugin/plugin-gcn.c\n+libgomp_plugin_gcn_la_CPPFLAGS = $(AM_CPPFLAGS) $(PLUGIN_GCN_CPPFLAGS) \\\n+\t-D_GNU_SOURCE\n+libgomp_plugin_gcn_la_LDFLAGS = $(libgomp_plugin_gcn_version_info) \\\n+\t$(lt_host_flags)\n+libgomp_plugin_gcn_la_LDFLAGS += $(PLUGIN_GCN_LDFLAGS)\n+libgomp_plugin_gcn_la_LIBADD = libgomp.la $(PLUGIN_GCN_LIBS)\n+libgomp_plugin_gcn_la_LIBTOOLFLAGS = --tag=disable-static\n+endif"}, {"sha": "424ec6c96b2c5702fbe95134aaff3b8b6ef34f95", "filename": "libgomp/plugin/configfrag.ac", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fplugin%2Fconfigfrag.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fplugin%2Fconfigfrag.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fconfigfrag.ac?ref=237957cc2c1818f30207f02747a880bd1cd28d0b", "patch": "@@ -137,6 +137,15 @@ AC_SUBST(PLUGIN_HSA_CPPFLAGS)\n AC_SUBST(PLUGIN_HSA_LDFLAGS)\n AC_SUBST(PLUGIN_HSA_LIBS)\n \n+PLUGIN_GCN=0\n+PLUGIN_GCN_CPPFLAGS=\n+PLUGIN_GCN_LDFLAGS=\n+PLUGIN_GCN_LIBS=\n+AC_SUBST(PLUGIN_GCN)\n+AC_SUBST(PLUGIN_GCN_CPPFLAGS)\n+AC_SUBST(PLUGIN_GCN_LDFLAGS)\n+AC_SUBST(PLUGIN_GCN_LIBS)\n+\n # Parse '--enable-offload-targets', figure out the corresponding libgomp\n # plugins, and configure to find the corresponding offload compilers.\n # 'offload_plugins' and 'offload_targets' will be populated in the same order.\n@@ -237,6 +246,29 @@ if test x\"$enable_offload_targets\" != x; then\n             ;;\n         esac\n         ;;\n+\n+      amdgcn*)\n+\tcase \"${target}\" in\n+\t  x86_64-*-*)\n+\t    case \" ${CC} ${CFLAGS} \" in\n+\t      *\" -m32 \"*)\n+\t\tPLUGIN_GCN=0\n+\t\t;;\n+\t      *)\n+\t\ttgt_plugin=gcn\n+\t\tPLUGIN_GCN=$tgt\n+\t\tPLUGIN_GCN_CPPFLAGS=$HSA_RUNTIME_CPPFLAGS\n+\t\tPLUGIN_GCN_LDFLAGS=\"$HSA_RUNTIME_LDFLAGS\"\n+\t\tPLUGIN_GCN_LIBS=\"-ldl\"\n+\t\tPLUGIN_GCN=1\n+\t\t;;\n+\t      esac\n+\t    ;;\n+\t  *-*-*)\n+\t    PLUGIN_GCN=0\n+\t     ;;\n+\tesac\n+\t;;\n       *)\n \tAC_MSG_ERROR([unknown offload target specified])\n \t;;\n@@ -275,6 +307,9 @@ AC_DEFINE_UNQUOTED([PLUGIN_NVPTX_DYNAMIC], [$PLUGIN_NVPTX_DYNAMIC],\n AM_CONDITIONAL([PLUGIN_HSA], [test $PLUGIN_HSA = 1])\n AC_DEFINE_UNQUOTED([PLUGIN_HSA], [$PLUGIN_HSA],\n   [Define to 1 if the HSA plugin is built, 0 if not.])\n+AM_CONDITIONAL([PLUGIN_GCN], [test $PLUGIN_GCN = 1])\n+AC_DEFINE_UNQUOTED([PLUGIN_GCN], [$PLUGIN_GCN],\n+  [Define to 1 if the GCN plugin is built, 0 if not.])\n \n if test \"$HSA_RUNTIME_LIB\" != \"\"; then\n   HSA_RUNTIME_LIB=\"$HSA_RUNTIME_LIB/\""}, {"sha": "583916759a5806a2148b7002923d274b43bca527", "filename": "libgomp/plugin/plugin-gcn.c", "status": "added", "additions": 3985, "deletions": 0, "changes": 3985, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fplugin%2Fplugin-gcn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Fplugin%2Fplugin-gcn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fplugin-gcn.c?ref=237957cc2c1818f30207f02747a880bd1cd28d0b"}, {"sha": "6dc6ab538650a00b6d41f765f6e13a88a486c901", "filename": "libgomp/testsuite/Makefile.in", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/237957cc2c1818f30207f02747a880bd1cd28d0b/libgomp%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2FMakefile.in?ref=237957cc2c1818f30207f02747a880bd1cd28d0b", "patch": "@@ -207,6 +207,10 @@ PACKAGE_URL = @PACKAGE_URL@\n PACKAGE_VERSION = @PACKAGE_VERSION@\n PATH_SEPARATOR = @PATH_SEPARATOR@\n PERL = @PERL@\n+PLUGIN_GCN = @PLUGIN_GCN@\n+PLUGIN_GCN_CPPFLAGS = @PLUGIN_GCN_CPPFLAGS@\n+PLUGIN_GCN_LDFLAGS = @PLUGIN_GCN_LDFLAGS@\n+PLUGIN_GCN_LIBS = @PLUGIN_GCN_LIBS@\n PLUGIN_HSA = @PLUGIN_HSA@\n PLUGIN_HSA_CPPFLAGS = @PLUGIN_HSA_CPPFLAGS@\n PLUGIN_HSA_LDFLAGS = @PLUGIN_HSA_LDFLAGS@"}]}