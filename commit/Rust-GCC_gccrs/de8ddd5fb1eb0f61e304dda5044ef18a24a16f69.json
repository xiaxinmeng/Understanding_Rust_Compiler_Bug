{"sha": "de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGU4ZGRkNWZiMWViMGY2MWUzMDRkZGE1MDQ0ZWYxOGEyNGExNmY2OQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2015-09-30T11:26:44Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2015-09-30T11:26:44Z"}, "message": "re PR c/67730 (No warning when returning NULL in void function)\n\n\tPR c/67730\n\t* c-typeck.c (c_finish_return): Use the expansion point location for\n\tcertain \"return with value\" warnings.\n\n\t* gcc.dg/pr67730.c: New test.\n\nFrom-SVN: r228286", "tree": {"sha": "36db101171db6bb1d32a8f4bb020799de6660143", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36db101171db6bb1d32a8f4bb020799de6660143"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6ea2f74cf9dbee7a3e41d4c2bd3757a2ea303b8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ea2f74cf9dbee7a3e41d4c2bd3757a2ea303b8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ea2f74cf9dbee7a3e41d4c2bd3757a2ea303b8e"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "10ed324c9f5b23723eb4ec7400acaba61c4f2cf9", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "patch": "@@ -1,3 +1,9 @@\n+2015-09-30  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/67730\n+\t* c-typeck.c (c_finish_return): Use the expansion point location for\n+\tcertain \"return with value\" warnings.\n+\n 2015-09-18  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n \n \t* c-parser.c (pragma_lex): Add loc argument."}, {"sha": "a11ccb20b334ab7dd8c2a34727195044ad70257b", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "patch": "@@ -9369,8 +9369,12 @@ c_finish_return (location_t loc, tree retval, tree origtype)\n   bool npc = false;\n   size_t rank = 0;\n \n+  /* Use the expansion point to handle cases such as returning NULL\n+     in a function returning void.  */\n+  source_location xloc = expansion_point_location_if_in_system_header (loc);\n+\n   if (TREE_THIS_VOLATILE (current_function_decl))\n-    warning_at (loc, 0,\n+    warning_at (xloc, 0,\n \t\t\"function declared %<noreturn%> has a %<return%> statement\");\n \n   if (flag_cilkplus && contains_array_notation_expr (retval))\n@@ -9425,10 +9429,10 @@ c_finish_return (location_t loc, tree retval, tree origtype)\n     {\n       current_function_returns_null = 1;\n       if (TREE_CODE (TREE_TYPE (retval)) != VOID_TYPE)\n-\tpedwarn (loc, 0,\n+\tpedwarn (xloc, 0,\n \t\t \"%<return%> with a value, in function returning void\");\n       else\n-\tpedwarn (loc, OPT_Wpedantic, \"ISO C forbids \"\n+\tpedwarn (xloc, OPT_Wpedantic, \"ISO C forbids \"\n \t\t \"%<return%> with expression, in function returning void\");\n     }\n   else"}, {"sha": "8192f18808388b8b9d4b74b7a77d30d6a2314aeb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "patch": "@@ -1,3 +1,8 @@\n+2015-09-30  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c/67730\n+\t* gcc.dg/pr67730.c: New test.\n+\n 2015-09-30  Marek Polacek  <polacek@redhat.com>\n \n \tPR tree-optimization/67690"}, {"sha": "54d73a62cf86a82b2fd5da167c80f39a70c8eda4", "filename": "gcc/testsuite/gcc.dg/pr67730.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67730.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de8ddd5fb1eb0f61e304dda5044ef18a24a16f69/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67730.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr67730.c?ref=de8ddd5fb1eb0f61e304dda5044ef18a24a16f69", "patch": "@@ -0,0 +1,11 @@\n+/* PR c/67730 */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+#include <stddef.h>\n+\n+void\n+fn1 (void)\n+{\n+  return NULL; /* { dg-warning \"10:.return. with a value\" } */\n+}"}]}