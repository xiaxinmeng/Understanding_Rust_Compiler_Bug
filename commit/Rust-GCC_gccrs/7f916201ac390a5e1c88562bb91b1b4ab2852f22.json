{"sha": "7f916201ac390a5e1c88562bb91b1b4ab2852f22", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y5MTYyMDFhYzM5MGE1ZTFjODg1NjJiYjkxYjFiNGFiMjg1MmYyMg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-05-05T09:33:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-05-05T09:34:45Z"}, "message": "x86: Fix *vec_dupv4hi constraints [PR94942]\n\nThis insn and split splits into HI->V?HImode broadcast for avx2 and later,\nbut either the operands need to be %xmm0-%xmm15 (i.e. VEX encoded insn), or\nthe insn needs both AVX512BW and AVX512VL.\nNow, Yv constraint is v for AVX512VL and x otherwise, so for -mavx512vl -mno-avx512bw\nwe ICE if we end up with a %xmm16+ register from RA.\nYw constraint is v for AVX512VL and AVX512BW and nothing otherwise, so\nin this pattern we actually need xYw.\n\n2020-05-05  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/94942\n\t* config/i386/mmx.md (*vec_dupv4hi): Use xYw constraints instead of Yv.\n\n\t* gcc.target/i386/pr94942.c: New test.", "tree": {"sha": "218478458e80d07e1710f98fb7d615addd288030", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/218478458e80d07e1710f98fb7d615addd288030"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f916201ac390a5e1c88562bb91b1b4ab2852f22", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f916201ac390a5e1c88562bb91b1b4ab2852f22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f916201ac390a5e1c88562bb91b1b4ab2852f22", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f916201ac390a5e1c88562bb91b1b4ab2852f22/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6d938a5d770d0e94ecd923d20006b05126659235", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d938a5d770d0e94ecd923d20006b05126659235", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d938a5d770d0e94ecd923d20006b05126659235"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "b796203aed6bfa2c3e6c2c0af61882822fa1e6e0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7f916201ac390a5e1c88562bb91b1b4ab2852f22", "patch": "@@ -1,5 +1,8 @@\n 2020-05-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/94942\n+\t* config/i386/mmx.md (*vec_dupv4hi): Use xYw constraints instead of Yv.\n+\n \tPR tree-optimization/94914\n \t* match.pd ((((type)A * B) >> prec) != 0 to .MUL_OVERFLOW(A, B) != 0):\n \tNew simplification."}, {"sha": "472f90f9bc138d073a3ecce6278d06b7f835c2b2", "filename": "gcc/config/i386/mmx.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2Fconfig%2Fi386%2Fmmx.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2Fconfig%2Fi386%2Fmmx.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fmmx.md?ref=7f916201ac390a5e1c88562bb91b1b4ab2852f22", "patch": "@@ -1613,10 +1613,10 @@\n    (set_attr \"mode\" \"DI\")])\n \n (define_insn_and_split \"*vec_dupv4hi\"\n-  [(set (match_operand:V4HI 0 \"register_operand\" \"=y,Yv,Yw\")\n+  [(set (match_operand:V4HI 0 \"register_operand\" \"=y,xYw,Yw\")\n \t(vec_duplicate:V4HI\n \t  (truncate:HI\n-\t    (match_operand:SI 1 \"register_operand\" \"0,Yv,r\"))))]\n+\t    (match_operand:SI 1 \"register_operand\" \"0,xYw,r\"))))]\n   \"(TARGET_MMX || TARGET_MMX_WITH_SSE)\n    && (TARGET_SSE || TARGET_3DNOW_A)\"\n   \"@"}, {"sha": "6475b7d6ff46224e8520606dc8aa1b0d4632ed39", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7f916201ac390a5e1c88562bb91b1b4ab2852f22", "patch": "@@ -1,5 +1,8 @@\n 2020-05-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/94942\n+\t* gcc.target/i386/pr94942.c: New test.\n+\n \tPR tree-optimization/94914\n \t* gcc.target/i386/pr94914.c: New test.\n "}, {"sha": "b20f7a62e91c5e177bac9dce75686b7cbeb34380", "filename": "gcc/testsuite/gcc.target/i386/pr94942.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr94942.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f916201ac390a5e1c88562bb91b1b4ab2852f22/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr94942.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr94942.c?ref=7f916201ac390a5e1c88562bb91b1b4ab2852f22", "patch": "@@ -0,0 +1,24 @@\n+/* PR target/94942 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O -flive-range-shrinkage -ftree-vrp -mavx512vl -mno-avx512bw -Wno-div-by-zero\" } */\n+\n+typedef unsigned __attribute__((__vector_size__(8))) U;\n+typedef short __attribute__((__vector_size__(8))) V;\n+typedef char __attribute__((__vector_size__(16))) W;\n+typedef int __attribute__((__vector_size__(16))) Z;\n+int i, j, n, o;\n+W k;\n+Z l;\n+char m;\n+\n+U\n+foo (U q, long long r, V s)\n+{\n+  Z t = (i & i - (Z){10} & 4) - (0 != j);\n+  Z u = o * (j * l);\n+  s -= (char)__builtin_clrsbll (n);\n+  W v = (k | k >> m + (W){4}) % 0;\n+  W w = v + (W)t + (W)u;\n+  U x = ((union { W a; U b; })w).b + q + (U)s + (U)r;\n+  return x;\n+}"}]}