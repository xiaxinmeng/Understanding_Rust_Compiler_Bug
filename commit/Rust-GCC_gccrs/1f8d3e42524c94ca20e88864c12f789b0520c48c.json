{"sha": "1f8d3e42524c94ca20e88864c12f789b0520c48c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWY4ZDNlNDI1MjRjOTRjYTIwZTg4ODY0YzEyZjc4OWIwNTIwYzQ4Yw==", "commit": {"author": {"name": "Dominik Vogt", "email": "vogt@linux.vnet.ibm.com", "date": "2015-05-29T14:26:56Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2015-05-29T14:26:56Z"}, "message": "PR 66215: S390: Fix placement of post-label NOPs with -mhotpatch\n\ngcc/ChangeLog:\n\t    PR target/66215\n\t    * config/s390/s390.c (s390_reorg): Fix placement of post-label NOPs\n\t    with -mhotpatch=.\n\ngcc/testsuite/ChangeLog:\n\t    PR target/66215\n\t    * gcc.target/s390/hotpatch-1.c: Remove optimization options from\n\t    dg-options.\n\t    * gcc.target/s390/hotpatch-10.c: Likewise.\n\t    * gcc.target/s390/hotpatch-11.c: Likewise.\n\t    * gcc.target/s390/hotpatch-12.c: Likewise.\n\t    * gcc.target/s390/hotpatch-17.c: Likewise.\n\t    * gcc.target/s390/hotpatch-18.c: Likewise.\n\t    * gcc.target/s390/hotpatch-20.c: Likewise.\n\t    * gcc.target/s390/hotpatch-21.c: Likewise.\n\t    * gcc.target/s390/hotpatch-22.c: Likewise.\n\t    * gcc.target/s390/hotpatch-23.c: Likewise.\n\t    * gcc.target/s390/hotpatch-24.c: Likewise.\n\t    * gcc.target/s390/hotpatch-2.c: Likewise.  Adjust scan-assembler\n\t    to check for the exact nops too.\n\t    * gcc.target/s390/hotpatch-3.c: Likewise.\n\t    * gcc.target/s390/hotpatch-4.c: Likewise.\n\t    * gcc.target/s390/hotpatch-5.c: Likewise.\n\t    * gcc.target/s390/hotpatch-6.c: Likewise.\n\t    * gcc.target/s390/hotpatch-7.c: Likewise.\n\t    * gcc.target/s390/hotpatch-8.c: Likewise.\n\t    * gcc.target/s390/hotpatch-9.c: Likewise.\n\t    * gcc.target/s390/hotpatch-14.c: Likewise.\n\t    * gcc.target/s390/hotpatch-15.c: Likewise.\n\t    * gcc.target/s390/hotpatch-16.c: Likewise.\n\t    * gcc.target/s390/hotpatch-19.c: Likewise.\n\t    * gcc.target/s390/hotpatch-25.c: Likewise.  Remove\n\t    scan-assembler-times counting number of .align directives.\n\t    * gcc.target/s390/hotpatch-13.c: Remove optimization options from\n\t    dg-options.  Remove scan-assembler-times counting number of .align\n\t    directives.\n\t    * gcc.target/s390/hotpatch-26.c: New file.\n\t    * gcc.target/s390/hotpatch-27.c: New file.\n\t    * gcc.target/s390/hotpatch-28.c: New file.\n\t    * gcc.target/s390/s390.exp: Run hotpatch-*.c tests as torture tests\n\t    using -Os -O0 -O1 -O2 -O3 options.\n\nFrom-SVN: r223867", "tree": {"sha": "f81d3bad74a81a066164f6551e08803e5e73dbad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f81d3bad74a81a066164f6551e08803e5e73dbad"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1f8d3e42524c94ca20e88864c12f789b0520c48c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f8d3e42524c94ca20e88864c12f789b0520c48c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f8d3e42524c94ca20e88864c12f789b0520c48c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f8d3e42524c94ca20e88864c12f789b0520c48c/comments", "author": {"login": "vogtd", "id": 9690100, "node_id": "MDQ6VXNlcjk2OTAxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9690100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vogtd", "html_url": "https://github.com/vogtd", "followers_url": "https://api.github.com/users/vogtd/followers", "following_url": "https://api.github.com/users/vogtd/following{/other_user}", "gists_url": "https://api.github.com/users/vogtd/gists{/gist_id}", "starred_url": "https://api.github.com/users/vogtd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vogtd/subscriptions", "organizations_url": "https://api.github.com/users/vogtd/orgs", "repos_url": "https://api.github.com/users/vogtd/repos", "events_url": "https://api.github.com/users/vogtd/events{/privacy}", "received_events_url": "https://api.github.com/users/vogtd/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "75eb64433edb2a48c471c50e729612a326d1b1e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75eb64433edb2a48c471c50e729612a326d1b1e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75eb64433edb2a48c471c50e729612a326d1b1e9"}], "stats": {"total": 220, "additions": 165, "deletions": 55}, "files": [{"sha": "1d5989831a3e9e49ebd3ae4503ee96e84708c1b5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,3 +1,9 @@\n+2015-05-29  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\tPR target/66215\n+\t* config/s390/s390.c (s390_reorg): Fix placement of post-label NOPs\n+\twith -mhotpatch=.\n+\n 2015-05-29  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/66142"}, {"sha": "90d43b1498cccbc4de337775a5d1a2e0d44d7fea", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 17, "deletions": 11, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -12843,31 +12843,37 @@ s390_reorg (void)\n \n       /* Insert NOPs for hotpatching. */\n       for (insn = get_insns (); insn; insn = NEXT_INSN (insn))\n-\t{\n-\t  if (NOTE_P (insn) && NOTE_KIND (insn) == NOTE_INSN_FUNCTION_BEG)\n-\t    break;\n-\t}\n-      gcc_assert (insn);\n-      /* Output a series of NOPs after the NOTE_INSN_FUNCTION_BEG.  */\n-      while (hw_after > 0)\n+\t/* Emit NOPs\n+\t    1. inside the area covered by debug information to allow setting\n+\t       breakpoints at the NOPs,\n+\t    2. before any insn which results in an asm instruction,\n+\t    3. before in-function labels to avoid jumping to the NOPs, for\n+\t       example as part of a loop,\n+\t    4. before any barrier in case the function is completely empty\n+\t       (__builtin_unreachable ()) and has neither internal labels nor\n+\t       active insns.\n+\t*/\n+\tif (active_insn_p (insn) || BARRIER_P (insn) || LABEL_P (insn))\n+\t  break;\n+      /* Output a series of NOPs before the first active insn.  */\n+      while (insn && hw_after > 0)\n \t{\n \t  if (hw_after >= 3 && TARGET_CPU_ZARCH)\n \t    {\n-\t      insn = emit_insn_after (gen_nop_6_byte (), insn);\n+\t      emit_insn_before (gen_nop_6_byte (), insn);\n \t      hw_after -= 3;\n \t    }\n \t  else if (hw_after >= 2)\n \t    {\n-\t      insn = emit_insn_after (gen_nop_4_byte (), insn);\n+\t      emit_insn_before (gen_nop_4_byte (), insn);\n \t      hw_after -= 2;\n \t    }\n \t  else\n \t    {\n-\t      insn = emit_insn_after (gen_nop_2_byte (), insn);\n+\t      emit_insn_before (gen_nop_2_byte (), insn);\n \t      hw_after -= 1;\n \t    }\n \t}\n-      gcc_assert (hw_after == 0);\n     }\n }\n "}, {"sha": "2fe348afd8338b8f14394abf434a7f31520bdfbc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,3 +1,42 @@\n+2015-05-29  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\tPR target/66215\n+\t* gcc.target/s390/hotpatch-1.c: Remove optimization options from\n+\tdg-options.\n+\t* gcc.target/s390/hotpatch-10.c: Likewise.\n+\t* gcc.target/s390/hotpatch-11.c: Likewise.\n+\t* gcc.target/s390/hotpatch-12.c: Likewise.\n+\t* gcc.target/s390/hotpatch-17.c: Likewise.\n+\t* gcc.target/s390/hotpatch-18.c: Likewise.\n+\t* gcc.target/s390/hotpatch-20.c: Likewise.\n+\t* gcc.target/s390/hotpatch-21.c: Likewise.\n+\t* gcc.target/s390/hotpatch-22.c: Likewise.\n+\t* gcc.target/s390/hotpatch-23.c: Likewise.\n+\t* gcc.target/s390/hotpatch-24.c: Likewise.\n+\t* gcc.target/s390/hotpatch-2.c: Likewise.  Adjust scan-assembler\n+\tto check for the exact nops too.\n+\t* gcc.target/s390/hotpatch-3.c: Likewise.\n+\t* gcc.target/s390/hotpatch-4.c: Likewise.\n+\t* gcc.target/s390/hotpatch-5.c: Likewise.\n+\t* gcc.target/s390/hotpatch-6.c: Likewise.\n+\t* gcc.target/s390/hotpatch-7.c: Likewise.\n+\t* gcc.target/s390/hotpatch-8.c: Likewise.\n+\t* gcc.target/s390/hotpatch-9.c: Likewise.\n+\t* gcc.target/s390/hotpatch-14.c: Likewise.\n+\t* gcc.target/s390/hotpatch-15.c: Likewise.\n+\t* gcc.target/s390/hotpatch-16.c: Likewise.\n+\t* gcc.target/s390/hotpatch-19.c: Likewise.\n+\t* gcc.target/s390/hotpatch-25.c: Likewise.  Remove\n+\tscan-assembler-times counting number of .align directives.\n+\t* gcc.target/s390/hotpatch-13.c: Remove optimization options from\n+\tdg-options.  Remove scan-assembler-times counting number of .align\n+\tdirectives.\n+\t* gcc.target/s390/hotpatch-26.c: New file.\n+\t* gcc.target/s390/hotpatch-27.c: New file.\n+\t* gcc.target/s390/hotpatch-28.c: New file.\n+\t* gcc.target/s390/s390.exp: Run hotpatch-*.c tests as torture tests\n+\tusing -Os -O0 -O1 -O2 -O3 options.\n+\n 2015-05-29  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* gcc.target/aarch64/vdup_lane_2.c: Close comment on final line."}, {"sha": "55088b8b65582ee91aa39c3f0bfd0251a8939933", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-1.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch\" } */\n+/* { dg-options \"-mzarch\" } */\n \n #include <stdio.h>\n "}, {"sha": "d2cb9a2ee86c5f91505af175cb30490bba81f4d5", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-10.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-10.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,0\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,0\" } */\n \n #include <stdio.h>\n "}, {"sha": "cabb9d263abdd0faa8fd0533b8a42ee41f51062c", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-11.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-11.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=1,0\" } */\n+/* { dg-options \"-mzarch -mhotpatch=1,0\" } */\n \n #include <stdio.h>\n "}, {"sha": "fc9adc3336941b2e2a80126c2a512af592a48f78", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-12.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-12.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-12.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-12.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=999,0\" } */\n+/* { dg-options \"-mzarch -mhotpatch=999,0\" } */\n \n #include <stdio.h>\n "}, {"sha": "b25fbd3f2aee4db7831d46309f0778df2dc13487", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-13.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-13.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-13.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-13.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch\" } */\n+/* { dg-options \"-mzarch\" } */\n \n #include <stdio.h>\n \n@@ -18,4 +18,3 @@ void hp1(void)\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n /* { dg-final { scan-assembler \"alignment for hotpatch\" } } */\n-/* { dg-final { scan-assembler-times \"\\.align\\t8\" 2 } } */"}, {"sha": "c387d6bf0638a75cdb619af792c8bf65ab00a088", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-14.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-14.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-14.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-14.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch\" } */\n+/* { dg-options \"-mzarch\" } */\n \n #include <stdio.h>\n \n@@ -13,7 +13,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "410106bb7ca294a24372d6f8316e675a46002691", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-15.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-15.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch\" } */\n+/* { dg-options \"-mzarch\" } */\n \n #include <stdio.h>\n \n@@ -13,7 +13,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "fa06fff491fa8def33116537e9fb49e863b497b0", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-16.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-16.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-16.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-16.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,0\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,0\" } */\n \n #include <stdio.h>\n \n@@ -13,7 +13,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "3ef7d69b57253e37b1cba8503c2ad25443a32da5", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-17.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-17.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-17.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-17.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=1,2\" } */\n+/* { dg-options \"-mzarch -mhotpatch=1,2\" } */\n \n #include <stdio.h>\n "}, {"sha": "c93af7fa99b0c4c37a93459042a3e671fe209b66", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-18.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-18.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-18.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-18.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=1,2 -mhotpatch=0,0\" } */\n+/* { dg-options \"-mzarch -mhotpatch=1,2 -mhotpatch=0,0\" } */\n \n #include <stdio.h>\n "}, {"sha": "c69b35e562a50fb9d6ab2f9a59e1b957fd6d1dff", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-19.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-19.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-19.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-19.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=1,2\" } */\n+/* { dg-options \"-mzarch -mhotpatch=1,2\" } */\n \n #include <stdio.h>\n \n@@ -19,7 +19,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "2a2665e258510fb2268a324935694255e2da018d", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-2.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-2.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,1\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,1\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(1 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(1 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nopr\\t\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "0a32a68993f434f9519567cdf76e0f5c350cddf1", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-20.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-20.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-20.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-20.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch\" } */\n+/* { dg-options \"-mzarch\" } */\n \n #include <stdio.h>\n "}, {"sha": "f6e90996ba9f297e98c429f4621c551d5c7c3bf4", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-21.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-21.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-21.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-21.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,1\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,1\" } */\n \n #include <stdio.h>\n "}, {"sha": "21f7d7e957a46b4a0f2faeeac41546d3e847557d", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-22.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-22.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-22.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-22.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,1 -falign-functions=1024\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,1 -falign-functions=1024\" } */\n \n #include <stdio.h>\n "}, {"sha": "6e149cc0b5aed82ce55faad8cf2c70e3caf08caf", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-23.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-23.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-23.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-23.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,1 -falign-functions=4096\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,1 -falign-functions=4096\" } */\n \n #include <stdio.h>\n "}, {"sha": "1e475917100a3c3b732e61d299c1ac9487de7d49", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-24.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-24.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-24.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-24.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,1 -falign-functions=2048\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,1 -falign-functions=2048\" } */\n \n #include <stdio.h>\n "}, {"sha": "e6cdbb6cb15605189a3f8da491b3834c3ce4064c", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-25.c", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-25.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-25.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-25.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch\" } */\n+/* { dg-options \"-mzarch\" } */\n \n typedef long (*fn_t)(void);\n \n@@ -25,9 +25,8 @@ fn_t outer(void)\n /* { dg-final { scan-assembler \"pre-label.*(1 halfwords)\" } } */\n /* { dg-final { scan-assembler \"pre-label.*(4 halfwords)\" } } */\n /* { dg-final { scan-assembler \"pre-label.*(16 halfwords)\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(8 halfwords)\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(32 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nopr\\t\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(8 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(32 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*brcl\\t0, 0\" } } */\n /* { dg-final { scan-assembler-times \"alignment for hotpatch\" 3 } } */\n-/* { dg-final { scan-assembler-times \"\\.align\\t8\" 6 } } */\n /* { dg-final { scan-assembler \"nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr.*\\n.*nopr\" } } */"}, {"sha": "eb95c26e25766729f18dba3b9ab7cfd60b2866ac", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-26.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-26.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-26.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-26.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -0,0 +1,17 @@\n+/* Functional tests for the function hotpatching feature.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mzarch -mhotpatch=1,2\" } */\n+\n+__attribute__ ((noreturn)) void hp1(void)\n+{\n+  __builtin_unreachable ();\n+}\n+\n+/* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n+/* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n+/* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n+/* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler \"alignment for hotpatch\" } } */"}, {"sha": "cdbd4caf90e18f2e12b114bc223232cc5c48c01c", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-27.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-27.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-27.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-27.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -0,0 +1,17 @@\n+/* Functional tests for the function hotpatching feature.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mzarch -mhotpatch=1,2\" } */\n+\n+__attribute__ ((noreturn)) void hp3(void)\n+{\n+  __builtin_unreachable ();\n+}\n+\n+/* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n+/* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n+/* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n+/* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler \"alignment for hotpatch\" } } */"}, {"sha": "9922daa8ac45376e3805e88263de7d2ed07428b0", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-28.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-28.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-28.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-28.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -0,0 +1,18 @@\n+/* Functional tests for the function hotpatching feature.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -mzarch -mhotpatch=1,2\" } */\n+\n+void hp1 (volatile unsigned int *i)\n+{\n+  for (;;)\n+    (*i)++;\n+}\n+\n+/* Check number of occurences of certain instructions.  */\n+/* { dg-final { scan-assembler \"pre-label NOPs\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n+/* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n+/* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n+/* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */\n+/* { dg-final { scan-assembler \"alignment for hotpatch\" } } */"}, {"sha": "671859116d480fdd87270ab6b7bc5216e202dfd5", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-3.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-3.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,2\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,2\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(2 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(2 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "b770d4bd671d7ac91f0bca1772ce182554e41f90", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-4.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-4.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,3\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,3\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(3 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(3 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*brcl\\t0, 0\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 1 } } */"}, {"sha": "f1dcd89def6ad0ee25e45a41f9851d7c8c7cd1a6", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-5.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-5.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,4\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,4\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(4 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(4 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*brcl\\t0, 0\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 1 } } */"}, {"sha": "6203a72ba2edae73a7a53dff20213ddafd8c2bc4", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-6.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-6.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,5\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,5\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(5 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(5 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*brcl\\t0, 0\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 1 } } */"}, {"sha": "e201ae940e6874ece6afab1f779413458841e875", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-7.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-7.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile } */\n-/* { dg-options \"-O3 -mzarch -mhotpatch=0,6\" } */\n+/* { dg-options \"-mzarch -mhotpatch=0,6\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(6 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(6 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*brcl\\t0, 0\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-not \"nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"brcl\\t0, 0\" 2 } } */"}, {"sha": "1ea3160c0f2ee2f910c7fbb66e22c879bd4adf6f", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-8.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-8.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile { target { ! lp64 } } } */\n-/* { dg-options \"-O3 -mesa -march=g5 -mhotpatch=0,3\" } */\n+/* { dg-options \"-mesa -march=g5 -mhotpatch=0,3\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(3 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(3 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-times \"nopr\\t%r7\" 1 } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 1 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "e30f2762d33575ec9165c03465c926c3cdf8e14a", "filename": "gcc/testsuite/gcc.target/s390/hotpatch-9.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fhotpatch-9.c?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -1,7 +1,7 @@\n /* Functional tests for the function hotpatching feature.  */\n \n /* { dg-do compile { target { ! lp64 } } } */\n-/* { dg-options \"-O3 -mesa -march=g5 -mhotpatch=0,4\" } */\n+/* { dg-options \"-mesa -march=g5 -mhotpatch=0,4\" } */\n \n #include <stdio.h>\n \n@@ -12,7 +12,7 @@ void hp1(void)\n \n /* Check number of occurences of certain instructions.  */\n /* { dg-final { scan-assembler-not \"pre-label NOPs\" } } */\n-/* { dg-final { scan-assembler \"post-label.*(4 halfwords)\" } } */\n+/* { dg-final { scan-assembler \"^\\[^.\\].*:\\n.*post-label.*(4 halfwords).*\\n\\(\\(.L.*:\\n\\)\\|\\(\\[\\[:space:\\]\\]*.cfi_.*\\n\\)\\)*\\[\\[:space:\\]\\]*nop\\t0\" } } */\n /* { dg-final { scan-assembler-not \"nopr\\t%r7\" } } */\n /* { dg-final { scan-assembler-times \"nop\\t0\" 2 } } */\n /* { dg-final { scan-assembler-not \"brcl\\t0, 0\" } } */"}, {"sha": "0b8f80ed6692e32ced08298196a5e80810f59dc8", "filename": "gcc/testsuite/gcc.target/s390/s390.exp", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fs390.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1f8d3e42524c94ca20e88864c12f789b0520c48c/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fs390.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fs390.exp?ref=1f8d3e42524c94ca20e88864c12f789b0520c48c", "patch": "@@ -61,12 +61,21 @@ if ![info exists DEFAULT_CFLAGS] then {\n # Initialize `dg'.\n dg-init\n \n+set hotpatch_tests $srcdir/$subdir/hotpatch-\\[0-9\\]*.c\n+\n # Main loop.\n-dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.\\[cS\\]]] \\\n-\t\"\" $DEFAULT_CFLAGS\n+dg-runtest [lsort [prune [glob -nocomplain $srcdir/$subdir/*.\\[cS\\]] \\\n+\t\t\t $hotpatch_tests]] \"\" $DEFAULT_CFLAGS\n \n dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*vector*/*.\\[cS\\]]] \\\n \t\"\" $DEFAULT_CFLAGS\n \n+# Additional hotpatch torture tests.\n+torture-init\n+set HOTPATCH_TEST_OPTS [list -Os -O0 -O1 -O2 -O3]\n+set-torture-options $HOTPATCH_TEST_OPTS\n+gcc-dg-runtest [lsort [glob -nocomplain $hotpatch_tests]] \"\" $DEFAULT_CFLAGS\n+torture-finish\n+\n # All done.\n dg-finish"}]}