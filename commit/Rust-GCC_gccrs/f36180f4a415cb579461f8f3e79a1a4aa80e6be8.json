{"sha": "f36180f4a415cb579461f8f3e79a1a4aa80e6be8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjM2MTgwZjRhNDE1Y2I1Nzk0NjFmOGYzZTc5YTFhNGFhODBlNmJlOA==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2018-01-13T19:32:04Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2018-01-13T19:32:04Z"}, "message": "predict.c (determine_unlikely_bbs): Handle correctly BBs which appears in the queue multiple times.\n\n\t* predict.c (determine_unlikely_bbs): Handle correctly BBs\n\twhich appears in the queue multiple times.\n\nFrom-SVN: r256648", "tree": {"sha": "74423b123d83963345d78c0b2f20c0b53f441929", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74423b123d83963345d78c0b2f20c0b53f441929"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f36180f4a415cb579461f8f3e79a1a4aa80e6be8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f36180f4a415cb579461f8f3e79a1a4aa80e6be8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f36180f4a415cb579461f8f3e79a1a4aa80e6be8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f36180f4a415cb579461f8f3e79a1a4aa80e6be8/comments", "author": null, "committer": null, "parents": [{"sha": "39f309aca6e6b756ffab4222ffc39094042b9413", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39f309aca6e6b756ffab4222ffc39094042b9413", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39f309aca6e6b756ffab4222ffc39094042b9413"}], "stats": {"total": 11, "additions": 9, "deletions": 2}, "files": [{"sha": "bcc77eb28d9e03a69880d34695275aa35f427749", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f36180f4a415cb579461f8f3e79a1a4aa80e6be8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f36180f4a415cb579461f8f3e79a1a4aa80e6be8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f36180f4a415cb579461f8f3e79a1a4aa80e6be8", "patch": "@@ -1,3 +1,8 @@\n+2018-01-13  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* predict.c (determine_unlikely_bbs): Handle correctly BBs\n+\twhich appears in the queue multiple times.\n+\n 2018-01-13  Richard Sandiford  <richard.sandiford@linaro.org>\n \t    Alan Hayward  <alan.hayward@arm.com>\n \t    David Sherwood  <david.sherwood@arm.com>"}, {"sha": "4c1e4489b55db8fdd1624ed41cc1ed160b8fa9a6", "filename": "gcc/predict.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f36180f4a415cb579461f8f3e79a1a4aa80e6be8/gcc%2Fpredict.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f36180f4a415cb579461f8f3e79a1a4aa80e6be8/gcc%2Fpredict.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpredict.c?ref=f36180f4a415cb579461f8f3e79a1a4aa80e6be8", "patch": "@@ -3565,6 +3565,8 @@ determine_unlikely_bbs ()\n   while (worklist.length () > 0)\n     {\n       bb = worklist.pop ();\n+      if (bb->count == profile_count::zero ())\n+\tcontinue;\n       if (bb != ENTRY_BLOCK_PTR_FOR_FN (cfun))\n \t{\n \t  bool found = false;\n@@ -3583,8 +3585,7 @@ determine_unlikely_bbs ()\n \t  if (found)\n \t    continue;\n \t}\n-      if (!(bb->count == profile_count::zero ())\n-\t  && (dump_file && (dump_flags & TDF_DETAILS)))\n+      if (dump_file && (dump_flags & TDF_DETAILS))\n \tfprintf (dump_file,\n \t\t \"Basic block %i is marked unlikely by backward prop\\n\",\n \t\t bb->index);\n@@ -3594,6 +3595,7 @@ determine_unlikely_bbs ()\n \t  {\n \t    if (!(e->src->count == profile_count::zero ()))\n \t      {\n+\t\tgcc_checking_assert (nsuccs[e->src->index] > 0);\n \t        nsuccs[e->src->index]--;\n \t        if (!nsuccs[e->src->index])\n \t\t  worklist.safe_push (e->src);"}]}