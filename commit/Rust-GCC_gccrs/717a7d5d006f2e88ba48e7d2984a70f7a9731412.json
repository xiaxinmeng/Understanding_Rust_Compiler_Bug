{"sha": "717a7d5d006f2e88ba48e7d2984a70f7a9731412", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzE3YTdkNWQwMDZmMmU4OGJhNDhlN2QyOTg0YTcwZjdhOTczMTQxMg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2004-08-19T20:16:01Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2004-08-19T20:16:01Z"}, "message": "re PR c++/15890 (internal compiler error: in c_expand_expr, at c-common.c:4138)\n\n\tPR c++/15890\n\t* pt.c (push_template_decl_real): Disallow template allocation\n\tfunctions with fewer than two parameters.\n\n\tPR c++/15890\n\t* g++.dg/template/delete1.C: New test.\n\nFrom-SVN: r86265", "tree": {"sha": "273fa4f96609c1b0301158a2d78367905e2451c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/273fa4f96609c1b0301158a2d78367905e2451c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/717a7d5d006f2e88ba48e7d2984a70f7a9731412", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/717a7d5d006f2e88ba48e7d2984a70f7a9731412", "html_url": "https://github.com/Rust-GCC/gccrs/commit/717a7d5d006f2e88ba48e7d2984a70f7a9731412", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/717a7d5d006f2e88ba48e7d2984a70f7a9731412/comments", "author": null, "committer": null, "parents": [{"sha": "5815280853df205cee38d4d9226856e1dba00685", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5815280853df205cee38d4d9226856e1dba00685", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5815280853df205cee38d4d9226856e1dba00685"}], "stats": {"total": 59, "additions": 50, "deletions": 9}, "files": [{"sha": "5f63d12b0eb022fe0e317f723dcb6b7b910a0f5f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=717a7d5d006f2e88ba48e7d2984a70f7a9731412", "patch": "@@ -1,3 +1,9 @@\n+2004-08-19  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/15890\n+\t* pt.c (push_template_decl_real): Disallow template allocation\n+\tfunctions with fewer than two parameters.\n+\n 2004-08-19  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* cp-tree.h (build_shared_int_cst): Remove."}, {"sha": "34ea3a6a53446627e172b7b0da0dc200cb3a9f7e", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 25, "deletions": 9, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=717a7d5d006f2e88ba48e7d2984a70f7a9731412", "patch": "@@ -2875,19 +2875,35 @@ push_template_decl_real (tree decl, int is_friend)\n       else if (TREE_CODE (decl) == TYPE_DECL \n \t       && ANON_AGGRNAME_P (DECL_NAME (decl))) \n \terror (\"template class without a name\");\n-      else if (TREE_CODE (decl) == FUNCTION_DECL\n-\t       && DECL_DESTRUCTOR_P (decl))\n+      else if (TREE_CODE (decl) == FUNCTION_DECL)\n \t{\n-\t  /* [temp.mem]\n-\t     \n-\t      A destructor shall not be a member template.  */\n-\t  error (\"destructor `%D' declared as member template\", decl);\n-\t  return error_mark_node;\n+\t  if (DECL_DESTRUCTOR_P (decl))\n+\t    {\n+\t      /* [temp.mem]\n+\t\t \n+\t         A destructor shall not be a member template.  */\n+\t      error (\"destructor `%D' declared as member template\", decl);\n+\t      return error_mark_node;\n+\t    }\n+\t  if (NEW_DELETE_OPNAME_P (DECL_NAME (decl))\n+\t      && (!TYPE_ARG_TYPES (TREE_TYPE (decl))\n+\t\t  || TYPE_ARG_TYPES (TREE_TYPE (decl)) == void_list_node\n+\t\t  || !TREE_CHAIN (TYPE_ARG_TYPES (TREE_TYPE (decl)))\n+\t\t  || (TREE_CHAIN (TYPE_ARG_TYPES ((TREE_TYPE (decl))))\n+\t\t      == void_list_node)))\n+\t    {\n+\t      /* [basic.stc.dynamic.allocation] \n+\n+\t         An allocation function can be a function\n+\t\t template. ... Template allocation functions shall\n+\t\t have two or more parameters.  */\n+\t      error (\"invalid template declaration of `%D'\", decl);\n+\t      return decl;\n+\t    }\n \t}\n       else if ((DECL_IMPLICIT_TYPEDEF_P (decl)\n \t\t&& CLASS_TYPE_P (TREE_TYPE (decl)))\n-\t       || (TREE_CODE (decl) == VAR_DECL && ctx && CLASS_TYPE_P (ctx))\n-\t       || TREE_CODE (decl) == FUNCTION_DECL)\n+\t       || (TREE_CODE (decl) == VAR_DECL && ctx && CLASS_TYPE_P (ctx)))\n \t/* OK */;\n       else\n \t{"}, {"sha": "7e639c105a2091da2a1591b50cea5fb2b1366abb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=717a7d5d006f2e88ba48e7d2984a70f7a9731412", "patch": "@@ -1,3 +1,8 @@\n+2004-08-19  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/15890\n+\t* g++.dg/template/delete1.C: New test.\n+\n 2004-08-19  Paul Brook  <paul@codesourcery.com>\n \n \tPR fortran/14976"}, {"sha": "fc532707451e02bea811a67c3bc6211dc065d7ff", "filename": "gcc/testsuite/g++.dg/template/delete1.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fdelete1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/717a7d5d006f2e88ba48e7d2984a70f7a9731412/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fdelete1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fdelete1.C?ref=717a7d5d006f2e88ba48e7d2984a70f7a9731412", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/15890\n+\n+template < typename T >\n+void operator delete ( void* raw ) { // { dg-error \"\" }\n+  delete raw;\n+}\n+\n+class A { };\n+\n+int main() {\n+  A* a = new A;\n+  delete a;\n+}\n+"}]}