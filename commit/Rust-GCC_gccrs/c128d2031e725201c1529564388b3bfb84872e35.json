{"sha": "c128d2031e725201c1529564388b3bfb84872e35", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzEyOGQyMDMxZTcyNTIwMWMxNTI5NTY0Mzg4YjNiZmI4NDg3MmUzNQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2012-07-03T19:24:07Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2012-07-03T19:24:07Z"}, "message": "re PR libstdc++/53840 ([C++11] DR 921. Rational Arithmetic should use template aliases)\n\n2012-07-03  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR libstdc++/53840\n\t* include/std/ratio (ratio_multiply, ratio_divide, ratio_add,\n\tratio_subtract): Use template aliases.\n\t* include/std/chrono (duration<>::duration(const duration<>&),\n\tduration_cast): Adjust.\n\t* testsuite/20_util/ratio/operations/53840.cc: New.\n\t* testsuite/20_util/duration/requirements/typedefs_neg1.cc: Adjust.\n\t* testsuite/20_util/duration/requirements/typedefs_neg2.cc: Likewise.\n\t* testsuite/20_util/duration/requirements/typedefs_neg3.cc: Likewise.\n\t* testsuite/20_util/ratio/operations/ops_overflow_neg.cc: Likewise.\n\nFrom-SVN: r189239", "tree": {"sha": "76d8012173d168c94a6139df0c0a26ff376e99ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/76d8012173d168c94a6139df0c0a26ff376e99ef"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c128d2031e725201c1529564388b3bfb84872e35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c128d2031e725201c1529564388b3bfb84872e35", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c128d2031e725201c1529564388b3bfb84872e35", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c128d2031e725201c1529564388b3bfb84872e35/comments", "author": null, "committer": null, "parents": [{"sha": "f5d306802cc5327d9ee94eeae84765dab89a0104", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5d306802cc5327d9ee94eeae84765dab89a0104", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5d306802cc5327d9ee94eeae84765dab89a0104"}], "stats": {"total": 116, "additions": 83, "deletions": 33}, "files": [{"sha": "35d6bbbc1e51991a72c41d087fca7fa95d3e86fe", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -1,3 +1,16 @@\n+2012-07-03  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR libstdc++/53840\n+\t* include/std/ratio (ratio_multiply, ratio_divide, ratio_add,\n+\tratio_subtract): Use template aliases.\n+\t* include/std/chrono (duration<>::duration(const duration<>&),\n+\tduration_cast): Adjust.\n+\t* testsuite/20_util/ratio/operations/53840.cc: New.\n+\t* testsuite/20_util/duration/requirements/typedefs_neg1.cc: Adjust.\n+\t* testsuite/20_util/duration/requirements/typedefs_neg2.cc: Likewise.\n+\t* testsuite/20_util/duration/requirements/typedefs_neg3.cc: Likewise.\n+\t* testsuite/20_util/ratio/operations/ops_overflow_neg.cc: Likewise.\n+\n 2012-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tRevert:"}, {"sha": "1931057d4cae24c25ce8461a049b9c6b6bba6b7b", "filename": "libstdc++-v3/include/std/chrono", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fchrono", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fchrono", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fchrono?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -1,6 +1,6 @@\n // <chrono> -*- C++ -*-\n \n-// Copyright (C) 2008, 2009, 2010, 2011 Free Software Foundation, Inc.\n+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -174,8 +174,7 @@ _GLIBCXX_END_NAMESPACE_VERSION\n       {\n \ttypedef typename _ToDur::period\t\t\t\t__to_period;\n \ttypedef typename _ToDur::rep\t\t\t\t__to_rep;\n-\ttypedef ratio_divide<_Period, __to_period> \t\t__r_div;\n-\ttypedef typename __r_div::type \t\t\t\t__cf;\n+\ttypedef ratio_divide<_Period, __to_period> \t\t__cf;\n \ttypedef typename common_type<__to_rep, _Rep, intmax_t>::type\n \t  \t\t\t\t\t\t\t__cr;\n \ttypedef  __duration_cast_impl<_ToDur, __cf, __cr,\n@@ -242,7 +241,7 @@ _GLIBCXX_END_NAMESPACE_VERSION\n \n \ttemplate<typename _Rep2, typename _Period2, typename = typename\n \t       enable_if<treat_as_floating_point<rep>::value\n-\t\t\t || (ratio_divide<_Period2, period>::type::den == 1\n+\t\t\t || (ratio_divide<_Period2, period>::den == 1\n \t\t\t     && !treat_as_floating_point<_Rep2>::value)>::type>\n \t  constexpr duration(const duration<_Rep2, _Period2>& __d)\n \t  : __r(duration_cast<duration>(__d).count()) { }"}, {"sha": "d36d1b2066f6b6d5a539fee42049b9fbad65a548", "filename": "libstdc++-v3/include/std/ratio", "status": "modified", "additions": 30, "deletions": 19, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fratio", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fratio", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fratio?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -1,6 +1,6 @@\n // ratio -*- C++ -*-\n \n-// Copyright (C) 2008, 2009, 2010, 2011 Free Software Foundation, Inc.\n+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the \n@@ -282,9 +282,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   template<intmax_t _Num, intmax_t _Den>\n     constexpr intmax_t ratio<_Num, _Den>::den;\n \n-  /// ratio_multiply\n   template<typename _R1, typename _R2>\n-    struct ratio_multiply\n+    struct __ratio_multiply\n     {\n     private:\n       static const intmax_t __gcd1 =\n@@ -304,18 +303,21 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     };\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_multiply<_R1, _R2>::num;\n+    constexpr intmax_t __ratio_multiply<_R1, _R2>::num;\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_multiply<_R1, _R2>::den;\n+    constexpr intmax_t __ratio_multiply<_R1, _R2>::den;\n+\n+  /// ratio_multiply\n+  template<typename _R1, typename _R2>\n+    using ratio_multiply = typename __ratio_multiply<_R1, _R2>::type;\n \n-  /// ratio_divide\n   template<typename _R1, typename _R2>\n-    struct ratio_divide\n+    struct __ratio_divide\n     {\n       static_assert(_R2::num != 0, \"division by 0\");\n \n-      typedef typename ratio_multiply<\n+      typedef typename __ratio_multiply<\n         _R1,\n         ratio<_R2::den, _R2::num>>::type type;\n \n@@ -324,10 +326,14 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     };\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_divide<_R1, _R2>::num;\n+    constexpr intmax_t __ratio_divide<_R1, _R2>::num;\n+\n+  template<typename _R1, typename _R2>\n+    constexpr intmax_t __ratio_divide<_R1, _R2>::den;\n \n+  /// ratio_divide\n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_divide<_R1, _R2>::den;\n+    using ratio_divide = typename __ratio_divide<_R1, _R2>::type;\n \n   /// ratio_equal\n   template<typename _R1, typename _R2>\n@@ -464,26 +470,28 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       typedef ratio<__n_final::__quot_lo, __d_final::__lo> type;\n     };\n \n-  /// ratio_add\n   template<typename _R1, typename _R2>\n-    struct ratio_add\n+    struct __ratio_add\n     {\n       typedef typename __ratio_add_impl<_R1, _R2>::type type;\n       static constexpr intmax_t num = type::num;\n       static constexpr intmax_t den = type::den;\n     };\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_add<_R1, _R2>::num;\n+    constexpr intmax_t __ratio_add<_R1, _R2>::num;\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_add<_R1, _R2>::den;\n+    constexpr intmax_t __ratio_add<_R1, _R2>::den;\n \n-  /// ratio_subtract\n+  /// ratio_add\n   template<typename _R1, typename _R2>\n-    struct ratio_subtract\n+    using ratio_add = typename __ratio_add<_R1, _R2>::type;\n+\n+  template<typename _R1, typename _R2>\n+    struct __ratio_subtract\n     {\n-      typedef typename ratio_add<\n+      typedef typename __ratio_add<\n         _R1,\n         ratio<-_R2::num, _R2::den>>::type type;\n \n@@ -492,11 +500,14 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     };\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_subtract<_R1, _R2>::num;\n+    constexpr intmax_t __ratio_subtract<_R1, _R2>::num;\n \n   template<typename _R1, typename _R2>\n-    constexpr intmax_t ratio_subtract<_R1, _R2>::den;\n+    constexpr intmax_t __ratio_subtract<_R1, _R2>::den;\n \n+  /// ratio_subtract\n+  template<typename _R1, typename _R2>\n+    using ratio_subtract = typename __ratio_subtract<_R1, _R2>::type;\n \n \n   typedef ratio<1,       1000000000000000000> atto;"}, {"sha": "a3671b0cfe164d3cca8cc1f5f562a4822a03422e", "filename": "libstdc++-v3/testsuite/20_util/duration/requirements/typedefs_neg1.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg1.cc?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -3,7 +3,7 @@\n // { dg-require-cstdint \"\" }\n // 2008-07-31 Chris Fairles <chris.fairles@gmail.com>\n \n-// Copyright (C) 2008, 2009, 2010, 2011 Free Software Foundation, Inc.\n+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -31,5 +31,5 @@ void test01()\n   test_type d;\n }\n \n-// { dg-error \"rep cannot be a duration\" \"\" { target *-*-* } 226 }\n+// { dg-error \"rep cannot be a duration\" \"\" { target *-*-* } 225 }\n // { dg-error \"required from here\" \"\" { target *-*-* } 31 }"}, {"sha": "17d24e5bb132ffce4634702943385ad0b510d0af", "filename": "libstdc++-v3/testsuite/20_util/duration/requirements/typedefs_neg2.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg2.cc?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -3,7 +3,7 @@\n // { dg-require-cstdint \"\" }\n // 2008-07-31 Chris Fairles <chris.fairles@gmail.com>\n \n-// Copyright (C) 2008, 2009, 2010 Free Software Foundation, Inc.\n+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -32,5 +32,5 @@ void test01()\n   test_type d;\t\t\t// { dg-error \"required from here\" }\n }\n \n-// { dg-error \"must be a specialization of ratio\" \"\" { target *-*-* } 227 }\n+// { dg-error \"must be a specialization of ratio\" \"\" { target *-*-* } 226 }\n // { dg-prune-output \"not a member\" }"}, {"sha": "4b2df490d1a99edacf6b1df24fbfc89390ced243", "filename": "libstdc++-v3/testsuite/20_util/duration/requirements/typedefs_neg3.cc", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg3.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg3.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fduration%2Frequirements%2Ftypedefs_neg3.cc?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -3,7 +3,7 @@\n // { dg-require-cstdint \"\" }\n // 2008-07-31 Chris Fairles <chris.fairles@gmail.com>\n \n-// Copyright (C) 2008, 2009, 2010, 2011 Free Software Foundation, Inc.\n+// Copyright (C) 2008, 2009, 2010, 2011, 2012 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -33,5 +33,5 @@ void test01()\n   test_type d;\n }\n \n-// { dg-error \"period must be positive\" \"\" { target *-*-* } 229 }\n+// { dg-error \"period must be positive\" \"\" { target *-*-* } 228 }\n // { dg-error \"required from here\" \"\" { target *-*-* } 33 }"}, {"sha": "780c321db77d45bbda686a294b9e2bc7f68417df", "filename": "libstdc++-v3/testsuite/20_util/ratio/operations/53840.cc", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Foperations%2F53840.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Foperations%2F53840.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Foperations%2F53840.cc?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -0,0 +1,27 @@\n+// { dg-options \"-std=gnu++0x\" }\n+// { dg-require-cstdint \"\" }\n+// { dg-do compile }\n+\n+// Copyright (C) 2012 Free Software Foundation\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License\n+// along with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+#include <chrono>\n+\n+std::chrono::duration<long, std::ratio_divide<std::kilo, std::milli>>   d1;\n+std::chrono::duration<long, std::ratio_multiply<std::kilo, std::milli>> d2;\n+std::chrono::duration<long, std::ratio_add<std::kilo, std::milli>>      d3;\n+std::chrono::duration<long, std::ratio_subtract<std::kilo, std::milli>> d4;"}, {"sha": "150aef6d5c21249ee9478a49621f78eccef8cca8", "filename": "libstdc++-v3/testsuite/20_util/ratio/operations/ops_overflow_neg.cc", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Foperations%2Fops_overflow_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c128d2031e725201c1529564388b3bfb84872e35/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Foperations%2Fops_overflow_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fratio%2Foperations%2Fops_overflow_neg.cc?ref=c128d2031e725201c1529564388b3bfb84872e35", "patch": "@@ -4,7 +4,7 @@\n \n // 2008-07-03 Chris Fairles <chris.fairles@gmail.com>\n \n-// Copyright (C) 2008, 2009, 2011 Free Software Foundation\n+// Copyright (C) 2008, 2009, 2011, 2012 Free Software Foundation\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -40,9 +40,9 @@ test02()\n }\n \n // { dg-error \"required from here\" \"\" { target *-*-* } 29 }\n-// { dg-error \"required from here\" \"\" { target *-*-* } 36 }\n-// { dg-error \"required from here\" \"\" { target *-*-* } 38 }\n-// { dg-error \"overflow in addition\" \"\" { target *-*-* } 429 }\n+// { dg-error \"expected initializer\" \"\" { target *-*-* } 36 }\n+// { dg-error \"expected initializer\" \"\" { target *-*-* } 38 }\n+// { dg-error \"overflow in addition\" \"\" { target *-*-* } 435 }\n // { dg-error \"overflow in multiplication\" \"\" { target *-*-* } 97 }\n // { dg-error \"overflow in multiplication\" \"\" { target *-*-* } 99 }\n // { dg-error \"overflow in multiplication\" \"\" { target *-*-* } 101 }"}]}