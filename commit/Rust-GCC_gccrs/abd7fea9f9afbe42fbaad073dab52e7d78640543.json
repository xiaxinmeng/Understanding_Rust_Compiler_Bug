{"sha": "abd7fea9f9afbe42fbaad073dab52e7d78640543", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWJkN2ZlYTlmOWFmYmU0MmZiYWFkMDczZGFiNTJlN2Q3ODY0MDU0Mw==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobias.schlueter@physik.uni-muenchen.de", "date": "2004-12-02T19:39:15Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2004-12-02T19:39:15Z"}, "message": "re PR libfortran/18710 (img part of complex number not written to direct access file)\n\nlibgfortran/\nPR fortran/18710\n* io/transfer.c (unformatted_read, unformatted_write): width of\na COMPLEX is twice its kind.\n\ngcc/testsuite/\nPR fortran/18170\n* gfortran.dg/direct_io_3.f90: New test.\n\nFrom-SVN: r91656", "tree": {"sha": "05580d191473440752eaeddfac5929d59504e771", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/05580d191473440752eaeddfac5929d59504e771"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/abd7fea9f9afbe42fbaad073dab52e7d78640543", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abd7fea9f9afbe42fbaad073dab52e7d78640543", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abd7fea9f9afbe42fbaad073dab52e7d78640543", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abd7fea9f9afbe42fbaad073dab52e7d78640543/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0396df8ac45acfbace58f00234eed18303387b7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0396df8ac45acfbace58f00234eed18303387b7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0396df8ac45acfbace58f00234eed18303387b7b"}], "stats": {"total": 49, "additions": 46, "deletions": 3}, "files": [{"sha": "7cb1ad6d59ba4af8c816c25c62c6952998e6e64b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abd7fea9f9afbe42fbaad073dab52e7d78640543/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abd7fea9f9afbe42fbaad073dab52e7d78640543/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=abd7fea9f9afbe42fbaad073dab52e7d78640543", "patch": "@@ -1,3 +1,8 @@\n+2004-12-02  Tobias Schlueter  <tobias.schlueter@physik.uni-muenchen.de>\n+\n+\tPR fortran/18170\n+\t* gfortran.dg/direct_io_3.f90: New test.\n+\n 2004-12-02  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tPR 18758"}, {"sha": "8603a833e12e1c44d784f5e3f6f45e354b9dcfb2", "filename": "gcc/testsuite/gfortran.dg/direct_io_3.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abd7fea9f9afbe42fbaad073dab52e7d78640543/gcc%2Ftestsuite%2Fgfortran.dg%2Fdirect_io_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abd7fea9f9afbe42fbaad073dab52e7d78640543/gcc%2Ftestsuite%2Fgfortran.dg%2Fdirect_io_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdirect_io_3.f90?ref=abd7fea9f9afbe42fbaad073dab52e7d78640543", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do run }\n+! PR 18710 : We used to not read and write the imaginary part of \n+! complex numbers\n+       COMPLEX C, D\n+       DOUBLE COMPLEX E, F\n+\n+       OPEN(UNIT=9,FILE='PR18710',ACCESS='DIRECT',RECL=132)\n+\n+       C = (120.0,240.0)\n+       WRITE(9,REC=1)C\n+       READ(9,REC=1)D\n+       if (c /= d) call abort()\n+\n+       E = (120.0,240.0)\n+       WRITE(9,REC=1)E\n+       READ(9,REC=1)F\n+       if (E /= F) call abort()\n+\n+       CLOSE(UNIT=9,STATUS='DELETE')\n+       END"}, {"sha": "4dfb3355341124c3af3fc5220f4cfdb5082763b6", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abd7fea9f9afbe42fbaad073dab52e7d78640543/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abd7fea9f9afbe42fbaad073dab52e7d78640543/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=abd7fea9f9afbe42fbaad073dab52e7d78640543", "patch": "@@ -1,3 +1,9 @@\n+2004-12-02  Tobias Schlueter  <tobias.schlueter@physik.uni-muenchen.de>\n+\n+\tPR fortran/18710\n+\t* io/transfer.c (unformatted_read, unformatted_write): width of\n+\ta COMPLEX is twice its kind.\n+\n 2004-12-02  Richard Sandiford  <rsandifo@redhat.com>\n \n \t* configure.ac: Use TL_AC_GCC_VERSION to set gcc_version."}, {"sha": "c27f0f7bb83d8fc4d7a89e091f0cc48648b612cb", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/abd7fea9f9afbe42fbaad073dab52e7d78640543/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/abd7fea9f9afbe42fbaad073dab52e7d78640543/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=abd7fea9f9afbe42fbaad073dab52e7d78640543", "patch": "@@ -271,6 +271,13 @@ unformatted_read (bt type, void *dest, int length)\n {\n   void *source;\n   int w;\n+\n+  /* Transfer functions get passed the kind of the entity, so we have\n+     to fix this for COMPLEX data which are twice the size of their\n+     kind.  */\n+  if (type == BT_COMPLEX)\n+    length *= 2;\n+\n   w = length;\n   source = read_block (&w);\n \n@@ -288,9 +295,14 @@ static void\n unformatted_write (bt type, void *source, int length)\n {\n   void *dest;\n-   dest = write_block (length);\n-   if (dest != NULL)\n-     memcpy (dest, source, length);\n+\n+  /* Correction for kind vs. length as in unformatted_read.  */\n+  if (type == BT_COMPLEX)\n+    length *= 2;\n+\n+  dest = write_block (length);\n+  if (dest != NULL)\n+    memcpy (dest, source, length);\n }\n \n "}]}