{"sha": "d8ab4e5471ac962fe29929306b51bd7acc064a59", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDhhYjRlNTQ3MWFjOTYyZmUyOTkyOTMwNmI1MWJkN2FjYzA2NGE1OQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2019-01-07T08:10:17Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2019-01-07T08:10:17Z"}, "message": "[nvptx] Postpone warnings in nvptx_goacc_validate_dims_1\n\nMove warnings in nvptx_goacc_validate_dims_1 to as late as possible.  This\nallows us more flexibility in setting the dimensions.\n\n2019-01-07  Tom de Vries  <tdevries@suse.de>\n\n\t* config/nvptx/nvptx.c (nvptx_goacc_validate_dims_1): Move warnings to\n\tas late as possible.\n\nFrom-SVN: r267627", "tree": {"sha": "fb1fbb5c054c240b6a24047c04e50d8af1227077", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fb1fbb5c054c240b6a24047c04e50d8af1227077"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8ab4e5471ac962fe29929306b51bd7acc064a59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8ab4e5471ac962fe29929306b51bd7acc064a59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8ab4e5471ac962fe29929306b51bd7acc064a59", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8ab4e5471ac962fe29929306b51bd7acc064a59/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "764ecad43b6cac2d2eded706fccd29cc15481ad2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/764ecad43b6cac2d2eded706fccd29cc15481ad2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/764ecad43b6cac2d2eded706fccd29cc15481ad2"}], "stats": {"total": 43, "additions": 30, "deletions": 13}, "files": [{"sha": "b9a271b742cd0ca5fd84eed86c3535ef2ddc686a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ab4e5471ac962fe29929306b51bd7acc064a59/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ab4e5471ac962fe29929306b51bd7acc064a59/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d8ab4e5471ac962fe29929306b51bd7acc064a59", "patch": "@@ -1,3 +1,8 @@\n+2019-01-07  Tom de Vries  <tdevries@suse.de>\n+\n+\t* config/nvptx/nvptx.c (nvptx_goacc_validate_dims_1): Move warnings to\n+\tas late as possible.\n+\n 2019-01-07  Tom de Vries  <tdevries@suse.de>\n \n \t* config/nvptx/nvptx.c (PTX_VECTOR_LENGTH): Remove."}, {"sha": "3a4a5a3a159e66170fd2762710cc59fda695f9ae", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 25, "deletions": 13, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ab4e5471ac962fe29929306b51bd7acc064a59/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ab4e5471ac962fe29929306b51bd7acc064a59/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=d8ab4e5471ac962fe29929306b51bd7acc064a59", "patch": "@@ -5376,25 +5376,37 @@ nvptx_goacc_validate_dims_1 (tree decl, int dims[], int fn_level)\n       gcc_assert (dims[GOMP_DIM_GANG] >= -1);\n     }\n \n-  if (dims[GOMP_DIM_VECTOR] >= 0\n-      && dims[GOMP_DIM_VECTOR] != PTX_WARP_SIZE)\n+  int old_dims[GOMP_DIM_MAX];\n+  unsigned int i;\n+  for (i = 0; i < GOMP_DIM_MAX; ++i)\n+    old_dims[i] = dims[i];\n+\n+  const char *vector_reason = NULL;\n+  if (dims[GOMP_DIM_VECTOR] == 0)\n     {\n-      warning_at (decl ? DECL_SOURCE_LOCATION (decl) : UNKNOWN_LOCATION, 0,\n-\t\t  dims[GOMP_DIM_VECTOR]\n-\t\t  ? G_(\"using vector_length (%d), ignoring %d\")\n-\t\t  : G_(\"using vector_length (%d), ignoring runtime setting\"),\n-\t\t  PTX_DEFAULT_VECTOR_LENGTH, dims[GOMP_DIM_VECTOR]);\n+      vector_reason = G_(\"using vector_length (%d), ignoring runtime setting\");\n       dims[GOMP_DIM_VECTOR] = PTX_DEFAULT_VECTOR_LENGTH;\n     }\n \n+  if (dims[GOMP_DIM_VECTOR] > 0\n+      && dims[GOMP_DIM_VECTOR] != PTX_WARP_SIZE)\n+    dims[GOMP_DIM_VECTOR] = PTX_DEFAULT_VECTOR_LENGTH;\n+\n   /* Check the num workers is not too large.  */\n   if (dims[GOMP_DIM_WORKER] > PTX_WORKER_LENGTH)\n-    {\n-      warning_at (decl ? DECL_SOURCE_LOCATION (decl) : UNKNOWN_LOCATION, 0,\n-\t\t  \"using num_workers (%d), ignoring %d\",\n-\t\t  PTX_WORKER_LENGTH, dims[GOMP_DIM_WORKER]);\n-      dims[GOMP_DIM_WORKER] = PTX_WORKER_LENGTH;\n-    }\n+    dims[GOMP_DIM_WORKER] = PTX_WORKER_LENGTH;\n+\n+  if (dims[GOMP_DIM_VECTOR] != old_dims[GOMP_DIM_VECTOR])\n+    warning_at (decl ? DECL_SOURCE_LOCATION (decl) : UNKNOWN_LOCATION, 0,\n+\t\tvector_reason != NULL\n+\t\t? vector_reason\n+\t\t: G_(\"using vector_length (%d), ignoring %d\"),\n+\t\tdims[GOMP_DIM_VECTOR], old_dims[GOMP_DIM_VECTOR]);\n+\n+  if (dims[GOMP_DIM_WORKER] != old_dims[GOMP_DIM_WORKER])\n+    warning_at (decl ? DECL_SOURCE_LOCATION (decl) : UNKNOWN_LOCATION, 0,\n+\t\tG_(\"using num_workers (%d), ignoring %d\"),\n+\t\tdims[GOMP_DIM_WORKER], old_dims[GOMP_DIM_WORKER]);\n \n   if (oacc_default_dims_p)\n     {"}]}