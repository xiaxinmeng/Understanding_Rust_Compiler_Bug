{"sha": "4747e2ccec94dc37f32201b884f574755cbb9ca8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc0N2UyY2NlYzk0ZGMzN2YzMjIwMWI4ODRmNTc0NzU1Y2JiOWNhOA==", "commit": {"author": {"name": "Mihail Ionescu", "email": "mihail.ionescu@arm.com", "date": "2020-01-15T11:49:32Z"}, "committer": {"name": "Mihail Ionescu", "email": "mihail.ionescu@arm.com", "date": "2020-01-16T15:12:14Z"}, "message": "[PATCH, GCC/ARM, 10/10] Enable -mcmse\n\nThe patch is straightforward: it redefines ARMv8_1m_main as having the\nsame features as ARMv8m_main (and thus as having the cmse feature) with\nthe extra features represented by armv8_1m_main.  It also removes the\nerror for using -mcmse on Armv8.1-M Mainline.\n\n*** gcc/ChangeLog ***\n\n2020-01-16  Mihail-Calin Ionescu  <mihail.ionescu@arm.com>\n2020-01-16  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n\n\t* config/arm/arm-cpus.in (ARMv8_1m_main): Redefine as an extension to\n\tArmv8-M Mainline.\n\t* config/arm/arm.c (arm_options_perform_arch_sanity_checks): Remove\n\terror for using -mcmse when targeting Armv8.1-M Mainline.", "tree": {"sha": "d4d29a4e28115c58ab3dc5feb391baf752b5fb88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d4d29a4e28115c58ab3dc5feb391baf752b5fb88"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4747e2ccec94dc37f32201b884f574755cbb9ca8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4747e2ccec94dc37f32201b884f574755cbb9ca8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4747e2ccec94dc37f32201b884f574755cbb9ca8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4747e2ccec94dc37f32201b884f574755cbb9ca8/comments", "author": null, "committer": null, "parents": [{"sha": "a464ffc2156a746d472fc2923d38324bdd06965e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a464ffc2156a746d472fc2923d38324bdd06965e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a464ffc2156a746d472fc2923d38324bdd06965e"}], "stats": {"total": 16, "additions": 9, "deletions": 7}, "files": [{"sha": "e056a6d6210d05e2eed9de1ef6dfa54ecb4958fb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4747e2ccec94dc37f32201b884f574755cbb9ca8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4747e2ccec94dc37f32201b884f574755cbb9ca8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4747e2ccec94dc37f32201b884f574755cbb9ca8", "patch": "@@ -1,6 +1,14 @@\n 2020-01-16  Mihail-Calin Ionescu <mihail.ionescu@arm.com>\n 2020-01-16  Thomas Preud'homme <thomas.preudhomme@arm.com>\n \n+\t* config/arm/arm-cpus.in (ARMv8_1m_main): Redefine as an extension to\n+\tArmv8-M Mainline.\n+\t* config/arm/arm.c (arm_options_perform_arch_sanity_checks): Remove\n+\terror for using -mcmse when targeting Armv8.1-M Mainline.\n+\n+2020-01-16  Mihail-Calin Ionescu  <mihail.ionescu@arm.com>\n+2020-01-16  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n+\n \t* config/arm/arm.md (nonsecure_call_internal): Do not force memory\n \taddress in r4 when targeting Armv8.1-M Mainline.\n \t(nonsecure_call_value_internal): Likewise."}, {"sha": "f5cc5ca2c317bd5e78f482fcffe629b072482643", "filename": "gcc/config/arm/arm-cpus.in", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4747e2ccec94dc37f32201b884f574755cbb9ca8/gcc%2Fconfig%2Farm%2Farm-cpus.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4747e2ccec94dc37f32201b884f574755cbb9ca8/gcc%2Fconfig%2Farm%2Farm-cpus.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-cpus.in?ref=4747e2ccec94dc37f32201b884f574755cbb9ca8", "patch": "@@ -272,10 +272,7 @@ define fgroup ARMv8_6a    ARMv8_5a armv8_6\n define fgroup ARMv8m_base ARMv6m armv8 cmse tdiv\n define fgroup ARMv8m_main ARMv7m armv8 cmse\n define fgroup ARMv8r      ARMv8a\n-# Feature cmse is omitted to disable Security Extensions support while secure\n-# code compiled by GCC does not preserve FP context as allowed by Armv8.1-M\n-# Mainline.\n-define fgroup ARMv8_1m_main ARMv7m armv8 armv8_1m_main\n+define fgroup ARMv8_1m_main ARMv8m_main armv8_1m_main\n \n # Useful combinations.\n define fgroup VFPv2\tvfpv2"}, {"sha": "5bb7a458b56e0ba9db102e410422927285515a40", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4747e2ccec94dc37f32201b884f574755cbb9ca8/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4747e2ccec94dc37f32201b884f574755cbb9ca8/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=4747e2ccec94dc37f32201b884f574755cbb9ca8", "patch": "@@ -3777,9 +3777,6 @@ arm_options_perform_arch_sanity_checks (void)\n   if (!arm_arch4 && arm_fp16_format != ARM_FP16_FORMAT_NONE)\n     sorry (\"__fp16 and no ldrh\");\n \n-  if (use_cmse && arm_arch8_1m_main)\n-    error (\"Armv8.1-M Mainline Security Extensions are unsupported\");\n-\n   if (use_cmse && !arm_arch_cmse)\n     error (\"target CPU does not support ARMv8-M Security Extensions\");\n "}]}