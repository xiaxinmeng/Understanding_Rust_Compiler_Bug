{"sha": "9f12a45ef147e563f099c24c293830727e8204cc", "node_id": "C_kwDOANBUbNoAKDlmMTJhNDVlZjE0N2U1NjNmMDk5YzI0YzI5MzgzMDcyN2U4MjA0Y2M", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-10-12T11:42:08Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-10-12T12:49:44Z"}, "message": "tree-optimization/102572 - fix gathers with invariant mask\n\nThis fixes the vector def gathering for invariant masks which\nfailed to pass in the desired vector type resulting in a non-mask\ntype to be generate.\n\n2021-10-12  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/102572\n\t* tree-vect-stmts.c (vect_build_gather_load_calls): When\n\tgathering the vectorized defs for the mask pass in the\n\tdesired mask vector type so invariants will be handled\n\tcorrectly.\n\n\t* g++.dg/vect/pr102572.cc: New testcase.", "tree": {"sha": "0180467afd7a85963a2a9889f0e72b35a6c9b1bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0180467afd7a85963a2a9889f0e72b35a6c9b1bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9f12a45ef147e563f099c24c293830727e8204cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f12a45ef147e563f099c24c293830727e8204cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f12a45ef147e563f099c24c293830727e8204cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f12a45ef147e563f099c24c293830727e8204cc/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e36206c9940d224637083f2e91bd4c70f4b7dd20", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e36206c9940d224637083f2e91bd4c70f4b7dd20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e36206c9940d224637083f2e91bd4c70f4b7dd20"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "0a713081537c43b866647e9bf3a8b52d79f79fd3", "filename": "gcc/testsuite/g++.dg/vect/pr102572.cc", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f12a45ef147e563f099c24c293830727e8204cc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr102572.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f12a45ef147e563f099c24c293830727e8204cc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr102572.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr102572.cc?ref=9f12a45ef147e563f099c24c293830727e8204cc", "patch": "@@ -0,0 +1,14 @@\n+// { dg-do compile }\n+// { dg-additional-options \"-O3\" }\n+// { dg-additional-options \"-march=skylake-avx512\" { target x86_64-*-* i?86-*-* } }\n+\n+int a, b, c, f;\n+void g(bool h, int d[][5])\n+{\n+  for (short i = f; i; i += 1)\n+    {\n+      a = h && d[0][i];\n+      for (int j = 0; j < 4; j += c)\n+\tb = 0;\n+    }\n+}"}, {"sha": "f5e1941f8ad358903deda54a521a6b4ba8f84b37", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9f12a45ef147e563f099c24c293830727e8204cc/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9f12a45ef147e563f099c24c293830727e8204cc/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=9f12a45ef147e563f099c24c293830727e8204cc", "patch": "@@ -2791,7 +2791,7 @@ vect_build_gather_load_calls (vec_info *vinfo, stmt_vec_info stmt_info,\n   if (mask)\n     vect_get_vec_defs_for_operand (vinfo, stmt_info,\n \t\t\t\t   modifier == NARROW ? ncopies / 2 : ncopies,\n-\t\t\t\t   mask, &vec_masks);\n+\t\t\t\t   mask, &vec_masks, masktype);\n   for (int j = 0; j < ncopies; ++j)\n     {\n       tree op, var;"}]}