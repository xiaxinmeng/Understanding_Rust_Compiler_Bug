{"sha": "077d1abec135863c50dc0d7a11772b23aae22821", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc3ZDFhYmVjMTM1ODYzYzUwZGMwZDdhMTE3NzJiMjNhYWUyMjgyMQ==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2012-10-29T20:17:23Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2012-10-29T20:17:23Z"}, "message": "re PR c/53066 (Wshadow should not warn for shadowing an extern function)\n\n2012-10-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR c/53066\nc/\n\t* c-decl.c (warn_if_shadowing): Do not warn if a variable\n\tshadows a function, unless the variable is a function or a\n\tpointer-to-function.\ngcc/\n\t* tree.h (FUNCTION_POINTER_TYPE_P): New.\ntestsuite/\n\t* gcc.dg/Wshadow-4.c: New.\n\t* gcc.dg/Wshadow-4.h: New.\n\nFrom-SVN: r192963", "tree": {"sha": "505d7a759421766b1f73cc99ae4e8492d75f4a37", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/505d7a759421766b1f73cc99ae4e8492d75f4a37"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/077d1abec135863c50dc0d7a11772b23aae22821", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/077d1abec135863c50dc0d7a11772b23aae22821", "html_url": "https://github.com/Rust-GCC/gccrs/commit/077d1abec135863c50dc0d7a11772b23aae22821", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/077d1abec135863c50dc0d7a11772b23aae22821/comments", "author": null, "committer": null, "parents": [{"sha": "36290bb4d5ca29006aaa97d5c1778594dec4ae22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36290bb4d5ca29006aaa97d5c1778594dec4ae22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36290bb4d5ca29006aaa97d5c1778594dec4ae22"}], "stats": {"total": 77, "additions": 75, "deletions": 2}, "files": [{"sha": "574a4743c38929ecc8065ba9189416c5fb5d4026", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -1,3 +1,8 @@\n+2012-10-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR c/53066\n+\t* tree.h (FUNCTION_POINTER_TYPE_P): New.\n+\n 2012-10-29  Alexandre Oliva <aoliva@redhat.com>\n \n \tPR debug/54693"}, {"sha": "f44131b74a1b50597e4a149d09ce3b45b9f8055d", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -1,3 +1,10 @@\n+2012-10-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR c/53066\n+\t* c-decl.c (warn_if_shadowing): Do not warn if a variable\n+\tshadows a function, unless the variable is a function or a\n+\tpointer-to-function.\n+\n 2012-10-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/54381"}, {"sha": "f03146690e1d67ea9f92c2c1e2e3c89b917d4821", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -2561,8 +2561,18 @@ warn_if_shadowing (tree new_decl)\n \t  warning (OPT_Wshadow, \"declaration of %q+D shadows a parameter\",\n \t\t   new_decl);\n \telse if (DECL_FILE_SCOPE_P (old_decl))\n-\t  warning (OPT_Wshadow, \"declaration of %q+D shadows a global \"\n-\t\t   \"declaration\", new_decl);\n+\t  {\n+\t    /* Do not warn if a variable shadows a function, unless\n+\t       the variable is a function or a pointer-to-function.  */\n+\t    if (TREE_CODE (old_decl) == FUNCTION_DECL\n+\t\t&& TREE_CODE (new_decl) != FUNCTION_DECL\n+\t\t&& !FUNCTION_POINTER_TYPE_P (TREE_TYPE (new_decl)))\n+\t\tcontinue;\n+\n+\t    warning_at (DECL_SOURCE_LOCATION (new_decl), OPT_Wshadow, \n+\t\t\t\"declaration of %qD shadows a global declaration\",\n+\t\t\tnew_decl);\n+\t  }\n \telse if (TREE_CODE (old_decl) == FUNCTION_DECL\n \t\t && DECL_BUILT_IN (old_decl))\n \t  {"}, {"sha": "49d6b9de345c344e5116a64a2f5d66ad3ff23d83", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -1,3 +1,9 @@\n+2012-10-29  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR c/53066\n+\t* gcc.dg/Wshadow-4.c: New.\n+\t* gcc.dg/Wshadow-4.h: New.\n+\n 2012-10-29  Alexandre Oliva <aoliva@redhat.com>\n \n \tPR debug/54693"}, {"sha": "f3b986fa6035ffbcd04ffe007f1bdb460680ed4c", "filename": "gcc/testsuite/gcc.dg/Wshadow-4.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-4.c?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -0,0 +1,38 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Wshadow -Wsystem-headers\" } */\n+\n+#include \"Wshadow-4.h\"\n+extern void index2 (void); /* { dg-message \"declaration is here\" } */\n+\n+void foo (double index1,\n+\t  double index2)\n+{\n+}\n+\n+void foo1 (void)\n+{\n+  double index1;\n+  double index2;\n+}\n+\n+void foo2 (void)\n+{\n+  {\n+    double index1;\n+    double index2;\n+  }\n+}\n+\n+void foo3 (void)\n+{\n+  void (*index1)(void); /* { dg-warning \"shadows\" } */\n+  void (*index2)(void); /* { dg-warning \"shadows\" } */\n+}\n+\n+void foo4 (void)\n+{\n+  void index1(void) {}; /* { dg-warning \"shadows\" } */\n+  void index2(void) {}; /* { dg-warning \"shadows\" } */\n+}\n+\n+/* { dg-message \"declaration is here\" \"\" { target *-*-* } 0 } */"}, {"sha": "5a44ca452ce888a8bcb3282d6ff5b7f09bb4a2e8", "filename": "gcc/testsuite/gcc.dg/Wshadow-4.h", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-4.h?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -0,0 +1,3 @@\n+#pragma GCC system_header\n+extern void index1 (void);\n+"}, {"sha": "d921886c2eaf13b4b9fe917faa8747b91ad44ec5", "filename": "gcc/tree.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/077d1abec135863c50dc0d7a11772b23aae22821/gcc%2Ftree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.h?ref=077d1abec135863c50dc0d7a11772b23aae22821", "patch": "@@ -1066,6 +1066,10 @@ extern void omp_clause_range_check_failed (const_tree, const char *, int,\n #define POINTER_TYPE_P(TYPE) \\\n   (TREE_CODE (TYPE) == POINTER_TYPE || TREE_CODE (TYPE) == REFERENCE_TYPE)\n \n+/* Nonzero if TYPE represents a pointer to function.  */\n+#define FUNCTION_POINTER_TYPE_P(TYPE) \\\n+  (POINTER_TYPE_P (TYPE) && TREE_CODE (TREE_TYPE (TYPE)) == FUNCTION_TYPE)\n+\n /* Nonzero if this type is a complete type.  */\n #define COMPLETE_TYPE_P(NODE) (TYPE_SIZE (NODE) != NULL_TREE)\n "}]}