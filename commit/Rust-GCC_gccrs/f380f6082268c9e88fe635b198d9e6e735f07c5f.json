{"sha": "f380f6082268c9e88fe635b198d9e6e735f07c5f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjM4MGY2MDgyMjY4YzllODhmZTYzNWIxOThkOWU2ZTczNWYwN2M1Zg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2017-04-18T18:49:19Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2017-04-18T18:49:19Z"}, "message": "re PR rtl-optimization/80357 (ICE in model_update_limit_points_in_group, at haifa-sched.c:1982 on powerpc64le-linux-gnu)\n\ngcc/\n\tPR rtl-optimization/80357\n\t* haifa-sched.c (tmp_bitmap): New variable.\n\t(model_recompute): Handle duplicate use records.\n\t(alloc_global_sched_pressure_data): Initialize tmp_bitmap.\n\t(free_global_sched_pressure_data): Free it.\n\ngcc/testsuite/\n\tPR rtl-optimization/80357\n\t* gcc.c-torture/compile/pr80357.c: New test.\n\nFrom-SVN: r246980", "tree": {"sha": "86328766c42bef50f00c651acba10464363486b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/86328766c42bef50f00c651acba10464363486b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f380f6082268c9e88fe635b198d9e6e735f07c5f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f380f6082268c9e88fe635b198d9e6e735f07c5f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f380f6082268c9e88fe635b198d9e6e735f07c5f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f380f6082268c9e88fe635b198d9e6e735f07c5f/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7754ee35771c049bf48b1bf8d8da4c5d19209866", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7754ee35771c049bf48b1bf8d8da4c5d19209866", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7754ee35771c049bf48b1bf8d8da4c5d19209866"}], "stats": {"total": 41, "additions": 40, "deletions": 1}, "files": [{"sha": "0278e495ef58dac933a912c0041494f6061659e0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f380f6082268c9e88fe635b198d9e6e735f07c5f", "patch": "@@ -1,3 +1,11 @@\n+2017-04-18  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\tPR rtl-optimization/80357\n+\t* haifa-sched.c (tmp_bitmap): New variable.\n+\t(model_recompute): Handle duplicate use records.\n+\t(alloc_global_sched_pressure_data): Initialize tmp_bitmap.\n+\t(free_global_sched_pressure_data): Free it.\n+\n 2017-04-18  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \tRevert:"}, {"sha": "0ebf110471c5d82beb7b48896960bcccefbc79f5", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=f380f6082268c9e88fe635b198d9e6e735f07c5f", "patch": "@@ -930,6 +930,9 @@ static bitmap saved_reg_live;\n /* Registers mentioned in the current region.  */\n static bitmap region_ref_regs;\n \n+/* Temporary bitmap used for SCHED_PRESSURE_MODEL.  */\n+static bitmap tmp_bitmap;\n+\n /* Effective number of available registers of a given class (see comment\n    in sched_pressure_start_bb).  */\n static int sched_class_regs_num[N_REG_CLASSES];\n@@ -2135,10 +2138,11 @@ model_recompute (rtx_insn *insn)\n      registers that will be born in the range [model_curr_point, POINT).  */\n   num_uses = 0;\n   num_pending_births = 0;\n+  bitmap_clear (tmp_bitmap);\n   for (use = INSN_REG_USE_LIST (insn); use != NULL; use = use->next_insn_use)\n     {\n       new_last = model_last_use_except (use);\n-      if (new_last < point)\n+      if (new_last < point && bitmap_set_bit (tmp_bitmap, use->regno))\n \t{\n \t  gcc_assert (num_uses < ARRAY_SIZE (uses));\n \t  uses[num_uses].last_use = new_last;\n@@ -7241,6 +7245,8 @@ alloc_global_sched_pressure_data (void)\n \t  saved_reg_live = BITMAP_ALLOC (NULL);\n \t  region_ref_regs = BITMAP_ALLOC (NULL);\n \t}\n+      if (sched_pressure == SCHED_PRESSURE_MODEL)\n+\ttmp_bitmap = BITMAP_ALLOC (NULL);\n \n       /* Calculate number of CALL_SAVED_REGS and FIXED_REGS in register classes\n \t that we calculate register pressure for.  */\n@@ -7274,6 +7280,8 @@ free_global_sched_pressure_data (void)\n \t  BITMAP_FREE (region_ref_regs);\n \t  BITMAP_FREE (saved_reg_live);\n \t}\n+      if (sched_pressure == SCHED_PRESSURE_MODEL)\n+\tBITMAP_FREE (tmp_bitmap);\n       BITMAP_FREE (curr_reg_live);\n       free (sched_regno_pressure_class);\n     }"}, {"sha": "05c5e23f07e34fcaa965ea3dff816afcaa767531", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f380f6082268c9e88fe635b198d9e6e735f07c5f", "patch": "@@ -1,3 +1,8 @@\n+2017-04-18  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\tPR rtl-optimization/80357\n+\t* gcc.c-torture/compile/pr80357.c: New test.\n+\n 2017-04-18  Jeff Law  <law@redhat.com>\n \n \tPR middle-end/80422"}, {"sha": "a3c6ab00feb229fa3983a587021a70f1772e286b", "filename": "gcc/testsuite/gcc.c-torture/compile/pr80357.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr80357.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f380f6082268c9e88fe635b198d9e6e735f07c5f/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr80357.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr80357.c?ref=f380f6082268c9e88fe635b198d9e6e735f07c5f", "patch": "@@ -0,0 +1,18 @@\n+typedef char a;\n+a b, c;\n+int d, e;\n+void f(void *g) { *(volatile int *)g; }\n+void j() {\n+  a h, i;\n+  for (; b; b += 2) {\n+    d = b;\n+    i = i >> b;\n+    if (i)\n+      continue;\n+    f(&c + (b >> 2));\n+    h = 0;\n+    for (; h < 8 / 2; h++)\n+      if (i << h)\n+        e = 0;\n+  }\n+}"}]}