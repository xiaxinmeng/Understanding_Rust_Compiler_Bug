{"sha": "14fef000947916e55e5aa1bdd6d78a04ed78dde4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTRmZWYwMDA5NDc5MTZlNTVlNWFhMWJkZDZkNzhhMDRlZDc4ZGRlNA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2019-06-19T19:16:17Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2019-06-19T19:16:17Z"}, "message": "[Darwin, specs] Tidy some more linker options.\n\npie, no-pie and rdynamic are driver options, we can process them in the\nrelevant place and drop them once dealt with.  There's no need to generate\na new header to process the \"no_compact_unwind\" which is applied on the\nbasis of the target system.\n\nSupport for the -pie, -no_pie and -no_compact_unwind options should ideally\nbe checked at configure time, however the status quo is to assert that linkers\ncapable of targeting the relevant systems support these options (i.e. we trust\nthat the user doesn't attempt to configure inappropriately).\n\nTODO: check the availability of the linker opts in configure rather than\ntrusting to the user.\n\nThis will fix the fail of pie-7.c, which is a result of failing to handle the\nno-pie driver option.\n\n2019-06-19  Iain Sandoe  <iain@sandoe.co.uk>\n\n\t* config/darwin.h (DRIVER_SELF_SPECS): Add RDYNAMIC, DARWIN_PIE_SPEC\n\tand DARWIN_NOPIE_SPEC.\n\t(RDYNAMIC): New, modified from DARWIN_EXPORT_DYNAMIC.\n\t(DARWIN_PIE_SPEC): Collate from darwin.h and darwin9.h.\n\t(DARWIN_NOPIE_SPEC): Collate from darwin10.h.\n\t(DARWIN_NOCOMPACT_UNWIND): New from darwin10.h\n\t(DARWIN_EXPORT_DYNAMIC): Delete.\n\t* config/darwin10.h (LINK_GCC_C_SEQUENCE_SPEC): Move no_compact_unwind\n\tand pie options processing to  darwin.h.\n\t* config/darwin9.h (DARWIN_PIE_SPEC): Move pie processing to darwin.h\n\nFrom-SVN: r272484", "tree": {"sha": "aa29742fa4479eaecbd666edafdd6baf3885d499", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aa29742fa4479eaecbd666edafdd6baf3885d499"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/14fef000947916e55e5aa1bdd6d78a04ed78dde4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14fef000947916e55e5aa1bdd6d78a04ed78dde4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14fef000947916e55e5aa1bdd6d78a04ed78dde4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14fef000947916e55e5aa1bdd6d78a04ed78dde4/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a04c0734e366a167a55f635b7d09de09b5013051", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a04c0734e366a167a55f635b7d09de09b5013051", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a04c0734e366a167a55f635b7d09de09b5013051"}], "stats": {"total": 81, "additions": 54, "deletions": 27}, "files": [{"sha": "6e9ecedf96c09de29aea9f675484a47f90f66a2b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=14fef000947916e55e5aa1bdd6d78a04ed78dde4", "patch": "@@ -1,7 +1,20 @@\n 2019-06-19  Iain Sandoe  <iain@sandoe.co.uk>\n \n-        * config/darwin-driver.c (darwin_driver_init): Fix off-by-one errors\n-        in computing the number of options to be moved.\n+\t* config/darwin.h (DRIVER_SELF_SPECS): Add RDYNAMIC, DARWIN_PIE_SPEC\n+\tand DARWIN_NOPIE_SPEC.\n+\t(RDYNAMIC): New, modified from DARWIN_EXPORT_DYNAMIC.\n+\t(DARWIN_PIE_SPEC): Collate from darwin.h and darwin9.h.\n+\t(DARWIN_NOPIE_SPEC): Collate from darwin10.h.\n+\t(DARWIN_NOCOMPACT_UNWIND): New from darwin10.h\n+\t(DARWIN_EXPORT_DYNAMIC): Delete.\n+\t* config/darwin10.h (LINK_GCC_C_SEQUENCE_SPEC): Move no_compact_unwind\n+\tand pie options processing to  darwin.h.\n+\t* config/darwin9.h (DARWIN_PIE_SPEC): Move pie processing to darwin.h\n+\n+2019-06-19  Iain Sandoe  <iain@sandoe.co.uk>\n+\n+\t* config/darwin-driver.c (darwin_driver_init): Fix off-by-one errors\n+\tin computing the number of options to be moved.\n \n 2019-06-19  Maya Rashish  <coypu@sdf.org>\n "}, {"sha": "ae324f194de68f03aad7f1018dc5eb5ff9b9f64a", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 37, "deletions": 12, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=14fef000947916e55e5aa1bdd6d78a04ed78dde4", "patch": "@@ -124,7 +124,30 @@ extern GTY(()) int darwin_ms_struct;\n   \"%{fapple-kext|mkernel:-static}\",\t\t\t\t\\\n   \"%{shared:-Zdynamiclib} %<shared\",                            \\\n   \"%{gsplit-dwarf:%ngsplit-dwarf is not supported on this platform} \\\n-     %<gsplit-dwarf\"\n+     %<gsplit-dwarf\",\t\t\t\t\t\t\\\n+  DARWIN_PIE_SPEC,\t\t\t\t\t\t\\\n+  DARWIN_NOPIE_SPEC,\t\t\t\t\t\t\\\n+  RDYNAMIC\n+\n+#if LD64_HAS_EXPORT_DYNAMIC\n+#define RDYNAMIC \"%{rdynamic:-Xlinker -export_dynamic} %<rdynamic\"\n+#else\n+#define RDYNAMIC \"%{rdynamic:%nrdynamic is not supported} %<rdynamic\"\n+#endif\n+\n+/* FIXME: we should check that the linker supports the -pie and -no_pie.\n+   options.  */\n+#define DARWIN_PIE_SPEC \\\n+\"%{pie|fpie|fPIE: \\\n+   %{mdynamic-no-pic: \\\n+       %n'-mdynamic-no-pic' overrides '-pie', '-fpie' or '-fPIE'; \\\n+     : %:version-compare(>= 10.5 mmacosx-version-min= -Xlinker) \\\n+       %:version-compare(>= 10.5 mmacosx-version-min= -pie) }} %<pie \"\n+\n+#define DARWIN_NOPIE_SPEC \\\n+\"%{no-pie|fno-pie|fno-PIE: \\\n+   %:version-compare(>= 10.7 mmacosx-version-min= -Xlinker ) \\\n+   %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } %<no-pie \"\n \n #define DARWIN_CC1_SPEC\t\t\t\t\t\t\t\\\n   \"%{findirect-virtual-calls: -fapple-kext} %<findirect-virtual-calls \" \\\n@@ -156,6 +179,16 @@ extern GTY(()) int darwin_ms_struct;\n #define CPP_SPEC \"%{static:%{!dynamic:-D__STATIC__}}%{!static:-D__DYNAMIC__}\" \\\n \t\" %{pthread:-D_REENTRANT}\"\n \n+/* This is a fix for PR41260 by passing -no_compact_unwind on darwin10 and\n+   later until the assembler, linker and libunwind are able to deal with the\n+   output from GCC.\n+\n+   FIXME: we should check that the linker supports the option.\n+*/\n+\n+#define DARWIN_NOCOMPACT_UNWIND \\\n+\" %:version-compare(>= 10.6 mmacosx-version-min= -no_compact_unwind) \"\n+\n /* This is mostly a clone of the standard LINK_COMMAND_SPEC, plus\n    precomp, libtool, and fat build additions.\n \n@@ -164,12 +197,6 @@ extern GTY(()) int darwin_ms_struct;\n    specifying the handling of options understood by generic Unix\n    linkers, and for positional arguments like libraries.  */\n \n-#if LD64_HAS_EXPORT_DYNAMIC\n-#define DARWIN_EXPORT_DYNAMIC \" %{rdynamic:-export_dynamic}\"\n-#else\n-#define DARWIN_EXPORT_DYNAMIC \" %{rdynamic: %nrdynamic is not supported}\"\n-#endif\n-\n #define LINK_COMMAND_SPEC_A \\\n    \"%{!fdump=*:%{!fsyntax-only:%{!c:%{!M:%{!MM:%{!E:%{!S:\\\n     %(linker)\" \\\n@@ -190,10 +217,11 @@ extern GTY(()) int darwin_ms_struct;\n       %{%:sanitize(address): -lasan } \\\n       %{%:sanitize(undefined): -lubsan } \\\n       %(link_ssp) \\\n-      \" DARWIN_EXPORT_DYNAMIC \" %<rdynamic \\\n       %(link_gcc_c_sequence) \\\n     }}}\\\n-    %{!nostdlib:%{!r:%{!nostartfiles:%E}}} %{T*} %{F*} }}}}}}}\"\n+    %{!nostdlib:%{!r:%{!nostartfiles:%E}}} %{T*} %{F*} \"\\\n+    DARWIN_NOCOMPACT_UNWIND \\\n+    \"}}}}}}}\"\n \n #define DSYMUTIL \"\\ndsymutil\"\n \n@@ -230,8 +258,6 @@ extern GTY(()) int darwin_ms_struct;\n #define STANDARD_STARTFILE_PREFIX_1 \"\"\n #define STANDARD_STARTFILE_PREFIX_2 \"\"\n \n-#define DARWIN_PIE_SPEC \"%{fpie|pie|fPIE:}\"\n-\n /* Please keep the random linker options in alphabetical order (modulo\n    'Z' and 'no' prefixes). Note that options taking arguments may appear\n    multiple times on a command line with different arguments each time,\n@@ -295,7 +321,6 @@ extern GTY(()) int darwin_ms_struct;\n      %:version-compare(< 10.5 mmacosx-version-min= -multiply_defined) \\\n      %:version-compare(< 10.5 mmacosx-version-min= suppress)}} \\\n    %{Zmultiplydefinedunused*:-multiply_defined_unused %*} \\\n-   \" DARWIN_PIE_SPEC \" \\\n    %{prebind} %{noprebind} %{nofixprebinding} %{prebind_all_twolevel_modules} \\\n    %{read_only_relocs} \\\n    %{sectcreate*} %{sectorder*} %{seg1addr*} %{segprot*} \\"}, {"sha": "a6d1eba6ebd10d4350c1ef635d66086da086c776", "filename": "gcc/config/darwin10.h", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2Fconfig%2Fdarwin10.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2Fconfig%2Fdarwin10.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin10.h?ref=14fef000947916e55e5aa1bdd6d78a04ed78dde4", "patch": "@@ -18,17 +18,12 @@ You should have received a copy of the GNU General Public License\n along with GCC; see the file COPYING3.  If not see\n <http://www.gnu.org/licenses/>.  */\n \n-/* Fix PR41260 by passing -no_compact_unwind on darwin10 and later until\n-   unwinder in libSystem is fixed to digest new epilog unwinding notes.\n+/* Fix PR47558 by linking against libSystem ahead of libgcc_ext. */\n \n-   Fix PR47558 by linking against libSystem ahead of libgcc_ext. */\n #undef  LINK_GCC_C_SEQUENCE_SPEC\n #define LINK_GCC_C_SEQUENCE_SPEC \\\n-\"%:version-compare(>= 10.6 mmacosx-version-min= -no_compact_unwind) \\\n- %{!static:%{!static-libgcc: \\\n+\"%{!static:%{!static-libgcc: \\\n     %:version-compare(>= 10.6 mmacosx-version-min= -lSystem) } } \\\n- %{fno-pic|fno-PIC|fno-pie|fno-PIE|fapple-kext|mkernel|static|mdynamic-no-pic: \\\n-   %:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } \\\n  %{!nostdlib:%:version-compare(>< 10.6 10.7 mmacosx-version-min= -ld10-uwfef.o)} \\\n   %G %{!nolibc:%L}\"\n "}, {"sha": "1fd1604aed8e3c5f41abbafc82341a96fe682b76", "filename": "gcc/config/darwin9.h", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2Fconfig%2Fdarwin9.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/14fef000947916e55e5aa1bdd6d78a04ed78dde4/gcc%2Fconfig%2Fdarwin9.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin9.h?ref=14fef000947916e55e5aa1bdd6d78a04ed78dde4", "patch": "@@ -35,12 +35,6 @@ along with GCC; see the file COPYING3.  If not see\n /* Tell collect2 to run dsymutil for us as necessary.  */\n #define COLLECT_RUN_DSYMUTIL 1\n \n-#undef DARWIN_PIE_SPEC\n-#define DARWIN_PIE_SPEC \\\n-  \"%{fpie|pie|fPIE: \\\n-     %{mdynamic-no-pic: %n'-mdynamic-no-pic' overrides '-pie', '-fpie' or '-fPIE'; \\\n-      :-pie}}\"\n-\n /* Only ask as for debug data if the debug style is stabs (since as doesn't\n    yet generate dwarf.)  */\n "}]}