{"sha": "0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGZiODA4ZWE3YTBmMzA1MzFlOWExNDk1YjlhYWZhNTI2N2MyZjBiNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-12-05T20:56:14Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-12-05T20:56:14Z"}, "message": "re PR tree-optimization/51396 (ICE: verify_flow_info failed: BB 4 can not throw but has an EH edge with -O2 -fnon-call-exceptions -mfma4)\n\n\tPR tree-optimization/51396\n\t* tree-ssa-math-opts.c (convert_mult_to_fma): Don't optimize\n\tif MUL_RESULT has zero uses.\n\n\t* g++.dg/opt/pr51396.C: New test.\n\nFrom-SVN: r182028", "tree": {"sha": "ee9328a0873b74fdcbd5ebe510e67699561cd4bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee9328a0873b74fdcbd5ebe510e67699561cd4bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "17fe0fdbad5fd777bbfa62b44cd97becb5f72056", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17fe0fdbad5fd777bbfa62b44cd97becb5f72056", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17fe0fdbad5fd777bbfa62b44cd97becb5f72056"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "318b4ceadb113087ddc2726b2c52ceade717a661", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "patch": "@@ -1,5 +1,9 @@\n 2011-12-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/51396\n+\t* tree-ssa-math-opts.c (convert_mult_to_fma): Don't optimize\n+\tif MUL_RESULT has zero uses.\n+\n \tPR debug/51410\n \t* c-decl.c (pop_scope): Don't add DECL_EXTERNAL decls\n \tfor debug info if scope is file_scope."}, {"sha": "efb2ed42af3025311d68ab34e14303886da32cbd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "patch": "@@ -1,5 +1,8 @@\n 2011-12-05  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/51396\n+\t* g++.dg/opt/pr51396.C: New test.\n+\n \tPR debug/51410\n \t* gcc.dg/debug/dwarf2/pr51410.c: New test.\n "}, {"sha": "f2b21b60d535a55e354ade9200b4b3df778c58a1", "filename": "gcc/testsuite/g++.dg/opt/pr51396.C", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr51396.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr51396.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr51396.C?ref=0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "patch": "@@ -0,0 +1,24 @@\n+// PR tree-optimization/51396\n+// { dg-do compile }\n+// { dg-options \"-O2 -fnon-call-exceptions -mfma\" }\n+// { dg-options \"-O2 -fnon-call-exceptions -mfma\" { target i?86-*-* x86_64-*-* } }\n+\n+double baz (double) throw ();\n+\n+struct C\n+{\n+  C (double d = 0.0) : c (d) {}\n+  double c;\n+};\n+\n+static inline void\n+foo (double x, const C &y)\n+{\n+  x ? (y.c * baz (x)) : (C (), y);\n+}\n+\n+void\n+bar (double x, C y)\n+{\n+  foo (x, y);\n+}"}, {"sha": "06a4505079fb1b9ac363f7169b5cc491e1f61981", "filename": "gcc/tree-ssa-math-opts.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2Ftree-ssa-math-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5/gcc%2Ftree-ssa-math-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-math-opts.c?ref=0fb808ea7a0f30531e9a1495b9aafa5267c2f0b5", "patch": "@@ -2429,6 +2429,12 @@ convert_mult_to_fma (gimple mul_stmt, tree op1, tree op2)\n   if (optab_handler (fma_optab, TYPE_MODE (type)) == CODE_FOR_nothing)\n     return false;\n \n+  /* If the multiplication has zero uses, it is kept around probably because\n+     of -fnon-call-exceptions.  Don't optimize it away in that case,\n+     it is DCE job.  */\n+  if (has_zero_uses (mul_result))\n+    return false;\n+\n   /* Make sure that the multiplication statement becomes dead after\n      the transformation, thus that all uses are transformed to FMAs.\n      This means we assume that an FMA operation has the same cost"}]}