{"sha": "d1eed638ed170a22a3feb9515b82b125fd203727", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDFlZWQ2MzhlZDE3MGEyMmEzZmViOTUxNWI4MmIxMjVmZDIwMzcyNw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-06-15T18:42:10Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-06-15T18:42:10Z"}, "message": "re PR lto/69866 (lto1: internal compiler error: in add_symbol_to_partition_1, at lto/lto-partition.c:158)\n\n\n\tPR lto/69866\n\t* lto-symtab.c (lto_symtab_merge_symbols): Drop useless definitions\n\tthat resolved externally.\n\n\t* gcc.dg/lto/pr69866_0.c: New test.\n\t* gcc.dg/lto/pr69866_1.c: Likewise.\n\nFrom-SVN: r249224", "tree": {"sha": "a753e9e9d5423fbd3ccff9f0c5190c796dd8e3c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a753e9e9d5423fbd3ccff9f0c5190c796dd8e3c2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d1eed638ed170a22a3feb9515b82b125fd203727", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1eed638ed170a22a3feb9515b82b125fd203727", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1eed638ed170a22a3feb9515b82b125fd203727", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1eed638ed170a22a3feb9515b82b125fd203727/comments", "author": null, "committer": null, "parents": [{"sha": "55dabf65f039c3a5635f01dccb9e4de767f89323", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55dabf65f039c3a5635f01dccb9e4de767f89323", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55dabf65f039c3a5635f01dccb9e4de767f89323"}], "stats": {"total": 70, "additions": 69, "deletions": 1}, "files": [{"sha": "58601c54b46d92e5240c2ac99a2215bae47a9aea", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=d1eed638ed170a22a3feb9515b82b125fd203727", "patch": "@@ -1,3 +1,10 @@\n+2017-06-15  Jan Hubicka  <hubicka@ucw.cz>\n+\t    Thomas Preud'homme  <thomas.preudhomme@arm.com>\n+\n+\tPR lto/69866\n+\t* lto-symtab.c (lto_symtab_merge_symbols): Drop useless definitions\n+\tthat resolved externally.\n+\n 2017-05-23  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto.c (do_whole_program_analysis): Replace inline_free_summary"}, {"sha": "620deac090b7e718f05d3f37e6ef68e759de0008", "filename": "gcc/lto/lto-partition.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Flto%2Flto-partition.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Flto%2Flto-partition.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-partition.c?ref=d1eed638ed170a22a3feb9515b82b125fd203727", "patch": "@@ -132,7 +132,7 @@ add_symbol_to_partition_1 (ltrans_partition part, symtab_node *node)\n \n   /* Be sure that we never try to duplicate partitioned symbol\n      or add external symbol.  */\n-  gcc_assert (c != SYMBOL_EXTERNAL\n+  gcc_assert ((c != SYMBOL_EXTERNAL || node->alias)\n \t      && (c == SYMBOL_DUPLICATE || !symbol_partitioned_p (node)));\n \n   part->symbols++;"}, {"sha": "019677eaf95e906d5dfc15f609f70fadfa1b3856", "filename": "gcc/lto/lto-symtab.c", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Flto%2Flto-symtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Flto%2Flto-symtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-symtab.c?ref=d1eed638ed170a22a3feb9515b82b125fd203727", "patch": "@@ -952,6 +952,42 @@ lto_symtab_merge_symbols (void)\n \t      if (tgt)\n \t\tnode->resolve_alias (tgt, true);\n \t    }\n+\t  /* If the symbol was preempted outside IR, see if we want to get rid\n+\t     of the definition.  */\n+\t  if (node->analyzed\n+\t      && !DECL_EXTERNAL (node->decl)\n+\t      && (node->resolution == LDPR_PREEMPTED_REG\n+\t\t  || node->resolution == LDPR_RESOLVED_IR\n+\t\t  || node->resolution == LDPR_RESOLVED_EXEC\n+\t\t  || node->resolution == LDPR_RESOLVED_DYN))\n+\t    {\n+\t      DECL_EXTERNAL (node->decl) = 1;\n+\t      /* If alias to local symbol was preempted by external definition,\n+\t\t we know it is not pointing to the local symbol.  Remove it.  */\n+\t      if (node->alias\n+\t\t  && !node->weakref\n+\t\t  && !node->transparent_alias\n+\t\t  && node->get_alias_target ()->binds_to_current_def_p ())\n+\t\t{\n+\t\t  node->alias = false;\n+\t\t  node->remove_all_references ();\n+\t\t  node->definition = false;\n+\t\t  node->analyzed = false;\n+\t\t  node->cpp_implicit_alias = false;\n+\t\t}\n+\t      else if (!node->alias\n+\t\t       && node->definition\n+\t\t       && node->get_availability () <= AVAIL_INTERPOSABLE)\n+\t\t{\n+\t\t  if ((cnode = dyn_cast <cgraph_node *> (node)) != NULL)\n+\t\t    cnode->reset ();\n+\t\t  else\n+\t\t    {\n+\t\t      node->analyzed = node->definition = false;\n+\t\t      node->remove_all_references ();\n+\t\t    }\n+\t\t}\n+\t    }\n \n \t  if (!(cnode = dyn_cast <cgraph_node *> (node))\n \t      || !cnode->clone_of"}, {"sha": "a79f533992ef0703cc3c506ac65b311bc9a0ec51", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d1eed638ed170a22a3feb9515b82b125fd203727", "patch": "@@ -1,3 +1,9 @@\n+2017-06-15  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n+\n+\tPR lto/69866\n+\t* gcc.dg/lto/pr69866_0.c: New test.\n+\t* gcc.dg/lto/pr69866_1.c: Likewise.\n+\n 2017-06-15  Jozef Lawrynowicz\t<jozef.l@somniumtech.com>\n \n \tPR target/78818"}, {"sha": "f49ef8d4c1da7a21d1bfb5409d647bd18141595b", "filename": "gcc/testsuite/gcc.dg/lto/pr69866_0.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr69866_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr69866_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr69866_0.c?ref=d1eed638ed170a22a3feb9515b82b125fd203727", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-lto-do link } */\n+\n+int _umh(int i)\n+{\n+  return i+1;\n+}\n+\n+int weaks(int i) __attribute__((weak, alias(\"_umh\")));\n+\n+int main()\n+{\n+  return weaks(10);\n+}"}, {"sha": "3a14f850eefaffbf659ce4642adef7900330f4ed", "filename": "gcc/testsuite/gcc.dg/lto/pr69866_1.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr69866_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1eed638ed170a22a3feb9515b82b125fd203727/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr69866_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr69866_1.c?ref=d1eed638ed170a22a3feb9515b82b125fd203727", "patch": "@@ -0,0 +1,6 @@\n+/* { dg-options { -fno-lto } } */\n+\n+int weaks(int i)\n+{\n+  return i+1;\n+}"}]}