{"sha": "6bf80413deb5c1eacbefd685e106c6351b75ecf2", "node_id": "C_kwDOANBUbNoAKDZiZjgwNDEzZGViNWMxZWFjYmVmZDY4NWUxMDZjNjM1MWI3NWVjZjI", "commit": {"author": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-03-17T00:23:02Z"}, "committer": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-03-17T00:23:02Z"}, "message": "[modula2] Bugfix local symbol names for -fm2-whole-program\n\nLocal symbols must be prefixed by the modulename if\n-fm2-whole-program is used to avoid a name clash.\n\ngcc/m2/ChangeLog:\n\n\t* gm2-compiler/M2AsmUtil.mod (SymNeedsModulePrefix):\n\tRe-implemented.\n\t* gm2-libs/SysStorage.mod (enableTrace): Disable tracing.\n\nSigned-off-by: Gaius Mulley <gaiusmod2@gmail.com>", "tree": {"sha": "f9138b2c71c22f014b278f0e1e4d1fdb35170afb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f9138b2c71c22f014b278f0e1e4d1fdb35170afb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6bf80413deb5c1eacbefd685e106c6351b75ecf2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6bf80413deb5c1eacbefd685e106c6351b75ecf2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6bf80413deb5c1eacbefd685e106c6351b75ecf2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6bf80413deb5c1eacbefd685e106c6351b75ecf2/comments", "author": null, "committer": null, "parents": [{"sha": "5c389a5c36f1c82fef82115270109f19c1237eaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c389a5c36f1c82fef82115270109f19c1237eaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c389a5c36f1c82fef82115270109f19c1237eaa"}], "stats": {"total": 30, "additions": 14, "deletions": 16}, "files": [{"sha": "9ee5dd35df784f7de26cb6c3aba8666993382eee", "filename": "gcc/m2/gm2-compiler/M2AsmUtil.mod", "status": "modified", "additions": 13, "deletions": 15, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6bf80413deb5c1eacbefd685e106c6351b75ecf2/gcc%2Fm2%2Fgm2-compiler%2FM2AsmUtil.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6bf80413deb5c1eacbefd685e106c6351b75ecf2/gcc%2Fm2%2Fgm2-compiler%2FM2AsmUtil.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-compiler%2FM2AsmUtil.mod?ref=6bf80413deb5c1eacbefd685e106c6351b75ecf2", "patch": "@@ -40,7 +40,7 @@ FROM SymbolTable IMPORT NulSym,\n                         IsProcedure,\n                         IsModule,\n                         IsDefImp,\n-                        IsExportQualified,\n+                        IsExportQualified, IsExportUnQualified,\n                         IsExported, IsPublic, IsExtern, IsMonoName,\n                         IsDefinitionForC ;\n \n@@ -146,28 +146,26 @@ END GetFullSymName ;\n \n \n (*\n-   SymNeedsModulePrefix -\n+   SymNeedsModulePrefix - return TRUE if symbol mod is required to have a prefix.\n *)\n \n PROCEDURE SymNeedsModulePrefix (sym, mod: CARDINAL) : BOOLEAN ;\n BEGIN\n-   IF IsDefImp(mod)\n+   IF IsDefImp (mod)\n    THEN\n-      IF WholeProgram\n+      IF IsExportUnQualified (sym)\n       THEN\n-         IF NOT IsDefinitionForC(mod)\n-         THEN\n-            RETURN( TRUE )\n-         END\n-      ELSIF IsExportQualified(sym)\n-      THEN\n-         RETURN( TRUE )\n+         RETURN FALSE\n+      ELSE\n+         (* We need to force the prefix if whole program is used otherwise\n+            local symbols from multipl modules might conflict.  *)\n+         RETURN WholeProgram OR IsExportQualified (sym)\n       END\n-   ELSIF IsModule(mod)\n+   ELSIF IsModule (mod)\n    THEN\n-      RETURN( WholeProgram )\n+      RETURN WholeProgram\n    END ;\n-   RETURN( FALSE )\n+   RETURN FALSE\n END SymNeedsModulePrefix ;\n \n \n@@ -185,7 +183,7 @@ BEGIN\n       THEN\n          RETURN( ConCat(ConCatChar(InitStringCharStar(KeyToCharStar(GetSymName(ModSym))), '_'),\n                         GetModulePrefix(Name, ModSym, GetScope(ModSym))) )\n-      ELSIF SymNeedsModulePrefix(Sym, ModSym)\n+      ELSIF SymNeedsModulePrefix (Sym, ModSym)\n       THEN\n          RETURN( ConCatChar(ConCat(InitStringCharStar(KeyToCharStar(GetSymName(ModSym))), Mark(Name)), '_') )\n       END"}, {"sha": "2318ab7a6c556a817a7ea96bdf6c55f3104f06e1", "filename": "gcc/m2/gm2-libs/SysStorage.mod", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6bf80413deb5c1eacbefd685e106c6351b75ecf2/gcc%2Fm2%2Fgm2-libs%2FSysStorage.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6bf80413deb5c1eacbefd685e106c6351b75ecf2/gcc%2Fm2%2Fgm2-libs%2FSysStorage.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs%2FSysStorage.mod?ref=6bf80413deb5c1eacbefd685e106c6351b75ecf2", "patch": "@@ -34,7 +34,7 @@ FROM SYSTEM IMPORT ADR ;\n CONST\n    enableDeallocation =  TRUE ;\n    enableZero         =  TRUE ;\n-   enableTrace        =  TRUE ;\n+   enableTrace        =  FALSE ;\n \n VAR\n    callno: CARDINAL ;"}]}