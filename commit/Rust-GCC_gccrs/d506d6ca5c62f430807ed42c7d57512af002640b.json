{"sha": "d506d6ca5c62f430807ed42c7d57512af002640b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDUwNmQ2Y2E1YzYyZjQzMDgwN2VkNDJjN2Q1NzUxMmFmMDAyNjQwYg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-08-17T12:10:11Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-08-17T12:10:11Z"}, "message": "tree-ssa-structalias.c (solve_graph): When propagating to successors update the graphs succ edges and avoid duplicate...\n\n2017-08-17  Richard Biener  <rguenther@suse.de>\n\n\t* tree-ssa-structalias.c (solve_graph): When propagating\n\tto successors update the graphs succ edges and avoid duplicate work.\n\nFrom-SVN: r251146", "tree": {"sha": "d5a10399f205edcfc1ece2741e7696ee1c428d1b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d5a10399f205edcfc1ece2741e7696ee1c428d1b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d506d6ca5c62f430807ed42c7d57512af002640b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d506d6ca5c62f430807ed42c7d57512af002640b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d506d6ca5c62f430807ed42c7d57512af002640b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d506d6ca5c62f430807ed42c7d57512af002640b/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b8d8d3ff49a530e6a2ea99d546f41497f3f96654", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8d8d3ff49a530e6a2ea99d546f41497f3f96654", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8d8d3ff49a530e6a2ea99d546f41497f3f96654"}], "stats": {"total": 34, "additions": 28, "deletions": 6}, "files": [{"sha": "e9ece8939194d4de8334dbbbcb3c7f49b5b2b650", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d506d6ca5c62f430807ed42c7d57512af002640b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d506d6ca5c62f430807ed42c7d57512af002640b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d506d6ca5c62f430807ed42c7d57512af002640b", "patch": "@@ -1,3 +1,8 @@\n+2017-08-17  Richard Biener  <rguenther@suse.de>\n+\n+\t* tree-ssa-structalias.c (solve_graph): When propagating\n+\tto successors update the graphs succ edges and avoid duplicate work.\n+\n 2017-08-17  Maxim Ostapenko  <m.ostapenko@samsung.com>\n \n \tPR target/81861"}, {"sha": "2cca970f1e5451442024960a2eabcac4ad192699", "filename": "gcc/tree-ssa-structalias.c", "status": "modified", "additions": 23, "deletions": 6, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d506d6ca5c62f430807ed42c7d57512af002640b/gcc%2Ftree-ssa-structalias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d506d6ca5c62f430807ed42c7d57512af002640b/gcc%2Ftree-ssa-structalias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-structalias.c?ref=d506d6ca5c62f430807ed42c7d57512af002640b", "patch": "@@ -2765,20 +2765,35 @@ solve_graph (constraint_graph_t graph)\n \t\t  unsigned eff_escaped_id = find (escaped_id);\n \n \t\t  /* Propagate solution to all successors.  */\n+\t\t  unsigned to_remove = ~0U;\n \t\t  EXECUTE_IF_IN_NONNULL_BITMAP (graph->succs[i],\n \t\t\t\t\t\t0, j, bi)\n \t\t    {\n-\t\t      bitmap tmp;\n-\t\t      bool flag;\n-\n+\t\t      if (to_remove != ~0U)\n+\t\t\t{\n+\t\t\t  bitmap_clear_bit (graph->succs[i], to_remove);\n+\t\t\t  to_remove = ~0U;\n+\t\t\t}\n \t\t      unsigned int to = find (j);\n-\t\t      tmp = get_varinfo (to)->solution;\n-\t\t      flag = false;\n-\n+\t\t      if (to != j)\n+\t\t\t{\n+\t\t\t  /* Update the succ graph, avoiding duplicate\n+\t\t\t     work.  */\n+\t\t\t  to_remove = j;\n+\t\t\t  if (! bitmap_set_bit (graph->succs[i], to))\n+\t\t\t    continue;\n+\t\t\t  /* We eventually end up processing 'to' twice\n+\t\t\t     as it is undefined whether bitmap iteration\n+\t\t\t     iterates over bits set during iteration.\n+\t\t\t     Play safe instead of doing tricks.  */\n+\t\t\t}\n \t\t      /* Don't try to propagate to ourselves.  */\n \t\t      if (to == i)\n \t\t\tcontinue;\n \n+\t\t      bitmap tmp = get_varinfo (to)->solution;\n+\t\t      bool flag = false;\n+\n \t\t      /* If we propagate from ESCAPED use ESCAPED as\n \t\t         placeholder.  */\n \t\t      if (i == eff_escaped_id)\n@@ -2789,6 +2804,8 @@ solve_graph (constraint_graph_t graph)\n \t\t      if (flag)\n \t\t\tbitmap_set_bit (changed, to);\n \t\t    }\n+\t\t  if (to_remove != ~0U)\n+\t\t    bitmap_clear_bit (graph->succs[i], to_remove);\n \t\t}\n \t    }\n \t}"}]}