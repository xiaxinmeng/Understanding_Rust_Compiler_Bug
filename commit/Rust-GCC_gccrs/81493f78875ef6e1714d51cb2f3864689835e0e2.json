{"sha": "81493f78875ef6e1714d51cb2f3864689835e0e2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODE0OTNmNzg4NzVlZjZlMTcxNGQ1MWNiMmYzODY0Njg5ODM1ZTBlMg==", "commit": {"author": {"name": "Adam Butcher", "email": "adam@jessamine.co.uk", "date": "2014-02-25T03:47:24Z"}, "committer": {"name": "Adam Butcher", "email": "abutcher@gcc.gnu.org", "date": "2014-02-25T03:47:24Z"}, "message": "re PR c++/60065 ([c++1y] ICE with auto parameter pack)\n\nFix PR c++/60065.\n\n\tPR c++/60065\n\t* parser.c (cp_parser_direct_declarator): Don't save and\n\trestore num_template_parameter_lists around call to\n\tcp_parser_parameter_declaration_list.\n\t(function_being_declared_is_template_p): New predicate.\n\t(cp_parser_parameter_declaration_list): Use\n\tfunction_being_declared_is_template_p as predicate for\n\tinspecting current function template parameter list length\n\trather than num_template_parameter_lists.\n\n\tPR c++/60065\n\t* g++.dg/cpp1y/pr60065.C: New testcase.\n\nFrom-SVN: r208106", "tree": {"sha": "5d4911d0be0ea6573b033ff26f5357862efa7b19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5d4911d0be0ea6573b033ff26f5357862efa7b19"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81493f78875ef6e1714d51cb2f3864689835e0e2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81493f78875ef6e1714d51cb2f3864689835e0e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81493f78875ef6e1714d51cb2f3864689835e0e2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81493f78875ef6e1714d51cb2f3864689835e0e2/comments", "author": {"login": "abutcher-gh", "id": 10379705, "node_id": "MDQ6VXNlcjEwMzc5NzA1", "avatar_url": "https://avatars.githubusercontent.com/u/10379705?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abutcher-gh", "html_url": "https://github.com/abutcher-gh", "followers_url": "https://api.github.com/users/abutcher-gh/followers", "following_url": "https://api.github.com/users/abutcher-gh/following{/other_user}", "gists_url": "https://api.github.com/users/abutcher-gh/gists{/gist_id}", "starred_url": "https://api.github.com/users/abutcher-gh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abutcher-gh/subscriptions", "organizations_url": "https://api.github.com/users/abutcher-gh/orgs", "repos_url": "https://api.github.com/users/abutcher-gh/repos", "events_url": "https://api.github.com/users/abutcher-gh/events{/privacy}", "received_events_url": "https://api.github.com/users/abutcher-gh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "325fefe0464b35ded3747e5a77f1e005562392ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/325fefe0464b35ded3747e5a77f1e005562392ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/325fefe0464b35ded3747e5a77f1e005562392ee"}], "stats": {"total": 59, "additions": 46, "deletions": 13}, "files": [{"sha": "a5f2ec2598fe6ea1ec481a9fa8aacb61fa99b4e5", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=81493f78875ef6e1714d51cb2f3864689835e0e2", "patch": "@@ -1,3 +1,15 @@\n+2014-02-25  Adam Butcher  <adam@jessamine.co.uk>\n+\n+\tPR c++/60065\n+\t* parser.c (cp_parser_direct_declarator): Don't save and\n+\trestore num_template_parameter_lists around call to\n+\tcp_parser_parameter_declaration_list.\n+\t(function_being_declared_is_template_p): New predicate.\n+\t(cp_parser_parameter_declaration_list): Use\n+\tfunction_being_declared_is_template_p as predicate for\n+\tinspecting current function template parameter list length\n+\trather than num_template_parameter_lists.\n+\n 2014-02-24  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/60146"}, {"sha": "038e8530527ebcba088fa5681aabe11fca14b226", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 21, "deletions": 13, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=81493f78875ef6e1714d51cb2f3864689835e0e2", "patch": "@@ -17042,7 +17042,6 @@ cp_parser_direct_declarator (cp_parser* parser,\n \t  if (!first || dcl_kind != CP_PARSER_DECLARATOR_NAMED)\n \t    {\n \t      tree params;\n-\t      unsigned saved_num_template_parameter_lists;\n \t      bool is_declarator = false;\n \n \t      /* In a member-declarator, the only valid interpretation\n@@ -17064,22 +17063,11 @@ cp_parser_direct_declarator (cp_parser* parser,\n \t\t  parser->in_declarator_p = true;\n \t\t}\n \n-\t      /* Inside the function parameter list, surrounding\n-\t\t template-parameter-lists do not apply.  */\n-\t      saved_num_template_parameter_lists\n-\t\t= parser->num_template_parameter_lists;\n-\t      parser->num_template_parameter_lists = 0;\n-\n \t      begin_scope (sk_function_parms, NULL_TREE);\n \n \t      /* Parse the parameter-declaration-clause.  */\n \t      params = cp_parser_parameter_declaration_clause (parser);\n \n-\t      /* Restore saved template parameter lists accounting for implicit\n-\t\t template parameters.  */\n-\t      parser->num_template_parameter_lists\n-\t\t+= saved_num_template_parameter_lists;\n-\n \t      /* Consume the `)'.  */\n \t      cp_parser_require (parser, CPP_CLOSE_PAREN, RT_CLOSE_PAREN);\n \n@@ -18128,6 +18116,26 @@ cp_parser_type_specifier_seq (cp_parser* parser,\n     }\n }\n \n+/* Return whether the function currently being declared has an associated\n+   template parameter list.  */\n+\n+static bool\n+function_being_declared_is_template_p (cp_parser* parser)\n+{\n+  if (!current_template_parms)\n+    return false;\n+\n+  if (parser->implicit_template_scope)\n+    return true;\n+\n+  if (at_class_scope_p ()\n+      && TYPE_BEING_DEFINED (current_class_type))\n+    return parser->num_template_parameter_lists != 0;\n+\n+  return ((int) parser->num_template_parameter_lists > template_class_depth\n+\t  (current_class_type));\n+}\n+\n /* Parse a parameter-declaration-clause.\n \n    parameter-declaration-clause:\n@@ -18266,7 +18274,7 @@ cp_parser_parameter_declaration_list (cp_parser* parser, bool *is_error)\n       cp_parameter_declarator *parameter;\n       tree decl = error_mark_node;\n       bool parenthesized_p = false;\n-      int template_parm_idx = (parser->num_template_parameter_lists?\n+      int template_parm_idx = (function_being_declared_is_template_p (parser)?\n \t\t\t       TREE_VEC_LENGTH (INNERMOST_TEMPLATE_PARMS\n \t\t\t\t\t\t(current_template_parms)) : 0);\n "}, {"sha": "b05509f6b65291f48294563296d10b8ac1f600fa", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=81493f78875ef6e1714d51cb2f3864689835e0e2", "patch": "@@ -1,3 +1,8 @@\n+2014-02-25  Adam Butcher  <adam@jessamine.co.uk>\n+\n+\tPR c++/60065\n+\t* g++.dg/cpp1y/pr60065.C: New testcase.\n+\n 2014-02-24  Andrey Belevantsev  <abel@ispras.ru>\n \n \tPR rtl-optimization/60268"}, {"sha": "2aaa1e32fab9525a1b263319f617f40c52d607fe", "filename": "gcc/testsuite/g++.dg/cpp1y/pr60065.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr60065.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81493f78875ef6e1714d51cb2f3864689835e0e2/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr60065.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr60065.C?ref=81493f78875ef6e1714d51cb2f3864689835e0e2", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/60065\n+// { dg-do compile }\n+// { dg-options \"-std=c++1y\" }\n+\n+template <int> void foo(auto... x);\n+template <typename> void foo2(auto... x);\n+template <int> void foo3(auto... x, auto y, auto... z);\n+template <typename> void foo4(auto... x, auto y, auto... z);"}]}