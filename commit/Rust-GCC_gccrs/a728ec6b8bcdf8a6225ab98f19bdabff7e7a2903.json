{"sha": "a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTcyOGVjNmI4YmNkZjhhNjIyNWFiOThmMTliZGFiZmY3ZTdhMjkwMw==", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2020-05-28T02:16:52Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2020-05-28T02:16:52Z"}, "message": "outputs.exp: no lto, linker default output, cdtor temps, empty args\n\nThis patch fixes various issues in the testsuite that came up after\nthe dump/aux output revamp, namely:\n\n- many outputs.exp tests used -flto without checking that LTO was\nsupported, getting lots of failures.  With this patch, we test for LTO\nsupport, and skip -flto tests on platforms that do not support it.\n\n- some linkers error out if an output file is not named, and the\na.{out,exe} construct that we used throughout outputs.exp to match the\ndefault linker output would trigger a bug in tcl globbing.  With this\npatch, we detect the default linker output early.  If none is found,\nwe arrange to pass -o a.out explicitly in tests that used to test the\ndefault linker output.  We now look for the detected default, or for\nexplicitly-specified output.\n\n- collect2 will leave <execname>.cdtor.* files behind in -save-temps\ntests.  Ignore them.\n\n- The prepending of -Wl, to file names in ldflags et al was done in a\nway that introduced empty arguments when consecutive blanks appeared\nin these board configuration knobs.  Skip the empty strings between\nconsecutive blanks to avoid this problem.\n\n\ngcc/testsuite/ChangeLog:\n\n\t* lib/gcc-defs.exp: Avoid introducing empty arguments between\n\tconsecutive blanks in board linking options.\n\t* gcc.misc-tests/outputs.exp: Likewise.  Document\n\t-gsplit-dwarf testing, skip LTO tests if -flto is not\n\tsupported, detect the default linker output name, cope with\n\tthe need for an explicit executable output.", "tree": {"sha": "0fa541f67ede9f58936f17822ef72238ba7e7e24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0fa541f67ede9f58936f17822ef72238ba7e7e24"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903/comments", "author": null, "committer": null, "parents": [{"sha": "b76415508692fc0bc85515a8215b874c7e215431", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b76415508692fc0bc85515a8215b874c7e215431", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b76415508692fc0bc85515a8215b874c7e215431"}], "stats": {"total": 167, "additions": 119, "deletions": 48}, "files": [{"sha": "c3c6c2dc0e6b5fdb3f1e94f8bc8adfa980dbd302", "filename": "gcc/testsuite/gcc.misc-tests/outputs.exp", "status": "modified", "additions": 116, "deletions": 47, "changes": 163, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.misc-tests%2Foutputs.exp?ref=a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903", "patch": "@@ -30,13 +30,20 @@ if {![gcc_parallel_test_run_p $b] || [is_remote host]} {\n }\n gcc_parallel_test_enable 0\n \n+# Check for -gsplit-dwarf support.  The outest proc will check that\n+# gsplit_dwarf is empty if a .dwo file is missing before deciding\n+# that's a fail.\n set gsplit_dwarf \"-gsplit-dwarf\"\n if ![check_no_compiler_messages gsplitdwarf object {\n     void foo (void) { }\n } \"$gsplit_dwarf\"] {\n     set gsplit_dwarf \"\"\n }\n \n+# Check for -flto support.  We explicitly test the result to skip\n+# tests that use -flto.\n+set skip_lto ![check_effective_target_lto]\n+\n # Prepare additional options to be used for linking.\n # We do not compile to an executable, because that requires naming an output.\n set link_options \"\"\n@@ -45,7 +52,9 @@ foreach i { ldflags libs ldscripts } {\n     if {[board_info $dest exists $i]} {\n \tset skip \"\"\n \tforeach opt [split [board_info $dest $i]] {\n-\t    if { $skip != \"\" } then {\n+\t    if { $opt == \"\" } then {\n+\t\tcontinue\n+\t    } elseif { $skip != \"\" } then {\n \t\tset skip \"\"\n \t    } elseif { $opt == \"-Xlinker\" } then {\n \t\tset skip $opt\n@@ -73,9 +82,10 @@ if {[board_info $dest exists output_format]} {\n # double dash, or a dash followed by a period, the first dash is\n # replaced with $b-$b; names starting with \"a--\" or \"a-.\" have \"$b\"\n # inserted after the first dash.  The glob pattern may expand to more\n-# than one file, but then the test will pass when there any number of\n-# matches.  So, it's safe to use for a.{out,exe}, but .{i,s,o} and\n-# .[iso] will pass even if only the .o is present.\n+# than one file, but then the test will pass for any number of\n+# matches, i.e., it would be safe to use for a.{out,exe} (if it\n+# weren't for https://core.tcl-lang.org/tcl/tktview?name=5bbd044812),\n+# but .{i,s,o} and .[iso] will pass even if only the .o is present.\n proc outest { test sources opts dirs outputs } {\n     global b\n     global srcdir\n@@ -120,6 +130,9 @@ proc outest { test sources opts dirs outputs } {\n \t\tset o \"a-$b-[string range $og 3 end]\"\n \t    } elseif { [string range $og 0 2] == \"a-.\" } then {\n \t\tset o \"a-$b.[string range $og 3 end]\"\n+\t    } elseif { \"$og\" == \"\\$aout\" } then {\n+\t\tglobal aout\n+\t\tset o \"$aout\"\n \t    } else {\n \t\tset o \"$og\"\n \t    }\n@@ -148,17 +161,23 @@ proc outest { test sources opts dirs outputs } {\n \t}\n     }\n \n+    set outb {}\n     foreach f $outs {\n \tfile delete $f\n+\t# collect2 may create <execname>.cdtor* files in -save-temps link tests,\n+\t# ??? without regard to aux output naming conventions.\n+\tif ![string match \"*.cdtor.*\" $f] then {\n+\t    lappend outb $f\n+\t}\n     }\n     foreach d $dirs {\n \tfile delete -force $d\n     }\n \n-    if { [llength $outs] == 0 } then {\n+    if { [llength $outb] == 0 } then {\n \tpass \"$test: extra\"\n     } else {\n-\tfail \"$test: extra\\n$outs\"\n+\tfail \"$test: extra\\n$outb\"\n     }\n \n     if { [string equal \"$gcc_output\" \"\"] } then {\n@@ -172,15 +191,59 @@ proc outest { test sources opts dirs outputs } {\n set sing {-0.c}\n set mult {-1.c -2.c}\n \n+# Find out the default linker output.  We only check for a.out and\n+# e.exe; gcc.c, the lto-wrapper and whatnot may have to change if\n+# prefixes other than a. might be used.  Our tests may have to be\n+# adjusted then.  Also, there may not be a default.  Some linkers\n+# error out if -o is not specified.\n+proc default_link_name { sources } {\n+    global b\n+    global srcdir\n+    global subdir\n+    set src {}\n+    foreach s $sources {\n+\tlappend src $srcdir/$subdir/$b$s\n+    }\n+\n+    set maybe { a.out a.exe }\n+    foreach f $maybe {\n+\tfile delete $f\n+    }\n+\n+    global link_options\n+    set gcc_output [gcc_target_compile $src \"\" none \"$link_options\"]\n+\n+    foreach f $maybe {\n+\tif { [file exists $f] } then {\n+\t    file delete $f\n+\t    return $f\n+\t}\n+    }\n+\n+    return \"\";\n+}\n+\n+set aout [default_link_name $sing]\n+\n+# If there is no default linker output, arrange for -o a.out to be\n+# specified where we would normally leave it for the linker to use its\n+# default.\n+if { \"$aout\" != \"\" } then {\n+    set oaout \"\"\n+} else {\n+    set aout a.out\n+    set oaout \"-o $aout\"\n+}\n+\n # Driver-chosen outputs.\n outest \"$b asm default 1\" $sing \"-S\" {} {{-0.s}}\n outest \"$b asm default 2\" $mult \"-S\" {} {{-1.s -2.s}}\n \n outest \"$b obj default 1\" $sing \"-c\" {} {{-0.o}}\n outest \"$b obj default 2\" $mult \"-c\" {} {{-1.o -2.o}}\n \n-outest \"$b exe default 1\" $sing \"\" {} {{a.{out,exe}}}\n-outest \"$b exe default 2\" $mult \"\" {} {{a.{out,exe}}}\n+outest \"$b exe default 1\" $sing \"$oaout\" {} {{$aout}}\n+outest \"$b exe default 2\" $mult \"$oaout\" {} {{$aout}}\n \n # Driver-chosen aux outputs.\n outest \"$b asm savetmp 1\" $sing \"-S -save-temps\" {} {{-0.i -0.s}}\n@@ -200,8 +263,8 @@ outest \"$b obj savetmp namedb\" $sing \"-c -o $b.o -save-temps\" {} {{.i .s .o}}\n # When linking, the executable name gets prepended to aux output\n # basenames, except when executable and single input share the same\n # basename.\n-outest \"$b exe savetmp unnamed1\" $sing \"-save-temps\" {} {{a--0.i a--0.s a--0.o a.{out,exe}}}\n-outest \"$b exe savetmp unnamed2\" $mult \"-save-temps\" {} {{a--1.i a--1.s a--1.o a--2.i a--2.s a--2.o a.{out,exe}}}\n+outest \"$b exe savetmp unnamed1\" $sing \"-save-temps $oaout\" {} {{a--0.i a--0.s a--0.o $aout}}\n+outest \"$b exe savetmp unnamed2\" $mult \"-save-temps $oaout\" {} {{a--1.i a--1.s a--1.o a--2.i a--2.s a--2.o $aout}}\n outest \"$b exe savetmp named0\" $sing \"-o $b-0.exe -save-temps\" {} {{-0.i -0.s -0.o -0.exe}}\n outest \"$b exe savetmp namedb\" $sing \"-o $b.exe -save-temps\" {} {{--0.i --0.s --0.o .exe}}\n outest \"$b exe savetmp named2\" $mult \"-o $b.exe -save-temps\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .exe}}\n@@ -227,8 +290,8 @@ outest \"$b obj savecwd named0\" $sing \"-c -o $b-0.o -save-temps=cwd\" {} {{-0.i -0\n outest \"$b cpp savecwd namedb\" $sing \"-E -o $b.i -save-temps=cwd\" {} {{.i}}\n outest \"$b asm savecwd namedb\" $sing \"-S -o $b.s -save-temps=cwd\" {} {{.i .s}}\n outest \"$b obj savecwd namedb\" $sing \"-c -o $b.o -save-temps=cwd\" {} {{.i .s .o}}\n-outest \"$b exe savecwd unnamed1\" $sing \"-save-temps=cwd\" {} {{a--0.i a--0.s a--0.o a.{out,exe}}}\n-outest \"$b exe savecwd unnamed2\" $mult \"-save-temps=cwd\" {} {{a--1.i a--1.s a--1.o a--2.i a--2.s a--2.o a.{out,exe}}}\n+outest \"$b exe savecwd unnamed1\" $sing \"-save-temps=cwd $oaout\" {} {{a--0.i a--0.s a--0.o $aout}}\n+outest \"$b exe savecwd unnamed2\" $mult \"-save-temps=cwd $oaout\" {} {{a--1.i a--1.s a--1.o a--2.i a--2.s a--2.o $aout}}\n outest \"$b exe savecwd named0\" $sing \"-o $b-0.exe -save-temps=cwd\" {} {{-0.i -0.s -0.o -0.exe}}\n outest \"$b exe savecwd namedb\" $sing \"-o $b.exe -save-temps=cwd\" {} {{--0.i --0.s --0.o .exe}}\n outest \"$b exe savecwd named2\" $mult \"-o $b.exe -save-temps=cwd\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .exe}}\n@@ -253,8 +316,8 @@ outest \"$b obj saveobj named0\" $sing \"-c -o $b-0.o -save-temps=obj\" {} {{-0.i -0\n outest \"$b cpp saveobj namedb\" $sing \"-E -o $b.i -save-temps=obj\" {} {{.i}}\n outest \"$b asm saveobj namedb\" $sing \"-S -o $b.s -save-temps=obj\" {} {{.i .s}}\n outest \"$b obj saveobj namedb\" $sing \"-c -o $b.o -save-temps=obj\" {} {{.i .s .o}}\n-outest \"$b exe saveobj unnamed1\" $sing \"-save-temps=obj\" {} {{a--0.i a--0.s a--0.o a.{out,exe}}}\n-outest \"$b exe saveobj unnamed2\" $mult \"-save-temps=obj\" {} {{a--1.i a--1.s a--1.o a--2.i a--2.s a--2.o a.{out,exe}}}\n+outest \"$b exe saveobj unnamed1\" $sing \"-save-temps=obj $oaout\" {} {{a--0.i a--0.s a--0.o $aout}}\n+outest \"$b exe saveobj unnamed2\" $mult \"-save-temps=obj $oaout\" {} {{a--1.i a--1.s a--1.o a--2.i a--2.s a--2.o $aout}}\n outest \"$b exe saveobj named0\" $sing \"-o $b-0.exe -save-temps=obj\" {} {{-0.i -0.s -0.o -0.exe}}\n outest \"$b exe saveobj namedb\" $sing \"-o $b.exe -save-temps=obj\" {} {{--0.i --0.s --0.o .exe}}\n outest \"$b exe saveobj named2\" $mult \"-o $b.exe -save-temps=obj\" {} {{--1.i --1.s --1.o --2.i --2.s --2.o .exe}}\n@@ -314,8 +377,8 @@ outest \"$b cpp auxdump namedb\" $sing \"-E -o $b.i -g -fdump-rtl-final -fstack-usa\n outest \"$b asm auxdump namedb\" $sing \"-S -o $b.s -g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{.c.???r.final .su .s}}\n outest \"$b obj auxdump namedb\" $sing \"-c -o $b.o -g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{.c.???r.final .su .dwo .o}}\n \n-outest \"$b exe auxdump unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{a--0.c.???r.final a--0.su a--0.dwo a.{out,exe}}}\n-outest \"$b exe auxdump unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo a.{out,exe}}}\n+outest \"$b exe auxdump unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf $oaout\" {} {{a--0.c.???r.final a--0.su a--0.dwo $aout}}\n+outest \"$b exe auxdump unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf $oaout\" {} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo $aout}}\n outest \"$b exe auxdump named0\" $sing \"-o $b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{-0.c.???r.final -0.su -0.dwo -0.exe}}\n outest \"$b exe auxdump namedb\" $sing \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{--0.c.???r.final --0.su --0.dwo .exe}}\n outest \"$b exe auxdump named2\" $mult \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {} {{--1.c.???r.final --1.su --1.dwo --2.c.???r.final --2.su --2.dwo .exe}}\n@@ -344,8 +407,8 @@ outest \"$b cpp auxdmps namedb\" $sing \"-E -o $b.i -g -fdump-rtl-final -fstack-usa\n outest \"$b asm auxdmps namedb\" $sing \"-S -o $b.s -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{.i .c.???r.final .su .s}}\n outest \"$b obj auxdmps namedb\" $sing \"-c -o $b.o -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{.i .c.???r.final .su .s .dwo .o}}\n \n-outest \"$b exe auxdmps unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{a--0.i a--0.c.???r.final a--0.su a--0.s a--0.dwo a--0.o a.{out,exe}}}\n-outest \"$b exe auxdmps unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{a--1.i a--1.c.???r.final a--1.su a--1.s a--1.dwo a--1.o a--2.i a--2.c.???r.final a--2.su a--2.s a--2.dwo a--2.o a.{out,exe}}}\n+outest \"$b exe auxdmps unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps $oaout\" {} {{a--0.i a--0.c.???r.final a--0.su a--0.s a--0.dwo a--0.o $aout}}\n+outest \"$b exe auxdmps unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps $oaout\" {} {{a--1.i a--1.c.???r.final a--1.su a--1.s a--1.dwo a--1.o a--2.i a--2.c.???r.final a--2.su a--2.s a--2.dwo a--2.o $aout}}\n outest \"$b exe auxdmps named0\" $sing \"-o $b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{-0.i -0.c.???r.final -0.su -0.s -0.dwo -0.o -0.exe}}\n outest \"$b exe auxdmps namedb\" $sing \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{--0.i --0.c.???r.final --0.su --0.s --0.dwo --0.o .exe}}\n outest \"$b exe auxdmps named2\" $mult \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -save-temps\" {} {{--1.i --1.c.???r.final --1.su --1.s --1.dwo --1.o --2.i --2.c.???r.final --2.su --2.s --2.dwo --2.o .exe}}\n@@ -374,8 +437,8 @@ outest \"$b cpp dumpdir namedb\" $sing \"-E -o $b.i -g -fdump-rtl-final -fstack-usa\n outest \"$b asm dumpdir namedb\" $sing \"-S -o $b.s -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/\" {od/} {{.c.???r.final .su} {.s}}\n outest \"$b obj dumpdir namedb\" $sing \"-c -o $b.o -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/\" {od/} {{.c.???r.final .su .dwo} {.o}}\n \n-outest \"$b exe dumpdir unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/a-\" {od/} {{a--0.c.???r.final a--0.su a--0.dwo} {a.{out,exe}}}\n-outest \"$b exe dumpdir unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/a-\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {a.{out,exe}}}\n+outest \"$b exe dumpdir unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/a- $oaout\" {od/} {{a--0.c.???r.final a--0.su a--0.dwo} {$aout}}\n+outest \"$b exe dumpdir unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/a- $oaout\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {$aout}}\n outest \"$b exe dumpdir named0\" $sing \"-o $b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/\" {od/} {{-0.c.???r.final -0.su -0.dwo} {-0.exe}}\n outest \"$b exe dumpdir namedb\" $sing \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/\" {od/} {{-0.c.???r.final -0.su -0.dwo} {.exe}}\n outest \"$b exe dumpdir named2\" $mult \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/\" {od/} {{-1.c.???r.final -1.su -1.dwo -2.c.???r.final -2.su -2.dwo} {.exe}}\n@@ -428,8 +491,8 @@ outest \"$b obj dbsovrdd namedb\" $sing \"-c -o $b.o -g -fdump-rtl-final -fstack-us\n # Nit: -dumpdir affects whether the specified dumpbase is combined\n # into dumpdir or taken as the output basename, even if dumpbase will\n # ultimately override it.\n-outest \"$b exe dbsovrdd unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/$b\" {od/} {{.???r.final .su .dwo} {a.{out,exe}}}\n-outest \"$b exe dbsovrdd unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/a\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {a.{out,exe}}}\n+outest \"$b exe dbsovrdd unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/$b $oaout\" {od/} {{.???r.final .su .dwo} {$aout}}\n+outest \"$b exe dbsovrdd unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/a $oaout\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {$aout}}\n outest \"$b exe dbsovrdd named0\" $sing \"-o $b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/$b\" {od/} {{.???r.final .su .dwo} {-0.exe}}\n outest \"$b exe dbsovrdd namedb\" $sing \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/$b.exe -dumpbase-ext .exe\" {od/} {{.exe.???r.final .su .dwo} {.exe}}\n outest \"$b exe dbsovrdd named2\" $mult \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir ./ -dumpbase od/$b\" {od/} {{--1.c.???r.final --1.su --1.dwo --2.c.???r.final --2.su --2.dwo} {.exe}}\n@@ -472,8 +535,8 @@ outest \"$b obj dbswthdd namedb\" $sing \"-c -o $b.o -g -fdump-rtl-final -fstack-us\n # Nitty details: -dumpdir affects whether the specified dumpbase is\n # combined into dumpdir or taken as the output basename, even if\n # dumpbase will ultimately override it.\n-outest \"$b exe dbswthdd unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase $b\" {od/} {{.???r.final .su .dwo} {a.{out,exe}}}\n-outest \"$b exe dbswthdd unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase a\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {a.{out,exe}}}\n+outest \"$b exe dbswthdd unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase $b $oaout\" {od/} {{.???r.final .su .dwo} {$aout}}\n+outest \"$b exe dbswthdd unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase a $oaout\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {$aout}}\n outest \"$b exe dbswthdd named0\" $sing \"-o $b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase $b\" {od/} {{.???r.final .su .dwo} {-0.exe}}\n outest \"$b exe dbswthdd namedb\" $sing \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase $b.exe -dumpbase-ext .exe\" {od/} {{.exe.???r.final .su .dwo} {.exe}}\n outest \"$b exe dbswthdd named2\" $mult \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpdir od/ -dumpbase $b\" {od/} {{--1.c.???r.final --1.su --1.dwo --2.c.???r.final --2.su --2.dwo} {.exe}}\n@@ -516,8 +579,8 @@ outest \"$b cpp dbwoutdd namedb\" $sing \"-E -o $b.i -g -fdump-rtl-final -fstack-us\n outest \"$b asm dbwoutdd namedb\" $sing \"-S -o $b.s -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/$b\" {od/} {{.???r.final .su} {.s}}\n outest \"$b obj dbwoutdd namedb\" $sing \"-c -o $b.o -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/$b\" {od/} {{.???r.final .su .dwo} {.o}}\n \n-outest \"$b exe dbwoutdd unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/$b\" {od/} {{--0.c.???r.final --0.su --0.dwo} {a.{out,exe}}}\n-outest \"$b exe dbwoutdd unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/a\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {a.{out,exe}}}\n+outest \"$b exe dbwoutdd unnamed1\" $sing \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/$b $oaout\" {od/} {{--0.c.???r.final --0.su --0.dwo} {$aout}}\n+outest \"$b exe dbwoutdd unnamed2\" $mult \"-g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/a $oaout\" {od/} {{a--1.c.???r.final a--1.su a--1.dwo a--2.c.???r.final a--2.su a--2.dwo} {$aout}}\n outest \"$b exe dbwoutdd named0\" $sing \"-o $b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/$b\" {od/} {{--0.c.???r.final --0.su --0.dwo} {-0.exe}}\n outest \"$b exe dbwoutdd named0d\" $sing \"-o od/$b-0.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase $b\" {od/} {{--0.c.???r.final --0.su --0.dwo -0.exe} {}}\n outest \"$b exe dbwoutdd namedb\" $sing \"-o $b.exe -g -fdump-rtl-final -fstack-usage $gsplit_dwarf -dumpbase od/$b.exe -dumpbase-ext .exe\" {od/} {{--0.c.???r.final --0.su --0.dwo} {.exe}}\n@@ -542,9 +605,11 @@ outest \"$b exe dbwoutdda namedir2\" $mult \"-o o/$b.exe -g -fdump-rtl-final -fstac\n outest \"$b obj compare-debug\" $sing \"-c -fcompare-debug -fdump-rtl-final -fstack-usage $gsplit_dwarf -fdump-final-insns\" {} {{-0.c.???r.final -0.su -0.c.gkd -0.gk.c.???r.final -0.dwo -0.o}}\n outest \"$b obj compare-debug save-temps\" $sing \"-c -fcompare-debug -save-temps -fdump-rtl-final -fstack-usage $gsplit_dwarf -fdump-final-insns\" {} {{-0.c.???r.final -0.su -0.i -0.c.gkd -0.s -0.gk.i -0.gk.c.???r.final -0.gk.c.gkd -0.dwo -0.o}}\n \n+if !$skip_lto {\n+\n # -flto\n-outest \"$b lto sing unnamed\" $sing \"-O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{a--0.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.{out,exe}}}\n-outest \"$b lto mult unnamed\" $mult \"-O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{a--1.c.???i.icf a--2.c.???i.icf  a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.{out,exe}}}\n+outest \"$b lto sing unnamed\" $sing \"-O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--0.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n+outest \"$b lto mult unnamed\" $mult \"-O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--1.c.???i.icf a--2.c.???i.icf  a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n outest \"$b lto sing named\" $sing \"-o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n outest \"$b lto mult named\" $mult \"-o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n outest \"$b lto sing nameddir\" $sing \"-o dir/$b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n@@ -553,33 +618,33 @@ outest \"$b lto mult nameddir\" $mult \"-o dir/$b.exe -O2 -flto -flto-partition=one\n # -dumpbase without -dumpdir.  The trailing dumppfx dash after it is\n # combined with dumpbase turns into a period when passed to lto as\n # -dumpdir, because the dash is introduced by the compiler driver.\n-outest \"$b lto sing dumpbase unnamed\" $sing \"-dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {a.{out,exe}}}\n-outest \"$b lto mult dumpbase unnamed\" $mult \"-dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {a.{out,exe}}}\n+outest \"$b lto sing dumpbase unnamed\" $sing \"-dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {$aout}}\n+outest \"$b lto mult dumpbase unnamed\" $mult \"-dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {$aout}}\n outest \"$b lto sing dumpbase named\" $sing \"-dumpbase dir/$b -o $b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {-0.exe}}\n outest \"$b lto mult dumpbase named\" $mult \"-dumpbase dir/$b -o $b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {-1.exe}}\n outest \"$b lto sing dumpbase namedb\" $sing \"-dumpbase dir/$b -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {.exe}}\n outest \"$b lto mult dumpbase namedb\" $mult \"-dumpbase dir/$b -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {.exe}}\n \n # -dumpdir without -dumpbase.  The trailing dash in -dumpdir is given\n # by the user, thus not replaced with a dot.\n-outest \"$b lto sing dumpdir unnamed\" $sing \"-dumpdir dir/$b- -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {a.{out,exe}}}\n-outest \"$b lto mult dumpdir unnamed\" $mult \"-dumpdir dir/$b- -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {a.{out,exe}}}\n+outest \"$b lto sing dumpdir unnamed\" $sing \"-dumpdir dir/$b- -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--0.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {$aout}}\n+outest \"$b lto mult dumpdir unnamed\" $mult \"-dumpdir dir/$b- -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {$aout}}\n outest \"$b lto sing dumpdir named\" $sing \"-dumpdir dir/$b- -o $b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {-0.exe}}\n outest \"$b lto mult dumpdir named\" $mult \"-dumpdir dir/$b- -o $b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {-1.exe}}\n outest \"$b lto sing dumpdir namedb\" $sing \"-dumpdir dir/$b- -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {.exe}}\n outest \"$b lto mult dumpdir namedb\" $mult \"-dumpdir dir/$b- -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -wpa.???i.icf -ltrans0.ltrans.???r.final -ltrans0.ltrans.su} {.exe}}\n \n # -dumpdir and non-overriding -dumpbase.\n-outest \"$b lto dbswthdd sing unnamed\" $sing \"-dumpdir dir/ -dumpbase $b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {a.{out,exe}}}\n-outest \"$b lto dbswthdd mult unnamed\" $mult \"-dumpdir dir/ -dumpbase $b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {a.{out,exe}}}\n+outest \"$b lto dbswthdd sing unnamed\" $sing \"-dumpdir dir/ -dumpbase $b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {$aout}}\n+outest \"$b lto dbswthdd mult unnamed\" $mult \"-dumpdir dir/ -dumpbase $b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {$aout}}\n outest \"$b lto dbswthdd sing named\" $sing \"-dumpdir dir/ -dumpbase $b -o $b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {-0.exe}}\n outest \"$b lto dbswthdd mult named\" $mult \"-dumpdir dir/ -dumpbase $b -o $b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {-1.exe}}\n outest \"$b lto dbswthdd sing namedb\" $sing \"-dumpdir dir/ -dumpbase $b -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {.exe}}\n outest \"$b lto dbswthdd mult namedb\" $mult \"-dumpdir dir/ -dumpbase $b -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {.exe}}\n \n # -dumpdir and an overriding -dumpbase.\n-outest \"$b lto dbsovrdd sing unnamed\" $sing \"-dumpdir ignore/ -dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {a.{out,exe}}}\n-outest \"$b lto dbsovrdd mult unnamed\" $mult \"-dumpdir ignore/ -dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {a.{out,exe}}}\n+outest \"$b lto dbsovrdd sing unnamed\" $sing \"-dumpdir ignore/ -dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {$aout}}\n+outest \"$b lto dbsovrdd mult unnamed\" $mult \"-dumpdir ignore/ -dumpbase dir/$b -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {$aout}}\n outest \"$b lto dbsovrdd sing named\" $sing \"-dumpdir ignore/ -dumpbase dir/$b -o $b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {-0.exe}}\n outest \"$b lto dbsovrdd mult named\" $mult \"-dumpdir ignore/ -dumpbase dir/$b -o $b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {-1.exe}}\n outest \"$b lto dbsovrdd sing namedb\" $sing \"-dumpdir ignore/ -dumpbase dir/$b -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su} {.exe}}\n@@ -588,46 +653,49 @@ outest \"$b lto dbsovrdd mult namedb\" $mult \"-dumpdir ignore/ -dumpbase dir/$b -o\n # Check that -dumpbase '' gets source names as dumpbases for\n # compilation, and output name as dumpbase for linking, regardless of\n # how many source files.\n-outest \"$b lto sing empty dumpbase unnamed\" $sing \"-dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-0.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.{out,exe}}}\n-outest \"$b lto mult empty dumpbase unnamed\" $mult \"-dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-1.c.???i.icf -2.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.{out,exe}}}\n+outest \"$b lto sing empty dumpbase unnamed\" $sing \"-dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{-0.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n+outest \"$b lto mult empty dumpbase unnamed\" $mult \"-dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{-1.c.???i.icf -2.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n outest \"$b lto sing empty dumpbase named\" $sing \"-dumpbase \\\"\\\" -o dir/$b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-0.c.???i.icf -0.wpa.???i.icf -0.ltrans0.ltrans.???r.final -0.ltrans0.ltrans.su -0.exe} {}}\n outest \"$b lto mult empty dumpbase named\" $mult \"-dumpbase \\\"\\\" -o dir/$b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-1.c.???i.icf -2.c.???i.icf -1.wpa.???i.icf -1.ltrans0.ltrans.???r.final -1.ltrans0.ltrans.su -1.exe} {}}\n outest \"$b lto sing empty dumpbase namedb\" $sing \"-dumpbase \\\"\\\" -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n outest \"$b lto mult empty dumpbase namedb\" $mult \"-dumpbase \\\"\\\" -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-1.c.???i.icf -2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe}}\n \n # Now with -dumpdir too.\n-outest \"$b lto sing empty dumpbase dumpdir unnamed\" $sing \"-dumpdir dir/$b- -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf -a.wpa.???i.icf -a.ltrans0.ltrans.???r.final -a.ltrans0.ltrans.su} {a.{out,exe}}}\n-outest \"$b lto mult empty dumpbase dumpdir unnamed\" $mult \"-dumpdir dir/$b- -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -a.wpa.???i.icf -a.ltrans0.ltrans.???r.final -a.ltrans0.ltrans.su} {a.{out,exe}}}\n+outest \"$b lto sing empty dumpbase dumpdir unnamed\" $sing \"-dumpdir dir/$b- -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--0.c.???i.icf -a.wpa.???i.icf -a.ltrans0.ltrans.???r.final -a.ltrans0.ltrans.su} {$aout}}\n+outest \"$b lto mult empty dumpbase dumpdir unnamed\" $mult \"-dumpdir dir/$b- -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -a.wpa.???i.icf -a.ltrans0.ltrans.???r.final -a.ltrans0.ltrans.su} {$aout}}\n outest \"$b lto sing empty dumpbase dumpdir named\" $sing \"-dumpdir dir/$b- -dumpbase \\\"\\\" -o $b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf --0.wpa.???i.icf --0.ltrans0.ltrans.???r.final --0.ltrans0.ltrans.su} {-0.exe}}\n outest \"$b lto mult empty dumpbase dumpdir named\" $mult \"-dumpdir dir/$b- -dumpbase \\\"\\\" -o $b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf --1.wpa.???i.icf --1.ltrans0.ltrans.???r.final --1.ltrans0.ltrans.su} {-1.exe}}\n outest \"$b lto sing empty dumpbase dumpdir namedb\" $sing \"-dumpdir dir/$b- -dumpbase \\\"\\\" -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.c.???i.icf -.wpa.???i.icf -.ltrans0.ltrans.???r.final -.ltrans0.ltrans.su} {.exe}}\n outest \"$b lto mult empty dumpbase dumpdir namedb\" $mult \"-dumpdir dir/$b- -dumpbase \\\"\\\" -o $b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.c.???i.icf --2.c.???i.icf -.wpa.???i.icf -.ltrans0.ltrans.???r.final -.ltrans0.ltrans.su} {.exe}}\n \n # And also with an empty -dumpdir.  That's equivalent to -dumpdir ./,\n # overriding any dumpdir implied by the output.\n-outest \"$b lto sing empty dumpdir empty dumpbase unnamed\" $sing \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-0.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.{out,exe}}}\n-outest \"$b lto mult empty dumpdir empty dumpbase unnamed\" $mult \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-1.c.???i.icf -2.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.{out,exe}}}\n+outest \"$b lto sing empty dumpdir empty dumpbase unnamed\" $sing \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{-0.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n+outest \"$b lto mult empty dumpdir empty dumpbase unnamed\" $mult \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{-1.c.???i.icf -2.c.???i.icf a.wpa.???i.icf a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su $aout}}\n outest \"$b lto sing empty dumpdir empty dumpbase named\" $sing \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -o dir/$b-0.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-0.exe} {-0.c.???i.icf -0.wpa.???i.icf -0.ltrans0.ltrans.???r.final -0.ltrans0.ltrans.su}}\n outest \"$b lto mult empty dumpdir empty dumpbase named\" $mult \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -o dir/$b-1.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-1.exe} {-1.c.???i.icf -2.c.???i.icf -1.wpa.???i.icf -1.ltrans0.ltrans.???r.final -1.ltrans0.ltrans.su}}\n outest \"$b lto sing empty dumpdir empty dumpbase namedb\" $sing \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -o dir/$b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.exe} {-0.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su}}\n outest \"$b lto mult empty dumpdir empty dumpbase namedb\" $mult \"-dumpdir \\\"\\\" -dumpbase \\\"\\\" -o dir/$b.exe -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{.exe} {-1.c.???i.icf -2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su}}\n \n # Now -flto with -save-temps, not exhaustive.\n-outest \"$b lto st sing empty dumpbase unnamed\" $sing \"-dumpbase \\\"\\\" -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-0.i -0.s -0.o -0.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o a.{out,exe}}}\n-outest \"$b lto st mult empty dumpbase unnamed\" $mult \"-dumpbase \\\"\\\" -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{-1.i -1.s -1.o -1.c.???i.icf -2.i -2.s -2.o -2.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o a.{out,exe}}}\n+outest \"$b lto st sing empty dumpbase unnamed\" $sing \"-dumpbase \\\"\\\" -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{-0.i -0.s -0.o -0.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o $aout}}\n+outest \"$b lto st mult empty dumpbase unnamed\" $mult \"-dumpbase \\\"\\\" -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{-1.i -1.s -1.o -1.c.???i.icf -2.i -2.s -2.o -2.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o $aout}}\n outest \"$b lto st sing dumpdir empty dumpbase named\" $sing \"-dumpdir dir/ -dumpbase \\\"\\\" -o $b-0.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-0.i -0.s -0.o -0.c.???i.icf -0.lto_wrapper_args -0.wpa.???i.icf -0.ltrans.out -0.res -0.ltrans0.o -0.ltrans0.ltrans.???r.final -0.ltrans0.ltrans.su -0.ltrans0.ltrans.s -0.ltrans0.ltrans.o} {-0.exe}}\n outest \"$b lto st mult dumpdir empty dumpbase named\" $mult \"-dumpdir dir/ -dumpbase \\\"\\\" -o $b-1.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-1.i -1.s -1.o -1.c.???i.icf -2.i -2.s -2.o -2.c.???i.icf -1.lto_wrapper_args -1.wpa.???i.icf -1.ltrans.out -1.res -1.ltrans0.o -1.ltrans0.ltrans.???r.final -1.ltrans0.ltrans.su -1.ltrans0.ltrans.s -1.ltrans0.ltrans.o} {-1.exe}}\n outest \"$b lto st sing empty dumpbase namedb\" $sing \"-dumpbase \\\"\\\" -o dir/$b.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-0.i -0.s -0.o -0.c.???i.icf .lto_wrapper_args .wpa.???i.icf .ltrans.out .res .ltrans0.o .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .ltrans0.ltrans.s .ltrans0.ltrans.o .exe} {}}\n outest \"$b lto st mult empty dumpbase namedb\" $mult \"-dumpbase \\\"\\\" -o dir/$b.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-1.i -1.s -1.o -1.c.???i.icf -2.i -2.s -2.o -2.c.???i.icf .lto_wrapper_args .wpa.???i.icf .ltrans.out .res .ltrans0.o .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .ltrans0.ltrans.s .ltrans0.ltrans.o .exe} {}}\n \n # lto save-temps without -dumpbase.\n-outest \"$b lto st sing unnamed\" $sing \"-save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{a--0.i a--0.s a--0.o a--0.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o a.{out,exe}}}\n-outest \"$b lto st mult unnamed\" $mult \"-save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {} {{a--1.i a--1.s a--1.o a--1.c.???i.icf a--2.i a--2.s a--2.o a--2.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o a.{out,exe}}}\n+outest \"$b lto st sing unnamed\" $sing \"-save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--0.i a--0.s a--0.o a--0.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o $aout}}\n+outest \"$b lto st mult unnamed\" $mult \"-save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage $oaout\" {} {{a--1.i a--1.s a--1.o a--1.c.???i.icf a--2.i a--2.s a--2.o a--2.c.???i.icf a.lto_wrapper_args a.wpa.???i.icf a.ltrans.out a.res a.ltrans0.o a.ltrans0.ltrans.???r.final a.ltrans0.ltrans.su a.ltrans0.ltrans.s a.ltrans0.ltrans.o $aout}}\n outest \"$b lto st sing dumpdir named\" $sing \"-dumpdir dir/$b- -o $b-0.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.i --0.s --0.o --0.c.???i.icf -lto_wrapper_args -wpa.???i.icf -ltrans.out -res -ltrans0.o -ltrans0.ltrans.???r.final -ltrans0.ltrans.su -ltrans0.ltrans.s -ltrans0.ltrans.o} {-0.exe}}\n outest \"$b lto st mult dumpdir named\" $mult \"-dumpdir dir/$b- -o $b-1.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.i --1.s --1.o --1.c.???i.icf --2.i --2.s --2.o --2.c.???i.icf -lto_wrapper_args -wpa.???i.icf -ltrans.out -res -ltrans0.o -ltrans0.ltrans.???r.final -ltrans0.ltrans.su -ltrans0.ltrans.s -ltrans0.ltrans.o} {-1.exe}}\n outest \"$b lto st sing namedb\" $sing \"-o dir/$b.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--0.i --0.s --0.o --0.c.???i.icf .lto_wrapper_args .wpa.???i.icf .ltrans.out .res .ltrans0.o .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .ltrans0.ltrans.s .ltrans0.ltrans.o .exe} {}}\n outest \"$b lto st mult namedb\" $mult \"-o dir/$b.exe -save-temps -O2 -flto -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{--1.i --1.s --1.o --1.c.???i.icf --2.i --2.s --2.o --2.c.???i.icf .lto_wrapper_args .wpa.???i.icf .ltrans.out .res .ltrans0.o .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .ltrans0.ltrans.s .ltrans0.ltrans.o .exe} {}}\n \n+# !$skip_lto\n+}\n+\n # Below are examples taken from the documentation.\n # They are likely redundant with earlier test,\n # but we want to make sure behavior matches the docs.\n@@ -660,9 +728,10 @@ outest \"$b doc double  -c !-o -db\" $mult \"-c -dumpbase $b -fdump-rtl-final -fsta\n # gcc -c foo.c -o dir/foobar.o -dumpbase '' ...\n outest \"$b doc single  -c  -o -db''\" $sing \"-c -o dir/$b.o -dumpbase \\\"\\\" -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {dir/} {{-0.c.???r.final -0.su -0.dwo .o} {}}\n \n+if !$skip_lto {\n # gcc foo.c bar.c -o dir/foobar -dumpbase '' -flto ...\n outest \"$b doc double !-c  -o -db'' -flto\" $mult \"-o dir/$b.exe -dumpbase \\\"\\\" -flto -O2 -flto-partition=one -fdump-ipa-icf-optimized -fdump-rtl-final -fstack-usage\" {dir/} {{-1.c.???i.icf -2.c.???i.icf .wpa.???i.icf .ltrans0.ltrans.???r.final .ltrans0.ltrans.su .exe} {}}\n-\n+}\n \n # gcc foo.c -c -o dir/foo.o -dumpbase x-foo.c -dumpbase-ext .c ...\n outest \"$b doc single  -c  -o -dbx\" $sing \"-c -o dir/$b-0.o -dumpbase $b.c -dumpbase-ext .c -fdump-rtl-final -fstack-usage $gsplit_dwarf\" {dir/} {{.c.???r.final .su .dwo -0.o} {}}"}, {"sha": "d591cb36eb9562a4435b3070fb5833b766e54248", "filename": "gcc/testsuite/lib/gcc-defs.exp", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903/gcc%2Ftestsuite%2Flib%2Fgcc-defs.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903/gcc%2Ftestsuite%2Flib%2Fgcc-defs.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fgcc-defs.exp?ref=a728ec6b8bcdf8a6225ab98f19bdabff7e7a2903", "patch": "@@ -306,7 +306,9 @@ proc gcc_adjust_linker_flags {} {\n \t\tset nopts {}\n \t\tset skip \"\"\n \t\tforeach opt [split $opts] {\n-\t\t    if { $skip != \"\" } then {\n+\t\t    if { $opt == \"\" } then {\n+\t\t\tcontinue\n+\t\t    } elseif { $skip != \"\" } then {\n \t\t\tset skip \"\"\n \t\t    } elseif { $opt == \"-Xlinker\" } then {\n \t\t\tset skip $opt"}]}