{"sha": "a7037861a77985c3a8bccab9eefc02179694aa8e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTcwMzc4NjFhNzc5ODVjM2E4YmNjYWI5ZWVmYzAyMTc5Njk0YWE4ZQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2017-11-18T16:56:21Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2017-11-18T16:56:21Z"}, "message": "PR 83036 Make NEXTREC specifier for INQUIRE work for large record numbers\n\nThis is accomplished by making the NEXTREC specifier be a 8 byte\ninteger where supported.\n\nI wasn't able to come up with a testcase that does not create a large\nfile that could be added to the testsuite, but here's one which\ncreates a 2 GB file:\n\nprogram nextrec\n  implicit none\n  integer(8) :: ii, n\n  open(10, file=\"foo.dat\", recl=1, access=\"direct\", form=\"unformatted\", &\n       status=\"replace\")\n  do ii = 1, huge(1) + 2_8\n     write(10, rec=ii) 'a'\n  end do\n  inquire(10, nextrec=n)\n  if (n /= huge(1) + 3_8) then\n     call abort()\n  end if\n  close(10, status=\"delete\")\nend program nextrec\n\nRegtested on x86_64-pc-linux-gnu.\n\ngcc/fortran/ChangeLog:\n\n2017-11-18  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/83036\n\t* ioparm.def (IOPARM): Make nextrec a pintio.\n\nlibgfortran/ChangeLog:\n\n2017-11-18  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\tPR fortran/83036\n\t* io/io.h: Make nextrec a GFC_IO_INT*.\n---\n gcc/fortran/ioparm.def | 2 +-\n libgfortran/io/io.h    | 3 +--\n 2 files changed, 2 insertions(+), 3 deletions(-)\n\ndiff --git a/gcc/fortran/ioparm.def b/gcc/fortran/ioparm.def\nindex 5fc04bc..59cc7cd 100644\n--- a/gcc/fortran/ioparm.def\n+++ b/gcc/fortran/ioparm.def\n@@ -62,7 +62,7 @@ IOPARM (inquire, exist,\t\t1 << 7,  pint4)\n IOPARM (inquire, opened,\t1 << 8,  pint4)\n IOPARM (inquire, number,\t1 << 9,  pint4)\n IOPARM (inquire, named,\t\t1 << 10, pint4)\n-IOPARM (inquire, nextrec,\t1 << 11, pint4)\n+IOPARM (inquire, nextrec,\t1 << 11, pintio)\n IOPARM (inquire, recl_out,\t1 << 12, pintio)\n IOPARM (inquire, strm_pos_out,\t1 << 13, pintio)\n IOPARM (inquire, file,\t\t1 << 14, char1)\ndiff --git a/libgfortran/io/io.h b/libgfortran/io/io.h\nindex 3330bce..d29b112 100644\n--- a/libgfortran/io/io.h\n+++ b/libgfortran/io/io.h\n@@ -388,8 +388,7 @@ typedef struct\n {\n   st_parameter_common common;\n   GFC_INTEGER_4 *exist, *opened, *number, *named;\n-  GFC_INTEGER_4 *nextrec;\n-  GFC_IO_INT  *recl_out, *strm_pos_out;\n+  GFC_IO_INT *nextrec, *recl_out, *strm_pos_out;\n   CHARACTER1 (file);\n   CHARACTER2 (access);\n   CHARACTER1 (form);\n-- \n2.7.4\n\nFrom-SVN: r254916", "tree": {"sha": "908f33484497608024b58833bcb92e3cb14a4ed6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/908f33484497608024b58833bcb92e3cb14a4ed6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a7037861a77985c3a8bccab9eefc02179694aa8e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7037861a77985c3a8bccab9eefc02179694aa8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7037861a77985c3a8bccab9eefc02179694aa8e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7037861a77985c3a8bccab9eefc02179694aa8e/comments", "author": null, "committer": null, "parents": [{"sha": "831cf09d60eed9f14cb06e83831cf74ea328a3bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/831cf09d60eed9f14cb06e83831cf74ea328a3bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/831cf09d60eed9f14cb06e83831cf74ea328a3bf"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "2e8bbd82ce11b9efd072e9e9642b604e8b98ccf6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7037861a77985c3a8bccab9eefc02179694aa8e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7037861a77985c3a8bccab9eefc02179694aa8e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a7037861a77985c3a8bccab9eefc02179694aa8e", "patch": "@@ -1,3 +1,8 @@\n+2017-11-18  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR fortran/83036\n+\t* ioparm.def (IOPARM): Make nextrec a pintio.\n+\n 2017-11-18  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR fortran/44292"}, {"sha": "59cc7cdb432df6661a435b139ded48e33cf8e0a1", "filename": "gcc/fortran/ioparm.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7037861a77985c3a8bccab9eefc02179694aa8e/gcc%2Ffortran%2Fioparm.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7037861a77985c3a8bccab9eefc02179694aa8e/gcc%2Ffortran%2Fioparm.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fioparm.def?ref=a7037861a77985c3a8bccab9eefc02179694aa8e", "patch": "@@ -62,7 +62,7 @@ IOPARM (inquire, exist,\t\t1 << 7,  pint4)\n IOPARM (inquire, opened,\t1 << 8,  pint4)\n IOPARM (inquire, number,\t1 << 9,  pint4)\n IOPARM (inquire, named,\t\t1 << 10, pint4)\n-IOPARM (inquire, nextrec,\t1 << 11, pint4)\n+IOPARM (inquire, nextrec,\t1 << 11, pintio)\n IOPARM (inquire, recl_out,\t1 << 12, pintio)\n IOPARM (inquire, strm_pos_out,\t1 << 13, pintio)\n IOPARM (inquire, file,\t\t1 << 14, char1)"}, {"sha": "3af699d1640e40e3931f74825a8efc970ce840e5", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7037861a77985c3a8bccab9eefc02179694aa8e/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7037861a77985c3a8bccab9eefc02179694aa8e/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=a7037861a77985c3a8bccab9eefc02179694aa8e", "patch": "@@ -1,3 +1,8 @@\n+2017-11-18  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR fortran/83036\n+\t* io/io.h: Make nextrec a GFC_IO_INT*.\n+\n 2017-11-18  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR fortran/44292"}, {"sha": "d29b112b9c4474788989fd008df35ecb13292604", "filename": "libgfortran/io/io.h", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a7037861a77985c3a8bccab9eefc02179694aa8e/libgfortran%2Fio%2Fio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a7037861a77985c3a8bccab9eefc02179694aa8e/libgfortran%2Fio%2Fio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fio.h?ref=a7037861a77985c3a8bccab9eefc02179694aa8e", "patch": "@@ -388,8 +388,7 @@ typedef struct\n {\n   st_parameter_common common;\n   GFC_INTEGER_4 *exist, *opened, *number, *named;\n-  GFC_INTEGER_4 *nextrec;\n-  GFC_IO_INT  *recl_out, *strm_pos_out;\n+  GFC_IO_INT *nextrec, *recl_out, *strm_pos_out;\n   CHARACTER1 (file);\n   CHARACTER2 (access);\n   CHARACTER1 (form);"}]}