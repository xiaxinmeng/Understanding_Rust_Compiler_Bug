{"sha": "44f92b59c2785eb9a77c04baf7b442416f2c2dce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRmOTJiNTljMjc4NWViOWE3N2MwNGJhZjdiNDQyNDE2ZjJjMmRjZQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2015-10-21T21:40:05Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2015-10-21T21:40:05Z"}, "message": "re PR fortran/67939 (ICE on using data with negative substring range)\n\n2015-10-21  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/67939\n\t* data.c (create_character_initializer): Deal with zero length string.\n\n\n2015-10-21  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/67939\n\t* gfortran.dg/pr67939.f90: New test.\n\nFrom-SVN: r229153", "tree": {"sha": "7c9a5887c761c6e53bb17c254c94b09e5d6d5272", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c9a5887c761c6e53bb17c254c94b09e5d6d5272"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44f92b59c2785eb9a77c04baf7b442416f2c2dce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44f92b59c2785eb9a77c04baf7b442416f2c2dce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44f92b59c2785eb9a77c04baf7b442416f2c2dce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44f92b59c2785eb9a77c04baf7b442416f2c2dce/comments", "author": null, "committer": null, "parents": [{"sha": "f9badf7134ba51f5a114d58c10e61cb1acd83997", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9badf7134ba51f5a114d58c10e61cb1acd83997", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9badf7134ba51f5a114d58c10e61cb1acd83997"}], "stats": {"total": 55, "additions": 48, "deletions": 7}, "files": [{"sha": "399dc573ed3fddba6e119ccd5996b70eb3b00665", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=44f92b59c2785eb9a77c04baf7b442416f2c2dce", "patch": "@@ -1,3 +1,8 @@\n+2015-10-21  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/67939\n+\t* data.c (create_character_initializer): Deal with zero length string.\n+\n 2015-10-19  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \t* resolve.c (gfc_verify_binding_labels): Check for NULL pointer."}, {"sha": "07ca6ad8d32b008aa15eb7c3eebc065e8b1dc7bd", "filename": "gcc/fortran/data.c", "status": "modified", "additions": 17, "deletions": 7, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ffortran%2Fdata.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ffortran%2Fdata.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdata.c?ref=44f92b59c2785eb9a77c04baf7b442416f2c2dce", "patch": "@@ -104,7 +104,7 @@ static gfc_expr *\n create_character_initializer (gfc_expr *init, gfc_typespec *ts,\n \t\t\t      gfc_ref *ref, gfc_expr *rvalue)\n {\n-  int len, start, end;\n+  int len, start, end, tlen;\n   gfc_char_t *dest;\n   bool alloced_init = false;\n \t    \n@@ -162,12 +162,22 @@ create_character_initializer (gfc_expr *init, gfc_typespec *ts,\n   else\n     len = rvalue->value.character.length;\n \n-  if (len > end - start)\n+  tlen = end - start;\n+  if (len > tlen)\n     {\n-      gfc_warning_now (0, \"Initialization string starting at %L was \"\n-\t\t       \"truncated to fit the variable (%d/%d)\",\n-\t\t       &rvalue->where, end - start, len);\n-      len = end - start;\n+      if (tlen < 0)\n+\t{\n+\t  gfc_warning_now (0, \"Unused initialization string at %L because \"\n+\t\t\t   \"variable has zero length\", &rvalue->where);\n+\t  len = 0;\n+\t}\n+      else\n+\t{\n+\t  gfc_warning_now (0, \"Initialization string at %L was truncated to \"\n+\t\t\t   \"fit the variable (%d/%d)\", &rvalue->where,\n+\t\t\t   tlen, len);\n+\t  len = tlen;\n+\t}\n     }\n \n   if (rvalue->ts.type == BT_HOLLERITH)\n@@ -181,7 +191,7 @@ create_character_initializer (gfc_expr *init, gfc_typespec *ts,\n \t    len * sizeof (gfc_char_t));\n \n   /* Pad with spaces.  Substrings will already be blanked.  */\n-  if (len < end - start && ref == NULL)\n+  if (len < tlen && ref == NULL)\n     gfc_wide_memset (&dest[start + len], ' ', end - (start + len));\n \n   if (rvalue->ts.type == BT_HOLLERITH)"}, {"sha": "c6cc423dfefe036c341b43ceb1cf4aa116da7f60", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=44f92b59c2785eb9a77c04baf7b442416f2c2dce", "patch": "@@ -1,3 +1,8 @@\n+2015-10-21  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/67939\n+\t* gfortran.dg/pr67939.f90: New test.\n+\n 2015-10-21  Aditya Kumar  <aditya.k7@samsung.com>\n \t    Sebastian Pop  <s.pop@samsung.com>\n "}, {"sha": "d1694bb043324893017ef344dd4424237ac27c85", "filename": "gcc/testsuite/gfortran.dg/pr67939.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr67939.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44f92b59c2785eb9a77c04baf7b442416f2c2dce/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr67939.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr67939.f90?ref=44f92b59c2785eb9a77c04baf7b442416f2c2dce", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do compile }\n+! PR fortran/67939\n+! Original code by Gerhard Steinmetz\n+! gerhard dot steinmetz dot fortran at t-online dot de\n+!\n+program p\n+   character(100) :: x\n+   data x(998:99) /'ab'/   ! { dg-warning \"Unused initialization string\" }\n+   call a\n+end\n+\n+subroutine a\n+   character(2) :: x\n+   data x(:-1) /'ab'/      ! { dg-warning \"Unused initialization string\" }\n+end subroutine a\n+\n+subroutine b\n+   character(8) :: x\n+   data x(3:1) /'abc'/     ! { dg-warning \"Unused initialization string\" }\n+end subroutine b\n+"}]}