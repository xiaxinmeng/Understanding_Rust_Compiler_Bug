{"sha": "47265942fa55c8198ef712af8ee23c4700ca2dfb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDcyNjU5NDJmYTU1YzgxOThlZjcxMmFmOGVlMjNjNDcwMGNhMmRmYg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2016-07-25T19:16:16Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2016-07-25T19:16:16Z"}, "message": "PR c++/71837 - pack expansion in init-capture\n\n\t* lambda.c (add_capture): Leave a pack expansion in a TREE_LIST.\n\t(build_lambda_object): Call build_x_compound_expr_from_list.\n\t* pt.c (tsubst) [DECLTYPE_TYPE]: Likewise.\n\nFrom-SVN: r238733", "tree": {"sha": "3cfaeafad0fb02b4fdef81de985517f29e064e9c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3cfaeafad0fb02b4fdef81de985517f29e064e9c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47265942fa55c8198ef712af8ee23c4700ca2dfb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47265942fa55c8198ef712af8ee23c4700ca2dfb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47265942fa55c8198ef712af8ee23c4700ca2dfb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47265942fa55c8198ef712af8ee23c4700ca2dfb/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e27f0bc9ca3e9d9266eb299ee6a27daef5c1e0b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e27f0bc9ca3e9d9266eb299ee6a27daef5c1e0b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e27f0bc9ca3e9d9266eb299ee6a27daef5c1e0b6"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "87020979510d8b2d816ec8847aab3f7adb029f44", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=47265942fa55c8198ef712af8ee23c4700ca2dfb", "patch": "@@ -1,5 +1,10 @@\n 2016-07-25  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/71837\n+\t* lambda.c (add_capture): Leave a pack expansion in a TREE_LIST.\n+\t(build_lambda_object): Call build_x_compound_expr_from_list.\n+\t* pt.c (tsubst) [DECLTYPE_TYPE]: Likewise.\n+\n \tPR c++/71833\n \tPR c++/54440\n \t* pt.c (coerce_template_parameter_pack): Fix logic for"}, {"sha": "9bf8a560d020be028160d9039623848272550023", "filename": "gcc/cp/lambda.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Fcp%2Flambda.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Fcp%2Flambda.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flambda.c?ref=47265942fa55c8198ef712af8ee23c4700ca2dfb", "patch": "@@ -79,6 +79,10 @@ build_lambda_object (tree lambda_expr)\n \t  goto out;\n \t}\n \n+      if (TREE_CODE (val) == TREE_LIST)\n+\tval = build_x_compound_expr_from_list (val, ELK_INIT,\n+\t\t\t\t\t       tf_warning_or_error);\n+\n       if (DECL_P (val))\n \tmark_used (val);\n \n@@ -449,7 +453,9 @@ add_capture (tree lambda, tree id, tree orig_init, bool by_reference_p,\n       variadic = true;\n     }\n \n-  if (TREE_CODE (initializer) == TREE_LIST)\n+  if (TREE_CODE (initializer) == TREE_LIST\n+      /* A pack expansion might end up with multiple elements.  */\n+      && !PACK_EXPANSION_P (TREE_VALUE (initializer)))\n     initializer = build_x_compound_expr_from_list (initializer, ELK_INIT,\n \t\t\t\t\t\t   tf_warning_or_error);\n   type = TREE_TYPE (initializer);"}, {"sha": "97d50001b146b211b9f287312571eb8f557c3650", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=47265942fa55c8198ef712af8ee23c4700ca2dfb", "patch": "@@ -13620,6 +13620,18 @@ tsubst (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \t\t\t\t      /*function_p*/false,\n \t\t\t\t      /*integral_constant_expression*/false);\n \n+\tif (DECLTYPE_FOR_INIT_CAPTURE (t))\n+\t  {\n+\t    if (type == NULL_TREE)\n+\t      {\n+\t\tif (complain & tf_error)\n+\t\t  error (\"empty initializer in lambda init-capture\");\n+\t\ttype = error_mark_node;\n+\t      }\n+\t    else if (TREE_CODE (type) == TREE_LIST)\n+\t      type = build_x_compound_expr_from_list (type, ELK_INIT, complain);\n+\t  }\n+\n \t--cp_unevaluated_operand;\n \t--c_inhibit_evaluation_warnings;\n "}, {"sha": "8b3e5205aeda603d1306f3998c9ef185d4982b4b", "filename": "gcc/testsuite/g++.dg/cpp1y/lambda-init15.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-init15.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-init15.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-init15.C?ref=47265942fa55c8198ef712af8ee23c4700ca2dfb", "patch": "@@ -0,0 +1,13 @@\n+// PR c++/71837\n+// { dg-do compile { target c++14 } }\n+\n+template < typename ... Ts > void f (Ts ... args)\n+{\n+  [ts (args ...)] { return ts; } ();\n+}\n+\n+int main ()\n+{ \n+  f (0);\n+  return 0;\n+}"}, {"sha": "166d650d4f7998e7e8d3ea2830d29b053e406538", "filename": "gcc/testsuite/g++.dg/cpp1y/lambda-init15a.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-init15a.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47265942fa55c8198ef712af8ee23c4700ca2dfb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-init15a.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-init15a.C?ref=47265942fa55c8198ef712af8ee23c4700ca2dfb", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/71837\n+// { dg-do compile { target c++14 } }\n+\n+template < typename ... Ts > void f (Ts ... args)\n+{\n+  [ts (args ...)] { return ts; } (); // { dg-error \"\" }\n+}\n+\n+int main ()\n+{ \n+  f ();\t\t\t\t// { dg-message \"required\" }\n+  f (1,2);\t\t\t// { dg-message \"required\" }\n+  return 0;\n+}"}]}