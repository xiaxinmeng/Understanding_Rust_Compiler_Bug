{"sha": "deb3da39d6ec5b94f45679860ae48a7037939f9f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGViM2RhMzlkNmVjNWI5NGY0NTY3OTg2MGFlNDhhNzAzNzkzOWY5Zg==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2018-03-09T15:24:44Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2018-03-09T15:24:44Z"}, "message": "jit: use 'configure' to replace hard-coded linker options (PR jit/64089 and PR jit/84288)\n\ngcc/ChangeLog:\n\tPR jit/64089\n\tPR jit/84288\n\t* Makefile.in (LD_VERSION_SCRIPT_OPTION, LD_SONAME_OPTION): New.\n\t* configure: Regenerate.\n\t* configure.ac (\"linker --version-script option\"): New.\n\t(\"linker soname option\"): New.\n\ngcc/jit/ChangeLog:\n\tPR jit/64089\n\tPR jit/84288\n\t* Make-lang.in (COMMA): New.\n\t(LIBGCCJIT_VERSION_SCRIPT_OPTION): New.\n\t(LIBGCCJIT_SONAME_OPTION): New.\n\t(jit): Move --version-script and -soname linker options to the\n\tabove.\n\n\nCo-Authored-By: Francois-Xavier Coudert <fxcoudert@gcc.gnu.org>\n\nFrom-SVN: r258388", "tree": {"sha": "be3e50e2422a1c4eff607d0c25b1b0133ae9dc03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be3e50e2422a1c4eff607d0c25b1b0133ae9dc03"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/deb3da39d6ec5b94f45679860ae48a7037939f9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/deb3da39d6ec5b94f45679860ae48a7037939f9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/deb3da39d6ec5b94f45679860ae48a7037939f9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/deb3da39d6ec5b94f45679860ae48a7037939f9f/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "20003c3cc31bf4ef40a0e03b4f237698e3e1b0ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20003c3cc31bf4ef40a0e03b4f237698e3e1b0ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20003c3cc31bf4ef40a0e03b4f237698e3e1b0ec"}], "stats": {"total": 129, "additions": 125, "deletions": 4}, "files": [{"sha": "6bc488ce5f101af9086d71f737a289f44c4e7af5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=deb3da39d6ec5b94f45679860ae48a7037939f9f", "patch": "@@ -1,3 +1,13 @@\n+2018-03-09  David Malcolm  <dmalcolm@redhat.com>\n+\t    Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR jit/64089\n+\tPR jit/84288\n+\t* Makefile.in (LD_VERSION_SCRIPT_OPTION, LD_SONAME_OPTION): New.\n+\t* configure: Regenerate.\n+\t* configure.ac (\"linker --version-script option\"): New.\n+\t(\"linker soname option\"): New.\n+\n 2018-03-09  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/84775"}, {"sha": "20bee0494b1bad4e3ec34e2eae291cf6eadc3aa1", "filename": "gcc/Makefile.in", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=deb3da39d6ec5b94f45679860ae48a7037939f9f", "patch": "@@ -1116,6 +1116,10 @@ endif\n \n LANG_MAKEFRAGS = @all_lang_makefrags@\n \n+# Used by gcc/jit/Make-lang.in\n+LD_VERSION_SCRIPT_OPTION = @ld_version_script_option@\n+LD_SONAME_OPTION = @ld_soname_option@\n+\n # Flags to pass to recursive makes.\n # CC is set by configure.\n # ??? The choices here will need some experimenting with."}, {"sha": "c2d3f752347fc5ae747e46b515838615f8495fc0", "filename": "gcc/configure", "status": "modified", "additions": 47, "deletions": 2, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=deb3da39d6ec5b94f45679860ae48a7037939f9f", "patch": "@@ -680,6 +680,8 @@ zlibdir\n HOST_LIBS\n enable_default_ssp\n thin_archive_support\n+ld_soname_option\n+ld_version_script_option\n libgcc_visibility\n gcc_cv_readelf\n gcc_cv_objdump\n@@ -18446,7 +18448,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18449 \"configure\"\n+#line 18451 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -18552,7 +18554,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 18555 \"configure\"\n+#line 18557 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -24453,6 +24455,48 @@ fi\n { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $gcc_cv_ld_static_dynamic\" >&5\n $as_echo \"$gcc_cv_ld_static_dynamic\" >&6; }\n \n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking linker --version-script option\" >&5\n+$as_echo_n \"checking linker --version-script option... \" >&6; }\n+gcc_cv_ld_version_script=no\n+ld_version_script_option=''\n+if test $in_tree_ld = yes || test x\"$gnu_ld\" = xyes; then\n+  gcc_cv_ld_version_script=yes\n+  ld_version_script_option='--version-script'\n+elif test x$gcc_cv_ld != x; then\n+  case \"$target\" in\n+    # Solaris 2 ld always supports -M.  It also supports a subset of\n+    # --version-script since Solaris 11.4, but requires\n+    # -z gnu-version-script-compat to activate.\n+    *-*-solaris2*)\n+      gcc_cv_ld_version_script=yes\n+      ld_version_script_option='-M'\n+      ;;\n+  esac\n+fi\n+# Don't AC_DEFINE result, only used in jit/Make-lang.in so far.\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $gcc_cv_ld_version_script\" >&5\n+$as_echo \"$gcc_cv_ld_version_script\" >&6; }\n+\n+\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking linker soname option\" >&5\n+$as_echo_n \"checking linker soname option... \" >&6; }\n+gcc_cv_ld_soname=no\n+if test $in_tree_ld = yes || test x\"$gnu_ld\" = xyes; then\n+  gcc_cv_ld_soname=yes\n+  ld_soname_option='-soname'\n+elif test x$gcc_cv_ld != x; then\n+  case \"$target\" in\n+    *-*-darwin*)\n+      gcc_cv_ld_soname=yes\n+      ld_soname_option='-install_name'\n+      ;;\n+  esac\n+fi\n+# Don't AC_DEFINE result, only used in jit/Make-lang.in so far.\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $gcc_cv_ld_soname\" >&5\n+$as_echo \"$gcc_cv_ld_soname\" >&6; }\n+\n+\n if test x\"$demangler_in_ld\" = xyes; then\n   { $as_echo \"$as_me:${as_lineno-$LINENO}: checking linker --demangle support\" >&5\n $as_echo_n \"checking linker --demangle support... \" >&6; }\n@@ -27870,6 +27914,7 @@ if test $gcc_cv_as_dwarf2_debug_view = yes; then\n $as_echo \"#define HAVE_AS_DWARF2_DEBUG_VIEW 1\" >>confdefs.h\n \n fi\n+\n     fi\n  fi\n "}, {"sha": "c3c76acd0814b9c06924016b0d28f989f2134291", "filename": "gcc/configure.ac", "status": "modified", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=deb3da39d6ec5b94f45679860ae48a7037939f9f", "patch": "@@ -3655,6 +3655,44 @@ if test x\"$gcc_cv_ld_static_dynamic\" = xyes; then\n fi\n AC_MSG_RESULT($gcc_cv_ld_static_dynamic)\n \n+AC_MSG_CHECKING(linker --version-script option)\n+gcc_cv_ld_version_script=no\n+ld_version_script_option=''\n+if test $in_tree_ld = yes || test x\"$gnu_ld\" = xyes; then\n+  gcc_cv_ld_version_script=yes\n+  ld_version_script_option='--version-script'\n+elif test x$gcc_cv_ld != x; then\n+  case \"$target\" in\n+    # Solaris 2 ld always supports -M.  It also supports a subset of\n+    # --version-script since Solaris 11.4, but requires\n+    # -z gnu-version-script-compat to activate.\n+    *-*-solaris2*)\n+      gcc_cv_ld_version_script=yes\n+      ld_version_script_option='-M'\n+      ;;\n+  esac\n+fi\n+# Don't AC_DEFINE result, only used in jit/Make-lang.in so far.\n+AC_MSG_RESULT($gcc_cv_ld_version_script)\n+AC_SUBST(ld_version_script_option)\n+\n+AC_MSG_CHECKING(linker soname option)\n+gcc_cv_ld_soname=no\n+if test $in_tree_ld = yes || test x\"$gnu_ld\" = xyes; then\n+  gcc_cv_ld_soname=yes\n+  ld_soname_option='-soname'\n+elif test x$gcc_cv_ld != x; then\n+  case \"$target\" in\n+    *-*-darwin*)\n+      gcc_cv_ld_soname=yes\n+      ld_soname_option='-install_name'\n+      ;;\n+  esac\n+fi\n+# Don't AC_DEFINE result, only used in jit/Make-lang.in so far.\n+AC_MSG_RESULT($gcc_cv_ld_soname)\n+AC_SUBST(ld_soname_option)\n+\n if test x\"$demangler_in_ld\" = xyes; then\n   AC_MSG_CHECKING(linker --demangle support)\n   gcc_cv_ld_demangle=no"}, {"sha": "8ae54f93f84cdb21a8573fa607eb96b5fd6edb84", "filename": "gcc/jit/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fjit%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fjit%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2FChangeLog?ref=deb3da39d6ec5b94f45679860ae48a7037939f9f", "patch": "@@ -1,3 +1,14 @@\n+2018-03-09  David Malcolm  <dmalcolm@redhat.com>\n+\t    Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR jit/64089\n+\tPR jit/84288\n+\t* Make-lang.in (COMMA): New.\n+\t(LIBGCCJIT_VERSION_SCRIPT_OPTION): New.\n+\t(LIBGCCJIT_SONAME_OPTION): New.\n+\t(jit): Move --version-script and -soname linker options to the\n+\tabove.\n+\n 2018-01-25  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR jit/81672"}, {"sha": "ba78f8ecaf3027a3be4bbd8d0767c454d5d12e04", "filename": "gcc/jit/Make-lang.in", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fjit%2FMake-lang.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/deb3da39d6ec5b94f45679860ae48a7037939f9f/gcc%2Fjit%2FMake-lang.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2FMake-lang.in?ref=deb3da39d6ec5b94f45679860ae48a7037939f9f", "patch": "@@ -51,6 +51,19 @@ LIBGCCJIT_FILENAME = \\\n LIBGCCJIT_LINKER_NAME_SYMLINK = $(LIBGCCJIT_LINKER_NAME)\n LIBGCCJIT_SONAME_SYMLINK = $(LIBGCCJIT_SONAME)\n \n+# Conditionalize the use of the LD_VERSION_SCRIPT_OPTION and\n+# LD_SONAME_OPTION depending if configure found them, using $(if)\n+# We have to define a COMMA here, otherwise the commas in the \"true\"\n+# result are treated as separators by the $(if).\n+COMMA := ,\n+LIBGCCJIT_VERSION_SCRIPT_OPTION = \\\n+\t$(if $(LD_VERSION_SCRIPT_OPTION),\\\n+\t  -Wl$(COMMA)$(LD_VERSION_SCRIPT_OPTION)$(COMMA)$(srcdir)/jit/libgccjit.map)\n+\n+LIBGCCJIT_SONAME_OPTION = \\\n+\t$(if $(LD_SONAME_OPTION), \\\n+\t     -Wl$(COMMA)$(LD_SONAME_OPTION)$(COMMA)$(LIBGCCJIT_SONAME))\n+\n jit: $(LIBGCCJIT_FILENAME) \\\n \t$(LIBGCCJIT_SYMLINK) \\\n \t$(LIBGCCJIT_LINKER_NAME_SYMLINK) \\\n@@ -85,8 +98,8 @@ $(LIBGCCJIT_FILENAME): $(jit_OBJS) \\\n \t     $(jit_OBJS) libbackend.a libcommon-target.a libcommon.a \\\n \t     $(CPPLIB) $(LIBDECNUMBER) $(LIBS) $(BACKENDLIBS) \\\n \t     $(EXTRA_GCC_OBJS) \\\n-\t     -Wl,--version-script=$(srcdir)/jit/libgccjit.map \\\n-\t     -Wl,-soname,$(LIBGCCJIT_SONAME)\n+\t     $(LIBGCCJIT_VERSION_SCRIPT_OPTION) \\\n+\t     $(LIBGCCJIT_SONAME_OPTION)\n \n $(LIBGCCJIT_SONAME_SYMLINK): $(LIBGCCJIT_FILENAME)\n \tln -sf $(LIBGCCJIT_FILENAME) $(LIBGCCJIT_SONAME_SYMLINK)"}]}