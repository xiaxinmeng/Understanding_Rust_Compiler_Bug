{"sha": "c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzNiYWY0YjU1YTI0MTNkYzc5MWNlNDhmOTViZTM4YzhjNmJjZDc2NQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@yorick.cygnus.com", "date": "1998-07-17T16:29:25Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "1998-07-17T16:29:25Z"}, "message": "pt.c (lookup_template_class): Don't mess with the context of the instantiation.\n\n\t* pt.c (lookup_template_class): Don't mess with the context of the\n\tinstantiation.\n\t* decl2.c (current_decl_namespace): Remove special handling for\n\ttemplates.\n\nFrom-SVN: r21265", "tree": {"sha": "3830f6062ef3e0e2da9980b7347ae9abe98b443c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3830f6062ef3e0e2da9980b7347ae9abe98b443c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/comments", "author": null, "committer": null, "parents": [{"sha": "402cdad5e7e27154bfeb296fbcdc67a30cf586c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/402cdad5e7e27154bfeb296fbcdc67a30cf586c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/402cdad5e7e27154bfeb296fbcdc67a30cf586c9"}], "stats": {"total": 36, "additions": 11, "deletions": 25}, "files": [{"sha": "7d5fb71f9ae79370a4666541b6aaa95c532c42f8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "patch": "@@ -1,5 +1,10 @@\n 1998-07-17  Jason Merrill  <jason@yorick.cygnus.com>\n \n+\t* pt.c (lookup_template_class): Don't mess with the context of the\n+\tinstantiation.\n+\t* decl2.c (current_decl_namespace): Remove special handling for\n+\ttemplates.\n+\n \t* pt.c (tsubst, case FUNCTION_DECL): Fix getting complete args for\n \ta member template specialization.\n "}, {"sha": "e484e6d4cf6724c443d5a053c4b07a2d6633ea69", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "patch": "@@ -4136,15 +4136,9 @@ current_decl_namespace ()\n     return TREE_PURPOSE (decl_namespace_list);\n \n   if (current_class_type)\n-    if (CLASSTYPE_USE_TEMPLATE (current_class_type))\n-      result = decl_namespace (CLASSTYPE_TI_TEMPLATE (current_class_type));\n-    else\n-      result = decl_namespace (TYPE_STUB_DECL (current_class_type));\n+    result = decl_namespace (TYPE_STUB_DECL (current_class_type));\n   else if (current_function_decl)\n-    if (DECL_USE_TEMPLATE (current_function_decl))\n-      result = decl_namespace (DECL_TI_TEMPLATE (current_function_decl));\n-    else\n-      result = decl_namespace (current_function_decl);\n+    result = decl_namespace (current_function_decl);\n   else \n     result = current_namespace;\n   return result;"}, {"sha": "ed23223d664efbc9251bfebb3096da162acf6698", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 4, "deletions": 17, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3baf4b55a2413dc791ce48f95be38c8c6bcd765/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=c3baf4b55a2413dc791ce48f95be38c8c6bcd765", "patch": "@@ -2985,7 +2985,7 @@ lookup_template_class (d1, arglist, in_decl, context)\n {\n   tree template = NULL_TREE, parmlist;\n   char *mangled_name;\n-  tree id, t, id_context;\n+  tree id, t;\n \n   if (TREE_CODE (d1) == IDENTIFIER_NODE)\n     {\n@@ -3030,28 +3030,15 @@ lookup_template_class (d1, arglist, in_decl, context)\n   else\n     my_friendly_abort (272);\n \n-  /* A namespace is used as context only for mangling.\n-     Template IDs with namespace context are found \n-     in the global binding level.  */\n-  if (context != NULL_TREE && TREE_CODE (context) == NAMESPACE_DECL)\n-    context = global_namespace;\n-\n   /* With something like `template <class T> class X class X { ... };'\n      we could end up with D1 having nothing but an IDENTIFIER_LOCAL_VALUE.\n      We don't want to do that, but we have to deal with the situation, so\n      let's give them some syntax errors to chew on instead of a crash.  */\n   if (! template)\n     return error_mark_node;\n \n-  /* We need an id_context to get the mangling right. If this is a\n-     nested template, use the context. If it is global, retrieve the\n-     context from the template.  */\n-  if (context && TREE_CODE (context) != NAMESPACE_DECL)\n-    id_context = context;\n-  else\n-    id_context = DECL_CONTEXT (template);\n-  if (id_context == NULL_TREE)\n-    id_context = global_namespace;\n+  if (context == NULL_TREE)\n+    context = global_namespace;\n \n   if (TREE_CODE (template) != TEMPLATE_DECL)\n     {\n@@ -3154,7 +3141,7 @@ lookup_template_class (d1, arglist, in_decl, context)\n       mangled_name = mangle_class_name_for_template (IDENTIFIER_POINTER (d1),\n \t\t\t\t\t\t     parmlist,\n \t\t\t\t\t\t     arglist_for_mangling,\n-\t\t\t\t\t\t     id_context);\n+\t\t\t\t\t\t     context);\n       id = get_identifier (mangled_name);\n       IDENTIFIER_TEMPLATE (id) = d1;\n "}]}