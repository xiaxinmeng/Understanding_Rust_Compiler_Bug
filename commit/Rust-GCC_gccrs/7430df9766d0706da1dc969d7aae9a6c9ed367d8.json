{"sha": "7430df9766d0706da1dc969d7aae9a6c9ed367d8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQzMGRmOTc2NmQwNzA2ZGExZGM5NjlkN2FhZTlhNmM5ZWQzNjdkOA==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2014-12-29T10:45:21Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2014-12-29T10:45:21Z"}, "message": "re PR fortran/60357 ([F08] structure constructor with unspecified values for allocatable components)\n\n2014-12-29  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/60357\n\t* array.c (check_constructor): Ignore empty expressions.\n\t* expr.c (check_alloc_comp_init): Check if constructor expression\n\texists.\n\t* primary.c (build_actual_constructor): Warn for absent alloc-comp\n\tinitializers in pre-2008 standards.\n\n2014-12-29  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/60357\n\t* gfortran.dg/alloc_comp_constructor_7.f90: New.\n\nFrom-SVN: r219098", "tree": {"sha": "09c521ceb79d4e0937eba0cc70142b17b77d1255", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/09c521ceb79d4e0937eba0cc70142b17b77d1255"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7430df9766d0706da1dc969d7aae9a6c9ed367d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7430df9766d0706da1dc969d7aae9a6c9ed367d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7430df9766d0706da1dc969d7aae9a6c9ed367d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7430df9766d0706da1dc969d7aae9a6c9ed367d8/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8cd2f58d8422616e32e236f1eb4301ccfbea69c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8cd2f58d8422616e32e236f1eb4301ccfbea69c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8cd2f58d8422616e32e236f1eb4301ccfbea69c0"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "3329c42347d1edf7b374a5939f1d394fc65b611d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=7430df9766d0706da1dc969d7aae9a6c9ed367d8", "patch": "@@ -1,3 +1,12 @@\n+2014-12-29  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/60357\n+\t* array.c (check_constructor): Ignore empty expressions.\n+\t* expr.c (check_alloc_comp_init): Check if constructor expression\n+\texists.\n+\t* primary.c (build_actual_constructor): Warn for absent alloc-comp\n+\tinitializers in pre-2008 standards.\n+\n 2014-12-28  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/56867"}, {"sha": "67bd42b511f50cfb887514940c76df1d55b1dd2c", "filename": "gcc/fortran/array.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2Farray.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2Farray.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Farray.c?ref=7430df9766d0706da1dc969d7aae9a6c9ed367d8", "patch": "@@ -1309,6 +1309,9 @@ check_constructor (gfc_constructor_base ctor, bool (*check_function) (gfc_expr *\n     {\n       e = c->expr;\n \n+      if (!e)\n+\tcontinue;\n+\n       if (e->expr_type != EXPR_ARRAY)\n \t{\n \t  if (!(*check_function)(e))"}, {"sha": "51f527dad122267606f2634d1fa3618a7651b598", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=7430df9766d0706da1dc969d7aae9a6c9ed367d8", "patch": "@@ -2201,7 +2201,7 @@ check_alloc_comp_init (gfc_expr *e)\n        ctor = gfc_constructor_first (e->value.constructor);\n        comp; comp = comp->next, ctor = gfc_constructor_next (ctor))\n     {\n-      if (comp->attr.allocatable\n+      if (comp->attr.allocatable && ctor->expr\n           && ctor->expr->expr_type != EXPR_NULL)\n         {\n \t  gfc_error (\"Invalid initialization expression for ALLOCATABLE \""}, {"sha": "78c24d48015847d989ca381444cd80d8dd5cfbdb", "filename": "gcc/fortran/primary.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2Fprimary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ffortran%2Fprimary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fprimary.c?ref=7430df9766d0706da1dc969d7aae9a6c9ed367d8", "patch": "@@ -2367,6 +2367,13 @@ build_actual_constructor (gfc_structure_ctor_component **comp_head,\n \t\treturn false;\n \t      value = gfc_copy_expr (comp->initializer);\n \t    }\n+\t  else if (comp->attr.allocatable)\n+\t    {\n+\t      if (!gfc_notify_std (GFC_STD_F2008, \"No initializer for \"\n+\t\t  \"allocatable component '%s' given in the structure \"\n+\t\t  \"constructor at %C\", comp->name))\n+\t\treturn false;\n+\t    }\n \t  else if (!comp->attr.deferred_parameter)\n \t    {\n \t      gfc_error (\"No initializer for component %qs given in the\""}, {"sha": "5706f62f922d33fec53d66275c533259d600e95a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7430df9766d0706da1dc969d7aae9a6c9ed367d8", "patch": "@@ -1,3 +1,8 @@\n+2014-12-29  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/60357\n+\t* gfortran.dg/alloc_comp_constructor_7.f90: New.\n+\n 2014-12-29  Hans-Peter Nilsson  <hp@axis.com>\n \n \t* gcc.dg/lto/pr59626_0.c (ASMNAME, ASMNAME2, STRING): Define."}, {"sha": "45d82726ae05a1bec16404df1fa4efc0e3a08dcb", "filename": "gcc/testsuite/gfortran.dg/alloc_comp_constructor_7.f90", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ftestsuite%2Fgfortran.dg%2Falloc_comp_constructor_7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7430df9766d0706da1dc969d7aae9a6c9ed367d8/gcc%2Ftestsuite%2Fgfortran.dg%2Falloc_comp_constructor_7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Falloc_comp_constructor_7.f90?ref=7430df9766d0706da1dc969d7aae9a6c9ed367d8", "patch": "@@ -0,0 +1,18 @@\n+! { dg-do run }\n+!\n+! PR 60357: [F08] structure constructor with unspecified values for allocatable components\n+!\n+! Contributed by Antony Lewis <antony@cosmologist.info>\n+\n+Type A\n+  integer :: X = 1\n+  integer, allocatable :: y\n+  integer, allocatable :: z(:)\n+end type\n+\n+Type(A) :: Me = A(X=1)\n+\n+if (allocated(Me%y)) call abort\n+if (allocated(Me%z)) call abort\n+\n+end"}]}