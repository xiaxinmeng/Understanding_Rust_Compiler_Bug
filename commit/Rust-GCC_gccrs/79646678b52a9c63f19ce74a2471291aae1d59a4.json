{"sha": "79646678b52a9c63f19ce74a2471291aae1d59a4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzk2NDY2NzhiNTJhOWM2M2YxOWNlNzRhMjQ3MTI5MWFhZTFkNTlhNA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2007-09-08T10:30:06Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2007-09-08T10:30:06Z"}, "message": "decl.c (gnat_to_gnu_entity): Simplify the condition under which a constant renaming is treated as a normal...\n\n\t* decl.c (gnat_to_gnu_entity) <Object>: Simplify the condition under\n\twhich a constant renaming is treated as a normal object declaration.\n\t* trans.c (lvalue_required_p) <N_Slice>: New case, extracted from\n\tthe N_Indexed_Component case.\n\t<N_Indexed_Component>: Fall through to above case.\n\t<N_Object_Renaming_Declaration>: Return true for all composite types.\n\nFrom-SVN: r128268", "tree": {"sha": "e298e197d6ac93776440288b70e8a3888ecd21df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e298e197d6ac93776440288b70e8a3888ecd21df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/79646678b52a9c63f19ce74a2471291aae1d59a4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79646678b52a9c63f19ce74a2471291aae1d59a4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79646678b52a9c63f19ce74a2471291aae1d59a4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79646678b52a9c63f19ce74a2471291aae1d59a4/comments", "author": null, "committer": null, "parents": [{"sha": "3b9f15d25672cf8dcaf66cee2eb80108aa07ba57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b9f15d25672cf8dcaf66cee2eb80108aa07ba57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b9f15d25672cf8dcaf66cee2eb80108aa07ba57"}], "stats": {"total": 65, "additions": 55, "deletions": 10}, "files": [{"sha": "3c5969d96ea3e9f95b63cfb50644988618a47e1a", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=79646678b52a9c63f19ce74a2471291aae1d59a4", "patch": "@@ -1,3 +1,12 @@\n+2007-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* decl.c (gnat_to_gnu_entity) <Object>: Simplify the condition under\n+\twhich a constant renaming is treated as a normal object declaration.\n+\t* trans.c (lvalue_required_p) <N_Slice>: New case, extracted from\n+\tthe N_Indexed_Component case.\n+\t<N_Indexed_Component>: Fall through to above case.\n+\t<N_Object_Renaming_Declaration>: Return true for all composite types.\n+\n 2007-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* decl.c (make_packable_type): If the new type has been given BLKmode,"}, {"sha": "202cca851ad3d2b13f8e9b5115086448b93b4e59", "filename": "gcc/ada/decl.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Fada%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Fada%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fdecl.c?ref=79646678b52a9c63f19ce74a2471291aae1d59a4", "patch": "@@ -815,10 +815,7 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \t\t/* Case 3: If this is a constant renaming and creating a\n \t\t   new object is allowed and cheap, treat it as a normal\n \t\t   object whose initial value is what is being renamed.  */\n-\t\tif (const_flag\n-\t\t    && Ekind (Etype (gnat_entity)) != E_Class_Wide_Type\n-\t\t    && TREE_CODE (gnu_type) != UNCONSTRAINED_ARRAY_TYPE\n-\t\t    && TYPE_MODE (gnu_type) != BLKmode)\n+\t\tif (const_flag && Is_Elementary_Type (Etype (gnat_entity)))\n \t\t  ;\n \n \t\t/* Case 4: Make this into a constant pointer to the object we"}, {"sha": "1a4067c8639eb2c13ff2c035659f10f7c881764a", "filename": "gcc/ada/trans.c", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Fada%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Fada%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ftrans.c?ref=79646678b52a9c63f19ce74a2471291aae1d59a4", "patch": "@@ -384,20 +384,28 @@ lvalue_required_p (Node_Id gnat_node, tree operand_type, int aliased)\n \t     gnat_temp = Next (gnat_temp))\n \t  if (Nkind (gnat_temp) != N_Integer_Literal)\n \t    return 1;\n-\taliased |= Has_Aliased_Components (Etype (Prefix (gnat_node)));\n-\treturn lvalue_required_p (Parent (gnat_node), operand_type, aliased);\n       }\n \n+      /* ... fall through ... */\n+\n+    case N_Slice:\n+      aliased |= Has_Aliased_Components (Etype (Prefix (gnat_node)));\n+      return lvalue_required_p (Parent (gnat_node), operand_type, aliased);\n+\n     case N_Selected_Component:\n       aliased |= Is_Aliased (Entity (Selector_Name (gnat_node)));\n       return lvalue_required_p (Parent (gnat_node), operand_type, aliased);\n \n     case N_Object_Renaming_Declaration:\n       /* We need to make a real renaming only if the constant object is\n-\t aliased; otherwise we can optimize and return the rvalue.  We\n-\t make an exception if the object is an identifier since in this\n-\t case the rvalue can be propagated attached to the CONST_DECL.  */\n-      return aliased || Nkind (Name (gnat_node)) == N_Identifier;\n+\t aliased or if we may use a renaming pointer; otherwise we can\n+\t optimize and return the rvalue.  We make an exception if the object\n+\t is an identifier since in this case the rvalue can be propagated\n+\t attached to the CONST_DECL.  */\n+      return (aliased != 0\n+\t      /* This should match the constant case of the renaming code.  */\n+\t      || Is_Composite_Type (Etype (Name (gnat_node)))\n+\t      || Nkind (Name (gnat_node)) == N_Identifier);\n \n     default:\n       return 0;"}, {"sha": "3114824ecc6d5a92cee49cbc132c1c0836dc1891", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=79646678b52a9c63f19ce74a2471291aae1d59a4", "patch": "@@ -1,3 +1,7 @@\n+2007-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/renaming3.adb, renaming4.ads: New test.\n+\n 2007-09-08  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/unaligned_rep_clause.adb: New testcase."}, {"sha": "335a212212101cd04dff2c7696913605768c55a8", "filename": "gcc/testsuite/gnat.dg/renaming3.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming3.adb?ref=79646678b52a9c63f19ce74a2471291aae1d59a4", "patch": "@@ -0,0 +1,12 @@\n+-- { dg-do run }\n+\n+with Renaming4; use Renaming4;\n+\n+procedure Renaming3 is\n+   type A is array(1..16) of Integer;\n+   Filler : A := (others => 0);\n+begin\n+   if B(1) /= 1 then\n+      raise Program_Error;\n+   end if;\n+end;"}, {"sha": "4fdc9c108827c18b4c78b714c5309300f4434438", "filename": "gcc/testsuite/gnat.dg/renaming4.ads", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming4.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/79646678b52a9c63f19ce74a2471291aae1d59a4/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming4.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming4.ads?ref=79646678b52a9c63f19ce74a2471291aae1d59a4", "patch": "@@ -0,0 +1,15 @@\n+package Renaming4 is\n+\n+   type Big_Array is array (Natural range <>) of Integer;\n+\n+   subtype Index is Natural range 1..4;\n+   subtype My_Array is Big_Array(Index);\n+\n+   A : constant My_Array := (1, 2, 3, 4);\n+\n+   subtype Small is Index range 1..2;\n+   subtype Small_Array is Big_Array(Small);\n+\n+   B : Small_Array renames A(Index);\n+\n+end Renaming4;"}]}