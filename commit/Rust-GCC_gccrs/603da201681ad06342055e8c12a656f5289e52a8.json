{"sha": "603da201681ad06342055e8c12a656f5289e52a8", "node_id": "C_kwDOANBUbNoAKDYwM2RhMjAxNjgxYWQwNjM0MjA1NWU4YzEyYTY1NmY1Mjg5ZTUyYTg", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2022-12-29T17:33:07Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2022-12-29T17:39:47Z"}, "message": "prevent hash set/map insertion of deleted entries\n\nJust like the recently-added checks for empty entries, add checks for\ndeleted entries as well.  This didn't catch any problems, but it might\nprevent future accidents.  Suggested by David Malcolm.\n\n\nfor  gcc/ChangeLog\n\n\t* hash-map.h (put, get_or_insert): Check that added entry\n\tdoesn't look deleted either.\n\t* hash-set.h (add): Likewise.", "tree": {"sha": "4312591c8fce568e824ab3875e420cd4b769b8cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4312591c8fce568e824ab3875e420cd4b769b8cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/603da201681ad06342055e8c12a656f5289e52a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/603da201681ad06342055e8c12a656f5289e52a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/603da201681ad06342055e8c12a656f5289e52a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/603da201681ad06342055e8c12a656f5289e52a8/comments", "author": null, "committer": null, "parents": [{"sha": "512af6c3803c4714cb2a92a8db263fb7f2b4ea10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/512af6c3803c4714cb2a92a8db263fb7f2b4ea10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/512af6c3803c4714cb2a92a8db263fb7f2b4ea10"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "e6ca9cf5e642943a8f335cc3f48e815d36c800ad", "filename": "gcc/hash-map.h", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603da201681ad06342055e8c12a656f5289e52a8/gcc%2Fhash-map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603da201681ad06342055e8c12a656f5289e52a8/gcc%2Fhash-map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhash-map.h?ref=603da201681ad06342055e8c12a656f5289e52a8", "patch": "@@ -173,8 +173,9 @@ class GTY((user)) hash_map\n       if (ins)\n \t{\n \t  e->m_key = k;\n-\t  new ((void *) &e->m_value) Value (v);\n-\t  gcc_checking_assert (!Traits::is_empty (*e));\n+\t  new ((void *)&e->m_value) Value (v);\n+\t  gcc_checking_assert (!Traits::is_empty (*e)\n+\t\t\t       && !Traits::is_deleted (*e));\n \t}\n       else\n \te->m_value = v;\n@@ -204,7 +205,8 @@ class GTY((user)) hash_map\n \t{\n \t  e->m_key = k;\n \t  new ((void *)&e->m_value) Value ();\n-\t  gcc_checking_assert (!Traits::is_empty (*e));\n+\t  gcc_checking_assert (!Traits::is_empty (*e)\n+\t\t\t       && !Traits::is_deleted (*e));\n \t}\n \n       if (existed != NULL)"}, {"sha": "08e1851d5118d10a1acb8a74103bf2f1d41722fa", "filename": "gcc/hash-set.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/603da201681ad06342055e8c12a656f5289e52a8/gcc%2Fhash-set.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/603da201681ad06342055e8c12a656f5289e52a8/gcc%2Fhash-set.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhash-set.h?ref=603da201681ad06342055e8c12a656f5289e52a8", "patch": "@@ -61,7 +61,8 @@ class hash_set\n \t{\n \t  new (e) Key (k);\n \t  // Catch attempts to insert e.g. a NULL pointer.\n-\t  gcc_checking_assert (!Traits::is_empty (*e));\n+\t  gcc_checking_assert (!Traits::is_empty (*e)\n+\t\t\t       && !Traits::is_deleted (*e));\n \t}\n \n       return existed;"}]}