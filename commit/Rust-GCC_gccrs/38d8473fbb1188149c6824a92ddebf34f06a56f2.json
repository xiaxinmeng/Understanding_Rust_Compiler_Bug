{"sha": "38d8473fbb1188149c6824a92ddebf34f06a56f2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzhkODQ3M2ZiYjExODgxNDljNjgyNGE5MmRkZWJmMzRmMDZhNTZmMg==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-12-08T02:57:53Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-12-08T02:57:53Z"}, "message": "(distribute_notes): If can't find place for REG_DEAD note, add an INSN\nwith a USE to hold it.\n\nFrom-SVN: r8625", "tree": {"sha": "825a17d218677de12ff8dc3d9c42dea05c9dd0ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/825a17d218677de12ff8dc3d9c42dea05c9dd0ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/38d8473fbb1188149c6824a92ddebf34f06a56f2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38d8473fbb1188149c6824a92ddebf34f06a56f2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38d8473fbb1188149c6824a92ddebf34f06a56f2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38d8473fbb1188149c6824a92ddebf34f06a56f2/comments", "author": null, "committer": null, "parents": [{"sha": "61314cb469b7a014caddd55f944ccaa84bd98e7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61314cb469b7a014caddd55f944ccaa84bd98e7e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61314cb469b7a014caddd55f944ccaa84bd98e7e"}], "stats": {"total": 90, "additions": 51, "deletions": 39}, "files": [{"sha": "f7415aea817237269ec466a63e0dcdc142169acc", "filename": "gcc/combine.c", "status": "modified", "additions": 51, "deletions": 39, "changes": 90, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38d8473fbb1188149c6824a92ddebf34f06a56f2/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38d8473fbb1188149c6824a92ddebf34f06a56f2/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=38d8473fbb1188149c6824a92ddebf34f06a56f2", "patch": "@@ -10515,49 +10515,50 @@ distribute_notes (notes, from_insn, i3, i2, elim_i2, elim_i1)\n \t    reg_n_refs[REGNO (XEXP (note, 0))] = 3;\n \n \t  if (place == 0)\n-\t    for (tem = prev_nonnote_insn (i3);\n-\t\t tem && (GET_CODE (tem) == INSN\n-\t\t\t || GET_CODE (tem) == CALL_INSN);\n-\t\t tem = prev_nonnote_insn (tem))\n-\t      {\n-\t\t/* If the register is being set at TEM, see if that is all\n-\t\t   TEM is doing.  If so, delete TEM.  Otherwise, make this\n-\t\t   into a REG_UNUSED note instead.  */\n-\t\tif (reg_set_p (XEXP (note, 0), PATTERN (tem)))\n-\t\t  {\n-\t\t    rtx set = single_set (tem);\n+\t    {\n+\t      for (tem = prev_nonnote_insn (i3);\n+\t\t   place == 0 && tem\n+\t\t   && (GET_CODE (tem) == INSN || GET_CODE (tem) == CALL_INSN);\n+\t\t   tem = prev_nonnote_insn (tem))\n+\t\t{\n+\t\t  /* If the register is being set at TEM, see if that is all\n+\t\t     TEM is doing.  If so, delete TEM.  Otherwise, make this\n+\t\t     into a REG_UNUSED note instead.  */\n+\t\t  if (reg_set_p (XEXP (note, 0), PATTERN (tem)))\n+\t\t    {\n+\t\t      rtx set = single_set (tem);\n \n-\t\t    /* Verify that it was the set, and not a clobber that\n-\t\t       modified the register.  */\n+\t\t      /* Verify that it was the set, and not a clobber that\n+\t\t\t modified the register.  */\n \n-\t\t    if (set != 0 && ! side_effects_p (SET_SRC (set))\n-\t\t\t&& rtx_equal_p (XEXP (note, 0), SET_DEST (set)))\n-\t\t      {\n-\t\t\t/* Move the notes and links of TEM elsewhere.\n-\t\t\t   This might delete other dead insns recursively. \n-\t\t\t   First set the pattern to something that won't use\n-\t\t\t   any register.  */\n+\t\t      if (set != 0 && ! side_effects_p (SET_SRC (set))\n+\t\t\t  && rtx_equal_p (XEXP (note, 0), SET_DEST (set)))\n+\t\t\t{\n+\t\t\t  /* Move the notes and links of TEM elsewhere.\n+\t\t\t     This might delete other dead insns recursively. \n+\t\t\t     First set the pattern to something that won't use\n+\t\t\t     any register.  */\n \n-\t\t\tPATTERN (tem) = pc_rtx;\n+\t\t\t  PATTERN (tem) = pc_rtx;\n \n-\t\t\tdistribute_notes (REG_NOTES (tem), tem, tem,\n-\t\t\t\t\t  NULL_RTX, NULL_RTX, NULL_RTX);\n-\t\t\tdistribute_links (LOG_LINKS (tem));\n+\t\t\t  distribute_notes (REG_NOTES (tem), tem, tem,\n+\t\t\t\t\t    NULL_RTX, NULL_RTX, NULL_RTX);\n+\t\t\t  distribute_links (LOG_LINKS (tem));\n \n-\t\t\tPUT_CODE (tem, NOTE);\n-\t\t\tNOTE_LINE_NUMBER (tem) = NOTE_INSN_DELETED;\n-\t\t\tNOTE_SOURCE_FILE (tem) = 0;\n-\t\t      }\n-\t\t    else\n-\t\t      {\n-\t\t\tPUT_REG_NOTE_KIND (note, REG_UNUSED);\n-\n-\t\t\t/*  If there isn't already a REG_UNUSED note, put one\n-\t\t\t    here.  */\n-\t\t\tif (! find_regno_note (tem, REG_UNUSED,\n-\t\t\t\t\t       REGNO (XEXP (note, 0))))\n-\t\t\t  place = tem;\n-\t\t\tbreak;\n+\t\t\t  PUT_CODE (tem, NOTE);\n+\t\t\t  NOTE_LINE_NUMBER (tem) = NOTE_INSN_DELETED;\n+\t\t\t  NOTE_SOURCE_FILE (tem) = 0;\n+\t\t\t}\n+\t\t      else\n+\t\t\t{\n+\t\t\t  PUT_REG_NOTE_KIND (note, REG_UNUSED);\n+\t\t\t  \n+\t\t\t  /*  If there isn't already a REG_UNUSED note, put one\n+\t\t\t      here.  */\n+\t\t\t  if (! find_regno_note (tem, REG_UNUSED,\n+\t\t\t\t\t\t REGNO (XEXP (note, 0))))\n+\t\t\t    place = tem;\n+\t\t\t  break;\n \t\t      }\n \t\t  }\n \t\telse if (reg_referenced_p (XEXP (note, 0), PATTERN (tem))\n@@ -10567,7 +10568,18 @@ distribute_notes (notes, from_insn, i3, i2, elim_i2, elim_i1)\n \t\t    place = tem;\n \t\t    break;\n \t\t  }\n-\t      }\n+\t\t}\n+\t      \n+\t      /* If we haven't found an insn for the death note and it\n+\t\t is still a REG_DEAD note, but we have hit a CODE_LABEL,\n+\t\t insert a USE insn for the register at that label and\n+\t\t put the death node there.  This prevents problems with\n+\t\t call-state tracking in caller-save.c.  */\n+\t      if (REG_NOTE_KIND (note) == REG_DEAD && place == 0 && tem != 0)\n+\t\tplace\n+\t\t  = emit_insn_after (gen_rtx (USE, VOIDmode, XEXP (note, 0)),\n+\t\t\t\t     tem);\n+\t    }\n \n \t  /* If the register is set or already dead at PLACE, we needn't do\n \t     anything with this note if it is still a REG_DEAD note.  "}]}