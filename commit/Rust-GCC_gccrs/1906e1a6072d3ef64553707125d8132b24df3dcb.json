{"sha": "1906e1a6072d3ef64553707125d8132b24df3dcb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTkwNmUxYTYwNzJkM2VmNjQ1NTM3MDcxMjVkODEzMmIyNGRmM2RjYg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2018-10-17T17:49:28Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2018-10-17T17:49:28Z"}, "message": "re PR middle-end/87623 (bytes swapped in register when comparing cause fail when compiled with  -O1 or higher)\n\n\tPR middle-end/87623\n\t* fold-const.c (fold_truth_andor_1): If the right side is not constant,\n\tbail out if both sides do not have the same storage order.\n\nFrom-SVN: r265242", "tree": {"sha": "693c71ceecea588f3fb1ff65e813037c0d60417f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/693c71ceecea588f3fb1ff65e813037c0d60417f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1906e1a6072d3ef64553707125d8132b24df3dcb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1906e1a6072d3ef64553707125d8132b24df3dcb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1906e1a6072d3ef64553707125d8132b24df3dcb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1906e1a6072d3ef64553707125d8132b24df3dcb/comments", "author": null, "committer": null, "parents": [{"sha": "54994253d3fc00bcb7d3e9359ff31a81c0e4543a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54994253d3fc00bcb7d3e9359ff31a81c0e4543a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54994253d3fc00bcb7d3e9359ff31a81c0e4543a"}], "stats": {"total": 51, "additions": 48, "deletions": 3}, "files": [{"sha": "d26780eb171c767347a392bd66b60d60c8327b32", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1906e1a6072d3ef64553707125d8132b24df3dcb", "patch": "@@ -1,4 +1,10 @@\n-2018-10-09  Aldy Hernandez  <aldyh@redhat.com>\n+2018-10-17  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\tPR middle-end/87623\n+\t* fold-const.c (fold_truth_andor_1): If the right side is not constant,\n+\tbail out if both sides do not have the same storage order.\n+\n+2018-10-17  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* bitmap.c (bitmap_head::dump): New.\n \t* bitmap.h (bitmap_head): Add dump()."}, {"sha": "5399288dfc5fcdca07d67b2c6ff644119f200afd", "filename": "gcc/fold-const.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=1906e1a6072d3ef64553707125d8132b24df3dcb", "patch": "@@ -6009,12 +6009,13 @@ fold_truth_andor_1 (location_t loc, enum tree_code code, tree truth_type,\n     }\n \n   /* If the right sides are not constant, do the same for it.  Also,\n-     disallow this optimization if a size or signedness mismatch occurs\n-     between the left and right sides.  */\n+     disallow this optimization if a size, signedness or storage order\n+     mismatch occurs between the left and right sides.  */\n   if (l_const == 0)\n     {\n       if (ll_bitsize != lr_bitsize || rl_bitsize != rr_bitsize\n \t  || ll_unsignedp != lr_unsignedp || rl_unsignedp != rr_unsignedp\n+\t  || ll_reversep != lr_reversep\n \t  /* Make sure the two fields on the right\n \t     correspond to the left without being swapped.  */\n \t  || ll_bitpos - rl_bitpos != lr_bitpos - rr_bitpos)"}, {"sha": "1e622066da5c6982ebb4eae81737b7a2ff07d708", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1906e1a6072d3ef64553707125d8132b24df3dcb", "patch": "@@ -1,3 +1,7 @@\n+2018-10-17  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc.c-torture/execute/pr87623.c: New test.\n+\n 2018-10-17  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/84705"}, {"sha": "54d8b5e45711d42662b630ecf7d1019d8d329336", "filename": "gcc/testsuite/gcc.c-torture/execute/pr87623.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr87623.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1906e1a6072d3ef64553707125d8132b24df3dcb/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr87623.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr87623.c?ref=1906e1a6072d3ef64553707125d8132b24df3dcb", "patch": "@@ -0,0 +1,34 @@\n+/* PR middle-end/87623 */\n+/* Testcase by George Thopas <george.thopas@gmail.com> */\n+\n+struct be {\n+    unsigned short pad[1];\n+    unsigned char  a;\n+    unsigned char  b;\n+} __attribute__((scalar_storage_order(\"big-endian\")));\n+\n+typedef struct be t_be;\n+\n+struct le {\n+    unsigned short pad[3];\n+    unsigned char  a;\n+    unsigned char  b;\n+};\n+\n+typedef struct le t_le;\n+\n+int a_or_b_different(t_be *x,t_le *y)\n+{\n+   return (x->a != y->a) || (x->b != y->b);\n+}\n+\n+int main (void)\n+{\n+   t_be x = { .a=1, .b=2  };\n+   t_le y = { .a=1, .b=2  };\n+  \n+   if (a_or_b_different(&x,&y))\n+       __builtin_abort ();\n+\n+   return 0;\n+}"}]}