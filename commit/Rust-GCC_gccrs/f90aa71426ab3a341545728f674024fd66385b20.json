{"sha": "f90aa71426ab3a341545728f674024fd66385b20", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjkwYWE3MTQyNmFiM2EzNDE1NDU3MjhmNjc0MDI0ZmQ2NjM4NWIyMA==", "commit": {"author": {"name": "Andrey Belevantsev", "email": "abel@ispras.ru", "date": "2012-01-19T07:29:18Z"}, "committer": {"name": "Andrey Belevantsev", "email": "abel@gcc.gnu.org", "date": "2012-01-19T07:29:18Z"}, "message": "re PR rtl-optimization/51505 (ICE: in form_sum, at reload.c:5349 with -O --param max-cse-insns=1)\n\ngcc/:\n2012-01-19 Andrey Belevantsev <abel@ispras.ru>\n\n\tPR rtl-optimization/51505\n\t* df-problems.c (df_kill_notes): New parameter live. Update comment.\n\tRemove REG_EQUAL/REG_EQUIV notes referring to dead registers.\n\t(df_note_bb_compute): Update the call to df_kill_notes.\n\ntestsuite/:\n2012-01-19 Andrey Belevantsev <abel@ispras.ru>\n\n\tPR rtl-optimization/51505\n\t* gcc.dg/pr51505.c: New test.\n\nFrom-SVN: r183296", "tree": {"sha": "996fa27ad4e957d49d2f8486fe1dc9d2794159e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/996fa27ad4e957d49d2f8486fe1dc9d2794159e0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f90aa71426ab3a341545728f674024fd66385b20", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f90aa71426ab3a341545728f674024fd66385b20", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f90aa71426ab3a341545728f674024fd66385b20", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f90aa71426ab3a341545728f674024fd66385b20/comments", "author": {"login": "abonzo", "id": 20396542, "node_id": "MDQ6VXNlcjIwMzk2NTQy", "avatar_url": "https://avatars.githubusercontent.com/u/20396542?v=4", "gravatar_id": "", "url": "https://api.github.com/users/abonzo", "html_url": "https://github.com/abonzo", "followers_url": "https://api.github.com/users/abonzo/followers", "following_url": "https://api.github.com/users/abonzo/following{/other_user}", "gists_url": "https://api.github.com/users/abonzo/gists{/gist_id}", "starred_url": "https://api.github.com/users/abonzo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/abonzo/subscriptions", "organizations_url": "https://api.github.com/users/abonzo/orgs", "repos_url": "https://api.github.com/users/abonzo/repos", "events_url": "https://api.github.com/users/abonzo/events{/privacy}", "received_events_url": "https://api.github.com/users/abonzo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d638822c753a3073a8f96d3f628ad588100e1de7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d638822c753a3073a8f96d3f628ad588100e1de7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d638822c753a3073a8f96d3f628ad588100e1de7"}], "stats": {"total": 78, "additions": 75, "deletions": 3}, "files": [{"sha": "5b70bf36a7868809fe163ff3d4086b6f040d4848", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f90aa71426ab3a341545728f674024fd66385b20/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f90aa71426ab3a341545728f674024fd66385b20/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f90aa71426ab3a341545728f674024fd66385b20", "patch": "@@ -1,3 +1,10 @@\n+2012-01-19 Andrey Belevantsev <abel@ispras.ru>\n+\n+\tPR rtl-optimization/51505\n+\t* df-problems.c (df_kill_notes): New parameter live. Update comment.\n+\tRemove REG_EQUAL/REG_EQUIV notes referring to dead registers.\n+\t(df_note_bb_compute): Update the call to df_kill_notes. \n+\n 2012-01-18  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* trans-mem.c (requires_barrier): Remove call to is_global_var."}, {"sha": "f9b0bc1d8729f757ccc927338ae5b3f4aa0bbce2", "filename": "gcc/df-problems.c", "status": "modified", "additions": 44, "deletions": 3, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f90aa71426ab3a341545728f674024fd66385b20/gcc%2Fdf-problems.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f90aa71426ab3a341545728f674024fd66385b20/gcc%2Fdf-problems.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-problems.c?ref=f90aa71426ab3a341545728f674024fd66385b20", "patch": "@@ -2748,10 +2748,12 @@ df_ignore_stack_reg (int regno ATTRIBUTE_UNUSED)\n \n \n /* Remove all of the REG_DEAD or REG_UNUSED notes from INSN and add\n-   them to OLD_DEAD_NOTES and OLD_UNUSED_NOTES.  */\n+   them to OLD_DEAD_NOTES and OLD_UNUSED_NOTES.  Remove also\n+   REG_EQUAL/REG_EQUIV notes referring to dead pseudos using LIVE\n+   as the bitmap of currently live registers.  */\n \n static void\n-df_kill_notes (rtx insn)\n+df_kill_notes (rtx insn, bitmap live)\n {\n   rtx *pprev = &REG_NOTES (insn);\n   rtx link = *pprev;\n@@ -2798,6 +2800,45 @@ df_kill_notes (rtx insn)\n \t    }\n \t  break;\n \n+\tcase REG_EQUAL:\n+\tcase REG_EQUIV:\n+\t  {\n+\t    /* Remove the notes that refer to dead registers.  As we have at most\n+\t       one REG_EQUAL/EQUIV note, all of EQ_USES will refer to this note\n+\t       so we need to purge the complete EQ_USES vector when removing\n+\t       the note using df_notes_rescan.  */\n+\t    df_ref *use_rec;\n+\t    bool deleted = false;\n+\n+\t    for (use_rec = DF_INSN_EQ_USES (insn); *use_rec; use_rec++)\n+\t      {\n+\t\tdf_ref use = *use_rec;\n+\t\tif (DF_REF_REGNO (use) > FIRST_PSEUDO_REGISTER\n+\t\t    && (DF_REF_FLAGS (use) & DF_REF_IN_NOTE)\n+\t\t    && ! bitmap_bit_p (live, DF_REF_REGNO (use)))\n+\t\t  {\n+\t\t    deleted = true;\n+\t\t    break;\n+\t\t  }\n+\t      }\n+\t    if (deleted)\n+\t      {\n+\t\trtx next;\n+#ifdef REG_DEAD_DEBUGGING\n+\t\tdf_print_note (\"deleting: \", insn, link);\n+#endif\n+\t\tnext = XEXP (link, 1);\n+\t\tfree_EXPR_LIST_node (link);\n+\t\t*pprev = link = next;\n+\t\tdf_notes_rescan (insn);\n+\t      }\n+\t    else\n+\t      {\n+\t\tpprev = &XEXP (link, 1);\n+\t\tlink = *pprev;\n+\t      }\n+\t    break;\n+\t  }\n \tdefault:\n \t  pprev = &XEXP (link, 1);\n \t  link = *pprev;\n@@ -3299,7 +3340,7 @@ df_note_bb_compute (unsigned int bb_index,\n       debug_insn = DEBUG_INSN_P (insn);\n \n       bitmap_clear (do_not_gen);\n-      df_kill_notes (insn);\n+      df_kill_notes (insn, live);\n \n       /* Process the defs.  */\n       if (CALL_P (insn))"}, {"sha": "a0d5a19901329a1189285df0eaca72757296a6d0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f90aa71426ab3a341545728f674024fd66385b20/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f90aa71426ab3a341545728f674024fd66385b20/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f90aa71426ab3a341545728f674024fd66385b20", "patch": "@@ -1,3 +1,8 @@\n+2012-01-19 Andrey Belevantsev <abel@ispras.ru>\n+\n+\tPR rtl-optimization/51505\n+\t* gcc.dg/pr51505.c: New test.\n+\n 2012-01-18  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/51634"}, {"sha": "dbcd3226d7d52538a4bebe49db9683c03c08b0b9", "filename": "gcc/testsuite/gcc.dg/pr51505.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f90aa71426ab3a341545728f674024fd66385b20/gcc%2Ftestsuite%2Fgcc.dg%2Fpr51505.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f90aa71426ab3a341545728f674024fd66385b20/gcc%2Ftestsuite%2Fgcc.dg%2Fpr51505.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr51505.c?ref=f90aa71426ab3a341545728f674024fd66385b20", "patch": "@@ -0,0 +1,19 @@\n+/* PR rtl-optimization/51505 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O --param max-cse-insns=1\" } */\n+struct S\n+{\n+char a[256];\n+};\n+\n+int bar(struct S, char[16]);\n+\n+void foo ()\n+{\n+  struct S u, s1, s2;\n+  char e[256];\n+  char i;\n+  e[i] = ~s1.a[i] & s2.a[i];\n+  if (bar(u, e))\n+    __builtin_abort ();\n+}"}]}