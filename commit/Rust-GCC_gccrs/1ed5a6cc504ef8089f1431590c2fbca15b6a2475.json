{"sha": "1ed5a6cc504ef8089f1431590c2fbca15b6a2475", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWVkNWE2Y2M1MDRlZjgwODlmMTQzMTU5MGMyZmJjYTE1YjZhMjQ3NQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2013-10-29T01:10:20Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2013-10-29T01:10:20Z"}, "message": "Add documentation about gengtype and inheritance\n\n\t* doc/gty.texi (GTY Options): Add note about inheritance to\n\tdescription of desc and tag.\n\t(Inheritance and GTY): New.\n\nFrom-SVN: r204147", "tree": {"sha": "60c40d741b97015d9f344af651f406e8b33bc35d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60c40d741b97015d9f344af651f406e8b33bc35d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1ed5a6cc504ef8089f1431590c2fbca15b6a2475", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ed5a6cc504ef8089f1431590c2fbca15b6a2475", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ed5a6cc504ef8089f1431590c2fbca15b6a2475", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ed5a6cc504ef8089f1431590c2fbca15b6a2475/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "52a7fb3cd396a30bf370d267d9ca685bbd4394cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52a7fb3cd396a30bf370d267d9ca685bbd4394cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52a7fb3cd396a30bf370d267d9ca685bbd4394cd"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "ac7c86b6107e89762de91f6caaede20e2a7ed018", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ed5a6cc504ef8089f1431590c2fbca15b6a2475/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ed5a6cc504ef8089f1431590c2fbca15b6a2475/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1ed5a6cc504ef8089f1431590c2fbca15b6a2475", "patch": "@@ -1,3 +1,9 @@\n+2013-10-29  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* doc/gty.texi (GTY Options): Add note about inheritance to\n+\tdescription of desc and tag.\n+\t(Inheritance and GTY): New.\n+\n 2013-10-29  David Malcolm  <dmalcolm@redhat.com>\n \n \t* gengtype-parse.c (opts_have): Drop \"static\" so that"}, {"sha": "090f6a6323b6b8d174b41f1bf08bc7245cdd6f08", "filename": "gcc/doc/gty.texi", "status": "modified", "additions": 52, "deletions": 0, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ed5a6cc504ef8089f1431590c2fbca15b6a2475/gcc%2Fdoc%2Fgty.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ed5a6cc504ef8089f1431590c2fbca15b6a2475/gcc%2Fdoc%2Fgty.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fgty.texi?ref=1ed5a6cc504ef8089f1431590c2fbca15b6a2475", "patch": "@@ -87,6 +87,7 @@ data members.\n \n @menu\n * GTY Options::         What goes inside a @code{GTY(())}.\n+* Inheritance and GTY:: Adding GTY to a class hierarchy.\n * User GC::\t\tAdding user-provided GC marking routines.\n * GGC Roots::           Making global variables GGC roots.\n * Files::               How the generated files work.\n@@ -234,6 +235,10 @@ In this example, the value of BINDING_HAS_LEVEL_P when applied to a\n mechanism will treat the field @code{level} as being present and if 0,\n will treat the field @code{scope} as being present.\n \n+The @code{desc} and @code{tag} options can also be used for inheritance\n+to denote which subclass an instance is.  See @ref{Inheritance and GTY}\n+for more information.\n+\n @findex param_is\n @findex use_param\n @item param_is (@var{type})\n@@ -470,6 +475,53 @@ fields is completely handled by user-provided routines.  See section\n @ref{User GC} for details on what functions need to be provided.\n @end table\n \n+@node Inheritance and GTY\n+@section Support for inheritance\n+gengtype has some support for simple class hierarchies.  You can use\n+this to have gengtype autogenerate marking routines, provided:\n+\n+@itemize @bullet\n+@item\n+There must be a concrete base class, with a discriminator expression\n+that can be used to identify which subclass an instance is.\n+@item\n+Only single inheritance is used.\n+@item\n+None of the classes within the hierarchy are templates.\n+@end itemize\n+\n+If your class hierarchy does not fit in this pattern, you must use\n+@ref{User GC} instead.\n+\n+The base class and its discriminator must be identified using the ``desc''\n+option.  Each concrete subclass must use the ``tag'' option to identify\n+which value of the discriminator it corresponds to.\n+\n+@smallexample\n+class GTY((desc(\"%h.kind\"), tag(\"0\"))) example_base\n+@{\n+public:\n+    int kind;\n+    tree a;\n+@};\n+\n+class GTY((tag(\"1\")) some_subclass : public example_base\n+@{\n+public:\n+    tree b;\n+@};\n+\n+class GTY((tag(\"2\")) some_other_subclass : public example_base\n+@{\n+public:\n+    tree c;\n+@};\n+@end smallexample\n+\n+The generated marking routines for the above will contain a ``switch''\n+on ``kind'', visiting all appropriate fields.  For example, if kind is\n+2, it will cast to ``some_other_subclass'' and visit fields a, b, and c.\n+\n @node User GC\n @section Support for user-provided GC marking routines\n @cindex user gc"}]}