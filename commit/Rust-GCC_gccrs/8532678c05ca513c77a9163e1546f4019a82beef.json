{"sha": "8532678c05ca513c77a9163e1546f4019a82beef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODUzMjY3OGMwNWNhNTEzYzc3YTkxNjNlMTU0NmY0MDE5YTgyYmVlZg==", "commit": {"author": {"name": "Changpeng Fang", "email": "changpeng.fang@amd.com", "date": "2010-05-17T22:33:53Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2010-05-17T22:33:53Z"}, "message": "Define PREFETCH_MOD_TO_UNROLL_FACTOR_RATIO heuristic.\n\n2010-05-17  Changpeng Fang  <changpeng.fang@amd.com>\n\n\t* tree-ssa-loop-prefetch.c (PREFETCH_MOD_TO_UNROLL_FACTOR_RATIO): New.\n\t(schedule_prefetches): Do not generate a prefetch if the unroll factor\n\tis far from what is required by the prefetch.\n\nFrom-SVN: r159514", "tree": {"sha": "9957431e127d4b12f699827d78fb336349730bed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9957431e127d4b12f699827d78fb336349730bed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8532678c05ca513c77a9163e1546f4019a82beef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8532678c05ca513c77a9163e1546f4019a82beef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8532678c05ca513c77a9163e1546f4019a82beef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8532678c05ca513c77a9163e1546f4019a82beef/comments", "author": {"login": "changpeng", "id": 4239661, "node_id": "MDQ6VXNlcjQyMzk2NjE=", "avatar_url": "https://avatars.githubusercontent.com/u/4239661?v=4", "gravatar_id": "", "url": "https://api.github.com/users/changpeng", "html_url": "https://github.com/changpeng", "followers_url": "https://api.github.com/users/changpeng/followers", "following_url": "https://api.github.com/users/changpeng/following{/other_user}", "gists_url": "https://api.github.com/users/changpeng/gists{/gist_id}", "starred_url": "https://api.github.com/users/changpeng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/changpeng/subscriptions", "organizations_url": "https://api.github.com/users/changpeng/orgs", "repos_url": "https://api.github.com/users/changpeng/repos", "events_url": "https://api.github.com/users/changpeng/events{/privacy}", "received_events_url": "https://api.github.com/users/changpeng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "339f49ec21ea4870e25641f7a7e60703b5d86d50", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/339f49ec21ea4870e25641f7a7e60703b5d86d50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/339f49ec21ea4870e25641f7a7e60703b5d86d50"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "a0ba83aa970d5ae0fb6165273f06a201690ac378", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8532678c05ca513c77a9163e1546f4019a82beef/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8532678c05ca513c77a9163e1546f4019a82beef/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8532678c05ca513c77a9163e1546f4019a82beef", "patch": "@@ -1,3 +1,9 @@\n+2010-05-17  Changpeng Fang  <changpeng.fang@amd.com>\n+\n+\t* tree-ssa-loop-prefetch.c (PREFETCH_MOD_TO_UNROLL_FACTOR_RATIO): New.\n+\t(schedule_prefetches): Do not generate a prefetch if the unroll factor\n+\tis far from what is required by the prefetch.\n+\n 2010-05-17  Jan Hubicka  <jh@suse.cz>\n \n \t* ipa-cp.c (ipcp_update_callgraph): Use ipa_is_param_used."}, {"sha": "4889604b6ab5740622b3b0c9df47aa5d40ca1384", "filename": "gcc/tree-ssa-loop-prefetch.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8532678c05ca513c77a9163e1546f4019a82beef/gcc%2Ftree-ssa-loop-prefetch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8532678c05ca513c77a9163e1546f4019a82beef/gcc%2Ftree-ssa-loop-prefetch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-prefetch.c?ref=8532678c05ca513c77a9163e1546f4019a82beef", "patch": "@@ -225,6 +225,17 @@ struct mem_ref_group\n \n #define PREFETCH_ALL\t\t(~(unsigned HOST_WIDE_INT) 0)\n \n+/* Do not generate a prefetch if the unroll factor is significantly less\n+   than what is required by the prefetch.  This is to avoid redundant\n+   prefetches.  For example, if prefetch_mod is 16 and unroll_factor is\n+   1, this means prefetching requires unrolling the loop 16 times, but\n+   the loop is not going to be unrolled.  In this case (ratio = 16),\n+   prefetching is not likely to be beneficial.  */\n+\n+#ifndef PREFETCH_MOD_TO_UNROLL_FACTOR_RATIO\n+#define PREFETCH_MOD_TO_UNROLL_FACTOR_RATIO 8\n+#endif\n+\n /* The memory reference.  */\n \n struct mem_ref\n@@ -921,6 +932,12 @@ schedule_prefetches (struct mem_ref_group *groups, unsigned unroll_factor,\n \tif (!should_issue_prefetch_p (ref))\n \t  continue;\n \n+        /* The loop is far from being sufficiently unrolled for this\n+           prefetch.  Do not generate prefetch to avoid many redudant\n+           prefetches.  */\n+        if (ref->prefetch_mod / unroll_factor > PREFETCH_MOD_TO_UNROLL_FACTOR_RATIO)\n+          continue;\n+\n \t/* If we need to prefetch the reference each PREFETCH_MOD iterations,\n \t   and we unroll the loop UNROLL_FACTOR times, we need to insert\n \t   ceil (UNROLL_FACTOR / PREFETCH_MOD) instructions in each"}]}