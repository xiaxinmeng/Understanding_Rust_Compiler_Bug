{"sha": "e088c55299869b69d386771f29a5a5661d0bd5cf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTA4OGM1NTI5OTg2OWI2OWQzODY3NzFmMjlhNWE1NjYxZDBiZDVjZg==", "commit": {"author": {"name": "Dorit Naishlos", "email": "dorit@il.ibm.com", "date": "2004-11-23T09:19:24Z"}, "committer": {"name": "Dorit Nuzman", "email": "dorit@gcc.gnu.org", "date": "2004-11-23T09:19:24Z"}, "message": "re PR tree-optimization/18403 (FAILs to vectorize testcases on ppc64-linux)\n\n        PR tree-opt/18403\n        PR tree-opt/18505\n        * tree-vectorizer.c (vect_create_data_ref_ptr): Use\n        lang_hooks.types.type_for_size instead of integer_type_node for the\n        type of ptr_update.\n\nFrom-SVN: r91081", "tree": {"sha": "dc6359ab8002b825fad0caab609f525b5b0ef3e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dc6359ab8002b825fad0caab609f525b5b0ef3e2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e088c55299869b69d386771f29a5a5661d0bd5cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e088c55299869b69d386771f29a5a5661d0bd5cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e088c55299869b69d386771f29a5a5661d0bd5cf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e088c55299869b69d386771f29a5a5661d0bd5cf/comments", "author": null, "committer": null, "parents": [{"sha": "00aca6e83ae577b520f810aaf7197c30c2eaf1a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00aca6e83ae577b520f810aaf7197c30c2eaf1a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00aca6e83ae577b520f810aaf7197c30c2eaf1a0"}], "stats": {"total": 20, "additions": 19, "deletions": 1}, "files": [{"sha": "e5d3f12ff84cf24d693f8a282c571a3761859f72", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e088c55299869b69d386771f29a5a5661d0bd5cf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e088c55299869b69d386771f29a5a5661d0bd5cf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e088c55299869b69d386771f29a5a5661d0bd5cf", "patch": "@@ -1,3 +1,11 @@\n+2004-11-23  Dorit Naishlos <dorit@il.ibm.com>\n+\n+\tPR tree-opt/18403\n+\tPR tree-opt/18505\n+\t* tree-vectorizer.c (vect_create_data_ref_ptr): Use\n+\tlang_hooks.types.type_for_size instead of integer_type_node for the\n+\ttype of ptr_update.\n+\t\n 2004-11-23  Ralf Corsepius <ralf.corsepius@rtems.org>\n \n \t* config.gcc (h8300-*-rtems*): Use h8300/t-rtems."}, {"sha": "6164036ab4e84f71508eef730b0927fc434d534b", "filename": "gcc/tree-vectorizer.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e088c55299869b69d386771f29a5a5661d0bd5cf/gcc%2Ftree-vectorizer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e088c55299869b69d386771f29a5a5661d0bd5cf/gcc%2Ftree-vectorizer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.c?ref=e088c55299869b69d386771f29a5a5661d0bd5cf", "patch": "@@ -1866,6 +1866,7 @@ vect_create_data_ref_ptr (tree stmt, block_stmt_iterator *bsi, tree offset,\n   tree vectype_size;\n   tree ptr_update;\n   tree data_ref_ptr;\n+  tree type, tmp, size;\n \n   base_name = unshare_expr (DR_BASE_NAME (dr));\n   if (vect_debug_details (NULL))\n@@ -1952,11 +1953,20 @@ vect_create_data_ref_ptr (tree stmt, block_stmt_iterator *bsi, tree offset,\n   idx = vect_create_index_for_vector_ref (loop, bsi);\n \n   /* Create: update = idx * vectype_size  */\n-  ptr_update = create_tmp_var (integer_type_node, \"update\");\n+  tmp = create_tmp_var (integer_type_node, \"update\");\n+  add_referenced_tmp_var (tmp);\n+  size = TYPE_SIZE (vect_ptr_type); \n+  type = lang_hooks.types.type_for_size (tree_low_cst (size, 1), 1);\n+  ptr_update = create_tmp_var (type, \"update\");\n   add_referenced_tmp_var (ptr_update);\n   vectype_size = build_int_cst (integer_type_node,\n                                 GET_MODE_SIZE (TYPE_MODE (vectype)));\n   vec_stmt = build2 (MULT_EXPR, integer_type_node, idx, vectype_size);\n+  vec_stmt = build2 (MODIFY_EXPR, void_type_node, tmp, vec_stmt);\n+  new_temp = make_ssa_name (tmp, vec_stmt);\n+  TREE_OPERAND (vec_stmt, 0) = new_temp;\n+  bsi_insert_before (bsi, vec_stmt, BSI_SAME_STMT);\n+  vec_stmt = fold_convert (type, new_temp);\n   vec_stmt = build2 (MODIFY_EXPR, void_type_node, ptr_update, vec_stmt);\n   new_temp = make_ssa_name (ptr_update, vec_stmt);\n   TREE_OPERAND (vec_stmt, 0) = new_temp;"}]}