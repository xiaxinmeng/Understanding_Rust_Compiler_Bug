{"sha": "5abde510b7e2864c18144c658c4a5d26f8dc12d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWFiZGU1MTBiN2UyODY0YzE4MTQ0YzY1OGM0YTVkMjZmOGRjMTJkMw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-10-07T11:48:28Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2017-10-07T11:48:28Z"}, "message": "re PR fortran/49232 (Pointer assignment of stride to CONTIGUOUS pointer not diagnosed as invalid)\n\n2017-10-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/49232\n\t* expr.c (gfc_check_pointer_assign): Error\n\tfor non-contiguous rhs.\n\n2017-10-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/49232\n\t* gfortran.dg/contiguous_4.f90: New test.\n\nFrom-SVN: r253509", "tree": {"sha": "2b203f2950f7fe7ca5f8344d3962aa131b60d08a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2b203f2950f7fe7ca5f8344d3962aa131b60d08a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5abde510b7e2864c18144c658c4a5d26f8dc12d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5abde510b7e2864c18144c658c4a5d26f8dc12d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5abde510b7e2864c18144c658c4a5d26f8dc12d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5abde510b7e2864c18144c658c4a5d26f8dc12d3/comments", "author": null, "committer": null, "parents": [{"sha": "a4792d44311895bef287eb9632a1d4936ca8eafb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4792d44311895bef287eb9632a1d4936ca8eafb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4792d44311895bef287eb9632a1d4936ca8eafb"}], "stats": {"total": 38, "additions": 38, "deletions": 0}, "files": [{"sha": "67a5b02e43b268997f02d4915513b38c0497f5b6", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=5abde510b7e2864c18144c658c4a5d26f8dc12d3", "patch": "@@ -1,3 +1,9 @@\n+2017-10-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/49232\n+\t* expr.c (gfc_check_pointer_assign): Error\n+\tfor non-contiguous rhs.\n+\n 2017-10-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \t* gfortran.h (async_io_dt): Add external reference."}, {"sha": "bc05db2fbaeade43402c27d79ecebbc78301858e", "filename": "gcc/fortran/expr.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ffortran%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ffortran%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fexpr.c?ref=5abde510b7e2864c18144c658c4a5d26f8dc12d3", "patch": "@@ -3851,6 +3851,14 @@ gfc_check_pointer_assign (gfc_expr *lvalue, gfc_expr *rvalue)\n \t  }\n     }\n \n+  /* Error for assignments of contiguous pointers to targets which is not\n+     contiguous.  Be lenient in the definition of what counts as\n+     congiguous.  */\n+\n+  if (lhs_attr.contiguous && !gfc_is_simply_contiguous (rvalue, false, true))\n+    gfc_error (\"Assignment to contiguous pointer from non-contiguous \"\n+\t       \"target at %L\", &rvalue->where);\n+\n   /* Warn if it is the LHS pointer may lives longer than the RHS target.  */\n   if (warn_target_lifetime\n       && rvalue->expr_type == EXPR_VARIABLE"}, {"sha": "319518c6e8a0b073f13cb71335f58ea5f7f14882", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5abde510b7e2864c18144c658c4a5d26f8dc12d3", "patch": "@@ -1,3 +1,8 @@\n+2017-10-07  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/49232\n+\t* gfortran.dg/contiguous_4.f90: New test.\n+\n 2017-10-06  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/66690"}, {"sha": "b05dcfbaa84a547c5fe9a6feb4425a2e0d512615", "filename": "gcc/testsuite/gfortran.dg/contiguous_4.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontiguous_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5abde510b7e2864c18144c658c4a5d26f8dc12d3/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontiguous_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontiguous_4.f90?ref=5abde510b7e2864c18144c658c4a5d26f8dc12d3", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do compile }\n+program cont_01_neg\n+  implicit none\n+  real, pointer, contiguous :: r(:)\n+  real, pointer, contiguous :: r2(:,:)\n+  real, target :: x(45)\n+  real, target :: x2(5,9)\n+  integer :: i\n+  integer :: n=1\n+\n+  x = (/ (real(i),i=1,45) /)\n+  x2 = reshape(x,shape(x2))\n+  r => x(::3)   ! { dg-error \"Assignment to contiguous pointer\" }\n+  r2 => x2(2:,:) ! { dg-error \"Assignment to contiguous pointer\" }\n+  r2 => x2(:,2:3)\n+  r => x2(2:3,1)\n+  r => x(::1)\n+  r => x(::n) ! { dg-error \"Assignment to contiguous pointer\" }\n+end program"}]}