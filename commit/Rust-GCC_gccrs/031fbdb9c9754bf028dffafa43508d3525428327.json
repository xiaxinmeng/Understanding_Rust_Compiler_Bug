{"sha": "031fbdb9c9754bf028dffafa43508d3525428327", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDMxZmJkYjljOTc1NGJmMDI4ZGZmYWZhNDM1MDhkMzUyNTQyODMyNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-04-13T11:05:09Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-04-13T11:05:09Z"}, "message": "re PR debug/80321 (infinite recursion with inlining of nested function and debug info)\n\n\tPR debug/80321\n\t* dwarf2out.c (decls_for_scope): Ignore declarations of\n\tcurrent_function_decl in BLOCK_NONLOCALIZED_VARS.\n\n\t* gcc.dg/debug/pr80321.c: New test.\n\n2017-04-13  Eric Botcazou  <ebotcazou@adacore.com>\n\n\t* gnat.dg/debug10.adb: New test.\n\t* gnat.dg/debug10_pkg.ads: New helper.\n\nFrom-SVN: r246900", "tree": {"sha": "38e799865db0b59b04bdcba32e7ec66bb0463b8c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/38e799865db0b59b04bdcba32e7ec66bb0463b8c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/031fbdb9c9754bf028dffafa43508d3525428327", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/031fbdb9c9754bf028dffafa43508d3525428327", "html_url": "https://github.com/Rust-GCC/gccrs/commit/031fbdb9c9754bf028dffafa43508d3525428327", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/031fbdb9c9754bf028dffafa43508d3525428327/comments", "author": null, "committer": null, "parents": [{"sha": "fb81a61b15689be318482bdecb8bbbb2017523ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb81a61b15689be318482bdecb8bbbb2017523ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb81a61b15689be318482bdecb8bbbb2017523ed"}], "stats": {"total": 255, "additions": 254, "deletions": 1}, "files": [{"sha": "8918882fe424e427d844f1969374f20e574795d7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=031fbdb9c9754bf028dffafa43508d3525428327", "patch": "@@ -1,3 +1,9 @@\n+2017-04-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/80321\n+\t* dwarf2out.c (decls_for_scope): Ignore declarations of\n+\tcurrent_function_decl in BLOCK_NONLOCALIZED_VARS.\n+\n 2017-04-12  Jan Hubicka  <hubicka@ucw.cz>\n \n \tPR lto/69953 "}, {"sha": "89d18725c3aa8484fcb728477046b630f25aa24d", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=031fbdb9c9754bf028dffafa43508d3525428327", "patch": "@@ -24889,7 +24889,12 @@ decls_for_scope (tree stmt, dw_die_ref context_die)\n \tfor (i = 0; i < BLOCK_NUM_NONLOCALIZED_VARS (stmt); i++)\n \t  {\n \t    decl = BLOCK_NONLOCALIZED_VAR (stmt, i);\n-\t    if (TREE_CODE (decl) == FUNCTION_DECL)\n+\t    if (decl == current_function_decl)\n+\t      /* Ignore declarations of the current function, while they\n+\t\t are declarations, gen_subprogram_die would treat them\n+\t\t as definitions again, because they are equal to\n+\t\t current_function_decl and endlessly recurse.  */;\n+\t    else if (TREE_CODE (decl) == FUNCTION_DECL)\n \t      process_scope_var (stmt, decl, NULL_TREE, context_die);\n \t    else\n \t      process_scope_var (stmt, NULL_TREE, decl, context_die);"}, {"sha": "3c33b0f40e1f545d4b0fb962c8d000cfe3d65a67", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=031fbdb9c9754bf028dffafa43508d3525428327", "patch": "@@ -1,3 +1,13 @@\n+2017-04-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/80321\n+\t* gcc.dg/debug/pr80321.c: New test.\n+\n+2017-04-13  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/debug10.adb: New test.\n+\t* gnat.dg/debug10_pkg.ads: New helper.\n+\n 2017-04-12  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/79390"}, {"sha": "e75572e7898329ff1bcf1378080807c804d16d0e", "filename": "gcc/testsuite/gcc.dg/debug/pr80321.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr80321.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr80321.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdebug%2Fpr80321.c?ref=031fbdb9c9754bf028dffafa43508d3525428327", "patch": "@@ -0,0 +1,26 @@\n+/* PR debug/80321 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fkeep-inline-functions\" } */\n+\n+void bar (void);\n+\n+static inline void\n+test (int x)\n+{\n+  inline void\n+  foo (int x)\n+  {\n+    test (0);\n+    asm volatile (\"\" : : : \"memory\");\n+  }\n+  if (x != 0)\n+    foo (x);\n+  else\n+    bar ();\n+}\n+\n+void\n+baz (int x)\n+{\n+  test (x);\n+}"}, {"sha": "5612b7874e467456ff14efcb08acbfa6888cba41", "filename": "gcc/testsuite/gnat.dg/debug10.adb", "status": "added", "additions": 68, "deletions": 0, "changes": 68, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug10.adb?ref=031fbdb9c9754bf028dffafa43508d3525428327", "patch": "@@ -0,0 +1,68 @@\n+-- PR debug/80321\n+\n+-- { dg-do compile }\n+-- { dg-options \"-O2 -g\" }\n+\n+with Debug10_Pkg; use Debug10_Pkg;\n+\n+procedure Debug10 (T : Entity_Id) is\n+\n+   procedure Inner (E : Entity_Id);\n+   pragma Inline (Inner);\n+\n+   procedure Inner (E : Entity_Id) is\n+   begin\n+      if E /= Empty\n+         and then not Nodes (E + 3).Flag16\n+      then\n+         Debug10 (E);\n+      end if;\n+   end Inner;\n+\n+   function Ekind (E : Entity_Id) return Entity_Kind is\n+   begin\n+      return N_To_E (Nodes (E + 1).Nkind);\n+   end Ekind;\n+\n+begin\n+\n+   if T = Empty then\n+      return;\n+   end if;\n+\n+   Nodes (T + 3).Flag16 := True;\n+\n+   if Ekind (T) in Object_Kind then\n+      Inner (T);\n+\n+   elsif Ekind (T) in Type_Kind then\n+      Inner (T);\n+\n+      if Ekind (T) in Record_Kind then\n+\n+         if Ekind (T) = E_Class_Wide_Subtype then\n+            Inner (T);\n+         end if;\n+\n+      elsif Ekind (T) in Array_Kind then\n+         Inner (T);\n+\n+      elsif Ekind (T) in Access_Kind then\n+         Inner (T);\n+\n+      elsif Ekind (T) in Scalar_Kind then\n+\n+         if My_Scalar_Range (T) /= Empty\n+           and then My_Test (My_Scalar_Range (T))\n+         then\n+            if My_Is_Entity_Name (T) then\n+               Inner (T);\n+            end if;\n+\n+            if My_Is_Entity_Name (T) then\n+               Inner (T);\n+            end if;\n+         end if;\n+      end if;\n+   end if;\n+end;"}, {"sha": "10146c5a4018752380fb85530f491f30594cfc55", "filename": "gcc/testsuite/gnat.dg/debug10_pkg.ads", "status": "added", "additions": 138, "deletions": 0, "changes": 138, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug10_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/031fbdb9c9754bf028dffafa43508d3525428327/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug10_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdebug10_pkg.ads?ref=031fbdb9c9754bf028dffafa43508d3525428327", "patch": "@@ -0,0 +1,138 @@\n+with Unchecked_Conversion;\n+\n+package Debug10_Pkg is\n+\n+   type Node_Id is range 0 .. 99_999_999;\n+\n+   Empty : constant Node_Id := 0;\n+\n+   subtype Entity_Id is Node_Id;\n+\n+   type Union_Id is new Integer;\n+\n+   function My_Is_Entity_Name (N : Node_Id) return Boolean;\n+\n+   function My_Scalar_Range (Id : Entity_Id) return Node_Id;\n+\n+   function My_Test (N : Node_Id) return Boolean;\n+\n+   type Node_Kind is (N_Unused_At_Start, N_Unused_At_End);\n+\n+   type Entity_Kind is (\n+\n+      E_Void,\n+      E_Component,\n+      E_Constant,\n+      E_Discriminant,\n+      E_Loop_Parameter,\n+      E_Variable,\n+      E_Out_Parameter,\n+      E_In_Out_Parameter,\n+      E_In_Parameter,\n+      E_Generic_In_Out_Parameter,\n+      E_Generic_In_Parameter,\n+      E_Named_Integer,\n+      E_Named_Real,\n+      E_Enumeration_Type,\n+      E_Enumeration_Subtype,\n+      E_Signed_Integer_Type,\n+      E_Signed_Integer_Subtype,\n+      E_Modular_Integer_Type,\n+      E_Modular_Integer_Subtype,\n+      E_Ordinary_Fixed_Point_Type,\n+      E_Ordinary_Fixed_Point_Subtype,\n+      E_Decimal_Fixed_Point_Type,\n+      E_Decimal_Fixed_Point_Subtype,\n+      E_Floating_Point_Type,\n+      E_Floating_Point_Subtype,\n+      E_Access_Type,\n+      E_Access_Subtype,\n+      E_Access_Attribute_Type,\n+      E_Allocator_Type,\n+      E_General_Access_Type,\n+      E_Access_Subprogram_Type,\n+      E_Anonymous_Access_Subprogram_Type,\n+      E_Access_Protected_Subprogram_Type,\n+      E_Anonymous_Access_Protected_Subprogram_Type,\n+      E_Anonymous_Access_Type,\n+      E_Array_Type,\n+      E_Array_Subtype,\n+      E_String_Literal_Subtype,\n+      E_Class_Wide_Type,\n+      E_Class_Wide_Subtype,\n+      E_Record_Type,\n+      E_Record_Subtype,\n+      E_Record_Type_With_Private,\n+      E_Record_Subtype_With_Private,\n+      E_Private_Type,\n+      E_Private_Subtype,\n+      E_Limited_Private_Type,\n+      E_Limited_Private_Subtype,\n+      E_Incomplete_Type,\n+      E_Incomplete_Subtype,\n+      E_Task_Type,\n+      E_Task_Subtype,\n+      E_Protected_Type,\n+      E_Protected_Subtype,\n+      E_Exception_Type,\n+      E_Subprogram_Type,\n+      E_Enumeration_Literal,\n+      E_Function,\n+      E_Operator,\n+      E_Procedure,\n+      E_Abstract_State,\n+      E_Entry,\n+      E_Entry_Family,\n+      E_Block,\n+      E_Entry_Index_Parameter,\n+      E_Exception,\n+      E_Generic_Function,\n+      E_Generic_Procedure,\n+      E_Generic_Package,\n+      E_Label,\n+      E_Loop,\n+      E_Return_Statement,\n+      E_Package,\n+      E_Package_Body,\n+      E_Protected_Object,\n+      E_Protected_Body,\n+      E_Task_Body,\n+      E_Subprogram_Body\n+   );\n+\n+   subtype Access_Kind                 is Entity_Kind range\n+       E_Access_Type ..\n+       E_Anonymous_Access_Type;\n+\n+   subtype Array_Kind                  is Entity_Kind range\n+       E_Array_Type ..\n+       E_String_Literal_Subtype;\n+\n+   subtype Object_Kind                 is Entity_Kind range\n+       E_Component ..\n+       E_Generic_In_Parameter;\n+\n+   subtype Record_Kind                 is Entity_Kind range\n+       E_Class_Wide_Type ..\n+       E_Record_Subtype_With_Private;\n+\n+   subtype Scalar_Kind                 is Entity_Kind range\n+       E_Enumeration_Type ..\n+       E_Floating_Point_Subtype;\n+\n+   subtype Type_Kind                   is Entity_Kind range\n+       E_Enumeration_Type ..\n+       E_Subprogram_Type;\n+\n+   type Node_Record (Is_Extension : Boolean := False) is record\n+      Flag16 : Boolean;\n+      Nkind : Node_Kind;\n+   end record;\n+\n+   function N_To_E is new Unchecked_Conversion (Node_Kind, Entity_Kind);\n+\n+   type Arr is array (Node_Id) of Node_Record;\n+\n+   Nodes : Arr;\n+\n+end Debug10_Pkg;"}]}