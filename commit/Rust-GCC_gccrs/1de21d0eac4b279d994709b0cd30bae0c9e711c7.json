{"sha": "1de21d0eac4b279d994709b0cd30bae0c9e711c7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWRlMjFkMGVhYzRiMjc5ZDk5NDcwOWIwY2QzMGJhZTBjOWU3MTFjNw==", "commit": {"author": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2002-03-21T00:26:46Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2002-03-21T00:26:46Z"}, "message": "posix-threads.cc (_Jv_ThreadSelf_out_of_line): Use write_barrier, not release_set.\n\n\t* posix-threads.cc (_Jv_ThreadSelf_out_of_line): Use write_barrier,\n\tnot release_set.\n\t* sysdep/powerpc/locks.h (write_barrier): New function.\n\t* sysdep/i386/locks.h (write_barrier): New function.\n\nFrom-SVN: r51101", "tree": {"sha": "9c7009e8040fa889ee77996438bd374542bd3833", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c7009e8040fa889ee77996438bd374542bd3833"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1de21d0eac4b279d994709b0cd30bae0c9e711c7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1de21d0eac4b279d994709b0cd30bae0c9e711c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1de21d0eac4b279d994709b0cd30bae0c9e711c7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1de21d0eac4b279d994709b0cd30bae0c9e711c7/comments", "author": null, "committer": null, "parents": [{"sha": "e5c4bd1bba2b29800b2316bef7f749994a27c7ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5c4bd1bba2b29800b2316bef7f749994a27c7ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5c4bd1bba2b29800b2316bef7f749994a27c7ef"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "677fd8e29f824bd4dc8ff6ee4e88d162d8b37f9f", "filename": "libjava/ChangeLog", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=1de21d0eac4b279d994709b0cd30bae0c9e711c7", "patch": "@@ -1,6 +1,13 @@\n+2002-03-20  Bryce McKinlay  <bryce@waitaki.otago.ac.nz>\n+\n+\t* posix-threads.cc (_Jv_ThreadSelf_out_of_line): Use write_barrier,\n+\tnot release_set.\n+\t* sysdep/powerpc/locks.h (write_barrier): New function.\n+\t* sysdep/i386/locks.h (write_barrier): New function.\n+\n 2002-03-19  Martin Kahlert  <martin.kahlert@infineon.com>\n \n-\t* include/jni.h Use correct C comments \n+\t* include/jni.h Use correct C comments.\n \n 2002-03-18  Tom Tromey  <tromey@redhat.com>\n "}, {"sha": "e92348bcc2cc078bdb768e9ba23c1c6c7ccda1b5", "filename": "libjava/posix-threads.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2Fposix-threads.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2Fposix-threads.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fposix-threads.cc?ref=1de21d0eac4b279d994709b0cd30bae0c9e711c7", "patch": "@@ -448,7 +448,8 @@ _Jv_ThreadSelf_out_of_line(volatile self_cache_entry *sce, size_t high_sp_bits)\n {\n   pthread_t self = pthread_self();\n   sce -> high_sp_bits = high_sp_bits;\n-  release_set ((obj_addr_t *) &(sce -> self), self);\n+  write_barrier();\n+  sce -> self = self;\n   return self;\n }\n "}, {"sha": "a9501ae99b23729584bef89a2fdd62f99bbe1a3d", "filename": "libjava/sysdep/i386/locks.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2Fsysdep%2Fi386%2Flocks.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2Fsysdep%2Fi386%2Flocks.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fsysdep%2Fi386%2Flocks.h?ref=1de21d0eac4b279d994709b0cd30bae0c9e711c7", "patch": "@@ -62,4 +62,12 @@ read_barrier()\n {\n }\n \n+// Ensure that prior stores to memory are completed with respect to other\n+// processors.\n+inline static void\n+write_barrier()\n+{\n+  // X86 does not reorder writes. We just need to ensure that gcc also doesn't.\n+  __asm__ __volatile__(\" \" : : : \"memory\");\n+}\n #endif"}, {"sha": "4d4532b1f83e9f831f238f157a093bbc661c7441", "filename": "libjava/sysdep/powerpc/locks.h", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2Fsysdep%2Fpowerpc%2Flocks.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1de21d0eac4b279d994709b0cd30bae0c9e711c7/libjava%2Fsysdep%2Fpowerpc%2Flocks.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fsysdep%2Fpowerpc%2Flocks.h?ref=1de21d0eac4b279d994709b0cd30bae0c9e711c7", "patch": "@@ -75,4 +75,12 @@ read_barrier()\n   __asm__ __volatile__ (\"isync\" : : : \"memory\");\n }\n \n+// Ensure that prior stores to memory are completed with respect to other\n+// processors.\n+inline static void\n+write_barrier()\n+{\n+  __asm__ __volatile__ (\"sync\" : : : \"memory\");\n+}\n+\n #endif"}]}