{"sha": "58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThjNWFkNDAzMmIyYmI5ZTM5YTBkOGM5OTI1YzA2NzNmMjI4NzdhMA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2015-07-08T14:41:59Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2015-07-08T14:41:59Z"}, "message": "PR jit/66783: improve error messages\n\ngcc/jit/ChangeLog:\n\tPR jit/66783\n\t* libgccjit.c (gcc_jit_context_new_field): Show name of field in\n\t\"unknown size\" error message.\n\t(gcc_jit_struct_set_fields): Show name of struct in error message.\n\t(gcc_jit_context_new_global): Show name of global in\n\t\"unknown size\" error message.\n\t(gcc_jit_function_new_local): Likewise for local.\n\ngcc/testsuite/ChangeLog:\n\tPR jit/66783\n\t* jit.dg/test-error-gcc_jit_context_new_field-opaque-struct.c\n\t(verify_code): Update expected error message.\n\t* jit.dg/test-error-gcc_jit_context_new_global-opaque-struct.c\n\t(verify_code): Likewise.\n\t* jit.dg/test-error-gcc_jit_function_new_local-opaque-struct.c\n\t(verify_code): Likewise.\n\nFrom-SVN: r225557", "tree": {"sha": "3fbc08b75a6006db22d369b7360f24233a99c656", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3fbc08b75a6006db22d369b7360f24233a99c656"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cadb53a5e6c47904f42e636dadbfada6c76fec39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cadb53a5e6c47904f42e636dadbfada6c76fec39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cadb53a5e6c47904f42e636dadbfada6c76fec39"}], "stats": {"total": 48, "additions": 38, "deletions": 10}, "files": [{"sha": "e9a32f0ae966a09ace1fc00ca9b14227574e12a6", "filename": "gcc/jit/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Fjit%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Fjit%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2FChangeLog?ref=58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "patch": "@@ -1,3 +1,13 @@\n+2015-07-08  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR jit/66783\n+\t* libgccjit.c (gcc_jit_context_new_field): Show name of field in\n+\t\"unknown size\" error message.\n+\t(gcc_jit_struct_set_fields): Show name of struct in error message.\n+\t(gcc_jit_context_new_global): Show name of global in\n+\t\"unknown size\" error message.\n+\t(gcc_jit_function_new_local): Likewise for local.\n+\n 2015-07-07  Andrew MacLeod  <amacleod@redhat.com>\n \n \t* dummy-frontend.c: Adjust includes."}, {"sha": "eee513f05c857a412e9d60e80c2134b75f3c064c", "filename": "gcc/jit/libgccjit.c", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Fjit%2Flibgccjit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Fjit%2Flibgccjit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjit%2Flibgccjit.c?ref=58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "patch": "@@ -543,10 +543,11 @@ gcc_jit_context_new_field (gcc_jit_context *ctxt,\n   /* LOC can be NULL.  */\n   RETURN_NULL_IF_FAIL (type, ctxt, loc, \"NULL type\");\n   RETURN_NULL_IF_FAIL (name, ctxt, loc, \"NULL name\");\n-  RETURN_NULL_IF_FAIL_PRINTF1 (\n+  RETURN_NULL_IF_FAIL_PRINTF2 (\n     type->has_known_size (),\n     ctxt, loc,\n-    \"type has unknown size (type: %s)\",\n+    \"unknown size for field \\\"%s\\\" (type: %s)\",\n+    name,\n     type->get_debug_string ());\n \n   return (gcc_jit_field *)ctxt->new_field (loc, type, name);\n@@ -662,7 +663,12 @@ gcc_jit_struct_set_fields (gcc_jit_struct *struct_type,\n     RETURN_IF_FAIL (fields, ctxt, loc, \"NULL fields ptr\");\n   for (int i = 0; i < num_fields; i++)\n     {\n-      RETURN_IF_FAIL (fields[i], ctxt, loc, \"NULL field ptr\");\n+      RETURN_IF_FAIL_PRINTF2 (\n+\tfields[i],\n+\tctxt, loc,\n+\t\"%s: NULL field ptr at index %i\",\n+\tstruct_type->get_debug_string (),\n+\ti);\n       RETURN_IF_FAIL_PRINTF2 (\n \tNULL == fields[i]->get_container (),\n \tctxt, loc,\n@@ -1038,10 +1044,11 @@ gcc_jit_context_new_global (gcc_jit_context *ctxt,\n     kind);\n   RETURN_NULL_IF_FAIL (type, ctxt, loc, \"NULL type\");\n   RETURN_NULL_IF_FAIL (name, ctxt, loc, \"NULL name\");\n-  RETURN_NULL_IF_FAIL_PRINTF1 (\n+  RETURN_NULL_IF_FAIL_PRINTF2 (\n     type->has_known_size (),\n     ctxt, loc,\n-    \"type has unknown size (type: %s)\",\n+    \"unknown size for global \\\"%s\\\" (type: %s)\",\n+    name,\n     type->get_debug_string ());\n \n   return (gcc_jit_lvalue *)ctxt->new_global (loc, kind, type, name);\n@@ -1839,10 +1846,11 @@ gcc_jit_function_new_local (gcc_jit_function *func,\n \t\t       \"Cannot add locals to an imported function\");\n   RETURN_NULL_IF_FAIL (type, ctxt, loc, \"NULL type\");\n   RETURN_NULL_IF_FAIL (name, ctxt, loc, \"NULL name\");\n-  RETURN_NULL_IF_FAIL_PRINTF1 (\n+  RETURN_NULL_IF_FAIL_PRINTF2 (\n     type->has_known_size (),\n     ctxt, loc,\n-    \"type has unknown size (type: %s)\",\n+    \"unknown size for local \\\"%s\\\" (type: %s)\",\n+    name,\n     type->get_debug_string ());\n \n   return (gcc_jit_lvalue *)func->new_local (loc, type, name);"}, {"sha": "0eb7a8ce606061667f0cd1613922823c479464c5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "patch": "@@ -1,3 +1,13 @@\n+2015-07-08  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR jit/66783\n+\t* jit.dg/test-error-gcc_jit_context_new_field-opaque-struct.c\n+\t(verify_code): Update expected error message.\n+\t* jit.dg/test-error-gcc_jit_context_new_global-opaque-struct.c\n+\t(verify_code): Likewise.\n+\t* jit.dg/test-error-gcc_jit_function_new_local-opaque-struct.c\n+\t(verify_code): Likewise.\n+\n 2015-07-08  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/66793"}, {"sha": "fb4e54d6078dbc938b72ad4e738a15f60fc916e0", "filename": "gcc/testsuite/jit.dg/test-error-gcc_jit_context_new_field-opaque-struct.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_field-opaque-struct.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_field-opaque-struct.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_field-opaque-struct.c?ref=58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "patch": "@@ -27,5 +27,5 @@ verify_code (gcc_jit_context *ctxt, gcc_jit_result *result)\n   /* Verify that the correct error message was emitted.  */\n   CHECK_STRING_VALUE (gcc_jit_context_get_first_error (ctxt),\n \t\t      \"gcc_jit_context_new_field:\"\n-\t\t      \" type has unknown size (type: struct opaque)\");\n+\t\t      \" unknown size for field \\\"f_opaque\\\" (type: struct opaque)\");\n }"}, {"sha": "539b94ec3b359bb732680c13760c2c8d246cb62a", "filename": "gcc/testsuite/jit.dg/test-error-gcc_jit_context_new_global-opaque-struct.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_global-opaque-struct.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_global-opaque-struct.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_context_new_global-opaque-struct.c?ref=58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "patch": "@@ -28,5 +28,5 @@ verify_code (gcc_jit_context *ctxt, gcc_jit_result *result)\n   /* Verify that the correct error message was emitted.  */\n   CHECK_STRING_VALUE (gcc_jit_context_get_first_error (ctxt),\n \t\t      \"gcc_jit_context_new_global:\"\n-\t\t      \" type has unknown size (type: struct opaque)\");\n+\t\t      \" unknown size for global \\\"instance_of_opaque\\\" (type: struct opaque)\");\n }"}, {"sha": "41fbee2026edf8e80625d640656d91a2fb449655", "filename": "gcc/testsuite/jit.dg/test-error-gcc_jit_function_new_local-opaque-struct.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_function_new_local-opaque-struct.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58c5ad4032b2bb9e39a0d8c9925c0673f22877a0/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_function_new_local-opaque-struct.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Ftest-error-gcc_jit_function_new_local-opaque-struct.c?ref=58c5ad4032b2bb9e39a0d8c9925c0673f22877a0", "patch": "@@ -38,5 +38,5 @@ verify_code (gcc_jit_context *ctxt, gcc_jit_result *result)\n   /* Verify that the correct error message was emitted.  */\n   CHECK_STRING_VALUE (gcc_jit_context_get_first_error (ctxt),\n \t\t      \"gcc_jit_function_new_local:\"\n-\t\t      \" type has unknown size (type: struct opaque)\");\n+\t\t      \" unknown size for local \\\"i\\\" (type: struct opaque)\");\n }"}]}