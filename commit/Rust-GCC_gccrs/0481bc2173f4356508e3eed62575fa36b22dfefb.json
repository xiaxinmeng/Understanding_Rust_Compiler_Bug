{"sha": "0481bc2173f4356508e3eed62575fa36b22dfefb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDQ4MWJjMjE3M2Y0MzU2NTA4ZTNlZWQ2MjU3NWZhMzZiMjJkZmVmYg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2002-04-13T07:10:12Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2002-04-13T07:10:12Z"}, "message": "re PR c++/5373 (Statement expressions broken in C++)\n\n\tPR c++ 5373.\n\t* g++.dg/parse/stmtexpr1.C: New test.\n\n\tPR c++/5373.\n\t* semantics.c (finish_expr_stmt): Remember the type of the\n\texpression before any conversions are performed.\n\nFrom-SVN: r52264", "tree": {"sha": "3c8faed6a9f50ee59d2f66d5398cf53616345600", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3c8faed6a9f50ee59d2f66d5398cf53616345600"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0481bc2173f4356508e3eed62575fa36b22dfefb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0481bc2173f4356508e3eed62575fa36b22dfefb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0481bc2173f4356508e3eed62575fa36b22dfefb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0481bc2173f4356508e3eed62575fa36b22dfefb/comments", "author": null, "committer": null, "parents": [{"sha": "1d405c5eba2b1350d2614e690e35fbb0076209f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d405c5eba2b1350d2614e690e35fbb0076209f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d405c5eba2b1350d2614e690e35fbb0076209f4"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "e615310d5bd096019d5f5f2590cfdd828a9de620", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=0481bc2173f4356508e3eed62575fa36b22dfefb", "patch": "@@ -1,3 +1,9 @@\n+2002-04-12  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/5373.\n+\t* semantics.c (finish_expr_stmt): Remember the type of the\n+\texpression before any conversions are performed.\n+\n 2002-04-12  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/5189."}, {"sha": "f53ac28a85e6e4c09b15c7caaee57cf8a9dc9ed2", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=0481bc2173f4356508e3eed62575fa36b22dfefb", "patch": "@@ -203,6 +203,7 @@ finish_expr_stmt (expr)\n      tree expr;\n {\n   tree r = NULL_TREE;\n+  tree expr_type = NULL_TREE;;\n \n   if (expr != NULL_TREE)\n     {\n@@ -213,6 +214,9 @@ finish_expr_stmt (expr)\n \t      || TREE_CODE (TREE_TYPE (expr)) == FUNCTION_TYPE))\n \texpr = default_conversion (expr);\n       \n+      /* Remember the type of the expression.  */\n+      expr_type = TREE_TYPE (expr);\n+\n       if (stmts_are_full_exprs_p ())\n \texpr = convert_to_void (expr, \"statement\");\n       \n@@ -223,7 +227,7 @@ finish_expr_stmt (expr)\n \n   /* This was an expression-statement, so we save the type of the\n      expression.  */\n-  last_expr_type = expr ? TREE_TYPE (expr) : NULL_TREE;\n+  last_expr_type = expr_type;\n \n   return r;\n }"}, {"sha": "d3391f0dbcc8602364c11fc36103e69ecd4a7cf9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0481bc2173f4356508e3eed62575fa36b22dfefb", "patch": "@@ -1,8 +1,10 @@\n 2002-04-12  Mark Mitchell  <mark@codesourcery.com>\n \n+\tPR c++ 5373.\n+\t* g++.dg/parse/stmtexpr1.C: New test.\n+\n \tPR c++/5189.\n-\t* call.c (add_template_candidate_real): Do not treat member\n-\ttemplates as copy constructors.\n+\t* g++.dg/template/copy1.C: New test.\n \n 2002-04-12  Richard Henderson  <rth@redhat.com>\n "}, {"sha": "4455398bca608f09c58f55df35a999a927476324", "filename": "gcc/testsuite/g++.dg/parse/stmtexpr1.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fstmtexpr1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0481bc2173f4356508e3eed62575fa36b22dfefb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fstmtexpr1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fstmtexpr1.C?ref=0481bc2173f4356508e3eed62575fa36b22dfefb", "patch": "@@ -0,0 +1,9 @@\n+// { dg-do compile }\n+// { dg-options \"\" }\n+\n+int\n+main (int argc, char **argv)\n+{\n+  int a = ({ 1 ? 0 : 1; });\n+  return ({ argc > 1 ? 1 : 0; });\n+}"}]}