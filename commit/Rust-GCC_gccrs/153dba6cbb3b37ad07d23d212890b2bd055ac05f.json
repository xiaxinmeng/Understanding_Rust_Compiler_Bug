{"sha": "153dba6cbb3b37ad07d23d212890b2bd055ac05f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTUzZGJhNmNiYjNiMzdhZDA3ZDIzZDIxMjg5MGIyYmQwNTVhYzA1Zg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-03-27T20:00:56Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-03-27T20:00:56Z"}, "message": "re PR c++/85077 (V[248][SD]F abs not optimized to)\n\n\tPR c++/85077\n\t* cp-gimplify.c (cp_fold) <case CONSTRUCTOR>: For ctors with vector\n\ttype call fold to generate VECTOR_CSTs when possible.\n\n\t* g++.dg/ext/vector35.C: New test.\n\nFrom-SVN: r258903", "tree": {"sha": "ea10fd34e5bb3a747c9941d1ae3cc3fc692e200a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea10fd34e5bb3a747c9941d1ae3cc3fc692e200a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/153dba6cbb3b37ad07d23d212890b2bd055ac05f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/153dba6cbb3b37ad07d23d212890b2bd055ac05f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/153dba6cbb3b37ad07d23d212890b2bd055ac05f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/153dba6cbb3b37ad07d23d212890b2bd055ac05f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a7dea61705009a47b788ecafed0816ab8b54e3ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7dea61705009a47b788ecafed0816ab8b54e3ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7dea61705009a47b788ecafed0816ab8b54e3ac"}], "stats": {"total": 31, "additions": 31, "deletions": 0}, "files": [{"sha": "1799d8a9b146b50fa783b84d81dc62c5b7dff2f1", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=153dba6cbb3b37ad07d23d212890b2bd055ac05f", "patch": "@@ -1,5 +1,9 @@\n 2018-03-27  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/85077\n+\t* cp-gimplify.c (cp_fold) <case CONSTRUCTOR>: For ctors with vector\n+\ttype call fold to generate VECTOR_CSTs when possible.\n+\n \tPR c++/85076\n \t* tree.c (cp_build_reference_type): If to_type is error_mark_node,\n \treturn it right away."}, {"sha": "fd0c37f9be280b280fbef24b5e39649f7b961015", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=153dba6cbb3b37ad07d23d212890b2bd055ac05f", "patch": "@@ -2504,6 +2504,8 @@ cp_fold (tree x)\n \t    CONSTRUCTOR_PLACEHOLDER_BOUNDARY (x)\n \t      = CONSTRUCTOR_PLACEHOLDER_BOUNDARY (org_x);\n \t  }\n+\tif (VECTOR_TYPE_P (TREE_TYPE (x)))\n+\t  x = fold (x);\n \tbreak;\n       }\n     case TREE_VEC:"}, {"sha": "ba8ba77c42c73a504fae03ef4556efb15bb02810", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=153dba6cbb3b37ad07d23d212890b2bd055ac05f", "patch": "@@ -1,5 +1,8 @@\n 2018-03-27  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/85077\n+\t* g++.dg/ext/vector35.C: New test.\n+\n \tPR c++/85061\n \t* g++.dg/ext/builtin-offsetof3.C: New test.\n "}, {"sha": "22ff513091aaec61844b655a6930033ce5f1bcd8", "filename": "gcc/testsuite/g++.dg/ext/vector35.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector35.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/153dba6cbb3b37ad07d23d212890b2bd055ac05f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector35.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvector35.C?ref=153dba6cbb3b37ad07d23d212890b2bd055ac05f", "patch": "@@ -0,0 +1,22 @@\n+// PR c++/85077\n+// { dg-do compile }\n+// { dg-options \"-Ofast -fdump-tree-forwprop1\" }\n+\n+typedef float V __attribute__((vector_size (4 * sizeof (float))));\n+typedef double W __attribute__((vector_size (2 * sizeof (double))));\n+\n+void\n+foo (V *y)\n+{\n+  V x = *y;\n+  *y = x < 0 ? -x : x;\n+}\n+\n+void\n+bar (W *y)\n+{\n+  W x = *y;\n+  *y = x < 0 ? -x : x;\n+}\n+\n+// { dg-final { scan-tree-dump-times \"ABS_EXPR <\" 2 \"forwprop1\" } }"}]}