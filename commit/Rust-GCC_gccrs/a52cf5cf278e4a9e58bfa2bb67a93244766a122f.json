{"sha": "a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTUyY2Y1Y2YyNzhlNGE5ZTU4YmZhMmJiNjdhOTMyNDQ3NjZhMTIyZg==", "commit": {"author": {"name": "Przemyslaw Wirkus", "email": "przemyslaw.wirkus@arm.com", "date": "2019-05-14T08:07:56Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2019-05-14T08:07:56Z"}, "message": "2019-05-14  Przemyslaw Wirkus  <przemyslaw.wirkus@arm.com\\>\n\ngcc/\n\t* internal-fn.def (SIGNBIT): New.\n\t* config/aarch64/aarch64-simd.md (signbitv2sf2): New expand\n\tdefined.\n\t(signbitv4sf2): Likewise.\n\ngcc/testsuite/\n\t* gcc.target/aarch64/signbitv4sf.c: New test.\n\t* gcc.target/aarch64/signbitv2sf.c: New test.\n\nFrom-SVN: r271149", "tree": {"sha": "4ab28786db99aa2712d33ef304e636715ec80632", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4ab28786db99aa2712d33ef304e636715ec80632"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/comments", "author": {"login": "PrzemekWirkus", "id": 6360720, "node_id": "MDQ6VXNlcjYzNjA3MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/6360720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PrzemekWirkus", "html_url": "https://github.com/PrzemekWirkus", "followers_url": "https://api.github.com/users/PrzemekWirkus/followers", "following_url": "https://api.github.com/users/PrzemekWirkus/following{/other_user}", "gists_url": "https://api.github.com/users/PrzemekWirkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/PrzemekWirkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PrzemekWirkus/subscriptions", "organizations_url": "https://api.github.com/users/PrzemekWirkus/orgs", "repos_url": "https://api.github.com/users/PrzemekWirkus/repos", "events_url": "https://api.github.com/users/PrzemekWirkus/events{/privacy}", "received_events_url": "https://api.github.com/users/PrzemekWirkus/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4dbf3a15f1b6afa0100c1b026ba13450677931c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4dbf3a15f1b6afa0100c1b026ba13450677931c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4dbf3a15f1b6afa0100c1b026ba13450677931c9"}], "stats": {"total": 106, "additions": 106, "deletions": 0}, "files": [{"sha": "a4568fe165128a51036da9106040518b21f6e46b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "patch": "@@ -1,3 +1,10 @@\n+2019-05-14  Przemyslaw Wirkus  <przemyslaw.wirkus@arm.com\\>\n+\n+\t* internal-fn.def (SIGNBIT): New.\n+\t* config/aarch64/aarch64-simd.md (signbitv2sf2): New expand\n+\tdefined.\n+\t(signbitv4sf2): Likewise.\n+\n 2019-05-14  Chenghua Xu  <paul.hua.gm@gmail.com>\n \n \tPR target/90357"}, {"sha": "d4c48d2aa613d6b33fa9b012a98cfd89c96fec9b", "filename": "gcc/config/aarch64/aarch64-simd.md", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Fconfig%2Faarch64%2Faarch64-simd.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Fconfig%2Faarch64%2Faarch64-simd.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64-simd.md?ref=a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "patch": "@@ -935,6 +935,21 @@\n   [(set_attr \"type\" \"neon_ins<q>\")]\n )\n \n+(define_expand \"signbit<mode>2\"\n+  [(use (match_operand:<V_INT_EQUIV> 0 \"register_operand\"))\n+   (use (match_operand:VDQSF 1 \"register_operand\"))]\n+  \"TARGET_SIMD\"\n+{\n+  int shift_amount = GET_MODE_UNIT_BITSIZE (<V_INT_EQUIV>mode) - 1;\n+  rtx shift_vector = aarch64_simd_gen_const_vector_dup (<V_INT_EQUIV>mode,\n+                                                        shift_amount);\n+  operands[1] = lowpart_subreg (<V_INT_EQUIV>mode, operands[1], <MODE>mode);\n+\n+  emit_insn (gen_aarch64_simd_lshr<v_int_equiv> (operands[0], operands[1],\n+                                                 shift_vector));\n+  DONE;\n+})\n+\n (define_insn \"aarch64_simd_lshr<mode>\"\n  [(set (match_operand:VDQ_I 0 \"register_operand\" \"=w\")\n        (lshiftrt:VDQ_I (match_operand:VDQ_I 1 \"register_operand\" \"w\")"}, {"sha": "016301a58d83d7128817824d7c7ef92825c7e03e", "filename": "gcc/internal-fn.def", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Finternal-fn.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Finternal-fn.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Finternal-fn.def?ref=a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "patch": "@@ -217,6 +217,7 @@ DEF_INTERNAL_FLT_FN (LOG10, ECF_CONST, log10, unary)\n DEF_INTERNAL_FLT_FN (LOG1P, ECF_CONST, log1p, unary)\n DEF_INTERNAL_FLT_FN (LOG2, ECF_CONST, log2, unary)\n DEF_INTERNAL_FLT_FN (LOGB, ECF_CONST, logb, unary)\n+DEF_INTERNAL_FLT_FN (SIGNBIT, ECF_CONST, signbit, unary)\n DEF_INTERNAL_FLT_FN (SIGNIFICAND, ECF_CONST, significand, unary)\n DEF_INTERNAL_FLT_FN (SIN, ECF_CONST, sin, unary)\n DEF_INTERNAL_FLT_FN (SINH, ECF_CONST, sinh, unary)"}, {"sha": "b140a5787fb7cfdda3e5f6029d60062ea8be2571", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "patch": "@@ -1,3 +1,8 @@\n+2019-05-14  Przemyslaw Wirkus  <przemyslaw.wirkus@arm.com\\>\n+\n+\t* gcc.target/aarch64/signbitv4sf.c: New test.\n+\t* gcc.target/aarch64/signbitv2sf.c: New test.\n+\n 2019-05-13  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* g++.dg/cpp0x/Wattributes1.C: Adjust dg-error line number to fix"}, {"sha": "2587bfedd538f30a018cf827ea57cd583b2fa084", "filename": "gcc/testsuite/gcc.target/aarch64/signbitv2sf.c", "status": "added", "additions": 40, "deletions": 0, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsignbitv2sf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsignbitv2sf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsignbitv2sf.c?ref=a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "patch": "@@ -0,0 +1,40 @@\n+/* { dg-do run } */\n+/* { dg-additional-options \"-O3 --save-temps\" } */\n+\n+extern void abort ();\n+\n+#define N 8\n+float in[N] = {1.0, -1.0, -2.0, 3.0, -5.0, -8.0, 13.0, 21.0};\n+int out[N];\n+\n+void\n+foo (int *i, float *f)\n+{\n+  i[0] = __builtin_signbit (f[0]);\n+  i[1] = __builtin_signbit (f[1]);\n+}\n+\n+/* { dg-final { scan-assembler-not {-2147483648} } } */\n+/* { dg-final { scan-assembler {\\tushr\\tv[0-9]+.2s, v[0-9]+.2s, 31} } } */\n+\n+int\n+main ()\n+{\n+  int i;\n+\n+  foo (out, in);\n+  foo (out + 2, in + 2);\n+  foo (out + 4, in + 4);\n+  foo (out + 6, in + 6);\n+\n+  for (i = 0; i < N; i++)\n+  {\n+    if (in[i] >= 0.0 && out[i])\n+      abort ();\n+    if (in[i] < 0.0 && !out[i])\n+      abort ();\n+  }\n+\n+  return 0;\n+}\n+"}, {"sha": "18cffdc7d5b2701a1bbf23f9f7d27b7a31568758", "filename": "gcc/testsuite/gcc.target/aarch64/signbitv4sf.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsignbitv4sf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a52cf5cf278e4a9e58bfa2bb67a93244766a122f/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsignbitv4sf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fsignbitv4sf.c?ref=a52cf5cf278e4a9e58bfa2bb67a93244766a122f", "patch": "@@ -0,0 +1,38 @@\n+/* { dg-do run } */\n+/* { dg-additional-options \"-O3 --save-temps\" } */\n+\n+extern void abort ();\n+\n+#define N 1024\n+float in[N] = {1.0, -1.0, -2.0, 3.0, -5.0, -8.0, 13.0, 21.0};\n+int out[N];\n+\n+void\n+foo ()\n+{\n+  int i;\n+  for (i = 0; i < N; i++)\n+    out[i] = __builtin_signbit (in[i]);\n+}\n+\n+/* { dg-final { scan-assembler-not {-2147483648} } } */\n+/* { dg-final { scan-assembler {\\tushr\\tv[0-9]+.4s, v[0-9]+.4s, 31} } } */\n+\n+int\n+main ()\n+{\n+  int i;\n+\n+  foo ();\n+\n+  for (i = 0; i < N; i++)\n+  {\n+    if (in[i] >= 0.0 && out[i])\n+      abort ();\n+    if (in[i] < 0.0 && !out[i])\n+      abort ();\n+  }\n+\n+  return 0;\n+}\n+"}]}