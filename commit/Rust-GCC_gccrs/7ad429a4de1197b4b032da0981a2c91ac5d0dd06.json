{"sha": "7ad429a4de1197b4b032da0981a2c91ac5d0dd06", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2FkNDI5YTRkZTExOTdiNGIwMzJkYTA5ODFhMmM5MWFjNWQwZGQwNg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@linaro.org", "date": "2018-01-09T14:30:27Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2018-01-09T14:30:27Z"}, "message": "Fix permute handling when vectorising scatters\n\nAs mentioned in https://gcc.gnu.org/ml/gcc-patches/2017-11/msg01575.html ,\nthe scatter handling in vectorizable_store seems to be dead code at the\nmoment.  Enabling it with the vect_analyze_data_ref_access part of\nthat patch triggered an ICE in the avx512f-scatter-*.c tests (which\npreviously didn't use scatters).  The problem was that the NARROW\nand WIDEN handling uses permute_vec_elements to marshal the inputs,\nand permute_vec_elements expected the lhs of the stmt to be an SSA_NAME,\nwhich of course it isn't for stores.\n\nThis patch makes permute_vec_elements create a fresh variable in this case.\n\n2018-01-09  Richard Sandiford  <richard.sandiford@linaro.org>\n\ngcc/\n\t* tree-vect-stmts.c (permute_vec_elements): Create a fresh variable\n\tif the destination isn't an SSA_NAME.\n\nFrom-SVN: r256383", "tree": {"sha": "f961b0ea1d30ee5ba25759c42016f2ef9c9ed9dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f961b0ea1d30ee5ba25759c42016f2ef9c9ed9dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ad429a4de1197b4b032da0981a2c91ac5d0dd06", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ad429a4de1197b4b032da0981a2c91ac5d0dd06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ad429a4de1197b4b032da0981a2c91ac5d0dd06", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ad429a4de1197b4b032da0981a2c91ac5d0dd06/comments", "author": null, "committer": null, "parents": [{"sha": "82c066f587fe99cc3d5cd0d685582f0272d3a40f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/82c066f587fe99cc3d5cd0d685582f0272d3a40f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/82c066f587fe99cc3d5cd0d685582f0272d3a40f"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "d3c313d8329cd55d411c50006696ac238b5adbe2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ad429a4de1197b4b032da0981a2c91ac5d0dd06/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ad429a4de1197b4b032da0981a2c91ac5d0dd06/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7ad429a4de1197b4b032da0981a2c91ac5d0dd06", "patch": "@@ -1,3 +1,8 @@\n+2018-01-09  Richard Sandiford  <richard.sandiford@linaro.org>\n+\n+\t* tree-vect-stmts.c (permute_vec_elements): Create a fresh variable\n+\tif the destination isn't an SSA_NAME.\n+\n 2018-01-09  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/83668"}, {"sha": "a4f2d7139599106ce3321566303a4c82d62ba353", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ad429a4de1197b4b032da0981a2c91ac5d0dd06/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ad429a4de1197b4b032da0981a2c91ac5d0dd06/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=7ad429a4de1197b4b032da0981a2c91ac5d0dd06", "patch": "@@ -6585,7 +6585,11 @@ permute_vec_elements (tree x, tree y, tree mask_vec, gimple *stmt,\n   tree perm_dest, data_ref;\n   gimple *perm_stmt;\n \n-  perm_dest = vect_create_destination_var (gimple_get_lhs (stmt), vectype);\n+  tree scalar_dest = gimple_get_lhs (stmt);\n+  if (TREE_CODE (scalar_dest) == SSA_NAME)\n+    perm_dest = vect_create_destination_var (scalar_dest, vectype);\n+  else\n+    perm_dest = vect_get_new_vect_var (vectype, vect_simple_var, NULL);\n   data_ref = make_ssa_name (perm_dest);\n \n   /* Generate the permute statement.  */"}]}