{"sha": "f523e68a231849653c829aab6b0ccaf99137d0a5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjUyM2U2OGEyMzE4NDk2NTNjODI5YWFiNmIwY2NhZjk5MTM3ZDBhNQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2015-10-21T22:52:45Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2015-10-21T22:52:45Z"}, "message": "re PR c++/66781 (\"confused by earlier errors, bailing out\" with wrong enum within class)\n\n/cp\n2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/66781\n\t* parser.c (cp_parser_enum_specifier): Upon error_at set\n\tnested_name_specifier to error_mark_node; improve error message.\n\n/testsuite\n2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/66781\n\t* g++.dg/parse/enum13.C: New.\n\n/cp\n2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/67847\n\t* parser.c (cp_parser_enum_specifier): Reject a nested_name_specifier\n\twhich doesn't name a class or namespace.\n\n/testsuite\n2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/67847\n\t* g++.dg/parse/enum12.C: New.\n\nFrom-SVN: r229156", "tree": {"sha": "90b066e13d411947432f609dd047e25734cbe64a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/90b066e13d411947432f609dd047e25734cbe64a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f523e68a231849653c829aab6b0ccaf99137d0a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f523e68a231849653c829aab6b0ccaf99137d0a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f523e68a231849653c829aab6b0ccaf99137d0a5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f523e68a231849653c829aab6b0ccaf99137d0a5/comments", "author": null, "committer": null, "parents": [{"sha": "a7b2e1845f0c20da4ed6462161f58f706a587d44", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7b2e1845f0c20da4ed6462161f58f706a587d44", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7b2e1845f0c20da4ed6462161f58f706a587d44"}], "stats": {"total": 53, "additions": 51, "deletions": 2}, "files": [{"sha": "0ed4e29615da0d4e0c9cc18a17821cfcc5cbd611", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f523e68a231849653c829aab6b0ccaf99137d0a5", "patch": "@@ -1,3 +1,15 @@\n+2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/66781\n+\t* parser.c (cp_parser_enum_specifier): Upon error_at set\n+\tnested_name_specifier to error_mark_node; improve error message.\n+\n+2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/67847\n+\t* parser.c (cp_parser_enum_specifier): Reject a nested_name_specifier\n+\twhich doesn't name a class or namespace.\n+\n 2015-10-21  Ilya Enkovich  <enkovich.gnu@gmail.com>\n \n \t* call.c (build_conditional_expr_1): Use boolean vector"}, {"sha": "7555bf3c87aefedf7f05c456e4ee444713285538", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 14, "deletions": 2, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=f523e68a231849653c829aab6b0ccaf99137d0a5", "patch": "@@ -16655,8 +16655,12 @@ cp_parser_enum_specifier (cp_parser* parser)\n       else if (nested_name_specifier == error_mark_node)\n \t/* We already issued an error.  */;\n       else\n-\terror_at (type_start_token->location,\n-\t\t  \"%qD is not an enumerator-name\", identifier);\n+\t{\n+\t  error_at (type_start_token->location,\n+\t\t    \"%qD does not name an enumeration in %qT\",\n+\t\t    identifier, nested_name_specifier);\n+\t  nested_name_specifier = error_mark_node;\n+\t}\n     }\n   else\n     {\n@@ -16783,6 +16787,14 @@ cp_parser_enum_specifier (cp_parser* parser)\n \t\t\tnested_name_specifier);\n \t      type = error_mark_node;\n \t    }\n+\t  else if (TREE_CODE (nested_name_specifier) != NAMESPACE_DECL\n+\t\t   && !CLASS_TYPE_P (nested_name_specifier))\n+\t    {\n+\t      error_at (type_start_token->location, \"nested name specifier \"\n+\t\t\t\"%qT for enum declaration does not name a class \"\n+\t\t\t\"or namespace\", nested_name_specifier);\n+\t      type = error_mark_node;\n+\t    }\n \t  /* If that scope does not contain the scope in which the\n \t     class was originally declared, the program is invalid.  */\n \t  else if (prev_scope && !is_ancestor (prev_scope,"}, {"sha": "ef63b1b076534b5c744ca9b9dc2724a85e786a2f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f523e68a231849653c829aab6b0ccaf99137d0a5", "patch": "@@ -1,3 +1,13 @@\n+2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/66781\n+\t* g++.dg/parse/enum13.C: New.\n+\n+2015-10-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/67847\n+\t* g++.dg/parse/enum12.C: New.\n+\n 2015-10-21  Martin Sebor  <msebor@redhat.com>\n \n \tPR driver/68043"}, {"sha": "835dacd71a66d46d2ad177c5cbea4644bc5bf82a", "filename": "gcc/testsuite/g++.dg/parse/enum12.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum12.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum12.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum12.C?ref=f523e68a231849653c829aab6b0ccaf99137d0a5", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/67847\n+\n+template < typename T > \n+class D\n+{\n+  enum T::Color {R, G, B} c; // { dg-error \"nested name specifier\" }\n+};"}, {"sha": "102f21953ac7f9ce4639ce0c8828604be61f6e10", "filename": "gcc/testsuite/g++.dg/parse/enum13.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum13.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f523e68a231849653c829aab6b0ccaf99137d0a5/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum13.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fenum13.C?ref=f523e68a231849653c829aab6b0ccaf99137d0a5", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/66781\n+\n+class foo\n+{\n+public:\n+  enum foo::bar{};  // { dg-error \"does not name an enumeration\" }\n+  foo::bar baz;\n+};"}]}