{"sha": "6cc7fb90517d6928054354f8249532af84e1dc5b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmNjN2ZiOTA1MTdkNjkyODA1NDM1NGY4MjQ5NTMyYWY4NGUxZGM1Yg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2011-12-13T19:22:44Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2011-12-13T19:22:44Z"}, "message": "sparc: Default memory model to TSO for Linux and Solaris.\n\n        * config/sparc/tso.h: New file.\n        * config.gcc (sparc-*-linux*, sparc*-*-solaris2*): Use it.\n        * config/sparc/sparc.c (sparc_option_override): Honor\n        SUBTARGET_DEFAULT_MEMORY_MODEL.\n        * config/sparc/sparc.h (SUBTARGET_DEFAULT_MEMORY_MODEL): New.\n\nFrom-SVN: r182297", "tree": {"sha": "b1b4a7b1d891dcea67383cef1479b4fa6ef4f4b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1b4a7b1d891dcea67383cef1479b4fa6ef4f4b5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6cc7fb90517d6928054354f8249532af84e1dc5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6cc7fb90517d6928054354f8249532af84e1dc5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6cc7fb90517d6928054354f8249532af84e1dc5b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6cc7fb90517d6928054354f8249532af84e1dc5b/comments", "author": null, "committer": null, "parents": [{"sha": "9dadf3bf5ee8ef62f5e183e4595eba0b20d74902", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9dadf3bf5ee8ef62f5e183e4595eba0b20d74902", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9dadf3bf5ee8ef62f5e183e4595eba0b20d74902"}], "stats": {"total": 48, "additions": 44, "deletions": 4}, "files": [{"sha": "2b324a470c4c47aebee62f90a693ba64f3d0339a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6cc7fb90517d6928054354f8249532af84e1dc5b", "patch": "@@ -1,3 +1,11 @@\n+2011-12-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* config/sparc/tso.h: New file.\n+\t* config.gcc (sparc-*-linux*, sparc*-*-solaris2*): Use it.\n+\t* config/sparc/sparc.c (sparc_option_override): Honor\n+\tSUBTARGET_DEFAULT_MEMORY_MODEL.\n+\t* config/sparc/sparc.h (SUBTARGET_DEFAULT_MEMORY_MODEL): New.\n+\n 2011-12-13  Aldy Hernandez  <aldyh@redhat.com>\n \n \tPR/51443"}, {"sha": "d0f7b283b9ab65285d3e996305adae27b5afbaa3", "filename": "gcc/config.gcc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=6cc7fb90517d6928054354f8249532af84e1dc5b", "patch": "@@ -2357,7 +2357,7 @@ sparc-*-rtems*)\n \ttmake_file=\"sparc/t-sparc sparc/t-elf t-rtems\"\n \t;;\n sparc-*-linux*)\n-\ttm_file=\"${tm_file} dbxelf.h elfos.h sparc/sysv4.h gnu-user.h linux.h glibc-stdint.h\"\n+\ttm_file=\"${tm_file} dbxelf.h elfos.h sparc/sysv4.h gnu-user.h linux.h glibc-stdint.h sparc/tso.h\"\n \textra_options=\"${extra_options} sparc/long-double-switch.opt\"\n \tcase ${target} in\n \t    *-leon-*)\n@@ -2384,7 +2384,7 @@ sparc-*-netbsdelf*)\n \ttmake_file=\"${tmake_file} sparc/t-sparc\"\n \t;;\n sparc*-*-solaris2*)\n-\ttm_file=\"sparc/biarch64.h ${tm_file} ${sol2_tm_file} sol2-bi.h\"\n+\ttm_file=\"sparc/biarch64.h ${tm_file} ${sol2_tm_file} sol2-bi.h sparc/tso.h\"\n \tcase ${target} in\n \t    sparc64-*-* | sparcv9-*-*)\n \t\ttm_file=\"sparc/default-64.h ${tm_file}\"\n@@ -2410,7 +2410,7 @@ sparc64-*-rtems*)\n \ttmake_file=\"${tmake_file} sparc/t-sparc t-rtems\"\n \t;;\n sparc64-*-linux*)\n-\ttm_file=\"sparc/biarch64.h ${tm_file} dbxelf.h elfos.h sparc/sysv4.h gnu-user.h linux.h glibc-stdint.h sparc/default-64.h sparc/linux64.h\"\n+\ttm_file=\"sparc/biarch64.h ${tm_file} dbxelf.h elfos.h sparc/sysv4.h gnu-user.h linux.h glibc-stdint.h sparc/default-64.h sparc/linux64.h sparc/tso.h\"\n \textra_options=\"${extra_options} sparc/long-double-switch.opt\"\n \ttmake_file=\"${tmake_file} sparc/t-sparc sparc/t-linux64\"\n \t;;"}, {"sha": "20efb00c4517fb43ff599d84d4e4d4e796f77a6b", "filename": "gcc/config/sparc/sparc.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig%2Fsparc%2Fsparc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig%2Fsparc%2Fsparc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.c?ref=6cc7fb90517d6928054354f8249532af84e1dc5b", "patch": "@@ -1162,8 +1162,12 @@ sparc_option_override (void)\n \n   if (sparc_memory_model == SMM_DEFAULT)\n     {\n+      /* Choose the memory model for the operating system.  */\n+      enum sparc_memory_model_type os_default = SUBTARGET_DEFAULT_MEMORY_MODEL;\n+      if (os_default != SMM_DEFAULT)\n+\tsparc_memory_model = os_default;\n       /* Choose the most relaxed model for the processor.  */\n-      if (TARGET_V9)\n+      else if (TARGET_V9)\n \tsparc_memory_model = SMM_RMO;\n       else if (TARGET_V8)\n \tsparc_memory_model = SMM_PSO;"}, {"sha": "bb6b0794350365da263ded4d7a01a699f792f8c5", "filename": "gcc/config/sparc/sparc.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig%2Fsparc%2Fsparc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig%2Fsparc%2Fsparc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.h?ref=6cc7fb90517d6928054354f8249532af84e1dc5b", "patch": "@@ -1755,3 +1755,8 @@ extern int sparc_indent_opcode;\n #define MASK_DEBUG_ALL\t\t\tMASK_DEBUG_OPTIONS\n \n #define TARGET_DEBUG_OPTIONS\t\t(sparc_debug & MASK_DEBUG_OPTIONS)\n+\n+/* By default, use the weakest memory model for the cpu.  */\n+#ifndef SUBTARGET_DEFAULT_MEMORY_MODEL\n+#define SUBTARGET_DEFAULT_MEMORY_MODEL\tSMM_DEFAULT\n+#endif"}, {"sha": "c81ea4d35a3f70527b5ca2ebb24e4a1cd4f17857", "filename": "gcc/config/sparc/tso.h", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig%2Fsparc%2Ftso.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cc7fb90517d6928054354f8249532af84e1dc5b/gcc%2Fconfig%2Fsparc%2Ftso.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Ftso.h?ref=6cc7fb90517d6928054354f8249532af84e1dc5b", "patch": "@@ -0,0 +1,23 @@\n+/* Include fragment for Sparc TSO operating systems.\n+   Copyright (C) 2011 Free Software Foundation, Inc.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 3, or (at your option)\n+any later version.\n+\n+GCC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GCC; see the file COPYING3.  If not see\n+<http://www.gnu.org/licenses/>.  */\n+\n+\n+/* This operating system sets PSTATE.MM to the TSO memory model.  */\n+#undef SUBTARGET_DEFAULT_MEMORY_MODEL\n+#define SUBTARGET_DEFAULT_MEMORY_MODEL\tSMM_TSO"}]}