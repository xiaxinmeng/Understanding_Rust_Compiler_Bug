{"sha": "f1b2b25ccf254bd21d112859db7c8a917c442d45", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjFiMmIyNWNjZjI1NGJkMjFkMTEyODU5ZGI3YzhhOTE3YzQ0MmQ0NQ==", "commit": {"author": {"name": "Anthony Green", "email": "green@redhat.com", "date": "2005-02-14T13:51:29Z"}, "committer": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2005-02-14T13:51:29Z"}, "message": "jni.cc (nathash_add): Don't strdup the method signature.\n\n2005-02-13  Anthony Green  <green@redhat.com>\n\n        * jni.cc (nathash_add): Don't strdup the method signature.\n        (_Jv_JNI_RegisterNatives): Convert the slashes to dots in the\n        method signature.\n        Update copyright.\n\nFrom-SVN: r95010", "tree": {"sha": "66806536e5d93fc403025a09eace3e2bf5fc09ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/66806536e5d93fc403025a09eace3e2bf5fc09ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f1b2b25ccf254bd21d112859db7c8a917c442d45", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1b2b25ccf254bd21d112859db7c8a917c442d45", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f1b2b25ccf254bd21d112859db7c8a917c442d45", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f1b2b25ccf254bd21d112859db7c8a917c442d45/comments", "author": {"login": "atgreen", "id": 89993, "node_id": "MDQ6VXNlcjg5OTkz", "avatar_url": "https://avatars.githubusercontent.com/u/89993?v=4", "gravatar_id": "", "url": "https://api.github.com/users/atgreen", "html_url": "https://github.com/atgreen", "followers_url": "https://api.github.com/users/atgreen/followers", "following_url": "https://api.github.com/users/atgreen/following{/other_user}", "gists_url": "https://api.github.com/users/atgreen/gists{/gist_id}", "starred_url": "https://api.github.com/users/atgreen/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/atgreen/subscriptions", "organizations_url": "https://api.github.com/users/atgreen/orgs", "repos_url": "https://api.github.com/users/atgreen/repos", "events_url": "https://api.github.com/users/atgreen/events{/privacy}", "received_events_url": "https://api.github.com/users/atgreen/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4230cec2f9ee41f4a33644a0b944eaaf0430dfdc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4230cec2f9ee41f4a33644a0b944eaaf0430dfdc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4230cec2f9ee41f4a33644a0b944eaaf0430dfdc"}], "stats": {"total": 33, "additions": 28, "deletions": 5}, "files": [{"sha": "b47469f343de39fb3d9b3d6d377006193abada9d", "filename": "libjava/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1b2b25ccf254bd21d112859db7c8a917c442d45/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1b2b25ccf254bd21d112859db7c8a917c442d45/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=f1b2b25ccf254bd21d112859db7c8a917c442d45", "patch": "@@ -1,3 +1,10 @@\n+2005-02-13  Anthony Green  <green@redhat.com>\n+\n+\t* jni.cc (nathash_add): Don't strdup the method signature.\n+\t(_Jv_JNI_RegisterNatives): Convert the slashes to dots in the\n+\tmethod signature.\n+\tUpdate copyright.\n+\n 2005-02-12  Mark Wielaard  <mark@klomp.org>\n \n \tFixes bug libgcj/8170"}, {"sha": "b7c208417a5a4556c21a5b7083d58b021f51a060", "filename": "libjava/jni.cc", "status": "modified", "additions": 21, "deletions": 5, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f1b2b25ccf254bd21d112859db7c8a917c442d45/libjava%2Fjni.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f1b2b25ccf254bd21d112859db7c8a917c442d45/libjava%2Fjni.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni.cc?ref=f1b2b25ccf254bd21d112859db7c8a917c442d45", "patch": "@@ -1,6 +1,6 @@\n // jni.cc - JNI implementation, including the jump table.\n \n-/* Copyright (C) 1998, 1999, 2000, 2001, 2002, 2003, 2004\n+/* Copyright (C) 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005\n    Free Software Foundation\n \n    This file is part of libgcj.\n@@ -1880,7 +1880,8 @@ nathash_add (const JNINativeMethod *method)\n     return;\n   // FIXME\n   slot->name = strdup (method->name);\n-  slot->signature = strdup (method->signature);\n+  // This was already strduped in _Jv_JNI_RegisterNatives.\n+  slot->signature = method->signature;\n   slot->fnPtr = method->fnPtr;\n }\n \n@@ -1894,6 +1895,8 @@ _Jv_JNI_RegisterNatives (JNIEnv *env, jclass klass,\n   // the nathash table.\n   JvSynchronize sync (global_ref_table);\n \n+  JNINativeMethod dottedMethod;\n+\n   // Look at each descriptor given us, and find the corresponding\n   // method in the class.\n   for (int j = 0; j < nMethods; ++j)\n@@ -1905,15 +1908,28 @@ _Jv_JNI_RegisterNatives (JNIEnv *env, jclass klass,\n \t{\n \t  _Jv_Method *self = &imeths[i];\n \n-\t  if (! strcmp (self->name->chars (), methods[j].name)\n-\t      && ! strcmp (self->signature->chars (), methods[j].signature))\n+\t  // Copy this JNINativeMethod and do a slash to dot\n+\t  // conversion on the signature.\n+\t  dottedMethod.name = methods[j].name;\n+\t  dottedMethod.signature = strdup (methods[j].signature);\n+\t  dottedMethod.fnPtr = methods[j].fnPtr;\n+\t  char *c = dottedMethod.signature;\n+\t  while (*c)\n+\t    {\n+\t      if (*c == '/')\n+\t\t*c = '.';\n+\t      c++;\n+\t    }\n+\n+\t  if (! strcmp (self->name->chars (), dottedMethod.name)\n+\t      && ! strcmp (self->signature->chars (), dottedMethod.signature))\n \t    {\n \t      if (! (self->accflags & java::lang::reflect::Modifier::NATIVE))\n \t\tbreak;\n \n \t      // Found a match that is native.\n \t      found = true;\n-\t      nathash_add (&methods[j]);\n+\t      nathash_add (&dottedMethod);\n \n \t      break;\n \t    }"}]}