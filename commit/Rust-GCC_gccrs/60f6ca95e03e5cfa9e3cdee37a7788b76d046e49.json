{"sha": "60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjBmNmNhOTVlMDNlNWNmYTllM2NkZWUzN2E3Nzg4Yjc2ZDA0NmU0OQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2013-05-04T17:49:31Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-05-04T17:49:31Z"}, "message": "decl.c (gfc_verify_c_interop_param): Permit allocatable and pointer with -std=f2008ts.\n\n2013-05-04  Tobias Burnus  <burnus@net-b.de>\n\n        * decl.c (gfc_verify_c_interop_param): Permit allocatable\n        and pointer with -std=f2008ts.\n\n2013-05-04  Tobias Burnus  <burnus@net-b.de>\n\n        * gfortran.dg/bind_c_array_params.f03: Update dg-error.\n        * gfortran.dg/bind_c_usage_27.f90: New.\n        * gfortran.dg/bind_c_usage_28.f90: New.\n\nFrom-SVN: r198597", "tree": {"sha": "e0ffb0e77f85ef3fe7537349c4550d941169e096", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e0ffb0e77f85ef3fe7537349c4550d941169e096"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0654e6be9566ff502a8754e3876c66dfdef14e2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0654e6be9566ff502a8754e3876c66dfdef14e2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0654e6be9566ff502a8754e3876c66dfdef14e2f"}], "stats": {"total": 81, "additions": 68, "deletions": 13}, "files": [{"sha": "3b8fe53242230cc119caf85bb4a4b8cbcfc1cce0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "patch": "@@ -1,3 +1,8 @@\n+2013-05-04  Tobias Burnus  <burnus@net-b.de>\n+\n+\t* decl.c (gfc_verify_c_interop_param): Permit allocatable\n+\tand pointer with -std=f2008ts.\n+\n 2013-05-02  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/57142"}, {"sha": "0187911ad204815c87b0ef35e55ac68af184df46", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 19, "deletions": 12, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "patch": "@@ -1061,20 +1061,27 @@ gfc_verify_c_interop_param (gfc_symbol *sym)\n \t  /* We have to make sure that any param to a bind(c) routine does\n \t     not have the allocatable, pointer, or optional attributes,\n \t     according to J3/04-007, section 5.1.  */\n-\t  if (sym->attr.allocatable == 1)\n-\t    {\n-\t      gfc_error (\"Variable '%s' at %L cannot have the \"\n-\t\t\t \"ALLOCATABLE attribute because procedure '%s'\"\n-\t\t\t \" is BIND(C)\", sym->name, &(sym->declared_at),\n-\t\t\t sym->ns->proc_name->name);\n-\t      retval = false;\n-\t    }\n+\t  if (sym->attr.allocatable == 1\n+\t      && !gfc_notify_std (GFC_STD_F2008_TS, \"Variable '%s' at %L with \"\n+\t\t\t\t  \"ALLOCATABLE attribute in procedure '%s' \"\n+\t\t\t\t  \"with BIND(C)\", sym->name,\n+\t\t\t\t  &(sym->declared_at),\n+\t\t\t\t  sym->ns->proc_name->name))\n+\t    retval = false;\n+\n+\t  if (sym->attr.pointer == 1\n+\t      && !gfc_notify_std (GFC_STD_F2008_TS, \"Variable '%s' at %L with \"\n+\t\t\t\t  \"POINTER attribute in procedure '%s' \"\n+\t\t\t\t  \"with BIND(C)\", sym->name,\n+\t\t\t\t  &(sym->declared_at),\n+\t\t\t\t  sym->ns->proc_name->name))\n+\t    retval = false;\n \n-\t  if (sym->attr.pointer == 1)\n+\t  if ((sym->attr.allocatable || sym->attr.pointer) && !sym->as)\n \t    {\n-\t      gfc_error (\"Variable '%s' at %L cannot have the \"\n-\t\t\t \"POINTER attribute because procedure '%s'\"\n-\t\t\t \" is BIND(C)\", sym->name, &(sym->declared_at),\n+\t      gfc_error (\"Scalar variable '%s' at %L with POINTER or \"\n+\t\t\t \"ALLOCATABLE in procedure '%s' with BIND(C) is not yet\"\n+\t\t\t \" supported\", sym->name, &(sym->declared_at),\n \t\t\t sym->ns->proc_name->name);\n \t      retval = false;\n \t    }"}, {"sha": "2e0d5103aca0c28858d2946ef46573485b8ee5d5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "patch": "@@ -1,3 +1,9 @@\n+2013-05-04  Tobias Burnus  <burnus@net-b.de>\n+\n+\t* gfortran.dg/bind_c_array_params.f03: Update dg-error.\n+\t* gfortran.dg/bind_c_usage_27.f90: New.\n+\t* gfortran.dg/bind_c_usage_28.f90: New.\n+\n 2013-05-04  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/51927"}, {"sha": "0e9903c6390ba96ceaf145b727fcf37ebd93152a", "filename": "gcc/testsuite/gfortran.dg/bind_c_array_params.f03", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_array_params.f03", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_array_params.f03", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_array_params.f03?ref=60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "patch": "@@ -9,7 +9,7 @@ subroutine sub0(assumed_array) bind(c) ! { dg-error \"TS 29113: Assumed-shape arr\n     integer(c_int), dimension(:) :: assumed_array\n   end subroutine sub0\n \n-  subroutine sub1(deferred_array) bind(c) ! { dg-error \"cannot\" } \n+  subroutine sub1(deferred_array) bind(c) ! { dg-error \"TS 29113: Variable 'deferred_array' at .1. with POINTER attribute in procedure 'sub1' with BIND.C.\" }\n     integer(c_int), pointer :: deferred_array(:)\n   end subroutine sub1\n end module bind_c_array_params"}, {"sha": "a1b0fcc62031988fbec6e61aaadcde884fc75e34", "filename": "gcc/testsuite/gfortran.dg/bind_c_usage_27.f90", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_27.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_27.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_27.f90?ref=60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "patch": "@@ -0,0 +1,17 @@\n+! { dg-do compile }\n+! { dg-options \"-std=f2008ts\" }\n+!\n+! Contributed by Reinhold Bader\n+! \n+use iso_c_binding\n+type, bind(C) :: cstruct\n+  integer :: i\n+end type\n+interface\n+     subroutine psub(this, that) bind(c, name='Psub')\n+       import :: c_float, cstruct\n+       real(c_float), pointer  :: this(:)\n+       type(cstruct), allocatable  :: that(:)\n+     end subroutine psub\n+  end interface\n+end"}, {"sha": "ff03ef48f17d1b3317d6b9110a2509d7ff629d4b", "filename": "gcc/testsuite/gfortran.dg/bind_c_usage_28.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_28.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60f6ca95e03e5cfa9e3cdee37a7788b76d046e49/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_28.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_28.f90?ref=60f6ca95e03e5cfa9e3cdee37a7788b76d046e49", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do compile }\n+! { dg-options \"-std=f2008\" }\n+!\n+! Contributed by Reinhold Bader\n+! \n+use iso_c_binding\n+type, bind(C) :: cstruct\n+  integer :: i\n+end type\n+interface\n+     subroutine psub(this) bind(c, name='Psub') ! { dg-error \"TS 29113: Variable 'this' at .1. with POINTER attribute in procedure 'psub' with BIND.C.\" }\n+       import :: c_float, cstruct\n+       real(c_float), pointer  :: this(:)\n+     end subroutine psub\n+     subroutine psub2(that) bind(c, name='Psub2') ! { dg-error \"TS 29113: Variable 'that' at .1. with ALLOCATABLE attribute in procedure 'psub2' with BIND.C.\" }\n+       import :: c_float, cstruct\n+       type(cstruct), allocatable  :: that(:)\n+     end subroutine psub2\n+  end interface\n+end"}]}