{"sha": "28267cfcce273646cf39bca5401428cb53429481", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjgyNjdjZmNjZTI3MzY0NmNmMzliY2E1NDAxNDI4Y2I1MzQyOTQ4MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-12-06T09:33:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-12-06T09:33:26Z"}, "message": "re PR c++/34336 (4.2.2 internal error in stabilize_expr)\n\n\tPR c++/34336\n\t* tree.c (stabilize_call, stabilize_init): Do nothing if\n\tprocessing_template_decl.\n\n\t* g++.dg/template/new8.C: New test.\n\nFrom-SVN: r130645", "tree": {"sha": "6c697217b3ef800e50679e044c15c669ed1856e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6c697217b3ef800e50679e044c15c669ed1856e4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/28267cfcce273646cf39bca5401428cb53429481", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28267cfcce273646cf39bca5401428cb53429481", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28267cfcce273646cf39bca5401428cb53429481", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28267cfcce273646cf39bca5401428cb53429481/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0bf0efd537002cfccc99e7b72ac8fdab64b76cf5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bf0efd537002cfccc99e7b72ac8fdab64b76cf5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bf0efd537002cfccc99e7b72ac8fdab64b76cf5"}], "stats": {"total": 49, "additions": 46, "deletions": 3}, "files": [{"sha": "f7e8904909f17a1963b701293bf6004214e1ecd3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28267cfcce273646cf39bca5401428cb53429481/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28267cfcce273646cf39bca5401428cb53429481/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=28267cfcce273646cf39bca5401428cb53429481", "patch": "@@ -1,3 +1,9 @@\n+2007-12-06  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/34336\n+\t* tree.c (stabilize_call, stabilize_init): Do nothing if\n+\tprocessing_template_decl.\n+\n 2007-12-05  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/34271"}, {"sha": "843f6c45590cf17ffead22155d03ba5a873d8333", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28267cfcce273646cf39bca5401428cb53429481/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28267cfcce273646cf39bca5401428cb53429481/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=28267cfcce273646cf39bca5401428cb53429481", "patch": "@@ -2602,8 +2602,11 @@ stabilize_call (tree call, tree *initp)\n   int i;\n   int nargs = call_expr_nargs (call);\n \n-  if (call == error_mark_node)\n-    return;\n+  if (call == error_mark_node || processing_template_decl)\n+    {\n+      *initp = NULL_TREE;\n+      return;\n+    }\n \n   gcc_assert (TREE_CODE (call) == CALL_EXPR);\n \n@@ -2662,7 +2665,7 @@ stabilize_init (tree init, tree *initp)\n \n   *initp = NULL_TREE;\n \n-  if (t == error_mark_node)\n+  if (t == error_mark_node || processing_template_decl)\n     return true;\n \n   if (TREE_CODE (t) == INIT_EXPR"}, {"sha": "94e727337ded6563df6ca8d5851daea84d957f84", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28267cfcce273646cf39bca5401428cb53429481/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28267cfcce273646cf39bca5401428cb53429481/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=28267cfcce273646cf39bca5401428cb53429481", "patch": "@@ -1,3 +1,8 @@\n+2007-12-06  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/34336\n+\t* g++.dg/template/new8.C: New test.\n+\n 2007-12-06  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/34333"}, {"sha": "b8f3f97e6dc83d6fed6299f16307559cac0d0f23", "filename": "gcc/testsuite/g++.dg/template/new8.C", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28267cfcce273646cf39bca5401428cb53429481/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnew8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28267cfcce273646cf39bca5401428cb53429481/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnew8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fnew8.C?ref=28267cfcce273646cf39bca5401428cb53429481", "patch": "@@ -0,0 +1,29 @@\n+// PR c++/34336\n+// { dg-do compile }\n+\n+struct A;\n+\n+template <class T>\n+struct S\n+{\n+  T *m;\n+  T &operator* () { return *m; }\n+};\n+\n+struct B\n+{\n+  B (const A &);\n+};\n+\n+template <class T>\n+struct C\n+{\n+  C ();\n+  S<A> c;\n+};\n+\n+template <class T>\n+C<T>::C ()\n+{\n+  B *b = new B (*c);\n+}"}]}