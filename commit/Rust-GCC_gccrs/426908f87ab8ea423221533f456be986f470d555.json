{"sha": "426908f87ab8ea423221533f456be986f470d555", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDI2OTA4Zjg3YWI4ZWE0MjMyMjE1MzNmNDU2YmU5ODZmNDcwZDU1NQ==", "commit": {"author": {"name": "Robert Dewar", "email": "dewar@adacore.com", "date": "2009-07-10T09:11:16Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-07-10T09:11:16Z"}, "message": "exp_ch4.adb (Raise_Accessibility_Error): New procedure\n\n2009-07-10  Robert Dewar  <dewar@adacore.com>\n\n\t* exp_ch4.adb (Raise_Accessibility_Error): New procedure\n\nFrom-SVN: r149463", "tree": {"sha": "95c7e82cf31d9aa95147bebc17e95c85a4eda6c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95c7e82cf31d9aa95147bebc17e95c85a4eda6c2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/426908f87ab8ea423221533f456be986f470d555", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/426908f87ab8ea423221533f456be986f470d555", "html_url": "https://github.com/Rust-GCC/gccrs/commit/426908f87ab8ea423221533f456be986f470d555", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/426908f87ab8ea423221533f456be986f470d555/comments", "author": null, "committer": null, "parents": [{"sha": "1ded1a1faeff3ed16dbd320bbb24035a6db21d45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ded1a1faeff3ed16dbd320bbb24035a6db21d45", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ded1a1faeff3ed16dbd320bbb24035a6db21d45"}], "stats": {"total": 32, "additions": 23, "deletions": 9}, "files": [{"sha": "880d4a02f71154aa087e72c3812263cbefd010e1", "filename": "gcc/ada/exp_ch4.adb", "status": "modified", "additions": 23, "deletions": 9, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/426908f87ab8ea423221533f456be986f470d555/gcc%2Fada%2Fexp_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/426908f87ab8ea423221533f456be986f470d555/gcc%2Fada%2Fexp_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch4.adb?ref=426908f87ab8ea423221533f456be986f470d555", "patch": "@@ -7519,6 +7519,11 @@ package body Exp_Ch4 is\n       --  assignment to temporary. If there is no change of representation,\n       --  then the conversion node is unchanged.\n \n+      procedure Raise_Accessibility_Error;\n+      --  Called when we know that an accessibility check will fail. Rewrites\n+      --  node N to an appropriate raise statement and outputs warning msgs.\n+      --  The Etype of the raise node is set to Target_Type.\n+\n       procedure Real_Range_Check;\n       --  Handles generation of range check for real target value\n \n@@ -7648,6 +7653,22 @@ package body Exp_Ch4 is\n          end if;\n       end Handle_Changed_Representation;\n \n+      -------------------------------\n+      -- Raise_Accessibility_Error --\n+      -------------------------------\n+\n+      procedure Raise_Accessibility_Error is\n+      begin\n+         Rewrite (N,\n+           Make_Raise_Program_Error (Sloc (N),\n+             Reason => PE_Accessibility_Check_Failed));\n+         Set_Etype (N, Target_Type);\n+\n+         Error_Msg_N (\"?accessibility check failure\", N);\n+         Error_Msg_NE\n+           (\"\\?& will be raised at run time\", N, Standard_Program_Error);\n+      end Raise_Accessibility_Error;\n+\n       ----------------------\n       -- Real_Range_Check --\n       ----------------------\n@@ -7884,10 +7905,7 @@ package body Exp_Ch4 is\n            and then Type_Access_Level (Operand_Type) >\n                     Type_Access_Level (Target_Type)\n          then\n-            Rewrite (N,\n-              Make_Raise_Program_Error (Sloc (N),\n-                Reason => PE_Accessibility_Check_Failed));\n-            Set_Etype (N, Target_Type);\n+            Raise_Accessibility_Error;\n \n          --  When the operand is a selected access discriminant the check needs\n          --  to be made against the level of the object denoted by the prefix\n@@ -7901,11 +7919,7 @@ package body Exp_Ch4 is\n            and then Object_Access_Level (Operand) >\n                       Type_Access_Level (Target_Type)\n          then\n-            Rewrite (N,\n-              Make_Raise_Program_Error (Sloc (N),\n-                Reason => PE_Accessibility_Check_Failed));\n-            Set_Etype (N, Target_Type);\n-\n+            Raise_Accessibility_Error;\n             return;\n          end if;\n       end if;"}]}