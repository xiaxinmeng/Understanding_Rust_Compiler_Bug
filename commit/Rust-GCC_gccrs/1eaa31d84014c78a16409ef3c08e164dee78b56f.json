{"sha": "1eaa31d84014c78a16409ef3c08e164dee78b56f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWVhYTMxZDg0MDE0Yzc4YTE2NDA5ZWYzYzA4ZTE2NGRlZTc4YjU2Zg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-12-16T19:50:42Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2017-12-16T19:50:42Z"}, "message": "re PR libfortran/81937 (stack-buffer-overflow on memcpy in libgfortran/io/unix.c on character(kind=4))\n\n2017-12-16  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n        PR libgfortran/81937\n        * io/list_read.c (next_char_internal): Don't attempt to read\n        from the internal unit stream if no bytes are left. Decrement\n        bytes_left in the right place.\n\nFrom-SVN: r255750", "tree": {"sha": "b052be0f836386dc80e2d8230dcd4d31426e03de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b052be0f836386dc80e2d8230dcd4d31426e03de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1eaa31d84014c78a16409ef3c08e164dee78b56f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1eaa31d84014c78a16409ef3c08e164dee78b56f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1eaa31d84014c78a16409ef3c08e164dee78b56f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1eaa31d84014c78a16409ef3c08e164dee78b56f/comments", "author": null, "committer": null, "parents": [{"sha": "c16c06daa1e537fb2f0cbeb038a40e0867c66b3a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c16c06daa1e537fb2f0cbeb038a40e0867c66b3a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c16c06daa1e537fb2f0cbeb038a40e0867c66b3a"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "aa2a0f7f673d9b46cbb90b459f490a98ededc820", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1eaa31d84014c78a16409ef3c08e164dee78b56f/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1eaa31d84014c78a16409ef3c08e164dee78b56f/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=1eaa31d84014c78a16409ef3c08e164dee78b56f", "patch": "@@ -1,3 +1,10 @@\n+2017-12-16  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libgfortran/81937\n+\t* io/list_read.c (next_char_internal): Don't attempt to read\n+\tfrom the internal unit stream if no bytes are left. Decrement\n+\tbytes_left in the right place.\n+\n 2017-12-12  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libgfortran/78549"}, {"sha": "037f2daa647e11292ebf538a3c4899f59d7e5c9b", "filename": "libgfortran/io/list_read.c", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1eaa31d84014c78a16409ef3c08e164dee78b56f/libgfortran%2Fio%2Flist_read.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1eaa31d84014c78a16409ef3c08e164dee78b56f/libgfortran%2Fio%2Flist_read.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Flist_read.c?ref=1eaa31d84014c78a16409ef3c08e164dee78b56f", "patch": "@@ -266,15 +266,19 @@ next_char_internal (st_parameter_dt *dtp)\n     }\n \n   /* Get the next character and handle end-of-record conditions.  */\n-\n-  if (is_char4_unit(dtp)) /* Check for kind=4 internal unit.  */\n-   length = sread (dtp->u.p.current_unit->s, &c, 1);\n+  if (likely (dtp->u.p.current_unit->bytes_left > 0))\n+    {\n+      if (unlikely (is_char4_unit(dtp))) /* Check for kind=4 internal unit.  */\n+       length = sread (dtp->u.p.current_unit->s, &c, 1);\n+      else\n+       {\n+\t char cc;\n+\t length = sread (dtp->u.p.current_unit->s, &cc, 1);\n+\t c = cc;\n+       }\n+    }\n   else\n-   {\n-     char cc;\n-     length = sread (dtp->u.p.current_unit->s, &cc, 1);\n-     c = cc;\n-   }\n+    length = 0;\n \n   if (unlikely (length < 0))\n     {\n@@ -290,7 +294,6 @@ next_char_internal (st_parameter_dt *dtp)\n \t  generate_error (&dtp->common, LIBERROR_INTERNAL_UNIT, NULL);\n \t  return '\\0';\n \t}\n-      dtp->u.p.current_unit->bytes_left--;\n     }\n   else\n     {\n@@ -302,6 +305,7 @@ next_char_internal (st_parameter_dt *dtp)\n \t  dtp->u.p.at_eof = 1;\n \t}\n     }\n+  dtp->u.p.current_unit->bytes_left--;\n \n done:\n   dtp->u.p.at_eol = (c == '\\n' || c == EOF);"}]}