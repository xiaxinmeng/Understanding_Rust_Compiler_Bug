{"sha": "dd1628807a800c86b45495218cb19260bae8a846", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGQxNjI4ODA3YTgwMGM4NmI0NTQ5NTIxOGNiMTkyNjBiYWU4YTg0Ng==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-01-13T23:17:20Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2012-01-13T23:17:20Z"}, "message": "mksysinfo: Pick up TIOCGWINSZ even if expression is too complex.\n\nFrom-SVN: r183169", "tree": {"sha": "0f0616362ad4d70ec8fb072e475987d9968fb76c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f0616362ad4d70ec8fb072e475987d9968fb76c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dd1628807a800c86b45495218cb19260bae8a846", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1628807a800c86b45495218cb19260bae8a846", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd1628807a800c86b45495218cb19260bae8a846", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd1628807a800c86b45495218cb19260bae8a846/comments", "author": null, "committer": null, "parents": [{"sha": "daeae9f1962fe408495f786c2d29098e7b13b36b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/daeae9f1962fe408495f786c2d29098e7b13b36b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/daeae9f1962fe408495f786c2d29098e7b13b36b"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "2d3aa8f620550e84cce2638569cca7b9d436d555", "filename": "libgo/mksysinfo.sh", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dd1628807a800c86b45495218cb19260bae8a846/libgo%2Fmksysinfo.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dd1628807a800c86b45495218cb19260bae8a846/libgo%2Fmksysinfo.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fmksysinfo.sh?ref=dd1628807a800c86b45495218cb19260bae8a846", "patch": "@@ -89,6 +89,15 @@ cat > sysinfo.c <<EOF\n #if defined(HAVE_NET_IF_H)\n #include <net/if.h>\n #endif\n+\n+/* Constants that may only be defined as expressions on some systems,\n+   expressions too complex for -fdump-go-spec to handle.  These are\n+   handled specially below.  */\n+enum {\n+#ifdef TIOCGWINSZ\n+  TIOCGWINSZ_val = TIOCGWINSZ,\n+#endif\n+};\n EOF\n \n ${CC} -fdump-go-spec=gen-sysinfo.go -std=gnu99 -S -o sysinfo.s sysinfo.c\n@@ -524,7 +533,14 @@ grep '^type _passwd ' gen-sysinfo.go | \\\n \n # The ioctl flags for the controlling TTY.\n grep '^const _TIOC' gen-sysinfo.go | \\\n+    grep -v '_val =' | \\\n     sed -e 's/^\\(const \\)_\\(TIOC[^= ]*\\)\\(.*\\)$/\\1\\2 = _\\2/' >> ${OUT}\n+# We need TIOCGWINSZ.\n+if ! grep '^const TIOCGWINSZ' ${OUT} >/dev/null 2>&1; then\n+  if grep '^const _TIOCGWINSZ_val' ${OUT} >/dev/null 2>&1; then\n+    echo 'const TIOCGWINSZ = TIOCGWINSZ_val' >> ${OUT}\n+  fi\n+fi\n \n # The ioctl flags for terminal control\n grep '^const _TC[GS]ET' gen-sysinfo.go | \\"}]}