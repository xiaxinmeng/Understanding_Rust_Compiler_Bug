{"sha": "537a2904e71f46dce47e2cbcd5b90b59b974568f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTM3YTI5MDRlNzFmNDZkY2U0N2UyY2JjZDViOTBiNTliOTc0NTY4Zg==", "commit": {"author": {"name": "Devang Patel", "email": "dpatel@apple.com", "date": "2005-03-05T02:59:25Z"}, "committer": {"name": "Devang Patel", "email": "dpatel@gcc.gnu.org", "date": "2005-03-05T02:59:25Z"}, "message": "re PR tree-optimization/18815 (Tree if-conversion screws up cfg very badly)\n\n       PR tree-optimization/18815\n       * tree-if-conv.c (combine_blocks): Adjust loop header edges for\n       loops with zero exit edges.\n\nFrom-SVN: r95923", "tree": {"sha": "4522297f7e571484534190b847a0f058c3f5bd80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4522297f7e571484534190b847a0f058c3f5bd80"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/537a2904e71f46dce47e2cbcd5b90b59b974568f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/537a2904e71f46dce47e2cbcd5b90b59b974568f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/537a2904e71f46dce47e2cbcd5b90b59b974568f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/537a2904e71f46dce47e2cbcd5b90b59b974568f/comments", "author": null, "committer": null, "parents": [{"sha": "c533f56b23e374e2cc15f704408f61c57915b091", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c533f56b23e374e2cc15f704408f61c57915b091", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c533f56b23e374e2cc15f704408f61c57915b091"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "22615e178d6ab8497897a2e6c1b9229db4525e0d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/537a2904e71f46dce47e2cbcd5b90b59b974568f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/537a2904e71f46dce47e2cbcd5b90b59b974568f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=537a2904e71f46dce47e2cbcd5b90b59b974568f", "patch": "@@ -1,3 +1,9 @@\n+2005-03-04  Devang Patel  <dpatel@apple.com>\n+\t\n+\tPR tree-optimization/18815\n+\t* tree-if-conv.c (combine_blocks): Adjust loop header edges for\n+\tloops with zero exit edges.\n+\n 2005-03-04  Devang Patel  <dpatel@apple.com>\n \n \t* doc/invoke.texi: Remove reference to webpage that does not exist."}, {"sha": "ef9dc574ce1621e6e3eb4262ee3997787a716052", "filename": "gcc/tree-if-conv.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/537a2904e71f46dce47e2cbcd5b90b59b974568f/gcc%2Ftree-if-conv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/537a2904e71f46dce47e2cbcd5b90b59b974568f/gcc%2Ftree-if-conv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-if-conv.c?ref=537a2904e71f46dce47e2cbcd5b90b59b974568f", "patch": "@@ -858,7 +858,8 @@ combine_blocks (struct loop *loop)\n   basic_block bb, exit_bb, merge_target_bb;\n   unsigned int orig_loop_num_nodes = loop->num_nodes;\n   unsigned int i;\n-\n+  unsigned int n_exits;\n+  edge *exits = get_loop_exit_edges (loop, &n_exits);\n   /* Process phi nodes to prepare blocks for merge.  */\n   process_phi_nodes (loop);\n \n@@ -905,11 +906,23 @@ combine_blocks (struct loop *loop)\n \tcontinue;\n \n       /* It is time to remove this basic block.\t First remove edges.  */\n-      while (EDGE_COUNT (bb->succs) > 0)\n-\tremove_edge (EDGE_SUCC (bb, 0));\n       while (EDGE_COUNT (bb->preds) > 0)\n \tremove_edge (EDGE_PRED (bb, 0));\n \n+      /* This is loop latch and loop does not have exit then do not\n+ \t delete this basic block. Just remove its PREDS and reconnect \n+ \t loop->header and loop->latch blocks.  */\n+      if (bb == loop->latch && n_exits == 0)\n+ \t{\n+\t  exits = NULL; /* To suppress unused warning.  */\n+ \t  make_edge (loop->header, loop->latch, EDGE_FALLTHRU);\n+ \t  set_immediate_dominator (CDI_DOMINATORS, loop->latch, loop->header);\n+\t  continue;\n+ \t}\n+\n+      while (EDGE_COUNT (bb->succs) > 0)\n+\tremove_edge (EDGE_SUCC (bb, 0));\n+\n       /* Remove labels and make stmts member of loop->header.  */\n       for (bsi = bsi_start (bb); !bsi_end_p (bsi); )\n \t{"}]}