{"sha": "7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2VjNGYzNDM4Y2QzZmM3YTgzYTMyZDZjOWI5MTBiMjZhMjIwMzc2ZQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2015-12-23T14:47:39Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2015-12-23T14:47:39Z"}, "message": "alias.c (compare_base_decls): Simplify in-symtab check.\n\n\tgcc/\n\t* alias.c (compare_base_decls): Simplify in-symtab check.\n\t* cgraph.h (decl_in_symtab_p): Check DECL_IN_CONSTANT_POOL.\n\n\ttestsuite/\n\t* gcc.dg/alias-15.c: New.\n\nFrom-SVN: r231928", "tree": {"sha": "23ff2500b938c7cf94d14dd55668e27574e466b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/23ff2500b938c7cf94d14dd55668e27574e466b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "986e29bc6a3df0269268d7045058049beb26e1cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/986e29bc6a3df0269268d7045058049beb26e1cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/986e29bc6a3df0269268d7045058049beb26e1cb"}], "stats": {"total": 39, "additions": 34, "deletions": 5}, "files": [{"sha": "e789c11c8ece61ff0498d60b07bfc5d4c320f5e9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "patch": "@@ -1,3 +1,8 @@\n+2015-12-23  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* alias.c (compare_base_decls): Simplify in-symtab check.\n+\t* cgraph.h (decl_in_symtab_p): Check DECL_IN_CONSTANT_POOL.\n+\n 2015-12-23  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n \n \t* config/s390/predicates.md (\"larl_operand\"): Remove now superfluous"}, {"sha": "42a974a5970e4dbf7a93351e0e468500ff7623b3", "filename": "gcc/alias.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Falias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Falias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Falias.c?ref=7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "patch": "@@ -2038,13 +2038,12 @@ compare_base_decls (tree base1, tree base2)\n   if (base1 == base2)\n     return 1;\n \n-  bool in_symtab1 = decl_in_symtab_p (base1);\n-  bool in_symtab2 = decl_in_symtab_p (base2);\n-\n   /* Declarations of non-automatic variables may have aliases.  All other\n      decls are unique.  */\n-  if (in_symtab1 != in_symtab2 || !in_symtab1)\n+  if (!decl_in_symtab_p (base1)\n+      || !decl_in_symtab_p (base2))\n     return 0;\n+\n   ret = symtab_node::get_create (base1)->equal_address_to\n \t\t (symtab_node::get_create (base2), true);\n   if (ret == 2)"}, {"sha": "fe7c1940c4e1d86126270f9bf4cb7998aad7198c", "filename": "gcc/cgraph.h", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Fcgraph.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Fcgraph.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.h?ref=7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "patch": "@@ -2294,13 +2294,19 @@ symtab_node::real_symbol_p (void)\n }\n \n /* Return true if DECL should have entry in symbol table if used.\n-   Those are functions and static & external veriables*/\n+   Those are functions and static & external non-constpool variables.\n+   We do not expect constant pool variables in the varpool, as they're\n+   not related to other variables, and simply lazily inserting them\n+   using the regular interface results in varpool thinking they are\n+   externally provided -- which results in erroneous assembly emission\n+   as an undefined decl.  */\n \n static inline bool\n decl_in_symtab_p (const_tree decl)\n {\n   return (TREE_CODE (decl) == FUNCTION_DECL\n           || (TREE_CODE (decl) == VAR_DECL\n+\t      && !DECL_IN_CONSTANT_POOL (decl)\n \t      && (TREE_STATIC (decl) || DECL_EXTERNAL (decl))));\n }\n "}, {"sha": "79a1827e66562eea20f767ea7cd504bbb1bd9d73", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "patch": "@@ -1,3 +1,7 @@\n+2015-12-23  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* gcc.dg/alias-15.c: New. \n+\n 2015-12-23  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* g++.dg/dg.exp (tests): Prune \"goacc/*\" and \"goacc-gomp/*\" files."}, {"sha": "0a8e69b61eceef95e61f16d7874b5a4204e0594f", "filename": "gcc/testsuite/gcc.dg/alias-15.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Ftestsuite%2Fgcc.dg%2Falias-15.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ec4f3438cd3fc7a83a32d6c9b910b26a220376e/gcc%2Ftestsuite%2Fgcc.dg%2Falias-15.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Falias-15.c?ref=7ec4f3438cd3fc7a83a32d6c9b910b26a220376e", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-additional-options  \"-O2 -fdump-ipa-cgraph\" } */\n+\n+/* RTL-level CSE shouldn't introduce LCO (for the string) into varpool */\n+char *p;\n+\n+void foo ()\n+{\n+  p = \"abc\\n\";\n+\n+  while (*p != '\\n')\n+    p++;\n+}\n+\n+/* { dg-final { scan-ipa-dump-not \"LC0\" \"cgraph\" } } */"}]}