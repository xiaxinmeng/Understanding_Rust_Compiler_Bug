{"sha": "b6f36bf8c74b6341566254227d2ac425bf4a54fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZmMzZiZjhjNzRiNjM0MTU2NjI1NDIyN2QyYWM0MjViZjRhNTRmYw==", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2014-01-22T16:40:30Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-01-22T16:40:30Z"}, "message": "errout.adb (Initialize): Remove trick to add dummy entry in Warnings table.\n\n2014-01-22  Yannick Moy  <moy@adacore.com>\n\n\t* errout.adb (Initialize): Remove trick to add dummy entry\n\tin Warnings table.\n\t* erroutc.adb (Set_Warnings_Mode_Off,\n\tSet_Warnings_Mode_On): Do nothing if warnings are suppressed by\n\tcommand line switch.\n\t* opt.ads (Warning_Mode): Document behavior\n\twrt pragma Warnings, in normal mode and in GNATprove_Mode.\n\nFrom-SVN: r206927", "tree": {"sha": "e4e358524c0e589fd68c4c477f70eef63aed11c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e4e358524c0e589fd68c4c477f70eef63aed11c4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6f36bf8c74b6341566254227d2ac425bf4a54fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6f36bf8c74b6341566254227d2ac425bf4a54fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6f36bf8c74b6341566254227d2ac425bf4a54fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6f36bf8c74b6341566254227d2ac425bf4a54fc/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6aadc94289c763ea858dc511908279ab3af0f43e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6aadc94289c763ea858dc511908279ab3af0f43e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6aadc94289c763ea858dc511908279ab3af0f43e"}], "stats": {"total": 62, "additions": 37, "deletions": 25}, "files": [{"sha": "1cb84d207be6d8b5a424824936ff36a5193f72e4", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b6f36bf8c74b6341566254227d2ac425bf4a54fc", "patch": "@@ -1,3 +1,13 @@\n+2014-01-22  Yannick Moy  <moy@adacore.com>\n+\n+\t* errout.adb (Initialize): Remove trick to add dummy entry\n+\tin Warnings table.\n+\t* erroutc.adb (Set_Warnings_Mode_Off,\n+\tSet_Warnings_Mode_On): Do nothing if warnings are suppressed by\n+\tcommand line switch.\n+\t* opt.ads (Warning_Mode): Document behavior\n+\twrt pragma Warnings, in normal mode and in GNATprove_Mode.\n+\n 2014-01-22  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_ch3.adb, errout.adb, erroutc.adb: Minor reformatting."}, {"sha": "f3469364c82546b4bd6c0adb7b713915d2f85ef2", "filename": "gcc/ada/errout.adb", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2Ferrout.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2Ferrout.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferrout.adb?ref=b6f36bf8c74b6341566254227d2ac425bf4a54fc", "patch": "@@ -1503,18 +1503,6 @@ package body Errout is\n \n       Warnings.Init;\n       Specific_Warnings.Init;\n-\n-      --  As an optimization, if all warnings are suppressed, we supply an\n-      --  initial dummy entry covering all possible source locations, which\n-      --  avoids taking into account pragma Warnings in the source. In\n-      --  GNATprove_Mode, this optimization is disabled, as we rely on\n-      --  the Warnings table to be correctly filled for use of the warning\n-      --  mechanism for gnatprove itself.\n-\n-      if not GNATprove_Mode and then Warning_Mode = Suppress then\n-         Warnings.Append\n-           ((Start => Source_Ptr'First, Stop => Source_Ptr'Last));\n-      end if;\n    end Initialize;\n \n    -----------------"}, {"sha": "d5497d6da6b885cc87600597473e991bf2a5a306", "filename": "gcc/ada/erroutc.adb", "status": "modified", "additions": 22, "deletions": 11, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2Ferroutc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2Ferroutc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Ferroutc.adb?ref=b6f36bf8c74b6341566254227d2ac425bf4a54fc", "patch": "@@ -1172,11 +1172,19 @@ package body Erroutc is\n          return;\n       end if;\n \n+      --  If all warnings are suppressed by command line switch, this can\n+      --  be ignored, unless we are in GNATprove_Mode which requires pragma\n+      --  Warnings to be stored for the formal verification backend.\n+\n+      if Warning_Mode = Suppress\n+        and then not GNATprove_Mode\n+      then\n+         return;\n+\n       --  If last entry in table already covers us, this is a redundant pragma\n-      --  Warnings (Off) and can be ignored. This also handles the case where\n-      --  all warnings are suppressed by command line switch.\n+      --  Warnings (Off) and can be ignored.\n \n-      if Warnings.Last >= Warnings.First\n+      elsif Warnings.Last >= Warnings.First\n         and then Warnings.Table (Warnings.Last).Start <= Loc\n         and then Loc <= Warnings.Table (Warnings.Last).Stop\n       then\n@@ -1207,20 +1215,23 @@ package body Erroutc is\n          return;\n       end if;\n \n+      --  If all warnings are suppressed by command line switch, this can\n+      --  be ignored, unless we are in GNATprove_Mode which requires pragma\n+      --  Warnings to be stored for the formal verification backend.\n+\n+      if Warning_Mode = Suppress\n+        and then not GNATprove_Mode\n+      then\n+         return;\n+\n       --  If the last entry in the warnings table covers this pragma, then\n       --  we adjust the end point appropriately.\n \n-      if Warnings.Last >= Warnings.First\n+      elsif Warnings.Last >= Warnings.First\n         and then Warnings.Table (Warnings.Last).Start <= Loc\n         and then Loc <= Warnings.Table (Warnings.Last).Stop\n       then\n-         --  We can normally skip this adjustment if we are suppressing all\n-         --  warnings, but we do want to do it in gnatprove mode even then,\n-         --  since we use the warning mechanism in gnatprove itself.\n-\n-         if Warning_Mode /= Suppress or else GNATprove_Mode then\n-            Warnings.Table (Warnings.Last).Stop := Loc;\n-         end if;\n+         Warnings.Table (Warnings.Last).Stop := Loc;\n       end if;\n    end Set_Warnings_Mode_On;\n "}, {"sha": "f6177eb52ee0a4aa0250f323a6bb9cd6599a9cf0", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6f36bf8c74b6341566254227d2ac425bf4a54fc/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=b6f36bf8c74b6341566254227d2ac425bf4a54fc", "patch": "@@ -1737,8 +1737,11 @@ package Opt is\n    --  GNAT, GNATBIND\n    --  Controls treatment of warning messages. If set to Suppress, warning\n    --  messages are not generated at all. In Normal mode, they are generated\n-   --  but do not count as errors. In Treat_As_Error mode, warning messages\n-   --  are generated and are treated as errors.\n+   --  but do not count as errors. In Treat_As_Error mode, warning messages are\n+   --  generated and are treated as errors. Note that Warning_Mode = Suppress\n+   --  causes pragma Warnings to be ignored (except for legality checks),\n+   --  unless we are in GNATprove_Mode, which requires pragma Warnings to\n+   --  be stored for the formal verification backend.\n \n    Wide_Character_Encoding_Method : WC_Encoding_Method := WCEM_Brackets;\n    --  GNAT, GNATBIND"}]}