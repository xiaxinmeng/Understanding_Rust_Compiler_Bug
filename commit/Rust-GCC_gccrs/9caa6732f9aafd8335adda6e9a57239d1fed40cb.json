{"sha": "9caa6732f9aafd8335adda6e9a57239d1fed40cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWNhYTY3MzJmOWFhZmQ4MzM1YWRkYTZlOWE1NzIzOWQxZmVkNDBjYg==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2018-11-29T05:03:01Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2018-11-29T05:03:01Z"}, "message": "[RS6000] PR11848 rs6000_emit_move long double split\n\nThis split is disabled for power7 and up, so we don't often see its\nbad effects.  However, on a powerpc-linux compiler (which defaults\nto PPC750 judging from rs6000/sysv4.h) we see\n\n\tlong double ld1 (void) { return 1.0L; }\n\ncompiled with -msoft-float -O2 -S resulting in\n\n\tld1:\n\t\tli 3,0\n\t\tli 4,0\n\t\tmr 6,4\n\t\tmr 5,3\n\t\tli 4,0\n\t\tlis 3,0x3ff0\n\t\tblr\n\nThings go awry in init-regs, with the TFmode reg being initialized to\nzero on seeing the subreg from the split.  (And that initialization\nitself is split by rs6000_emit_move!)  Later passes apparently don't\nclean up the rubbish.\n\nSince the split was added for Darwin (as the comment says), let's get\nrid of it on other targets.\n\n\t* config/rs6000/rs6000.c (rs6000_emit_move): Disable long\n\tdouble split for targets other than Darwin.\n\nFrom-SVN: r266610", "tree": {"sha": "ed29d449b143f1be411ef19248beb085ebf1cf11", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed29d449b143f1be411ef19248beb085ebf1cf11"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9caa6732f9aafd8335adda6e9a57239d1fed40cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9caa6732f9aafd8335adda6e9a57239d1fed40cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9caa6732f9aafd8335adda6e9a57239d1fed40cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9caa6732f9aafd8335adda6e9a57239d1fed40cb/comments", "author": null, "committer": null, "parents": [{"sha": "aa74f2217d0686788889d357c46d666fcb8be87f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa74f2217d0686788889d357c46d666fcb8be87f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa74f2217d0686788889d357c46d666fcb8be87f"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "36b1b2baa8b4318a9080d5b8d9d74b884e330ced", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9caa6732f9aafd8335adda6e9a57239d1fed40cb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9caa6732f9aafd8335adda6e9a57239d1fed40cb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9caa6732f9aafd8335adda6e9a57239d1fed40cb", "patch": "@@ -1,3 +1,8 @@\n+2018-11-29  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_emit_move): Disable long\n+\tdouble split for targets other than Darwin.\n+\n 2018-11-29  Alan Modra  <amodra@gmail.com>\n \n \t* config/rs6000/rs6000.md (movdi_internal64): Correct lengths.\n@@ -692,7 +697,7 @@\n \n 2018-11-23  Christoph Muellner  <christoph.muellner@theobroma-systems.com>\n \n-        * config/aarch64/aarch64-cores.def: Define emag.\n+\t* config/aarch64/aarch64-cores.def: Define emag.\n \t* config/aarch64/aarch64-tune.md: Regenerated with emag.\n \t* config/aarch64/aarch64.c (emag_tunings): New struct.\n \t* doc/invoke.texi: Document mtune value."}, {"sha": "d986207a0c6528c119efa0ffe93a58d0cb2c73d7", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9caa6732f9aafd8335adda6e9a57239d1fed40cb/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9caa6732f9aafd8335adda6e9a57239d1fed40cb/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=9caa6732f9aafd8335adda6e9a57239d1fed40cb", "patch": "@@ -9967,8 +9967,8 @@ rs6000_emit_move (rtx dest, rtx source, machine_mode mode)\n   /* 128-bit constant floating-point values on Darwin should really be loaded\n      as two parts.  However, this premature splitting is a problem when DFmode\n      values can go into Altivec registers.  */\n-  if (FLOAT128_IBM_P (mode) && !reg_addr[DFmode].scalar_in_vmx_p\n-      && GET_CODE (operands[1]) == CONST_DOUBLE)\n+  if (TARGET_MACHO && CONST_DOUBLE_P (operands[1]) && FLOAT128_IBM_P (mode)\n+      && !reg_addr[DFmode].scalar_in_vmx_p)\n     {\n       rs6000_emit_move (simplify_gen_subreg (DFmode, operands[0], mode, 0),\n \t\t\tsimplify_gen_subreg (DFmode, operands[1], mode, 0),"}]}