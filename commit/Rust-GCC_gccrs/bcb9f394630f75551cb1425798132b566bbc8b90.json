{"sha": "bcb9f394630f75551cb1425798132b566bbc8b90", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmNiOWYzOTQ2MzBmNzU1NTFjYjE0MjU3OTgxMzJiNTY2YmJjOGI5MA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2013-06-11T14:58:55Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-06-11T14:58:55Z"}, "message": "re PR fortran/57535 ([OOP] ICE when allocating a CLASS function-result variable)\n\n2013-06-11  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/57535\n        * trans-array.c (build_class_array_ref): Fix ICE for\n        function result variables.\n\n2013-06-11  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/57535\n        * gfortran.dg/class_array_18.f90: New.\n\nFrom-SVN: r199958", "tree": {"sha": "723677dd37685cf87d748a7f17c9b0bb3f83315f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/723677dd37685cf87d748a7f17c9b0bb3f83315f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bcb9f394630f75551cb1425798132b566bbc8b90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcb9f394630f75551cb1425798132b566bbc8b90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bcb9f394630f75551cb1425798132b566bbc8b90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bcb9f394630f75551cb1425798132b566bbc8b90/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dca61c7e6194d0f2942ced148e17bb05f688124c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dca61c7e6194d0f2942ced148e17bb05f688124c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dca61c7e6194d0f2942ced148e17bb05f688124c"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "6b37acd72fca0191d660684464c289608f743f04", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=bcb9f394630f75551cb1425798132b566bbc8b90", "patch": "@@ -1,3 +1,9 @@\n+2013-06-11  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/57535\n+\t* trans-array.c (build_class_array_ref): Fix ICE for\n+\tfunction result variables.\n+\n 2013-06-08  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/37336"}, {"sha": "a4321cc3e26bec17533e1c56b6463d7e277e2c1e", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=bcb9f394630f75551cb1425798132b566bbc8b90", "patch": "@@ -2991,7 +2991,13 @@ build_class_array_ref (gfc_se *se, tree base, tree index)\n   if (ts == NULL)\n     return false;\n \n-  if (class_ref == NULL)\n+  if (class_ref == NULL && expr->symtree->n.sym->attr.function\n+      && expr->symtree->n.sym == expr->symtree->n.sym->result)\n+    {\n+      gcc_assert (expr->symtree->n.sym->backend_decl == current_function_decl);\n+      decl = gfc_get_fake_result_decl (expr->symtree->n.sym, 0);\n+    }\n+  else if (class_ref == NULL)\n     decl = expr->symtree->n.sym->backend_decl;\n   else\n     {"}, {"sha": "bb98acad68875440387b0d7f53cd591e9d3631ac", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bcb9f394630f75551cb1425798132b566bbc8b90", "patch": "@@ -1,3 +1,8 @@\n+2013-06-11  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/57535\n+\t* gfortran.dg/class_array_18.f90: New.\n+\n 2013-06-11  Jan Hubicka  <jh@suse.cz>\n \n \tPR c++/57551"}, {"sha": "5f2f3dee7f221e59b1b5c1b4ffee8968b1efe4c9", "filename": "gcc/testsuite/gfortran.dg/class_array_18.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_array_18.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bcb9f394630f75551cb1425798132b566bbc8b90/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_array_18.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fclass_array_18.f90?ref=bcb9f394630f75551cb1425798132b566bbc8b90", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do compile }\n+!\n+! PR fortran/57535\n+!\n+program test\n+  implicit none\n+  type t\n+    integer :: ii = 55\n+  end type t\n+contains\n+  function func2()\n+    class(t), allocatable :: func2(:)\n+    allocate(func2(3))\n+    func2%ii = [111,222,333]\n+  end function func2\n+end program test"}]}