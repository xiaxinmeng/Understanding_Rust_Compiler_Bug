{"sha": "9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWJmM2M5Y2M2ZDM4Njc1MjM3MDZhYzc4ZGM0M2MyOTllYWMyZmJhMQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-04-22T17:35:44Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-04-22T17:35:44Z"}, "message": "hashtab.c: Include limits.h, stdint.h, ansidecl.h.\n\n        * hashtab.c: Include limits.h, stdint.h, ansidecl.h.\n        (CHAR_BIT): Provide default.\n        (struct prime_ent, prime_tab): New.\n        (higher_prime_index): Rename from higher_prime_number, return index.\n        (htab_mod_1): New.\n        (htab_mod, htab_mod_m2): Use it.\n        (htab_create_alloc, htab_create_alloc_ex): Store prime index.\n        (htab_expand): Likewise.\n        * configure.ac: Check for stdint.h.\n        (UNSIGNED_64BIT_TYPE): New define and checks to fill it in.\n        * config.in, configure: Rebuild.\n\nFrom-SVN: r81029", "tree": {"sha": "733f68fca344b1fa54470ad459e7919a521e2cfb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/733f68fca344b1fa54470ad459e7919a521e2cfb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/comments", "author": null, "committer": null, "parents": [{"sha": "a95cd5a0d46e37922e5a0c5eb4cd4d22bc21da29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a95cd5a0d46e37922e5a0c5eb4cd4d22bc21da29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a95cd5a0d46e37922e5a0c5eb4cd4d22bc21da29"}], "stats": {"total": 553, "additions": 425, "deletions": 128}, "files": [{"sha": "78e8386617c41f915396bc07b28622753a2aa287", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "patch": "@@ -1,3 +1,17 @@\n+2004-04-22  Richard Henderson  <rth@redhat.com>\n+\n+\t* hashtab.c: Include limits.h, stdint.h, ansidecl.h.\n+\t(CHAR_BIT): Provide default.\n+\t(struct prime_ent, prime_tab): New.\n+\t(higher_prime_index): Rename from higher_prime_number, return index.\n+\t(htab_mod_1): New.\n+\t(htab_mod, htab_mod_m2): Use it.\n+\t(htab_create_alloc, htab_create_alloc_ex): Store prime index.\n+\t(htab_expand): Likewise.\n+\t* configure.ac: Check for stdint.h.\n+\t(UNSIGNED_64BIT_TYPE): New define and checks to fill it in.\n+\t* config.in, configure: Rebuild.\n+\n 2004-04-13  Ian Lance Taylor  <ian@wasabisystems.com>\n \n \t* strerror.c: Include config.h, and redefine sys_nerr and"}, {"sha": "3cce9aa19794c2841bca0e4690a338a4814f517b", "filename": "libiberty/config.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfig.in?ref=9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "patch": "@@ -353,6 +353,9 @@\n /* Define to 1 if you can safely include both <sys/time.h> and <time.h>. */\n #undef TIME_WITH_SYS_TIME\n \n+/* Define to an unsigned 64-bit type available in the compiler. */\n+#undef UNSIGNED_64BIT_TYPE\n+\n /* whether byteorder is bigendian */\n #undef WORDS_BIGENDIAN\n "}, {"sha": "8a09439ce86ccf245fd85402957e1daebf299333", "filename": "libiberty/configure", "status": "modified", "additions": 202, "deletions": 65, "changes": 267, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfigure?ref=9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "patch": "@@ -957,7 +957,7 @@ esac\n     else\n       echo \"$as_me: WARNING: no configuration information is in $ac_dir\" >&2\n     fi\n-    cd $ac_popdir\n+    cd \"$ac_popdir\"\n   done\n fi\n \n@@ -1304,6 +1304,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n \n \n \n+\n \n # This works around the fact that libtool configuration may change LD\n # for this particular configuration, but some shells, instead of\n@@ -2329,8 +2330,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -2388,8 +2388,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -2505,8 +2504,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -2560,8 +2558,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -2606,8 +2603,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -2651,8 +2647,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3108,8 +3103,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3169,8 +3163,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3246,8 +3239,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3288,8 +3280,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3538,7 +3529,8 @@ host_makefile_frag=${frag}\n \n \n \n-for ac_header in sys/file.h sys/param.h limits.h stdlib.h malloc.h string.h unistd.h strings.h sys/time.h time.h sys/resource.h sys/stat.h sys/mman.h fcntl.h alloca.h sys/pstat.h sys/sysmp.h sys/sysinfo.h machine/hal_sysinfo.h sys/table.h sys/sysctl.h sys/systemcfg.h\n+\n+for ac_header in sys/file.h sys/param.h limits.h stdlib.h malloc.h string.h unistd.h strings.h sys/time.h time.h sys/resource.h sys/stat.h sys/mman.h fcntl.h alloca.h sys/pstat.h sys/sysmp.h sys/sysinfo.h machine/hal_sysinfo.h sys/table.h sys/sysctl.h sys/systemcfg.h stdint.h\n do\n as_ac_Header=`echo \"ac_cv_header_$ac_header\" | $as_tr_sh`\n echo \"$as_me:$LINENO: checking for $ac_header\" >&5\n@@ -3630,8 +3622,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3695,8 +3686,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3757,8 +3747,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -3838,8 +3827,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -4068,8 +4056,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -4102,6 +4089,167 @@ _ACEOF\n \n fi\n \n+\n+# Look for a 64-bit type.\n+echo \"$as_me:$LINENO: checking for a 64-bit type\" >&5\n+echo $ECHO_N \"checking for a 64-bit type... $ECHO_C\" >&6\n+if test \"${liberty_cv_uint64+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+else\n+  cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#ifdef HAVE_STDINT_H\n+#include <stdint.h>\n+#endif\n+int\n+main ()\n+{\n+extern uint64_t foo;\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest.$ac_objext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  liberty_cv_uint64=uint64_t\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#ifdef HAVE_LIMITS_H\n+#include <limits.h>\n+#endif\n+#ifndef CHAR_BIT\n+#define CHAR_BIT 8\n+#endif\n+int\n+main ()\n+{\n+extern char foo[sizeof(long) * CHAR_BIT >= 64 ? 1 : -1];\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest.$ac_objext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  liberty_cv_uint64=\"unsigned long\"\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#ifdef HAVE_LIMITS_H\n+#include <limits.h>\n+#endif\n+#ifndef CHAR_BIT\n+#define CHAR_BIT 8\n+#endif\n+int\n+main ()\n+{\n+extern char foo[sizeof(long long) * CHAR_BIT >= 64 ? 1 : -1];\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest.$ac_objext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  liberty_cv_uint64=\"unsigned long long\"\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+liberty_cv_uint64=none\n+fi\n+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+fi\n+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+fi\n+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+fi\n+\n+echo \"$as_me:$LINENO: result: $liberty_cv_uint64\" >&5\n+echo \"${ECHO_T}$liberty_cv_uint64\" >&6\n+if test \"$liberty_cv_uint64\" != none; then\n+\n+cat >>confdefs.h <<\\_ACEOF\n+#define HAVE_64BIT_TYPE $liberty_cv_uint64\n+_ACEOF\n+\n+fi\n+\n # Given the above check, we always have uintptr_t or a fallback\n # definition.  So define HAVE_UINTPTR_T in case any imported code\n # relies on it.\n@@ -4143,8 +4291,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -4377,8 +4524,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -4792,8 +4938,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -4852,8 +4997,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -4953,8 +5097,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -5092,8 +5235,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -5314,8 +5456,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -5660,8 +5801,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -5772,8 +5912,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -5842,8 +5981,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -5908,8 +6046,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -6005,8 +6142,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -6082,8 +6218,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -6256,8 +6391,7 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   cat conftest.err >&5\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n   { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n   (eval $ac_try) 2>&5\n   ac_status=$?\n@@ -6601,7 +6735,9 @@ LIBOBJS=\"$L\"\n \n # We need multilib support, but only if configuring for the target.\n                     ac_config_files=\"$ac_config_files Makefile testsuite/Makefile\"\n+\n           ac_config_commands=\"$ac_config_commands default\"\n+\n cat >confcache <<\\_ACEOF\n # This file is a shell script that caches the results of configure\n # tests run on this system so they can be shared between configure\n@@ -7444,11 +7580,6 @@ esac\n   *) ac_INSTALL=$ac_top_builddir$INSTALL ;;\n   esac\n \n-  if test x\"$ac_file\" != x-; then\n-    { echo \"$as_me:$LINENO: creating $ac_file\" >&5\n-echo \"$as_me: creating $ac_file\" >&6;}\n-    rm -f \"$ac_file\"\n-  fi\n   # Let's still pretend it is `configure' which instantiates (i.e., don't\n   # use $as_me), people would be surprised to read:\n   #    /* config.h.  Generated by config.status.  */\n@@ -7487,6 +7618,12 @@ echo \"$as_me: error: cannot find input file: $f\" >&2;}\n \t fi;;\n       esac\n     done` || { (exit 1); exit 1; }\n+\n+  if test x\"$ac_file\" != x-; then\n+    { echo \"$as_me:$LINENO: creating $ac_file\" >&5\n+echo \"$as_me: creating $ac_file\" >&6;}\n+    rm -f \"$ac_file\"\n+  fi\n _ACEOF\n cat >>$CONFIG_STATUS <<_ACEOF\n   sed \"$ac_vpsub"}, {"sha": "124558a20a5497a4f44850368e24b608abbccb62", "filename": "libiberty/configure.ac", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fconfigure.ac?ref=9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "patch": "@@ -159,13 +159,47 @@ AC_SUBST_FILE(host_makefile_frag)\n # It's OK to check for header files.  Although the compiler may not be\n # able to link anything, it had better be able to at least compile\n # something.\n-AC_CHECK_HEADERS(sys/file.h sys/param.h limits.h stdlib.h malloc.h string.h unistd.h strings.h sys/time.h time.h sys/resource.h sys/stat.h sys/mman.h fcntl.h alloca.h sys/pstat.h sys/sysmp.h sys/sysinfo.h machine/hal_sysinfo.h sys/table.h sys/sysctl.h sys/systemcfg.h)\n+AC_CHECK_HEADERS(sys/file.h sys/param.h limits.h stdlib.h malloc.h string.h unistd.h strings.h sys/time.h time.h sys/resource.h sys/stat.h sys/mman.h fcntl.h alloca.h sys/pstat.h sys/sysmp.h sys/sysinfo.h machine/hal_sysinfo.h sys/table.h sys/sysctl.h sys/systemcfg.h stdint.h)\n AC_HEADER_SYS_WAIT\n AC_HEADER_TIME\n \n libiberty_AC_DECLARE_ERRNO\n \n AC_CHECK_TYPE(uintptr_t, unsigned long)\n+\n+# Look for a 64-bit type.\n+AC_MSG_CHECKING([for a 64-bit type])\n+AC_CACHE_VAL(liberty_cv_uint64,\n+[AC_TRY_COMPILE(\n+[#ifdef HAVE_STDINT_H\n+#include <stdint.h>\n+#endif],\n+[extern uint64_t foo;],\n+liberty_cv_uint64=uint64_t,\n+[AC_TRY_COMPILE(\n+[#ifdef HAVE_LIMITS_H\n+#include <limits.h>\n+#endif\n+#ifndef CHAR_BIT\n+#define CHAR_BIT 8\n+#endif],\n+[extern char foo[sizeof(long) * CHAR_BIT >= 64 ? 1 : -1];],\n+liberty_cv_uint64=\"unsigned long\",\n+[AC_TRY_COMPILE(\n+[#ifdef HAVE_LIMITS_H\n+#include <limits.h>\n+#endif\n+#ifndef CHAR_BIT\n+#define CHAR_BIT 8\n+#endif],\n+[extern char foo[sizeof(long long) * CHAR_BIT >= 64 ? 1 : -1];],\n+liberty_cv_uint64=\"unsigned long long\", liberty_cv_uint64=none)])])])\n+AC_MSG_RESULT($liberty_cv_uint64)\n+if test \"$liberty_cv_uint64\" != none; then\n+  AC_DEFINE(UNSIGNED_64BIT_TYPE, $liberty_cv_uint64,\n+            [Define to an unsigned 64-bit type available in the compiler.])\n+fi\n+\n # Given the above check, we always have uintptr_t or a fallback\n # definition.  So define HAVE_UINTPTR_T in case any imported code\n # relies on it."}, {"sha": "6e7a44b9c91d2865be3a6b4ba0e3eb43b81314b8", "filename": "libiberty/hashtab.c", "status": "modified", "additions": 171, "deletions": 62, "changes": 233, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fhashtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9bf3c9cc6d3867523706ac78dc43c299eac2fba1/libiberty%2Fhashtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fhashtab.c?ref=9bf3c9cc6d3867523706ac78dc43c299eac2fba1", "patch": "@@ -1,5 +1,6 @@\n /* An expandable hash tables datatype.  \n-   Copyright (C) 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n+   Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004\n+   Free Software Foundation, Inc.\n    Contributed by Vladimir Makarov (vmakarov@cygnus.com).\n \n This file is part of the libiberty library.\n@@ -40,20 +41,29 @@ Boston, MA 02111-1307, USA.  */\n #ifdef HAVE_STDLIB_H\n #include <stdlib.h>\n #endif\n-\n #ifdef HAVE_STRING_H\n #include <string.h>\n #endif\n-\n #ifdef HAVE_MALLOC_H\n #include <malloc.h>\n #endif\n+#ifdef HAVE_LIMITS_H\n+#include <limits.h>\n+#endif\n+#ifdef HAVE_STDINT_H\n+#include <stdint.h>\n+#endif\n \n #include <stdio.h>\n \n #include \"libiberty.h\"\n+#include \"ansidecl.h\"\n #include \"hashtab.h\"\n \n+#ifndef CHAR_BIT\n+#define CHAR_BIT 8\n+#endif\n+\n /* This macro defines reserved value for empty table entry. */\n \n #define EMPTY_ENTRY    ((PTR) 0)\n@@ -63,7 +73,10 @@ Boston, MA 02111-1307, USA.  */\n \n #define DELETED_ENTRY  ((PTR) 1)\n \n-static unsigned long higher_prime_number PARAMS ((unsigned long));\n+static unsigned int higher_prime_index PARAMS ((unsigned long));\n+static hashval_t htab_mod_1 PARAMS ((hashval_t, hashval_t, hashval_t, int));\n+static hashval_t htab_mod PARAMS ((hashval_t, htab_t));\n+static hashval_t htab_mod_m2 PARAMS ((hashval_t, htab_t));\n static hashval_t hash_pointer PARAMS ((const void *));\n static int eq_pointer PARAMS ((const void *, const void *));\n static int htab_expand PARAMS ((htab_t));\n@@ -75,69 +88,117 @@ static PTR *find_empty_slot_for_expand  PARAMS ((htab_t, hashval_t));\n htab_hash htab_hash_pointer = hash_pointer;\n htab_eq htab_eq_pointer = eq_pointer;\n \n-/* The following function returns a nearest prime number which is\n-   greater than N, and near a power of two. */\n+/* Table of primes and multiplicative inverses.\n+\n+   Note that these are not minimally reduced inverses.  Unlike when generating\n+   code to divide by a constant, we want to be able to use the same algorithm\n+   all the time.  All of these inverses (are implied to) have bit 32 set.\n+\n+   For the record, here's the function that computed the table; it's a \n+   vastly simplified version of the function of the same name from gcc.  */\n+\n+#if 0\n+unsigned int\n+ceil_log2 (unsigned int x)\n+{\n+  int i;\n+  for (i = 31; i >= 0 ; --i)\n+    if (x > (1u << i))\n+      return i+1;\n+  abort ();\n+}\n \n-static unsigned long\n-higher_prime_number (n)\n+unsigned int\n+choose_multiplier (unsigned int d, unsigned int *mlp, unsigned char *shiftp)\n+{\n+  unsigned long long mhigh;\n+  double nx;\n+  int lgup, post_shift;\n+  int pow, pow2;\n+  int n = 32, precision = 32;\n+\n+  lgup = ceil_log2 (d);\n+  pow = n + lgup;\n+  pow2 = n + lgup - precision;\n+\n+  nx = ldexp (1.0, pow) + ldexp (1.0, pow2);\n+  mhigh = nx / d;\n+\n+  *shiftp = lgup - 1;\n+  *mlp = mhigh;\n+  return mhigh >> 32;\n+}\n+#endif\n+\n+struct prime_ent\n+{\n+  hashval_t prime;\n+  hashval_t inv;\n+  hashval_t inv_m2;\t/* inverse of prime-2 */\n+  hashval_t shift;\n+};\n+\n+static struct prime_ent const prime_tab[] = {\n+  {          7, 0x24924925, 0x9999999b, 2 },\n+  {         13, 0x3b13b13c, 0x745d1747, 3 },\n+  {         31, 0x08421085, 0x1a7b9612, 4 },\n+  {         61, 0x0c9714fc, 0x15b1e5f8, 5 },\n+  {        127, 0x02040811, 0x0624dd30, 6 },\n+  {        251, 0x05197f7e, 0x073260a5, 7 },\n+  {        509, 0x01824366, 0x02864fc8, 8 },\n+  {       1021, 0x00c0906d, 0x014191f7, 9 },\n+  {       2039, 0x0121456f, 0x0161e69e, 10 },\n+  {       4093, 0x00300902, 0x00501908, 11 },\n+  {       8191, 0x00080041, 0x00180241, 12 },\n+  {      16381, 0x000c0091, 0x00140191, 13 },\n+  {      32749, 0x002605a5, 0x002a06e6, 14 },\n+  {      65521, 0x000f00e2, 0x00110122, 15 },\n+  {     131071, 0x00008001, 0x00018003, 16 },\n+  {     262139, 0x00014002, 0x0001c004, 17 },\n+  {     524287, 0x00002001, 0x00006001, 18 },\n+  {    1048573, 0x00003001, 0x00005001, 19 },\n+  {    2097143, 0x00004801, 0x00005801, 20 },\n+  {    4194301, 0x00000c01, 0x00001401, 21 },\n+  {    8388593, 0x00001e01, 0x00002201, 22 },\n+  {   16777213, 0x00000301, 0x00000501, 23 },\n+  {   33554393, 0x00001381, 0x00001481, 24 },\n+  {   67108859, 0x00000141, 0x000001c1, 25 },\n+  {  134217689, 0x000004e1, 0x00000521, 26 },\n+  {  268435399, 0x00000391, 0x000003b1, 27 },\n+  {  536870909, 0x00000019, 0x00000029, 28 },\n+  { 1073741789, 0x0000008d, 0x00000095, 29 },\n+  { 2147483647, 0x00000003, 0x00000007, 30 },\n+  /* Avoid \"decimal constant so large it is unsigned\" for 4294967291.  */\n+  { 0xfffffffb, 0x00000006, 0x00000008, 31 }\n+};\n+\n+/* The following function returns an index into the above table of the\n+   nearest prime number which is greater than N, and near a power of two. */\n+\n+static unsigned int\n+higher_prime_index (n)\n      unsigned long n;\n {\n-  /* These are primes that are near, but slightly smaller than, a\n-     power of two.  */\n-  static const unsigned long primes[] = {\n-    (unsigned long) 7,\n-    (unsigned long) 13,\n-    (unsigned long) 31,\n-    (unsigned long) 61,\n-    (unsigned long) 127,\n-    (unsigned long) 251,\n-    (unsigned long) 509,\n-    (unsigned long) 1021,\n-    (unsigned long) 2039,\n-    (unsigned long) 4093,\n-    (unsigned long) 8191,\n-    (unsigned long) 16381,\n-    (unsigned long) 32749,\n-    (unsigned long) 65521,\n-    (unsigned long) 131071,\n-    (unsigned long) 262139,\n-    (unsigned long) 524287,\n-    (unsigned long) 1048573,\n-    (unsigned long) 2097143,\n-    (unsigned long) 4194301,\n-    (unsigned long) 8388593,\n-    (unsigned long) 16777213,\n-    (unsigned long) 33554393,\n-    (unsigned long) 67108859,\n-    (unsigned long) 134217689,\n-    (unsigned long) 268435399,\n-    (unsigned long) 536870909,\n-    (unsigned long) 1073741789,\n-    (unsigned long) 2147483647,\n-\t\t\t\t\t/* 4294967291L */\n-    ((unsigned long) 2147483647) + ((unsigned long) 2147483644),\n-  };\n-\n-  const unsigned long *low = &primes[0];\n-  const unsigned long *high = &primes[sizeof(primes) / sizeof(primes[0])];\n+  unsigned int low = 0;\n+  unsigned int high = sizeof(prime_tab) / sizeof(prime_tab[0]);\n \n   while (low != high)\n     {\n-      const unsigned long *mid = low + (high - low) / 2;\n-      if (n > *mid)\n+      unsigned int mid = low + (high - low) / 2;\n+      if (n > prime_tab[mid].prime)\n \tlow = mid + 1;\n       else\n \thigh = mid;\n     }\n \n   /* If we've run out of primes, abort.  */\n-  if (n > *low)\n+  if (n > prime_tab[low].prime)\n     {\n       fprintf (stderr, \"Cannot find prime bigger than %lu\\n\", n);\n       abort ();\n     }\n \n-  return *low;\n+  return low;\n }\n \n /* Returns a hash code for P.  */\n@@ -177,14 +238,45 @@ htab_elements (htab)\n   return htab->n_elements - htab->n_deleted;\n }\n \n+/* Return X % Y.  */\n+\n+static inline hashval_t\n+htab_mod_1 (x, y, inv, shift)\n+     hashval_t x, y, inv;\n+     int shift;\n+{\n+  /* The multiplicative inverses computed above are for 32-bit types, and\n+     requires that we be able to compute a highpart multiply.  */\n+#ifdef UNSIGNED_64BIT_TYPE\n+  __extension__ typedef UNSIGNED_64BIT_TYPE ull;\n+  if (sizeof (hashval_t) * CHAR_BIT <= 32)\n+    {\n+      hashval_t t1, t2, t3, t4, q, r;\n+\n+      t1 = ((ull)x * inv) >> 32;\n+      t2 = x - t1;\n+      t3 = t2 >> 1;\n+      t4 = t1 + t3;\n+      q  = t4 >> shift;\n+      r  = x - (q * y);\n+\n+      return r;\n+    }\n+#endif\n+\n+  /* Otherwise just use the native division routines.  */\n+  return x % y;\n+}\n+\n /* Compute the primary hash for HASH given HTAB's current size.  */\n \n static inline hashval_t\n htab_mod (hash, htab)\n      hashval_t hash;\n      htab_t htab;\n {\n-  return hash % htab_size (htab);\n+  const struct prime_ent *p = &prime_tab[htab->size_prime_index];\n+  return htab_mod_1 (hash, p->prime, p->inv, p->shift);\n }\n \n /* Compute the secondary hash for HASH given HTAB's current size.  */\n@@ -194,7 +286,8 @@ htab_mod_m2 (hash, htab)\n      hashval_t hash;\n      htab_t htab;\n {\n-  return 1 + hash % (htab_size (htab) - 2);\n+  const struct prime_ent *p = &prime_tab[htab->size_prime_index];\n+  return 1 + htab_mod_1 (hash, p->prime - 2, p->inv_m2, p->shift);\n }\n \n /* This function creates table with length slightly longer than given\n@@ -212,8 +305,11 @@ htab_create_alloc (size, hash_f, eq_f, del_f, alloc_f, free_f)\n      htab_free free_f;\n {\n   htab_t result;\n+  unsigned int size_prime_index;\n+\n+  size_prime_index = higher_prime_index (size);\n+  size = prime_tab[size_prime_index].prime;\n \n-  size = higher_prime_number (size);\n   result = (htab_t) (*alloc_f) (1, sizeof (struct htab));\n   if (result == NULL)\n     return NULL;\n@@ -225,6 +321,7 @@ htab_create_alloc (size, hash_f, eq_f, del_f, alloc_f, free_f)\n       return NULL;\n     }\n   result->size = size;\n+  result->size_prime_index = size_prime_index;\n   result->hash_f = hash_f;\n   result->eq_f = eq_f;\n   result->del_f = del_f;\n@@ -248,8 +345,11 @@ htab_create_alloc_ex (size, hash_f, eq_f, del_f, alloc_arg, alloc_f,\n      htab_free_with_arg free_f;\n {\n   htab_t result;\n+  unsigned int size_prime_index;\n+\n+  size_prime_index = higher_prime_index (size);\n+  size = prime_tab[size_prime_index].prime;\n \n-  size = higher_prime_number (size);\n   result = (htab_t) (*alloc_f) (alloc_arg, 1, sizeof (struct htab));\n   if (result == NULL)\n     return NULL;\n@@ -261,6 +361,7 @@ htab_create_alloc_ex (size, hash_f, eq_f, del_f, alloc_arg, alloc_f,\n       return NULL;\n     }\n   result->size = size;\n+  result->size_prime_index = size_prime_index;\n   result->hash_f = hash_f;\n   result->eq_f = eq_f;\n   result->del_f = del_f;\n@@ -412,19 +513,27 @@ htab_expand (htab)\n   PTR *olimit;\n   PTR *p;\n   PTR *nentries;\n-  size_t nsize;\n+  size_t nsize, osize, elts;\n+  unsigned int oindex, nindex;\n \n   oentries = htab->entries;\n-  olimit = oentries + htab->size;\n+  oindex = htab->size_prime_index;\n+  osize = htab->size;\n+  olimit = oentries + osize;\n+  elts = htab_elements (htab);\n \n   /* Resize only when table after removal of unused elements is either\n      too full or too empty.  */\n-  if ((htab->n_elements - htab->n_deleted) * 2 > htab->size\n-      || ((htab->n_elements - htab->n_deleted) * 8 < htab->size\n-\t  && htab->size > 32))\n-    nsize = higher_prime_number ((htab->n_elements - htab->n_deleted) * 2);\n+  if (elts * 2 > osize || (elts * 8 < osize && osize > 32))\n+    {\n+      nindex = higher_prime_index (elts * 2);\n+      nsize = prime_tab[nindex].prime;\n+    }\n   else\n-    nsize = htab->size;\n+    {\n+      nindex = oindex;\n+      nsize = osize;\n+    }\n \n   if (htab->alloc_with_arg_f != NULL)\n     nentries = (PTR *) (*htab->alloc_with_arg_f) (htab->alloc_arg, nsize,\n@@ -435,7 +544,7 @@ htab_expand (htab)\n     return 0;\n   htab->entries = nentries;\n   htab->size = nsize;\n-\n+  htab->size_prime_index = nindex;\n   htab->n_elements -= htab->n_deleted;\n   htab->n_deleted = 0;\n "}]}