{"sha": "51f3e4e157dae1cded8f340f12859b237151fe74", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTFmM2U0ZTE1N2RhZTFjZGVkOGYzNDBmMTI4NTliMjM3MTUxZmU3NA==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2018-01-11T08:50:18Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-01-11T08:50:18Z"}, "message": "[Ada] Inconsistent scope chain due to quantified expression\n\nThis patch corrects the minor decoration performed on invariant procedures in\ncase the procedure is not inserted into the tree and analyzed. The decoration\nnow constructs a proper first/next/last entity chain containing the single\nformal parameter which represents the object of the related type. The chain\nthen ensures that any other entities generated by the [pre]analysis of the\ninvariant expression will be properly added to the chain.\n\nThe issue was discovered during the development of the GNATprove tool and\nis not visible to end users. No simple test is available because this would\nrequire a debug session.\n\n2018-01-11  Hristian Kirtchev  <kirtchev@adacore.com>\n\ngcc/ada/\n\n\t* exp_util.adb (Build_Invariant_Procedure_Declaration): Set the last\n\tentity of the generated invariant procedure in order to construct a\n\tproper entity chain.\n\nFrom-SVN: r256483", "tree": {"sha": "efb29bdc3b0afa2977c2556a47bcce6876ef4859", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/efb29bdc3b0afa2977c2556a47bcce6876ef4859"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/51f3e4e157dae1cded8f340f12859b237151fe74", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51f3e4e157dae1cded8f340f12859b237151fe74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51f3e4e157dae1cded8f340f12859b237151fe74", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51f3e4e157dae1cded8f340f12859b237151fe74/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "593e3172343967753c81fb85013b3f769679c9e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/593e3172343967753c81fb85013b3f769679c9e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/593e3172343967753c81fb85013b3f769679c9e2"}], "stats": {"total": 7, "additions": 7, "deletions": 0}, "files": [{"sha": "88e2ee247370f00cf5008bdb4b19588efd24f2e7", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51f3e4e157dae1cded8f340f12859b237151fe74/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51f3e4e157dae1cded8f340f12859b237151fe74/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=51f3e4e157dae1cded8f340f12859b237151fe74", "patch": "@@ -1,3 +1,9 @@\n+2018-01-11  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* exp_util.adb (Build_Invariant_Procedure_Declaration): Set the last\n+\tentity of the generated invariant procedure in order to construct a\n+\tproper entity chain.\n+\n 2018-01-11  Piotr Trojanek  <trojanek@adacore.com>\n \n \t* sem_ch13.adb (Build_Predicate_Functions): Fix minor issues in"}, {"sha": "9ccaa78bc5ddcf98cb1f844de4c7d5b21b948662", "filename": "gcc/ada/exp_util.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51f3e4e157dae1cded8f340f12859b237151fe74/gcc%2Fada%2Fexp_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51f3e4e157dae1cded8f340f12859b237151fe74/gcc%2Fada%2Fexp_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.adb?ref=51f3e4e157dae1cded8f340f12859b237151fe74", "patch": "@@ -3466,6 +3466,7 @@ package body Exp_Util is\n       Set_Scope (Obj_Id, Proc_Id);\n \n       Set_First_Entity (Proc_Id, Obj_Id);\n+      Set_Last_Entity  (Proc_Id, Obj_Id);\n \n       --  Generate:\n       --    procedure <Work_Typ>[Partial_]Invariant (_object : <Obj_Typ>);"}]}