{"sha": "12f154688d9e942614d49178dee92b766afb64bb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTJmMTU0Njg4ZDllOTQyNjE0ZDQ5MTc4ZGVlOTJiNzY2YWZiNjRiYg==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2019-01-22T14:53:41Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2019-01-22T14:53:41Z"}, "message": "i386: Load external function address via GOT slot\n\nWith noplt attribute, we load the external function address via the GOT\nslot so that linker won't create an PLT entry for extern function address.\n\ngcc/\n\n\tPR target/88954\n\t* config/i386/i386.c (ix86_force_load_from_GOT_p): Also check\n\tnoplt attribute.\n\ngcc/testsuite/\n\n\tPR target/88954\n\t* gcc.target/i386/pr88954-1.c: New test.\n\t* gcc.target/i386/pr88954-2.c: Likewise.\n\nFrom-SVN: r268152", "tree": {"sha": "edc5ed79863d994cd35b293ee30303d2db1928e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/edc5ed79863d994cd35b293ee30303d2db1928e4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/12f154688d9e942614d49178dee92b766afb64bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12f154688d9e942614d49178dee92b766afb64bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12f154688d9e942614d49178dee92b766afb64bb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12f154688d9e942614d49178dee92b766afb64bb/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "44a7251e1e97caf3b2315f20d48519ff8fced152", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44a7251e1e97caf3b2315f20d48519ff8fced152", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44a7251e1e97caf3b2315f20d48519ff8fced152"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "88c2e149f228ced90371ff79ff3d9211003fc6c4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12f154688d9e942614d49178dee92b766afb64bb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12f154688d9e942614d49178dee92b766afb64bb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=12f154688d9e942614d49178dee92b766afb64bb", "patch": "@@ -1,3 +1,9 @@\n+2019-01-22  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/88954\n+\t* config/i386/i386.c (ix86_force_load_from_GOT_p): Also check\n+\tnoplt attribute.\n+\n 2019-01-22  Richard Earnshaw  <rearnsha@arm.com>\n \n \tPR target/88469"}, {"sha": "7485a86d7d5cfd4a55c0d2bf6b5480d94a41576c", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=12f154688d9e942614d49178dee92b766afb64bb", "patch": "@@ -15189,10 +15189,14 @@ ix86_force_load_from_GOT_p (rtx x)\n {\n   return ((TARGET_64BIT || HAVE_AS_IX86_GOT32X)\n \t  && !TARGET_PECOFF && !TARGET_MACHO\n-\t  && !flag_plt && !flag_pic\n+\t  && !flag_pic\n \t  && ix86_cmodel != CM_LARGE\n \t  && GET_CODE (x) == SYMBOL_REF\n \t  && SYMBOL_REF_FUNCTION_P (x)\n+\t  && (!flag_plt\n+\t      || (SYMBOL_REF_DECL (x)\n+\t\t  && lookup_attribute (\"noplt\",\n+\t\t\t\t       DECL_ATTRIBUTES (SYMBOL_REF_DECL (x)))))\n \t  && !SYMBOL_REF_LOCAL_P (x));\n }\n "}, {"sha": "5fb19c473e18887ba131ff3a8e1e852c259eff32", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=12f154688d9e942614d49178dee92b766afb64bb", "patch": "@@ -1,3 +1,9 @@\n+2019-01-22  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR target/88954\n+\t* gcc.target/i386/pr88954-1.c: New test.\n+\t* gcc.target/i386/pr88954-2.c: Likewise.\n+\n 2019-01-22  Richard Earnshaw  <rearnsha@arm.com>\n \n \tPR target/88469"}, {"sha": "69cb940ae4f5a07e484e55c133d8e79b174db79e", "filename": "gcc/testsuite/gcc.target/i386/pr88954-1.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr88954-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr88954-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr88954-1.c?ref=12f154688d9e942614d49178dee92b766afb64bb", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile { target *-*-linux* } } */\n+/* { dg-options \"-O2 -fno-pic -fplt\" } */\n+\n+extern void bar (void) __attribute__((noplt));\n+\n+void *\n+foo (void)\n+{\n+  return &bar;\n+}\n+\n+/* { dg-final { scan-assembler \"mov\\(l|q\\)\\[ \\t\\]*bar@GOTPCREL\" { target { ! ia32 } } } } */\n+/* { dg-final { scan-assembler \"movl\\[ \\t\\]*bar@GOT,\" { target { ia32 && got32x_reloc } } } } */\n+/* { dg-final { scan-assembler-not \"\\(mov|lea\\)\\(l|q\\)\\[ \\t\\]*\\(\\\\\\$|\\)bar,\" { target { ! ia32 } } } } */\n+/* { dg-final { scan-assembler-not \"\\(mov|lea\\)l\\[ \\t\\]*\\(\\\\\\$|\\)bar,\" { target { ia32 && got32x_reloc } } } } */"}, {"sha": "3bc4ee47bae303128cb5a57691c36ccec06cb95b", "filename": "gcc/testsuite/gcc.target/i386/pr88954-2.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr88954-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12f154688d9e942614d49178dee92b766afb64bb/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr88954-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr88954-2.c?ref=12f154688d9e942614d49178dee92b766afb64bb", "patch": "@@ -0,0 +1,16 @@\n+/* { dg-do compile { target *-*-linux* } } */\n+/* { dg-options \"-O2 -fno-pic -fplt\" } */\n+\n+extern void bar (void) __attribute__((noplt));\n+extern void *p;\n+\n+void\n+foo (void)\n+{\n+  p = &bar;\n+}\n+\n+/* { dg-final { scan-assembler \"mov\\(l|q\\)\\[ \\t\\]*bar@GOTPCREL\" { target { ! ia32 } } } } */\n+/* { dg-final { scan-assembler \"movl\\[ \\t\\]*bar@GOT,\" { target { ia32 && got32x_reloc } } } } */\n+/* { dg-final { scan-assembler-not \"mov\\(l|q\\)\\[ \\t\\]*\\\\\\$bar,\" { target { ! ia32 } } } } */\n+/* { dg-final { scan-assembler-not \"mov\\(l|q\\)\\[ \\t\\]*\\\\\\$bar,\" { target { ia32 && got32x_reloc } } } } */"}]}