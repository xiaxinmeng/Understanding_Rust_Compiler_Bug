{"sha": "2249a4d5125689e9012a866537bade963317fab8", "node_id": "C_kwDOANBUbNoAKDIyNDlhNGQ1MTI1Njg5ZTkwMTJhODY2NTM3YmFkZTk2MzMxN2ZhYjg", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-03-25T10:13:29Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2022-03-25T10:22:17Z"}, "message": "attributes: Allow stripping assignment expressions", "tree": {"sha": "71631a8bffd92767ef8c32e8393b9d3c48c9c493", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/71631a8bffd92767ef8c32e8393b9d3c48c9c493"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2249a4d5125689e9012a866537bade963317fab8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2249a4d5125689e9012a866537bade963317fab8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2249a4d5125689e9012a866537bade963317fab8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2249a4d5125689e9012a866537bade963317fab8/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "89ad4f21f25a2501bb9bb96338be4a6edb89bbcd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89ad4f21f25a2501bb9bb96338be4a6edb89bbcd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89ad4f21f25a2501bb9bb96338be4a6edb89bbcd"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "8f2a6c7fc5f2d0c202499cbc50ccf7e669ffca9b", "filename": "gcc/rust/expand/rust-attribute-visitor.cc", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2249a4d5125689e9012a866537bade963317fab8/gcc%2Frust%2Fexpand%2Frust-attribute-visitor.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2249a4d5125689e9012a866537bade963317fab8/gcc%2Frust%2Fexpand%2Frust-attribute-visitor.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-attribute-visitor.cc?ref=2249a4d5125689e9012a866537bade963317fab8", "patch": "@@ -628,8 +628,12 @@ AttrVisitor::visit (AST::TypeCastExpr &expr)\n void\n AttrVisitor::visit (AST::AssignmentExpr &expr)\n {\n-  /* outer attributes never allowed before these. while cannot strip\n-   * two direct descendant expressions, can strip ones below that */\n+  expander.expand_cfg_attrs (expr.get_outer_attrs ());\n+  if (expander.fails_cfg_with_expand (expr.get_outer_attrs ()))\n+    {\n+      expr.mark_for_strip ();\n+      return;\n+    }\n \n   /* should have no possibility for outer attrs as would be parsed\n    * with outer expr */"}, {"sha": "1c6410d23046560288001c2e8cf7583490788c59", "filename": "gcc/rust/expand/rust-attribute-visitor.h", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2249a4d5125689e9012a866537bade963317fab8/gcc%2Frust%2Fexpand%2Frust-attribute-visitor.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2249a4d5125689e9012a866537bade963317fab8/gcc%2Frust%2Fexpand%2Frust-attribute-visitor.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-attribute-visitor.h?ref=2249a4d5125689e9012a866537bade963317fab8", "patch": "@@ -71,8 +71,12 @@ class AttrVisitor : public AST::ASTVisitor\n \t    it = values.erase (it);\n \t    for (auto &node : fragment.get_nodes ())\n \t      {\n-\t\tit = values.insert (it, extractor (node));\n-\t\tit++;\n+\t\tauto new_node = extractor (node);\n+\t\tif (new_node != nullptr && !new_node->is_marked_for_strip ())\n+\t\t  {\n+\t\t    it = values.insert (it, std::move (new_node));\n+\t\t    it++;\n+\t\t  }\n \t      }\n \t  }\n \telse if (value->is_marked_for_strip ())"}]}