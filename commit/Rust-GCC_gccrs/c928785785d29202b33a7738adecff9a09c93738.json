{"sha": "c928785785d29202b33a7738adecff9a09c93738", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzkyODc4NTc4NWQyOTIwMmIzM2E3NzM4YWRlY2ZmOWEwOWM5MzczOA==", "commit": {"author": {"name": "Emmanuel Briot", "email": "briot@adacore.com", "date": "2009-06-24T09:57:13Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-06-24T09:57:13Z"}, "message": "prj-proc.adb, [...] (Allow_Duplicate_Basenames): New parameter to several subprograms.\n\n2009-06-24  Emmanuel Briot  <briot@adacore.com>\n\n\t* prj-proc.adb, prj-proc.ads, prj.ads, prj-nmsc.adb, prj-nmsc.ads,\n\tprj-conf.adb, prj-conf.ads (Allow_Duplicate_Basenames): New parameter\n\tto several subprograms.\n\t(Source_Data.Other_Part): Removed, since can be computed from the\n\tlanguage.\n\t(Other_Part): New subprogram.\n\nFrom-SVN: r148904", "tree": {"sha": "a4e7eb796c5e2dc481738203d747f83b12577a22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a4e7eb796c5e2dc481738203d747f83b12577a22"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c928785785d29202b33a7738adecff9a09c93738", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c928785785d29202b33a7738adecff9a09c93738", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c928785785d29202b33a7738adecff9a09c93738", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c928785785d29202b33a7738adecff9a09c93738/comments", "author": {"login": "briot", "id": 42402, "node_id": "MDQ6VXNlcjQyNDAy", "avatar_url": "https://avatars.githubusercontent.com/u/42402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briot", "html_url": "https://github.com/briot", "followers_url": "https://api.github.com/users/briot/followers", "following_url": "https://api.github.com/users/briot/following{/other_user}", "gists_url": "https://api.github.com/users/briot/gists{/gist_id}", "starred_url": "https://api.github.com/users/briot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briot/subscriptions", "organizations_url": "https://api.github.com/users/briot/orgs", "repos_url": "https://api.github.com/users/briot/repos", "events_url": "https://api.github.com/users/briot/events{/privacy}", "received_events_url": "https://api.github.com/users/briot/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2b426674815acc4d32ef39140e531f92cbf20e14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b426674815acc4d32ef39140e531f92cbf20e14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b426674815acc4d32ef39140e531f92cbf20e14"}], "stats": {"total": 266, "additions": 158, "deletions": 108}, "files": [{"sha": "a1c4d339faf283af4bbf7e6e5536eb48764d51b0", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -1,3 +1,12 @@\n+2009-06-24  Emmanuel Briot  <briot@adacore.com>\n+\n+\t* prj-proc.adb, prj-proc.ads, prj.ads, prj-nmsc.adb, prj-nmsc.ads,\n+\tprj-conf.adb, prj-conf.ads (Allow_Duplicate_Basenames): New parameter\n+\tto several subprograms.\n+\t(Source_Data.Other_Part): Removed, since can be computed from the\n+\tlanguage.\n+\t(Other_Part): New subprogram.\n+\n 2009-06-24  Emmanuel Briot  <briot@adacore.com>\n \n \t* gnat_ugn.texi, prj-nmsc.adb (Suffix_Matches): A suffix can also match"}, {"sha": "0520cf5253ce5fb7991993db6372216166e231f1", "filename": "gcc/ada/prj-conf.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-conf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-conf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.adb?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -907,7 +907,8 @@ package body Prj.Conf is\n       Normalized_Hostname        : String;\n       Report_Error               : Put_Line_Access := null;\n       On_Load_Config             : Config_File_Hook := null;\n-      Compiler_Driver_Mandatory  : Boolean := True)\n+      Compiler_Driver_Mandatory  : Boolean := True;\n+      Allow_Duplicate_Basenames  : Boolean := False)\n    is\n       Main_Config_Project : Project_Id;\n       Success : Boolean;\n@@ -962,6 +963,7 @@ package body Prj.Conf is\n          Current_Dir               => Current_Directory,\n          When_No_Sources           => Warning,\n          Compiler_Driver_Mandatory => Compiler_Driver_Mandatory,\n+         Allow_Duplicate_Basenames => Allow_Duplicate_Basenames,\n          Is_Config_File            => False);\n \n       if not Success then"}, {"sha": "4eb8691bfc45bc74687aa30f8dc64d823fdb06f4", "filename": "gcc/ada/prj-conf.ads", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-conf.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-conf.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.ads?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -98,7 +98,8 @@ package Prj.Conf is\n       Normalized_Hostname        : String;\n       Report_Error               : Put_Line_Access := null;\n       On_Load_Config             : Config_File_Hook := null;\n-      Compiler_Driver_Mandatory  : Boolean := True);\n+      Compiler_Driver_Mandatory  : Boolean := True;\n+      Allow_Duplicate_Basenames  : Boolean := False);\n    --  Same as above, except the project must already have been parsed through\n    --  Prj.Part.Parse, and only the processing of the project and the\n    --  configuration is done at this level."}, {"sha": "c503b5ecac0dc78ce1e9541421dcbed45105b74d", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 75, "deletions": 59, "changes": 134, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -240,7 +240,6 @@ package body Prj.Nmsc is\n       Naming_Exception    : Boolean := False;\n       Path                : Path_Information := No_Path_Information;\n       Alternate_Languages : Language_List := null;\n-      Other_Part          : Source_Id := No_Source;\n       Unit                : Name_Id   := No_Name;\n       Index               : Int       := 0;\n       Source_To_Replace   : Source_Id := No_Source);\n@@ -378,19 +377,24 @@ package body Prj.Nmsc is\n    procedure Search_Directories\n      (Project         : Project_Id;\n       In_Tree         : Project_Tree_Ref;\n-      For_All_Sources : Boolean);\n+      For_All_Sources : Boolean;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Search the source directories to find the sources.\n    --  If For_All_Sources is True, check each regular file name against the\n    --  naming schemes of the different languages. Otherwise consider only the\n    --  file names in the hash table Source_Names.\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n    procedure Check_File\n      (Project           : Project_Id;\n       In_Tree           : Project_Tree_Ref;\n       Path              : Path_Name_Type;\n       File_Name         : File_Name_Type;\n       Display_File_Name : File_Name_Type;\n-      For_All_Sources   : Boolean);\n+      For_All_Sources   : Boolean;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Check if file File_Name is a valid source of the project. This is used\n    --  in multi-language mode only.\n    --  When the file matches one of the naming schemes, it is added to\n@@ -409,6 +413,10 @@ package body Prj.Nmsc is\n    --\n    --  If For_All_Sources is True, then all possible file names are analyzed\n    --  otherwise only those currently set in the Source_Names htable.\n+   --\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n    procedure Check_File_Naming_Schemes\n      (In_Tree               : Project_Tree_Ref;\n@@ -459,11 +467,15 @@ package body Prj.Nmsc is\n    procedure Find_Sources\n      (Project   : Project_Id;\n       In_Tree   : Project_Tree_Ref;\n-      Proc_Data : in out Processing_Data);\n+      Proc_Data : in out Processing_Data;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Process the Source_Files and Source_List_File attributes, and store\n    --  the list of source files into the Source_Names htable.\n    --  When these attributes are not defined, find all files matching the\n    --  naming schemes in the source directories.\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n    procedure Compute_Unit_Name\n      (File_Name       : File_Name_Type;\n@@ -525,11 +537,15 @@ package body Prj.Nmsc is\n    procedure Look_For_Sources\n      (Project     : Project_Id;\n       In_Tree     : Project_Tree_Ref;\n-      Proc_Data   : in out Processing_Data);\n+      Proc_Data   : in out Processing_Data;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Find all the sources of project Project in project tree In_Tree and\n    --  update its Data accordingly. This assumes that Data.First_Source has\n    --  been initialized with the list of excluded sources and special naming\n    --  exceptions.\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n    function Path_Name_Of\n      (File_Name : File_Name_Type;\n@@ -683,7 +699,6 @@ package body Prj.Nmsc is\n       Naming_Exception    : Boolean := False;\n       Path                : Path_Information := No_Path_Information;\n       Alternate_Languages : Language_List := null;\n-      Other_Part          : Source_Id := No_Source;\n       Unit                : Name_Id   := No_Name;\n       Index               : Int       := 0;\n       Source_To_Replace   : Source_Id := No_Source)\n@@ -716,11 +731,6 @@ package body Prj.Nmsc is\n       Id.Language            := Lang_Id;\n       Id.Kind                := Kind;\n       Id.Alternate_Languages := Alternate_Languages;\n-      Id.Other_Part          := Other_Part;\n-\n-      if Other_Part /= No_Source then\n-         Other_Part.Other_Part := Id;\n-      end if;\n \n       --  Add the source id to the Unit_Sources_HT hash table, if the unit name\n       --  is not null.\n@@ -820,7 +830,8 @@ package body Prj.Nmsc is\n       Current_Dir               : String;\n       Proc_Data                 : in out Processing_Data;\n       Is_Config_File            : Boolean;\n-      Compiler_Driver_Mandatory : Boolean)\n+      Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Extending : Boolean := False;\n \n@@ -911,7 +922,8 @@ package body Prj.Nmsc is\n       --  Find the sources\n \n       if Project.Source_Dirs /= Nil_String then\n-         Look_For_Sources (Project, In_Tree, Proc_Data);\n+         Look_For_Sources\n+           (Project, In_Tree, Proc_Data, Allow_Duplicate_Basenames);\n \n          if Get_Mode = Ada_Only then\n \n@@ -2533,6 +2545,7 @@ package body Prj.Nmsc is\n       Iter      : Source_Iterator;\n       Source    : Source_Id;\n       Project_2 : Project_Id;\n+      Other     : Source_Id;\n \n    begin\n       if not Interfaces.Default then\n@@ -2573,9 +2586,11 @@ package body Prj.Nmsc is\n                         Source.In_Interfaces := True;\n                         Source.Declared_In_Interfaces := True;\n \n-                        if Source.Other_Part /= No_Source then\n-                           Source.Other_Part.In_Interfaces := True;\n-                           Source.Other_Part.Declared_In_Interfaces := True;\n+                        Other := Other_Part (Source);\n+\n+                        if Other /= No_Source then\n+                           Other.In_Interfaces := True;\n+                           Other.Declared_In_Interfaces := True;\n                         end if;\n \n                         if Current_Verbosity = High then\n@@ -2971,7 +2986,6 @@ package body Prj.Nmsc is\n          Source            : Source_Id;\n          Source_To_Replace : Source_Id := No_Source;\n          Other_Project     : Project_Id;\n-         Other_Part        : Source_Id := No_Source;\n          Iter              : Source_Iterator;\n \n       begin\n@@ -3049,8 +3063,6 @@ package body Prj.Nmsc is\n \n                if Source /= No_Source then\n                   if Source.Kind /= Kind then\n-                     Other_Part := Source;\n-\n                      loop\n                         Next (Iter);\n                         Source := Prj.Element (Iter);\n@@ -3066,10 +3078,6 @@ package body Prj.Nmsc is\n                      Other_Project := Source.Project;\n \n                      if Is_Extending (Project, Other_Project) then\n-                        Other_Part := Source.Other_Part;\n-\n-                        --  Record the source to be removed\n-\n                         Source_To_Replace := Source;\n                         Source := No_Source;\n \n@@ -3094,7 +3102,6 @@ package body Prj.Nmsc is\n                      Kind         => Kind,\n                      File_Name    => File_Name,\n                      Display_File => File_Name_Type (Element.Value.Value),\n-                     Other_Part   => Other_Part,\n                      Unit         => Unit,\n                      Index        => Index,\n                      Naming_Exception => True,\n@@ -4661,9 +4668,9 @@ package body Prj.Nmsc is\n                         if Source.Kind = Sep then\n                            Source := No_Source;\n                         elsif Source.Kind = Spec\n-                          and then Source.Other_Part /= No_Source\n+                          and then Other_Part (Source) /= No_Source\n                         then\n-                           Source := Source.Other_Part;\n+                           Source := Other_Part (Source);\n                         end if;\n                      end if;\n \n@@ -4683,10 +4690,10 @@ package body Prj.Nmsc is\n                                 (Interfaces).Location);\n \n                      else\n-                        if Source.Kind = Spec and then\n-                          Source.Other_Part /= No_Source\n+                        if Source.Kind = Spec\n+                          and then Other_Part (Source) /= No_Source\n                         then\n-                           Source := Source.Other_Part;\n+                           Source := Other_Part (Source);\n                         end if;\n \n                         String_Element_Table.Increment_Last\n@@ -6760,7 +6767,8 @@ package body Prj.Nmsc is\n    procedure Find_Sources\n      (Project   : Project_Id;\n       In_Tree   : Project_Tree_Ref;\n-      Proc_Data : in out Processing_Data)\n+      Proc_Data : in out Processing_Data;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Sources          : constant Variable_Value :=\n                            Util.Value_Of\n@@ -6926,7 +6934,8 @@ package body Prj.Nmsc is\n          Search_Directories\n            (Project, In_Tree,\n             For_All_Sources =>\n-              Sources.Default and then Source_List_File.Default);\n+              Sources.Default and then Source_List_File.Default,\n+            Allow_Duplicate_Basenames => Allow_Duplicate_Basenames);\n       end if;\n \n       --  Check if all exceptions have been found. For Ada, it is an error if\n@@ -7342,7 +7351,8 @@ package body Prj.Nmsc is\n       Path              : Path_Name_Type;\n       File_Name         : File_Name_Type;\n       Display_File_Name : File_Name_Type;\n-      For_All_Sources   : Boolean)\n+      For_All_Sources   : Boolean;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Canonical_Path : constant Path_Name_Type :=\n                          Path_Name_Type\n@@ -7353,7 +7363,6 @@ package body Prj.Nmsc is\n       Alternate_Languages   : Language_List;\n       Language              : Language_Ptr;\n       Source                : Source_Id;\n-      Other_Part            : Source_Id;\n       Add_Src               : Boolean;\n       Src_Ind               : Source_File_Index;\n       Unit                  : Name_Id;\n@@ -7414,8 +7423,6 @@ package body Prj.Nmsc is\n       end if;\n \n       if Check_Name then\n-         Other_Part := No_Source;\n-\n          Check_File_Naming_Schemes\n            (In_Tree               => In_Tree,\n             Project               => Project,\n@@ -7457,7 +7464,7 @@ package body Prj.Nmsc is\n                        or else\n                     (Source.Kind = Impl and then Kind = Spec))\n                then\n-                  Other_Part := Source;\n+                  null; --  We found the \"other_part (source)\"\n \n                elsif (Unit /= No_Name\n                       and then Source.Unit /= No_Unit_Index\n@@ -7475,22 +7482,29 @@ package body Prj.Nmsc is\n                   --  allowed if order of source directories is known.\n \n                   if Project = Source.Project then\n-                     if Project.Known_Order_Of_Source_Dirs then\n-                        Add_Src := False;\n-\n-                     elsif Unit /= No_Name then\n-                        Error_Msg_Name_1 := Unit;\n-                        Error_Msg\n-                          (Project, In_Tree, \"duplicate unit %%\",\n-                           No_Location);\n-                        Add_Src := False;\n+                     if Unit = No_Name then\n+                        if Allow_Duplicate_Basenames then\n+                           Add_Src := True;\n+                        elsif Project.Known_Order_Of_Source_Dirs then\n+                           Add_Src := False;\n+                        else\n+                           Error_Msg_File_1 := File_Name;\n+                           Error_Msg\n+                             (Project, In_Tree, \"duplicate source file name {\",\n+                              No_Location);\n+                           Add_Src := False;\n+                        end if;\n \n                      else\n-                        Error_Msg_File_1 := File_Name;\n-                        Error_Msg\n-                          (Project, In_Tree, \"duplicate source file name {\",\n-                           No_Location);\n-                        Add_Src := False;\n+                        if Project.Known_Order_Of_Source_Dirs then\n+                           Add_Src := False;\n+                        else\n+                           Error_Msg_Name_1 := Unit;\n+                           Error_Msg\n+                             (Project, In_Tree, \"duplicate unit %%\",\n+                              No_Location);\n+                           Add_Src := False;\n+                        end if;\n                      end if;\n \n                      --  Do not allow the same unit name in different projects,\n@@ -7539,7 +7553,6 @@ package body Prj.Nmsc is\n                   Alternate_Languages => Alternate_Languages,\n                   File_Name           => File_Name,\n                   Display_File        => Display_File_Name,\n-                  Other_Part          => Other_Part,\n                   Unit                => Unit,\n                   Path                => (Canonical_Path, Path),\n                   Source_To_Replace   => Source_To_Replace);\n@@ -7555,7 +7568,8 @@ package body Prj.Nmsc is\n    procedure Search_Directories\n      (Project         : Project_Id;\n       In_Tree         : Project_Tree_Ref;\n-      For_All_Sources : Boolean)\n+      For_All_Sources : Boolean;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Source_Dir        : String_List_Id;\n       Element           : String_Element;\n@@ -7663,7 +7677,9 @@ package body Prj.Nmsc is\n                                  Path              => Path,\n                                  File_Name         => File_Name,\n                                  Display_File_Name => Display_File_Name,\n-                                 For_All_Sources   => For_All_Sources);\n+                                 For_All_Sources   => For_All_Sources,\n+                                 Allow_Duplicate_Basenames =>\n+                                   Allow_Duplicate_Basenames);\n                            end if;\n                         end;\n                      end if;\n@@ -7761,7 +7777,8 @@ package body Prj.Nmsc is\n    procedure Look_For_Sources\n      (Project     : Project_Id;\n       In_Tree     : Project_Tree_Ref;\n-      Proc_Data   : in out Processing_Data)\n+      Proc_Data   : in out Processing_Data;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Iter : Source_Iterator;\n \n@@ -7914,15 +7931,15 @@ package body Prj.Nmsc is\n                   else\n                      case Src_Id.Kind is\n                         when Spec =>\n-                           if Src_Id.Other_Part = No_Source then\n+                           if Other_Part (Src_Id) = No_Source then\n                               Check_Object (Src_Id);\n                            end if;\n \n                         when Sep =>\n                            null;\n \n                         when Impl =>\n-                           if Src_Id.Other_Part /= No_Source then\n+                           if Other_Part (Src_Id) /= No_Source then\n                               Check_Object (Src_Id);\n \n                            else\n@@ -7966,7 +7983,7 @@ package body Prj.Nmsc is\n             Load_Naming_Exceptions (Project, In_Tree);\n          end if;\n \n-         Find_Sources (Project, In_Tree, Proc_Data);\n+         Find_Sources (Project, In_Tree, Proc_Data, Allow_Duplicate_Basenames);\n          Mark_Excluded_Sources;\n \n          if Get_Mode = Multi_Language then\n@@ -8198,8 +8215,7 @@ package body Prj.Nmsc is\n                Path                => (Canonical_Path, Path_Name),\n                Naming_Exception    => Needs_Pragma,\n                Kind                => Unit_Kind,\n-               Index               => Unit_Ind,\n-               Other_Part          => No_Source);  --  ??? Can we find file ?\n+               Index               => Unit_Ind);\n             Source_Recorded := True;\n          end if;\n       end Record_Unit;"}, {"sha": "dfb167ccf8ddc25cda37fa7f4d6ab4c48fe03499", "filename": "gcc/ada/prj-nmsc.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-nmsc.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-nmsc.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.ads?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -48,7 +48,8 @@ private package Prj.Nmsc is\n       Current_Dir     : String;\n       Proc_Data       : in out Processing_Data;\n       Is_Config_File  : Boolean;\n-      Compiler_Driver_Mandatory : Boolean);\n+      Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Perform consistency and semantic checks on a project, starting from the\n    --  project tree parsed from the .gpr file. This procedure interprets the\n    --  various case statements in the project based on the current environment\n@@ -74,6 +75,9 @@ private package Prj.Nmsc is\n    --  If Compiler_Driver_Mandatory is true, then a Compiler.Driver attribute\n    --  for each language must be defined, or we will not look for its source\n    --  files.\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n private\n    type Processing_Data is record"}, {"sha": "2946b42fb296077109eda1e5c0dbea15172f0fbe", "filename": "gcc/ada/prj-proc.adb", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-proc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-proc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.adb?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -84,11 +84,15 @@ package body Prj.Proc is\n       Current_Dir               : String;\n       When_No_Sources           : Error_Warning;\n       Is_Config_File            : Boolean;\n-      Compiler_Driver_Mandatory : Boolean);\n+      Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Set all projects to not checked, then call Recursive_Check for the\n    --  main project Project. Project is set to No_Project if errors occurred.\n    --  Current_Dir is for optimization purposes, avoiding extra system calls.\n    --  Is_Config_File should be True if Project is a config file (.cgpr).\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n    procedure Copy_Package_Declarations\n      (From              : Declarations;\n@@ -154,6 +158,7 @@ package body Prj.Proc is\n       Proc_Data                 : Processing_Data;\n       Is_Config_File            : Boolean;\n       Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean;\n    end record;\n    --  Data passed to Recursive_Check\n    --  Current_Dir is for optimization purposes, avoiding extra system calls.\n@@ -285,7 +290,8 @@ package body Prj.Proc is\n       Current_Dir     : String;\n       When_No_Sources : Error_Warning;\n       Is_Config_File  : Boolean;\n-      Compiler_Driver_Mandatory : Boolean)\n+      Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Dir : aliased String := Current_Dir;\n \n@@ -300,6 +306,7 @@ package body Prj.Proc is\n       Data.When_No_Sources           := When_No_Sources;\n       Data.Is_Config_File            := Is_Config_File;\n       Data.Compiler_Driver_Mandatory := Compiler_Driver_Mandatory;\n+      Data.Allow_Duplicate_Basenames := Allow_Duplicate_Basenames;\n \n       Initialize (Data.Proc_Data);\n \n@@ -330,8 +337,6 @@ package body Prj.Proc is\n \n                else\n                   Unit_Htable.Remove (Name);\n-                  Source1.Other_Part := Source2;\n-                  Source2.Other_Part := Source1;\n                end if;\n             end if;\n \n@@ -1263,6 +1268,7 @@ package body Prj.Proc is\n             When_No_Sources        => When_No_Sources,\n             Current_Dir            => Current_Dir,\n             Compiler_Driver_Mandatory => True,\n+            Allow_Duplicate_Basenames => False,\n             Is_Config_File         => Is_Config_File);\n       end if;\n    end Process;\n@@ -2318,7 +2324,8 @@ package body Prj.Proc is\n       When_No_Sources           : Error_Warning := Error;\n       Current_Dir               : String;\n       Is_Config_File            : Boolean;\n-      Compiler_Driver_Mandatory : Boolean)\n+      Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean)\n    is\n       Obj_Dir    : Path_Name_Type;\n       Extending  : Project_Id;\n@@ -2334,7 +2341,8 @@ package body Prj.Proc is\n       if Project /= No_Project then\n          Check (In_Tree, Project, Current_Dir, When_No_Sources,\n                 Is_Config_File            => Is_Config_File,\n-                Compiler_Driver_Mandatory => Compiler_Driver_Mandatory);\n+                Compiler_Driver_Mandatory => Compiler_Driver_Mandatory,\n+                Allow_Duplicate_Basenames => Allow_Duplicate_Basenames);\n       end if;\n \n       --  If main project is an extending all project, set the object\n@@ -2459,7 +2467,8 @@ package body Prj.Proc is\n         (Project, Data.In_Tree, Error_Report, Data.When_No_Sources,\n          Data.Current_Dir.all, Data.Proc_Data,\n          Compiler_Driver_Mandatory => Data.Compiler_Driver_Mandatory,\n-         Is_Config_File            => Data.Is_Config_File);\n+         Is_Config_File            => Data.Is_Config_File,\n+         Allow_Duplicate_Basenames => Data.Allow_Duplicate_Basenames);\n    end Recursive_Check;\n \n    -----------------------"}, {"sha": "ae69d968ff6cc1ef3e0eee196ed02955047131a1", "filename": "gcc/ada/prj-proc.ads", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-proc.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj-proc.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-proc.ads?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -67,7 +67,8 @@ package Prj.Proc is\n       When_No_Sources           : Error_Warning := Error;\n       Current_Dir               : String;\n       Is_Config_File            : Boolean;\n-      Compiler_Driver_Mandatory : Boolean);\n+      Compiler_Driver_Mandatory : Boolean;\n+      Allow_Duplicate_Basenames : Boolean);\n    --  Perform the second phase of the processing, filling the rest of the\n    --  project with the information extracted from the project tree. This phase\n    --  requires that the configuration file has already been parsed (in fact\n@@ -78,6 +79,10 @@ package Prj.Proc is\n    --  Current_Dir is for optimization purposes, avoiding extra system calls.\n    --\n    --  Is_Config_File should be true if Project is a config file (.cgpr)\n+   --\n+   --  If Allow_Duplicate_Basenames, then files with the same base names are\n+   --  authorized within a project for source-based languages (never for unit\n+   --  based languages)\n \n    procedure Process\n      (In_Tree                : Project_Tree_Ref;"}, {"sha": "f1cc450276c0fdfd11713d83606d1d0b2fb85099", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 42, "deletions": 38, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c928785785d29202b33a7738adecff9a09c93738/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=c928785785d29202b33a7738adecff9a09c93738", "patch": "@@ -308,7 +308,8 @@ package Prj is\n    --  Constant indicating that there is no language data\n \n    function Get_Language_From_Name\n-     (Project : Project_Id; Name : String) return Language_Ptr;\n+     (Project : Project_Id;\n+      Name    : String) return Language_Ptr;\n    --  Get a language from a project. This might return null if no such\n    --  language exists in the project\n \n@@ -399,8 +400,13 @@ package Prj is\n \n    function Is_Compilable (Source : Source_Id) return Boolean;\n    pragma Inline (Is_Compilable);\n-   --  Return True if we know how to compile Source (ie if a compiler is\n-   --  defined). This doesn't indicate whether the source should be compiled\n+   --  Return True if we know how to compile Source (i.e. if a compiler is\n+   --  defined). This doesn't indicate whether the source should be compiled.\n+\n+   function Other_Part (Source : Source_Id) return Source_Id;\n+   pragma Inline (Other_Part);\n+   --  Source ID for the other part, if any: for a spec, indicates its body;\n+   --  for a body, indicates its spec.\n \n    No_Source : constant Source_Id := null;\n \n@@ -638,103 +644,102 @@ package Prj is\n    --  GNAT Project File(s).\n \n    type Source_Data is record\n-      Project             : Project_Id            := No_Project;\n+      Project                : Project_Id          := No_Project;\n       --  Project of the source\n \n-      Language            : Language_Ptr        := No_Language_Index;\n+      Language               : Language_Ptr        := No_Language_Index;\n       --  Index of the language. This is an index into\n       --  Project_Tree.Languages_Data.\n \n-      In_Interfaces       : Boolean               := True;\n+      In_Interfaces          : Boolean             := True;\n       --  False when the source is not included in interfaces, when attribute\n       --  Interfaces is declared.\n \n-      Declared_In_Interfaces : Boolean            := False;\n+      Declared_In_Interfaces : Boolean             := False;\n       --  True when source is declared in attribute Interfaces\n \n-      Alternate_Languages : Language_List;\n+      Alternate_Languages    : Language_List;\n       --  List of languages a header file may also be, in addition of language\n       --  Language_Name.\n \n-      Kind                : Source_Kind           := Spec;\n+      Kind                   : Source_Kind         := Spec;\n       --  Kind of the source: spec, body or subunit\n \n-      Other_Part          : Source_Id             := No_Source;\n-      --  Source ID for the other part, if any: for a spec, indicates its body;\n-      --  for a body, indicates its spec.\n-\n-      Unit                : Unit_Index               := No_Unit_Index;\n+      Unit                   : Unit_Index          := No_Unit_Index;\n       --  Name of the unit, if language is unit based\n \n-      Index               : Int                   := 0;\n-      --  Index of the source in a multi unit source file\n+      Index                  : Int                 := 0;\n+      --  Index of the source in a multi unit source file (the same Source_Data\n+      --  is duplicated several times when there are several units in the same\n+      --  file). Index is 0 if there is either no unit or a single one, and\n+      --  starts at 1 when there are multiple units\n \n-      Locally_Removed     : Boolean               := False;\n+      Locally_Removed        : Boolean             := False;\n       --  True if the source has been \"excluded\"\n \n-      Get_Object          : Boolean               := False;\n+      Get_Object             : Boolean             := False;\n       --  Indicates that the object of the source should be put in the global\n       --  archive. This is for Ada, when only the closure of a main needs to\n       --  be compiled/recompiled.\n \n-      Replaced_By         : Source_Id             := No_Source;\n+      Replaced_By            : Source_Id           := No_Source;\n \n-      File                : File_Name_Type        := No_File;\n+      File                   : File_Name_Type      := No_File;\n       --  Canonical file name of the source\n \n-      Display_File        : File_Name_Type        := No_File;\n+      Display_File           : File_Name_Type      := No_File;\n       --  File name of the source, for display purposes\n \n-      Path                : Path_Information      := No_Path_Information;\n+      Path                   : Path_Information    := No_Path_Information;\n       --  Path name of the source\n       --  Path.Name is set to Slash for an excluded file that does not belong\n       --  in the project in fact\n \n-      Source_TS           : Time_Stamp_Type       := Empty_Time_Stamp;\n+      Source_TS              : Time_Stamp_Type     := Empty_Time_Stamp;\n       --  Time stamp of the source file\n \n-      Object_Project      : Project_Id            := No_Project;\n+      Object_Project         : Project_Id          := No_Project;\n       --  Project where the object file is. This might be different from\n       --  Project when using extending project files.\n \n-      Object              : File_Name_Type        := No_File;\n+      Object                 : File_Name_Type      := No_File;\n       --  File name of the object file\n \n-      Current_Object_Path : Path_Name_Type        := No_Path;\n+      Current_Object_Path    : Path_Name_Type      := No_Path;\n       --  Object path of an existing object file\n \n-      Object_Path         : Path_Name_Type        := No_Path;\n+      Object_Path            : Path_Name_Type      := No_Path;\n       --  Object path of the real object file\n \n-      Object_TS           : Time_Stamp_Type       := Empty_Time_Stamp;\n+      Object_TS              : Time_Stamp_Type     := Empty_Time_Stamp;\n       --  Object file time stamp\n \n-      Dep_Name            : File_Name_Type        := No_File;\n+      Dep_Name               : File_Name_Type      := No_File;\n       --  Dependency file simple name\n \n-      Current_Dep_Path    : Path_Name_Type        := No_Path;\n+      Current_Dep_Path       : Path_Name_Type      := No_Path;\n       --  Path name of an existing dependency file\n \n-      Dep_Path            : Path_Name_Type        := No_Path;\n+      Dep_Path               : Path_Name_Type      := No_Path;\n       --  Path name of the real dependency file\n \n-      Dep_TS              : Time_Stamp_Type       := Empty_Time_Stamp;\n+      Dep_TS                 : Time_Stamp_Type     := Empty_Time_Stamp;\n       --  Dependency file time stamp\n \n-      Switches            : File_Name_Type        := No_File;\n+      Switches               : File_Name_Type      := No_File;\n       --  File name of the switches file. For all languages, this is a file\n       --  that ends with the .cswi extension.\n \n-      Switches_Path       : Path_Name_Type        := No_Path;\n+      Switches_Path          : Path_Name_Type      := No_Path;\n       --  Path name of the switches file\n \n-      Switches_TS         : Time_Stamp_Type       := Empty_Time_Stamp;\n+      Switches_TS            : Time_Stamp_Type     := Empty_Time_Stamp;\n       --  Switches file time stamp\n \n-      Naming_Exception    : Boolean               := False;\n+      Naming_Exception       : Boolean             := False;\n       --  True if the source has an exceptional name\n \n-      Next_In_Lang        : Source_Id             := No_Source;\n+      Next_In_Lang           : Source_Id           := No_Source;\n       --  Link to another source of the same language in the same project\n    end record;\n \n@@ -745,7 +750,6 @@ package Prj is\n                        Declared_In_Interfaces => False,\n                        Alternate_Languages    => null,\n                        Kind                   => Spec,\n-                       Other_Part             => No_Source,\n                        Unit                   => No_Unit_Index,\n                        Index                  => 0,\n                        Locally_Removed        => False,"}]}