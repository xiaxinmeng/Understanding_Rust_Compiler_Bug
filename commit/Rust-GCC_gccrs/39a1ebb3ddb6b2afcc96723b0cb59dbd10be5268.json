{"sha": "39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzlhMWViYjNkZGI2YjJhZmNjOTY3MjNiMGNiNTlkYmQxMGJlNTI2OA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-03-13T20:56:06Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-03-13T20:56:06Z"}, "message": "re PR middle-end/36282 (Spurious warning \"asm declaration ignored due to conflict with previous rename\")\n\n\tPR middle-end/36282\n\t* c-pragma.c (apply_pragma_weak): Only look at\n\tTREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (decl)) if\n\tDECL_ASSEMBLER_NAME_SET_P (decl).\n\t(maybe_apply_pending_pragma_weaks): Exit early if\n\tvec_safe_is_empty (pending_weaks) rather than only when\n\t!pending_weaks.\n\t(maybe_apply_pragma_weak): Likewise.  If !DECL_ASSEMBLER_NAME_SET_P,\n\tset assembler name back to NULL afterwards.\n\n\t* c-c++-common/pr36282-1.c: New test.\n\t* c-c++-common/pr36282-2.c: New test.\n\t* c-c++-common/pr36282-3.c: New test.\n\t* c-c++-common/pr36282-4.c: New test.\n\nFrom-SVN: r208557", "tree": {"sha": "8f7c0d3df37b36ddc8cdb15d240d700dcfbb3b2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8f7c0d3df37b36ddc8cdb15d240d700dcfbb3b2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3386d77eb83f3043afcc46503356165bc5ddfdba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3386d77eb83f3043afcc46503356165bc5ddfdba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3386d77eb83f3043afcc46503356165bc5ddfdba"}], "stats": {"total": 81, "additions": 78, "deletions": 3}, "files": [{"sha": "4e5aea468415321d754548d2b31cca092e856554", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -1,3 +1,15 @@\n+2014-03-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/36282\n+\t* c-pragma.c (apply_pragma_weak): Only look at\n+\tTREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (decl)) if\n+\tDECL_ASSEMBLER_NAME_SET_P (decl).\n+\t(maybe_apply_pending_pragma_weaks): Exit early if\n+\tvec_safe_is_empty (pending_weaks) rather than only when\n+\t!pending_weaks.\n+\t(maybe_apply_pragma_weak): Likewise.  If !DECL_ASSEMBLER_NAME_SET_P,\n+\tset assembler name back to NULL afterwards.\n+\n 2014-03-11  Jason Merrill  <jason@redhat.com>\n \n \t* c.opt: Add -std=gnu++14."}, {"sha": "9e2a00eb16e122b178387d2adf48b38e33251269", "filename": "gcc/c-family/c-pragma.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Fc-family%2Fc-pragma.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Fc-family%2Fc-pragma.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-pragma.c?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -263,6 +263,7 @@ apply_pragma_weak (tree decl, tree value)\n \n   if (SUPPORTS_WEAK && DECL_EXTERNAL (decl) && TREE_USED (decl)\n       && !DECL_WEAK (decl) /* Don't complain about a redundant #pragma.  */\n+      && DECL_ASSEMBLER_NAME_SET_P (decl)\n       && TREE_SYMBOL_REFERENCED (DECL_ASSEMBLER_NAME (decl)))\n     warning (OPT_Wpragmas, \"applying #pragma weak %q+D after first use \"\n \t     \"results in unspecified behavior\", decl);\n@@ -280,7 +281,7 @@ maybe_apply_pragma_weak (tree decl)\n   /* Avoid asking for DECL_ASSEMBLER_NAME when it's not needed.  */\n \n   /* No weak symbols pending, take the short-cut.  */\n-  if (!pending_weaks)\n+  if (vec_safe_is_empty (pending_weaks))\n     return;\n   /* If it's not visible outside this file, it doesn't matter whether\n      it's weak.  */\n@@ -292,7 +293,13 @@ maybe_apply_pragma_weak (tree decl)\n   if (TREE_CODE (decl) != FUNCTION_DECL && TREE_CODE (decl) != VAR_DECL)\n     return;\n \n-  id = DECL_ASSEMBLER_NAME (decl);\n+  if (DECL_ASSEMBLER_NAME_SET_P (decl))\n+    id = DECL_ASSEMBLER_NAME (decl);\n+  else\n+    {\n+      id = DECL_ASSEMBLER_NAME (decl);\n+      SET_DECL_ASSEMBLER_NAME (decl, NULL_TREE);\n+    }\n \n   FOR_EACH_VEC_ELT (*pending_weaks, i, pe)\n     if (id == pe->name)\n@@ -313,7 +320,7 @@ maybe_apply_pending_pragma_weaks (void)\n   pending_weak *pe;\n   symtab_node *target;\n \n-  if (!pending_weaks)\n+  if (vec_safe_is_empty (pending_weaks))\n     return;\n \n   FOR_EACH_VEC_ELT (*pending_weaks, i, pe)"}, {"sha": "3df9dbb1ed13db3dfc78b592f26d075097ef07bd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -1,3 +1,11 @@\n+2014-03-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/36282\n+\t* c-c++-common/pr36282-1.c: New test.\n+\t* c-c++-common/pr36282-2.c: New test.\n+\t* c-c++-common/pr36282-3.c: New test.\n+\t* c-c++-common/pr36282-4.c: New test.\n+\n 2014-03-13  Richard Henderson  <rth@redhat.com>\n \n \tPR debug/60438"}, {"sha": "abe11e7ec7f3c7d0c8f8abd04c73512237fc6308", "filename": "gcc/testsuite/c-c++-common/pr36282-1.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-1.c?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -0,0 +1,12 @@\n+/* PR middle-end/36282 */\n+/* { dg-do compile } */\n+\n+#pragma weak bar\n+\n+extern void *baz (void *dest, const void *src, __SIZE_TYPE__ n);\n+extern __typeof (baz) baz __asm(\"bazfn\"); /* { dg-bogus \"asm declaration ignored due to conflict with previous rename\" } */\n+\n+void\n+foo (void)\n+{\n+}"}, {"sha": "86d3ad657a31e5f45dc39eb0422e55aaeb3df5d6", "filename": "gcc/testsuite/c-c++-common/pr36282-2.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-2.c?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -0,0 +1,10 @@\n+/* PR middle-end/36282 */\n+/* { dg-do compile } */\n+\n+extern void *baz (void *dest, const void *src, __SIZE_TYPE__ n);\n+extern __typeof (baz) baz __asm(\"bazfn\"); /* { dg-bogus \"asm declaration ignored due to conflict with previous rename\" } */\n+\n+void\n+foo (void)\n+{\n+}"}, {"sha": "8982470c0905cfdbc0ef99ef5266dcb888768319", "filename": "gcc/testsuite/c-c++-common/pr36282-3.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-3.c?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -0,0 +1,13 @@\n+/* PR middle-end/36282 */\n+/* { dg-do compile } */\n+\n+void bar (void);\n+#pragma weak bar\n+\n+extern void *baz (void *dest, const void *src, __SIZE_TYPE__ n);\n+extern __typeof (baz) baz __asm(\"bazfn\"); /* { dg-bogus \"asm declaration ignored due to conflict with previous rename\" } */\n+\n+void\n+foo (void)\n+{\n+}"}, {"sha": "f6f40f8e4aaceeba02f9885ee1ebf34f4c54b3b6", "filename": "gcc/testsuite/c-c++-common/pr36282-4.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr36282-4.c?ref=39a1ebb3ddb6b2afcc96723b0cb59dbd10be5268", "patch": "@@ -0,0 +1,13 @@\n+/* PR middle-end/36282 */\n+/* { dg-do compile } */\n+\n+#pragma weak bar\n+void bar (void);\n+\n+extern void *baz (void *dest, const void *src, __SIZE_TYPE__ n);\n+extern __typeof (baz) baz __asm(\"bazfn\"); /* { dg-bogus \"asm declaration ignored due to conflict with previous rename\" } */\n+\n+void\n+foo (void)\n+{\n+}"}]}