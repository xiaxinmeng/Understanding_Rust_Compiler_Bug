{"sha": "741bbaabaffa7db912a775077897ad72611471f3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQxYmJhYWJhZmZhN2RiOTEyYTc3NTA3Nzg5N2FkNzI2MTE0NzFmMw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2017-09-12T19:45:37Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2017-09-12T19:45:37Z"}, "message": "re PR c++/70621 (ICE on invalid code at -O1 and above on x86_64-linux-gnu in record_reference, at cgraphbuild.c:64)\n\n/cp\n2017-09-12  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/70621\n\t* decl.c (start_decl): Early return error_mark_node if duplicate_decls\n\treturns it; avoid misleading error message.\n\n/testsuite\n2017-09-12  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/70621\n\t* g++.dg/torture/pr70621.C: New.\n\nFrom-SVN: r252040", "tree": {"sha": "ddb77920f0aab7399253ed4730486aa0436fa910", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ddb77920f0aab7399253ed4730486aa0436fa910"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/741bbaabaffa7db912a775077897ad72611471f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/741bbaabaffa7db912a775077897ad72611471f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/741bbaabaffa7db912a775077897ad72611471f3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/741bbaabaffa7db912a775077897ad72611471f3/comments", "author": null, "committer": null, "parents": [{"sha": "18a4e7e305c1e12392ac35073b89f2ca0e7f8eda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18a4e7e305c1e12392ac35073b89f2ca0e7f8eda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18a4e7e305c1e12392ac35073b89f2ca0e7f8eda"}], "stats": {"total": 33, "additions": 29, "deletions": 4}, "files": [{"sha": "56ecf72b81647c74c311d965147c3d44578b6837", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=741bbaabaffa7db912a775077897ad72611471f3", "patch": "@@ -1,3 +1,9 @@\n+2017-09-12  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/70621\n+\t* decl.c (start_decl): Early return error_mark_node if duplicate_decls\n+\treturns it; avoid misleading error message.\n+\n 2017-09-12  Nathan Sidwell  <nathan@acm.org>\n \n \tKill CLASSTYPE_SORTED_FIELDS."}, {"sha": "6101bdf2bc83a13b615a68de7fac7d3af14a1fb1", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=741bbaabaffa7db912a775077897ad72611471f3", "patch": "@@ -5022,11 +5022,12 @@ start_decl (const cp_declarator *declarator,\n \t\t about this situation, and so we check here.  */\n \t      if (initialized && DECL_INITIALIZED_IN_CLASS_P (field))\n \t\terror (\"duplicate initialization of %qD\", decl);\n-\t      if (duplicate_decls (decl, field, /*newdecl_is_friend=*/false))\n+\t      field = duplicate_decls (decl, field,\n+\t\t\t\t       /*newdecl_is_friend=*/false);\n+\t      if (field == error_mark_node)\n+\t\treturn error_mark_node;\n+\t      else if (field)\n \t\tdecl = field;\n-              if (decl_spec_seq_has_spec_p (declspecs, ds_constexpr)\n-                  && !DECL_DECLARED_CONSTEXPR_P (field))\n-                error (\"%qD declared %<constexpr%> outside its class\", field);\n \t    }\n \t}\n       else"}, {"sha": "dc5ae01a641365f0115e9d5d0d43adf0807cad36", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=741bbaabaffa7db912a775077897ad72611471f3", "patch": "@@ -1,3 +1,8 @@\n+017-09-12  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/70621\n+\t* g++.dg/torture/pr70621.C: New.\n+\n 2017-09-12  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/82173"}, {"sha": "63eb92805f6e1b776ec87b6e67c4c4c14dc40cda", "filename": "gcc/testsuite/g++.dg/torture/pr70621.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr70621.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/741bbaabaffa7db912a775077897ad72611471f3/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr70621.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr70621.C?ref=741bbaabaffa7db912a775077897ad72611471f3", "patch": "@@ -0,0 +1,13 @@\n+float foo();\n+\n+struct A\n+{\n+  static float x;  // { dg-message \"previous declaration\" }\n+};\n+\n+double A::x = foo();  // { dg-error \"conflicting declaration\" }\n+\n+void bar()\n+{\n+  A::x = 0;\n+}"}]}