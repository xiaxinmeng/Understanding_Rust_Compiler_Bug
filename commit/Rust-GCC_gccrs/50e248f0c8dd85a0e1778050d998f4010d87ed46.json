{"sha": "50e248f0c8dd85a0e1778050d998f4010d87ed46", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBlMjQ4ZjBjOGRkODVhMGUxNzc4MDUwZDk5OGY0MDEwZDg3ZWQ0Ng==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2017-11-01T17:09:14Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2017-11-01T17:09:14Z"}, "message": "PR libstdc++/82777 fix path normalization for dot-dot\n\n\tPR libstdc++/82777\n\t* src/filesystem/std-path.cc (path::lexically_normal): Remove dot-dot\n\telements correctly.\n\t* testsuite/27_io/filesystem/path/generation/normal.cc: Add testcase.\n\t* testsuite/util/testsuite_fs.h (compare_paths): Improve exception\n\ttext.\n\nFrom-SVN: r254317", "tree": {"sha": "16c56de4fe2646dcaa19c9f79c802bcde54acda5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/16c56de4fe2646dcaa19c9f79c802bcde54acda5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50e248f0c8dd85a0e1778050d998f4010d87ed46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50e248f0c8dd85a0e1778050d998f4010d87ed46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50e248f0c8dd85a0e1778050d998f4010d87ed46", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50e248f0c8dd85a0e1778050d998f4010d87ed46/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "37a2c475252b26895732fefbbb0050c864ba698d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37a2c475252b26895732fefbbb0050c864ba698d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37a2c475252b26895732fefbbb0050c864ba698d"}], "stats": {"total": 48, "additions": 43, "deletions": 5}, "files": [{"sha": "9805e4ba6647cab35e1dac5a94c1cf9bc0c822a7", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=50e248f0c8dd85a0e1778050d998f4010d87ed46", "patch": "@@ -1,3 +1,12 @@\n+2017-11-01  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/82777\n+\t* src/filesystem/std-path.cc (path::lexically_normal): Remove dot-dot\n+\telements correctly.\n+\t* testsuite/27_io/filesystem/path/generation/normal.cc: Add testcase.\n+\t* testsuite/util/testsuite_fs.h (compare_paths): Improve exception\n+\ttext.\n+\n 2017-10-30  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* include/Makefile.am (stamp-bits-sup): Do not create broken symlink"}, {"sha": "330aee72b139efc96cab13539a7c2526a68fea64", "filename": "libstdc++-v3/src/filesystem/std-path.cc", "status": "modified", "additions": 29, "deletions": 4, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fstd-path.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fstd-path.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fstd-path.cc?ref=50e248f0c8dd85a0e1778050d998f4010d87ed46", "patch": "@@ -388,10 +388,35 @@ path::lexically_normal() const\n #endif\n       if (is_dotdot(p))\n \t{\n-\t  if (ret.has_filename() && !is_dotdot(ret.filename()))\n-\t    ret.remove_filename();\n-\t  else if (ret.has_filename() || !ret.has_root_directory())\n-\t    ret /= p;\n+\t  if (ret.has_filename())\n+\t    {\n+\t      // remove a non-dot-dot filename immediately followed by /..\n+\t      if (!is_dotdot(ret.filename()))\n+\t\tret.remove_filename();\n+\t      else\n+\t\tret /= p;\n+\t    }\n+\t  else if (!ret.has_relative_path())\n+\t    {\n+\t      if (!ret.is_absolute())\n+\t\tret /= p;\n+\t    }\n+\t  else\n+\t    {\n+\t      // Got a path with a relative path (i.e. at least one non-root\n+\t      // element) and no filename at the end (i.e. empty last element),\n+\t      // so must have a trailing slash. See what is before it.\n+\t      auto elem = std::prev(ret.end(), 2);\n+\t      if (elem->has_filename() && !is_dotdot(*elem))\n+\t\t{\n+\t\t  // Remove the filename before the trailing slash\n+\t\t  // (equiv. to ret = ret.parent_path().remove_filename())\n+\t\t  ret._M_pathname.erase(elem._M_cur->_M_pos);\n+\t\t  ret._M_cmpts.erase(elem._M_cur, ret._M_cmpts.end());\n+\t\t}\n+\t      else // ???\n+\t\tret /= p;\n+\t    }\n \t}\n       else if (is_dot(p))\n \tret /= path();"}, {"sha": "df3b7154ab3e20f2c5587aafa1fcf8db154cf6f1", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/generation/normal.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fgeneration%2Fnormal.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fgeneration%2Fnormal.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fgeneration%2Fnormal.cc?ref=50e248f0c8dd85a0e1778050d998f4010d87ed46", "patch": "@@ -46,6 +46,10 @@ test02()\n   compare_paths( path().lexically_normal(), \"\" );\n \n   compare_paths( path(\"/..\").lexically_normal(), \"/\" );\n+\n+  // PR libstdc++/82777\n+  compare_paths( path(\"./a/b/c/../.././b/c\").lexically_normal(), \"a/b/c\" );\n+  compare_paths( path(\"/a/b/c/../.././b/c\").lexically_normal(), \"/a/b/c\" );\n }\n \n void"}, {"sha": "c18dae28fcc909ac10a6581feee2344dd5a6439b", "filename": "libstdc++-v3/testsuite/util/testsuite_fs.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_fs.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50e248f0c8dd85a0e1778050d998f4010d87ed46/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_fs.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_fs.h?ref=50e248f0c8dd85a0e1778050d998f4010d87ed46", "patch": "@@ -40,7 +40,7 @@ namespace __gnu_test\n {\n #define PATH_CHK(p1, p2, fn) \\\n     if ( p1.fn() != p2.fn() ) \\\n-      throw test_fs::filesystem_error( #fn, p1, p2, \\\n+      throw test_fs::filesystem_error(\"comparing '\" #fn \"' failed\", p1, p2, \\\n \t  std::make_error_code(std::errc::invalid_argument) )\n \n   void"}]}