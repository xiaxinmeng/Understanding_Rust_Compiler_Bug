{"sha": "7569ce583f540ae22c585cc5159e3b23deedd987", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzU2OWNlNTgzZjU0MGFlMjJjNTg1Y2M1MTU5ZTNiMjNkZWVkZDk4Nw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-04-12T11:49:17Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-04-12T12:31:17Z"}, "message": "libstdc++: Implement LWG 3404 for C++20 subrange [PR 100044]\n\nThese deduction guides became useless with LWG 3282 (implemented in\ncommit r10-6741) and so were removed by LWG 3404.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/100044\n\t* include/bits/ranges_util.h (__detail::__iterator_sentinel_pair):\n\tRemove helper concept.\n\t(subrange(_Pr), subrange(Pr, __make_unsigned_like<...>)): Remove\n\tdeduction guides, as per LWG 3404.\n\t* testsuite/std/ranges/subrange/lwg3282_neg.cc: Check that class\n\ttemplate argument deduction fails.", "tree": {"sha": "2060c4af90d8c20e0f6fadd6f8e34af0c1f10456", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2060c4af90d8c20e0f6fadd6f8e34af0c1f10456"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7569ce583f540ae22c585cc5159e3b23deedd987", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7569ce583f540ae22c585cc5159e3b23deedd987", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7569ce583f540ae22c585cc5159e3b23deedd987", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7569ce583f540ae22c585cc5159e3b23deedd987/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c35444b919683be23208479312a45e73d23ed35", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c35444b919683be23208479312a45e73d23ed35", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c35444b919683be23208479312a45e73d23ed35"}], "stats": {"total": 28, "additions": 13, "deletions": 15}, "files": [{"sha": "9d51e1b874eae3228438ffeb75e475e846365d55", "filename": "libstdc++-v3/include/bits/ranges_util.h", "status": "modified", "additions": 0, "deletions": 15, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7569ce583f540ae22c585cc5159e3b23deedd987/libstdc%2B%2B-v3%2Finclude%2Fbits%2Franges_util.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7569ce583f540ae22c585cc5159e3b23deedd987/libstdc%2B%2B-v3%2Finclude%2Fbits%2Franges_util.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Franges_util.h?ref=7569ce583f540ae22c585cc5159e3b23deedd987", "patch": "@@ -186,11 +186,6 @@ namespace ranges\n \t&& __convertible_to_non_slicing<_Up, tuple_element_t<0, _Tp>>\n \t&& convertible_to<_Vp, tuple_element_t<1, _Tp>>;\n \n-    template<typename _Tp>\n-      concept __iterator_sentinel_pair\n-\t= !range<_Tp> && __pair_like<_Tp>\n-\t&& sentinel_for<tuple_element_t<1, _Tp>, tuple_element_t<0, _Tp>>;\n-\n   } // namespace __detail\n \n   enum class subrange_kind : bool { unsized, sized };\n@@ -352,16 +347,6 @@ namespace ranges\n \t     __detail::__make_unsigned_like_t<iter_difference_t<_It>>)\n       -> subrange<_It, _Sent, subrange_kind::sized>;\n \n-  template<__detail::__iterator_sentinel_pair _Pr>\n-    subrange(_Pr)\n-      -> subrange<tuple_element_t<0, _Pr>, tuple_element_t<1, _Pr>>;\n-\n-  template<__detail::__iterator_sentinel_pair _Pr>\n-    subrange(_Pr, __detail::__make_unsigned_like_t<iter_difference_t<\n-\t\t\t\t\t\t     tuple_element_t<0, _Pr>>>)\n-      -> subrange<tuple_element_t<0, _Pr>, tuple_element_t<1, _Pr>,\n-\t\t  subrange_kind::sized>;\n-\n   template<borrowed_range _Rng>\n     subrange(_Rng&&)\n       -> subrange<iterator_t<_Rng>, sentinel_t<_Rng>,"}, {"sha": "170f4d2962b6d651fb161f2cf2d0dd3d5d9b9f75", "filename": "libstdc++-v3/testsuite/std/ranges/subrange/lwg3282_neg.cc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7569ce583f540ae22c585cc5159e3b23deedd987/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fsubrange%2Flwg3282_neg.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7569ce583f540ae22c585cc5159e3b23deedd987/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fsubrange%2Flwg3282_neg.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fstd%2Franges%2Fsubrange%2Flwg3282_neg.cc?ref=7569ce583f540ae22c585cc5159e3b23deedd987", "patch": "@@ -29,3 +29,16 @@ struct Base {};\n struct Derived : Base {};\n subrange<Derived*> sd;\n subrange<Base*> sb = sd; // { dg-error \"conversion\" }\n+\n+void\n+test_lwg3404()\n+{\n+  // LWG 3404. Finish removing subrange's conversions from pair-like\n+  std::pair<char*, char*> p;\n+  subrange sb1(p);\t\t\t// { dg-error \"no matching function\" }\n+  // { dg-error \"class template argument deduction\" \"\" { target *-*-* } 38 }\n+  subrange sb2(p, p.second - p.first);\t// { dg-error \"no matching function\" }\n+  // { dg-error \"class template argument deduction\" \"\" { target *-*-* } 40 }\n+\n+  // { dg-prune-output \"in requirements with\" }\n+}"}]}