{"sha": "895548a571810f574a7f2a5ebdf6efa3250fa993", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODk1NTQ4YTU3MTgxMGY1NzRhN2YyYTVlYmRmNmVmYTMyNTBmYTk5Mw==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2015-11-24T11:03:51Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2015-11-24T11:03:51Z"}, "message": "[cfgloop] PR middle-end/68375: Restructure get_loop_body_in_bfs_order to handle loops with only a header\n\n\tPR middle-end/68375\n\t* cfgloop.c (get_loop_body_in_bfs_order): Restructure loop to avoid\n\tbogus assertion.\n\n\t* gcc.dg/pr68375.c: New test.\n\nFrom-SVN: r230798", "tree": {"sha": "764f838fee6d420fb2d792bc03d1db13516096df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/764f838fee6d420fb2d792bc03d1db13516096df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/895548a571810f574a7f2a5ebdf6efa3250fa993", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/895548a571810f574a7f2a5ebdf6efa3250fa993", "html_url": "https://github.com/Rust-GCC/gccrs/commit/895548a571810f574a7f2a5ebdf6efa3250fa993", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/895548a571810f574a7f2a5ebdf6efa3250fa993/comments", "author": null, "committer": null, "parents": [{"sha": "3788cfb513d19a9b36311b1317aff2141a2c6a65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3788cfb513d19a9b36311b1317aff2141a2c6a65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3788cfb513d19a9b36311b1317aff2141a2c6a65"}], "stats": {"total": 70, "additions": 58, "deletions": 12}, "files": [{"sha": "cffa083cea49b9b5a0796aa0204868e03fafd35a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=895548a571810f574a7f2a5ebdf6efa3250fa993", "patch": "@@ -1,3 +1,10 @@\n+2015-11-24  Richard Biener  <rguenther@suse.de>\n+            Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR middle-end/68375\n+\t* cfgloop.c (get_loop_body_in_bfs_order): Restructure loop to avoid\n+\tbogus assertion.\n+\n 2015-11-24  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/68483"}, {"sha": "83a526276dbef8554b75709847645d844fbab4dd", "filename": "gcc/cfgloop.c", "status": "modified", "additions": 7, "deletions": 12, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2Fcfgloop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2Fcfgloop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloop.c?ref=895548a571810f574a7f2a5ebdf6efa3250fa993", "patch": "@@ -913,37 +913,32 @@ get_loop_body_in_bfs_order (const struct loop *loop)\n   basic_block *blocks;\n   basic_block bb;\n   bitmap visited;\n-  unsigned int i = 0;\n-  unsigned int vc = 1;\n+  unsigned int i = 1;\n+  unsigned int vc = 0;\n \n   gcc_assert (loop->num_nodes);\n   gcc_assert (loop->latch != EXIT_BLOCK_PTR_FOR_FN (cfun));\n \n   blocks = XNEWVEC (basic_block, loop->num_nodes);\n   visited = BITMAP_ALLOC (NULL);\n-\n-  bb = loop->header;\n+  blocks[0] = loop->header;\n+  bitmap_set_bit (visited, loop->header->index);\n   while (i < loop->num_nodes)\n     {\n       edge e;\n       edge_iterator ei;\n-\n-      if (bitmap_set_bit (visited, bb->index))\n-\t/* This basic block is now visited */\n-\tblocks[i++] = bb;\n+      gcc_assert (i > vc);\n+      bb = blocks[vc++];\n \n       FOR_EACH_EDGE (e, ei, bb->succs)\n \t{\n \t  if (flow_bb_inside_loop_p (loop, e->dest))\n \t    {\n+\t      /* This bb is now visited.  */\n \t      if (bitmap_set_bit (visited, e->dest->index))\n \t\tblocks[i++] = e->dest;\n \t    }\n \t}\n-\n-      gcc_assert (i > vc);\n-\n-      bb = blocks[vc++];\n     }\n \n   BITMAP_FREE (visited);"}, {"sha": "d5a1023b94d4b99a28c0b3dedc8eda95debc4363", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=895548a571810f574a7f2a5ebdf6efa3250fa993", "patch": "@@ -1,3 +1,8 @@\n+2015-11-24  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR middle-end/68375\n+\t* gcc.dg/pr68375.c: New test.\n+\n 2015-11-24  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/68483"}, {"sha": "bbbdd915ab18b0425c647233ea19342a12fa01e4", "filename": "gcc/testsuite/gcc.dg/pr68375.c", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2Ftestsuite%2Fgcc.dg%2Fpr68375.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/895548a571810f574a7f2a5ebdf6efa3250fa993/gcc%2Ftestsuite%2Fgcc.dg%2Fpr68375.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr68375.c?ref=895548a571810f574a7f2a5ebdf6efa3250fa993", "patch": "@@ -0,0 +1,39 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized-graph\" } */\n+\n+int a, c, d, e, g, h;\n+short f;\n+\n+int\n+foo ()\n+{\n+}\n+\n+short\n+fn1 (void)\n+{\n+  int j[2];\n+  for (; e; e++)\n+    if (j[0])\n+      for (;;)\n+\t;\n+  if (!g)\n+    return f;\n+}\n+\n+int\n+main (void)\n+{\n+  for (; a < 1; a++)\n+    {\n+      for (c = 0; c < 2; c++)\n+\t{\n+\t  d && (f = 0);\n+\t  h = fn1 ();\n+\t}\n+      __builtin_printf (\"%d\\n\", (char) f);\n+   }\n+\n+ return 0;\n+}\n+"}]}