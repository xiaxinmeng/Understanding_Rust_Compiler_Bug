{"sha": "6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmNhMzlmY2JmNmViNTFkMzlkODQ5MTZhNGM3NDJlMjBiYjJjOTFlMA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2007-11-23T19:15:09Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2007-11-23T19:15:09Z"}, "message": "re PR c++/5310 (Weird warnings about using (int)NULL)\n\n2007-11-23  Mark Mitchell  <mark@codesourcery.com>\n\t    Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n\t\n\tPR c++/5310\ncp/\n\t* call.c (convert_like_real): Build a zero constant when __null is\n\tconverted to an integer type.\ntestsuite/\n\t* g++.dg/warn/pr5310.C: New.\n\t* g++.dg/warn/pr33160.C: New\n\nCo-Authored-By: Manuel L\u00f3pez-Ib\u00e1\u00f1ez <manu@gcc.gnu.org>\n\nFrom-SVN: r130381", "tree": {"sha": "12066094a6cb3be14cb5a9561ed87af7a386beb5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/12066094a6cb3be14cb5a9561ed87af7a386beb5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/comments", "author": null, "committer": null, "parents": [{"sha": "f89935ed1786b2bc9e4d3fba30387343a4c4f312", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f89935ed1786b2bc9e4d3fba30387343a4c4f312", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f89935ed1786b2bc9e4d3fba30387343a4c4f312"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "0aff9b197cc1db19361d59ad98f3c0ed98377458", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "patch": "@@ -1,3 +1,10 @@\n+2007-11-23  Mark Mitchell  <mark@codesourcery.com>\n+\t    Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\t\n+\tPR c++/5310\n+\t* call.c (convert_like_real): Build a zero constant when __null is\n+\tconverted to an integer type.\n+\t\n 2007-11-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/34094"}, {"sha": "d240b85b03a7c1ca8e8009faae3b508776957194", "filename": "gcc/cp/call.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "patch": "@@ -4420,7 +4420,14 @@ convert_like_real (conversion *convs, tree expr, tree fn, int argnum,\n \t about to bind it to a reference, in which case we need to\n \t leave it as an lvalue.  */\n       if (inner >= 0)\n-\texpr = decl_constant_value (expr);\n+        {   \n+          expr = decl_constant_value (expr);\n+          if (expr == null_node && INTEGRAL_TYPE_P (totype))\n+            /* If __null has been converted to an integer type, we do not\n+               want to warn about uses of EXPR as an integer, rather than\n+               as a pointer.  */\n+            expr = build_int_cst (totype, 0);\n+        }\n       return expr;\n     case ck_ambig:\n       /* Call build_user_type_conversion again for the error.  */"}, {"sha": "5e5578d8867df06f99701d1a4724d031dc167f4c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "patch": "@@ -1,3 +1,10 @@\n+2007-11-23  Mark Mitchell  <mark@codesourcery.com>\n+\t    Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n+\t\n+\tPR c++/5310\n+\t* g++.dg/warn/pr5310.C: New.\n+\t* g++.dg/warn/pr33160.C: New.\n+\t\n 2007-11-23  Richard Guenther  <rguenther@suse.de>\n \tMichael Matz  <matz@suse.de>\n "}, {"sha": "e463e2dfd1ca17a6aba915a7a99da5a449d547ed", "filename": "gcc/testsuite/g++.dg/warn/pr33160.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr33160.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr33160.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr33160.C?ref=6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "patch": "@@ -0,0 +1,12 @@\n+// PR 33160\n+// { dg-do compile }\n+// { dg-options \"-Wall -Wextra -Wpointer-arith -pedantic -Wconversion\" }\n+\n+typedef int __attribute__((mode(pointer))) intptr_t;\n+int foo(void)\n+{\n+ intptr_t t = 0;\n+ if (t != ((intptr_t)__null)) t = 1;\n+ return 0;\n+}\n+"}, {"sha": "48a60062f1bf807b06d0f77c2755689cf33fe6b9", "filename": "gcc/testsuite/g++.dg/warn/pr5310.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr5310.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr5310.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2Fpr5310.C?ref=6ca39fcbf6eb51d39d84916a4c742e20bb2c91e0", "patch": "@@ -0,0 +1,11 @@\n+// PR 5310\n+// { dg-do compile }\n+// { dg-options \"-pedantic -Wall -Wextra -Wpointer-arith -Wconversion\" } \n+void foo (int);\n+void foo (long);\n+\n+void bar()\n+{\n+   foo ((int)__null);\n+   foo ((long)__null);\n+}"}]}