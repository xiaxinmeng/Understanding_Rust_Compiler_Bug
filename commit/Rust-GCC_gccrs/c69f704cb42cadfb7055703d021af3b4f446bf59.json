{"sha": "c69f704cb42cadfb7055703d021af3b4f446bf59", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzY5ZjcwNGNiNDJjYWRmYjcwNTU3MDNkMDIxYWYzYjRmNDQ2YmY1OQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2017-07-06T14:40:47Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2017-07-06T14:40:47Z"}, "message": "auto-profile.c (afdo_set_bb_count, [...]): Set counts/probabilities as determined by afdo.\n\n\n\t* auto-profile.c (afdo_set_bb_count, afdo_propagate_edge,\n\tafdo_annotate_cfg): Set counts/probabilities as determined by afdo.\n\nFrom-SVN: r250026", "tree": {"sha": "b32f381a192c1d6ff7e98a84badd0e37448a8177", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b32f381a192c1d6ff7e98a84badd0e37448a8177"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c69f704cb42cadfb7055703d021af3b4f446bf59", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c69f704cb42cadfb7055703d021af3b4f446bf59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c69f704cb42cadfb7055703d021af3b4f446bf59", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c69f704cb42cadfb7055703d021af3b4f446bf59/comments", "author": null, "committer": null, "parents": [{"sha": "9296dd9ba3106f5190eeeaf16dfa2b91a3ad318f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9296dd9ba3106f5190eeeaf16dfa2b91a3ad318f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9296dd9ba3106f5190eeeaf16dfa2b91a3ad318f"}], "stats": {"total": 15, "additions": 10, "deletions": 5}, "files": [{"sha": "4fd19e643db005ad2d088b9b58b871b1a67992e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c69f704cb42cadfb7055703d021af3b4f446bf59/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c69f704cb42cadfb7055703d021af3b4f446bf59/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c69f704cb42cadfb7055703d021af3b4f446bf59", "patch": "@@ -1,3 +1,8 @@\n+2017-07-06  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* auto-profile.c (afdo_set_bb_count, afdo_propagate_edge,\n+\tafdo_annotate_cfg): Set counts/probabilities as determined by afdo.\n+\n 2017-07-06  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \t* config/arm/arm-cpus.in (armv8-r): Add new entry."}, {"sha": "71c06f304490c8a82908d76178abe066b95f7625", "filename": "gcc/auto-profile.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c69f704cb42cadfb7055703d021af3b4f446bf59/gcc%2Fauto-profile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c69f704cb42cadfb7055703d021af3b4f446bf59/gcc%2Fauto-profile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fauto-profile.c?ref=c69f704cb42cadfb7055703d021af3b4f446bf59", "patch": "@@ -1151,7 +1151,7 @@ afdo_set_bb_count (basic_block bb, const stmt_set &promoted)\n   FOR_EACH_EDGE (e, ei, bb->succs)\n   afdo_source_profile->mark_annotated (e->goto_locus);\n \n-  bb->count = profile_count::from_gcov_type (max_count);\n+  bb->count = profile_count::from_gcov_type (max_count).afdo ();\n   return true;\n }\n \n@@ -1228,7 +1228,7 @@ afdo_propagate_edge (bool is_succ, bb_set *annotated_bb,\n     edge e, unknown_edge = NULL;\n     edge_iterator ei;\n     int num_unknown_edge = 0;\n-    profile_count total_known_count = profile_count::zero ();\n+    profile_count total_known_count = profile_count::zero ().afdo ();\n \n     FOR_EACH_EDGE (e, ei, is_succ ? bb->succs : bb->preds)\n       if (!is_edge_annotated (e, *annotated_edge))\n@@ -1350,7 +1350,7 @@ afdo_propagate_circuit (const bb_set &annotated_bb, edge_set *annotated_edge)\n \t      && !is_edge_annotated (ep, *annotated_edge))\n             {\n               ep->probability = profile_probability::never ();\n-              ep->count = profile_count::zero ();\n+              ep->count = profile_count::zero ().afdo ();\n               set_edge_annotated (ep, annotated_edge);\n             }\n         }\n@@ -1537,9 +1537,9 @@ afdo_annotate_cfg (const stmt_set &promoted_stmts)\n   if (s == NULL)\n     return;\n   cgraph_node::get (current_function_decl)->count\n-     = profile_count::from_gcov_type (s->head_count ());\n+     = profile_count::from_gcov_type (s->head_count ()).afdo ();\n   ENTRY_BLOCK_PTR_FOR_FN (cfun)->count\n-     = profile_count::from_gcov_type (s->head_count ());\n+     = profile_count::from_gcov_type (s->head_count ()).afdo ();\n   profile_count max_count = ENTRY_BLOCK_PTR_FOR_FN (cfun)->count;\n \n   FOR_EACH_BB_FN (bb, cfun)"}]}