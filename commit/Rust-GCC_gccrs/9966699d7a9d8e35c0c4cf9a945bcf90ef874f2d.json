{"sha": "9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTk2NjY5OWQ3YTlkOGUzNWMwYzRjZjlhOTQ1YmNmOTBlZjg3NGYyZA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2021-02-14T22:24:44Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2021-02-14T22:24:44Z"}, "message": "Fix memory leak in ipa-refernece\n\n2021-02-14  Jan Hubicka  <hubicka@ucw.cz>\n\t    Richard Biener  <rguether@suse.de>\n\n\tPR ipa/97346\n\t* ipa-reference.c (ipa_init): Only conditinally initialize\n\treference_vars_to_consider.\n\t(propagate): Conditionally deninitialize reference_vars_to_consider.\n\t(ipa_reference_write_optimization_summary): Sanity check that\n\treference_vars_to_consider is not allocated.", "tree": {"sha": "ccea6fc0d9125c254c87e2c6a23f8b8c7619cb06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ccea6fc0d9125c254c87e2c6a23f8b8c7619cb06"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d/comments", "author": null, "committer": null, "parents": [{"sha": "4e3590d06cf8a06fcc460ccda6150483a0311bae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e3590d06cf8a06fcc460ccda6150483a0311bae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e3590d06cf8a06fcc460ccda6150483a0311bae"}], "stats": {"total": 16, "additions": 11, "deletions": 5}, "files": [{"sha": "6cf78ff94a61c1fae23162ed1f6d871c75599257", "filename": "gcc/ipa-reference.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d/gcc%2Fipa-reference.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d/gcc%2Fipa-reference.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-reference.c?ref=9966699d7a9d8e35c0c4cf9a945bcf90ef874f2d", "patch": "@@ -458,8 +458,8 @@ ipa_init (void)\n \n   ipa_init_p = true;\n \n-  vec_alloc (reference_vars_to_consider, 10);\n-\n+  if (dump_file)\n+    vec_alloc (reference_vars_to_consider, 10);\n \n   if (ipa_ref_opt_sum_summaries != NULL)\n     {\n@@ -967,8 +967,12 @@ propagate (void)\n     }\n \n   if (dump_file)\n-    vec_free (reference_vars_to_consider);\n-  reference_vars_to_consider = NULL;\n+    {\n+      vec_free (reference_vars_to_consider);\n+      reference_vars_to_consider = NULL;\n+    }\n+  else\n+    gcc_checking_assert (!reference_vars_to_consider);\n   return remove_p ? TODO_remove_functions : 0;\n }\n \n@@ -1059,6 +1063,7 @@ ipa_reference_write_optimization_summary (void)\n   auto_bitmap ltrans_statics;\n   int i;\n \n+  gcc_checking_assert (!reference_vars_to_consider);\n   vec_alloc (reference_vars_to_consider, ipa_reference_vars_uids);\n   reference_vars_to_consider->safe_grow (ipa_reference_vars_uids, true);\n \n@@ -1117,7 +1122,8 @@ ipa_reference_write_optimization_summary (void)\n \t  }\n       }\n   lto_destroy_simple_output_block (ob);\n-  delete reference_vars_to_consider;\n+  vec_free (reference_vars_to_consider);\n+  reference_vars_to_consider = NULL;\n }\n \n /* Deserialize the ipa info for lto.  */"}]}