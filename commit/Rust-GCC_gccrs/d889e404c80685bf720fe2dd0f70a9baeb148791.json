{"sha": "d889e404c80685bf720fe2dd0f70a9baeb148791", "node_id": "C_kwDOANBUbNoAKGQ4ODllNDA0YzgwNjg1YmY3MjBmZTJkZDBmNzBhOWJhZWIxNDg3OTE", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-02-03T18:55:34Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-12T12:38:33Z"}, "message": "[Ada] Reuse generic string hash for invocation signatures\n\nUse a generic string hash routine for hashing of invocation signatures.\nThe System.String_Hash unit was added to GNAT in 2009 and shouldn't\ncause any bootstrap problems these days. To be safe, we don't use the\nGNAT.String_Hash renaming, which was added later.\n\nCleanup related to a new restriction No_Uninitialized_Local_Scalars,\nwhich will also rely on GNAT hash tables. Semantics is unaffected.\n\ngcc/ada/\n\n\t* ali.adb (Hash): Reuse GNAT.String_Hash.Hash and don't pollute\n\tthe Name_Id table.", "tree": {"sha": "e1536cfe5eec255ecf1e30d8d4b461800f343a21", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e1536cfe5eec255ecf1e30d8d4b461800f343a21"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d889e404c80685bf720fe2dd0f70a9baeb148791", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d889e404c80685bf720fe2dd0f70a9baeb148791", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d889e404c80685bf720fe2dd0f70a9baeb148791", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d889e404c80685bf720fe2dd0f70a9baeb148791/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3e51e753a61917e3f3b286740a39357ac8c954f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3e51e753a61917e3f3b286740a39357ac8c954f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3e51e753a61917e3f3b286740a39357ac8c954f"}], "stats": {"total": 20, "additions": 9, "deletions": 11}, "files": [{"sha": "984e9ca7c5a60c58c4d359265292b8f319197aa1", "filename": "gcc/ada/ali.adb", "status": "modified", "additions": 9, "deletions": 11, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d889e404c80685bf720fe2dd0f70a9baeb148791/gcc%2Fada%2Fali.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d889e404c80685bf720fe2dd0f70a9baeb148791/gcc%2Fada%2Fali.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fali.adb?ref=d889e404c80685bf720fe2dd0f70a9baeb148791", "patch": "@@ -33,6 +33,7 @@ with Snames; use Snames;\n \n with GNAT;                 use GNAT;\n with GNAT.Dynamic_HTables; use GNAT.Dynamic_HTables;\n+with System.String_Hash;\n \n package body ALI is\n \n@@ -578,20 +579,18 @@ package body ALI is\n    function Hash\n      (IS_Rec : Invocation_Signature_Record) return Bucket_Range_Type\n    is\n+      function String_Hash is new System.String_Hash.Hash\n+        (Char_Type => Character,\n+         Key_Type  => String,\n+         Hash_Type => Bucket_Range_Type);\n+\n       Buffer : Bounded_String (2052);\n-      IS_Nam : Name_Id;\n \n    begin\n-      --  The hash is obtained in the following manner:\n-      --\n-      --    * A String signature based on the scope, name, line number, column\n-      --      number, and locations, in the following format:\n+      --  The hash is obtained from a signature based on the scope, name, line\n+      --  number, column number, and locations, in the following format:\n       --\n       --         scope__name__line_column__locations\n-      --\n-      --    * The String is converted into a Name_Id\n-      --\n-      --    * The absolute value of the Name_Id is used as the hash\n \n       Append (Buffer, IS_Rec.Scope);\n       Append (Buffer, \"__\");\n@@ -606,8 +605,7 @@ package body ALI is\n          Append (Buffer, IS_Rec.Locations);\n       end if;\n \n-      IS_Nam := Name_Find (Buffer);\n-      return Bucket_Range_Type (abs IS_Nam);\n+      return String_Hash (To_String (Buffer));\n    end Hash;\n \n    --------------------"}]}