{"sha": "6b67ec08ceed9e120a93fe1fea50d77dc8969eac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmI2N2VjMDhjZWVkOWUxMjBhOTNmZTFmZWE1MGQ3N2RjODk2OWVhYw==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-05-06T21:48:55Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1994-05-06T21:48:55Z"}, "message": "(flow_analysis, find_basic_blocks): Change from USE and CLOBBER insns\nto using CALL_INSN_FUNCTION_USAGE.\n\nFrom-SVN: r7242", "tree": {"sha": "90f2fe47c6134b279730f6d72eb02ee9d988437e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/90f2fe47c6134b279730f6d72eb02ee9d988437e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6b67ec08ceed9e120a93fe1fea50d77dc8969eac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b67ec08ceed9e120a93fe1fea50d77dc8969eac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b67ec08ceed9e120a93fe1fea50d77dc8969eac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b67ec08ceed9e120a93fe1fea50d77dc8969eac/comments", "author": null, "committer": null, "parents": [{"sha": "8c99eaf6ebfec216ee1c4579e94c7f9f9a14358b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c99eaf6ebfec216ee1c4579e94c7f9f9a14358b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c99eaf6ebfec216ee1c4579e94c7f9f9a14358b"}], "stats": {"total": 34, "additions": 13, "deletions": 21}, "files": [{"sha": "71d15ad7014f85bb9d025b52405d795743abab67", "filename": "gcc/flow.c", "status": "modified", "additions": 13, "deletions": 21, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6b67ec08ceed9e120a93fe1fea50d77dc8969eac/gcc%2Fflow.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6b67ec08ceed9e120a93fe1fea50d77dc8969eac/gcc%2Fflow.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fflow.c?ref=6b67ec08ceed9e120a93fe1fea50d77dc8969eac", "patch": "@@ -347,17 +347,10 @@ flow_analysis (f, nregs, file)\n \t    || (GET_RTX_CLASS (code) == 'i'\n \t\t&& (prev_code == JUMP_INSN\n \t\t    || (prev_code == CALL_INSN\n-\t\t\t&& nonlocal_label_list != 0\n-\t\t\t/* Ignore a CLOBBER after a CALL_INSN here.  */\n-\t\t\t&& ! (code == INSN\n-\t\t\t      && GET_CODE (PATTERN (insn)) == CLOBBER))\n+\t\t\t&& nonlocal_label_list != 0)\n \t\t    || prev_code == BARRIER)))\n \t  i++;\n-\tif (code != NOTE\n-\t    /* Skip a CLOBBER after a CALL_INSN.  See similar code in\n-\t       find_basic_blocks.  */\n-\t    && ! (prev_code == CALL_INSN\n-\t\t  && code == INSN && GET_CODE (PATTERN (insn)) == CLOBBER))\n+\tif (code != NOTE)\n \t  prev_code = code;\n       }\n   }\n@@ -443,11 +436,7 @@ find_basic_blocks (f, nonlocal_label_list)\n \t       || (GET_RTX_CLASS (code) == 'i'\n \t\t   && (prev_code == JUMP_INSN\n \t\t       || (prev_code == CALL_INSN\n-\t\t\t   && nonlocal_label_list != 0\n-\t\t\t   /* Ignore if CLOBBER since we consider this\n-\t\t\t      part of the CALL.  See below.  */\n-\t\t\t   && ! (code == INSN\n-\t\t\t\t && GET_CODE (PATTERN (insn)) == CLOBBER))\n+\t\t\t   && nonlocal_label_list != 0)\n \t\t       || prev_code == BARRIER)))\n \t{\n \t  basic_block_head[++i] = insn;\n@@ -481,13 +470,7 @@ find_basic_blocks (f, nonlocal_label_list)\n \n       BLOCK_NUM (insn) = i;\n \n-      /* Don't separate a CALL_INSN from following CLOBBER insns.  This is a\n-\t kludge that will go away when each CALL_INSN records its USE and\n-\t CLOBBERs.  */\n-\n-      if (code != NOTE\n-\t  && ! (prev_code == CALL_INSN && code == INSN\n-\t\t&& GET_CODE (PATTERN (insn)) == CLOBBER))\n+      if (code != NOTE)\n \tprev_code = code;\n     }\n \n@@ -1494,6 +1477,15 @@ propagate_block (old, first, last, final, significant, bnum)\n \t\t{\n \t\t  register int i;\n \n+\t\t  rtx note;\n+\n+\t          for (note = CALL_INSN_FUNCTION_USAGE (insn);\n+\t\t       note;\n+\t\t       note = XEXP (note, 1))\n+\t\t    if (GET_CODE (XEXP (note, 0)) == USE)\n+\t\t      mark_used_regs (old, live, SET_DEST (XEXP (note, 0)),\n+\t\t\t\t      final, insn);\n+\n \t\t  /* Each call clobbers all call-clobbered regs that are not\n \t\t     global.  Note that the function-value reg is a\n \t\t     call-clobbered reg, and mark_set_regs has already had"}]}