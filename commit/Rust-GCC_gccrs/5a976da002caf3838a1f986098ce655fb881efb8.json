{"sha": "5a976da002caf3838a1f986098ce655fb881efb8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWE5NzZkYTAwMmNhZjM4MzhhMWY5ODYwOThjZTY1NWZiODgxZWZiOA==", "commit": {"author": {"name": "Rafael Avila de Espindola", "email": "espindola@google.com", "date": "2008-05-28T16:20:25Z"}, "committer": {"name": "Rafael Espindola", "email": "espindola@gcc.gnu.org", "date": "2008-05-28T16:20:25Z"}, "message": "see.c (see_def_extension_not_merged): Use copy_rtx_if_shared to avoid invalid sharing.\n\n2008-05-28  Rafael Espindola  <espindola@google.com>\n\n\t* see.c (see_def_extension_not_merged): Use copy_rtx_if_shared to avoid\n\tinvalid sharing.\n\n2008-05-28  Rafael Espindola  <espindola@google.com>\n\n\t* gcc.dg/20080528-1.c: New test.\n\nFrom-SVN: r136115", "tree": {"sha": "fc4f9f2657619badbd0209749b23cc7d6c178ea1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fc4f9f2657619badbd0209749b23cc7d6c178ea1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5a976da002caf3838a1f986098ce655fb881efb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a976da002caf3838a1f986098ce655fb881efb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a976da002caf3838a1f986098ce655fb881efb8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a976da002caf3838a1f986098ce655fb881efb8/comments", "author": null, "committer": null, "parents": [{"sha": "acca98c08fb5c522fb2b830ed61a6d2b53415ae1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acca98c08fb5c522fb2b830ed61a6d2b53415ae1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acca98c08fb5c522fb2b830ed61a6d2b53415ae1"}], "stats": {"total": 29, "additions": 29, "deletions": 0}, "files": [{"sha": "fe82a48d1bddcea8ed1a91c5cd8aa3ce6213f644", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5a976da002caf3838a1f986098ce655fb881efb8", "patch": "@@ -1,3 +1,8 @@\n+2008-05-28  Rafael Espindola  <espindola@google.com>\n+\n+\t* see.c (see_def_extension_not_merged): Use copy_rtx_if_shared to avoid\n+\tinvalid sharing.\n+\n 2008-05-28  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/36339"}, {"sha": "5084b9765595172ebc99f378a90b45fb861b9e20", "filename": "gcc/see.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2Fsee.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2Fsee.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsee.c?ref=5a976da002caf3838a1f986098ce655fb881efb8", "patch": "@@ -2554,6 +2554,17 @@ see_def_extension_not_merged (struct see_ref_s *curr_ref_s, rtx def_se)\n \n   /* The manipulation succeeded.  Store the new manipulated reference.  */\n \n+  /* It is possible for dest_reg to appear multiple times in ref_copy. In this\n+     case, ref_copy now has invalid sharing. Copying solves the problem.\n+     We don't use copy_rtx as an optimization for the common case (no sharing).\n+     We can't just use copy_rtx_if_shared since it does nothing on INSNs.\n+     Another possible solution would be to make validate_replace_rtx_1\n+     public and use it instead of replace_rtx. */\n+  reset_used_flags (PATTERN (ref_copy));\n+  reset_used_flags (REG_NOTES (ref_copy));\n+  PATTERN (ref_copy) = copy_rtx_if_shared (PATTERN (ref_copy));\n+  REG_NOTES (ref_copy) = copy_rtx_if_shared (REG_NOTES (ref_copy));\n+\n   /* Try to simplify the new manipulated insn.  */\n   validate_simplify_insn (ref_copy);\n "}, {"sha": "c548a7d182876df528ef25da9c6de7e0eb26cb76", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5a976da002caf3838a1f986098ce655fb881efb8", "patch": "@@ -1,3 +1,7 @@\n+2008-05-28  Rafael Espindola  <espindola@google.com>\n+\n+\t* gcc.dg/20080528-1.c: New test.\n+\n 2008-05-28  Arnaud Charlet  <charlet@adacore.com>\n \n \t* gnat.dg/old_errors.adb, gnat.dg/deep_old.adb: Adjust."}, {"sha": "9fe978051ebc48f404dbfe9ae4bbaf75d367124b", "filename": "gcc/testsuite/gcc.dg/20080528-1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2Ftestsuite%2Fgcc.dg%2F20080528-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5a976da002caf3838a1f986098ce655fb881efb8/gcc%2Ftestsuite%2Fgcc.dg%2F20080528-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2F20080528-1.c?ref=5a976da002caf3838a1f986098ce655fb881efb8", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fsee\" } */\n+\n+unsigned long g(int a, int b) {\n+  return a / b;\n+}\n+unsigned long f(long int a) {\n+  return g(a, 1<<13);\n+}"}]}