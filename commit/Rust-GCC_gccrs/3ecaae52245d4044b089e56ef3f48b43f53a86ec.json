{"sha": "3ecaae52245d4044b089e56ef3f48b43f53a86ec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2VjYWFlNTIyNDVkNDA0NGIwODllNTZlZjNmNDhiNDNmNTNhODZlYw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2008-12-02T15:02:53Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2008-12-02T15:02:53Z"}, "message": "PR libstdc++/38365 (cont)\n\n2008-12-02  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR libstdc++/38365 (cont)\n\t* src/localename.cc (locale::locale(const locale&, const locale&,\n\tcategory)): Revert last changes.\n\t* src/localename.cc (locale::_Impl::_M_replace_categories(const\n\t_Impl*, category)): Fix here instead; rework.\n\nFrom-SVN: r142358", "tree": {"sha": "191cb80dea400ed93f13af763a90e3bf67cb2e22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/191cb80dea400ed93f13af763a90e3bf67cb2e22"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3ecaae52245d4044b089e56ef3f48b43f53a86ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ecaae52245d4044b089e56ef3f48b43f53a86ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ecaae52245d4044b089e56ef3f48b43f53a86ec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ecaae52245d4044b089e56ef3f48b43f53a86ec/comments", "author": null, "committer": null, "parents": [{"sha": "84cfdcb34ba2645c063db860b3671c5bd03ded2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84cfdcb34ba2645c063db860b3671c5bd03ded2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84cfdcb34ba2645c063db860b3671c5bd03ded2d"}], "stats": {"total": 71, "additions": 43, "deletions": 28}, "files": [{"sha": "25857cbfa10f89cf6b44a85e24da035730a95b1d", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ecaae52245d4044b089e56ef3f48b43f53a86ec/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ecaae52245d4044b089e56ef3f48b43f53a86ec/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=3ecaae52245d4044b089e56ef3f48b43f53a86ec", "patch": "@@ -1,3 +1,11 @@\n+2008-12-02  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR libstdc++/38365 (cont)\n+\t* src/localename.cc (locale::locale(const locale&, const locale&,\n+\tcategory)): Revert last changes.\n+\t* src/localename.cc (locale::_Impl::_M_replace_categories(const\n+\t_Impl*, category)): Fix here instead; rework.\n+\n 2008-12-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR libstdc++/38365"}, {"sha": "5f5ec5f62e972c85e67b8ac3e3a3d99231e90122", "filename": "libstdc++-v3/src/localename.cc", "status": "modified", "additions": 35, "deletions": 28, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3ecaae52245d4044b089e56ef3f48b43f53a86ec/libstdc%2B%2B-v3%2Fsrc%2Flocalename.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3ecaae52245d4044b089e56ef3f48b43f53a86ec/libstdc%2B%2B-v3%2Fsrc%2Flocalename.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Flocalename.cc?ref=3ecaae52245d4044b089e56ef3f48b43f53a86ec", "patch": "@@ -157,14 +157,7 @@ _GLIBCXX_BEGIN_NAMESPACE(std)\n \n   locale::locale(const locale& __base, const locale& __add, category __cat)\n   : _M_impl(0)\n-  {\n-    _M_coalesce(__base, __add, __cat);\n-    if (!__base._M_impl->_M_names[0] || !__add._M_impl->_M_names[0])\n-      {\n-\tdelete [] _M_impl->_M_names[0];\n-\t_M_impl->_M_names[0] = 0;   // Unnamed.\n-      }\n-  }\n+  { _M_coalesce(__base, __add, __cat); }\n \n   void\n   locale::_M_coalesce(const locale& __base, const locale& __add, \n@@ -274,29 +267,43 @@ _GLIBCXX_BEGIN_NAMESPACE(std)\n   _M_replace_categories(const _Impl* __imp, category __cat)\n   {\n     category __mask = 1;\n-    const bool __have_names = _M_names[0] && __imp->_M_names[0];\n-    for (size_t __ix = 0; __ix < _S_categories_size; ++__ix, __mask <<= 1)\n+    if (!_M_names[0] || !__imp->_M_names[0])\n+      {\n+\tif (_M_names[0])\n+\t  {\n+\t    delete [] _M_names[0];\n+\t    _M_names[0] = 0;   // Unnamed.\n+\t  }\n+\n+\tfor (size_t __ix = 0; __ix < _S_categories_size; ++__ix, __mask <<= 1)\n+\t  {\n+\t    if (__mask & __cat)\n+\t      // Need to replace entry in _M_facets with other locale's info.\n+\t      _M_replace_category(__imp, _S_facet_categories[__ix]);\n+\t  }\n+      }\n+    else\n       {\n-\tif (__mask & __cat)\n+\tif (!_M_names[1])\n \t  {\n-\t    // Need to replace entry in _M_facets with other locale's info.\n-\t    _M_replace_category(__imp, _S_facet_categories[__ix]);\n-\t    // If both have names, go ahead and mangle.\n-\t    if (__have_names)\n+\t    // A full set of _M_names must be prepared, all identical\n+\t    // to _M_names[0] to begin with. Then, below, a few will\n+\t    // be replaced by the corresponding __imp->_M_names. I.e.,\n+\t    // not a \"simple\" locale anymore (see locale::operator==).\n+\t    const size_t __len = std::strlen(_M_names[0]) + 1;\n+\t    for (size_t __i = 1; __i < _S_categories_size; ++__i)\n \t      {\n-\t\tif (!_M_names[1])\n-\t\t  {\n-\t\t    // A full set of _M_names must be prepared, all identical\n-\t\t    // to _M_names[0] to begin with. Then, below, a few will\n-\t\t    // be replaced by the corresponding __imp->_M_names. I.e.,\n-\t\t    // not a \"simple\" locale anymore (see locale::operator==).\n-\t\t    const size_t __len = std::strlen(_M_names[0]) + 1;\n-\t\t    for (size_t __i = 1; __i < _S_categories_size; ++__i)\n-\t\t      {\n-\t\t\t_M_names[__i] = new char[__len];\n-\t\t\tstd::memcpy(_M_names[__i], _M_names[0], __len);\n-\t\t      }\n-\t\t  }\n+\t\t_M_names[__i] = new char[__len];\n+\t\tstd::memcpy(_M_names[__i], _M_names[0], __len);\n+\t      }\n+\t  }\n+\n+\tfor (size_t __ix = 0; __ix < _S_categories_size; ++__ix, __mask <<= 1)\n+\t  {\n+\t    if (__mask & __cat)\n+\t      {\n+\t\t// Need to replace entry in _M_facets with other locale's info.\n+\t\t_M_replace_category(__imp, _S_facet_categories[__ix]);\n \n \t\t// FIXME: Hack for libstdc++/29217: the numerical encodings\n \t\t// of the time and collate categories are swapped vs the"}]}