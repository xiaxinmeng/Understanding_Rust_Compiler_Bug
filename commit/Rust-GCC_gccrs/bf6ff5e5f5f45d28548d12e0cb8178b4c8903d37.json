{"sha": "bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmY2ZmY1ZTVmNWY0NWQyODU0OGQxMmUwY2I4MTc4YjRjODkwM2QzNw==", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2018-07-16T14:11:30Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-16T14:11:30Z"}, "message": "[Ada] Trivial simplifications in in Walk_Library_Items\n\nCleanup only; semantics unaffected.\n\n2018-07-16  Piotr Trojanek  <trojanek@adacore.com>\n\ngcc/ada/\n\n\t* sem.adb (Walk_Library_Items): Reuse local constant.\n\t(Is_Subunit_Of_Main): Turn condition to positive and flip the\n\tIF-THEN-ELSE branches; avoid potentially ineffective assignment to the\n\tLib variable.\n\nFrom-SVN: r262719", "tree": {"sha": "510ec671a2cc76a7943b9affdcb6b6105dfacfa2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/510ec671a2cc76a7943b9affdcb6b6105dfacfa2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "feb7f36cad506b667a778b78d034491cb909c8c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/feb7f36cad506b667a778b78d034491cb909c8c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/feb7f36cad506b667a778b78d034491cb909c8c2"}], "stats": {"total": 28, "additions": 15, "deletions": 13}, "files": [{"sha": "02bb4228c17c1bbeec76c58362c9cf88b8efaf19", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37", "patch": "@@ -1,3 +1,10 @@\n+2018-07-16  Piotr Trojanek  <trojanek@adacore.com>\n+\n+\t* sem.adb (Walk_Library_Items): Reuse local constant.\n+\t(Is_Subunit_Of_Main): Turn condition to positive and flip the\n+\tIF-THEN-ELSE branches; avoid potentially ineffective assignment to the\n+\tLib variable.\n+\n 2018-07-16  Piotr Trojanek  <trojanek@adacore.com>\n \n \t* sem.adb (Walk_Library_Items): Deconstruct dead code."}, {"sha": "2f2f846c2a896006dff1fca46e4e13aace5478d9", "filename": "gcc/ada/sem.adb", "status": "modified", "additions": 8, "deletions": 13, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37/gcc%2Fada%2Fsem.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37/gcc%2Fada%2Fsem.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem.adb?ref=bf6ff5e5f5f45d28548d12e0cb8178b4c8903d37", "patch": "@@ -1778,8 +1778,7 @@ package body Sem is\n \n                --  A subprogram body must be the main unit\n \n-               pragma Assert (Acts_As_Spec (CU)\n-                               or else CU = Cunit (Main_Unit));\n+               pragma Assert (Acts_As_Spec (CU) or else CU = Main_CU);\n                null;\n \n             when N_Function_Instantiation\n@@ -1940,9 +1939,7 @@ package body Sem is\n             if not Nkind_In (Item, N_Package_Body, N_Subprogram_Body)\n               or else Acts_As_Spec (CU)\n             then\n-               if CU = Cunit (Main_Unit)\n-                   and then not Do_Main\n-               then\n+               if CU = Main_CU and then not Do_Main then\n                   Seen (Unit_Num) := False;\n \n                else\n@@ -2017,7 +2014,7 @@ package body Sem is\n                --  parents that are instances have been loaded already.\n \n                if Present (Body_CU)\n-                 and then Body_CU /= Cunit (Main_Unit)\n+                 and then Body_CU /= Main_CU\n                  and then Nkind (Unit (Body_CU)) /= N_Subprogram_Body\n                  and then Nkind (Unit (Comp)) /= N_Package_Declaration\n                then\n@@ -2152,6 +2149,7 @@ package body Sem is\n                   if Par /= Cunit_Entity (Main_Unit) then\n                      Do_Unit_And_Dependents (CU, N);\n                   end if;\n+\n             end case;\n          end;\n \n@@ -2183,14 +2181,11 @@ package body Sem is\n             function Is_Subunit_Of_Main (U : Node_Id) return Boolean is\n                Lib : Node_Id;\n             begin\n-               if No (U) then\n-                  return False;\n-               else\n+               if Present (U) and then Nkind (Unit (U)) = N_Subunit then\n                   Lib := Library_Unit (U);\n-                  return Nkind (Unit (U)) = N_Subunit\n-                    and then\n-                      (Lib = Cunit (Main_Unit)\n-                        or else Is_Subunit_Of_Main (Lib));\n+                  return Lib = Main_CU or else Is_Subunit_Of_Main (Lib);\n+               else\n+                  return False;\n                end if;\n             end Is_Subunit_Of_Main;\n "}]}