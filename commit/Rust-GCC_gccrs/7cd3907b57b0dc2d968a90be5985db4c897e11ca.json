{"sha": "7cd3907b57b0dc2d968a90be5985db4c897e11ca", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2NkMzkwN2I1N2IwZGMyZDk2OGE5MGJlNTk4NWRiNGM4OTdlMTFjYQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2003-02-04T18:08:45Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2003-02-04T18:08:45Z"}, "message": "[multiple changes]\n\n2003-02-04  Paolo Carlini  <pcarlini@unitus.it>\n\n\tPR libstdc++/9538\n\t* include/bits/streambuf.tcc (sputbackc): Access\n\tthis->gptr()[-1] only if _M_in_beg < _M_in_cur.\n\t* testsuite/27_io/filebuf_virtuals.cc (test08): Add.\n\n2003-02-04  Paolo Carlini  <pcarlini@unitus.it>\n\n\tPR libstdc++/9507\n\t* include/bits/fstream.tcc (open): If the 'ate' repositioning\n\toperation fails, calls close _and_ returns a null pointer\n\tto indicate failure (27.8.1.3,4).\n\t* testsuite/27_io/filebuf_members.cc (test_06): Add.\n\n2003-02-04  Petur Runolfsson  <peturr02@ru.is>\n\n\t* testsuite/27_io/filebuf_members.cc (test_04): Remove exit(0).\n\nFrom-SVN: r62388", "tree": {"sha": "82cde50835a300e4ff4bae0d4ed772e3cc147011", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82cde50835a300e4ff4bae0d4ed772e3cc147011"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7cd3907b57b0dc2d968a90be5985db4c897e11ca", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cd3907b57b0dc2d968a90be5985db4c897e11ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7cd3907b57b0dc2d968a90be5985db4c897e11ca", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cd3907b57b0dc2d968a90be5985db4c897e11ca/comments", "author": null, "committer": null, "parents": [{"sha": "09f26fb511eb0cb0184bf81111b7041ae8ae6042", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09f26fb511eb0cb0184bf81111b7041ae8ae6042", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09f26fb511eb0cb0184bf81111b7041ae8ae6042"}], "stats": {"total": 91, "additions": 87, "deletions": 4}, "files": [{"sha": "ac010126b70f945f8275d47e58cba36c8a492fae", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=7cd3907b57b0dc2d968a90be5985db4c897e11ca", "patch": "@@ -1,3 +1,22 @@\n+2003-02-04  Paolo Carlini  <pcarlini@unitus.it>\n+\n+\tPR libstdc++/9538\n+\t* include/bits/streambuf.tcc (sputbackc): Access\n+\tthis->gptr()[-1] only if _M_in_beg < _M_in_cur.\n+\t* testsuite/27_io/filebuf_virtuals.cc (test08): Add.\n+\n+2003-02-04  Paolo Carlini  <pcarlini@unitus.it>\n+\n+\tPR libstdc++/9507\n+\t* include/bits/fstream.tcc (open): If the 'ate' repositioning\n+\toperation fails, calls close _and_ returns a null pointer\n+\tto indicate failure (27.8.1.3,4).\n+\t* testsuite/27_io/filebuf_members.cc (test_06): Add.\n+\n+2003-02-04  Petur Runolfsson  <peturr02@ru.is>\n+\n+\t* testsuite/27_io/filebuf_members.cc (test_04): Remove exit(0).\n+\n 2002-02-04  Jonathan Wakely  <redi@gcc.gnu.org>\n \n \t* docs/html/27_io/howto.html: New section on stdio_filebuf."}, {"sha": "c5f9758da278966fc7e5df82e8ce616844e3b91f", "filename": "libstdc++-v3/include/bits/fstream.tcc", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc?ref=7cd3907b57b0dc2d968a90be5985db4c897e11ca", "patch": "@@ -103,7 +103,11 @@ namespace std\n \t      \n \t      if ((__mode & ios_base::ate)\n \t\t  && this->seekoff(0, ios_base::end, __mode) < 0)\n-\t\tthis->close();\n+\t\t{\n+\t\t  // 27.8.1.3,4\n+\t\t  this->close();\n+\t\t  return __ret;\n+\t\t}\n \n \t      __ret = this;\n \t    }"}, {"sha": "cb6f95deea4d8db30a9133652f9593534018355d", "filename": "libstdc++-v3/include/bits/streambuf.tcc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstreambuf.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstreambuf.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstreambuf.tcc?ref=7cd3907b57b0dc2d968a90be5985db4c897e11ca", "patch": "@@ -67,8 +67,7 @@ namespace std\n     {\n       int_type __ret;\n       bool __testpos = _M_in_cur && _M_in_beg < _M_in_cur;\n-      bool __testne = _M_in_cur && !traits_type::eq(__c, this->gptr()[-1]);\n-      if (!__testpos || __testne)\n+      if (!__testpos || !traits_type::eq(__c, this->gptr()[-1]))\n \t__ret = this->pbackfail(traits_type::to_int_type(__c));\n       else \n \t{"}, {"sha": "88b05358e7fd2c1deafadd60d735c11dac6fa908", "filename": "libstdc++-v3/testsuite/27_io/filebuf_members.cc", "status": "modified", "additions": 28, "deletions": 1, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_members.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_members.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_members.cc?ref=7cd3907b57b0dc2d968a90be5985db4c897e11ca", "patch": "@@ -172,7 +172,6 @@ test_04()\n     }\n \n   unlink(\"xxx\");\n-  exit(0);\n }\n \n // Charles Leggett <CGLeggett@lbl.gov>\n@@ -191,6 +190,33 @@ void test_05()\n   scratch_file.close();\n }\n \n+// libstdc++/9507\n+void test_06()\n+{\n+  bool test = true;\n+\n+  signal(SIGPIPE, SIG_IGN);\n+\n+  unlink(\"yyy\");\n+  mkfifo(\"yyy\", S_IRWXU);\n+\t\n+  if (!fork())\n+    {\n+      std::filebuf fbuf;\n+      fbuf.open(\"yyy\", std::ios_base::in);\n+      fbuf.sgetc();\n+      fbuf.close();\n+\n+      exit(0);\n+    }\n+\n+  std::filebuf fbuf;\n+  std::filebuf* r =\n+    fbuf.open(\"yyy\", std::ios_base::out | std::ios_base::ate);\n+  VERIFY( !fbuf.is_open() );\n+  VERIFY( r == NULL );\n+}\n+\n int\n main()\n {\n@@ -199,6 +225,7 @@ main()\n   test_03();\n   test_04();\n   test_05();\n+  test_06();\n   return 0;\n }\n "}, {"sha": "75c2e1cac77c0354980b5cfe18116b24d88db0c0", "filename": "libstdc++-v3/testsuite/27_io/filebuf_virtuals.cc", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cd3907b57b0dc2d968a90be5985db4c897e11ca/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc?ref=7cd3907b57b0dc2d968a90be5985db4c897e11ca", "patch": "@@ -537,6 +537,39 @@ void test07()\n   VERIFY( ob.getloc() == loc_de );\n }\n \n+class MyTraits : public std::char_traits<char>\n+{\n+public:\n+  static bool eq(char c1, char c2)\n+  {\n+    VERIFY( c1 >= 0 );\n+    VERIFY( c2 >= 0 );\n+    return std::char_traits<char>::eq(c1, c2);\n+  }\n+};\n+\n+class MyBuf : public std::basic_streambuf<char, MyTraits>\n+{\n+  char buffer[8];\n+\n+public:\n+  MyBuf()\n+  {\n+    std::memset(buffer, -1, sizeof(buffer));\n+    std::memset(buffer + 2, 0, 4);\n+    setg(buffer + 2, buffer + 2, buffer + 6);\n+  }\n+};\n+\n+// libstdc++/9538\n+void test08()\n+{\n+  bool test = true;\n+\n+  MyBuf mb;\n+  mb.sputbackc(0);  \n+}\n+\n main() \n {\n   test01();\n@@ -548,5 +581,6 @@ main()\n   test06();\n \n   test07();\n+  test08();\n   return 0;\n }"}]}