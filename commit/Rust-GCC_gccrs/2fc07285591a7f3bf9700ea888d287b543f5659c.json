{"sha": "2fc07285591a7f3bf9700ea888d287b543f5659c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZjMDcyODU1OTFhN2YzYmY5NzAwZWE4ODhkMjg3YjU0M2Y1NjU5Yw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-10-10T10:55:36Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-10-10T10:55:36Z"}, "message": "[multiple changes]\n\n2013-10-10  Yannick Moy  <moy@adacore.com>\n\n\t* gnat_rm.texi, a-cfdlli.ads, a-cfhase.ads, a-cforma.ads, a-cfhama.ads,\n\ta-cforse.ads, a-cofove.ads: Update comment and doc of formal containers\n\n2013-10-10  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch13.adb (Analyze_Aspect_Specifications): For Pre/Post\n\tconditions that apply to a subprogram body, preserve the placement\n\tand order of the generated pragmas, which must appear before\n\tother declarations in the body.\n\nFrom-SVN: r203347", "tree": {"sha": "a698c1cbe00f3b6034ecf4e1403d100a5835e8f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a698c1cbe00f3b6034ecf4e1403d100a5835e8f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fc07285591a7f3bf9700ea888d287b543f5659c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fc07285591a7f3bf9700ea888d287b543f5659c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fc07285591a7f3bf9700ea888d287b543f5659c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fc07285591a7f3bf9700ea888d287b543f5659c/comments", "author": null, "committer": null, "parents": [{"sha": "c1645ac8762353e4ac4d91d46cc1a0c039647542", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1645ac8762353e4ac4d91d46cc1a0c039647542", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1645ac8762353e4ac4d91d46cc1a0c039647542"}], "stats": {"total": 147, "additions": 102, "deletions": 45}, "files": [{"sha": "7438dabe57eca39f5b3e2b9c81b827d95cd7c78a", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -1,3 +1,15 @@\n+2013-10-10  Yannick Moy  <moy@adacore.com>\n+\n+\t* gnat_rm.texi, a-cfdlli.ads, a-cfhase.ads, a-cforma.ads, a-cfhama.ads,\n+\ta-cforse.ads, a-cofove.ads: Update comment and doc of formal containers\n+\n+2013-10-10  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch13.adb (Analyze_Aspect_Specifications): For Pre/Post\n+\tconditions that apply to a subprogram body, preserve the placement\n+\tand order of the generated pragmas, which must appear before\n+\tother declarations in the body.\n+\n 2013-10-10  Bob Duff  <duff@adacore.com>\n \n \t* gnat_ugn.texi: Add gnat2xml doc."}, {"sha": "0442fe60aaf5d9dc7e7c5afee06634a2f46f19dd", "filename": "gcc/ada/a-cfdlli.ads", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cfdlli.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cfdlli.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-cfdlli.ads?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -30,8 +30,10 @@\n ------------------------------------------------------------------------------\n \n --  This spec is derived from Ada.Containers.Bounded_Doubly_Linked_Lists in the\n---  Ada 2012 RM. The modifications are to facilitate formal proofs by making it\n---  easier to express properties.\n+--  Ada 2012 RM. The modifications are meant to facilitate formal proofs by\n+--  making it easier to express properties, and by making the specification of\n+--  this unit compatible with SPARK 2014. Note that the API of this unit may be\n+--  subject to incompatible changes as SPARK 2014 evolves.\n \n --  The modifications are:\n \n@@ -49,7 +51,7 @@\n --      function Left  (Container : List; Position : Cursor) return List;\n --      function Right (Container : List; Position : Cursor) return List;\n \n---    See subprogram specifications that follow for details\n+--    See subprogram specifications that follow for details.\n \n generic\n    type Element_Type is private;"}, {"sha": "2f1e7bbdaf079a570975114d6cdee5ca7772fca1", "filename": "gcc/ada/a-cfhama.ads", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cfhama.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cfhama.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-cfhama.ads?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -30,8 +30,10 @@\n ------------------------------------------------------------------------------\n \n --  This spec is derived from package Ada.Containers.Bounded_Hashed_Maps in the\n---  Ada 2012 RM. The modifications are to facilitate formal proofs by making it\n---  easier to express properties.\n+--  Ada 2012 RM. The modifications are meant to facilitate formal proofs by\n+--  making it easier to express properties, and by making the specification of\n+--  this unit compatible with SPARK 2014. Note that the API of this unit may be\n+--  subject to incompatible changes as SPARK 2014 evolves.\n \n --  The modifications are:\n \n@@ -49,7 +51,7 @@\n --      function Left  (Container : Map; Position : Cursor) return Map;\n --      function Right (Container : Map; Position : Cursor) return Map;\n \n---    See detailed specifications for these subprograms\n+--    See detailed specifications for these subprograms.\n \n private with Ada.Containers.Hash_Tables;\n "}, {"sha": "147a332ed5287ffcb0d7d9da4805256c999a1bcc", "filename": "gcc/ada/a-cfhase.ads", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cfhase.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cfhase.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-cfhase.ads?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -30,8 +30,10 @@\n ------------------------------------------------------------------------------\n \n --  This spec is derived from package Ada.Containers.Bounded_Hashed_Sets in the\n---  Ada 2012 RM. The modifications are to facilitate formal proofs by making it\n---  easier to express properties.\n+--  Ada 2012 RM. The modifications are meant to facilitate formal proofs by\n+--  making it easier to express properties, and by making the specification of\n+--  this unit compatible with SPARK 2014. Note that the API of this unit may be\n+--  subject to incompatible changes as SPARK 2014 evolves.\n \n --  The modifications are:\n \n@@ -49,7 +51,7 @@\n --      function Left  (Container : Set; Position : Cursor) return Set;\n --      function Right (Container : Set; Position : Cursor) return Set;\n \n---    See detailed specifications for these subprograms\n+--    See detailed specifications for these subprograms.\n \n private with Ada.Containers.Hash_Tables;\n "}, {"sha": "ca6db020013e3037e7f8847403fab8a7643065dd", "filename": "gcc/ada/a-cforma.ads", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cforma.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cforma.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-cforma.ads?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -30,8 +30,10 @@\n ------------------------------------------------------------------------------\n \n --  This spec is derived from package Ada.Containers.Bounded_Ordered_Maps in\n---  the Ada 2012 RM. The modifications are to facilitate formal proofs by\n---  making it easier to express properties.\n+--  the Ada 2012 RM. The modifications are meant to facilitate formal proofs by\n+--  making it easier to express properties, and by making the specification of\n+--  this unit compatible with SPARK 2014. Note that the API of this unit may be\n+--  subject to incompatible changes as SPARK 2014 evolves.\n \n --  The modifications are:\n \n@@ -51,7 +53,7 @@\n --      function Left  (Container : Map; Position : Cursor) return Map;\n --      function Right (Container : Map; Position : Cursor) return Map;\n \n---    See detailed specifications for these subprograms\n+--    See detailed specifications for these subprograms.\n \n private with Ada.Containers.Red_Black_Trees;\n "}, {"sha": "7f9316186e6812b46a2c6ca38580c5c5dfc0c287", "filename": "gcc/ada/a-cforse.ads", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cforse.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cforse.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-cforse.ads?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -30,8 +30,10 @@\n ------------------------------------------------------------------------------\n \n --  This spec is derived from package Ada.Containers.Bounded_Ordered_Sets in\n---  the Ada 2012 RM. The modifications are to facilitate formal proofs by\n---  making it easier to express properties.\n+--  the Ada 2012 RM. The modifications are meant to facilitate formal proofs by\n+--  making it easier to express properties, and by making the specification of\n+--  this unit compatible with SPARK 2014. Note that the API of this unit may be\n+--  subject to incompatible changes as SPARK 2014 evolves.\n \n --  The modifications are:\n \n@@ -50,7 +52,7 @@\n --      function Left  (Container : Set; Position : Cursor) return Set;\n --      function Right (Container : Set; Position : Cursor) return Set;\n \n---    See detailed specifications for these subprograms\n+--    See detailed specifications for these subprograms.\n \n private with Ada.Containers.Red_Black_Trees;\n "}, {"sha": "58e7b8b2c7b52669046f4e6fa6407584783ec935", "filename": "gcc/ada/a-cofove.ads", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cofove.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fa-cofove.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-cofove.ads?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -30,8 +30,10 @@\n ------------------------------------------------------------------------------\n \n --  This spec is derived from package Ada.Containers.Bounded_Vectors in the Ada\n---  2012 RM. The modifications are to facilitate formal proofs by making it\n---  easier to express properties.\n+--  2012 RM. The modifications are meant to facilitate formal proofs by making\n+--  it easier to express properties, and by making the specification of this\n+--  unit compatible with SPARK 2014. Note that the API of this unit may be\n+--  subject to incompatible changes as SPARK 2014 evolves.\n \n --  The modifications are:\n \n@@ -48,12 +50,7 @@\n --      function Left  (Container : Vector; Position : Cursor) return Vector;\n --      function Right (Container : Vector; Position : Cursor) return Vector;\n \n---      Left returns a container containing all elements preceding Position\n---      (excluded) in Container. Right returns a container containing all\n---      elements following Position (included) in Container. These two new\n---      functions are useful to express invariant properties in loops which\n---      iterate over containers. Left returns the part of the container already\n---      scanned and Right the part not scanned yet.\n+--    See detailed specifications for these subprograms.\n \n with Ada.Containers;\n use Ada.Containers;\n@@ -350,9 +347,14 @@ package Ada.Containers.Formal_Vectors is\n \n    function Left (Container : Vector; Position : Cursor) return Vector with\n      Pre => Has_Element (Container, Position) or else Position = No_Element;\n-\n    function Right (Container : Vector; Position : Cursor) return Vector with\n      Pre => Has_Element (Container, Position) or else Position = No_Element;\n+   --  Left returns a container containing all elements preceding Position\n+   --  (excluded) in Container. Right returns a container containing all\n+   --  elements following Position (included) in Container. These two new\n+   --  functions can be used to express invariant properties in loops which\n+   --  iterate over containers. Left returns the part of the container already\n+   --  scanned and Right the part not scanned yet.\n \n private\n "}, {"sha": "6dfda7554d3176e1bb02df7eb89059ac25a12747", "filename": "gcc/ada/gnat_rm.texi", "status": "modified", "additions": 30, "deletions": 18, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fgnat_rm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fgnat_rm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_rm.texi?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -16995,59 +16995,71 @@ is specifically authorized by the Ada Reference Manual\n @cindex Formal container for doubly linked lists\n \n @noindent\n-This child of @code{Ada.Containers} defines a modified version of the Ada 2005\n-container for doubly linked lists, meant to facilitate formal verification of\n-code using such containers.\n+This child of @code{Ada.Containers} defines a modified version of the\n+Ada 2005 container for doubly linked lists, meant to facilitate formal\n+verification of code using such containers. The specification of this\n+unit is compatible with SPARK 2014. Note that the API of this unit may\n+be subject to incompatible changes as SPARK 2014 evolves.\n \n @node Ada.Containers.Formal_Hashed_Maps (a-cfhama.ads)\n @section @code{Ada.Containers.Formal_Hashed_Maps} (@file{a-cfhama.ads})\n @cindex @code{Ada.Containers.Formal_Hashed_Maps} (@file{a-cfhama.ads})\n @cindex Formal container for hashed maps\n \n @noindent\n-This child of @code{Ada.Containers} defines a modified version of the Ada 2005\n-container for hashed maps, meant to facilitate formal verification of\n-code using such containers.\n+This child of @code{Ada.Containers} defines a modified version of the\n+Ada 2005 container for hashed maps, meant to facilitate formal\n+verification of code using such containers. The specification of this\n+unit is compatible with SPARK 2014. Note that the API of this unit may\n+be subject to incompatible changes as SPARK 2014 evolves.\n \n @node Ada.Containers.Formal_Hashed_Sets (a-cfhase.ads)\n @section @code{Ada.Containers.Formal_Hashed_Sets} (@file{a-cfhase.ads})\n @cindex @code{Ada.Containers.Formal_Hashed_Sets} (@file{a-cfhase.ads})\n @cindex Formal container for hashed sets\n \n @noindent\n-This child of @code{Ada.Containers} defines a modified version of the Ada 2005\n-container for hashed sets, meant to facilitate formal verification of\n-code using such containers.\n+This child of @code{Ada.Containers} defines a modified version of the\n+Ada 2005 container for hashed sets, meant to facilitate formal\n+verification of code using such containers. The specification of this\n+unit is compatible with SPARK 2014. Note that the API of this unit may\n+be subject to incompatible changes as SPARK 2014 evolves.\n \n @node Ada.Containers.Formal_Ordered_Maps (a-cforma.ads)\n @section @code{Ada.Containers.Formal_Ordered_Maps} (@file{a-cforma.ads})\n @cindex @code{Ada.Containers.Formal_Ordered_Maps} (@file{a-cforma.ads})\n @cindex Formal container for ordered maps\n \n @noindent\n-This child of @code{Ada.Containers} defines a modified version of the Ada 2005\n-container for ordered maps, meant to facilitate formal verification of\n-code using such containers.\n+This child of @code{Ada.Containers} defines a modified version of the\n+Ada 2005 container for ordered maps, meant to facilitate formal\n+verification of code using such containers. The specification of this\n+unit is compatible with SPARK 2014. Note that the API of this unit may\n+be subject to incompatible changes as SPARK 2014 evolves.\n \n @node Ada.Containers.Formal_Ordered_Sets (a-cforse.ads)\n @section @code{Ada.Containers.Formal_Ordered_Sets} (@file{a-cforse.ads})\n @cindex @code{Ada.Containers.Formal_Ordered_Sets} (@file{a-cforse.ads})\n @cindex Formal container for ordered sets\n \n @noindent\n-This child of @code{Ada.Containers} defines a modified version of the Ada 2005\n-container for ordered sets, meant to facilitate formal verification of\n-code using such containers.\n+This child of @code{Ada.Containers} defines a modified version of the\n+Ada 2005 container for ordered sets, meant to facilitate formal\n+verification of code using such containers. The specification of this\n+unit is compatible with SPARK 2014. Note that the API of this unit may\n+be subject to incompatible changes as SPARK 2014 evolves.\n \n @node Ada.Containers.Formal_Vectors (a-cofove.ads)\n @section @code{Ada.Containers.Formal_Vectors} (@file{a-cofove.ads})\n @cindex @code{Ada.Containers.Formal_Vectors} (@file{a-cofove.ads})\n @cindex Formal container for vectors\n \n @noindent\n-This child of @code{Ada.Containers} defines a modified version of the Ada 2005\n-container for vectors, meant to facilitate formal verification of\n-code using such containers.\n+This child of @code{Ada.Containers} defines a modified version of the\n+Ada 2005 container for vectors, meant to facilitate formal\n+verification of code using such containers. The specification of this\n+unit is compatible with SPARK 2014. Note that the API of this unit may\n+be subject to incompatible changes as SPARK 2014 evolves.\n \n @node Ada.Command_Line.Environment (a-colien.ads)\n @section @code{Ada.Command_Line.Environment} (@file{a-colien.ads})"}, {"sha": "dbae075519799b1cfb3d73c6cec0aafefe2682c7", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 24, "deletions": 3, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fc07285591a7f3bf9700ea888d287b543f5659c/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=2fc07285591a7f3bf9700ea888d287b543f5659c", "patch": "@@ -1189,10 +1189,29 @@ package body Sem_Ch13 is\n \n          elsif Nkind (N) = N_Subprogram_Body then\n             if No (Declarations (N)) then\n-               Set_Declarations (N, New_List);\n-            end if;\n+               Set_Declarations (N, New_List (Prag));\n+            else\n+               declare\n+                  D : Node_Id;\n+               begin\n+\n+                  --  There may be several aspects associated with the body;\n+                  --  preserve the ordering of the corresponding pragmas.\n+\n+                  D := First (Declarations (N));\n+                  while Present (D) loop\n+                     exit when Nkind (D) /= N_Pragma\n+                       or else not From_Aspect_Specification (D);\n+                     Next (D);\n+                  end loop;\n \n-            Append (Prag, Declarations (N));\n+                  if No (D) then\n+                     Append (Prag, Declarations (N));\n+                  else\n+                     Insert_Before (D, Prag);\n+                  end if;\n+               end;\n+            end if;\n \n          --  Default\n \n@@ -2231,6 +2250,8 @@ package body Sem_Ch13 is\n                               end;\n                            end if;\n \n+                           --  Otherwise, Convention must be specified\n+\n                            Error_Msg_N\n                              (\"missing Convention aspect for Export/Import\",\n                               Aspect);"}]}