{"sha": "65f2d1ee1c20860e238750099b88e394ee30a770", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjVmMmQxZWUxYzIwODYwZTIzODc1MDA5OWI4OGUzOTRlZTMwYTc3MA==", "commit": {"author": {"name": "Prathamesh Kulkarni", "email": "prathamesh.kulkarni@linaro.org", "date": "2018-01-03T16:07:32Z"}, "committer": {"name": "Prathamesh Kulkarni", "email": "prathamesh3492@gcc.gnu.org", "date": "2018-01-03T16:07:32Z"}, "message": "re PR tree-optimization/83501 (strlen(a) not folded after strcpy(a, \"...\"))\n\n2018-01-03  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n\n\tPR tree-optimization/83501\n\t* tree-ssa-strlen.c (get_string_cst): New.\n\t(handle_char_store): Call get_string_cst.\n\ntestsuite/\n\t* gcc.dg/tree-ssa/pr83501.c: New test.\n\nFrom-SVN: r256180", "tree": {"sha": "39a1b922636b131e994dcc24e956ad6826434e59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/39a1b922636b131e994dcc24e956ad6826434e59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65f2d1ee1c20860e238750099b88e394ee30a770", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65f2d1ee1c20860e238750099b88e394ee30a770", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65f2d1ee1c20860e238750099b88e394ee30a770", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65f2d1ee1c20860e238750099b88e394ee30a770/comments", "author": null, "committer": null, "parents": [{"sha": "ce4734988f9ee022fbe5195f85ea04e7372a9eda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ce4734988f9ee022fbe5195f85ea04e7372a9eda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ce4734988f9ee022fbe5195f85ea04e7372a9eda"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "d95c297e96a46618c5cbd2c6278d72aef1e7f2d4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=65f2d1ee1c20860e238750099b88e394ee30a770", "patch": "@@ -1,3 +1,9 @@\n+2018-01-03  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\tPR tree-optimization/83501\n+\t* tree-ssa-strlen.c (get_string_cst): New.\n+\t(handle_char_store): Call get_string_cst.\n+\n 2018-01-03  Martin Liska  <mliska@suse.cz>\n \n \tPR tree-optimization/83593"}, {"sha": "c18e6c7fd69bb864ddd24d74dfc49bd1983b4c39", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=65f2d1ee1c20860e238750099b88e394ee30a770", "patch": "@@ -1,3 +1,8 @@\n+2018-01-03  Prathamesh Kulkarni  <prathamesh.kulkarni@linaro.org>\n+\n+\tPR tree-optimization/83501\n+\t* gcc.dg/tree-ssa/pr83501-1.c: New test.\n+\n 2018-01-03  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/83667"}, {"sha": "d8d3bf6039a8f8636002746f6433ccd3833f810a", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr83501.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr83501.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr83501.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr83501.c?ref=65f2d1ee1c20860e238750099b88e394ee30a770", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-strlen\" } */\n+\n+char a[4];\n+\n+void f (void)\n+{\n+  __builtin_strcpy (a, \"abc\");\n+\n+  if (__builtin_strlen (a) != 3)\n+    __builtin_abort ();\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"__builtin_strlen\" \"strlen\" } } */"}, {"sha": "f4fd69f58de49eead45fc4daf64c630c38116507", "filename": "gcc/tree-ssa-strlen.c", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2Ftree-ssa-strlen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65f2d1ee1c20860e238750099b88e394ee30a770/gcc%2Ftree-ssa-strlen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-strlen.c?ref=65f2d1ee1c20860e238750099b88e394ee30a770", "patch": "@@ -2772,6 +2772,21 @@ handle_pointer_plus (gimple_stmt_iterator *gsi)\n     }\n }\n \n+/* Check if RHS is string_cst possibly wrapped by mem_ref.  */\n+static tree\n+get_string_cst (tree rhs)\n+{\n+  if (TREE_CODE (rhs) == MEM_REF\n+      && integer_zerop (TREE_OPERAND (rhs, 1)))\n+    {\n+      rhs = TREE_OPERAND (rhs, 0);\n+      if (TREE_CODE (rhs) == ADDR_EXPR)\n+\trhs = TREE_OPERAND (rhs, 0);\n+    }\n+\n+  return (TREE_CODE (rhs) == STRING_CST) ? rhs : NULL_TREE;\n+}\n+\n /* Handle a single character store.  */\n \n static bool\n@@ -2927,11 +2942,11 @@ handle_char_store (gimple_stmt_iterator *gsi)\n \t}\n     }\n   else if (idx == 0\n-\t   && TREE_CODE (gimple_assign_rhs1 (stmt)) == STRING_CST\n+\t   && (rhs = get_string_cst (gimple_assign_rhs1 (stmt)))\n \t   && ssaname == NULL_TREE\n \t   && TREE_CODE (TREE_TYPE (lhs)) == ARRAY_TYPE)\n     {\n-      size_t l = strlen (TREE_STRING_POINTER (gimple_assign_rhs1 (stmt)));\n+      size_t l = strlen (TREE_STRING_POINTER (rhs));\n       HOST_WIDE_INT a = int_size_in_bytes (TREE_TYPE (lhs));\n       if (a > 0 && (unsigned HOST_WIDE_INT) a > l)\n \t{"}]}