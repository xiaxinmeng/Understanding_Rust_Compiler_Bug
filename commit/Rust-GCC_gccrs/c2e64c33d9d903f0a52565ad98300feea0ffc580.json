{"sha": "c2e64c33d9d903f0a52565ad98300feea0ffc580", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzJlNjRjMzNkOWQ5MDNmMGE1MjU2NWFkOTgzMDBmZWVhMGZmYzU4MA==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-03-05T15:41:41Z"}, "committer": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2021-03-05T22:55:27Z"}, "message": "c++: ICE with -Wshadow and enumerator in template [PR99120]\n\nWe crash here, because in a template, an enumerator doesn't have\na type until we've called finish_enum_value_list.  But our -Wshadow\nimplementation, check_local_shadow, is called when we pushdecl in\nbuild_enumerator, which takes place before finish_enum_value_list.\n\ngcc/cp/ChangeLog:\n\n\tPR c++/99120\n\t* name-lookup.c (check_local_shadow): Check if the type of decl\n\tis non-null before checking TYPE_PTR*.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/99120\n\t* g++.dg/warn/Wshadow-17.C: New test.", "tree": {"sha": "81dede6337af8e7772e952f567d32f2c6c427025", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81dede6337af8e7772e952f567d32f2c6c427025"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c2e64c33d9d903f0a52565ad98300feea0ffc580", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2e64c33d9d903f0a52565ad98300feea0ffc580", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2e64c33d9d903f0a52565ad98300feea0ffc580", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2e64c33d9d903f0a52565ad98300feea0ffc580/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "812230c63c3efcf2cb36965fe178420b5f1892a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/812230c63c3efcf2cb36965fe178420b5f1892a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/812230c63c3efcf2cb36965fe178420b5f1892a6"}], "stats": {"total": 18, "additions": 15, "deletions": 3}, "files": [{"sha": "092fa6b8768ee9f7688907829a48be647119e9cb", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c2e64c33d9d903f0a52565ad98300feea0ffc580/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c2e64c33d9d903f0a52565ad98300feea0ffc580/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=c2e64c33d9d903f0a52565ad98300feea0ffc580", "patch": "@@ -3309,7 +3309,7 @@ check_local_shadow (tree decl)\n   /* Don't warn for artificial things that are not implicit typedefs.  */\n   if (DECL_ARTIFICIAL (decl) && !DECL_IMPLICIT_TYPEDEF_P (decl))\n     return;\n-  \n+\n   if (nonlambda_method_basetype ())\n     if (tree member = lookup_member (current_nonlambda_class_type (),\n \t\t\t\t     DECL_NAME (decl), /*protect=*/0,\n@@ -3321,8 +3321,9 @@ check_local_shadow (tree decl)\n \t   is a function or a pointer-to-function.  */\n \tif (!OVL_P (member)\n \t    || TREE_CODE (decl) == FUNCTION_DECL\n-\t    || TYPE_PTRFN_P (TREE_TYPE (decl))\n-\t    || TYPE_PTRMEMFUNC_P (TREE_TYPE (decl)))\n+\t    || (TREE_TYPE (decl)\n+\t\t&& (TYPE_PTRFN_P (TREE_TYPE (decl))\n+\t\t    || TYPE_PTRMEMFUNC_P (TREE_TYPE (decl)))))\n \t  {\n \t    auto_diagnostic_group d;\n \t    if (warning_at (DECL_SOURCE_LOCATION (decl), OPT_Wshadow,"}, {"sha": "0dee397796fbb95fdf1f8b9306e3c6a66737a876", "filename": "gcc/testsuite/g++.dg/warn/Wshadow-17.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c2e64c33d9d903f0a52565ad98300feea0ffc580/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWshadow-17.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c2e64c33d9d903f0a52565ad98300feea0ffc580/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWshadow-17.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWshadow-17.C?ref=c2e64c33d9d903f0a52565ad98300feea0ffc580", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/99120\n+// { dg-options \"-Wshadow\" }\n+\n+struct S {\n+  void X();\n+\n+  template<typename T>\n+  void fn () {\n+    enum { X };\n+  }\n+};"}]}