{"sha": "7c2da05e604c27549afadf4df26c679aead5f414", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2MyZGEwNWU2MDRjMjc1NDlhZmFkZjRkZjI2YzY3OWFlYWQ1ZjQxNA==", "commit": {"author": {"name": "Simon Martin", "email": "simartin@users.sourceforge.net", "date": "2006-12-31T16:09:07Z"}, "committer": {"name": "Simon Martin", "email": "simartin@gcc.gnu.org", "date": "2006-12-31T16:09:07Z"}, "message": "re PR c++/29731 (ICE with statement expression as template parameter)\n\n2006-12-31  Simon Martin  <simartin@users.sourceforge.net>\n\n\tPR c++/29731\n\t* parser.c (cp_parser_primary_expression): Return error_mark_node when\n\ta statement-expression is found outside of a function body.\n\nFrom-SVN: r120299", "tree": {"sha": "ae5544b4685448570f3fe482042f9086491c090c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ae5544b4685448570f3fe482042f9086491c090c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7c2da05e604c27549afadf4df26c679aead5f414", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c2da05e604c27549afadf4df26c679aead5f414", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c2da05e604c27549afadf4df26c679aead5f414", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c2da05e604c27549afadf4df26c679aead5f414/comments", "author": {"login": "simartin", "id": 935202, "node_id": "MDQ6VXNlcjkzNTIwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/935202?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simartin", "html_url": "https://github.com/simartin", "followers_url": "https://api.github.com/users/simartin/followers", "following_url": "https://api.github.com/users/simartin/following{/other_user}", "gists_url": "https://api.github.com/users/simartin/gists{/gist_id}", "starred_url": "https://api.github.com/users/simartin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simartin/subscriptions", "organizations_url": "https://api.github.com/users/simartin/orgs", "repos_url": "https://api.github.com/users/simartin/repos", "events_url": "https://api.github.com/users/simartin/events{/privacy}", "received_events_url": "https://api.github.com/users/simartin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "72ff1a96091ff6a1fb93e1c7087dc17f3c6c5d4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72ff1a96091ff6a1fb93e1c7087dc17f3c6c5d4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72ff1a96091ff6a1fb93e1c7087dc17f3c6c5d4b"}], "stats": {"total": 37, "additions": 30, "deletions": 7}, "files": [{"sha": "ae5beb2a624b45bebf1e05c702e98d3929d6ac7f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7c2da05e604c27549afadf4df26c679aead5f414", "patch": "@@ -1,3 +1,9 @@\n+2006-12-31  Simon Martin  <simartin@users.sourceforge.net>\n+\n+\tPR c++/29731\n+\t* parser.c (cp_parser_primary_expression): Return error_mark_node when\n+\ta statement-expression is found outside of a function body.\n+\n 2006-12-28  Kazu Hirata  <kazu@codesourcery.com>\n \n \t* cp-tree.h (TYPE_NAMESPACE_SCOPE_P, TYPE_FUNCTION_SCOPE_P):"}, {"sha": "82cb796985890e47f42ee3c6c6e3f23a0ce56148", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=7c2da05e604c27549afadf4df26c679aead5f414", "patch": "@@ -3024,13 +3024,20 @@ cp_parser_primary_expression (cp_parser *parser,\n \n \t       at class or namespace scope.  */\n \t    if (!parser->in_function_body)\n-\t      error (\"statement-expressions are allowed only inside functions\");\n-\t    /* Start the statement-expression.  */\n-\t    expr = begin_stmt_expr ();\n-\t    /* Parse the compound-statement.  */\n-\t    cp_parser_compound_statement (parser, expr, false);\n-\t    /* Finish up.  */\n-\t    expr = finish_stmt_expr (expr, false);\n+\t      {\n+\t\terror (\"statement-expressions are allowed only inside functions\");\n+\t\tcp_parser_skip_to_end_of_block_or_statement (parser);\n+\t\texpr = error_mark_node;\n+\t      }\n+\t    else\n+\t      {\n+\t\t/* Start the statement-expression.  */\n+\t\texpr = begin_stmt_expr ();\n+\t\t/* Parse the compound-statement.  */\n+\t\tcp_parser_compound_statement (parser, expr, false);\n+\t\t/* Finish up.  */\n+\t\texpr = finish_stmt_expr (expr, false);\n+\t      }\n \t  }\n \telse\n \t  {"}, {"sha": "df63017b96c836f36631fbca9f39ff93ec0a1aa6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7c2da05e604c27549afadf4df26c679aead5f414", "patch": "@@ -1,3 +1,8 @@\n+2006-12-31  Simon Martin  <simartin@users.sourceforge.net>\n+\n+\tPR c++/29731\n+\t* g++.dg/parse/template22.C: New test.\n+\n 2006-12-31  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/30338"}, {"sha": "c93375685253a386a9ca0f19ff4bbbad8fd0e941", "filename": "gcc/testsuite/g++.dg/parse/template22.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ftemplate22.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c2da05e604c27549afadf4df26c679aead5f414/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ftemplate22.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Ftemplate22.C?ref=7c2da05e604c27549afadf4df26c679aead5f414", "patch": "@@ -0,0 +1,5 @@\n+/* PR c++/29731. This used to ICE in uses_template_parms. */\n+\n+template<int> struct A {};\n+\n+A<({})> a; /* { dg-error \"forbids braced-groups within expressions|statement-expressions|template argument 1 is invalid|invalid type\" } */"}]}