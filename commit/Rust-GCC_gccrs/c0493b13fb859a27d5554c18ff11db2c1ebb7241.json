{"sha": "c0493b13fb859a27d5554c18ff11db2c1ebb7241", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzA0OTNiMTNmYjg1OWEyN2Q1NTU0YzE4ZmYxMWRiMmMxZWJiNzI0MQ==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "dvorakz@suse.cz", "date": "2006-11-12T18:20:03Z"}, "committer": {"name": "Zdenek Dvorak", "email": "rakdver@gcc.gnu.org", "date": "2006-11-12T18:20:03Z"}, "message": "cfgloopmanip.c (update_single_exit_for_duplicated_loop, [...]): New functions.\n\n\t* cfgloopmanip.c (update_single_exit_for_duplicated_loop,\n\tupdate_single_exit_for_duplicated_loops): New functions.\n\t(duplicate_loop_to_header_edge): Use\n\tupdate_single_exit_for_duplicated_loops.\n\t* tree-ssa-loop-manip.c (tree_unroll_loop): Call verification\n\tfunctions only with ENABLE_CHECKING.\n\nFrom-SVN: r118726", "tree": {"sha": "8d48fdb7d07dc37f4d2f16a51dc3192fbda851c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8d48fdb7d07dc37f4d2f16a51dc3192fbda851c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c0493b13fb859a27d5554c18ff11db2c1ebb7241", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0493b13fb859a27d5554c18ff11db2c1ebb7241", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0493b13fb859a27d5554c18ff11db2c1ebb7241", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0493b13fb859a27d5554c18ff11db2c1ebb7241/comments", "author": null, "committer": null, "parents": [{"sha": "8a492e2cbfd97bce61c007d99fa459af68e038d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a492e2cbfd97bce61c007d99fa459af68e038d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a492e2cbfd97bce61c007d99fa459af68e038d2"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "081c6cfde3a2462f6d3ea4b6c1f667d9308d2938", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0493b13fb859a27d5554c18ff11db2c1ebb7241/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0493b13fb859a27d5554c18ff11db2c1ebb7241/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c0493b13fb859a27d5554c18ff11db2c1ebb7241", "patch": "@@ -1,3 +1,12 @@\n+2006-11-12  Zdenek Dvorak <dvorakz@suse.cz>\n+\n+\t* cfgloopmanip.c (update_single_exit_for_duplicated_loop,\n+\tupdate_single_exit_for_duplicated_loops): New functions.\n+\t(duplicate_loop_to_header_edge): Use\n+\tupdate_single_exit_for_duplicated_loops.\n+\t* tree-ssa-loop-manip.c (tree_unroll_loop): Call verification\n+\tfunctions only with ENABLE_CHECKING.\n+\n 2006-11-12  Andreas Schwab  <schwab@suse.de>\n \n \t* except.c (sjlj_emit_function_enter): Remove unused variable."}, {"sha": "8c5a0f14a58c0b32dd8fa6cb5504720ed5302956", "filename": "gcc/cfgloopmanip.c", "status": "modified", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0493b13fb859a27d5554c18ff11db2c1ebb7241/gcc%2Fcfgloopmanip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0493b13fb859a27d5554c18ff11db2c1ebb7241/gcc%2Fcfgloopmanip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloopmanip.c?ref=c0493b13fb859a27d5554c18ff11db2c1ebb7241", "patch": "@@ -770,6 +770,40 @@ update_single_exits_after_duplication (basic_block *bbs, unsigned nbbs,\n     bbs[i]->flags &= ~BB_DUPLICATED;\n }\n \n+/* Updates single exit information for the copy of LOOP.  */\n+\n+static void\n+update_single_exit_for_duplicated_loop (struct loop *loop)\n+{\n+  struct loop *copy = loop->copy;\n+  basic_block src, dest;\n+  edge exit = loop->single_exit;\n+\n+  if (!exit)\n+    return;\n+\n+  src = get_bb_copy (exit->src);\n+  dest = exit->dest;\n+  if (dest->flags & BB_DUPLICATED)\n+    dest = get_bb_copy (dest);\n+\n+  exit = find_edge (src, dest);\n+  gcc_assert (exit != NULL);\n+  copy->single_exit = exit;\n+}\n+\n+/* Updates single exit information for copies of ORIG_LOOPS and their subloops.\n+   N is the number of the loops in the ORIG_LOOPS array.  */\n+\n+static void\n+update_single_exit_for_duplicated_loops (struct loop *orig_loops[], unsigned n)\n+{\n+  unsigned i;\n+\n+  for (i = 0; i < n; i++)\n+    update_single_exit_for_duplicated_loop (orig_loops[i]);\n+}\n+\n /* Duplicates body of LOOP to given edge E NDUPL times.  Takes care of updating\n    LOOPS structure and dominators.  E's destination must be LOOP header for\n    this to work, i.e. it must be entry or latch edge of this loop; these are\n@@ -950,6 +984,15 @@ duplicate_loop_to_header_edge (struct loop *loop, edge e, struct loops *loops,\n \t\tplace_after);\n       place_after = new_spec_edges[SE_LATCH]->src;\n \n+      if (loops->state & LOOPS_HAVE_MARKED_SINGLE_EXITS)\n+\t{\n+\t  for (i = 0; i < n; i++)\n+\t    bbs[i]->flags |= BB_DUPLICATED;\n+\t  update_single_exit_for_duplicated_loops (orig_loops, n_orig_loops);\n+\t  for (i = 0; i < n; i++)\n+\t    bbs[i]->flags &= ~BB_DUPLICATED;\n+\t}\n+\n       if (flags & DLTHE_RECORD_COPY_NUMBER)\n \tfor (i = 0; i < n; i++)\n \t  {"}, {"sha": "dde0e8d2a09fc307a380505f76c866bebeaa0fd5", "filename": "gcc/tree-ssa-loop-manip.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0493b13fb859a27d5554c18ff11db2c1ebb7241/gcc%2Ftree-ssa-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0493b13fb859a27d5554c18ff11db2c1ebb7241/gcc%2Ftree-ssa-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-manip.c?ref=c0493b13fb859a27d5554c18ff11db2c1ebb7241", "patch": "@@ -940,8 +940,10 @@ tree_unroll_loop (struct loops *loops, struct loop *loop, unsigned factor,\n \t\t\t   tree_block_label (rest));\n   bsi_insert_after (&bsi, exit_if, BSI_NEW_STMT);\n \n+#ifdef ENABLE_CHECKING\n   verify_flow_info ();\n   verify_dominators (CDI_DOMINATORS);\n   verify_loop_structure (loops);\n   verify_loop_closed_ssa ();\n+#endif\n }"}]}