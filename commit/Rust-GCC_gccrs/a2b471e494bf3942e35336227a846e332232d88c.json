{"sha": "a2b471e494bf3942e35336227a846e332232d88c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTJiNDcxZTQ5NGJmMzk0MmUzNTMzNjIyN2E4NDZlMzMyMjMyZDg4Yw==", "commit": {"author": {"name": "Seth Johnson", "email": "johnsonsr@ornl.gov", "date": "2018-03-25T11:30:24Z"}, "committer": {"name": "Dominique d'Humieres", "email": "dominiq@gcc.gnu.org", "date": "2018-03-25T11:30:24Z"}, "message": "re PR fortran/84924 (Erroneous error in C_F_POINTER)\n\n2018-03-25  Seth Johnson <johnsonsr@ornl.gov>\n\tDominique d'Humieres  <dominiq@gcc.gnu.org>\n\n\tPR fortran/84924\n\t* check.c (gfc_check_c_f_pointer): Allow scalar noninteroperable\n\tscalar derived type with -std=f2003 and -std=f2008.\n\n2018-03-25  Seth Johnson <johnsonsr@ornl.gov>\n\tDominique d'Humieres  <dominiq@gcc.gnu.org>\n\n\tPR fortran/84924\n\t* gfortran.dg/scalar_pointer_1.f90: New test.\n\n\nCo-Authored-By: Dominique d'Humieres <dominiq@gcc.gnu.org>\n\nFrom-SVN: r258843", "tree": {"sha": "e5a533858deb6dbe102dd31881e67e07a06e070c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e5a533858deb6dbe102dd31881e67e07a06e070c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2b471e494bf3942e35336227a846e332232d88c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2b471e494bf3942e35336227a846e332232d88c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2b471e494bf3942e35336227a846e332232d88c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2b471e494bf3942e35336227a846e332232d88c/comments", "author": {"login": "sethrj", "id": 741229, "node_id": "MDQ6VXNlcjc0MTIyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/741229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sethrj", "html_url": "https://github.com/sethrj", "followers_url": "https://api.github.com/users/sethrj/followers", "following_url": "https://api.github.com/users/sethrj/following{/other_user}", "gists_url": "https://api.github.com/users/sethrj/gists{/gist_id}", "starred_url": "https://api.github.com/users/sethrj/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sethrj/subscriptions", "organizations_url": "https://api.github.com/users/sethrj/orgs", "repos_url": "https://api.github.com/users/sethrj/repos", "events_url": "https://api.github.com/users/sethrj/events{/privacy}", "received_events_url": "https://api.github.com/users/sethrj/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "60ac5d9dd93ea7d95f69d9082eba0ed0d1a1baf0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60ac5d9dd93ea7d95f69d9082eba0ed0d1a1baf0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/60ac5d9dd93ea7d95f69d9082eba0ed0d1a1baf0"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "4d93c55fe50c2f03a1361934c56f508b7ef9cec5", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a2b471e494bf3942e35336227a846e332232d88c", "patch": "@@ -1,3 +1,10 @@\n+2018-03-25  Seth Johnson <johnsonsr@ornl.gov>\n+\tDominique d'Humieres  <dominiq@gcc.gnu.org>\n+\n+\tPR fortran/84924\n+\t* check.c (gfc_check_c_f_pointer): Allow scalar noninteroperable\n+\tscalar derived type with -std=f2003 and -std=f2008.\n+\n 2018-03-24  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \t    Dominique d'Humieres  <dominiq@gcc.gnu.org>\n "}, {"sha": "83bd004eaac2b6bcbb929600cac45d501b607cc0", "filename": "gcc/fortran/check.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ffortran%2Fcheck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ffortran%2Fcheck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.c?ref=a2b471e494bf3942e35336227a846e332232d88c", "patch": "@@ -4749,7 +4749,7 @@ gfc_check_c_f_pointer (gfc_expr *cptr, gfc_expr *fptr, gfc_expr *shape)\n       return false;\n     }\n \n-  if (!is_c_interoperable (fptr, &msg, false, true))\n+  if (fptr->rank > 0 && !is_c_interoperable (fptr, &msg, false, true))\n     return gfc_notify_std (GFC_STD_F2008_TS, \"Noninteroperable array FPTR \"\n \t\t\t   \"at %L to C_F_POINTER: %s\", &fptr->where, msg);\n "}, {"sha": "8b462a5e9ebb81114b22280895a1f2996b67a132", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a2b471e494bf3942e35336227a846e332232d88c", "patch": "@@ -1,3 +1,9 @@\n+2018-03-25  Seth Johnson <johnsonsr@ornl.gov>\n+\tDominique d'Humieres  <dominiq@gcc.gnu.org>\n+\n+\tPR fortran/84924\n+\t* gfortran.dg/scalar_pointer_1.f90: New test.\n+\n 2018-03-25  Tom de Vries  <tom@codesourcery.com>\n \n \t* gcc.dg/tree-ssa/vrp104.c: Make scan-tree-dump-times pattern more"}, {"sha": "d421f3884584d967df550f6156990913319f51ce", "filename": "gcc/testsuite/gfortran.dg/scalar_pointer_1.f90", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ftestsuite%2Fgfortran.dg%2Fscalar_pointer_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2b471e494bf3942e35336227a846e332232d88c/gcc%2Ftestsuite%2Fgfortran.dg%2Fscalar_pointer_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fscalar_pointer_1.f90?ref=a2b471e494bf3942e35336227a846e332232d88c", "patch": "@@ -0,0 +1,36 @@\n+! { dg-do compile }\n+! { dg-options \"-std=f2003\" }\n+! PR fortran/84924\n+! Testcase contributed by Seth Johnson <johnsonsr@ornl.gov>\n+!\n+module ftest\n+    use ISO_C_BINDING\n+    implicit none\n+\n+    type :: Cls\n+    end type\n+\n+    type :: ClsHandle\n+        class(Cls), pointer :: ptr\n+    end type\n+contains\n+    subroutine to_ptr(c, p)\n+        use ISO_C_BINDING\n+        class(Cls), intent(in), target :: c\n+        type(C_PTR), intent(out) :: p\n+        type(ClsHandle), pointer :: handle\n+        allocate(handle)\n+        handle%ptr => c\n+        p = c_loc(handle)\n+    end subroutine\n+\n+    subroutine from_ptr(p, c)\n+        use ISO_C_BINDING\n+        type(C_PTR), intent(in) :: p\n+        class(Cls), intent(out), pointer :: c\n+        type(ClsHandle), pointer :: handle\n+        call c_f_pointer(cptr=p, fptr=handle)\n+        c => handle%ptr\n+        deallocate(handle)\n+    end subroutine\n+end module"}]}