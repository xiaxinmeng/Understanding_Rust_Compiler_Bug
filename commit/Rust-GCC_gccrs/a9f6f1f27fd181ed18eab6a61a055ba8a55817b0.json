{"sha": "a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTlmNmYxZjI3ZmQxODFlZDE4ZWFiNmE2MWEwNTViYThhNTU4MTdiMA==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2006-10-27T20:47:28Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2006-10-27T20:47:28Z"}, "message": "re PR fortran/27954 (ICE on garbage in DATA statement)\n\n2006-10-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/27954\n\t* decl.c (gfc_free_data_all): New function to free all data structures\n\tafter errors in DATA statements and declarations.\n\t(top_var_list): Use new function.(top_val_list): Use new function.\n\t(gfc_match_data_decl): Use new function.\n\t* misc.c (gfc_typename): Fixed incorrect function name in error text.\n\nFrom-SVN: r118084", "tree": {"sha": "9d7bdaf4ce466133c4469aa04221cb3c9ad73d70", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d7bdaf4ce466133c4469aa04221cb3c9ad73d70"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/comments", "author": null, "committer": null, "parents": [{"sha": "95c0fb7a066b8f41723150b08e4aa3c08622bc2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95c0fb7a066b8f41723150b08e4aa3c08622bc2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95c0fb7a066b8f41723150b08e4aa3c08622bc2b"}], "stats": {"total": 30, "additions": 29, "deletions": 1}, "files": [{"sha": "8ff4a5fff5649ec82aa17eb9402bebab003e3a7c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "patch": "@@ -1,3 +1,12 @@\n+2006-10-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/27954\n+\t* decl.c (gfc_free_data_all): New function to free all data structures\n+\tafter errors in DATA statements and declarations.\n+\t(top_var_list): Use new function.(top_val_list): Use new function.\n+\t(gfc_match_data_decl): Use new function.\n+\t* misc.c (gfc_typename): Fixed incorrect function name in error text. \n+\n 2006-10-24  Erik Edelmann  <eedelman@gcc.gnu.org>\n \n \tPR fortran/29393"}, {"sha": "fbd2bbbe360375ec6b39b59b65aea970aadc472b", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "patch": "@@ -128,6 +128,21 @@ gfc_free_data (gfc_data * p)\n }\n \n \n+/* Free all data in a namespace.  */\n+static void\n+gfc_free_data_all (gfc_namespace * ns)\n+{\n+  gfc_data *d;\n+\n+  for (;ns->data;)\n+    {\n+      d = ns->data->next;\n+      gfc_free (ns->data);\n+      ns->data = d;\n+    }\n+}\n+\n+\n static match var_element (gfc_data_variable *);\n \n /* Match a list of variables terminated by an iterator and a right\n@@ -262,6 +277,7 @@ top_var_list (gfc_data * d)\n \n syntax:\n   gfc_syntax_error (ST_DATA);\n+  gfc_free_data_all (gfc_current_ns);\n   return MATCH_ERROR;\n }\n \n@@ -374,6 +390,7 @@ top_val_list (gfc_data * data)\n \n syntax:\n   gfc_syntax_error (ST_DATA);\n+  gfc_free_data_all (gfc_current_ns);\n   return MATCH_ERROR;\n }\n \n@@ -2368,6 +2385,8 @@ gfc_match_data_decl (void)\n   gfc_error (\"Syntax error in data declaration at %C\");\n   m = MATCH_ERROR;\n \n+  gfc_free_data_all (gfc_current_ns);\n+\n cleanup:\n   gfc_free_array_spec (current_as);\n   current_as = NULL;"}, {"sha": "bafb69819dddf70d37f7db77c7b5619e6ed943a8", "filename": "gcc/fortran/misc.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/gcc%2Ffortran%2Fmisc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9f6f1f27fd181ed18eab6a61a055ba8a55817b0/gcc%2Ffortran%2Fmisc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmisc.c?ref=a9f6f1f27fd181ed18eab6a61a055ba8a55817b0", "patch": "@@ -193,7 +193,7 @@ gfc_typename (gfc_typespec * ts)\n       strcpy (buffer, \"UNKNOWN\");\n       break;\n     default:\n-      gfc_internal_error (\"gfc_typespec(): Undefined type\");\n+      gfc_internal_error (\"gfc_typename(): Undefined type\");\n     }\n \n   return buffer;"}]}