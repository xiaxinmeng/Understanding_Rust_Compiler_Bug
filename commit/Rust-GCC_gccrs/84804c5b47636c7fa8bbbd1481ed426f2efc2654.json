{"sha": "84804c5b47636c7fa8bbbd1481ed426f2efc2654", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODQ4MDRjNWI0NzYzNmM3ZmE4YmJiZDE0ODFlZDQyNmYyZWZjMjY1NA==", "commit": {"author": {"name": "Claudiu Zissulescu", "email": "claziss@synopsys.com", "date": "2017-03-27T10:56:04Z"}, "committer": {"name": "Claudiu Zissulescu", "email": "claziss@gcc.gnu.org", "date": "2017-03-27T10:56:04Z"}, "message": "[ARC] Save/restore blink when in ISR.\n\ngcc/\n2017-03-27  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* config/arc/arc.c (arc_epilogue_uses): BLINK should be also\n\trestored when in interrupt.\n\t* config/arc/arc.md (simple_return): ARCv2 rtie instruction\n\tdoesn't have delay slot.\n\n2017-03-27  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* testsuite/gcc.target/arc/interrupt-4.c: New file.\n\nFrom-SVN: r246495", "tree": {"sha": "98fbcc94f6f8c9ff7f65db94999708007e2de327", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/98fbcc94f6f8c9ff7f65db94999708007e2de327"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/84804c5b47636c7fa8bbbd1481ed426f2efc2654", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84804c5b47636c7fa8bbbd1481ed426f2efc2654", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84804c5b47636c7fa8bbbd1481ed426f2efc2654", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84804c5b47636c7fa8bbbd1481ed426f2efc2654/comments", "author": {"login": "claziss", "id": 2761368, "node_id": "MDQ6VXNlcjI3NjEzNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claziss", "html_url": "https://github.com/claziss", "followers_url": "https://api.github.com/users/claziss/followers", "following_url": "https://api.github.com/users/claziss/following{/other_user}", "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}", "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claziss/subscriptions", "organizations_url": "https://api.github.com/users/claziss/orgs", "repos_url": "https://api.github.com/users/claziss/repos", "events_url": "https://api.github.com/users/claziss/events{/privacy}", "received_events_url": "https://api.github.com/users/claziss/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c5e5f5f6429b05b47110f8dea839ec055d69bb4f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5e5f5f6429b05b47110f8dea839ec055d69bb4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5e5f5f6429b05b47110f8dea839ec055d69bb4f"}], "stats": {"total": 43, "additions": 38, "deletions": 5}, "files": [{"sha": "336fa7fedf154312e343f31e6827ba85736e881d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=84804c5b47636c7fa8bbbd1481ed426f2efc2654", "patch": "@@ -1,3 +1,10 @@\n+2017-03-27  Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* config/arc/arc.c (arc_epilogue_uses): BLINK should be also\n+\trestored when in interrupt.\n+\t* config/arc/arc.md (simple_return): ARCv2 rtie instruction\n+\tdoesn't have delay slot.\n+\n 2017-03-27  Richard Biener  <rguenther@suse.de>\n \n \tPR ipa/79776"}, {"sha": "0563a74b72471764890e012cfa5692b19fee1fca", "filename": "gcc/config/arc/arc.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Fconfig%2Farc%2Farc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Fconfig%2Farc%2Farc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.c?ref=84804c5b47636c7fa8bbbd1481ed426f2efc2654", "patch": "@@ -9381,9 +9381,10 @@ arc_can_follow_jump (const rtx_insn *follower, const rtx_insn *followee)\n    Return true if REGNO should be added to the deemed uses of the epilogue.\n \n    We use the return address\n-   arc_return_address_regs[arc_compute_function_type (cfun)] .\n-   But also, we have to make sure all the register restore instructions\n-   are known to be live in interrupt functions.  */\n+   arc_return_address_regs[arc_compute_function_type (cfun)].  But\n+   also, we have to make sure all the register restore instructions\n+   are known to be live in interrupt functions, plus the blink\n+   register if it is clobbered by the isr.  */\n \n bool\n arc_epilogue_uses (int regno)\n@@ -9396,7 +9397,8 @@ arc_epilogue_uses (int regno)\n \t{\n \t  if (!fixed_regs[regno])\n \t    return true;\n-\t  return regno == arc_return_address_regs[cfun->machine->fn_type];\n+\t  return ((regno == arc_return_address_regs[cfun->machine->fn_type])\n+\t\t  || (regno == RETURN_ADDR_REGNUM));\n \t}\n       else\n \treturn regno == RETURN_ADDR_REGNUM;"}, {"sha": "88b7fca8c08e25c6b08967866cd401ee6795a1c7", "filename": "gcc/config/arc/arc.md", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Fconfig%2Farc%2Farc.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Fconfig%2Farc%2Farc.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.md?ref=84804c5b47636c7fa8bbbd1481ed426f2efc2654", "patch": "@@ -4748,7 +4748,12 @@\n   output_asm_insn (\\\"j%!%* [%0]%&\\\", &reg);\n   return \\\"\\\";\n }\n-  [(set_attr \"type\" \"return\")\n+  [(set (attr \"type\")\n+\t(cond [(and (eq (symbol_ref \"arc_compute_function_type (cfun)\")\n+\t\t\t(symbol_ref \"ARC_FUNCTION_ILINK1\"))\n+\t\t    (match_test \"TARGET_V2\"))\n+\t       (const_string \"brcc_no_delay_slot\")]\n+\t      (const_string \"return\")))\n    ; predicable won't help here since the canonical rtl looks different\n    ; for branches.\n    (set (attr \"cond\")"}, {"sha": "184ccdb4712171805348e2c6ba39d98590bcb98d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=84804c5b47636c7fa8bbbd1481ed426f2efc2654", "patch": "@@ -1,3 +1,7 @@\n+2017-03-27  Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* testsuite/gcc.target/arc/interrupt-4.c: New file.\n+\n 2017-03-27  Richard Biener  <rguenther@suse.de>\n \n \tPR ipa/79776"}, {"sha": "ea6596eb128317d651967bedaf0bcdf46d88bf49", "filename": "gcc/testsuite/gcc.target/arc/interrupt-4.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Ftestsuite%2Fgcc.target%2Farc%2Finterrupt-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84804c5b47636c7fa8bbbd1481ed426f2efc2654/gcc%2Ftestsuite%2Fgcc.target%2Farc%2Finterrupt-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farc%2Finterrupt-4.c?ref=84804c5b47636c7fa8bbbd1481ed426f2efc2654", "patch": "@@ -0,0 +1,15 @@\n+#if defined (__ARCHS__) || defined (__ARCEM__)\n+#define RILINK \"ilink\"\n+#else\n+#define RILINK \"ilink1\"\n+#endif\n+\n+extern int gpio_int;\n+extern int read_reg (int);\n+\n+void __attribute__ ((interrupt(RILINK)))\n+isr_handler (void)\n+{\n+  gpio_int = read_reg (1);\n+}\n+/* { dg-final { scan-assembler-times \"blink\" 2 } } */"}]}