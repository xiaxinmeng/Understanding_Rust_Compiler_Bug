{"sha": "b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjVlZTlkMWMwZDk5NTUzMzVlN2Q4YTBjZjc2NTNmNDRkMGFmYjJhYg==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2011-06-11T08:22:35Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2011-06-11T08:22:35Z"}, "message": "frontend-passes.c (optimize_assignment): Follow chains of concatenation operators to the end for removing trailing TRIMS...\n\n2011-05-11  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\t* frontend-passes.c (optimize_assignment): Follow chains\n\tof concatenation operators to the end for removing trailing\n\tTRIMS for assignments.\n\n2011-05-11  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\t* gfortran.dg/trim_optimize_7.f90:  New test.\n\nFrom-SVN: r174944", "tree": {"sha": "fde0740af1e7c95d4eb70f492675b55b2699317c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fde0740af1e7c95d4eb70f492675b55b2699317c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/comments", "author": null, "committer": null, "parents": [{"sha": "891daafaf87384c823ff5186562e5132f246a9e4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/891daafaf87384c823ff5186562e5132f246a9e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/891daafaf87384c823ff5186562e5132f246a9e4"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "ac9f3cae1884d7fc1a2436e8a1dac85794df4069", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "patch": "@@ -1,3 +1,9 @@\n+2011-05-11  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\t* frontend-passes.c (optimize_assignment): Follow chains\n+\tof concatenation operators to the end for removing trailing\n+\tTRIMS for assignments.\n+\n 2011-06-10  Daniel Carrera  <dcarrera@gmail.com>\n \n \t* trans-decl.c (gfc_build_builtin_function_decls):"}, {"sha": "d1cc22979b7903e14c07282d1c6697c68aa90acb", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "patch": "@@ -500,6 +500,14 @@ optimize_assignment (gfc_code * c)\n \n   if (lhs->ts.type == BT_CHARACTER)\n     {\n+      /* Check for a // b // trim(c).  Looping is probably not\n+\t necessary because the parser usually generates\n+\t (// (// a b ) trim(c) ) , but better safe than sorry.  */\n+\n+      while (rhs->expr_type == EXPR_OP\n+\t     && rhs->value.op.op == INTRINSIC_CONCAT)\n+\trhs = rhs->value.op.op2;\n+\n       if (rhs->expr_type == EXPR_FUNCTION &&\n \t  rhs->value.function.isym &&\n \t  rhs->value.function.isym->id == GFC_ISYM_TRIM)"}, {"sha": "f34cf1933ff95bbe98fc359580834b8e90e1829c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "patch": "@@ -1,3 +1,7 @@\n+2011-05-11  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\t* gfortran.dg/trim_optimize_7.f90:  New test.\n+\n 2011-06-10  Wei Guozhi  <carrot@google.com>\n \n \tPR target/45335"}, {"sha": "26663c04d27e3df1dcc469b1fdecd1b240a55c87", "filename": "gcc/testsuite/gfortran.dg/trim_optimize_7.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ftestsuite%2Fgfortran.dg%2Ftrim_optimize_7.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab/gcc%2Ftestsuite%2Fgfortran.dg%2Ftrim_optimize_7.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftrim_optimize_7.f90?ref=b5ee9d1c0d9955335e7d8a0cf7653f44d0afb2ab", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! { dg-options \"-O -fdump-tree-original\" }\n+! Check that trailing trims are also removed from assignment of\n+! expressions involving concatenations of strings .\n+program main\n+  character(2) :: a,b,c\n+  character(8) :: d\n+  a = 'a '\n+  b = 'b '\n+  c = 'c '\n+  d = a // b // a // trim(c)   ! This should be optimized away.\n+  if (d /= 'a b a c ') call abort\n+  d = a // trim(b) // c // a   ! This shouldn't.\n+  if (d /= 'a bc a  ') call abort\n+  d = a // b // a // trim(trim(c)) ! This should also be optimized away.\n+  if (d /= 'a b a c ') call abort\n+end\n+! { dg-final { scan-tree-dump-times \"string_len_trim\" 1 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }"}]}