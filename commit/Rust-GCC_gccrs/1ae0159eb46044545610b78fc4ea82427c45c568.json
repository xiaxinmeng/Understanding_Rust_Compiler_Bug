{"sha": "1ae0159eb46044545610b78fc4ea82427c45c568", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWFlMDE1OWViNDYwNDQ1NDU2MTBiNzhmYzRlYTgyNDI3YzQ1YzU2OA==", "commit": {"author": {"name": "Simon Buist", "email": "buist@adacore.com", "date": "2019-07-10T09:02:12Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-10T09:02:12Z"}, "message": "[Ada] Entity names are not unique\n\nThis patch updates the Unique_Name procedure in order to prefix the\nstring \"ada___\" to child units that have a nested subprogram or package,\nso that they do not clash with a parent package of the same name.\n\nThis is for GNATprove only and does not affect regular compilation.\n\n2019-07-10  Simon Buist  <buist@adacore.com>\n\ngcc/ada/\n\n\t* sem_util.ads (Child_Prefix): New constant.\n\t* sem_util.adb (Unique_Name): Add a special prefix to child\n\tunits that have a nested subprogram or package.\n\nFrom-SVN: r273343", "tree": {"sha": "aba954c995b32716e71cf247113d6b8c0e882f66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aba954c995b32716e71cf247113d6b8c0e882f66"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1ae0159eb46044545610b78fc4ea82427c45c568", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ae0159eb46044545610b78fc4ea82427c45c568", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ae0159eb46044545610b78fc4ea82427c45c568", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ae0159eb46044545610b78fc4ea82427c45c568/comments", "author": null, "committer": null, "parents": [{"sha": "f35688c95a8ab5d3d6eeee51623d69705a00b115", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f35688c95a8ab5d3d6eeee51623d69705a00b115", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f35688c95a8ab5d3d6eeee51623d69705a00b115"}], "stats": {"total": 12, "additions": 12, "deletions": 0}, "files": [{"sha": "7e609bdc04932ccc9d6d057d09dd4bb9d85978ed", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ae0159eb46044545610b78fc4ea82427c45c568/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ae0159eb46044545610b78fc4ea82427c45c568/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=1ae0159eb46044545610b78fc4ea82427c45c568", "patch": "@@ -1,3 +1,9 @@\n+2019-07-10  Simon Buist  <buist@adacore.com>\n+\n+\t* sem_util.ads (Child_Prefix): New constant.\n+\t* sem_util.adb (Unique_Name): Add a special prefix to child\n+\tunits that have a nested subprogram or package.\n+\n 2019-07-10  Arnaud Charlet  <charlet@adacore.com>\n \n \t* sfn_scan.adb (Scan_SFN_Pragmas): Add pragma Assert."}, {"sha": "448eea15e6d0e622bba3d2bcaec568e029de6303", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ae0159eb46044545610b78fc4ea82427c45c568/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ae0159eb46044545610b78fc4ea82427c45c568/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=1ae0159eb46044545610b78fc4ea82427c45c568", "patch": "@@ -25781,6 +25781,8 @@ package body Sem_Util is\n                   end if;\n                end;\n \n+            elsif Is_Child_Unit (U) then\n+               return Child_Prefix & Unique_Name (S) & \"__\" & This_Name;\n             else\n                return Unique_Name (S) & \"__\" & This_Name;\n             end if;"}, {"sha": "808d693525737e779f8df6cce01f8f24cde81140", "filename": "gcc/ada/sem_util.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ae0159eb46044545610b78fc4ea82427c45c568/gcc%2Fada%2Fsem_util.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ae0159eb46044545610b78fc4ea82427c45c568/gcc%2Fada%2Fsem_util.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.ads?ref=1ae0159eb46044545610b78fc4ea82427c45c568", "patch": "@@ -2854,6 +2854,10 @@ package Sem_Util is\n    --  Return a unique name for entity E, which could be used to identify E\n    --  across compilation units.\n \n+   Child_Prefix : constant String := \"ada___\";\n+   --  Prefix for child packages when building a unique name for an entity. It\n+   --  is included here to share between Unique_Name and gnatprove.\n+\n    function Unit_Is_Visible (U : Entity_Id) return Boolean;\n    --  Determine whether a compilation unit is visible in the current context,\n    --  because there is a with_clause that makes the unit available. Used to"}]}