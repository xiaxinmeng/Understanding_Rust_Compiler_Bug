{"sha": "cd2f262b2fa4292a39b97ab590b46e79d349817c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2QyZjI2MmIyZmE0MjkyYTM5Yjk3YWI1OTBiNDZlNzlkMzQ5ODE3Yw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-05-14T15:35:12Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-05-14T15:35:12Z"}, "message": "Add __attribute__((malloc) to allocator and remove unused code\n\n\t* include/bits/valarray_array.h (__valarray_get_memory): Remove.\n\t(__valarray_get_storage): Call operator new directly. Remove ignored\n\ttop-level restrict qualifier and add malloc attribute instead.\n\t(_Array<_Tp>::_Array(size_t)): Remove unused constructor.\n\nFrom-SVN: r260230", "tree": {"sha": "37ca4de6c9508ea29a32bf5952d32305d240cb6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/37ca4de6c9508ea29a32bf5952d32305d240cb6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cd2f262b2fa4292a39b97ab590b46e79d349817c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd2f262b2fa4292a39b97ab590b46e79d349817c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd2f262b2fa4292a39b97ab590b46e79d349817c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd2f262b2fa4292a39b97ab590b46e79d349817c/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6bfbebb063100f6ab845a8456fc7fec99361da80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6bfbebb063100f6ab845a8456fc7fec99361da80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6bfbebb063100f6ab845a8456fc7fec99361da80"}], "stats": {"total": 27, "additions": 11, "deletions": 16}, "files": [{"sha": "e8322137756c794dafeb6d64570b53a444b0e0ca", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd2f262b2fa4292a39b97ab590b46e79d349817c/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd2f262b2fa4292a39b97ab590b46e79d349817c/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=cd2f262b2fa4292a39b97ab590b46e79d349817c", "patch": "@@ -1,5 +1,10 @@\n 2018-05-14  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* include/bits/valarray_array.h (__valarray_get_memory): Remove.\n+\t(__valarray_get_storage): Call operator new directly. Remove ignored\n+\ttop-level restrict qualifier and add malloc attribute instead.\n+\t(_Array<_Tp>::_Array(size_t)): Remove unused constructor.\n+\n \tPR libstdc++/67554\n \t* include/bits/valarray_array.h (_Array_copy_ctor<_Tp, true>)\n \t(_Array_copier<_Tp, true>): Do not pass null pointers to memcpy."}, {"sha": "6759d6003e9646121c76a386476ec8352dcff736", "filename": "libstdc++-v3/include/bits/valarray_array.h", "status": "modified", "additions": 6, "deletions": 16, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cd2f262b2fa4292a39b97ab590b46e79d349817c/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvalarray_array.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cd2f262b2fa4292a39b97ab590b46e79d349817c/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvalarray_array.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fvalarray_array.h?ref=cd2f262b2fa4292a39b97ab590b46e79d349817c", "patch": "@@ -47,18 +47,15 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   // Helper functions on raw pointers\n   //\n \n-  // We get memory by the old fashion way\n-  inline void*\n-  __valarray_get_memory(size_t __n)\n-  { return operator new(__n); }\n+  // We get memory the old fashioned way\n+  template<typename _Tp>\n+    _Tp*\n+    __valarray_get_storage(size_t) __attribute__((__malloc__));\n \n   template<typename _Tp>\n-    inline _Tp*__restrict__\n+    inline _Tp*\n     __valarray_get_storage(size_t __n)\n-    {\n-      return static_cast<_Tp*__restrict__>\n-\t(std::__valarray_get_memory(__n * sizeof(_Tp)));\n-    }\n+    { return static_cast<_Tp*>(operator new(__n * sizeof(_Tp))); }\n \n   // Return memory to the system\n   inline void\n@@ -410,7 +407,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   template<typename _Tp>\n     struct _Array\n     {\n-      explicit _Array(size_t);\n       explicit _Array(_Tp* const __restrict__);\n       explicit _Array(const valarray<_Tp>&);\n       _Array(const _Tp* __restrict__, size_t);\n@@ -503,12 +499,6 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t    __dst._M_data, __j._M_data);\n     }\n \n-  template<typename _Tp>\n-    inline\n-    _Array<_Tp>::_Array(size_t __n)\n-    : _M_data(__valarray_get_storage<_Tp>(__n))\n-    { std::__valarray_default_construct(_M_data, _M_data + __n); }\n-\n   template<typename _Tp>\n     inline\n     _Array<_Tp>::_Array(_Tp* const __restrict__ __p)"}]}