{"sha": "4c3b378b5a9ddba3a66fa24203df5e850b4de3d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGMzYjM3OGI1YTlkZGJhM2E2NmZhMjQyMDNkZjVlODUwYjRkZTNkNg==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@arm.com", "date": "2015-07-16T05:49:47Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2015-07-16T05:49:47Z"}, "message": "tree-ssa-loop-ivopts.c (add_candidate): Remove call to add_autoinc_candidates.\n\n\n\t* tree-ssa-loop-ivopts.c (add_candidate): Remove call to\n\tadd_autoinc_candidates.\n\t(add_iv_candidate_for_biv): Rename to add_iv_candidate_for_biv.\n\t(add_iv_candidate_for_biv): Rename from add_iv_candidate_for_biv.\n\t(add_old_ivs_candidates): Rename to add_iv_candidate_for_bivs.\n\t(add_iv_candidate_for_bivs): Rename from add_old_ivs_candidates.\n\tCall new function.\n\t(add_iv_value_candidates): Rename to add_iv_candidate_for_use.\n\t(add_iv_candidate_for_use): Rename from add_iv_value_candidates.\n\tRemove parameter struct iv*.  Call add_autoinc_candidates here.\n\t(add_derived_ivs_candidates): Rename to add_iv_candidate_for_uses.\n\t(add_iv_candidate_for_uses): Rename from add_derived_ivs_candidates.\n\tCall new function.\n\t(find_iv_candidates): Call new functions.\n\nFrom-SVN: r225859", "tree": {"sha": "2260573a0b7e5807d0b3e1d91f4a27562a6dc69e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2260573a0b7e5807d0b3e1d91f4a27562a6dc69e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6/comments", "author": null, "committer": null, "parents": [{"sha": "a6885f12c73d525ad577fb5c2ae4a7c94ab53e31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6885f12c73d525ad577fb5c2ae4a7c94ab53e31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6885f12c73d525ad577fb5c2ae4a7c94ab53e31"}], "stats": {"total": 55, "additions": 37, "deletions": 18}, "files": [{"sha": "8e3820597a324ec9082918e0812eff7a7eae087a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4c3b378b5a9ddba3a66fa24203df5e850b4de3d6", "patch": "@@ -1,3 +1,20 @@\n+2015-07-16  Bin Cheng  <bin.cheng@arm.com>\n+\n+\t* tree-ssa-loop-ivopts.c (add_candidate): Remove call to\n+\tadd_autoinc_candidates.\n+\t(add_iv_candidate_for_biv): Rename to add_iv_candidate_for_biv.\n+\t(add_iv_candidate_for_biv): Rename from add_iv_candidate_for_biv.\n+\t(add_old_ivs_candidates): Rename to add_iv_candidate_for_bivs.\n+\t(add_iv_candidate_for_bivs): Rename from add_old_ivs_candidates.\n+\tCall new function.\n+\t(add_iv_value_candidates): Rename to add_iv_candidate_for_use.\n+\t(add_iv_candidate_for_use): Rename from add_iv_value_candidates.\n+\tRemove parameter struct iv*.  Call add_autoinc_candidates here.\n+\t(add_derived_ivs_candidates): Rename to add_iv_candidate_for_uses.\n+\t(add_iv_candidate_for_uses): Rename from add_derived_ivs_candidates.\n+\tCall new function.\n+\t(find_iv_candidates): Call new functions.\n+\n 2015-07-16  Sandra Loosemore  <sandra@codesourcery.com>\n \n \t* config/nios2/nios2.c (nios2_emit_stack_limit_check): Fix"}, {"sha": "6bce3a1090d5a1c3e822d696557db376f976e713", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 20, "deletions": 18, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c3b378b5a9ddba3a66fa24203df5e850b4de3d6/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=4c3b378b5a9ddba3a66fa24203df5e850b4de3d6", "patch": "@@ -2788,7 +2788,8 @@ add_autoinc_candidates (struct ivopts_data *data, tree base, tree step,\n \n /* Adds a candidate BASE + STEP * i.  Important field is set to IMPORTANT and\n    position to POS.  If USE is not NULL, the candidate is set as related to\n-   it.  The candidate computation is scheduled on all available positions.  */\n+   it.  The candidate computation is scheduled before exit condition and at\n+   the end of loop.  */\n \n static void\n add_candidate (struct ivopts_data *data,\n@@ -2801,9 +2802,6 @@ add_candidate (struct ivopts_data *data,\n   if (ip_end_pos (data->current_loop)\n       && allow_ip_end_pos_p (data->current_loop))\n     add_candidate_1 (data, base, step, important, IP_END, use, NULL);\n-\n-  if (use != NULL && use->type == USE_ADDRESS)\n-    add_autoinc_candidates (data, base, step, important, use);\n }\n \n /* Adds standard iv candidates.  */\n@@ -2832,7 +2830,7 @@ add_standard_iv_candidates (struct ivopts_data *data)\n /* Adds candidates bases on the old induction variable IV.  */\n \n static void\n-add_old_iv_candidates (struct ivopts_data *data, struct iv *iv)\n+add_iv_candidate_for_biv (struct ivopts_data *data, struct iv *iv)\n {\n   gimple phi;\n   tree def;\n@@ -2872,7 +2870,7 @@ add_old_iv_candidates (struct ivopts_data *data, struct iv *iv)\n /* Adds candidates based on the old induction variables.  */\n \n static void\n-add_old_ivs_candidates (struct ivopts_data *data)\n+add_iv_candidate_for_bivs (struct ivopts_data *data)\n {\n   unsigned i;\n   struct iv *iv;\n@@ -2882,19 +2880,19 @@ add_old_ivs_candidates (struct ivopts_data *data)\n     {\n       iv = ver_info (data, i)->iv;\n       if (iv && iv->biv_p && !integer_zerop (iv->step))\n-\tadd_old_iv_candidates (data, iv);\n+\tadd_iv_candidate_for_biv (data, iv);\n     }\n }\n \n-/* Adds candidates based on the value of the induction variable IV and USE.  */\n+/* Adds candidates based on the value of USE's iv.  */\n \n static void\n-add_iv_value_candidates (struct ivopts_data *data,\n-\t\t\t struct iv *iv, struct iv_use *use)\n+add_iv_candidate_for_use (struct ivopts_data *data, struct iv_use *use)\n {\n   unsigned HOST_WIDE_INT offset;\n   tree base;\n   tree basetype;\n+  struct iv *iv = use->iv;\n \n   add_candidate (data, iv->base, iv->step, false, use);\n \n@@ -2904,21 +2902,25 @@ add_iv_value_candidates (struct ivopts_data *data,\n   basetype = TREE_TYPE (iv->base);\n   if (POINTER_TYPE_P (basetype))\n     basetype = sizetype;\n-  add_candidate (data, build_int_cst (basetype, 0),\n-\t\t iv->step, true, use);\n+  add_candidate (data, build_int_cst (basetype, 0), iv->step, true, use);\n \n   /* Third, try removing the constant offset.  Make sure to even\n      add a candidate for &a[0] vs. (T *)&a.  */\n   base = strip_offset (iv->base, &offset);\n-  if (offset\n-      || base != iv->base)\n+  if (offset || base != iv->base)\n     add_candidate (data, base, iv->step, false, use);\n+\n+  /* At last, add auto-incremental candidates.  Make such variables\n+     important since other iv uses with same base object may be based\n+     on it.  */\n+  if (use != NULL && use->type == USE_ADDRESS)\n+    add_autoinc_candidates (data, iv->base, iv->step, true, use);\n }\n \n /* Adds candidates based on the uses.  */\n \n static void\n-add_derived_ivs_candidates (struct ivopts_data *data)\n+add_iv_candidate_for_uses (struct ivopts_data *data)\n {\n   unsigned i;\n \n@@ -2935,7 +2937,7 @@ add_derived_ivs_candidates (struct ivopts_data *data)\n \tcase USE_COMPARE:\n \tcase USE_ADDRESS:\n \t  /* Just add the ivs based on the value of the iv used here.  */\n-\t  add_iv_value_candidates (data, use->iv, use);\n+\t  add_iv_candidate_for_use (data, use);\n \t  break;\n \n \tdefault:\n@@ -5320,10 +5322,10 @@ find_iv_candidates (struct ivopts_data *data)\n   add_standard_iv_candidates (data);\n \n   /* Add old induction variables.  */\n-  add_old_ivs_candidates (data);\n+  add_iv_candidate_for_bivs (data);\n \n   /* Add induction variables derived from uses.  */\n-  add_derived_ivs_candidates (data);\n+  add_iv_candidate_for_uses (data);\n \n   set_autoinc_for_original_candidates (data);\n "}]}