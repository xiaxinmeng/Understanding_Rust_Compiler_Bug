{"sha": "00a25a2d39c992235f57f6d891a407144236760c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDBhMjVhMmQzOWM5OTIyMzVmNTdmNmQ4OTFhNDA3MTQ0MjM2NzYwYw==", "commit": {"author": {"name": "Janis Johnson", "email": "janis187@us.ibm.com", "date": "2008-05-21T18:03:32Z"}, "committer": {"name": "Janis Johnson", "email": "janis@gcc.gnu.org", "date": "2008-05-21T18:03:32Z"}, "message": "sourcebuild.texi (Test Directives): Add dg-xfail-run-if.\n\ngcc/\n\t* doc/sourcebuild.texi (Test Directives): Add dg-xfail-run-if.\ngcc/testsuite/\n\t* lib/target-supports-dg.exp (dg-xfail-run-if): New.\n\t* gcc.test-framework/dg-do-run-xrif-exp-F.c: New test.\n\t* gcc.test-framework/dg-do-run-xrif-exp-P.c: New test.\n\t* gcc.test-framework/dg-do-run-xrif-exp-XF.c: New test.\n\t* gcc.test-framework/dg-do-run-xrif-exp-XP.c: New test.\n\t* gcc.test-framework/dg-dot-run-xrif-exp-F.c: New test.\n\t* gcc.test-framework/dg-dot-run-xrif-exp-P.c: New test.\n\t* gcc.test-framework/dg-dot-run-xrif-exp-XF.c: New test.\n\t* gcc.test-framework/dg-dot-run-xrif-exp-XP.c: New test.\n\t* gcc.test-framework/test-framework.awk: Handle new tests.\n\nFrom-SVN: r135729", "tree": {"sha": "74ac640467fdfcb0d90754fa3d1b5fd0dd43b621", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74ac640467fdfcb0d90754fa3d1b5fd0dd43b621"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/00a25a2d39c992235f57f6d891a407144236760c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00a25a2d39c992235f57f6d891a407144236760c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00a25a2d39c992235f57f6d891a407144236760c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00a25a2d39c992235f57f6d891a407144236760c/comments", "author": null, "committer": null, "parents": [{"sha": "80980aecc61c7c892d37cc6dd28511c76e80863e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80980aecc61c7c892d37cc6dd28511c76e80863e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80980aecc61c7c892d37cc6dd28511c76e80863e"}], "stats": {"total": 131, "additions": 129, "deletions": 2}, "files": [{"sha": "125cc45453854f5cd04e8d1d915c6e12b7e47ff5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -1,3 +1,7 @@\n+2008-05-21  Janis Johnson  <janis187@us.ibm.com>\n+\n+\t* doc/sourcebuild.texi (Test Directives): Add dg-xfail-run-if.\n+\n 2008-05-21  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/i386/sse.md (vec_extractv4sf): Removed."}, {"sha": "635c716769a0e88202168f7c64c6da886c2c8c9a", "filename": "gcc/doc/sourcebuild.texi", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Fdoc%2Fsourcebuild.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Fdoc%2Fsourcebuild.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fsourcebuild.texi?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -1004,7 +1004,11 @@ an empty @var{exclude-opts} list.\n \n @item  @{ dg-xfail-if @var{comment} @{ @var{selector} @} @{ @var{include-opts} @} @{ @var{exclude-opts} @} @}\n Expect the test to fail if the conditions (which are the same as for\n-@code{dg-skip-if}) are met.\n+@code{dg-skip-if}) are met.  This does not affect the execute step.\n+\n+@item  @{ dg-xfail-run-if @var{comment} @{ @var{selector} @} @{ @var{include-opts} @} @{ @var{exclude-opts} @} @}\n+Expect the execute step of a test to fail if the conditions (which are\n+the same as for @code{dg-skip-if}) and @code{dg-xfail-if}) are met.\n \n @item @{ dg-require-@var{support} args @}\n Skip the test if the target does not provide the required support;"}, {"sha": "5600a4099a752e156dfa38b876df95f78c0233b9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -1,3 +1,16 @@\n+2008-05-21  Janis Johnson  <janis187@us.ibm.com>\n+\n+\t* lib/target-supports-dg.exp (dg-xfail-run-if): New.\n+\t* gcc.test-framework/dg-do-run-xrif-exp-F.c: New test.\n+\t* gcc.test-framework/dg-do-run-xrif-exp-P.c: New test.\n+\t* gcc.test-framework/dg-do-run-xrif-exp-XF.c: New test.\n+\t* gcc.test-framework/dg-do-run-xrif-exp-XP.c: New test.\n+\t* gcc.test-framework/dg-dot-run-xrif-exp-F.c: New test.\n+\t* gcc.test-framework/dg-dot-run-xrif-exp-P.c: New test.\n+\t* gcc.test-framework/dg-dot-run-xrif-exp-XF.c: New test.\n+\t* gcc.test-framework/dg-dot-run-xrif-exp-XP.c: New test.\n+\t* gcc.test-framework/test-framework.awk: Handle new tests.\n+\n 2008-05-21  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/36257"}, {"sha": "01459eaa08c07d9314d6c55ca2fef55b8a69b62c", "filename": "gcc/testsuite/gcc.test-framework/dg-do-run-xrif-exp-F.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-F.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-F.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-F.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run } */\n+/* { dg-xfail-run-if \"\" { empty-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    abort ();\t/* This results in a failure.  */\n+}"}, {"sha": "d3472abcc3c03a22fb7b3fda4d95c7b712fb8db9", "filename": "gcc/testsuite/gcc.test-framework/dg-do-run-xrif-exp-P.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-P.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-P.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-P.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run } */\n+/* { dg-xfail-run-if \"\" { empty-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    return 0;\t/* This results in a pass.  */\n+}"}, {"sha": "0a0a1f856c306e040ed0e024ab99da2a3fee0169", "filename": "gcc/testsuite/gcc.test-framework/dg-do-run-xrif-exp-XF.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-XF.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-XF.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-XF.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run } */\n+/* { dg-xfail-run-if \"\" { *-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    abort ();\t/* This results in an expected failure.  */\n+}"}, {"sha": "6f418689a137259e7dfb23ffa4e12a2c6a94e443", "filename": "gcc/testsuite/gcc.test-framework/dg-do-run-xrif-exp-XP.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-XP.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-XP.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-do-run-xrif-exp-XP.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run } */\n+/* { dg-xfail-run-if \"\" { *-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    return 0;\t/* This results in unexpected pass.  */\n+}"}, {"sha": "3011799c88c8977791dc618944b5004bfb84ee9c", "filename": "gcc/testsuite/gcc.test-framework/dg-dot-run-xrif-exp-F.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-F.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-F.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-F.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run { xfail *-empty-* } } */\n+/* { dg-xfail-run-if \"\" { empty-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    abort ();\t/* Neither xfail list matched, so fail.  */\n+}"}, {"sha": "5bb92207a19b11c8ee87f61475ed47531aa46e4e", "filename": "gcc/testsuite/gcc.test-framework/dg-dot-run-xrif-exp-P.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-P.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-P.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-P.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run { xfail *-empty-* } } */\n+/* { dg-xfail-run-if \"\" { empty-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    return 0;\t/* Neither xfail list matched, so pass.  */\n+}"}, {"sha": "854f1cb20dee04a46c4d2685756eae4d9f587240", "filename": "gcc/testsuite/gcc.test-framework/dg-dot-run-xrif-exp-XF.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-XF.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-XF.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-XF.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run { xfail *-*-* } } */\n+/* { dg-xfail-run-if \"\" { empty-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    abort ();\t/* A failed match doesn't override an existing XFAIL.  */\n+}"}, {"sha": "f1ac0c1de9f099e485462a049909c584554303b5", "filename": "gcc/testsuite/gcc.test-framework/dg-dot-run-xrif-exp-XP.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-XP.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-XP.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Fdg-dot-run-xrif-exp-XP.c?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do run { xfail empty-*-* } } */\n+/* { dg-xfail-run-if \"\" { *-*-* } { \"*\" } { \"\" } } */\n+\n+extern void abort (void);\n+\n+int\n+main ()\n+{\n+    return 0;\t/* First xfail list didn't match but second did, so XPASS.  */\n+}"}, {"sha": "381d3473b0516122f5f7ff9196ed1f918f6a0b37", "filename": "gcc/testsuite/gcc.test-framework/test-framework.awk", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Ftest-framework.awk", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Fgcc.test-framework%2Ftest-framework.awk", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.test-framework%2Ftest-framework.awk?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -3,7 +3,7 @@\n # of passing tests.\n #\n #\n-# Copyright (c) 2004, 2005, 2006, 2007 Free Software Foundation, Inc.\n+# Copyright (c) 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.\n #\n # This file is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -47,6 +47,8 @@ BEGIN\t\t\t{ skip = 1; passes = 0; fails = 0; }\n /dg-outexists.*\\(test for excess errors)/ { ignore(); next }\n /dg-outexists.*\\(test for warnings/ { ignore(); next }\n /dg-outexists.*\\(test for errors/ { ignore(); next }\n+# ignore compile step for dg-xfail-run-if tests.\n+/run-xrif.*\\(test for excess errors)/ { ignore(); next }\n # The other dox tests pass the compile step; ignore that message.\n /^PASS.*dox.*\\(test for excess errors\\)/ { ignore(); next }\n # The sf tests pass the compile step; ignore that message."}, {"sha": "4bff5fa44244e0beeb26fabdfddf9f30c18ec12e", "filename": "gcc/testsuite/lib/target-supports-dg.exp", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Flib%2Ftarget-supports-dg.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/00a25a2d39c992235f57f6d891a407144236760c/gcc%2Ftestsuite%2Flib%2Ftarget-supports-dg.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports-dg.exp?ref=00a25a2d39c992235f57f6d891a407144236760c", "patch": "@@ -294,6 +294,30 @@ proc dg-xfail-if { args } {\n     }\n }\n \n+# Like dg-xfail-if but for the execute step.\n+\n+proc dg-xfail-run-if { args } {\n+    # Don't bother if we're already skipping the test.\n+    upvar dg-do-what dg-do-what\n+    if { [lindex ${dg-do-what} 1] == \"N\" } {\n+      return\n+    }\n+\n+    set args [lreplace $args 0 0]\n+\n+    set selector [list target [lindex $args 1]]\n+    if { [dg-process-target $selector] == \"S\" } {\n+\t# These are defined in DejaGnu's dg-test, needed by check-flags.\n+\tupvar dg-extra-tool-flags dg-extra-tool-flags\n+\tupvar tool_flags tool_flags\n+\n+\tif [check-flags $args] {\n+\t    upvar dg-do-what dg-do-what\n+            set dg-do-what [list [lindex ${dg-do-what} 0] \"S\" \"F\"]\n+\t}\n+    }\n+}\n+\n # Record whether the program is expected to return a nonzero status.\n \n set shouldfail 0"}]}