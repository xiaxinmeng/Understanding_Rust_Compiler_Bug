{"sha": "e497b9bd88db2302ddc32317bd600c8176c579db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQ5N2I5YmQ4OGRiMjMwMmRkYzMyMzE3YmQ2MDBjODE3NmM1NzlkYg==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2011-05-19T10:45:26Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2011-05-19T10:45:26Z"}, "message": "re PR c/48985 (bogus buffer overflow warning and abort on static flexible array member)\n\n2011-05-19  Richard Guenther  <rguenther@suse.de>\n\n\tPR middle-end/48985\n\t* tree-object-size.c (addr_object_size): If the pointed-to\n\tvariable is a decl use DECL_SIZE_UNIT instead of TYPE_SIZE_UNIT.\n\n\t* gcc.dg/builtin-object-size-11.c: New testcase.\n\nFrom-SVN: r173901", "tree": {"sha": "5585ebe56b49c389bde1eddb7ee80e0ff227a9cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5585ebe56b49c389bde1eddb7ee80e0ff227a9cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e497b9bd88db2302ddc32317bd600c8176c579db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e497b9bd88db2302ddc32317bd600c8176c579db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e497b9bd88db2302ddc32317bd600c8176c579db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e497b9bd88db2302ddc32317bd600c8176c579db/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "31b3ca64f48e85c780d9d98730231ff2961c4d32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31b3ca64f48e85c780d9d98730231ff2961c4d32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31b3ca64f48e85c780d9d98730231ff2961c4d32"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "b03cc9bc4af7023df85c20333920e0edaef02101", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e497b9bd88db2302ddc32317bd600c8176c579db", "patch": "@@ -1,3 +1,9 @@\n+2011-05-19  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/48985\n+\t* tree-object-size.c (addr_object_size): If the pointed-to\n+\tvariable is a decl use DECL_SIZE_UNIT instead of TYPE_SIZE_UNIT.\n+\n 2011-05-19  Richard Guenther  <rguenther@suse.de>\n \n \t* gimple.c (gimple_types_compatible_p_1): Compare names of"}, {"sha": "242a33b0283243daa0c4e130502535d01443a6b8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e497b9bd88db2302ddc32317bd600c8176c579db", "patch": "@@ -1,3 +1,8 @@\n+2011-05-19  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR middle-end/48985\n+\t* gcc.dg/builtin-object-size-11.c: New testcase.\n+\n 2011-05-19  Tom de Vries  <tom@codesourcery.com>\n \n \tPR target/45098"}, {"sha": "427b94d4335e2b702ef69704e6cc8944bcacf09f", "filename": "gcc/testsuite/gcc.dg/builtin-object-size-11.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-object-size-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-object-size-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-object-size-11.c?ref=e497b9bd88db2302ddc32317bd600c8176c579db", "patch": "@@ -0,0 +1,20 @@\n+/* PR48985 */\n+/* { dg-do run } */\n+\n+extern void abort (void);\n+\n+struct s {\n+    int i;\n+    char c[];\n+} s = { 1, \"01234\" };\n+\n+__SIZE_TYPE__ f (void) { return __builtin_object_size (&s.c, 0); }\n+\n+int\n+main()\n+{\n+  if (f() != sizeof (\"01234\"))\n+    abort ();\n+\n+  return 0;\n+}"}, {"sha": "41118d25b2ebb5a4f0e126dd55e493826f59d9d1", "filename": "gcc/tree-object-size.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2Ftree-object-size.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e497b9bd88db2302ddc32317bd600c8176c579db/gcc%2Ftree-object-size.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-object-size.c?ref=e497b9bd88db2302ddc32317bd600c8176c579db", "patch": "@@ -204,6 +204,12 @@ addr_object_size (struct object_size_info *osi, const_tree ptr,\n       if (sz != unknown[object_size_type] && sz < offset_limit)\n \tpt_var_size = size_int (sz);\n     }\n+  else if (pt_var\n+\t   && DECL_P (pt_var)\n+\t   && host_integerp (DECL_SIZE_UNIT (pt_var), 1)\n+\t   && (unsigned HOST_WIDE_INT)\n+\t        tree_low_cst (DECL_SIZE_UNIT (pt_var), 1) < offset_limit)\n+    pt_var_size = DECL_SIZE_UNIT (pt_var);\n   else if (pt_var\n \t   && (SSA_VAR_P (pt_var) || TREE_CODE (pt_var) == STRING_CST)\n \t   && TYPE_SIZE_UNIT (TREE_TYPE (pt_var))"}]}