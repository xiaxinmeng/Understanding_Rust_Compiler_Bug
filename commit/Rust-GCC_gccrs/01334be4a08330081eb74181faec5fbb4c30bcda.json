{"sha": "01334be4a08330081eb74181faec5fbb4c30bcda", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDEzMzRiZTRhMDgzMzAwODFlYjc0MTgxZmFlYzVmYmI0YzMwYmNkYQ==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2017-01-20T01:22:27Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2017-01-20T01:22:27Z"}, "message": "rs6000: Fix the new SSP guard configuration code (PR79140)\n\nI foolishly tested this with r241087 reverted.  After that revision\ndefault_stack_protect_guard is no longer called if the compiler defaults\nto using the TLS guard, which of course is the wrong thing to do if\nthere is some other way to enable the global guard.\n\nThis fixes it.\n\n\n\tPR target/78875\n\tPR target/79140\n\t* config/rs6000/rs6000.c (TARGET_STACK_PROTECT_GUARD): Unconditionally\n\tdefine to rs6000_init_stack_protect_guard.\n\t(rs6000_init_stack_protect_guard): New function.\n\nFrom-SVN: r244677", "tree": {"sha": "f98a91b994292cfbac91ec3a5421a13088238def", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f98a91b994292cfbac91ec3a5421a13088238def"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/01334be4a08330081eb74181faec5fbb4c30bcda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01334be4a08330081eb74181faec5fbb4c30bcda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01334be4a08330081eb74181faec5fbb4c30bcda", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01334be4a08330081eb74181faec5fbb4c30bcda/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d821744c630acda55c7a5ff59e6cfd184132be74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d821744c630acda55c7a5ff59e6cfd184132be74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d821744c630acda55c7a5ff59e6cfd184132be74"}], "stats": {"total": 23, "additions": 20, "deletions": 3}, "files": [{"sha": "470608638d235b70ba6a36743fc151e622ad356e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01334be4a08330081eb74181faec5fbb4c30bcda/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01334be4a08330081eb74181faec5fbb4c30bcda/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=01334be4a08330081eb74181faec5fbb4c30bcda", "patch": "@@ -1,3 +1,11 @@\n+2017-01-19  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR target/78875\n+\tPR target/79140\n+\t* config/rs6000/rs6000.c (TARGET_STACK_PROTECT_GUARD): Unconditionally\n+\tdefine to rs6000_init_stack_protect_guard.\n+\t(rs6000_init_stack_protect_guard): New function.\n+\n 2017-01-19  Matthew Fortune  <matthew.fortune@imgtec.com>\n \t    Yunqiang Su  <yunqiang.su@imgtec.com>\n "}, {"sha": "be7e94770b5117053c030b75dc74cbef57b21422", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01334be4a08330081eb74181faec5fbb4c30bcda/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01334be4a08330081eb74181faec5fbb4c30bcda/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=01334be4a08330081eb74181faec5fbb4c30bcda", "patch": "@@ -1758,10 +1758,8 @@ static const struct attribute_spec rs6000_attribute_table[] =\n #define TARGET_VECTORIZE_BUILTIN_MD_VECTORIZED_FUNCTION \\\n   rs6000_builtin_md_vectorized_function\n \n-#ifdef TARGET_THREAD_SSP_OFFSET\n #undef TARGET_STACK_PROTECT_GUARD\n-#define TARGET_STACK_PROTECT_GUARD hook_tree_void_null\n-#endif\n+#define TARGET_STACK_PROTECT_GUARD rs6000_init_stack_protect_guard\n \n #if !TARGET_MACHO\n #undef TARGET_STACK_PROTECT_FAIL\n@@ -9479,6 +9477,17 @@ rs6000_legitimize_tls_address (rtx addr, enum tls_model model)\n   return dest;\n }\n \n+/* Only create the global variable for the stack protect guard if we are using\n+   the global flavor of that guard.  */\n+static tree\n+rs6000_init_stack_protect_guard (void)\n+{\n+  if (rs6000_stack_protector_guard == SSP_GLOBAL)\n+    return default_stack_protect_guard ();\n+\n+  return NULL_TREE;\n+}\n+\n /* Implement TARGET_CANNOT_FORCE_CONST_MEM.  */\n \n static bool"}]}