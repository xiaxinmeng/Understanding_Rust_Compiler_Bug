{"sha": "2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQwNWY4NGRjNGFkYmViMzg4MWE3ZDdiMjdiNjU1MjBhZWY4YmI1Yw==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael.morin@tele2.fr", "date": "2009-02-13T22:16:20Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2009-02-13T22:16:20Z"}, "message": "re PR fortran/38259 (Add version number to .mod file)\n\n2009-02-13  Mikael Morin  <mikael.morin@tele2.fr>\n\n        PR fortran/38259\n        * module.c (gfc_dump_module,gfc_use_module): Add module\n        version number.\n\nFrom-SVN: r144169", "tree": {"sha": "10a2000b05efd08c3d6a77fe2835ac2e46b1f1de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/10a2000b05efd08c3d6a77fe2835ac2e46b1f1de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c/comments", "author": null, "committer": null, "parents": [{"sha": "c208436c7bef0b3d4aa15073347404b9178e9280", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c208436c7bef0b3d4aa15073347404b9178e9280", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c208436c7bef0b3d4aa15073347404b9178e9280"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "2cd54474726b01da0867edd23aa07394240bcce7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c", "patch": "@@ -1,3 +1,9 @@\n+2009-02-13  Mikael Morin  <mikael.morin@tele2.fr>\n+\n+\tPR fortran/38259\n+\t* module.c (gfc_dump_module,gfc_use_module): Add module\n+\tversion number.\n+\n 2009-02-13  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/36703"}, {"sha": "bfc4ef9f0d2b7c799c5614900423daea36338b08", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=2d05f84dc4adbeb3881a7d7b27b65520aef8bb5c", "patch": "@@ -75,6 +75,10 @@ along with GCC; see the file COPYING3.  If not see\n \n #define MODULE_EXTENSION \".mod\"\n \n+/* Don't put any single quote (') in MOD_VERSION, \n+   if yout want it to be recognized.  */\n+#define MOD_VERSION \"0\"\n+\n \n /* Structure that describes a position within a module file.  */\n \n@@ -4817,8 +4821,8 @@ gfc_dump_module (const char *name, int dump_flag)\n \n   *strchr (p, '\\n') = '\\0';\n \n-  fprintf (module_fp, \"GFORTRAN module created from %s on %s\\nMD5:\", \n-\t   gfc_source_file, p);\n+  fprintf (module_fp, \"GFORTRAN module version '%s' created from %s on %s\\n\"\n+\t   \"MD5:\", MOD_VERSION, gfc_source_file, p);\n   fgetpos (module_fp, &md5_pos);\n   fputs (\"00000000000000000000000000000000 -- \"\n \t\"If you edit this, you'll get what you deserve.\\n\\n\", module_fp);\n@@ -5220,12 +5224,27 @@ gfc_use_module (void)\n       c = module_char ();\n       if (c == EOF)\n \tbad_module (\"Unexpected end of module\");\n-      if (start++ < 2)\n+      if (start++ < 3)\n \tparse_name (c);\n       if ((start == 1 && strcmp (atom_name, \"GFORTRAN\") != 0)\n \t  || (start == 2 && strcmp (atom_name, \" module\") != 0))\n \tgfc_fatal_error (\"File '%s' opened at %C is not a GFORTRAN module \"\n \t\t\t \"file\", filename);\n+      if (start == 3)\n+\t{\n+\t  if (strcmp (atom_name, \" version\") != 0\n+\t      || module_char () != ' '\n+\t      || parse_atom () != ATOM_STRING)\n+\t    gfc_fatal_error (\"Parse error when checking module version\"\n+\t\t    \t     \" for file '%s' opened at %C\", filename);\n+\n+\t  if (strcmp (atom_string, MOD_VERSION))\n+\t    {\n+\t      gfc_fatal_error (\"Wrong module version '%s' (expected '\"\n+\t\t\t       MOD_VERSION \"') for file '%s' opened\"\n+\t\t\t       \" at %C\", atom_string, filename);\n+\t    }\n+\t}\n \n       if (c == '\\n')\n \tline++;"}]}