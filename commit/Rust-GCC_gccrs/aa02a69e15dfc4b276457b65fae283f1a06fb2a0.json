{"sha": "aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "node_id": "C_kwDOANBUbNoAKGFhMDJhNjllMTVkZmM0YjI3NjQ1N2I2NWZhZTI4M2YxYTA2ZmIyYTA", "commit": {"author": {"name": "Nathaniel Shead", "email": "nathanieloshead@gmail.com", "date": "2022-12-28T14:28:25Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-02-06T14:23:47Z"}, "message": "libstdc++: Implement P1413R3 'deprecate aligned_storage and aligned_union'\n\nAdds deprecated attributes for C++23, and makes use of it for\nstd::aligned_storage, std::aligned_storage_t, std::aligned_union, and\nstd::aligned_union_t.\n\nlibstdc++-v3/ChangeLog:\n\n\t* doc/doxygen/user.cfg.in (PREDEFINED): Add new macros.\n\t* include/bits/c++config (_GLIBCXX23_DEPRECATED)\n\t(_GLIBCXX23_DEPRECATED_SUGGEST): New macros.\n\t* include/std/type_traits (aligned_storage, aligned_union)\n\t(aligned_storage_t, aligned_union_t): Deprecate for C++23.\n\t* testsuite/20_util/aligned_storage/deprecated-2b.cc: New test.\n\t* testsuite/20_util/aligned_union/deprecated-2b.cc: New test.\n\nSigned-off-by: Nathaniel Shead <nathanieloshead@gmail.com>\nReviewed-by: Jonathan Wakely <jwakely@redhat.com>", "tree": {"sha": "b724d1ea22143916ca7f830bde1f3e3ed0ee17ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b724d1ea22143916ca7f830bde1f3e3ed0ee17ab"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4f49ae607cb1ed312fd63967ede418601343ef24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f49ae607cb1ed312fd63967ede418601343ef24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f49ae607cb1ed312fd63967ede418601343ef24"}], "stats": {"total": 81, "additions": 77, "deletions": 4}, "files": [{"sha": "31613f51517e8630e48130c3dee0497044975a80", "filename": "libstdc++-v3/doc/doxygen/user.cfg.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fdoc%2Fdoxygen%2Fuser.cfg.in?ref=aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "patch": "@@ -2396,6 +2396,8 @@ PREDEFINED             = __cplusplus=202002L \\\n                          \"_GLIBCXX17_DEPRECATED_SUGGEST(E)= \" \\\n                          \"_GLIBCXX20_DEPRECATED= \" \\\n                          \"_GLIBCXX20_DEPRECATED_SUGGEST(E)= \" \\\n+                         \"_GLIBCXX23_DEPRECATED= \" \\\n+                         \"_GLIBCXX23_DEPRECATED_SUGGEST(E)= \" \\\n                          _GLIBCXX17_INLINE=inline \\\n                          _GLIBCXX_CHRONO_INT64_T=int64_t \\\n                          _GLIBCXX_DEFAULT_ABI_TAG \\"}, {"sha": "71f2401402fab7c95cfdcffb442de666abfd4a63", "filename": "libstdc++-v3/include/bits/c++config", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fc%2B%2Bconfig", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fc%2B%2Bconfig", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fc%2B%2Bconfig?ref=aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "patch": "@@ -86,6 +86,8 @@\n //   _GLIBCXX17_DEPRECATED_SUGGEST( string-literal )\n //   _GLIBCXX20_DEPRECATED\n //   _GLIBCXX20_DEPRECATED_SUGGEST( string-literal )\n+//   _GLIBCXX23_DEPRECATED\n+//   _GLIBCXX23_DEPRECATED_SUGGEST( string-literal )\n #ifndef _GLIBCXX_USE_DEPRECATED\n # define _GLIBCXX_USE_DEPRECATED 1\n #endif\n@@ -131,6 +133,14 @@\n # define _GLIBCXX20_DEPRECATED_SUGGEST(ALT)\n #endif\n \n+#if defined(__DEPRECATED) && (__cplusplus >= 202100L)\n+# define _GLIBCXX23_DEPRECATED [[__deprecated__]]\n+# define _GLIBCXX23_DEPRECATED_SUGGEST(ALT) _GLIBCXX_DEPRECATED_SUGGEST(ALT)\n+#else\n+# define _GLIBCXX23_DEPRECATED\n+# define _GLIBCXX23_DEPRECATED_SUGGEST(ALT)\n+#endif\n+\n // Macros for ABI tag attributes.\n #ifndef _GLIBCXX_ABI_TAG_CXX11\n # define _GLIBCXX_ABI_TAG_CXX11 __attribute ((__abi_tag__ (\"cxx11\")))"}, {"sha": "d13af433a17f25b98d3ec100e18c2e7f70a173fc", "filename": "libstdc++-v3/include/std/type_traits", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ftype_traits", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ftype_traits", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Ftype_traits?ref=aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "patch": "@@ -2088,10 +2088,15 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n    *  type shall be a POD type suitable for use as uninitialized\n    *  storage for any object whose size is at most _Len and whose\n    *  alignment is a divisor of _Align.\n+   *\n+   *  @deprecated Deprecated in C++23. Uses can be replaced by an\n+   *  array std::byte[_Len] declared with alignas(_Align).\n   */\n   template<std::size_t _Len, std::size_t _Align =\n \t   __alignof__(typename __aligned_storage_msa<_Len>::__type)>\n-    struct aligned_storage\n+    struct\n+    _GLIBCXX23_DEPRECATED\n+    aligned_storage\n     {\n       union type\n       {\n@@ -2127,9 +2132,13 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n    *  least size _Len.\n    *\n    *  @see aligned_storage\n+   *\n+   *  @deprecated Deprecated in C++23.\n    */\n   template <size_t _Len, typename... _Types>\n-    struct aligned_union\n+    struct\n+    _GLIBCXX23_DEPRECATED\n+    aligned_union\n     {\n     private:\n       static_assert(sizeof...(_Types) != 0, \"At least one type is required\");\n@@ -2580,10 +2589,10 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n   /// Alias template for aligned_storage\n   template<size_t _Len, size_t _Align =\n \t    __alignof__(typename __aligned_storage_msa<_Len>::__type)>\n-    using aligned_storage_t = typename aligned_storage<_Len, _Align>::type;\n+    using aligned_storage_t _GLIBCXX23_DEPRECATED = typename aligned_storage<_Len, _Align>::type;\n \n   template <size_t _Len, typename... _Types>\n-    using aligned_union_t = typename aligned_union<_Len, _Types...>::type;\n+    using aligned_union_t _GLIBCXX23_DEPRECATED = typename aligned_union<_Len, _Types...>::type;\n \n   /// Alias template for decay\n   template<typename _Tp>"}, {"sha": "a0e338a58431f6a7863dccd97b41babbc3d8a46f", "filename": "libstdc++-v3/testsuite/20_util/aligned_storage/deprecated-2b.cc", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Fdeprecated-2b.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Fdeprecated-2b.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_storage%2Fdeprecated-2b.cc?ref=aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "patch": "@@ -0,0 +1,26 @@\n+// Copyright (C) 2022 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++23\" }\n+// { dg-do compile { target c++23 } }\n+\n+#include <type_traits>\n+\n+std::aligned_storage<1, 1>::type x; // { dg-warning \"is deprecated\" }\n+std::aligned_storage_t<1, 1> y; // { dg-warning \"is deprecated\" }\n+\n+// { dg-prune-output \"declared here\" }"}, {"sha": "fa00a9238565c471569e009af538ac6a0be5b67a", "filename": "libstdc++-v3/testsuite/20_util/aligned_union/deprecated-2b.cc", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2Fdeprecated-2b.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aa02a69e15dfc4b276457b65fae283f1a06fb2a0/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2Fdeprecated-2b.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Faligned_union%2Fdeprecated-2b.cc?ref=aa02a69e15dfc4b276457b65fae283f1a06fb2a0", "patch": "@@ -0,0 +1,26 @@\n+// Copyright (C) 2022 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++23\" }\n+// { dg-do compile { target c++23 } }\n+\n+#include <type_traits>\n+\n+std::aligned_union<4, int>::type x; // { dg-warning \"is deprecated\" }\n+std::aligned_union_t<4, int> y; // { dg-warning \"is deprecated\" }\n+\n+// { dg-prune-output \"declared here\" }"}]}