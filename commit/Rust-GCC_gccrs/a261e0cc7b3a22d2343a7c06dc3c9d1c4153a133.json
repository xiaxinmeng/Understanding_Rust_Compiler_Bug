{"sha": "a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTI2MWUwY2M3YjNhMjJkMjM0M2E3YzA2ZGMzYzlkMWM0MTUzYTEzMw==", "commit": {"author": {"name": "David S. Miller", "email": "davem@gcc.gnu.org", "date": "2002-04-03T20:13:50Z"}, "committer": {"name": "David S. Miller", "email": "davem@gcc.gnu.org", "date": "2002-04-03T20:13:50Z"}, "message": "crtfastmath.c: New file.\n\n2002-04-03  David S. Miller  <davem@redhat.com>\n\n\t* config/sparc/crtfastmath.c: New file.\n\t* config/sparc/t-crtfm: New file.\n\t* config/sparc/linux.h (ENDFILE_SPEC): Use crtfastmath.o\n\t* config/sparc/linux64.h (ENDFILE_SPEC): Likewise.\n\t* config/sparc/sol2.h (ENDFILE_SPEC): Likewise.\n\t* config/sparc/sp64-elf.h (ENDFILE_SPEC): Likewise.\n\t* config/sparc/elf.h (ENDFILE_SPEC): Likewise.\n\t* config.gcc (sparc*-*-{elf*,linux*,solaris2*}): Add\n\tsparc/t-crtfm to tmake_file.\n\n\t* config/sparc/sparc-protos.h (sparc_emitting_epilogue): Add.\n\nFrom-SVN: r51808", "tree": {"sha": "2f5a43a3fb6ddeffa532f4dfb75179057a205bac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f5a43a3fb6ddeffa532f4dfb75179057a205bac"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/comments", "author": null, "committer": null, "parents": [{"sha": "68c17f30462516324d741c9d00ea729813fae657", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/68c17f30462516324d741c9d00ea729813fae657", "html_url": "https://github.com/Rust-GCC/gccrs/commit/68c17f30462516324d741c9d00ea729813fae657"}], "stats": {"total": 96, "additions": 83, "deletions": 13}, "files": [{"sha": "818dfbe8c6ac82399a654f4a29b75a8ddf02b8ef", "filename": "gcc/config.gcc", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -3018,7 +3018,7 @@ sparc-*-chorusos*)\n \t;;\n sparc-*-elf*)\n \ttm_file=\"${tm_file} dbxelf.h elfos.h svr4.h sparc/sysv4.h sparc/sol2.h sparc/elf.h\"\n-\ttmake_file=sparc/t-elf\n+\ttmake_file=\"sparc/t-elf sparc/t-crtfm\"\n \textra_parts=\"crti.o crtn.o crtbegin.o crtend.o\"\n \t#float_format=i128\n \tfloat_format=i64\n@@ -3029,14 +3029,14 @@ sparc-*-linux*aout*)\t\t# Sparc's running GNU/Linux, a.out\n \t;;\n sparc-*-linux*libc1*)\t# Sparc's running GNU/Linux, libc5\n \ttm_file=\"${tm_file} dbxelf.h elfos.h svr4.h sparc/sysv4.h sparc/linux.h\"\n-\ttmake_file=\"t-slibgcc-elf-ver t-linux t-linux-gnulibc1\"\n+\ttmake_file=\"t-slibgcc-elf-ver t-linux t-linux-gnulibc1 sparc/t-crtfm\"\n \textra_parts=\"crtbegin.o crtbeginS.o crtend.o crtendS.o\"\n \tgnu_ld=yes\n \tfloat_format=sparc\n \t;;\n sparc-*-linux*)\t\t# Sparc's running GNU/Linux, libc6\n \ttm_file=\"${tm_file} dbxelf.h elfos.h svr4.h sparc/sysv4.h sparc/linux.h\"\n-\ttmake_file=\"t-slibgcc-elf-ver t-linux\"\n+\ttmake_file=\"t-slibgcc-elf-ver t-linux sparc/t-crtfm\"\n \textra_parts=\"crtbegin.o crtbeginS.o crtbeginT.o crtend.o crtendS.o\"\n \tgnu_ld=yes\n \tif test x$enable_threads = xyes; then\n@@ -3080,7 +3080,7 @@ sparcv9-*-solaris2* | sparc64-*-solaris2*)\n \t\ttm_file=sparc/sol2-sld-64.h\n \tfi\n \txm_defines=POSIX\n-\ttmake_file=\"sparc/t-sol2 sparc/t-sol2-64\"\n+\ttmake_file=\"sparc/t-sol2 sparc/t-sol2-64 sparc/t-crtfm\"\n \tif test x$gnu_ld = xyes; then\n \t\ttmake_file=\"$tmake_file t-slibgcc-elf-ver\"\n \telse\n@@ -3105,7 +3105,7 @@ sparcv9-*-solaris2* | sparc64-*-solaris2*)\n sparc-hal-solaris2*)\n         xm_defines=POSIX\n         tm_file=\"${tm_file} dbxelf.h elfos.h svr4.h sparc/sysv4.h sparc/sol2.h sparc/hal.h\"\n-        tmake_file=\"sparc/t-halos sparc/t-sol2\"\n+        tmake_file=\"sparc/t-halos sparc/t-sol2 sparc/t-crtfm\"\n \tif test x$gnu_ld = xyes; then\n \t\ttmake_file=\"$tmake_file t-slibgcc-elf-ver\"\n \telse\n@@ -3130,7 +3130,7 @@ sparc-*-solaris2*)\n \t\ttm_file=\"${tm_file} dbxelf.h elfos.h svr4.h sparc/sysv4.h sparc/sol2.h sparc/sol2-sld.h\"\n \tfi\n \txm_defines=POSIX\n-\ttmake_file=sparc/t-sol2\n+\ttmake_file=\"sparc/t-sol2 sparc/t-crtfm\"\n \tif test x$gnu_ld = xyes; then\n \t\ttmake_file=\"$tmake_file t-slibgcc-elf-ver\"\n \telse"}, {"sha": "a0824a19733a1de5dd8fe530cfc426c003a5d954", "filename": "gcc/config/sparc/crtfastmath.c", "status": "added", "additions": 54, "deletions": 0, "changes": 54, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Fcrtfastmath.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Fcrtfastmath.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fcrtfastmath.c?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright (C) 2001 Free Software Foundation, Inc.\n+ * Contributed by David S. Miller (davem@redhat.com)\n+ *\n+ * This file is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU General Public License as published by the\n+ * Free Software Foundation; either version 2, or (at your option) any\n+ * later version.\n+ * \n+ * In addition to the permissions in the GNU General Public License, the\n+ * Free Software Foundation gives you unlimited permission to link the\n+ * compiled version of this file with other programs, and to distribute\n+ * those programs without any restriction coming from the use of this\n+ * file.  (The General Public License restrictions do apply in other\n+ * respects; for example, they cover modification of the file, and\n+ * distribution when not linked into another program.)\n+ * \n+ * This file is distributed in the hope that it will be useful, but\n+ * WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * General Public License for more details.\n+ * \n+ * You should have received a copy of the GNU General Public License\n+ * along with this program; see the file COPYING.  If not, write to\n+ * the Free Software Foundation, 59 Temple Place - Suite 330,\n+ * Boston, MA 02111-1307, USA.\n+ * \n+ *    As a special exception, if you link this library with files\n+ *    compiled with GCC to produce an executable, this does not cause\n+ *    the resulting executable to be covered by the GNU General Public License.\n+ *    This exception does not however invalidate any other reasons why\n+ *    the executable file might be covered by the GNU General Public License.\n+ */\n+\n+#define FPRS_NS\t\t(1 << 22)\t/* Non-Standard fpu results */\n+\n+static void __attribute__((constructor))\n+set_fast_math (void)\n+{\n+  unsigned long fsr;\n+\n+  /* This works for the 64-bit case because, even if 32-bit ld/st of\n+     the fsr register modified the upper 32-bit, the only thing up there\n+     are the 3 other condition codes which are \"do not care\" at the time\n+     that this runs.  */\n+\n+  __asm__(\"st %%fsr, %0\"\n+\t  : \"=m\" (fsr));\n+\n+  fsr |= FPRS_NS;\n+\n+  __asm__(\"ld %0, %%fsr\"\n+\t  : : \"m\" (fsr));\n+}"}, {"sha": "d2d3a0b74d368ec9b67c8833bc3242881b61a43b", "filename": "gcc/config/sparc/elf.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Felf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Felf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Felf.h?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -26,7 +26,9 @@ Boston, MA 02111-1307, USA.  */\n #define STARTFILE_SPEC \"crt0.o%s crti.o%s crtbegin.o%s\"\n \n #undef  ENDFILE_SPEC\n-#define ENDFILE_SPEC \"crtend.o%s crtn.o%s\"\n+#define ENDFILE_SPEC \\\n+  \"%{ffast-math|funsafe-math-optimizations:crtfastmath.o%s} \\\n+   crtend.o%s crtn.o%s\"\n \n /* Use the default.  */\n #undef LINK_SPEC"}, {"sha": "1fb604e2a039bc60f9edafea0bb4b76200bf6138", "filename": "gcc/config/sparc/linux.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Flinux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Flinux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Flinux.h?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -64,7 +64,8 @@ Boston, MA 02111-1307, USA.  */\n \n #undef  ENDFILE_SPEC\n #define ENDFILE_SPEC \\\n-  \"%{!shared:crtend.o%s} %{shared:crtendS.o%s} crtn.o%s\"\n+  \"%{ffast-math|funsafe-math-optimizations:crtfastmath.o%s} \\\n+   %{!shared:crtend.o%s} %{shared:crtendS.o%s} crtn.o%s\"\n \n /* This is for -profile to use -lc_p instead of -lc.  */\n #undef\tCC1_SPEC"}, {"sha": "aa83342fc44dd7ea5c58ca1ad8807493f6ddf4ab", "filename": "gcc/config/sparc/linux64.h", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Flinux64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Flinux64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Flinux64.h?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -104,23 +104,28 @@ Boston, MA 02111-1307, USA.  */\n #define ENDFILE_SPEC64 \\\n   \"%{!shared:crtend.o%s} %{shared:crtendS.o%s} /usr/lib64/crtn.o%s\"\n   \n+#define ENDFILE_SPEC_COMMON \\\n+  \"%{ffast-math|funsafe-math-optimizations:crtfastmath.o%s}\"\n+\n #ifdef SPARC_BI_ARCH\n \n #if DEFAULT_ARCH32_P\n #define ENDFILE_SPEC \"\\\n %{m32:\" ENDFILE_SPEC32 \"} \\\n %{m64:\" ENDFILE_SPEC64 \"} \\\n-%{!m32:%{!m64:\" ENDFILE_SPEC32 \"}}\"\n+%{!m32:%{!m64:\" ENDFILE_SPEC32 \"}} \" \\\n+ENDFILE_SPEC_COMMON\n #else\n #define ENDFILE_SPEC \"\\\n %{m32:\" ENDFILE_SPEC32 \"} \\\n %{m64:\" ENDFILE_SPEC64 \"} \\\n-%{!m32:%{!m64:\" ENDFILE_SPEC64 \"}}\"\n+%{!m32:%{!m64:\" ENDFILE_SPEC64 \"}} \" \\\n+ENDFILE_SPEC_COMMON\n #endif\n \n #else\n \n-#define ENDFILE_SPEC ENDFILE_SPEC64\n+#define ENDFILE_SPEC ENDFILE_SPEC64 \" \" ENDFILE_SPEC_COMMON\n \n #endif\n "}, {"sha": "305129b6b6e44a430d43bc619e76e60ff68ac8e4", "filename": "gcc/config/sparc/sol2.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsol2.h?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -160,7 +160,9 @@ Boston, MA 02111-1307, USA.  */\n        %{p|pg:-ldl} -lc}}\"\n \n #undef  ENDFILE_SPEC\n-#define ENDFILE_SPEC \"crtend.o%s crtn.o%s\"\n+#define ENDFILE_SPEC \\\n+  \"%{ffast-math|funsafe-math-optimizations:crtfastmath.o%s} \\\n+   crtend.o%s crtn.o%s\"\n \n /* This should be the same as in svr4.h, except with -R added.  */\n #undef LINK_SPEC"}, {"sha": "caf944b33ff7d191b8ac162e9386b3ab81ca8214", "filename": "gcc/config/sparc/sp64-elf.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Fsp64-elf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Fsp64-elf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsp64-elf.h?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -71,7 +71,9 @@ crtbegin.o%s \\\n \"\n \n #undef ENDFILE_SPEC\n-#define ENDFILE_SPEC \"crtend.o%s\"\n+#define ENDFILE_SPEC \\\n+  \"%{ffast-math|funsafe-math-optimizations:crtfastmath.o%s} \\\n+   crtend.o%s\"\n \n /* Use the default (for now).  */\n #undef LIB_SPEC"}, {"sha": "744537db3bd3a0119c6939d0cbc203b340ffffe6", "filename": "gcc/config/sparc/t-crtfm", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Ft-crtfm", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133/gcc%2Fconfig%2Fsparc%2Ft-crtfm", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Ft-crtfm?ref=a261e0cc7b3a22d2343a7c06dc3c9d1c4153a133", "patch": "@@ -0,0 +1,4 @@\n+EXTRA_PARTS += crtfastmath.o\n+\n+crtfastmath.o: $(srcdir)/config/sparc/crtfastmath.c $(GCC_PASSES)\n+\t$(GCC_FOR_TARGET) $(LIBGCC2_CFLAGS) -c -o crtfastmath.o $(srcdir)/config/sparc/crtfastmath.c"}]}