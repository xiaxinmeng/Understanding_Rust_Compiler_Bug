{"sha": "bfa9f660d25aef1513b1289d01c80b52090ef72a", "node_id": "C_kwDOANBUbNoAKGJmYTlmNjYwZDI1YWVmMTUxM2IxMjg5ZDAxYzgwYjUyMDkwZWY3MmE", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-04-01T11:08:54Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-04-01T11:23:16Z"}, "message": "[libgomp, testsuite, nvptx] Limit recursion in declare_target-{1,2}.f90\n\nWhen running testcases libgomp.fortran/examples-4/declare_target-{1,2}.f90 on\nan RTX A2000 (sm_86) with driver 510.60.02 and with GOMP_NVPTX_JIT=-O0 I run\ninto:\n...\nFAIL: libgomp.fortran/examples-4/declare_target-1.f90 -O0 \\\n  -DGOMP_NVPTX_JIT=-O0 execution test\nFAIL: libgomp.fortran/examples-4/declare_target-2.f90 -O0 \\\n  -DGOMP_NVPTX_JIT=-O0 execution test\n...\n\nFix this by further limiting recursion depth in the test-cases for nvptx.\n\nFurthermore, make the recursion depth limiting nvptx-specific.\n\nTested on x86_64 with nvptx accelerator.\n\nlibgomp/ChangeLog:\n\n2022-04-01  Tom de Vries  <tdevries@suse.de>\n\n\t* testsuite/libgomp.fortran/examples-4/declare_target-1.f90: Define\n\tand use REC_DEPTH.\n\t* testsuite/libgomp.fortran/examples-4/declare_target-2.f90: Same.", "tree": {"sha": "785e0aeab00621ce448703c48394f3b27f9bb16c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/785e0aeab00621ce448703c48394f3b27f9bb16c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bfa9f660d25aef1513b1289d01c80b52090ef72a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfa9f660d25aef1513b1289d01c80b52090ef72a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bfa9f660d25aef1513b1289d01c80b52090ef72a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfa9f660d25aef1513b1289d01c80b52090ef72a/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "065e25f6331c130bc3cd2ce78036f2328adb3d71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/065e25f6331c130bc3cd2ce78036f2328adb3d71", "html_url": "https://github.com/Rust-GCC/gccrs/commit/065e25f6331c130bc3cd2ce78036f2328adb3d71"}], "stats": {"total": 38, "additions": 27, "deletions": 11}, "files": [{"sha": "03c5c53ed67326ae001966731da58919f031fd65", "filename": "libgomp/testsuite/libgomp.fortran/examples-4/declare_target-1.f90", "status": "modified", "additions": 13, "deletions": 5, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa9f660d25aef1513b1289d01c80b52090ef72a/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fexamples-4%2Fdeclare_target-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa9f660d25aef1513b1289d01c80b52090ef72a/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fexamples-4%2Fdeclare_target-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fexamples-4%2Fdeclare_target-1.f90?ref=bfa9f660d25aef1513b1289d01c80b52090ef72a", "patch": "@@ -1,4 +1,16 @@\n ! { dg-do run }\n+! { dg-additional-options \"-cpp\" }\n+! Reduced from 25 to 23, otherwise execution runs out of thread stack on\n+! Nvidia Titan V.\n+! Reduced from 23 to 22, otherwise execution runs out of thread stack on\n+! Nvidia T400 (2GB variant), when run with GOMP_NVPTX_JIT=-O0.\n+! Reduced from 22 to 20, otherwise execution runs out of thread stack on\n+! Nvidia RTX A2000 (6GB variant), when run with GOMP_NVPTX_JIT=-O0.\n+! { dg-additional-options \"-DREC_DEPTH=20\" { target { offload_target_nvptx } } } */\n+\n+#ifndef REC_DEPTH\n+#define REC_DEPTH 25\n+#endif\n \n module e_53_1_mod\n   integer :: THRESHOLD = 20\n@@ -27,9 +39,5 @@ integer function fib_wrapper (n)\n program e_53_1\n   use e_53_1_mod, only : fib, fib_wrapper\n   if (fib (15) /= fib_wrapper (15)) stop 1\n-  ! Reduced from 25 to 23, otherwise execution runs out of thread stack on\n-  ! Nvidia Titan V.\n-  ! Reduced from 23 to 22, otherwise execution runs out of thread stack on\n-  ! Nvidia T400 (2GB variant), when run with GOMP_NVPTX_JIT=-O0.\n-  if (fib (22) /= fib_wrapper (22)) stop 2\n+  if (fib (REC_DEPTH) /= fib_wrapper (REC_DEPTH)) stop 2\n end program"}, {"sha": "0e8bea578a8f9daddedd67e87e15eba355cc5853", "filename": "libgomp/testsuite/libgomp.fortran/examples-4/declare_target-2.f90", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfa9f660d25aef1513b1289d01c80b52090ef72a/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fexamples-4%2Fdeclare_target-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfa9f660d25aef1513b1289d01c80b52090ef72a/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fexamples-4%2Fdeclare_target-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fexamples-4%2Fdeclare_target-2.f90?ref=bfa9f660d25aef1513b1289d01c80b52090ef72a", "patch": "@@ -1,16 +1,24 @@\n ! { dg-do run }\n+! { dg-additional-options \"-cpp\" }\n+! Reduced from 25 to 23, otherwise execution runs out of thread stack on\n+! Nvidia Titan V.\n+! Reduced from 23 to 22, otherwise execution runs out of thread stack on\n+! Nvidia T400 (2GB variant), when run with GOMP_NVPTX_JIT=-O0.\n+! Reduced from 22 to 18, otherwise execution runs out of thread stack on\n+! Nvidia RTX A2000 (6GB variant), when run with GOMP_NVPTX_JIT=-O0.\n+! { dg-additional-options \"-DREC_DEPTH=18\" { target { offload_target_nvptx } } } */\n+\n+#ifndef REC_DEPTH\n+#define REC_DEPTH 25\n+#endif\n \n program e_53_2\n   !$omp declare target (fib)\n   integer :: x, fib\n   !$omp target map(from: x)\n-    ! Reduced from 25 to 23, otherwise execution runs out of thread stack on\n-    ! Nvidia Titan V.\n-    ! Reduced from 23 to 22, otherwise execution runs out of thread stack on\n-    ! Nvidia T400 (2GB variant), when run with GOMP_NVPTX_JIT=-O0.\n-    x = fib (22)\n+    x = fib (REC_DEPTH)\n   !$omp end target\n-  if (x /= fib (22)) stop 1\n+  if (x /= fib (REC_DEPTH)) stop 1\n end program\n \n integer recursive function fib (n) result (f)"}]}