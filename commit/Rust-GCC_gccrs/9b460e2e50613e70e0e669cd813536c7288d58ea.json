{"sha": "9b460e2e50613e70e0e669cd813536c7288d58ea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWI0NjBlMmU1MDYxM2U3MGUwZTY2OWNkODEzNTM2YzcyODhkNThlYQ==", "commit": {"author": {"name": "Fritz Reese", "email": "fritzoreese@gmail.com", "date": "2017-10-16T17:40:53Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2017-10-16T17:40:53Z"}, "message": "re PR fortran/82511 (ICE Bad IO basetype (12) on attempted read or write of entire DEC structure)\n\n2017-10-16  Fritz Reese <fritzoreese@gmail.com>\n\n    PR fortran/82511\n    Treat UNION components as DT comp. in I/O lists.\n\n    gcc/fortran/ChangeLog:\n\n\tPR fortran/82511\n\t* trans-io.c (transfer_expr): Treat BT_UNION as BT_DERIVED.\n\n    gcc/testsuite/ChangeLog:\n\n\tPR fortran/82511\n\t* gfortran.dg/dec_structure_22.f90: New testcase.\n\nFrom-SVN: r253791", "tree": {"sha": "6be4ba6e37339e88677543fcbfc46fd43ff7ae39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6be4ba6e37339e88677543fcbfc46fd43ff7ae39"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9b460e2e50613e70e0e669cd813536c7288d58ea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b460e2e50613e70e0e669cd813536c7288d58ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9b460e2e50613e70e0e669cd813536c7288d58ea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9b460e2e50613e70e0e669cd813536c7288d58ea/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "01118373fe07a1329bb33d00c286f59c6e7f15b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01118373fe07a1329bb33d00c286f59c6e7f15b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01118373fe07a1329bb33d00c286f59c6e7f15b1"}], "stats": {"total": 52, "additions": 50, "deletions": 2}, "files": [{"sha": "02763fe580baf9aff8d7f0677931dca79fc12d4f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9b460e2e50613e70e0e669cd813536c7288d58ea", "patch": "@@ -1,3 +1,8 @@\n+2017-10-16  Fritz Reese <fritzoreese@gmail.com>\n+\n+\tPR fortran/82511\n+\t* trans-io.c (transfer_expr): Treat BT_UNION as BT_DERIVED.\n+\n 2017-10-15  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/82372"}, {"sha": "f3e1f3e4d09b9f0e9e2439b0d851b749af0b59d9", "filename": "gcc/fortran/trans-io.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ffortran%2Ftrans-io.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ffortran%2Ftrans-io.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-io.c?ref=9b460e2e50613e70e0e669cd813536c7288d58ea", "patch": "@@ -2404,7 +2404,7 @@ transfer_expr (gfc_se * se, gfc_typespec * ts, tree addr_expr,\n     case BT_CLASS:\n       if (ts->u.derived->components == NULL)\n \treturn;\n-      if (ts->type == BT_DERIVED || ts->type == BT_CLASS)\n+      if (gfc_bt_struct (ts->type) || ts->type == BT_CLASS)\n \t{\n \t  gfc_symbol *derived;\n \t  gfc_symbol *dtio_sub = NULL;\n@@ -2438,7 +2438,7 @@ transfer_expr (gfc_se * se, gfc_typespec * ts, tree addr_expr,\n \t      function = iocall[IOCALL_X_DERIVED];\n \t      break;\n \t    }\n-\t  else if (ts->type == BT_DERIVED)\n+\t  else if (gfc_bt_struct (ts->type))\n \t    {\n \t      /* Recurse into the elements of the derived type.  */\n \t      expr = gfc_evaluate_now (addr_expr, &se->pre);"}, {"sha": "fb2021a8efd31ec98da4f0a7a266bca5e77b9163", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9b460e2e50613e70e0e669cd813536c7288d58ea", "patch": "@@ -1,3 +1,8 @@\n+2017-10-16  Fritz Reese <fritzoreese@gmail.com>\n+\n+\tPR fortran/82511\n+\t* gfortran.dg/dec_structure_22.f90: New testcase.\n+\n 2017-10-16  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/64931"}, {"sha": "ddbee02602aeba23b7aa16851680267f4a5b564e", "filename": "gcc/testsuite/gfortran.dg/dec_structure_22.f90", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_structure_22.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9b460e2e50613e70e0e669cd813536c7288d58ea/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_structure_22.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_structure_22.f90?ref=9b460e2e50613e70e0e669cd813536c7288d58ea", "patch": "@@ -0,0 +1,38 @@\n+      ! { dg-do run }\n+      ! { dg-options \"-fdec-structure\" }\n+      !\n+      ! PR fortran/82511\n+      !\n+      ! Verify that structure variables with UNION components\n+      ! are accepted in an I/O-list READ.\n+      !\n+      implicit none\n+\n+      structure /s/\n+        union\n+          map\n+            character(16) :: c16_1\n+          end map\n+          map\n+            character(16) :: c16_2\n+          end map\n+        end union\n+      end structure\n+\n+      record /s/ r\n+      character(32) :: instr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^\"\n+\n+      r.c16_1 = '                '\n+      r.c16_2 = '                '\n+      ! The record r shall be treated as if its components are listed:\n+      ! read(...) r.c16_1, r.c16_2\n+      ! This shall correspond to the formatted read of A16,A16\n+      read(instr, '(A16,A16)') r\n+\n+      ! r.c16_1 and r.c16_2 are in a union, thus share the same memory\n+      ! and the first 16 bytes of instr are overwritten\n+      if ( r.c16_1 .ne. instr(17:32) .or. r.c16_2 .ne. instr(17:32) ) then\n+        call abort()\n+      endif\n+\n+      end"}]}