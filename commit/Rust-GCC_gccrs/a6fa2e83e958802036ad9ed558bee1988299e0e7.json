{"sha": "a6fa2e83e958802036ad9ed558bee1988299e0e7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTZmYTJlODNlOTU4ODAyMDM2YWQ5ZWQ1NThiZWUxOTg4Mjk5ZTBlNw==", "commit": {"author": {"name": "Maciej W. Rozycki", "email": "macro@wdc.com", "date": "2019-09-13T17:43:12Z"}, "committer": {"name": "Maciej W. Rozycki", "email": "macro@gcc.gnu.org", "date": "2019-09-13T17:43:12Z"}, "message": "gnatmake: Accept the `--sysroot=' GCC driver option\n\nAccording to `gnatmake' documentation:\n\n\"Any uppercase or multi-character switch that is not a 'gnatmake' switch\nis passed to 'gcc' (e.g., '-O', '-gnato,' etc.)\"\n\nhowever the `--sysroot=' switch is actually rejected:\n\ngnatmake: invalid switch: --sysroot=...\n\nlikely because it is one of the very few GCC driver options that have a \nleading double dash and therefore we don't have a blanket fall-through \nfor such switches that would satisfy what our documentation claims.\n\nThe option is actually shared between the compiler and the linker, so \npass the switch to both build stages if requested, removing GNAT \ntestsuite issues like:\n\ngnatmake: invalid switch: --sysroot=.../sysroot\ncompiler exited with status 1\nExecuting on host: .../gcc/gnatclean -c -q -n ./abstract_with_anonymous_result   (timeout = 300)\nspawn -ignore SIGHUP .../gcc/gnatclean -c -q -n ./abstract_with_anonymous_result\nPASS: gnat.dg/abstract_with_anonymous_result.adb (test for excess errors)\nUNRESOLVED: gnat.dg/abstract_with_anonymous_result.adb compilation failed to produce executable\n\nin a test environment where `--with-build-sysroot=.../sysroot' has been \nused to build a cross-compiler.  Passing to the compilation stage only \nwould lead to errors like:\n\n.../bin/riscv64-linux-gnu-ld: cannot find crt1.o: No such file or directory\n.../bin/riscv64-linux-gnu-ld: cannot find -lc\ncollect2: error: ld returned 1 exit status\ngnatlink: error when calling .../gcc/xgcc\ngnatmake: *** link failed.\ncompiler exited with status 1\nExecuting on host: .../gcc/gnatclean -c -q -n ./abstract_with_anonymous_result   (timeout = 300)\nspawn -ignore SIGHUP .../gcc/gnatclean -c -q -n ./abstract_with_anonymous_result\n./abstract_with_anonymous_result.ali\n./abstract_with_anonymous_result.o\nFAIL: gnat.dg/abstract_with_anonymous_result.adb (test for excess errors)\nExcess errors:\n.../bin/riscv64-linux-gnu-ld: cannot find crt1.o: No such file or directory\n.../bin/riscv64-linux-gnu-ld: cannot find -lc\ngnatlink: error when calling .../gcc/xgcc\n\nUNRESOLVED: gnat.dg/abstract_with_anonymous_result.adb compilation failed to produce executable\n\ninstead.\n\n\tgcc/ada/\n\t* make.adb (Scan_Make_Arg): Also accept `--sysroot=' for the \n\tcompiler and the linker.\n\nFrom-SVN: r275702", "tree": {"sha": "9ea5ce4d5c14c670d607238f072ef85bb633cc5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ea5ce4d5c14c670d607238f072ef85bb633cc5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6fa2e83e958802036ad9ed558bee1988299e0e7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6fa2e83e958802036ad9ed558bee1988299e0e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6fa2e83e958802036ad9ed558bee1988299e0e7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6fa2e83e958802036ad9ed558bee1988299e0e7/comments", "author": null, "committer": null, "parents": [{"sha": "237413747601e3f11c22277991b08c84adc302de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/237413747601e3f11c22277991b08c84adc302de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/237413747601e3f11c22277991b08c84adc302de"}], "stats": {"total": 9, "additions": 8, "deletions": 1}, "files": [{"sha": "e3e274a756fb04b3360d94f3650e567e8a094fb5", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6fa2e83e958802036ad9ed558bee1988299e0e7/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6fa2e83e958802036ad9ed558bee1988299e0e7/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=a6fa2e83e958802036ad9ed558bee1988299e0e7", "patch": "@@ -1,3 +1,8 @@\n+2019-09-13  Maciej W. Rozycki  <macro@wdc.com>\n+\n+\t* make.adb (Scan_Make_Arg): Also accept `--sysroot=' for the \n+\tcompiler and the linker.\n+ \n 2019-08-30  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/decl.c (maybe_saturate_size): New function."}, {"sha": "3c9df7e50a14dcae820372cf2645e24d2afe2a20", "filename": "gcc/ada/make.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6fa2e83e958802036ad9ed558bee1988299e0e7/gcc%2Fada%2Fmake.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6fa2e83e958802036ad9ed558bee1988299e0e7/gcc%2Fada%2Fmake.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmake.adb?ref=a6fa2e83e958802036ad9ed558bee1988299e0e7", "patch": "@@ -4516,7 +4516,9 @@ package body Make is\n                end;\n             end if;\n \n-         elsif Argv'Length >= 8 and then Argv (1 .. 8) = \"--param=\" then\n+         elsif (Argv'Length >= 8 and then Argv (1 .. 8) = \"--param=\")\n+           or else (Argv'Length >= 10 and then Argv (1 .. 10) = \"--sysroot=\")\n+         then\n             Add_Switch (Argv, Compiler);\n             Add_Switch (Argv, Linker);\n "}]}