{"sha": "72b03fde35443a0007dbbef4c2151ac0d7b6a1f9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzJiMDNmZGUzNTQ0M2EwMDA3ZGJiZWY0YzIxNTFhYzBkN2I2YTFmOQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-09-18T07:38:12Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-09-18T07:38:12Z"}, "message": "graphite-scop-detection.c (scop_detection::stmt_has_simple_data_ref): Simplify.\n\n2017-09-18  Richard Biener  <rguenther@suse.de>\n\n\t* graphite-scop-detection.c (scop_detection::stmt_has_simple_data_ref):\n\tSimplify.\n\t(build_alias_set): Reject aliases with no access function.\n\nFrom-SVN: r252906", "tree": {"sha": "81736159be762bd412e9eb4ad48461e548c8096c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81736159be762bd412e9eb4ad48461e548c8096c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3d07d963f6eb6fce457e0414bef4ad428dfb7788", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d07d963f6eb6fce457e0414bef4ad428dfb7788", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d07d963f6eb6fce457e0414bef4ad428dfb7788"}], "stats": {"total": 42, "additions": 16, "deletions": 26}, "files": [{"sha": "fe4fcfaefbb492610be3c4830316ace81c20f95f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=72b03fde35443a0007dbbef4c2151ac0d7b6a1f9", "patch": "@@ -1,3 +1,9 @@\n+2017-09-18  Richard Biener  <rguenther@suse.de>\n+\n+\t* graphite-scop-detection.c (scop_detection::stmt_has_simple_data_ref):\n+\tSimplify.\n+\t(build_alias_set): Reject aliases with no access function.\n+\n 2017-09-18  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/79622"}, {"sha": "71ddfd8e23464372d5a57cc58cc2784e9a317d57", "filename": "gcc/graphite-scop-detection.c", "status": "modified", "additions": 10, "deletions": 26, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9/gcc%2Fgraphite-scop-detection.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72b03fde35443a0007dbbef4c2151ac0d7b6a1f9/gcc%2Fgraphite-scop-detection.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-scop-detection.c?ref=72b03fde35443a0007dbbef4c2151ac0d7b6a1f9", "patch": "@@ -1338,40 +1338,23 @@ scop_detection::stmt_has_simple_data_refs_p (sese_l scop, gimple *stmt)\n {\n   loop_p nest = outermost_loop_in_sese (scop, gimple_bb (stmt));\n   loop_p loop = loop_containing_stmt (stmt);\n-  vec<data_reference_p> drs = vNULL;\n+  if (!loop_in_sese_p (loop, scop))\n+    loop = nest;\n \n-  graphite_find_data_references_in_stmt (nest, loop, stmt, &drs);\n+  auto_vec<data_reference_p> drs;\n+  if (! graphite_find_data_references_in_stmt (nest, loop, stmt, &drs))\n+    return false;\n \n   int j;\n   data_reference_p dr;\n   FOR_EACH_VEC_ELT (drs, j, dr)\n     {\n-      int nb_subscripts = DR_NUM_DIMENSIONS (dr);\n-\n-      if (nb_subscripts < 1)\n-\t{\n-\t  free_data_refs (drs);\n+      for (unsigned i = 0; i < DR_NUM_DIMENSIONS (dr); ++i)\n+\tif (! graphite_can_represent_scev (DR_ACCESS_FN (dr, i)))\n \t  return false;\n-\t}\n-\n-      tree ref = DR_REF (dr);\n-\n-      for (int i = nb_subscripts - 1; i >= 0; i--)\n-\t{\n-\t  if (!graphite_can_represent_scev (DR_ACCESS_FN (dr, i))\n-\t      || (TREE_CODE (ref) != ARRAY_REF && TREE_CODE (ref) != MEM_REF\n-\t\t  && TREE_CODE (ref) != COMPONENT_REF))\n-\t    {\n-\t      free_data_refs (drs);\n-\t      return false;\n-\t    }\n-\n-\t  ref = TREE_OPERAND (ref, 0);\n-\t}\n     }\n \n-    free_data_refs (drs);\n-    return true;\n+  return true;\n }\n \n /* GIMPLE_ASM and GIMPLE_CALL may embed arbitrary side effects.\n@@ -1875,7 +1858,8 @@ build_alias_set (scop_p scop)\n \t{\n \t  /* Dependences in the same alias set need to be handled\n \t     by just looking at DR_ACCESS_FNs.  */\n-\t  if (DR_NUM_DIMENSIONS (dr1->dr) != DR_NUM_DIMENSIONS (dr2->dr)\n+\t  if (DR_NUM_DIMENSIONS (dr1->dr) == 0\n+\t      || DR_NUM_DIMENSIONS (dr1->dr) != DR_NUM_DIMENSIONS (dr2->dr)\n \t      || ! operand_equal_p (DR_BASE_OBJECT (dr1->dr),\n \t\t\t\t    DR_BASE_OBJECT (dr2->dr),\n \t\t\t\t    OEP_ADDRESS_OF)"}]}