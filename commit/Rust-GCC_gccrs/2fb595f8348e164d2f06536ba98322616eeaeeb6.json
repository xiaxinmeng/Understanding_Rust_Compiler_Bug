{"sha": "2fb595f8348e164d2f06536ba98322616eeaeeb6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZiNTk1ZjgzNDhlMTY0ZDJmMDY1MzZiYTk4MzIyNjE2ZWVhZWViNg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2020-05-29T20:55:52Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2020-05-29T22:16:54Z"}, "message": "c++: Template template parameter in constraint [PR95371]\n\nany_template_parm_r was assuming that the DECL_TEMPLATE_RESULT of a template\nwill have a suitable TEMPLATE_INFO from which we can look at the generic\narguments for that template.  But that wasn't true for a template template\nparameter; this patch makes it so.\n\ngcc/cp/ChangeLog:\n\n\tPR c++/95371\n\t* pt.c (process_template_parm): Set DECL_TEMPLATE_INFO\n\ton the DECL_TEMPLATE_RESULT.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/95371\n\t* g++.dg/cpp2a/concepts-ttp1.C: New test.", "tree": {"sha": "62f985a6ba84d868d4e1829dd6f69b38054c4840", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/62f985a6ba84d868d4e1829dd6f69b38054c4840"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2fb595f8348e164d2f06536ba98322616eeaeeb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fb595f8348e164d2f06536ba98322616eeaeeb6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fb595f8348e164d2f06536ba98322616eeaeeb6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fb595f8348e164d2f06536ba98322616eeaeeb6/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "33e23881aae0549572cc23a2520c5094a2ffede9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33e23881aae0549572cc23a2520c5094a2ffede9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33e23881aae0549572cc23a2520c5094a2ffede9"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "df647af7b463bd12a7578d036f34f7d787822f8f", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fb595f8348e164d2f06536ba98322616eeaeeb6/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fb595f8348e164d2f06536ba98322616eeaeeb6/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=2fb595f8348e164d2f06536ba98322616eeaeeb6", "patch": "@@ -4575,7 +4575,16 @@ process_template_parm (tree list, location_t parm_loc, tree parm,\n \t  /* This is for distinguishing between real templates and template\n \t     template parameters */\n \t  TREE_TYPE (parm) = t;\n-\t  TREE_TYPE (DECL_TEMPLATE_RESULT (parm)) = t;\n+\n+\t  /* any_template_parm_r expects to be able to get the targs of a\n+\t     DECL_TEMPLATE_RESULT.  */\n+\t  tree result = DECL_TEMPLATE_RESULT (parm);\n+\t  TREE_TYPE (result) = t;\n+\t  tree args = template_parms_to_args (DECL_TEMPLATE_PARMS (parm));\n+\t  tree tinfo = build_template_info (parm, args);\n+\t  retrofit_lang_decl (result);\n+\t  DECL_TEMPLATE_INFO (result) = tinfo;\n+\n \t  decl = parm;\n \t}\n       else"}, {"sha": "3f6eb35cf61da9c80e4c02450ef1d219906d5dfd", "filename": "gcc/testsuite/g++.dg/cpp2a/concepts-ttp1.C", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2fb595f8348e164d2f06536ba98322616eeaeeb6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-ttp1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2fb595f8348e164d2f06536ba98322616eeaeeb6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-ttp1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconcepts-ttp1.C?ref=2fb595f8348e164d2f06536ba98322616eeaeeb6", "patch": "@@ -0,0 +1,16 @@\n+// PR c++/95371\n+// { dg-do compile { target c++20 } }\n+\n+template <typename...>\n+struct configuration  {\n+    template <template <typename...> typename query_t>\n+    static constexpr bool exists() { return true; }\n+\n+    template <template <typename...> typename query_t>\n+    void remove() requires(exists<query_t>());\n+};\n+\n+int main() {\n+    configuration<> cfg{};\n+    cfg.remove<configuration>();\n+}"}]}