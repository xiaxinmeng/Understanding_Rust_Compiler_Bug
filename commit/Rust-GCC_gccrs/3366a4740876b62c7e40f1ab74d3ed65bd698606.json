{"sha": "3366a4740876b62c7e40f1ab74d3ed65bd698606", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM2NmE0NzQwODc2YjYyYzdlNDBmMWFiNzRkM2VkNjViZDY5ODYwNg==", "commit": {"author": {"name": "Tim Shen", "email": "timshen@google.com", "date": "2017-09-11T19:02:34Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2017-09-11T19:02:34Z"}, "message": "re PR libstdc++/71500 (regex::icase only works on first character in a range)\n\n\tPR libstdc++/71500\n\t* include/bits/regex_executor.tcc: Support icase in regex_tratis<...>\n\tfor back reference matches.\n\t* testsuite/28_regex/regression.cc: Test case.\n\nFrom-SVN: r251982", "tree": {"sha": "d213ab8f4b3ae4ae7945be932ecebbb19faab4fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d213ab8f4b3ae4ae7945be932ecebbb19faab4fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3366a4740876b62c7e40f1ab74d3ed65bd698606", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3366a4740876b62c7e40f1ab74d3ed65bd698606", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3366a4740876b62c7e40f1ab74d3ed65bd698606", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3366a4740876b62c7e40f1ab74d3ed65bd698606/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "47d7966a70e1fcf39c11402f02ca3931a02f21eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47d7966a70e1fcf39c11402f02ca3931a02f21eb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47d7966a70e1fcf39c11402f02ca3931a02f21eb"}], "stats": {"total": 74, "additions": 71, "deletions": 3}, "files": [{"sha": "7163c6427b4851148a66cae9f3a70a93380efc58", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3366a4740876b62c7e40f1ab74d3ed65bd698606/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3366a4740876b62c7e40f1ab74d3ed65bd698606/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=3366a4740876b62c7e40f1ab74d3ed65bd698606", "patch": "@@ -1,3 +1,10 @@\n+2017-09-11  Tim Shen  <timshen@google.com>\n+\n+\tPR libstdc++/71500\n+\t* include/bits/regex_executor.tcc: Support icase in regex_tratis<...>\n+\tfor back reference matches.\n+\t* testsuite/28_regex/regression.cc: Test case.\n+\n 2017-09-11  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* testsuite/21_strings/basic_string/lwg2946.cc: Adjust for"}, {"sha": "f6149fecf9d81585b04a720271cb8ef2b34870a9", "filename": "libstdc++-v3/include/bits/regex_executor.tcc", "status": "modified", "additions": 52, "deletions": 3, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3366a4740876b62c7e40f1ab74d3ed65bd698606/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3366a4740876b62c7e40f1ab74d3ed65bd698606/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex_executor.tcc?ref=3366a4740876b62c7e40f1ab74d3ed65bd698606", "patch": "@@ -335,6 +335,54 @@ namespace __detail\n \t  _M_states._M_queue(__state._M_next, _M_cur_results);\n     }\n \n+  template<typename _BiIter, typename _TraitsT>\n+    struct _Backref_matcher\n+    {\n+      _Backref_matcher(bool __icase, const _TraitsT& __traits)\n+      : _M_traits(__traits) { }\n+\n+      bool\n+      _M_apply(_BiIter __expected_begin,\n+\t       _BiIter __expected_end, _BiIter __actual_begin,\n+\t       _BiIter __actual_end)\n+      {\n+\treturn _M_traits.transform(__expected_begin, __expected_end)\n+\t    == _M_traits.transform(__actual_begin, __actual_end);\n+      }\n+\n+      const _TraitsT& _M_traits;\n+    };\n+\n+  template<typename _BiIter, typename _CharT>\n+    struct _Backref_matcher<_BiIter, std::regex_traits<_CharT>>\n+    {\n+      using _TraitsT = std::regex_traits<_CharT>;\n+      _Backref_matcher(bool __icase, const _TraitsT& __traits)\n+      : _M_icase(__icase), _M_traits(__traits) { }\n+\n+      bool\n+      _M_apply(_BiIter __expected_begin,\n+\t       _BiIter __expected_end, _BiIter __actual_begin,\n+\t       _BiIter __actual_end)\n+      {\n+\tif (!_M_icase)\n+\t  return std::equal(__expected_begin, __expected_end,\n+\t\t\t    __actual_begin, __actual_end);\n+\ttypedef std::ctype<_CharT> __ctype_type;\n+\tconst auto& __fctyp = use_facet<__ctype_type>(_M_traits.getloc());\n+\treturn std::equal(__expected_begin, __expected_end,\n+\t\t\t  __actual_begin, __actual_end,\n+\t\t\t  [this, &__fctyp](_CharT __lhs, _CharT __rhs)\n+\t\t\t  {\n+\t\t\t    return __fctyp.tolower(__lhs)\n+\t\t\t\t== __fctyp.tolower(__rhs);\n+\t\t\t  });\n+      }\n+\n+      bool _M_icase;\n+      const _TraitsT& _M_traits;\n+    };\n+\n   // First fetch the matched result from _M_cur_results as __submatch;\n   // then compare it with\n   // (_M_current, _M_current + (__submatch.second - __submatch.first)).\n@@ -355,9 +403,10 @@ namespace __detail\n \t   __last != _M_end && __tmp != __submatch.second;\n \t   ++__tmp)\n \t++__last;\n-      if (_M_re._M_automaton->_M_traits.transform(__submatch.first,\n-\t\t\t\t\t\t  __submatch.second)\n-\t  == _M_re._M_automaton->_M_traits.transform(_M_current, __last))\n+      if (_Backref_matcher<_BiIter, _TraitsT>(\n+\t      _M_re.flags() & regex_constants::icase,\n+\t      _M_re._M_automaton->_M_traits)._M_apply(\n+\t\t  __submatch.first, __submatch.second, _M_current, __last))\n \t{\n \t  if (__last != _M_current)\n \t    {"}, {"sha": "3fa9022eac4691ebe8a59d2df652a9ae2f25d6ee", "filename": "libstdc++-v3/testsuite/28_regex/regression.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3366a4740876b62c7e40f1ab74d3ed65bd698606/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fregression.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3366a4740876b62c7e40f1ab74d3ed65bd698606/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fregression.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fregression.cc?ref=3366a4740876b62c7e40f1ab74d3ed65bd698606", "patch": "@@ -93,6 +93,17 @@ test06()\n   }\n }\n \n+// PR libstdc++/71500\n+void\n+test07()\n+{\n+  bool test [[gnu::unused]] = true;\n+\n+  VERIFY(regex_match_debug(\"abc abc\", regex(\"([a-z]+) \\\\1\", regex::icase)));\n+  VERIFY(regex_match_debug(\"Abc abc\", regex(\"([a-z]+) \\\\1\", regex::icase)));\n+  VERIFY(regex_match_debug(\"abc Abc\", regex(\"([a-z]+) \\\\1\", regex::icase)));\n+}\n+\n int\n main()\n {\n@@ -102,6 +113,7 @@ main()\n   test04();\n   test05();\n   test06();\n+  test07();\n   return 0;\n }\n "}]}