{"sha": "47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDdhMWFlM2M2YTI3YmZkNTg3NWQ3MDg2MGQ3MmVhMzFkNGM5OGNjNw==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2012-03-25T13:28:32Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2012-03-25T13:28:32Z"}, "message": "re PR middle-end/51663 (Desirable/undesirable elimination of unused variables & functions at -O0, -O0 -flto and -O0 -fwhole-program)\n\n\tPR lto/51663\n\t* varpool.c (varpool_finalize_decl): Handle toplevel_reorder here.\n\t(decide_is_variable_needed): Do not handle toplevel reorder here.\n\t* cgraph.h (varpool_can_remove_if_no_refs): Likewise.\n\t* ipa.c (cgraph_remove_unreachable_nodes): Remove unreachable vars\n\teven at -O0.\n\nFrom-SVN: r185777", "tree": {"sha": "92acef700b091d82f1b0b19cc3a1903207a22d71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/92acef700b091d82f1b0b19cc3a1903207a22d71"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/comments", "author": null, "committer": null, "parents": [{"sha": "e24e08d4e2c4d8f008bdf0dd7ed91449ba3f7787", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e24e08d4e2c4d8f008bdf0dd7ed91449ba3f7787", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e24e08d4e2c4d8f008bdf0dd7ed91449ba3f7787"}], "stats": {"total": 30, "additions": 18, "deletions": 12}, "files": [{"sha": "0db91475709d6ae304f2c783b93b785a182d1d29", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "patch": "@@ -1,3 +1,12 @@\n+2012-03-24  Jan Hubicka  <jh@suse.cz>\n+\n+\tPR lto/51663\n+\t* varpool.c (varpool_finalize_decl): Handle toplevel_reorder here.\n+\t(decide_is_variable_needed): Do not handle toplevel reorder here.\n+\t* cgraph.h (varpool_can_remove_if_no_refs): Likewise.\n+\t* ipa.c (cgraph_remove_unreachable_nodes): Remove unreachable vars\n+\teven at -O0.\n+\n 2012-03-24  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* expr.c (optimize_bitfield_assignment_op) <BIT_IOR_EXPR>: Use str_mode"}, {"sha": "93efd94d9ba63bbd255935ab7dd24a2edb07a4df", "filename": "gcc/cgraph.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2Fcgraph.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2Fcgraph.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.h?ref=47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "patch": "@@ -947,8 +947,6 @@ static inline bool\n varpool_can_remove_if_no_refs (struct varpool_node *node)\n {\n   return (!node->force_output && !node->used_from_other_partition\n-\t  && (flag_toplevel_reorder || DECL_COMDAT (node->decl)\n-\t      || DECL_ARTIFICIAL (node->decl))\n   \t  && (DECL_COMDAT (node->decl) || !node->externally_visible));\n }\n "}, {"sha": "88dd9072c0c0575b247769b405ca8d9894b1ebd9", "filename": "gcc/ipa.c", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2Fipa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2Fipa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa.c?ref=47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "patch": "@@ -419,11 +419,6 @@ cgraph_remove_unreachable_nodes (bool before_inlining_p, FILE *file)\n   if (file)\n     fprintf (file, \"\\n\");\n \n-  /* We must release unused extern inlines or sanity checking will fail.  Rest of transformations\n-     are undesirable at -O0 since we do not want to remove anything.  */\n-  if (!optimize)\n-    return changed;\n-\n   if (file)\n     fprintf (file, \"Reclaiming variables:\");\n   for (vnode = varpool_nodes; vnode; vnode = vnext)\n@@ -463,6 +458,10 @@ cgraph_remove_unreachable_nodes (bool before_inlining_p, FILE *file)\n   if (file)\n     fprintf (file, \"\\n\");\n \n+  /* Rest of transformations are undesirable at -O0.  */\n+  if (!optimize)\n+    return changed;\n+\n #ifdef ENABLE_CHECKING\n   verify_cgraph ();\n #endif"}, {"sha": "e064f7bd6485db3d5bb5dd3bb24647174b4c1710", "filename": "gcc/varpool.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2Fvarpool.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7/gcc%2Fvarpool.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarpool.c?ref=47a1ae3c6a27bfd5875d70860d72ea31d4c98cc7", "patch": "@@ -334,10 +334,6 @@ decide_is_variable_needed (struct varpool_node *node, tree decl)\n       && !DECL_EXTERNAL (decl))\n     return true;\n \n-  /* When not reordering top level variables, we have to assume that\n-     we are going to keep everything.  */\n-  if (!flag_toplevel_reorder)\n-    return true;\n   return false;\n }\n \n@@ -405,7 +401,11 @@ varpool_finalize_decl (tree decl)\n   if (node->needed)\n     varpool_enqueue_needed_node (node);\n   node->finalized = true;\n-  if (TREE_THIS_VOLATILE (decl) || DECL_PRESERVE_P (decl))\n+  if (TREE_THIS_VOLATILE (decl) || DECL_PRESERVE_P (decl)\n+      /* Traditionally we do not eliminate static variables when not\n+\t optimizing and when not doing toplevel reoder.  */\n+      || (!flag_toplevel_reorder && !DECL_COMDAT (node->decl)\n+\t  && !DECL_ARTIFICIAL (node->decl)))\n     node->force_output = true;\n \n   if (decide_is_variable_needed (node, decl))"}]}