{"sha": "782bdf21895dc769cfd85a08c8c1b780924775f3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzgyYmRmMjE4OTVkYzc2OWNmZDg1YTA4YzhjMWI3ODA5MjQ3NzVmMw==", "commit": {"author": {"name": "Claudiu Zissulescu", "email": "claziss@synopsys.com", "date": "2017-09-01T11:43:40Z"}, "committer": {"name": "Claudiu Zissulescu", "email": "claziss@gcc.gnu.org", "date": "2017-09-01T11:43:40Z"}, "message": "[ARC] Fix errors in arc_ifcvt.\n\nThe arc_ifcvt procedure is removing a label even when it is used by\nanother jump.  This patch fixes dg.exp/pr31507-1.c.\n\ngcc/\n2017-07-10  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* config/arc/arc.c (arc_ifcvt): Remove use of merge_blocks call.\n\t(arc_ccfsm_advance): Fix checking for delay slots.\n\t(arc_reorg): Add rtl dump after each call to arc_ifcvt\n\nFrom-SVN: r251588", "tree": {"sha": "4f23fdb13e104fffeb449b08e4742fdad2c69c85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4f23fdb13e104fffeb449b08e4742fdad2c69c85"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/782bdf21895dc769cfd85a08c8c1b780924775f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/782bdf21895dc769cfd85a08c8c1b780924775f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/782bdf21895dc769cfd85a08c8c1b780924775f3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/782bdf21895dc769cfd85a08c8c1b780924775f3/comments", "author": {"login": "claziss", "id": 2761368, "node_id": "MDQ6VXNlcjI3NjEzNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claziss", "html_url": "https://github.com/claziss", "followers_url": "https://api.github.com/users/claziss/followers", "following_url": "https://api.github.com/users/claziss/following{/other_user}", "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}", "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claziss/subscriptions", "organizations_url": "https://api.github.com/users/claziss/orgs", "repos_url": "https://api.github.com/users/claziss/repos", "events_url": "https://api.github.com/users/claziss/events{/privacy}", "received_events_url": "https://api.github.com/users/claziss/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1370fccf2b694231c57fd6517781d53ea241e60d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1370fccf2b694231c57fd6517781d53ea241e60d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1370fccf2b694231c57fd6517781d53ea241e60d"}], "stats": {"total": 48, "additions": 17, "deletions": 31}, "files": [{"sha": "cda34a54e87990743c3d520ce54395fd6077d868", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/782bdf21895dc769cfd85a08c8c1b780924775f3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/782bdf21895dc769cfd85a08c8c1b780924775f3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=782bdf21895dc769cfd85a08c8c1b780924775f3", "patch": "@@ -1,3 +1,9 @@\n+2017-09-01  Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* config/arc/arc.c (arc_ifcvt): Remove use of merge_blocks call.\n+\t(arc_ccfsm_advance): Fix checking for delay slots.\n+\t(arc_reorg): Add rtl dump after each call to arc_ifcvt.\n+\n 2017-09-01  Claudiu Zissulescu  <claziss@synopsys.com>\n \n \t* config/arc/arc.md (movqi_insn): Add stores to save constant long"}, {"sha": "fcca0f1f660c33c64e4cb69c45c9e4d3baf1b224", "filename": "gcc/config/arc/arc.c", "status": "modified", "additions": 11, "deletions": 31, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/782bdf21895dc769cfd85a08c8c1b780924775f3/gcc%2Fconfig%2Farc%2Farc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/782bdf21895dc769cfd85a08c8c1b780924775f3/gcc%2Fconfig%2Farc%2Farc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.c?ref=782bdf21895dc769cfd85a08c8c1b780924775f3", "patch": "@@ -4340,12 +4340,10 @@ arc_ccfsm_advance (rtx_insn *insn, struct arc_ccfsm *state)\n \n       /* If this is a non-annulled branch with a delay slot, there is\n \t no need to conditionalize the delay slot.  */\n-      if (NEXT_INSN (PREV_INSN (insn)) != insn\n+      if ((GET_CODE (PATTERN (NEXT_INSN (PREV_INSN (insn)))) == SEQUENCE)\n \t  && state->state == 0 && !INSN_ANNULLED_BRANCH_P (insn))\n \t{\n \t  this_insn = NEXT_INSN (this_insn);\n-\t  gcc_assert (NEXT_INSN (NEXT_INSN (PREV_INSN (start_insn)))\n-\t\t      == NEXT_INSN (this_insn));\n \t}\n       /* See how many insns this branch skips, and what kind of insns.  If all\n \t insns are okay, and the label or unconditional branch to the same\n@@ -7278,6 +7276,12 @@ arc_reorg (void)\n \t  arc_ifcvt ();\n \t  unsigned int flags = pass_data_arc_ifcvt.todo_flags_finish;\n \t  df_finish_pass ((flags & TODO_df_verify) != 0);\n+\n+\t  if (dump_file)\n+\t    {\n+\t      fprintf (dump_file, \";; After if conversion:\\n\\n\");\n+\t      print_rtl (dump_file, get_insns ());\n+\t    }\n \t}\n \n       /* Call shorten_branches to calculate the insn lengths.  */\n@@ -8828,7 +8832,6 @@ static unsigned\n arc_ifcvt (void)\n {\n   struct arc_ccfsm *statep = &cfun->machine->ccfsm_current;\n-  basic_block merge_bb = 0;\n \n   memset (statep, 0, sizeof *statep);\n   for (rtx_insn *insn = get_insns (); insn; insn = next_insn (insn))\n@@ -8838,20 +8841,14 @@ arc_ifcvt (void)\n       switch (statep->state)\n \t{\n \tcase 0:\n-\t  if (JUMP_P (insn))\n-\t    merge_bb = 0;\n \t  break;\n \tcase 1: case 2:\n \t  {\n \t    /* Deleted branch.  */\n-\t    gcc_assert (!merge_bb);\n-\t    merge_bb = BLOCK_FOR_INSN (insn);\n-\t    basic_block succ_bb\n-\t      = BLOCK_FOR_INSN (NEXT_INSN (NEXT_INSN (PREV_INSN (insn))));\n \t    arc_ccfsm_post_advance (insn, statep);\n \t    gcc_assert (!IN_RANGE (statep->state, 1, 2));\n \t    rtx_insn *seq = NEXT_INSN (PREV_INSN (insn));\n-\t    if (seq != insn)\n+\t    if (GET_CODE (PATTERN (seq)) == SEQUENCE)\n \t      {\n \t\trtx slot = XVECEXP (PATTERN (seq), 0, 1);\n \t\trtx pat = PATTERN (slot);\n@@ -8865,18 +8862,10 @@ arc_ifcvt (void)\n \t\t  gcc_unreachable ();\n \t\tPUT_CODE (slot, NOTE);\n \t\tNOTE_KIND (slot) = NOTE_INSN_DELETED;\n-\t\tif (merge_bb && succ_bb)\n-\t\t  merge_blocks (merge_bb, succ_bb);\n-\t      }\n-\t    else if (merge_bb && succ_bb)\n-\t      {\n-\t\tset_insn_deleted (insn);\n-\t\tmerge_blocks (merge_bb, succ_bb);\n \t      }\n \t    else\n \t      {\n-\t\tPUT_CODE (insn, NOTE);\n-\t\tNOTE_KIND (insn) = NOTE_INSN_DELETED;\n+\t\tset_insn_deleted (insn);\n \t      }\n \t    continue;\n \t  }\n@@ -8885,17 +8874,8 @@ arc_ifcvt (void)\n \t      && statep->target_label == CODE_LABEL_NUMBER (insn))\n \t    {\n \t      arc_ccfsm_post_advance (insn, statep);\n-\t      basic_block succ_bb = BLOCK_FOR_INSN (insn);\n-\t      if (merge_bb && succ_bb)\n-\t\tmerge_blocks (merge_bb, succ_bb);\n-\t      else if (--LABEL_NUSES (insn) == 0)\n-\t\t{\n-\t\t  const char *name = LABEL_NAME (insn);\n-\t\t  PUT_CODE (insn, NOTE);\n-\t\t  NOTE_KIND (insn) = NOTE_INSN_DELETED_LABEL;\n-\t\t  NOTE_DELETED_LABEL_NAME (insn) = name;\n-\t\t}\n-\t      merge_bb = 0;\n+\t      if (--LABEL_NUSES (insn) == 0)\n+\t\tdelete_insn (insn);\n \t      continue;\n \t    }\n \t  /* Fall through.  */"}]}