{"sha": "8dc319eb495d6fa742a265dfa12dc75bf3576d07", "node_id": "C_kwDOANBUbNoAKDhkYzMxOWViNDk1ZDZmYTc0MmEyNjVkZmExMmRjNzViZjM1NzZkMDc", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-11-07T11:59:25Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-11-09T08:00:35Z"}, "message": "sphinx: update baseconf.py file\n\nChangeLog:\n\n\t* doc/baseconf.py: Port to GCC sources.", "tree": {"sha": "f7dc19d8f91bb67852a2094f6ea3f5b931ee039d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f7dc19d8f91bb67852a2094f6ea3f5b931ee039d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8dc319eb495d6fa742a265dfa12dc75bf3576d07", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dc319eb495d6fa742a265dfa12dc75bf3576d07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8dc319eb495d6fa742a265dfa12dc75bf3576d07", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dc319eb495d6fa742a265dfa12dc75bf3576d07/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c63539ffe4c0e327337a1a51f638d9c8c958cb26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c63539ffe4c0e327337a1a51f638d9c8c958cb26", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c63539ffe4c0e327337a1a51f638d9c8c958cb26"}], "stats": {"total": 75, "additions": 31, "deletions": 44}, "files": [{"sha": "f80fdabc8b0e8782314f401c776d0be5752ff6ce", "filename": "doc/baseconf.py", "status": "modified", "additions": 31, "deletions": 44, "changes": 75, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc319eb495d6fa742a265dfa12dc75bf3576d07/doc%2Fbaseconf.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc319eb495d6fa742a265dfa12dc75bf3576d07/doc%2Fbaseconf.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/doc%2Fbaseconf.py?ref=8dc319eb495d6fa742a265dfa12dc75bf3576d07", "patch": "@@ -11,7 +11,7 @@\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n #\n import os\n-import subprocess\n+import time\n import sys\n # sys.path.insert(0, os.path.abspath('.'))\n \n@@ -22,44 +22,34 @@\n \n # The full version, including alpha/beta/rc tags\n \n-# FIXME\n folder = os.path.dirname(os.path.realpath(__file__))\n-gcc_srcdir = os.path.join(folder, './objdir')\n+gcc_srcdir = os.path.join(folder, '..', 'gcc')\n \n-\n-def __read_file(name):\n+def read_file(name):\n     path = os.path.join(gcc_srcdir, name)\n     if os.path.exists(path):\n         return open(path).read().strip()\n     else:\n         return ''\n \n-\n-def __get_git_revision():\n-    try:\n-        r = subprocess.check_output('git rev-parse --short HEAD', shell=True, encoding='utf8',\n-                                    stderr=subprocess.DEVNULL)\n-        return r.strip()\n-    except subprocess.CalledProcessError:\n-        return None\n-\n-\n def __get_builder_name():\n     if '-b' in sys.argv:\n         return sys.argv[sys.argv.index('-b') + 1]\n     else:\n         return None\n \n \n-gcc_BASEVER = __read_file('BASE-VER')\n-gcc_DEVPHASE = __read_file('DEV-PHASE')\n-gcc_DATESTAMP = __read_file('DATESTAMP')\n-gcc_REVISION = __read_file('REVISION')\n+gcc_BASEVER = read_file('BASE-VER')\n+gcc_DEVPHASE = read_file('DEV-PHASE')\n+gcc_DATESTAMP = read_file('DATESTAMP')\n+gcc_REVISION = read_file('REVISION')\n \n-VERSION_PACKAGE = os.getenv('VERSION_PACKAGE', '(GCC)')\n-BUGURL = os.getenv('BUGURL', 'https://gcc.gnu.org/bugs/')\n+VERSION_PACKAGE = os.getenv('VERSION_PACKAGE')\n+BUGURL = os.getenv('BUGURL')\n MONOCHROMATIC = os.getenv('MONOCHROMATIC')\n \n+YEAR = time.strftime('%Y')\n+\n # The short X.Y version.\n version = gcc_BASEVER\n \n@@ -80,10 +70,14 @@ def __get_builder_name():\n \n rst_epilog = '''\n .. |gcc_version| replace:: %s\n-.. |package_version| replace:: %s\n-.. |bugurl| replace:: %s\n-.. |needs_sphinx| replace:: %s\n-''' % (gcc_BASEVER, VERSION_PACKAGE, BUGURL, needs_sphinx)\n+.. |needs_sphinx| replace:: %s\\n\n+''' % (gcc_BASEVER, needs_sphinx)\n+\n+if BUGURL:\n+    rst_epilog += '.. |bugurl| replace:: %s\\n' % BUGURL\n+\n+if VERSION_PACKAGE:\n+    rst_epilog += '.. |package_version| replace:: %s\\n' % VERSION_PACKAGE\n \n # -- General configuration ---------------------------------------------------\n \n@@ -130,18 +124,14 @@ def __get_builder_name():\n     'navigation_with_keys': True,\n }\n \n-html_logo = '../logo.svg'\n+html_logo = os.path.join(folder, 'logo.svg')\n \n-html_favicon = '../favicon.ico'\n+html_favicon = os.path.join(folder, 'favicon.ico')\n \n html_last_updated_fmt = ''\n \n-html_context = {\n-    'commit': __get_git_revision()\n-}\n-\n html_static_path = [\n-    '../_static'\n+    os.path.join(folder, '_static')\n ]\n \n html_css_files = [\n@@ -159,7 +149,7 @@ def __get_builder_name():\n # Use xelatex by default\n latex_engine = 'xelatex'\n \n-latex_logo = '../logo.pdf'\n+latex_logo = os.path.join(folder, 'logo.pdf')\n \n latex_elements = {\n     'pointsize': '11pt',\n@@ -181,13 +171,10 @@ def __get_builder_name():\n \n latex_table_style = ['colorrows']\n \n-texinfo_cross_references = False\n+# makeindex is much common on older systems\n+latex_use_xindy = False\n \n-texinfo_elements = {'preamble': \"\"\"\n-@definfoenclose strong,*,*\n-@definfoenclose emph,','\n-\"\"\"\n-}\n+texinfo_cross_references = False\n \n # Use default as RTD theme uses default as well\n pygments_style = 'bw' if MONOCHROMATIC else 'default'\n@@ -201,13 +188,13 @@ def __get_builder_name():\n ]\n \n USER_LEVEL_DOCS = ('install', 'gcc', 'gfortran', 'cpp', 'gnat_rm', 'gnat_ugn',\n-                   'gccgo', 'libgomp', 'libquadmath', 'libgccjit')\n-INTERNAL_DOCS = ('gccint', 'cppinternals', 'gfc-internals', 'gnat-style')\n+                   'gccgo', 'gdc', 'libgomp', 'libquadmath', 'libitm', 'libgccjit')\n+INTERNAL_DOCS = ('gccint', 'cppinternals', 'gfc-internals', 'gnat-style', 'libiberty')\n \n # Cross manual reference mapping\n intersphinx_mapping = {}\n for manual in USER_LEVEL_DOCS + INTERNAL_DOCS:\n-    intersphinx_mapping[manual] = (f'https://splichal.eu/scripts/sphinx/{manual}/_build/html/', None)\n+    intersphinx_mapping[manual] = (f'https://gcc.gnu.org/onlinedocs/{manual}/', None)\n \n # Custom references\n extlinks = {\n@@ -226,5 +213,5 @@ def set_common(name, module):\n         module['todo_include_todos'] = True\n         module['tags'].add('development')\n \n-    html_theme_options['source_edit_link'] = f'https://splichal.eu/scripts/sphinx/{name}' \\\n-                                               '/_build/html/_sources/{filename}.txt'\n+    html_theme_options['source_edit_link'] = f'https://gcc.gnu.org/onlinedocs/{name}' \\\n+                                               '/_sources/{filename}.txt'"}]}