{"sha": "727a65e6fc07ea95309c875978c83c741359ad4e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzI3YTY1ZTZmYzA3ZWE5NTMwOWM4NzU5NzhjODNjNzQxMzU5YWQ0ZQ==", "commit": {"author": {"name": "Bernd Schmidt", "email": "bernds@codesourcery.com", "date": "2011-07-13T13:32:57Z"}, "committer": {"name": "Bernd Schmidt", "email": "bernds@gcc.gnu.org", "date": "2011-07-13T13:32:57Z"}, "message": "tm.texi.in (TARGET_ASM_MERGEABLE_RODATA_PREFIX): Add hook.\n\n\t* doc/tm.texi.in (TARGET_ASM_MERGEABLE_RODATA_PREFIX): Add hook.\n\t* doc/tm.texi: Regenerate.\n\t* target.def (mergeable_rodata_prefix: New defhookpod.\n\t* varasm.c (mergeable_string_section, mergeable_constant_section):\n\tUse it. Allocate name with alloca.\n\nFrom-SVN: r176235", "tree": {"sha": "c27f9b1f6edf8bca3d95d41510094e498024b477", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c27f9b1f6edf8bca3d95d41510094e498024b477"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/727a65e6fc07ea95309c875978c83c741359ad4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/727a65e6fc07ea95309c875978c83c741359ad4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/727a65e6fc07ea95309c875978c83c741359ad4e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/727a65e6fc07ea95309c875978c83c741359ad4e/comments", "author": null, "committer": null, "parents": [{"sha": "cb77b6cf1f6f16014d71213cba699d76c87ac2ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb77b6cf1f6f16014d71213cba699d76c87ac2ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb77b6cf1f6f16014d71213cba699d76c87ac2ef"}], "stats": {"total": 37, "additions": 32, "deletions": 5}, "files": [{"sha": "7bb3a05ff2c63addc1a0350a12ad6eb297b0cc87", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=727a65e6fc07ea95309c875978c83c741359ad4e", "patch": "@@ -1,3 +1,11 @@\n+2011-07-13  Bernd Schmidt  <bernds@codesourcery.com>\n+\n+\t* doc/tm.texi.in (TARGET_ASM_MERGEABLE_RODATA_PREFIX): Add hook.\n+\t* doc/tm.texi: Regenerate.\n+\t* target.def (mergeable_rodata_prefix: New defhookpod.\n+\t* varasm.c (mergeable_string_section, mergeable_constant_section):\n+\tUse it. Allocate name with alloca.\n+\n 2011-07-13  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* doc/invoke.texi (x86): Remove -mfused-madd and add -mfma."}, {"sha": "08acb351ba35dee2150cbdf0c9ede016712fca02", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=727a65e6fc07ea95309c875978c83c741359ad4e", "patch": "@@ -7050,6 +7050,12 @@ if function is in @code{.text.name}, and the normal readonly-data section\n otherwise.\n @end deftypefn\n \n+@deftypevr {Target Hook} {const char *} TARGET_ASM_MERGEABLE_RODATA_PREFIX\n+Usually, the compiler uses the prefix @code{\".rodata\"} to construct\n+section names for mergeable constant data.  Define this macro to override\n+the string if a different section name should be used.\n+@end deftypevr\n+\n @deftypefn {Target Hook} {section *} TARGET_ASM_SELECT_RTX_SECTION (enum machine_mode @var{mode}, rtx @var{x}, unsigned HOST_WIDE_INT @var{align})\n Return the section into which a constant @var{x}, of mode @var{mode},\n should be placed.  You can assume that @var{x} is some kind of"}, {"sha": "7990c763a73ef44665c5ec547a51a7bc7f47696f", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=727a65e6fc07ea95309c875978c83c741359ad4e", "patch": "@@ -6984,6 +6984,8 @@ if function is in @code{.text.name}, and the normal readonly-data section\n otherwise.\n @end deftypefn\n \n+@hook TARGET_ASM_MERGEABLE_RODATA_PREFIX\n+\n @hook TARGET_ASM_SELECT_RTX_SECTION\n Return the section into which a constant @var{x}, of mode @var{mode},\n should be placed.  You can assume that @var{x} is some kind of"}, {"sha": "3a0b413a80a281de0abfd1365783df15e1732b39", "filename": "gcc/target.def", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Ftarget.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Ftarget.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget.def?ref=727a65e6fc07ea95309c875978c83c741359ad4e", "patch": "@@ -296,6 +296,15 @@ DEFHOOK\n  section *, (tree decl),\n  default_function_rodata_section)\n \n+/* Nonnull if the target wants to override the default \".rodata\" prefix\n+   for mergeable data sections.  */\n+DEFHOOKPOD\n+(mergeable_rodata_prefix,\n+ \"Usually, the compiler uses the prefix @code{\\\".rodata\\\"} to construct\\n\\\n+section names for mergeable constant data.  Define this macro to override\\n\\\n+the string if a different section name should be used.\",\n+ const char *, \".rodata\")\n+\n /* Output a constructor for a symbol with a given priority.  */\n DEFHOOK\n (constructor,"}, {"sha": "8c656960f756d16390fe9dc2f5804d3776f326eb", "filename": "gcc/varasm.c", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/727a65e6fc07ea95309c875978c83c741359ad4e/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=727a65e6fc07ea95309c875978c83c741359ad4e", "patch": "@@ -742,7 +742,8 @@ mergeable_string_section (tree decl ATTRIBUTE_UNUSED,\n       const char *str;\n       HOST_WIDE_INT i;\n       int j, unit;\n-      char name[30];\n+      const char *prefix = targetm.asm_out.mergeable_rodata_prefix;\n+      char *name = (char *) alloca (strlen (prefix) + 30);\n \n       mode = TYPE_MODE (TREE_TYPE (TREE_TYPE (decl)));\n       modesize = GET_MODE_BITSIZE (mode);\n@@ -766,8 +767,8 @@ mergeable_string_section (tree decl ATTRIBUTE_UNUSED,\n \t    }\n \t  if (i == len - unit)\n \t    {\n-\t      sprintf (name, \".rodata.str%d.%d\", modesize / 8,\n-\t\t       (int) (align / 8));\n+\t      sprintf (name, \"%s.str%d.%d\", prefix,\n+\t\t       modesize / 8, (int) (align / 8));\n \t      flags |= (modesize / 8) | SECTION_MERGE | SECTION_STRINGS;\n \t      return get_section (name, flags, NULL);\n \t    }\n@@ -794,9 +795,10 @@ mergeable_constant_section (enum machine_mode mode ATTRIBUTE_UNUSED,\n       && align <= 256\n       && (align & (align - 1)) == 0)\n     {\n-      char name[24];\n+      const char *prefix = targetm.asm_out.mergeable_rodata_prefix;\n+      char *name = (char *) alloca (strlen (prefix) + 30);\n \n-      sprintf (name, \".rodata.cst%d\", (int) (align / 8));\n+      sprintf (name, \"%s.cst%d\", prefix, (int) (align / 8));\n       flags |= (align / 8) | SECTION_MERGE;\n       return get_section (name, flags, NULL);\n     }"}]}