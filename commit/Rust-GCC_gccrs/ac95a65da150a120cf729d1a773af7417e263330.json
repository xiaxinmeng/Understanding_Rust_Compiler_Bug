{"sha": "ac95a65da150a120cf729d1a773af7417e263330", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWM5NWE2NWRhMTUwYTEyMGNmNzI5ZDFhNzczYWY3NDE3ZTI2MzMzMA==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2017-10-06T09:19:46Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2017-10-06T09:19:46Z"}, "message": "PR82322: S/390: Fix vec_ceil and friends\n\nvec_ceil and friends are expanded by vecintrin.h to __builtin_s390_vfi\nwhich is an overloaded builtin being replaced by either\n__builtin_s390_vfisb or __builtin_s390_vfidb depending on its argument\ntypes.\n\nThe problem in this PR was that the overloaded builtin definition of\n__builtin_s390_vfi was missing in s390-builtins.def.\n\ngcc/ChangeLog:\n\n2017-10-06  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/82322\n\t* config/s390/s390-builtins.def (s390_vfi): Define new overloaded\n\tbuiltin.\n\t* config/s390/s390-builtin-types.def: Regenerate.\n\ngcc/testsuite/ChangeLog:\n\n2017-10-06  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/82322\n\t* gcc.target/s390/zvector/pr82322.c: New test.\n\nFrom-SVN: r253481", "tree": {"sha": "aa54268a1f20dcb7f60f10c4c860d671cdd66e85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aa54268a1f20dcb7f60f10c4c860d671cdd66e85"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ac95a65da150a120cf729d1a773af7417e263330", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac95a65da150a120cf729d1a773af7417e263330", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac95a65da150a120cf729d1a773af7417e263330", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac95a65da150a120cf729d1a773af7417e263330/comments", "author": null, "committer": null, "parents": [{"sha": "6fcb90c624db95f1b483e0d403e95215d4732bd6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fcb90c624db95f1b483e0d403e95215d4732bd6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6fcb90c624db95f1b483e0d403e95215d4732bd6"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "82479468f9135b4ddda66a0511e2083a579406ec", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac95a65da150a120cf729d1a773af7417e263330/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac95a65da150a120cf729d1a773af7417e263330/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ac95a65da150a120cf729d1a773af7417e263330", "patch": "@@ -1,3 +1,10 @@\n+2017-10-06  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/82322\n+\t* config/s390/s390-builtins.def (s390_vfi): Define new overloaded\n+\tbuiltin.\n+\t* config/s390/s390-builtin-types.def: Regenerate.\n+\n 2017-10-06  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \tPR target/82317"}, {"sha": "fa03f423a9a95f8ad618525cb066f3b1cf2f6dcf", "filename": "gcc/config/s390/s390-builtin-types.def", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Fconfig%2Fs390%2Fs390-builtin-types.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Fconfig%2Fs390%2Fs390-builtin-types.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390-builtin-types.def?ref=ac95a65da150a120cf729d1a773af7417e263330", "patch": "@@ -312,6 +312,7 @@ DEF_FN_TYPE_3 (BT_FN_V16QI_V8HI_V8HI_INTPTR, BT_V16QI, BT_V8HI, BT_V8HI, BT_INTP\n DEF_FN_TYPE_3 (BT_FN_V2DF_UV2DI_INT_INT, BT_V2DF, BT_UV2DI, BT_INT, BT_INT)\n DEF_FN_TYPE_3 (BT_FN_V2DF_V2DF_DBL_INT, BT_V2DF, BT_V2DF, BT_DBL, BT_INT)\n DEF_FN_TYPE_3 (BT_FN_V2DF_V2DF_UCHAR_UCHAR, BT_V2DF, BT_V2DF, BT_UCHAR, BT_UCHAR)\n+DEF_FN_TYPE_3 (BT_FN_V2DF_V2DF_UINT_UINT, BT_V2DF, BT_V2DF, BT_UINT, BT_UINT)\n DEF_FN_TYPE_3 (BT_FN_V2DF_V2DF_V2DF_INT, BT_V2DF, BT_V2DF, BT_V2DF, BT_INT)\n DEF_FN_TYPE_3 (BT_FN_V2DF_V2DF_V2DF_V2DF, BT_V2DF, BT_V2DF, BT_V2DF, BT_V2DF)\n DEF_FN_TYPE_3 (BT_FN_V2DF_V2DI_INT_INT, BT_V2DF, BT_V2DI, BT_INT, BT_INT)\n@@ -664,6 +665,7 @@ DEF_OV_TYPE (BT_OV_V2DF_UV2DI_INT, BT_V2DF, BT_UV2DI, BT_INT)\n DEF_OV_TYPE (BT_OV_V2DF_V2DF, BT_V2DF, BT_V2DF)\n DEF_OV_TYPE (BT_OV_V2DF_V2DF_BV2DI, BT_V2DF, BT_V2DF, BT_BV2DI)\n DEF_OV_TYPE (BT_OV_V2DF_V2DF_UCHAR, BT_V2DF, BT_V2DF, BT_UCHAR)\n+DEF_OV_TYPE (BT_OV_V2DF_V2DF_UCHAR_UCHAR, BT_V2DF, BT_V2DF, BT_UCHAR, BT_UCHAR)\n DEF_OV_TYPE (BT_OV_V2DF_V2DF_UV2DI, BT_V2DF, BT_V2DF, BT_UV2DI)\n DEF_OV_TYPE (BT_OV_V2DF_V2DF_UV2DI_DBLCONSTPTR_UCHAR, BT_V2DF, BT_V2DF, BT_UV2DI, BT_DBLCONSTPTR, BT_UCHAR)\n DEF_OV_TYPE (BT_OV_V2DF_V2DF_V2DF, BT_V2DF, BT_V2DF, BT_V2DF)\n@@ -717,6 +719,7 @@ DEF_OV_TYPE (BT_OV_V4SF_LONG_FLTPTR, BT_V4SF, BT_LONG, BT_FLTPTR)\n DEF_OV_TYPE (BT_OV_V4SF_V4SF, BT_V4SF, BT_V4SF)\n DEF_OV_TYPE (BT_OV_V4SF_V4SF_BV4SI, BT_V4SF, BT_V4SF, BT_BV4SI)\n DEF_OV_TYPE (BT_OV_V4SF_V4SF_UCHAR, BT_V4SF, BT_V4SF, BT_UCHAR)\n+DEF_OV_TYPE (BT_OV_V4SF_V4SF_UCHAR_UCHAR, BT_V4SF, BT_V4SF, BT_UCHAR, BT_UCHAR)\n DEF_OV_TYPE (BT_OV_V4SF_V4SF_UV4SI, BT_V4SF, BT_V4SF, BT_UV4SI)\n DEF_OV_TYPE (BT_OV_V4SF_V4SF_UV4SI_FLTCONSTPTR_UCHAR, BT_V4SF, BT_V4SF, BT_UV4SI, BT_FLTCONSTPTR, BT_UCHAR)\n DEF_OV_TYPE (BT_OV_V4SF_V4SF_V4SF, BT_V4SF, BT_V4SF, BT_V4SF)"}, {"sha": "5cfe9a43de990f2bffe7f73e5d225c8abe3e288f", "filename": "gcc/config/s390/s390-builtins.def", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Fconfig%2Fs390%2Fs390-builtins.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Fconfig%2Fs390%2Fs390-builtins.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390-builtins.def?ref=ac95a65da150a120cf729d1a773af7417e263330", "patch": "@@ -2778,6 +2778,10 @@ OB_DEF     (s390_vec_ctd,               s390_vec_ctd_s64,   s390_vec_ctd_u64,\n OB_DEF_VAR (s390_vec_ctd_s64,           s390_vec_ctd_s64,   0,                  O2_U5,              BT_OV_V2DF_V2DI_INT)                     /* vcdgb */\n OB_DEF_VAR (s390_vec_ctd_u64,           s390_vec_ctd_u64,   0,                  O2_U5,              BT_OV_V2DF_UV2DI_INT)                    /* vcdlgb */\n \n+OB_DEF     (s390_vfi,                   s390_vfi_flt,       s390_vfi_dbl,       B_VX,               BT_FN_V2DF_V2DF_UINT_UINT)\n+OB_DEF_VAR (s390_vfi_flt,               s390_vfisb,         0,                  O2_U4 | O3_U3,      BT_OV_V4SF_V4SF_UCHAR_UCHAR)             /* vfisb */\n+OB_DEF_VAR (s390_vfi_dbl,               s390_vfidb,         0,                  O2_U4 | O3_U3,      BT_OV_V2DF_V2DF_UCHAR_UCHAR)             /* vfidb */\n+\n B_DEF      (s390_vec_ctd_s64,           vec_ctd_s64,        0,                  B_VX,               O2_U3,              BT_FN_V2DF_V2DI_INT)                     /* vcdgb */\n B_DEF      (s390_vec_ctd_u64,           vec_ctd_u64,        0,                  B_VX,               O2_U3,              BT_FN_V2DF_UV2DI_INT)                    /* vcdlgb */\n B_DEF      (s390_vcdgb,                 vcdgb,              0,                  B_VX,               O2_U4 | O3_U3,      BT_FN_V2DF_V2DI_INT_INT)"}, {"sha": "c7cbfa95ae468559c7fa19c88371ffa3f257b24f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ac95a65da150a120cf729d1a773af7417e263330", "patch": "@@ -1,3 +1,8 @@\n+2017-10-06  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/82322\n+\t* gcc.target/s390/zvector/pr82322.c: New test.\n+\n 2017-10-06  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \tPR target/82317"}, {"sha": "87410e7a9d901d619e362c6ac2f2ba8a35d70f26", "filename": "gcc/testsuite/gcc.target/s390/zvector/pr82322.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fzvector%2Fpr82322.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac95a65da150a120cf729d1a773af7417e263330/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fzvector%2Fpr82322.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fzvector%2Fpr82322.c?ref=ac95a65da150a120cf729d1a773af7417e263330", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do compile { target { s390*-*-* } } } */\n+/* { dg-options \"-march=z14 -mzarch -mzvector\" } */\n+\n+/* vec_ceil and friends are expanded by vecintrin.h to\n+   __builtin_s390_vfi which is an overloaded builtin being replaced by\n+   either __builtin_s390_vfisb or __builtin_s390_vfidb depending on\n+   its argument types.\n+\n+   The problem in this PR was that the overloaded builtin definition\n+   was missing in s390-builtins.def.  */\n+\n+#include <vecintrin.h>\n+\n+vector double\n+foo (vector double a) {\n+  return vec_ceil (a);\n+}\n+\n+vector float\n+bar (vector float a) {\n+  return vec_ceil (a);\n+}"}]}