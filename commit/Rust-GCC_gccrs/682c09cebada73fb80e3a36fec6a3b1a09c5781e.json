{"sha": "682c09cebada73fb80e3a36fec6a3b1a09c5781e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjgyYzA5Y2ViYWRhNzNmYjgwZTNhMzZmZWM2YTNiMWEwOWM1NzgxZQ==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2019-09-19T08:12:56Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-09-19T08:12:56Z"}, "message": "[Ada] Infinite loop with concatenation and aspect\n\nThis patch fixes a bug where an array object initialized with a\nconcatenation, and that has an aspect_specification for Alignment,\ncauses the compiler goes into an infinite loop.\n\n2019-09-19  Bob Duff  <duff@adacore.com>\n\ngcc/ada/\n\n\t* exp_ch3.adb (Rewrite_As_Renaming): Return False if there are\n\tany aspect specifications, because otherwise Insert_Actions\n\tblows up.\n\ngcc/testsuite/\n\n\t* gnat.dg/concat3.adb: New testcase.\n\nFrom-SVN: r275934", "tree": {"sha": "0f23c5e9c42004ce66fece6ad3975009a5bee5cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f23c5e9c42004ce66fece6ad3975009a5bee5cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/682c09cebada73fb80e3a36fec6a3b1a09c5781e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/682c09cebada73fb80e3a36fec6a3b1a09c5781e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/682c09cebada73fb80e3a36fec6a3b1a09c5781e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/682c09cebada73fb80e3a36fec6a3b1a09c5781e/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "348c3ae62ec5579323defd9179aa6b870e0b744b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/348c3ae62ec5579323defd9179aa6b870e0b744b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/348c3ae62ec5579323defd9179aa6b870e0b744b"}], "stats": {"total": 47, "additions": 40, "deletions": 7}, "files": [{"sha": "7d867bfd5eabf00db17a6befd7563a66b2d74935", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=682c09cebada73fb80e3a36fec6a3b1a09c5781e", "patch": "@@ -1,3 +1,9 @@\n+2019-09-19  Bob Duff  <duff@adacore.com>\n+\n+\t* exp_ch3.adb (Rewrite_As_Renaming): Return False if there are\n+\tany aspect specifications, because otherwise Insert_Actions\n+\tblows up.\n+\n 2019-09-19  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* exp_ch6.adb (Add_Simple_Call_By_Copy_Code): Add"}, {"sha": "18c6aafe294087a13a413bed0cde05e0b2cef2a5", "filename": "gcc/ada/exp_ch3.adb", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Fada%2Fexp_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Fada%2Fexp_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch3.adb?ref=682c09cebada73fb80e3a36fec6a3b1a09c5781e", "patch": "@@ -6318,7 +6318,8 @@ package body Exp_Ch3 is\n       -------------------------\n \n       function Rewrite_As_Renaming return Boolean is\n-      begin\n+         Result : constant Boolean :=\n+\n          --  If the object declaration appears in the form\n \n          --    Obj : Ctrl_Typ := Func (...);\n@@ -6336,12 +6337,12 @@ package body Exp_Ch3 is\n \n          --  This part is disabled for now, because it breaks GPS builds\n \n-         return (False -- ???\n-             and then Nkind (Expr_Q) = N_Explicit_Dereference\n-             and then not Comes_From_Source (Expr_Q)\n-             and then Nkind (Original_Node (Expr_Q)) = N_Function_Call\n-             and then Nkind (Object_Definition (N)) in N_Has_Entity\n-             and then (Needs_Finalization (Entity (Object_Definition (N)))))\n+         (False -- ???\n+            and then Nkind (Expr_Q) = N_Explicit_Dereference\n+            and then not Comes_From_Source (Expr_Q)\n+            and then Nkind (Original_Node (Expr_Q)) = N_Function_Call\n+            and then Nkind (Object_Definition (N)) in N_Has_Entity\n+            and then (Needs_Finalization (Entity (Object_Definition (N)))))\n \n            --  If the initializing expression is for a variable with attribute\n            --  OK_To_Rename set, then transform:\n@@ -6362,6 +6363,14 @@ package body Exp_Ch3 is\n                and then Ekind (Entity (Expr_Q)) = E_Variable\n                and then OK_To_Rename (Entity (Expr_Q))\n                and then Is_Entity_Name (Obj_Def));\n+      begin\n+         --  Return False if there are any aspect specifications, because\n+         --  otherwise we duplicate that corresponding implicit attribute\n+         --  definition, and call Insert_Action, which has no place to insert\n+         --  the attribute definition. The attribute definition is stored in\n+         --  Aspect_Rep_Item, which is not a list.\n+\n+         return Result and then No (Aspect_Specifications (N));\n       end Rewrite_As_Renaming;\n \n       --  Local variables"}, {"sha": "3755221c56bcae2ee940579b3011614370ab10e6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=682c09cebada73fb80e3a36fec6a3b1a09c5781e", "patch": "@@ -1,3 +1,7 @@\n+2019-09-19  Bob Duff  <duff@adacore.com>\n+\n+\t* gnat.dg/concat3.adb: New testcase.\n+\n 2019-09-19  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/pack26.adb: New testcase."}, {"sha": "b4df3fd5eed20415a8bc64416b23eb478388aa06", "filename": "gcc/testsuite/gnat.dg/concat3.adb", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Ftestsuite%2Fgnat.dg%2Fconcat3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682c09cebada73fb80e3a36fec6a3b1a09c5781e/gcc%2Ftestsuite%2Fgnat.dg%2Fconcat3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fconcat3.adb?ref=682c09cebada73fb80e3a36fec6a3b1a09c5781e", "patch": "@@ -0,0 +1,14 @@\n+--  { dg-do run }\n+--  { dg-options \"-g -O0 -gnata\" }\n+\n+procedure Concat3 is\n+   procedure Show_Bug (S : in String)\n+   is\n+      Str : constant String := S & \"-\" with Alignment => 4;\n+   begin\n+      null;\n+   end Show_Bug;\n+\n+begin\n+   Show_Bug (\"BUG\");\n+end Concat3;\n\\ No newline at end of file"}]}