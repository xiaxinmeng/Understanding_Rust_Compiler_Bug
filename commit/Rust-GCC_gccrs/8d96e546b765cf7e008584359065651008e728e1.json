{"sha": "8d96e546b765cf7e008584359065651008e728e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGQ5NmU1NDZiNzY1Y2Y3ZTAwODU4NDM1OTA2NTY1MTAwOGU3MjhlMQ==", "commit": {"author": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-04-10T07:24:59Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2018-04-10T07:24:59Z"}, "message": "Be more carefull about DECL merging in LTO (PR lto/85248).\n\n2018-04-10  Richard Biener  <rguenther@suse.de>\n\t    Martin Liska  <mliska@suse.cz>\n\n\tPR lto/85248\n\t* lto-symtab.c (lto_symtab_merge_p): Handle noreturn attribute.\n2018-04-10  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR lto/85248\n\t* gcc.dg/lto/pr85248_0.c: New test.\n\t* gcc.dg/lto/pr85248_1.c: New test.\n\nFrom-SVN: r259265", "tree": {"sha": "dbdf98e4977a4c4df3bd44bfdcb4fed00ccd3bce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dbdf98e4977a4c4df3bd44bfdcb4fed00ccd3bce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8d96e546b765cf7e008584359065651008e728e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d96e546b765cf7e008584359065651008e728e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d96e546b765cf7e008584359065651008e728e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d96e546b765cf7e008584359065651008e728e1/comments", "author": null, "committer": null, "parents": [{"sha": "c1b8f25d8090e778b330555005c81bc0c582a6b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1b8f25d8090e778b330555005c81bc0c582a6b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1b8f25d8090e778b330555005c81bc0c582a6b8"}], "stats": {"total": 82, "additions": 82, "deletions": 0}, "files": [{"sha": "2c9c7bff09a6ea1c1179c2382b347ad6cf717414", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d96e546b765cf7e008584359065651008e728e1/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d96e546b765cf7e008584359065651008e728e1/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=8d96e546b765cf7e008584359065651008e728e1", "patch": "@@ -1,3 +1,9 @@\n+2018-04-10  Richard Biener  <rguenther@suse.de>\n+\t    Martin Liska  <mliska@suse.cz>\n+\n+\tPR lto/85248\n+\t* lto-symtab.c (lto_symtab_merge_p): Handle noreturn attribute.\n+\n 2018-02-08  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto-partition.c (lto_balanced_map): Watch overflow."}, {"sha": "473c0d0b5af1071f69ad8c1eaadb48bf790b0657", "filename": "gcc/lto/lto-symtab.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d96e546b765cf7e008584359065651008e728e1/gcc%2Flto%2Flto-symtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d96e546b765cf7e008584359065651008e728e1/gcc%2Flto%2Flto-symtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-symtab.c?ref=8d96e546b765cf7e008584359065651008e728e1", "patch": "@@ -572,6 +572,9 @@ lto_symtab_merge_p (tree prevailing, tree decl)\n \t  return false;\n \t}\n     }\n+\n+  /* FIXME: after MPX is removed, use flags_from_decl_or_type\n+     function instead.  PR lto/85248.  */\n   if (DECL_ATTRIBUTES (prevailing) != DECL_ATTRIBUTES (decl))\n     {\n       tree prev_attr = lookup_attribute (\"error\", DECL_ATTRIBUTES (prevailing));\n@@ -599,6 +602,19 @@ lto_symtab_merge_p (tree prevailing, tree decl)\n \t\t     \"warning attribute mismatch\\n\");\n \t  return false;\n \t}\n+\n+      prev_attr = lookup_attribute (\"noreturn\", DECL_ATTRIBUTES (prevailing));\n+      attr = lookup_attribute (\"noreturn\", DECL_ATTRIBUTES (decl));\n+      if ((prev_attr == NULL) != (attr == NULL)\n+\t  || (prev_attr\n+\t      && TREE_VALUE (TREE_VALUE (prev_attr))\n+\t\t != TREE_VALUE (TREE_VALUE (attr))))\n+\t{\n+          if (symtab->dump_file)\n+\t    fprintf (symtab->dump_file, \"Not merging decls; \"\n+\t\t     \"noreturn attribute mismatch\\n\");\n+\t  return false;\n+\t}\n     }\n   return true;\n }"}, {"sha": "de04c8bc6b81d7523cf06cb927f5b593b3a06057", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d96e546b765cf7e008584359065651008e728e1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d96e546b765cf7e008584359065651008e728e1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8d96e546b765cf7e008584359065651008e728e1", "patch": "@@ -1,3 +1,9 @@\n+2018-04-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR lto/85248\n+\t* gcc.dg/lto/pr85248_0.c: New test.\n+\t* gcc.dg/lto/pr85248_1.c: New test.\n+\n 2018-04-09  Jan Hubicka  <jh@suse.cz>\n \n \tPR lto/85078"}, {"sha": "df61ac976a554c8b8f10f470fbd7ecc91cec7125", "filename": "gcc/testsuite/gcc.dg/lto/pr85248_0.c", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d96e546b765cf7e008584359065651008e728e1/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr85248_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d96e546b765cf7e008584359065651008e728e1/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr85248_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr85248_0.c?ref=8d96e546b765cf7e008584359065651008e728e1", "patch": "@@ -0,0 +1,45 @@\n+/* PR lto/85248 */\n+/* { dg-lto-do run } */\n+/* { dg-lto-options { { -flto -O2 } } } */\n+\n+extern void test_alias (int s, int e) __asm__ (__USER_LABEL_PREFIX__ \"test\");\n+extern void test_noreturn (int s, int e) __asm__ (__USER_LABEL_PREFIX__ \"test\")\n+  __attribute__ ((__noreturn__));\n+\n+extern inline __attribute__ ((__always_inline__, __gnu_inline__)) void\n+test (int s, int e)\n+{\n+  if (__builtin_constant_p (s) && s != 0)\n+    test_noreturn (s, e);\n+  else\n+    test_alias (s, e);\n+}\n+\n+int\n+foo (void)\n+{\n+  static volatile int a;\n+  return a;\n+}\n+\n+static void\n+bar (void)\n+{\n+  test (0, 1);\n+  __builtin_exit (0);\n+}\n+\n+static void\n+baz ()\n+{\n+  test (1, 0);\n+}\n+\n+int\n+main ()\n+{\n+  if (foo ())\n+    baz ();\n+  bar ();\n+  __builtin_abort ();\n+}"}, {"sha": "418c069702814739b9212d0b4fdfc9c94c403bd3", "filename": "gcc/testsuite/gcc.dg/lto/pr85248_1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d96e546b765cf7e008584359065651008e728e1/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr85248_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d96e546b765cf7e008584359065651008e728e1/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr85248_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Fpr85248_1.c?ref=8d96e546b765cf7e008584359065651008e728e1", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-options \"-fno-lto\" } */\n+\n+__attribute__((__noipa__)) void\n+test (int s, int e)\n+{\n+  asm volatile (\"\" : \"+g\" (s), \"+g\" (e) : : \"memory\");\n+  if (s)\n+    __builtin_abort ();\n+}"}]}