{"sha": "66146c90f61f644970f9037f89f56cfcad7bce8c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjYxNDZjOTBmNjFmNjQ0OTcwZjkwMzdmODlmNTZjZmNhZDdiY2U4Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-11-14T00:02:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-11-14T00:02:35Z"}, "message": "re PR tree-optimization/87898 (ICE in separate_decls_in_region_debug, at tree-parloops.c:961)\n\n\tPR tree-optimization/87898\n\t* omp-simd-clone.c (ipa_simd_modify_stmt_ops): Formatting fix.\n\t(ipa_simd_modify_function_body): Remove debug stmts where the first\n\targument was changed into a non-decl.\n\n\t* gcc.dg/gomp/pr87898.c: New test.\n\nFrom-SVN: r266093", "tree": {"sha": "c32a467cad3d745d91235c17569cf0bd098b6375", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c32a467cad3d745d91235c17569cf0bd098b6375"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66146c90f61f644970f9037f89f56cfcad7bce8c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66146c90f61f644970f9037f89f56cfcad7bce8c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66146c90f61f644970f9037f89f56cfcad7bce8c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66146c90f61f644970f9037f89f56cfcad7bce8c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b76a1b3604f8e645402a68c3352e1bc360a5b8f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b76a1b3604f8e645402a68c3352e1bc360a5b8f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b76a1b3604f8e645402a68c3352e1bc360a5b8f9"}], "stats": {"total": 44, "additions": 39, "deletions": 5}, "files": [{"sha": "fa13fdd0a718781f33864b9b37c584d1a144d91a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=66146c90f61f644970f9037f89f56cfcad7bce8c", "patch": "@@ -1,3 +1,10 @@\n+2018-11-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/87898\n+\t* omp-simd-clone.c (ipa_simd_modify_stmt_ops): Formatting fix.\n+\t(ipa_simd_modify_function_body): Remove debug stmts where the first\n+\targument was changed into a non-decl.\n+\n 2018-11-13  Peter Bergner  <bergner@linux.ibm.com>\n \n \tPR rtl-optimization/87899"}, {"sha": "7aa362a5e70e1ff151e6c69ebdb14fbaa05ea042", "filename": "gcc/omp-simd-clone.c", "status": "modified", "additions": 17, "deletions": 5, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2Fomp-simd-clone.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2Fomp-simd-clone.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-simd-clone.c?ref=66146c90f61f644970f9037f89f56cfcad7bce8c", "patch": "@@ -834,11 +834,8 @@ ipa_simd_modify_stmt_ops (tree *tp, int *walk_subtrees, void *data)\n   struct ipa_parm_adjustment *cand = NULL;\n   if (TREE_CODE (*tp) == PARM_DECL)\n     cand = ipa_get_adjustment_candidate (&tp, NULL, info->adjustments, true);\n-  else\n-    {\n-      if (TYPE_P (*tp))\n-\t*walk_subtrees = 0;\n-    }\n+  else if (TYPE_P (*tp))\n+    *walk_subtrees = 0;\n \n   tree repl = NULL_TREE;\n   if (cand)\n@@ -1014,6 +1011,21 @@ ipa_simd_modify_function_body (struct cgraph_node *node,\n \t  if (info.modified)\n \t    {\n \t      update_stmt (stmt);\n+\t      /* If the above changed the var of a debug bind into something\n+\t\t different, remove the debug stmt.  We could also for all the\n+\t\t replaced parameters add VAR_DECLs for debug info purposes,\n+\t\t add debug stmts for those to be the simd array accesses and\n+\t\t replace debug stmt var operand with that var.  Debugging of\n+\t\t vectorized loops doesn't work too well, so don't bother for\n+\t\t now.  */\n+\t      if ((gimple_debug_bind_p (stmt)\n+\t\t   && !DECL_P (gimple_debug_bind_get_var (stmt)))\n+\t\t  || (gimple_debug_source_bind_p (stmt)\n+\t\t      && !DECL_P (gimple_debug_source_bind_get_var (stmt))))\n+\t\t{\n+\t\t  gsi_remove (&gsi, true);\n+\t\t  continue;\n+\t\t}\n \t      if (maybe_clean_eh_stmt (stmt))\n \t\tgimple_purge_dead_eh_edges (gimple_bb (stmt));\n \t    }"}, {"sha": "be7cf2880caa22539e5f2349a2b613b358aebf5e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=66146c90f61f644970f9037f89f56cfcad7bce8c", "patch": "@@ -1,3 +1,8 @@\n+2018-11-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/87898\n+\t* gcc.dg/gomp/pr87898.c: New test.\n+\n 2018-11-13  David Malcolm  <dmalcolm@redhat.com>\n \n \t* g++.dg/plugin/comment_plugin.c: Replace \"source_location\" with"}, {"sha": "ba42c64abf31ea9bfb74d96083c6c219c19d87ba", "filename": "gcc/testsuite/gcc.dg/gomp/pr87898.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr87898.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66146c90f61f644970f9037f89f56cfcad7bce8c/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr87898.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fpr87898.c?ref=66146c90f61f644970f9037f89f56cfcad7bce8c", "patch": "@@ -0,0 +1,10 @@\n+/* PR tree-optimization/87898 */\n+/* { dg-do compile { target fgraphite } } */\n+/* { dg-options \"-O1 -floop-parallelize-all -fopenmp -ftree-parallelize-loops=2 -g\" } */\n+\n+#pragma omp declare simd\n+void\n+foo (int x)\n+{\n+  x = 0;\n+}"}]}