{"sha": "425ea30f79e236c187430749be994309968e1dbd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDI1ZWEzMGY3OWUyMzZjMTg3NDMwNzQ5YmU5OTQzMDk5NjhlMWRiZA==", "commit": {"author": {"name": "Dragan Mladjenovic", "email": "dmladjenovic@wavecomp.com", "date": "2019-11-13T18:50:15Z"}, "committer": {"name": "Dragan Mladjenovic", "email": "draganm@gcc.gnu.org", "date": "2019-11-13T18:50:15Z"}, "message": "Sanitize the constant argument for rotr<mode>3\n\nThis was dormant for quite some time, but it started happening for me\non gcc.c-torture/compile/pr65153.c sometime after r276645 for -mabi=32 linux runs.\n\nThe pattern accepts any SMALL_OPERAND constant value while it asserts during the final\nthat the value is in the mode size range. I this case it happens that combine_and_move_insns\nduring ira makes a pattern with negative \"shift count\" which fails at final stage.\n\nThis simple fix just truncates the constant operand to mode size the same as shift patterns.\n\ngcc/ChangeLog:\n\n2019-11-13  Dragan Mladjenovic  <dmladjenovic@wavecomp.com>\n\n\t* config/mips/mips.md (rotr<mode>3): Sanitize the constant argument\n\tinstead of asserting its value.\n\nFrom-SVN: r278152", "tree": {"sha": "4d56ead1d6f5b07f81c6db7fee6f5fa748c998b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d56ead1d6f5b07f81c6db7fee6f5fa748c998b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/425ea30f79e236c187430749be994309968e1dbd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/425ea30f79e236c187430749be994309968e1dbd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/425ea30f79e236c187430749be994309968e1dbd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/425ea30f79e236c187430749be994309968e1dbd/comments", "author": null, "committer": null, "parents": [{"sha": "d51dd316a2dde3df062bd16b41567350adc3427e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d51dd316a2dde3df062bd16b41567350adc3427e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d51dd316a2dde3df062bd16b41567350adc3427e"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "3ffe1d7347f9d66d831241b856eae7c11b257269", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/425ea30f79e236c187430749be994309968e1dbd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/425ea30f79e236c187430749be994309968e1dbd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=425ea30f79e236c187430749be994309968e1dbd", "patch": "@@ -1,3 +1,8 @@\n+2019-11-13  Dragan Mladjenovic  <dmladjenovic@wavecomp.com>\n+\n+\t* config/mips/mips.md (rotr<mode>3): Sanitize the constant argument\n+\tinstead of asserting its value.\n+\n 2019-11-13  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* gimple-fold.c (size_must_be_zero_p): Rewrite use of value_range"}, {"sha": "4de97318e67fe6679d64a44f4407d73a75c8ee99", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/425ea30f79e236c187430749be994309968e1dbd/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/425ea30f79e236c187430749be994309968e1dbd/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=425ea30f79e236c187430749be994309968e1dbd", "patch": "@@ -5845,8 +5845,8 @@\n   \"ISA_HAS_ROR\"\n {\n   if (CONST_INT_P (operands[2]))\n-    gcc_assert (INTVAL (operands[2]) >= 0\n-\t\t&& INTVAL (operands[2]) < GET_MODE_BITSIZE (<MODE>mode));\n+    operands[2] = GEN_INT (INTVAL (operands[2])\n+                           & (GET_MODE_BITSIZE (<MODE>mode) - 1));\n \n   return \"<d>ror\\t%0,%1,%2\";\n }"}]}