{"sha": "57ac2606c472c30be27975f137f36b81d0824af8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTdhYzI2MDZjNDcyYzMwYmUyNzk3NWYxMzdmMzZiODFkMDgyNGFmOA==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2011-11-22T18:37:16Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2011-11-22T18:37:16Z"}, "message": "opts.c (finish_options): Do not fail for -fgnu-tm.\n\n        * opts.c (finish_options): Do not fail for -fgnu-tm.\n        * gimple-streamer-out.c (output_gimple_stmt): Handle GIMPLE_TRANSACTION.\n        * gimple-streamer-in.c (input_gimple_stmt): Same.\n        * lto-cgraph.c (input_overwrite_node): Read tm_clone bit.\n        (lto_output_node): Write tm_clone bit.\nlto/\n        * lto-lang.c (lto_attribute_table): Handle transaction_pure.\n        (handle_transaction_pure_attribute): New.\n\nFrom-SVN: r181629", "tree": {"sha": "d9c627efeb62217e0942238cce58b0177ffc0e93", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d9c627efeb62217e0942238cce58b0177ffc0e93"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57ac2606c472c30be27975f137f36b81d0824af8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57ac2606c472c30be27975f137f36b81d0824af8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57ac2606c472c30be27975f137f36b81d0824af8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57ac2606c472c30be27975f137f36b81d0824af8/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "73cd7644a7873b52c4a5fd81e20ec05fbfee8274", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73cd7644a7873b52c4a5fd81e20ec05fbfee8274", "html_url": "https://github.com/Rust-GCC/gccrs/commit/73cd7644a7873b52c4a5fd81e20ec05fbfee8274"}], "stats": {"total": 84, "additions": 82, "deletions": 2}, "files": [{"sha": "ba48cc1f2cb9f8f44f077aac24497ac3ab6f2bd8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -1,3 +1,11 @@\n+2011-11-21  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\t* opts.c (finish_options): Do not fail for -fgnu-tm.\n+\t* gimple-streamer-out.c (output_gimple_stmt): Handle GIMPLE_TRANSACTION.\n+\t* gimple-streamer-in.c (input_gimple_stmt): Same.\n+\t* lto-cgraph.c (input_overwrite_node): Read tm_clone bit.\n+\t(lto_output_node): Write tm_clone bit.\n+\n 2011-11-22  Ian Lance Taylor  <iant@google.com>\n \n \t* doc/install.texi (Configuration): Correct doc of"}, {"sha": "1facb3296f6e74c1279cba2f42a56884f6ee45dd", "filename": "gcc/gimple-streamer-in.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Fgimple-streamer-in.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Fgimple-streamer-in.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-streamer-in.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -238,6 +238,10 @@ input_gimple_stmt (struct lto_input_block *ib, struct data_in *data_in,\n     case GIMPLE_PREDICT:\n       break;\n \n+    case GIMPLE_TRANSACTION:\n+      gimple_transaction_set_label (stmt, stream_read_tree (ib, data_in));\n+      break;\n+\n     default:\n       internal_error (\"bytecode stream: unknown GIMPLE statement tag %s\",\n \t\t      lto_tag_name (tag));"}, {"sha": "a7e73fa8db25f9e32fc017e8f0cf05f3235779f4", "filename": "gcc/gimple-streamer-out.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Fgimple-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Fgimple-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-streamer-out.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -151,6 +151,11 @@ output_gimple_stmt (struct output_block *ob, gimple stmt)\n     case GIMPLE_PREDICT:\n       break;\n \n+    case GIMPLE_TRANSACTION:\n+      gcc_assert (gimple_transaction_body (stmt) == NULL);\n+      stream_write_tree (ob, gimple_transaction_label (stmt), true);\n+      break;\n+\n     default:\n       gcc_unreachable ();\n     }"}, {"sha": "44a204977c0357100bcc0f6b3c241d8ac3360f1e", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -522,6 +522,7 @@ lto_output_node (struct lto_simple_output_block *ob, struct cgraph_node *node,\n   bp_pack_value (&bp, node->frequency, 2);\n   bp_pack_value (&bp, node->only_called_at_startup, 1);\n   bp_pack_value (&bp, node->only_called_at_exit, 1);\n+  bp_pack_value (&bp, node->tm_clone, 1);\n   bp_pack_value (&bp, node->thunk.thunk_p && !boundary_p, 1);\n   bp_pack_enum (&bp, ld_plugin_symbol_resolution,\n \t        LDPR_NUM_KNOWN, node->resolution);\n@@ -928,6 +929,7 @@ input_overwrite_node (struct lto_file_decl_data *file_data,\n   node->frequency = (enum node_frequency)bp_unpack_value (bp, 2);\n   node->only_called_at_startup = bp_unpack_value (bp, 1);\n   node->only_called_at_exit = bp_unpack_value (bp, 1);\n+  node->tm_clone = bp_unpack_value (bp, 1);\n   node->thunk.thunk_p = bp_unpack_value (bp, 1);\n   node->resolution = bp_unpack_enum (bp, ld_plugin_symbol_resolution,\n \t\t\t\t     LDPR_NUM_KNOWN);"}, {"sha": "af849540ea8972ba777634a417025eb8dc25ccec", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -1,3 +1,8 @@\n+2011-11-21  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\t* lto-lang.c (lto_attribute_table): Handle transaction_pure.\n+\t(handle_transaction_pure_attribute): New.\n+\n 2011-11-03  Richard Guenther  <rguenther@suse.de>\n \n \tPR lto/44965"}, {"sha": "2536f26ebf07283f9e9246042d12f03710b3c3ac", "filename": "gcc/lto/lto-lang.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Flto%2Flto-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Flto%2Flto-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-lang.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -46,6 +46,7 @@ static tree handle_nonnull_attribute (tree *, tree, tree, int, bool *);\n static tree handle_nothrow_attribute (tree *, tree, tree, int, bool *);\n static tree handle_sentinel_attribute (tree *, tree, tree, int, bool *);\n static tree handle_type_generic_attribute (tree *, tree, tree, int, bool *);\n+static tree handle_transaction_pure_attribute (tree *, tree, tree, int, bool *);\n static tree handle_format_attribute (tree *, tree, tree, int, bool *);\n static tree handle_format_arg_attribute (tree *, tree, tree, int, bool *);\n \n@@ -75,6 +76,8 @@ const struct attribute_spec lto_attribute_table[] =\n \t\t\t      handle_sentinel_attribute, false },\n   { \"type generic\",           0, 0, false, true, true,\n \t\t\t      handle_type_generic_attribute, false },\n+  { \"transaction_pure\",\t      0, 0, false, true, true,\n+\t\t\t      handle_transaction_pure_attribute, false },\n   { NULL,                     0, 0, false, false, false, NULL, false }\n };\n \n@@ -402,6 +405,20 @@ handle_type_generic_attribute (tree *node, tree ARG_UNUSED (name),\n   return NULL_TREE;\n }\n \n+/* Handle a \"transaction_pure\" attribute.  */\n+\n+static tree\n+handle_transaction_pure_attribute (tree *node, tree ARG_UNUSED (name),\n+\t\t\t\t   tree ARG_UNUSED (args),\n+\t\t\t\t   int ARG_UNUSED (flags),\n+\t\t\t\t   bool * ARG_UNUSED (no_add_attrs))\n+{\n+  /* Ensure we have a function type.  */\n+  gcc_assert (TREE_CODE (*node) == FUNCTION_TYPE);\n+\n+  return NULL_TREE;\n+}\n+\n /* Handle a \"format\" attribute; arguments as in\n    struct attribute_spec.handler.  */\n "}, {"sha": "3153fe5027494619e8d1afbd3a3731c47675dda2", "filename": "gcc/opts.c", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Fopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Fopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -784,8 +784,6 @@ finish_options (struct gcc_options *opts, struct gcc_options *opts_set,\n #endif\n       if (!opts->x_flag_fat_lto_objects && !HAVE_LTO_PLUGIN)\n         error_at (loc, \"-fno-fat-lto-objects are supported only with linker plugin.\");\n-      if (opts->x_flag_tm)\n-\terror_at (loc, \"LTO is currently not supported with transactional memory\");\n }\n   if ((opts->x_flag_lto_partition_balanced != 0) + (opts->x_flag_lto_partition_1to1 != 0)\n        + (opts->x_flag_lto_partition_none != 0) >= 1)"}, {"sha": "aedf06379ce393da020fc53f098d8545eb3b06ed", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-1_0.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_0.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-lto-options {{-flto -fgnu-tm}} } */\n+\n+int i;\n+\n+main()\n+{\n+  __transaction_atomic\n+    {\n+      i = 0;\n+    }\n+}"}, {"sha": "948effacc4d091cd8a0161a8acdf3aa43b00ae4b", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-1_1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-1_1.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -0,0 +1,7 @@\n+#define dummy(func) \\\n+  __attribute__((noinline,noclone,used)) void func() { asm (\"\"); }\n+\n+dummy(_ITM_beginTransaction)\n+dummy(_ITM_commitTransaction)\n+dummy(_ITM_WU4)\n+dummy(_ITM_WU8)"}, {"sha": "f7e8d04bf7e16beceae184502c33c94d0b7503f0", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-2_0.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_0.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-lto-options {{-flto -fgnu-tm}} } */\n+\n+extern void foobar() __attribute__((transaction_callable));\n+\n+#define dummy(func) \\\n+  __attribute__((noinline,noclone,used)) void func() { asm (\"\"); }\n+\n+dummy(_ITM_beginTransaction)\n+dummy(_ITM_commitTransaction)\n+dummy(_ITM_WU4)\n+dummy(_ITM_WU8)\n+\n+main()\n+{\n+  __transaction_relaxed\n+    {\n+      foobar();\n+    }\n+}"}, {"sha": "fb6918d6584a4d29103dc5796f729491dc2934b8", "filename": "gcc/testsuite/gcc.dg/lto/trans-mem-2_1.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57ac2606c472c30be27975f137f36b81d0824af8/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Flto%2Ftrans-mem-2_1.c?ref=57ac2606c472c30be27975f137f36b81d0824af8", "patch": "@@ -0,0 +1,4 @@\n+__attribute__((transaction_callable,noinline))\n+void foobar() \n+{\n+}"}]}