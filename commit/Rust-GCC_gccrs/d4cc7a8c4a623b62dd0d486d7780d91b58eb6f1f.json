{"sha": "d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f", "node_id": "C_kwDOANBUbNoAKGQ0Y2M3YThjNGE2MjNiNjJkZDBkNDg2ZDc3ODBkOTFiNThlYjZmMWY", "commit": {"author": {"name": "Alexander Monakov", "email": "amonakov@ispras.ru", "date": "2022-11-01T14:53:13Z"}, "committer": {"name": "Alexander Monakov", "email": "amonakov@ispras.ru", "date": "2022-11-16T13:41:39Z"}, "message": "i386: correct x87&SSE multiplication modeling in znver.md\n\nAll multiplication instructions are fully pipelined, except AVX256\ninstructions on Zen 1, which issue over two cycles on a 128-bit unit.\nCorrect the model accordingly to reduce combinatorial explosion in\nautomaton tables.\n\nTop znver table sizes in insn-automata.o:\n\nBefore:\n\n30056 r znver1_fp_min_issue_delay\n120224 r znver1_fp_transitions\n\nAfter:\n\n6720 r znver1_fp_min_issue_delay\n53760 r znver1_fp_transitions\n\ngcc/ChangeLog:\n\n\tPR target/87832\n\t* config/i386/znver.md: (znver1_fp_op_mul): Correct cycles in\n\tthe reservation.\n\t(znver1_fp_op_mul_load): Ditto.\n\t(znver1_mmx_mul): Ditto.\n\t(znver1_mmx_load): Ditto.\n\t(znver1_ssemul_ss_ps): Ditto.\n\t(znver1_ssemul_ss_ps_load): Ditto.\n\t(znver1_ssemul_avx256_ps): Ditto.\n\t(znver1_ssemul_avx256_ps_load): Ditto.\n\t(znver1_ssemul_sd_pd): Ditto.\n\t(znver1_ssemul_sd_pd_load): Ditto.\n\t(znver2_ssemul_sd_pd): Ditto.\n\t(znver2_ssemul_sd_pd_load): Ditto.\n\t(znver1_ssemul_avx256_pd): Ditto.\n\t(znver1_ssemul_avx256_pd_load): Ditto.\n\t(znver1_sseimul): Ditto.\n\t(znver1_sseimul_avx256): Ditto.\n\t(znver1_sseimul_load): Ditto.\n\t(znver1_sseimul_avx256_load): Ditto.\n\t(znver1_sseimul_di): Ditto.\n\t(znver1_sseimul_load_di): Ditto.", "tree": {"sha": "98e6fc048db7a67a48e9ebcebb01a4abf2cb5169", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/98e6fc048db7a67a48e9ebcebb01a4abf2cb5169"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f/comments", "author": {"login": "amonakov", "id": 1997391, "node_id": "MDQ6VXNlcjE5OTczOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1997391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amonakov", "html_url": "https://github.com/amonakov", "followers_url": "https://api.github.com/users/amonakov/followers", "following_url": "https://api.github.com/users/amonakov/following{/other_user}", "gists_url": "https://api.github.com/users/amonakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/amonakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amonakov/subscriptions", "organizations_url": "https://api.github.com/users/amonakov/orgs", "repos_url": "https://api.github.com/users/amonakov/repos", "events_url": "https://api.github.com/users/amonakov/events{/privacy}", "received_events_url": "https://api.github.com/users/amonakov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "amonakov", "id": 1997391, "node_id": "MDQ6VXNlcjE5OTczOTE=", "avatar_url": "https://avatars.githubusercontent.com/u/1997391?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amonakov", "html_url": "https://github.com/amonakov", "followers_url": "https://api.github.com/users/amonakov/followers", "following_url": "https://api.github.com/users/amonakov/following{/other_user}", "gists_url": "https://api.github.com/users/amonakov/gists{/gist_id}", "starred_url": "https://api.github.com/users/amonakov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amonakov/subscriptions", "organizations_url": "https://api.github.com/users/amonakov/orgs", "repos_url": "https://api.github.com/users/amonakov/repos", "events_url": "https://api.github.com/users/amonakov/events{/privacy}", "received_events_url": "https://api.github.com/users/amonakov/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dd744f06c9952f92738b0860630085f0f0b99574", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd744f06c9952f92738b0860630085f0f0b99574", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd744f06c9952f92738b0860630085f0f0b99574"}], "stats": {"total": 40, "additions": 20, "deletions": 20}, "files": [{"sha": "882f250f1b623d9490a2ad38e52d8c616457c380", "filename": "gcc/config/i386/znver.md", "status": "modified", "additions": 20, "deletions": 20, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f/gcc%2Fconfig%2Fi386%2Fznver.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f/gcc%2Fconfig%2Fi386%2Fznver.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fznver.md?ref=d4cc7a8c4a623b62dd0d486d7780d91b58eb6f1f", "patch": "@@ -573,13 +573,13 @@\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n-\t\t\t \"znver1-direct,znver1-fp0*5\")\n+\t\t\t \"znver1-direct,znver1-fp0\")\n \n (define_insn_reservation \"znver1_fp_op_mul_load\" 12 \n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"fop,fmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"znver1-direct,znver1-load,znver1-fp0*5\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0\")\n \n (define_insn_reservation \"znver1_fp_op_imul_load\" 16\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n@@ -684,13 +684,13 @@\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n-\t\t\t  \"znver1-direct,znver1-fp0*3\")\n+\t\t\t  \"znver1-direct,znver1-fp0\")\n \n (define_insn_reservation \"znver1_mmx_load\" 10\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"mmxmul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"znver1-direct,znver1-load,znver1-fp0*3\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0\")\n \n ;; TODO\n (define_insn_reservation \"znver1_avx256_log\" 1\n@@ -1161,7 +1161,7 @@\n \t\t\t\t\t      (eq_attr \"mode\" \"V8SF,V4SF,SF,V4DF,V2DF,DF\")))\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n-\t\t\t \"znver1-direct,(znver1-fp0|znver1-fp1)*3\")\n+\t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n \n (define_insn_reservation \"znver1_ssemul_ss_ps_load\" 10 \n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n@@ -1172,62 +1172,62 @@\n \t\t\t\t\t      (eq_attr \"mode\" \"V8SF,V4SF,SF\")))\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"znver1-direct,znver1-load,(znver1-fp0|znver1-fp1)*3\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp1\")\n \n (define_insn_reservation \"znver1_ssemul_avx256_ps\" 3\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n-\t\t\t \"znver1-double,(znver1-fp0|znver1-fp1)*3\")\n+\t\t\t \"znver1-double,znver1-fp0*2|znver1-fp1*2\")\n \n (define_insn_reservation \"znver1_ssemul_avx256_ps_load\" 10\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V8SF\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"znver1-double,znver1-load,(znver1-fp0|znver1-fp1)*3\")\n+\t\t\t \"znver1-double,znver1-load,znver1-fp0*2|znver1-fp1*2\")\n \n (define_insn_reservation \"znver1_ssemul_sd_pd\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V2DF,DF\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n-\t\t\t \"znver1-direct,(znver1-fp0|znver1-fp1)*4\")\n+\t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n \n (define_insn_reservation \"znver1_ssemul_sd_pd_load\" 11\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V2DF,DF\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"znver1-direct,znver1-load,(znver1-fp0|znver1-fp1)*4\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp1\")\n \n (define_insn_reservation \"znver2_ssemul_sd_pd\" 3\n \t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n-\t\t\t \"znver1-direct,(znver1-fp0|znver1-fp1)*3\")\n+\t\t\t \"znver1-direct,znver1-fp0|znver1-fp1\")\n \n (define_insn_reservation \"znver2_ssemul_sd_pd_load\" 10\n \t\t\t (and (eq_attr \"cpu\" \"znver2,znver3\")\n \t\t\t      (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"znver1-direct,znver1-load,(znver1-fp0|znver1-fp1)*3\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0|znver1-fp1\")\n \n \n (define_insn_reservation \"znver1_ssemul_avx256_pd\" 5\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V4DF\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n-\t\t\t \"znver1-double,(znver1-fp0|znver1-fp1)*4\")\n+\t\t\t \"znver1-double,znver1-fp0*2|znver1-fp1*2\")\n \n (define_insn_reservation \"znver1_ssemul_avx256_pd_load\" 12\n \t\t\t (and (eq_attr \"cpu\" \"znver1\")\n \t\t\t      (and (eq_attr \"mode\" \"V4DF\")\n \t\t\t\t   (and (eq_attr \"type\" \"ssemul\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"znver1-double,znver1-load,(znver1-fp0|znver1-fp1)*4\")\n+\t\t\t \"znver1-double,znver1-load,znver1-fp0*2|znver1-fp1*2\")\n \n ;;SSE imul\n (define_insn_reservation \"znver1_sseimul\" 3\n@@ -1239,14 +1239,14 @@\n \t\t\t\t\t      (eq_attr \"mode\" \"TI,OI\")))\n \t\t\t      (and (eq_attr \"type\" \"sseimul\")\n \t\t\t\t   (eq_attr \"memory\" \"none\")))\n-\t\t\t \"znver1-direct,znver1-fp0*3\")\n+\t\t\t \"znver1-direct,znver1-fp0\")\n \n (define_insn_reservation \"znver1_sseimul_avx256\" 4\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"mode\" \"OI\")\n \t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n \t\t\t\t\t(eq_attr \"memory\" \"none\"))))\n-\t\t\t \"znver1-double,znver1-fp0*4\")\n+\t\t\t \"znver1-double,znver1-fp0*2\")\n \n (define_insn_reservation \"znver1_sseimul_load\" 10\n \t\t\t (and (ior (and (eq_attr \"cpu\" \"znver1\")\n@@ -1257,28 +1257,28 @@\n \t\t\t                (eq_attr \"mode\" \"TI,OI\")))\n \t\t\t      (and (eq_attr \"type\" \"sseimul\")\n \t\t\t\t   (eq_attr \"memory\" \"load\")))\n-\t\t\t \"znver1-direct,znver1-load,znver1-fp0*3\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0\")\n \n (define_insn_reservation \"znver1_sseimul_avx256_load\" 11\n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"mode\" \"OI\")\n \t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"znver1-double,znver1-load,znver1-fp0*4\")\n+\t\t\t \"znver1-double,znver1-load,znver1-fp0*2\")\n \n (define_insn_reservation \"znver1_sseimul_di\" 3 \n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"mode\" \"DI\")\n \t\t\t\t   (and (eq_attr \"memory\" \"none\")\n \t\t\t\t\t(eq_attr \"type\" \"sseimul\"))))\n-\t\t\t \"znver1-direct,znver1-fp0*3\")\n+\t\t\t \"znver1-direct,znver1-fp0\")\n \n (define_insn_reservation \"znver1_sseimul_load_di\" 10 \n \t\t\t (and (eq_attr \"cpu\" \"znver1,znver2,znver3\")\n \t\t\t      (and (eq_attr \"mode\" \"DI\")\n \t\t\t\t   (and (eq_attr \"type\" \"sseimul\")\n \t\t\t\t\t(eq_attr \"memory\" \"load\"))))\n-\t\t\t \"znver1-direct,znver1-load,znver1-fp0*3\")\n+\t\t\t \"znver1-direct,znver1-load,znver1-fp0\")\n \n ;; SSE compares\n (define_insn_reservation \"znver1_sse_cmp\" 1"}]}