{"sha": "8d06c80914d7374d16887b0e817eadb41d898aa8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGQwNmM4MDkxNGQ3Mzc0ZDE2ODg3YjBlODE3ZWFkYjQxZDg5OGFhOA==", "commit": {"author": {"name": "James A. Morrison", "email": "phython@gcc.gnu.org", "date": "2005-03-04T02:48:30Z"}, "committer": {"name": "James A. Morrison", "email": "phython@gcc.gnu.org", "date": "2005-03-04T02:48:30Z"}, "message": "re PR tree-optimization/15784 (fold misses binary optimization)\n\n2005-03-03  James A. Morrison  <phython@gcc.gnu.org>\n\n        PR tree-optimization/15784\n        * fold-const.c (fold): Fold ~A + 1 to -1.  Fold -A - 1\n        and -1 - A to ~A.\n\nFrom-SVN: r95870", "tree": {"sha": "c908d67b93dc9a831686bb43afc3806aef6fd260", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c908d67b93dc9a831686bb43afc3806aef6fd260"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8d06c80914d7374d16887b0e817eadb41d898aa8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d06c80914d7374d16887b0e817eadb41d898aa8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d06c80914d7374d16887b0e817eadb41d898aa8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d06c80914d7374d16887b0e817eadb41d898aa8/comments", "author": null, "committer": null, "parents": [{"sha": "3159b178b0479e9c8998982c112f486d5d28ab53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3159b178b0479e9c8998982c112f486d5d28ab53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3159b178b0479e9c8998982c112f486d5d28ab53"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "19b45f231d913ba7c7ecfbb75e8b1a7dbdcdd960", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8d06c80914d7374d16887b0e817eadb41d898aa8", "patch": "@@ -1,3 +1,9 @@\n+2005-03-03  James A. Morrison  <phython@gcc.gnu.org>\n+\n+\tPR tree-optimization/15784\n+\t* fold-const.c (fold): Fold ~A + 1 to -1.  Fold -A - 1\n+\tand -1 - A to ~A.\n+\n 2005-03-03  David Edelsohn  <edelsohn@gnu.org>\n \n \t* config/rs6000/predicates.md (branch_comparison_operator):"}, {"sha": "2c6d71ec030880e5a12e9230370206b0135b9720", "filename": "gcc/fold-const.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=8d06c80914d7374d16887b0e817eadb41d898aa8", "patch": "@@ -7223,6 +7223,11 @@ fold (tree expr)\n       if (TREE_CODE (arg0) == NEGATE_EXPR\n \t  && reorder_operands_p (TREE_OPERAND (arg0, 0), arg1))\n \treturn fold (build2 (MINUS_EXPR, type, arg1, TREE_OPERAND (arg0, 0)));\n+      /* Convert ~A + 1 to -A.  */\n+      if (INTEGRAL_TYPE_P (type)\n+\t  && TREE_CODE (arg0) == BIT_NOT_EXPR\n+\t  && integer_onep (arg1))\n+\treturn fold (build1 (NEGATE_EXPR, type, TREE_OPERAND (arg0, 0)));\n \n       if (TREE_CODE (type) == COMPLEX_TYPE)\n \t{\n@@ -7661,6 +7666,16 @@ fold (tree expr)\n \t  && reorder_operands_p (arg0, arg1))\n \treturn fold (build2 (MINUS_EXPR, type, negate_expr (arg1),\n \t\t\t     TREE_OPERAND (arg0, 0)));\n+      /* Convert -A - 1 to ~A.  */\n+      if (INTEGRAL_TYPE_P (type)\n+\t  && TREE_CODE (arg0) == NEGATE_EXPR\n+\t  && integer_onep (arg1))\n+\treturn fold (build1 (BIT_NOT_EXPR, type, TREE_OPERAND (arg0, 0)));\n+\n+      /* Convert -1 - A to ~A.  */\n+      if (INTEGRAL_TYPE_P (type)\n+\t  && integer_all_onesp (arg0))\n+\treturn fold (build1 (BIT_NOT_EXPR, type, arg1));\n \n       if (TREE_CODE (type) == COMPLEX_TYPE)\n \t{"}, {"sha": "b7a3692e6a25f469ef4dc4275a223c1cd4e9a4ab", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8d06c80914d7374d16887b0e817eadb41d898aa8", "patch": "@@ -1,3 +1,7 @@\n+2005-03-03  James A. Morrison  <phython@gcc.gnu.org>\n+\n+\t* gcc.dg/pr15784-4.c: New test.\n+\n 2005-03-03  Geoffrey Keating  <geoffk@apple.com>\n \n \t* gcc.c-torture/execute/pr17133.c: New."}, {"sha": "021b6375efcddf9a6321c50b31ae5763d1cec6ae", "filename": "gcc/testsuite/gcc.dg/pr15784-4.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr15784-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d06c80914d7374d16887b0e817eadb41d898aa8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr15784-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr15784-4.c?ref=8d06c80914d7374d16887b0e817eadb41d898aa8", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+int a (int x) {\n+\treturn ~x + 1; /* -x */\n+}\n+\n+int b (int x) {\n+\treturn -x -1; /* ~x */\n+}\n+\n+/* { dg-final { scan-tree-dump \"~x;\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump \"-x;\" \"optimized\" } } */"}]}