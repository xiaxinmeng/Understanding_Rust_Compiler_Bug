{"sha": "c9852156dd2fedec130f6d8eb669579ef6237946", "node_id": "C_kwDOANBUbNoAKGM5ODUyMTU2ZGQyZmVkZWMxMzBmNmQ4ZWI2Njk1NzllZjYyMzc5NDY", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-05-17T18:46:29Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2022-05-17T18:54:32Z"}, "message": "Revert 'Use more ARRAY_SIZE.' for mkoffload\n\nRevert commit r13-472-gca32b29ec3e92dcf8dda5c2501d0baf9dd1cb09d partially;\nnamely for {gcn,nvptx}/mkoffload.cc, only.\n\nThe patch changed 'sizeof(...)/sizeof(...[0])' to the 'ARRAY_SIZE' macro,\nwhich is in principle a good idea \u2013 except that in the two mkoffload.cc,\nthe change happened inside a string that is used to generate plain C code.\n\nWith offlading to nvptx or gcn, the mkoffload genenates then the C file\nand compilation of the latter fails with\n\"warning: implicit declaration of function 'ARRAY_SIZE'\" followed by\n\"error: initializer element is not constant\"\n\ngcc/\n\t* config/gcn/mkoffload.cc (process_obj): Revert: Use ARRAY_SIZE.\n\t* config/nvptx/mkoffload.cc (process): Likewise.", "tree": {"sha": "b7c364620f844d4130a5f39e5c717104cd3bc336", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b7c364620f844d4130a5f39e5c717104cd3bc336"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c9852156dd2fedec130f6d8eb669579ef6237946", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9852156dd2fedec130f6d8eb669579ef6237946", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9852156dd2fedec130f6d8eb669579ef6237946", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9852156dd2fedec130f6d8eb669579ef6237946/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b7501739f3b14ac7749aace93f636d021fd607f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b7501739f3b14ac7749aace93f636d021fd607f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b7501739f3b14ac7749aace93f636d021fd607f7"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "94ba7ffa5af4e794973f7c376c5c2d389f7a2e90", "filename": "gcc/config/gcn/mkoffload.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9852156dd2fedec130f6d8eb669579ef6237946/gcc%2Fconfig%2Fgcn%2Fmkoffload.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9852156dd2fedec130f6d8eb669579ef6237946/gcc%2Fconfig%2Fgcn%2Fmkoffload.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fgcn%2Fmkoffload.cc?ref=c9852156dd2fedec130f6d8eb669579ef6237946", "patch": "@@ -723,7 +723,7 @@ process_obj (FILE *in, FILE *cfile)\n \t   \"  unsigned global_variable_count;\\n\"\n \t   \"} target_data = {\\n\"\n \t   \"  &gcn_image,\\n\"\n-\t   \"  ARRAY_SIZE (gcn_kernels),\\n\"\n+\t   \"  sizeof (gcn_kernels) / sizeof (gcn_kernels[0]),\\n\"\n \t   \"  gcn_kernels,\\n\"\n \t   \"  gcn_num_vars\\n\"\n \t   \"};\\n\\n\");"}, {"sha": "b28c1a32292a62b6b871c9e656091a50a252dd30", "filename": "gcc/config/nvptx/mkoffload.cc", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9852156dd2fedec130f6d8eb669579ef6237946/gcc%2Fconfig%2Fnvptx%2Fmkoffload.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9852156dd2fedec130f6d8eb669579ef6237946/gcc%2Fconfig%2Fnvptx%2Fmkoffload.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fmkoffload.cc?ref=c9852156dd2fedec130f6d8eb669579ef6237946", "patch": "@@ -316,11 +316,11 @@ process (FILE *in, FILE *out)\n \t   \"  const struct nvptx_fn *fn_names;\\n\"\n \t   \"  unsigned fn_num;\\n\"\n \t   \"} target_data = {\\n\"\n-\t   \"  ptx_objs, ARRAY_SIZE (ptx_objs),\\n\"\n+\t   \"  ptx_objs, sizeof (ptx_objs) / sizeof (ptx_objs[0]),\\n\"\n \t   \"  var_mappings,\"\n-\t   \"  ARRAY_SIZE (var_mappings),\\n\"\n+\t   \"  sizeof (var_mappings) / sizeof (var_mappings[0]),\\n\"\n \t   \"  func_mappings,\"\n-\t   \"  ARRAY_SIZE (func_mappings)\\n\"\n+\t   \"  sizeof (func_mappings) / sizeof (func_mappings[0])\\n\"\n \t   \"};\\n\\n\");\n \n   fprintf (out, \"#ifdef __cplusplus\\n\""}]}