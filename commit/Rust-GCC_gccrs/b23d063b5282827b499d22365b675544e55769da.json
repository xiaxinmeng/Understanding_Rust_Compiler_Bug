{"sha": "b23d063b5282827b499d22365b675544e55769da", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjIzZDA2M2I1MjgyODI3YjQ5OWQyMjM2NWI2NzU1NDRlNTU3NjlkYQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2016-09-28T14:31:04Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2016-09-28T14:31:04Z"}, "message": "dwarf2out.c (cu_die_list): New global.\n\n2016-09-27  Richard Biener  <rguenther@suse.de>\n\n\t* dwarf2out.c (cu_die_list): New global.\n\t(dwarf2out_finish): Walk cu_die_list instead of limbo DIEs.  Add\n\tmain_comp_unit_die to cu_die_list if we created it.\n\tMove break_out_includes ...\n\t(dwarf2out_early_finish): ... here.  Push created CU DIEs onto\n\tthe cu_die_list.\n\nFrom-SVN: r240579", "tree": {"sha": "0c1f9e39090786c42190641d1ba2aa4faf2199d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0c1f9e39090786c42190641d1ba2aa4faf2199d2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b23d063b5282827b499d22365b675544e55769da", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b23d063b5282827b499d22365b675544e55769da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b23d063b5282827b499d22365b675544e55769da", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b23d063b5282827b499d22365b675544e55769da/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8fd57d049ffe9220c16b662a434578fb77bec047", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fd57d049ffe9220c16b662a434578fb77bec047", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8fd57d049ffe9220c16b662a434578fb77bec047"}], "stats": {"total": 46, "additions": 38, "deletions": 8}, "files": [{"sha": "3c708605b6c2b235d970bf912fb22883b3fb319c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b23d063b5282827b499d22365b675544e55769da/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b23d063b5282827b499d22365b675544e55769da/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b23d063b5282827b499d22365b675544e55769da", "patch": "@@ -1,3 +1,12 @@\n+2016-09-27  Richard Biener  <rguenther@suse.de>\n+\n+\t* dwarf2out.c (cu_die_list): New global.\n+\t(dwarf2out_finish): Walk cu_die_list instead of limbo DIEs.  Add\n+\tmain_comp_unit_die to cu_die_list if we created it.\n+\tMove break_out_includes ...\n+\t(dwarf2out_early_finish): ... here.  Push created CU DIEs onto\n+\tthe cu_die_list.\n+\n 2016-09-28  Richard Biener  <rguenther@suse.de>\n \n \t* dwarf2out.c (struct die_struct): Add removed flag."}, {"sha": "972da16492f8c8471c89febd466a6f364b7c3866", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 29, "deletions": 8, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b23d063b5282827b499d22365b675544e55769da/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b23d063b5282827b499d22365b675544e55769da/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=b23d063b5282827b499d22365b675544e55769da", "patch": "@@ -2866,6 +2866,9 @@ static GTY(()) dw_die_ref single_comp_unit_die;\n /* A list of type DIEs that have been separated into comdat sections.  */\n static GTY(()) comdat_type_node *comdat_type_list;\n \n+/* A list of CU DIEs that have been separated.  */\n+static GTY(()) limbo_die_node *cu_die_list;\n+\n /* A list of DIEs with a NULL parent waiting to be relocated.  */\n static GTY(()) limbo_die_node *limbo_die_list;\n \n@@ -27855,19 +27858,14 @@ dwarf2out_finish (const char *)\n   resolve_addr (comp_unit_die ());\n   move_marked_base_types ();\n \n-  /* Generate separate CUs for each of the include files we've seen.\n-     They will go into limbo_die_list.  */\n-  if (flag_eliminate_dwarf2_dups)\n-    break_out_includes (comp_unit_die ());\n-\n   /* Initialize sections and labels used for actual assembler output.  */\n   init_sections_and_labels ();\n \n   /* Traverse the DIE's and add sibling attributes to those DIE's that\n      have children.  */\n   add_sibling_attributes (comp_unit_die ());\n   limbo_die_node *node;\n-  for (node = limbo_die_list; node; node = node->next)\n+  for (node = cu_die_list; node; node = node->next)\n     add_sibling_attributes (node->die);\n   for (ctnode = comdat_type_list; ctnode != NULL; ctnode = ctnode->next)\n     add_sibling_attributes (ctnode->root_die);\n@@ -27876,7 +27874,15 @@ dwarf2out_finish (const char *)\n      skeleton compile_unit DIE that remains in the .o, while\n      most attributes go in the DWO compile_unit_die.  */\n   if (dwarf_split_debug_info)\n-    main_comp_unit_die = gen_compile_unit_die (NULL);\n+    {\n+      limbo_die_node *cu;\n+      main_comp_unit_die = gen_compile_unit_die (NULL);\n+      cu = limbo_die_list;\n+      gcc_assert (cu->die == main_comp_unit_die);\n+      limbo_die_list = limbo_die_list->next;\n+      cu->next = cu_die_list;\n+      cu_die_list = cu;\n+    }\n   else\n     main_comp_unit_die = comp_unit_die ();\n \n@@ -27988,7 +27994,7 @@ dwarf2out_finish (const char *)\n \n   /* Output all of the compilation units.  We put the main one last so that\n      the offsets are available to output_pubnames.  */\n-  for (node = limbo_die_list; node; node = node->next)\n+  for (node = cu_die_list; node; node = node->next)\n     output_comp_unit (node->die, 0);\n \n   hash_table<comdat_type_hasher> comdat_type_table (100);\n@@ -28217,6 +28223,21 @@ dwarf2out_early_finish (const char *filename)\n       prune_unused_types ();\n     }\n \n+  /* Generate separate CUs for each of the include files we've seen.\n+     They will go into limbo_die_list and from there to cu_die_list.  */\n+  if (flag_eliminate_dwarf2_dups)\n+    {\n+      gcc_assert (limbo_die_list == NULL);\n+      break_out_includes (comp_unit_die ());\n+      limbo_die_node *cu;\n+      while ((cu = limbo_die_list))\n+\t{\n+\t  limbo_die_list = cu->next;\n+\t  cu->next = cu_die_list;\n+\t  cu_die_list = cu;\n+\t}\n+    }\n+\n   /* The early debug phase is now finished.  */\n   early_dwarf_finished = true;\n }"}]}