{"sha": "5714705f1189d42e55c4209e2d2485c9d3bea1cd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTcxNDcwNWYxMTg5ZDQyZTU1YzQyMDllMmQyNDg1YzlkM2JlYTFjZA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2012-06-01T16:11:38Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2012-06-01T16:11:38Z"}, "message": "re PR c++/26155 (ICE after error with namespace alias)\n\n/cp\n2012-06-01  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/26155\n\t* name-lookup.c (push_namespace): When error recovery is\n\timpossible just error out in duplicate_decls.\n\n/testsuite\n2012-06-01  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/26155\n\t* g++.dg/parse/namespace-alias-1.C: New.\n\nFrom-SVN: r188113", "tree": {"sha": "54a3eea2e026357457e9e32423fe45b7c32e0a5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54a3eea2e026357457e9e32423fe45b7c32e0a5f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5714705f1189d42e55c4209e2d2485c9d3bea1cd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5714705f1189d42e55c4209e2d2485c9d3bea1cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5714705f1189d42e55c4209e2d2485c9d3bea1cd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5714705f1189d42e55c4209e2d2485c9d3bea1cd/comments", "author": null, "committer": null, "parents": [{"sha": "874a3589497f78b4631ee273b4bc5dd8293e3873", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/874a3589497f78b4631ee273b4bc5dd8293e3873", "html_url": "https://github.com/Rust-GCC/gccrs/commit/874a3589497f78b4631ee273b4bc5dd8293e3873"}], "stats": {"total": 61, "additions": 51, "deletions": 10}, "files": [{"sha": "95e698d72ae4967fef1fc798356690023c45b9bf", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5714705f1189d42e55c4209e2d2485c9d3bea1cd", "patch": "@@ -1,3 +1,9 @@\n+2012-06-01  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/26155\n+\t* name-lookup.c (push_namespace): When error recovery is\n+\timpossible just error out in duplicate_decls.\n+\n 2012-05-31  Steven Bosscher  <steven@gcc.gnu.org>\n \n \t* call.c: Do not include output.h."}, {"sha": "642f39f2628da6e91846f31ff2917a444fb4d0e2", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 33, "deletions": 10, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=5714705f1189d42e55c4209e2d2485c9d3bea1cd", "patch": "@@ -3518,8 +3518,8 @@ void\n push_namespace (tree name)\n {\n   tree d = NULL_TREE;\n-  int need_new = 1;\n-  int implicit_use = 0;\n+  bool need_new = true;\n+  bool implicit_use = false;\n   bool anon = !name;\n \n   bool subtime = timevar_cond_start (TV_NAME_LOOKUP);\n@@ -3535,22 +3535,45 @@ push_namespace (tree name)\n       d = IDENTIFIER_NAMESPACE_VALUE (name);\n       if (d)\n \t/* Reopening anonymous namespace.  */\n-\tneed_new = 0;\n-      implicit_use = 1;\n+\tneed_new = false;\n+      implicit_use = true;\n     }\n   else\n     {\n       /* Check whether this is an extended namespace definition.  */\n       d = IDENTIFIER_NAMESPACE_VALUE (name);\n       if (d != NULL_TREE && TREE_CODE (d) == NAMESPACE_DECL)\n \t{\n-\t  need_new = 0;\n-\t  if (DECL_NAMESPACE_ALIAS (d))\n-\t    {\n-\t      error (\"namespace alias %qD not allowed here, assuming %qD\",\n-\t\t     d, DECL_NAMESPACE_ALIAS (d));\n-\t      d = DECL_NAMESPACE_ALIAS (d);\n+\t  tree dna = DECL_NAMESPACE_ALIAS (d);\n+\t  if (dna)\n+ \t    {\n+\t      /* We do some error recovery for, eg, the redeclaration\n+\t\t of M here:\n+\n+\t\t namespace N {}\n+\t\t namespace M = N;\n+\t\t namespace M {}\n+\n+\t\t However, in nasty cases like:\n+\n+\t\t namespace N\n+\t\t {\n+\t\t   namespace M = N;\n+\t\t   namespace M {}\n+\t\t }\n+\n+\t\t we just error out below, in duplicate_decls.  */\n+\t      if (NAMESPACE_LEVEL (dna)->level_chain\n+\t\t  == current_binding_level)\n+\t\t{\n+\t\t  error (\"namespace alias %qD not allowed here, \"\n+\t\t\t \"assuming %qD\", d, dna);\n+\t\t  d = dna;\n+\t\t  need_new = false;\n+\t\t}\n \t    }\n+\t  else\n+\t    need_new = false;\n \t}\n     }\n "}, {"sha": "28b853f598127e827f79c17ccfe7194570d29301", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5714705f1189d42e55c4209e2d2485c9d3bea1cd", "patch": "@@ -1,3 +1,8 @@\n+2012-06-01  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/26155\n+\t* g++.dg/parse/namespace-alias-1.C: New.\n+\n 2012-06-01  Christian Bruel  <christian.bruel@st.com>\n \n \t* gcc.dg/spec-options.c: New test."}, {"sha": "627a95bc6552cf61307985cc01c045271a8c31f3", "filename": "gcc/testsuite/g++.dg/parse/namespace-alias-1.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-alias-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5714705f1189d42e55c4209e2d2485c9d3bea1cd/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-alias-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fnamespace-alias-1.C?ref=5714705f1189d42e55c4209e2d2485c9d3bea1cd", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/26155\n+\n+namespace N\n+{\n+  namespace M = N;  // { dg-error \"previous declaration\" }\n+  namespace M {}    // { dg-error \"declaration of namespace\" }\n+}"}]}