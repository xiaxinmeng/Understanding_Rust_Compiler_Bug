{"sha": "bde8c9629a161f292ba1d9c97c28e7cd61806eb9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmRlOGM5NjI5YTE2MWYyOTJiYTFkOWM5N2MyOGU3Y2Q2MTgwNmViOQ==", "commit": {"author": {"name": "Teresa Johnson", "email": "tejohnson@google.com", "date": "2012-12-02T16:40:28Z"}, "committer": {"name": "Teresa Johnson", "email": "tejohnson@gcc.gnu.org", "date": "2012-12-02T16:40:28Z"}, "message": "re PR gcov-profile/55551 (Revision 193999 breaks lto/profiledbootstrap)\n\n2012-12-02  Teresa Johnson  <tejohnson@google.com>\n\n        PR gcov-profile/55551\n\t* lto-cgraph.c (merge_profile_summaries): Handle scaled histogram\n        entries that map to the same index.\n\nFrom-SVN: r194055", "tree": {"sha": "ce378886902417d4864119e07084c1c6bcc9de84", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ce378886902417d4864119e07084c1c6bcc9de84"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bde8c9629a161f292ba1d9c97c28e7cd61806eb9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bde8c9629a161f292ba1d9c97c28e7cd61806eb9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bde8c9629a161f292ba1d9c97c28e7cd61806eb9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bde8c9629a161f292ba1d9c97c28e7cd61806eb9/comments", "author": {"login": "teresajohnson", "id": 20446403, "node_id": "MDQ6VXNlcjIwNDQ2NDAz", "avatar_url": "https://avatars.githubusercontent.com/u/20446403?v=4", "gravatar_id": "", "url": "https://api.github.com/users/teresajohnson", "html_url": "https://github.com/teresajohnson", "followers_url": "https://api.github.com/users/teresajohnson/followers", "following_url": "https://api.github.com/users/teresajohnson/following{/other_user}", "gists_url": "https://api.github.com/users/teresajohnson/gists{/gist_id}", "starred_url": "https://api.github.com/users/teresajohnson/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/teresajohnson/subscriptions", "organizations_url": "https://api.github.com/users/teresajohnson/orgs", "repos_url": "https://api.github.com/users/teresajohnson/repos", "events_url": "https://api.github.com/users/teresajohnson/events{/privacy}", "received_events_url": "https://api.github.com/users/teresajohnson/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "853f8f1c1ced73b423dc1b56c81f4e78c6e5f734", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/853f8f1c1ced73b423dc1b56c81f4e78c6e5f734", "html_url": "https://github.com/Rust-GCC/gccrs/commit/853f8f1c1ced73b423dc1b56c81f4e78c6e5f734"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "6ba71f10a137cdfe226934be040f16a5419a27dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8c9629a161f292ba1d9c97c28e7cd61806eb9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8c9629a161f292ba1d9c97c28e7cd61806eb9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bde8c9629a161f292ba1d9c97c28e7cd61806eb9", "patch": "@@ -1,3 +1,9 @@\n+2012-12-02  Teresa Johnson  <tejohnson@google.com>\n+\n+\tPR gcov-profile/55551\n+\t* lto-cgraph.c (merge_profile_summaries): Handle scaled histogram\n+\tentries that map to the same index.\n+\n 2012-12-02  Steven Bosscher  <steven@gcc.gnu.org>\n \n \t* optabs.c (add_equal_note): Do not create self-referencing REG_EQUAL"}, {"sha": "85b1ea4a5f3b5d3f375cb95cac7f8bdf86cda760", "filename": "gcc/lto-cgraph.c", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8c9629a161f292ba1d9c97c28e7cd61806eb9/gcc%2Flto-cgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8c9629a161f292ba1d9c97c28e7cd61806eb9/gcc%2Flto-cgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-cgraph.c?ref=bde8c9629a161f292ba1d9c97c28e7cd61806eb9", "patch": "@@ -1345,7 +1345,8 @@ merge_profile_summaries (struct lto_file_decl_data **file_data_vec)\n         /* Save a pointer to the profile_info with the largest\n            scaled sum_all and the scale for use in merging the\n            histogram.  */\n-        if (lto_gcov_summary.sum_all > saved_sum_all)\n+        if (!saved_profile_info\n+            || lto_gcov_summary.sum_all > saved_sum_all)\n           {\n             saved_profile_info = &file_data->profile_info;\n             saved_sum_all = lto_gcov_summary.sum_all;\n@@ -1363,17 +1364,20 @@ merge_profile_summaries (struct lto_file_decl_data **file_data_vec)\n          above. Use that to find the new histogram index.  */\n       int scaled_min = RDIV (saved_profile_info->histogram[h_ix].min_value\n                              * saved_scale, REG_BR_PROB_BASE);\n+      /* The new index may be shared with another scaled histogram entry,\n+         so we need to account for a non-zero histogram entry at new_ix.  */\n       unsigned new_ix = gcov_histo_index (scaled_min);\n-      lto_gcov_summary.histogram[new_ix].min_value = scaled_min;\n+      lto_gcov_summary.histogram[new_ix].min_value\n+          = MIN (lto_gcov_summary.histogram[new_ix].min_value, scaled_min);\n       /* Some of the scaled counter values would ostensibly need to be placed\n          into different (larger) histogram buckets, but we keep things simple\n          here and place the scaled cumulative counter value in the bucket\n          corresponding to the scaled minimum counter value.  */\n       lto_gcov_summary.histogram[new_ix].cum_value\n-          = RDIV (saved_profile_info->histogram[h_ix].cum_value\n-                  * saved_scale, REG_BR_PROB_BASE);\n+          += RDIV (saved_profile_info->histogram[h_ix].cum_value\n+                   * saved_scale, REG_BR_PROB_BASE);\n       lto_gcov_summary.histogram[new_ix].num_counters\n-          = saved_profile_info->histogram[h_ix].num_counters;\n+          += saved_profile_info->histogram[h_ix].num_counters;\n     }\n \n   /* Watch roundoff errors.  */"}]}