{"sha": "8208d7dc3012faadc09726f03363fa9a8f96ff66", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODIwOGQ3ZGMzMDEyZmFhZGMwOTcyNmYwMzM2M2ZhOWE4Zjk2ZmY2Ng==", "commit": {"author": {"name": "Daniel Jacobowitz", "email": "dan@codesourcery.com", "date": "2007-11-08T12:48:28Z"}, "committer": {"name": "Daniel Jacobowitz", "email": "drow@gcc.gnu.org", "date": "2007-11-08T12:48:28Z"}, "message": "class.c (build_ctor_vtbl_group): Lay out the new type and decl.\n\n\t* class.c (build_ctor_vtbl_group): Lay out the new type and decl.\n\n\t* g++.dg/opt/anchor1.C: New.\n\nFrom-SVN: r129997", "tree": {"sha": "47cc2b29e83533c4fc38f568fda130c3164ebc0e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/47cc2b29e83533c4fc38f568fda130c3164ebc0e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8208d7dc3012faadc09726f03363fa9a8f96ff66", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8208d7dc3012faadc09726f03363fa9a8f96ff66", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8208d7dc3012faadc09726f03363fa9a8f96ff66", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8208d7dc3012faadc09726f03363fa9a8f96ff66/comments", "author": null, "committer": null, "parents": [{"sha": "0a485bae9f0aa4a2ad5236131113e16a339213db", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a485bae9f0aa4a2ad5236131113e16a339213db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a485bae9f0aa4a2ad5236131113e16a339213db"}], "stats": {"total": 70, "additions": 70, "deletions": 0}, "files": [{"sha": "e28f5822d4b119fd83c171f15738c6a849221ac0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8208d7dc3012faadc09726f03363fa9a8f96ff66", "patch": "@@ -1,3 +1,7 @@\n+2007-11-08  Daniel Jacobowitz  <dan@codesourcery.com>\n+\n+\t* class.c (build_ctor_vtbl_group): Lay out the new type and decl.\n+\n 2007-11-07  Douglas Gregor  <doug.gregor@gmail.com>\n \n \tPR c++/33045"}, {"sha": "6e67157a290a3c881a9f5533f735bdec7108650a", "filename": "gcc/cp/class.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=8208d7dc3012faadc09726f03363fa9a8f96ff66", "patch": "@@ -7006,7 +7006,10 @@ build_ctor_vtbl_group (tree binfo, tree t)\n   /* Figure out the type of the construction vtable.  */\n   type = build_index_type (size_int (list_length (inits) - 1));\n   type = build_cplus_array_type (vtable_entry_type, type);\n+  layout_type (type);\n   TREE_TYPE (vtbl) = type;\n+  DECL_SIZE (vtbl) = DECL_SIZE_UNIT (vtbl) = NULL_TREE;\n+  layout_decl (vtbl, 0);\n \n   /* Initialize the construction vtable.  */\n   CLASSTYPE_VTABLES (t) = chainon (CLASSTYPE_VTABLES (t), vtbl);"}, {"sha": "fdbbb6bbe4d9c12dbd8a0c2db693694ec405f9ca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8208d7dc3012faadc09726f03363fa9a8f96ff66", "patch": "@@ -1,3 +1,7 @@\n+2007-11-08  Daniel Jacobowitz  <dan@codesourcery.com>\n+\n+\t* g++.dg/opt/anchor1.C: New.\n+\n 2007-11-07  Diego Novillo  <dnovillo@google.com>\n \n \tPR 33870"}, {"sha": "5d30afbe8a3ceaa43715b8df267779b9527c1274", "filename": "gcc/testsuite/g++.dg/opt/anchor1.C", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fanchor1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8208d7dc3012faadc09726f03363fa9a8f96ff66/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fanchor1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fanchor1.C?ref=8208d7dc3012faadc09726f03363fa9a8f96ff66", "patch": "@@ -0,0 +1,59 @@\n+// { dg-do run }\n+// { dg-options \"-O2\" }\n+\n+// The size of the construction vtable for YFont in YCoreFont was not\n+// updated to reflect its actual size.  On targets with section anchor\n+// support, the vtable for YCoreFont was laid out immediately after\n+// that, but the compiler thought it was about 40 bytes closer to the\n+// anchor than it actually was.\n+\n+extern \"C\" void abort (void);\n+\n+class refcounted {\n+public:\n+    int __refcount;\n+\n+public:\n+    refcounted(): __refcount(0) {};\n+    virtual ~refcounted() {}\n+};\n+\n+class YFont : public virtual refcounted {\n+public:\n+    virtual ~YFont() {}\n+\n+    virtual int ascent() const = 0;\n+};\n+\n+struct XFontStruct {\n+};\n+\n+class YCoreFont : public YFont {\n+public:\n+    YCoreFont(char const * name);\n+    virtual ~YCoreFont();\n+\n+    virtual int ascent() const { return 2; }\n+\n+private:\n+    XFontStruct * fFont;\n+};\n+\n+YCoreFont::YCoreFont(char const * name) {\n+}\n+\n+YCoreFont::~YCoreFont() {\n+}\n+\n+int foo(YCoreFont *ycf)\n+{\n+  ycf->ascent ();\n+}\n+\n+int main()\n+{\n+  YCoreFont ycf(\"\");\n+  if (foo(&ycf) != 2)\n+    abort ();\n+  return 0;\n+}"}]}