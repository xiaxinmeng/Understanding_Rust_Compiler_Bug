{"sha": "2c8f068300e1fc38c73a992f82c0d19af55ded04", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmM4ZjA2ODMwMGUxZmMzOGM3M2E5OTJmODJjMGQxOWFmNTVkZWQwNA==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2015-04-29T09:04:31Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2015-04-29T09:04:31Z"}, "message": "Fix OpenMP's target update directive in templated code.\n\n    FAIL: g++.dg/gomp/tpl-target-update.C  -std=c++98 (internal compiler error)\n    FAIL: g++.dg/gomp/tpl-target-update.C  -std=c++98 (test for excess errors)\n    FAIL: g++.dg/gomp/tpl-target-update.C  -std=c++11 (internal compiler error)\n    FAIL: g++.dg/gomp/tpl-target-update.C  -std=c++11 (test for excess errors)\n    FAIL: g++.dg/gomp/tpl-target-update.C  -std=c++14 (internal compiler error)\n    FAIL: g++.dg/gomp/tpl-target-update.C  -std=c++14 (test for excess errors)\n\n    [...]/source-gcc/gcc/testsuite/g++.dg/gomp/tpl-target-update.C: In instantiation of 'void f(T, T) [with T = int]':\n    [...]/source-gcc/gcc/testsuite/g++.dg/gomp/tpl-target-update.C:19:9:   required from here\n    [...]/source-gcc/gcc/testsuite/g++.dg/gomp/tpl-target-update.C:10:9: internal compiler error: tree check: expected oacc_parallel or oacc_kernels or oacc_data or oacc_host_data or omp_parallel or omp_task or omp_for or omp_simd or cilk_simd or cilk_for or omp_distribute or oacc_loop or omp_teams or omp_target_data or omp_target or omp_sections or omp_single, have omp_target_update in tsubst_expr, at cp/pt.c:14209\n    0xf5aae1 tree_range_check_failed(tree_node const*, char const*, int, char const*, tree_code, tree_code)\n            [...]/source-gcc/gcc/tree.c:9384\n    0x66e201 tree_range_check\n            [...]/source-gcc/gcc/tree.h:2979\n    0x66e201 tsubst_expr\n            [...]/source-gcc/gcc/cp/pt.c:14209\n    0x6695e3 tsubst_expr\n            [...]/source-gcc/gcc/cp/pt.c:13752\n    0x66ac07 tsubst_expr\n            [...]/source-gcc/gcc/cp/pt.c:13938\n    0x667c41 instantiate_decl(tree_node*, int, bool)\n            [...]/source-gcc/gcc/cp/pt.c:20367\n    0x6ae386 instantiate_pending_templates(int)\n            [...]/source-gcc/gcc/cp/pt.c:20484\n    0x6edc3d cp_write_global_declarations()\n            [...]/source-gcc/gcc/cp/decl2.c:4456\n\n\tgcc/cp/\n\t* pt.c (tsubst_expr) <OMP_TARGET_UPDATE>: Use\n\tOMP_TARGET_UPDATE_CLAUSES instead of OMP_CLAUSES.\n\tgcc/testsuite/\n\t* g++.dg/gomp/tpl-target-update.C: New file.\n\nFrom-SVN: r222564", "tree": {"sha": "d5215eb965e1453034a609a2f7d2d090278f787d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d5215eb965e1453034a609a2f7d2d090278f787d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c8f068300e1fc38c73a992f82c0d19af55ded04", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c8f068300e1fc38c73a992f82c0d19af55ded04", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c8f068300e1fc38c73a992f82c0d19af55ded04", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c8f068300e1fc38c73a992f82c0d19af55ded04/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b504063421d10afa572be9734468fc6ccff51186", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b504063421d10afa572be9734468fc6ccff51186", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b504063421d10afa572be9734468fc6ccff51186"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "cc716b86160c5b64d0fb7c184bbd99037943b5d0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=2c8f068300e1fc38c73a992f82c0d19af55ded04", "patch": "@@ -1,3 +1,8 @@\n+2015-04-29  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\t* pt.c (tsubst_expr) <OMP_TARGET_UPDATE>: Use\n+\tOMP_TARGET_UPDATE_CLAUSES instead of OMP_CLAUSES.\n+\n 2015-04-28  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/65896"}, {"sha": "8e0e789916b28de801bda1a5812ae1d9bc48c435", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=2c8f068300e1fc38c73a992f82c0d19af55ded04", "patch": "@@ -14203,7 +14203,7 @@ tsubst_expr (tree t, tree args, tsubst_flags_t complain, tree in_decl,\n       tmp = tsubst_omp_clauses (OMP_TARGET_UPDATE_CLAUSES (t), false,\n \t\t\t\targs, complain, in_decl);\n       t = copy_node (t);\n-      OMP_CLAUSES (t) = tmp;\n+      OMP_TARGET_UPDATE_CLAUSES (t) = tmp;\n       add_stmt (t);\n       break;\n "}, {"sha": "ffc4c2dce179446b2cdc7c49a39eeebbd5fadca7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2c8f068300e1fc38c73a992f82c0d19af55ded04", "patch": "@@ -1,3 +1,7 @@\n+2015-04-29  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\t* g++.dg/gomp/tpl-target-update.C: New file.\n+\n 2015-04-29  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/65917"}, {"sha": "6226ebf9ca05b571a2e37f16ec324f53d5d8f8fe", "filename": "gcc/testsuite/g++.dg/gomp/tpl-target-update.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Ftpl-target-update.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c8f068300e1fc38c73a992f82c0d19af55ded04/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Ftpl-target-update.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgomp%2Ftpl-target-update.C?ref=2c8f068300e1fc38c73a992f82c0d19af55ded04", "patch": "@@ -0,0 +1,20 @@\n+// { dg-do compile }\n+\n+template <typename T>\n+void f(T A, T B)\n+{\n+  extern int *v;\n+  T a = 2;\n+  T b = 4;\n+\n+#pragma omp target update to(v[a:b])\n+  v[a] = 0;\n+\n+#pragma omp target update to(v[A:B])\n+  v[a] = 0;\n+}\n+\n+void g()\n+{\n+  f(1, 5);\n+}"}]}