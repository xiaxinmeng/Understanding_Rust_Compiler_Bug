{"sha": "ffd343926959a175219f705631f6c649bdfdff2a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmZkMzQzOTI2OTU5YTE3NTIxOWY3MDU2MzFmNmM2NDliZGZkZmYyYQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2007-04-11T06:18:28Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2007-04-11T06:18:28Z"}, "message": "class.c (convert_to_base_statically): Fold produced tree; verify that we are not processing template_decl.\n\n\t* cp/class.c (convert_to_base_statically): Fold produced tree; verify\n\tthat we are not processing template_decl.\n\nFrom-SVN: r123711", "tree": {"sha": "b44cdfcdef1b3171d3b746ae6f2c7d255425339c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b44cdfcdef1b3171d3b746ae6f2c7d255425339c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ffd343926959a175219f705631f6c649bdfdff2a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffd343926959a175219f705631f6c649bdfdff2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ffd343926959a175219f705631f6c649bdfdff2a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ffd343926959a175219f705631f6c649bdfdff2a/comments", "author": null, "committer": null, "parents": [{"sha": "113008b54b1405325b472e7eef9811c1340560f3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/113008b54b1405325b472e7eef9811c1340560f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/113008b54b1405325b472e7eef9811c1340560f3"}], "stats": {"total": 19, "additions": 15, "deletions": 4}, "files": [{"sha": "38ce783a47b66002ef44356077bc64f3ee2ba675", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffd343926959a175219f705631f6c649bdfdff2a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffd343926959a175219f705631f6c649bdfdff2a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ffd343926959a175219f705631f6c649bdfdff2a", "patch": "@@ -1,3 +1,8 @@\n+2007-04-11  Jan Hubicka  <jh@suse.cz>\n+\n+\t* cp/class.c (convert_to_base_statically): Fold produced tree; verify\n+\tthat we are not processing template_decl.\n+\n 2007-04-09  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/31449"}, {"sha": "953cdffca7d748810c5f3d9dc9610a27ff00be14", "filename": "gcc/cp/class.c", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ffd343926959a175219f705631f6c649bdfdff2a/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ffd343926959a175219f705631f6c649bdfdff2a/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=ffd343926959a175219f705631f6c649bdfdff2a", "patch": "@@ -531,12 +531,18 @@ convert_to_base_statically (tree expr, tree base)\n       tree pointer_type;\n \n       pointer_type = build_pointer_type (expr_type);\n+\n+      /* We use fold_build2 and fold_convert below to simplify the trees\n+\t provided to the optimizers.  It is not safe to call these functions\n+\t when processing a template because they do not handle C++-specific\n+\t trees.  */\n+      gcc_assert (!processing_template_decl);\n       expr = build_unary_op (ADDR_EXPR, expr, /*noconvert=*/1);\n       if (!integer_zerop (BINFO_OFFSET (base)))\n-\t  expr = build2 (PLUS_EXPR, pointer_type, expr,\n-\t\t\t build_nop (pointer_type, BINFO_OFFSET (base)));\n-      expr = build_nop (build_pointer_type (BINFO_TYPE (base)), expr);\n-      expr = build1 (INDIRECT_REF, BINFO_TYPE (base), expr);\n+        expr = fold_build2 (PLUS_EXPR, pointer_type, expr,\n+\t\t\t    fold_convert (pointer_type, BINFO_OFFSET (base)));\n+      expr = fold_convert (build_pointer_type (BINFO_TYPE (base)), expr);\n+      expr = build_fold_indirect_ref (expr);\n     }\n \n   return expr;"}]}