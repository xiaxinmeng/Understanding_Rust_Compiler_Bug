{"sha": "5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWNkMWFmNDk5ZDkyNTdmNDRiZmY2ZTRhYTg1YjBhOWZhNzA1OGU5YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-13T09:12:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-13T09:12:47Z"}, "message": "re PR target/84335 (ICE on invalid code in copy_to_mode_reg, at explow.c:612)\n\n\tPR target/84335\n\t* config/i386/i386.c (ix86_init_mmx_sse_builtins): Pass\n\tOPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2 instead of\n\tOPTION_MASK_ISA_AES as first argument to def_builtin_const\n\tfor AES builtins.  Pass OPTION_MASK_ISA_PCLMUL | OPTION_MASK_ISA_SSE2\n\tinstead of OPTION_MASK_ISA_PCLMUL as first argument to\n\tdef_builtin_const for __builtin_ia32_pclmulqdq128 builtin.\n\t* config/i386/wmmintrin.h: If __SSE2__ is not defined, enable it\n\ttemporarily for AES and PCLMUL builtins.\n\n\t* gcc.target/i386/pr84335.c: New test.\n\nFrom-SVN: r257619", "tree": {"sha": "943d48180cd5097ae5d4e42798cf64ffbd340f81", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/943d48180cd5097ae5d4e42798cf64ffbd340f81"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "204a7ecb02199cdef17e445821c1effbfaf21bae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/204a7ecb02199cdef17e445821c1effbfaf21bae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/204a7ecb02199cdef17e445821c1effbfaf21bae"}], "stats": {"total": 52, "additions": 41, "deletions": 11}, "files": [{"sha": "6ed2b5ca39e5c949773e53423a84274d87580e11", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "patch": "@@ -1,5 +1,15 @@\n 2018-02-13  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/84335\n+\t* config/i386/i386.c (ix86_init_mmx_sse_builtins): Pass\n+\tOPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2 instead of\n+\tOPTION_MASK_ISA_AES as first argument to def_builtin_const\n+\tfor AES builtins.  Pass OPTION_MASK_ISA_PCLMUL | OPTION_MASK_ISA_SSE2\n+\tinstead of OPTION_MASK_ISA_PCLMUL as first argument to\n+\tdef_builtin_const for __builtin_ia32_pclmulqdq128 builtin.\n+\t* config/i386/wmmintrin.h: If __SSE2__ is not defined, enable it\n+\ttemporarily for AES and PCLMUL builtins.\n+\n \tPR tree-optimization/84339\n \t* gimple-fold.c (get_range_strlen): Set *FLEXP to true when handling\n \tARRAY_REF where first operand is array_at_struct_end_p COMPONENT_REF."}, {"sha": "020eef9fd7bd7d54fdd5f2f8479f394195aa56de", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 14, "deletions": 7, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "patch": "@@ -31282,21 +31282,28 @@ ix86_init_mmx_sse_builtins (void)\n \t       VOID_FTYPE_UNSIGNED_UNSIGNED, IX86_BUILTIN_MWAIT);\n \n   /* AES */\n-  def_builtin_const (OPTION_MASK_ISA_AES, \"__builtin_ia32_aesenc128\",\n+  def_builtin_const (OPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_aesenc128\",\n \t\t     V2DI_FTYPE_V2DI_V2DI, IX86_BUILTIN_AESENC128);\n-  def_builtin_const (OPTION_MASK_ISA_AES, \"__builtin_ia32_aesenclast128\",\n+  def_builtin_const (OPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_aesenclast128\",\n \t\t     V2DI_FTYPE_V2DI_V2DI, IX86_BUILTIN_AESENCLAST128);\n-  def_builtin_const (OPTION_MASK_ISA_AES, \"__builtin_ia32_aesdec128\",\n+  def_builtin_const (OPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_aesdec128\",\n \t\t     V2DI_FTYPE_V2DI_V2DI, IX86_BUILTIN_AESDEC128);\n-  def_builtin_const (OPTION_MASK_ISA_AES, \"__builtin_ia32_aesdeclast128\",\n+  def_builtin_const (OPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_aesdeclast128\",\n \t\t     V2DI_FTYPE_V2DI_V2DI, IX86_BUILTIN_AESDECLAST128);\n-  def_builtin_const (OPTION_MASK_ISA_AES, \"__builtin_ia32_aesimc128\",\n+  def_builtin_const (OPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_aesimc128\",\n \t\t     V2DI_FTYPE_V2DI, IX86_BUILTIN_AESIMC128);\n-  def_builtin_const (OPTION_MASK_ISA_AES, \"__builtin_ia32_aeskeygenassist128\",\n+  def_builtin_const (OPTION_MASK_ISA_AES | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_aeskeygenassist128\",\n \t\t     V2DI_FTYPE_V2DI_INT, IX86_BUILTIN_AESKEYGENASSIST128);\n \n   /* PCLMUL */\n-  def_builtin_const (OPTION_MASK_ISA_PCLMUL, \"__builtin_ia32_pclmulqdq128\",\n+  def_builtin_const (OPTION_MASK_ISA_PCLMUL | OPTION_MASK_ISA_SSE2,\n+\t\t     \"__builtin_ia32_pclmulqdq128\",\n \t\t     V2DI_FTYPE_V2DI_V2DI_INT, IX86_BUILTIN_PCLMULQDQ128);\n \n   /* RDRND */"}, {"sha": "61837f30892b8d02888b65da1ee7500cec0019cb", "filename": "gcc/config/i386/wmmintrin.h", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Fconfig%2Fi386%2Fwmmintrin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Fconfig%2Fi386%2Fwmmintrin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fwmmintrin.h?ref=5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "patch": "@@ -32,9 +32,9 @@\n \n /* AES */\n \n-#ifndef __AES__\n+#if !defined(__AES__) || !defined(__SSE2__)\n #pragma GCC push_options\n-#pragma GCC target(\"aes\")\n+#pragma GCC target(\"aes,sse2\")\n #define __DISABLE_AES__\n #endif /* __AES__ */\n \n@@ -101,9 +101,9 @@ _mm_aeskeygenassist_si128 (__m128i __X, const int __C)\n \n /* PCLMUL */\n \n-#ifndef __PCLMUL__\n+#if !defined(__PCLMUL__) || !defined(__SSE2__)\n #pragma GCC push_options\n-#pragma GCC target(\"pclmul\")\n+#pragma GCC target(\"pclmul,sse2\")\n #define __DISABLE_PCLMUL__\n #endif /* __PCLMUL__ */\n "}, {"sha": "878a78e299e3475868e978c10235d3a546a6c555", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "patch": "@@ -1,5 +1,8 @@\n 2018-02-13  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/84335\n+\t* gcc.target/i386/pr84335.c: New test.\n+\n \tPR tree-optimization/84339\n \t* gcc.c-torture/execute/pr84339.c: New test.\n "}, {"sha": "c8d2a712f1f5ee33c6738312cb4f20e4fa0ac8a7", "filename": "gcc/testsuite/gcc.target/i386/pr84335.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr84335.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr84335.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr84335.c?ref=5cd1af499d9257f44bff6e4aa85b0a9fa7058e9a", "patch": "@@ -0,0 +1,10 @@\n+/* PR target/84335 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -maes -mno-sse2\" } */\n+typedef long long V __attribute__ ((__vector_size__ (16)));\n+\n+V\n+foo (V *a, V *b)\n+{\n+  return __builtin_ia32_aesenc128 (*a, *b);\t/* { dg-error \"needs isa option\" } */\n+}"}]}