{"sha": "b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZlM2RiMDYwODYwNGRkZDkzYjc3YjQyYTU5OGUxZDBiMmQ2ZWZkMQ==", "commit": {"author": {"name": "Ryan Burn", "email": "contact@rnburn.com", "date": "2016-01-14T22:23:09Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2016-01-14T22:23:09Z"}, "message": "[cilkplus] Fix cilk_spawn gimplification bug (PR cilkplus/69048)\n\n\tPR c++/69048\n\t* cilk.c (create_cilk_wrapper_body): Call fold_build_cleanup_point_expr\n\t to add missing cleanup point.\n\n\tPR c++/69048\n\t* g++.dg/cilk-plus/CK/pr69048.cc: New test.\n\nFrom-SVN: r232393", "tree": {"sha": "5123b2c42371f63149c2fe16f954433caa95578f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5123b2c42371f63149c2fe16f954433caa95578f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/comments", "author": null, "committer": null, "parents": [{"sha": "006df05d5cc462545336d5a439afbf10732acd16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/006df05d5cc462545336d5a439afbf10732acd16", "html_url": "https://github.com/Rust-GCC/gccrs/commit/006df05d5cc462545336d5a439afbf10732acd16"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "af215511546e3c33fe8cf63410f09497dc7c7cff", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "patch": "@@ -1,3 +1,9 @@\n+2015-01-14 Ryan Burn  <contact@rnburn.com>\n+\n+\tPR c++/69048\n+\t* cilk.c (create_cilk_wrapper_body): Call fold_build_cleanup_point_expr\n+\t to add missing cleanup point.\n+\n 2016-01-14  David Malcolm  <dmalcolm@redhat.com>\n \n \tPR c++/68819"}, {"sha": "4d6be33d818e35acb45eb502adf9e00d909ffed3", "filename": "gcc/c-family/cilk.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Fc-family%2Fcilk.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Fc-family%2Fcilk.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fcilk.c?ref=b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "patch": "@@ -592,6 +592,11 @@ create_cilk_wrapper_body (tree stmt, struct wrapper_data *wd)\n   for (p = wd->parms; p; p = TREE_CHAIN (p))\n     DECL_CONTEXT (p) = fndecl;\n \n+  /* The statement containing the spawn expression might create temporaries with\n+     destructors defined; if so we need to add a CLEANUP_POINT_EXPR to ensure\n+     the expression is properly gimplified.  */\n+  stmt = fold_build_cleanup_point_expr (void_type_node, stmt);\n+\n   gcc_assert (!DECL_SAVED_TREE (fndecl));\n   cilk_install_body_with_frame_cleanup (fndecl, stmt, (void *) wd);\n   gcc_assert (DECL_SAVED_TREE (fndecl));"}, {"sha": "05ae50bb69ab3ffcab432a87ac8920bd4bc35553", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "patch": "@@ -1,3 +1,8 @@\n+2015-01-14 Ryan Burn  <contact@rnburn.com>\n+\n+\tPR c++/69048\n+\t* g++.dg/cilk-plus/CK/pr69048.cc: New test.\n+\n 2016-01-14  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR testsuite/67509"}, {"sha": "b6c57fca9a453b6555f9ac06bae35c6130d20e2f", "filename": "gcc/testsuite/g++.dg/cilk-plus/CK/pr69048.cc", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcilk-plus%2FCK%2Fpr69048.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6e3db0608604ddd93b77b42a598e1d0b2d6efd1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcilk-plus%2FCK%2Fpr69048.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcilk-plus%2FCK%2Fpr69048.cc?ref=b6e3db0608604ddd93b77b42a598e1d0b2d6efd1", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fcilkplus\" } */\n+\n+struct A {\n+  ~A () {}\n+};\n+\n+A f () {\n+  return A ();\n+}\n+\n+void t1 () {\n+  _Cilk_spawn f ();\n+}"}]}