{"sha": "7f37fff1a17d12538973f68be49ba3d6030a495d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2YzN2ZmZjFhMTdkMTI1Mzg5NzNmNjhiZTQ5YmEzZDYwMzBhNDk1ZA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-10-16T13:41:29Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-10-16T13:41:29Z"}, "message": "[multiple changes]\n\n2015-10-16  Javier Miranda  <miranda@adacore.com>\n\n\t* sem_ch5.adb (Analyze_Iterator_Specification): Associate a\n\ttransient scope with the renaming object declararation.\n\t* exp_util.adb (Insert_Actions): if the enclosing interator\n\tloop is marked as requiring the secondary stack then attach the\n\tactions to the transient scope.\n\n2015-10-16  Bob Duff  <duff@adacore.com>\n\n\t* exp_ch7.adb: Minor spelling fixes.\n\n2015-10-16  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch3.adb (Replace_Anonymous_Access_To_Protected_Subprogram):\n\tIf anonymous type is component type of array type declaration,\n\tanalyze its declaration in the current scope, not the enclosing\n\tone.\n\nFrom-SVN: r228906", "tree": {"sha": "f9e873bd79131ffc12f463a8de5aa67ea40b6b21", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f9e873bd79131ffc12f463a8de5aa67ea40b6b21"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f37fff1a17d12538973f68be49ba3d6030a495d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f37fff1a17d12538973f68be49ba3d6030a495d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f37fff1a17d12538973f68be49ba3d6030a495d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f37fff1a17d12538973f68be49ba3d6030a495d/comments", "author": null, "committer": null, "parents": [{"sha": "16e49553f73393d7cd40fcfe77816ad4d23f434a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16e49553f73393d7cd40fcfe77816ad4d23f434a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16e49553f73393d7cd40fcfe77816ad4d23f434a"}], "stats": {"total": 78, "additions": 65, "deletions": 13}, "files": [{"sha": "d8f2b58a10757a9502582f7dc08b780cdec6934f", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=7f37fff1a17d12538973f68be49ba3d6030a495d", "patch": "@@ -1,3 +1,22 @@\n+2015-10-16  Javier Miranda  <miranda@adacore.com>\n+\n+\t* sem_ch5.adb (Analyze_Iterator_Specification): Associate a\n+\ttransient scope with the renaming object declararation.\n+\t* exp_util.adb (Insert_Actions): if the enclosing interator\n+\tloop is marked as requiring the secondary stack then attach the\n+\tactions to the transient scope.\n+\n+2015-10-16  Bob Duff  <duff@adacore.com>\n+\n+\t* exp_ch7.adb: Minor spelling fixes.\n+\n+2015-10-16  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch3.adb (Replace_Anonymous_Access_To_Protected_Subprogram):\n+\tIf anonymous type is component type of array type declaration,\n+\tanalyze its declaration in the current scope, not the enclosing\n+\tone.\n+\n 2015-10-16  Gary Dismukes  <dismukes@adacore.com>\n \n \t* prj.adb, sem_util.adb, exp_ch6.adb: Minor reformatting."}, {"sha": "3836e8575ea8b5d29ee2fdd6d7ba861f64ba98d4", "filename": "gcc/ada/exp_ch7.adb", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fexp_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fexp_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch7.adb?ref=7f37fff1a17d12538973f68be49ba3d6030a495d", "patch": "@@ -1109,7 +1109,7 @@ package body Exp_Ch7 is\n       Finalizer_Decls : List_Id := No_List;\n       --  Local variable declarations. This list holds the label declarations\n       --  of all jump block alternatives as well as the declaration of the\n-      --  local exception occurence and the raised flag:\n+      --  local exception occurrence and the raised flag:\n       --     E : Exception_Occurrence;\n       --     Raised : Boolean := False;\n       --     L<counter value> : label;\n@@ -5283,7 +5283,7 @@ package body Exp_Ch7 is\n       --                      Abort  : constant Boolean := Triggered_By_Abort;\n       --                        <or>\n       --                      Abort  : constant Boolean := False; --  no abort\n-      --                      E      : Exception_Occurence;\n+      --                      E      : Exception_Occurrence;\n       --                      Raised : Boolean := False;\n \n       --                   begin\n@@ -6047,7 +6047,7 @@ package body Exp_Ch7 is\n       --             when others =>\n       --                if not Raised then\n       --                   Raised := True;\n-      --                   Save_Occurence (E, Get_Current_Excep.all.all);\n+      --                   Save_Occurrence (E, Get_Current_Excep.all.all);\n       --                end if;\n       --          end;\n       --       end if;\n@@ -6065,7 +6065,7 @@ package body Exp_Ch7 is\n       --       Abort  : constant Boolean := Triggered_By_Abort;\n       --         <or>\n       --       Abort  : constant Boolean := False;  --  no abort\n-      --       E      : Exception_Occurence;\n+      --       E      : Exception_Occurrence;\n       --       Raised : Boolean := False;\n       --\n       --    begin\n@@ -6076,7 +6076,7 @@ package body Exp_Ch7 is\n       --             when others =>\n       --                if not Raised then\n       --                   Raised := True;\n-      --                   Save_Occurence (E, Get_Current_Excep.all.all);\n+      --                   Save_Occurrence (E, Get_Current_Excep.all.all);\n       --                end if;\n       --          end;\n       --       end if;\n@@ -6100,7 +6100,7 @@ package body Exp_Ch7 is\n       --                when others =>\n       --                   if not Raised then\n       --                      Raised := True;\n-      --                      Save_Occurence (E, Get_Current_Excep.all.all);\n+      --                      Save_Occurrence (E, Get_Current_Excep.all.all);\n       --                   end if;\n       --             end;\n       --             .  .  .\n@@ -6111,7 +6111,7 @@ package body Exp_Ch7 is\n       --                when others =>\n       --                   if not Raised then\n       --                      Raised := True;\n-      --                      Save_Occurence (E, Get_Current_Excep.all.all);\n+      --                      Save_Occurrence (E, Get_Current_Excep.all.all);\n       --                   end if;\n       --             end;\n       --             <<L0>>\n@@ -6533,7 +6533,7 @@ package body Exp_Ch7 is\n          --         <or>\n          --       Abort  : constant Boolean := False;  --  no abort\n \n-         --       E      : Exception_Occurence;\n+         --       E      : Exception_Occurrence;\n          --       Raised : Boolean := False;\n \n          --    begin\n@@ -7105,7 +7105,7 @@ package body Exp_Ch7 is\n          --         <or>\n          --       Abort  : constant Boolean := False;  --  no abort\n \n-         --       E      : Exception_Occurence;\n+         --       E      : Exception_Occurrence;\n          --       Raised : Boolean := False;\n \n          --    begin"}, {"sha": "56f9b9a043bde93ca125a0ecd6c1306650c4279e", "filename": "gcc/ada/exp_util.adb", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fexp_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fexp_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.adb?ref=7f37fff1a17d12538973f68be49ba3d6030a495d", "patch": "@@ -4034,6 +4034,22 @@ package body Exp_Util is\n                   end if;\n \n                   return;\n+\n+               --  Iteration scheme located in a transient scope\n+\n+               elsif Nkind (P) = N_Iteration_Scheme\n+                 and then Present (Wrapped_Node)\n+               then\n+                  --  If the enclosing iterator loop is marked as requiring the\n+                  --  secondary stack then the actions must be inserted in the\n+                  --  transient scope.\n+\n+                  if Uses_Sec_Stack\n+                       (Find_Enclosing_Iterator_Loop (Current_Scope))\n+                  then\n+                     Store_Before_Actions_In_Scope (Ins_Actions);\n+                     return;\n+                  end if;\n                end if;\n \n             --  Statements, declarations, pragmas, representation clauses"}, {"sha": "542ea3f9c1d0588ab23f3218abba589ad13ded8f", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=7f37fff1a17d12538973f68be49ba3d6030a495d", "patch": "@@ -5913,7 +5913,13 @@ package body Sem_Ch3 is\n \n       Mark_Rewrite_Insertion (Comp);\n \n-      if Nkind_In (N, N_Object_Declaration, N_Access_Function_Definition) then\n+      if Nkind_In (N, N_Object_Declaration, N_Access_Function_Definition)\n+        or else (Nkind (Parent (N)) = N_Full_Type_Declaration\n+                  and then not Is_Type (Current_Scope))\n+      then\n+\n+         --  Declaration can be analyzed in the current scope.\n+\n          Analyze (Decl);\n \n       else"}, {"sha": "234317c0f1dc5063ee29b14fd39236340ac7bec8", "filename": "gcc/ada/sem_ch5.adb", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fsem_ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fsem_ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch5.adb?ref=7f37fff1a17d12538973f68be49ba3d6030a495d", "patch": "@@ -30,6 +30,7 @@ with Einfo;    use Einfo;\n with Errout;   use Errout;\n with Expander; use Expander;\n with Exp_Ch6;  use Exp_Ch6;\n+with Exp_Ch7;  use Exp_Ch7;\n with Exp_Util; use Exp_Util;\n with Freeze;   use Freeze;\n with Ghost;    use Ghost;\n@@ -1959,6 +1960,16 @@ package body Sem_Ch5 is\n                 Name                =>\n                   New_Copy_Tree (Iter_Name, New_Sloc => Loc));\n \n+            --  Create a transient scope to ensure that all the temporaries\n+            --  generated by Remove_Side_Effects as part of processing this\n+            --  renaming declaration (if any) are attached by Insert_Actions\n+            --  to it. It has no effect on the generated code if no actions\n+            --  are added to it (see Wrap_Transient_Declaration).\n+\n+            if Expander_Active then\n+               Establish_Transient_Scope (Name (Decl), Sec_Stack => True);\n+            end if;\n+\n             Insert_Actions (Parent (Parent (N)), New_List (Decl));\n             Rewrite (Name (N), New_Occurrence_Of (Id, Loc));\n             Set_Etype (Id, Typ);"}, {"sha": "2fa6253df374137b4d56d3a6f1961a1055555c0d", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f37fff1a17d12538973f68be49ba3d6030a495d/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=7f37fff1a17d12538973f68be49ba3d6030a495d", "patch": "@@ -2346,9 +2346,9 @@ package body Sem_Util is\n          return Id;\n       end Get_Function_Id;\n \n-      ---------------------------\n-      -- Preanalyze_Expression --\n-      ---------------------------\n+      -------------------------------\n+      -- Preanalyze_Without_Errors --\n+      -------------------------------\n \n       procedure Preanalyze_Without_Errors (N : Node_Id) is\n          Status : constant Boolean := Get_Ignore_Errors;"}]}