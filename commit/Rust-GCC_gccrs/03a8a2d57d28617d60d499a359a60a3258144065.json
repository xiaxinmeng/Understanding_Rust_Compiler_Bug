{"sha": "03a8a2d57d28617d60d499a359a60a3258144065", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDNhOGEyZDU3ZDI4NjE3ZDYwZDQ5OWEzNTlhNjBhMzI1ODE0NDA2NQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-06-24T08:43:55Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2013-06-24T08:43:55Z"}, "message": "[multiple changes]\n\n2013-06-24  Steven G. Kargl  <sgk@troutmask.apl.washington.edu>\n            Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n            Dominique d'Humieres  <dominiq@lps.ens.fr>\n\n        PR fortran/52413\n        * simplify.c (gfc_simplify_fraction): Fix the sign of negative values.\n\n2013-06-24  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n            Dominique d'Humieres  <dominiq@lps.ens.fr>\n\n        PR fortran/52413\n        * gfortran.dg/fraction.f90: New.\n\nFrom-SVN: r200361", "tree": {"sha": "db39bceb30087cec7331a7840449e4014461dc94", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db39bceb30087cec7331a7840449e4014461dc94"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/03a8a2d57d28617d60d499a359a60a3258144065", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03a8a2d57d28617d60d499a359a60a3258144065", "html_url": "https://github.com/Rust-GCC/gccrs/commit/03a8a2d57d28617d60d499a359a60a3258144065", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/03a8a2d57d28617d60d499a359a60a3258144065/comments", "author": null, "committer": null, "parents": [{"sha": "7ae346c340a76c3bd83db101c72a2deb7a98ea5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ae346c340a76c3bd83db101c72a2deb7a98ea5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ae346c340a76c3bd83db101c72a2deb7a98ea5d"}], "stats": {"total": 50, "additions": 48, "deletions": 2}, "files": [{"sha": "60097dbe12b550673e7e69737eb5ec5acdc19199", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=03a8a2d57d28617d60d499a359a60a3258144065", "patch": "@@ -1,5 +1,13 @@\n+2013-06-24  Steven G. Kargl  <sgk@troutmask.apl.washington.edu>\n+\t    Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\t    Dominique d'Humieres  <dominiq@lps.ens.fr>\n+\n+\tPR fortran/52413\n+\t* simplify.c (gfc_simplify_fraction): Fix the sign of negative values.\n+\n 2013-06-21  Tobias Burnus  <burnus@net-b.de>\n \n+\tPR fortran/37336\n \t* trans-array.c (gfc_trans_deferred_array): Call the\n \tfinalizer for nonallocatable local variables.\n \t* trans-decl.c (gfc_get_symbol_decl): Add local"}, {"sha": "41e1dfbe87f4738aa62907cf90fbc7f004311d50", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 18, "deletions": 2, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=03a8a2d57d28617d60d499a359a60a3258144065", "patch": "@@ -2342,16 +2342,26 @@ gfc_expr *\n gfc_simplify_fraction (gfc_expr *x)\n {\n   gfc_expr *result;\n+\n+#if MPFR_VERSION < MPFR_VERSION_NUM(3,1,0)\n   mpfr_t absv, exp, pow2;\n+#else\n+  mpfr_exp_t e;\n+#endif\n \n   if (x->expr_type != EXPR_CONSTANT)\n     return NULL;\n \n   result = gfc_get_constant_expr (BT_REAL, x->ts.kind, &x->where);\n \n+#if MPFR_VERSION < MPFR_VERSION_NUM(3,1,0)\n+\n+  /* MPFR versions before 3.1.0 do not include mpfr_frexp.  \n+     TODO: remove the kludge when MPFR 3.1.0 or newer will be required */\n+\n   if (mpfr_sgn (x->value.real) == 0)\n     {\n-      mpfr_set_ui (result->value.real, 0, GFC_RND_MODE);\n+      mpfr_set (result->value.real, x->value.real, GFC_RND_MODE);\n       return result;\n     }\n \n@@ -2368,10 +2378,16 @@ gfc_simplify_fraction (gfc_expr *x)\n \n   mpfr_ui_pow (pow2, 2, exp, GFC_RND_MODE);\n \n-  mpfr_div (result->value.real, absv, pow2, GFC_RND_MODE);\n+  mpfr_div (result->value.real, x->value.real, pow2, GFC_RND_MODE);\n \n   mpfr_clears (exp, absv, pow2, NULL);\n \n+#else\n+\n+  mpfr_frexp (&e, result->value.real, x->value.real, GFC_RND_MODE);\n+\n+#endif\n+\n   return range_check (result, \"FRACTION\");\n }\n "}, {"sha": "d130644e58ad87330489c756bfde7a51a6adc6ae", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=03a8a2d57d28617d60d499a359a60a3258144065", "patch": "@@ -1,3 +1,9 @@\n+2013-06-24  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\t    Dominique d'Humieres  <dominiq@lps.ens.fr>\n+\n+\tPR fortran/52413\n+\t* gfortran.dg/fraction.f90: New.\n+\n 2013-06-24  Alan Modra  <amodra@gmail.com>\n \n \t* gcc.target/powerpc/altivec-consts.c: Correct for little-endian.\n@@ -30,6 +36,7 @@\n \n 2013-06-21  Tobias Burnus  <burnus@net-b.de>\n \n+\tPR fortran/37336\n \t* gfortran.dg/finalize_17.f90: New.\n \n 2013-06-21  Tobias Burnus  <burnus@net-b.de>"}, {"sha": "7a981118e0aa0c80fc380b6672606a46e633f8d5", "filename": "gcc/testsuite/gfortran.dg/fraction.f90", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ftestsuite%2Fgfortran.dg%2Ffraction.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/03a8a2d57d28617d60d499a359a60a3258144065/gcc%2Ftestsuite%2Fgfortran.dg%2Ffraction.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ffraction.f90?ref=03a8a2d57d28617d60d499a359a60a3258144065", "patch": "@@ -0,0 +1,15 @@\n+! { dg-do run }\n+!\n+! Test for pr52413\n+!\n+\n+program test_frac\n+\n+  real :: y\n+  y=fraction (-2.0) \n+  if (fraction (-2.0) /= -0.5) call abort ()\n+  if (fraction (-0.0) /= 0.0) call abort ()\n+  if (sign(1.0, fraction(-0.0)) /= -1.0) call abort ()\n+  if (fraction (-2.0_8) /=  -0.5) call abort ()\n+\n+end program test_frac"}]}