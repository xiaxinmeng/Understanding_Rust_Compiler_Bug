{"sha": "bfff9190695b229b6d0c9432e4c0f4b12401841d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmZmZjkxOTA2OTViMjI5YjZkMGM5NDMyZTRjMGY0YjEyNDAxODQxZA==", "commit": {"author": {"name": "Seongbae Park", "email": "seongbae.park@gmail.com", "date": "2007-06-18T20:49:23Z"}, "committer": {"name": "Seongbae Park", "email": "spark@gcc.gnu.org", "date": "2007-06-18T20:49:23Z"}, "message": "re PR middle-end/32321 (ICE in df_refs_verify with -fgcse-sm)\n\n2007-06-18  Seongbae Park  <seongbae.park@gmail.com>\n\n\tPR rtl-optimization/32321\n\t* gcse.c (replace_store_insn): Update the note before\n\tcalling emit_insn_after.\n\nFrom-SVN: r125827", "tree": {"sha": "d389cd31a3929555328650e9fcad1777bd249ca0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d389cd31a3929555328650e9fcad1777bd249ca0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bfff9190695b229b6d0c9432e4c0f4b12401841d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfff9190695b229b6d0c9432e4c0f4b12401841d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bfff9190695b229b6d0c9432e4c0f4b12401841d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfff9190695b229b6d0c9432e4c0f4b12401841d/comments", "author": null, "committer": null, "parents": [{"sha": "aacc93b5cae884a2396093f0f357404745b32a7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aacc93b5cae884a2396093f0f357404745b32a7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aacc93b5cae884a2396093f0f357404745b32a7c"}], "stats": {"total": 31, "additions": 20, "deletions": 11}, "files": [{"sha": "6cc09bd22f236c0b5157dc2217e5d92b785c4dd5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfff9190695b229b6d0c9432e4c0f4b12401841d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfff9190695b229b6d0c9432e4c0f4b12401841d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bfff9190695b229b6d0c9432e4c0f4b12401841d", "patch": "@@ -1,3 +1,9 @@\n+2007-06-18  Seongbae Park  <seongbae.park@gmail.com>\n+\n+\tPR rtl-optimization/32321\n+\t* gcse.c (replace_store_insn): Update the note before\n+\tcalling emit_insn_after.\n+\n 2007-06-18  David Daney  <ddaney@avtrex.com\n \n \tRevert:"}, {"sha": "8278714cefea420fa329fac315b222bf4aa0f2c4", "filename": "gcc/gcse.c", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bfff9190695b229b6d0c9432e4c0f4b12401841d/gcc%2Fgcse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bfff9190695b229b6d0c9432e4c0f4b12401841d/gcc%2Fgcse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcse.c?ref=bfff9190695b229b6d0c9432e4c0f4b12401841d", "patch": "@@ -6341,17 +6341,6 @@ replace_store_insn (rtx reg, rtx del, basic_block bb, struct ls_expr *smexpr)\n \n   mem = smexpr->pattern;\n   insn = gen_move_insn (reg, SET_SRC (single_set (del)));\n-  insn = emit_insn_after (insn, del);\n-\n-  if (dump_file)\n-    {\n-      fprintf (dump_file,\n-\t       \"STORE_MOTION  delete insn in BB %d:\\n      \", bb->index);\n-      print_inline_rtx (dump_file, del, 6);\n-      fprintf (dump_file, \"\\nSTORE MOTION  replaced with insn:\\n      \");\n-      print_inline_rtx (dump_file, insn, 6);\n-      fprintf (dump_file, \"\\n\");\n-    }\n \n   for (ptr = ANTIC_STORE_LIST (smexpr); ptr; ptr = XEXP (ptr, 1))\n     if (XEXP (ptr, 0) == del)\n@@ -6379,6 +6368,20 @@ replace_store_insn (rtx reg, rtx del, basic_block bb, struct ls_expr *smexpr)\n       XEXP (note, 0) = insn;\n     }\n \n+  /* Emit the insn AFTER all the notes are transferred.\n+     This is cheaper since we avoid df rescanning for the note change.  */\n+  insn = emit_insn_after (insn, del);\n+\n+  if (dump_file)\n+    {\n+      fprintf (dump_file,\n+\t       \"STORE_MOTION  delete insn in BB %d:\\n      \", bb->index);\n+      print_inline_rtx (dump_file, del, 6);\n+      fprintf (dump_file, \"\\nSTORE MOTION  replaced with insn:\\n      \");\n+      print_inline_rtx (dump_file, insn, 6);\n+      fprintf (dump_file, \"\\n\");\n+    }\n+\n   delete_insn (del);\n \n   /* Now we must handle REG_EQUAL notes whose contents is equal to the mem;"}]}