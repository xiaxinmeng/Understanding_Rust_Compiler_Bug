{"sha": "0741e2aff181cddb7235b45dc3102ebc76815aa3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDc0MWUyYWZmMTgxY2RkYjcyMzViNDVkYzMxMDJlYmM3NjgxNWFhMw==", "commit": {"author": {"name": "Andrew Haley", "email": "aph@redhat.com", "date": "2007-12-18T14:06:15Z"}, "committer": {"name": "Andrew Haley", "email": "aph@gcc.gnu.org", "date": "2007-12-18T14:06:15Z"}, "message": "re PR java/27643 (ICE in java_mark_cni_decl_local compiling bytecode->native)\n\n2007-12-18  Andrew Haley  <aph@redhat.com>\n\n        PR java/27643\n        * jcf-parse.c (java_parse_file): Remove call to\n        java_mark_class_local.\n        (parse_class_file): Reinstate call to java_mark_class_local here.\n        * decl.c (java_mark_cni_decl_local): If the ASSEMBLER_NAME is\n        already set, call java_mangle_decl() and make_decl_rtl() to\n        rewrite its name as a hidden alias.\n\nFrom-SVN: r131036", "tree": {"sha": "9bce766e3768b6f93b5136c4fb071bceb45fa58e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9bce766e3768b6f93b5136c4fb071bceb45fa58e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0741e2aff181cddb7235b45dc3102ebc76815aa3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0741e2aff181cddb7235b45dc3102ebc76815aa3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0741e2aff181cddb7235b45dc3102ebc76815aa3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0741e2aff181cddb7235b45dc3102ebc76815aa3/comments", "author": {"login": "theRealAph", "id": 254637, "node_id": "MDQ6VXNlcjI1NDYzNw==", "avatar_url": "https://avatars.githubusercontent.com/u/254637?v=4", "gravatar_id": "", "url": "https://api.github.com/users/theRealAph", "html_url": "https://github.com/theRealAph", "followers_url": "https://api.github.com/users/theRealAph/followers", "following_url": "https://api.github.com/users/theRealAph/following{/other_user}", "gists_url": "https://api.github.com/users/theRealAph/gists{/gist_id}", "starred_url": "https://api.github.com/users/theRealAph/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/theRealAph/subscriptions", "organizations_url": "https://api.github.com/users/theRealAph/orgs", "repos_url": "https://api.github.com/users/theRealAph/repos", "events_url": "https://api.github.com/users/theRealAph/events{/privacy}", "received_events_url": "https://api.github.com/users/theRealAph/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ae0bce62c6dbce0a5bf288b63dc569de8ba657ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae0bce62c6dbce0a5bf288b63dc569de8ba657ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae0bce62c6dbce0a5bf288b63dc569de8ba657ad"}], "stats": {"total": 40, "additions": 27, "deletions": 13}, "files": [{"sha": "5d4f2732c2dfc77bc6e05e680fe4a36de125c09e", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0741e2aff181cddb7235b45dc3102ebc76815aa3/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0741e2aff181cddb7235b45dc3102ebc76815aa3/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=0741e2aff181cddb7235b45dc3102ebc76815aa3", "patch": "@@ -1,3 +1,13 @@\n+2007-12-18  Andrew Haley  <aph@redhat.com>\n+\n+\tPR java/27643\n+\t* jcf-parse.c (java_parse_file): Remove call to\n+\tjava_mark_class_local.\n+\t(parse_class_file): Reinstate call to java_mark_class_local here.\n+\t* decl.c (java_mark_cni_decl_local): If the ASSEMBLER_NAME is\n+\talready set, call java_mangle_decl() and make_decl_rtl() to\n+\trewrite its name as a hidden alias.\n+\n 2007-12-15  Alexandre Oliva  <aoliva@redhat.com>\n \n \tPR debug/7081"}, {"sha": "1f0dbf46de6a0abd81a70f2667aa9a22dd6ff9b0", "filename": "gcc/java/decl.c", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0741e2aff181cddb7235b45dc3102ebc76815aa3/gcc%2Fjava%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0741e2aff181cddb7235b45dc3102ebc76815aa3/gcc%2Fjava%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fdecl.c?ref=0741e2aff181cddb7235b45dc3102ebc76815aa3", "patch": "@@ -1890,18 +1890,27 @@ java_mark_decl_local (tree decl)\n static void\n java_mark_cni_decl_local (tree decl)\n {\n-  /* Setting DECL_LOCAL_CNI_METHOD_P changes the behavior of the mangler.\n-     We expect that we should not yet have referenced this decl in a \n-     context that requires it.  Check this invariant even if we don't have\n-     support for hidden aliases.  */\n-  gcc_assert (!DECL_ASSEMBLER_NAME_SET_P (decl));\n-\n #if !defined(HAVE_GAS_HIDDEN) || !defined(ASM_OUTPUT_DEF)\n   return;\n #endif\n \n   DECL_VISIBILITY (decl) = VISIBILITY_HIDDEN;\n   DECL_LOCAL_CNI_METHOD_P (decl) = 1;\n+\n+  /* Setting DECL_LOCAL_CNI_METHOD_P changes the behavior of the\n+     mangler.  We might have already referenced this native method and\n+     therefore created its name, but even if we have it won't hurt.\n+     We'll just go via its externally visible name, rather than its\n+     hidden alias.  However, we must force things so that the correct\n+     mangling is done.  */\n+\n+  if (DECL_ASSEMBLER_NAME_SET_P (decl))\n+    java_mangle_decl (decl);\n+  if (DECL_RTL_SET_P (decl))\n+    {\n+      SET_DECL_RTL (decl, 0);\n+      make_decl_rtl (decl);\n+    }\n }\n \n /* Use the preceding two functions and mark all members of the class.  */"}, {"sha": "67590a49a59620024a7102101eb8e6e96b2aec98", "filename": "gcc/java/jcf-parse.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0741e2aff181cddb7235b45dc3102ebc76815aa3/gcc%2Fjava%2Fjcf-parse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0741e2aff181cddb7235b45dc3102ebc76815aa3/gcc%2Fjava%2Fjcf-parse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fjcf-parse.c?ref=0741e2aff181cddb7235b45dc3102ebc76815aa3", "patch": "@@ -1596,6 +1596,8 @@ parse_class_file (void)\n   file_start_location = input_location;\n   (*debug_hooks->start_source_file) (input_line, input_filename);\n \n+  java_mark_class_local (current_class);\n+\n   gen_indirect_dispatch_tables (current_class);\n \n   for (method = TYPE_METHODS (current_class);\n@@ -1967,13 +1969,6 @@ java_parse_file (int set_yydebug ATTRIBUTE_UNUSED)\n \t}\n     }\n \n-  /* Do this before lowering any code.  */\n-  for (node = current_file_list; node; node = TREE_CHAIN (node))\n-    {\n-      if (CLASS_FILE_P (node))\n-\tjava_mark_class_local (TREE_TYPE (node));\n-    }\n-\n   for (node = current_file_list; node; node = TREE_CHAIN (node))\n     {\n       input_location = DECL_SOURCE_LOCATION (node);"}]}