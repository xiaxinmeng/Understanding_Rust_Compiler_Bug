{"sha": "dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGNhY2ZhMDRmZTY3YTRmMGM5NTdkMGIzN2UwYzc1MGQyMDM2ZDM0ZA==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@wolery.cumb.org", "date": "2000-07-13T04:40:23Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2000-07-13T04:40:23Z"}, "message": "final.c (profile_function): Do not emit profile counters in the data section, if NO_PROFILE_COUNTERS is defined.\n\n\t* final.c (profile_function): Do not emit profile counters in\n\tthe data section, if NO_PROFILE_COUNTERS is defined.\n\t* tm.texi: Document NO_PROFILE_COUNTERS.  Update doc for\n\tFUNCTION_PROFILER.\n\n\t* config/i386/linux.h (NO_PROFILE_COUNTERS): Define.\n\t(FUNCTION_PROFILER): Just emit a call to mcount.\n\nFrom-SVN: r35005", "tree": {"sha": "368fea8b37e9a35afe1a0e8331dd2883719c3905", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/368fea8b37e9a35afe1a0e8331dd2883719c3905"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/comments", "author": null, "committer": null, "parents": [{"sha": "6e993bdb628abac7f0400cc068c5a03e1897840d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e993bdb628abac7f0400cc068c5a03e1897840d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e993bdb628abac7f0400cc068c5a03e1897840d"}], "stats": {"total": 32, "additions": 21, "deletions": 11}, "files": [{"sha": "38638132d4b7d72e054e425db2669ce3719c67a3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "patch": "@@ -1,3 +1,13 @@\n+2000-07-12  Zack Weinberg  <zack@wolery.cumb.org>\n+\n+\t* final.c (profile_function): Do not emit profile counters in\n+\tthe data section, if NO_PROFILE_COUNTERS is defined.\n+\t* tm.texi: Document NO_PROFILE_COUNTERS.  Update doc for\n+\tFUNCTION_PROFILER.\n+\n+\t* config/i386/linux.h (NO_PROFILE_COUNTERS): Define.\n+\t(FUNCTION_PROFILER): Just emit a call to mcount.\n+\n 2000-07-12  Zack Weinberg  <zack@wolery.cumb.org>\n \n \t* tradcpp.c (main): Rename 'perror' label to 'sys_error'."}, {"sha": "9cb332c30961ebcaf886cf7d9f80e4519328a3a4", "filename": "gcc/config/i386/linux.h", "status": "modified", "additions": 7, "deletions": 11, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/gcc%2Fconfig%2Fi386%2Flinux.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/gcc%2Fconfig%2Fi386%2Flinux.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Flinux.h?ref=dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "patch": "@@ -54,23 +54,19 @@ Boston, MA 02111-1307, USA.  */\n #undef DBX_REGISTER_NUMBER\n #define DBX_REGISTER_NUMBER(n)  svr4_dbx_register_map[n]\n \n-/* Output assembler code to FILE to increment profiler label # LABELNO\n-   for profiling a function entry.  */\n+/* Output assembler code to FILE to call the profiler.\n+   To the best of my knowledge, no Linux libc has required the label\n+   argument to mcount.  */\n+\n+#define NO_PROFILE_COUNTERS\n \n #undef FUNCTION_PROFILER\n #define FUNCTION_PROFILER(FILE, LABELNO)  \\\n {\t\t\t\t\t\t\t\t\t\\\n   if (flag_pic)\t\t\t\t\t\t\t\t\\\n-    {\t\t\t\t\t\t\t\t\t\\\n-      fprintf (FILE, \"\\tleal %sP%d@GOTOFF(%%ebx),%%edx\\n\",\t\t\\\n-\t       LPREFIX, (LABELNO));\t\t\t\t\t\\\n-      fprintf (FILE, \"\\tcall *mcount@GOT(%%ebx)\\n\");\t\t\t\\\n-    }\t\t\t\t\t\t\t\t\t\\\n+    fprintf (FILE, \"\\tcall\\t*mcount@GOT(%%ebx)\\n\");\t\t\t\\\n   else\t\t\t\t\t\t\t\t\t\\\n-    {\t\t\t\t\t\t\t\t\t\\\n-      fprintf (FILE, \"\\tmovl $%sP%d,%%edx\\n\", LPREFIX, (LABELNO));\t\\\n-      fprintf (FILE, \"\\tcall mcount\\n\");\t\t\t\t\\\n-    }\t\t\t\t\t\t\t\t\t\\\n+    fprintf (FILE, \"\\tcall\\tmcount\\n\");\t\t\t\t\t\\\n }\n \n #undef SIZE_TYPE"}, {"sha": "e655637644f097b3804fc9426ca8f8a31b204519", "filename": "gcc/final.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dcacfa04fe67a4f0c957d0b37e0c750d2036d34d/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=dcacfa04fe67a4f0c957d0b37e0c750d2036d34d", "patch": "@@ -1705,7 +1705,9 @@ static void\n profile_function (file)\n      FILE *file;\n {\n+#ifndef NO_PROFILE_COUNTERS\n   int align = MIN (BIGGEST_ALIGNMENT, LONG_TYPE_SIZE);\n+#endif\n #if defined(ASM_OUTPUT_REG_PUSH)\n #if defined(STRUCT_VALUE_INCOMING_REGNUM) || defined(STRUCT_VALUE_REGNUM)\n   int sval = current_function_returns_struct;\n@@ -1715,10 +1717,12 @@ profile_function (file)\n #endif\n #endif /* ASM_OUTPUT_REG_PUSH */\n \n+#ifndef NO_PROFILE_COUNTERS\n   data_section ();\n   ASM_OUTPUT_ALIGN (file, floor_log2 (align / BITS_PER_UNIT));\n   ASM_OUTPUT_INTERNAL_LABEL (file, \"LP\", profile_label_no);\n   assemble_integer (const0_rtx, LONG_TYPE_SIZE / BITS_PER_UNIT, 1);\n+#endif\n \n   function_section (current_function_decl);\n "}]}