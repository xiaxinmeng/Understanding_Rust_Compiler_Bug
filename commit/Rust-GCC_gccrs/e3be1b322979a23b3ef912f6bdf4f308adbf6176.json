{"sha": "e3be1b322979a23b3ef912f6bdf4f308adbf6176", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTNiZTFiMzIyOTc5YTIzYjNlZjkxMmY2YmRmNGYzMDhhZGJmNjE3Ng==", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-07-29T13:59:27Z"}, "committer": {"name": "Richard Kenner", "email": "kenner@gcc.gnu.org", "date": "1995-07-29T13:59:27Z"}, "message": "(truncdfsf2...\n\n(truncdfsf2, extendsfdf2, floatsidf2, fix_truncdfsi2): Allow register\nparameters, required by gcc to generate correct code.\n\nFrom-SVN: r10203", "tree": {"sha": "f9fe46e229e6a100763af1aa5a40959dbe385f83", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f9fe46e229e6a100763af1aa5a40959dbe385f83"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3be1b322979a23b3ef912f6bdf4f308adbf6176", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3be1b322979a23b3ef912f6bdf4f308adbf6176", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3be1b322979a23b3ef912f6bdf4f308adbf6176", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3be1b322979a23b3ef912f6bdf4f308adbf6176/comments", "author": null, "committer": null, "parents": [{"sha": "7e47602183a27467a1e4eaad6e14a9b450c298b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e47602183a27467a1e4eaad6e14a9b450c298b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e47602183a27467a1e4eaad6e14a9b450c298b8"}], "stats": {"total": 80, "additions": 64, "deletions": 16}, "files": [{"sha": "d23c2cd6657d87a6a8e0590689e56b3e609a4c1e", "filename": "gcc/config/pdp11/pdp11.md", "status": "modified", "additions": 64, "deletions": 16, "changes": 80, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3be1b322979a23b3ef912f6bdf4f308adbf6176/gcc%2Fconfig%2Fpdp11%2Fpdp11.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3be1b322979a23b3ef912f6bdf4f308adbf6176/gcc%2Fconfig%2Fpdp11%2Fpdp11.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpdp11%2Fpdp11.md?ref=e3be1b322979a23b3ef912f6bdf4f308adbf6176", "patch": "@@ -718,11 +718,24 @@\n ;;- truncation instructions\n \n (define_insn  \"truncdfsf2\"\n-  [(set (match_operand:SF 0 \"memory_operand\" \"=R,Q\")\n-\t(float_truncate:SF (match_operand:DF 1 \"register_operand\" \"a,a\")))]\n+  [(set (match_operand:SF 0 \"general_operand\" \"=r,R,Q\")\n+\t(float_truncate:SF (match_operand:DF 1 \"register_operand\" \"a,a,a\")))]\n   \"TARGET_FPU\"\n-  \"stcdf %1, %0\"\n-  [(set_attr \"length\" \"1,2\")])\n+  \"* if (which_alternative ==0)\n+     {\n+       output_asm_insn(\\\"stcdf %1, -(sp)\\\", operands);\n+       output_asm_insn(\\\"mov (sp)+, %0\\\", operands);\n+       operands[0] = gen_rtx(REG, HImode, REGNO (operands[0])+1);\n+       output_asm_insn(\\\"mov (sp)+, %0\\\", operands);\n+       return \\\"\\\";\n+     }\n+     else if (which_alternative == 1)\n+       return \\\"stcdf %1, %0\\\";\n+     else \n+       return \\\"stcdf %1, %0\\\";\n+  \"\n+  [(set_attr \"length\" \"3,1,2\")])\n+\n \n (define_expand \"truncsihi2\"\n   [(set (match_operand:HI 0 \"general_operand\" \"=g\")\n@@ -758,11 +771,14 @@\n ;;- sign extension instructions\n \n (define_insn \"extendsfdf2\"\n-  [(set (match_operand:DF 0 \"register_operand\" \"=a,a\")\n-\t(float_extend:SF (match_operand:SF 1 \"memory_operand\" \"R,Q\")))]\n+  [(set (match_operand:DF 0 \"register_operand\" \"=a,a,a\")\n+\t(float_extend:SF (match_operand:SF 1 \"general_operand\" \"r,R,Q\")))]\n   \"TARGET_FPU\"\n-  \"ldcfd %1, %0\"\n-  [(set_attr \"length\" \"1,2\")])\n+  \"@\n+   mov %1, -(sp)\\;ldcfd (sp)+,%0\n+   ldcfd %1, %0\n+   ldcfd %1, %0\"\n+  [(set_attr \"length\" \"2,1,2\")])\n \n ;; does movb sign extend in register-to-register move?\n (define_insn \"extendqihi2\"\n@@ -887,11 +903,29 @@\n ;; what do pdp library routines do to fpu mode ?\n \n (define_insn \"floatsidf2\"\n-  [(set (match_operand:DF 0 \"register_operand\" \"=a,a\")\n-\t(float:DF (match_operand:SI 1 \"memory_operand\" \"R,Q\")))]\n+  [(set (match_operand:DF 0 \"register_operand\" \"=a,a,a\")\n+\t(float:DF (match_operand:SI 1 \"general_operand\" \"r,R,Q\")))]\n   \"TARGET_FPU\"\n-  \"setl\\;ldcld %1, %0\\;seti\"\n-  [(set_attr \"length\" \"3,4\")])\n+  \"* if (which_alternative ==0)\n+     {\n+       rtx latehalf[2];\n+\n+       latehalf[0] = NULL; \n+       latehalf[1] = gen_rtx(REG, HImode, REGNO (operands[0])+1);\n+       output_asm_insn(\\\"mov %1, -(sp)\\\", latehalf);\n+       output_asm_insn(\\\"mov %1, -(sp)\\\", operands);\n+       \n+       output_asm_insn(\\\"setl\\\", operands);\n+       output_asm_insn(\\\"ldcld (sp)+, %0\\\", operands);\n+       output_asm_insn(\\\"seti\\\", operands);\n+       return \\\"\\\";\n+     }\n+     else if (which_alternative == 1)\n+       return \\\"setl\\;ldcld %1, %0\\;seti\\\";\n+     else \n+       return \\\"setl\\;ldcld %1, %0\\;seti\\\";\n+  \"\n+  [(set_attr \"length\" \"5,3,4\")])\n \n (define_insn \"floathidf2\"\n   [(set (match_operand:DF 0 \"register_operand\" \"=a,a\")\n@@ -902,11 +936,25 @@\n \t\n ;; cut float to int\n (define_insn \"fix_truncdfsi2\"\n-  [(set (match_operand:SI 0 \"memory_operand\" \"=R,Q\")\n-\t(fix:SI (fix:DF (match_operand:DF 1 \"register_operand\" \"a,a\"))))]\n+  [(set (match_operand:SI 0 \"general_operand\" \"=r,R,Q\")\n+\t(fix:SI (fix:DF (match_operand:DF 1 \"register_operand\" \"a,a,a\"))))]\n   \"TARGET_FPU\"\n-  \"setl\\;stcdl %1, %0\\;seti\"\n-  [(set_attr \"length\" \"3,4\")])\n+  \"* if (which_alternative ==0)\n+     {\n+       output_asm_insn(\\\"setl\\\", operands);\n+       output_asm_insn(\\\"stcdl %1, -(sp)\\\", operands);\n+       output_asm_insn(\\\"seti\\\", operands);\n+       output_asm_insn(\\\"mov (sp)+, %0\\\", operands);\n+       operands[0] = gen_rtx(REG, HImode, REGNO (operands[0])+1);\n+       output_asm_insn(\\\"mov (sp)+, %0\\\", operands);\n+       return \\\"\\\";\n+     }\n+     else if (which_alternative == 1)\n+       return \\\"setl\\;stcdl %1, %0\\;seti\\\";\n+     else \n+       return \\\"setl\\;stcdl %1, %0\\;seti\\\";\n+  \"\n+  [(set_attr \"length\" \"5,3,4\")])\n \n (define_insn \"fix_truncdfhi2\"\n   [(set (match_operand:HI 0 \"general_operand\" \"=rR,Q\")"}]}