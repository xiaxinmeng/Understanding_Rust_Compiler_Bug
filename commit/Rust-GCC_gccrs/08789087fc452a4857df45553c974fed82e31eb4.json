{"sha": "08789087fc452a4857df45553c974fed82e31eb4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDg3ODkwODdmYzQ1MmE0ODU3ZGY0NTU1M2M5NzRmZWQ4MmUzMWViNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-08-28T16:08:57Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-08-28T16:08:57Z"}, "message": "re PR fortran/22244 (dimension information is lost for multi-dimension array)\n\n\tPR fortran/22244\n\t* Make-lang.in (fortran/trans-types.o): Depend on $(FLAGS_H).\n\t* trans-types.c: Include flags.h.\n\t(gfc_get_nodesc_array_type): Add TYPE_DECL TYPE_NAME with\n\tcorrect bounds and dimensions for packed arrays.\n\nFrom-SVN: r127864", "tree": {"sha": "1e0e4e601cb96fefb0fce70c3fd21e29665cf079", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e0e4e601cb96fefb0fce70c3fd21e29665cf079"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/08789087fc452a4857df45553c974fed82e31eb4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08789087fc452a4857df45553c974fed82e31eb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08789087fc452a4857df45553c974fed82e31eb4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08789087fc452a4857df45553c974fed82e31eb4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "92d0af977fea398604540282f2ff2789dd525eaa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92d0af977fea398604540282f2ff2789dd525eaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92d0af977fea398604540282f2ff2789dd525eaa"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "dffd31ea69aefbe7d08745039373f0e6b937c064", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08789087fc452a4857df45553c974fed82e31eb4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08789087fc452a4857df45553c974fed82e31eb4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=08789087fc452a4857df45553c974fed82e31eb4", "patch": "@@ -1,3 +1,11 @@\n+2007-08-28  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/22244\n+\t* Make-lang.in (fortran/trans-types.o): Depend on $(FLAGS_H).\n+\t* trans-types.c: Include flags.h.\n+\t(gfc_get_nodesc_array_type): Add TYPE_DECL TYPE_NAME with\n+\tcorrect bounds and dimensions for packed arrays.\n+\n 2007-08-27  Tobias Burnus  <burnus@net-b.de>\n \n \t* simplify.c (gfc_simplify_lgamma): Fix mpfr_lgamma call."}, {"sha": "30320a848100d01817fffb8b30c938d7496b554c", "filename": "gcc/fortran/Make-lang.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08789087fc452a4857df45553c974fed82e31eb4/gcc%2Ffortran%2FMake-lang.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08789087fc452a4857df45553c974fed82e31eb4/gcc%2Ffortran%2FMake-lang.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FMake-lang.in?ref=08789087fc452a4857df45553c974fed82e31eb4", "patch": "@@ -311,7 +311,7 @@ fortran/trans-decl.o: $(GFORTRAN_TRANS_DEPS) gt-fortran-trans-decl.h \\\n   $(CGRAPH_H) $(TARGET_H) $(FUNCTION_H) $(FLAGS_H) $(RTL_H) $(TREE_GIMPLE_H) \\\n   $(TREE_DUMP_H)\n fortran/trans-types.o: $(GFORTRAN_TRANS_DEPS) gt-fortran-trans-types.h \\\n-  $(REAL_H) toplev.h $(TARGET_H)\n+  $(REAL_H) toplev.h $(TARGET_H) $(FLAGS_H)\n fortran/trans-const.o: $(GFORTRAN_TRANS_DEPS)\n fortran/trans-expr.o: $(GFORTRAN_TRANS_DEPS) fortran/dependency.h\n fortran/trans-stmt.o: $(GFORTRAN_TRANS_DEPS) fortran/dependency.h"}, {"sha": "b7c9c53bf215c48806b3243cce642ea15acdc2a2", "filename": "gcc/fortran/trans-types.c", "status": "modified", "additions": 20, "deletions": 1, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08789087fc452a4857df45553c974fed82e31eb4/gcc%2Ffortran%2Ftrans-types.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08789087fc452a4857df45553c974fed82e31eb4/gcc%2Ffortran%2Ftrans-types.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-types.c?ref=08789087fc452a4857df45553c974fed82e31eb4", "patch": "@@ -36,6 +36,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"trans-types.h\"\n #include \"trans-const.h\"\n #include \"real.h\"\n+#include \"flags.h\"\n \f\n \n #if (GFC_MAX_DIMENSIONS < 10)\n@@ -1232,7 +1233,7 @@ gfc_get_nodesc_array_type (tree etype, gfc_array_spec * as, gfc_packed packed)\n     {\n       /* Fill in the stride and bound components of the type.  */\n       if (known_stride)\n-\ttmp =  gfc_conv_mpz_to_tree (stride, gfc_index_integer_kind);\n+\ttmp = gfc_conv_mpz_to_tree (stride, gfc_index_integer_kind);\n       else\n         tmp = NULL_TREE;\n       GFC_TYPE_ARRAY_STRIDE (type, n) = tmp;\n@@ -1330,6 +1331,24 @@ gfc_get_nodesc_array_type (tree etype, gfc_array_spec * as, gfc_packed packed)\n   mpz_clear (stride);\n   mpz_clear (delta);\n \n+  /* In debug info represent packed arrays as multi-dimensional\n+     if they have rank > 1 and with proper bounds, instead of flat\n+     arrays.  */\n+  if (known_stride && write_symbols != NO_DEBUG)\n+    {\n+      tree gtype = etype, rtype, type_decl;\n+\n+      for (n = as->rank - 1; n >= 0; n--)\n+\t{\n+\t  rtype = build_range_type (gfc_array_index_type,\n+\t\t\t\t    GFC_TYPE_ARRAY_LBOUND (type, n),\n+\t\t\t\t    GFC_TYPE_ARRAY_UBOUND (type, n));\n+\t  gtype = build_array_type (gtype, rtype);\n+\t}\n+      TYPE_NAME (type) = type_decl = build_decl (TYPE_DECL, NULL, gtype);\n+      DECL_ORIGINAL_TYPE (type_decl) = gtype;\n+    }\n+\n   if (packed != PACKED_STATIC || !known_stride)\n     {\n       /* For dummy arrays and automatic (heap allocated) arrays we"}]}