{"sha": "b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjUzYzFiOWNlMmMwNWE5Yzk4MmJjYmRiODQzNGFlMTY3ZjAxNDE2MQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-06-17T15:41:23Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-06-17T15:41:23Z"}, "message": "[multiple changes]\n\n2010-06-17  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch12.adb (Mark_Context): Refine placement of Withed_Body flag, so\n\tthat it marks a unit as needed by a spec only if the corresponding\n\tinstantiation appears in that spec (and not in the corresponding body).\n\t* sem_elim.adb (Check_Eliminated): If we are within a subunit, the name\n\tin the pragma Eliminate has been parsed as a child unit, but the\n\tcurrent compilation unit is in fact the parent in which the subunit is\n\tembedded.\n\n2010-06-17  Vincent Celier  <celier@adacore.com>\n\n\t* gnat_rm.texi: Fix typo\n\nFrom-SVN: r160928", "tree": {"sha": "c9234148fb1bfbf46332ac69fdffbe947d0dcd6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c9234148fb1bfbf46332ac69fdffbe947d0dcd6b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/comments", "author": null, "committer": null, "parents": [{"sha": "7a78fa979e331eb8d04b3b62563c0b8e75706858", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a78fa979e331eb8d04b3b62563c0b8e75706858", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a78fa979e331eb8d04b3b62563c0b8e75706858"}], "stats": {"total": 77, "additions": 53, "deletions": 24}, "files": [{"sha": "d472b28d32310c7ffc233017ddb69069490c8258", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "patch": "@@ -1,3 +1,17 @@\n+2010-06-17  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch12.adb (Mark_Context): Refine placement of Withed_Body flag, so\n+\tthat it marks a unit as needed by a spec only if the corresponding\n+\tinstantiation appears in that spec (and not in the corresponding body).\n+\t* sem_elim.adb (Check_Eliminated): If we are within a subunit, the name\n+\tin the pragma Eliminate has been parsed as a child unit, but the\n+\tcurrent compilation unit is in fact the parent in which the subunit is\n+\tembedded.\n+\n+2010-06-17  Vincent Celier  <celier@adacore.com>\n+\n+\t* gnat_rm.texi: Fix typo\n+\n 2010-06-17  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_util.adb: Minor reformatting"}, {"sha": "8e226c6e5cbdb2f7eb9f5649e7a0481cf2880bc6", "filename": "gcc/ada/gnat_rm.texi", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2Fgnat_rm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2Fgnat_rm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat_rm.texi?ref=b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "patch": "@@ -16271,7 +16271,7 @@ be copied.  The directory must exist, must be distinct from the project's\n object directory and source directories of all projects in the project tree,\n and must be writable.\n \n-@item  Library_Src_Dir\n+@item  Library_ALI_Dir\n Expression must be a path name. The attribute defines the\n directory in which the ALI files of a Library will\n be copied.  The directory must exist, must be distinct from the project's"}, {"sha": "b9ff3b97fda650e19ae6d8e32e7d3952ee76ac64", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 6, "deletions": 22, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "patch": "@@ -10388,11 +10388,16 @@ package body Sem_Ch12 is\n    ------------------\n \n    procedure Mark_Context (Inst_Decl : Node_Id; Gen_Decl : Node_Id) is\n-      Inst_CU : constant Unit_Number_Type := Get_Source_Unit (Inst_Decl);\n+      Inst_CU : constant Unit_Number_Type := Get_Code_Unit   (Inst_Decl);\n       Gen_CU  : constant Unit_Number_Type := Get_Source_Unit (Gen_Decl);\n       Clause  : Node_Id;\n \n    begin\n+      --  Note that we use Get_Code_Unit to determine the position of the\n+      --  instantiation, because it may itself appear within another instance\n+      --  and we need to mark the context of the enclosing unit, not that of\n+      --  the unit that contains the corresponding generic.\n+\n       Clause := First (Context_Items (Cunit (Inst_CU)));\n       while Present (Clause) loop\n          if Nkind (Clause) = N_With_Clause\n@@ -10403,27 +10408,6 @@ package body Sem_Ch12 is\n \n          Next (Clause);\n       end loop;\n-\n-      --  If the instance appears within another instantiated unit, check\n-      --  whether it appears in the main unit, and indicate the need for\n-      --  the body of the enclosing instance as well.\n-\n-      if In_Extended_Main_Code_Unit (Inst_Decl)\n-        and then Instantiation_Location (Sloc (Inst_Decl)) /= No_Location\n-        and then Present (Library_Unit (Cunit (Main_Unit)))\n-        and then Cunit (Inst_CU) /= Library_Unit (Cunit (Main_Unit))\n-      then\n-         Clause := First (Context_Items (Library_Unit (Cunit (Main_Unit))));\n-         while Present (Clause) loop\n-            if Nkind (Clause) = N_With_Clause\n-              and then  Library_Unit (Clause) = Cunit (Gen_CU)\n-            then\n-               Set_Withed_Body (Clause, Cunit (Gen_CU));\n-            end if;\n-\n-            Next (Clause);\n-         end loop;\n-      end if;\n    end Mark_Context;\n \n    ---------------------"}, {"sha": "ecc4ed6e71235b3aa43c0b0c95d3abdca5a393d4", "filename": "gcc/ada/sem_elim.adb", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2Fsem_elim.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b53c1b9ce2c05a9c982bcbdb8434ae167f014161/gcc%2Fada%2Fsem_elim.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_elim.adb?ref=b53c1b9ce2c05a9c982bcbdb8434ae167f014161", "patch": "@@ -234,6 +234,7 @@ package body Sem_Elim is\n       Elmt : Access_Elim_Data;\n       Scop : Entity_Id;\n       Form : Entity_Id;\n+      Up   : Nat;\n \n    begin\n       if No_Elimination then\n@@ -292,7 +293,37 @@ package body Sem_Elim is\n \n             --  Now see if compilation unit matches\n \n-            for J in reverse Elmt.Unit_Name'Range loop\n+            Up := Elmt.Unit_Name'Last;\n+\n+            --  If we are within a subunit, the name in the pragma  has been\n+            --  parsed as a child unit, but the current compilation unit is\n+            --  in fact the parent in which the subunit is embedded. We must\n+            --  skip the first name which is that of the subunit to match\n+            --  the pragma specification.\n+\n+            declare\n+               Par : Node_Id;\n+\n+            begin\n+               Par := Parent (E);\n+               while Present (Par) loop\n+                  if Nkind (Par) = N_Subunit then\n+                     if Chars (Defining_Unit_Name (Proper_Body (Par))) =\n+                                                         Elmt.Unit_Name (Up)\n+                     then\n+                        Up := Up - 1;\n+                        exit;\n+\n+                     else\n+                        goto Continue;\n+                     end if;\n+                  end if;\n+\n+                  Par := Parent (Par);\n+               end loop;\n+            end;\n+\n+            for J in reverse Elmt.Unit_Name'First .. Up loop\n                if Elmt.Unit_Name (J) /= Chars (Scop) then\n                   goto Continue;\n                end if;"}]}