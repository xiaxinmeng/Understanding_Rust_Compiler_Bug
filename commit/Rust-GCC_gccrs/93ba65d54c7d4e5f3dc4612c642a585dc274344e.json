{"sha": "93ba65d54c7d4e5f3dc4612c642a585dc274344e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTNiYTY1ZDU0YzdkNGU1ZjNkYzQ2MTJjNjQyYTU4NWRjMjc0MzQ0ZQ==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2019-07-09T07:53:35Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-09T07:53:35Z"}, "message": "[Ada] Fix scopes for local variables in task/protected bodies\n\nNo impact on compilation with GCC.\n\n2019-07-09  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_util.adb (Scope_Within_Or_Same): Handle properly task\n\tbodies and protected bodies, so that local variables within have\n\ttheir proper scopes after these constructs have been rewritten\n\tduring expansion. This patch resembles but is not identical to\n\tthe code in Scope_Within.\n\nFrom-SVN: r273269", "tree": {"sha": "d010ae08ae7acc4b163a25cd69faec0fee584229", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d010ae08ae7acc4b163a25cd69faec0fee584229"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/93ba65d54c7d4e5f3dc4612c642a585dc274344e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93ba65d54c7d4e5f3dc4612c642a585dc274344e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93ba65d54c7d4e5f3dc4612c642a585dc274344e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93ba65d54c7d4e5f3dc4612c642a585dc274344e/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9ae497cb69e5a944e29225a402883ad359d5c031", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ae497cb69e5a944e29225a402883ad359d5c031", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ae497cb69e5a944e29225a402883ad359d5c031"}], "stats": {"total": 33, "additions": 30, "deletions": 3}, "files": [{"sha": "c5fa67f17a6d1504290bb1e7f7a47d7520886f42", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/93ba65d54c7d4e5f3dc4612c642a585dc274344e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/93ba65d54c7d4e5f3dc4612c642a585dc274344e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=93ba65d54c7d4e5f3dc4612c642a585dc274344e", "patch": "@@ -1,3 +1,11 @@\n+2019-07-09  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_util.adb (Scope_Within_Or_Same): Handle properly task\n+\tbodies and protected bodies, so that local variables within have\n+\ttheir proper scopes after these constructs have been rewritten\n+\tduring expansion. This patch resembles but is not identical to\n+\tthe code in Scope_Within.\n+\n 2019-07-09  Arnaud Charlet  <charlet@adacore.com>\n \n \t* gnat1drv.adb (Adjust_Global_Switches): Set"}, {"sha": "7b7d04470c5905751cbe88f92e265f70d634665c", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 22, "deletions": 3, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/93ba65d54c7d4e5f3dc4612c642a585dc274344e/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/93ba65d54c7d4e5f3dc4612c642a585dc274344e/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=93ba65d54c7d4e5f3dc4612c642a585dc274344e", "patch": "@@ -24268,13 +24268,32 @@ package body Sem_Util is\n      (Inner : Entity_Id;\n       Outer : Entity_Id) return Boolean\n    is\n-      Curr : Entity_Id;\n-\n+      Curr : Entity_Id := Inner;\n    begin\n-      Curr := Inner;\n+      --  Similar to the above, but check for scope identity first.\n+\n       while Present (Curr) and then Curr /= Standard_Standard loop\n          if Curr = Outer then\n             return True;\n+\n+         elsif Ekind (Curr) = E_Task_Type\n+           and then Outer = Task_Body_Procedure (Curr)\n+         then\n+            return True;\n+\n+         elsif Is_Subprogram (Curr)\n+           and then Outer = Protected_Body_Subprogram (Curr)\n+         then\n+            return True;\n+\n+         elsif Is_Private_Type (Curr)\n+           and then Present (Full_View (Curr))\n+         then\n+            if Full_View (Curr) = Outer then\n+               return True;\n+            else\n+               return Scope_Within (Full_View (Curr), Outer);\n+            end if;\n          end if;\n \n          Curr := Scope (Curr);"}]}