{"sha": "1db54f4e49894663db378fe462590f7a91ae75ec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWRiNTRmNGU0OTg5NDY2M2RiMzc4ZmU0NjI1OTBmN2E5MWFlNzVlYw==", "commit": {"author": {"name": "Douglas Gregor", "email": "doug.gregor@gmail.com", "date": "2008-02-05T13:29:43Z"}, "committer": {"name": "Doug Gregor", "email": "dgregor@gcc.gnu.org", "date": "2008-02-05T13:29:43Z"}, "message": "re PR c++/35074 (ICE with attribute \"aligned\" for template classes)\n\n2008-02-05  Douglas Gregor  <doug.gregor@gmail.com>\n\n\tPR c++/35074\n\t* decl2.c (save_template_attributes): When we're modifying the\n\tTYPE_MAIN_VARIANT to add new attributes, be sure to also modify\n\tall of the other variants to add those same attributes. Otherwise,\n\tthe main variant will be inconsistent with those other variants.\n\t\n2008-02-05  Douglas Gregor  <doug.gregor@gmail.com>\n\n\tPR c++/35074\n\t* g++.dg/ext/attrib30.C: New.\n\nFrom-SVN: r132120", "tree": {"sha": "6e7ba93340a32ec6b5dfb7440327efee8a37079c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6e7ba93340a32ec6b5dfb7440327efee8a37079c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1db54f4e49894663db378fe462590f7a91ae75ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1db54f4e49894663db378fe462590f7a91ae75ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1db54f4e49894663db378fe462590f7a91ae75ec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1db54f4e49894663db378fe462590f7a91ae75ec/comments", "author": {"login": "DougGregor", "id": 989428, "node_id": "MDQ6VXNlcjk4OTQyOA==", "avatar_url": "https://avatars.githubusercontent.com/u/989428?v=4", "gravatar_id": "", "url": "https://api.github.com/users/DougGregor", "html_url": "https://github.com/DougGregor", "followers_url": "https://api.github.com/users/DougGregor/followers", "following_url": "https://api.github.com/users/DougGregor/following{/other_user}", "gists_url": "https://api.github.com/users/DougGregor/gists{/gist_id}", "starred_url": "https://api.github.com/users/DougGregor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/DougGregor/subscriptions", "organizations_url": "https://api.github.com/users/DougGregor/orgs", "repos_url": "https://api.github.com/users/DougGregor/repos", "events_url": "https://api.github.com/users/DougGregor/events{/privacy}", "received_events_url": "https://api.github.com/users/DougGregor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0f5098aef3678a7b6966a8bcabd7a4d05020fd23", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f5098aef3678a7b6966a8bcabd7a4d05020fd23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f5098aef3678a7b6966a8bcabd7a4d05020fd23"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "5ea0490684cc3d6b15b77f16f9073daae56d4aee", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1db54f4e49894663db378fe462590f7a91ae75ec/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1db54f4e49894663db378fe462590f7a91ae75ec/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1db54f4e49894663db378fe462590f7a91ae75ec", "patch": "@@ -1,3 +1,11 @@\n+2008-02-05  Douglas Gregor  <doug.gregor@gmail.com>\n+\n+\tPR c++/35074\n+\t* decl2.c (save_template_attributes): When we're modifying the\n+\tTYPE_MAIN_VARIANT to add new attributes, be sure to also modify\n+\tall of the other variants to add those same attributes. Otherwise,\n+\tthe main variant will be inconsistent with those other variants.\n+\t\n 2008-02-04  Richard Guenther  <rguenther@suse.de>\n \n \tPR java/35035"}, {"sha": "d2d81feae44d3158bc3bb00fde9f7fe0d735767d", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1db54f4e49894663db378fe462590f7a91ae75ec/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1db54f4e49894663db378fe462590f7a91ae75ec/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=1db54f4e49894663db378fe462590f7a91ae75ec", "patch": "@@ -1068,6 +1068,7 @@ save_template_attributes (tree *attr_p, tree *decl_p)\n {\n   tree late_attrs = splice_template_attributes (attr_p, *decl_p);\n   tree *q;\n+  tree old_attrs = NULL_TREE;\n \n   if (!late_attrs)\n     return;\n@@ -1090,9 +1091,26 @@ save_template_attributes (tree *attr_p, tree *decl_p)\n   else\n     q = &TYPE_ATTRIBUTES (*decl_p);\n \n-  if (*q)\n-    q = &TREE_CHAIN (tree_last (*q));\n+  old_attrs = *q;\n+\n+  /* Place the late attributes at the beginning of the attribute\n+     list.  */\n+  TREE_CHAIN (tree_last (late_attrs)) = *q;\n   *q = late_attrs;\n+\n+  if (!DECL_P (*decl_p) && *decl_p == TYPE_MAIN_VARIANT (*decl_p))\n+    {\n+      /* We've added new attributes directly to the main variant, so\n+\t now we need to update all of the other variants to include\n+\t these new attributes.  */\n+      tree variant;\n+      for (variant = TYPE_NEXT_VARIANT (*decl_p); variant;\n+\t   variant = TYPE_NEXT_VARIANT (variant))\n+\t{\n+\t  gcc_assert (TYPE_ATTRIBUTES (variant) == old_attrs);\n+\t  TYPE_ATTRIBUTES (variant) = TYPE_ATTRIBUTES (*decl_p);\n+\t}\n+    }\n }\n \n /* Like decl_attributes, but handle C++ complexity.  */"}, {"sha": "fd2826a60298de4960baaa822b5bb0a1e32263e5", "filename": "gcc/testsuite/g++.dg/ext/attrib30.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1db54f4e49894663db378fe462590f7a91ae75ec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattrib30.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1db54f4e49894663db378fe462590f7a91ae75ec/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattrib30.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fattrib30.C?ref=1db54f4e49894663db378fe462590f7a91ae75ec", "patch": "@@ -0,0 +1,8 @@\n+// { dg-do compile }\n+// PR c++/35074\n+template<typename T> struct A\n+{\n+  void foo() const;\n+} __attribute((aligned(4)));\n+\n+template<typename T> void A<T>::foo() const {}"}]}