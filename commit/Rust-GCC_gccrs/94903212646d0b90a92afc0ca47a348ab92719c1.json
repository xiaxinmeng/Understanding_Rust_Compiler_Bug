{"sha": "94903212646d0b90a92afc0ca47a348ab92719c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTQ5MDMyMTI2NDZkMGI5MGE5MmFmYzBjYTQ3YTM0OGFiOTI3MTljMQ==", "commit": {"author": {"name": "Fritz O. Reese", "email": "fritzoreese@gmail.com", "date": "2016-11-10T21:57:13Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2016-11-10T21:57:13Z"}, "message": "Fix ICE and improve errors for invalid anonymous structure declarations.\n\n\tPR fortran/78277\n\t* gcc/fortran/decl.c (gfc_match_data_decl): Gracefully handle bad\n\tanonymous structure declarations.\n\n\tPR fortran/78277\n\t* gcc/testsuite/gfortran.dg/dec_structure_17.f90: New test.\n\nFrom-SVN: r242058", "tree": {"sha": "14856b9dbfce8af631a0a5aa61b9970b2bca3a07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14856b9dbfce8af631a0a5aa61b9970b2bca3a07"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94903212646d0b90a92afc0ca47a348ab92719c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94903212646d0b90a92afc0ca47a348ab92719c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94903212646d0b90a92afc0ca47a348ab92719c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94903212646d0b90a92afc0ca47a348ab92719c1/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "05b8fcb4d2087c1544ebe3ad128711f12bcff022", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05b8fcb4d2087c1544ebe3ad128711f12bcff022", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05b8fcb4d2087c1544ebe3ad128711f12bcff022"}], "stats": {"total": 61, "additions": 60, "deletions": 1}, "files": [{"sha": "ae8f661ff534376b1d6617a24a1b234149be369d", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=94903212646d0b90a92afc0ca47a348ab92719c1", "patch": "@@ -1,3 +1,9 @@\n+2016-11-10  Fritz O. Reese <fritzoreese@gmail.com>\n+\n+\tPR fortran/78277\n+\t* gcc/fortran/decl.c (gfc_match_data_decl): Gracefully handle bad\n+\tanonymous structure declarations.\n+\n 2016-11-10  Fritz O. Reese <fritzoreese@gmail.com>\n \n \t* decl.c (get_struct_decl, gfc_match_map, gfc_match_union): Fix"}, {"sha": "bf6bc2467098558054cd58aaa07267164bd9b5b2", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=94903212646d0b90a92afc0ca47a348ab92719c1", "patch": "@@ -4901,7 +4901,28 @@ gfc_match_data_decl (void)\n     }\n \n   if (!gfc_error_flag_test ())\n-    gfc_error (\"Syntax error in data declaration at %C\");\n+    {\n+      /* An anonymous structure declaration is unambiguous; if we matched one\n+\t according to gfc_match_structure_decl, we need to return MATCH_YES\n+\t here to avoid confusing the remaining matchers, even if there was an\n+\t error during variable_decl.  We must flush any such errors.  Note this\n+\t causes the parser to gracefully continue parsing the remaining input\n+\t as a structure body, which likely follows.  */\n+      if (current_ts.type == BT_DERIVED && current_ts.u.derived\n+\t  && gfc_fl_struct (current_ts.u.derived->attr.flavor))\n+\t{\n+\t  gfc_error_now (\"Syntax error in anonymous structure declaration\"\n+\t\t\t \" at %C\");\n+\t  /* Skip the bad variable_decl and line up for the start of the\n+\t     structure body.  */\n+\t  gfc_error_recovery ();\n+\t  m = MATCH_YES;\n+\t  goto cleanup;\n+\t}\n+\n+      gfc_error (\"Syntax error in data declaration at %C\");\n+    }\n+\n   m = MATCH_ERROR;\n \n   gfc_free_data_all (gfc_current_ns);"}, {"sha": "e16fdde8db969bc7f76897752e481edc41e8d08b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=94903212646d0b90a92afc0ca47a348ab92719c1", "patch": "@@ -1,3 +1,8 @@\n+2016-11-10  Fritz O. Reese <fritzoreese@gmail.com>\n+\n+\tPR fortran/78277\n+\t* gfortran.dg/dec_structure_17.f90: New test.\n+\n 2016-11-10  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* gcc.target/powerpc/vsx-qimode.c: New test for QImode, HImode"}, {"sha": "18d3193e2f0db599a29126c7dee61d9887b4a606", "filename": "gcc/testsuite/gfortran.dg/dec_structure_17.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_structure_17.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94903212646d0b90a92afc0ca47a348ab92719c1/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_structure_17.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_structure_17.f90?ref=94903212646d0b90a92afc0ca47a348ab92719c1", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do compile }\n+! { dg-options \"-fdec-structure\" }\n+!\n+! PR fortran/78277\n+!\n+! Fix ICE for invalid structure declaration code.\n+!\n+\n+subroutine sub1()\n+  structure /s/\n+    structure t\n+      integer i\n+    end structure\n+  end structure\n+  record /s/ u\n+  interface\n+    subroutine sub0(u)\n+      structure /s/\n+        structure t. ! { dg-error \"Syntax error in anonymous structure decl\" }\n+          integer i\n+        end structure\n+      end structure\n+      record /s/ u\n+    end\n+  end interface\n+  call sub0(u)\n+end"}]}