{"sha": "f74433e70ae94a3b5291e45fea488b1cfdee4a34", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjc0NDMzZTcwYWU5NGEzYjUyOTFlNDVmZWE0ODhiMWNmZGVlNGEzNA==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-08-18T13:21:18Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-08-18T13:24:22Z"}, "message": "Fortran: Add OpenMP's nothing directive support\n\nFortran version of commit 5079b7781a2c506dcdfb241347d74c7891268225\n\ngcc/fortran/ChangeLog:\n\n\t* match.h (gfc_match_omp_nothing): New.\n\t* openmp.c (gfc_match_omp_nothing): New.\n\t* parse.c (decode_omp_directive): Match 'nothing' directive.\n\ngcc/testsuite/ChangeLog:\n\n\t* gfortran.dg/nothing-1.f90: New test.\n\t* gfortran.dg/nothing-2.f90: New test.", "tree": {"sha": "86caeb8480d332f032516f9191bdd42847a65944", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/86caeb8480d332f032516f9191bdd42847a65944"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f74433e70ae94a3b5291e45fea488b1cfdee4a34", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f74433e70ae94a3b5291e45fea488b1cfdee4a34", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f74433e70ae94a3b5291e45fea488b1cfdee4a34", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f74433e70ae94a3b5291e45fea488b1cfdee4a34/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "be4a4fb516688d7cfe28a80a4aa333f4ecf0b518", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be4a4fb516688d7cfe28a80a4aa333f4ecf0b518", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be4a4fb516688d7cfe28a80a4aa333f4ecf0b518"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "5127b4b8ea3563b3ee032210c915159800a713b6", "filename": "gcc/fortran/match.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ffortran%2Fmatch.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ffortran%2Fmatch.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.h?ref=f74433e70ae94a3b5291e45fea488b1cfdee4a34", "patch": "@@ -175,6 +175,7 @@ match gfc_match_omp_masked_taskloop_simd (void);\n match gfc_match_omp_master (void);\n match gfc_match_omp_master_taskloop (void);\n match gfc_match_omp_master_taskloop_simd (void);\n+match gfc_match_omp_nothing (void);\n match gfc_match_omp_ordered (void);\n match gfc_match_omp_ordered_depend (void);\n match gfc_match_omp_parallel (void);"}, {"sha": "fd219dc9c4d7e13758495a0e511ee26238c6d512", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=f74433e70ae94a3b5291e45fea488b1cfdee4a34", "patch": "@@ -4797,6 +4797,17 @@ gfc_match_omp_ordered (void)\n   return match_omp (EXEC_OMP_ORDERED, OMP_ORDERED_CLAUSES);\n }\n \n+match\n+gfc_match_omp_nothing (void)\n+{\n+  if (gfc_match_omp_eos () != MATCH_YES)\n+    {\n+      gfc_error (\"Unexpected junk after $OMP NOTHING statement at %C\");\n+      return MATCH_ERROR;\n+    }\n+  /* Will use ST_NONE; therefore, no EXEC_OMP_ is needed.  */\n+  return MATCH_YES;\n+}\n \n match\n gfc_match_omp_ordered_depend (void)"}, {"sha": "d004732677cfaec03aaec862ee01872ce8edb56e", "filename": "gcc/fortran/parse.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ffortran%2Fparse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ffortran%2Fparse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.c?ref=f74433e70ae94a3b5291e45fea488b1cfdee4a34", "patch": "@@ -1005,6 +1005,9 @@ decode_omp_directive (void)\n \t      ST_OMP_MASTER_TASKLOOP);\n       matcho (\"master\", gfc_match_omp_master, ST_OMP_MASTER);\n       break;\n+    case 'n':\n+      matcho (\"nothing\", gfc_match_omp_nothing, ST_NONE);\n+      break;\n     case 'l':\n       matcho (\"loop\", gfc_match_omp_loop, ST_OMP_LOOP);\n       break;"}, {"sha": "9fc24d4bd6ca8fbc0cf3ee8235bd14abee91708e", "filename": "gcc/testsuite/gfortran.dg/nothing-1.f90", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ftestsuite%2Fgfortran.dg%2Fnothing-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ftestsuite%2Fgfortran.dg%2Fnothing-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fnothing-1.f90?ref=f74433e70ae94a3b5291e45fea488b1cfdee4a34", "patch": "@@ -0,0 +1,28 @@\n+module m\n+  implicit none (type, external)\n+  !$omp nothing\n+\n+  type t\n+    !$omp nothing\n+    integer s\n+  end type\n+\n+contains\n+\n+integer function foo (i)\n+  integer :: i\n+\n+  !$omp nothing\n+  if (.false.) &\n+& &    !$omp nothing\n+    i = i + 1\n+\n+! In the following, '& & !$' is not a valid OpenMP sentinel and,\n+! hence, the line is regarded as comment\n+  if (.false.) &\n+&   & !$omp nothing\n+    then\n+  end if\n+  foo = i\n+end\n+end module"}, {"sha": "74a4a5a22b0f78b720e1b91b47d6ac4915b92945", "filename": "gcc/testsuite/gfortran.dg/nothing-2.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ftestsuite%2Fgfortran.dg%2Fnothing-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f74433e70ae94a3b5291e45fea488b1cfdee4a34/gcc%2Ftestsuite%2Fgfortran.dg%2Fnothing-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fnothing-2.f90?ref=f74433e70ae94a3b5291e45fea488b1cfdee4a34", "patch": "@@ -0,0 +1,7 @@\n+pure subroutine foo\n+  !$omp nothing  ! { dg-error \"OpenMP directives other than SIMD or DECLARE TARGET at .1. may not appear in PURE procedures\" }\n+end subroutine\n+\n+subroutine bar\n+  !$omp nothing foo  ! { dg-error \"Unexpected junk after $OMP NOTHING statement\" }\n+end"}]}