{"sha": "b195d84561a5c31108c7bbbd7c5b63fe3cebe35f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjE5NWQ4NDU2MWE1YzMxMTA4YzdiYmJkN2M1YjYzZmUzY2ViZTM1Zg==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-06-01T08:41:04Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2021-06-01T13:23:58Z"}, "message": "Fix sanity checking of global_options.\n\ngcc/c-family/ChangeLog:\n\n\tPR other/100759\n\t* c-attribs.c (handle_optimize_attribute): Limit sanity check\n\tto a situation where we are not in processing of an optimize\n\tpragma.\n\t* c-pragma.c (handle_pragma_pop_options): Restore target\n\toptions.", "tree": {"sha": "e78b61b941106ea3846215f2102c5946e2800399", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e78b61b941106ea3846215f2102c5946e2800399"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9f7bc160b4a0f27dce248d1226e3ae7104b0e67b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f7bc160b4a0f27dce248d1226e3ae7104b0e67b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f7bc160b4a0f27dce248d1226e3ae7104b0e67b"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "156f7b3e8e1b3ddcb16324b1e6c252374d7c5660", "filename": "gcc/c-family/c-attribs.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f/gcc%2Fc-family%2Fc-attribs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f/gcc%2Fc-family%2Fc-attribs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-attribs.c?ref=b195d84561a5c31108c7bbbd7c5b63fe3cebe35f", "patch": "@@ -5389,7 +5389,11 @@ handle_optimize_attribute (tree *node, tree name, tree args,\n       /* If we previously had some optimization options, use them as the\n \t default.  */\n       gcc_options *saved_global_options = NULL;\n-      if (flag_checking)\n+\n+      /* When #pragma GCC optimize pragma is used, it modifies global_options\n+\t without calling targetm.override_options_after_change.  That can leave\n+\t target flags inconsistent for comparison.  */\n+      if (flag_checking && optimization_current_node == optimization_default_node)\n \t{\n \t  saved_global_options = XNEW (gcc_options);\n \t  *saved_global_options = global_options;"}, {"sha": "f46b5b93c29ae342d66a077ddbc63b01077b5bd5", "filename": "gcc/c-family/c-pragma.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f/gcc%2Fc-family%2Fc-pragma.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b195d84561a5c31108c7bbbd7c5b63fe3cebe35f/gcc%2Fc-family%2Fc-pragma.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-pragma.c?ref=b195d84561a5c31108c7bbbd7c5b63fe3cebe35f", "patch": "@@ -1088,6 +1088,8 @@ handle_pragma_pop_options (cpp_reader *ARG_UNUSED(dummy))\n    * overwritten by invoke_set_current_function_hook.  */\n   cl_optimization_restore (&global_options, &global_options_set,\n \t\t\t   TREE_OPTIMIZATION (p->optimize_binary));\n+  cl_target_option_restore (&global_options, &global_options_set,\n+\t\t\t    TREE_TARGET_OPTION (p->target_binary));\n \n   if (p->optimize_binary != optimization_current_node)\n     {"}]}