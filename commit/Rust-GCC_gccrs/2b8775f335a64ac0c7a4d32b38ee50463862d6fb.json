{"sha": "2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmI4Nzc1ZjMzNWE2NGFjMGM3YTRkMzJiMzhlZTUwNDYzODYyZDZmYg==", "commit": {"author": {"name": "Ira Rosen", "email": "irar@il.ibm.com", "date": "2008-05-14T12:28:53Z"}, "committer": {"name": "Ira Rosen", "email": "irar@gcc.gnu.org", "date": "2008-05-14T12:28:53Z"}, "message": "re PR tree-optimization/36098 (435.gromacs miscompares at -O3)\n\n\tPR tree-optimization/36098\n\t* tree-vect-analyze.c (vect_analyze_group_access): Set the gap\n\tvalue for the first load in the group in case of a gap.\n\t(vect_build_slp_tree): Check that there are no gaps in loads.\n\nFrom-SVN: r135290", "tree": {"sha": "c7ff13c57cdad9e84c367b272fa1e312faad8a01", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7ff13c57cdad9e84c367b272fa1e312faad8a01"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/comments", "author": {"login": "irar2", "id": 16818592, "node_id": "MDQ6VXNlcjE2ODE4NTky", "avatar_url": "https://avatars.githubusercontent.com/u/16818592?v=4", "gravatar_id": "", "url": "https://api.github.com/users/irar2", "html_url": "https://github.com/irar2", "followers_url": "https://api.github.com/users/irar2/followers", "following_url": "https://api.github.com/users/irar2/following{/other_user}", "gists_url": "https://api.github.com/users/irar2/gists{/gist_id}", "starred_url": "https://api.github.com/users/irar2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/irar2/subscriptions", "organizations_url": "https://api.github.com/users/irar2/orgs", "repos_url": "https://api.github.com/users/irar2/repos", "events_url": "https://api.github.com/users/irar2/events{/privacy}", "received_events_url": "https://api.github.com/users/irar2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d70dcf2945e7e09446f3a03f1b12ced3543f9d33", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d70dcf2945e7e09446f3a03f1b12ced3543f9d33", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d70dcf2945e7e09446f3a03f1b12ced3543f9d33"}], "stats": {"total": 69, "additions": 58, "deletions": 11}, "files": [{"sha": "9e151ea6984c4964119cda86bf39cfc893b48830", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "patch": "@@ -1,3 +1,10 @@\n+2008-05-14  Ira Rosen  <irar@il.ibm.com>\n+\n+\tPR tree-optimization/36098\n+\t* tree-vect-analyze.c (vect_analyze_group_access): Set the gap\n+\tvalue for the first load in the group in case of a gap.\n+\t(vect_build_slp_tree): Check that there are no gaps in loads.\n+\n 2008-05-14  Kenneth Zadeck <zadeck@naturalbridge.com>\n \n \t* doc/rtl.texi: Removed reference to REG_NO_CONFLICT notes."}, {"sha": "bd147b45a52cb9ac9e1d9a2c8ef72165ec7c2830", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "patch": "@@ -1,3 +1,9 @@\n+2008-05-14  Ira Rosen  <irar@il.ibm.com>\n+\n+\tPR tree-optimization/36098\t\n+\t* gcc.dg/vect/vect.exp: Compile with -O3 all the tests named \"O3-*\".\n+\t* gcc.dg/vect/O3-pr36098.c: New test.\n+\n 2008-05-14  Samuel Tardieu  <sam@rfc1149.net>\n \n \t* gnat.dg/old_errors.ads, gnat.dg/old_errors.adb: New."}, {"sha": "1c445be9e204a07b82b2402e0a07869145f068a2", "filename": "gcc/testsuite/gcc.dg/vect/O3-pr36098.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2FO3-pr36098.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2FO3-pr36098.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2FO3-pr36098.c?ref=2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target vect_int } */\n+\n+typedef struct {\n+  int iatom[3];\n+  int blocknr;\n+} t_sortblock;\n+\n+#define DIM 3\n+\n+void foo (int ncons, t_sortblock *sb, int *iatom)\n+{\n+ int i, m;\n+\n+ for(i=0; (i<ncons); i++,iatom+=3)\n+   for(m=0; (m<DIM); m++)\n+     iatom[m]=sb[i].iatom[m];\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"vectorizing stmts using SLP\" 1 \"vect\" { xfail *-*-* } } } */\n+/* { dg-final { cleanup-tree-dump \"vect\" } } */\n+"}, {"sha": "2fb14b1b08ea041414f65784d3c61547a212a84c", "filename": "gcc/testsuite/gcc.dg/vect/vect.exp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect.exp?ref=2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "patch": "@@ -245,7 +245,7 @@ dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/Os-vect-*.\\[cS\\]]]  \\\n # With -O3\n set DEFAULT_VECTCFLAGS $SAVED_DEFAULT_VECTCFLAGS\n lappend DEFAULT_VECTCFLAGS \"-O3\"\n-dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/O3-vect-*.\\[cS\\]]]  \\\n+dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/O3-*.\\[cS\\]]]  \\\n         \"\" $DEFAULT_VECTCFLAGS\n \n # With -O1"}, {"sha": "1e2012f85d19c53bc498460757e31e1de7ef08e8", "filename": "gcc/tree-vect-analyze.c", "status": "modified", "additions": 22, "deletions": 10, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftree-vect-analyze.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2b8775f335a64ac0c7a4d32b38ee50463862d6fb/gcc%2Ftree-vect-analyze.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-analyze.c?ref=2b8775f335a64ac0c7a4d32b38ee50463862d6fb", "patch": "@@ -2230,7 +2230,13 @@ vect_analyze_group_access (struct data_reference *dr)\n       if (dr_step != count_in_bytes)\n         {\n           if (DR_IS_READ (dr))\n-            slp_impossible = true;\n+            {\n+              slp_impossible = true;\n+              /* There is a gap after the last load in the group. This gap is a\n+                 difference between the stride and the number of elements. When \n+                 there is no gap, this difference should be 0.  */ \n+              DR_GROUP_GAP (vinfo_for_stmt (stmt)) = stride - count; \n+            }\n           else\n             {\n               if (vect_print_dump_info (REPORT_DETAILS))\n@@ -2644,7 +2650,7 @@ vect_build_slp_tree (loop_vec_info loop_vinfo, slp_tree *node,\n   enum machine_mode vec_mode;\n   tree first_stmt_const_oprnd = NULL_TREE;\n   struct data_reference *first_dr;\n- \n+\n   /* For every stmt in NODE find its def stmt/s.  */\n   for (i = 0; VEC_iterate (tree, stmts, i, stmt); i++)\n     {\n@@ -2776,15 +2782,17 @@ vect_build_slp_tree (loop_vec_info loop_vinfo, slp_tree *node,\n \t\tif (i == 0)\n \t\t  {\n \t\t    /* First stmt of the SLP group should be the first load of \n-\t\t       the interleaving loop if data permutation is not \n-\t\t       allowed.  */\n-\t\t    if  (DR_GROUP_FIRST_DR (vinfo_for_stmt (stmt)) != stmt) \n+\t\t       the interleaving loop if data permutation is not allowed.\n+\t\t       Check that there is no gap between the loads.  */\n+\t\t    if (DR_GROUP_FIRST_DR (vinfo_for_stmt (stmt)) != stmt\n+                        || DR_GROUP_GAP (vinfo_for_stmt (stmt)) != 0) \n \t\t      {\n-\t\t\t/* FORNOW: data permutations are not supported.  */\n+\t\t\t/* FORNOW: data permutations and gaps in loads are not \n+                           supported.  */\n \t\t\tif (vect_print_dump_info (REPORT_SLP)) \n \t\t\t  {\n \t\t\t    fprintf (vect_dump, \"Build SLP failed: strided \"\n-\t\t\t\t     \" loads need permutation \");\n+\t\t\t\t     \" loads need permutation or have gaps \");\n \t\t\t    print_generic_expr (vect_dump, stmt, TDF_SLIM);\n \t\t\t  }\n \n@@ -2811,13 +2819,17 @@ vect_build_slp_tree (loop_vec_info loop_vinfo, slp_tree *node,\n \t\t  }\n \t\telse\n \t\t  {\n-\t\t    if (DR_GROUP_NEXT_DR (vinfo_for_stmt (prev_stmt)) != stmt)\n+                    /* Check that we have consecutive loads from interleaving\n+                       chain and that there is no gap between the loads.  */\n+\t\t    if (DR_GROUP_NEXT_DR (vinfo_for_stmt (prev_stmt)) != stmt\n+                        || DR_GROUP_GAP (vinfo_for_stmt (stmt)) != 1)\n \t\t      {\n-\t\t\t/* FORNOW: data permutations are not supported.  */\n+\t\t\t/* FORNOW: data permutations and gaps in loads are not\n+                           supported.  */\n \t\t\tif (vect_print_dump_info (REPORT_SLP)) \n \t\t\t  {\n \t\t\t    fprintf (vect_dump, \"Build SLP failed: strided \"\n-\t\t\t\t     \" loads need permutation \");\n+\t\t\t\t     \" loads need permutation or have gaps \");\n \t\t\t    print_generic_expr (vect_dump, stmt, TDF_SLIM);\n \t\t\t  }\n \t\t\treturn false;"}]}