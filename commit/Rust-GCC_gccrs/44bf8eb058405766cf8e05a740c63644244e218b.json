{"sha": "44bf8eb058405766cf8e05a740c63644244e218b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRiZjhlYjA1ODQwNTc2NmNmOGUwNWE3NDBjNjM2NDQyNDRlMjE4Yg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-10-11T10:07:06Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-10-11T10:07:06Z"}, "message": "[multiple changes]\n\n2010-10-11  Arnaud Charlet  <charlet@adacore.com>\n\n\t* sem_ch3.adb, exp_ch6.adb\n\t(Make_Build_In_Place_Call_In_Anonymous_Context,\n\tMake_Build_In_Place_Call_In_Assignment,\n\tMake_Build_In_Place_Call_In_Object_Declaration): Fix calls to\n\tAdd_Task_Actuals_To_Build_In_Place_Call in case of No_Task_Hierarchy\n\trestriction.\n\t(Access_Definition): Add missing handling of No_Task_Hierarchy.\n\n2010-10-11  Javier Miranda  <miranda@adacore.com>\n\n\t* exp_util.adb (Remove_Side_Effects): No action needed for renamings of\n\tclass-wide expressions.\n\nFrom-SVN: r165293", "tree": {"sha": "ea3db1ae3135a8af79bd7e6657e739ecfc21ef62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ea3db1ae3135a8af79bd7e6657e739ecfc21ef62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44bf8eb058405766cf8e05a740c63644244e218b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44bf8eb058405766cf8e05a740c63644244e218b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44bf8eb058405766cf8e05a740c63644244e218b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44bf8eb058405766cf8e05a740c63644244e218b/comments", "author": null, "committer": null, "parents": [{"sha": "cead616d5659c95f8981a1b1f735fa7aea02de0f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cead616d5659c95f8981a1b1f735fa7aea02de0f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cead616d5659c95f8981a1b1f735fa7aea02de0f"}], "stats": {"total": 41, "additions": 37, "deletions": 4}, "files": [{"sha": "6401df7ffe4c903cae708209cd5c4ab745a619d0", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=44bf8eb058405766cf8e05a740c63644244e218b", "patch": "@@ -1,3 +1,18 @@\n+2010-10-11  Arnaud Charlet  <charlet@adacore.com>\n+\n+\t* sem_ch3.adb, exp_ch6.adb\n+\t(Make_Build_In_Place_Call_In_Anonymous_Context,\n+\tMake_Build_In_Place_Call_In_Assignment,\n+\tMake_Build_In_Place_Call_In_Object_Declaration): Fix calls to\n+\tAdd_Task_Actuals_To_Build_In_Place_Call in case of No_Task_Hierarchy\n+\trestriction.\n+\t(Access_Definition): Add missing handling of No_Task_Hierarchy.\n+\n+2010-10-11  Javier Miranda  <miranda@adacore.com>\n+\n+\t* exp_util.adb (Remove_Side_Effects): No action needed for renamings of\n+\tclass-wide expressions.\n+\n 2010-10-11  Arnaud Charlet  <charlet@adacore.com>\n \n \t* xr_tabls.adb, sem_res.adb: Minor reformatting"}, {"sha": "bd365801fda127acec568751fd56c7f05ccac09a", "filename": "gcc/ada/exp_ch6.adb", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2Fexp_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2Fexp_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch6.adb?ref=44bf8eb058405766cf8e05a740c63644244e218b", "patch": "@@ -475,15 +475,21 @@ package body Exp_Ch6 is\n       Master_Actual : Node_Id)\n       --  Note: Master_Actual can be Empty, but only if there are no tasks\n    is\n-      Loc               : constant Source_Ptr := Sloc (Function_Call);\n-\n+      Loc    : constant Source_Ptr := Sloc (Function_Call);\n+      Actual : Node_Id := Master_Actual;\n    begin\n       --  No such extra parameters are needed if there are no tasks\n \n       if not Has_Task (Etype (Function_Id)) then\n          return;\n       end if;\n \n+      --  Use a dummy _master actual in case of No_Task_Hierarchy\n+\n+      if Restriction_Active (No_Task_Hierarchy) then\n+         Actual := New_Occurrence_Of (RTE (RE_Library_Task_Level), Loc);\n+      end if;\n+\n       --  The master\n \n       declare\n@@ -493,13 +499,13 @@ package body Exp_Ch6 is\n \n          Master_Formal := Build_In_Place_Formal (Function_Id, BIP_Master);\n \n-         Analyze_And_Resolve (Master_Actual, Etype (Master_Formal));\n+         Analyze_And_Resolve (Actual, Etype (Master_Formal));\n \n          --  Build the parameter association for the new actual and add it to\n          --  the end of the function's actuals.\n \n          Add_Extra_Actual_To_Call\n-           (Function_Call, Master_Formal, Master_Actual);\n+           (Function_Call, Master_Formal, Actual);\n       end;\n \n       --  The activation chain"}, {"sha": "980f0f6e80b3edc30fd58f8bf2c285e46fc0634c", "filename": "gcc/ada/exp_util.adb", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2Fexp_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2Fexp_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.adb?ref=44bf8eb058405766cf8e05a740c63644244e218b", "patch": "@@ -4839,6 +4839,17 @@ package body Exp_Util is\n          return;\n       end if;\n \n+      --  No action needed for renamings of class-wide expressions because for\n+      --  class-wide types Remove_Side_Effects uses a renaming to capture the\n+      --  expression (and hence we would generate a never-ending loop in the\n+      --  frontend).\n+\n+      if Is_Class_Wide_Type (Exp_Type)\n+         and then Nkind (Parent (Exp)) = N_Object_Renaming_Declaration\n+      then\n+         return;\n+      end if;\n+\n       --  All this must not have any checks\n \n       Scope_Suppress := (others => True);"}, {"sha": "29f28b002375605dc1441b06a260554e71d5d31a", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44bf8eb058405766cf8e05a740c63644244e218b/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=44bf8eb058405766cf8e05a740c63644244e218b", "patch": "@@ -884,6 +884,7 @@ package body Sem_Ch3 is\n \n          elsif Has_Task (Desig_Type)\n            and then Comes_From_Source (Related_Nod)\n+           and then not Restriction_Active (No_Task_Hierarchy)\n          then\n             if not Has_Master_Entity (Current_Scope) then\n                Decl :="}]}