{"sha": "76680678a8e6e41ed64b816c65298d3366ad7345", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY2ODA2NzhhOGU2ZTQxZWQ2NGI4MTZjNjUyOThkMzM2NmFkNzM0NQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2015-12-09T10:13:35Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2015-12-09T10:13:35Z"}, "message": "Fix GOMP/GOACC_parallel handling in find_func_clobbers\n\n2015-12-09  Tom de Vries  <tom@codesourcery.com>\n\n\tPR tree-optimization/68716\n\t* tree-ssa-structalias.c (find_func_clobbers): Fix handling of\n\tBUILT_IN_GOMP_PARALLEL and BUILT_IN_GOACC_PARALLEL.\n\n\t* testsuite/libgomp.c/omp-nested-2.c: New test.\n\nFrom-SVN: r231449", "tree": {"sha": "9490d31f79d7a751c44230d9503851d7573246b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9490d31f79d7a751c44230d9503851d7573246b4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/76680678a8e6e41ed64b816c65298d3366ad7345", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76680678a8e6e41ed64b816c65298d3366ad7345", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76680678a8e6e41ed64b816c65298d3366ad7345", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76680678a8e6e41ed64b816c65298d3366ad7345/comments", "author": null, "committer": null, "parents": [{"sha": "74fbae9278d935f5623498edc2235fcbba4f9578", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74fbae9278d935f5623498edc2235fcbba4f9578", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74fbae9278d935f5623498edc2235fcbba4f9578"}], "stats": {"total": 62, "additions": 61, "deletions": 1}, "files": [{"sha": "82607d19ad4f5bbed46e7e76a3840019f68f2a6c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76680678a8e6e41ed64b816c65298d3366ad7345/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76680678a8e6e41ed64b816c65298d3366ad7345/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=76680678a8e6e41ed64b816c65298d3366ad7345", "patch": "@@ -1,3 +1,9 @@\n+2015-12-09  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR tree-optimization/68716\n+\t* tree-ssa-structalias.c (find_func_clobbers): Fix handling of\n+\tBUILT_IN_GOMP_PARALLEL and BUILT_IN_GOACC_PARALLEL.\n+\n 2015-12-09  Martin Liska  <mliska@suse.cz>\n \n \t* hash-traits.h (struct typed_delete_remove): New function."}, {"sha": "15e351ebe592b8ab85c0d7dce360a5f9dfe2a64c", "filename": "gcc/tree-ssa-structalias.c", "status": "modified", "additions": 46, "deletions": 1, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76680678a8e6e41ed64b816c65298d3366ad7345/gcc%2Ftree-ssa-structalias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76680678a8e6e41ed64b816c65298d3366ad7345/gcc%2Ftree-ssa-structalias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-structalias.c?ref=76680678a8e6e41ed64b816c65298d3366ad7345", "patch": "@@ -5082,7 +5082,52 @@ find_func_clobbers (struct function *fn, gimple *origt)\n \t    return;\n \t  case BUILT_IN_GOMP_PARALLEL:\n \t  case BUILT_IN_GOACC_PARALLEL:\n-\t    return;\n+\t    {\n+\t      unsigned int fnpos, argpos;\n+\t      switch (DECL_FUNCTION_CODE (decl))\n+\t\t{\n+\t\tcase BUILT_IN_GOMP_PARALLEL:\n+\t\t  /* __builtin_GOMP_parallel (fn, data, num_threads, flags).  */\n+\t\t  fnpos = 0;\n+\t\t  argpos = 1;\n+\t\t  break;\n+\t\tcase BUILT_IN_GOACC_PARALLEL:\n+\t\t  /* __builtin_GOACC_parallel (device, fn, mapnum, hostaddrs,\n+\t\t\t\t\t       sizes, kinds, ...).  */\n+\t\t  fnpos = 1;\n+\t\t  argpos = 3;\n+\t\t  break;\n+\t\tdefault:\n+\t\t  gcc_unreachable ();\n+\t\t}\n+\n+\t      tree fnarg = gimple_call_arg (t, fnpos);\n+\t      gcc_assert (TREE_CODE (fnarg) == ADDR_EXPR);\n+\t      tree fndecl = TREE_OPERAND (fnarg, 0);\n+\t      varinfo_t cfi = get_vi_for_tree (fndecl);\n+\n+\t      tree arg = gimple_call_arg (t, argpos);\n+\n+\t      /* Parameter passed by value is used.  */\n+\t      lhs = get_function_part_constraint (fi, fi_uses);\n+\t      struct constraint_expr *rhsp;\n+\t      get_constraint_for (arg, &rhsc);\n+\t      FOR_EACH_VEC_ELT (rhsc, j, rhsp)\n+\t\tprocess_constraint (new_constraint (lhs, *rhsp));\n+\t      rhsc.truncate (0);\n+\n+\t      /* The caller clobbers what the callee does.  */\n+\t      lhs = get_function_part_constraint (fi, fi_clobbers);\n+\t      rhs = get_function_part_constraint (cfi, fi_clobbers);\n+\t      process_constraint (new_constraint (lhs, rhs));\n+\n+\t      /* The caller uses what the callee does.  */\n+\t      lhs = get_function_part_constraint (fi, fi_uses);\n+\t      rhs = get_function_part_constraint (cfi, fi_uses);\n+\t      process_constraint (new_constraint (lhs, rhs));\n+\n+\t      return;\n+\t    }\n \t  /* printf-style functions may have hooks to set pointers to\n \t     point to somewhere into the generated string.  Leave them\n \t     for a later exercise...  */"}, {"sha": "1b12354a075c61b89c6ae8de10a1688d1f58a10e", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76680678a8e6e41ed64b816c65298d3366ad7345/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76680678a8e6e41ed64b816c65298d3366ad7345/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=76680678a8e6e41ed64b816c65298d3366ad7345", "patch": "@@ -1,3 +1,8 @@\n+2015-12-09  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR tree-optimization/68716\n+\t* testsuite/libgomp.c/omp-nested-2.c: New test.\n+\n 2015-12-02  Thomas Schwinge  <thomas@codesourcery.com>\n \n \t* testsuite/libgomp.oacc-c-c++-common/host_data-2.c: Restrict to"}, {"sha": "7495afb8a216f2a87e096bb60756a667c9189df0", "filename": "libgomp/testsuite/libgomp.c/omp-nested-2.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/76680678a8e6e41ed64b816c65298d3366ad7345/libgomp%2Ftestsuite%2Flibgomp.c%2Fomp-nested-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/76680678a8e6e41ed64b816c65298d3366ad7345/libgomp%2Ftestsuite%2Flibgomp.c%2Fomp-nested-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fomp-nested-2.c?ref=76680678a8e6e41ed64b816c65298d3366ad7345", "patch": "@@ -0,0 +1,4 @@\n+// { dg-do run }\n+// { dg-additional-options \"-fipa-pta\" }\n+\n+#include \"omp-nested-1.c\""}]}