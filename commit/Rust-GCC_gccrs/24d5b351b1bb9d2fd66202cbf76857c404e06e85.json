{"sha": "24d5b351b1bb9d2fd66202cbf76857c404e06e85", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjRkNWIzNTFiMWJiOWQyZmQ2NjIwMmNiZjc2ODU3YzQwNGUwNmU4NQ==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.vnet.ibm.com", "date": "2012-04-24T15:51:58Z"}, "committer": {"name": "William Schmidt", "email": "wschmidt@gcc.gnu.org", "date": "2012-04-24T15:51:58Z"}, "message": "re PR target/47197 (ICE in gimplify_expr, at gimplify.c:7153 on AltiVec code (vec_dst))\n\ngcc:\n\n2012-04-24  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR target/47197\n\t* config/rs6000/rs6000-c.c (fully_fold_convert): New function.\n\t(altivec_build_resolved_builtin): Call fully_fold_convert.\n\ngcc/testsuite:\n\n2012-04-24  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR target/47197\n\t* gcc.target/powerpc/pr47197.c: New test.\n\nFrom-SVN: r186771", "tree": {"sha": "975041ebfdf128eec33889abe5a1294aeb7b3445", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/975041ebfdf128eec33889abe5a1294aeb7b3445"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/24d5b351b1bb9d2fd66202cbf76857c404e06e85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24d5b351b1bb9d2fd66202cbf76857c404e06e85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24d5b351b1bb9d2fd66202cbf76857c404e06e85", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24d5b351b1bb9d2fd66202cbf76857c404e06e85/comments", "author": {"login": "wschmidt-ibm", "id": 5520937, "node_id": "MDQ6VXNlcjU1MjA5Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/5520937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wschmidt-ibm", "html_url": "https://github.com/wschmidt-ibm", "followers_url": "https://api.github.com/users/wschmidt-ibm/followers", "following_url": "https://api.github.com/users/wschmidt-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/wschmidt-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/wschmidt-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wschmidt-ibm/subscriptions", "organizations_url": "https://api.github.com/users/wschmidt-ibm/orgs", "repos_url": "https://api.github.com/users/wschmidt-ibm/repos", "events_url": "https://api.github.com/users/wschmidt-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/wschmidt-ibm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "814671217c95f47784353e731057665f6ecb3cb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/814671217c95f47784353e731057665f6ecb3cb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/814671217c95f47784353e731057665f6ecb3cb0"}], "stats": {"total": 51, "additions": 45, "deletions": 6}, "files": [{"sha": "5eb9411fc1376579f742858884b074750deacf91", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=24d5b351b1bb9d2fd66202cbf76857c404e06e85", "patch": "@@ -1,3 +1,9 @@\n+2012-04-24  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR target/47197\n+\t* config/rs6000/rs6000-c.c (fully_fold_convert): New function.\n+\t(altivec_build_resolved_builtin): Call fully_fold_convert.\n+\n 2012-04-24  Georg-Johann Lay  <avr@gjlay.de>\n \n \tPR target/53065"}, {"sha": "0717b91b2bc2d1782d47fa4ac6b524d7f812098a", "filename": "gcc/config/rs6000/rs6000-c.c", "status": "modified", "additions": 22, "deletions": 6, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2Fconfig%2Frs6000%2Frs6000-c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2Fconfig%2Frs6000%2Frs6000-c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000-c.c?ref=24d5b351b1bb9d2fd66202cbf76857c404e06e85", "patch": "@@ -3421,6 +3421,22 @@ rs6000_builtin_type_compatible (tree t, int id)\n }\n \n \n+/* In addition to calling fold_convert for EXPR of type TYPE, also\n+   call c_fully_fold to remove any C_MAYBE_CONST_EXPRs that could be\n+   hiding there (PR47197).  */\n+\n+static tree\n+fully_fold_convert (tree type, tree expr)\n+{\n+  tree result = fold_convert (type, expr);\n+  bool maybe_const = true;\n+\n+  if (!c_dialect_cxx ())\n+    result = c_fully_fold (result, false, &maybe_const);\n+\n+  return result;\n+}\n+\n /* Build a tree for a function call to an Altivec non-overloaded builtin.\n    The overloaded builtin that matched the types and args is described\n    by DESC.  The N arguments are given in ARGS, respectively.  \n@@ -3470,18 +3486,18 @@ altivec_build_resolved_builtin (tree *args, int n,\n       break;\n     case 1:\n       call = build_call_expr (impl_fndecl, 1,\n-\t\t\t      fold_convert (arg_type[0], args[0]));\n+\t\t\t      fully_fold_convert (arg_type[0], args[0]));\n       break;\n     case 2:\n       call = build_call_expr (impl_fndecl, 2,\n-\t\t\t      fold_convert (arg_type[0], args[0]),\n-\t\t\t      fold_convert (arg_type[1], args[1]));\n+\t\t\t      fully_fold_convert (arg_type[0], args[0]),\n+\t\t\t      fully_fold_convert (arg_type[1], args[1]));\n       break;\n     case 3:\n       call = build_call_expr (impl_fndecl, 3,\n-\t\t\t      fold_convert (arg_type[0], args[0]),\n-\t\t\t      fold_convert (arg_type[1], args[1]),\n-\t\t\t      fold_convert (arg_type[2], args[2]));\n+\t\t\t      fully_fold_convert (arg_type[0], args[0]),\n+\t\t\t      fully_fold_convert (arg_type[1], args[1]),\n+\t\t\t      fully_fold_convert (arg_type[2], args[2]));\n       break;\n     default:\n       gcc_unreachable ();"}, {"sha": "0a4d974ef08ec59cf05bfce50c08b2291faa0d36", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=24d5b351b1bb9d2fd66202cbf76857c404e06e85", "patch": "@@ -1,3 +1,8 @@\n+2012-04-24  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR target/47197\n+\t* gcc.target/powerpc/pr47197.c: New test.\n+\t\n 2012-04-24  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/53085"}, {"sha": "729dcfb364a129f95479918a4443406ec822b32a", "filename": "gcc/testsuite/gcc.target/powerpc/pr47197.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr47197.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24d5b351b1bb9d2fd66202cbf76857c404e06e85/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr47197.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr47197.c?ref=24d5b351b1bb9d2fd66202cbf76857c404e06e85", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-maltivec\" } */\n+\n+/* Compile-only test to ensure that expressions can be passed to\n+   Altivec builtins without error.  */\n+\n+#include <altivec.h>\n+\n+void func(unsigned char *buf, unsigned len)\n+{\n+        vec_dst(buf, (len >= 256 ? 0 : len) | 512, 2);\n+}"}]}