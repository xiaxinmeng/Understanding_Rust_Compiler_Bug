{"sha": "56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTZkM2E5MzBhZTUwY2Q4YWI3NDRhMWQyZWE0ZWQ4MDM5OTViNDdiZg==", "commit": {"author": {"name": "Fritz Reese", "email": "fritzoreese@gmail.com", "date": "2016-10-07T21:25:16Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2016-10-07T21:25:16Z"}, "message": "Fix ICE due to map typespecs with different sized charlens being copied.\n\n2016-10-07  Fritz Reese  <fritzoreese@gmail.com>\n\nFix ICE due to map typespecs with different sized charlens being copied.\n\n\tgcc/fortran/\n\t* interface.c (compare_components): Check charlen for BT_CHAR.\n\n\tgcc/testsuite/gfortran.dg/\n\t* dec_union_11.f90: New testcase.\n\nFrom-SVN: r240875", "tree": {"sha": "b20a99f78f375d2406e8f4099deeabf3092129fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b20a99f78f375d2406e8f4099deeabf3092129fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "45e2bf2e5e370e62c3cef575b6726dc936a45599", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45e2bf2e5e370e62c3cef575b6726dc936a45599", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45e2bf2e5e370e62c3cef575b6726dc936a45599"}], "stats": {"total": 82, "additions": 82, "deletions": 0}, "files": [{"sha": "49054dd9955caa9ba4ca3e7c6378c779b340e5b3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "patch": "@@ -1,3 +1,7 @@\n+2016-10-07  Fritz Reese  <fritzoreese@gmail.com>\n+\n+\t* interface.c (compare_components): Check charlen for BT_CHAR.\n+\n 2016-10-07  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/77406"}, {"sha": "dc81ab5991c15dc2f2370f0d7affebedf9bd794f", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "patch": "@@ -495,6 +495,17 @@ compare_components (gfc_component *cmp1, gfc_component *cmp2,\n   if (cmp1->attr.dimension && gfc_compare_array_spec (cmp1->as, cmp2->as) == 0)\n     return 0;\n \n+  if (cmp1->ts.type == BT_CHARACTER && cmp2->ts.type == BT_CHARACTER)\n+    {\n+      gfc_charlen *l1 = cmp1->ts.u.cl;\n+      gfc_charlen *l2 = cmp2->ts.u.cl;\n+      if (l1 && l2 && l1->length && l2->length\n+          && l1->length->expr_type == EXPR_CONSTANT\n+          && l2->length->expr_type == EXPR_CONSTANT\n+          && gfc_dep_compare_expr (l1->length, l2->length) != 0)\n+        return 0;\n+    }\n+\n   /* Make sure that link lists do not put this function into an\n      endless recursive loop!  */\n   if (!(cmp1->ts.type == BT_DERIVED && derived1 == cmp1->ts.u.derived)"}, {"sha": "2214179cbd4bb4be5dd52e22413f0e42e8d3b2d8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "patch": "@@ -1,3 +1,7 @@\n+2016-10-07  Fritz Reese  <fritzoreese@gmail.com>\n+\n+\t* gfortran.dg/dec_union_11.f90: New testcase.\n+\n 2016-10-07  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/66443"}, {"sha": "3ff4b49b62f1a4bdb10c805da14febb20d2028b2", "filename": "gcc/testsuite/gfortran.dg/dec_union_11.f90", "status": "added", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_11.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56d3a930ae50cd8ab744a1d2ea4ed803995b47bf/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_11.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_11.f90?ref=56d3a930ae50cd8ab744a1d2ea4ed803995b47bf", "patch": "@@ -0,0 +1,63 @@\n+! { dg-do compile }\n+! { dg-options \"-g -fdec-structure\" }\n+!\n+! Test a regression where typespecs of unions containing character buffers of\n+! different lengths where copied, resulting in a bad gimple tree state.\n+!\n+\n+subroutine sub2 (otherbuf)\n+  integer, parameter :: L_bbuf = 65536\n+  integer, parameter :: L_bbuf2 = 24\n+\n+  structure /buffer2/\n+    union\n+     map\n+      character(L_bbuf2)  sbuf\n+     end map\n+    end union\n+  end structure\n+  structure /buffer/\n+    union\n+     map\n+      character(L_bbuf)  sbuf\n+     end map\n+    end union\n+  end structure\n+\n+  record /buffer/ buf1\n+  record /buffer2/ buf2\n+  common /c/ buf1, buf2\n+\n+  record /buffer2/ otherbuf\n+end subroutine\n+\n+subroutine sub()\n+  integer, parameter :: L_bbuf = 65536\n+  integer, parameter :: L_bbuf2 = 24\n+\n+  structure /buffer2/\n+    union\n+     map\n+      character(L_bbuf2)  sbuf\n+     end map\n+    end union\n+  end structure\n+  structure /buffer/\n+    union\n+     map\n+      character(L_bbuf)  sbuf\n+     end map\n+    end union\n+  end structure\n+\n+  record /buffer/ buf1\n+  record /buffer2/ buf2\n+  common /c/ buf1, buf2\n+\n+  call sub2 (buf1) ! { dg-warning \"Type mismatch\" }\n+  return\n+end subroutine\n+\n+call sub()\n+\n+end"}]}