{"sha": "859720937474816d4d386664d56d80a9e840f06f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODU5NzIwOTM3NDc0ODE2ZDRkMzg2NjY0ZDU2ZDgwYTllODQwZjA2Zg==", "commit": {"author": {"name": "SimplyTheOther", "email": "simplytheother@gmail.com", "date": "2020-12-25T09:16:25Z"}, "committer": {"name": "SimplyTheOther", "email": "simplytheother@gmail.com", "date": "2020-12-25T09:16:25Z"}, "message": "Rewrote SingleASTNode representation", "tree": {"sha": "c24398609b8fe7777b15ab83d0775013dfb5b322", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c24398609b8fe7777b15ab83d0775013dfb5b322"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/859720937474816d4d386664d56d80a9e840f06f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/859720937474816d4d386664d56d80a9e840f06f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/859720937474816d4d386664d56d80a9e840f06f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/859720937474816d4d386664d56d80a9e840f06f/comments", "author": {"login": "SimplyTheOther", "id": 19371469, "node_id": "MDQ6VXNlcjE5MzcxNDY5", "avatar_url": "https://avatars.githubusercontent.com/u/19371469?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimplyTheOther", "html_url": "https://github.com/SimplyTheOther", "followers_url": "https://api.github.com/users/SimplyTheOther/followers", "following_url": "https://api.github.com/users/SimplyTheOther/following{/other_user}", "gists_url": "https://api.github.com/users/SimplyTheOther/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimplyTheOther/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimplyTheOther/subscriptions", "organizations_url": "https://api.github.com/users/SimplyTheOther/orgs", "repos_url": "https://api.github.com/users/SimplyTheOther/repos", "events_url": "https://api.github.com/users/SimplyTheOther/events{/privacy}", "received_events_url": "https://api.github.com/users/SimplyTheOther/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SimplyTheOther", "id": 19371469, "node_id": "MDQ6VXNlcjE5MzcxNDY5", "avatar_url": "https://avatars.githubusercontent.com/u/19371469?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SimplyTheOther", "html_url": "https://github.com/SimplyTheOther", "followers_url": "https://api.github.com/users/SimplyTheOther/followers", "following_url": "https://api.github.com/users/SimplyTheOther/following{/other_user}", "gists_url": "https://api.github.com/users/SimplyTheOther/gists{/gist_id}", "starred_url": "https://api.github.com/users/SimplyTheOther/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SimplyTheOther/subscriptions", "organizations_url": "https://api.github.com/users/SimplyTheOther/orgs", "repos_url": "https://api.github.com/users/SimplyTheOther/repos", "events_url": "https://api.github.com/users/SimplyTheOther/events{/privacy}", "received_events_url": "https://api.github.com/users/SimplyTheOther/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7299d6d84ac4a1e8118915b00d361e7251e32b65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7299d6d84ac4a1e8118915b00d361e7251e32b65", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7299d6d84ac4a1e8118915b00d361e7251e32b65"}], "stats": {"total": 50, "additions": 37, "deletions": 13}, "files": [{"sha": "5f05985289786e1ae905655a277ed8f938b7571b", "filename": "gcc/rust/ast/rust-macro.h", "status": "modified", "additions": 36, "deletions": 13, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/859720937474816d4d386664d56d80a9e840f06f/gcc%2Frust%2Fast%2Frust-macro.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/859720937474816d4d386664d56d80a9e840f06f/gcc%2Frust%2Fast%2Frust-macro.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fast%2Frust-macro.h?ref=859720937474816d4d386664d56d80a9e840f06f", "patch": "@@ -591,22 +591,11 @@ class MetaListNameValueStr : public MetaItem\n };\n \n /* A \"tagged union\" describing a single AST node. Due to technical difficulties\n- * with unions, had to use raw pointers. */\n+ * with unions, this is actually a struct and so wastes space. FIXME */\n+/*\n struct SingleASTNode\n {\n   public:\n-    union {\n-      std::unique_ptr<Expr> expr;\n-      std::unique_ptr<Stmt> stmt;\n-      std::unique_ptr<Item> item;\n-      std::unique_ptr<Type> type;\n-      std::unique_ptr<Pattern> pattern;\n-      std::unique_ptr<TraitItem> trait_item;\n-      std::unique_ptr<InherentImplItem> inherent_impl_item;\n-      std::unique_ptr<TraitImplItem> trait_impl_item;\n-      std::unique_ptr<ExternalItem> external_item;\n-    };\n-\n     enum tag_types {\n       EXPR,\n       STMT,\n@@ -656,6 +645,7 @@ struct SingleASTNode\n \n     }\n \n+    // destructor definition is required\n     ~SingleASTNode () {\n       switch (tag) {\n         case EXPR:\n@@ -695,6 +685,39 @@ struct SingleASTNode\n   private:\n     tag_types tag;\n \n+    union {\n+      std::unique_ptr<Expr> expr;\n+      std::unique_ptr<Stmt> stmt;\n+      std::unique_ptr<Item> item;\n+      std::unique_ptr<Type> type;\n+      std::unique_ptr<Pattern> pattern;\n+      std::unique_ptr<TraitItem> trait_item;\n+      std::unique_ptr<InherentImplItem> inherent_impl_item;\n+      std::unique_ptr<TraitImplItem> trait_impl_item;\n+      std::unique_ptr<ExternalItem> external_item;\n+    };\n+};\n+*/\n+struct SingleASTNode {\n+      std::unique_ptr<Expr> expr;\n+      std::unique_ptr<Stmt> stmt;\n+      std::unique_ptr<Item> item;\n+      std::unique_ptr<Type> type;\n+      std::unique_ptr<Pattern> pattern;\n+      std::unique_ptr<TraitItem> trait_item;\n+      std::unique_ptr<InherentImplItem> inherent_impl_item;\n+      std::unique_ptr<TraitImplItem> trait_impl_item;\n+      std::unique_ptr<ExternalItem> external_item;\n+\n+    SingleASTNode (std::unique_ptr<Expr> expr) : expr (std::move (expr)) {}\n+    SingleASTNode (std::unique_ptr<Stmt> stmt) : stmt (std::move (stmt)) {}\n+    SingleASTNode (std::unique_ptr<Item> item) : item (std::move (item)) {}\n+    SingleASTNode (std::unique_ptr<Type> type) : type (std::move (type)) {}\n+    SingleASTNode (std::unique_ptr<Pattern> pattern) : pattern (std::move (pattern)) {}\n+    SingleASTNode (std::unique_ptr<TraitItem> trait_item) : trait_item (std::move (trait_item)) {}\n+    SingleASTNode (std::unique_ptr<InherentImplItem> inherent_impl_item) : inherent_impl_item (std::move (inherent_impl_item)) {}\n+    SingleASTNode (std::unique_ptr<TraitImplItem> trait_impl_item) : trait_impl_item (std::move (trait_impl_item)) {}\n+    SingleASTNode (std::unique_ptr<ExternalItem> external_item) : external_item (std::move (external_item)) {}\n };\n \n /* Basically, a \"fragment\" that can be incorporated into the AST, created as "}, {"sha": "17adf0ee8b520fc6e0cc59aba103cce580993c3c", "filename": "gcc/rust/expand/rust-macro-expand.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/859720937474816d4d386664d56d80a9e840f06f/gcc%2Frust%2Fexpand%2Frust-macro-expand.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/859720937474816d4d386664d56d80a9e840f06f/gcc%2Frust%2Fexpand%2Frust-macro-expand.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-macro-expand.h?ref=859720937474816d4d386664d56d80a9e840f06f", "patch": "@@ -2,6 +2,7 @@\n #define RUST_MACRO_EXPAND_H\n \n #include \"rust-ast.h\"\n+#include \"rust-macro.h\"\n \n // Provides objects and method prototypes for macro expansion\n "}]}