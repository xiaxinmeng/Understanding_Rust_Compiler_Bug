{"sha": "be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmU0YWE4M2Q2ZmY0NzIwZmZmZDJjOWY2MmM2ZTMwODJlY2UxOTM3Zg==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2017-01-13T19:27:43Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2017-01-13T19:27:43Z"}, "message": "Don't suppress bogus usage of macros from system headers in -Wformat (PR c/78304)\n\ngcc/ChangeLog:\n\tPR c/78304\n\t* substring-locations.c (format_warning_va): Strengthen case 1 so\n\tthat both endpoints of the substring must be within the format\n\trange for just the substring to be printed.\n\ngcc/testsuite/ChangeLog:\n\tPR c/78304\n\t* gcc.dg/format/diagnostic-ranges.c (test_macro): Undef INT_FMT.\n\t(test_macro_2): New test.\n\t(test_macro_3): New test.\n\t(test_macro_4): New test.\n\t(test_non_contiguous_strings): Convert line number to line offset.\n\t* gcc.dg/format/pr78304-2.c: New test case.\n\t* gcc.dg/format/pr78304.c: New test case.\n\nFrom-SVN: r244453", "tree": {"sha": "1ba8193ad64aa0c109a78cb075770c0922917e6f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1ba8193ad64aa0c109a78cb075770c0922917e6f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7cdca3ec8a5ae98b5a92dcb3cb2d6d28f8f68266", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cdca3ec8a5ae98b5a92dcb3cb2d6d28f8f68266", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7cdca3ec8a5ae98b5a92dcb3cb2d6d28f8f68266"}], "stats": {"total": 94, "additions": 93, "deletions": 1}, "files": [{"sha": "3c74b193528d9743060f2e8d164e7e20dde6033f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "patch": "@@ -1,3 +1,10 @@\n+2017-01-13  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/78304\n+\t* substring-locations.c (format_warning_va): Strengthen case 1 so\n+\tthat both endpoints of the substring must be within the format\n+\trange for just the substring to be printed.\n+\n 2017-01-13  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* config/i386/i386.opt (msgx): Use ix86_isa_flags2 variable."}, {"sha": "e2d8dd7ea88634f759b96667149c1cec99ab6969", "filename": "gcc/substring-locations.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Fsubstring-locations.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Fsubstring-locations.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsubstring-locations.c?ref=be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "patch": "@@ -118,6 +118,8 @@ format_warning_va (const substring_loc &fmt_loc,\n   else\n     {\n       if (fmt_substring_range.m_start >= fmt_loc_range.m_start\n+\t  && fmt_substring_range.m_start <= fmt_loc_range.m_finish\n+\t  && fmt_substring_range.m_finish >= fmt_loc_range.m_start\n \t  && fmt_substring_range.m_finish <= fmt_loc_range.m_finish)\n \t/* Case 1.  */\n \t{"}, {"sha": "76dfd7e47472d2aea27ba5fe9deba08af7365075", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "patch": "@@ -1,3 +1,14 @@\n+2017-01-13  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR c/78304\n+\t* gcc.dg/format/diagnostic-ranges.c (test_macro): Undef INT_FMT.\n+\t(test_macro_2): New test.\n+\t(test_macro_3): New test.\n+\t(test_macro_4): New test.\n+\t(test_non_contiguous_strings): Convert line number to line offset.\n+\t* gcc.dg/format/pr78304-2.c: New test case.\n+\t* gcc.dg/format/pr78304.c: New test case.\n+\n 2017-01-13  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.target/i386/funcspec-56.inc: Add missing options and"}, {"sha": "cab30f2d7f6958b290125576f8fde0b88d1580d7", "filename": "gcc/testsuite/gcc.dg/format/diagnostic-ranges.c", "status": "modified", "additions": 52, "deletions": 1, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fdiagnostic-ranges.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fdiagnostic-ranges.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fdiagnostic-ranges.c?ref=be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "patch": "@@ -254,12 +254,63 @@ void test_macro (const char *msg)\n                   ~^\n                   %s\n    { dg-end-multiline-output \"\" } */\n+#undef INT_FMT\n+}\n+\n+void test_macro_2 (const char *msg)\n+{\n+#define PRIu32 \"u\" /* { dg-message \"17: format string is defined here\" } */\n+  printf(\"hello %\" PRIu32 \" world\", msg);  /* { dg-warning \"10: format '%u' expects argument of type 'unsigned int', but argument 2 has type 'const char \\\\*' \" } */\n+/* { dg-begin-multiline-output \"\" }\n+   printf(\"hello %\" PRIu32 \" world\", msg);\n+          ^~~~~~~~~\n+   { dg-end-multiline-output \"\" } */\n+/* { dg-begin-multiline-output \"\" }\n+ #define PRIu32 \"u\"\n+                 ^\n+   { dg-end-multiline-output \"\" } */\n+#undef PRIu32\n+}\n+\n+void test_macro_3 (const char *msg)\n+{\n+#define FMT_STRING \"hello %i world\" /* { dg-warning \"20: format '%i' expects argument of type 'int', but argument 2 has type 'const char \\\\*' \" } */\n+  printf(FMT_STRING, msg);  /* { dg-message \"10: in expansion of macro 'FMT_STRING\" } */\n+/* { dg-begin-multiline-output \"\" }\n+ #define FMT_STRING \"hello %i world\"\n+                    ^\n+   { dg-end-multiline-output \"\" } */\n+/* { dg-begin-multiline-output \"\" }\n+   printf(FMT_STRING, msg);\n+          ^~~~~~~~~~\n+   { dg-end-multiline-output \"\" } */\n+#undef FMT_STRING\n+}\n+\n+void test_macro_4 (const char *msg)\n+{\n+#define FMT_STRING \"hello %i world\" /* { dg-warning \"20: format '%i' expects argument of type 'int', but argument 2 has type 'const char \\\\*' \" } */\n+  printf(FMT_STRING \"\\n\", msg);  /* { dg-message \"10: in expansion of macro 'FMT_STRING\" } */\n+/* { dg-begin-multiline-output \"\" }\n+ #define FMT_STRING \"hello %i world\"\n+                    ^\n+   { dg-end-multiline-output \"\" } */\n+/* { dg-begin-multiline-output \"\" }\n+   printf(FMT_STRING \"\\n\", msg);\n+          ^~~~~~~~~~\n+   { dg-end-multiline-output \"\" } */\n+/* { dg-begin-multiline-output \"\" }\n+ #define FMT_STRING \"hello %i world\"\n+                           ~^\n+                           %s\n+   { dg-end-multiline-output \"\" } */\n+#undef FMT_STRING\n }\n \n void test_non_contiguous_strings (void)\n {\n   __builtin_printf(\" %\" \"d \", 0.5); /* { dg-warning \"20: format .%d. expects argument of type .int., but argument 2 has type .double.\" } */\n-                                    /* { dg-message \"26: format string is defined here\" \"\" { target *-*-* } 261 } */\n+                                    /* { dg-message \"26: format string is defined here\" \"\" { target *-*-* } .-1 } */\n   /* { dg-begin-multiline-output \"\" }\n    __builtin_printf(\" %\" \"d \", 0.5);\n                     ^~~~"}, {"sha": "5ee6d659ea24dc851b1d996e8759d683f9c6d04d", "filename": "gcc/testsuite/gcc.dg/format/pr78304-2.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fpr78304-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fpr78304-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fpr78304-2.c?ref=be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -Wall -Wextra\" } */\n+\n+extern int printf (const char *, ...);\n+\n+# define PRIu32\t\t\"u\"\n+\n+void test (long size)\n+{\n+  printf (\"size: %\" PRIu32 \"\\n\", size); /* { dg-warning \"expects argument of type\" } */\n+}"}, {"sha": "d0a96f6ac4bb51a55b70eb6ea57f429d6a50e266", "filename": "gcc/testsuite/gcc.dg/format/pr78304.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fpr78304.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/be4aa83d6ff4720fffd2c9f62c6e3082ece1937f/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fpr78304.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fpr78304.c?ref=be4aa83d6ff4720fffd2c9f62c6e3082ece1937f", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target inttypes_types } } */\n+/* { dg-options \"-O2 -Wall -Wextra\" } */\n+\n+#include <inttypes.h>\n+#include <stdio.h>\n+\n+void test (size_t size)\n+{\n+  printf (\"size: %\" PRIu32 \"\\n\", size); /* { dg-warning \"expects argument of type\" } */\n+}"}]}