{"sha": "bb7d75ffce7a2ca526229b579666ceae01805f69", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmI3ZDc1ZmZjZTdhMmNhNTI2MjI5YjU3OTY2NmNlYWUwMTgwNWY2OQ==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2017-02-07T02:20:48Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@gcc.gnu.org", "date": "2017-02-07T02:20:48Z"}, "message": "re PR c++/79360 (ICE with NSDMI and enum in union)\n\nFix PR c++/79360\n\ngcc/cp/ChangeLog:\n\n\tPR c++/79360\n\t* typeck2.c (process_init_constructor_union): Consider only\n\tFIELD_DECLs when looking for an NSDMI.\n\ngcc/testsuite/ChangeLog:\n\n\tPR c++/79360\n\t* g++.dg/cpp1y/nsdmi-union2.C: New test.\n\nFrom-SVN: r245239", "tree": {"sha": "46f0838503c4e047dafbc502715a6f3ec8f4f341", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/46f0838503c4e047dafbc502715a6f3ec8f4f341"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bb7d75ffce7a2ca526229b579666ceae01805f69", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb7d75ffce7a2ca526229b579666ceae01805f69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb7d75ffce7a2ca526229b579666ceae01805f69", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb7d75ffce7a2ca526229b579666ceae01805f69/comments", "author": null, "committer": null, "parents": [{"sha": "10d22398b86c84be838cf3ff04302a3ee2ce726b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10d22398b86c84be838cf3ff04302a3ee2ce726b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10d22398b86c84be838cf3ff04302a3ee2ce726b"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "85bb3b5736d85da2884988267978f8f020f0294d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=bb7d75ffce7a2ca526229b579666ceae01805f69", "patch": "@@ -1,3 +1,9 @@\n+2017-02-07  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/79360\n+\t* typeck2.c (process_init_constructor_union): Consider only\n+\tFIELD_DECLs when looking for an NSDMI.\n+\n 2017-02-06  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/71193 - incomplete types in templates"}, {"sha": "1e0354d8a73ea50267c0495ca92a43e33c7da821", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=bb7d75ffce7a2ca526229b579666ceae01805f69", "patch": "@@ -1510,7 +1510,8 @@ process_init_constructor_union (tree type, tree init,\n     {\n       for (tree field = TYPE_FIELDS (type); field; field = TREE_CHAIN (field))\n \t{\n-\t  if (DECL_INITIAL (field))\n+\t  if (TREE_CODE (field) == FIELD_DECL\n+\t      && DECL_INITIAL (field) != NULL_TREE)\n \t    {\n \t      CONSTRUCTOR_APPEND_ELT (CONSTRUCTOR_ELTS (init),\n \t\t\t\t      field,"}, {"sha": "427615c511be3f454b19e7506c012df1a4a9a136", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bb7d75ffce7a2ca526229b579666ceae01805f69", "patch": "@@ -1,3 +1,8 @@\n+2017-02-07  Patrick Palka  <ppalka@gcc.gnu.org>\n+\n+\tPR c++/79360\n+\t* g++.dg/cpp1y/nsdmi-union2.C: New test.\n+\n 2017-02-06  Kito Cheng  <kito.cheng@gmail.com>\n \n \t* lib/target-supports.exp: Define the RISC-V target."}, {"sha": "08217d799db975d08957634caeaea3392f99dd68", "filename": "gcc/testsuite/g++.dg/cpp1y/nsdmi-union2.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-union2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb7d75ffce7a2ca526229b579666ceae01805f69/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-union2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fnsdmi-union2.C?ref=bb7d75ffce7a2ca526229b579666ceae01805f69", "patch": "@@ -0,0 +1,12 @@\n+// PR c++/79360\n+// { dg-do compile { target c++14 } }\n+\n+union U\n+{\n+  enum E { e };\n+};\n+\n+struct A\n+{\n+  U u{};\n+};"}]}