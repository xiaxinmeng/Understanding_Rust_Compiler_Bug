{"sha": "066b6b8df960796362dbdcff62851ebea201b8e9", "node_id": "C_kwDOANBUbNoAKDA2NmI2YjhkZjk2MDc5NjM2MmRiZGNmZjYyODUxZWJlYTIwMWI4ZTk", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2022-09-24T16:25:34Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2022-09-30T21:53:26Z"}, "message": "rust: Add skeleton support and documentation for targetrustm hooks.\n\ngcc/ChangeLog:\n\n\t* Makefile.in (tm_rust_file_list, tm_rust_include_list, TM_RUST_H,\n\tRUST_TARGET_DEF, RUST_TARGET_H, RUST_TARGET_OBJS): New variables.\n\t(tm_rust.h, cs-tm_rust.h, default-rust.o,\n\trust/rust-target-hooks-def.h, s-rust-target-hooks-def-h): New rules.\n\t(s-tm-texi): Also check timestamp on rust-target.def.\n\t(generated_files): Add TM_RUST_H and rust-target-hooks-def.h.\n\t(build/genhooks.o): Also depend on RUST_TARGET_DEF.\n\t* config.gcc (tm_rust_file, rust_target_objs, target_has_targetrustm):\n\tNew variables.\n\t* configure: Regenerate.\n\t* configure.ac (tm_rust_file_list, tm_rust_include_list,\n\trust_target_objs): Add substitutes.\n\t* doc/tm.texi: Regenerate.\n\t* doc/tm.texi.in (targetrustm): Document.\n\t(target_has_targetrustm): Document.\n\t* genhooks.cc: Include rust/rust-target.def.\n\t* config/default-rust.cc: New file.\n\ngcc/rust/ChangeLog:\n\n\t* rust/rust-target-def.h: New file.\n\t* rust/rust-target.def: New file.\n\t* rust/rust-target.h: New file.", "tree": {"sha": "9f89d2858a882e86b4c1ca813b2adcfb4adbd20e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9f89d2858a882e86b4c1ca813b2adcfb4adbd20e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/066b6b8df960796362dbdcff62851ebea201b8e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/066b6b8df960796362dbdcff62851ebea201b8e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/066b6b8df960796362dbdcff62851ebea201b8e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/066b6b8df960796362dbdcff62851ebea201b8e9/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8ff035ddc55079161d24941785114aa0f5056260", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ff035ddc55079161d24941785114aa0f5056260", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ff035ddc55079161d24941785114aa0f5056260"}], "stats": {"total": 231, "additions": 224, "deletions": 7}, "files": [{"sha": "f25351fd672b1237963482f928dacecbb16e19f0", "filename": ".github/bors_log_expected_warnings", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/.github%2Fbors_log_expected_warnings", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/.github%2Fbors_log_expected_warnings", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/.github%2Fbors_log_expected_warnings?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -89,10 +89,10 @@\n ../../gcc/gcc.cc:7711:13: warning: ignoring return value of \u2018ssize_t write(int, const void*, size_t)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n ../../gcc/gcc.cc:7712:13: warning: ignoring return value of \u2018ssize_t write(int, const void*, size_t)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n ../../gcc/gcc.cc:7714:9: warning: ignoring return value of \u2018ssize_t write(int, const void*, size_t)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n-../../gcc/genhooks.cc:111:17: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n-../../gcc/genhooks.cc:120:14: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n-../../gcc/genhooks.cc:173:14: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n-../../gcc/genhooks.cc:179:14: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n+../../gcc/genhooks.cc:112:17: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n+../../gcc/genhooks.cc:121:14: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n+../../gcc/genhooks.cc:174:14: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n+../../gcc/genhooks.cc:180:14: warning: ignoring return value of \u2018int fscanf(FILE*, const char*, ...)\u2019, declared with attribute warn_unused_result [-Wunused-result]\n ../../gcc/gimple-range-gori.cc:318:22: warning: format not a string literal and no format arguments [-Wformat-security]\n ../../gcc/ipa-devirt.cc:965:47: warning: format not a string literal and no format arguments [-Wformat-security]\n ../../gcc/lto-wrapper.cc:1147:8: warning: ignoring return value of \u2018ssize_t read(int, void*, size_t)\u2019, declared with attribute warn_unused_result [-Wunused-result]"}, {"sha": "27ae592338f05270bcac3cdf16983c8bfa5970b2", "filename": "gcc/Makefile.in", "status": "modified", "additions": 33, "deletions": 1, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -573,6 +573,8 @@ tm_p_file_list=@tm_p_file_list@\n tm_p_include_list=@tm_p_include_list@\n tm_d_file_list=@tm_d_file_list@\n tm_d_include_list=@tm_d_include_list@\n+tm_rust_file_list=@tm_rust_file_list@\n+tm_rust_include_list=@tm_rust_include_list@\n build_xm_file_list=@build_xm_file_list@\n build_xm_include_list=@build_xm_include_list@\n build_xm_defines=@build_xm_defines@\n@@ -866,6 +868,7 @@ CONFIG_H  = config.h  $(host_xm_file_list)\n TCONFIG_H = tconfig.h $(xm_file_list)\n TM_P_H    = tm_p.h    $(tm_p_file_list)\n TM_D_H    = tm_d.h    $(tm_d_file_list)\n+TM_RUST_H = tm_rust.h $(tm_rust_file_list)\n GTM_H     = tm.h      $(tm_file_list) insn-constants.h\n TM_H      = $(GTM_H) insn-flags.h $(OPTIONS_H)\n \n@@ -924,10 +927,12 @@ TARGET_DEF = target.def target-hooks-macros.h target-insns.def\n C_TARGET_DEF = c-family/c-target.def target-hooks-macros.h\n COMMON_TARGET_DEF = common/common-target.def target-hooks-macros.h\n D_TARGET_DEF = d/d-target.def target-hooks-macros.h\n+RUST_TARGET_DEF = rust/rust-target.def target-hooks-macros.h\n TARGET_H = $(TM_H) target.h $(TARGET_DEF) insn-modes.h insn-codes.h\n C_TARGET_H = c-family/c-target.h $(C_TARGET_DEF)\n COMMON_TARGET_H = common/common-target.h $(INPUT_H) $(COMMON_TARGET_DEF)\n D_TARGET_H = d/d-target.h $(D_TARGET_DEF)\n+RUST_TARGET_H = rust/rust-target.h $(RUST_TARGET_DEF)\n MACHMODE_H = machmode.h mode-classes.def\n HOOKS_H = hooks.h\n HOSTHOOKS_DEF_H = hosthooks-def.h $(HOOKS_H)\n@@ -1231,6 +1236,9 @@ D_TARGET_OBJS=@d_target_objs@\n # Target specific, Fortran specific object file\n FORTRAN_TARGET_OBJS=@fortran_target_objs@\n \n+# Target specific, Rust specific object file\n+RUST_TARGET_OBJS=@rust_target_objs@\n+\n # Object files for gcc many-languages driver.\n GCC_OBJS = gcc.o gcc-main.o ggc-none.o\n \n@@ -1938,6 +1946,7 @@ tconfig.h: cs-tconfig.h ; @true\n tm.h: cs-tm.h ; @true\n tm_p.h: cs-tm_p.h ; @true\n tm_d.h: cs-tm_d.h ; @true\n+tm_rust.h: cs-tm_rust.h ; @true\n \n cs-config.h: Makefile\n \tTARGET_CPU_DEFAULT=\"\" \\\n@@ -1969,6 +1978,11 @@ cs-tm_d.h: Makefile\n \tHEADERS=\"$(tm_d_include_list)\" DEFINES=\"\" \\\n \t$(SHELL) $(srcdir)/mkconfig.sh tm_d.h\n \n+cs-tm_rust.h: Makefile\n+\tTARGET_CPU_DEFAULT=\"\" \\\n+\tHEADERS=\"$(tm_rust_include_list)\" DEFINES=\"\" \\\n+\t$(SHELL) $(srcdir)/mkconfig.sh tm_rust.h\n+\n # Don't automatically run autoconf, since configure.ac might be accidentally\n # newer than configure.  Also, this writes into the source directory which\n # might be on a read-only file system.  If configured for maintainer mode\n@@ -2305,6 +2319,12 @@ default-d.o: config/default-d.cc\n \t$(COMPILE) $<\n \t$(POSTCOMPILE)\n \n+# Files used by the Rust language front end.\n+\n+default-rust.o: config/default-rust.cc\n+\t$(COMPILE) $<\n+\t$(POSTCOMPILE)\n+\n # Language-independent files.\n \n DRIVER_DEFINES = \\\n@@ -2610,6 +2630,15 @@ s-d-target-hooks-def-h: build/genhooks$(build_exeext)\n \t\t\t\t\t     d/d-target-hooks-def.h\n \t$(STAMP) s-d-target-hooks-def-h\n \n+rust/rust-target-hooks-def.h: s-rust-target-hooks-def-h; @true\n+\n+s-rust-target-hooks-def-h: build/genhooks$(build_exeext)\n+\t$(RUN_GEN) build/genhooks$(build_exeext) \"Rust Target Hook\" \\\n+\t\t\t\t\t     > tmp-rust-target-hooks-def.h\n+\t$(SHELL) $(srcdir)/../move-if-change tmp-rust-target-hooks-def.h \\\n+\t\t\t\t\t     rust/rust-target-hooks-def.h\n+\t$(STAMP) s-rust-target-hooks-def-h\n+\n # check if someone mistakenly only changed tm.texi.\n # We use a different pathname here to avoid a circular dependency.\n s-tm-texi: $(srcdir)/doc/../doc/tm.texi\n@@ -2634,6 +2663,7 @@ s-tm-texi: build/genhooks$(build_exeext) $(srcdir)/doc/tm.texi.in\n \t    || test $(srcdir)/doc/tm.texi -nt $(srcdir)/c-family/c-target.def \\\n \t    || test $(srcdir)/doc/tm.texi -nt $(srcdir)/common/common-target.def \\\n \t    || test $(srcdir)/doc/tm.texi -nt $(srcdir)/d/d-target.def \\\n+\t    || test $(srcdir)/doc/tm.texi -nt $(srcdir)/rust/rust-target.def \\\n \t  ); then \\\n \t  echo >&2 ; \\\n \t  echo You should edit $(srcdir)/doc/tm.texi.in rather than $(srcdir)/doc/tm.texi . >&2 ; \\\n@@ -2792,6 +2822,7 @@ generated_files = config.h tm.h $(TM_P_H) $(TM_D_H) $(TM_H) multilib.h \\\n        common/common-target-hooks-def.h pass-instances.def \\\n        gimple-match.cc generic-match.cc \\\n        c-family/c-target-hooks-def.h d/d-target-hooks-def.h \\\n+       $(TM_RUST_H) rust/rust-target-hooks-def.h \\\n        case-cfn-macros.h \\\n        cfn-operators.pd omp-device-properties.h\n \n@@ -2926,7 +2957,8 @@ build/genrecog.o : genrecog.cc $(RTL_BASE_H) $(BCONFIG_H) $(SYSTEM_H)\t\\\n   $(CORETYPES_H) $(GTM_H) errors.h $(READ_MD_H) $(GENSUPPORT_H)\t\t\\\n   $(HASH_TABLE_H) inchash.h\n build/genhooks.o : genhooks.cc $(TARGET_DEF) $(C_TARGET_DEF)\t\t\\\n-  $(COMMON_TARGET_DEF) $(D_TARGET_DEF) $(BCONFIG_H) $(SYSTEM_H) errors.h\n+  $(COMMON_TARGET_DEF) $(D_TARGET_DEF) $(RUST_TARGET_DEF) $(BCONFIG_H) \\\n+  $(SYSTEM_H) errors.h\n build/genmddump.o : genmddump.cc $(RTL_BASE_H) $(BCONFIG_H) $(SYSTEM_H)\t\\\n   $(CORETYPES_H) $(GTM_H) errors.h $(READ_MD_H) $(GENSUPPORT_H)\n build/genmatch.o : genmatch.cc $(BCONFIG_H) $(SYSTEM_H) \\"}, {"sha": "da0c71d63ab4fc7d7dbc1b38eca326781c28f77b", "filename": "gcc/config.gcc", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -90,6 +90,9 @@\n #  tm_d_file\t\tA list of headers with definitions of target hook\n #\t\t\tmacros for the D compiler.\n #\n+#  tm_rust_file\t\tlist of headers with definitions of target hook\n+#\t\t\tmacros for the Rust compiler.\n+#\n #  out_file\t\tThe name of the machine description C support\n #\t\t\tfile, if different from \"$cpu_type/$cpu_type.c\".\n #\n@@ -149,6 +152,9 @@\n #  fortran_target_objs\tList of extra target-dependent objects that be\n #\t\t\tlinked into the fortran compiler only.\n #\n+#  rust_target_objs\tList of extra target-dependent objects that be\n+#\t\t\tlinked into the Rust compiler only.\n+#\n #  target_gtfiles       List of extra source files with type information.\n #\n #  xm_defines\t\tList of macros to define when compiling for the\n@@ -201,6 +207,9 @@\n #\n #  target_has_targetdm\tSet to yes or no depending on whether the target\n #\t\t\thas its own definition of targetdm.\n+#\n+#  target_has_targetrustm\tSet to yes or no depending on whether the target\n+#\t\t\thas its own definition of targetrustm.\n \n out_file=\n common_out_file=\n@@ -218,9 +227,11 @@ c_target_objs=\n cxx_target_objs=\n d_target_objs=\n fortran_target_objs=\n+rust_target_objs=\n target_has_targetcm=no\n target_has_targetm_common=yes\n target_has_targetdm=no\n+target_has_targetrustm=no\n tm_defines=\n xm_defines=\n # Set this to force installation and use of collect2.\n@@ -569,6 +580,16 @@ then\n \ttm_d_file=\"${tm_d_file} ${cpu_type}/${cpu_type}-d.h\"\n fi\n \n+tm_rust_file=\n+if test -f ${srcdir}/config/${cpu_type}/${cpu_type}-rust.h\n+then\n+\ttm_rust_file=\"${cpu_type}/${cpu_type}-rust.h\"\n+fi\n+if test -f ${srcdir}/config/${cpu_type}/${cpu_type}-rust.cc\n+then\n+\trust_target_objs=\"${rust_target_objs} ${cpu_type}-rust.o\"\n+fi\n+\n extra_modes=\n if test -f ${srcdir}/config/${cpu_type}/${cpu_type}-modes.def\n then\n@@ -3544,6 +3565,10 @@ if [ \"$target_has_targetdm\" = \"no\" ]; then\n   d_target_objs=\"$d_target_objs default-d.o\"\n fi\n \n+if [ \"$target_has_targetrustm\" = \"no\" ]; then\n+  rust_target_objs=\"$rust_target_objs default-rust.o\"\n+fi\n+\n # Support for --with-cpu and related options (and a few unrelated options,\n # too).\n case ${with_cpu} in"}, {"sha": "aa098cbb806d1efd9182d657fd6b50ebcd5ab4b6", "filename": "gcc/config/default-rust.cc", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfig%2Fdefault-rust.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfig%2Fdefault-rust.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdefault-rust.cc?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -0,0 +1,29 @@\n+/* Default Rust language target hooks initializer.\n+   Copyright (C) 2022 Free Software Foundation, Inc.\n+\n+GCC is free software; you can redistribute it and/or modify it under\n+the terms of the GNU General Public License as published by the Free\n+Software Foundation; either version 3, or (at your option) any later\n+version.\n+\n+GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GCC; see the file COPYING3.  If not see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#include \"config.h\"\n+#include \"system.h\"\n+#include \"coretypes.h\"\n+#include \"tm_rust.h\"\n+#include \"rust/rust-target.h\"\n+#include \"rust/rust-target-def.h\"\n+\n+/* Do not include tm.h or tm_p.h here; definitions needed by the target\n+   architecture to initialize targetrustm should instead be added to tm_rust.h.\n+ */\n+\n+struct gcc_targetrustm targetrustm = TARGETRUSTM_INITIALIZER;"}, {"sha": "66271fc6c7ce5d87776e52220b89807f092ecb9a", "filename": "gcc/configure", "status": "modified", "additions": 19, "deletions": 2, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -644,6 +644,7 @@ ISLLIBS\n GMPINC\n GMPLIBS\n target_cpu_default\n+rust_target_objs\n d_target_objs\n fortran_target_objs\n cxx_target_objs\n@@ -652,6 +653,8 @@ use_gcc_stdint\n xm_defines\n xm_include_list\n xm_file_list\n+tm_rust_include_list\n+tm_rust_file_list\n tm_d_include_list\n tm_d_file_list\n tm_p_include_list\n@@ -13427,6 +13430,17 @@ for f in $tm_d_file; do\n   esac\n done\n \n+tm_rust_file_list=\n+tm_rust_include_list=\n+for f in $tm_rust_file; do\n+  case $f in\n+    * )\n+       tm_rust_file_list=\"${tm_rust_file_list} \\$(srcdir)/config/$f\"\n+       tm_rust_include_list=\"${tm_rust_include_list} config/$f\"\n+       ;;\n+  esac\n+done\n+\n xm_file_list=\n xm_include_list=\n for f in $xm_file; do\n@@ -19689,7 +19703,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 19692 \"configure\"\n+#line 19706 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -19795,7 +19809,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 19798 \"configure\"\n+#line 19812 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -31644,6 +31658,9 @@ fi\n \n \n \n+\n+\n+\n \n \n "}, {"sha": "c8998aafb8c825ff0542e7319b093c178cdce6f7", "filename": "gcc/configure.ac", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -2362,6 +2362,17 @@ for f in $tm_d_file; do\n   esac\n done\n \n+tm_rust_file_list=\n+tm_rust_include_list=\n+for f in $tm_rust_file; do\n+  case $f in\n+    * )\n+       tm_rust_file_list=\"${tm_rust_file_list} \\$(srcdir)/config/$f\"\n+       tm_rust_include_list=\"${tm_rust_include_list} config/$f\"\n+       ;;\n+  esac\n+done\n+\n xm_file_list=\n xm_include_list=\n for f in $xm_file; do\n@@ -7310,6 +7321,8 @@ AC_SUBST(tm_p_file_list)\n AC_SUBST(tm_p_include_list)\n AC_SUBST(tm_d_file_list)\n AC_SUBST(tm_d_include_list)\n+AC_SUBST(tm_rust_file_list)\n+AC_SUBST(tm_rust_include_list)\n AC_SUBST(xm_file_list)\n AC_SUBST(xm_include_list)\n AC_SUBST(xm_defines)\n@@ -7318,6 +7331,7 @@ AC_SUBST(c_target_objs)\n AC_SUBST(cxx_target_objs)\n AC_SUBST(fortran_target_objs)\n AC_SUBST(d_target_objs)\n+AC_SUBST(rust_target_objs)\n AC_SUBST(target_cpu_default)\n \n AC_SUBST_FILE(language_hooks)"}, {"sha": "9042059fd8a276a834120649a272526cee1a0946", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -115,6 +115,14 @@ initialize @code{targetdm} themselves, they should set\n @code{target_has_targetdm=yes} in @file{config.gcc}; otherwise a default\n definition is used.\n \n+Similarly, there is a @code{targetrustm} variable for hooks that are\n+specific to the Rust language front end, documented as ``Rust Target\n+Hook''.  This is declared in @file{rust/rust-target.h}, the initializer\n+@code{TARGETRUSTM_INITIALIZER} in @file{rust/rust-target-def.h}.\n+If targets initialize @code{targetrustm} themselves, they should set\n+@code{target_has_targetrustm=yes} in @file{config.gcc}; otherwise a\n+default definition is used.\n+\n @node Driver\n @section Controlling the Compilation Driver, @file{gcc}\n @cindex driver"}, {"sha": "dc639cc643f1846bdeb585ac18a68b1ebf8b20db", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -115,6 +115,14 @@ initialize @code{targetdm} themselves, they should set\n @code{target_has_targetdm=yes} in @file{config.gcc}; otherwise a default\n definition is used.\n \n+Similarly, there is a @code{targetrustm} variable for hooks that are\n+specific to the Rust language front end, documented as ``Rust Target\n+Hook''.  This is declared in @file{rust/rust-target.h}, the initializer\n+@code{TARGETRUSTM_INITIALIZER} in @file{rust/rust-target-def.h}.\n+If targets initialize @code{targetrustm} themselves, they should set\n+@code{target_has_targetrustm=yes} in @file{config.gcc}; otherwise a\n+default definition is used.\n+\n @node Driver\n @section Controlling the Compilation Driver, @file{gcc}\n @cindex driver"}, {"sha": "4e1338d21b7f229b3eb9ac357437a893f3ce8cd5", "filename": "gcc/genhooks.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fgenhooks.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Fgenhooks.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgenhooks.cc?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -35,6 +35,7 @@ static struct hook_desc hook_array[] = {\n #include \"c-family/c-target.def\"\n #include \"common/common-target.def\"\n #include \"d/d-target.def\"\n+#include \"rust/rust-target.def\"\n #undef DEFHOOK\n };\n "}, {"sha": "8534c4b68c302d486864e83d9ea87ec36144e7ff", "filename": "gcc/rust/rust-target-def.h", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Frust%2Frust-target-def.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Frust%2Frust-target-def.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-target-def.h?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -0,0 +1,20 @@\n+/* Default initializers for Rust target hooks.\n+   Copyright (C) 2022 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by the\n+   Free Software Foundation; either version 3, or (at your option) any\n+   later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program; see the file COPYING3.  If not see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+#include \"rust/rust-target-hooks-def.h\"\n+#include \"tree.h\"\n+#include \"hooks.h\""}, {"sha": "c800eefcfaa7cdcb0712ecb73155fa268c9e378d", "filename": "gcc/rust/rust-target.def", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Frust%2Frust-target.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Frust%2Frust-target.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-target.def?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -0,0 +1,32 @@\n+/* Target hook definitions for the Rust front end.\n+   Copyright (C) 2022 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by the\n+   Free Software Foundation; either version 3, or (at your option) any\n+   later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program; see the file COPYING3.  If not see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+/* See target-hooks-macros.h for details of macros that should be\n+   provided by the including file, and how to use them here.  */\n+\n+#include \"target-hooks-macros.h\"\n+\n+#undef HOOK_TYPE\n+#define HOOK_TYPE \"Rust Target Hook\"\n+\n+HOOK_VECTOR (TARGETRUSTM_INITIALIZER, gcc_targetrustm)\n+\n+#undef HOOK_PREFIX\n+#define HOOK_PREFIX \"TARGET_\"\n+\n+/* Close the 'struct gcc_targetrustm' definition.  */\n+HOOK_VECTOR_END (C90_EMPTY_HACK)"}, {"sha": "79edd786cddf08993154c2dfb633d2947d78b96a", "filename": "gcc/rust/rust-target.h", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Frust%2Frust-target.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/066b6b8df960796362dbdcff62851ebea201b8e9/gcc%2Frust%2Frust-target.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-target.h?ref=066b6b8df960796362dbdcff62851ebea201b8e9", "patch": "@@ -0,0 +1,31 @@\n+/* Data structure definitions for target-specific Rust behavior.\n+   Copyright (C) 2022 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by the\n+   Free Software Foundation; either version 3, or (at your option) any\n+   later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program; see the file COPYING3.  If not see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+#ifndef GCC_RUST_TARGET_H\n+#define GCC_RUST_TARGET_H\n+\n+#define DEFHOOKPOD(NAME, DOC, TYPE, INIT) TYPE NAME;\n+#define DEFHOOK(NAME, DOC, TYPE, PARAMS, INIT) TYPE (*NAME) PARAMS;\n+#define DEFHOOK_UNDOC DEFHOOK\n+#define HOOKSTRUCT(FRAGMENT) FRAGMENT\n+\n+#include \"rust-target.def\"\n+\n+/* Each target can provide their own.  */\n+extern struct gcc_targetrustm targetrustm;\n+\n+#endif /* GCC_RUST_TARGET_H  */"}]}