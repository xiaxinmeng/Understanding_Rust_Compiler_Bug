{"sha": "06658c6d05b360dfb85b173d67975603d5e960f3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY2NThjNmQwNWIzNjBkZmI4NWIxNzNkNjc5NzU2MDNkNWU5NjBmMw==", "commit": {"author": {"name": "Senthil Kumar Selvaraj", "email": "senthil_kumar.selvaraj@atmel.com", "date": "2016-11-08T06:30:31Z"}, "committer": {"name": "Senthil Kumar Selvaraj", "email": "saaadhu@gcc.gnu.org", "date": "2016-11-08T06:30:31Z"}, "message": "Fix bogus store_merging_x.c failures for avr.\n\nStore merging isn't profitable for the avr. Add a new\neffective target keyword \"store_merge\", and turn it on\nonly if non_strict_align *and* int32plus, as targets with\nsmallish word sizes are unlikely to profit from this optimization.\n\ngcc/testsuite/ChangeLog\n\n2016-11-03  Senthil Kumar Selvaraj  <senthil_kumar.selvaraj@atmel.com>\n\n\t* gcc.dg/store_merging_1.c: Require store_merge.\n\t* gcc.dg/store_merging_2.c: Likewise.\n\t* gcc.dg/store_merging_4.c: Likewise.\n\t* gcc.dg/store_merging_5.c: Likewise. \n\t* gcc.dg/store_merging_6.c: Likewise.\n\t* gcc.dg/store_merging_7.c: Likewise.\n\t* gcc.dg/store_merging_8.c: Likewise.\n\t* lib/target-supports.exp (check_effective_target_store_merge): New.\n\nFrom-SVN: r241953", "tree": {"sha": "1ce44e8ba76b8df2b77bf762ad455f78f96fd2ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1ce44e8ba76b8df2b77bf762ad455f78f96fd2ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/06658c6d05b360dfb85b173d67975603d5e960f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06658c6d05b360dfb85b173d67975603d5e960f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06658c6d05b360dfb85b173d67975603d5e960f3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06658c6d05b360dfb85b173d67975603d5e960f3/comments", "author": null, "committer": {"login": "saaadhu", "id": 532256, "node_id": "MDQ6VXNlcjUzMjI1Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/532256?v=4", "gravatar_id": "", "url": "https://api.github.com/users/saaadhu", "html_url": "https://github.com/saaadhu", "followers_url": "https://api.github.com/users/saaadhu/followers", "following_url": "https://api.github.com/users/saaadhu/following{/other_user}", "gists_url": "https://api.github.com/users/saaadhu/gists{/gist_id}", "starred_url": "https://api.github.com/users/saaadhu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/saaadhu/subscriptions", "organizations_url": "https://api.github.com/users/saaadhu/orgs", "repos_url": "https://api.github.com/users/saaadhu/repos", "events_url": "https://api.github.com/users/saaadhu/events{/privacy}", "received_events_url": "https://api.github.com/users/saaadhu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e525d6110b1f2bef005f41130187c7252213d5c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e525d6110b1f2bef005f41130187c7252213d5c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e525d6110b1f2bef005f41130187c7252213d5c2"}], "stats": {"total": 39, "additions": 32, "deletions": 7}, "files": [{"sha": "ba30991faff6ec8e48101b1f92c18938ed5c7764", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,3 +1,14 @@\n+2016-11-08  Senthil Kumar Selvaraj  <senthil_kumar.selvaraj@atmel.com>\n+\n+\t* gcc.dg/store_merging_1.c: Require store_merge.\n+\t* gcc.dg/store_merging_2.c: Likewise.\n+\t* gcc.dg/store_merging_4.c: Likewise.\n+\t* gcc.dg/store_merging_5.c: Likewise. \n+\t* gcc.dg/store_merging_6.c: Likewise.\n+\t* gcc.dg/store_merging_7.c: Likewise.\n+\t* gcc.dg/store_merging_8.c: Likewise.\n+\t* lib/target-supports.exp (check_effective_target_store_merge): New.\n+\n 2016-11-07  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* gcc.target/powerpc/fold-vec-add-1.c: Add dg-options -maltivec."}, {"sha": "4cc43dfd9e17ddc0984bd263708a96a8be1fd035", "filename": "gcc/testsuite/gcc.dg/store_merging_1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_1.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n struct bar {"}, {"sha": "8cd29f4243c15730224156ca4bb8dc233f615aef", "filename": "gcc/testsuite/gcc.dg/store_merging_2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_2.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n struct bar"}, {"sha": "719c2c038e4520b150808e11d1ac55984f279361", "filename": "gcc/testsuite/gcc.dg/store_merging_4.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_4.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n /* Check that we can merge interleaving stores that are guaranteed"}, {"sha": "e6c349767bc6c67bfe5e36ff5828edf99d87301f", "filename": "gcc/testsuite/gcc.dg/store_merging_5.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_5.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n /* Make sure that non-aliasing non-constant interspersed stores do not"}, {"sha": "314829da6d3c1d1e3f78cbec13f41927f4018ed8", "filename": "gcc/testsuite/gcc.dg/store_merging_6.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_6.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n /* Check that we can widen accesses to bitfields.  */"}, {"sha": "c744ece64073821bdfa7cfeb5a601beca0c12c9d", "filename": "gcc/testsuite/gcc.dg/store_merging_7.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_7.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n /* Check that we can merge consecutive array members through the pointer."}, {"sha": "e710a544ff0591a53f2977c835265417ab0e4e4a", "filename": "gcc/testsuite/gcc.dg/store_merging_8.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_8.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_8.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_8.c?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-require-effective-target non_strict_align } */\n+/* { dg-require-effective-target store_merge } */\n /* { dg-options \"-O2 -fdump-tree-store-merging\" } */\n \n struct baz {"}, {"sha": "b683c09c1db0eb9edd73f2e2e824d6b0368df3fe", "filename": "gcc/testsuite/lib/target-supports.exp", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06658c6d05b360dfb85b173d67975603d5e960f3/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Ftarget-supports.exp?ref=06658c6d05b360dfb85b173d67975603d5e960f3", "patch": "@@ -8107,3 +8107,17 @@ proc check_effective_target_divmod_simode { } {\n \n     return [check_effective_target_divmod]\n }\n+\n+# Return 1 if store merging optimization is applicable for target.\n+# Store merging is not profitable for targets like the avr which\n+# can load/store only one byte at a time. Use int size as a proxy\n+# for the number of bytes the target can write, and skip for targets\n+# with a smallish (< 32) size.\n+\n+proc check_effective_target_store_merge { } {\n+    if { [is-effective-target non_strict_align ] && [is-effective-target int32plus] } {\n+\treturn 1\n+    }\n+\n+    return 0\n+}"}]}