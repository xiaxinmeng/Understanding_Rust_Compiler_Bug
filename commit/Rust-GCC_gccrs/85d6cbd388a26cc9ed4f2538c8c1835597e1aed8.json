{"sha": "85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODVkNmNiZDM4OGEyNmNjOWVkNGYyNTM4YzhjMTgzNTU5N2UxYWVkOA==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@gmail.com", "date": "2006-11-25T21:43:48Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2006-11-25T21:43:48Z"}, "message": "re PR fortran/29951 (incorrect conversion from string to integer by TRANSFER())\n\n2006-11-25  Andrew Pinski  <pinskia@gmail.com>\n\n        PR fortran/29951\n        * trans-intrinsic.c (gfc_conv_intrinsic_transfer): Change to\n        call memcpy instead of creating a VIEW_CONVERT_EXRP.\n\n2006-11-25  Andrew Pinski  <pinskia@gmail.com>\n\n        PR fortran/29951\n        * gfortran.fortran-torture/execute/transfer2.f90: New test\n\nFrom-SVN: r119211", "tree": {"sha": "ccee1801f6d73f965a89221a4a0fc6639305f76e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ccee1801f6d73f965a89221a4a0fc6639305f76e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/comments", "author": {"login": "pinskia", "id": 8496799, "node_id": "MDQ6VXNlcjg0OTY3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8496799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pinskia", "html_url": "https://github.com/pinskia", "followers_url": "https://api.github.com/users/pinskia/followers", "following_url": "https://api.github.com/users/pinskia/following{/other_user}", "gists_url": "https://api.github.com/users/pinskia/gists{/gist_id}", "starred_url": "https://api.github.com/users/pinskia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pinskia/subscriptions", "organizations_url": "https://api.github.com/users/pinskia/orgs", "repos_url": "https://api.github.com/users/pinskia/repos", "events_url": "https://api.github.com/users/pinskia/events{/privacy}", "received_events_url": "https://api.github.com/users/pinskia/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "56d8eb6260b8c8f9e65b40348384e9b28c03f3ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56d8eb6260b8c8f9e65b40348384e9b28c03f3ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56d8eb6260b8c8f9e65b40348384e9b28c03f3ce"}], "stats": {"total": 52, "additions": 49, "deletions": 3}, "files": [{"sha": "cf7879758c6312d05f89324a59195d70b41d03a5", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "patch": "@@ -1,3 +1,9 @@\n+2006-11-25  Andrew Pinski  <pinskia@gmail.com>\n+\n+\tPR fortran/29951\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_transfer): Change to\n+\tcall memcpy instead of creating a VIEW_CONVERT_EXRP.\n+\n 2006-11-25  Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n \n \tPR fortran/29711"}, {"sha": "9256e86776e23ee50e7c616fb65f9527ca90e62b", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "patch": "@@ -2989,7 +2989,7 @@ gfc_conv_intrinsic_array_transfer (gfc_se * se, gfc_expr * expr)\n \n \n /* Scalar transfer statement.\n-   TRANSFER (source, mold) = VIEW_CONVERT_EXPR<typeof<mold> >source.  */\n+   TRANSFER (source, mold) = memcpy(&tmpdecl, &source, size), tmpdecl.  */\n \n static void\n gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n@@ -2999,6 +2999,7 @@ gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n   tree type;\n   tree ptr;\n   gfc_ss *ss;\n+  tree tmpdecl, tmp, args;\n \n   /* Get a pointer to the source.  */\n   arg = expr->value.function.actual;\n@@ -3014,6 +3015,7 @@ gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n \n   arg = arg->next;\n   type = gfc_typenode_for_spec (&expr->ts);\n+\n   if (expr->ts.type == BT_CHARACTER)\n     {\n       ptr = convert (build_pointer_type (type), ptr);\n@@ -3026,8 +3028,22 @@ gfc_conv_intrinsic_transfer (gfc_se * se, gfc_expr * expr)\n     }\n   else\n     {\n-      tree tmp = build_fold_indirect_ref (ptr);\n-      se->expr = fold_build1 (VIEW_CONVERT_EXPR, type, tmp);\n+      tree moldsize;\n+      tmpdecl = gfc_create_var (type, \"transfer\");\n+      moldsize = size_in_bytes (type);\n+\n+      /* Use memcpy to do the transfer.  */\n+      tmp = build1 (ADDR_EXPR, build_pointer_type (type), tmpdecl);\n+      tmp = fold_convert (pvoid_type_node, tmp);\n+      args = gfc_chainon_list (NULL_TREE, tmp);\n+      tmp = fold_convert (pvoid_type_node, ptr);\n+      args = gfc_chainon_list (args, tmp);\n+      args = gfc_chainon_list (args, moldsize);\n+      tmp = built_in_decls[BUILT_IN_MEMCPY];\n+      tmp = build_function_call_expr (tmp, args);\n+      gfc_add_expr_to_block (&se->pre, tmp);\n+\n+      se->expr = tmpdecl;\n     }\n }\n "}, {"sha": "ccb37744d5a9d8e48ad42d54a68eb3d65db0a37f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "patch": "@@ -1,3 +1,8 @@\n+2006-11-25  Andrew Pinski  <pinskia@gmail.com>\n+\n+\tPR fortran/29951\n+\t* gfortran.fortran-torture/execute/transfer2.f90: New test.\n+\n 2006-11-25  Francois-Xavier Coudert  <coudert@clipper.ens.fr>\n \n \t* gfortran.fortran-torture/execute/specifics.f90: Remove test"}, {"sha": "b57841c30f012682f1490ca080e24ac87fb87b9b", "filename": "gcc/testsuite/gfortran.fortran-torture/execute/transfer2.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Ftransfer2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/85d6cbd388a26cc9ed4f2538c8c1835597e1aed8/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Ftransfer2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.fortran-torture%2Fexecute%2Ftransfer2.f90?ref=85d6cbd388a26cc9ed4f2538c8c1835597e1aed8", "patch": "@@ -0,0 +1,19 @@\n+program test_convert\n+\n+  implicit none\n+  character(len=4)              :: byte_string\n+  character(len=1),dimension(4) :: byte_array\n+  integer*4 :: value,value1,n,i\n+\n+  byte_string(1:1) = char(157)\n+  byte_string(2:2) = char(127)\n+  byte_string(3:3) = char(100)\n+  byte_string(4:4) = char(0)\n+\n+  byte_array(1:4) = (/char(157),char(127),char(100),char(0)/)\n+\n+  value = transfer(byte_string(1:4),value)\n+  value1 = transfer(byte_array(1:4),value1)\n+\n+  if (value .ne. value1)  call abort()\n+end program test_convert"}]}