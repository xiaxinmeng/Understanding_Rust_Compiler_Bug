{"sha": "eb3490b96c149c8a5559b3f3947257c4ce0df650", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWIzNDkwYjk2YzE0OWM4YTU1NTliM2YzOTQ3MjU3YzRjZTBkZjY1MA==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2005-04-27T00:47:06Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2005-04-27T00:47:06Z"}, "message": "re PR c/21213 (segfault declaring a transparent union)\n\n\tPR c/21213\n\t* c-decl.c (finish_struct): Don't dereference NULL TYPE_FIELDS of\n\ttransparent union.\n\ntestsuite:\n\t* gcc.dg/transparent-union-3.c: New test.\n\nFrom-SVN: r98808", "tree": {"sha": "cf0c6299cc325166c5334689a7def45d807128fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf0c6299cc325166c5334689a7def45d807128fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eb3490b96c149c8a5559b3f3947257c4ce0df650", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb3490b96c149c8a5559b3f3947257c4ce0df650", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb3490b96c149c8a5559b3f3947257c4ce0df650", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb3490b96c149c8a5559b3f3947257c4ce0df650/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "968744fc6609f4efdadb4272ac895d1e15867c77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/968744fc6609f4efdadb4272ac895d1e15867c77", "html_url": "https://github.com/Rust-GCC/gccrs/commit/968744fc6609f4efdadb4272ac895d1e15867c77"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "f0da7e624b73807d50bf4256334f9f59d1f9944a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=eb3490b96c149c8a5559b3f3947257c4ce0df650", "patch": "@@ -1,3 +1,9 @@\n+2005-04-27  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/21213\n+\t* c-decl.c (finish_struct): Don't dereference NULL TYPE_FIELDS of\n+\ttransparent union.\n+\n 2005-04-27  Joseph S. Myers  <joseph@codesourcery.com>\n \n \tPR c/20740"}, {"sha": "3578862269f0e629218fcaee55cf2e2db3cc0b1c", "filename": "gcc/c-decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=eb3490b96c149c8a5559b3f3947257c4ce0df650", "patch": "@@ -5329,7 +5329,7 @@ finish_struct (tree t, tree fieldlist, tree attributes)\n      make it one, warn and turn off the flag.  */\n   if (TREE_CODE (t) == UNION_TYPE\n       && TYPE_TRANSPARENT_UNION (t)\n-      && TYPE_MODE (t) != DECL_MODE (TYPE_FIELDS (t)))\n+      && (!TYPE_FIELDS (t) || TYPE_MODE (t) != DECL_MODE (TYPE_FIELDS (t))))\n     {\n       TYPE_TRANSPARENT_UNION (t) = 0;\n       warning (0, \"union cannot be made transparent\");"}, {"sha": "bd88d352ed926e7e975c601bf065b8e0c26401f6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eb3490b96c149c8a5559b3f3947257c4ce0df650", "patch": "@@ -1,3 +1,8 @@\n+2005-04-27  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/21213\n+\t* gcc.dg/transparent-union-3.c: New test.\n+\n 2005-04-27  Joseph S. Myers  <joseph@codesourcery.com>\n \n \tPR c/20740"}, {"sha": "cebd5f857716cb78fa16239e6347f6992dd0dc68", "filename": "gcc/testsuite/gcc.dg/transparent-union-3.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2Ftestsuite%2Fgcc.dg%2Ftransparent-union-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb3490b96c149c8a5559b3f3947257c4ce0df650/gcc%2Ftestsuite%2Fgcc.dg%2Ftransparent-union-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftransparent-union-3.c?ref=eb3490b96c149c8a5559b3f3947257c4ce0df650", "patch": "@@ -0,0 +1,22 @@\n+/* Test for ICEs on invalid transparent unions (empty or no named\n+   members).  Bug 21213.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+enum e { A };\n+\n+union __attribute__((__transparent_union__)) ue1 { enum e; }; /* { dg-warning \"warning: declaration does not declare anything\" } */\n+/* { dg-warning \"warning: union cannot be made transparent\" \"\" { target *-*-* } 9 } */\n+union ue2 { enum e; } __attribute__((__transparent_union__)); /* { dg-warning \"warning: declaration does not declare anything\" } */\n+/* { dg-warning \"warning: union cannot be made transparent\" \"\" { target *-*-* } 11 } */\n+\n+union __attribute__((__transparent_union__)) ui1 { int; }; /* { dg-warning \"warning: declaration does not declare anything\" } */\n+/* { dg-warning \"warning: union cannot be made transparent\" \"\" { target *-*-* } 14 } */\n+union ui2 { int; } __attribute__((__transparent_union__)); /* { dg-warning \"warning: declaration does not declare anything\" } */\n+/* { dg-warning \"warning: union cannot be made transparent\" \"\" { target *-*-* } 16 } */\n+\n+union __attribute__((__transparent_union__)) u1 { };\n+/* { dg-warning \"warning: union cannot be made transparent\" \"\" { target *-*-* } 19 } */\n+union u2 { } __attribute__((__transparent_union__));\n+/* { dg-warning \"warning: union cannot be made transparent\" \"\" { target *-*-* } 21 } */"}]}