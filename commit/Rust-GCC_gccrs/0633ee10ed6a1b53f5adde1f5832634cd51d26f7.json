{"sha": "0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDYzM2VlMTBlZDZhMWI1M2Y1YWRkZTFmNTgzMjYzNGNkNTFkMjZmNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-06-02T16:36:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-06-02T16:36:04Z"}, "message": "re PR c++/71372 (C++ FE drops TREE_THIS_VOLATILE in cp_fold on all tcc_reference trees)\n\n\tPR c++/71372\n\t* cp-gimplify.c (cp_fold): For INDIRECT_REF, if the folded expression\n\tis INDIRECT_REF or MEM_REF, copy over TREE_READONLY, TREE_SIDE_EFFECTS\n\tand TREE_THIS_VOLATILE flags.  For ARRAY_REF and ARRAY_RANGE_REF, copy\n\tover TREE_READONLY, TREE_SIDE_EFFECTS and TREE_THIS_VOLATILE flags\n\tto the newly built tree.\n\n\t* c-c++-common/pr71372.c: New test.\n\nFrom-SVN: r237041", "tree": {"sha": "0a05305ad09d3624641409f3653039f434615285", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0a05305ad09d3624641409f3653039f434615285"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4ae1c663d45fd14498aa6f60ba22d4e5fb8495ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ae1c663d45fd14498aa6f60ba22d4e5fb8495ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ae1c663d45fd14498aa6f60ba22d4e5fb8495ab"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "651407151abbc185a7e1a91fa27a591d1bbce824", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "patch": "@@ -1,3 +1,12 @@\n+2016-06-02  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/71372\n+\t* cp-gimplify.c (cp_fold): For INDIRECT_REF, if the folded expression\n+\tis INDIRECT_REF or MEM_REF, copy over TREE_READONLY, TREE_SIDE_EFFECTS\n+\tand TREE_THIS_VOLATILE flags.  For ARRAY_REF and ARRAY_RANGE_REF, copy\n+\tover TREE_READONLY, TREE_SIDE_EFFECTS and TREE_THIS_VOLATILE flags\n+\tto the newly built tree.\n+\n 2016-05-31  Jason Merrill  <jason@redhat.com>\n \n \t* pt.c (instantiate_decl): Avoid recalculation."}, {"sha": "4fc8ba1afcacc379e89a2e6dbf5c477fa391b4b3", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "patch": "@@ -2035,7 +2035,16 @@ cp_fold (tree x)\n \t  if (op0 == error_mark_node)\n \t    x = error_mark_node;\n \t  else\n-\t    x = fold_build1_loc (loc, code, TREE_TYPE (x), op0);\n+\t    {\n+\t      x = fold_build1_loc (loc, code, TREE_TYPE (x), op0);\n+\t      if (code == INDIRECT_REF\n+\t\t  && (INDIRECT_REF_P (x) || TREE_CODE (x) == MEM_REF))\n+\t\t{\n+\t\t  TREE_READONLY (x) = TREE_READONLY (org_x);\n+\t\t  TREE_SIDE_EFFECTS (x) = TREE_SIDE_EFFECTS (org_x);\n+\t\t  TREE_THIS_VOLATILE (x) = TREE_THIS_VOLATILE (org_x);\n+\t\t}\n+\t    }\n \t}\n       else\n \tx = fold (x);\n@@ -2312,7 +2321,12 @@ cp_fold (tree x)\n \t      || op3 == error_mark_node)\n \t    x = error_mark_node;\n \t  else\n-\t    x = build4_loc (loc, code, TREE_TYPE (x), op0, op1, op2, op3);\n+\t    {\n+\t      x = build4_loc (loc, code, TREE_TYPE (x), op0, op1, op2, op3);\n+\t      TREE_READONLY (x) = TREE_READONLY (org_x);\n+\t      TREE_SIDE_EFFECTS (x) = TREE_SIDE_EFFECTS (org_x);\n+\t      TREE_THIS_VOLATILE (x) = TREE_THIS_VOLATILE (org_x);\n+\t    }\n \t}\n \n       x = fold (x);"}, {"sha": "899e2bced1fc3a9b62ab6248b456d029ae502653", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "patch": "@@ -1,5 +1,8 @@\n 2016-06-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/71372\n+\t* c-c++-common/pr71372.c: New test.\n+\n \t* gcc.dg/cpp/source_date_epoch-1.c (main): Test __DATE__ and\n \t__TIME__ strings with __builtin_strcmp instead of printf and\n \tdg-output."}, {"sha": "943adab628d784762a8a84f67e2dc4df666aea87", "filename": "gcc/testsuite/c-c++-common/pr71372.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr71372.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0633ee10ed6a1b53f5adde1f5832634cd51d26f7/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr71372.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr71372.c?ref=0633ee10ed6a1b53f5adde1f5832634cd51d26f7", "patch": "@@ -0,0 +1,14 @@\n+/* PR c++/71372 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+\n+void\n+foo (volatile int *p, int q)\n+{\n+  *(volatile int *)p = 0;\n+  *(p + (q - q) + 1) = 0;\n+  *(p + (q - q) + 2) = 0;\n+  *(p + (q - q) + 3) = 0;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \" ={v} \" 4 \"optimized\" } } */"}]}