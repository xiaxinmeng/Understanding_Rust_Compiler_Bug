{"sha": "c6f431bba531bac3212b66069cf0f9718edf0132", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzZmNDMxYmJhNTMxYmFjMzIxMmI2NjA2OWNmMGY5NzE4ZWRmMDEzMg==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely.gcc@gmail.com", "date": "2020-07-02T17:11:10Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2020-07-02T18:05:13Z"}, "message": "libstdc++: Fix atomic<long double> tests (PR 91153, PR 93224)\n\nThese tests fail with AIX double double. Use different floating point\nvalues that behave less surprisingly.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/91153\n\tPR target/93224\n\t* testsuite/29_atomics/atomic_float/1.cc: Use different values\n\tfor tests.\n\t* testsuite/29_atomics/atomic_ref/float.cc: Likewise.", "tree": {"sha": "ecad8dac3e93c5382730c2ede3014fb9f14d4341", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ecad8dac3e93c5382730c2ede3014fb9f14d4341"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c6f431bba531bac3212b66069cf0f9718edf0132", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6f431bba531bac3212b66069cf0f9718edf0132", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c6f431bba531bac3212b66069cf0f9718edf0132", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c6f431bba531bac3212b66069cf0f9718edf0132/comments", "author": null, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e6321c4508b2a85c21246c1c06a8208e2a151e48", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6321c4508b2a85c21246c1c06a8208e2a151e48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6321c4508b2a85c21246c1c06a8208e2a151e48"}], "stats": {"total": 131, "additions": 67, "deletions": 64}, "files": [{"sha": "a38b040ee8fc53e9695222c0b39aa4018dcd5539", "filename": "libstdc++-v3/testsuite/29_atomics/atomic_float/1.cc", "status": "modified", "additions": 44, "deletions": 42, "changes": 86, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c6f431bba531bac3212b66069cf0f9718edf0132/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2F1.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c6f431bba531bac3212b66069cf0f9718edf0132/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2F1.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_float%2F1.cc?ref=c6f431bba531bac3212b66069cf0f9718edf0132", "patch": "@@ -453,27 +453,28 @@ test03()\n     ok = a1.compare_exchange_strong(expected, 3.2l, mo);\n     VERIFY( !ok && a1.load() == 2.56l && expected == 2.56l );\n \n-    f0 = a0.fetch_add(1.2l);\n-    VERIFY( f0 == 12.8l );\n-    VERIFY( a0 == 14.0l );\n-    f1 = a1.fetch_add(2.4l, mo);\n-    VERIFY( f1 == 2.56l );\n-    VERIFY( a1 == 4.96l );\n-\n-    f0 = a0.fetch_sub(1.2l);\n-    VERIFY( f0 == 14.0l );\n-    VERIFY( a0 == 12.8l );\n-    f1 = a1.fetch_sub(3.5l, mo);\n-    VERIFY( f1 == 4.96l );\n-    VERIFY( a1 == 1.46l );\n-\n-    f0 = a0 += 1.2l;\n-    VERIFY( f0 == 14.0l );\n-    VERIFY( a0 == 14.0l );\n-\n-    f0 = a0 -= 0.8l;\n-    VERIFY( f0 == 13.2l );\n-    VERIFY( a0 == 13.2l );\n+    a1 = a0 = 0.5l;\n+    f0 = a0.fetch_add(0.25l);\n+    VERIFY( f0 == 0.5l );\n+    VERIFY( a0 == 0.75l );\n+    f1 = a1.fetch_add(0.25l, mo);\n+    VERIFY( f1 == 0.5l );\n+    VERIFY( a1 == 0.75l );\n+\n+    f0 = a0.fetch_sub(0.5l);\n+    VERIFY( f0 == 0.75l );\n+    VERIFY( a0 == 0.25l );\n+    f1 = a1.fetch_sub(0.5l, mo);\n+    VERIFY( f1 == 0.75l );\n+    VERIFY( a1 == 0.25l );\n+\n+    f0 = a0 += 0.75l;\n+    VERIFY( f0 == 1.0l );\n+    VERIFY( a0 == 1.0l );\n+\n+    f0 = a0 -= 0.5l;\n+    VERIFY( f0 == 0.5l );\n+    VERIFY( a0 == 0.5l );\n   }\n \n   // Repeat for volatile std::atomic<long double>\n@@ -540,27 +541,28 @@ test03()\n     ok = a1.compare_exchange_strong(expected, 3.2l, mo);\n     VERIFY( !ok && a1.load() == 2.56l && expected == 2.56l );\n \n-    f0 = a0.fetch_add(1.2l);\n-    VERIFY( f0 == 12.8l );\n-    VERIFY( a0 == 14.0l );\n-    f1 = a1.fetch_add(2.4l, mo);\n-    VERIFY( f1 == 2.56l );\n-    VERIFY( a1 == 4.96l );\n-\n-    f0 = a0.fetch_sub(1.2l);\n-    VERIFY( f0 == 14.0l );\n-    VERIFY( a0 == 12.8l );\n-    f1 = a1.fetch_sub(3.5l, mo);\n-    VERIFY( f1 == 4.96l );\n-    VERIFY( a1 == 1.46l );\n-\n-    f0 = a0 += 1.2l;\n-    VERIFY( f0 == 14.0l );\n-    VERIFY( a0 == 14.0l );\n-\n-    f0 = a0 -= 0.8l;\n-    VERIFY( f0 == 13.2l );\n-    VERIFY( a0 == 13.2l );\n+    a1 = a0 = 0.5l;\n+    f0 = a0.fetch_add(0.25l);\n+    VERIFY( f0 == 0.5l );\n+    VERIFY( a0 == 0.75l );\n+    f1 = a1.fetch_add(0.25l, mo);\n+    VERIFY( f1 == 0.5l );\n+    VERIFY( a1 == 0.75l );\n+\n+    f0 = a0.fetch_sub(0.5l);\n+    VERIFY( f0 == 0.75l );\n+    VERIFY( a0 == 0.25l );\n+    f1 = a1.fetch_sub(0.5l, mo);\n+    VERIFY( f1 == 0.75l );\n+    VERIFY( a1 == 0.25l );\n+\n+    f0 = a0 += 0.75l;\n+    VERIFY( f0 == 1.0l );\n+    VERIFY( a0 == 1.0l );\n+\n+    f0 = a0 -= 0.5l;\n+    VERIFY( f0 == 0.5l );\n+    VERIFY( a0 == 0.5l );\n   }\n }\n "}, {"sha": "4726a14f9ca86eb7d14d19ec4579468468c31585", "filename": "libstdc++-v3/testsuite/29_atomics/atomic_ref/float.cc", "status": "modified", "additions": 23, "deletions": 22, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c6f431bba531bac3212b66069cf0f9718edf0132/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_ref%2Ffloat.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c6f431bba531bac3212b66069cf0f9718edf0132/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_ref%2Ffloat.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F29_atomics%2Fatomic_ref%2Ffloat.cc?ref=c6f431bba531bac3212b66069cf0f9718edf0132", "patch": "@@ -267,31 +267,32 @@ test03()\n     ok = a.compare_exchange_strong(expected, 6.4l, mo);\n     VERIFY( !ok && a.load() == 204.8l && expected == 204.8l );\n \n-    v = a.fetch_add(3.2l);\n-    VERIFY( v == 204.8l );\n-    VERIFY( a == 208.0l );\n-    v = a.fetch_add(-8.5l, mo);\n-    VERIFY( v == 208.0l );\n-    VERIFY( a == 199.5l );\n-\n-    v = a.fetch_sub(109.5l);\n-    VERIFY( v == 199.5l );\n-    VERIFY( a == 90.0l );\n-    v = a.fetch_sub(2, mo);\n-    VERIFY( v == 90.0l );\n-    VERIFY( a == 88.0l );\n-\n-    v = a += 5.0l;\n-    VERIFY( v == 93.0l );\n-    VERIFY( a == 93.0l );\n-\n-    v = a -= 6.5l;\n-    VERIFY( v == 86.5l );\n-    VERIFY( a == 86.5l );\n+    a = 0.5l;\n+    v = a.fetch_add(0.5l);\n+    VERIFY( v == 0.5l );\n+    VERIFY( a == 1.0l );\n+    v = a.fetch_add(-0.2l, mo);\n+    VERIFY( v == 1.0l );\n+    VERIFY( a == 0.8l );\n+\n+    v = a.fetch_sub(0.4l);\n+    VERIFY( v == 0.8l );\n+    VERIFY( a == 0.4l );\n+    v = a.fetch_sub(-0.4l, mo);\n+    VERIFY( v == 0.4l );\n+    VERIFY( a == 0.8l );\n+\n+    v = a += .8l;\n+    VERIFY( v == 1.6l );\n+    VERIFY( a == 1.6l );\n+\n+    v = a -= 0.6l;\n+    VERIFY( v == 1.0l );\n+    VERIFY( a == 1.0l );\n   }\n \n   if constexpr (std::atomic_ref<long double>::is_always_lock_free)\n-    VERIFY( value == 86.5l );\n+    VERIFY( value == 1.0l );\n }\n \n void"}]}