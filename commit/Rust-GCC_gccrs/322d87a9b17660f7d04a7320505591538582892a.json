{"sha": "322d87a9b17660f7d04a7320505591538582892a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzIyZDg3YTliMTc2NjBmN2QwNGE3MzIwNTA1NTkxNTM4NTgyODkyYQ==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2018-08-21T14:48:35Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-08-21T14:48:35Z"}, "message": "[Ada] Crash processing SPARK annotate aspect\n\nThe compiler blows up writing the ALI file of a package that has a ghost\nsubprogram with an annotate contract.\n\n2018-08-21  Javier Miranda  <miranda@adacore.com>\n\ngcc/ada/\n\n\t* lib-writ.adb (Write_Unit_Information): Handle pragmas removed\n\tby the expander.\n\ngcc/testsuite/\n\n\t* gnat.dg/spark2.adb, gnat.dg/spark2.ads: New testcase.\n\nFrom-SVN: r263732", "tree": {"sha": "f2c5a63f3c954a385252992ef259e7cb05ccc167", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f2c5a63f3c954a385252992ef259e7cb05ccc167"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/322d87a9b17660f7d04a7320505591538582892a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/322d87a9b17660f7d04a7320505591538582892a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/322d87a9b17660f7d04a7320505591538582892a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/322d87a9b17660f7d04a7320505591538582892a/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "24241bd0388ec6f730788540b289da12c13a34cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24241bd0388ec6f730788540b289da12c13a34cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24241bd0388ec6f730788540b289da12c13a34cc"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "1d21061cd28b38d8d9debc9b09767dc8752c1846", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322d87a9b17660f7d04a7320505591538582892a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322d87a9b17660f7d04a7320505591538582892a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=322d87a9b17660f7d04a7320505591538582892a", "patch": "@@ -1,3 +1,8 @@\n+2018-08-21  Javier Miranda  <miranda@adacore.com>\n+\n+\t* lib-writ.adb (Write_Unit_Information): Handle pragmas removed\n+\tby the expander.\n+\n 2018-08-21  Ed Schonberg  <schonberg@adacore.com>\n \n \t* sem_ch6.adb (Check_Synchronized_Overriding): The conformance"}, {"sha": "beb9489ef0931e3f3b33d0e57cc2f86504b6ac43", "filename": "gcc/ada/lib-writ.adb", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322d87a9b17660f7d04a7320505591538582892a/gcc%2Fada%2Flib-writ.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322d87a9b17660f7d04a7320505591538582892a/gcc%2Fada%2Flib-writ.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-writ.adb?ref=322d87a9b17660f7d04a7320505591538582892a", "patch": "@@ -744,7 +744,14 @@ package body Lib.Writ is\n                   Note_Unit := U;\n                end if;\n \n-               if Note_Unit = Unit_Num then\n+               --  No action needed for pragmas removed by the expander (for\n+               --  example, pragmas of ignored ghost entities).\n+\n+               if Nkind (N) = N_Null_Statement then\n+                  pragma Assert (Nkind (Original_Node (N)) = N_Pragma);\n+                  null;\n+\n+               elsif Note_Unit = Unit_Num then\n                   Write_Info_Initiate ('N');\n                   Write_Info_Char (' ');\n "}, {"sha": "b4f0c41116db501d5fa16e24c8a8debb504d5aa6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322d87a9b17660f7d04a7320505591538582892a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322d87a9b17660f7d04a7320505591538582892a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=322d87a9b17660f7d04a7320505591538582892a", "patch": "@@ -1,3 +1,7 @@\n+2018-08-21  Javier Miranda  <miranda@adacore.com>\n+\n+\t* gnat.dg/spark2.adb, gnat.dg/spark2.ads: New testcase.\n+\n 2018-08-21  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/prot6.adb, gnat.dg/prot6.ads: New testcase."}, {"sha": "cb6c3b842e2109ea828c91a9d25f4198a6747a60", "filename": "gcc/testsuite/gnat.dg/spark2.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322d87a9b17660f7d04a7320505591538582892a/gcc%2Ftestsuite%2Fgnat.dg%2Fspark2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322d87a9b17660f7d04a7320505591538582892a/gcc%2Ftestsuite%2Fgnat.dg%2Fspark2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspark2.adb?ref=322d87a9b17660f7d04a7320505591538582892a", "patch": "@@ -0,0 +1,12 @@\n+--  { dg-do compile }\n+\n+package body SPARK2 with SPARK_Mode is\n+   function Factorial (N : Natural) return Natural is\n+   begin\n+      if N = 0 then\n+         return 1;\n+      else\n+         return N * Factorial (N - 1);\n+      end if;\n+   end Factorial;\n+end SPARK2;"}, {"sha": "c60b1e27501c763cd28cab3b7e79220e17f7bc03", "filename": "gcc/testsuite/gnat.dg/spark2.ads", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/322d87a9b17660f7d04a7320505591538582892a/gcc%2Ftestsuite%2Fgnat.dg%2Fspark2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/322d87a9b17660f7d04a7320505591538582892a/gcc%2Ftestsuite%2Fgnat.dg%2Fspark2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspark2.ads?ref=322d87a9b17660f7d04a7320505591538582892a", "patch": "@@ -0,0 +1,16 @@\n+package SPARK2 with SPARK_Mode is\n+\n+   function Expon (Value, Exp : Natural) return Natural is\n+      (if Exp = 0 then 1\n+       else Value * Expon (Value, Exp - 1))\n+   with Ghost,\n+        Pre => Value <= Max_Factorial_Number and Exp <= Max_Factorial_Number,\n+        Annotate => (GNATprove, Terminating);  --  CRASH!\n+\n+   Max_Factorial_Number : constant := 6;\n+\n+   function Factorial (N : Natural) return Natural with\n+      Pre => N < Max_Factorial_Number,\n+      Post => Factorial'Result <= Expon (Max_Factorial_Number, N);\n+\n+end SPARK2;"}]}