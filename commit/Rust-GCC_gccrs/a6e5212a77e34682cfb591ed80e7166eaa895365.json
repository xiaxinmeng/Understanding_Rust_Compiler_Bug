{"sha": "a6e5212a77e34682cfb591ed80e7166eaa895365", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTZlNTIxMmE3N2UzNDY4MmNmYjU5MWVkODBlNzE2NmVhYTg5NTM2NQ==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2017-06-19T13:27:48Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2017-06-19T13:27:48Z"}, "message": "Initialize live_switch_vars for SWITCH_BODY == STATEMENT_LIST (PR sanitizer/80879).\n\n2017-06-19  Martin Liska  <mliska@suse.cz>\n\n\tPR sanitizer/80879\n\t* gimplify.c (gimplify_switch_expr):\n\tInitialize live_switch_vars for SWITCH_BODY == STATEMENT_LIST.\n2017-06-19  Martin Liska  <mliska@suse.cz>\n\n\tPR sanitizer/80879\n\t* gcc.dg/asan/use-after-scope-switch-4.c: New test.\n\nFrom-SVN: r249368", "tree": {"sha": "306ee35916c9118ad658594b931d61933751b679", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/306ee35916c9118ad658594b931d61933751b679"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6e5212a77e34682cfb591ed80e7166eaa895365", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6e5212a77e34682cfb591ed80e7166eaa895365", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6e5212a77e34682cfb591ed80e7166eaa895365", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6e5212a77e34682cfb591ed80e7166eaa895365/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1a1e0df1cd646b81e35dd65523c3ae484d29fbf6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a1e0df1cd646b81e35dd65523c3ae484d29fbf6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a1e0df1cd646b81e35dd65523c3ae484d29fbf6"}], "stats": {"total": 49, "additions": 48, "deletions": 1}, "files": [{"sha": "aab38b1ce78edeaa411a078ba43a27467eff608b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a6e5212a77e34682cfb591ed80e7166eaa895365", "patch": "@@ -1,3 +1,9 @@\n+2017-06-19  Martin Liska  <mliska@suse.cz>\n+\n+\tPR sanitizer/80879\n+\t* gimplify.c (gimplify_switch_expr):\n+\tInitialize live_switch_vars for SWITCH_BODY == STATEMENT_LIST.\n+\n 2017-06-19  Martin Liska  <mliska@suse.cz>\n \n \t* doc/install.texi: Document that PGO runs in 4 stages."}, {"sha": "cf82f95160a22c0210fafbbb95c74c4b72535983", "filename": "gcc/gimplify.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=a6e5212a77e34682cfb591ed80e7166eaa895365", "patch": "@@ -2279,7 +2279,8 @@ gimplify_switch_expr (tree *expr_p, gimple_seq *pre_p)\n \n       /* Do not create live_switch_vars if SWITCH_BODY is not a BIND_EXPR.  */\n       saved_live_switch_vars = gimplify_ctxp->live_switch_vars;\n-      if (TREE_CODE (SWITCH_BODY (switch_expr)) == BIND_EXPR)\n+      tree_code body_type = TREE_CODE (SWITCH_BODY (switch_expr));\n+      if (body_type == BIND_EXPR || body_type == STATEMENT_LIST)\n \tgimplify_ctxp->live_switch_vars = new hash_set<tree> (4);\n       else\n \tgimplify_ctxp->live_switch_vars = NULL;"}, {"sha": "26e527c7e153d1cf44f1cab870584ac723c6a7e7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a6e5212a77e34682cfb591ed80e7166eaa895365", "patch": "@@ -1,3 +1,8 @@\n+2017-06-19  Martin Liska  <mliska@suse.cz>\n+\n+\tPR sanitizer/80879\n+\t* gcc.dg/asan/use-after-scope-switch-4.c: New test.\n+\n 2017-06-19  Martin Liska  <mliska@suse.cz>\n \n \tPR ipa/80732"}, {"sha": "290a920633baf4ab377286d3a22974bd04eda31f", "filename": "gcc/testsuite/gcc.dg/asan/use-after-scope-switch-4.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fuse-after-scope-switch-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6e5212a77e34682cfb591ed80e7166eaa895365/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fuse-after-scope-switch-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fuse-after-scope-switch-4.c?ref=a6e5212a77e34682cfb591ed80e7166eaa895365", "patch": "@@ -0,0 +1,35 @@\n+// { dg-do run }\n+// { dg-additional-options \"-fdump-tree-gimple\" }\n+\n+int *ptr;\n+\n+struct a\n+{\n+  int c;\n+};\n+\n+int main(int argc, char **argv)\n+{\n+  struct a e;\n+  e.c = 2;\n+  int x = 0;\n+\n+  for (;;)\n+    switch (e.c)    \n+      case 3:\n+\t{\n+\t  int resxxx;\n+\tcase 2:\n+\t  ptr = &resxxx;\n+\t  *ptr = 123;\n+\n+\t  if (x)\n+\t    return 0;\n+\t  else\n+\t    x = 1;\n+\t}\n+\n+  return 1;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"ASAN_MARK \\\\(UNPOISON, &resxxx, \\[0-9\\]\\\\);\" 2 \"gimple\" } }  */"}]}