{"sha": "2791be24535827b03f32ab5c84c5a5c746a8d9f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjc5MWJlMjQ1MzU4MjdiMDNmMzJhYjVjODRjNWE1Yzc0NmE4ZDlmNw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-01T08:07:19Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-01T08:07:19Z"}, "message": "[multiple changes]\n\n2012-10-01  Robert Dewar  <dewar@adacore.com>\n\n\t* sinfo.ads, exp_aggr.adb, sem_ch13.adb: Minor reformatting.\n\n2012-10-01  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_aggr.adb (Resolve_Array_Aggregate): Handle properly\n\tcomponent associations given by subtypes that have static\n\tpredicates.  Improve error message for overlapping ranges in\n\tarray aggregates.\n\n2012-10-01  Pascal Obry  <obry@adacore.com>\n\n\t* snames.ads-tmpl (Name_Link_Lib_Subdir): New constant.\n\n2012-10-01  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch9.adb (Analyze_Requeue): The target of a requeue\n\tstatement on a protected entry must be a variable. This is part\n\tof AI05-0225.\n\nFrom-SVN: r191889", "tree": {"sha": "a633d722b5a544243cf4b6ee732795da47287fd0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a633d722b5a544243cf4b6ee732795da47287fd0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2791be24535827b03f32ab5c84c5a5c746a8d9f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2791be24535827b03f32ab5c84c5a5c746a8d9f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2791be24535827b03f32ab5c84c5a5c746a8d9f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2791be24535827b03f32ab5c84c5a5c746a8d9f7/comments", "author": null, "committer": null, "parents": [{"sha": "f686b370e44cfe183978af7bddb49a5ca1830173", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f686b370e44cfe183978af7bddb49a5ca1830173", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f686b370e44cfe183978af7bddb49a5ca1830173"}], "stats": {"total": 128, "additions": 108, "deletions": 20}, "files": [{"sha": "3ae01b7baa86938d7f311026624582ca49ffab27", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -1,3 +1,24 @@\n+2012-10-01  Robert Dewar  <dewar@adacore.com>\n+\n+\t* sinfo.ads, exp_aggr.adb, sem_ch13.adb: Minor reformatting.\n+\n+2012-10-01  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_aggr.adb (Resolve_Array_Aggregate): Handle properly\n+\tcomponent associations given by subtypes that have static\n+\tpredicates.  Improve error message for overlapping ranges in\n+\tarray aggregates.\n+\n+2012-10-01  Pascal Obry  <obry@adacore.com>\n+\n+\t* snames.ads-tmpl (Name_Link_Lib_Subdir): New constant.\n+\n+2012-10-01  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch9.adb (Analyze_Requeue): The target of a requeue\n+\tstatement on a protected entry must be a variable. This is part\n+\tof AI05-0225.\n+\n 2012-09-26  Ian Lance Taylor  <iant@google.com>\n \n \t* gcc-interface/Makefile.in (LIBBACKTRACE): New variable."}, {"sha": "d8df2a8f81d70276d87ade73540724bd798ce274", "filename": "gcc/ada/exp_aggr.adb", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fexp_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fexp_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_aggr.adb?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -239,12 +239,13 @@ package body Exp_Aggr is\n    --  N is the N_Aggregate node to be expanded.\n \n    function Is_Two_Dim_Packed_Array (Typ : Entity_Id) return Boolean;\n-\n    --  For two-dimensional packed aggregates with constant bounds and constant\n    --  components, it is preferable to pack the inner aggregates because the\n    --  whole matrix can then be presented to the back-end as a one-dimensional\n    --  list of literals. This is much more efficient than expanding into single\n-   --  component assignments.\n+   --  component assignments. This function determines if the type Typ is for\n+   --  an array that is suitable for this optimization: it returns True if Typ\n+   --  is a two dimensional bit packed array with component size 1, 2, or 4.\n \n    function Late_Expansion\n      (N      : Node_Id;\n@@ -5924,8 +5925,7 @@ package body Exp_Aggr is\n    begin\n       return Number_Dimensions (Typ) = 2\n         and then Is_Bit_Packed_Array (Typ)\n-        and then\n-          (C = 1 or else C = 2 or else C = 4);\n+        and then (C = 1 or else C = 2 or else C = 4);\n    end Is_Two_Dim_Packed_Array;\n \n    --------------------"}, {"sha": "e4c27d015ea2699c2eb619f6adddf7633527bfc3", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 54, "deletions": 2, "changes": 56, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -1726,6 +1726,9 @@ package body Sem_Aggr is\n       Discard : Node_Id;\n       pragma Warnings (Off, Discard);\n \n+      Delete_Choice : Boolean;\n+      --  Used when replacing a subtype choice with predicate by a list\n+\n       Aggr_Low  : Node_Id := Empty;\n       Aggr_High : Node_Id := Empty;\n       --  The actual low and high bounds of this sub-aggregate\n@@ -1766,6 +1769,8 @@ package body Sem_Aggr is\n          Assoc := First (Component_Associations (N));\n          while Present (Assoc) loop\n             Choice := First (Choices (Assoc));\n+            Delete_Choice := False;\n+\n             while Present (Choice) loop\n                if Nkind (Choice) = N_Others_Choice then\n                   Others_Present := True;\n@@ -1792,10 +1797,56 @@ package body Sem_Aggr is\n                      Error_Msg_N\n                        (\"(Ada 83) illegal context for OTHERS choice\", N);\n                   end if;\n+\n+               elsif Is_Entity_Name (Choice) then\n+                  Analyze (Choice);\n+\n+                  declare\n+                     E      : constant Entity_Id := Entity (Choice);\n+                     New_Cs : List_Id;\n+                     P      : Node_Id;\n+                     C      : Node_Id;\n+\n+                  begin\n+                     if Is_Type (E) and then Has_Predicates (E) then\n+                        Freeze_Before (N, E);\n+\n+                        --  If the subtype has a static predicate, replace the\n+                        --  original choice with the list of individual values\n+                        --  covered by the predicate.\n+\n+                        if Present (Static_Predicate (E)) then\n+                           Delete_Choice := True;\n+\n+                           New_Cs := New_List;\n+                           P := First (Static_Predicate (E));\n+                           while Present (P) loop\n+                              C := New_Copy (P);\n+                              Set_Sloc (C, Sloc (Choice));\n+                              Append_To (New_Cs, C);\n+                              Next (P);\n+                           end loop;\n+\n+                           Insert_List_After (Choice, New_Cs);\n+                        end if;\n+                     end if;\n+                  end;\n                end if;\n \n                Nb_Choices := Nb_Choices + 1;\n-               Next (Choice);\n+\n+               declare\n+                  C : constant Node_Id := Choice;\n+\n+               begin\n+                  Next (Choice);\n+\n+                  if Delete_Choice then\n+                     Remove (C);\n+                     Nb_Choices := Nb_Choices - 1;\n+                     Delete_Choice := False;\n+                  end if;\n+               end;\n             end loop;\n \n             Next (Assoc);\n@@ -1998,6 +2049,7 @@ package body Sem_Aggr is\n                   Nb_Discrete_Choices := Nb_Discrete_Choices + 1;\n                   Table (Nb_Discrete_Choices).Choice_Lo := Low;\n                   Table (Nb_Discrete_Choices).Choice_Hi := High;\n+                  Table (Nb_Discrete_Choices).Choice_Node := Choice;\n \n                   Next (Choice);\n \n@@ -2115,7 +2167,7 @@ package body Sem_Aggr is\n                   then\n                      Error_Msg_N\n                        (\"duplicate choice values in array aggregate\",\n-                        Table (J).Choice_Hi);\n+                        Table (J).Choice_Node);\n                      return Failure;\n \n                   elsif not Others_Present then"}, {"sha": "02fb1131d1a19a3aa5940277d3b5732a1e9e7661", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -856,7 +856,7 @@ package body Sem_Ch13 is\n    --  Start of processing for Analyze_Aspects_At_Freeze_Point\n \n    begin\n-      --  Must be visible in current scope.\n+      --  Must be visible in current scope\n \n       if not Scope_Within_Or_Same (Current_Scope, Scope (E)) then\n          return;\n@@ -7966,18 +7966,20 @@ package body Sem_Ch13 is\n                      (Entity (Rep_Item), Aspect_Rep_Item (Rep_Item));\n       end Is_Pragma_Or_Corr_Pragma_Present_In_Rep_Item;\n \n+   --  Start of processing for Inherit_Aspects_At_Freeze_Point\n+\n    begin\n       --  A representation item is either subtype-specific (Size and Alignment\n       --  clauses) or type-related (all others).  Subtype-specific aspects may\n-      --  differ for different subtypes of the same type.(RM 13.1.8)\n+      --  differ for different subtypes of the same type (RM 13.1.8).\n \n       --  A derived type inherits each type-related representation aspect of\n       --  its parent type that was directly specified before the declaration of\n-      --  the derived type. (RM 13.1.15)\n+      --  the derived type (RM 13.1.15).\n \n       --  A derived subtype inherits each subtype-specific representation\n       --  aspect of its parent subtype that was directly specified before the\n-      --  declaration of the derived type .(RM 13.1.15)\n+      --  declaration of the derived type (RM 13.1.15).\n \n       --  The general processing involves inheriting a representation aspect\n       --  from a parent type whenever the first rep item (aspect specification,\n@@ -7986,11 +7988,11 @@ package body Sem_Ch13 is\n       --  directly specified to Typ but to one of its parents.\n \n       --  ??? Note that, for now, just a limited number of representation\n-      --  aspects have been inherited here so far. Many of them are still\n-      --  inherited in Sem_Ch3. This will be fixed soon. Here is a\n-      --  non-exhaustive list of aspects that likely also need to be moved to\n-      --  this routine: Alignment, Component_Alignment, Component_Size,\n-      --  Machine_Radix, Object_Size, Pack, Predicates,\n+      --  aspects have been inherited here so far. Many of them are\n+      --  still inherited in Sem_Ch3. This will be fixed soon. Here is\n+      --  a non- exhaustive list of aspects that likely also need to\n+      --  be moved to this routine: Alignment, Component_Alignment,\n+      --  Component_Size, Machine_Radix, Object_Size, Pack, Predicates,\n       --  Preelaborable_Initialization, RM_Size and Small.\n \n       if Nkind (Parent (Typ)) = N_Private_Extension_Declaration then\n@@ -8029,7 +8031,7 @@ package body Sem_Ch13 is\n          Set_Is_Volatile (Typ);\n       end if;\n \n-      --  Default_Component_Value.\n+      --  Default_Component_Value\n \n       if Is_Array_Type (Typ)\n         and then Has_Rep_Item (Typ, Name_Default_Component_Value, False)\n@@ -8040,7 +8042,7 @@ package body Sem_Ch13 is\n              (Entity (Get_Rep_Item (Typ, Name_Default_Component_Value))));\n       end if;\n \n-      --  Default_Value.\n+      --  Default_Value\n \n       if Is_Scalar_Type (Typ)\n         and then Has_Rep_Item (Typ, Name_Default_Value, False)\n@@ -8135,6 +8137,7 @@ package body Sem_Ch13 is\n             --  Record type specific aspects\n \n             if Is_Record_Type (Typ) then\n+\n                --  Bit_Order\n \n                if not Has_Rep_Item (Typ, Name_Bit_Order, False)"}, {"sha": "d40647ed7add4a786d365683c61288913667993d", "filename": "gcc/ada/sem_ch9.adb", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsem_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsem_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch9.adb?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -2379,6 +2379,18 @@ package body Sem_Ch9 is\n             end;\n          end if;\n       end if;\n+\n+      --  AI05-0225: the target protected object of a requeue must be a\n+      --  variable. This is a binding interpretation that applies to all\n+      --  versions of the language.\n+\n+      if Present (Target_Obj)\n+        and then Ekind (Scope (Entry_Id)) in Protected_Kind\n+        and then not Is_Variable (Target_Obj)\n+      then\n+         Error_Msg_N\n+           (\"target protected object of requeue must be a variable\", N);\n+      end if;\n    end Analyze_Requeue;\n \n    ------------------------------"}, {"sha": "16e92cd60e91b7cc47aa5e49d462b1c2239799db", "filename": "gcc/ada/sinfo.ads", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsinfo.ads?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -668,9 +668,8 @@ package Sinfo is\n    --  Compile_Time_Known_Aggregate (Flag18-Sem)\n    --    Present in N_Aggregate nodes. Set for aggregates which can be fully\n    --    evaluated at compile time without raising constraint error. Such\n-   --    aggregates can be passed as is to Gigi without any expansion. See\n-   --    Exp_Aggr for the specific conditions under which an aggregate has this\n-   --    flag set.\n+   --    aggregates can be passed as is the back end without any expansion.\n+   --    See Exp_Aggr for specific conditions under which this flag gets set.\n \n    --  Componentwise_Assignment (Flag14-Sem)\n    --    Present in N_Assignment_Statement nodes. Set for a record assignment"}, {"sha": "f4b31aa799608214cb94058bb1280eba6eddaa69", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2791be24535827b03f32ab5c84c5a5c746a8d9f7/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=2791be24535827b03f32ab5c84c5a5c746a8d9f7", "patch": "@@ -1208,6 +1208,7 @@ package Snames is\n    Name_Leading_Required_Switches          : constant Name_Id := N + $;\n    Name_Leading_Switches                   : constant Name_Id := N + $;\n    Name_Lib_Subdir                         : constant Name_Id := N + $;\n+   Name_Link_Lib_Subdir                    : constant Name_Id := N + $;\n    Name_Library                            : constant Name_Id := N + $;\n    Name_Library_Ali_Dir                    : constant Name_Id := N + $;\n    Name_Library_Auto_Init                  : constant Name_Id := N + $;"}]}