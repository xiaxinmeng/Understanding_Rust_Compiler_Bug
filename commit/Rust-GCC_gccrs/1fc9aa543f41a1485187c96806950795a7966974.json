{"sha": "1fc9aa543f41a1485187c96806950795a7966974", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWZjOWFhNTQzZjQxYTE0ODUxODdjOTY4MDY5NTA3OTVhNzk2Njk3NA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-06-04T13:49:55Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-06-04T13:49:55Z"}, "message": "re PR target/85832 ([AVX512] possible shorter code when comparing with vector of zeros)\n\n\tPR target/85832\n\tPR target/86036\n\t* config/i386/sse.md (<avx512>_eq<mode>3<mask_scalar_merge_name>_1):\n\tUse vptestnm rather than vptestm in (=Yc,v,C) variant.\n\n\t* gcc.target/i386/avx512f-pr85832.c: Expect vptestnm rather than\n\tvptestm.\n\t* gcc.target/i386/avx512vl-pr85832.c: Likewise.\n\t* gcc.target/i386/avx512vlbw-pr85832.c: Likewise.\n\t* gcc.target/i386/avx512bw-pr85832.c: Likewise.\n\t* gcc.target/i386/avx512bw-pr86036.c: New test.\n\nFrom-SVN: r261148", "tree": {"sha": "580722d2b1665a30f45c005753ba34030a5f1031", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/580722d2b1665a30f45c005753ba34030a5f1031"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1fc9aa543f41a1485187c96806950795a7966974", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc9aa543f41a1485187c96806950795a7966974", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1fc9aa543f41a1485187c96806950795a7966974", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc9aa543f41a1485187c96806950795a7966974/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "92a38cfd775c045d7ed8b989b231410849fc22fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92a38cfd775c045d7ed8b989b231410849fc22fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92a38cfd775c045d7ed8b989b231410849fc22fe"}], "stats": {"total": 86, "additions": 76, "deletions": 10}, "files": [{"sha": "eea029814cdc59e6cd590bc8fe7d74de2f46e9b9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -1,3 +1,10 @@\n+2018-06-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/85832\n+\tPR target/86036\n+\t* config/i386/sse.md (<avx512>_eq<mode>3<mask_scalar_merge_name>_1):\n+\tUse vptestnm rather than vptestm in (=Yc,v,C) variant.\n+\n 2018-06-04  Richard Biener  <rguenther@suse.de>\n \n \t* tree-cfgcleanup.c (cleanup_tree_cfg_1): Fold into..."}, {"sha": "2d4e495890d93e81ba63e330609540eaca155890", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -11287,7 +11287,7 @@\n   \"TARGET_AVX512BW && !(MEM_P (operands[1]) && MEM_P (operands[2]))\"\n   \"@\n    vpcmpeq<ssemodesuffix>\\t{%2, %1, %0<mask_scalar_merge_operand3>|%0<mask_scalar_merge_operand3>, %1, %2}\n-   vptestm<ssemodesuffix>\\t{%1, %1, %0<mask_scalar_merge_operand3>|%0<mask_scalar_merge_operand3>, %1, %1}\"\n+   vptestnm<ssemodesuffix>\\t{%1, %1, %0<mask_scalar_merge_operand3>|%0<mask_scalar_merge_operand3>, %1, %1}\"\n   [(set_attr \"type\" \"ssecmp\")\n    (set_attr \"prefix_extra\" \"1\")\n    (set_attr \"prefix\" \"evex\")\n@@ -11302,7 +11302,7 @@\n   \"TARGET_AVX512F && !(MEM_P (operands[1]) && MEM_P (operands[2]))\"\n   \"@\n    vpcmpeq<ssemodesuffix>\\t{%2, %1, %0<mask_scalar_merge_operand3>|%0<mask_scalar_merge_operand3>, %1, %2}\n-   vptestm<ssemodesuffix>\\t{%1, %1, %0<mask_scalar_merge_operand3>|%0<mask_scalar_merge_operand3>, %1, %1}\"\n+   vptestnm<ssemodesuffix>\\t{%1, %1, %0<mask_scalar_merge_operand3>|%0<mask_scalar_merge_operand3>, %1, %1}\"\n   [(set_attr \"type\" \"ssecmp\")\n    (set_attr \"prefix_extra\" \"1\")\n    (set_attr \"prefix\" \"evex\")"}, {"sha": "043a4f49495f8a8d7a1802a9a3e1f4405396b96b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -1,3 +1,14 @@\n+2018-06-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/85832\n+\tPR target/86036\n+\t* gcc.target/i386/avx512f-pr85832.c: Expect vptestnm rather than\n+\tvptestm.\n+\t* gcc.target/i386/avx512vl-pr85832.c: Likewise.\n+\t* gcc.target/i386/avx512vlbw-pr85832.c: Likewise.\n+\t* gcc.target/i386/avx512bw-pr85832.c: Likewise.\n+\t* gcc.target/i386/avx512bw-pr86036.c: New test.\n+\n 2018-06-04  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/86038"}, {"sha": "a406e0858ba0d49e58c247a23185f84a3393c63f", "filename": "gcc/testsuite/gcc.target/i386/avx512bw-pr85832.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr85832.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr85832.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr85832.c?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -1,8 +1,8 @@\n /* PR target/85832 */\n /* { dg-do compile } */\n /* { dg-options \"-O2 -mavx512bw -mno-avx512vl -masm=att\" } */\n-/* { dg-final { scan-assembler-times {\\mvptestmb\\M} 1 } } */\n-/* { dg-final { scan-assembler-times {\\mvptestmw\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmb\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmw\\M} 1 } } */\n \n #include <x86intrin.h>\n "}, {"sha": "47685e54f142d297e12ef6525c0ec3c679d30bb1", "filename": "gcc/testsuite/gcc.target/i386/avx512bw-pr86036.c", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr86036.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr86036.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512bw-pr86036.c?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -0,0 +1,48 @@\n+/* PR target/86036 */\n+/* { dg-do run } */\n+/* { dg-options \"-O -mavx512bw\" } */\n+/* { dg-require-effective-target avx512bw } */\n+\n+#define AVX512BW\n+#include \"avx512f-helper.h\"\n+\n+typedef unsigned short V __attribute__ ((vector_size (64)));\n+\n+__attribute__((noipa)) V\n+foo (V a)\n+{\n+  return a >= 3;\n+}\n+\n+__attribute__((noipa)) V\n+bar (V a)\n+{\n+  return a != 0;\n+}\n+\n+__attribute__((noipa)) V\n+baz (V a)\n+{\n+  return a == 0;\n+}\n+\n+void\n+TEST (void)\n+{\n+  V a = (V) { 3, 17, 2, 0, 9, 1, 2, 3, 0, 0, 0, 3, 3, 3, 3, 3,\n+\t      9, 16387, 9, 3, 3, 0, 0, 3, 3, 3, 0, 0, 0, 0, 3, 3 };\n+  V b = foo (a);\n+  V c = (V) { -1, -1, 0, 0, -1, 0, 0, -1, 0, 0, 0, -1, -1, -1, -1, -1,\n+\t      -1, -1, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1 };\n+  if (__builtin_memcmp (&b, &c, sizeof (b)))\n+    abort ();\n+  V d = bar (a);\n+  V e = (V) { -1, -1, -1, 0, -1, -1, -1, -1, 0, 0, 0, -1, -1, -1, -1, -1,\n+\t      -1, -1, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, 0, -1, -1 };\n+  if (__builtin_memcmp (&d, &e, sizeof (d)))\n+    abort ();\n+  V f = baz (a);\n+  V g = ~e;\n+  if (__builtin_memcmp (&f, &g, sizeof (f)))\n+    abort ();\n+}"}, {"sha": "a169776ec45f6680a574d6a44070d1510aa61a1e", "filename": "gcc/testsuite/gcc.target/i386/avx512f-pr85832.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85832.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85832.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512f-pr85832.c?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -1,8 +1,8 @@\n /* PR target/85832 */\n /* { dg-do compile } */\n /* { dg-options \"-O2 -mavx512f -mno-avx512vl -mno-avx512bw -masm=att\" } */\n-/* { dg-final { scan-assembler-times {\\mvptestmd\\M} 1 } } */\n-/* { dg-final { scan-assembler-times {\\mvptestmq\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmd\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmq\\M} 1 } } */\n \n #include <x86intrin.h>\n "}, {"sha": "09ed8936c21fdb1e2d0ee089ca45f50fb7df3e07", "filename": "gcc/testsuite/gcc.target/i386/avx512vl-pr85832.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vl-pr85832.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vl-pr85832.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vl-pr85832.c?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -1,8 +1,8 @@\n /* PR target/85832 */\n /* { dg-do compile } */\n /* { dg-options \"-O2 -mavx512vl -mno-avx512bw -masm=att\" } */\n-/* { dg-final { scan-assembler-times {\\mvptestmd\\M} 2 } } */\n-/* { dg-final { scan-assembler-times {\\mvptestmq\\M} 2 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmd\\M} 2 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmq\\M} 2 } } */\n \n #include <x86intrin.h>\n "}, {"sha": "ee93e0ddd59f306be3224e178d13d50b19ff703f", "filename": "gcc/testsuite/gcc.target/i386/avx512vlbw-pr85832.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vlbw-pr85832.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1fc9aa543f41a1485187c96806950795a7966974/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vlbw-pr85832.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vlbw-pr85832.c?ref=1fc9aa543f41a1485187c96806950795a7966974", "patch": "@@ -1,8 +1,8 @@\n /* PR target/85832 */\n /* { dg-do compile } */\n /* { dg-options \"-O2 -mavx512vl -mavx512bw -masm=att\" } */\n-/* { dg-final { scan-assembler-times {\\mvptestmb\\M} 2 } } */\n-/* { dg-final { scan-assembler-times {\\mvptestmw\\M} 2 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmb\\M} 2 } } */\n+/* { dg-final { scan-assembler-times {\\mvptestnmw\\M} 2 } } */\n \n #include <x86intrin.h>\n "}]}