{"sha": "bb2e1640492f6b6989131cef45519dfd47a1acbb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmIyZTE2NDA0OTJmNmI2OTg5MTMxY2VmNDU1MTlkZmQ0N2ExYWNiYg==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2005-02-22T02:27:37Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2005-02-22T02:27:37Z"}, "message": "re PR tree-optimization/19786 (Aliasing optimisation bug)\n\ngcc/ChangeLog:\nPR tree-optimization/19786\n* tree-ssa-alias.c (compute_flow_insensitive_aliasing): Add one\ntag to another's may-alias bitmap when adding to the other's list.\ngcc/testsuite/ChangeLog:\nPR tree-optimization/19786\n* g++.dg/tree-ssa/pr19786.C: New.\n\nFrom-SVN: r95377", "tree": {"sha": "e53536f3c19ce30de20e9fb83251734c20e5e305", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e53536f3c19ce30de20e9fb83251734c20e5e305"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bb2e1640492f6b6989131cef45519dfd47a1acbb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb2e1640492f6b6989131cef45519dfd47a1acbb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb2e1640492f6b6989131cef45519dfd47a1acbb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb2e1640492f6b6989131cef45519dfd47a1acbb/comments", "author": null, "committer": null, "parents": [{"sha": "1d27fed446abb6a831261c004803cf23d994b296", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d27fed446abb6a831261c004803cf23d994b296", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d27fed446abb6a831261c004803cf23d994b296"}], "stats": {"total": 60, "additions": 60, "deletions": 0}, "files": [{"sha": "fa3709688c926f4088820a2537f2d8113c69785a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bb2e1640492f6b6989131cef45519dfd47a1acbb", "patch": "@@ -1,3 +1,9 @@\n+2005-02-21  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR tree-optimization/19786\n+\t* tree-ssa-alias.c (compute_flow_insensitive_aliasing): Add one\n+\ttag to another's may-alias bitmap when adding to the other's list.\n+\n 2005-02-21  DJ Delorie  <dj@redhat.com>\n \n \t* tree-ssa-loop-ivopts.c (computation_cost): Start register"}, {"sha": "dd742ed74b9b212681d3f0456b355f5cb1bd395c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bb2e1640492f6b6989131cef45519dfd47a1acbb", "patch": "@@ -1,3 +1,8 @@\n+2005-02-21  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\tPR tree-optimization/19786\n+\t* g++.dg/tree-ssa/pr19786.C: New.\n+\n 2005-02-21  Tobias Schl\"uter  <tobias.schlueter@physik.uni-muenchen.de>\n \n \t* lib/gfortran-dg.exp (gfortran-dg-test): Split long regexps."}, {"sha": "faaecdfd97174aa82376b6d67a574a7e459785d4", "filename": "gcc/testsuite/g++.dg/tree-ssa/pr19786.C", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr19786.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr19786.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr19786.C?ref=bb2e1640492f6b6989131cef45519dfd47a1acbb", "patch": "@@ -0,0 +1,48 @@\n+// { dg-do run }\n+/* { dg-options \"-O2\" } */\n+\n+// We used to get alias grouping wrong on this one, hoisting accesses\n+// to the vector's end out of the loop.\n+\n+#include <vector>\n+#include <cassert>\n+\n+struct A\n+{\n+  double unused;      // If I remove it => it works.\n+  std::vector<int> v;\n+\n+  A() : v(1) {}\n+};\n+\n+inline // If not inline => it works.\n+A g()\n+{\n+  A r;\n+  r.v.resize(2);\n+  r.v[0] = 1;\n+\n+  while (!r.v.empty() && r.v.back() == 0)\n+    r.v.pop_back();\n+\n+  return r;\n+}\n+\n+A f(const A &a)\n+{\n+  if (a.v.empty())  return a;\n+  if (a.v.empty())  return a;\n+\n+  // A z = g(); return z;  // If I return like this => it works.\n+  return g();\n+}\n+\n+int main()\n+{\n+  A a;\n+  A b;\n+  A r = f(a);\n+  assert(r.v.size() != 0);\n+\n+  return 0;\n+}"}, {"sha": "bfa1685eb9ed8e23c464d0e59881b620a465cb44", "filename": "gcc/tree-ssa-alias.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2Ftree-ssa-alias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb2e1640492f6b6989131cef45519dfd47a1acbb/gcc%2Ftree-ssa-alias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-alias.c?ref=bb2e1640492f6b6989131cef45519dfd47a1acbb", "patch": "@@ -1116,6 +1116,7 @@ compute_flow_insensitive_aliasing (struct alias_info *ai)\n \t      /* Since TAG2 does not have any aliases of its own, add\n \t\t TAG2 itself to the alias set of TAG1.  */\n \t      add_may_alias (tag1, tag2);\n+\t      SET_BIT (may_aliases1, var_ann (tag2)->uid);\n \t    }\n \t}\n     }"}]}