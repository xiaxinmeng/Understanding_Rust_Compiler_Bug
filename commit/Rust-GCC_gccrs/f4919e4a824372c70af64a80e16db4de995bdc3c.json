{"sha": "f4919e4a824372c70af64a80e16db4de995bdc3c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjQ5MTllNGE4MjQzNzJjNzBhZjY0YTgwZTE2ZGI0ZGU5OTViZGMzYw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2012-11-28T21:01:26Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2012-11-28T21:01:26Z"}, "message": "re PR libgcc/48076 (Unsafe double checked locking in __emutls_get_address)\n\nPR libgcc/48076\n        * emutls.c (__emutls_get_address): Avoid race condition between\n        obj->loc.offset read and emutls_key initialization.\n\nFrom-SVN: r193907", "tree": {"sha": "f08c3d71c7d0d279f944d16c9cc812bbd7a2220a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f08c3d71c7d0d279f944d16c9cc812bbd7a2220a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f4919e4a824372c70af64a80e16db4de995bdc3c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4919e4a824372c70af64a80e16db4de995bdc3c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f4919e4a824372c70af64a80e16db4de995bdc3c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4919e4a824372c70af64a80e16db4de995bdc3c/comments", "author": null, "committer": null, "parents": [{"sha": "361a58da83a1f870af4e53b6a22eabc53e1c2879", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/361a58da83a1f870af4e53b6a22eabc53e1c2879", "html_url": "https://github.com/Rust-GCC/gccrs/commit/361a58da83a1f870af4e53b6a22eabc53e1c2879"}], "stats": {"total": 10, "additions": 8, "deletions": 2}, "files": [{"sha": "6506e85e89fa5849049e13784bde53d0c427d82f", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f4919e4a824372c70af64a80e16db4de995bdc3c/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f4919e4a824372c70af64a80e16db4de995bdc3c/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=f4919e4a824372c70af64a80e16db4de995bdc3c", "patch": "@@ -1,3 +1,9 @@\n+2012-11-28  Richard Henderson  <rth@redhat.com>\n+\n+\tPR libgcc/48076\n+\t* emutls.c (__emutls_get_address): Avoid race condition between\n+\tobj->loc.offset read and emutls_key initialization.\n+\t\n 2012-11-22  Georg-Johann Lay  <avr@gjlay.de>\n \n \tAdjust decimal point of signed accum mode to GCC default."}, {"sha": "f1b653b7d542a29a970bb1b7409f8945288bdb1a", "filename": "libgcc/emutls.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f4919e4a824372c70af64a80e16db4de995bdc3c/libgcc%2Femutls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f4919e4a824372c70af64a80e16db4de995bdc3c/libgcc%2Femutls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Femutls.c?ref=f4919e4a824372c70af64a80e16db4de995bdc3c", "patch": "@@ -136,7 +136,7 @@ __emutls_get_address (struct __emutls_object *obj)\n #ifndef __GTHREADS\n   abort ();\n #else\n-  pointer offset = obj->loc.offset;\n+  pointer offset = __atomic_load_n (&obj->loc.offset, __ATOMIC_ACQUIRE);\n \n   if (__builtin_expect (offset == 0, 0))\n     {\n@@ -147,7 +147,7 @@ __emutls_get_address (struct __emutls_object *obj)\n       if (offset == 0)\n \t{\n \t  offset = ++emutls_size;\n-\t  obj->loc.offset = offset;\n+\t  __atomic_store_n (&obj->loc.offset, offset, __ATOMIC_RELEASE);\n \t}\n       __gthread_mutex_unlock (&emutls_mutex);\n     }"}]}