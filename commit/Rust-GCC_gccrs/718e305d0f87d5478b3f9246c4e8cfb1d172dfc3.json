{"sha": "718e305d0f87d5478b3f9246c4e8cfb1d172dfc3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzE4ZTMwNWQwZjg3ZDU0NzhiM2Y5MjQ2YzRlOGNmYjFkMTcyZGZjMw==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2013-03-03T17:21:07Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2013-03-03T17:21:07Z"}, "message": "symbol.c (gfc_undo_symbols): Move code...\n\nfortran/\n\t* symbol.c (gfc_undo_symbols): Move code...\n\t(restore_old_symbol): ... here as a new function.\n\nFrom-SVN: r196412", "tree": {"sha": "201285fb373f7d395c832998ebe9b214142841b5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/201285fb373f7d395c832998ebe9b214142841b5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3/comments", "author": null, "committer": null, "parents": [{"sha": "dd355a42fd3808c3b61f5f4b6b4834f42a37349a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd355a42fd3808c3b61f5f4b6b4834f42a37349a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd355a42fd3808c3b61f5f4b6b4834f42a37349a"}], "stats": {"total": 120, "additions": 67, "deletions": 53}, "files": [{"sha": "b3a995b3de2d035cecb8e1df31407f12baedc2b9", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=718e305d0f87d5478b3f9246c4e8cfb1d172dfc3", "patch": "@@ -1,7 +1,12 @@\n 2013-03-03  Mikael Morin  <mikael@gcc.gnu.org>\n \n-\t* Make-lang.in (F95_PARSER_OBJS): Add dependency to vec.h\n-\t* gfortran.h: Include vec.h\n+\t* symbol.c (gfc_undo_symbols): Move code...\n+\t(restore_old_symbol): ... here as a new function.\n+\n+2013-03-03  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\t* Make-lang.in (F95_PARSER_OBJS): Add dependency to vec.h.\n+\t* gfortran.h: Include vec.h.\n \t(gfc_undo_change_set): New struct.\n \t* symbol.c (tentative_tbp): Remove struct.\n \t(changed_syms, tentative_tbp_list): Remove variables."}, {"sha": "ce39b8cf4275c3d082d85a5a11864e4486ec23ad", "filename": "gcc/fortran/symbol.c", "status": "modified", "additions": 60, "deletions": 51, "changes": 111, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3/gcc%2Ffortran%2Fsymbol.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/718e305d0f87d5478b3f9246c4e8cfb1d172dfc3/gcc%2Ffortran%2Fsymbol.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsymbol.c?ref=718e305d0f87d5478b3f9246c4e8cfb1d172dfc3", "patch": "@@ -2879,14 +2879,72 @@ find_common_symtree (gfc_symtree *st, gfc_common_head *head)\n }\n \n \n+/* Restore previous state of symbol.  Just copy simple stuff.  */\n+  \n+static void\n+restore_old_symbol (gfc_symbol *p)\n+{\n+  gfc_symbol *old;\n+\n+  p->mark = 0;\n+  old = p->old_symbol;\n+\n+  p->ts.type = old->ts.type;\n+  p->ts.kind = old->ts.kind;\n+\n+  p->attr = old->attr;\n+\n+  if (p->value != old->value)\n+    {\n+      gfc_free_expr (old->value);\n+      p->value = NULL;\n+    }\n+\n+  if (p->as != old->as)\n+    {\n+      if (p->as)\n+\tgfc_free_array_spec (p->as);\n+      p->as = old->as;\n+    }\n+\n+  p->generic = old->generic;\n+  p->component_access = old->component_access;\n+\n+  if (p->namelist != NULL && old->namelist == NULL)\n+    {\n+      gfc_free_namelist (p->namelist);\n+      p->namelist = NULL;\n+    }\n+  else\n+    {\n+      if (p->namelist_tail != old->namelist_tail)\n+\t{\n+\t  gfc_free_namelist (old->namelist_tail->next);\n+\t  old->namelist_tail->next = NULL;\n+\t}\n+    }\n+\n+  p->namelist_tail = old->namelist_tail;\n+\n+  if (p->formal != old->formal)\n+    {\n+      gfc_free_formal_arglist (p->formal);\n+      p->formal = old->formal;\n+    }\n+\n+  free (p->old_symbol);\n+  p->old_symbol = NULL;\n+}\n+\n+\n /* Undoes all the changes made to symbols in the current statement.\n    This subroutine is made simpler due to the fact that attributes are\n    never removed once added.  */\n \n void\n gfc_undo_symbols (void)\n {\n-  gfc_symbol *p, *old;\n+  gfc_symbol *p;\n   unsigned i;\n \n   FOR_EACH_VEC_ELT (latest_undo_chgset->syms, i, p)\n@@ -2945,58 +3003,9 @@ gfc_undo_symbols (void)\n \t    gfc_delete_symtree (&p->ns->sym_root, p->name);\n \n \t  gfc_release_symbol (p);\n-\t  continue;\n-\t}\n-\n-      /* Restore previous state of symbol.  Just copy simple stuff.  */\n-      p->mark = 0;\n-      old = p->old_symbol;\n-\n-      p->ts.type = old->ts.type;\n-      p->ts.kind = old->ts.kind;\n-\n-      p->attr = old->attr;\n-\n-      if (p->value != old->value)\n-\t{\n-\t  gfc_free_expr (old->value);\n-\t  p->value = NULL;\n-\t}\n-\n-      if (p->as != old->as)\n-\t{\n-\t  if (p->as)\n-\t    gfc_free_array_spec (p->as);\n-\t  p->as = old->as;\n-\t}\n-\n-      p->generic = old->generic;\n-      p->component_access = old->component_access;\n-\n-      if (p->namelist != NULL && old->namelist == NULL)\n-\t{\n-\t  gfc_free_namelist (p->namelist);\n-\t  p->namelist = NULL;\n \t}\n       else\n-\t{\n-\t  if (p->namelist_tail != old->namelist_tail)\n-\t    {\n-\t      gfc_free_namelist (old->namelist_tail->next);\n-\t      old->namelist_tail->next = NULL;\n-\t    }\n-\t}\n-\n-      p->namelist_tail = old->namelist_tail;\n-\n-      if (p->formal != old->formal)\n-\t{\n-\t  gfc_free_formal_arglist (p->formal);\n-\t  p->formal = old->formal;\n-\t}\n-\n-      free (p->old_symbol);\n-      p->old_symbol = NULL;\n+\trestore_old_symbol (p);\n     }\n \n   latest_undo_chgset->syms.truncate (0);"}]}