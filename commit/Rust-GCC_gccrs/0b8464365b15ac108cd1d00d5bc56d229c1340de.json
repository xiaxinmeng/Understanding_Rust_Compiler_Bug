{"sha": "0b8464365b15ac108cd1d00d5bc56d229c1340de", "node_id": "C_kwDOANBUbNoAKDBiODQ2NDM2NWIxNWFjMTA4Y2QxZDAwZDViYzU2ZDIyOWMxMzQwZGU", "commit": {"author": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-01-12T20:24:49Z"}, "committer": {"name": "Harald Anlauf", "email": "anlauf@gmx.de", "date": "2022-01-13T18:24:13Z"}, "message": "Fortran: fix error recovery on bad structure constructor in DATA statement\n\ngcc/fortran/ChangeLog:\n\n\tPR fortran/67804\n\t* primary.c (gfc_match_structure_constructor): Recover from errors\n\tthat occurred while checking for a valid structure constructor in\n\ta DATA statement.\n\ngcc/testsuite/ChangeLog:\n\n\tPR fortran/67804\n\t* gfortran.dg/pr93604.f90: Adjust to changed diagnostics.\n\t* gfortran.dg/pr67804.f90: New test.", "tree": {"sha": "9d08a0f4cecaf2bfa7ac8906a8926162b652d6b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d08a0f4cecaf2bfa7ac8906a8926162b652d6b6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0b8464365b15ac108cd1d00d5bc56d229c1340de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b8464365b15ac108cd1d00d5bc56d229c1340de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b8464365b15ac108cd1d00d5bc56d229c1340de", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b8464365b15ac108cd1d00d5bc56d229c1340de/comments", "author": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "committer": {"login": "harald-anlauf", "id": 90786862, "node_id": "MDQ6VXNlcjkwNzg2ODYy", "avatar_url": "https://avatars.githubusercontent.com/u/90786862?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harald-anlauf", "html_url": "https://github.com/harald-anlauf", "followers_url": "https://api.github.com/users/harald-anlauf/followers", "following_url": "https://api.github.com/users/harald-anlauf/following{/other_user}", "gists_url": "https://api.github.com/users/harald-anlauf/gists{/gist_id}", "starred_url": "https://api.github.com/users/harald-anlauf/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harald-anlauf/subscriptions", "organizations_url": "https://api.github.com/users/harald-anlauf/orgs", "repos_url": "https://api.github.com/users/harald-anlauf/repos", "events_url": "https://api.github.com/users/harald-anlauf/events{/privacy}", "received_events_url": "https://api.github.com/users/harald-anlauf/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "386b15d6ef2db6bcca1369650f5456728e2d42f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/386b15d6ef2db6bcca1369650f5456728e2d42f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/386b15d6ef2db6bcca1369650f5456728e2d42f1"}], "stats": {"total": 42, "additions": 38, "deletions": 4}, "files": [{"sha": "3f01f67cd4966145fe17aaea75a4dc0d51fceded", "filename": "gcc/fortran/primary.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b8464365b15ac108cd1d00d5bc56d229c1340de/gcc%2Ffortran%2Fprimary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b8464365b15ac108cd1d00d5bc56d229c1340de/gcc%2Ffortran%2Fprimary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fprimary.c?ref=0b8464365b15ac108cd1d00d5bc56d229c1340de", "patch": "@@ -3364,6 +3364,7 @@ gfc_match_structure_constructor (gfc_symbol *sym, gfc_expr **result)\n   match m;\n   gfc_expr *e;\n   gfc_symtree *symtree;\n+  bool t = true;\n \n   gfc_get_ha_sym_tree (sym->name, &symtree);\n \n@@ -3394,10 +3395,18 @@ gfc_match_structure_constructor (gfc_symbol *sym, gfc_expr **result)\n      in the structure constructor must be a constant.  Try to reduce the\n      expression here.  */\n   if (gfc_in_match_data ())\n-    gfc_reduce_init_expr (e);\n+    t = gfc_reduce_init_expr (e);\n \n-  *result = e;\n-  return MATCH_YES;\n+  if (t)\n+    {\n+      *result = e;\n+      return MATCH_YES;\n+    }\n+  else\n+    {\n+      gfc_free_expr (e);\n+      return MATCH_ERROR;\n+    }\n }\n \n "}, {"sha": "e2009a5bfdbe344253c0ec51a2dedd5c915a3b05", "filename": "gcc/testsuite/gfortran.dg/pr67804.f90", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b8464365b15ac108cd1d00d5bc56d229c1340de/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr67804.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b8464365b15ac108cd1d00d5bc56d229c1340de/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr67804.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr67804.f90?ref=0b8464365b15ac108cd1d00d5bc56d229c1340de", "patch": "@@ -0,0 +1,25 @@\n+! { dg-do compile }\n+! PR fortran/67804 - ICE on bad type in structure constructor in DATA statement\n+! Contributed by G.Steinmetz\n+\n+program p\n+  type t\n+     character :: c\n+  end type\n+  type u\n+     character, pointer :: c\n+  end type\n+  type(t) :: x0, x1, x2, x3, x4, x5, x6, x7, x8, x9\n+  type(u) :: y6\n+  data x0 /t('a')/     ! OK\n+  data x1 /t(1)/       ! { dg-error \"Cannot convert\" }\n+  data x2 /t(1.)/      ! { dg-error \"Cannot convert\" }\n+  data x3 /t(1d1)/     ! { dg-error \"Cannot convert\" }\n+  data x4 /t((0.,1.))/ ! { dg-error \"Cannot convert\" }\n+  data x5 /t(.true.)/  ! { dg-error \"Cannot convert\" }\n+  data x6 /t(null())/  ! { dg-error \"neither a POINTER nor ALLOCATABLE\" }\n+  data x7 /t(['1'])/   ! { dg-error \"The rank of the element\" }\n+  data x8 /t([1])/     ! { dg-error \"Cannot convert\" }\n+  data x9 /t(z'0')/    ! { dg-error \"Cannot convert\" }\n+  data y6 /u(null())/  ! OK\n+end"}, {"sha": "4040155120c12587235b4e7a2430c2f804923abe", "filename": "gcc/testsuite/gfortran.dg/pr93604.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b8464365b15ac108cd1d00d5bc56d229c1340de/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr93604.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b8464365b15ac108cd1d00d5bc56d229c1340de/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr93604.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr93604.f90?ref=0b8464365b15ac108cd1d00d5bc56d229c1340de", "patch": "@@ -5,6 +5,6 @@ program p\n       integer :: a\n    end type\n    type(t) :: x\n-   data x /t(z'1')/ ! { dg-error \"cannot appear in a structure constructor\" }\n+   data x /t(z'1')/ ! { dg-error \"BOZ\" }\n end\n "}]}