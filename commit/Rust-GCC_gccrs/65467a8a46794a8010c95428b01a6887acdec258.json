{"sha": "65467a8a46794a8010c95428b01a6887acdec258", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjU0NjdhOGE0Njc5NGE4MDEwYzk1NDI4YjAxYTY4ODdhY2RlYzI1OA==", "commit": {"author": {"name": "Pascal Obry", "email": "obry@adacore.com", "date": "2015-05-22T10:40:07Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2015-05-22T10:40:07Z"}, "message": "makeutl.ads (In_Place_Option): New constant.\n\n2015-05-22  Pascal Obry  <obry@adacore.com>\n\n\t* makeutl.ads (In_Place_Option): New constant.\n\t* prj.ads (Obj_Root_Dir): New variable (absolute path to relocate\n\tobjects).\n\t(Root_Src_Tree): New variable (absolute path of root source tree).\n\t* prj-conf.adb (Do_Autoconf): Take into account the object root\n\tdirectory (if defined) to generate configuration project.\n\t* prj-nmsc.adb (Get_Directories): Handle case where Obj_Root_Dir\n\tis defined.\n\t(Locate_Directory): Likewise.\n\nFrom-SVN: r223543", "tree": {"sha": "7723c3cdcc5c84f545478d1c05eaca7a219bd5ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7723c3cdcc5c84f545478d1c05eaca7a219bd5ee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65467a8a46794a8010c95428b01a6887acdec258", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65467a8a46794a8010c95428b01a6887acdec258", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65467a8a46794a8010c95428b01a6887acdec258", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65467a8a46794a8010c95428b01a6887acdec258/comments", "author": {"login": "TurboGit", "id": 467069, "node_id": "MDQ6VXNlcjQ2NzA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/467069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TurboGit", "html_url": "https://github.com/TurboGit", "followers_url": "https://api.github.com/users/TurboGit/followers", "following_url": "https://api.github.com/users/TurboGit/following{/other_user}", "gists_url": "https://api.github.com/users/TurboGit/gists{/gist_id}", "starred_url": "https://api.github.com/users/TurboGit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TurboGit/subscriptions", "organizations_url": "https://api.github.com/users/TurboGit/orgs", "repos_url": "https://api.github.com/users/TurboGit/repos", "events_url": "https://api.github.com/users/TurboGit/events{/privacy}", "received_events_url": "https://api.github.com/users/TurboGit/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "01099e0465b7851cc5096c58f7b7155937d44960", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01099e0465b7851cc5096c58f7b7155937d44960", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01099e0465b7851cc5096c58f7b7155937d44960"}], "stats": {"total": 97, "additions": 88, "deletions": 9}, "files": [{"sha": "314aeffd262da92ac8034454639c9434c5f5c3fa", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=65467a8a46794a8010c95428b01a6887acdec258", "patch": "@@ -1,3 +1,15 @@\n+2015-05-22  Pascal Obry  <obry@adacore.com>\n+\n+\t* makeutl.ads (In_Place_Option): New constant.\n+\t* prj.ads (Obj_Root_Dir): New variable (absolute path to relocate\n+\tobjects).\n+\t(Root_Src_Tree): New variable (absolute path of root source tree).\n+\t* prj-conf.adb (Do_Autoconf): Take into account the object root\n+\tdirectory (if defined) to generate configuration project.\n+\t* prj-nmsc.adb (Get_Directories): Handle case where Obj_Root_Dir\n+\tis defined.\n+\t(Locate_Directory): Likewise.\n+\n 2015-05-22  Pascal Obry  <obry@adacore.com>\n \n \t* prj-util.ads, prj-util.adb (Relative_Path): New routine."}, {"sha": "5a318aacf17284121ef10b2ade9b9270af327309", "filename": "gcc/ada/makeutl.ads", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fmakeutl.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fmakeutl.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeutl.ads?ref=65467a8a46794a8010c95428b01a6887acdec258", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2004-2014, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2004-2015, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -66,6 +66,10 @@ package Makeutl is\n    --  Switch used to indicate that the real directories (object, exec,\n    --  library, ...) are subdirectories of those in the project file.\n \n+   In_Place_Option : constant String := \"--in-place\";\n+   --  Switch to build out-of-tree. In this context the object, exec and\n+   --  library directories are relocated to the current working directory.\n+\n    Unchecked_Shared_Lib_Imports : constant String :=\n                                     \"--unchecked-shared-lib-imports\";\n    --  Command line switch to allow shared library projects to import projects"}, {"sha": "29217a7ef4e03c85a6061f9eb79ab21b9ea30bca", "filename": "gcc/ada/prj-conf.adb", "status": "modified", "additions": 27, "deletions": 5, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fprj-conf.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fprj-conf.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-conf.adb?ref=65467a8a46794a8010c95428b01a6887acdec258", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---            Copyright (C) 2006-2014, Free Software Foundation, Inc.       --\n+--            Copyright (C) 2006-2015, Free Software Foundation, Inc.       --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -962,17 +962,39 @@ package body Prj.Conf is\n \n          --  First, find the object directory of the Conf_Project\n \n+         --  If the object directory is a relative one and Obj_Root_Dir is set,\n+         --  first add it.\n+\n+         Name_Len := 0;\n+\n          if Obj_Dir = Nil_Variable_Value or else Obj_Dir.Default then\n-            Get_Name_String (Conf_Project.Directory.Display_Name);\n+\n+            if Obj_Root_Dir /= null then\n+               Add_Str_To_Name_Buffer (Obj_Root_Dir.all);\n+               Add_Str_To_Name_Buffer\n+                 (Relative_Path\n+                    (Get_Name_String (Conf_Project.Directory.Display_Name),\n+                     Root_Src_Tree.all));\n+            else\n+               Get_Name_String (Conf_Project.Directory.Display_Name);\n+            end if;\n \n          else\n             if Is_Absolute_Path (Get_Name_String (Obj_Dir.Value)) then\n                Get_Name_String (Obj_Dir.Value);\n \n             else\n-               Name_Len := 0;\n-               Add_Str_To_Name_Buffer\n-                 (Get_Name_String (Conf_Project.Directory.Display_Name));\n+               if Obj_Root_Dir /= null then\n+                  Add_Str_To_Name_Buffer (Obj_Root_Dir.all);\n+                  Add_Str_To_Name_Buffer\n+                    (Relative_Path\n+                       (Get_Name_String (Conf_Project.Directory.Display_Name),\n+                        Root_Src_Tree.all));\n+               else\n+                  Add_Str_To_Name_Buffer\n+                    (Get_Name_String (Conf_Project.Directory.Display_Name));\n+               end if;\n+\n                Add_Str_To_Name_Buffer (Get_Name_String (Obj_Dir.Value));\n             end if;\n          end if;"}, {"sha": "5d209ec71d8b08226db76b8c21fd61ba0208b936", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 32, "deletions": 2, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=65467a8a46794a8010c95428b01a6887acdec258", "patch": "@@ -5589,7 +5589,9 @@ package body Prj.Nmsc is\n             end if;\n          end if;\n \n-      elsif not No_Sources and then Subdirs /= null then\n+      elsif not No_Sources\n+        and then (Subdirs /= null or else Obj_Root_Dir /= null)\n+      then\n          Name_Len := 1;\n          Name_Buffer (1) := '.';\n          Locate_Directory\n@@ -6204,7 +6206,35 @@ package body Prj.Nmsc is\n       The_Name        : File_Name_Type;\n \n    begin\n-      Get_Name_String (Name);\n+      --  Check if we have a root-object dir specified, if so relocate all\n+      --  artefact directories to it.\n+\n+      if Obj_Root_Dir /= null\n+        and then Create /= \"\"\n+        and then not Is_Absolute_Path (Get_Name_String (Name))\n+      then\n+         Name_Len := 0;\n+         Add_Str_To_Name_Buffer (Obj_Root_Dir.all);\n+         Add_Str_To_Name_Buffer\n+           (Relative_Path\n+              (The_Parent (The_Parent'First .. The_Parent_Last),\n+               Root_Src_Tree.all));\n+         Add_Str_To_Name_Buffer (Get_Name_String (Name));\n+\n+      else\n+         if Obj_Root_Dir /= null and then Create /= \"\" then\n+\n+            --  Issue a warning that we cannot relocate absolute obj dir\n+\n+            Err_Vars.Error_Msg_File_1 := Name;\n+            Error_Or_Warning\n+              (Data.Flags, Warning,\n+               \"{ cannot relocate absolute object directory\",\n+               No_Location, Project);\n+         end if;\n+\n+         Get_Name_String (Name);\n+      end if;\n \n       --  Add Subdirs.all if it is a directory that may be created and\n       --  Subdirs is not null;"}, {"sha": "4910331c4849f9de322218d4ff032223ccc7660d", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65467a8a46794a8010c95428b01a6887acdec258/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=65467a8a46794a8010c95428b01a6887acdec258", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2001-2014, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2015, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -61,6 +61,17 @@ package Prj is\n    --  The value after the equal sign in switch --subdirs=...\n    --  Contains the relative subdirectory.\n \n+   Obj_Root_Dir : String_Ptr := null;\n+   --  A root directory for building out-of-tree projects. All relative object\n+   --  directories will be rooted at this location. If Subdirs is also set it\n+   --  will be added at the end too.\n+\n+   Root_Src_Tree : String_Ptr := null;\n+   --  When using out-of-tree build we need to keep information about the root\n+   --  directory source tree to properly relocate all projects to this root\n+   --  directory. Note that the root source directory is not necessary the\n+   --  directory of the main project.\n+\n    type Library_Support is (None, Static_Only, Full);\n    --  Support for Library Project File.\n    --  - None: Library Project Files are not supported at all"}]}