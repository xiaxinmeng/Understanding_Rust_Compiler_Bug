{"sha": "d868231706cf9a43ce1d6b474e8c1aa1535c4736", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg2ODIzMTcwNmNmOWE0M2NlMWQ2YjQ3NGU4YzFhYTE1MzVjNDczNg==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2020-05-10T00:23:58Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-07-06T11:35:32Z"}, "message": "[Ada] Time_IO.Value: Allow subseconds and time zones together\n\ngcc/ada/\n\n\t* libgnat/g-catiio.ads: Change the regular expression that\n\tdocuments the allowed format to match what ISO-8601 allows.\n\t* libgnat/g-catiio.adb (Scan_Subsecond): Rewrite so it doesn't\n\tassume the subsecond comes last.\n\t(Parse_ISO_8601): Parse an optional subsecond, followed by an\n\toptional time zone, rather than making these alternatives to\n\teach other.", "tree": {"sha": "3da16dd0f2f206e14e7e7ec3be8b2f94883304a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3da16dd0f2f206e14e7e7ec3be8b2f94883304a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d868231706cf9a43ce1d6b474e8c1aa1535c4736", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d868231706cf9a43ce1d6b474e8c1aa1535c4736", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d868231706cf9a43ce1d6b474e8c1aa1535c4736", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d868231706cf9a43ce1d6b474e8c1aa1535c4736/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bf8467d8069a4cd91a1071431200926186235f1c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bf8467d8069a4cd91a1071431200926186235f1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bf8467d8069a4cd91a1071431200926186235f1c"}], "stats": {"total": 50, "additions": 25, "deletions": 25}, "files": [{"sha": "f7bffe4e4718c09d167ffb54c0e75cb2a3301a4a", "filename": "gcc/ada/libgnat/g-catiio.adb", "status": "modified", "additions": 23, "deletions": 24, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d868231706cf9a43ce1d6b474e8c1aa1535c4736/gcc%2Fada%2Flibgnat%2Fg-catiio.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d868231706cf9a43ce1d6b474e8c1aa1535c4736/gcc%2Fada%2Flibgnat%2Fg-catiio.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fg-catiio.adb?ref=d868231706cf9a43ce1d6b474e8c1aa1535c4736", "patch": "@@ -778,17 +778,10 @@ package body GNAT.Calendar.Time_IO is\n       begin\n          Advance_Digits (Num_Digits => 1);\n \n-         while Symbol in '0' .. '9'\n-           and then Index < Date'Length\n-         loop\n+         while Index <= Date'Length and then Symbol in '0' .. '9' loop\n             Advance;\n          end loop;\n \n-         if Symbol not in '0' .. '9' then\n-            raise Wrong_Syntax;\n-         end if;\n-\n-         Advance;\n          return Second_Duration'Value (\"0.\" & Date (From .. Index - 1));\n       end Scan_Subsecond;\n \n@@ -845,6 +838,8 @@ package body GNAT.Calendar.Time_IO is\n \n       subtype Sign_Type is Character with Predicate => Sign_Type in '+' | '-';\n \n+   --  Start of processing for Parse_ISO_8601\n+\n    begin\n       --  Parse date\n \n@@ -869,26 +864,31 @@ package body GNAT.Calendar.Time_IO is\n \n          Second := Scan_Second;\n \n-         --  [('Z' | ('.' | ',') s{s} | ('+'|'-')hh:mm)]\n+         --  [ ('.' | ',') s{s} ]\n \n          if Index <= Date'Last then\n-\n-            --  Suffix 'Z' signifies that this is UTC time (time zone 0)\n-\n-            if Symbol = 'Z' then\n-               Time_Zone_Seen := True;\n-               Time_Zone_Offset := 0;\n-               Advance;\n-\n             --  A decimal fraction shall have at least one digit, and has as\n             --  many digits as supported by the underlying implementation.\n             --  The valid decimal separators are those specified in ISO 31-0,\n             --  i.e. the comma [,] or full stop [.]. Of these, the comma is\n             --  the preferred separator of ISO-8601.\n \n-            elsif Symbol = ',' or else Symbol = '.' then\n+            if Symbol = ',' or else Symbol = '.' then\n                Advance; --  past decimal separator\n                Subsec := Scan_Subsecond;\n+            end if;\n+         end if;\n+\n+         --  [ ('Z' | ('+'|'-')hh':'mm) ]\n+\n+         if Index <= Date'Last then\n+            Time_Zone_Seen := Symbol in 'Z' | Sign_Type;\n+\n+            --  Suffix 'Z' signifies that this is UTC time (time zone 0)\n+\n+            if Symbol = 'Z' then\n+               Time_Zone_Offset := 0;\n+               Advance;\n \n             --  Difference between local time and UTC: It shall be expressed\n             --  as positive (i.e. with the leading plus sign [+]) if the local\n@@ -900,12 +900,10 @@ package body GNAT.Calendar.Time_IO is\n \n             elsif Symbol in Sign_Type then\n                declare\n-                  Time_Zone_Sign : constant Sign_Type := Symbol;\n-\n+                  Time_Zone_Sign   : constant Sign_Type := Symbol;\n                   Time_Zone_Hour   : Hour_Number;\n                   Time_Zone_Minute : Minute_Number;\n                begin\n-                  Time_Zone_Seen := True;\n                   Advance;\n                   Time_Zone_Hour := Scan_Hour;\n \n@@ -923,9 +921,10 @@ package body GNAT.Calendar.Time_IO is\n                   Time_Zone_Offset :=\n                     Time_Offset (Time_Zone_Hour * 60 + Time_Zone_Minute);\n \n-                  if Time_Zone_Sign = '-' then\n-                     Time_Zone_Offset := -Time_Zone_Offset;\n-                  end if;\n+                  case Time_Zone_Sign is\n+                     when '+' => null;\n+                     when '-' => Time_Zone_Offset := -Time_Zone_Offset;\n+                  end case;\n                end;\n             else\n                raise Wrong_Syntax;"}, {"sha": "982b80d13c37b555959510f1b8db59e2197e0093", "filename": "gcc/ada/libgnat/g-catiio.ads", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d868231706cf9a43ce1d6b474e8c1aa1535c4736/gcc%2Fada%2Flibgnat%2Fg-catiio.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d868231706cf9a43ce1d6b474e8c1aa1535c4736/gcc%2Fada%2Flibgnat%2Fg-catiio.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fg-catiio.ads?ref=d868231706cf9a43ce1d6b474e8c1aa1535c4736", "patch": "@@ -154,7 +154,8 @@ package GNAT.Calendar.Time_IO is\n    --  supported:\n    --\n    --    (yyyymmdd | yyyy'-'mm'-'dd)'T'(hhmmss | hh':'mm':'ss)\n-   --      [ ('Z' | ('.' | ',') s{s} | ('+'|'-')hh':'mm) ]\n+   --      [ ('.' | ',') s{s} ]\n+   --      [ ('Z' | ('+'|'-')hh':'mm) ]\n    --  Trailing characters (including spaces) are not allowed.\n    --  In the ISO case, the current time zone is not used; the time zone\n    --  is as specified in the string, defaulting to UTC."}]}