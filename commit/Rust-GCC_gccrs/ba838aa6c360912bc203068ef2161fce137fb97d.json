{"sha": "ba838aa6c360912bc203068ef2161fce137fb97d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmE4MzhhYTZjMzYwOTEyYmMyMDMwNjhlZjIxNjFmY2UxMzdmYjk3ZA==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2019-04-14T09:24:26Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2019-04-14T09:24:26Z"}, "message": "Work around Solaris ld bug linking __tls_get_addr on 64-bit x86\n\n\t* m4/druntime/os.m4 (DRUNTIME_OS_LINK_SPEC): New macro.\n\t* configure.ac: Call it.\n\t* configure: Regenerate.\n\t* Makefile.in, libdruntime/Makefile.in, src/Makefile.in,\n\ttestsuite/Makefile.in: Regenerate.\n\t* src/libgphobos.spec.in (*link): Append OS_LINK_SPEC.\n\nFrom-SVN: r270346", "tree": {"sha": "8be2bdd527ac314700e88c5032ff77a139b23c3d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8be2bdd527ac314700e88c5032ff77a139b23c3d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba838aa6c360912bc203068ef2161fce137fb97d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba838aa6c360912bc203068ef2161fce137fb97d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba838aa6c360912bc203068ef2161fce137fb97d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba838aa6c360912bc203068ef2161fce137fb97d/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4d51312053fc8d12ddcdad6c2cf07d9437ac5e60", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d51312053fc8d12ddcdad6c2cf07d9437ac5e60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d51312053fc8d12ddcdad6c2cf07d9437ac5e60"}], "stats": {"total": 59, "additions": 57, "deletions": 2}, "files": [{"sha": "9c418dc8b7d38a63dcca97ef6c166b28c7e0decc", "filename": "libphobos/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2FChangeLog?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -1,5 +1,12 @@\n 2019-04-14  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n+\t* m4/druntime/os.m4 (DRUNTIME_OS_LINK_SPEC): New macro.\n+\t* configure.ac: Call it.\n+\t* configure: Regenerate.\n+\t* Makefile.in, libdruntime/Makefile.in, src/Makefile.in,\n+\ttestsuite/Makefile.in: Regenerate.\n+\t* src/libgphobos.spec.in (*link): Append OS_LINK_SPEC.\n+\n \tPR d/88150\n \t* libdruntime/gcc/sections/elf_shared.d [Solaris] (SharedELF): Set\n \tto true."}, {"sha": "127a62628cee5e8fdcb74adaf1391ea178b46a86", "filename": "libphobos/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2FMakefile.in?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -252,6 +252,7 @@ NM = @NM@\n NMEDIT = @NMEDIT@\n OBJDUMP = @OBJDUMP@\n OBJEXT = @OBJEXT@\n+OS_LINK_SPEC = @OS_LINK_SPEC@\n OTOOL = @OTOOL@\n OTOOL64 = @OTOOL64@\n PACKAGE = @PACKAGE@"}, {"sha": "4ebad782abf02a621f482463f1b16ce0da087327", "filename": "libphobos/configure", "status": "modified", "additions": 20, "deletions": 2, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fconfigure?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -650,6 +650,7 @@ DCFG_HAVE_LIBATOMIC\n DCFG_HAVE_64BIT_ATOMICS\n DCFG_HAVE_ATOMIC_BUILTINS\n DCFG_HAVE_QSORT_R\n+OS_LINK_SPEC\n DRUNTIME_OS_MINFO_BRACKETING_FALSE\n DRUNTIME_OS_MINFO_BRACKETING_TRUE\n DCFG_MINFO_BRACKETING\n@@ -11495,7 +11496,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11498 \"configure\"\n+#line 11499 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11601,7 +11602,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11604 \"configure\"\n+#line 11605 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -14118,6 +14119,23 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n \n \n \n+  case $target in\n+    i?86-*-solaris2.* | x86_64-*-solaris2.*)\n+      # 64-bit Solaris/x86 ld breaks calls to __tls_get_addr with non-TLS\n+      # relocs.  Work around by disabling TLS transitions.  Not necessary\n+      # on 32-bit x86, but cannot be distinguished reliably in specs.\n+      druntime_ld_prog=`$CC -print-prog-name=ld`\n+      if test -n \"$druntime_ld_prog\" \\\n+         && $druntime_ld_prog -v 2>&1 | grep GNU > /dev/null 2>&1; then\n+        :\n+      else\n+        OS_LINK_SPEC='-z relax=transtls'\n+      fi\n+      ;;\n+  esac\n+\n+\n+\n   ac_ext=c\n ac_cpp='$CPP $CPPFLAGS'\n ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'"}, {"sha": "8905252b021039be486e91110e6cb2f84b972e47", "filename": "libphobos/configure.ac", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fconfigure.ac?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -125,6 +125,7 @@ DRUNTIME_OS_SOURCES\n DRUNTIME_OS_THREAD_MODEL\n DRUNTIME_OS_ARM_EABI_UNWINDER\n DRUNTIME_OS_MINFO_BRACKETING\n+DRUNTIME_OS_LINK_SPEC\n DRUNTIME_LIBRARIES_CLIB\n \n WITH_LOCAL_DRUNTIME(["}, {"sha": "0994fcd813299ce0aa18ccf51e51b1dc0a9f2750", "filename": "libphobos/libdruntime/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Flibdruntime%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Flibdruntime%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Flibdruntime%2FMakefile.in?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -566,6 +566,7 @@ NM = @NM@\n NMEDIT = @NMEDIT@\n OBJDUMP = @OBJDUMP@\n OBJEXT = @OBJEXT@\n+OS_LINK_SPEC = @OS_LINK_SPEC@\n OTOOL = @OTOOL@\n OTOOL64 = @OTOOL64@\n PACKAGE = @PACKAGE@"}, {"sha": "295926c43d308e45979dfe85b61ecc4800d8b4c8", "filename": "libphobos/m4/druntime/os.m4", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fm4%2Fdruntime%2Fos.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fm4%2Fdruntime%2Fos.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fm4%2Fdruntime%2Fos.m4?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -183,3 +183,25 @@ AC_DEFUN([DRUNTIME_OS_MINFO_BRACKETING],\n   AM_CONDITIONAL([DRUNTIME_OS_MINFO_BRACKETING], [test \"$DCFG_MINFO_BRACKETING\" = \"true\"])\n   AC_LANG_POP([C])\n ])\n+\n+# DRUNTIME_OS_LINK_SPEC\n+# ---------------------\n+# Add target-specific link options to link_spec.\n+AC_DEFUN([DRUNTIME_OS_LINK_SPEC],\n+[\n+  case $target in\n+    i?86-*-solaris2.* | x86_64-*-solaris2.*)\n+      # 64-bit Solaris/x86 ld breaks calls to __tls_get_addr with non-TLS\n+      # relocs.  Work around by disabling TLS transitions.  Not necessary\n+      # on 32-bit x86, but cannot be distinguished reliably in specs.\n+      druntime_ld_prog=`$CC -print-prog-name=ld`\n+      if test -n \"$druntime_ld_prog\" \\\n+         && $druntime_ld_prog -v 2>&1 | grep GNU > /dev/null 2>&1; then\n+        :\n+      else\n+        OS_LINK_SPEC='-z relax=transtls'\n+      fi\n+      ;;\n+  esac\n+  AC_SUBST(OS_LINK_SPEC)\n+])"}, {"sha": "8fd6e5d384498c3b4a33d7e2df09a641483e8edf", "filename": "libphobos/src/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fsrc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fsrc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fsrc%2FMakefile.in?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -323,6 +323,7 @@ NM = @NM@\n NMEDIT = @NMEDIT@\n OBJDUMP = @OBJDUMP@\n OBJEXT = @OBJEXT@\n+OS_LINK_SPEC = @OS_LINK_SPEC@\n OTOOL = @OTOOL@\n OTOOL64 = @OTOOL64@\n PACKAGE = @PACKAGE@"}, {"sha": "97a9ceaf48c854a9053d90b8070244e2c9beb556", "filename": "libphobos/src/libgphobos.spec.in", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fsrc%2Flibgphobos.spec.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Fsrc%2Flibgphobos.spec.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Fsrc%2Flibgphobos.spec.in?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -6,5 +6,8 @@\n \n @DRTSTUFF_SPEC@\n \n+%rename link linkorig_gdc_renamed\n+*link: %(linkorig_gdc_renamed) @OS_LINK_SPEC@\n+\n %rename lib liborig_gdc_renamed\n *lib: %{debuglib|defaultlib|nophoboslib: ; :@SPEC_PHOBOS_DEPS@} %(liborig_gdc_renamed)"}, {"sha": "cacc03138f3a31b6fd87f0e62dd7e4ae8cd2dbf2", "filename": "libphobos/testsuite/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba838aa6c360912bc203068ef2161fce137fb97d/libphobos%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libphobos%2Ftestsuite%2FMakefile.in?ref=ba838aa6c360912bc203068ef2161fce137fb97d", "patch": "@@ -196,6 +196,7 @@ NM = @NM@\n NMEDIT = @NMEDIT@\n OBJDUMP = @OBJDUMP@\n OBJEXT = @OBJEXT@\n+OS_LINK_SPEC = @OS_LINK_SPEC@\n OTOOL = @OTOOL@\n OTOOL64 = @OTOOL64@\n PACKAGE = @PACKAGE@"}]}