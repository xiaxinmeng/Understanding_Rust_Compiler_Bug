{"sha": "7be0232c686a75f98b2ca3c27f7de3139b8999c6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2JlMDIzMmM2ODZhNzVmOThiMmNhM2MyN2Y3ZGUzMTM5Yjg5OTljNg==", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-08-12T10:54:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-08-12T10:54:28Z"}, "message": "Merge #625\n\n625:  Change name resolver's iterate_* functions to allow early exit r=philberty a=dkm\n\nThe callback now returns a bool for continuing the iteration (true) or stopping\r\nit (false).\r\nFixed the scanning for unused names without changing its behavior (always doing\r\nfull iteration).\n\nCo-authored-by: Marc Poulhi\u00e8s <dkm@kataplop.net>", "tree": {"sha": "decb6e01d0db2bb940bfc11fcf61e6de0fdf5eb8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/decb6e01d0db2bb940bfc11fcf61e6de0fdf5eb8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7be0232c686a75f98b2ca3c27f7de3139b8999c6", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhFP3kCRBK7hj4Ov3rIwAA3rUIAF4LhVBtfr5J2rNdR8HH6u8B\nfG0abRXeueEReP3EsXSfktCJps1CbGlFEWA5I0JCyfm2ERxj/mZveVHeGTi0w+M0\nzwHcWbN1Y59iC0Q1eXVrkQ5cgXTFrg/q28MDWAqYtYEpq/nUsV7mVBOSGENaGskL\njDzcuDaRZkELsdAqXU1yRdkWidS9JJUoHZdba/eL/vgawIbQVgENNn1JZON7U2n6\nVI2fc1EbkG4OkhxMRaNoLtEc7fyL/hN2uRyyBXTWvIU4VMSr7y5sEWqH0jQSiccg\nQc/NWUkQknF4aHJ88utYLl+CPmCnbKpMamRPKkYNAnZTEHfKrCoe/iQBkPoL3m0=\n=0tY4\n-----END PGP SIGNATURE-----\n", "payload": "tree decb6e01d0db2bb940bfc11fcf61e6de0fdf5eb8\nparent a0ba86c3bef853ff8a0c282c10c3e0cb1811a507\nparent da72de4d8929608b064b486312ca8dd80cce47a4\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1628765668 +0000\ncommitter GitHub <noreply@github.com> 1628765668 +0000\n\nMerge #625\n\n625:  Change name resolver's iterate_* functions to allow early exit r=philberty a=dkm\n\nThe callback now returns a bool for continuing the iteration (true) or stopping\r\nit (false).\r\nFixed the scanning for unused names without changing its behavior (always doing\r\nfull iteration).\n\nCo-authored-by: Marc Poulhi\u00e8s <dkm@kataplop.net>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7be0232c686a75f98b2ca3c27f7de3139b8999c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7be0232c686a75f98b2ca3c27f7de3139b8999c6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7be0232c686a75f98b2ca3c27f7de3139b8999c6/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a0ba86c3bef853ff8a0c282c10c3e0cb1811a507", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0ba86c3bef853ff8a0c282c10c3e0cb1811a507", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0ba86c3bef853ff8a0c282c10c3e0cb1811a507"}, {"sha": "da72de4d8929608b064b486312ca8dd80cce47a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da72de4d8929608b064b486312ca8dd80cce47a4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da72de4d8929608b064b486312ca8dd80cce47a4"}], "stats": {"total": 24, "additions": 14, "deletions": 10}, "files": [{"sha": "b8b50a0c07a92a3e4b7671fd08e6e6674d9f1535", "filename": "gcc/rust/resolve/rust-ast-resolve-unused.h", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7be0232c686a75f98b2ca3c27f7de3139b8999c6/gcc%2Frust%2Fresolve%2Frust-ast-resolve-unused.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7be0232c686a75f98b2ca3c27f7de3139b8999c6/gcc%2Frust%2Fresolve%2Frust-ast-resolve-unused.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fresolve%2Frust-ast-resolve-unused.h?ref=7be0232c686a75f98b2ca3c27f7de3139b8999c6", "patch": "@@ -27,7 +27,7 @@ namespace Resolver {\n class ScanUnused\n {\n public:\n-  static void ScanRib (Rib *r)\n+  static bool ScanRib (Rib *r)\n   {\n     r->iterate_decls ([&] (NodeId decl_node_id, Location locus) -> bool {\n       CanonicalPath ident = CanonicalPath::create_empty ();\n@@ -43,14 +43,15 @@ class ScanUnused\n \t}\n       return true;\n     });\n+    return true;\n   }\n \n   static void Scan ()\n   {\n     auto resolver = Resolver::get ();\n-    resolver->iterate_name_ribs ([&] (Rib *r) -> void { ScanRib (r); });\n-    resolver->iterate_type_ribs ([&] (Rib *r) -> void { ScanRib (r); });\n-    resolver->iterate_label_ribs ([&] (Rib *r) -> void { ScanRib (r); });\n+    resolver->iterate_name_ribs ([&] (Rib *r) -> bool { return ScanRib (r); });\n+    resolver->iterate_type_ribs ([&] (Rib *r) -> bool { return ScanRib (r); });\n+    resolver->iterate_label_ribs ([&] (Rib *r) -> bool { return ScanRib (r); });\n   }\n };\n "}, {"sha": "6fac3d3cd016ce646bcc385d88a0fb8b0bd0613d", "filename": "gcc/rust/resolve/rust-name-resolver.h", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7be0232c686a75f98b2ca3c27f7de3139b8999c6/gcc%2Frust%2Fresolve%2Frust-name-resolver.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7be0232c686a75f98b2ca3c27f7de3139b8999c6/gcc%2Frust%2Fresolve%2Frust-name-resolver.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fresolve%2Frust-name-resolver.h?ref=7be0232c686a75f98b2ca3c27f7de3139b8999c6", "patch": "@@ -335,27 +335,30 @@ class Resolver\n     return it->second.size ();\n   }\n \n-  void iterate_name_ribs (std::function<void (Rib *)> cb)\n+  void iterate_name_ribs (std::function<bool (Rib *)> cb)\n   {\n     for (auto it = name_ribs.begin (); it != name_ribs.end (); it++)\n-      cb (it->second);\n+      if (!cb (it->second))\n+\tbreak;\n   }\n \n-  void iterate_type_ribs (std::function<void (Rib *)> cb)\n+  void iterate_type_ribs (std::function<bool (Rib *)> cb)\n   {\n     for (auto it = type_ribs.begin (); it != type_ribs.end (); it++)\n       {\n \tif (it->first == global_type_node_id)\n \t  continue;\n \n-\tcb (it->second);\n+\tif (!cb (it->second))\n+\t  break;\n       }\n   }\n \n-  void iterate_label_ribs (std::function<void (Rib *)> cb)\n+  void iterate_label_ribs (std::function<bool (Rib *)> cb)\n   {\n     for (auto it = label_ribs.begin (); it != label_ribs.end (); it++)\n-      cb (it->second);\n+      if (!cb (it->second))\n+\tbreak;\n   }\n \n private:"}]}