{"sha": "8c56bb830708cab8909c6911124af2565ad1acc6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGM1NmJiODMwNzA4Y2FiODkwOWM2OTExMTI0YWYyNTY1YWQxYWNjNg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-06-24T05:35:16Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-06-24T05:35:16Z"}, "message": "c-gimplify.c (gimplify_decl_stmt): Push gimplify_one_sizepos inside non-constant size check.\n\n\t* c-gimplify.c (gimplify_decl_stmt): Push gimplify_one_sizepos inside\n\tnon-constant size check.  Gimplify the type too.  Tidy building\n\tBUILT_IN_STACK_ALLOC call\n\nFrom-SVN: r83582", "tree": {"sha": "50d2015aa08fd0447f47471177e699b5db3fab80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/50d2015aa08fd0447f47471177e699b5db3fab80"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c56bb830708cab8909c6911124af2565ad1acc6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c56bb830708cab8909c6911124af2565ad1acc6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c56bb830708cab8909c6911124af2565ad1acc6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c56bb830708cab8909c6911124af2565ad1acc6/comments", "author": null, "committer": null, "parents": [{"sha": "d522060b39e1627ebc07734d756b27637c957c53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d522060b39e1627ebc07734d756b27637c957c53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d522060b39e1627ebc07734d756b27637c957c53"}], "stats": {"total": 30, "additions": 18, "deletions": 12}, "files": [{"sha": "bd1c4a369f9c4e4ef033d9222f1d921bfa8c299d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c56bb830708cab8909c6911124af2565ad1acc6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c56bb830708cab8909c6911124af2565ad1acc6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8c56bb830708cab8909c6911124af2565ad1acc6", "patch": "@@ -1,3 +1,9 @@\n+2004-06-23  Richard Henderson  <rth@redhat.com>\n+\n+\t* c-gimplify.c (gimplify_decl_stmt): Push gimplify_one_sizepos inside\n+\tnon-constant size check.  Gimplify the type too.  Tidy building\n+\tBUILT_IN_STACK_ALLOC call\n+\n 2004-06-23  Roger Sayle  <roger@eyesopen.com>\n \n \t* c-common.c (expand_unordered_cmp): Delete."}, {"sha": "44af046d1eea2037691ea61b440c7e1bd20e3eb0", "filename": "gcc/c-gimplify.c", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c56bb830708cab8909c6911124af2565ad1acc6/gcc%2Fc-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c56bb830708cab8909c6911124af2565ad1acc6/gcc%2Fc-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-gimplify.c?ref=8c56bb830708cab8909c6911124af2565ad1acc6", "patch": "@@ -488,25 +488,25 @@ gimplify_decl_stmt (tree *stmt_p)\n     {\n       tree init = DECL_INITIAL (decl);\n \n-      gimplify_one_sizepos (&DECL_SIZE (decl), stmt_p);\n-      gimplify_one_sizepos (&DECL_SIZE_UNIT (decl), stmt_p);\n-\n       if (!TREE_CONSTANT (DECL_SIZE (decl)))\n \t{\n \t  /* This is a variable-sized decl.  Simplify its size and mark it\n \t     for deferred expansion.  Note that mudflap depends on the format\n \t     of the emitted code: see mx_register_decls().  */\n \n-\t  tree pt_type = build_pointer_type (TREE_TYPE (decl));\n-\t  tree alloc_stmt\n-\t    = (build_function_call_expr\n-\t       (implicit_built_in_decls[BUILT_IN_STACK_ALLOC],\n-\t\ttree_cons (NULL_TREE,\n-\t\t\t   build1 (ADDR_EXPR, pt_type, decl),\n-\t\t\t   tree_cons (NULL_TREE, DECL_SIZE_UNIT (decl),\n-\t\t\t\t      NULL_TREE))));\n+\t  tree t, args;\n+\n+\t  gimplify_type_sizes (TREE_TYPE (decl), stmt_p);\n+\t  gimplify_one_sizepos (&DECL_SIZE (decl), stmt_p);\n+\t  gimplify_one_sizepos (&DECL_SIZE_UNIT (decl), stmt_p);\n+\n+\t  args = tree_cons (NULL, DECL_SIZE_UNIT (decl), NULL);\n+\t  t = build_fold_addr_expr (decl);\n+\t  args = tree_cons (NULL, t, args);\n+\t  t = implicit_built_in_decls[BUILT_IN_STACK_ALLOC];\n+\t  t = build_function_call_expr (t, args);\n \n-\t  gimplify_and_add (alloc_stmt, stmt_p);\n+\t  gimplify_and_add (t, stmt_p);\n \t  DECL_DEFER_OUTPUT (decl) = 1;\n \t}\n "}]}