{"sha": "2c23ebfec69d77f9d62e80bfb4157c184f88364f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmMyM2ViZmVjNjlkNzdmOWQ2MmU4MGJmYjQxNTdjMTg0Zjg4MzY0Zg==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2011-10-19T22:05:23Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2011-10-19T22:05:23Z"}, "message": "re PR fortran/47023 (C_Sizeof: Rejects valid code)\n\n2011-10-19  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/47023\n\t* check.c (gfc_check_sizeof): Reject procedures as argument of SIZEOF.\n\t* intrinsinc.texi (SIZEOF): Document it.\n\t(STORAGE_SIZE): Fix special characters. Fix line breaks.\n\n2011-10-19  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/47023\n\t* gfortran.dg/sizeof_proc.f90: New.\n\nFrom-SVN: r180210", "tree": {"sha": "7bb1b66ecb7f8dab68864953e87af67e4240c434", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7bb1b66ecb7f8dab68864953e87af67e4240c434"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c23ebfec69d77f9d62e80bfb4157c184f88364f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c23ebfec69d77f9d62e80bfb4157c184f88364f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c23ebfec69d77f9d62e80bfb4157c184f88364f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c23ebfec69d77f9d62e80bfb4157c184f88364f/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e423833d36290e6919a4f286f0ba92e2395267c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e423833d36290e6919a4f286f0ba92e2395267c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e423833d36290e6919a4f286f0ba92e2395267c5"}], "stats": {"total": 58, "additions": 54, "deletions": 4}, "files": [{"sha": "a350ff29a38ffdf3dbe671a09a7cb5650f225a91", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=2c23ebfec69d77f9d62e80bfb4157c184f88364f", "patch": "@@ -1,3 +1,10 @@\n+2011-10-19  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/47023\n+\t* check.c (gfc_check_sizeof): Reject procedures as argument of SIZEOF.\n+\t* intrinsinc.texi (SIZEOF): Document it.\n+\t(STORAGE_SIZE): Fix special characters. Fix line breaks.\n+\n 2011-10-18  Mikael Morin  <mikael@gcc.gnu.org>\n \n \tPR fortran/50420"}, {"sha": "bf4559203b1b9efc28a79ba944917dd797225ccc", "filename": "gcc/fortran/check.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ffortran%2Fcheck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ffortran%2Fcheck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fcheck.c?ref=2c23ebfec69d77f9d62e80bfb4157c184f88364f", "patch": "@@ -3444,8 +3444,15 @@ gfc_check_size (gfc_expr *array, gfc_expr *dim, gfc_expr *kind)\n \n \n gfc_try\n-gfc_check_sizeof (gfc_expr *arg ATTRIBUTE_UNUSED)\n+gfc_check_sizeof (gfc_expr *arg)\n {\n+  if (arg->ts.type == BT_PROCEDURE)\n+    {\n+      gfc_error (\"'%s' argument of '%s' intrinsic at %L may not be a procedure\",\n+\t\t gfc_current_intrinsic_arg[0]->name, gfc_current_intrinsic,\n+\t\t &arg->where);\n+      return FAILURE;\n+    }\n   return SUCCESS;\n }\n "}, {"sha": "084cd15ea6f4931d3c2d8d47532c9aa38cddece3", "filename": "gcc/fortran/intrinsic.texi", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ffortran%2Fintrinsic.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ffortran%2Fintrinsic.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fintrinsic.texi?ref=2c23ebfec69d77f9d62e80bfb4157c184f88364f", "patch": "@@ -11459,7 +11459,8 @@ number of bytes occupied by the argument.  If the argument has the\n to is returned.  If the argument is of a derived type with @code{POINTER}\n or @code{ALLOCATABLE} components, the return value doesn't account for\n the sizes of the data pointed to by these components. If the argument is\n-polymorphic, the size according to the declared type is returned.\n+polymorphic, the size according to the declared type is returned. The argument\n+may not be a procedure or procedure pointer.\n \n @item @emph{Example}:\n @smallexample\n@@ -11816,8 +11817,10 @@ Inquiry function\n @end multitable\n \n @item @emph{Return Value}:\n-The result is a scalar integer with the kind type parameter speci\ufb01ed by KIND (or default integer type if KIND is missing). The result value is the size expressed in bits for an element of an array that\n-has the dynamic type and type parameters of A.\n+The result is a scalar integer with the kind type parameter specified by KIND\n+(or default integer type if KIND is missing). The result value is the size\n+expressed in bits for an element of an array that has the dynamic type and type\n+parameters of A.\n \n @item @emph{See also}:\n @ref{C_SIZEOF}, @ref{SIZEOF}"}, {"sha": "23f1e5fff1feb4231921f7f26adf01aa4e9a8175", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2c23ebfec69d77f9d62e80bfb4157c184f88364f", "patch": "@@ -1,3 +1,8 @@\n+2011-10-19  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/47023\n+\t* gfortran.dg/sizeof_proc.f90: New.\n+\n 2011-10-19  Joseph Myers  <joseph@codesourcery.com>\n \n \t* g++.dg/compat/struct-layout-1_generate.c: Also pass -mno-mmx"}, {"sha": "b4a2d7320038fcf464207aa6274722a8296ffd47", "filename": "gcc/testsuite/gfortran.dg/sizeof_proc.f90", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ftestsuite%2Fgfortran.dg%2Fsizeof_proc.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c23ebfec69d77f9d62e80bfb4157c184f88364f/gcc%2Ftestsuite%2Fgfortran.dg%2Fsizeof_proc.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsizeof_proc.f90?ref=2c23ebfec69d77f9d62e80bfb4157c184f88364f", "patch": "@@ -0,0 +1,28 @@\n+! { dg-do compile }\n+!\n+! PR 47023: C_Sizeof: Rejects valid code\n+!\n+! Contributed by Janus Weil <janus@gcc.gnu.org>\n+\n+use iso_c_binding\n+procedure(real) :: proc\n+procedure(real), pointer :: pp\n+pp => sin\n+\n+print *,sizeof(proc)    ! { dg-error \"may not be a procedure\" }\n+print *,sizeof(pp)      ! { dg-error \"may not be a procedure\" }\n+print *,sizeof(pp(0.))\n+print *,sizeof(sub)     ! { dg-error \"may not be a procedure\" }\n+print *,sizeof(func)    ! { dg-error \"may not be a procedure\" }\n+print *,sizeof(func())\n+\n+contains\n+\n+  subroutine sub\n+  end subroutine\n+\n+  real function func()\n+    func = 0.\n+  end function\n+\n+end"}]}