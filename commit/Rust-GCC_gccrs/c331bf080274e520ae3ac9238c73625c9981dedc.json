{"sha": "c331bf080274e520ae3ac9238c73625c9981dedc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzMzMWJmMDgwMjc0ZTUyMGFlM2FjOTIzOGM3MzYyNWM5OTgxZGVkYw==", "commit": {"author": {"name": "Kazuhiro Inaoka", "email": "inaoka.kazuhiro@renesas.com", "date": "2004-12-15T12:13:07Z"}, "committer": {"name": "Nick Clifton", "email": "nickc@gcc.gnu.org", "date": "2004-12-15T12:13:07Z"}, "message": "config/m32r.c (m32r_legitimize_pic_address): Changed to support GOTOFF relocation.\n\nconfig/m32r.c  (m32r_legitimize_pic_address): Changed to support GOTOFF\n               relocation.\nconfig/m32r.md (UNSPEC_GOTOFF): New.\n               (gotoff_load_addr): New.\n\nFrom-SVN: r92186", "tree": {"sha": "60b06fc1a57f4dd134488d9304dfdcff69417786", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60b06fc1a57f4dd134488d9304dfdcff69417786"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c331bf080274e520ae3ac9238c73625c9981dedc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c331bf080274e520ae3ac9238c73625c9981dedc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c331bf080274e520ae3ac9238c73625c9981dedc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c331bf080274e520ae3ac9238c73625c9981dedc/comments", "author": null, "committer": null, "parents": [{"sha": "2594119414795e798aa0ed29617f12d0f629c56b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2594119414795e798aa0ed29617f12d0f629c56b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2594119414795e798aa0ed29617f12d0f629c56b"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "bbdaeab51fd0b4a4cd23e582c37654a13388cbe2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c331bf080274e520ae3ac9238c73625c9981dedc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c331bf080274e520ae3ac9238c73625c9981dedc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c331bf080274e520ae3ac9238c73625c9981dedc", "patch": "@@ -3,6 +3,11 @@\n \t* config/m32r/m32r.h (PREFERRED_DEBUGGING_TYPE):\n \tUse DWARF2_DEBUG.\n \n+\t* config/m32r.c (m32r_legitimize_pic_address): Changed\n+\tto support GOTOFF relocation.\n+\t* config/m32r.md (UNSPEC_GOTOFF): New.\n+\t(gotoff_load_addr): New.\n+\n 2004-12-15  Richard Sandiford  <rsandifo@redhat.com>\n \n \t* config/mips/mips.c (mips_arg_info): Use FUNCTION_ARG_BOUNDARY to"}, {"sha": "b5a5325724a826d4517e631bad73eb30e8320960", "filename": "gcc/config/m32r/m32r.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c331bf080274e520ae3ac9238c73625c9981dedc/gcc%2Fconfig%2Fm32r%2Fm32r.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c331bf080274e520ae3ac9238c73625c9981dedc/gcc%2Fconfig%2Fm32r%2Fm32r.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm32r%2Fm32r.c?ref=c331bf080274e520ae3ac9238c73625c9981dedc", "patch": "@@ -1987,12 +1987,21 @@ m32r_legitimize_pic_address (rtx orig, rtx reg)\n       else\n         address = reg;\n \n+      current_function_uses_pic_offset_table = 1;\n+\n+      if (GET_CODE (orig) == LABEL_REF\n+          || (GET_CODE (orig) == SYMBOL_REF && SYMBOL_REF_LOCAL_P (orig)))\n+        {\n+          emit_insn (gen_gotoff_load_addr (reg, orig));\n+          emit_insn (gen_addsi3 (reg, reg, pic_offset_table_rtx));\n+          return reg;\n+        }\n+\n       emit_insn (gen_pic_load_addr (address, orig));\n \n       emit_insn (gen_addsi3 (address, address, pic_offset_table_rtx));\n       pic_ref = gen_const_mem (Pmode, address);\n       insn = emit_move_insn (reg, pic_ref);\n-      current_function_uses_pic_offset_table = 1;\n #if 0\n       /* Put a REG_EQUAL note on this insn, so that it can be optimized\n          by loop.  */"}, {"sha": "37f94e41599b8f561c7be9ab1a2759671b323505", "filename": "gcc/config/m32r/m32r.md", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c331bf080274e520ae3ac9238c73625c9981dedc/gcc%2Fconfig%2Fm32r%2Fm32r.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c331bf080274e520ae3ac9238c73625c9981dedc/gcc%2Fconfig%2Fm32r%2Fm32r.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm32r%2Fm32r.md?ref=c331bf080274e520ae3ac9238c73625c9981dedc", "patch": "@@ -31,7 +31,9 @@\n   [(UNSPEC_LOAD_SDA_BASE\t2)\n    (UNSPEC_SET_CBIT\t\t3)\n    (UNSPEC_PIC_LOAD_ADDR\t4)\n-   (UNSPEC_GET_PC\t\t5)])\n+   (UNSPEC_GET_PC\t\t5)\n+   (UNSPEC_GOTOFF\t\t6)\n+   ])\n \n ;; Insn type.  Used to default other attribute values.\n (define_attr \"type\"\n@@ -2570,6 +2572,14 @@\n   \"ld24 %0,%#%1\"\n   [(set_attr \"type\" \"int4\")])\n \n+(define_insn \"gotoff_load_addr\"\n+  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n+        (unspec:SI [(match_operand 1 \"\" \"\")] UNSPEC_GOTOFF))]\n+  \"flag_pic\"\n+  \"seth %0, %#shigh(%1@GOTOFF)\\;add3 %0, %0, low(%1@GOTOFF)\"\n+  [(set_attr \"type\" \t\"int4\")\n+   (set_attr \"length\"\t\"8\")])\n+\n ;; Load program counter insns.\n \n (define_insn \"get_pc\""}]}