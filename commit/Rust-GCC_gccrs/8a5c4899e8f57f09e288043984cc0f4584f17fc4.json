{"sha": "8a5c4899e8f57f09e288043984cc0f4584f17fc4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGE1YzQ4OTllOGY1N2YwOWUyODgwNDM5ODRjYzBmNDU4NGYxN2ZjNA==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-05-29T18:15:08Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-05-29T18:15:08Z"}, "message": "re PR fortran/18918 (Eventually support Fortran 2008's coarrays [co-arrays])\n\n2011-05-29  Tobias Burnus  <burnus@net-b.de>\n            Richard Guenther  <rguenther@suse.de>\n\n        PR fortran/18918\n        * trans-types.c (gfc_get_nodesc_array_type): Don't mess with\n        the type's TREE_TYPE.\n        * trans-array.c (gfc_conv_array_ref): Use TYPE_MAIN_VARIANT.\n        * trans.c (gfc_build_array_ref): Ditto.\n\n2011-05-29  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/18918\n        * gfortran.dg/coarray_23.f90: New.\n\n\nCo-Authored-By: Richard Guenther <rguenther@suse.de>\n\nFrom-SVN: r174410", "tree": {"sha": "6d2fbf1b69f77f9c491dee27d2731c9582c5f614", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6d2fbf1b69f77f9c491dee27d2731c9582c5f614"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a5c4899e8f57f09e288043984cc0f4584f17fc4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a5c4899e8f57f09e288043984cc0f4584f17fc4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a5c4899e8f57f09e288043984cc0f4584f17fc4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a5c4899e8f57f09e288043984cc0f4584f17fc4/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "269e0e1853605002f06a19b0e7e5106d8d491631", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/269e0e1853605002f06a19b0e7e5106d8d491631", "html_url": "https://github.com/Rust-GCC/gccrs/commit/269e0e1853605002f06a19b0e7e5106d8d491631"}], "stats": {"total": 36, "additions": 30, "deletions": 6}, "files": [{"sha": "71e6452ca5bb67854f15cf4e15875b033f002552", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=8a5c4899e8f57f09e288043984cc0f4584f17fc4", "patch": "@@ -1,3 +1,12 @@\n+2011-05-29  Tobias Burnus  <burnus@net-b.de>\n+\t    Richard Guenther  <rguenther@suse.de>\n+\n+\tPR fortran/18918\n+\t* trans-types.c (gfc_get_nodesc_array_type): Don't mess with\n+\tthe type's TREE_TYPE.\n+\t* trans-array.c (gfc_conv_array_ref): Use TYPE_MAIN_VARIANT.\n+\t* trans.c (gfc_build_array_ref): Ditto.\n+\n 2011-05-27  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/18918"}, {"sha": "d83a7a9d8ece587de538713fd715caff15b236f7", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=8a5c4899e8f57f09e288043984cc0f4584f17fc4", "patch": "@@ -2628,7 +2628,7 @@ gfc_conv_array_ref (gfc_se * se, gfc_array_ref * ar, gfc_symbol * sym,\n \tse->expr = build_fold_indirect_ref_loc (input_location, se->expr);\n \n       /* Use the actual tree type and not the wrapped coarray. */\n-      se->expr = fold_convert (TREE_TYPE (TREE_TYPE (se->expr)), se->expr);\n+      se->expr = fold_convert (TYPE_MAIN_VARIANT (TREE_TYPE (se->expr)), se->expr);\n       return;\n     }\n "}, {"sha": "02a75fd28197979eef5282601738b30d1e1354e0", "filename": "gcc/fortran/trans-types.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2Ftrans-types.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2Ftrans-types.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-types.c?ref=8a5c4899e8f57f09e288043984cc0f4584f17fc4", "patch": "@@ -1423,10 +1423,7 @@ gfc_get_nodesc_array_type (tree etype, gfc_array_spec * as, gfc_packed packed,\n   if (as->rank)\n     type = make_node (ARRAY_TYPE);\n   else\n-    {\n-      type = build_variant_type_copy (etype);\n-      TREE_TYPE (type) = etype;\n-    }\n+    type = build_variant_type_copy (etype);\n \n   GFC_ARRAY_TYPE_P (type) = 1;\n   TYPE_LANG_SPECIFIC (type)"}, {"sha": "0ab4637851c5db6ebb3791c05d2441b2ce8eb295", "filename": "gcc/fortran/trans.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ffortran%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.c?ref=8a5c4899e8f57f09e288043984cc0f4584f17fc4", "patch": "@@ -320,7 +320,7 @@ gfc_build_array_ref (tree base, tree offset, tree decl)\n     {\n       gcc_assert (GFC_TYPE_ARRAY_CORANK (type) > 0);\n \n-      return fold_convert (TREE_TYPE (type), base);\n+      return fold_convert (TYPE_MAIN_VARIANT (type), base);\n     }\n \n   gcc_assert (TREE_CODE (type) == ARRAY_TYPE);"}, {"sha": "fce1c3256f7909ac3bde9cfb30b79ab226718e61", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8a5c4899e8f57f09e288043984cc0f4584f17fc4", "patch": "@@ -1,3 +1,8 @@\n+2011-05-29  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/18918\n+\t* gfortran.dg/coarray_23.f90: New.\n+\n 2011-05-29  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \tFrom Ryan Mansfield"}, {"sha": "429928a4d86de975fd6e77ceae8170d524135407", "filename": "gcc/testsuite/gfortran.dg/coarray_23.f90", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_23.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a5c4899e8f57f09e288043984cc0f4584f17fc4/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_23.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_23.f90?ref=8a5c4899e8f57f09e288043984cc0f4584f17fc4", "patch": "@@ -0,0 +1,13 @@\n+! { dg-do compile }\n+! { dg-options \"-fcoarray=single\" }\n+!\n+! PR fortran/18918\n+!\n+! The example was ICEing before as the tree-decl\n+! of the type was wrong.\n+!\n+\n+  subroutine test\n+    complex, save :: z[*]\n+    if (z /= cmplx (0.0, 0.0)) call abort()\n+  end subroutine test"}]}