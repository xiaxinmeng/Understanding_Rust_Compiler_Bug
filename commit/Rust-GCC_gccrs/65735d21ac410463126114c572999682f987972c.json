{"sha": "65735d21ac410463126114c572999682f987972c", "node_id": "C_kwDOANBUbNoAKDY1NzM1ZDIxYWM0MTA0NjMxMjYxMTRjNTcyOTk5NjgyZjk4Nzk3MmM", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-21T21:24:07Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-04-26T03:54:02Z"}, "message": "c++: generic lambda fn parm pack [PR104624]\n\nParameter packs from the enclosing context can be used unexpanded in a\nlambda that is itself part of a pack expansion, but not packs that are part\nof the lambda itself.  We already check for capture packs; we also need to\ncheck for function parameter packs of the lambda call operator.\n\n\tPR c++/104624\n\ngcc/cp/ChangeLog:\n\n\t* pt.cc (check_for_bare_parameter_packs): Check for lambda\n\tfunction parameter pack.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp1y/lambda-generic-variadic22.C: New test.", "tree": {"sha": "44f743f3468b3ce2611a1c6c52181b3cf7b86bd2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/44f743f3468b3ce2611a1c6c52181b3cf7b86bd2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65735d21ac410463126114c572999682f987972c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65735d21ac410463126114c572999682f987972c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65735d21ac410463126114c572999682f987972c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65735d21ac410463126114c572999682f987972c/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c83b9c54d9dee2dce5d8268472a745b013d166cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c83b9c54d9dee2dce5d8268472a745b013d166cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c83b9c54d9dee2dce5d8268472a745b013d166cc"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "a77b3166818607f7a22c47525cd1065bed8610c6", "filename": "gcc/cp/pt.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65735d21ac410463126114c572999682f987972c/gcc%2Fcp%2Fpt.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65735d21ac410463126114c572999682f987972c/gcc%2Fcp%2Fpt.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.cc?ref=65735d21ac410463126114c572999682f987972c", "patch": "@@ -4341,7 +4341,9 @@ check_for_bare_parameter_packs (tree t, location_t loc /* = UNKNOWN_LOCATION */)\n \t parameter_packs = TREE_CHAIN (parameter_packs))\n       {\n \ttree pack = TREE_VALUE (parameter_packs);\n-\tif (is_capture_proxy (pack))\n+\tif (is_capture_proxy (pack)\n+\t    || (TREE_CODE (pack) == PARM_DECL\n+\t\t&& DECL_CONTEXT (DECL_CONTEXT (pack)) == lam))\n \t  break;\n       }\n "}, {"sha": "670c598a865d7e40a320becfb77529affebed93b", "filename": "gcc/testsuite/g++.dg/cpp1y/lambda-generic-variadic22.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65735d21ac410463126114c572999682f987972c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-generic-variadic22.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65735d21ac410463126114c572999682f987972c/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-generic-variadic22.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Flambda-generic-variadic22.C?ref=65735d21ac410463126114c572999682f987972c", "patch": "@@ -0,0 +1,15 @@\n+// PR c++/104624\n+// { dg-do compile { target c++14 } }\n+\n+template <typename T>\n+auto f (T)\n+{\n+  auto a = [](auto ... i)\t// { dg-prune-output \"incomplete type\" }\n+  {\n+    int x[][i] = { 0 };\t\t// { dg-error \"not expanded\" }\n+  }();\n+}\n+void g ()\n+{\n+  f(0);\n+}"}]}