{"sha": "faae53f8ca3766da999534c342e00e5eeadd9f9d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmFhZTUzZjhjYTM3NjZkYTk5OTUzNGMzNDJlMDBlNWVlYWRkOWY5ZA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2015-05-27T13:17:13Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2015-05-27T13:17:13Z"}, "message": "LTO balanced map: add stats about insns and symbols.\n\n\t* lto-partition.c (new_partition): Reset number of symbols.\n\t(add_symbol_to_partition_1): Increment number of symbols.\n\t(undo_partition): Decrement number of symbols.\n\t(lto_balanced_map): Dump number of symbols and insns that\n\tbelong to a partition.\n\t* lto-partition.h (struct ltrans_partition_def): Add symbol counter.\n\nFrom-SVN: r223750", "tree": {"sha": "5df24c84558041a7e8f12ac911f7becfb5c8ddfa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5df24c84558041a7e8f12ac911f7becfb5c8ddfa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/faae53f8ca3766da999534c342e00e5eeadd9f9d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faae53f8ca3766da999534c342e00e5eeadd9f9d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/faae53f8ca3766da999534c342e00e5eeadd9f9d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faae53f8ca3766da999534c342e00e5eeadd9f9d/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4d45be537bef92d4222e89c958b26983d4009d2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d45be537bef92d4222e89c958b26983d4009d2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d45be537bef92d4222e89c958b26983d4009d2e"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "6e27922f6eec1e14b4e5534bbd3f4f01d5d1c51c", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faae53f8ca3766da999534c342e00e5eeadd9f9d/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faae53f8ca3766da999534c342e00e5eeadd9f9d/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=faae53f8ca3766da999534c342e00e5eeadd9f9d", "patch": "@@ -1,3 +1,12 @@\n+2015-05-27  Martin Liska  <mliska@suse.cz>\n+\n+\t* lto-partition.c (new_partition): Reset number of symbols.\n+\t(add_symbol_to_partition_1): Increment number of symbols.\n+\t(undo_partition): Decrement number of symbols.\n+\t(lto_balanced_map): Dump number of symbols and insns that\n+\tbelong to a partition.\n+\t* lto-partition.h (struct ltrans_partition_def): Add symbol counter.\n+\n 2015-05-22  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* lto.c (hash_canonical_type): Be sure we hash only types that"}, {"sha": "8c72d9e9a41607ef0080f93210e1e38749566e9f", "filename": "gcc/lto/lto-partition.c", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faae53f8ca3766da999534c342e00e5eeadd9f9d/gcc%2Flto%2Flto-partition.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faae53f8ca3766da999534c342e00e5eeadd9f9d/gcc%2Flto%2Flto-partition.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-partition.c?ref=faae53f8ca3766da999534c342e00e5eeadd9f9d", "patch": "@@ -73,6 +73,7 @@ new_partition (const char *name)\n   part->encoder = lto_symtab_encoder_new (false);\n   part->name = name;\n   part->insns = 0;\n+  part->symbols = 0;\n   ltrans_partitions.safe_push (part);\n   return part;\n }\n@@ -157,6 +158,8 @@ add_symbol_to_partition_1 (ltrans_partition part, symtab_node *node)\n   gcc_assert (c != SYMBOL_EXTERNAL\n \t      && (c == SYMBOL_DUPLICATE || !symbol_partitioned_p (node)));\n \n+  part->symbols++;\n+\n   lto_set_symtab_encoder_in_partition (part->encoder, node);\n \n   if (symbol_partitioned_p (node))\n@@ -274,6 +277,7 @@ undo_partition (ltrans_partition partition, unsigned int n_nodes)\n     {\n       symtab_node *node = lto_symtab_encoder_deref (partition->encoder,\n \t\t\t\t\t\t   n_nodes);\n+      partition->symbols--;\n       cgraph_node *cnode;\n \n       /* After UNDO we no longer know what was visited.  */\n@@ -462,7 +466,7 @@ lto_balanced_map (int n_lto_partitions)\n   auto_vec<varpool_node *> varpool_order;\n   int i;\n   struct cgraph_node *node;\n-  int total_size = 0, best_total_size = 0;\n+  int original_total_size, total_size = 0, best_total_size = 0;\n   int partition_size;\n   ltrans_partition partition;\n   int last_visited_node = 0;\n@@ -488,6 +492,8 @@ lto_balanced_map (int n_lto_partitions)\n \t  total_size += inline_summaries->get (node)->size;\n       }\n \n+  original_total_size = total_size;\n+\n   /* Streaming works best when the source units do not cross partition\n      boundaries much.  This is because importing function from a source\n      unit tends to import a lot of global trees defined there.  We should\n@@ -782,6 +788,23 @@ lto_balanced_map (int n_lto_partitions)\n   add_sorted_nodes (next_nodes, partition);\n \n   free (order);\n+\n+  if (symtab->dump_file)\n+    {\n+      fprintf (symtab->dump_file, \"\\nPartition sizes:\\n\");\n+      unsigned partitions = ltrans_partitions.length ();\n+\n+      for (unsigned i = 0; i < partitions ; i++)\n+\t{\n+\t  ltrans_partition p = ltrans_partitions[i];\n+\t  fprintf (symtab->dump_file, \"partition %d contains %d (%2.2f%%)\"\n+\t\t   \" symbols and %d (%2.2f%%) insns\\n\", i, p->symbols,\n+\t\t   100.0 * p->symbols / n_nodes, p->insns,\n+\t\t   100.0 * p->insns / original_total_size);\n+\t}\n+\n+      fprintf (symtab->dump_file, \"\\n\");\n+    }\n }\n \n /* Return true if we must not change the name of the NODE.  The name as"}, {"sha": "a44e8e703c6f64887aae8ac5a4aabbf7d8e69487", "filename": "gcc/lto/lto-partition.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faae53f8ca3766da999534c342e00e5eeadd9f9d/gcc%2Flto%2Flto-partition.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faae53f8ca3766da999534c342e00e5eeadd9f9d/gcc%2Flto%2Flto-partition.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-partition.h?ref=faae53f8ca3766da999534c342e00e5eeadd9f9d", "patch": "@@ -26,6 +26,7 @@ struct ltrans_partition_def\n   lto_symtab_encoder_t encoder;\n   const char * name;\n   int insns;\n+  int symbols;\n   hash_set<symtab_node *> *initializers_visited;\n };\n "}]}