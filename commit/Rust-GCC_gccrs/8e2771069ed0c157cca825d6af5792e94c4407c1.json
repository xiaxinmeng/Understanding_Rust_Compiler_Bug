{"sha": "8e2771069ed0c157cca825d6af5792e94c4407c1", "node_id": "C_kwDOANBUbNoAKDhlMjc3MTA2OWVkMGMxNTdjY2E4MjVkNmFmNTc5MmU5NGM0NDA3YzE", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2022-01-05T21:18:10Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2022-01-06T20:45:56Z"}, "message": "Fortran: Fix ICE in argument_rank_mismatch [PR103287]\n\nThis patch removes an incorrect assertion.  A user-friendly error for this\ncase is already given elsewhere.\n\n2022-01-05  Steve Kargl  <kargl@gcc.gnu.org>\n\t    Sandra Loosemore  <sandra@codesourcery.com>\n\n\tPR fortran/103287\n\n\tgcc/fortran/\n\t* interface.c (argument_rank_mismatch): Replace incorrect assertion\n\twith return.\n\n\tgcc/testsuite/\n\t* gfortran.dg/c-interop/pr103287-1.f90: new.\n\t* gfortran.dg/c-interop/pr103287-2.f90: new.", "tree": {"sha": "b4baee38d00056b0bed1d4a4007e80e5a02ec796", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4baee38d00056b0bed1d4a4007e80e5a02ec796"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8e2771069ed0c157cca825d6af5792e94c4407c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e2771069ed0c157cca825d6af5792e94c4407c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e2771069ed0c157cca825d6af5792e94c4407c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e2771069ed0c157cca825d6af5792e94c4407c1/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2e5c4feed32c808591b5278f680bbabe63eb225", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2e5c4feed32c808591b5278f680bbabe63eb225", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2e5c4feed32c808591b5278f680bbabe63eb225"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "0fd881dec15e632299b4090b9b22379ada9cee23", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2771069ed0c157cca825d6af5792e94c4407c1/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2771069ed0c157cca825d6af5792e94c4407c1/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=8e2771069ed0c157cca825d6af5792e94c4407c1", "patch": "@@ -2237,7 +2237,11 @@ argument_rank_mismatch (const char *name, locus *where,\n     }\n   else\n     {\n-      gcc_assert (rank2 != -1);\n+      if (rank2 == -1)\n+\t/* This is an assumed rank-actual passed to a function without\n+\t   an explicit interface, which is already diagnosed in\n+\t   gfc_procedure_use.  */\n+\treturn;\n       if (rank1 == 0)\n \tgfc_error_opt (0, \"Rank mismatch between actual argument at %L \"\n \t\t       \"and actual argument at %L (scalar and rank-%d)\","}, {"sha": "aeca52f01da1a3ef8d33208012869372a00cc68a", "filename": "gcc/testsuite/gfortran.dg/c-interop/pr103287-1.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2771069ed0c157cca825d6af5792e94c4407c1/gcc%2Ftestsuite%2Fgfortran.dg%2Fc-interop%2Fpr103287-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2771069ed0c157cca825d6af5792e94c4407c1/gcc%2Ftestsuite%2Fgfortran.dg%2Fc-interop%2Fpr103287-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fc-interop%2Fpr103287-1.f90?ref=8e2771069ed0c157cca825d6af5792e94c4407c1", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+\n+subroutine g\n+   call s([1])\n+end\n+subroutine h(x)\n+   integer, pointer :: x(..)\n+   call s(x) ! { dg-error \"Assumed-rank argument requires an explicit interface\" } \n+end"}, {"sha": "0e724b8fa47636285f01435132afe72863013b6b", "filename": "gcc/testsuite/gfortran.dg/c-interop/pr103287-2.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8e2771069ed0c157cca825d6af5792e94c4407c1/gcc%2Ftestsuite%2Fgfortran.dg%2Fc-interop%2Fpr103287-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8e2771069ed0c157cca825d6af5792e94c4407c1/gcc%2Ftestsuite%2Fgfortran.dg%2Fc-interop%2Fpr103287-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fc-interop%2Fpr103287-2.f90?ref=8e2771069ed0c157cca825d6af5792e94c4407c1", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+\n+subroutine g\n+   call s(1)\n+end\n+subroutine h(x)\n+   integer, pointer :: x(..)\n+   call s(x) ! { dg-error \"Assumed-rank argument requires an explicit interface\" } \n+end"}]}