{"sha": "e37288a608ed33f7789feff4f4ee7fa772e5a962", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTM3Mjg4YTYwOGVkMzNmNzc4OWZlZmY0ZjRlZTdmYTc3MmU1YTk2Mg==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2016-05-17T08:07:52Z"}, "committer": {"name": "Chung-Lin Tang", "email": "cltang@gcc.gnu.org", "date": "2016-05-17T08:07:52Z"}, "message": "oacc-init.c (acc_init): Remove !cached_base_dev condition on call to gomp_init_targets_once.\n\n2016-05-17  Chung-Lin Tang  <cltang@codesourcery.com>\n\n\tlibgomp/\n\t* oacc-init.c (acc_init): Remove !cached_base_dev condition on call\n\tto gomp_init_targets_once.\n\t(acc_set_device_type): Remove !cached_base_dev condition on call to\n\tgomp_init_targets_once, move call to before acc_device_lock acquire,\n\tto avoid deadlock.\n\t(acc_get_device_num): Remove !cached_base_dev condition on call to\n\tgomp_init_targets_once.\n\t(acc_set_device_num): Likewise.\n\nFrom-SVN: r236310", "tree": {"sha": "e3b174fc73b1ba4b2a489962bed55e58b39ca16c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e3b174fc73b1ba4b2a489962bed55e58b39ca16c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e37288a608ed33f7789feff4f4ee7fa772e5a962", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e37288a608ed33f7789feff4f4ee7fa772e5a962", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e37288a608ed33f7789feff4f4ee7fa772e5a962", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e37288a608ed33f7789feff4f4ee7fa772e5a962/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d35c169874df4bfb773c511b188754f6e22e4f55", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d35c169874df4bfb773c511b188754f6e22e4f55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d35c169874df4bfb773c511b188754f6e22e4f55"}], "stats": {"total": 25, "additions": 16, "deletions": 9}, "files": [{"sha": "3f2fe5a4df9b6629ce27837532753cbaabadefe4", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e37288a608ed33f7789feff4f4ee7fa772e5a962/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e37288a608ed33f7789feff4f4ee7fa772e5a962/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=e37288a608ed33f7789feff4f4ee7fa772e5a962", "patch": "@@ -1,3 +1,14 @@\n+2016-05-17  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* oacc-init.c (acc_init): Remove !cached_base_dev condition on call\n+\tto gomp_init_targets_once.\n+\t(acc_set_device_type): Remove !cached_base_dev condition on call to\n+\tgomp_init_targets_once, move call to before acc_device_lock acquire,\n+\tto avoid deadlock.\n+\t(acc_get_device_num): Remove !cached_base_dev condition on call to\n+\tgomp_init_targets_once.\n+\t(acc_set_device_num): Likewise.\n+\n 2016-05-16  Martin Jambor  <mjambor@suse.cz>\n \n         * testsuite/libgomp.hsa.c/complex-align-2.c: New test."}, {"sha": "f6176eccd3f658d8d5eea744c2645ac529994910", "filename": "libgomp/oacc-init.c", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e37288a608ed33f7789feff4f4ee7fa772e5a962/libgomp%2Foacc-init.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e37288a608ed33f7789feff4f4ee7fa772e5a962/libgomp%2Foacc-init.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Foacc-init.c?ref=e37288a608ed33f7789feff4f4ee7fa772e5a962", "patch": "@@ -433,8 +433,7 @@ goacc_attach_host_thread_to_device (int ord)\n void\n acc_init (acc_device_t d)\n {\n-  if (!cached_base_dev)\n-    gomp_init_targets_once ();\n+  gomp_init_targets_once ();\n \n   gomp_mutex_lock (&acc_device_lock);\n \n@@ -498,10 +497,9 @@ acc_set_device_type (acc_device_t d)\n   struct gomp_device_descr *base_dev, *acc_dev;\n   struct goacc_thread *thr = goacc_thread ();\n \n-  gomp_mutex_lock (&acc_device_lock);\n+  gomp_init_targets_once ();\n \n-  if (!cached_base_dev)\n-    gomp_init_targets_once ();\n+  gomp_mutex_lock (&acc_device_lock);\n \n   cached_base_dev = base_dev = resolve_device (d, true);\n   acc_dev = &base_dev[goacc_device_num];\n@@ -563,8 +561,7 @@ acc_get_device_num (acc_device_t d)\n   if (d >= _ACC_device_hwm)\n     gomp_fatal (\"unknown device type %u\", (unsigned) d);\n \n-  if (!cached_base_dev)\n-    gomp_init_targets_once ();\n+  gomp_init_targets_once ();\n \n   gomp_mutex_lock (&acc_device_lock);\n   dev = resolve_device (d, true);\n@@ -584,8 +581,7 @@ acc_set_device_num (int ord, acc_device_t d)\n   struct gomp_device_descr *base_dev, *acc_dev;\n   int num_devices;\n \n-  if (!cached_base_dev)\n-    gomp_init_targets_once ();\n+  gomp_init_targets_once ();\n \n   if (ord < 0)\n     ord = goacc_device_num;"}]}