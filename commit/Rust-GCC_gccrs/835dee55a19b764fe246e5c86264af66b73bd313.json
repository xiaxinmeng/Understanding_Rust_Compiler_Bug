{"sha": "835dee55a19b764fe246e5c86264af66b73bd313", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODM1ZGVlNTVhMTliNzY0ZmUyNDZlNWM4NjI2NGFmNjZiNzNiZDMxMw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-07-17T16:22:19Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-07-17T16:22:19Z"}, "message": "re PR c++/50961 (Fails to decay template function properly(?))\n\n/cp\n2014-07-17  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/50961\n\t* call.c (standard_conversion): Use resolve_nondeduced_context\n\tfor type_unknown_p (EXPR) && TREE_CODE (TO) == BOOLEAN_TYPE.\n\n/testsuite\n2014-07-17  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/50961\n\t* g++.dg/template/operator13.C: New.\n\nFrom-SVN: r212760", "tree": {"sha": "7820b3ddb8ebdec0d390d01041a54e5fc591cb59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7820b3ddb8ebdec0d390d01041a54e5fc591cb59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/835dee55a19b764fe246e5c86264af66b73bd313", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/835dee55a19b764fe246e5c86264af66b73bd313", "html_url": "https://github.com/Rust-GCC/gccrs/commit/835dee55a19b764fe246e5c86264af66b73bd313", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/835dee55a19b764fe246e5c86264af66b73bd313/comments", "author": null, "committer": null, "parents": [{"sha": "37738b0fe4b2f3be6f21fc20722e917185949764", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37738b0fe4b2f3be6f21fc20722e917185949764", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37738b0fe4b2f3be6f21fc20722e917185949764"}], "stats": {"total": 45, "additions": 38, "deletions": 7}, "files": [{"sha": "779e087e4441898472d934fbe5b554cf335cb86b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=835dee55a19b764fe246e5c86264af66b73bd313", "patch": "@@ -1,3 +1,9 @@\n+2014-07-17  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/50961\n+\t* call.c (standard_conversion): Use resolve_nondeduced_context\n+\tfor type_unknown_p (EXPR) && TREE_CODE (TO) == BOOLEAN_TYPE.\n+\n 2014-07-17  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/61804"}, {"sha": "61e2769807bb514f62c69af50bb5978f0a3d097c", "filename": "gcc/cp/call.c", "status": "modified", "additions": 15, "deletions": 7, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=835dee55a19b764fe246e5c86264af66b73bd313", "patch": "@@ -1107,14 +1107,22 @@ standard_conversion (tree to, tree from, tree expr, bool c_cast_p,\n   to = strip_top_quals (to);\n   from = strip_top_quals (from);\n \n-  if ((TYPE_PTRFN_P (to) || TYPE_PTRMEMFUNC_P (to))\n-      && expr && type_unknown_p (expr))\n+  if (expr && type_unknown_p (expr))\n     {\n-      tsubst_flags_t tflags = tf_conv;\n-      expr = instantiate_type (to, expr, tflags);\n-      if (expr == error_mark_node)\n-\treturn NULL;\n-      from = TREE_TYPE (expr);\n+      if (TYPE_PTRFN_P (to) || TYPE_PTRMEMFUNC_P (to))\n+\t{\n+\t  tsubst_flags_t tflags = tf_conv;\n+\t  expr = instantiate_type (to, expr, tflags);\n+\t  if (expr == error_mark_node)\n+\t    return NULL;\n+\t  from = TREE_TYPE (expr);\n+\t}\n+      else if (TREE_CODE (to) == BOOLEAN_TYPE)\n+\t{\n+\t  /* Necessary for eg, TEMPLATE_ID_EXPRs (c++/50961).  */\n+\t  expr = resolve_nondeduced_context (expr);\n+\t  from = TREE_TYPE (expr);\n+\t}\n     }\n \n   fcode = TREE_CODE (from);"}, {"sha": "55cf9e5d014407736c1804420bd57ebb59278828", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=835dee55a19b764fe246e5c86264af66b73bd313", "patch": "@@ -1,3 +1,8 @@\n+2014-07-17  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/50961\n+\t* g++.dg/template/operator13.C: New.\n+\n 2014-07-17  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* gcc.target/aarch64/simd/vfma_f64.c: New test."}, {"sha": "1967c910e68851205a96ce00da14d12633596ece", "filename": "gcc/testsuite/g++.dg/template/operator13.C", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Foperator13.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/835dee55a19b764fe246e5c86264af66b73bd313/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Foperator13.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Foperator13.C?ref=835dee55a19b764fe246e5c86264af66b73bd313", "patch": "@@ -0,0 +1,12 @@\n+// PR c++/50961\n+\n+template < class > void foo ();\n+\n+bool b1 = !foo<void>;\n+bool b2 = foo<void> ? true : false;\n+\n+void bar()\n+{\n+  if (foo<void>)\n+    ;\n+}"}]}