{"sha": "7cfac5953a129fe78668db20cdf2533125349dea", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2NmYWM1OTUzYTEyOWZlNzg2NjhkYjIwY2RmMjUzMzEyNTM0OWRlYQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@markmitchell.com", "date": "1998-10-16T14:06:24Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "1998-10-16T14:06:24Z"}, "message": "decl.c (expand_static_init): Build cleanups before entering the anonymous function used to do them to avoid...\n\n\t* decl.c (expand_static_init): Build cleanups before entering the\n\tanonymous function used to do them to avoid access-checking\n\tconfusion.\n\t* decl.c (grokfndecl): Add back call to cplus_decl_attributes\n\taccidentally removed by previous change, and make DECL_RTL here.\n\t* class.c (add_method): Don't make DECL_RTL here.\n\nFrom-SVN: r23138", "tree": {"sha": "ffa08c0a95e67f0e44a6a971e67c65936e47ad1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ffa08c0a95e67f0e44a6a971e67c65936e47ad1f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7cfac5953a129fe78668db20cdf2533125349dea", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cfac5953a129fe78668db20cdf2533125349dea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7cfac5953a129fe78668db20cdf2533125349dea", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cfac5953a129fe78668db20cdf2533125349dea/comments", "author": null, "committer": null, "parents": [{"sha": "588c2d1c2f7303efadc5159cab5af58d78d1c405", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/588c2d1c2f7303efadc5159cab5af58d78d1c405", "html_url": "https://github.com/Rust-GCC/gccrs/commit/588c2d1c2f7303efadc5159cab5af58d78d1c405"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "0569dd3232aa2c5abae975ff75389117a4f81db5", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7cfac5953a129fe78668db20cdf2533125349dea", "patch": "@@ -1,5 +1,13 @@\n 1998-10-16  Mark Mitchell  <mark@markmitchell.com>\n \n+\t* decl.c (expand_static_init): Build cleanups before entering the\n+\tanonymous function used to do them to avoid access-checking\n+\tconfusion.\n+\n+\t* decl.c (grokfndecl): Add back call to cplus_decl_attributes\n+\taccidentally removed by previous change, and make DECL_RTL here.\n+\t* class.c (add_method): Don't make DECL_RTL here.\n+\t\n \t* pt.c (for_each_template_parm): Don't examine uninstantiated\n \tdefault arguments.\n "}, {"sha": "68f65f668038bcb82ed729e07b1f407a7568a91b", "filename": "gcc/cp/class.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=7cfac5953a129fe78668db20cdf2533125349dea", "patch": "@@ -1270,9 +1270,6 @@ add_method (type, fields, method)\n \t\t}\n \t    }\n \n-\t  /* Create RTL for the METHOD.  */\n-\t  make_decl_rtl (method, NULL_PTR, 1);\n-\n \t  /* Actually insert the new method.  */\n \t  TREE_VEC_ELT (method_vec, i) \n \t    = build_overload (method, TREE_VEC_ELT (method_vec, i));"}, {"sha": "80ee017bf50880e12ccc05650f70ea3087b61941", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=7cfac5953a129fe78668db20cdf2533125349dea", "patch": "@@ -7814,8 +7814,13 @@ expand_static_init (decl, init)\n \t      pop_obstacks ();\n \t    }\n \t      \n+\t  /* Call build_cleanup before we enter the anonymous function\n+\t     so that any access checks will be done relative to the\n+\t     current scope, rather than the scope of the anonymous\n+\t     function.  */\n+\t  fcall = build_cleanup (decl);\n \t  cleanup = start_anon_func ();\n-\t  expand_expr_stmt (build_cleanup (decl));\n+\t  expand_expr_stmt (fcall);\n \t  end_anon_func ();\n \t  mark_addressable (cleanup);\n \t  cleanup = build_unary_op (ADDR_EXPR, cleanup, 0);\n@@ -8235,6 +8240,11 @@ grokfndecl (ctype, type, declarator, orig_declarator, virtualp, flags, quals,\n       if (ctype == NULL_TREE || check)\n \treturn decl;\n \n+      if (attrlist)\n+\tcplus_decl_attributes (decl, TREE_PURPOSE (attrlist), \n+\t\t\t       TREE_VALUE (attrlist));\n+      make_decl_rtl (decl, NULL_PTR, 1);\n+\n       if (virtualp)\n \t{\n \t  DECL_VIRTUAL_P (decl) = 1;"}, {"sha": "b75771e76e2c2ee9ec2de6b0f0c39f9326d883f5", "filename": "gcc/testsuite/g++.old-deja/g++.other/static3.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fstatic3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfac5953a129fe78668db20cdf2533125349dea/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fstatic3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fstatic3.C?ref=7cfac5953a129fe78668db20cdf2533125349dea", "patch": "@@ -0,0 +1,14 @@\n+// Build don't link:\n+\n+class S \n+{\n+  ~S();\n+public:\n+  friend void f();\n+};\n+\n+\n+S::~S()\n+{\n+  static S s;\n+}"}]}