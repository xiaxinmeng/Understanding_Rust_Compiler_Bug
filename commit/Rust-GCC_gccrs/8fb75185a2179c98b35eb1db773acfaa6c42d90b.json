{"sha": "8fb75185a2179c98b35eb1db773acfaa6c42d90b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGZiNzUxODVhMjE3OWM5OGIzNWViMWRiNzczYWNmYWE2YzQyZDkwYg==", "commit": {"author": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-11-30T15:59:07Z"}, "committer": {"name": "Andre Vehreschild", "email": "vehre@gcc.gnu.org", "date": "2016-11-30T15:59:07Z"}, "message": "single.c (_gfortran_caf_get_by_ref): Prevent compile time warning.\n\nlibgfortran/ChangeLog:\n\n2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n        * caf/single.c (_gfortran_caf_get_by_ref): Prevent compile time\n        warning.\n        (_gfortran_caf_send_by_ref): Same.\n        (_gfortran_caf_is_present): Prevent fallthrough warnings.\n\ngcc/testsuite/ChangeLog:\n\n2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n\n\t* ChangeLog: Removed wrongly placed entry.\n\t* gfortran.dg/coarray_lib_alloc_4.f90: New test.\n\nFrom-SVN: r243034", "tree": {"sha": "ebe00badd50927fac4232ca1a5b4e3fbd32a1865", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ebe00badd50927fac4232ca1a5b4e3fbd32a1865"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8fb75185a2179c98b35eb1db773acfaa6c42d90b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fb75185a2179c98b35eb1db773acfaa6c42d90b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8fb75185a2179c98b35eb1db773acfaa6c42d90b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8fb75185a2179c98b35eb1db773acfaa6c42d90b/comments", "author": null, "committer": null, "parents": [{"sha": "bdc5f9370cf1ee5b83cacc29fc737e458d173f70", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bdc5f9370cf1ee5b83cacc29fc737e458d173f70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bdc5f9370cf1ee5b83cacc29fc737e458d173f70"}], "stats": {"total": 67, "additions": 60, "deletions": 7}, "files": [{"sha": "c1ab201a9efa256278daec4e76a094ffe230207a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fb75185a2179c98b35eb1db773acfaa6c42d90b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fb75185a2179c98b35eb1db773acfaa6c42d90b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8fb75185a2179c98b35eb1db773acfaa6c42d90b", "patch": "@@ -1,3 +1,8 @@\n+2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\tNow really add the file.\n+\t* gfortran.dg/coarray_lib_alloc_4.f90: New test.\n+\n 2016-11-30  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* g++.dg/eh/new1.C: XFAIL on AIX.\n@@ -33,11 +38,6 @@\n \tPR tree-optimization/78574\n \t* gcc.c-torture/compile/pr78574.c: New test.\n \n-2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n-\n-\t* caf/single.c (_gfortran_caf_is_present): Prevent fallthrough\n-\twarnings.\n-\n 2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \t* gfortran.dg/coarray/alloc_comp_1.f90: Fix tree-dump scans to adhere"}, {"sha": "aea9fbf7f98d62d47d5e9770241f668aa318360c", "filename": "gcc/testsuite/gfortran.dg/coarray_lib_alloc_4.f90", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fb75185a2179c98b35eb1db773acfaa6c42d90b/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_lib_alloc_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fb75185a2179c98b35eb1db773acfaa6c42d90b/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_lib_alloc_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcoarray_lib_alloc_4.f90?ref=8fb75185a2179c98b35eb1db773acfaa6c42d90b", "patch": "@@ -0,0 +1,46 @@\n+! { dg-do run }\n+! { dg-options \"-fcoarray=lib -lcaf_single -fdump-tree-original\" }\n+!\n+! Allocate/deallocate with libcaf.\n+!\n+\n+program test_caf_alloc\n+\n+  type t\n+    integer, allocatable :: i\n+    real, allocatable :: r(:)\n+  end type t\n+\n+  type(t), allocatable :: xx[:]\n+\n+  allocate (xx[*])\n+\n+  if (allocated(xx%i)) call abort()\n+  if (allocated(xx[1]%i)) call abort()\n+  if (allocated(xx[1]%r)) call abort()\n+  allocate(xx%i)\n+  if (.not. allocated(xx[1]%i)) call abort()\n+  if (allocated(xx[1]%r)) call abort()\n+  \n+  allocate(xx%r(5))\n+  if (.not. allocated(xx[1]%i)) call abort()\n+  if (.not. allocated(xx[1]%r)) call abort()\n+  \n+  deallocate(xx%i)\n+  if (allocated(xx[1]%i)) call abort()\n+  if (.not. allocated(xx[1]%r)) call abort()\n+\n+  deallocate(xx%r)\n+  if (allocated(xx[1]%i)) call abort()\n+  if (allocated(xx[1]%r)) call abort()\n+\n+  deallocate(xx)\n+end\n+\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_is_present \\\\(xx\\\\.token, 2 - \\\\(integer\\\\(kind=4\\\\)\\\\) xx\\\\.dim\\\\\\[0\\\\\\]\\\\.lbound, &caf_ref\\\\.\\[0-9\\]+\\\\)|_gfortran_caf_is_present \\\\(xx\\\\.token, 2 - xx\\\\.dim\\\\\\[0\\\\\\]\\\\.lbound, &caf_ref\\\\.\\[0-9\\]+\\\\)\" 10 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_register \\\\(72, 1, &xx\\\\.token, \\\\(void \\\\*\\\\) &xx, 0B, 0B, 0\\\\)\" 1 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_register \\\\(\\[0-9\\]+, 7\" 2 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_register \\\\(\\[0-9\\]+, 8\" 2 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister \\\\(&xx\\\\.token, 0, 0B, 0B, 0\\\\)\" 1 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister \\\\(&\\\\(\\\\(struct t \\\\* restrict\\\\) xx\\\\.data\\\\)->r\\\\.token, 1, 0B, 0B, 0\\\\)\" 1 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"_gfortran_caf_deregister \\\\(&\\\\(\\\\(struct t \\\\* restrict\\\\) xx\\\\.data\\\\)->_caf_i, 1, 0B, 0B, 0\\\\)\" 1 \"original\" } }"}, {"sha": "d3966f5d54cdae6cd4d08b0dfaa655516ce8282a", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fb75185a2179c98b35eb1db773acfaa6c42d90b/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fb75185a2179c98b35eb1db773acfaa6c42d90b/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=8fb75185a2179c98b35eb1db773acfaa6c42d90b", "patch": "@@ -1,3 +1,10 @@\n+2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n+\n+\t* caf/single.c (_gfortran_caf_get_by_ref): Prevent compile time\n+\twarning.\n+\t(_gfortran_caf_send_by_ref): Same.\n+\t(_gfortran_caf_is_present): Prevent fallthrough\twarnings.\n+\n 2016-11-30  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \t* caf/libcaf.h: Add new action types for (de-)registration of"}, {"sha": "d1b33592502c344b3773c6bb561e51299faebd01", "filename": "libgfortran/caf/single.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8fb75185a2179c98b35eb1db773acfaa6c42d90b/libgfortran%2Fcaf%2Fsingle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8fb75185a2179c98b35eb1db773acfaa6c42d90b/libgfortran%2Fcaf%2Fsingle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fcaf%2Fsingle.c?ref=8fb75185a2179c98b35eb1db773acfaa6c42d90b", "patch": "@@ -1471,7 +1471,7 @@ _gfortran_caf_get_by_ref (caf_token_t token,\n   size_t dst_index[GFC_MAX_DIMENSIONS];\n   int dst_rank = GFC_DESCRIPTOR_RANK (dst);\n   int dst_cur_dim = 0;\n-  size_t src_size;\n+  size_t src_size = 0;\n   caf_single_token_t single_token = TOKEN (token);\n   void *memptr = single_token->memptr;\n   gfc_descriptor_t *src = single_token->desc;\n@@ -2325,7 +2325,7 @@ _gfortran_caf_send_by_ref (caf_token_t token,\n   size_t dst_index[GFC_MAX_DIMENSIONS];\n   int src_rank = GFC_DESCRIPTOR_RANK (src);\n   int src_cur_dim = 0;\n-  size_t src_size;\n+  size_t src_size = 0;\n   caf_single_token_t single_token = TOKEN (token);\n   void *memptr = single_token->memptr;\n   gfc_descriptor_t *dst = single_token->desc;"}]}