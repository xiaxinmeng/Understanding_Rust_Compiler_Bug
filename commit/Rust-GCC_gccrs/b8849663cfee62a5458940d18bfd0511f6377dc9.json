{"sha": "b8849663cfee62a5458940d18bfd0511f6377dc9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjg4NDk2NjNjZmVlNjJhNTQ1ODk0MGQxOGJmZDA1MTFmNjM3N2RjOQ==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2010-03-20T16:01:17Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2010-03-20T16:01:17Z"}, "message": "re PR fortran/43450 (-fwhole-file: ICE in gfc_create_module_variable, at fortran/trans-decl.c:3386)\n\n2010-03-20  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/43450\n\t* trans-decl.c (gfc_create_module_variable): With -fwhole-file\n\tdo not assert the context of derived types.\n\n2010-03-20  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/43450\n\t* gfortran.dg/whole_file_15.f90 : New test.\n\nFrom-SVN: r157595", "tree": {"sha": "36376a6bcc6f643c925edc656fda08666e1e6fa1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36376a6bcc6f643c925edc656fda08666e1e6fa1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b8849663cfee62a5458940d18bfd0511f6377dc9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8849663cfee62a5458940d18bfd0511f6377dc9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8849663cfee62a5458940d18bfd0511f6377dc9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8849663cfee62a5458940d18bfd0511f6377dc9/comments", "author": null, "committer": null, "parents": [{"sha": "21b04412b046c5819813c4b7d3853277385b93aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21b04412b046c5819813c4b7d3853277385b93aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21b04412b046c5819813c4b7d3853277385b93aa"}], "stats": {"total": 58, "additions": 53, "deletions": 5}, "files": [{"sha": "03eb8fef97f4c6509db5962fa1588c0ca4e86583", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b8849663cfee62a5458940d18bfd0511f6377dc9", "patch": "@@ -1,3 +1,9 @@\n+2010-03-20  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/43450\n+\t* trans-decl.c (gfc_create_module_variable): With -fwhole-file\n+\tdo not assert the context of derived types.\n+\n 2010-03-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/43409"}, {"sha": "3dc070cdc6b9b45b3688052ca004a9015b78af34", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=b8849663cfee62a5458940d18bfd0511f6377dc9", "patch": "@@ -3382,11 +3382,16 @@ gfc_create_module_variable (gfc_symbol * sym)\n     {\n       decl = sym->backend_decl;\n       gcc_assert (sym->ns->proc_name->attr.flavor == FL_MODULE);\n-      gcc_assert (TYPE_CONTEXT (decl) == NULL_TREE\n-\t\t  || TYPE_CONTEXT (decl) == sym->ns->proc_name->backend_decl);\n-      gcc_assert (DECL_CONTEXT (TYPE_STUB_DECL (decl)) == NULL_TREE\n-\t\t  || DECL_CONTEXT (TYPE_STUB_DECL (decl))\n-\t\t     == sym->ns->proc_name->backend_decl);\n+\n+      /* -fwhole-file mixes up the contexts so these asserts are unnecessary.  */\n+      if (!(gfc_option.flag_whole_file && sym->attr.use_assoc))\n+\t{\n+\t  gcc_assert (TYPE_CONTEXT (decl) == NULL_TREE\n+\t\t      || TYPE_CONTEXT (decl) == sym->ns->proc_name->backend_decl);\n+\t  gcc_assert (DECL_CONTEXT (TYPE_STUB_DECL (decl)) == NULL_TREE\n+\t\t      || DECL_CONTEXT (TYPE_STUB_DECL (decl))\n+\t\t\t   == sym->ns->proc_name->backend_decl);\n+\t}\n       TYPE_CONTEXT (decl) = sym->ns->proc_name->backend_decl;\n       DECL_CONTEXT (TYPE_STUB_DECL (decl)) = sym->ns->proc_name->backend_decl;\n       gfc_module_add_decl (cur_module, TYPE_STUB_DECL (decl));"}, {"sha": "2f8f1a80f247183d833a996a2adbb476758c72ed", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b8849663cfee62a5458940d18bfd0511f6377dc9", "patch": "@@ -1,3 +1,8 @@\n+2010-03-20  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/43450\n+\t* gfortran.dg/whole_file_15.f90 : New test.\n+\n 2010-03-20  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/43409"}, {"sha": "08d6120445b87f431da29aa62e818d19b295df75", "filename": "gcc/testsuite/gfortran.dg/whole_file_15.f90", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ftestsuite%2Fgfortran.dg%2Fwhole_file_15.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8849663cfee62a5458940d18bfd0511f6377dc9/gcc%2Ftestsuite%2Fgfortran.dg%2Fwhole_file_15.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fwhole_file_15.f90?ref=b8849663cfee62a5458940d18bfd0511f6377dc9", "patch": "@@ -0,0 +1,32 @@\n+! { dg-do compile }\n+! { dg-options \"-fwhole-file\" }\n+! Test the fix for PR43450 in which the use of 'replica_env_type'\n+! caused an ICE in ep_types\n+!\n+! Contributed by Tobias Burnus <burnus@gcc.gnu.org>\n+!\n+MODULE replica_types\n+  TYPE replica_env_type\n+  END TYPE replica_env_type\n+CONTAINS\n+  SUBROUTINE rep_env_create(rep_env, para_env, input, nrep, prep,&\n+       sync_v,keep_wf_history,row_force)\n+  END SUBROUTINE rep_env_create\n+  SUBROUTINE rep_envs_add_rep_env(rep_env)\n+    TYPE(replica_env_type), POINTER          :: rep_env\n+  END SUBROUTINE rep_envs_add_rep_env\n+END MODULE replica_types\n+MODULE ep_types\n+  USE replica_types\n+  TYPE ep_env_type\n+     TYPE(replica_env_type), POINTER :: mol_envs\n+  END TYPE ep_env_type\n+  TYPE ep_env_p_type\n+     TYPE(ep_env_type), POINTER :: ep_env\n+  END TYPE ep_env_p_type\n+  TYPE(ep_env_p_type), DIMENSION(:), POINTER :: ep_envs\n+CONTAINS\n+  SUBROUTINE ep_force_release()\n+  END SUBROUTINE ep_force_release\n+END MODULE ep_types\n+! { dg-final { cleanup-modules \"replica_types ep_types\" } }"}]}