{"sha": "b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjA5MWI4ZGMwYjlmZGZlMTU3ZGE1YTczOGU4Y2JiMzYwMTQzZmM5ZQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2017-01-11T14:44:04Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2017-01-11T14:44:04Z"}, "message": "PR78273 fix count to work with partitioning function\n\n\tPR libstdc++/78273\n\t* include/bits/stl_map.h (map::count<_Kt>(const _Kt&)): Don't assume\n\tthe heterogeneous comparison can only find one match.\n\t* include/bits/stl_set.h (set::count<_Kt>(const _Kt&)): Likewise.\n\t* testsuite/23_containers/map/operations/2.cc: Test count works with\n\tcomparison function that just partitions rather than sorting.\n\t* testsuite/23_containers/set/operations/2.cc: Likewise.\n\nFrom-SVN: r244317", "tree": {"sha": "968e331b6db2ff2c777d3680dcf336d9f3ed2dee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/968e331b6db2ff2c777d3680dcf336d9f3ed2dee"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a92ffb3e945608131f5edf3ec2d6d583e417083b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a92ffb3e945608131f5edf3ec2d6d583e417083b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a92ffb3e945608131f5edf3ec2d6d583e417083b"}], "stats": {"total": 59, "additions": 57, "deletions": 2}, "files": [{"sha": "b52d6dfc8c7e45836dace79c9d0f5f55f5331063", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "patch": "@@ -1,3 +1,13 @@\n+2017-01-11  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/78273\n+\t* include/bits/stl_map.h (map::count<_Kt>(const _Kt&)): Don't assume\n+\tthe heterogeneous comparison can only find one match.\n+\t* include/bits/stl_set.h (set::count<_Kt>(const _Kt&)): Likewise.\n+\t* testsuite/23_containers/map/operations/2.cc: Test count works with\n+\tcomparison function that just partitions rather than sorting.\n+\t* testsuite/23_containers/set/operations/2.cc: Likewise.\n+\n 2017-01-11  Ville Voutilainen  <ville.voutilainen@gmail.com>\n \n \tReduce the size of variant, it doesn't need an index of"}, {"sha": "91b80d93e6b2ce8782f12fc71fa33649ad09bcea", "filename": "libstdc++-v3/include/bits/stl_map.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_map.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_map.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_map.h?ref=b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "patch": "@@ -1194,7 +1194,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n       template<typename _Kt>\n \tauto\n \tcount(const _Kt& __x) const -> decltype(_M_t._M_count_tr(__x))\n-\t{ return _M_t._M_find_tr(__x) == _M_t.end() ? 0 : 1; }\n+\t{ return _M_t._M_count_tr(__x); }\n #endif\n       //@}\n "}, {"sha": "ab960f18810aa03aa1c4148262cb59a4b86893bb", "filename": "libstdc++-v3/include/bits/stl_set.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_set.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_set.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_set.h?ref=b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "patch": "@@ -739,7 +739,7 @@ _GLIBCXX_BEGIN_NAMESPACE_CONTAINER\n \tauto\n \tcount(const _Kt& __x) const\n \t-> decltype(_M_t._M_count_tr(__x))\n-\t{ return _M_t._M_find_tr(__x) == _M_t.end() ? 0 : 1; }\n+\t{ return _M_t._M_count_tr(__x); }\n #endif\n       //@}\n "}, {"sha": "ef4e76b60e6fa447bada4f1b78a2b108e38628c8", "filename": "libstdc++-v3/testsuite/23_containers/map/operations/2.cc", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fmap%2Foperations%2F2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fmap%2Foperations%2F2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fmap%2Foperations%2F2.cc?ref=b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "patch": "@@ -133,6 +133,27 @@ test05()\n   VERIFY( Cmp::count == 0);\n }\n \n+void\n+test06()\n+{\n+  // PR libstdc++/78273\n+\n+  struct C {\n+    bool operator()(int l, int r) const { return l < r; }\n+\n+    struct Partition { };\n+\n+    bool operator()(int l, Partition) const { return l < 2; }\n+    bool operator()(Partition, int r) const { return 4 < r; }\n+\n+    using is_transparent = void;\n+  };\n+\n+  std::map<int, int, C> m{ {1,0}, {2,0}, {3,0}, {4, 0}, {5, 0} };\n+\n+  auto n = m.count(C::Partition{});\n+  VERIFY( n == 3 );\n+}\n \n int\n main()\n@@ -142,4 +163,5 @@ main()\n   test03();\n   test04();\n   test05();\n+  test06();\n }"}, {"sha": "aef808d31b245653f6725d59c66d662298918434", "filename": "libstdc++-v3/testsuite/23_containers/set/operations/2.cc", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fset%2Foperations%2F2.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b091b8dc0b9fdfe157da5a738e8cbb360143fc9e/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fset%2Foperations%2F2.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fset%2Foperations%2F2.cc?ref=b091b8dc0b9fdfe157da5a738e8cbb360143fc9e", "patch": "@@ -150,6 +150,28 @@ test06()\n   s.find(i);\n }\n \n+void\n+test07()\n+{\n+  // PR libstdc++/78273\n+\n+  struct C {\n+    bool operator()(int l, int r) const { return l < r; }\n+\n+    struct Partition { };\n+\n+    bool operator()(int l, Partition) const { return l < 2; }\n+    bool operator()(Partition, int r) const { return 4 < r; }\n+\n+    using is_transparent = void;\n+  };\n+\n+  std::set<int, C> s{ 1, 2, 3, 4, 5 };\n+\n+  auto n = s.count(C::Partition{});\n+  VERIFY( n == 3 );\n+}\n+\n int\n main()\n {\n@@ -159,4 +181,5 @@ main()\n   test04();\n   test05();\n   test06();\n+  test07();\n }"}]}