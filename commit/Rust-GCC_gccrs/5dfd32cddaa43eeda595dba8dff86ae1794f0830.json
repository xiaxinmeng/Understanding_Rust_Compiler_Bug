{"sha": "5dfd32cddaa43eeda595dba8dff86ae1794f0830", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWRmZDMyY2RkYWE0M2VlZGE1OTVkYmE4ZGZmODZhZTE3OTRmMDgzMA==", "commit": {"author": {"name": "Bernd Edlinger", "email": "bernd.edlinger@hotmail.de", "date": "2013-10-21T15:51:48Z"}, "committer": {"name": "Bernd Edlinger", "email": "edlinger@gcc.gnu.org", "date": "2013-10-21T15:51:48Z"}, "message": "Fix DECL_BIT_FIELD depencency on flag_strict_volatile_bitfields and...\n\n2013-10-21  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        Fix DECL_BIT_FIELD depencency on flag_strict_volatile_bitfields\n        and get_inner_reference returning different pmode for non-volatile\n        bit-field members dependent on flag_strict_volatile_bitfields.\n        * stor-layout.c (layout_decl): Remove special handling of\n        flag_strict_volatile_bitfields.\n        * expr.c (get_inner_reference): Don't use DECL_BIT_FIELD\n        if flag_strict_volatile_bitfields > 0 and TREE_THIS_VOLATILE.\n\nFrom-SVN: r203898", "tree": {"sha": "3cbd330a92a954d9c4e588c3b77ef68400c5ae80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3cbd330a92a954d9c4e588c3b77ef68400c5ae80"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5dfd32cddaa43eeda595dba8dff86ae1794f0830", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5dfd32cddaa43eeda595dba8dff86ae1794f0830", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5dfd32cddaa43eeda595dba8dff86ae1794f0830", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5dfd32cddaa43eeda595dba8dff86ae1794f0830/comments", "author": {"login": "bernd-edlinger", "id": 17638929, "node_id": "MDQ6VXNlcjE3NjM4OTI5", "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bernd-edlinger", "html_url": "https://github.com/bernd-edlinger", "followers_url": "https://api.github.com/users/bernd-edlinger/followers", "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}", "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions", "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs", "repos_url": "https://api.github.com/users/bernd-edlinger/repos", "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}", "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bff3610402612ce2d9c7bd136ee36fb4ab977b6"}], "stats": {"total": 32, "additions": 20, "deletions": 12}, "files": [{"sha": "fd9123f6ae0cb75a03edbe1b5b1715f68ca06ab7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dfd32cddaa43eeda595dba8dff86ae1794f0830/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dfd32cddaa43eeda595dba8dff86ae1794f0830/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5dfd32cddaa43eeda595dba8dff86ae1794f0830", "patch": "@@ -1,3 +1,13 @@\n+2013-10-21  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\tFix DECL_BIT_FIELD depencency on flag_strict_volatile_bitfields\n+\tand get_inner_reference returning different pmode for non-volatile\n+\tbit-field members dependent on flag_strict_volatile_bitfields.\n+\t* stor-layout.c (layout_decl): Remove special handling of\n+\tflag_strict_volatile_bitfields.\n+\t* expr.c (get_inner_reference): Don't use DECL_BIT_FIELD\n+\tif flag_strict_volatile_bitfields > 0 and TREE_THIS_VOLATILE.\n+\n 2013-10-21  Paulo Matos  <pmatos@broadcom.com>\n \n \t* ipa-inline.c (edge_badness): Cap edge->count at max_count for badness"}, {"sha": "e672e454219bf345d5d6209dfea3ff7cfa77975f", "filename": "gcc/expr.c", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dfd32cddaa43eeda595dba8dff86ae1794f0830/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dfd32cddaa43eeda595dba8dff86ae1794f0830/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=5dfd32cddaa43eeda595dba8dff86ae1794f0830", "patch": "@@ -6552,16 +6552,18 @@ get_inner_reference (tree exp, HOST_WIDE_INT *pbitsize,\n     {\n       tree field = TREE_OPERAND (exp, 1);\n       size_tree = DECL_SIZE (field);\n-      if (!DECL_BIT_FIELD (field))\n-\tmode = DECL_MODE (field);\n-      else if (DECL_MODE (field) == BLKmode)\n-\tblkmode_bitfield = true;\n-      else if (TREE_THIS_VOLATILE (exp)\n-\t       && flag_strict_volatile_bitfields > 0)\n+      if (flag_strict_volatile_bitfields > 0\n+\t  && TREE_THIS_VOLATILE (exp)\n+\t  && DECL_BIT_FIELD_TYPE (field)\n+\t  && DECL_MODE (field) != BLKmode)\n \t/* Volatile bitfields should be accessed in the mode of the\n \t     field's type, not the mode computed based on the bit\n \t     size.  */\n \tmode = TYPE_MODE (DECL_BIT_FIELD_TYPE (field));\n+      else if (!DECL_BIT_FIELD (field))\n+\tmode = DECL_MODE (field);\n+      else if (DECL_MODE (field) == BLKmode)\n+\tblkmode_bitfield = true;\n \n       *punsignedp = DECL_UNSIGNED (field);\n     }"}, {"sha": "4619d6e427b3d9cf33b5f94659a4c5feb79217eb", "filename": "gcc/stor-layout.c", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5dfd32cddaa43eeda595dba8dff86ae1794f0830/gcc%2Fstor-layout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5dfd32cddaa43eeda595dba8dff86ae1794f0830/gcc%2Fstor-layout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstor-layout.c?ref=5dfd32cddaa43eeda595dba8dff86ae1794f0830", "patch": "@@ -606,14 +606,10 @@ layout_decl (tree decl, unsigned int known_align)\n \n \t  /* See if we can use an ordinary integer mode for a bit-field.\n \t     Conditions are: a fixed size that is correct for another mode,\n-\t     occupying a complete byte or bytes on proper boundary,\n-\t     and not -fstrict-volatile-bitfields.  If the latter is set,\n-\t     we unfortunately can't check TREE_THIS_VOLATILE, as a cast\n-\t     may make a volatile object later.  */\n+\t     occupying a complete byte or bytes on proper boundary.  */\n \t  if (TYPE_SIZE (type) != 0\n \t      && TREE_CODE (TYPE_SIZE (type)) == INTEGER_CST\n-\t      && GET_MODE_CLASS (TYPE_MODE (type)) == MODE_INT\n-\t      && flag_strict_volatile_bitfields <= 0)\n+\t      && GET_MODE_CLASS (TYPE_MODE (type)) == MODE_INT)\n \t    {\n \t      enum machine_mode xmode\n \t\t= mode_for_size_tree (DECL_SIZE (decl), MODE_INT, 1);"}]}