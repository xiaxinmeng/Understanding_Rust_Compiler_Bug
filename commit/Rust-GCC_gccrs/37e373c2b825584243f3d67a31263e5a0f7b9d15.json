{"sha": "37e373c2b825584243f3d67a31263e5a0f7b9d15", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzdlMzczYzJiODI1NTg0MjQzZjNkNjdhMzEyNjNlNWEwZjdiOWQxNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-06-24T18:44:11Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-06-24T18:44:11Z"}, "message": "re PR tree-optimization/71647 (aligned(x:32) in #pragma omp simd does not work)\n\n\tPR tree-optimization/71647\n\t* omp-low.c (lower_rec_input_clauses): Convert\n\tomp_clause_aligned_alignment (c) to size_type_node for the\n\tlast argument of __builtin_assume_aligned.\n\n\t* gcc.target/i386/pr71647.c: New test.\n\nFrom-SVN: r237769", "tree": {"sha": "28b364b7658b39d19c00f3b705d77688098b4eb6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/28b364b7658b39d19c00f3b705d77688098b4eb6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37e373c2b825584243f3d67a31263e5a0f7b9d15", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37e373c2b825584243f3d67a31263e5a0f7b9d15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37e373c2b825584243f3d67a31263e5a0f7b9d15", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37e373c2b825584243f3d67a31263e5a0f7b9d15/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "de86ff8f97fa7352f4be371b053f7c3dcd4290c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de86ff8f97fa7352f4be371b053f7c3dcd4290c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de86ff8f97fa7352f4be371b053f7c3dcd4290c0"}], "stats": {"total": 54, "additions": 50, "deletions": 4}, "files": [{"sha": "71b818167edac458a4db4292ebd76a8c7d56e91f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=37e373c2b825584243f3d67a31263e5a0f7b9d15", "patch": "@@ -1,3 +1,10 @@\n+2016-06-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/71647\n+\t* omp-low.c (lower_rec_input_clauses): Convert\n+\tomp_clause_aligned_alignment (c) to size_type_node for the\n+\tlast argument of __builtin_assume_aligned.\n+\n 2016-06-24  Martin Liska  <mliska@suse.cz>\n \n \t* cfgloop.c (flow_loop_dump): Dump average number of loop iterations."}, {"sha": "b89978f77236edbaeaebdebd6dc4d12d799807d8", "filename": "gcc/omp-low.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=37e373c2b825584243f3d67a31263e5a0f7b9d15", "patch": "@@ -4475,8 +4475,9 @@ lower_rec_input_clauses (tree clauses, gimple_seq *ilist, gimple_seq *dlist,\n \t\t  if (new_var == NULL_TREE)\n \t\t    new_var = maybe_lookup_decl_in_outer_ctx (var, ctx);\n \t\t  x = builtin_decl_explicit (BUILT_IN_ASSUME_ALIGNED);\n-\t\t  x = build_call_expr_loc (clause_loc, x, 2, new_var,\n-\t\t\t\t\t   omp_clause_aligned_alignment (c));\n+\t\t  tree alarg = omp_clause_aligned_alignment (c);\n+\t\t  alarg = fold_convert_loc (clause_loc, size_type_node, alarg);\n+\t\t  x = build_call_expr_loc (clause_loc, x, 2, new_var, alarg);\n \t\t  x = fold_convert_loc (clause_loc, TREE_TYPE (new_var), x);\n \t\t  x = build2 (MODIFY_EXPR, TREE_TYPE (new_var), new_var, x);\n \t\t  gimplify_and_add (x, ilist);\n@@ -4489,8 +4490,9 @@ lower_rec_input_clauses (tree clauses, gimple_seq *ilist, gimple_seq *dlist,\n \t\t  t = maybe_lookup_decl_in_outer_ctx (var, ctx);\n \t\t  t = build_fold_addr_expr_loc (clause_loc, t);\n \t\t  t2 = builtin_decl_explicit (BUILT_IN_ASSUME_ALIGNED);\n-\t\t  t = build_call_expr_loc (clause_loc, t2, 2, t,\n-\t\t\t\t\t   omp_clause_aligned_alignment (c));\n+\t\t  tree alarg = omp_clause_aligned_alignment (c);\n+\t\t  alarg = fold_convert_loc (clause_loc, size_type_node, alarg);\n+\t\t  t = build_call_expr_loc (clause_loc, t2, 2, t, alarg);\n \t\t  t = fold_convert_loc (clause_loc, ptype, t);\n \t\t  x = create_tmp_var (ptype);\n \t\t  t = build2 (MODIFY_EXPR, ptype, x, t);"}, {"sha": "1ec279cf0eb360e0a0eb8009b5710feedef6b380", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=37e373c2b825584243f3d67a31263e5a0f7b9d15", "patch": "@@ -1,3 +1,8 @@\n+2016-06-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/71647\n+\t* gcc.target/i386/pr71647.c: New test.\n+\n 2016-06-24  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.dg/vect/vect-nb-iter-ub-1.c: Remove default vector"}, {"sha": "ab091bd93dd634021bb0d0140660a751499c4dcd", "filename": "gcc/testsuite/gcc.target/i386/pr71647.c", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr71647.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37e373c2b825584243f3d67a31263e5a0f7b9d15/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr71647.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr71647.c?ref=37e373c2b825584243f3d67a31263e5a0f7b9d15", "patch": "@@ -0,0 +1,32 @@\n+/* PR tree-optimization/71647 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fopenmp-simd -mavx -mno-avx512f -fdump-tree-vect-details\" } */\n+\n+void\n+foo (double *a, double *b)\n+{\n+  int i;\n+#pragma omp simd aligned(a,b:4*sizeof(double))\n+  for (i = 0; i < 32768; i++)\n+    a[i] += b[i];\n+}\n+\n+void\n+bar (double *a, double *b)\n+{\n+  int i;\n+#pragma omp simd aligned(a,b:32)\n+  for (i = 0; i < 32768; i++)\n+    a[i] += b[i];\n+}\n+\n+void\n+baz (double *a, double *b)\n+{\n+  int i;\n+#pragma omp simd aligned(a,b:32L)\n+  for (i = 0; i < 32768; i++)\n+    a[i] += b[i];\n+}\n+\n+/* { dg-final { scan-tree-dump-not \"Alignment of access forced using peeling\" \"vect\" } } */"}]}