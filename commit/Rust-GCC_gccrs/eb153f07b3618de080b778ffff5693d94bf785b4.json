{"sha": "eb153f07b3618de080b778ffff5693d94bf785b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWIxNTNmMDdiMzYxOGRlMDgwYjc3OGZmZmY1NjkzZDk0YmY3ODViNA==", "commit": {"author": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2018-07-03T00:19:59Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "2018-07-03T00:19:59Z"}, "message": "RISC-V: Fix interrupt support for -g.\n\n\tgcc/\n\t* config/riscv/riscv.c (riscv_expand_epilogue): Use emit_jump_insn\n\tinstead of emit_insn for interrupt returns.\n\t* config/riscv/riscv.md (riscv_met): Add (return) to rtl.\n\t(riscv_sret, riscv_uret): Likewise.\n\n\tgcc/testsuite/\n\t* gcc.target/riscv/interrupt-debug.c: New.\n\nFrom-SVN: r262327", "tree": {"sha": "8a29dee6b528506ea18bad07097a888d7bca653d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8a29dee6b528506ea18bad07097a888d7bca653d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eb153f07b3618de080b778ffff5693d94bf785b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb153f07b3618de080b778ffff5693d94bf785b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eb153f07b3618de080b778ffff5693d94bf785b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eb153f07b3618de080b778ffff5693d94bf785b4/comments", "author": null, "committer": null, "parents": [{"sha": "ccf266dbb86620ae8d8ff3b1aefdea45b5524d2a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccf266dbb86620ae8d8ff3b1aefdea45b5524d2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ccf266dbb86620ae8d8ff3b1aefdea45b5524d2a"}], "stats": {"total": 41, "additions": 35, "deletions": 6}, "files": [{"sha": "a8c2629cdac622a01d613697112d6a0b94e71cc5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=eb153f07b3618de080b778ffff5693d94bf785b4", "patch": "@@ -1,3 +1,10 @@\n+2018-07-02  Jim Wilson  <jimw@sifive.com>\n+\n+\t* config/riscv/riscv.c (riscv_expand_epilogue): Use emit_jump_insn\n+\tinstead of emit_insn for interrupt returns.\n+\t* config/riscv/riscv.md (riscv_met): Add (return) to rtl.\n+\t(riscv_sret, riscv_uret): Likewise.\n+\n 2018-07-02  David Malcolm  <dmalcolm@redhat.com>\n \n \t* pretty-print.c (selftest::test_pp_format): Move save and restore"}, {"sha": "d87836f53f859e58db0bb8ecfd06df70fd9b5ad3", "filename": "gcc/config/riscv/riscv.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Fconfig%2Friscv%2Friscv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Fconfig%2Friscv%2Friscv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.c?ref=eb153f07b3618de080b778ffff5693d94bf785b4", "patch": "@@ -3985,11 +3985,11 @@ riscv_expand_epilogue (int style)\n       enum riscv_privilege_levels mode = cfun->machine->interrupt_mode;\n \n       if (mode == MACHINE_MODE)\n-\temit_insn (gen_riscv_mret ());\n+\temit_jump_insn (gen_riscv_mret ());\n       else if (mode == SUPERVISOR_MODE)\n-\temit_insn (gen_riscv_sret ());\n+\temit_jump_insn (gen_riscv_sret ());\n       else\n-\temit_insn (gen_riscv_uret ());\n+\temit_jump_insn (gen_riscv_uret ());\n     }\n   else if (style != SIBCALL_RETURN)\n     emit_jump_insn (gen_simple_return_internal (ra));"}, {"sha": "613af9d79e47070c6e6ac4e161983b744df680c1", "filename": "gcc/config/riscv/riscv.md", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Fconfig%2Friscv%2Friscv.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Fconfig%2Friscv%2Friscv.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.md?ref=eb153f07b3618de080b778ffff5693d94bf785b4", "patch": "@@ -2328,17 +2328,20 @@\n   \"fsflags\\t%0\")\n \n (define_insn \"riscv_mret\"\n-  [(unspec_volatile [(const_int 0)] UNSPECV_MRET)]\n+  [(return)\n+   (unspec_volatile [(const_int 0)] UNSPECV_MRET)]\n   \"\"\n   \"mret\")\n \n (define_insn \"riscv_sret\"\n-  [(unspec_volatile [(const_int 0)] UNSPECV_SRET)]\n+  [(return)\n+   (unspec_volatile [(const_int 0)] UNSPECV_SRET)]\n   \"\"\n   \"sret\")\n \n (define_insn \"riscv_uret\"\n-  [(unspec_volatile [(const_int 0)] UNSPECV_URET)]\n+  [(return)\n+   (unspec_volatile [(const_int 0)] UNSPECV_URET)]\n   \"\"\n   \"uret\")\n "}, {"sha": "fb4422ff6e797be2250a994aeb0a955e3ab02381", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eb153f07b3618de080b778ffff5693d94bf785b4", "patch": "@@ -1,3 +1,7 @@\n+2018-07-02  Jim Wilson  <jimw@sifive.com>\n+\n+\t* gcc.target/riscv/interrupt-debug.c: New.\n+\n 2018-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* g++.dg/diagnostic/thread-thread_local.C: New."}, {"sha": "a1b6dac8fbbf8fadad20a67b590354d4f1c54875", "filename": "gcc/testsuite/gcc.target/riscv/interrupt-debug.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Finterrupt-debug.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eb153f07b3618de080b778ffff5693d94bf785b4/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Finterrupt-debug.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Friscv%2Finterrupt-debug.c?ref=eb153f07b3618de080b778ffff5693d94bf785b4", "patch": "@@ -0,0 +1,15 @@\n+/* Verify that we can compile with debug info.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-Og -g\" } */\n+extern int var1;\n+extern int var2;\n+extern void sub2 (void);\n+\n+void __attribute__ ((interrupt))\n+sub (void)\n+{\n+  if (var1)\n+    var2 = 0;\n+  else\n+    sub2 ();\n+}"}]}