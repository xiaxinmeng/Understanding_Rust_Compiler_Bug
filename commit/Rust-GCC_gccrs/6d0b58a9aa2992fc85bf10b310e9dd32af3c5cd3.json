{"sha": "6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmQwYjU4YTlhYTI5OTJmYzg1YmYxMGIzMTBlOWRkMzJhZjNjNWNkMw==", "commit": {"author": {"name": "Andreas Tobler", "email": "andreast@gcc.gnu.org", "date": "2006-04-22T22:17:26Z"}, "committer": {"name": "Andreas Tobler", "email": "andreast@gcc.gnu.org", "date": "2006-04-22T22:17:26Z"}, "message": "configure.ac: Weaken the check for MMAP.\n\n2006-04-22  Andreas Tobler  <a.tobler@schweiz.ch>\n\n\t* configure.ac: Weaken the check for MMAP.\n\t* configure: Rebuilt.\n\t* include/config.h.in: Likewise.\n\nFrom-SVN: r113182", "tree": {"sha": "93ac6e1f58180ad16a8eacfb5c1cdadf705b5752", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/93ac6e1f58180ad16a8eacfb5c1cdadf705b5752"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/comments", "author": null, "committer": null, "parents": [{"sha": "ac6ed182edca2c15eb0509336b5fcc45fb250fe7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac6ed182edca2c15eb0509336b5fcc45fb250fe7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac6ed182edca2c15eb0509336b5fcc45fb250fe7"}], "stats": {"total": 436, "additions": 51, "deletions": 385}, "files": [{"sha": "9ab4e752cd521705f3cd5e08883e18169673a065", "filename": "libjava/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "patch": "@@ -1,4 +1,10 @@\n-2004-04-20  Bryce McKinlay  <mckinlay@redhat.com>\n+2006-04-22  Andreas Tobler  <a.tobler@schweiz.ch>\n+\n+\t* configure.ac: Weaken the check for MMAP.\n+\t* configure: Rebuilt.\n+\t* include/config.h.in: Likewise.\n+\n+2006-04-20  Bryce McKinlay  <mckinlay@redhat.com>\n \n \tPR libgcj/27170\n \t* gnu/gcj/runtime/natSharedLibLoader.cc: Include gc.h to override"}, {"sha": "9553685188bc1569f75e8c525f2297b31107b26a", "filename": "libjava/configure", "status": "modified", "additions": 17, "deletions": 379, "changes": 396, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure?ref=6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "patch": "@@ -16248,170 +16248,14 @@ _ACEOF\n \n fi\n \n-if test x$gcc_no_link = xyes; then\n-  if test \"x${ac_cv_func_mmap_fixed_mapped+set}\" != xset; then\n-    ac_cv_func_mmap_fixed_mapped=no\n-  fi\n-fi\n-if test \"x${ac_cv_func_mmap_fixed_mapped}\" != xno; then\n \n+# AC_FUNC_MMAP goes to far and checks for mmap fixed, we do only need mmap\n+# at a mmap selected address. See\n+# gnu/java/nio/channels/natFileChannelPosix.cc\n \n-for ac_header in stdlib.h unistd.h\n-do\n-as_ac_Header=`echo \"ac_cv_header_$ac_header\" | $as_tr_sh`\n-if eval \"test \\\"\\${$as_ac_Header+set}\\\" = set\"; then\n-  echo \"$as_me:$LINENO: checking for $ac_header\" >&5\n-echo $ECHO_N \"checking for $ac_header... $ECHO_C\" >&6\n-if eval \"test \\\"\\${$as_ac_Header+set}\\\" = set\"; then\n-  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n-fi\n-echo \"$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`\" >&5\n-echo \"${ECHO_T}`eval echo '${'$as_ac_Header'}'`\" >&6\n-else\n-  # Is the header compilable?\n-echo \"$as_me:$LINENO: checking $ac_header usability\" >&5\n-echo $ECHO_N \"checking $ac_header usability... $ECHO_C\" >&6\n-cat >conftest.$ac_ext <<_ACEOF\n-/* confdefs.h.  */\n-_ACEOF\n-cat confdefs.h >>conftest.$ac_ext\n-cat >>conftest.$ac_ext <<_ACEOF\n-/* end confdefs.h.  */\n-$ac_includes_default\n-#include <$ac_header>\n-_ACEOF\n-rm -f conftest.$ac_objext\n-if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n-  (eval $ac_compile) 2>conftest.er1\n-  ac_status=$?\n-  grep -v '^ *+' conftest.er1 >conftest.err\n-  rm -f conftest.er1\n-  cat conftest.err >&5\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); } &&\n-\t { ac_try='test -z \"$ac_c_werror_flag\"\n-\t\t\t || test ! -s conftest.err'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; } &&\n-\t { ac_try='test -s conftest.$ac_objext'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; }; then\n-  ac_header_compiler=yes\n-else\n-  echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-ac_header_compiler=no\n-fi\n-rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n-echo \"$as_me:$LINENO: result: $ac_header_compiler\" >&5\n-echo \"${ECHO_T}$ac_header_compiler\" >&6\n-\n-# Is the header present?\n-echo \"$as_me:$LINENO: checking $ac_header presence\" >&5\n-echo $ECHO_N \"checking $ac_header presence... $ECHO_C\" >&6\n-cat >conftest.$ac_ext <<_ACEOF\n-/* confdefs.h.  */\n-_ACEOF\n-cat confdefs.h >>conftest.$ac_ext\n-cat >>conftest.$ac_ext <<_ACEOF\n-/* end confdefs.h.  */\n-#include <$ac_header>\n-_ACEOF\n-if { (eval echo \"$as_me:$LINENO: \\\"$ac_cpp conftest.$ac_ext\\\"\") >&5\n-  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1\n-  ac_status=$?\n-  grep -v '^ *+' conftest.er1 >conftest.err\n-  rm -f conftest.er1\n-  cat conftest.err >&5\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); } >/dev/null; then\n-  if test -s conftest.err; then\n-    ac_cpp_err=$ac_c_preproc_warn_flag\n-    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag\n-  else\n-    ac_cpp_err=\n-  fi\n-else\n-  ac_cpp_err=yes\n-fi\n-if test -z \"$ac_cpp_err\"; then\n-  ac_header_preproc=yes\n-else\n-  echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-  ac_header_preproc=no\n-fi\n-rm -f conftest.err conftest.$ac_ext\n-echo \"$as_me:$LINENO: result: $ac_header_preproc\" >&5\n-echo \"${ECHO_T}$ac_header_preproc\" >&6\n-\n-# So?  What about this header?\n-case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in\n-  yes:no: )\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!\" >&5\n-echo \"$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!\" >&2;}\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result\" >&5\n-echo \"$as_me: WARNING: $ac_header: proceeding with the compiler's result\" >&2;}\n-    ac_header_preproc=yes\n-    ;;\n-  no:yes:* )\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled\" >&5\n-echo \"$as_me: WARNING: $ac_header: present but cannot be compiled\" >&2;}\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?\" >&5\n-echo \"$as_me: WARNING: $ac_header:     check for missing prerequisite headers?\" >&2;}\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation\" >&5\n-echo \"$as_me: WARNING: $ac_header: see the Autoconf documentation\" >&2;}\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header:     section \\\"Present But Cannot Be Compiled\\\"\" >&5\n-echo \"$as_me: WARNING: $ac_header:     section \\\"Present But Cannot Be Compiled\\\"\" >&2;}\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result\" >&5\n-echo \"$as_me: WARNING: $ac_header: proceeding with the preprocessor's result\" >&2;}\n-    { echo \"$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence\" >&5\n-echo \"$as_me: WARNING: $ac_header: in the future, the compiler will take precedence\" >&2;}\n-    (\n-      cat <<\\_ASBOX\n-## ---------------------------------- ##\n-## Report this to the libjava lists.  ##\n-## ---------------------------------- ##\n-_ASBOX\n-    ) |\n-      sed \"s/^/$as_me: WARNING:     /\" >&2\n-    ;;\n-esac\n-echo \"$as_me:$LINENO: checking for $ac_header\" >&5\n-echo $ECHO_N \"checking for $ac_header... $ECHO_C\" >&6\n-if eval \"test \\\"\\${$as_ac_Header+set}\\\" = set\"; then\n-  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n-else\n-  eval \"$as_ac_Header=\\$ac_header_preproc\"\n-fi\n-echo \"$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`\" >&5\n-echo \"${ECHO_T}`eval echo '${'$as_ac_Header'}'`\" >&6\n-\n-fi\n-if test `eval echo '${'$as_ac_Header'}'` = yes; then\n-  cat >>confdefs.h <<_ACEOF\n-#define `echo \"HAVE_$ac_header\" | $as_tr_cpp` 1\n-_ACEOF\n-\n-fi\n-\n-done\n-\n-\n-for ac_func in getpagesize\n-do\n-as_ac_var=`echo \"ac_cv_func_$ac_func\" | $as_tr_sh`\n-echo \"$as_me:$LINENO: checking for $ac_func\" >&5\n-echo $ECHO_N \"checking for $ac_func... $ECHO_C\" >&6\n-if eval \"test \\\"\\${$as_ac_var+set}\\\" = set\"; then\n+echo \"$as_me:$LINENO: checking for mmap\" >&5\n+echo $ECHO_N \"checking for mmap... $ECHO_C\" >&6\n+if test \"${ac_cv_func_mmap_ok+set}\" = set; then\n   echo $ECHO_N \"(cached) $ECHO_C\" >&6\n else\n   if test x$gcc_no_link = xyes; then\n@@ -16425,47 +16269,16 @@ _ACEOF\n cat confdefs.h >>conftest.$ac_ext\n cat >>conftest.$ac_ext <<_ACEOF\n /* end confdefs.h.  */\n-/* Define $ac_func to an innocuous variant, in case <limits.h> declares $ac_func.\n-   For example, HP-UX 11i <limits.h> declares gettimeofday.  */\n-#define $ac_func innocuous_$ac_func\n \n-/* System header to define __stub macros and hopefully few prototypes,\n-    which can conflict with char $ac_func (); below.\n-    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since\n-    <limits.h> exists even on freestanding compilers.  */\n-\n-#ifdef __STDC__\n-# include <limits.h>\n-#else\n-# include <assert.h>\n-#endif\n-\n-#undef $ac_func\n-\n-/* Override any gcc2 internal prototype to avoid an error.  */\n-#ifdef __cplusplus\n-extern \"C\"\n-{\n-#endif\n-/* We use char because int might match the return type of a gcc2\n-   builtin and then its argument prototype would still apply.  */\n-char $ac_func ();\n-/* The GNU C library defines this for functions which it implements\n-    to always fail with ENOSYS.  Some functions are actually named\n-    something starting with __ and the normal name is an alias.  */\n-#if defined (__stub_$ac_func) || defined (__stub___$ac_func)\n-choke me\n-#else\n-char (*f) () = $ac_func;\n-#endif\n-#ifdef __cplusplus\n-}\n-#endif\n+#include <unistd.h>\n+#include <sys/mman.h>\n+#include <sys/stat.h>\n+#include <fcntl.h>\n \n int\n main ()\n {\n-return f != $ac_func;\n+    mmap((void *)0, 0, PROT_READ, 0, 0, 0);\n   ;\n   return 0;\n }\n@@ -16492,201 +16305,26 @@ if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n   ac_status=$?\n   echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n   (exit $ac_status); }; }; then\n-  eval \"$as_ac_var=yes\"\n+  ac_cv_func_mmap_ok=yes\n else\n   echo \"$as_me: failed program was:\" >&5\n sed 's/^/| /' conftest.$ac_ext >&5\n \n-eval \"$as_ac_var=no\"\n+ac_cv_func_mmap_ok=no\n fi\n rm -f conftest.err conftest.$ac_objext \\\n       conftest$ac_exeext conftest.$ac_ext\n fi\n-echo \"$as_me:$LINENO: result: `eval echo '${'$as_ac_var'}'`\" >&5\n-echo \"${ECHO_T}`eval echo '${'$as_ac_var'}'`\" >&6\n-if test `eval echo '${'$as_ac_var'}'` = yes; then\n-  cat >>confdefs.h <<_ACEOF\n-#define `echo \"HAVE_$ac_func\" | $as_tr_cpp` 1\n-_ACEOF\n-\n-fi\n-done\n-\n-echo \"$as_me:$LINENO: checking for working mmap\" >&5\n-echo $ECHO_N \"checking for working mmap... $ECHO_C\" >&6\n-if test \"${ac_cv_func_mmap_fixed_mapped+set}\" = set; then\n-  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n-else\n-  if test \"$cross_compiling\" = yes; then\n-  ac_cv_func_mmap_fixed_mapped=no\n-else\n-  cat >conftest.$ac_ext <<_ACEOF\n-/* confdefs.h.  */\n-_ACEOF\n-cat confdefs.h >>conftest.$ac_ext\n-cat >>conftest.$ac_ext <<_ACEOF\n-/* end confdefs.h.  */\n-$ac_includes_default\n-/* malloc might have been renamed as rpl_malloc. */\n-#undef malloc\n-\n-/* Thanks to Mike Haertel and Jim Avera for this test.\n-   Here is a matrix of mmap possibilities:\n-\tmmap private not fixed\n-\tmmap private fixed at somewhere currently unmapped\n-\tmmap private fixed at somewhere already mapped\n-\tmmap shared not fixed\n-\tmmap shared fixed at somewhere currently unmapped\n-\tmmap shared fixed at somewhere already mapped\n-   For private mappings, we should verify that changes cannot be read()\n-   back from the file, nor mmap's back from the file at a different\n-   address.  (There have been systems where private was not correctly\n-   implemented like the infamous i386 svr4.0, and systems where the\n-   VM page cache was not coherent with the file system buffer cache\n-   like early versions of FreeBSD and possibly contemporary NetBSD.)\n-   For shared mappings, we should conversely verify that changes get\n-   propagated back to all the places they're supposed to be.\n-\n-   Grep wants private fixed already mapped.\n-   The main things grep needs to know about mmap are:\n-   * does it exist and is it safe to write into the mmap'd area\n-   * how to use it (BSD variants)  */\n-\n-#include <fcntl.h>\n-#include <sys/mman.h>\n-\n-#if !STDC_HEADERS && !HAVE_STDLIB_H\n-char *malloc ();\n-#endif\n-\n-/* This mess was copied from the GNU getpagesize.h.  */\n-#if !HAVE_GETPAGESIZE\n-/* Assume that all systems that can run configure have sys/param.h.  */\n-# if !HAVE_SYS_PARAM_H\n-#  define HAVE_SYS_PARAM_H 1\n-# endif\n-\n-# ifdef _SC_PAGESIZE\n-#  define getpagesize() sysconf(_SC_PAGESIZE)\n-# else /* no _SC_PAGESIZE */\n-#  if HAVE_SYS_PARAM_H\n-#   include <sys/param.h>\n-#   ifdef EXEC_PAGESIZE\n-#    define getpagesize() EXEC_PAGESIZE\n-#   else /* no EXEC_PAGESIZE */\n-#    ifdef NBPG\n-#     define getpagesize() NBPG * CLSIZE\n-#     ifndef CLSIZE\n-#      define CLSIZE 1\n-#     endif /* no CLSIZE */\n-#    else /* no NBPG */\n-#     ifdef NBPC\n-#      define getpagesize() NBPC\n-#     else /* no NBPC */\n-#      ifdef PAGESIZE\n-#       define getpagesize() PAGESIZE\n-#      endif /* PAGESIZE */\n-#     endif /* no NBPC */\n-#    endif /* no NBPG */\n-#   endif /* no EXEC_PAGESIZE */\n-#  else /* no HAVE_SYS_PARAM_H */\n-#   define getpagesize() 8192\t/* punt totally */\n-#  endif /* no HAVE_SYS_PARAM_H */\n-# endif /* no _SC_PAGESIZE */\n-\n-#endif /* no HAVE_GETPAGESIZE */\n \n-int\n-main ()\n-{\n-  char *data, *data2, *data3;\n-  int i, pagesize;\n-  int fd;\n-\n-  pagesize = getpagesize ();\n-\n-  /* First, make a file with some known garbage in it. */\n-  data = (char *) malloc (pagesize);\n-  if (!data)\n-    exit (1);\n-  for (i = 0; i < pagesize; ++i)\n-    *(data + i) = rand ();\n-  umask (0);\n-  fd = creat (\"conftest.mmap\", 0600);\n-  if (fd < 0)\n-    exit (1);\n-  if (write (fd, data, pagesize) != pagesize)\n-    exit (1);\n-  close (fd);\n-\n-  /* Next, try to mmap the file at a fixed address which already has\n-     something else allocated at it.  If we can, also make sure that\n-     we see the same garbage.  */\n-  fd = open (\"conftest.mmap\", O_RDWR);\n-  if (fd < 0)\n-    exit (1);\n-  data2 = (char *) malloc (2 * pagesize);\n-  if (!data2)\n-    exit (1);\n-  data2 += (pagesize - ((long) data2 & (pagesize - 1))) & (pagesize - 1);\n-  if (data2 != mmap (data2, pagesize, PROT_READ | PROT_WRITE,\n-\t\t     MAP_PRIVATE | MAP_FIXED, fd, 0L))\n-    exit (1);\n-  for (i = 0; i < pagesize; ++i)\n-    if (*(data + i) != *(data2 + i))\n-      exit (1);\n-\n-  /* Finally, make sure that changes to the mapped area do not\n-     percolate back to the file as seen by read().  (This is a bug on\n-     some variants of i386 svr4.0.)  */\n-  for (i = 0; i < pagesize; ++i)\n-    *(data2 + i) = *(data2 + i) + 1;\n-  data3 = (char *) malloc (pagesize);\n-  if (!data3)\n-    exit (1);\n-  if (read (fd, data3, pagesize) != pagesize)\n-    exit (1);\n-  for (i = 0; i < pagesize; ++i)\n-    if (*(data + i) != *(data3 + i))\n-      exit (1);\n-  close (fd);\n-  exit (0);\n-}\n-_ACEOF\n-rm -f conftest$ac_exeext\n-if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n-  (eval $ac_link) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); } && { ac_try='./conftest$ac_exeext'\n-  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n-  (eval $ac_try) 2>&5\n-  ac_status=$?\n-  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n-  (exit $ac_status); }; }; then\n-  ac_cv_func_mmap_fixed_mapped=yes\n-else\n-  echo \"$as_me: program exited with status $ac_status\" >&5\n-echo \"$as_me: failed program was:\" >&5\n-sed 's/^/| /' conftest.$ac_ext >&5\n-\n-( exit $ac_status )\n-ac_cv_func_mmap_fixed_mapped=no\n-fi\n-rm -f core *.core gmon.out bb.out conftest$ac_exeext conftest.$ac_objext conftest.$ac_ext\n-fi\n-fi\n-echo \"$as_me:$LINENO: result: $ac_cv_func_mmap_fixed_mapped\" >&5\n-echo \"${ECHO_T}$ac_cv_func_mmap_fixed_mapped\" >&6\n-if test $ac_cv_func_mmap_fixed_mapped = yes; then\n+echo \"$as_me:$LINENO: result: $ac_cv_func_mmap_ok\" >&5\n+echo \"${ECHO_T}$ac_cv_func_mmap_ok\" >&6\n+if test $ac_cv_func_mmap_ok = yes\n+then\n \n cat >>confdefs.h <<\\_ACEOF\n #define HAVE_MMAP 1\n _ACEOF\n \n-fi\n-rm -f conftest.mmap\n-\n fi\n \n for ac_prog in perl"}, {"sha": "1077b8dd8fc91ab569489603cc4063b47301ed9a", "filename": "libjava/configure.ac", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fconfigure.ac?ref=6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "patch": "@@ -1346,7 +1346,31 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <time.h>]], [[struct tm tim; tim.t\n           [AC_MSG_RESULT(no)])])])\n \n AC_FUNC_ALLOCA\n-AC_FUNC_MMAP\n+\n+dnl Check for mmap()\n+# AC_FUNC_MMAP goes to far and checks for mmap fixed, we do only need mmap\n+# at a mmap selected address. See\n+# gnu/java/nio/channels/natFileChannelPosix.cc\n+\n+AC_MSG_CHECKING([for mmap])\n+AC_CACHE_VAL(ac_cv_func_mmap_ok,\n+    [AC_TRY_LINK(\n+    changequote(<<, >>)dnl\n+    <<\n+#include <unistd.h>\n+#include <sys/mman.h>\n+#include <sys/stat.h>\n+#include <fcntl.h>\n+    >>,\n+    changequote([, ])dnl\n+    [mmap((void *)0, 0, PROT_READ, 0, 0, 0);],\n+    ac_cv_func_mmap_ok=yes,\n+    ac_cv_func_mmap_ok=no)] )\n+AC_MSG_RESULT($ac_cv_func_mmap_ok)\n+if test $ac_cv_func_mmap_ok = yes\n+then\n+  AC_DEFINE(HAVE_MMAP, 1, [ Define to 1 if you have a working `mmap' system call w/o fixed address ability.])\n+fi\n \n AC_CHECK_PROGS(PERL, perl, false)\n "}, {"sha": "8dcd65832a6ff7fba2b8177a4c6068570dda2104", "filename": "libjava/include/config.h.in", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2Finclude%2Fconfig.h.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3/libjava%2Finclude%2Fconfig.h.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Finclude%2Fconfig.h.in?ref=6d0b58a9aa2992fc85bf10b310e9dd32af3c5cd3", "patch": "@@ -115,9 +115,6 @@\n /* Define if gethostname is declared in <unistd.h>. */\n #undef HAVE_GETHOSTNAME_DECL\n \n-/* Define to 1 if you have the `getpagesize' function. */\n-#undef HAVE_GETPAGESIZE\n-\n /* Define to 1 if you have the `getpwuid_r' function. */\n #undef HAVE_GETPWUID_R\n \n@@ -187,7 +184,8 @@\n /* Define is you have 'mktime' in <time.h> */\n #undef HAVE_MKTIME\n \n-/* Define to 1 if you have a working `mmap' system call. */\n+/* Define to 1 if you have a working `mmap' system call w/o fixed address\n+   ability. */\n #undef HAVE_MMAP\n \n /* Define to 1 if you have the <netdb.h> header file. */"}]}