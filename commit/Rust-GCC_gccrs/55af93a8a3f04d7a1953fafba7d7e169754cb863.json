{"sha": "55af93a8a3f04d7a1953fafba7d7e169754cb863", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTVhZjkzYThhM2YwNGQ3YTE5NTNmYWZiYTdkN2UxNjk3NTRjYjg2Mw==", "commit": {"author": {"name": "Danny Smith", "email": "dannysmith@users.sourceforge.net", "date": "2006-08-15T21:46:30Z"}, "committer": {"name": "Danny Smith", "email": "dannysmith@gcc.gnu.org", "date": "2006-08-15T21:46:30Z"}, "message": "re PR c/28287 (ICE with misplaced attribute weak)\n\ngcc\n\tPR c/28287\n\t* c-common.c (handle_weak_attribute): Ignore and warn if\n\tnot a FUNCTION_ or VAR_DECL\n\ntestsuite\n\n\t* gcc.dg/attr-invalid.c: Add tests for invalid weak attribute.\n\nFrom-SVN: r116170", "tree": {"sha": "211877abcbf327a83cb6b5734399fa9e50c8c349", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/211877abcbf327a83cb6b5734399fa9e50c8c349"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/55af93a8a3f04d7a1953fafba7d7e169754cb863", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55af93a8a3f04d7a1953fafba7d7e169754cb863", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55af93a8a3f04d7a1953fafba7d7e169754cb863", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55af93a8a3f04d7a1953fafba7d7e169754cb863/comments", "author": null, "committer": null, "parents": [{"sha": "c1782c0e69d219d3ccceeca553a3d1d90622d1af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1782c0e69d219d3ccceeca553a3d1d90622d1af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1782c0e69d219d3ccceeca553a3d1d90622d1af"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "0658f36c4e076d9aedac834b29b8a56c42809fc4", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=55af93a8a3f04d7a1953fafba7d7e169754cb863", "patch": "@@ -1,3 +1,9 @@\n+2006-08-15  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR c/28287\n+\t* c-common.c (handle_weak_attribute): Ignore and warn if\n+\tnot a FUNCTION_ or VAR_DECL.\n+\n 2006-07-15  Mike Stump  <mrs@apple.com>\n \n \tPR c/28280"}, {"sha": "167d04b81ff09f08c1a4f2f6942892dde3c0c804", "filename": "gcc/c-common.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=55af93a8a3f04d7a1953fafba7d7e169754cb863", "patch": "@@ -4737,12 +4737,17 @@ handle_aligned_attribute (tree *node, tree ARG_UNUSED (name), tree args,\n    struct attribute_spec.handler.  */\n \n static tree\n-handle_weak_attribute (tree *node, tree ARG_UNUSED (name),\n+handle_weak_attribute (tree *node, tree name,\n \t\t       tree ARG_UNUSED (args),\n \t\t       int ARG_UNUSED (flags),\n \t\t       bool * ARG_UNUSED (no_add_attrs))\n {\n-  declare_weak (*node);\n+  if (TREE_CODE (*node) == FUNCTION_DECL\n+      || TREE_CODE (*node) == VAR_DECL)\n+    declare_weak (*node);\n+  else\n+    warning (OPT_Wattributes, \"%qE attribute ignored\", name);\n+    \t\n \n   return NULL_TREE;\n }"}, {"sha": "acf6d703fd1908880c15624b4d718702679f3746", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=55af93a8a3f04d7a1953fafba7d7e169754cb863", "patch": "@@ -1,3 +1,8 @@\n+2006-08-15  Danny Smith  <dannysmith@users.sourceforge.net>\n+\n+\tPR c/28287\n+\t* gcc.dg/attr-invalid.c: Add tests for invalid weak attribute.\n+\n 2006-08-15  Lee Millward  <lee.millward@codesourcery.com>\n \n \tPR c++/28594"}, {"sha": "c6c437d0bbfa5dc57143d6fbb8902595e1840a69", "filename": "gcc/testsuite/gcc.dg/attr-invalid.c", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/55af93a8a3f04d7a1953fafba7d7e169754cb863/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-invalid.c?ref=55af93a8a3f04d7a1953fafba7d7e169754cb863", "patch": "@@ -56,3 +56,24 @@ int ATSYM(fn_vars) (void) {\n   auto int lvar ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n   return 0;\n }\n+\n+\n+/* PR 28287 */\n+/* These are invalid on all targets.  Applying to PARM_ or FIELD_DECL\n+   also caused a tree checking ice on targets that support weak,  */\n+#undef AT\n+#define AT weak\n+\n+typedef int ATSYM(type) ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+\n+typedef int (*ATSYM(fntype))(void) ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+\n+struct ATSYM(struct) {\n+  char dummy ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+};\n+\n+int ATSYM(fn_knrarg) (arg)\n+  int arg ATTR; /* { dg-warning \"attribute ignored\" \"\" } */\n+{ return 0; }\n+\n+int ATSYM(fn_isoarg) (int arg ATTR) { return 0; } /* { dg-warning \"attribute ignored\" \"\" } */"}]}