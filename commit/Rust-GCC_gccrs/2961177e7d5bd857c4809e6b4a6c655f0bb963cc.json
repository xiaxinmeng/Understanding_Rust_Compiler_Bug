{"sha": "2961177e7d5bd857c4809e6b4a6c655f0bb963cc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjk2MTE3N2U3ZDViZDg1N2M0ODA5ZTZiNGE2YzY1NWYwYmI5NjNjYw==", "commit": {"author": {"name": "James Greenhalgh", "email": "james.greenhalgh@arm.com", "date": "2014-05-16T08:56:54Z"}, "committer": {"name": "James Greenhalgh", "email": "jgreenhalgh@gcc.gnu.org", "date": "2014-05-16T08:56:54Z"}, "message": "[AArch64 costs 8/18] Cost memory accesses using address costs \n\ngcc/\n\n\t* config/aarch64/aarch64.c (aarch64_rtx_costs): Use address\n\tcosts when costing loads and stores to memory.\n\n\nCo-Authored-By: Philipp Tomsich <philipp.tomsich@theobroma-systems.com>\n\nFrom-SVN: r210500", "tree": {"sha": "1e78ce2db307a4e018f7af7a154bf513a141d29b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1e78ce2db307a4e018f7af7a154bf513a141d29b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2961177e7d5bd857c4809e6b4a6c655f0bb963cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2961177e7d5bd857c4809e6b4a6c655f0bb963cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2961177e7d5bd857c4809e6b4a6c655f0bb963cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2961177e7d5bd857c4809e6b4a6c655f0bb963cc/comments", "author": {"login": "jgreenhalgh-arm", "id": 6104025, "node_id": "MDQ6VXNlcjYxMDQwMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6104025?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jgreenhalgh-arm", "html_url": "https://github.com/jgreenhalgh-arm", "followers_url": "https://api.github.com/users/jgreenhalgh-arm/followers", "following_url": "https://api.github.com/users/jgreenhalgh-arm/following{/other_user}", "gists_url": "https://api.github.com/users/jgreenhalgh-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jgreenhalgh-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jgreenhalgh-arm/subscriptions", "organizations_url": "https://api.github.com/users/jgreenhalgh-arm/orgs", "repos_url": "https://api.github.com/users/jgreenhalgh-arm/repos", "events_url": "https://api.github.com/users/jgreenhalgh-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/jgreenhalgh-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ba123b0de58bd9c7dbc2b745a82e7f28c6123af9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba123b0de58bd9c7dbc2b745a82e7f28c6123af9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba123b0de58bd9c7dbc2b745a82e7f28c6123af9"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "a084ca98aecbbc3e4777c745a089c87bf846ec5a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2961177e7d5bd857c4809e6b4a6c655f0bb963cc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2961177e7d5bd857c4809e6b4a6c655f0bb963cc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2961177e7d5bd857c4809e6b4a6c655f0bb963cc", "patch": "@@ -1,3 +1,9 @@\n+2014-05-16  James Greenhalgh  <james.greenhalgh@arm.com>\n+\t    Philipp Tomsich  <philipp.tomsich@theobroma-systems.com>\n+\n+\t* config/aarch64/aarch64.c (aarch64_rtx_costs): Use address\n+\tcosts when costing loads and stores to memory.\n+\n 2014-05-16  James Greenhalgh  <james.greenhalgh@arm.com>\n \t    Philip Tomsich  <philipp.tomsich@theobroma-systems.com>\n "}, {"sha": "d0a5e49eb9010671ccb225f04836805f13133718", "filename": "gcc/config/aarch64/aarch64.c", "status": "modified", "additions": 30, "deletions": 2, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2961177e7d5bd857c4809e6b4a6c655f0bb963cc/gcc%2Fconfig%2Faarch64%2Faarch64.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2961177e7d5bd857c4809e6b4a6c655f0bb963cc/gcc%2Fconfig%2Faarch64%2Faarch64.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64.c?ref=2961177e7d5bd857c4809e6b4a6c655f0bb963cc", "patch": "@@ -142,6 +142,7 @@ static bool aarch64_const_vec_all_same_int_p (rtx,\n \n static bool aarch64_vectorize_vec_perm_const_ok (enum machine_mode vmode,\n \t\t\t\t\t\t const unsigned char *sel);\n+static int aarch64_address_cost (rtx, enum machine_mode, addr_space_t, bool);\n \n /* The processor for which instructions should be scheduled.  */\n enum aarch64_processor aarch64_tune = cortexa53;\n@@ -4870,7 +4871,19 @@ aarch64_rtx_costs (rtx x, int code, int outer ATTRIBUTE_UNUSED,\n \t{\n \tcase MEM:\n \t  if (speed)\n-\t    *cost += extra_cost->ldst.store;\n+\t    {\n+\t      rtx address = XEXP (op0, 0);\n+\t      if (GET_MODE_CLASS (mode) == MODE_INT)\n+\t\t*cost += extra_cost->ldst.store;\n+\t      else if (mode == SFmode)\n+\t\t*cost += extra_cost->ldst.storef;\n+\t      else if (mode == DFmode)\n+\t\t*cost += extra_cost->ldst.stored;\n+\n+\t      *cost +=\n+\t\tCOSTS_N_INSNS (aarch64_address_cost (address, mode,\n+\t\t\t\t\t\t     0, speed));\n+\t    }\n \n \t  *cost += rtx_cost (op1, SET, 1, speed);\n \t  return true;\n@@ -4983,7 +4996,22 @@ aarch64_rtx_costs (rtx x, int code, int outer ATTRIBUTE_UNUSED,\n \n     case MEM:\n       if (speed)\n-\t*cost += extra_cost->ldst.load;\n+\t{\n+\t  /* For loads we want the base cost of a load, plus an\n+\t     approximation for the additional cost of the addressing\n+\t     mode.  */\n+\t  rtx address = XEXP (x, 0);\n+\t  if (GET_MODE_CLASS (mode) == MODE_INT)\n+\t    *cost += extra_cost->ldst.load;\n+\t  else if (mode == SFmode)\n+\t    *cost += extra_cost->ldst.loadf;\n+\t  else if (mode == DFmode)\n+\t    *cost += extra_cost->ldst.loadd;\n+\n+\t  *cost +=\n+\t\tCOSTS_N_INSNS (aarch64_address_cost (address, mode,\n+\t\t\t\t\t\t     0, speed));\n+\t}\n \n       return true;\n "}]}