{"sha": "88312d26a5b32bf7ae7d593d8c12517623106c6f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODgzMTJkMjZhNWIzMmJmN2FlN2Q1OTNkOGMxMjUxNzYyMzEwNmM2Zg==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@cs.umass.edu", "date": "2005-02-21T19:47:40Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2005-02-21T19:47:40Z"}, "message": "flow.c (delete_dead_jumptables): Speed up by scanning insns that do not belong to any basic block.\n\n\t* flow.c (delete_dead_jumptables): Speed up by scanning insns\n\tthat do not belong to any basic block.\n\nFrom-SVN: r95342", "tree": {"sha": "5527b039f988d6e0b9585b5f8a80477d6ee437bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5527b039f988d6e0b9585b5f8a80477d6ee437bc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88312d26a5b32bf7ae7d593d8c12517623106c6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88312d26a5b32bf7ae7d593d8c12517623106c6f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88312d26a5b32bf7ae7d593d8c12517623106c6f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88312d26a5b32bf7ae7d593d8c12517623106c6f/comments", "author": null, "committer": null, "parents": [{"sha": "fca01525bf39af39d545094e75cb72276f46013c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fca01525bf39af39d545094e75cb72276f46013c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fca01525bf39af39d545094e75cb72276f46013c"}], "stats": {"total": 43, "additions": 30, "deletions": 13}, "files": [{"sha": "fea868a638e6c98073b3e7880a68d3caa98e8f5c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88312d26a5b32bf7ae7d593d8c12517623106c6f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88312d26a5b32bf7ae7d593d8c12517623106c6f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=88312d26a5b32bf7ae7d593d8c12517623106c6f", "patch": "@@ -7,6 +7,9 @@\n \tand 1.\n \t(find_taken_edge_switch_expr): Remove a check for INTEGER_CST.\n \n+\t* flow.c (delete_dead_jumptables): Speed up by scanning insns\n+\tthat do not belong to any basic block.\n+\n 2005-02-21  Jeff Law  <law@redhat.com>\n \n \t* cfganal.c (find_unreachable_blocks): Manually CSE load of"}, {"sha": "d3850cc9618f5f3954d45bdc472bf60ab670f4e0", "filename": "gcc/flow.c", "status": "modified", "additions": 27, "deletions": 13, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88312d26a5b32bf7ae7d593d8c12517623106c6f/gcc%2Fflow.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88312d26a5b32bf7ae7d593d8c12517623106c6f/gcc%2Fflow.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fflow.c?ref=88312d26a5b32bf7ae7d593d8c12517623106c6f", "patch": "@@ -817,21 +817,35 @@ delete_noop_moves (void)\n void\n delete_dead_jumptables (void)\n {\n-  rtx insn, next;\n-  for (insn = get_insns (); insn; insn = next)\n+  basic_block bb;\n+\n+  /* A dead jump table does not belong to any basic block.  Scan insns\n+     between two adjacent basic blocks.  */\n+  FOR_EACH_BB (bb)\n     {\n-      next = NEXT_INSN (insn);\n-      if (LABEL_P (insn)\n-\t  && LABEL_NUSES (insn) == LABEL_PRESERVE_P (insn)\n-\t  && JUMP_P (next)\n-\t  && (GET_CODE (PATTERN (next)) == ADDR_VEC\n-\t      || GET_CODE (PATTERN (next)) == ADDR_DIFF_VEC))\n+      rtx insn, next;\n+\n+      for (insn = NEXT_INSN (BB_END (bb));\n+\t   insn && !NOTE_INSN_BASIC_BLOCK_P (insn);\n+\t   insn = next)\n \t{\n-\t  if (dump_file)\n-\t    fprintf (dump_file, \"Dead jumptable %i removed\\n\", INSN_UID (insn));\n-\t  delete_insn (NEXT_INSN (insn));\n-\t  delete_insn (insn);\n-\t  next = NEXT_INSN (next);\n+\t  next = NEXT_INSN (insn);\n+\t  if (LABEL_P (insn)\n+\t      && LABEL_NUSES (insn) == LABEL_PRESERVE_P (insn)\n+\t      && JUMP_P (next)\n+\t      && (GET_CODE (PATTERN (next)) == ADDR_VEC\n+\t\t  || GET_CODE (PATTERN (next)) == ADDR_DIFF_VEC))\n+\t    {\n+\t      rtx label = insn, jump = next;\n+\n+\t      if (dump_file)\n+\t\tfprintf (dump_file, \"Dead jumptable %i removed\\n\",\n+\t\t\t INSN_UID (insn));\n+\n+\t      next = NEXT_INSN (next);\n+\t      delete_insn (jump);\n+\t      delete_insn (label);\n+\t    }\n \t}\n     }\n }"}]}