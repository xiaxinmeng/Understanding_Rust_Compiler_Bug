{"sha": "7ab282a5a0880dea9e75e04113676d7e4139d4b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2FiMjgyYTVhMDg4MGRlYTllNzVlMDQxMTM2NzZkN2U0MTM5ZDRiOQ==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@cygnus.com", "date": "1999-10-28T17:14:59Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1999-10-28T17:14:59Z"}, "message": "Fix i960 varargs/stdarg build failures.\n\n\t* config/i960/i960.c (i960_va_start): New locals base, num.\n\tUse INDIRECT_REF instead of ARRAY_REF on valist.\n\t(i960_va_arg): Use INDIRECT_REF instead of ARRAY_REF on valist.\n\nFrom-SVN: r30244", "tree": {"sha": "ab48848df5dedb554799fafb1b6a1a176065e424", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ab48848df5dedb554799fafb1b6a1a176065e424"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7ab282a5a0880dea9e75e04113676d7e4139d4b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ab282a5a0880dea9e75e04113676d7e4139d4b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7ab282a5a0880dea9e75e04113676d7e4139d4b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7ab282a5a0880dea9e75e04113676d7e4139d4b9/comments", "author": null, "committer": null, "parents": [{"sha": "9ed5879d10ca2f21840431c9ba32eed1813d29d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ed5879d10ca2f21840431c9ba32eed1813d29d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ed5879d10ca2f21840431c9ba32eed1813d29d5"}], "stats": {"total": 29, "additions": 22, "deletions": 7}, "files": [{"sha": "d4f2b4eece1c94ecf3cdb1c8371880ac9de76360", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ab282a5a0880dea9e75e04113676d7e4139d4b9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ab282a5a0880dea9e75e04113676d7e4139d4b9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7ab282a5a0880dea9e75e04113676d7e4139d4b9", "patch": "@@ -1,3 +1,9 @@\n+Thu Oct 28 10:02:00 1999  Jim Wilson  <wilson@cygnus.com>\n+\n+\t* config/i960/i960.c (i960_va_start): New locals base, num.\n+\tUse INDIRECT_REF instead of ARRAY_REF on valist.\n+\t(i960_va_arg): Use INDIRECT_REF instead of ARRAY_REF on valist.\n+\n Thu Oct 28 09:45:48 1999  Mark Mitchell  <mark@codesourcery.com>\n \n \t* gcse.c (delete_null_pointer_checks): Fix typo in previous change."}, {"sha": "2dd17aebb57ebed36f24005addf7feed36489b56", "filename": "gcc/config/i960/i960.c", "status": "modified", "additions": 16, "deletions": 7, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7ab282a5a0880dea9e75e04113676d7e4139d4b9/gcc%2Fconfig%2Fi960%2Fi960.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7ab282a5a0880dea9e75e04113676d7e4139d4b9/gcc%2Fconfig%2Fi960%2Fi960.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi960%2Fi960.c?ref=7ab282a5a0880dea9e75e04113676d7e4139d4b9", "patch": "@@ -2652,18 +2652,23 @@ i960_va_start (stdarg_p, valist, nextarg)\n      tree valist;\n      rtx nextarg ATTRIBUTE_UNUSED;\n {\n-  tree d, s, t;\n+  tree s, t, base, num;\n+\n+  /* The array type always decays to a pointer before we get here, so we\n+     can't use ARRAY_REF.  */\n+  base = build1 (INDIRECT_REF, unsigned_type_node, valist);\n+  num = build1 (INDIRECT_REF, unsigned_type_node,\n+\t\tbuild (PLUS_EXPR, unsigned_type_node, valist,\n+\t\t       TYPE_SIZE_UNIT (TREE_TYPE (valist))));\n \n   s = make_tree (unsigned_type_node, arg_pointer_rtx);\n-  d = build (ARRAY_REF, unsigned_type_node, valist, size_zero_node);\n-  t = build (MODIFY_EXPR, unsigned_type_node, d, s);\n+  t = build (MODIFY_EXPR, unsigned_type_node, base, s);\n   TREE_SIDE_EFFECTS (t) = 1;\n   expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);\n \n   s = build_int_2 ((current_function_args_info.ca_nregparms\n \t\t    + current_function_args_info.ca_nstackparms) * 4, 0);\n-  d = build (ARRAY_REF, unsigned_type_node, valist, size_one_node);\n-  t = build (MODIFY_EXPR, unsigned_type_node, d, s);\n+  t = build (MODIFY_EXPR, unsigned_type_node, num, s);\n   TREE_SIDE_EFFECTS (t) = 1;\n   expand_expr (t, const0_rtx, VOIDmode, EXPAND_NORMAL);\n }\n@@ -2678,8 +2683,12 @@ i960_va_arg (valist, type)\n   tree base, num, pad, next, this, t1, t2, int48;\n   rtx addr_rtx;\n \n-  base = build (ARRAY_REF, unsigned_type_node, valist, size_zero_node);\n-  num = build (ARRAY_REF, unsigned_type_node, valist, size_one_node);\n+  /* The array type always decays to a pointer before we get here, so we\n+     can't use ARRAY_REF.  */\n+  base = build1 (INDIRECT_REF, unsigned_type_node, valist);\n+  num = build1 (INDIRECT_REF, unsigned_type_node,\n+\t\tbuild (PLUS_EXPR, unsigned_type_node, valist,\n+\t\t       TYPE_SIZE_UNIT (TREE_TYPE (valist))));\n \n   /* Round up sizeof(type) to a word.  */\n   siz = (int_size_in_bytes (type) + UNITS_PER_WORD - 1) & -UNITS_PER_WORD;"}]}