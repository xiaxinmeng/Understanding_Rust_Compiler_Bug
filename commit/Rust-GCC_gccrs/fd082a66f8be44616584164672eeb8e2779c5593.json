{"sha": "fd082a66f8be44616584164672eeb8e2779c5593", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmQwODJhNjZmOGJlNDQ2MTY1ODQxNjQ2NzJlZWI4ZTI3NzljNTU5Mw==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2018-06-25T10:39:54Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2018-06-25T10:39:54Z"}, "message": "[i386/debug] Fix insn prefix in tls_global_dynamic_64_<mode>\n\n2018-06-25  Tom de Vries  <tdevries@suse.de>\n\n\tPR debug/86257\n\t* config/i386/i386.md (define_insn \"*tls_global_dynamic_64_<mode>\"):\n\tUse data16 instead of .byte for insn prefix.\n\n\t* gcc.target/i386/pr86257.c: New test.\n\nFrom-SVN: r262006", "tree": {"sha": "474544b6d19cbf3fa6778dbbe00741b0d9c0572f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/474544b6d19cbf3fa6778dbbe00741b0d9c0572f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fd082a66f8be44616584164672eeb8e2779c5593", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd082a66f8be44616584164672eeb8e2779c5593", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fd082a66f8be44616584164672eeb8e2779c5593", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fd082a66f8be44616584164672eeb8e2779c5593/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4f1c88ae5892fad3d0cf248c6da5ffb51a61c9aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f1c88ae5892fad3d0cf248c6da5ffb51a61c9aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f1c88ae5892fad3d0cf248c6da5ffb51a61c9aa"}], "stats": {"total": 38, "additions": 37, "deletions": 1}, "files": [{"sha": "f4df7442de43aafd7ccab88258fea31cf76fe260", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fd082a66f8be44616584164672eeb8e2779c5593", "patch": "@@ -1,3 +1,9 @@\n+2018-06-25  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR debug/86257\n+\t* config/i386/i386.md (define_insn \"*tls_global_dynamic_64_<mode>\"):\n+\tUse data16 instead of .byte for insn prefix.\n+\n 2018-06-25  Andreas Krebbel  <krebbel@linux.ibm.com>\n \n \tPR C++/86082"}, {"sha": "6f2300057aa9f5387076a26189bd7baedf498a80", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=fd082a66f8be44616584164672eeb8e2779c5593", "patch": "@@ -14733,7 +14733,18 @@\n   \"TARGET_64BIT\"\n {\n   if (!TARGET_X32)\n-    fputs (ASM_BYTE \"0x66\\n\", asm_out_file);\n+    /* The .loc directive has effect for 'the immediately following assembly\n+       instruction'.  So for a sequence:\n+         .loc f l\n+         .byte x\n+         insn1\n+       the 'immediately following assembly instruction' is insn1.\n+       We want to emit an insn prefix here, but if we use .byte (as shown in\n+       'ELF Handling For Thread-Local Storage'), a preceding .loc will point\n+       inside the insn sequence, rather than to the start.  After relaxation\n+       of the sequence by the linker, the .loc might point inside an insn.\n+       Use data16 prefix instead, which doesn't have this problem.  */\n+    fputs (\"\\tdata16\", asm_out_file);\n   output_asm_insn\n     (\"lea{q}\\t{%E1@tlsgd(%%rip), %%rdi|rdi, %E1@tlsgd[rip]}\", operands);\n   if (TARGET_SUN_TLS || flag_plt || !HAVE_AS_IX86_TLS_GET_ADDR_GOT)"}, {"sha": "e8ab480febf48d6e87c818c2484006e7901a5e99", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fd082a66f8be44616584164672eeb8e2779c5593", "patch": "@@ -1,3 +1,8 @@\n+2018-06-25  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR debug/86257\n+\t* gcc.target/i386/pr86257.c: New test.\n+\n 2018-06-25  Andreas Krebbel  <krebbel@linux.ibm.com>\n \n \tPR C++/86082"}, {"sha": "3287c190d3682096065d9d266c8a45e7c2571153", "filename": "gcc/testsuite/gcc.target/i386/pr86257.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr86257.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fd082a66f8be44616584164672eeb8e2779c5593/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr86257.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr86257.c?ref=fd082a66f8be44616584164672eeb8e2779c5593", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-require-effective-target fpic } */\n+/* { dg-require-effective-target tls } */\n+/* { dg-options \"-g -fPIC\" } */\n+\n+__thread int i;\n+\n+void\n+foo(void)\n+{\n+  i = 0;\n+}\n+\n+/* { dg-final { scan-assembler \"data16\\[ \\t\\]*leaq\" } } */\n+/* { dg-final { scan-assembler-not \"\\.byte\\[ \\t\\]*0x66\\n\\[ \\t\\]*leaq\" } } */"}]}