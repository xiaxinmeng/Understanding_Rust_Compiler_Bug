{"sha": "10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTBhZTdjN2I3OGJlZWQ0YTVkOTI0ZWM4OTM3MWVjYjBiMGE5YTM2Nw==", "commit": {"author": {"name": "Daniel Jacobowitz", "email": "dan@codesourcery.com", "date": "2007-07-01T21:15:14Z"}, "committer": {"name": "Daniel Jacobowitz", "email": "drow@gcc.gnu.org", "date": "2007-07-01T21:15:14Z"}, "message": "arm.c (arm_cannot_copy_insn_p): Do not expect a PARALLEL.\n\n\t* config/arm/arm.c (arm_cannot_copy_insn_p): Do not expect a\n\tPARALLEL.\n\t* config/arm/arm.md (pic_add_dot_plus_four, pic_add_dot_plus_eight)\n\t(tls_load_dot_plus_eight): Move the label number into the unspec.\n\t* config/arm/thumb2.md (pic_load_dot_plus_four): Likewise.\n\n\t* gcc.dg/tls/opt-14.c: New.\n\nFrom-SVN: r126178", "tree": {"sha": "69a4c8dfbaa4c8ec2fe6ddfd5115e39d98bc15f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/69a4c8dfbaa4c8ec2fe6ddfd5115e39d98bc15f1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/comments", "author": null, "committer": null, "parents": [{"sha": "af92ab368ad709fcd26b360dc1cf4e50b0cd6185", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af92ab368ad709fcd26b360dc1cf4e50b0cd6185", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af92ab368ad709fcd26b360dc1cf4e50b0cd6185"}], "stats": {"total": 69, "additions": 54, "deletions": 15}, "files": [{"sha": "295dc728021ddd686622515e1621e22a37b76a12", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "patch": "@@ -1,3 +1,11 @@\n+2007-07-01  Daniel Jacobowitz  <dan@codesourcery.com>\n+\n+\t* config/arm/arm.c (arm_cannot_copy_insn_p): Do not expect a\n+\tPARALLEL.\n+\t* config/arm/arm.md (pic_add_dot_plus_four, pic_add_dot_plus_eight)\n+\t(tls_load_dot_plus_eight): Move the label number into the unspec.\n+\t* config/arm/thumb2.md (pic_load_dot_plus_four): Likewise.\n+\n 2007-07-01  Andreas Schwab  <schwab@suse.de>\n \n \t* dwarf2out.c (initial_return_save): Define only if used."}, {"sha": "df08c467b1611aef785fe39ebd46bf1202623914", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "patch": "@@ -6058,10 +6058,9 @@ arm_cannot_copy_insn_p (rtx insn)\n {\n   rtx pat = PATTERN (insn);\n \n-  if (GET_CODE (pat) == PARALLEL\n-      && GET_CODE (XVECEXP (pat, 0, 0)) == SET)\n+  if (GET_CODE (pat) == SET)\n     {\n-      rtx rhs = SET_SRC (XVECEXP (pat, 0, 0));\n+      rtx rhs = SET_SRC (pat);\n \n       if (GET_CODE (rhs) == UNSPEC\n \t  && XINT (rhs, 1) == UNSPEC_PIC_BASE)"}, {"sha": "fca66d821f239849791df5f9ef95fc850bc478c7", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "patch": "@@ -4859,9 +4859,9 @@\n (define_insn \"pic_add_dot_plus_four\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t(unspec:SI [(plus:SI (match_operand:SI 1 \"register_operand\" \"0\")\n-\t\t\t     (const (plus:SI (pc) (const_int 4))))]\n-\t\t   UNSPEC_PIC_BASE))\n-   (use (match_operand 2 \"\" \"\"))]\n+\t\t\t     (const (plus:SI (pc) (const_int 4))))\n+\t\t    (match_operand 2 \"\" \"\")]\n+\t\t   UNSPEC_PIC_BASE))]\n   \"TARGET_THUMB1\"\n   \"*\n   (*targetm.asm_out.internal_label) (asm_out_file, \\\"LPIC\\\",\n@@ -4874,9 +4874,9 @@\n (define_insn \"pic_add_dot_plus_eight\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n \t(unspec:SI [(plus:SI (match_operand:SI 1 \"register_operand\" \"r\")\n-\t\t\t     (const (plus:SI (pc) (const_int 8))))]\n-\t\t   UNSPEC_PIC_BASE))\n-   (use (match_operand 2 \"\" \"\"))]\n+\t\t\t     (const (plus:SI (pc) (const_int 8))))\n+\t\t    (match_operand 2 \"\" \"\")]\n+\t\t   UNSPEC_PIC_BASE))]\n   \"TARGET_ARM\"\n   \"*\n     (*targetm.asm_out.internal_label) (asm_out_file, \\\"LPIC\\\",\n@@ -4889,9 +4889,9 @@\n (define_insn \"tls_load_dot_plus_eight\"\n   [(set (match_operand:SI 0 \"register_operand\" \"+r\")\n \t(mem:SI (unspec:SI [(plus:SI (match_operand:SI 1 \"register_operand\" \"r\")\n-\t\t\t\t     (const (plus:SI (pc) (const_int 8))))]\n-\t\t\t   UNSPEC_PIC_BASE)))\n-   (use (match_operand 2 \"\" \"\"))]\n+\t\t\t\t     (const (plus:SI (pc) (const_int 8))))\n+\t\t\t    (match_operand 2 \"\" \"\")]\n+\t\t\t   UNSPEC_PIC_BASE)))]\n   \"TARGET_ARM\"\n   \"*\n     (*targetm.asm_out.internal_label) (asm_out_file, \\\"LPIC\\\","}, {"sha": "fe2f8749a9d4c352f659e7ea34a7db5f639048bc", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "patch": "@@ -259,9 +259,9 @@\n ;; word aligned.\n (define_insn \"pic_load_dot_plus_four\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n-\t(unspec:SI [(const (plus:SI (pc) (const_int 4)))]\n-\t\t   UNSPEC_PIC_BASE))\n-   (use (match_operand 1 \"\" \"\"))]\n+\t(unspec:SI [(const (plus:SI (pc) (const_int 4)))\n+\t\t    (use (match_operand 1 \"\" \"\"))]\n+\t\t   UNSPEC_PIC_BASE))]\n   \"TARGET_THUMB2\"\n   \"*\n   assemble_align(BITS_PER_WORD);"}, {"sha": "6c58ee5cbf416411eff8095281432396b67c9680", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "patch": "@@ -1,3 +1,7 @@\n+2007-07-01  Daniel Jacobowitz  <dan@codesourcery.com>\n+\n+\t* gcc.dg/tls/opt-14.c: New.\n+\n 2007-07-01  Ollie Wild  <aaw@google.com>\n \n \t* g++.dg/lookup/using16.C: New test."}, {"sha": "5abeacea7d31e9e67a66be9ee870d22ff4244489", "filename": "gcc/testsuite/gcc.dg/tls/opt-14.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-14.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10ae7c7b78beed4a5d924ec89371ecb0b0a9a367/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-14.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftls%2Fopt-14.c?ref=10ae7c7b78beed4a5d924ec89371ecb0b0a9a367", "patch": "@@ -0,0 +1,28 @@\n+/* This testcase generated invalid assembly on ARM Thumb-2.  Two\n+   PIC additions of pc were combined, but the deleted label was still\n+   used.  */\n+/* { dg-do assemble } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-require-effective-target tls } */\n+\n+struct __res_state\n+{\n+  int options;\n+};\n+extern __thread struct __res_state *__resp\n+  __attribute__ ((tls_model (\"initial-exec\")));\n+\n+void foo (void);\n+\n+int main(void)\n+{\n+  int count, total = 0;\n+\n+  for (count = 0; count < 10; count++)\n+    {\n+      if (((*__resp).options & 0x00000001) == 0)\n+\tfoo ();\n+      (*__resp).options &= ~((0x00000002 | 0x00000200 | 0x00000080));\n+    }\n+  return 0;\n+}"}]}