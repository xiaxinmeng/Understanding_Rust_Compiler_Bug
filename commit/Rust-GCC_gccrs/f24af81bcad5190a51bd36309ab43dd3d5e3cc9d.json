{"sha": "f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjI0YWY4MWJjYWQ1MTkwYTUxYmQzNjMwOWFiNDNkZDNkNWUzY2M5ZA==", "commit": {"author": {"name": "Teemu Torma", "email": "tot@trema.com", "date": "1997-12-24T23:56:08Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "1997-12-24T23:56:08Z"}, "message": "Makefile.in (GTHREAD_FLAGS): New var.\n\n\t* Makefile.in (GTHREAD_FLAGS): New var.\n\t(LIBGCC2_CFLAGS): Added $(GTHREAD_FLAGS).\n\t(distclean): Remove gthr-default.h.\n\t* configure.in: Accept dce as a thread package.\n\tCheck for thread.h and pthread.h.\n\tLink gthr-default.h to appropriate thread file and set\n\tgthread_flags.\n\t(hppa1.1-*-hpux10*): If --enable-threads, use dce threads and\n\tinclude multilib definitions from pa/t-dce-thr.\n\t(sparc-*-solaris2*): Enable threads by default, if thread.h or\n\tpthread.h is found, preferring posix threads over solaris ones.\n\t* config/pa/t-dce-thr: New file.\n\t* config/pa/t-pa: Removed multilibs.\n\t* config/sparc/t-sol2: Ditto.\n\t* gthr.h: New file.\n\t* gthr-single.h: New file.\n\t* gthr-posix.h: New file.\n\t* gthr-solaris.h: New file.\n\t* gthr-dce.h: New file.\n\t* libgcc-thr.h: Removed.\n\t* objc/thr-dce.c: New file copied from thr-decosf1.c.\n\t* frame.c: Include gthr.h instead of libgcc-thr.h.\n\t* libgcc2.c: Include gthr.h instead of libgcc-thr.h.\n\t(eh_context_initialize): If __gthread_once fails, use static eh\n\tcontext.\n\t(eh_context_free): Call __gthread_key_dtor.\n\nFrom-SVN: r17235", "tree": {"sha": "2e6cf425a80122eaea96bbebc87b797b0242c6da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2e6cf425a80122eaea96bbebc87b797b0242c6da"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/comments", "author": null, "committer": null, "parents": [{"sha": "df3b6ab30ea4e3310b79eadb2c41fb6243d3b4aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df3b6ab30ea4e3310b79eadb2c41fb6243d3b4aa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df3b6ab30ea4e3310b79eadb2c41fb6243d3b4aa"}], "stats": {"total": 1699, "additions": 1228, "deletions": 471}, "files": [{"sha": "61084d69a5cf268e157a92516719999fa35741a8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -1,3 +1,36 @@\n+1997-12-25  Teemu Torma  <tot@trema.com>\n+\n+\t* Makefile.in (GTHREAD_FLAGS): New var.\n+\t(LIBGCC2_CFLAGS): Added $(GTHREAD_FLAGS).\n+\t(distclean): Remove gthr-default.h.\n+\n+\t* configure.in: Accept dce as a thread package.\n+\tCheck for thread.h and pthread.h.\n+\tLink gthr-default.h to appropriate thread file and set\n+\tgthread_flags.\n+\t(hppa1.1-*-hpux10*): If --enable-threads, use dce threads and\n+\tinclude multilib definitions from pa/t-dce-thr.\n+\t(sparc-*-solaris2*): Enable threads by default, if thread.h or\n+\tpthread.h is found, preferring posix threads over solaris ones.\n+\n+\t* config/pa/t-dce-thr: New file.\n+\t* config/pa/t-pa: Removed multilibs.\n+\t* config/sparc/t-sol2: Ditto.\n+\t\t\n+\t* gthr.h: New file.\n+\t* gthr-single.h: New file.\n+\t* gthr-posix.h: New file.\n+\t* gthr-solaris.h: New file.\n+\t* gthr-dce.h: New file.\n+\t* libgcc-thr.h: Removed.\n+\t* objc/thr-dce.c: New file copied from thr-decosf1.c.\n+\n+\t* frame.c: Include gthr.h instead of libgcc-thr.h.\n+\t* libgcc2.c: Include gthr.h instead of libgcc-thr.h.\n+\t(eh_context_initialize): If __gthread_once fails, use static eh\n+\tcontext.\n+\t(eh_context_free): Call __gthread_key_dtor.\n+\n Wed Dec 24 23:33:17 1997  Jeffrey A Law  (law@cygnus.com)\n \n \t* expr.h (MUST_PASS_IN_STACK): Allow target port to override."}, {"sha": "4b256b5db04019a0ddc2480caee2bc0dd57f298d", "filename": "gcc/Makefile.in", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -206,6 +206,7 @@ host_xm_file=@host_xm_file_list@\n lang_specs_files=@lang_specs_files@\n lang_options_files=@lang_options_files@\n GCC_THREAD_FILE=@thread_file@\n+GTHREAD_FLAGS=@gthread_flags@\n version=@version@\n mainversion=`sed -e 's/.*\\\"\\([0-9]*\\.[0-9]*\\).*/\\1/' < $(srcdir)/version.c`\n \n@@ -281,7 +282,7 @@ LIBGCC2 = libgcc2.a\n # -fexceptions is necessary for eh.o now that the exceptions are\n # the default for g++ only.\n LIBGCC2_DEBUG_CFLAGS = -g1\n-LIBGCC2_CFLAGS = -O2 $(LIBGCC2_INCLUDES) $(GCC_CFLAGS) $(TARGET_LIBGCC2_CFLAGS) $(LIBGCC2_DEBUG_CFLAGS) -DIN_LIBGCC2 -D__GCC_FLOAT_NOT_NEEDED -fexceptions @inhibit_libc@ \n+LIBGCC2_CFLAGS = -O2 $(LIBGCC2_INCLUDES) $(GCC_CFLAGS) $(TARGET_LIBGCC2_CFLAGS) $(LIBGCC2_DEBUG_CFLAGS) $(GTHREAD_FLAGS) -DIN_LIBGCC2 -D__GCC_FLOAT_NOT_NEEDED -fexceptions @inhibit_libc@ \n \n # Additional options to use when compiling libgcc2.a.\n # Some targets override this to -Iinclude\n@@ -2157,6 +2158,7 @@ distclean: clean bytecode.distclean lang.distclean\n \t-rm -f config.status config.run config.cache config.bak\n \t-rm -f Make-lang Make-hooks Make-host Make-target\n \t-rm -f Makefile specs.h options.h *.oaux\n+\t-rm -f gthr-default.h\n \t-rm -f */stage1 */stage2 */stage3 */stage4 */include\n \t-rm -f c-parse.output\n \t-rm -f *.asm"}, {"sha": "8d86a41818675b0a2c494ec3734f42568765e210", "filename": "gcc/config/pa/t-dce-thr", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfig%2Fpa%2Ft-dce-thr", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfig%2Fpa%2Ft-dce-thr", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Ft-dce-thr?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,5 @@\n+MULTILIB_OPTIONS = threads\n+MULTILIB_DIRNAMES = threads\n+\n+LIBGCC = stmp-multilib\n+INSTALL_LIBGCC = install-multilib"}, {"sha": "a359918a1259790b9d9a01c46c3520c402b98ccb", "filename": "gcc/config/pa/t-pa", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfig%2Fpa%2Ft-pa", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfig%2Fpa%2Ft-pa", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Ft-pa?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -16,9 +16,3 @@ ee_fp.asm: $(srcdir)/config/pa/ee_fp.asm\n \tcp $(srcdir)/config/pa/ee_fp.asm .\n \n TARGET_LIBGCC2_CFLAGS = -fPIC\n-\n-MULTILIB_OPTIONS = threads\n-MULTILIB_DIRNAMES = threads\n-\n-LIBGCC = stmp-multilib\n-INSTALL_LIBGCC = install-multilib"}, {"sha": "d41254adb442005b21255033b61928fb1a95c25f", "filename": "gcc/config/sparc/t-sol2", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfig%2Fsparc%2Ft-sol2", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfig%2Fsparc%2Ft-sol2", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Ft-sol2?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -5,13 +5,6 @@ LIBGCC1 =\n CROSS_LIBGCC1 =\n LIBGCC1_TEST =\n \n-MULTILIB_OPTIONS = threads\n-MULTILIB_DIRNAMES = threads\n-MULTILIB_MATCHES = threads=pthreads\n-\n-LIBGCC = stmp-multilib\n-INSTALL_LIBGCC = install-multilib\n-\n # gmon build rule:\n gmon.o:\t$(srcdir)/config/sparc/gmon-sol2.c $(GCC_PASSES) $(CONFIG_H) stmp-int-hdrs\n \t$(GCC_FOR_TARGET) $(GCC_CFLAGS) $(INCLUDES) \\"}, {"sha": "ff602458239ba6c2281505162315e4248e30686d", "filename": "gcc/configure", "status": "modified", "additions": 231, "deletions": 131, "changes": 362, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -1,7 +1,7 @@\n #! /bin/sh\n \n # Guess values for system-dependent variables and create Makefiles.\n-# Generated automatically using autoconf version 2.12 \n+# Generated automatically using autoconf version 2.12.1 \n # Copyright (C) 1992, 93, 94, 95, 96 Free Software Foundation, Inc.\n #\n # This configure script is free software; the Free Software Foundation\n@@ -71,6 +71,7 @@ mandir='${prefix}/man'\n # Initialize some other variables.\n subdirs=\n MFLAGS= MAKEFLAGS=\n+SHELL=${CONFIG_SHELL-/bin/sh}\n # Maximum number of lines to put in a shell here document.\n ac_max_here_lines=12\n \n@@ -354,7 +355,7 @@ EOF\n     verbose=yes ;;\n \n   -version | --version | --versio | --versi | --vers)\n-    echo \"configure generated by autoconf version 2.12\"\n+    echo \"configure generated by autoconf version 2.12.1\"\n     exit 0 ;;\n \n   -with-* | --with-*)\n@@ -663,7 +664,7 @@ case x${enable_threads} in\n \t\tthread_file=''\n \t\t;;\n \txdecosf1 | xirix | xmach | xos2 | xposix | xpthreads | xsingle | \\\n-\txsolaris | xwin32)\n+\txsolaris | xwin32 | xdce)\n \t\tthread_file=$enable_threads\n \t\t;;\n \t*)\n@@ -715,33 +716,33 @@ esac\n \n \n # Make sure we can run config.sub.\n-if $ac_config_sub sun4 >/dev/null 2>&1; then :\n+if ${CONFIG_SHELL-/bin/sh} $ac_config_sub sun4 >/dev/null 2>&1; then :\n else { echo \"configure: error: can not run $ac_config_sub\" 1>&2; exit 1; }\n fi\n \n echo $ac_n \"checking host system type\"\"... $ac_c\" 1>&6\n-echo \"configure:724: checking host system type\" >&5\n+echo \"configure:725: checking host system type\" >&5\n \n host_alias=$host\n case \"$host_alias\" in\n NONE)\n   case $nonopt in\n   NONE)\n-    if host_alias=`$ac_config_guess`; then :\n+    if host_alias=`${CONFIG_SHELL-/bin/sh} $ac_config_guess`; then :\n     else { echo \"configure: error: can not guess host type; you must specify one\" 1>&2; exit 1; }\n     fi ;;\n   *) host_alias=$nonopt ;;\n   esac ;;\n esac\n \n-host=`$ac_config_sub $host_alias`\n+host=`${CONFIG_SHELL-/bin/sh} $ac_config_sub $host_alias`\n host_cpu=`echo $host | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\1/'`\n host_vendor=`echo $host | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\2/'`\n host_os=`echo $host | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$host\" 1>&6\n \n echo $ac_n \"checking target system type\"\"... $ac_c\" 1>&6\n-echo \"configure:745: checking target system type\" >&5\n+echo \"configure:746: checking target system type\" >&5\n \n target_alias=$target\n case \"$target_alias\" in\n@@ -752,14 +753,14 @@ NONE)\n   esac ;;\n esac\n \n-target=`$ac_config_sub $target_alias`\n+target=`${CONFIG_SHELL-/bin/sh} $ac_config_sub $target_alias`\n target_cpu=`echo $target | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\1/'`\n target_vendor=`echo $target | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\2/'`\n target_os=`echo $target | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n echo \"$ac_t\"\"$target\" 1>&6\n \n echo $ac_n \"checking build system type\"\"... $ac_c\" 1>&6\n-echo \"configure:763: checking build system type\" >&5\n+echo \"configure:764: checking build system type\" >&5\n \n build_alias=$build\n case \"$build_alias\" in\n@@ -770,7 +771,7 @@ NONE)\n   esac ;;\n esac\n \n-build=`$ac_config_sub $build_alias`\n+build=`${CONFIG_SHELL-/bin/sh} $ac_config_sub $build_alias`\n build_cpu=`echo $build | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\1/'`\n build_vendor=`echo $build | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\2/'`\n build_os=`echo $build | sed 's/^\\([^-]*\\)-\\([^-]*\\)-\\(.*\\)$/\\3/'`\n@@ -786,7 +787,7 @@ test \"$host_alias\" != \"$target_alias\" &&\n # Extract the first word of \"gcc\", so it can be a program name with args.\n set dummy gcc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:790: checking for $ac_word\" >&5\n+echo \"configure:791: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -815,7 +816,7 @@ if test -z \"$CC\"; then\n   # Extract the first word of \"cc\", so it can be a program name with args.\n set dummy cc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:819: checking for $ac_word\" >&5\n+echo \"configure:820: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -863,7 +864,7 @@ fi\n fi\n \n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\"\"... $ac_c\" 1>&6\n-echo \"configure:867: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n+echo \"configure:868: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n \n ac_ext=c\n # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n@@ -873,11 +874,11 @@ ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS\n cross_compiling=$ac_cv_prog_cc_cross\n \n cat > conftest.$ac_ext <<EOF\n-#line 877 \"configure\"\n+#line 878 \"configure\"\n #include \"confdefs.h\"\n main(){return(0);}\n EOF\n-if { (eval echo configure:881: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:882: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   ac_cv_prog_cc_works=yes\n   # If we can't run a trivial program, we are probably using a cross compiler.\n   if (./conftest; exit) 2>/dev/null; then\n@@ -897,12 +898,12 @@ if test $ac_cv_prog_cc_works = no; then\n   { echo \"configure: error: installation or configuration problem: C compiler cannot create executables.\" 1>&2; exit 1; }\n fi\n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\"\"... $ac_c\" 1>&6\n-echo \"configure:901: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n+echo \"configure:902: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n echo \"$ac_t\"\"$ac_cv_prog_cc_cross\" 1>&6\n cross_compiling=$ac_cv_prog_cc_cross\n \n echo $ac_n \"checking whether we are using GNU C\"\"... $ac_c\" 1>&6\n-echo \"configure:906: checking whether we are using GNU C\" >&5\n+echo \"configure:907: checking whether we are using GNU C\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gcc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -911,7 +912,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:915: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:916: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gcc=yes\n else\n   ac_cv_prog_gcc=no\n@@ -926,7 +927,7 @@ if test $ac_cv_prog_gcc = yes; then\n   ac_save_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\n   echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:930: checking whether ${CC-cc} accepts -g\" >&5\n+echo \"configure:931: checking whether ${CC-cc} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cc_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -954,7 +955,7 @@ else\n fi\n \n echo $ac_n \"checking whether ${MAKE-make} sets \\${MAKE}\"\"... $ac_c\" 1>&6\n-echo \"configure:958: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n+echo \"configure:959: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n set dummy ${MAKE-make}; ac_make=`echo \"$2\" | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -987,7 +988,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:991: checking for $ac_word\" >&5\n+echo \"configure:992: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AWK'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1018,7 +1019,7 @@ done\n # Extract the first word of \"flex\", so it can be a program name with args.\n set dummy flex; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1022: checking for $ac_word\" >&5\n+echo \"configure:1023: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LEX'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1051,15 +1052,15 @@ then\n   *) ac_lib=l ;;\n   esac\n   echo $ac_n \"checking for yywrap in -l$ac_lib\"\"... $ac_c\" 1>&6\n-echo \"configure:1055: checking for yywrap in -l$ac_lib\" >&5\n+echo \"configure:1056: checking for yywrap in -l$ac_lib\" >&5\n ac_lib_var=`echo $ac_lib'_'yywrap | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   ac_save_LIBS=\"$LIBS\"\n LIBS=\"-l$ac_lib  $LIBS\"\n cat > conftest.$ac_ext <<EOF\n-#line 1063 \"configure\"\n+#line 1064 \"configure\"\n #include \"confdefs.h\"\n /* Override any gcc2 internal prototype to avoid an error.  */\n /* We use char because int might match the return type of a gcc2\n@@ -1070,7 +1071,7 @@ int main() {\n yywrap()\n ; return 0; }\n EOF\n-if { (eval echo configure:1074: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1075: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_lib_$ac_lib_var=yes\"\n else\n@@ -1093,7 +1094,7 @@ fi\n fi\n \n echo $ac_n \"checking whether ln works\"\"... $ac_c\" 1>&6\n-echo \"configure:1097: checking whether ln works\" >&5\n+echo \"configure:1098: checking whether ln works\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_prog_LN'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1125,7 +1126,7 @@ else\n fi\n \n echo $ac_n \"checking whether ln -s works\"\"... $ac_c\" 1>&6\n-echo \"configure:1129: checking whether ln -s works\" >&5\n+echo \"configure:1130: checking whether ln -s works\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_prog_LN_S'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1159,7 +1160,7 @@ fi\n # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1163: checking for $ac_word\" >&5\n+echo \"configure:1164: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1190,7 +1191,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1194: checking for $ac_word\" >&5\n+echo \"configure:1195: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_YACC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1230,7 +1231,7 @@ test -n \"$YACC\" || YACC=\"yacc\"\n # SVR4 /usr/ucb/install, which tries to use the nonexistent group \"staff\"\n # ./install, which can be erroneously created by make from ./install.sh.\n echo $ac_n \"checking for a BSD compatible install\"\"... $ac_c\" 1>&6\n-echo \"configure:1234: checking for a BSD compatible install\" >&5\n+echo \"configure:1235: checking for a BSD compatible install\" >&5\n if test -z \"$INSTALL\"; then\n if eval \"test \\\"`echo '$''{'ac_cv_path_install'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1284,7 +1285,7 @@ test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n # Extract the first word of \"gcc\", so it can be a program name with args.\n set dummy gcc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1288: checking for $ac_word\" >&5\n+echo \"configure:1289: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1313,7 +1314,7 @@ if test -z \"$CC\"; then\n   # Extract the first word of \"cc\", so it can be a program name with args.\n set dummy cc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1317: checking for $ac_word\" >&5\n+echo \"configure:1318: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1361,7 +1362,7 @@ fi\n fi\n \n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\"\"... $ac_c\" 1>&6\n-echo \"configure:1365: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n+echo \"configure:1366: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n \n ac_ext=c\n # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n@@ -1371,11 +1372,11 @@ ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS\n cross_compiling=$ac_cv_prog_cc_cross\n \n cat > conftest.$ac_ext <<EOF\n-#line 1375 \"configure\"\n+#line 1376 \"configure\"\n #include \"confdefs.h\"\n main(){return(0);}\n EOF\n-if { (eval echo configure:1379: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1380: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   ac_cv_prog_cc_works=yes\n   # If we can't run a trivial program, we are probably using a cross compiler.\n   if (./conftest; exit) 2>/dev/null; then\n@@ -1395,12 +1396,12 @@ if test $ac_cv_prog_cc_works = no; then\n   { echo \"configure: error: installation or configuration problem: C compiler cannot create executables.\" 1>&2; exit 1; }\n fi\n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\"\"... $ac_c\" 1>&6\n-echo \"configure:1399: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n+echo \"configure:1400: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n echo \"$ac_t\"\"$ac_cv_prog_cc_cross\" 1>&6\n cross_compiling=$ac_cv_prog_cc_cross\n \n echo $ac_n \"checking whether we are using GNU C\"\"... $ac_c\" 1>&6\n-echo \"configure:1404: checking whether we are using GNU C\" >&5\n+echo \"configure:1405: checking whether we are using GNU C\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gcc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1409,7 +1410,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1413: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1414: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gcc=yes\n else\n   ac_cv_prog_gcc=no\n@@ -1424,7 +1425,7 @@ if test $ac_cv_prog_gcc = yes; then\n   ac_save_CFLAGS=\"$CFLAGS\"\n   CFLAGS=\n   echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:1428: checking whether ${CC-cc} accepts -g\" >&5\n+echo \"configure:1429: checking whether ${CC-cc} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cc_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1452,7 +1453,7 @@ else\n fi\n \n echo $ac_n \"checking whether ${MAKE-make} sets \\${MAKE}\"\"... $ac_c\" 1>&6\n-echo \"configure:1456: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n+echo \"configure:1457: checking whether ${MAKE-make} sets \\${MAKE}\" >&5\n set dummy ${MAKE-make}; ac_make=`echo \"$2\" | sed 'y%./+-%__p_%'`\n if eval \"test \\\"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n@@ -1480,7 +1481,7 @@ fi\n \n \n echo $ac_n \"checking how to run the C preprocessor\"\"... $ac_c\" 1>&6\n-echo \"configure:1484: checking how to run the C preprocessor\" >&5\n+echo \"configure:1485: checking how to run the C preprocessor\" >&5\n # On Suns, sometimes $CPP names a directory.\n if test -n \"$CPP\" && test -d \"$CPP\"; then\n   CPP=\n@@ -1495,13 +1496,13 @@ else\n   # On the NeXT, cc -E runs the code through the compiler's parser,\n   # not just through cpp.\n   cat > conftest.$ac_ext <<EOF\n-#line 1499 \"configure\"\n+#line 1500 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1505: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:1506: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out`\n if test -z \"$ac_err\"; then\n   :\n@@ -1512,13 +1513,13 @@ else\n   rm -rf conftest*\n   CPP=\"${CC-cc} -E -traditional-cpp\"\n   cat > conftest.$ac_ext <<EOF\n-#line 1516 \"configure\"\n+#line 1517 \"configure\"\n #include \"confdefs.h\"\n #include <assert.h>\n Syntax Error\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1522: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:1523: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out`\n if test -z \"$ac_err\"; then\n   :\n@@ -1541,20 +1542,20 @@ fi\n echo \"$ac_t\"\"$CPP\" 1>&6\n \n echo $ac_n \"checking for ANSI C header files\"\"... $ac_c\" 1>&6\n-echo \"configure:1545: checking for ANSI C header files\" >&5\n+echo \"configure:1546: checking for ANSI C header files\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_stdc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1550 \"configure\"\n+#line 1551 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n #include <stdarg.h>\n #include <string.h>\n #include <float.h>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1558: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:1559: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -1571,7 +1572,7 @@ rm -f conftest*\n if test $ac_cv_header_stdc = yes; then\n   # SunOS 4.x string.h does not declare mem*, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 1575 \"configure\"\n+#line 1576 \"configure\"\n #include \"confdefs.h\"\n #include <string.h>\n EOF\n@@ -1589,7 +1590,7 @@ fi\n if test $ac_cv_header_stdc = yes; then\n   # ISC 2.0.2 stdlib.h does not declare free, contrary to ANSI.\n cat > conftest.$ac_ext <<EOF\n-#line 1593 \"configure\"\n+#line 1594 \"configure\"\n #include \"confdefs.h\"\n #include <stdlib.h>\n EOF\n@@ -1610,7 +1611,7 @@ if test \"$cross_compiling\" = yes; then\n   :\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1614 \"configure\"\n+#line 1615 \"configure\"\n #include \"confdefs.h\"\n #include <ctype.h>\n #define ISLOWER(c) ('a' <= (c) && (c) <= 'z')\n@@ -1621,7 +1622,7 @@ if (XOR (islower (i), ISLOWER (i)) || toupper (i) != TOUPPER (i)) exit(2);\n exit (0); }\n \n EOF\n-if { (eval echo configure:1625: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n+if { (eval echo configure:1626: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest && (./conftest; exit) 2>/dev/null\n then\n   :\n else\n@@ -1645,12 +1646,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether time.h and sys/time.h may both be included\"\"... $ac_c\" 1>&6\n-echo \"configure:1649: checking whether time.h and sys/time.h may both be included\" >&5\n+echo \"configure:1650: checking whether time.h and sys/time.h may both be included\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_time'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1654 \"configure\"\n+#line 1655 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <sys/time.h>\n@@ -1659,7 +1660,7 @@ int main() {\n struct tm *tp;\n ; return 0; }\n EOF\n-if { (eval echo configure:1663: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:1664: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_header_time=yes\n else\n@@ -1683,17 +1684,17 @@ for ac_hdr in limits.h stddef.h string.h strings.h stdlib.h time.h fcntl.h unist\n do\n ac_safe=`echo \"$ac_hdr\" | sed 'y%./+-%__p_%'`\n echo $ac_n \"checking for $ac_hdr\"\"... $ac_c\" 1>&6\n-echo \"configure:1687: checking for $ac_hdr\" >&5\n+echo \"configure:1688: checking for $ac_hdr\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1692 \"configure\"\n+#line 1693 \"configure\"\n #include \"confdefs.h\"\n #include <$ac_hdr>\n EOF\n ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n-{ (eval echo configure:1697: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+{ (eval echo configure:1698: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n ac_err=`grep -v '^ *+' conftest.out`\n if test -z \"$ac_err\"; then\n   rm -rf conftest*\n@@ -1720,23 +1721,93 @@ fi\n done\n \n \n+# Check for thread headers.\n+ac_safe=`echo \"thread.h\" | sed 'y%./+-%__p_%'`\n+echo $ac_n \"checking for thread.h\"\"... $ac_c\" 1>&6\n+echo \"configure:1728: checking for thread.h\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 1733 \"configure\"\n+#include \"confdefs.h\"\n+#include <thread.h>\n+EOF\n+ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n+{ (eval echo configure:1738: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out`\n+if test -z \"$ac_err\"; then\n+  rm -rf conftest*\n+  eval \"ac_cv_header_$ac_safe=yes\"\n+else\n+  echo \"$ac_err\" >&5\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  eval \"ac_cv_header_$ac_safe=no\"\n+fi\n+rm -f conftest*\n+fi\n+if eval \"test \\\"`echo '$ac_cv_header_'$ac_safe`\\\" = yes\"; then\n+  echo \"$ac_t\"\"yes\" 1>&6\n+  have_thread_h=yes\n+else\n+  echo \"$ac_t\"\"no\" 1>&6\n+have_thread_h=\n+fi\n+\n+ac_safe=`echo \"pthread.h\" | sed 'y%./+-%__p_%'`\n+echo $ac_n \"checking for pthread.h\"\"... $ac_c\" 1>&6\n+echo \"configure:1762: checking for pthread.h\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  cat > conftest.$ac_ext <<EOF\n+#line 1767 \"configure\"\n+#include \"confdefs.h\"\n+#include <pthread.h>\n+EOF\n+ac_try=\"$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out\"\n+{ (eval echo configure:1772: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }\n+ac_err=`grep -v '^ *+' conftest.out`\n+if test -z \"$ac_err\"; then\n+  rm -rf conftest*\n+  eval \"ac_cv_header_$ac_safe=yes\"\n+else\n+  echo \"$ac_err\" >&5\n+  echo \"configure: failed program was:\" >&5\n+  cat conftest.$ac_ext >&5\n+  rm -rf conftest*\n+  eval \"ac_cv_header_$ac_safe=no\"\n+fi\n+rm -f conftest*\n+fi\n+if eval \"test \\\"`echo '$ac_cv_header_'$ac_safe`\\\" = yes\"; then\n+  echo \"$ac_t\"\"yes\" 1>&6\n+  have_pthread_h=yes\n+else\n+  echo \"$ac_t\"\"no\" 1>&6\n+have_pthread_h=\n+fi\n+\n+\n # Use <inttypes.h> only if it exists,\n # doesn't clash with <sys/types.h>, and declares intmax_t.\n echo $ac_n \"checking for inttypes.h\"\"... $ac_c\" 1>&6\n-echo \"configure:1727: checking for inttypes.h\" >&5\n+echo \"configure:1798: checking for inttypes.h\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_header_inttypes_h'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1732 \"configure\"\n+#line 1803 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <inttypes.h>\n int main() {\n intmax_t i = -1;\n ; return 0; }\n EOF\n-if { (eval echo configure:1740: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:1811: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   cat >> confdefs.h <<EOF\n #define HAVE_INTTYPES_H 1\n@@ -1757,12 +1828,12 @@ echo \"$ac_t\"\"$gcc_cv_header_inttypes_h\" 1>&6\n for ac_func in strtoul\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1761: checking for $ac_func\" >&5\n+echo \"configure:1832: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1766 \"configure\"\n+#line 1837 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1785,7 +1856,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1789: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1860: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1812,12 +1883,12 @@ done\n for ac_func in bsearch\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1816: checking for $ac_func\" >&5\n+echo \"configure:1887: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1821 \"configure\"\n+#line 1892 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1840,7 +1911,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1844: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1915: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1867,12 +1938,12 @@ done\n for ac_func in strerror\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1871: checking for $ac_func\" >&5\n+echo \"configure:1942: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1876 \"configure\"\n+#line 1947 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1895,7 +1966,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1899: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:1970: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1922,12 +1993,12 @@ done\n for ac_func in putenv\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1926: checking for $ac_func\" >&5\n+echo \"configure:1997: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1931 \"configure\"\n+#line 2002 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -1950,7 +2021,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:1954: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2025: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -1977,12 +2048,12 @@ done\n for ac_func in popen\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:1981: checking for $ac_func\" >&5\n+echo \"configure:2052: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 1986 \"configure\"\n+#line 2057 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2005,7 +2076,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2009: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2080: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2032,12 +2103,12 @@ done\n for ac_func in vprintf\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2036: checking for $ac_func\" >&5\n+echo \"configure:2107: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2041 \"configure\"\n+#line 2112 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2060,7 +2131,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2064: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2135: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2087,12 +2158,12 @@ done\n for ac_func in bcopy\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2091: checking for $ac_func\" >&5\n+echo \"configure:2162: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2096 \"configure\"\n+#line 2167 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2115,7 +2186,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2119: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2190: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2142,12 +2213,12 @@ done\n for ac_func in bzero\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2146: checking for $ac_func\" >&5\n+echo \"configure:2217: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2151 \"configure\"\n+#line 2222 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2170,7 +2241,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2174: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2245: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2197,12 +2268,12 @@ done\n for ac_func in bcmp\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2201: checking for $ac_func\" >&5\n+echo \"configure:2272: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2206 \"configure\"\n+#line 2277 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2225,7 +2296,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2229: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2300: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2252,12 +2323,12 @@ done\n for ac_func in index\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2256: checking for $ac_func\" >&5\n+echo \"configure:2327: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2261 \"configure\"\n+#line 2332 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2280,7 +2351,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2284: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2355: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2307,12 +2378,12 @@ done\n for ac_func in rindex\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2311: checking for $ac_func\" >&5\n+echo \"configure:2382: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2316 \"configure\"\n+#line 2387 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2335,7 +2406,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2339: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2410: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2362,12 +2433,12 @@ done\n for ac_func in kill\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2366: checking for $ac_func\" >&5\n+echo \"configure:2437: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2371 \"configure\"\n+#line 2442 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2390,7 +2461,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2394: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2465: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2417,12 +2488,12 @@ done\n for ac_func in getrlimit\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2421: checking for $ac_func\" >&5\n+echo \"configure:2492: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2426 \"configure\"\n+#line 2497 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2445,7 +2516,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2449: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2520: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2472,12 +2543,12 @@ done\n for ac_func in setrlimit\n do\n echo $ac_n \"checking for $ac_func\"\"... $ac_c\" 1>&6\n-echo \"configure:2476: checking for $ac_func\" >&5\n+echo \"configure:2547: checking for $ac_func\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_func_$ac_func'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2481 \"configure\"\n+#line 2552 \"configure\"\n #include \"confdefs.h\"\n /* System header to define __stub macros and hopefully few prototypes,\n     which can conflict with char $ac_func(); below.  */\n@@ -2500,7 +2571,7 @@ $ac_func();\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2504: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n+if { (eval echo configure:2575: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest; then\n   rm -rf conftest*\n   eval \"ac_cv_func_$ac_func=yes\"\n else\n@@ -2526,12 +2597,12 @@ done\n \n \n echo $ac_n \"checking whether malloc must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2530: checking whether malloc must be declared\" >&5\n+echo \"configure:2601: checking whether malloc must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_malloc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2535 \"configure\"\n+#line 2606 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2558,7 +2629,7 @@ int main() {\n char *(*pfn) = (char *(*)) malloc\n ; return 0; }\n EOF\n-if { (eval echo configure:2562: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2633: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_malloc=no\n else\n@@ -2580,12 +2651,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether realloc must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2584: checking whether realloc must be declared\" >&5\n+echo \"configure:2655: checking whether realloc must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_realloc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2589 \"configure\"\n+#line 2660 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2612,7 +2683,7 @@ int main() {\n char *(*pfn) = (char *(*)) realloc\n ; return 0; }\n EOF\n-if { (eval echo configure:2616: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2687: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_realloc=no\n else\n@@ -2634,12 +2705,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether calloc must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2638: checking whether calloc must be declared\" >&5\n+echo \"configure:2709: checking whether calloc must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_calloc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2643 \"configure\"\n+#line 2714 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2666,7 +2737,7 @@ int main() {\n char *(*pfn) = (char *(*)) calloc\n ; return 0; }\n EOF\n-if { (eval echo configure:2670: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2741: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_calloc=no\n else\n@@ -2688,12 +2759,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether free must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2692: checking whether free must be declared\" >&5\n+echo \"configure:2763: checking whether free must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_free'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2697 \"configure\"\n+#line 2768 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2720,7 +2791,7 @@ int main() {\n char *(*pfn) = (char *(*)) free\n ; return 0; }\n EOF\n-if { (eval echo configure:2724: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2795: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_free=no\n else\n@@ -2742,12 +2813,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether index must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2746: checking whether index must be declared\" >&5\n+echo \"configure:2817: checking whether index must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_index'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2751 \"configure\"\n+#line 2822 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2774,7 +2845,7 @@ int main() {\n char *(*pfn) = (char *(*)) index\n ; return 0; }\n EOF\n-if { (eval echo configure:2778: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2849: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_index=no\n else\n@@ -2796,12 +2867,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether rindex must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2800: checking whether rindex must be declared\" >&5\n+echo \"configure:2871: checking whether rindex must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_rindex'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2805 \"configure\"\n+#line 2876 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2828,7 +2899,7 @@ int main() {\n char *(*pfn) = (char *(*)) rindex\n ; return 0; }\n EOF\n-if { (eval echo configure:2832: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2903: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_rindex=no\n else\n@@ -2850,12 +2921,12 @@ EOF\n fi\n \n echo $ac_n \"checking whether getenv must be declared\"\"... $ac_c\" 1>&6\n-echo \"configure:2854: checking whether getenv must be declared\" >&5\n+echo \"configure:2925: checking whether getenv must be declared\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_decl_needed_getenv'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2859 \"configure\"\n+#line 2930 \"configure\"\n #include \"confdefs.h\"\n \n #include <stdio.h>\n@@ -2882,7 +2953,7 @@ int main() {\n char *(*pfn) = (char *(*)) getenv\n ; return 0; }\n EOF\n-if { (eval echo configure:2886: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2957: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   gcc_cv_decl_needed_getenv=no\n else\n@@ -2905,12 +2976,12 @@ fi\n \n \n echo $ac_n \"checking for sys_siglist declaration in signal.h or unistd.h\"\"... $ac_c\" 1>&6\n-echo \"configure:2909: checking for sys_siglist declaration in signal.h or unistd.h\" >&5\n+echo \"configure:2980: checking for sys_siglist declaration in signal.h or unistd.h\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_decl_sys_siglist'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n   cat > conftest.$ac_ext <<EOF\n-#line 2914 \"configure\"\n+#line 2985 \"configure\"\n #include \"confdefs.h\"\n #include <sys/types.h>\n #include <signal.h>\n@@ -2922,7 +2993,7 @@ int main() {\n char *msg = *(sys_siglist + 1);\n ; return 0; }\n EOF\n-if { (eval echo configure:2926: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2997: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   ac_cv_decl_sys_siglist=yes\n else\n@@ -3395,10 +3466,18 @@ for machine in $build $host $target; do\n \t\ttm_file=\"${tm_file} pa/pa-hpux.h pa/pa-hpux10.h\"\n \t\txm_file=pa/xm-pahpux.h\n \t\txmake_file=pa/x-pa-hpux\n+\t\ttmake_file=pa/t-pa\n \t\tif [ x$gas = xyes ]\n \t\tthen\n \t\t\ttm_file=\"${tm_file} pa/pa-gas.h\"\n \t\tfi\n+\t\tif [ x$enable_threads = x ]; then\n+\t\t    enable_threads=$have_pthread_h\n+\t\tfi\n+ \t\tif [ x$enable_threads = xyes ]; then\n+\t\t\tthread_file='dce'\n+\t\t\ttmake_file=\"${tmake_file} pa/t-dce-thr\"\n+\t\tfi\n \t\tinstall_headers_dir=install-headers-cpio\n \t\tuse_collect2=yes\n \t\t;;\n@@ -5238,8 +5317,18 @@ for machine in $build $host $target; do\n \t\tfixincludes=fixinc.svr4\n \t\tfloat_format=i128\n \t\tbroken_install=yes\n- \t\tif [ x$enable_threads = xyes ]; then\n+\t\tif [ x${enable_threads} = x ]; then\n+\t\t    enable_threads=$have_pthread_h\n+\t\t    if [ x${enable_threads} = x ]; then\n+\t\t\tenable_threads=$have_thread_h\n+\t\t    fi\n+\t\tfi\n+\t\tif [ x${enable_threads} = xyes ]; then\n+\t\t    if [ x${have_pthread_h} = xyes ]; then\n+\t\t\tthread_file='posix'\n+\t\t    else\n \t\t\tthread_file='solaris'\n+\t\t    fi\n \t\tfi\n \t\t;;\n \tsparc-*-sunos4.0*)\n@@ -5836,6 +5925,15 @@ do\n \tesac\n done\n \n+# Make gthr-default.h if we have a thread file.\n+gthread_flags=\n+if [ $thread_file != single ]; then\n+    rm -f gthr-default.h\n+    $symbolic_link gthr-${thread_file}.h gthr-default.h\n+    gthread_flags=-DHAVE_GTHR_DEFAULT\n+fi\n+\n+\n # Make empty files to contain the specs and options for each language.\n # Then add #include lines to for a compiler that has specs and/or options.\n \n@@ -6095,7 +6193,7 @@ EOF\n # Ultrix sh set writes to stderr and can't be redirected directly,\n # and sets the high bit in the cache file unless we assign to the vars.\n (set) 2>&1 |\n-  case `(ac_space=' '; set) 2>&1` in\n+  case `(ac_space=' '; set) 2>&1 | grep ac_space` in\n   *ac_space=\\ *)\n     # `set' does not quote correctly, so add quotes (double-quote substitution\n     # turns \\\\\\\\ into \\\\, and sed turns \\\\ into \\).\n@@ -6162,7 +6260,7 @@ do\n     echo \"running \\${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion\"\n     exec \\${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;\n   -version | --version | --versio | --versi | --vers | --ver | --ve | --v)\n-    echo \"$CONFIG_STATUS generated by autoconf version 2.12\"\n+    echo \"$CONFIG_STATUS generated by autoconf version 2.12.1\"\n     exit 0 ;;\n   -help | --help | --hel | --he | --h)\n     echo \"\\$ac_cs_usage\"; exit 0 ;;\n@@ -6181,6 +6279,7 @@ sed 's/%@/@@/; s/@%/@@/; s/%g\\$/@g/; /@g\\$/s/[\\\\\\\\&%]/\\\\\\\\&/g;\n  s/@@/%@/; s/@@/@%/; s/@g\\$/%g/' > conftest.subs <<\\\\CEOF\n $ac_vpsub\n $extrasub\n+s%@SHELL@%$SHELL%g\n s%@CFLAGS@%$CFLAGS%g\n s%@CPPFLAGS@%$CPPFLAGS%g\n s%@CXXFLAGS@%$CXXFLAGS%g\n@@ -6232,6 +6331,7 @@ s%@INSTALL_DATA@%$INSTALL_DATA%g\n s%@CPP@%$CPP%g\n s%@manext@%$manext%g\n s%@objext@%$objext%g\n+s%@gthread_flags@%$gthread_flags%g\n s%@inhibit_libc@%$inhibit_libc%g\n s%@sched_prefix@%$sched_prefix%g\n s%@sched_cflags@%$sched_cflags%g"}, {"sha": "4957d517297a0aa5765da056746356c5a989ef6f", "filename": "gcc/configure.in", "status": "modified", "additions": 33, "deletions": 2, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfigure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fconfigure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.in?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -114,7 +114,7 @@ case x${enable_threads} in\n \t\tthread_file=''\n \t\t;;\n \txdecosf1 | xirix | xmach | xos2 | xposix | xpthreads | xsingle | \\\n-\txsolaris | xwin32)\n+\txsolaris | xwin32 | xdce)\n \t\tthread_file=$enable_threads\n \t\t;;\n \t*)\n@@ -147,6 +147,10 @@ AC_HEADER_STDC\n AC_HEADER_TIME\n AC_CHECK_HEADERS(limits.h stddef.h string.h strings.h stdlib.h time.h fcntl.h unistd.h sys/file.h sys/time.h sys/resource.h sys/param.h sys/times.h varargs.h sys/varargs.h)\n \n+# Check for thread headers.\n+AC_CHECK_HEADER(thread.h, [have_thread_h=yes], [have_thread_h=])\n+AC_CHECK_HEADER(pthread.h, [have_pthread_h=yes], [have_pthread_h=])\n+\n # Use <inttypes.h> only if it exists,\n # doesn't clash with <sys/types.h>, and declares intmax_t.\n AC_MSG_CHECKING(for inttypes.h)\n@@ -637,10 +641,18 @@ for machine in $build $host $target; do\n \t\ttm_file=\"${tm_file} pa/pa-hpux.h pa/pa-hpux10.h\"\n \t\txm_file=pa/xm-pahpux.h\n \t\txmake_file=pa/x-pa-hpux\n+\t\ttmake_file=pa/t-pa\n \t\tif [[ x$gas = xyes ]]\n \t\tthen\n \t\t\ttm_file=\"${tm_file} pa/pa-gas.h\"\n \t\tfi\n+\t\tif [[ x$enable_threads = x ]]; then\n+\t\t    enable_threads=$have_pthread_h\n+\t\tfi\n+ \t\tif [[ x$enable_threads = xyes ]]; then\n+\t\t\tthread_file='dce'\n+\t\t\ttmake_file=\"${tmake_file} pa/t-dce-thr\"\n+\t\tfi\n \t\tinstall_headers_dir=install-headers-cpio\n \t\tuse_collect2=yes\n \t\t;;\n@@ -2480,8 +2492,18 @@ for machine in $build $host $target; do\n \t\tfixincludes=fixinc.svr4\n \t\tfloat_format=i128\n \t\tbroken_install=yes\n- \t\tif [[ x$enable_threads = xyes ]]; then\n+\t\tif [[ x${enable_threads} = x ]]; then\n+\t\t    enable_threads=$have_pthread_h\n+\t\t    if [[ x${enable_threads} = x ]]; then\n+\t\t\tenable_threads=$have_thread_h\n+\t\t    fi\n+\t\tfi\n+\t\tif [[ x${enable_threads} = xyes ]]; then\n+\t\t    if [[ x${have_pthread_h} = xyes ]]; then\n+\t\t\tthread_file='posix'\n+\t\t    else\n \t\t\tthread_file='solaris'\n+\t\t    fi\n \t\tfi\n \t\t;;\n \tsparc-*-sunos4.0*)\n@@ -3078,6 +3100,15 @@ do\n \tesac\n done\n \n+# Make gthr-default.h if we have a thread file.\n+gthread_flags=\n+if [[ $thread_file != single ]]; then\n+    rm -f gthr-default.h\n+    $symbolic_link gthr-${thread_file}.h gthr-default.h\n+    gthread_flags=-DHAVE_GTHR_DEFAULT\n+fi\n+AC_SUBST(gthread_flags)\n+\n # Make empty files to contain the specs and options for each language.\n # Then add #include lines to for a compiler that has specs and/or options.\n "}, {"sha": "ab0a9705924d5e968962107d11f8ff05b9d434a9", "filename": "gcc/frame.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fframe.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fframe.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fframe.c?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -39,7 +39,7 @@ Boston, MA 02111-1307, USA.  */\n #include \"dwarf2.h\"\n #include <stddef.h>\n #include \"frame.h\"\n-#include \"libgcc-thr.h\"\n+#include \"gthr.h\"\n \n #ifdef __GTHREAD_MUTEX_INIT\n static __gthread_mutex_t object_mutex = __GTHREAD_MUTEX_INIT;"}, {"sha": "3cba8a0e4b867b6a23117e3700befc5439596400", "filename": "gcc/gthr-dce.h", "status": "added", "additions": 150, "deletions": 0, "changes": 150, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-dce.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-dce.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgthr-dce.h?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,150 @@\n+\n+/* Compile this one with gcc.  */\n+/* Copyright (C) 1997 Free Software Foundation, Inc.\n+\n+This file is part of GNU CC.\n+\n+GNU CC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 2, or (at your option)\n+any later version.\n+\n+GNU CC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GNU CC; see the file COPYING.  If not, write to\n+the Free Software Foundation, 59 Temple Place - Suite 330,\n+Boston, MA 02111-1307, USA.  */\n+\n+/* As a special exception, if you link this library with other files,\n+   some of which are compiled with GCC, to produce an executable,\n+   this library does not by itself cause the resulting executable\n+   to be covered by the GNU General Public License.\n+   This exception does not however invalidate any other reasons why\n+   the executable file might be covered by the GNU General Public License.  */\n+\n+#ifndef __gthr_dce_h\n+#define __gthr_dce_h\n+\n+/* DCE threads interface.\n+   DCE threads are based on POSIX threads draft 4, and many things\n+   have changed since then. */\n+\n+#define __GTHREADS 1\n+\n+#include <pthread.h>\n+\n+typedef pthread_key_t __gthread_key_t;\n+typedef pthread_once_t __gthread_once_t;\n+typedef pthread_mutex_t __gthread_mutex_t;\n+\n+#define __GTHREAD_ONCE_INIT pthread_once_init\n+/* Howto define __GTHREAD_MUTEX_INIT? */\n+\n+#if SUPPORTS_WEAK && GTHREAD_USE_WEAK\n+\n+#pragma weak pthread_once\n+#pragma weak pthread_once_init\n+#pragma weak pthread_key_create\n+#pragma weak pthread_key_delete\n+#pragma weak pthread_getspecific\n+#pragma weak pthread_setspecific\n+#pragma weak pthread_create\n+\n+#pragma weak pthread_mutex_lock\n+#pragma weak pthread_mutex_trylock\n+#pragma weak pthread_mutex_unlock\n+\n+static void *__gthread_active_ptr = &pthread_create;\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return __gthread_active_ptr != 0;\n+}\n+\n+#else /* not SUPPORTS_WEAK */\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return 1;\n+}\n+\n+#endif /* SUPPORTS_WEAK */\n+\n+static inline int\n+__gthread_once (__gthread_once_t *once, void (*func) ())\n+{\n+  if (__gthread_active_p ())\n+    return pthread_once (once, func);\n+  else\n+    return -1;\n+}\n+\n+static inline int\n+__gthread_key_create (__gthread_key_t *key, void (*dtor) (void *))\n+{\n+  return pthread_keycreate (key, dtor);\n+}\n+\n+static inline int\n+__gthread_key_dtor (__gthread_key_t key, void *ptr)\n+{\n+  /* Nothing needed. */\n+  return 0;\n+}\n+\n+static inline int\n+__gthread_key_delete (__gthread_key_t key)\n+{\n+  return pthread_key_delete (key);\n+}\n+\n+static inline void *\n+__gthread_getspecific (__gthread_key_t key)\n+{\n+  void *ptr;\n+  if (pthread_getspecific (key, &ptr) == 0)\n+    return ptr;\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_setspecific (__gthread_key_t key, const void *ptr)\n+{\n+  return pthread_setspecific (key, (void *) ptr);\n+}\n+\n+static inline int\n+__gthread_mutex_lock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return pthread_mutex_lock (mutex);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return pthread_mutex_trylock (mutex);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return pthread_mutex_unlock (mutex);\n+  else\n+    return 0;\n+}\n+\n+#endif /* not __gthr_dce_h */"}, {"sha": "19231c3c464d61c34292fc43ba395c97ad44867c", "filename": "gcc/gthr-posix.h", "status": "added", "additions": 147, "deletions": 0, "changes": 147, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-posix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-posix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgthr-posix.h?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,147 @@\n+/* Threads compatibily routines for libgcc2.  */\n+/* Compile this one with gcc.  */\n+/* Copyright (C) 1997 Free Software Foundation, Inc.\n+\n+This file is part of GNU CC.\n+\n+GNU CC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 2, or (at your option)\n+any later version.\n+\n+GNU CC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GNU CC; see the file COPYING.  If not, write to\n+the Free Software Foundation, 59 Temple Place - Suite 330,\n+Boston, MA 02111-1307, USA.  */\n+\n+/* As a special exception, if you link this library with other files,\n+   some of which are compiled with GCC, to produce an executable,\n+   this library does not by itself cause the resulting executable\n+   to be covered by the GNU General Public License.\n+   This exception does not however invalidate any other reasons why\n+   the executable file might be covered by the GNU General Public License.  */\n+\n+#ifndef __gthr_posix_h\n+#define __gthr_posix_h\n+\n+/* POSIX threads specific definitions.\n+   Easy, since the interface is just one-to-one mapping. */\n+\n+#define __GTHREADS 1\n+\n+#include <pthread.h>\n+\n+typedef pthread_key_t __gthread_key_t;\n+typedef pthread_once_t __gthread_once_t;\n+typedef pthread_mutex_t __gthread_mutex_t;\n+\n+#define __GTHREAD_MUTEX_INIT PTHREAD_MUTEX_INITIALIZER\n+#define __GTHREAD_ONCE_INIT PTHREAD_ONCE_INIT\n+\n+#if SUPPORTS_WEAK && GTHREAD_USE_WEAK\n+\n+#pragma weak pthread_once\n+#pragma weak pthread_key_create\n+#pragma weak pthread_key_delete\n+#pragma weak pthread_getspecific\n+#pragma weak pthread_setspecific\n+#pragma weak pthread_create\n+\n+#pragma weak pthread_mutex_lock \n+#pragma weak pthread_mutex_trylock \n+#pragma weak pthread_mutex_unlock \n+\n+static void *__gthread_active_ptr = &pthread_create;\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return __gthread_active_ptr != 0;\n+}\n+\n+#else /* not SUPPORTS_WEAK */\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return 1;\n+}\n+\n+#endif /* SUPPORTS_WEAK */\n+\n+static inline int\n+__gthread_once (__gthread_once_t *once, void (*func) ())\n+{\n+  if (__gthread_active_p ())\n+    return pthread_once (once, func);\n+  else\n+    return -1;\n+}\n+\n+static inline int\n+__gthread_key_create (__gthread_key_t *key, void (*dtor) (void *))\n+{\n+  return pthread_key_create (key, dtor);\n+}\n+\n+static inline int\n+__gthread_key_dtor (__gthread_key_t key, void *ptr)\n+{\n+  /* Just reset the key value to zero. */\n+  if (ptr)\n+    return pthread_setspecific (key, 0);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_key_delete (__gthread_key_t key)\n+{\n+  return pthread_key_delete (key);\n+}\n+\n+static inline void *\n+__gthread_getspecific (__gthread_key_t key)\n+{\n+  return pthread_getspecific (key);\n+}\n+\n+static inline int\n+__gthread_setspecific (__gthread_key_t key, const void *ptr)\n+{\n+  return pthread_setspecific (key, ptr);\n+}\n+\n+static inline int\n+__gthread_mutex_lock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return pthread_mutex_lock (mutex);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return pthread_mutex_trylock (mutex);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return pthread_mutex_unlock (mutex);\n+  else\n+    return 0;\n+}\n+\n+#endif /* not __gthr_posix_h */"}, {"sha": "72edfc352859ef09bb7f276ce611d19c56028d69", "filename": "gcc/gthr-single.h", "status": "added", "additions": 62, "deletions": 0, "changes": 62, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-single.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-single.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgthr-single.h?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,62 @@\n+/* Threads compatibily routines for libgcc2.  */\n+/* Compile this one with gcc.  */\n+/* Copyright (C) 1997 Free Software Foundation, Inc.\n+\n+This file is part of GNU CC.\n+\n+GNU CC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 2, or (at your option)\n+any later version.\n+\n+GNU CC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GNU CC; see the file COPYING.  If not, write to\n+the Free Software Foundation, 59 Temple Place - Suite 330,\n+Boston, MA 02111-1307, USA.  */\n+\n+/* As a special exception, if you link this library with other files,\n+   some of which are compiled with GCC, to produce an executable,\n+   this library does not by itself cause the resulting executable\n+   to be covered by the GNU General Public License.\n+   This exception does not however invalidate any other reasons why\n+   the executable file might be covered by the GNU General Public License.  */\n+\n+#ifndef __gthr_single_h\n+#define __gthr_single_h\n+\n+/* Just provide compatibility for mutex handling. */\n+\n+typedef int __gthread_mutex_t;\n+\n+#define __GTHREAD_MUTEX_INIT 0\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_lock (__gthread_mutex_t *mutex)\n+{\n+  return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n+{\n+  return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n+{\n+  return 0;\n+}\n+\n+#endif /* not __gthr_single_h */"}, {"sha": "465ececb13947c4ce90bccec62ea4853d133864b", "filename": "gcc/gthr-solaris.h", "status": "added", "additions": 179, "deletions": 0, "changes": 179, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-solaris.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr-solaris.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgthr-solaris.h?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,179 @@\n+/* Threads compatibily routines for libgcc2.  */\n+/* Compile this one with gcc.  */\n+/* Copyright (C) 1997 Free Software Foundation, Inc.\n+\n+This file is part of GNU CC.\n+\n+GNU CC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 2, or (at your option)\n+any later version.\n+\n+GNU CC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GNU CC; see the file COPYING.  If not, write to\n+the Free Software Foundation, 59 Temple Place - Suite 330,\n+Boston, MA 02111-1307, USA.  */\n+\n+/* As a special exception, if you link this library with other files,\n+   some of which are compiled with GCC, to produce an executable,\n+   this library does not by itself cause the resulting executable\n+   to be covered by the GNU General Public License.\n+   This exception does not however invalidate any other reasons why\n+   the executable file might be covered by the GNU General Public License.  */\n+\n+#ifndef __gthr_solaris_h\n+#define __gthr_solaris_h\n+\n+/* Solaris threads as found in Solaris 2.[456].\n+   Actually these are Unix International (UI) threads, but I don't\n+   know if anyone else implements these. */\n+\n+#define __GTHREADS 1\n+\n+#include <thread.h>\n+#include <errno.h>\n+\n+typedef thread_key_t __gthread_key_t;\n+typedef struct\n+{\n+  mutex_t mutex;\n+  int once;\n+} __gthread_once_t;\n+typedef mutex_t __gthread_mutex_t;\n+\n+#define __GTHREAD_ONCE_INIT { DEFAULTMUTEX, 0 }\n+#define __GTHREAD_MUTEX_INIT DEFAULTMUTEX\n+\n+#if SUPPORTS_WEAK && GTHREAD_USE_WEAK\n+\n+#pragma weak thr_keycreate\n+#pragma weak thr_getspecific\n+#pragma weak thr_setspecific\n+#pragma weak thr_create\n+\n+#pragma weak mutex_lock\n+#pragma weak mutex_trylock\n+#pragma weak mutex_unlock\n+\n+/* This will not actually work in Solaris 2.5, since libc contains\n+   dummy symbols of all thr_* routines. */\n+\n+static void *__gthread_active_ptr = &thr_create;\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return __gthread_active_ptr != 0;\n+}\n+\n+#else /* not SUPPORTS_WEAK */\n+\n+static inline int\n+__gthread_active_p ()\n+{\n+  return 1;\n+}\n+\n+#endif /* SUPPORTS_WEAK */\n+\n+static inline int\n+__gthread_once (__gthread_once_t *once, void (*func) ())\n+{\n+  if (! __gthread_active_p ())\n+    return -1;\n+\n+  if (once == 0 || func == 0)\n+    {\n+      errno = EINVAL;\n+      return -1;\n+    }\n+\n+  if (once->once == 0)\n+    {\n+      if (mutex_lock (&once->mutex) != 0)\n+\treturn -1;\n+      if (once->once == 0)\n+\t{\n+\t  (*func) ();\n+\t  once->once ++;\n+\t}\n+      mutex_unlock (&once->mutex);\n+    }\n+  return 0;\n+}\n+\n+static inline int\n+__gthread_key_create (__gthread_key_t *key, void (*dtor) (void *))\n+{\n+  /* Solaris 2.5 contains thr_* routines no-op in libc, so test if we actually\n+     got a reasonable key value, and if not, fail. */\n+  *key = -1;\n+  if (thr_keycreate (key, dtor) == -1 || *key == -1)\n+    return -1;\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_key_dtor (__gthread_key_t key, void *ptr)\n+{\n+  /* Nothing needed. */\n+  return 0;\n+}\n+\n+static inline int\n+__gthread_key_delete (__gthread_key_t key)\n+{\n+  /* Not possible. */\n+  return -1;\n+}\n+\n+static inline void *\n+__gthread_getspecific (__gthread_key_t key)\n+{\n+  void *ptr;\n+  if (thr_getspecific (key, &ptr) == 0)\n+    return ptr;\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_setspecific (__gthread_key_t key, const void *ptr)\n+{\n+  return thr_setspecific (key, (void *) ptr);\n+}\n+\n+static inline int\n+__gthread_mutex_lock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return mutex_lock (mutex);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return mutex_trylock (mutex);\n+  else\n+    return 0;\n+}\n+\n+static inline int\n+__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n+{\n+  if (__gthread_active_p ())\n+    return mutex_unlock (mutex);\n+  else\n+    return 0;\n+}\n+\n+#endif /* not __gthr_solaris_h */"}, {"sha": "54ad6b04c8dab4e1a6982d7a53eb435eb63f8819", "filename": "gcc/gthr.h", "status": "added", "additions": 96, "deletions": 0, "changes": 96, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fgthr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgthr.h?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,96 @@\n+/* Threads compatibily routines for libgcc2.  */\n+/* Compile this one with gcc.  */\n+/* Copyright (C) 1997 Free Software Foundation, Inc.\n+\n+This file is part of GNU CC.\n+\n+GNU CC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 2, or (at your option)\n+any later version.\n+\n+GNU CC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GNU CC; see the file COPYING.  If not, write to\n+the Free Software Foundation, 59 Temple Place - Suite 330,\n+Boston, MA 02111-1307, USA.  */\n+\n+/* As a special exception, if you link this library with other files,\n+   some of which are compiled with GCC, to produce an executable,\n+   this library does not by itself cause the resulting executable\n+   to be covered by the GNU General Public License.\n+   This exception does not however invalidate any other reasons why\n+   the executable file might be covered by the GNU General Public License.  */\n+\n+#ifndef __gthr_h\n+#define __gthr_h\n+\n+/* If this file is compiled with threads support, it must\n+       #define __GTHREADS 1\n+   to indicate that threads support is present.  Also it has define\n+   function \n+     int __gthread_active_p ()\n+   that returns 1 if thread system is active, 0 if not.\n+\n+   The threads interface must define the following types:\n+     __gthread_key_t\n+     __gthread_once_t\n+     __gthread_mutex_t\n+\n+   The threads interface must define the following macros:\n+\n+     __GTHREAD_ONCE_INIT\n+     \t\tto initialize __gthread_once_t\n+     __GTHREAD_MUTEX_INIT\n+     \t\tto initialize __gthread_mutex_t to get a fast\n+\t\tnon-recursive mutex.\n+\n+   The threads interface must define the following static functions:\n+\n+     int __gthread_once (__gthread_once_t *once, void (*func) ())\n+\n+     int __gthread_key_create (__gthread_key_t *keyp, void (*dtor) (void *))\n+     int __gthread_key_delete (__gthread_key_t key)\n+\n+     int __gthread_key_dtor (__gthread_key_t key, void *ptr)\n+\n+     void *__gthread_getspecific (__gthread_key_t key)\n+     int __gthread_setspecific (__gthread_key_t key, const void *ptr)\n+\n+     int __gthread_mutex_lock (__gthread_mutex_t *mutex);\n+     int __gthread_mutex_trylock (__gthread_mutex_t *mutex);\n+     int __gthread_mutex_unlock (__gthread_mutex_t *mutex);\n+\n+   All functions returning int should return 0 on success, -1 on error.\n+\n+   Currently supported threads packages are\n+     POSIX threads with -D_PTHREADS\n+     DCE threads with -D_DCE_THREADS\n+     Solaris/UI threads with -D_SOLARIS_THREADS\n+*/\n+\n+/* Check first for thread specific defines. */\n+#if _PTHREADS\n+#include \"gthr-posix.h\"\n+#elif _DCE_THREADS\n+#include \"gthr-dce.h\"\n+#elif _SOLARIS_THREADS\n+#include \"gthr-solaris.h\"\n+\n+/* Include GTHREAD_FILE if one is defined. */\n+#elif SUPPORTS_WEAK && HAVE_GTHR_DEFAULT\n+#ifndef GTHREAD_USE_WEAK\n+#define GTHREAD_USE_WEAK 1\n+#endif\n+#include \"gthr-default.h\"\n+\n+/* Fallback to single thread definitions. */\n+#else\n+#include \"gthr-single.h\"\n+#endif\n+\n+#endif /* not __gthr_h */"}, {"sha": "53813c5c7899ca11653d251f00375ab7840450e4", "filename": "gcc/libgcc-thr.h", "status": "removed", "additions": 0, "deletions": 321, "changes": 321, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df3b6ab30ea4e3310b79eadb2c41fb6243d3b4aa/gcc%2Flibgcc-thr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df3b6ab30ea4e3310b79eadb2c41fb6243d3b4aa/gcc%2Flibgcc-thr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flibgcc-thr.h?ref=df3b6ab30ea4e3310b79eadb2c41fb6243d3b4aa", "patch": "@@ -1,321 +0,0 @@\n-/* Threads compatibily routines for libgcc2.  */\n-/* Compile this one with gcc.  */\n-/* Copyright (C) 1997 Free Software Foundation, Inc.\n-\n-This file is part of GNU CC.\n-\n-GNU CC is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 2, or (at your option)\n-any later version.\n-\n-GNU CC is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with GNU CC; see the file COPYING.  If not, write to\n-the Free Software Foundation, 59 Temple Place - Suite 330,\n-Boston, MA 02111-1307, USA.  */\n-\n-/* As a special exception, if you link this library with other files,\n-   some of which are compiled with GCC, to produce an executable,\n-   this library does not by itself cause the resulting executable\n-   to be covered by the GNU General Public License.\n-   This exception does not however invalidate any other reasons why\n-   the executable file might be covered by the GNU General Public License.  */\n-\n-#ifndef __libgcc_thr_h\n-#define __libgcc_thr_h\n-\n-/* If this file is compiled with threads support, it must\n-       #define __GTHREADS 1\n-   to indicate that threads support is present.\n-   \n-   The threads interface must define the following types:\n-     __gthread_key_t\n-     __gthread_once_t\n-     __gthread_mutex_t\n-\n-   The threads interface must define the following macros:\n-\n-     __GTHREAD_ONCE_INIT\n-     \t\tto initialize __gthread_once_t\n-     __GTHREAD_MUTEX_INIT\n-     \t\tto initialize __gthread_mutex_t to get a fast\n-\t\tnon-recursive mutex.\n-\n-   The threads interface must define the following static functions:\n-\n-     int __gthread_once (__gthread_once_t *once, void (*func) ())\n-\n-     int __gthread_key_create (__gthread_key_t *keyp, void (*dtor) (void *))\n-     int __gthread_key_delete (__gthread_key_t key)\n-\n-     void *__gthread_getspecific (__gthread_key_t key)\n-     int __gthread_setspecific (__gthread_key_t key, const void *ptr)\n-\n-     int __gthread_mutex_lock (__gthread_mutex_t *mutex);\n-     int __gthread_mutex_trylock (__gthread_mutex_t *mutex);\n-     int __gthread_mutex_unlock (__gthread_mutex_t *mutex);\n-\n-   All functions returning int should return 0 on success, -1 on error.\n-\n-   Currently supported threads packages are\n-     POSIX threads with -D_PTHREADS\n-     DCE threads with -D_DCE_THREADS\n-     Solaris/UI threads with -D_SOLARIS_THREADS\n-*/\n-\n-#if _PTHREADS\n-/* POSIX threads specific definitions.\n-   Easy, since the interface is just one-to-one mapping. */\n-\n-#define __GTHREADS 1\n-\n-#include <pthread.h>\n-\n-typedef pthread_key_t __gthread_key_t;\n-typedef pthread_once_t __gthread_once_t;\n-typedef pthread_mutex_t __gthread_mutex_t;\n-\n-#define __GTHREAD_MUTEX_INIT PTHREAD_MUTEX_INITIALIZER\n-#define __GTHREAD_ONCE_INIT PTHREAD_ONCE_INIT\n-\n-static inline int\n-__gthread_once (__gthread_once_t *once, void (*func) ())\n-{\n-  return pthread_once (once, func);\n-}\n-\n-static inline int\n-__gthread_key_create (__gthread_key_t *key, void (*dtor) (void *))\n-{\n-  return pthread_key_create (key, dtor);\n-}\n-\n-static inline int\n-__gthread_key_delete (__gthread_key_t key)\n-{\n-  return pthread_key_delete (key);\n-}\n-\n-static inline void *\n-__gthread_getspecific (__gthread_key_t key)\n-{\n-  return pthread_getspecific (key);\n-}\n-\n-static inline int\n-__gthread_setspecific (__gthread_key_t key, const void *ptr)\n-{\n-  return pthread_setspecific (key, ptr);\n-}\n-\n-static inline int\n-__gthread_mutex_lock (__gthread_mutex_t *mutex)\n-{\n-  return pthread_mutex_lock (mutex);\n-}\n-\n-static inline int\n-__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n-{\n-  return pthread_mutex_trylock (mutex);\n-}\n-\n-static inline int\n-__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n-{\n-  return pthread_mutex_unlock (mutex);\n-}\n-\n-#elif _DCE_THREADS\n-/* DCE threads interface.\n-   DCE threads are based on POSIX threads draft 4, and many things\n-   have changed since then. */\n-\n-#define __GTHREADS 1\n-\n-#include <pthread.h>\n-\n-typedef pthread_key_t __gthread_key_t;\n-typedef pthread_once_t __gthread_once_t;\n-typedef pthread_mutex_t __gthread_mutex_t;\n-\n-#define __GTHREAD_ONCE_INIT pthread_once_init\n-/* Howto define __GTHREAD_MUTEX_INIT? */\n-\n-static inline int\n-__gthread_once (__gthread_once_t *once, void (*func) ())\n-{\n-  return pthread_once (once, func);\n-}\n-\n-static inline int\n-__gthread_key_create (__gthread_key_t *key, void (*dtor) (void *))\n-{\n-  return pthread_keycreate (key, dtor);\n-}\n-\n-static inline int\n-__gthread_key_delete (__gthread_key_t key)\n-{\n-  return pthread_key_delete (key);\n-}\n-\n-static inline void *\n-__gthread_getspecific (__gthread_key_t key)\n-{\n-  void *ptr;\n-  if (pthread_getspecific (key, &ptr) == 0)\n-    return ptr;\n-  else\n-    return 0;\n-}\n-\n-static inline int\n-__gthread_setspecific (__gthread_key_t key, const void *ptr)\n-{\n-  return pthread_setspecific (key, (void *) ptr);\n-}\n-\n-static inline int\n-__gthread_mutex_lock (__gthread_mutex_t *mutex)\n-{\n-  return pthread_mutex_lock (mutex);\n-}\n-\n-static inline int\n-__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n-{\n-  return pthread_mutex_trylock (mutex);\n-}\n-\n-static inline int\n-__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n-{\n-  return pthread_mutex_unlock (mutex);\n-}\n-\n-#elif _SOLARIS_THREADS\n-/* Solaris threads as found in Solaris 2.[456].\n-   Actually these are Unix International (UI) threads, but I don't\n-   know if anyone else implements these. */\n-\n-#define __GTHREADS 1\n-\n-#include <thread.h>\n-#include <errno.h>\n-\n-typedef thread_key_t __gthread_key_t;\n-typedef struct\n-{\n-  mutex_t mutex;\n-  int once;\n-} __gthread_once_t;\n-typedef mutex_t __gthread_mutex_t;\n-\n-#define __GTHREAD_ONCE_INIT { DEFAULTMUTEX, 0 }\n-#define __GTHREAD_MUTEX_INIT DEFAULTMUTEX\n-\n-static inline int\n-__gthread_once (__gthread_once_t *once, void (*func) ())\n-{\n-  if (once == 0 || func == 0)\n-    {\n-      errno = EINVAL;\n-      return -1;\n-    }\n-\n-  if (once->once == 0)\n-    {\n-      if (mutex_lock (&once->mutex) != 0)\n-\treturn -1;\n-      if (once->once == 0)\n-\t{\n-\t  (*func) ();\n-\t  once->once ++;\n-\t}\n-      mutex_unlock (&once->mutex);\n-    }\n-  return 0;\n-}\n-\n-static inline int\n-__gthread_key_create (__gthread_key_t *key, void (*dtor) (void *))\n-{\n-  return thr_keycreate (key, dtor);\n-}\n-\n-static inline int\n-__gthread_key_delete (__gthread_key_t key)\n-{\n-  /* Not possible. */\n-  return -1;\n-}\n-\n-static inline void *\n-__gthread_getspecific (__gthread_key_t key)\n-{\n-  void *ptr;\n-  if (thr_getspecific (key, &ptr) == 0)\n-    return ptr;\n-  else\n-    return 0;\n-}\n-\n-static inline int\n-__gthread_setspecific (__gthread_key_t key, const void *ptr)\n-{\n-  return thr_setspecific (key, (void *) ptr);\n-}\n-\n-static inline int\n-__gthread_mutex_lock (__gthread_mutex_t *mutex)\n-{\n-  return mutex_lock (mutex);\n-}\n-\n-static inline int\n-__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n-{\n-  return mutex_trylock (mutex);\n-}\n-\n-static inline int\n-__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n-{\n-  return mutex_unlock (mutex);\n-}\n-\n-#else /* no threads */\n-\n-/* Just provide compatibility for mutex handling. */\n-\n-typedef int __gthread_mutex_t;\n-\n-#define __GTHREAD_MUTEX_INIT 0\n-\n-static inline int\n-__gthread_mutex_lock (__gthread_mutex_t *mutex)\n-{\n-  return 0;\n-}\n-\n-static inline int\n-__gthread_mutex_trylock (__gthread_mutex_t *mutex)\n-{\n-  return 0;\n-}\n-\n-static inline int\n-__gthread_mutex_unlock (__gthread_mutex_t *mutex)\n-{\n-  return 0;\n-}\n-\n-#endif /* no threads */\n-\n-#endif /* not __libgcc_thr_h */"}, {"sha": "46dbdaafb16e0e559f0f680129c1033607f07312", "filename": "gcc/libgcc2.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Flibgcc2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Flibgcc2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flibgcc2.c?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -2965,7 +2965,7 @@ int _exit_dummy_decl = 0;\t/* prevent compiler & linker warnings */\n \f\n #ifdef L_eh\n \n-#include \"libgcc-thr.h\"\n+#include \"gthr.h\"\n \n /* Shared exception handling support routines.  */\n \n@@ -3038,6 +3038,7 @@ static __gthread_key_t eh_context_key;\n static void\n eh_context_free (void *ptr)\n {\n+  __gthread_key_dtor (eh_context_key, ptr);\n   if (ptr)\n     free (ptr);\n }\n@@ -3094,7 +3095,11 @@ eh_context_initialize ()\n #if __GTHREADS\n \n   static __gthread_once_t once = __GTHREAD_ONCE_INIT;\n-  __gthread_once (&once, eh_threads_initialize);\n+  if (__gthread_once (&once, eh_threads_initialize) == -1)\n+    {\n+      /* Use static version of EH context. */\n+      get_eh_context = &eh_context_static;\n+    }\n \n #else /* no __GTHREADS */\n "}, {"sha": "0f7063b7e836116e98f1e31a1fe3fe4188fb2372", "filename": "gcc/objc/thr-dce.c", "status": "added", "additions": 281, "deletions": 0, "changes": 281, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fobjc%2Fthr-dce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f24af81bcad5190a51bd36309ab43dd3d5e3cc9d/gcc%2Fobjc%2Fthr-dce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fthr-dce.c?ref=f24af81bcad5190a51bd36309ab43dd3d5e3cc9d", "patch": "@@ -0,0 +1,281 @@\n+/* GNU Objective C Runtime Thread Interface\n+   Copyright (C) 1996, 1997 Free Software Foundation, Inc.\n+   Contributed by Galen C. Hunt (gchunt@cs.rochester.edu)\n+\n+This file is part of GNU CC.\n+\n+GNU CC is free software; you can redistribute it and/or modify it under the\n+terms of the GNU General Public License as published by the Free Software\n+Foundation; either version 2, or (at your option) any later version.\n+\n+GNU CC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more\n+details.\n+\n+You should have received a copy of the GNU General Public License along with\n+GNU CC; see the file COPYING.  If not, write to the Free Software\n+Foundation, 59 Temple Place - Suite 330,\n+Boston, MA 02111-1307, USA.  */\n+\n+/* As a special exception, if you link this library with files compiled with\n+   GCC to produce an executable, this does not cause the resulting executable\n+   to be covered by the GNU General Public License. This exception does not\n+   however invalidate any other reasons why the executable file might be\n+   covered by the GNU General Public License.  */\n+\n+#include <pthread.h>\n+#include <objc/thr.h>\n+#include \"runtime.h\"\n+\n+/* Key structure for maintaining thread specific storage */\n+static pthread_key_t _objc_thread_storage;\n+\n+/* Backend initialization functions */\n+\n+/* Initialize the threads subsystem. */\n+int\n+__objc_init_thread_system(void)\n+{\n+  /* Initialize the thread storage key */\n+  return pthread_keycreate(&_objc_thread_storage, NULL);\n+}\n+\n+/* Close the threads subsystem. */\n+int\n+__objc_close_thread_system(void)\n+{\n+  /* Destroy the thread storage key */\n+  /* Not implemented yet */\n+  /* return pthread_key_delete(&_objc_thread_storage); */\n+  return 0;\n+}\n+\n+/* Backend thread functions */\n+\n+/* Create a new thread of execution. */\n+objc_thread_t\n+__objc_thread_detach(void (*func)(void *arg), void *arg)\n+{\n+  objc_thread_t thread_id;\n+  pthread_t new_thread_handle;\n+\n+  if (pthread_create(&new_thread_handle, pthread_attr_default,\n+\t\t     (void *)func, arg) == 0)\n+    {\n+      /* ??? May not work! (64bit) */\n+      thread_id = *(objc_thread_t *)&new_thread_handle; \n+      pthread_detach(&new_thread_handle);     /* Fully detach thread.     */\n+    }\n+  else\n+    thread_id = NULL;\n+  \n+  return thread_id;\n+}\n+\n+/* Set the current thread's priority. */\n+int\n+__objc_thread_set_priority(int priority)\n+{\n+  int sys_priority = 0;\n+\n+  switch (priority)\n+    {\n+    case OBJC_THREAD_INTERACTIVE_PRIORITY:\n+      sys_priority = (PRI_FG_MIN_NP + PRI_FG_MAX_NP) / 2;\n+      break;\n+    default:\n+    case OBJC_THREAD_BACKGROUND_PRIORITY:\n+      sys_priority = (PRI_BG_MIN_NP + PRI_BG_MAX_NP) / 2;\n+      break;\n+    case OBJC_THREAD_LOW_PRIORITY:\n+      sys_priority = (PRI_BG_MIN_NP + PRI_BG_MAX_NP) / 2;\n+      break;\n+    }\n+    \n+  /* Change the priority. */\n+  if (pthread_setprio(pthread_self(), sys_priority) >= 0)\n+    return 0;\n+  else\n+    /* Failed */\n+    return -1;\n+}\n+\n+/* Return the current thread's priority. */\n+int\n+__objc_thread_get_priority(void)\n+{\n+  int sys_priority;\n+    \n+  if ((sys_priority = pthread_getprio(pthread_self())) >= 0) {\n+    if (sys_priority >= PRI_FG_MIN_NP && sys_priority <= PRI_FG_MAX_NP)\n+      return OBJC_THREAD_INTERACTIVE_PRIORITY;\n+    if (sys_priority >= PRI_BG_MIN_NP && sys_priority <= PRI_BG_MAX_NP)\n+      return OBJC_THREAD_BACKGROUND_PRIORITY;\n+    return OBJC_THREAD_LOW_PRIORITY;\n+  }\n+\n+  /* Failed */\n+  return -1;\n+}\n+\n+/* Yield our process time to another thread. */\n+void\n+__objc_thread_yield(void)\n+{\n+  pthread_yield();\n+}\n+\n+/* Terminate the current thread. */\n+int\n+__objc_thread_exit(void)\n+{\n+  /* exit the thread */\n+  pthread_exit(&__objc_thread_exit_status);\n+\n+  /* Failed if we reached here */\n+  return -1;\n+}\n+\n+/* Returns an integer value which uniquely describes a thread. */\n+objc_thread_t\n+__objc_thread_id(void)\n+{\n+  pthread_t self = pthread_self();\n+\n+  return (objc_thread_t) pthread_getunique_np (&self);\n+}\n+\n+/* Sets the thread's local storage pointer. */\n+int\n+__objc_thread_set_data(void *value)\n+{\n+  return pthread_setspecific(_objc_thread_storage, value);\n+}\n+\n+/* Returns the thread's local storage pointer. */\n+void *\n+__objc_thread_get_data(void)\n+{\n+  void *value = NULL;\n+\n+  if ( !(pthread_getspecific(_objc_thread_storage, &value)) )\n+    return value;\n+\n+  return NULL;\n+}\n+\n+/* Backend mutex functions */\n+\n+/* Allocate a mutex. */\n+int\n+__objc_mutex_allocate(objc_mutex_t mutex)\n+{\n+  if (pthread_mutex_init((pthread_mutex_t *)(&(mutex->backend)), \n+\t\t\t pthread_mutexattr_default))\n+    return -1;\n+  else\n+    return 0;\n+}\n+\n+/* Deallocate a mutex. */\n+int\n+__objc_mutex_deallocate(objc_mutex_t mutex)\n+{\n+  if (pthread_mutex_destroy((pthread_mutex_t *)(&(mutex->backend))))\n+    return -1;\n+  else\n+    return 0;\n+}\n+\n+/* Grab a lock on a mutex. */\n+int\n+__objc_mutex_lock(objc_mutex_t mutex)\n+{\n+  return pthread_mutex_lock((pthread_mutex_t *)(&(mutex->backend)));\n+}\n+\n+/* Try to grab a lock on a mutex. */\n+int\n+__objc_mutex_trylock(objc_mutex_t mutex)\n+{\n+  if (pthread_mutex_trylock((pthread_mutex_t *)(&(mutex->backend))) != 1)\n+    return -1;\n+  else\n+    return 0;\n+}\n+\n+/* Unlock the mutex */\n+int\n+__objc_mutex_unlock(objc_mutex_t mutex)\n+{\n+  return pthread_mutex_unlock((pthread_mutex_t *)(&(mutex->backend)));\n+}\n+\n+/* Backend condition mutex functions */\n+\n+/* Allocate a condition. */\n+int\n+__objc_condition_allocate(objc_condition_t condition)\n+{\n+  /* Unimplemented. */\n+  return -1;\n+\n+  /*\n+  if (pthread_cond_init((pthread_cond_t *)(&(condition->backend)), NULL))\n+    return -1;\n+  else\n+    return 0;\n+    */\n+}\n+\n+/* Deallocate a condition. */\n+int\n+__objc_condition_deallocate(objc_condition_t condition)\n+{\n+  /* Unimplemented. */\n+  return -1;\n+\n+  /*\n+  return pthread_cond_destroy((pthread_cond_t *)(&(condition->backend)));\n+  */\n+}\n+\n+/* Wait on the condition */\n+int\n+__objc_condition_wait(objc_condition_t condition, objc_mutex_t mutex)\n+{\n+  /* Unimplemented. */\n+  return -1;\n+\n+  /*\n+  return pthread_cond_wait((pthread_cond_t *)(&(condition->backend)),\n+\t\t\t   (pthread_mutex_t *)(&(mutex->backend)));\n+\t\t\t   */\n+}\n+\n+/* Wake up all threads waiting on this condition. */\n+int\n+__objc_condition_broadcast(objc_condition_t condition)\n+{\n+  /* Unimplemented. */\n+  return -1;\n+\n+  /*\n+  return pthread_cond_broadcast((pthread_cond_t *)(&(condition->backend)));\n+  */\n+}\n+\n+/* Wake up one thread waiting on this condition. */\n+int\n+__objc_condition_signal(objc_condition_t condition)\n+{\n+  /* Unimplemented. */\n+  return -1;\n+\n+  /*\n+  return pthread_cond_signal((pthread_cond_t *)(&(condition->backend)));\n+  */\n+}\n+\n+/* End of File */"}]}