{"sha": "b57e6e182cc596dd2e346b5799b57014ced47229", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjU3ZTZlMTgyY2M1OTZkZDJlMzQ2YjU3OTliNTcwMTRjZWQ0NzIyOQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2016-03-17T15:11:35Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2016-03-17T15:11:35Z"}, "message": "Properly set flag_pie and flag_pic\n\nWe can't set flag_pie to the default when flag_pic == 0, which may be\nset by -fno-pic or -fno-PIC, since the default value of flag_pie is\nnon-zero when GCC is configured with --enable-default-pie.  We need\nto initialize flag_pic to -1 so that we can tell if -fpic, -fPIC,\n-fno-pic or -fno-PIC is used.\n\nSince Darwin defaults to PIC (__PIC__ == 2) and the PIC setting can't\nbe changed, skip tests of default __PIC__ and __PIE__ setting for\n*-*-darwin* targets.\n\ngcc/\n\n\tPR driver/70192\n\t* opts.c (finish_options): Don't set flag_pie to the default if\n\t-fpic, -fPIC, -fno-pic or -fno-PIC is used.  Set flag_pic to 0\n\tif it is -1.\n\ngcc/testsuite/\n\n\tPR driver/70192\n\t* gcc.dg/pic-1.c: New test.\n\t* gcc.dg/pic-2.c: Likewise.\n\t* gcc.dg/pic-3.c: Likewise.\n\t* gcc.dg/pic-4.c: Likewise.\n\t* gcc.dg/pie-1.c: Likewise.\n\t* gcc.dg/pie-2.c: Likewise.\n\t* gcc.dg/pie-3.c: Likewise.\n\t* gcc.dg/pie-4.c: Likewise.\n\t* gcc.dg/pie-5.c: Likewise.\n\t* gcc.dg/pie-6.c: Likewise.\n\nFrom-SVN: r234295", "tree": {"sha": "17ba6d251c6be7998bf2b5fdac8d60ecdc3b210c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/17ba6d251c6be7998bf2b5fdac8d60ecdc3b210c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b57e6e182cc596dd2e346b5799b57014ced47229", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b57e6e182cc596dd2e346b5799b57014ced47229", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b57e6e182cc596dd2e346b5799b57014ced47229", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b57e6e182cc596dd2e346b5799b57014ced47229/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "91106e8435c68963f7f0a8e6bf45acb0b2a432ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91106e8435c68963f7f0a8e6bf45acb0b2a432ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91106e8435c68963f7f0a8e6bf45acb0b2a432ab"}], "stats": {"total": 128, "additions": 125, "deletions": 3}, "files": [{"sha": "b7711b8d00b5c15564c56e731664093d5b3b7936", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -1,3 +1,10 @@\n+2016-03-17  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR driver/70192\n+\t* opts.c (finish_options): Don't set flag_pie to the default if\n+\t-fpic, -fPIC, -fno-pic or -fno-PIC is used.  Set flag_pic to 0\n+\tif it is -1.\n+\n 2016-03-17  Joern Rennecke  <joern.rennecke@embecosm.com>\n \n \t* config/i386/i386.md (*movv4qicc_insn+1..36): Pass"}, {"sha": "67048db7c9baf3a0d6098963c0b8f5131d1a8889", "filename": "gcc/common.opt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Fcommon.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Fcommon.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon.opt?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -1840,15 +1840,15 @@ Common Report Var(flag_peephole2) Optimization\n Enable an RTL peephole pass before sched2.\n \n fPIC\n-Common Report Var(flag_pic,2) Negative(fPIE)\n+Common Report Var(flag_pic,2) Negative(fPIE) Init(-1)\n Generate position-independent code if possible (large mode).\n \n fPIE\n Common Report Var(flag_pie,2) Negative(fpic) Init(-1)\n Generate position-independent code for executables if possible (large mode).\n \n fpic\n-Common Report Var(flag_pic,1) Negative(fpie)\n+Common Report Var(flag_pic,1) Negative(fpie) Init(-1)\n Generate position-independent code if possible (small mode).\n \n fpie"}, {"sha": "0f9431a0b3231e57605a1af44774bc1e6980bfc3", "filename": "gcc/opts.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Fopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Fopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -766,13 +766,18 @@ finish_options (struct gcc_options *opts, struct gcc_options *opts_set,\n \t default value.  */\n       if (opts->x_flag_pie == -1)\n \t{\n-\t  if (opts->x_flag_pic == 0)\n+\t  /* We initialize opts->x_flag_pic to -1 so that we can tell if\n+\t     -fpic, -fPIC, -fno-pic or -fno-PIC is used.  */\n+\t  if (opts->x_flag_pic == -1)\n \t    opts->x_flag_pie = DEFAULT_FLAG_PIE;\n \t  else\n \t    opts->x_flag_pie = 0;\n \t}\n+      /* If -fPIE or -fpie is used, turn on PIC.  */\n       if (opts->x_flag_pie)\n \topts->x_flag_pic = opts->x_flag_pie;\n+      else if (opts->x_flag_pic == -1)\n+\topts->x_flag_pic = 0;\n       if (opts->x_flag_pic && !opts->x_flag_pie)\n \topts->x_flag_shlib = 1;\n       opts->x_flag_opts_finished = true;"}, {"sha": "c59417ed2c2f45659295c3e24242a6c1ee2853f2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -1,3 +1,17 @@\n+2016-03-17  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR driver/70192\n+\t* gcc.dg/pic-1.c: New test.\n+\t* gcc.dg/pic-2.c: Likewise.\n+\t* gcc.dg/pic-3.c: Likewise.\n+\t* gcc.dg/pic-4.c: Likewise.\n+\t* gcc.dg/pie-1.c: Likewise.\n+\t* gcc.dg/pie-2.c: Likewise.\n+\t* gcc.dg/pie-3.c: Likewise.\n+\t* gcc.dg/pie-4.c: Likewise.\n+\t* gcc.dg/pie-5.c: Likewise.\n+\t* gcc.dg/pie-6.c: Likewise.\n+\n 2016-03-17  Tom de Vries  <tom@codesourcery.com>\n \n \t* gfortran.dg/goacc/kernels-alias-3.f95: New test."}, {"sha": "86360aa3ae4efd4716ed8d06704fd9c999e4899a", "filename": "gcc/testsuite/gcc.dg/pic-1.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-1.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target { ! *-*-darwin* } } } */\n+/* { dg-options \"-fpic\" } */\n+\n+#if __PIC__ != 1\n+# error __PIC__ is not 1!\n+#endif\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}, {"sha": "2c742e932b84ff112b454ffbf522885c39f0e9fc", "filename": "gcc/testsuite/gcc.dg/pic-2.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-2.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fPIC\" } */\n+\n+#if __PIC__ != 2\n+# error __PIC__ is not 2!\n+#endif\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}, {"sha": "7c4bbced2186be1fd21976f12899b6f5dcae672b", "filename": "gcc/testsuite/gcc.dg/pic-3.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-3.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target { ! *-*-darwin* } } } */\n+/* { dg-options \"-fno-pic\" } */\n+\n+#ifdef __PIC__\n+# error __PIC__ is defined!\n+#endif\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}, {"sha": "727fe14bace16aee7aaed9be96d66465d6b12608", "filename": "gcc/testsuite/gcc.dg/pic-4.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpic-4.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target { ! *-*-darwin* } } } */\n+/* { dg-options \"-fno-PIC\" } */\n+\n+#ifdef __PIC__\n+# error __PIC__ is defined!\n+#endif\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}, {"sha": "ca43e8b7adccab70d0fbd2828889206d6392c3a3", "filename": "gcc/testsuite/gcc.dg/pie-1.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-1.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target { ! *-*-darwin* } } } */\n+/* { dg-options \"-fpie\" } */\n+\n+#if __PIC__ != 1\n+# error __PIC__ is not 1!\n+#endif\n+\n+#if __PIE__ != 1\n+# error __PIE__ is not 1!\n+#endif"}, {"sha": "e185e5156557b1b6d80bb141e76cee44d6a28cd1", "filename": "gcc/testsuite/gcc.dg/pie-2.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-2.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fPIE\" } */\n+\n+#if __PIC__ != 2\n+# error __PIC__ is not 2!\n+#endif\n+\n+#if __PIE__ != 2\n+# error __PIE__ is not 2!\n+#endif"}, {"sha": "0ccc56b194d473ddea35b30ef36da89f83daf59b", "filename": "gcc/testsuite/gcc.dg/pie-3.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-3.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target { ! *-*-darwin* } } } */\n+/* { dg-options \"-fno-pie\" } */\n+\n+#ifdef __PIC__\n+# error __PIC__ is defined!\n+#endif\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}, {"sha": "f42bad3d297f12b3acf5cd94933a82db2c1b0ed7", "filename": "gcc/testsuite/gcc.dg/pie-4.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-4.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target { ! *-*-darwin* } } } */\n+/* { dg-options \"-fno-PIE\" } */\n+\n+#ifdef __PIC__\n+# error __PIC__ is defined!\n+#endif\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}, {"sha": "d49554f184c6befc9c9c58e3cde71896eceb06fc", "filename": "gcc/testsuite/gcc.dg/pie-5.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-5.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile { target pie_enabled } } */\n+/* { dg-options \"\" } */\n+\n+#ifndef __PIC__\n+# error __PIC__ is not defined!\n+#endif\n+\n+#ifndef __PIE__\n+# error __PIE__ is not defined!\n+#endif"}, {"sha": "fac1e945f6952d4cb8e80cd45c4f58c13f198d97", "filename": "gcc/testsuite/gcc.dg/pie-6.c", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-6.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b57e6e182cc596dd2e346b5799b57014ced47229/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-6.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpie-6.c?ref=b57e6e182cc596dd2e346b5799b57014ced47229", "patch": "@@ -0,0 +1,6 @@\n+/* { dg-do compile { target { ! pie_enabled } } } */\n+/* { dg-options \"\" } */\n+\n+#ifdef __PIE__\n+# error __PIE__ is defined!\n+#endif"}]}