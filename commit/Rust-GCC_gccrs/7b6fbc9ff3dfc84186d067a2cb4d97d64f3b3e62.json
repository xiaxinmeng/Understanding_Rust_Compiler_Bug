{"sha": "7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2I2ZmJjOWZmM2RmYzg0MTg2ZDA2N2EyY2I0ZDk3ZDY0ZjNiM2U2Mg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@adacore.com", "date": "2020-06-17T08:00:47Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2020-07-27T08:05:19Z"}, "message": "[Ada] AI12-0377 View conversions and out parameters revisited\n\ngcc/ada/\n\n\t* sem_res.adb (Resolve_Actuals): Refine 6.4.1 rules as per\n\tAI12-0377.", "tree": {"sha": "fad2d5a8b285b41517befb9add8c12f35c4cab30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fad2d5a8b285b41517befb9add8c12f35c4cab30"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62/comments", "author": {"login": "ArnaudCharlet", "id": 30291825, "node_id": "MDQ6VXNlcjMwMjkxODI1", "avatar_url": "https://avatars.githubusercontent.com/u/30291825?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ArnaudCharlet", "html_url": "https://github.com/ArnaudCharlet", "followers_url": "https://api.github.com/users/ArnaudCharlet/followers", "following_url": "https://api.github.com/users/ArnaudCharlet/following{/other_user}", "gists_url": "https://api.github.com/users/ArnaudCharlet/gists{/gist_id}", "starred_url": "https://api.github.com/users/ArnaudCharlet/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ArnaudCharlet/subscriptions", "organizations_url": "https://api.github.com/users/ArnaudCharlet/orgs", "repos_url": "https://api.github.com/users/ArnaudCharlet/repos", "events_url": "https://api.github.com/users/ArnaudCharlet/events{/privacy}", "received_events_url": "https://api.github.com/users/ArnaudCharlet/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d4fe2035920a2440ca2d787cefc6eca03a4af40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d4fe2035920a2440ca2d787cefc6eca03a4af40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d4fe2035920a2440ca2d787cefc6eca03a4af40"}], "stats": {"total": 37, "additions": 22, "deletions": 15}, "files": [{"sha": "4dc19f35a86977925655564df3cd04271cf93849", "filename": "gcc/ada/sem_res.adb", "status": "modified", "additions": 22, "deletions": 15, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62/gcc%2Fada%2Fsem_res.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62/gcc%2Fada%2Fsem_res.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_res.adb?ref=7b6fbc9ff3dfc84186d067a2cb4d97d64f3b3e62", "patch": "@@ -4175,27 +4175,34 @@ package body Sem_Res is\n                         end if;\n                      end if;\n \n-                  --  AI12-0074\n+                  --  AI12-0074 & AI12-0377\n                   --  Check 6.4.1: If the mode is out, the actual parameter is\n                   --  a view conversion, and the type of the formal parameter\n-                  --  is a scalar type that has the Default_Value aspect\n-                  --  specified, then\n-                  --    - there shall exist a type (other than a root numeric\n-                  --      type) that is an ancestor of both the target type and\n-                  --      the operand type; and\n-                  --    - the type of the operand of the conversion shall have\n-                  --      the Default_Value aspect specified.\n+                  --  is a scalar type, then either:\n+                  --    - the target and operand type both do not have the\n+                  --      Default_Value aspect specified; or\n+                  --    - the target and operand type both have the\n+                  --      Default_Value aspect specified, and there shall exist\n+                  --      a type (other than a root numeric type) that is an\n+                  --      ancestor of both the target type and the operand\n+                  --      type.\n \n                   elsif Ekind (F) = E_Out_Parameter\n                     and then Is_Scalar_Type (Etype (F))\n-                    and then Present (Default_Aspect_Value (Etype (F)))\n-                    and then\n-                      (not Same_Ancestor (Etype (F), Expr_Typ)\n-                         or else No (Default_Aspect_Value (Expr_Typ)))\n                   then\n-                     Error_Msg_N\n-                       (\"view conversion between unrelated types with \"\n-                        & \"Default_Value not allowed (RM 6.4.1)\", A);\n+                     if Has_Default_Aspect (Etype (F)) /=\n+                        Has_Default_Aspect (Expr_Typ)\n+                     then\n+                        Error_Msg_N\n+                          (\"view conversion requires Default_Value on both \" &\n+                           \"types (RM 6.4.1)\", A);\n+                     elsif Has_Default_Aspect (Expr_Typ)\n+                       and then not Same_Ancestor (Etype (F), Expr_Typ)\n+                     then\n+                        Error_Msg_N\n+                          (\"view conversion between unrelated types with \"\n+                           & \"Default_Value not allowed (RM 6.4.1)\", A);\n+                     end if;\n                   end if;\n                end;\n "}]}