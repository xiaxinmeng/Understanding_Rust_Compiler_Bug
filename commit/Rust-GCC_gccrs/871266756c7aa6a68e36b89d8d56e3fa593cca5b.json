{"sha": "871266756c7aa6a68e36b89d8d56e3fa593cca5b", "node_id": "C_kwDOANBUbNoAKDg3MTI2Njc1NmM3YWE2YTY4ZTM2Yjg5ZDhkNTZlM2ZhNTkzY2NhNWI", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2022-03-29T11:59:14Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2022-03-29T11:59:14Z"}, "message": "Disable gathers for znver3 for vectors with 2 or 4 elements\n\ngcc/ChangeLog:\n\n2022-03-28  Jan Hubicka  <hubicka@ucw.cz>\n\n\t* config/i386/i386-builtins.cc (ix86_vectorize_builtin_gather): Test\n\tTARGET_USE_GATHER_2PARTS and TARGET_USE_GATHER_4PARTS.\n\t* config/i386/i386.h (TARGET_USE_GATHER_2PARTS): New macro.\n\t(TARGET_USE_GATHER_4PARTS): New macro.\n\t* config/i386/x86-tune.def (X86_TUNE_USE_GATHER_2PARTS): New tune\n\t(X86_TUNE_USE_GATHER_4PARTS): New tune", "tree": {"sha": "94750ec4f5aa2be61f85a5381852155ab5675066", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/94750ec4f5aa2be61f85a5381852155ab5675066"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/871266756c7aa6a68e36b89d8d56e3fa593cca5b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/871266756c7aa6a68e36b89d8d56e3fa593cca5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/871266756c7aa6a68e36b89d8d56e3fa593cca5b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/871266756c7aa6a68e36b89d8d56e3fa593cca5b/comments", "author": null, "committer": null, "parents": [{"sha": "c5db32a143604f44672cfe312ffc6edfd5c86a4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5db32a143604f44672cfe312ffc6edfd5c86a4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5db32a143604f44672cfe312ffc6edfd5c86a4a"}], "stats": {"total": 24, "additions": 22, "deletions": 2}, "files": [{"sha": "8c6d0fe96315e10cf73b4917c2470b114c870e3f", "filename": "gcc/config/i386/i386-builtins.cc", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/871266756c7aa6a68e36b89d8d56e3fa593cca5b/gcc%2Fconfig%2Fi386%2Fi386-builtins.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/871266756c7aa6a68e36b89d8d56e3fa593cca5b/gcc%2Fconfig%2Fi386%2Fi386-builtins.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-builtins.cc?ref=871266756c7aa6a68e36b89d8d56e3fa593cca5b", "patch": "@@ -1785,7 +1785,12 @@ ix86_vectorize_builtin_gather (const_tree mem_vectype,\n   bool si;\n   enum ix86_builtins code;\n \n-  if (! TARGET_AVX2 || !TARGET_USE_GATHER)\n+  if (! TARGET_AVX2\n+      || (known_eq (TYPE_VECTOR_SUBPARTS (mem_vectype), 2u)\n+\t  ? !TARGET_USE_GATHER_2PARTS\n+\t  : (known_eq (TYPE_VECTOR_SUBPARTS (mem_vectype), 4u)\n+\t     ? !TARGET_USE_GATHER_4PARTS\n+\t     : !TARGET_USE_GATHER)))\n     return NULL_TREE;\n \n   if ((TREE_CODE (index_type) != INTEGER_TYPE"}, {"sha": "363082ba47b3a10091876035f9e6fc966abc2df2", "filename": "gcc/config/i386/i386.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/871266756c7aa6a68e36b89d8d56e3fa593cca5b/gcc%2Fconfig%2Fi386%2Fi386.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/871266756c7aa6a68e36b89d8d56e3fa593cca5b/gcc%2Fconfig%2Fi386%2Fi386.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.h?ref=871266756c7aa6a68e36b89d8d56e3fa593cca5b", "patch": "@@ -390,6 +390,10 @@ extern unsigned char ix86_tune_features[X86_TUNE_LAST];\n \tix86_tune_features[X86_TUNE_SLOW_PSHUFB]\n #define TARGET_AVOID_4BYTE_PREFIXES \\\n \tix86_tune_features[X86_TUNE_AVOID_4BYTE_PREFIXES]\n+#define TARGET_USE_GATHER_2PARTS \\\n+\tix86_tune_features[X86_TUNE_USE_GATHER_2PARTS]\n+#define TARGET_USE_GATHER_4PARTS \\\n+\tix86_tune_features[X86_TUNE_USE_GATHER_4PARTS]\n #define TARGET_USE_GATHER \\\n \tix86_tune_features[X86_TUNE_USE_GATHER]\n #define TARGET_FUSE_CMP_AND_BRANCH_32 \\"}, {"sha": "d983e2f6213f8b54f32ae854145bc25e8da73abd", "filename": "gcc/config/i386/x86-tune.def", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/871266756c7aa6a68e36b89d8d56e3fa593cca5b/gcc%2Fconfig%2Fi386%2Fx86-tune.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/871266756c7aa6a68e36b89d8d56e3fa593cca5b/gcc%2Fconfig%2Fi386%2Fx86-tune.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fx86-tune.def?ref=871266756c7aa6a68e36b89d8d56e3fa593cca5b", "patch": "@@ -464,7 +464,18 @@ DEF_TUNE (X86_TUNE_AVOID_4BYTE_PREFIXES, \"avoid_4byte_prefixes\",\n \t  m_SILVERMONT | m_GOLDMONT | m_GOLDMONT_PLUS | m_TREMONT | m_ALDERLAKE\n \t  | m_INTEL)\n \n-/* X86_TUNE_USE_GATHER: Use gather instructions.  */\n+/* X86_TUNE_USE_GATHER_2PARTS: Use gather instructions for vectors with 2\n+   elements.  */\n+DEF_TUNE (X86_TUNE_USE_GATHER_2PARTS, \"use_gather_2parts\",\n+\t  ~(m_ZNVER1 | m_ZNVER2 | m_ZNVER3 | m_ALDERLAKE | m_GENERIC))\n+\n+/* X86_TUNE_USE_GATHER_4PARTS: Use gather instructions for vectors with 4\n+   elements.  */\n+DEF_TUNE (X86_TUNE_USE_GATHER_4PARTS, \"use_gather_4parts\",\n+\t  ~(m_ZNVER1 | m_ZNVER2 | m_ZNVER3 | m_ALDERLAKE | m_GENERIC))\n+\n+/* X86_TUNE_USE_GATHER: Use gather instructions for vectors with 8 or more\n+   elements.  */\n DEF_TUNE (X86_TUNE_USE_GATHER, \"use_gather\",\n \t  ~(m_ZNVER1 | m_ZNVER2 | m_ALDERLAKE | m_GENERIC))\n "}]}