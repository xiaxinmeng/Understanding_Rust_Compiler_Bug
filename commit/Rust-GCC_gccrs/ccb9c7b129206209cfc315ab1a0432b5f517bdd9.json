{"sha": "ccb9c7b129206209cfc315ab1a0432b5f517bdd9", "node_id": "C_kwDOANBUbNoAKGNjYjljN2IxMjkyMDYyMDljZmMzMTVhYjFhMDQzMmI1ZjUxN2JkZDk", "commit": {"author": {"name": "Christophe Lyon", "email": "christophe.lyon@arm.com", "date": "2022-11-21T11:12:14Z"}, "committer": {"name": "Christophe Lyon", "email": "christophe.lyon@arm.com", "date": "2022-11-21T12:19:53Z"}, "message": "genmultilib: Fix sanity check\n\nMy previous patch to add a sanity check to genmultilib actually\nchecked the number of dirnames with the number of \"sets of options\"\nrather than the number of options, thus breaking the build on some\ntargets.\n\nTo avoid duplicating once more the loop that constructs the sed\npatterns, this patch checks that the current dirname/osdirname is not\nempty in the existing loops.\n\nAre there targets where:\nif [ \"$1\" != \"${opt}\" ]; then\nis \"legally\" executed with an empty $1? (and thus where this patch\nwould incorrectly trigger an error?)\n\nSorry for the breakage. Tested on aarch64 by adding an option to\nt-aarch64 and no corresponding dirname, and on x86_64.\n\ngcc/ChangeLog:\n\n\t* genmultilib: Fix options and dirnames/osdirnames sanity check.", "tree": {"sha": "630953cffd27f6ad70cec75914ba0a895557bbbb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/630953cffd27f6ad70cec75914ba0a895557bbbb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ccb9c7b129206209cfc315ab1a0432b5f517bdd9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccb9c7b129206209cfc315ab1a0432b5f517bdd9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ccb9c7b129206209cfc315ab1a0432b5f517bdd9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccb9c7b129206209cfc315ab1a0432b5f517bdd9/comments", "author": null, "committer": null, "parents": [{"sha": "4c7d336b673df2f3bf23bc5e7a69c445a2320c04", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c7d336b673df2f3bf23bc5e7a69c445a2320c04", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c7d336b673df2f3bf23bc5e7a69c445a2320c04"}], "stats": {"total": 22, "additions": 8, "deletions": 14}, "files": [{"sha": "c0c271eddd60acab548d017a393a6a3e072b073b", "filename": "gcc/genmultilib", "status": "modified", "additions": 8, "deletions": 14, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ccb9c7b129206209cfc315ab1a0432b5f517bdd9/gcc%2Fgenmultilib", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ccb9c7b129206209cfc315ab1a0432b5f517bdd9/gcc%2Fgenmultilib", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgenmultilib?ref=ccb9c7b129206209cfc315ab1a0432b5f517bdd9", "patch": "@@ -141,20 +141,6 @@ multiarch=$9\n multilib_reuse=${10}\n enable_multilib=${11}\n \n-# Sanity check: make sure we have as many dirnames as options\n-if [ -n \"${dirnames}\" ]; then\n-    set x $options\n-    nboptions=$#\n-    set x $dirnames\n-    nbdirnames=$#\n-    if [ $nbdirnames -ne $nboptions ]; then\n-\techo 1>&2 \"Error calling $0: Number of dirnames ($nbdirnames) does not match number of options ($nboptions)\"\n-\techo 1>&2 \"options: ${options}\"\n-\techo 1>&2 \"dirnames: ${dirnames}\"\n-\texit 1\n-    fi\n-fi\n-\n echo \"static const char *const multilib_raw[] = {\"\n \n mkdir tmpmultilib.$$ || exit 1\n@@ -264,6 +250,10 @@ if [ -n \"${dirnames}\" ]; then\n     for opts in `echo ${set} | sed -e 's|/| |'g`; do\n       patt=\"/\"\n       for opt in `echo ${opts} | sed -e 's_|_ _'g`; do\n+\tif [ -z \"$1\" ]; then\n+\t  echo 1>&2 \"Error calling $0: No dirname for option: $opt\"\n+\t  exit 1\n+\tfi\n         if [ \"$1\" != \"${opt}\" ]; then\n           todirnames=\"${todirnames} -e s|/${opt}/|/${1}/|g\"\n \t  patt=\"${patt}${1}/\"\n@@ -320,6 +310,10 @@ if [ -n \"${osdirnames}\" ]; then\n       for opts in `echo ${set} | sed -e 's|/| |'g`; do\n         patt=\"/\"\n         for opt in `echo ${opts} | sed -e 's_|_ _'g`; do\n+\tif [ -z \"$1\" ]; then\n+\t  echo 1>&2 \"Error calling $0: No osdirname for option: $opt\"\n+\t  exit 1\n+\tfi\n           if [ \"$1\" != \"${opt}\" ]; then\n             toosdirnames=\"${toosdirnames} -e s|/${opt}/|/${1}/|g\"\n \t    patt=\"${patt}${1}/\""}]}