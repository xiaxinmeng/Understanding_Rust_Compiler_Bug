{"sha": "6ea007e447876a49b7ea271d0bdee721e6b98cef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmVhMDA3ZTQ0Nzg3NmE0OWI3ZWEyNzFkMGJkZWU3MjFlNmI5OGNlZg==", "commit": {"author": {"name": "Bernd Schmidt", "email": "bernd.schmidt@codesourcery.com", "date": "2010-04-16T09:42:32Z"}, "committer": {"name": "Bernd Schmidt", "email": "bernds@gcc.gnu.org", "date": "2010-04-16T09:42:32Z"}, "message": "re PR target/41514 (redundant compare instruction of consecutive conditional branches)\n\n\tPR target/41514\n\t* config/arm/arm.md (cbranchsi4_insn): Renamed from \"*cbranchsi4_insn\".\n\tIf the previous insn is a cbranchsi4_insn with the same arguments,\n\tomit the compare instruction.\n\n\tPR target/41514\n\tgcc.target/arm/thumb-comparisons.c: New test.\n\nFrom-SVN: r158404", "tree": {"sha": "9049fc03e8bcf8a31faf13f9fdffe9a4b1fdf3c3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9049fc03e8bcf8a31faf13f9fdffe9a4b1fdf3c3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ea007e447876a49b7ea271d0bdee721e6b98cef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ea007e447876a49b7ea271d0bdee721e6b98cef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ea007e447876a49b7ea271d0bdee721e6b98cef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ea007e447876a49b7ea271d0bdee721e6b98cef/comments", "author": null, "committer": null, "parents": [{"sha": "6ddfdb0f7e310a026479c484e32d020b1cbeedf8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ddfdb0f7e310a026479c484e32d020b1cbeedf8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ddfdb0f7e310a026479c484e32d020b1cbeedf8"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "0e384b57376e83a31479ae508e199050c29a9804", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6ea007e447876a49b7ea271d0bdee721e6b98cef", "patch": "@@ -8,6 +8,11 @@\n \t* reload.c (find_reloads): Use it rather than testing for an\n \tempty constraint string.\n \n+\tPR target/41514\n+\t* config/arm/arm.md (cbranchsi4_insn): Renamed from \"*cbranchsi4_insn\".\n+\tIf the previous insn is a cbranchsi4_insn with the same arguments,\n+\tomit the compare instruction.\n+\n 2010-04-16  Jakub Jelinek  <jakub@redhat.com>\n \n \t* alias.c (memrefs_conflict_p): If x and y are the same VALUE,"}, {"sha": "1a07f36ef6ca3823a68e6aabce4b5be517da5475", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=6ea007e447876a49b7ea271d0bdee721e6b98cef", "patch": "@@ -6705,7 +6705,7 @@\n \t\t\t\t   operands[3])); DONE;\"\n )\n \n-(define_insn \"*cbranchsi4_insn\"\n+(define_insn \"cbranchsi4_insn\"\n   [(set (pc) (if_then_else\n \t      (match_operator 0 \"arm_comparison_operator\"\n \t       [(match_operand:SI 1 \"s_register_operand\" \"l,*h\")\n@@ -6714,7 +6714,20 @@\n \t      (pc)))]\n   \"TARGET_THUMB1\"\n   \"*\n-  output_asm_insn (\\\"cmp\\\\t%1, %2\\\", operands);\n+  rtx t = prev_nonnote_insn (insn);\n+  if (t != NULL_RTX\n+      && INSN_P (t)\n+      && INSN_CODE (t) == CODE_FOR_cbranchsi4_insn)\n+    {\n+      t = XEXP (SET_SRC (PATTERN (t)), 0);\n+      if (!rtx_equal_p (XEXP (t, 0), operands[1])\n+\t  || !rtx_equal_p (XEXP (t, 1), operands[2]))\n+\tt = NULL_RTX;\n+    }\n+  else\n+    t = NULL_RTX;\n+  if (t == NULL_RTX)\n+    output_asm_insn (\\\"cmp\\\\t%1, %2\\\", operands);\n \n   switch (get_attr_length (insn))\n     {"}, {"sha": "3f0fe2beab271ef2053f06ea422384d679b28abd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6ea007e447876a49b7ea271d0bdee721e6b98cef", "patch": "@@ -1,3 +1,8 @@\n+2010-04-16  Bernd Schmidt  <bernd.schmidt@codesourcery.com>\n+\n+\tPR target/41514\n+\tgcc.target/arm/thumb-comparisons.c: New test.\n+\n 2010-04-16  Christian Bruel  <christian.bruel@st.com>\n \n \t* g++.dg/torture/pr36191.C: Enable for SH."}, {"sha": "45be2cf74f075d24daa6d0336fa4c02486fc8353", "filename": "gcc/testsuite/gcc.target/arm/thumb-comparisons.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-comparisons.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ea007e447876a49b7ea271d0bdee721e6b98cef/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-comparisons.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-comparisons.c?ref=6ea007e447876a49b7ea271d0bdee721e6b98cef", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-mthumb -Os\" }  */\n+/* { dg-require-effective-target arm_thumb1_ok } */\n+\n+int foo(char ch)\n+{\n+  switch (ch) {\n+    case '-':\n+    case '?':\n+    case '/':\n+    case 99:\n+        return 1;\n+    default:\n+        return 0;\n+  }\n+}\n+\n+/* { dg-final { scan-assembler-times \"cmp\\[\\\\t \\]*r.,\\[\\\\t \\]*#63\" 1 } } */"}]}