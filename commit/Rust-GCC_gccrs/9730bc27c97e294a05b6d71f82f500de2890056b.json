{"sha": "9730bc27c97e294a05b6d71f82f500de2890056b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTczMGJjMjdjOTdlMjk0YTA1YjZkNzFmODJmNTAwZGUyODkwMDU2Yg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2010-07-07T17:23:39Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2010-07-07T17:23:39Z"}, "message": "tm.texi: Update.\n\ngcc\n\t* doc/tm.texi: Update.\n\t* doc/tm.texi.in (SDB and DWARF) <TARGET_WANT_DEBUG_PUB_SECTIONS>:\n\tAdd @hook.\n\t* target.def (want_debug_pub_sections): New hook.\n\t* config/darwin.h (TARGET_WANT_DEBUG_PUB_SECTIONS): Define.\n\t* dwarf2out.c (add_pubname_string): Check\n\ttargetm.want_debug_pub_sections.\n\t(add_pubname): Likewise.\n\t(add_pubtype): Likewise.\ngcc/testsuite\n\t* g++.dg/debug/dwarf2/pubnames-1.C: Make darwin-specific.\n\nFrom-SVN: r161924", "tree": {"sha": "36e5a2d6ff28400d1fe31caff904f627834f515a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36e5a2d6ff28400d1fe31caff904f627834f515a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9730bc27c97e294a05b6d71f82f500de2890056b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9730bc27c97e294a05b6d71f82f500de2890056b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9730bc27c97e294a05b6d71f82f500de2890056b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9730bc27c97e294a05b6d71f82f500de2890056b/comments", "author": null, "committer": null, "parents": [{"sha": "f5d5226b3d7cd2d667e4f40bf3180cf10aa0fb6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5d5226b3d7cd2d667e4f40bf3180cf10aa0fb6a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5d5226b3d7cd2d667e4f40bf3180cf10aa0fb6a"}], "stats": {"total": 49, "additions": 43, "deletions": 6}, "files": [{"sha": "45e211a531fa31640674474fe170a1b077f9dd51", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -1,3 +1,15 @@\n+2010-07-07  Tom Tromey  <tromey@redhat.com>\n+\n+\t* doc/tm.texi: Update.\n+\t* doc/tm.texi.in (SDB and DWARF) <TARGET_WANT_DEBUG_PUB_SECTIONS>:\n+\tAdd @hook.\n+\t* target.def (want_debug_pub_sections): New hook.\n+\t* config/darwin.h (TARGET_WANT_DEBUG_PUB_SECTIONS): Define.\n+\t* dwarf2out.c (add_pubname_string): Check\n+\ttargetm.want_debug_pub_sections.\n+\t(add_pubname): Likewise.\n+\t(add_pubtype): Likewise.\n+\n 2010-07-07  Jie Zhang  <jie@codesourcery.com>\n \n \t* genautomata.c (output_automata_list_min_issue_delay_code):"}, {"sha": "6b681ee4509a8339108e50741a2992c396ab2712", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -471,6 +471,8 @@ extern GTY(()) int darwin_ms_struct;\n #define DEBUG_STR_SECTION\t\"__DWARF,__debug_str,regular,debug\"\n #define DEBUG_RANGES_SECTION\t\"__DWARF,__debug_ranges,regular,debug\"\n \n+#define TARGET_WANT_DEBUG_PUB_SECTIONS true\n+\n /* When generating stabs debugging, use N_BINCL entries.  */\n \n #define DBX_USE_BINCL"}, {"sha": "cb878afbe5717554d0d563ded2421efa011800be", "filename": "gcc/doc/tm.texi", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fdoc%2Ftm.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fdoc%2Ftm.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -9278,6 +9278,10 @@ line debug info sections.  This will result in much more compact line number\n tables, and hence is desirable if it works.\n @end defmac\n \n+@deftypevr {Target Hook} bool TARGET_WANT_DEBUG_PUB_SECTIONS\n+True if the @code{.debug_pubtypes} and @code{.debug_pubnames} sections should be emitted.  These sections are not used on most platforms, and in particular GDB does not use them.\n+@end deftypevr\n+\n @defmac ASM_OUTPUT_DWARF_DELTA (@var{stream}, @var{size}, @var{label1}, @var{label2})\n A C statement to issue assembly directives that create a difference\n @var{lab1} minus @var{lab2}, using an integer of the given @var{size}."}, {"sha": "bab073e5ae02dead71fb226e3ed2ee143240c766", "filename": "gcc/doc/tm.texi.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fdoc%2Ftm.texi.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fdoc%2Ftm.texi.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Ftm.texi.in?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -9277,6 +9277,8 @@ line debug info sections.  This will result in much more compact line number\n tables, and hence is desirable if it works.\n @end defmac\n \n+@hook TARGET_WANT_DEBUG_PUB_SECTIONS\n+\n @defmac ASM_OUTPUT_DWARF_DELTA (@var{stream}, @var{size}, @var{label1}, @var{label2})\n A C statement to issue assembly directives that create a difference\n @var{lab1} minus @var{lab2}, using an integer of the given @var{size}."}, {"sha": "434783ac2a506ead2698409bfa73a17e7ad506cc", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -11238,17 +11238,20 @@ dwarf2_name (tree decl, int scope)\n static void\n add_pubname_string (const char *str, dw_die_ref die)\n {\n-  pubname_entry e;\n+  if (targetm.want_debug_pub_sections)\n+    {\n+      pubname_entry e;\n \n-  e.die = die;\n-  e.name = xstrdup (str);\n-  VEC_safe_push (pubname_entry, gc, pubname_table, &e);\n+      e.die = die;\n+      e.name = xstrdup (str);\n+      VEC_safe_push (pubname_entry, gc, pubname_table, &e);\n+    }\n }\n \n static void\n add_pubname (tree decl, dw_die_ref die)\n {\n-  if (TREE_PUBLIC (decl))\n+  if (targetm.want_debug_pub_sections && TREE_PUBLIC (decl))\n     {\n       const char *name = dwarf2_name (decl, 1);\n       if (name)\n@@ -11263,6 +11266,9 @@ add_pubtype (tree decl, dw_die_ref die)\n {\n   pubname_entry e;\n \n+  if (!targetm.want_debug_pub_sections)\n+    return;\n+\n   e.name = NULL;\n   if ((TREE_PUBLIC (decl)\n        || die->die_parent == comp_unit_die)"}, {"sha": "3eb52a6fe54647e2cf63ae08b21c31a0c0ed86af", "filename": "gcc/target.def", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Ftarget.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Ftarget.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarget.def?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -2337,6 +2337,13 @@ DEFHOOKPOD\n  \"\",\n  bool, false)\n \n+DEFHOOKPOD\n+(want_debug_pub_sections,\n+ \"True if the @code{.debug_pubtypes} and @code{.debug_pubnames} sections\\\n+ should be emitted.  These sections are not used on most platforms, and\\\n+ in particular GDB does not use them.\",\n+ bool, false)\n+\n /* Leave the boolean fields at the end.  */\n \n /* Empty macro arguments are undefined in C90, so use an empty macro.  */"}, {"sha": "189c556e1306fb2105971e0697c5e72b501d7f7f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -1,3 +1,7 @@\n+2010-07-07  Tom Tromey  <tromey@redhat.com>\n+\n+\t* g++.dg/debug/dwarf2/pubnames-1.C: Make darwin-specific.\n+\n 2010-07-07  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/44844"}, {"sha": "18d1df0d952c12f15fdfd2408f3cf1004d265e99", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/pubnames-1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpubnames-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9730bc27c97e294a05b6d71f82f500de2890056b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpubnames-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fpubnames-1.C?ref=9730bc27c97e294a05b6d71f82f500de2890056b", "patch": "@@ -1,7 +1,7 @@\n // Contributed by Dodji Seketeli <dodji@redhat.com>\n // Origin PR debug/39706\n+// { dg-do compile { target *-*-darwin* } }\n // { dg-options \"-g -dA -fno-merge-debug-strings\" }\n-// { dg-do compile }\n //\n // There should be one debug_pubnames section generated.\n // On Darwin though, there is also a label pointing at the begining of the"}]}