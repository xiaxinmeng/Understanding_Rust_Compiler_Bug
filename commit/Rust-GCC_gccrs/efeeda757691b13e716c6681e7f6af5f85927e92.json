{"sha": "efeeda757691b13e716c6681e7f6af5f85927e92", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWZlZWRhNzU3NjkxYjEzZTcxNmM2NjgxZTdmNmFmNWY4NTkyN2U5Mg==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-11-29T09:03:25Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-11-29T09:03:25Z"}, "message": "Check for TYPE_NAME in type_with_linkage_p.\n\n2019-11-29  Martin Liska  <mliska@suse.cz>\n\n\tPR lto/91574\n\t* ipa-devirt.c (types_same_for_odr): Check for existence\n\tof TYPE_NAMEs first.\n2019-11-29  Martin Liska  <mliska@suse.cz>\n\n\tPR lto/91574\n\t* g++.dg/lto/pr91574_0.C: New test.\n\nFrom-SVN: r278829", "tree": {"sha": "3bfd1d32ae0f121f4e250b339637500eeb449da8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3bfd1d32ae0f121f4e250b339637500eeb449da8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/efeeda757691b13e716c6681e7f6af5f85927e92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efeeda757691b13e716c6681e7f6af5f85927e92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efeeda757691b13e716c6681e7f6af5f85927e92", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efeeda757691b13e716c6681e7f6af5f85927e92/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d5e82c9f686f6c8e2feabfe753258f9fc13d980f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5e82c9f686f6c8e2feabfe753258f9fc13d980f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5e82c9f686f6c8e2feabfe753258f9fc13d980f"}], "stats": {"total": 41, "additions": 41, "deletions": 0}, "files": [{"sha": "229e2b6b7ef5f138b1150d4b45a2b1e73e263bde", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=efeeda757691b13e716c6681e7f6af5f85927e92", "patch": "@@ -1,3 +1,9 @@\n+2019-11-29  Martin Liska  <mliska@suse.cz>\n+\n+\tPR lto/91574\n+\t* ipa-devirt.c (types_same_for_odr): Check for existence\n+\tof TYPE_NAMEs first.\n+\n 2019-11-29  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/92704"}, {"sha": "a884a465a5d0758ade2d607ab93bcabe0250e60a", "filename": "gcc/ipa-devirt.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2Fipa-devirt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2Fipa-devirt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-devirt.c?ref=efeeda757691b13e716c6681e7f6af5f85927e92", "patch": "@@ -356,6 +356,13 @@ types_same_for_odr (const_tree type1, const_tree type2)\n       || (type_with_linkage_p (type2) && type_in_anonymous_namespace_p (type2)))\n     return false;\n \n+  /* If both type has mangled defined check if they are same.\n+     Watch for anonymous types which are all mangled as \"<anon\">.  */\n+  if (!type_with_linkage_p (type1) || !type_with_linkage_p (type2))\n+    return false;\n+  if (type_in_anonymous_namespace_p (type1)\n+      || type_in_anonymous_namespace_p (type2))\n+    return false;\n   return (DECL_ASSEMBLER_NAME (TYPE_NAME (type1))\n \t  == DECL_ASSEMBLER_NAME (TYPE_NAME (type2)));\n }"}, {"sha": "e0c37ddba900a2cad43bf4abc2a11c4a98b6d9a1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=efeeda757691b13e716c6681e7f6af5f85927e92", "patch": "@@ -1,3 +1,8 @@\n+2019-11-29  Martin Liska  <mliska@suse.cz>\n+\n+\tPR lto/91574\n+\t* g++.dg/lto/pr91574_0.C: New test.\n+\n 2019-11-29  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/92704"}, {"sha": "346a8015c98a2d285f64e14fad4c52561739ced5", "filename": "gcc/testsuite/g++.dg/lto/pr91574_0.C", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr91574_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/efeeda757691b13e716c6681e7f6af5f85927e92/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr91574_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fpr91574_0.C?ref=efeeda757691b13e716c6681e7f6af5f85927e92", "patch": "@@ -0,0 +1,23 @@\n+// PR lto/91574\n+// { dg-lto-do link }\n+// { dg-lto-options { { -fPIC -flto -O2 } } }\n+// { dg-require-effective-target shared }\n+// { dg-require-effective-target fpic }\n+// { dg-extra-ld-options \"-shared\" }\n+\n+class A\n+{\n+public:\n+  virtual ~A ();\n+  A (A &);\n+  virtual unsigned m_fn1 () const;\n+};\n+class B : A\n+{\n+  unsigned m_fn1 () const;\n+};\n+void\n+fn1 (B p1)\n+{\n+  B a[]{p1, p1};\n+}"}]}