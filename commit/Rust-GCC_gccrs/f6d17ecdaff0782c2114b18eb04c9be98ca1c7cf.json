{"sha": "f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjZkMTdlY2RhZmYwNzgyYzIxMTRiMThlYjA0YzliZTk4Y2ExYzdjZg==", "commit": {"author": {"name": "Fritz Reese", "email": "fritzoreese@gmail.com", "date": "2016-10-25T15:13:43Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2016-10-25T15:13:43Z"}, "message": "Cleanup -fdec.\n\n\tgcc/fortran/\n\t* invoke.texi, gfortran.texi: Touch up documentation of -fdec.\n\t* gfortran.h (gfc_option): Move flag_dec_structure out of gfc_option.\n\t* decl.c (match_record_decl, gfc_match_decl_type_spec,\n\tgfc_match_structure_decl): Ditto.\n\t* match.c (gfc_match_member_sep): Ditto.\n\t* options.c (gfc_handle_option): Ditto.\n\t* lang.opt (fdec-structure): Use Fortran Var for flag_dec_structure.\n\t* lang.opt (fdec): Use Fortran Var to create flag_dec.\n\t* options.c (set_dec_flags): With -fdec enable -fcray-pointer,\n\t-fd-lines-as-comments (default), -fdollar-ok, and legacy std flags.\n\nFrom-SVN: r241516", "tree": {"sha": "ee373133ab268f2af7fc6ac7c66e8ae15a7a5a8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee373133ab268f2af7fc6ac7c66e8ae15a7a5a8a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6ddefaa79f3014ce4e57a744e9e8c9222beaf18b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ddefaa79f3014ce4e57a744e9e8c9222beaf18b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ddefaa79f3014ce4e57a744e9e8c9222beaf18b"}], "stats": {"total": 62, "additions": 44, "deletions": 18}, "files": [{"sha": "ab98c202e1c8ba4742145ea03ede4ef17ff841da", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -1,3 +1,15 @@\n+2016-10-25  Fritz Reese <fritzoreese@gmail.com>\n+\n+\t* invoke.texi, gfortran.texi: Touch up documentation of -fdec.\n+\t* gfortran.h (gfc_option): Move flag_dec_structure out of gfc_option.\n+\t* decl.c (match_record_decl, gfc_match_decl_type_spec,\n+\tgfc_match_structure_decl): Ditto.\n+\t* match.c (gfc_match_member_sep): Ditto.\n+\t* options.c (gfc_handle_option): Ditto.\n+\t* lang.opt (fdec-structure): Use Fortran Var for flag_dec_structure.\n+\t* lang.opt (fdec): Use Fortran Var to create flag_dec.\n+\t* options.c (set_dec_flags): With -fdec enable -fcray-pointer,\n+\t-fd-lines-as-comments (default), -fdollar-ok, and legacy std flags.\n 2016-10-24  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/77828"}, {"sha": "e47d8ede33cf5368f7d5abd99e93f58c18d51105", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -2929,7 +2929,7 @@ match_record_decl (char *name)\n     m = gfc_match (\" record /\");\n     if (m == MATCH_YES)\n       {\n-          if (!gfc_option.flag_dec_structure)\n+          if (!flag_dec_structure)\n             {\n                 gfc_current_locus = old_loc;\n                 gfc_error (\"RECORD at %C is an extension, enable it with \"\n@@ -2942,7 +2942,7 @@ match_record_decl (char *name)\n       }\n \n   gfc_current_locus = old_loc;\n-  if (gfc_option.flag_dec_structure\n+  if (flag_dec_structure\n       && (gfc_match (\" record% \") == MATCH_YES\n           || gfc_match (\" record%t\") == MATCH_YES))\n     gfc_error (\"Structure name expected after RECORD at %C\");\n@@ -3145,7 +3145,7 @@ gfc_match_decl_type_spec (gfc_typespec *ts, int implicit_flag)\n     {\n       /* Match nested STRUCTURE declarations; only valid within another\n \t structure declaration.  */\n-      if (gfc_option.flag_dec_structure\n+      if (flag_dec_structure\n \t  && (gfc_current_state () == COMP_STRUCTURE\n \t      || gfc_current_state () == COMP_MAP))\n \t{\n@@ -8654,7 +8654,7 @@ gfc_match_structure_decl (void)\n     match m;\n     locus where;\n \n-    if(!gfc_option.flag_dec_structure)\n+    if(!flag_dec_structure)\n       {\n           gfc_error (\"STRUCTURE at %C is a DEC extension, enable with \"\n                      \"-fdec-structure\");"}, {"sha": "78a75e58b51641515ce59350c13e8c57171b69bb", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -2549,8 +2549,6 @@ typedef struct\n   int flag_init_character;\n   char flag_init_character_value;\n \n-  int flag_dec_structure;\n-\n   int fpe;\n   int fpe_summary;\n   int rtcheck;"}, {"sha": "fa1f17cf54cf3146f9a8bdee4591b91cbaf25e43", "filename": "gcc/fortran/gfortran.texi", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fgfortran.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fgfortran.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.texi?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -1437,7 +1437,8 @@ purely for backward compatibility with legacy compilers.  By default,\n extensions, but to warn about the use of the latter.  Specifying\n either @option{-std=f95}, @option{-std=f2003} or @option{-std=f2008}\n disables both types of extensions, and @option{-std=legacy} allows both\n-without warning.\n+without warning.  The special compile flag @option{-fdec} enables additional\n+compatibility extensions along with those enabled by @option{-std=legacy}.\n \n @menu\n * Old-style kind specifications::"}, {"sha": "ebf3aba8d4a134dd4299f6edb8e3259a1c185c03", "filename": "gcc/fortran/invoke.texi", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finvoke.texi?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -236,12 +236,15 @@ comment lines.\n DEC compatibility mode. Enables extensions and other features that mimic\n the default behavior of older compilers (such as DEC).\n These features are non-standard and should be avoided at all costs.\n-For details on GNU Fortran's implementation of these extensions see the \n+For details on GNU Fortran's implementation of these extensions see the\n full documentation.\n \n Other flags enabled by this switch are:\n @option{-fdollar-ok} @option{-fcray-pointer} @option{-fdec-structure}\n-@option{-fdec-intrinsic-ints} @option{-fdec-static}\n+@option{-fdec-intrinsic-ints} @option{-fdec-static} @option{-fdec-math}\n+\n+If @option{-fd-lines-as-code}/@option{-fd-lines-as-comments} are unset, then\n+@option{-fdec} also sets @option{-fd-lines-as-comments}.\n \n @item -fdec-structure\n @opindex @code{fdec-structure}"}, {"sha": "2e7640302ee6f11106e923ebeef65ff55b86f965", "filename": "gcc/fortran/lang.opt", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Flang.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Flang.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Flang.opt?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -421,7 +421,7 @@ Fortran RejectNegative\n Treat lines with 'D' in column one as comments.\n \n fdec\n-Fortran\n+Fortran Var(flag_dec)\n Enable all DEC language extensions.\n \n fdec-intrinsic-ints\n@@ -433,7 +433,7 @@ Fortran Var(flag_dec_math)\n Enable legacy math intrinsics for compatibility.\n \n fdec-structure\n-Fortran\n+Fortran Var(flag_dec_structure)\n Enable support for DEC STRUCTURE/RECORD.\n \n fdec-static"}, {"sha": "aa9961c6ed5ac3fd0a6a369073ab9a55c9ec1b66", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -159,7 +159,7 @@ gfc_match_member_sep(gfc_symbol *sym)\n     return MATCH_YES;\n \n   /* Beware ye who enter here.  */\n-  if (!gfc_option.flag_dec_structure || !sym)\n+  if (!flag_dec_structure || !sym)\n     return MATCH_NO;\n \n   tsym = NULL;"}, {"sha": "2b90654584fe693391e3100e65d1f623f7c53b50", "filename": "gcc/fortran/options.c", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Foptions.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf/gcc%2Ffortran%2Foptions.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Foptions.c?ref=f6d17ecdaff0782c2114b18eb04c9be98ca1c7cf", "patch": "@@ -47,15 +47,27 @@ set_default_std_flags (void)\n }\n \n \n-/* Set all the DEC extension flags. */\n+/* Set all the DEC extension flags.  */\n \n static void\n set_dec_flags (int value)\n {\n-    gfc_option.flag_dec_structure  = value;\n-    flag_dec_intrinsic_ints = value;\n-    flag_dec_static = value;\n-    flag_dec_math = value;\n+  /* Allow legacy code without warnings.  */\n+  gfc_option.allow_std |= GFC_STD_F95_OBS | GFC_STD_F95_DEL\n+    | GFC_STD_GNU | GFC_STD_LEGACY;\n+  gfc_option.warn_std &= ~(GFC_STD_LEGACY | GFC_STD_F95_DEL);\n+\n+  /* Set -fd-lines-as-comments by default.  */\n+  if (value && gfc_current_form != FORM_FREE && gfc_option.flag_d_lines == -1)\n+    gfc_option.flag_d_lines = 0;\n+\n+  /* Set other DEC compatibility extensions.  */\n+  flag_dollar_ok |= value;\n+  flag_cray_pointer |= value;\n+  flag_dec_structure |= value;\n+  flag_dec_intrinsic_ints |= value;\n+  flag_dec_static |= value;\n+  flag_dec_math |= value;\n }\n \n \n@@ -729,7 +741,7 @@ gfc_handle_option (size_t scode, const char *arg, int value,\n       break;\n \n     case OPT_fdec_structure:\n-      gfc_option.flag_dec_structure = 1;\n+      flag_dec_structure = 1;\n       break;\n     }\n "}]}