{"sha": "ae026741df1a3f1dfe86ffde544010027a4c08b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWUwMjY3NDFkZjFhM2YxZGZlODZmZmRlNTQ0MDEwMDI3YTRjMDhiMQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-11-26T00:24:21Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-11-26T00:24:21Z"}, "message": "re PR go/61303 (gccgo: segfault, regression since 4.8.2)\n\n\tPR go/61303\n    runtime: don't overallocate in select code\n    \n    If we've already allocated an fd_set, don't allocate another one.\n    \n    Also, don't bother to read from rdwake if it wasn't returned in select.\n    \n    Fixes https://gcc.gnu.org/PR61303.\n    \n    Reviewed-on: https://go-review.googlesource.com/17243\n\nFrom-SVN: r230922", "tree": {"sha": "c853bd52fd73b08be9644ba4fccfd3de7381eaca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c853bd52fd73b08be9644ba4fccfd3de7381eaca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae026741df1a3f1dfe86ffde544010027a4c08b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae026741df1a3f1dfe86ffde544010027a4c08b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae026741df1a3f1dfe86ffde544010027a4c08b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae026741df1a3f1dfe86ffde544010027a4c08b1/comments", "author": null, "committer": null, "parents": [{"sha": "1a5d8ff69ceb839da0920199b0d5b8915e48cd43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a5d8ff69ceb839da0920199b0d5b8915e48cd43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a5d8ff69ceb839da0920199b0d5b8915e48cd43"}], "stats": {"total": 18, "additions": 11, "deletions": 7}, "files": [{"sha": "80136abcf76c0804a99c65eff00c10eb888f6f00", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae026741df1a3f1dfe86ffde544010027a4c08b1/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae026741df1a3f1dfe86ffde544010027a4c08b1/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=ae026741df1a3f1dfe86ffde544010027a4c08b1", "patch": "@@ -1,4 +1,4 @@\n-0d979f0b860cfd879754150e0ae5e1018b94d7c4\n+81eb6a3f425b2158c67ee32c0cc973a72ce9d6be\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "033661d17f243134f3656d3e1f8d02dd4946abf4", "filename": "libgo/runtime/netpoll_select.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae026741df1a3f1dfe86ffde544010027a4c08b1/libgo%2Fruntime%2Fnetpoll_select.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae026741df1a3f1dfe86ffde544010027a4c08b1/libgo%2Fruntime%2Fnetpoll_select.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fruntime%2Fnetpoll_select.c?ref=ae026741df1a3f1dfe86ffde544010027a4c08b1", "patch": "@@ -135,6 +135,8 @@ runtime_netpoll(bool block)\n \tbyte b;\n \tstruct stat st;\n \n+\tallocatedfds = false;\n+\n  retry:\n \truntime_lock(&selectlock);\n \n@@ -146,11 +148,13 @@ runtime_netpoll(bool block)\n \t}\n \n \tif(inuse) {\n-\t\tprfds = runtime_SysAlloc(4 * sizeof fds, &mstats.other_sys);\n-\t\tpwfds = prfds + 1;\n-\t\tpefds = pwfds + 1;\n-\t\tptfds = pefds + 1;\n-\t\tallocatedfds = true;\n+\t\tif(!allocatedfds) {\n+\t\t\tprfds = runtime_SysAlloc(4 * sizeof fds, &mstats.other_sys);\n+\t\t\tpwfds = prfds + 1;\n+\t\t\tpefds = pwfds + 1;\n+\t\t\tptfds = pefds + 1;\n+\t\t\tallocatedfds = true;\n+\t\t}\n \t} else {\n \t\tprfds = &grfds;\n \t\tpwfds = &gwfds;\n@@ -216,7 +220,7 @@ runtime_netpoll(bool block)\n \t\t\tmode = 'r' + 'w';\n \t\t\t--c;\n \t\t}\n-\t\tif(i == rdwake) {\n+\t\tif(i == rdwake && mode != 0) {\n \t\t\twhile(read(rdwake, &b, sizeof b) > 0)\n \t\t\t\t;\n \t\t\tcontinue;"}]}