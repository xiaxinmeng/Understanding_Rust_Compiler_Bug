{"sha": "7d092805ba995e042a89072bcbf2948800d87d3f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2QwOTI4MDViYTk5NWUwNDJhODkwNzJiY2JmMjk0ODgwMGQ4N2QzZg==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2014-03-19T18:21:52Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2014-03-19T18:21:52Z"}, "message": "re PR c++/51474 ([c++0x] ICE with pure virtual function in initialization of non-static data member)\n\n/cp\n2014-03-19  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51474\n\t* call.c (build_new_method_call_1): Handle pure virtuals called by\n\tNSDMIs too.\n\n/testsuite\n2014-03-19  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/51474\n\t* g++.dg/cpp0x/nsdmi-virtual2.C: New.\n\nFrom-SVN: r208686", "tree": {"sha": "b4bc81b466dee6a514162c9420f227b15bfe340d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b4bc81b466dee6a514162c9420f227b15bfe340d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7d092805ba995e042a89072bcbf2948800d87d3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d092805ba995e042a89072bcbf2948800d87d3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d092805ba995e042a89072bcbf2948800d87d3f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d092805ba995e042a89072bcbf2948800d87d3f/comments", "author": null, "committer": null, "parents": [{"sha": "057be77f433a256f6e8392f2e841d735d1ba6157", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/057be77f433a256f6e8392f2e841d735d1ba6157", "html_url": "https://github.com/Rust-GCC/gccrs/commit/057be77f433a256f6e8392f2e841d735d1ba6157"}], "stats": {"total": 40, "additions": 32, "deletions": 8}, "files": [{"sha": "655f6d4152b633a933c9587e350c31938db15fbc", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7d092805ba995e042a89072bcbf2948800d87d3f", "patch": "@@ -1,3 +1,9 @@\n+2014-03-19  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51474\n+\t* call.c (build_new_method_call_1): Handle pure virtuals called by\n+\tNSDMIs too.\n+\n 2014-03-17  Adam Butcher  <adam@jessamine.co.uk>\n \n \tPR c++/60390"}, {"sha": "877f6d9cf1728ec41b7e1e4c4b986af772b88241", "filename": "gcc/cp/call.c", "status": "modified", "additions": 13, "deletions": 8, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=7d092805ba995e042a89072bcbf2948800d87d3f", "patch": "@@ -7828,15 +7828,20 @@ build_new_method_call_1 (tree instance, tree fns, vec<tree, va_gc> **args,\n \t  if (!(flags & LOOKUP_NONVIRTUAL)\n \t      && DECL_PURE_VIRTUAL_P (fn)\n \t      && instance == current_class_ref\n-\t      && (DECL_CONSTRUCTOR_P (current_function_decl)\n-\t\t  || DECL_DESTRUCTOR_P (current_function_decl))\n \t      && (complain & tf_warning))\n-\t    /* This is not an error, it is runtime undefined\n-\t       behavior.  */\n-\t    warning (0, (DECL_CONSTRUCTOR_P (current_function_decl) ?\n-\t\t      \"pure virtual %q#D called from constructor\"\n-\t\t      : \"pure virtual %q#D called from destructor\"),\n-\t\t     fn);\n+\t    {\n+\t      /* This is not an error, it is runtime undefined\n+\t\t behavior.  */\n+\t      if (!current_function_decl)\n+\t\twarning (0, \"pure virtual %q#D called from \"\n+\t\t\t \"non-static data member initializer\", fn);\n+\t      else if (DECL_CONSTRUCTOR_P (current_function_decl)\n+\t\t       || DECL_DESTRUCTOR_P (current_function_decl))\n+\t\twarning (0, (DECL_CONSTRUCTOR_P (current_function_decl)\n+\t\t\t     ? \"pure virtual %q#D called from constructor\"\n+\t\t\t     : \"pure virtual %q#D called from destructor\"),\n+\t\t\t fn);\n+\t    }\n \n \t  if (TREE_CODE (TREE_TYPE (fn)) == METHOD_TYPE\n \t      && is_dummy_object (instance))"}, {"sha": "d0f56cdbca183ea74989a3acbd4076a86b4b3b0d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7d092805ba995e042a89072bcbf2948800d87d3f", "patch": "@@ -1,3 +1,8 @@\n+2014-03-19  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/51474\n+\t* g++.dg/cpp0x/nsdmi-virtual2.C: New.\n+\n 2014-03-19  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR testsuite/60590"}, {"sha": "157854c5aa075c39c937efb02a2e9b82b0429565", "filename": "gcc/testsuite/g++.dg/cpp0x/nsdmi-virtual2.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnsdmi-virtual2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d092805ba995e042a89072bcbf2948800d87d3f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnsdmi-virtual2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fnsdmi-virtual2.C?ref=7d092805ba995e042a89072bcbf2948800d87d3f", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/51474\n+// { dg-do compile { target c++11 } }\n+\n+struct A\n+{\n+  virtual int foo() = 0;\n+  int i = foo();  // { dg-warning \"pure virtual\" }\n+};"}]}