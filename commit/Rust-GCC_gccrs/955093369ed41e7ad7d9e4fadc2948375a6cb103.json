{"sha": "955093369ed41e7ad7d9e4fadc2948375a6cb103", "node_id": "C_kwDOANBUbNoAKDk1NTA5MzM2OWVkNDFlN2FkN2Q5ZTRmYWRjMjk0ODM3NWE2Y2IxMDM", "commit": {"author": {"name": "Siddhesh Poyarekar", "email": "siddhesh@gotplt.org", "date": "2022-12-08T15:21:17Z"}, "committer": {"name": "Siddhesh Poyarekar", "email": "siddhesh@gotplt.org", "date": "2022-12-08T15:21:18Z"}, "message": "testsuite: Fix leaks in tree-dynamic-object-size-0.c\n\nIn commit e5cfb9cac1d7aba9a8ea73bfe7922cfaff9d61f3 I introduced tests\nfor strdup and strndup with leaks.  Fix those leaks.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.dg/builtin-dynamic-object-size-0.c (test_strdup,\n\ttest_strndup, test_strdup_min, test_strndup_min): Free RES\n\tbefore returning from function.\n\nSigned-off-by: Siddhesh Poyarekar <siddhesh@gotplt.org>", "tree": {"sha": "4d5696854b13a41ba9089da90dd38a9e8581f563", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4d5696854b13a41ba9089da90dd38a9e8581f563"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/955093369ed41e7ad7d9e4fadc2948375a6cb103", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/955093369ed41e7ad7d9e4fadc2948375a6cb103", "html_url": "https://github.com/Rust-GCC/gccrs/commit/955093369ed41e7ad7d9e4fadc2948375a6cb103", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/955093369ed41e7ad7d9e4fadc2948375a6cb103/comments", "author": {"login": "siddhesh", "id": 158582, "node_id": "MDQ6VXNlcjE1ODU4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/158582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siddhesh", "html_url": "https://github.com/siddhesh", "followers_url": "https://api.github.com/users/siddhesh/followers", "following_url": "https://api.github.com/users/siddhesh/following{/other_user}", "gists_url": "https://api.github.com/users/siddhesh/gists{/gist_id}", "starred_url": "https://api.github.com/users/siddhesh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siddhesh/subscriptions", "organizations_url": "https://api.github.com/users/siddhesh/orgs", "repos_url": "https://api.github.com/users/siddhesh/repos", "events_url": "https://api.github.com/users/siddhesh/events{/privacy}", "received_events_url": "https://api.github.com/users/siddhesh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "siddhesh", "id": 158582, "node_id": "MDQ6VXNlcjE1ODU4Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/158582?v=4", "gravatar_id": "", "url": "https://api.github.com/users/siddhesh", "html_url": "https://github.com/siddhesh", "followers_url": "https://api.github.com/users/siddhesh/followers", "following_url": "https://api.github.com/users/siddhesh/following{/other_user}", "gists_url": "https://api.github.com/users/siddhesh/gists{/gist_id}", "starred_url": "https://api.github.com/users/siddhesh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/siddhesh/subscriptions", "organizations_url": "https://api.github.com/users/siddhesh/orgs", "repos_url": "https://api.github.com/users/siddhesh/repos", "events_url": "https://api.github.com/users/siddhesh/events{/privacy}", "received_events_url": "https://api.github.com/users/siddhesh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d9f9d5d30feb33c359955d7030cc6be50ef6dc0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9f9d5d30feb33c359955d7030cc6be50ef6dc0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9f9d5d30feb33c359955d7030cc6be50ef6dc0a"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "f9047a037d99c70f3a83f30c55ebd9a06bf83168", "filename": "gcc/testsuite/gcc.dg/builtin-dynamic-object-size-0.c", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/955093369ed41e7ad7d9e4fadc2948375a6cb103/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-dynamic-object-size-0.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/955093369ed41e7ad7d9e4fadc2948375a6cb103/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-dynamic-object-size-0.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fbuiltin-dynamic-object-size-0.c?ref=955093369ed41e7ad7d9e4fadc2948375a6cb103", "patch": "@@ -486,31 +486,43 @@ __attribute__ ((noinline))\n test_strdup (const char *in)\n {\n   char *res = __builtin_strdup (in);\n-  return __builtin_dynamic_object_size (res, 0);\n+  size_t sz = __builtin_dynamic_object_size (res, 0);\n+\n+  __builtin_free (res);\n+  return sz;\n }\n \n size_t\n __attribute__ ((noinline))\n test_strndup (const char *in, size_t bound)\n {\n   char *res = __builtin_strndup (in, bound);\n-  return __builtin_dynamic_object_size (res, 0);\n+  size_t sz = __builtin_dynamic_object_size (res, 0);\n+\n+  __builtin_free (res);\n+  return sz;\n }\n \n size_t\n __attribute__ ((noinline))\n test_strdup_min (const char *in)\n {\n   char *res = __builtin_strdup (in);\n-  return __builtin_dynamic_object_size (res, 2);\n+  size_t sz = __builtin_dynamic_object_size (res, 2);\n+\n+  __builtin_free (res);\n+  return sz;\n }\n \n size_t\n __attribute__ ((noinline))\n test_strndup_min (const char *in, size_t bound)\n {\n   char *res = __builtin_strndup (in, bound);\n-  return __builtin_dynamic_object_size (res, 2);\n+  size_t sz = __builtin_dynamic_object_size (res, 2);\n+\n+  __builtin_free (res);\n+  return sz;\n }\n \n /* Other tests.  */"}]}