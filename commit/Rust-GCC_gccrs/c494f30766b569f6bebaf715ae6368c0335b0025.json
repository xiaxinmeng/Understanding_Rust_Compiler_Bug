{"sha": "c494f30766b569f6bebaf715ae6368c0335b0025", "node_id": "C_kwDOANBUbNoAKGM0OTRmMzA3NjZiNTY5ZjZiZWJhZjcxNWFlNjM2OGMwMzM1YjAwMjU", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2022-04-12T13:28:28Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2022-04-12T13:28:28Z"}, "message": "Merge #1106\n\n1106: macros: fix an infinite loop in `concat!` macro parser r=CohenArthur a=liushuyu\n\n- Fix concat macro parser issue which caused an infinite loop when invalid token is encountered\r\n\n\nCo-authored-by: liushuyu <liushuyu011@gmail.com>", "tree": {"sha": "04143be929a7be634a3cdc2a899ca3a0a1ead5ff", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/04143be929a7be634a3cdc2a899ca3a0a1ead5ff"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c494f30766b569f6bebaf715ae6368c0335b0025", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJiVX58CRBK7hj4Ov3rIwAAkBUIAJmBDn/gII6z97M6mzHrD1oO\nb2Hxs8Ckc4CgvuqTyeIpgNcWIDEfw42PKJHvDl8SqmJ22k5QDsaY1zZdpR2mx+QO\n3Emlx7CblFeeD3Bed3foT9X3IOi/txzCjpY2BhjeLGDkeqEVYVqYnH9b1VZ2MgAZ\nrrtxowQkIn2R3N2U/WvXl7zGzy+i6bYdQ+lQsliCImXEHNDwgHx4FN7nMMJ45m0z\n+xldAcsY7ZYwgZckGBUo/RQXjlKLmSCTLItkUnYnHxuSPrJMxWVtQzxewv7q7NlP\nLZcKnuqWNGchcyRQDA7nYnwsZ2FkdrMjFUM2irE+ygt+OIsYRnUptgjRsd15gFY=\n=LxXB\n-----END PGP SIGNATURE-----\n", "payload": "tree 04143be929a7be634a3cdc2a899ca3a0a1ead5ff\nparent a5b38698aa439a935f0c0f4c55611f2173a28b57\nparent 2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1649770108 +0000\ncommitter GitHub <noreply@github.com> 1649770108 +0000\n\nMerge #1106\n\n1106: macros: fix an infinite loop in `concat!` macro parser r=CohenArthur a=liushuyu\n\n- Fix concat macro parser issue which caused an infinite loop when invalid token is encountered\r\n\n\nCo-authored-by: liushuyu <liushuyu011@gmail.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c494f30766b569f6bebaf715ae6368c0335b0025", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c494f30766b569f6bebaf715ae6368c0335b0025", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c494f30766b569f6bebaf715ae6368c0335b0025/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5b38698aa439a935f0c0f4c55611f2173a28b57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5b38698aa439a935f0c0f4c55611f2173a28b57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5b38698aa439a935f0c0f4c55611f2173a28b57"}, {"sha": "2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fe4048f7f1d10ce9928eb7611179ee8ff7f17f8"}], "stats": {"total": 14, "additions": 9, "deletions": 5}, "files": [{"sha": "1f41545ba38be8bc76880d5059690472136f26e0", "filename": "gcc/rust/expand/rust-macro-builtins.cc", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c494f30766b569f6bebaf715ae6368c0335b0025/gcc%2Frust%2Fexpand%2Frust-macro-builtins.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c494f30766b569f6bebaf715ae6368c0335b0025/gcc%2Frust%2Fexpand%2Frust-macro-builtins.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-macro-builtins.cc?ref=c494f30766b569f6bebaf715ae6368c0335b0025", "patch": "@@ -287,9 +287,12 @@ MacroBuiltin::concat (Location invoc_locus, AST::MacroInvocData &invoc)\n \t}\n       else\n \t{\n-\t  rust_error_at (parser.peek_current_token ()->get_locus (),\n+\t  auto current_token = parser.peek_current_token ();\n+\t  rust_error_at (current_token->get_locus (),\n \t\t\t \"argument must be a constant literal\");\n \t  has_error = true;\n+\t  // Just crash if the current token can't be skipped\n+\t  rust_assert (parser.skip_token (current_token->get_id ()));\n \t}\n       parser.maybe_skip_token (COMMA);\n     }"}, {"sha": "b37f80fc29912ccb21f626259d844c797a05585a", "filename": "gcc/testsuite/rust/compile/builtin_macro_concat.rs", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c494f30766b569f6bebaf715ae6368c0335b0025/gcc%2Ftestsuite%2Frust%2Fcompile%2Fbuiltin_macro_concat.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c494f30766b569f6bebaf715ae6368c0335b0025/gcc%2Ftestsuite%2Frust%2Fcompile%2Fbuiltin_macro_concat.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Fbuiltin_macro_concat.rs?ref=c494f30766b569f6bebaf715ae6368c0335b0025", "patch": "@@ -3,13 +3,14 @@ macro_rules! concat {\n }\n \n fn main() {\n-    // let not_literal = \"identifier\";\n+    let not_literal = \"identifier\";\n     concat!();\n-    // concat! (,); // { error \"argument must be a constant literal\" }\n-    // concat!(not_literal); // { error \"argument must be a constant literal\" }\n+    concat! (,); // { dg-error \"argument must be a constant literal\" }\n+    concat!(not_literal); // { dg-error \"argument must be a constant literal\" }\n     concat!(\"message\");\n     concat!(\"message\",);\n     concat!(\"message\", 1, true, false, 1.0, 10usize, 2000u64);\n     concat!(\"message\", 1, true, false, 1.0, 10usize, 2000u64,);\n-    // concat! (\"m\", not_literal); // { error \"argument must be a constant literal\" }\n+    concat! (\"m\", not_literal); // { dg-error \"argument must be a constant literal\" }\n+    concat!(not_literal invalid 'm' !!,); // { dg-error \"argument must be a constant literal\" }\n }"}]}