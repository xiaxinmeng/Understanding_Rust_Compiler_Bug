{"sha": "0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDQ0NGQwNjcxZDI2OTZkOWEzZWVmOGNlMDFmZTc3ZjgyNzAyYzBlMw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2018-10-09T15:06:11Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-10-09T15:06:11Z"}, "message": "[Ada] Internal error on inlined renaming of subprogram instance\n\nThis fixes a recent regression introduced in the compiler for the\ninlined renaming of a subprogram instantiated in a package body.  It was\nwrongly clearing the Is_Public flag on the entity associated with the\nbody.\n\n2018-10-09  Eric Botcazou  <ebotcazou@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch7.adb (Has_Referencer): Add comment for the\n\tN_Freeze_Entity case.  Do not rely on\n\tHas_Referencer_Of_Non_Subprograms to clear the Is_Public flag on\n\tsubprogram entities.\n\ngcc/testsuite/\n\n\t* gnat.dg/inline14.adb, gnat.dg/inline14_pkg.adb,\n\tgnat.dg/inline14_pkg.ads: New testcase.\n\nFrom-SVN: r264975", "tree": {"sha": "9a1cd800843984fb0892e61eb573708d977d4639", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9a1cd800843984fb0892e61eb573708d977d4639"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/comments", "author": null, "committer": null, "parents": [{"sha": "c14bd5028a410a277b2e0ba8ffbfe8ee58e74d00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c14bd5028a410a277b2e0ba8ffbfe8ee58e74d00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c14bd5028a410a277b2e0ba8ffbfe8ee58e74d00"}], "stats": {"total": 54, "additions": 52, "deletions": 2}, "files": [{"sha": "2c0bce6a54c1165ec64173003c42c9c5a11a1530", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "patch": "@@ -1,3 +1,10 @@\n+2018-10-09  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* sem_ch7.adb (Has_Referencer): Add comment for the\n+\tN_Freeze_Entity case.  Do not rely on\n+\tHas_Referencer_Of_Non_Subprograms to clear the Is_Public flag on\n+\tsubprogram entities.\n+\n 2018-10-09  Ed Schonberg  <schonberg@adacore.com>\n \n \t* exp_unst.adb (In_Synchronized_Call): Handle properly private"}, {"sha": "6e9f531573356a4625fed595c6e6ccadc9becdce", "filename": "gcc/ada/sem_ch7.adb", "status": "modified", "additions": 9, "deletions": 2, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Fada%2Fsem_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Fada%2Fsem_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch7.adb?ref=0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "patch": "@@ -441,7 +441,13 @@ package body Sem_Ch7 is\n                      Discard : Boolean;\n                      pragma Unreferenced (Discard);\n                   begin\n-                     --  Inspect the actions to find references to subprograms\n+                     --  Inspect the actions to find references to subprograms.\n+                     --  We assume that the actions do not contain other kinds\n+                     --  of references and, therefore, we do not stop the scan\n+                     --  or set Has_Referencer_Of_Non_Subprograms here. Doing\n+                     --  it would pessimize common cases for which the actions\n+                     --  contain the declaration of an init procedure, since\n+                     --  such a procedure is automatically marked inline.\n \n                      Discard :=\n                        Has_Referencer (Actions (Decl),\n@@ -470,7 +476,8 @@ package body Sem_Ch7 is\n                     and then not Is_Exported (Decl_Id)\n                     and then No (Interface_Name (Decl_Id))\n                     and then\n-                      (not Has_Referencer_Of_Non_Subprograms\n+                      ((Nkind (Decl) /= N_Subprogram_Declaration\n+                         and then not Has_Referencer_Of_Non_Subprograms)\n                         or else (Nkind (Decl) = N_Subprogram_Declaration\n                                   and then not Subprogram_Table.Get (Decl_Id)))\n                   then"}, {"sha": "87368c7301da7c1ecd1102911b871e09374718de", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "patch": "@@ -1,3 +1,8 @@\n+2018-10-09  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/inline14.adb, gnat.dg/inline14_pkg.adb,\n+\tgnat.dg/inline14_pkg.ads: New testcase.\n+\n 2018-10-09  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/warn18.adb: New testcase."}, {"sha": "5bf9aa6e6faaff3a5a85934346f22f1488b7110d", "filename": "gcc/testsuite/gnat.dg/inline14.adb", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2Fgnat.dg%2Finline14.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2Fgnat.dg%2Finline14.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Finline14.adb?ref=0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "patch": "@@ -0,0 +1,9 @@\n+--  { dg-do compile }\n+--  { dg-options \"-O -gnatn\" }\n+\n+with Inline14_Pkg; use Inline14_Pkg;\n+\n+procedure Inline14 is\n+begin\n+  Proc;\n+end;"}, {"sha": "0b7192803846bb7243d805d8e9c5edbb714163dc", "filename": "gcc/testsuite/gnat.dg/inline14_pkg.adb", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2Fgnat.dg%2Finline14_pkg.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2Fgnat.dg%2Finline14_pkg.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Finline14_pkg.adb?ref=0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "patch": "@@ -0,0 +1,16 @@\n+package body Inline14_Pkg is\n+\n+  I : Integer;\n+\n+  generic procedure Inner;\n+\n+  procedure Inner is\n+  begin\n+    I := 0;\n+  end;\n+\n+  procedure My_Inner is new Inner;\n+\n+  procedure Proc renames My_Inner;\n+\n+end Inline14_Pkg;"}, {"sha": "d9c6dff76fd7ff81d8c4edca27566b1ce125e7f8", "filename": "gcc/testsuite/gnat.dg/inline14_pkg.ads", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2Fgnat.dg%2Finline14_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0444d0671d2696d9a3eef8ce01fe77f82702c0e3/gcc%2Ftestsuite%2Fgnat.dg%2Finline14_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Finline14_pkg.ads?ref=0444d0671d2696d9a3eef8ce01fe77f82702c0e3", "patch": "@@ -0,0 +1,6 @@\n+package Inline14_Pkg is\n+\n+  procedure Proc;\n+  pragma Inline (Proc);\n+\n+end Inline14_Pkg;"}]}