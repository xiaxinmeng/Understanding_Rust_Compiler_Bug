{"sha": "48d261d20a1588698f9aa4f92dfd151791c4e8e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDhkMjYxZDIwYTE1ODg2OThmOWFhNGY5MmRmZDE1MTc5MWM0ZThlMQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2012-03-23T00:35:33Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2012-03-23T00:35:33Z"}, "message": "re PR c++/52487 ([C++11] ICE at cp/semantics.c:5613 with lambda capturing reference to incomplete type by value)\n\n/cp\n2012-03-22  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/52487\n\t* class.c (check_field_decls): Call literal_type_p only\n\ton complete types.\n\n/testsuite\n2012-03-22  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/52487\n\t* g++.dg/cpp0x/lambda/lambda-ice7.C: New.\n\nFrom-SVN: r185722", "tree": {"sha": "e35f92911cddee26b212d45467cb513da73dc185", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e35f92911cddee26b212d45467cb513da73dc185"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/48d261d20a1588698f9aa4f92dfd151791c4e8e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48d261d20a1588698f9aa4f92dfd151791c4e8e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48d261d20a1588698f9aa4f92dfd151791c4e8e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48d261d20a1588698f9aa4f92dfd151791c4e8e1/comments", "author": null, "committer": null, "parents": [{"sha": "d7bdd048edd2ec5ab950e87d3991ff487b467269", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7bdd048edd2ec5ab950e87d3991ff487b467269", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7bdd048edd2ec5ab950e87d3991ff487b467269"}], "stats": {"total": 25, "additions": 23, "deletions": 2}, "files": [{"sha": "0fc0bd8a7f64c21dc4d2f32fcb23eb55a0d19e20", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=48d261d20a1588698f9aa4f92dfd151791c4e8e1", "patch": "@@ -1,3 +1,9 @@\n+2012-03-22  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/52487\n+\t* class.c (check_field_decls): Call literal_type_p only\n+\ton complete types.\n+\n 2012-03-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/52671"}, {"sha": "bc17c82c6a0308fa15c5fe80fb8794ace42b6bae", "filename": "gcc/cp/class.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=48d261d20a1588698f9aa4f92dfd151791c4e8e1", "patch": "@@ -3149,8 +3149,9 @@ check_field_decls (tree t, tree *access_decls,\n \tCLASSTYPE_NON_AGGREGATE (t) = 1;\n \n       /* If at least one non-static data member is non-literal, the whole\n-         class becomes non-literal.  */\n-      if (!literal_type_p (type))\n+         class becomes non-literal.  Note: if the type is incomplete we\n+\t will complain later on.  */\n+      if (COMPLETE_TYPE_P (type) && !literal_type_p (type))\n         CLASSTYPE_LITERAL_P (t) = false;\n \n       /* A standard-layout class is a class that:"}, {"sha": "bf3c5d10bdb1698b4684a09590e6db48d5a7a6a6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=48d261d20a1588698f9aa4f92dfd151791c4e8e1", "patch": "@@ -1,3 +1,8 @@\n+2012-03-22  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/52487\n+\t* g++.dg/cpp0x/lambda/lambda-ice7.C: New.\n+\n 2012-03-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/52671"}, {"sha": "946377e550a4c45c349879cdaec9cd98bbb0c909", "filename": "gcc/testsuite/g++.dg/cpp0x/lambda/lambda-ice7.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Flambda%2Flambda-ice7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d261d20a1588698f9aa4f92dfd151791c4e8e1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Flambda%2Flambda-ice7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Flambda%2Flambda-ice7.C?ref=48d261d20a1588698f9aa4f92dfd151791c4e8e1", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/52487\n+// { dg-options \"-std=c++0x\" }\n+\n+struct A;         // { dg-error \"forward declaration\" }\n+\n+void foo(A& a)\n+{\n+  [=](){a;};      // { dg-error \"invalid use of incomplete type\" }\n+}"}]}