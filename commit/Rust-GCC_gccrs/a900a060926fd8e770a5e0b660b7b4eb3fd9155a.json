{"sha": "a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTkwMGEwNjA5MjZmZDhlNzcwYTVlMGI2NjBiN2I0ZWIzZmQ5MTU1YQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-03-03T18:20:32Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2018-03-03T18:20:32Z"}, "message": "re PR fortran/51434 (ICE with scalar init of an array parameter, used in DT default init with transfer)\n\n2018-03-03  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/51434\n\t* simplify.c (gfc_simplify_transfer): Resolve mold.\n\n2018-03-03  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/51434\n\t* gfortran.dg/pr51434.f90: New test.\n\nFrom-SVN: r258220", "tree": {"sha": "1c2b002157fec392211d6e007f45058f0bfa3927", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1c2b002157fec392211d6e007f45058f0bfa3927"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/comments", "author": null, "committer": null, "parents": [{"sha": "88aa59ff7ede25ef44c0dafc2b06e2eaf9080d8a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88aa59ff7ede25ef44c0dafc2b06e2eaf9080d8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88aa59ff7ede25ef44c0dafc2b06e2eaf9080d8a"}], "stats": {"total": 38, "additions": 35, "deletions": 3}, "files": [{"sha": "c04a552344c3918605526fb8eec8005fcc7d5bd5", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "patch": "@@ -1,3 +1,8 @@\n+2018-03-03  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/51434\n+\t* simplify.c (gfc_simplify_transfer): Resolve mold.\n+\n 2018-03-03  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/80965"}, {"sha": "b130abacc521fc4266b4c3f9812ef57d90989f4b", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "patch": "@@ -25,6 +25,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"gfortran.h\"\n #include \"arith.h\"\n #include \"intrinsic.h\"\n+#include \"match.h\"\n #include \"target-memory.h\"\n #include \"constructor.h\"\n #include \"version.h\"\t/* For version_string.  */\n@@ -7370,10 +7371,12 @@ gfc_simplify_transfer (gfc_expr *source, gfc_expr *mold, gfc_expr *size)\n   unsigned char *buffer;\n   size_t result_length;\n \n+  if (!gfc_is_constant_expr (source) || !gfc_is_constant_expr (size))\n+    return NULL;\n \n-  if (!gfc_is_constant_expr (source)\n-\t|| (gfc_init_expr_flag && !gfc_is_constant_expr (mold))\n-\t|| !gfc_is_constant_expr (size))\n+  if (!gfc_resolve_expr (mold))\n+    return NULL;\n+  if (gfc_init_expr_flag && !gfc_is_constant_expr (mold))\n     return NULL;\n \n   if (!gfc_calculate_transfer_sizes (source, mold, size, &source_size,"}, {"sha": "2460b06280cb7b733840b7d2444e75f5482f094c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "patch": "@@ -1,3 +1,8 @@\n+2018-03-03  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/51434\n+\t* gfortran.dg/pr51434.f90: New test.\n+\n 2018-03-03  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/61358"}, {"sha": "31679ec5d78711382ecb8b5fae829a3e2d52ecd9", "filename": "gcc/testsuite/gfortran.dg/pr51434.f90", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr51434.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a900a060926fd8e770a5e0b660b7b4eb3fd9155a/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr51434.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr51434.f90?ref=a900a060926fd8e770a5e0b660b7b4eb3fd9155a", "patch": "@@ -0,0 +1,19 @@\n+! { dg-do run }\n+! PR fortran/51434\n+module foo\n+   implicit none\n+   integer, parameter :: n = 5\n+   character(len=1), parameter :: s(n) = 'a'\n+   type :: a\n+      integer :: m = n\n+      character(len=1):: t(n) = transfer('abcde             ', s)\n+   end type a\n+end module foo\n+\n+program bar\n+   use foo\n+   implicit none\n+   type(a) c\n+   if (c%m /= n) stop 1\n+   if (any(c%t /= ['a', 'b', 'c', 'd', 'e'])) stop 2\n+end program bar"}]}