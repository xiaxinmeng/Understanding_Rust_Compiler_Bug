{"sha": "cca7f1076abe9e521702ddbc1a2dbfea072bd563", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2NhN2YxMDc2YWJlOWU1MjE3MDJkZGJjMWEyZGJmZWEwNzJiZDU2Mw==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-01-29T15:25:11Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-01-29T15:25:11Z"}, "message": "[multiple changes]\n\n2014-01-29  Tristan Gingold  <gingold@adacore.com>\n\n\t* exp_ch9.adb (Build_Protected_Entry): Do not call\n\tComplete_Entry_Body anymore.\n\t* rtsfind.ads (RE_Complete_Single_Entry_Body): Remove.\n\t* s-tposen.ads, s-tposen.adb (Complete_Single_Entry_Body): Remove.\n\n2014-01-29  Pierre-Marie Derodat  <derodat@adacore.com>\n\n\t* s-os_lib.adb, s-os_lib.ads (Normalize_Pathname): Return an empty\n\tstring when the Name input bigger than allowed. Adapt the function\n\tspecification.\n\n2014-01-29  Ed Schonberg  <schonberg@adacore.com>\n\n\t* checks.adb (Install_Null_Excluding_Check): Do not emit warning\n\tif expression is within a case_expression of if_expression.\n\nFrom-SVN: r207247", "tree": {"sha": "5f38ce3c93473c0ef85520b2321f877a1d15a209", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5f38ce3c93473c0ef85520b2321f877a1d15a209"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cca7f1076abe9e521702ddbc1a2dbfea072bd563", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cca7f1076abe9e521702ddbc1a2dbfea072bd563", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cca7f1076abe9e521702ddbc1a2dbfea072bd563", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cca7f1076abe9e521702ddbc1a2dbfea072bd563/comments", "author": null, "committer": null, "parents": [{"sha": "443dd772d6121017bb24bfca182f1494c58ef7d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/443dd772d6121017bb24bfca182f1494c58ef7d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/443dd772d6121017bb24bfca182f1494c58ef7d2"}], "stats": {"total": 120, "additions": 67, "deletions": 53}, "files": [{"sha": "c6e15738146fbc7b7f8bfb2877ef098d83280be4", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -1,3 +1,21 @@\n+2014-01-29  Tristan Gingold  <gingold@adacore.com>\n+\n+\t* exp_ch9.adb (Build_Protected_Entry): Do not call\n+\tComplete_Entry_Body anymore.\n+\t* rtsfind.ads (RE_Complete_Single_Entry_Body): Remove.\n+\t* s-tposen.ads, s-tposen.adb (Complete_Single_Entry_Body): Remove.\n+\n+2014-01-29  Pierre-Marie Derodat  <derodat@adacore.com>\n+\n+\t* s-os_lib.adb, s-os_lib.ads (Normalize_Pathname): Return an empty\n+\tstring when the Name input bigger than allowed. Adapt the function\n+\tspecification.\n+\n+2014-01-29  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* checks.adb (Install_Null_Excluding_Check): Do not emit warning\n+\tif expression is within a case_expression of if_expression.\n+\n 2014-01-29  Robert Dewar  <dewar@adacore.com>\n \n \t* exp_ch9.adb, inline.ads: Minor reformatting."}, {"sha": "826c09bf11f42e92dd5d63fbdf2df01fc9ddcc4a", "filename": "gcc/ada/checks.adb", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fchecks.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fchecks.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fchecks.adb?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -6672,7 +6672,7 @@ package body Checks is\n    begin\n       pragma Assert (Is_Access_Type (Typ));\n \n-      --  No check inside a generic (why not???)\n+      --  No check inside a generic, check will be emitted in instance\n \n       if Inside_A_Generic then\n          return;\n@@ -6690,11 +6690,20 @@ package body Checks is\n \n          --  Avoid generating warning message inside init procs. In SPARK mode\n          --  we can go ahead and call Apply_Compile_Time_Constraint_Error\n-         --  since it will be truned into an error in any case.\n+         --  since it will be turned into an error in any case.\n \n-         if not Inside_Init_Proc or else SPARK_Mode = On then\n+         if (not Inside_Init_Proc or else SPARK_Mode = On)\n+\n+           --  Do not emit the warning within a conditional expression\n+           --  Why not ???\n+\n+           and then not Within_Case_Or_If_Expression (N)\n+         then\n             Apply_Compile_Time_Constraint_Error\n               (N, \"null value not allowed here??\", CE_Access_Check_Failed);\n+\n+         --  Remaining cases, where we silently insert the raise\n+\n          else\n             Insert_Action (N,\n               Make_Raise_Constraint_Error (Loc,"}, {"sha": "7c570a84a02c492cc837ac0e7aca09e8b3b28771", "filename": "gcc/ada/exp_ch9.adb", "status": "modified", "additions": 29, "deletions": 21, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fexp_ch9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fexp_ch9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch9.adb?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -3847,9 +3847,10 @@ package body Exp_Ch9 is\n         Build_Protected_Entry_Specification (Loc, Edef, Empty);\n \n       --  Add the following declarations:\n+\n       --    type poVP is access poV;\n       --    _object : poVP := poVP (_O);\n-      --\n+\n       --  where _O is the formal parameter associated with the concurrent\n       --  object. These declarations are needed for Complete_Entry_Body.\n \n@@ -3861,35 +3862,42 @@ package body Exp_Ch9 is\n       Add_Formal_Renamings (Espec, Op_Decls, Ent, Loc);\n       Debug_Private_Data_Declarations (Decls);\n \n+      --  Put the declarations and the statements from the entry\n+\n+      Op_Stats :=\n+        New_List (\n+          Make_Block_Statement (Loc,\n+            Declarations => Decls,\n+            Handled_Statement_Sequence =>\n+              Handled_Statement_Sequence (N)));\n+\n       case Corresponding_Runtime_Package (Pid) is\n          when System_Tasking_Protected_Objects_Entries =>\n-            Complete :=\n-              New_Reference_To (RTE (RE_Complete_Entry_Body), Loc);\n+            Append_To (Op_Stats,\n+              Make_Procedure_Call_Statement (End_Loc,\n+                Name                   =>\n+                  New_Reference_To (RTE (RE_Complete_Entry_Body), Loc),\n+                Parameter_Associations => New_List (\n+                  Make_Attribute_Reference (End_Loc,\n+                    Prefix         =>\n+                      Make_Selected_Component (End_Loc,\n+                        Prefix        =>\n+                          Make_Identifier (End_Loc, Name_uObject),\n+                        Selector_Name =>\n+                          Make_Identifier (End_Loc, Name_uObject)),\n+                    Attribute_Name => Name_Unchecked_Access))));\n \n          when System_Tasking_Protected_Objects_Single_Entry =>\n-            Complete :=\n-              New_Reference_To (RTE (RE_Complete_Single_Entry_Body), Loc);\n+\n+            --  Historically, a call to Complete_Single_Entry_Body was\n+            --  inserted, but it was a null procedure.\n+\n+            null;\n \n          when others =>\n             raise Program_Error;\n       end case;\n \n-      Op_Stats := New_List (\n-        Make_Block_Statement (Loc,\n-          Declarations => Decls,\n-          Handled_Statement_Sequence =>\n-            Handled_Statement_Sequence (N)),\n-\n-        Make_Procedure_Call_Statement (End_Loc,\n-          Name => Complete,\n-          Parameter_Associations => New_List (\n-            Make_Attribute_Reference (End_Loc,\n-              Prefix =>\n-                Make_Selected_Component (End_Loc,\n-                  Prefix        => Make_Identifier (End_Loc, Name_uObject),\n-                  Selector_Name => Make_Identifier (End_Loc, Name_uObject)),\n-              Attribute_Name => Name_Unchecked_Access))));\n-\n       --  When exceptions can not be propagated, we never need to call\n       --  Exception_Complete_Entry_Body\n "}, {"sha": "8325bcf1fb35e0339c136cc4c8136a58cac7dec7", "filename": "gcc/ada/rtsfind.ads", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Frtsfind.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Frtsfind.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.ads?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -1747,7 +1747,6 @@ package Rtsfind is\n      RE_Unlock_Entry,                    -- Protected_Objects.Single_Entry\n      RE_Protected_Single_Entry_Call,     -- Protected_Objects.Single_Entry\n      RE_Service_Entry,                   -- Protected_Objects.Single_Entry\n-     RE_Complete_Single_Entry_Body,      -- Protected_Objects.Single_Entry\n      RE_Exceptional_Complete_Single_Entry_Body,\n      RE_Protected_Count_Entry,           -- Protected_Objects.Single_Entry\n      RE_Protected_Single_Entry_Caller,   -- Protected_Objects.Single_Entry\n@@ -3057,8 +3056,6 @@ package Rtsfind is\n        System_Tasking_Protected_Objects_Single_Entry,\n      RE_Service_Entry                    =>\n        System_Tasking_Protected_Objects_Single_Entry,\n-     RE_Complete_Single_Entry_Body       =>\n-       System_Tasking_Protected_Objects_Single_Entry,\n      RE_Exceptional_Complete_Single_Entry_Body =>\n        System_Tasking_Protected_Objects_Single_Entry,\n      RE_Protected_Count_Entry            =>"}, {"sha": "8b4db7b5f0391197b2d184c3010608615f88cba0", "filename": "gcc/ada/s-os_lib.adb", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-os_lib.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-os_lib.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-os_lib.adb?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -1927,9 +1927,10 @@ package body System.OS_Lib is\n    --  Start of processing for Normalize_Pathname\n \n    begin\n-      --  Special case, if name is null, then return null\n+      --  Special case, return null if name is null, or if it is bigger than\n+      --  the biggest name allowed.\n \n-      if Name'Length = 0 then\n+      if Name'Length = 0 or else Name'Length > Max_Path then\n          return \"\";\n       end if;\n "}, {"sha": "cd644964f1fbe067a4d3c4db476d7a3f450d2647", "filename": "gcc/ada/s-os_lib.ads", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-os_lib.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-os_lib.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-os_lib.ads?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -445,9 +445,10 @@ package System.OS_Lib is\n    --  directory pointed to. This is slightly less efficient, since it\n    --  requires system calls.\n    --\n-   --  If Name cannot be resolved or is null on entry (for example if there is\n-   --  symbolic link circularity, e.g. A is a symbolic link for B, and B is a\n-   --  symbolic link for A), then Normalize_Pathname returns an empty  string.\n+   --  If Name cannot be resolved, is invalid (for example if it is too big) or\n+   --  is null on entry (for example if there is symbolic link circularity,\n+   --  e.g. A is a symbolic link for B, and B is a symbolic link for A), then\n+   --  Normalize_Pathname returns an empty string.\n    --\n    --  In VMS, if Name follows the VMS syntax file specification, it is first\n    --  converted into Unix syntax. If the conversion fails, Normalize_Pathname"}, {"sha": "356da5aa4616b2fd5972bb2bffa2bc7d470afd5d", "filename": "gcc/ada/s-tposen.adb", "status": "modified", "additions": 1, "deletions": 15, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-tposen.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-tposen.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tposen.adb?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                B o d y                                   --\n --                                                                          --\n---         Copyright (C) 1998-2009, Free Software Foundation, Inc.          --\n+--         Copyright (C) 1998-2013, Free Software Foundation, Inc.          --\n --                                                                          --\n -- GNARL is free software; you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -278,20 +278,6 @@ package body System.Tasking.Protected_Objects.Single_Entry is\n    -- Restricted GNARLI --\n    -----------------------\n \n-   --------------------------------\n-   -- Complete_Single_Entry_Body --\n-   --------------------------------\n-\n-   procedure Complete_Single_Entry_Body (Object : Protection_Entry_Access) is\n-      pragma Warnings (Off, Object);\n-\n-   begin\n-      --  Nothing needs to do (Object.Call_In_Progress.Exception_To_Raise\n-      --  has already been set to Null_Id).\n-\n-      null;\n-   end Complete_Single_Entry_Body;\n-\n    --------------------------------------------\n    -- Exceptional_Complete_Single_Entry_Body --\n    --------------------------------------------"}, {"sha": "6cfd3de537da3a2921e0015f0c23e9c31fd23261", "filename": "gcc/ada/s-tposen.ads", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-tposen.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cca7f1076abe9e521702ddbc1a2dbfea072bd563/gcc%2Fada%2Fs-tposen.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tposen.ads?ref=cca7f1076abe9e521702ddbc1a2dbfea072bd563", "patch": "@@ -250,12 +250,6 @@ package System.Tasking.Protected_Objects.Single_Entry is\n    --  Same as the Protected_Entry_Call but with time-out specified.\n    --  This routine is used to implement timed entry calls.\n \n-   procedure Complete_Single_Entry_Body\n-     (Object : Protection_Entry_Access);\n-   pragma Inline (Complete_Single_Entry_Body);\n-   --  Called from within an entry body procedure, indicates that the\n-   --  corresponding entry call has been serviced.\n-\n    procedure Exceptional_Complete_Single_Entry_Body\n      (Object : Protection_Entry_Access;\n       Ex     : Ada.Exceptions.Exception_Id);"}]}