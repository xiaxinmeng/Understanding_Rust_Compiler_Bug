{"sha": "c826a041081bfe9171353159a41da29b4667cdc0", "node_id": "C_kwDOANBUbNoAKGM4MjZhMDQxMDgxYmZlOTE3MTM1MzE1OWE0MWRhMjliNDY2N2NkYzA", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2022-11-22T17:22:03Z"}, "committer": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2022-11-22T17:29:01Z"}, "message": "ipa: IPA-SRA split detection simplification\n\nI have noticed that the flag m_split_modifications_p of\nipa_param_body_adjustments is not really necessary as it has to\ncorrespond to whether m_replacements is non-empty so this patches\nremoves it.  This also simplifies a bit some patches I work on.\n\ngcc/ChangeLog:\n\n2022-11-10  Martin Jambor  <mjambor@suse.cz>\n\n\t* ipa-param-manipulation.h (ipa_param_body_adjustments): Removed\n\tmember m_split_modifications_p.\n\t* ipa-param-manipulation.cc\n\t(ipa_param_body_adjustments::common_initialization): Do not set\n\tm_split_modifications_p.\n\t(ipa_param_body_adjustments::ipa_param_body_adjustments): Remove\n\tinitializations of m_split_modifications_p.\n\t(ipa_param_body_adjustments::modify_call_stmt): Check that\n\tm_replacements is empty instead of m_split_modifications_p.", "tree": {"sha": "25a05ea3a79666982a7d284477a49c52eb48e961", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/25a05ea3a79666982a7d284477a49c52eb48e961"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c826a041081bfe9171353159a41da29b4667cdc0", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE5elVTFt/d09Vsoczv2PBvD+kNUAFAmN9Bt0ACgkQv2PBvD+k\nNUCMWBAAsYcdeQ2QVoicf0yyphsUWicKk/ZYhdz46b0k6m3LnIDbVfpBUOCdF5Qb\nS1F+4JOfvs4GW3XKf8L3+a4l21fH3FUvGNY835/pDtJ8tFffzYV9AY9AsFNZOKcR\nVMpCldYUAhhk38oX+gCnBP+I4M3MbjkgFg/TN9uKU58ArSEK45JYn2BLrQ6nj6VT\nG4nIwMpKZ+127Iuuz5gf/SPhuI/ItIHcP/aDle7VzOYgR6HH8ZqsQQlNud1tORPC\ne2yM5K/AHiF1yYGw9yZ46JAYvbclwGmYPaFjiOdRISVBXwTlZkTxDCAqU8zp3a7N\ncR8+VQRX1clRE2H2Fq1U0zn995a0aK9l01W2eb4OY6qvvJbL3oaYyP76yZpN3b8X\nOyu3TXZSsTfNbsWfJMqUGfgqxjh4l6H3KzUK/qzl3Lo4HhhR6VLDudNxHOjgwnVL\nAEM3go+lZY39tVz0FjytBMTChApcQ+DUpXHk1Q6zzeI7EiEZGs1h4xIjHb6tSvN6\nTsVGhlesPj/p9uiXg8lzDEhHNZr5dOsefldRP3Ld9GYjoWhg/rsOVdvQx4sbP2cI\ne/JFXbJLUNKnghHd+07T873kV6d/OR2ezkeiETvVPQADQWewniH0cJ8e6Re0W64a\n3fPAlxChj7I5ivQXaFvQbWlXwdwPgo4lOq3VJ6nYJLDtsVjuQyo=\n=BeZS\n-----END PGP SIGNATURE-----", "payload": "tree 25a05ea3a79666982a7d284477a49c52eb48e961\nparent c4a92a9117a034e7cf291ae51d8b9b844fb5a88b\nauthor Martin Jambor <mjambor@suse.cz> 1669137723 +0100\ncommitter Martin Jambor <mjambor@suse.cz> 1669138141 +0100\n\nipa: IPA-SRA split detection simplification\n\nI have noticed that the flag m_split_modifications_p of\nipa_param_body_adjustments is not really necessary as it has to\ncorrespond to whether m_replacements is non-empty so this patches\nremoves it.  This also simplifies a bit some patches I work on.\n\ngcc/ChangeLog:\n\n2022-11-10  Martin Jambor  <mjambor@suse.cz>\n\n\t* ipa-param-manipulation.h (ipa_param_body_adjustments): Removed\n\tmember m_split_modifications_p.\n\t* ipa-param-manipulation.cc\n\t(ipa_param_body_adjustments::common_initialization): Do not set\n\tm_split_modifications_p.\n\t(ipa_param_body_adjustments::ipa_param_body_adjustments): Remove\n\tinitializations of m_split_modifications_p.\n\t(ipa_param_body_adjustments::modify_call_stmt): Check that\n\tm_replacements is empty instead of m_split_modifications_p.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c826a041081bfe9171353159a41da29b4667cdc0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c826a041081bfe9171353159a41da29b4667cdc0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c826a041081bfe9171353159a41da29b4667cdc0/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c4a92a9117a034e7cf291ae51d8b9b844fb5a88b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4a92a9117a034e7cf291ae51d8b9b844fb5a88b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4a92a9117a034e7cf291ae51d8b9b844fb5a88b"}], "stats": {"total": 33, "additions": 13, "deletions": 20}, "files": [{"sha": "cee0e23f946a65eb190b888fd66e3932d9082f15", "filename": "gcc/ipa-param-manipulation.cc", "status": "modified", "additions": 13, "deletions": 16, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c826a041081bfe9171353159a41da29b4667cdc0/gcc%2Fipa-param-manipulation.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c826a041081bfe9171353159a41da29b4667cdc0/gcc%2Fipa-param-manipulation.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-param-manipulation.cc?ref=c826a041081bfe9171353159a41da29b4667cdc0", "patch": "@@ -1378,7 +1378,6 @@ ipa_param_body_adjustments::common_initialization (tree old_fndecl,\n \n \t  if (apm->op == IPA_PARAM_OP_SPLIT)\n \t    {\n-\t      m_split_modifications_p = true;\n \t      split[prev_index] = true;\n \t      register_replacement (apm, new_parm);\n \t    }\n@@ -1472,10 +1471,10 @@ ipa_param_body_adjustments\n ::ipa_param_body_adjustments (vec<ipa_adjusted_param, va_gc> *adj_params,\n \t\t\t      tree fndecl)\n   : m_adj_params (adj_params), m_adjustments (NULL), m_reset_debug_decls (),\n-    m_split_modifications_p (false), m_dead_stmts (), m_dead_ssas (),\n-    m_dead_ssa_debug_equiv (), m_dead_stmt_debug_equiv (), m_fndecl (fndecl),\n-    m_id (NULL), m_oparms (), m_new_decls (), m_new_types (), m_replacements (),\n-    m_removed_decls (), m_removed_map (), m_method2func (false)\n+    m_dead_stmts (), m_dead_ssas (), m_dead_ssa_debug_equiv (),\n+    m_dead_stmt_debug_equiv (), m_fndecl (fndecl), m_id (NULL), m_oparms (),\n+    m_new_decls (), m_new_types (), m_replacements (), m_removed_decls (),\n+    m_removed_map (), m_method2func (false)\n {\n   common_initialization (fndecl, NULL, NULL);\n }\n@@ -1489,11 +1488,10 @@ ipa_param_body_adjustments\n ::ipa_param_body_adjustments (ipa_param_adjustments *adjustments,\n \t\t\t      tree fndecl)\n   : m_adj_params (adjustments->m_adj_params), m_adjustments (adjustments),\n-    m_reset_debug_decls (), m_split_modifications_p (false), m_dead_stmts (),\n-    m_dead_ssas (), m_dead_ssa_debug_equiv (), m_dead_stmt_debug_equiv (),\n-    m_fndecl (fndecl), m_id (NULL), m_oparms (), m_new_decls (),\n-    m_new_types (), m_replacements (), m_removed_decls (), m_removed_map (),\n-    m_method2func (false)\n+    m_reset_debug_decls (), m_dead_stmts (), m_dead_ssas (),\n+    m_dead_ssa_debug_equiv (), m_dead_stmt_debug_equiv (), m_fndecl (fndecl),\n+    m_id (NULL), m_oparms (), m_new_decls (), m_new_types (), m_replacements (),\n+    m_removed_decls (), m_removed_map (), m_method2func (false)\n {\n   common_initialization (fndecl, NULL, NULL);\n }\n@@ -1513,11 +1511,10 @@ ::ipa_param_body_adjustments (ipa_param_adjustments *adjustments,\n \t\t\t      copy_body_data *id, tree *vars,\n \t\t\t      vec<ipa_replace_map *, va_gc> *tree_map)\n   : m_adj_params (adjustments->m_adj_params), m_adjustments (adjustments),\n-    m_reset_debug_decls (), m_split_modifications_p (false), m_dead_stmts (),\n-    m_dead_ssas (), m_dead_ssa_debug_equiv (), m_dead_stmt_debug_equiv (),\n-    m_fndecl (fndecl), m_id (id), m_oparms (), m_new_decls (), m_new_types (),\n-    m_replacements (), m_removed_decls (), m_removed_map (),\n-    m_method2func (false)\n+    m_reset_debug_decls (), m_dead_stmts (), m_dead_ssas (),\n+    m_dead_ssa_debug_equiv (), m_dead_stmt_debug_equiv (), m_fndecl (fndecl),\n+    m_id (id), m_oparms (), m_new_decls (), m_new_types (), m_replacements (),\n+    m_removed_decls (), m_removed_map (), m_method2func (false)\n {\n   common_initialization (old_fndecl, vars, tree_map);\n }\n@@ -1979,7 +1976,7 @@ ipa_param_body_adjustments::modify_call_stmt (gcall **stmt_p,\n \t  && m_dead_ssas.contains (t))\n \trecreate = true;\n \n-      if (!m_split_modifications_p)\n+      if (m_replacements.is_empty ())\n \tcontinue;\n \n       tree base;"}, {"sha": "e5654f4ff701acb187ff0cfe59e55490be93c315", "filename": "gcc/ipa-param-manipulation.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c826a041081bfe9171353159a41da29b4667cdc0/gcc%2Fipa-param-manipulation.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c826a041081bfe9171353159a41da29b4667cdc0/gcc%2Fipa-param-manipulation.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-param-manipulation.h?ref=c826a041081bfe9171353159a41da29b4667cdc0", "patch": "@@ -350,10 +350,6 @@ class ipa_param_body_adjustments\n \n   auto_vec<tree, 16> m_reset_debug_decls;\n \n-  /* Set to true if there are any IPA_PARAM_OP_SPLIT adjustments among stored\n-     adjustments.  */\n-  bool m_split_modifications_p;\n-\n   /* Sets of statements and SSA_NAMEs that only manipulate data from parameters\n      removed because they are not necessary.  */\n   hash_set<gimple *> m_dead_stmts;"}]}