{"sha": "148907eaa6e6cf62e8e253d6124dbd24f653dccc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQ4OTA3ZWFhNmU2Y2Y2MmU4ZTI1M2Q2MTI0ZGJkMjRmNjUzZGNjYw==", "commit": {"author": {"name": "Paolo Bonzini", "email": "bonzini@gnu.org", "date": "2004-05-24T11:08:12Z"}, "committer": {"name": "Paolo Bonzini", "email": "bonzini@gcc.gnu.org", "date": "2004-05-24T11:08:12Z"}, "message": "configure.in: Test the ability to symlink directories.\n\n2005-05-24  Paolo Bonzini <bonzini@gnu.org>\n\n\t* configure.in: Test the ability to symlink directories.\n\t* configure: Regenerate.\n\n\t* Makefile.def (bootstrap-stage): New definitions.\n\t* Makefile.tpl (configure-stage1-gcc,\n\tconfigure-stage2-gcc, configure-stage3-gcc,\n\tall-stage1-gcc, all-stage2-gcc, all-stage3-gcc,\n\tnew-bootstrap, new-cleanstrap, new-restage1, new-restage2,\n\tnew-restage3, compare): Autogenerate, see Makefile.in\n\tentry for behavioral changes.\n\t(distclean-stage1, new-stage1-start, new-stage1-end,\n\tnew-stage1-bubble, distclean-stage2, new-stage2-start,\n\tnew-stage2-end, new-stage2-bubble, distclean-stage3,\n\tnew-stage3-start, new-stage3-end): New autogenerated targets.\n\t(objext, prebootstrap, BOOT_CFLAGS,\n\tPOSTSTAGE1_FLAGS_TO_PASS): Move above the autogenerated\n\ttargets.\n\n\t* Makefile.in: Regenerate.\n\t(distclean-stage1, new-stage1-start, new-stage1-end,\n\tnew-stage1-bubble, distclean-stage2, new-stage2-start,\n\tnew-stage2-end, new-stage2-bubble, distclean-stage3,\n\tnew-stage3-start, new-stage3-end): New targets.\n\t(all-stage1-gcc): Move prebootstrap dependency from here...\n\t(configure-stage1-gcc): ...to here.\n\t(new-bootstrap): Use bubble targets.\n\t(new-cleanstrap, new-restage1, new-restage2, new-restage3):\n\tUse per-stage distclean targets.\n\t(configure-stage1-gcc, configure-stage2-gcc,\n\tconfigure-stage3-gcc, all-stage1-gcc,\n\tall-stage2-gcc, all-stage3-gcc, new-bootstrap):\n\tUse new-stageN-start to prepare the tree.\n\nFrom-SVN: r82200", "tree": {"sha": "c963019b2a12f23463011a03878e3e0c0c96d434", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c963019b2a12f23463011a03878e3e0c0c96d434"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/148907eaa6e6cf62e8e253d6124dbd24f653dccc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/148907eaa6e6cf62e8e253d6124dbd24f653dccc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/148907eaa6e6cf62e8e253d6124dbd24f653dccc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/148907eaa6e6cf62e8e253d6124dbd24f653dccc/comments", "author": {"login": "bonzini", "id": 42082, "node_id": "MDQ6VXNlcjQyMDgy", "avatar_url": "https://avatars.githubusercontent.com/u/42082?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bonzini", "html_url": "https://github.com/bonzini", "followers_url": "https://api.github.com/users/bonzini/followers", "following_url": "https://api.github.com/users/bonzini/following{/other_user}", "gists_url": "https://api.github.com/users/bonzini/gists{/gist_id}", "starred_url": "https://api.github.com/users/bonzini/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bonzini/subscriptions", "organizations_url": "https://api.github.com/users/bonzini/orgs", "repos_url": "https://api.github.com/users/bonzini/repos", "events_url": "https://api.github.com/users/bonzini/events{/privacy}", "received_events_url": "https://api.github.com/users/bonzini/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4f4e53dd8517c0b2cbe36f0cf866f9f5ebe294e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f4e53dd8517c0b2cbe36f0cf866f9f5ebe294e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f4e53dd8517c0b2cbe36f0cf866f9f5ebe294e9"}], "stats": {"total": 961, "additions": 550, "deletions": 411}, "files": [{"sha": "90959b77aea4b4525d8772642dd2f726eecece31", "filename": "ChangeLog", "status": "modified", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/148907eaa6e6cf62e8e253d6124dbd24f653dccc/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/148907eaa6e6cf62e8e253d6124dbd24f653dccc/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=148907eaa6e6cf62e8e253d6124dbd24f653dccc", "patch": "@@ -1,3 +1,38 @@\n+2005-05-24  Paolo Bonzini <bonzini@gnu.org>\n+\n+\t* configure.in: Test the ability to symlink directories.\n+\t* configure: Regenerate.\n+\n+\t* Makefile.def (bootstrap-stage): New definitions.\n+\t* Makefile.tpl (configure-stage1-gcc,\n+\tconfigure-stage2-gcc, configure-stage3-gcc,\n+\tall-stage1-gcc, all-stage2-gcc, all-stage3-gcc,\n+\tnew-bootstrap, new-cleanstrap, new-restage1, new-restage2,\n+\tnew-restage3, compare): Autogenerate, see Makefile.in\n+\tentry for behavioral changes.\n+\t(distclean-stage1, new-stage1-start, new-stage1-end,\n+\tnew-stage1-bubble, distclean-stage2, new-stage2-start,\n+\tnew-stage2-end, new-stage2-bubble, distclean-stage3,\n+\tnew-stage3-start, new-stage3-end): New autogenerated targets.\n+\t(objext, prebootstrap, BOOT_CFLAGS,\n+\tPOSTSTAGE1_FLAGS_TO_PASS): Move above the autogenerated\n+\ttargets.\n+\n+\t* Makefile.in: Regenerate.\n+\t(distclean-stage1, new-stage1-start, new-stage1-end,\n+\tnew-stage1-bubble, distclean-stage2, new-stage2-start,\n+\tnew-stage2-end, new-stage2-bubble, distclean-stage3,\n+\tnew-stage3-start, new-stage3-end): New targets.\n+\t(all-stage1-gcc): Move prebootstrap dependency from here...\n+\t(configure-stage1-gcc): ...to here.\n+\t(new-bootstrap): Use bubble targets.\n+\t(new-cleanstrap, new-restage1, new-restage2, new-restage3):\n+\tUse per-stage distclean targets.\n+\t(configure-stage1-gcc, configure-stage2-gcc,\n+\tconfigure-stage3-gcc, all-stage1-gcc,\n+\tall-stage2-gcc, all-stage3-gcc, new-bootstrap):\n+\tUse new-stageN-start to prepare the tree.\n+\n 2004-05-23  Paolo Bonzini  <bonzini@gnu.org>\n \n \t* Makefile.def (host_modules): add libcpp."}, {"sha": "9c425963f5cf2714e0d1c4431a42d876c7de301f", "filename": "Makefile.def", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/148907eaa6e6cf62e8e253d6124dbd24f653dccc/Makefile.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/148907eaa6e6cf62e8e253d6124dbd24f653dccc/Makefile.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/Makefile.def?ref=148907eaa6e6cf62e8e253d6124dbd24f653dccc", "patch": "@@ -213,3 +213,21 @@ flags_to_pass = { flag= LIBCXXFLAGS_FOR_TARGET ; };\n flags_to_pass = { flag= NM_FOR_TARGET ; };\n flags_to_pass = { flag= RANLIB_FOR_TARGET ; };\n flags_to_pass = { flag= WINDRES_FOR_TARGET ; };\n+\n+// Toplevel bootstrap\n+bootstrap_stage = {\n+\tid=1 ; next=2 ;\n+\textra_configure_flags='--disable-intermodule \\\n+\t  --disable-coverage --enable-languages=\"$(STAGE1_LANGUAGES)\"' ;\n+\textra_make_flags='CFLAGS=\"$(STAGE1_CFLAGS)\"' ; };\n+bootstrap_stage = {\n+\tid=2 ; prev=1 ; next=3 ;\n+\textra_configure_flags=\"@stage2_werror_flag@\" ;\n+\textra_make_flags=\"$(POSTSTAGE1_FLAGS_TO_PASS)\" ; };\n+bootstrap_stage = {\n+\tid=3 ; prev=2 ;\n+\tcompare_target=compare ;\n+\tbootstrap_target=new-bootstrap ;\n+\tcleanstrap_target=new-cleanstrap ;\n+\textra_configure_flags=\"@stage2_werror_flag@\" ;\n+\textra_make_flags=\"$(POSTSTAGE1_FLAGS_TO_PASS)\" ; };"}, {"sha": "11548f28247734167dea1c97e08b2d96c484bfac", "filename": "Makefile.in", "status": "modified", "additions": 230, "deletions": 136, "changes": 366, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/148907eaa6e6cf62e8e253d6124dbd24f653dccc/Makefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/148907eaa6e6cf62e8e253d6124dbd24f653dccc/Makefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/Makefile.in?ref=148907eaa6e6cf62e8e253d6124dbd24f653dccc", "patch": "@@ -28287,16 +28287,26 @@ maintainer-clean-gcc:\n # GCC bootstrap support\n # ---------------------\n \n-# We name the directories for the various stages \"stage1-gcc\",\n-# \"stage2-gcc\",\"stage3-gcc\", etc.  \n-# Unfortunately, the 'compare' process will fail (on debugging information)\n-# if any directory names are different!\n-# So in the building rule for each stage, we relocate them before and after.\n-# The current one is 'gcc', while the previous one is 'prev-gcc'.  (The\n-# current one must be 'gcc' for now because the scripts in that directory\n-# assume it.)\n-# At the end of the bootstrap, 'stage3-gcc' must be moved to 'gcc' so that\n-# libraries can find it.  Ick!\n+# We track the current stage (the one in 'gcc') in the stage_last file.\n+# We name the build directories for the various stages \"stage1-gcc\",\n+# \"stage2-gcc\",\"stage3-gcc\", etc.\n+\n+# Since the 'compare' process will fail (on debugging information) if any\n+# directory names are different, we need to link the gcc directory for\n+# the previous stage to a constant name ('gcc-prev'), and to make the name of\n+# the build directories constant as well. For the latter, we use naked names\n+# like 'gcc', because the scripts in that directory assume it.  We use\n+# mv on platforms where symlinks to directories do not work or are not\n+# reliable.\n+\n+# At the end of the bootstrap, a symlink to 'stage3-gcc' named 'gcc' must\n+# be kept, so that libraries can find it.  Ick!\n+\n+# It would be best to preinstall gcc into a staging area (and in the\n+# future, gather there all prebootstrap packages).  This would allow\n+# assemblers and linkers can be bootstrapped as well as the compiler\n+# (both in a combined tree, or separately).  This however requires some\n+# change to the gcc driver, again in order to avoid comparison failures.\n \n # Bugs: This is almost certainly not parallel-make safe.\n \n@@ -28312,6 +28322,21 @@ STAMP = echo timestamp >\n STAGE1_CFLAGS=@stage1_cflags@\n STAGE1_LANGUAGES=@stage1_languages@\n \n+# We only want to compare .o files, so set this!\n+objext = .o\n+\n+# Real targets act phony if they depend on phony targets; this hack\n+# prevents gratuitous rebuilding of stage 1.\n+prebootstrap:\n+\t$(MAKE) all-bootstrap\n+\t$(STAMP) prebootstrap\n+\n+# Flags to pass to stage2 and later makes.\n+BOOT_CFLAGS= -g -O2\n+POSTSTAGE1_FLAGS_TO_PASS = \\\n+\tCFLAGS=\"$(BOOT_CFLAGS)\" \\\n+\tADAC=\"\\$$(CC)\"\n+\n # For stage 1:\n # * We force-disable intermodule optimizations, even if\n #   --enable-intermodule was passed, since the installed compiler probably\n@@ -28320,27 +28345,53 @@ STAGE1_LANGUAGES=@stage1_languages@\n # * Likewise, we force-disable coverage flags, since the installed compiler\n #   probably has never heard of them.\n # * We build only C (and possibly Ada).\n-configure-stage1-gcc:\n-\techo configure-stage1-gcc > stage_last ; \\\n-\tif [ -f stage1-gcc/Makefile ] ; then \\\n+\n+\n+.PHONY: new-stage1-start new-stage1-end\n+\n+new-stage1-start:\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\techo stage1 > stage_last ; \\\n+\t[ -d stage1-gcc ] || mkdir stage1-gcc; \\\n+\tset stage1-gcc gcc ; @CREATE_LINK_TO_DIR@ \n+\n+new-stage1-end:\n+\trm -f stage_last ; \\\n+\tset gcc stage1-gcc ; @UNDO_LINK_TO_DIR@ \n+\n+# Bubble a bugfix through all the stages up to stage 1.  They\n+# are remade, but not reconfigured.  The next stage (if any) will not\n+# be reconfigured as well.\n+.PHONY: new-stage1-bubble\n+new-stage1-bubble: \n+\t@if [ -f all-stage1-gcc ] ; then \\\n+\t  echo Remaking stage 1 ; \\\n+\t  rm -f all-stage1-gcc ; \\\n+\t  $(MAKE) all-stage1-gcc  && \\\n+\t  if [ -f configure-stage2-gcc ] ; then \\\n+\t    $(STAMP) configure-stage2-gcc ; \\\n+\t  fi ; \\\n+\telse \\\n+\t  $(MAKE) all-stage1-gcc ; \\\n+\tfi\n+\n+configure-stage1-gcc:  prebootstrap \n+\t$(MAKE) new-stage1-start\n+\t@if [ -f stage1-gcc/Makefile ] ; then \\\n \t  $(STAMP) configure-stage1-gcc ; \\\n \t  exit 0; \\\n \telse \\\n \t  true ; \\\n \tfi ; \\\n-\t[ -d stage1-gcc ] || mkdir stage1-gcc; \\\n-\tmv stage1-gcc gcc ; \\\n \tr=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n \tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n \tTOPLEVEL_CONFIGURE_ARGUMENTS=\"$(TOPLEVEL_CONFIGURE_ARGUMENTS)\"; export TOPLEVEL_CONFIGURE_ARGUMENTS; \\\n-\tCC=\"$(CC)\"; export CC; \\\n \tCFLAGS=\"$(CFLAGS)\"; export CFLAGS; \\\n \tCXX=\"$(CXX)\"; export CXX; \\\n \tCXXFLAGS=\"$(CXXFLAGS)\"; export CXXFLAGS; \\\n \tAR=\"$(AR)\"; export AR; \\\n \tAS=\"$(AS)\"; export AS; \\\n-\tCC_FOR_BUILD=\"$(CC_FOR_BUILD)\"; export CC_FOR_BUILD; \\\n \tDLLTOOL=\"$(DLLTOOL)\"; export DLLTOOL; \\\n \tLD=\"$(LD)\"; export LD; \\\n \tLDFLAGS=\"$(LDFLAGS)\"; export LDFLAGS; \\\n@@ -28349,7 +28400,11 @@ configure-stage1-gcc:\n \tWINDRES=\"$(WINDRES)\"; export WINDRES; \\\n \tOBJCOPY=\"$(OBJCOPY)\"; export OBJCOPY; \\\n \tOBJDUMP=\"$(OBJDUMP)\"; export OBJDUMP; \\\n-\techo Configuring stage 1 in gcc; \\\n+\tGMPLIBS=\"$(HOST_GMPLIBS)\"; export GMPLIBS; \\\n+\tGMPINC=\"$(HOST_GMPINC)\"; export GMPINC  ; \\\n+\tCC=\"$(CC)\"; export CC; \\\n+\tCC_FOR_BUILD=\"$(CC_FOR_BUILD)\"; export CC_FOR_BUILD  ; \\\n+\techo Configuring stage 1 in gcc ; \\\n \tcd gcc || exit 1; \\\n \tcase $(srcdir) in \\\n \t  \\.) \\\n@@ -28364,45 +28419,72 @@ configure-stage1-gcc:\n \tesac; \\\n \t$(SHELL) $${libsrcdir}/configure \\\n \t  $(HOST_CONFIGARGS) $${srcdiroption} \\\n-\t  --disable-intermodule --disable-coverage \\\n-\t  --enable-languages=\"$(STAGE1_LANGUAGES)\"; \\\n-\tcd .. ; \\\n-\tmv gcc stage1-gcc ; \\\n-\t$(STAMP) configure-stage1-gcc\n+\t  --disable-intermodule \t  --disable-coverage --enable-languages=\"$(STAGE1_LANGUAGES)\" && \\\n+\t  $(STAMP) ../configure-stage1-gcc\n \n-# Real targets act phony if they depend on phony targets; this hack\n-# prevents gratuitous rebuilding of stage 1.\n-prebootstrap:\n-\t$(MAKE) all-bootstrap\n-\t$(STAMP) prebootstrap\n-\n-all-stage1-gcc: configure-stage1-gcc prebootstrap\n-\techo all-stage1-gcc > stage_last ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n+all-stage1-gcc: configure-stage1-gcc\n+\t$(MAKE) new-stage1-start\n+\t@r=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tmv stage1-gcc gcc ; \\\n \tcd gcc && \\\n-\t$(MAKE) $(GCC_FLAGS_TO_PASS) \\\n-\t\tCFLAGS=\"$(STAGE1_CFLAGS)\" && $(STAMP) ../all-stage1-gcc ; \\\n-\tresult=$$? ; \\\n-\tcd .. ; \\\n-\tmv gcc stage1-gcc ; \\\n-\texit $$result\n-\n-# TODO: Deal with STAGE_PREFIX (which is only for ada, incidentally)\n-# Possibly pass --enable-werror-always (depending on --enable-werror);\n-# that's what @stage2_werror_flag@ is for\n-configure-stage2-gcc: all-stage1-gcc\n-\techo configure-stage2-gcc > stage_last ; \\\n-\tif [ -f stage2-gcc/Makefile ] ; then \\\n+\t$(MAKE) $(GCC_FLAGS_TO_PASS)  \\\n+\t\tCFLAGS=\"$(STAGE1_CFLAGS)\" && $(STAMP) ../all-stage1-gcc\n+\n+\n+\n+\n+\n+.PHONY: new-restage1 distclean-stage1\n+\n+distclean-stage1:  distclean-stage2 \n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\trm -rf configure-stage1-gcc all-stage1-gcc stage1-gcc \n+\n+new-restage1:  distclean-stage2 \n+\trm -rf all-stage1-gcc \n+\t$(MAKE)  all-stage1-gcc \n+\n+\n+\n+\n+.PHONY: new-stage2-start new-stage2-end\n+\n+new-stage2-start:\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\techo stage2 > stage_last ; \\\n+\t[ -d stage2-gcc ] || mkdir stage2-gcc; \\\n+\tset stage2-gcc gcc ; @CREATE_LINK_TO_DIR@  ; \\\n+\tset stage1-gcc prev-gcc ; @CREATE_LINK_TO_DIR@ \n+\n+new-stage2-end:\n+\trm -f stage_last ; \\\n+\tset gcc stage2-gcc ; @UNDO_LINK_TO_DIR@  ; \\\n+\tset prev-gcc stage1-gcc ; @UNDO_LINK_TO_DIR@ \n+\n+# Bubble a bugfix through all the stages up to stage 2.  They\n+# are remade, but not reconfigured.  The next stage (if any) will not\n+# be reconfigured as well.\n+.PHONY: new-stage2-bubble\n+new-stage2-bubble: new-stage1-bubble\n+\t@if [ -f all-stage2-gcc ] ; then \\\n+\t  echo Remaking stage 2 ; \\\n+\t  rm -f all-stage2-gcc ; \\\n+\t  $(MAKE) all-stage2-gcc  && \\\n+\t  if [ -f configure-stage3-gcc ] ; then \\\n+\t    $(STAMP) configure-stage3-gcc ; \\\n+\t  fi ; \\\n+\telse \\\n+\t  $(MAKE) all-stage2-gcc ; \\\n+\tfi\n+\n+configure-stage2-gcc:  all-stage1-gcc \n+\t$(MAKE) new-stage2-start\n+\t@if [ -f stage2-gcc/Makefile ] ; then \\\n \t  $(STAMP) configure-stage2-gcc ; \\\n \t  exit 0; \\\n \telse \\\n \t  true ; \\\n \tfi ; \\\n-\t[ -d stage2-gcc ] || mkdir stage2-gcc; \\\n-\tmv stage2-gcc gcc ; \\\n-\tmv stage1-gcc prev-gcc ; \\\n \tr=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n \tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n@@ -28420,9 +28502,11 @@ configure-stage2-gcc: all-stage1-gcc\n \tWINDRES=\"$(WINDRES)\"; export WINDRES; \\\n \tOBJCOPY=\"$(OBJCOPY)\"; export OBJCOPY; \\\n \tOBJDUMP=\"$(OBJDUMP)\"; export OBJDUMP; \\\n+\tGMPLIBS=\"$(HOST_GMPLIBS)\"; export GMPLIBS; \\\n+\tGMPINC=\"$(HOST_GMPINC)\"; export GMPINC  ; \\\n \tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC; \\\n-\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD; \\\n-\techo Configuring stage 2 in gcc; \\\n+\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD  ; \\\n+\techo Configuring stage 2 in gcc ; \\\n \tcd gcc || exit 1; \\\n \tcase $(srcdir) in \\\n \t  \\.) \\\n@@ -28436,47 +28520,73 @@ configure-stage2-gcc: all-stage1-gcc\n \t    libsrcdir=\"$$s/gcc\";; \\\n \tesac; \\\n \t$(SHELL) $${libsrcdir}/configure \\\n-\t  $(HOST_CONFIGARGS) $${srcdiroption} @stage2_werror_flag@ ; \\\n-\tcd .. ; \\\n-\tmv gcc stage2-gcc ; \\\n-\tmv prev-gcc stage1-gcc ; \\\n-\t$(STAMP) configure-stage2-gcc\n-\n-# Flags to pass to stage2 and later makes.\n-BOOT_CFLAGS= -g -O2\n-POSTSTAGE1_FLAGS_TO_PASS = \\\n-\tCFLAGS=\"$(BOOT_CFLAGS)\" \\\n-\tADAC=\"\\$$(CC)\"\n+\t  $(HOST_CONFIGARGS) $${srcdiroption} \\\n+\t  @stage2_werror_flag@ && \\\n+\t  $(STAMP) ../configure-stage2-gcc\n \n-all-stage2-gcc: all-stage1-gcc configure-stage2-gcc\n-\techo all-stage2-gcc > stage_last ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n+all-stage2-gcc: configure-stage2-gcc\n+\t$(MAKE) new-stage2-start\n+\t@r=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tmv stage2-gcc gcc ; \\\n-\tmv stage1-gcc prev-gcc ; \\\n \tcd gcc && \\\n-\t$(MAKE) $(GCC_FLAGS_TO_PASS) \\\n+\t$(MAKE) $(GCC_FLAGS_TO_PASS)  \\\n \t\tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n \t\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n-\t\tSTAGE_PREFIX=$$r/prev-gcc/ \\\n-\t\t$(POSTSTAGE1_FLAGS_TO_PASS) && $(STAMP) ../all-stage2-gcc ; \\\n-\tresult=$$? ; \\\n-\tcd .. ; \\\n-\tmv prev-gcc stage1-gcc ; \\\n-\tmv gcc stage2-gcc ; \\\n-\texit $$result\n+\t\tSTAGE_PREFIX=$$r/stage1-gcc/  \\\n+\t\t$(POSTSTAGE1_FLAGS_TO_PASS) && $(STAMP) ../all-stage2-gcc\n+\n+\n+\n+\n+\n+.PHONY: new-restage2 distclean-stage2\n+\n+distclean-stage2:  distclean-stage3 \n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\trm -rf configure-stage2-gcc all-stage2-gcc stage2-gcc \n \n-configure-stage3-gcc: all-stage2-gcc\n-\techo configure-stage3-gcc > stage_last ; \\\n-\tif [ -f stage3-gcc/Makefile ] ; then \\\n+new-restage2:  distclean-stage3 \n+\trm -rf all-stage2-gcc \n+\t$(MAKE)  all-stage2-gcc \n+\n+\n+\n+\n+.PHONY: new-stage3-start new-stage3-end\n+\n+new-stage3-start:\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\techo stage3 > stage_last ; \\\n+\t[ -d stage3-gcc ] || mkdir stage3-gcc; \\\n+\tset stage3-gcc gcc ; @CREATE_LINK_TO_DIR@  ; \\\n+\tset stage2-gcc prev-gcc ; @CREATE_LINK_TO_DIR@ \n+\n+new-stage3-end:\n+\trm -f stage_last ; \\\n+\tset gcc stage3-gcc ; @UNDO_LINK_TO_DIR@  ; \\\n+\tset prev-gcc stage2-gcc ; @UNDO_LINK_TO_DIR@ \n+\n+# Bubble a bugfix through all the stages up to stage 3.  They\n+# are remade, but not reconfigured.  The next stage (if any) will not\n+# be reconfigured as well.\n+.PHONY: new-stage3-bubble\n+new-stage3-bubble: new-stage2-bubble\n+\t@if [ -f all-stage3-gcc ] ; then \\\n+\t  echo Remaking stage 3 ; \\\n+\t  rm -f all-stage3-gcc ; \\\n+\t  $(MAKE) all-stage3-gcc ; \\\n+\telse \\\n+\t  $(MAKE) all-stage3-gcc ; \\\n+\tfi\n+\n+configure-stage3-gcc:  all-stage2-gcc \n+\t$(MAKE) new-stage3-start\n+\t@if [ -f stage3-gcc/Makefile ] ; then \\\n \t  $(STAMP) configure-stage3-gcc ; \\\n \t  exit 0; \\\n \telse \\\n \t  true ; \\\n \tfi ; \\\n-\t[ -d stage3-gcc ] || mkdir stage3-gcc; \\\n-\tmv stage3-gcc gcc ; \\\n-\tmv stage2-gcc prev-gcc ; \\\n \tr=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n \tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n@@ -28494,9 +28604,11 @@ configure-stage3-gcc: all-stage2-gcc\n \tWINDRES=\"$(WINDRES)\"; export WINDRES; \\\n \tOBJCOPY=\"$(OBJCOPY)\"; export OBJCOPY; \\\n \tOBJDUMP=\"$(OBJDUMP)\"; export OBJDUMP; \\\n+\tGMPLIBS=\"$(HOST_GMPLIBS)\"; export GMPLIBS; \\\n+\tGMPINC=\"$(HOST_GMPINC)\"; export GMPINC  ; \\\n \tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC; \\\n-\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD; \\\n-\techo Configuring stage 3 in gcc; \\\n+\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD  ; \\\n+\techo Configuring stage 3 in gcc ; \\\n \tcd gcc || exit 1; \\\n \tcase $(srcdir) in \\\n \t  \\.) \\\n@@ -28510,35 +28622,25 @@ configure-stage3-gcc: all-stage2-gcc\n \t    libsrcdir=\"$$s/gcc\";; \\\n \tesac; \\\n \t$(SHELL) $${libsrcdir}/configure \\\n-\t  $(HOST_CONFIGARGS) $${srcdiroption} @stage2_werror_flag@ ; \\\n-\tcd .. ; \\\n-\tmv gcc stage3-gcc ; \\\n-\tmv prev-gcc stage2-gcc ; \\\n-\t$(STAMP) configure-stage3-gcc\n+\t  $(HOST_CONFIGARGS) $${srcdiroption} \\\n+\t  @stage2_werror_flag@ && \\\n+\t  $(STAMP) ../configure-stage3-gcc\n \n-all-stage3-gcc: all-stage2-gcc configure-stage3-gcc\n-\techo all-stage3-gcc > stage_last ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n+all-stage3-gcc: configure-stage3-gcc\n+\t$(MAKE) new-stage3-start\n+\t@r=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tmv stage2-gcc prev-gcc ; \\\n-\tmv stage3-gcc gcc ; \\\n \tcd gcc && \\\n-\t$(MAKE) $(GCC_FLAGS_TO_PASS) \\\n+\t$(MAKE) $(GCC_FLAGS_TO_PASS)  \\\n \t\tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n \t\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n-\t\tSTAGE_PREFIX=$$r/prev-gcc/ \\\n-\t\t$(POSTSTAGE1_FLAGS_TO_PASS) && $(STAMP) ../all-stage3-gcc \\\n-\tresult=$$? ; \\\n-\tcd .. ; \\\n-\tmv prev-gcc stage2-gcc ; \\\n-\tmv gcc stage3-gcc ; \\\n-\texit $$result\n+\t\tSTAGE_PREFIX=$$r/stage2-gcc/  \\\n+\t\t$(POSTSTAGE1_FLAGS_TO_PASS) && $(STAMP) ../all-stage3-gcc\n \n-# We only want to compare .o files, so set this!\n-objext = .o\n \n compare: all-stage3-gcc\n-\tr=`${PWD_COMMAND}`; export r; \\\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\t@r=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n \trm -f .bad_compare ; \\\n \tcd stage3-gcc; \\\n@@ -28556,40 +28658,32 @@ compare: all-stage3-gcc\n \telse \\\n \t  true; \\\n \tfi ; \\\n-        $(STAMP) compare\n+\t$(STAMP) compare\n+\n+\n \n .PHONY: new-bootstrap\n-# This target exists so that everything can be made in one pass.\n-# 'all-gcc' has to avoid stomping on the bootstrap-generated gcc for\n-# this to work.\n-new-bootstrap: compare\n-\tmv stage3-gcc gcc ; \\\n-\t$(MAKE) all ; \\\n-\tmv gcc stage3-gcc\n-\n-new-cleanstrap:\n-\trm -rf configure-stage1-gcc all-stage1-gcc stage1-gcc \\\n-\t  configure-stage2-gcc all-stage2-gcc stage2-gcc \\\n-\t  configure-stage3-gcc all-stage3-gcc stage3-gcc \\\n-\t  compare\n-\t$(MAKE) new-bootstrap\n-\n-new-restage1:\n-\trm -rf all-stage1-gcc \\\n-\t  configure-stage2-gcc all-stage2-gcc stage2-gcc \\\n-\t  configure-stage3-gcc all-stage3-gcc stage3-gcc \\\n-\t  compare\n-\t$(MAKE) all-stage1-gcc\n-\n-new-restage2: all-stage1-gcc\n-\trm -rf all-stage2-gcc \\\n-\t  configure-stage3-gcc all-stage3-gcc stage3-gcc \\\n-\t  compare\n-\t$(MAKE) all-stage2-gcc\n-\n-new-restage3: all-stage2-gcc\n-\trm -rf all-stage3-gcc compare\n-\t$(MAKE) compare\n+new-bootstrap:\n+\t$(MAKE) new-stage3-bubble  compare  \\\n+\t  new-stage3-start all new-stage3-end \n+\n+\n+.PHONY: new-restage3 distclean-stage3\n+\n+distclean-stage3: \n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\trm -rf configure-stage3-gcc all-stage3-gcc stage3-gcc compare \n+\n+new-restage3: \n+\trm -rf all-stage3-gcc compare \n+\t$(MAKE) compare \n+\n+\n+.PHONY: new-cleanstrap\n+new-cleanstrap: distclean-stage1 new-bootstrap\n+\n+\n+\n \n # --------------------------------------\n # Dependencies between different modules"}, {"sha": "33764aa40ec948d96a8ece0d709efe4e09d66e4c", "filename": "Makefile.tpl", "status": "modified", "additions": 120, "deletions": 219, "changes": 339, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/148907eaa6e6cf62e8e253d6124dbd24f653dccc/Makefile.tpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/148907eaa6e6cf62e8e253d6124dbd24f653dccc/Makefile.tpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/Makefile.tpl?ref=148907eaa6e6cf62e8e253d6124dbd24f653dccc", "patch": "@@ -1341,16 +1341,26 @@ maybe-[+make_target+]-gcc: [+make_target+]-gcc\n # GCC bootstrap support\n # ---------------------\n \n-# We name the directories for the various stages \"stage1-gcc\",\n-# \"stage2-gcc\",\"stage3-gcc\", etc.  \n-# Unfortunately, the 'compare' process will fail (on debugging information)\n-# if any directory names are different!\n-# So in the building rule for each stage, we relocate them before and after.\n-# The current one is 'gcc', while the previous one is 'prev-gcc'.  (The\n-# current one must be 'gcc' for now because the scripts in that directory\n-# assume it.)\n-# At the end of the bootstrap, 'stage3-gcc' must be moved to 'gcc' so that\n-# libraries can find it.  Ick!\n+# We track the current stage (the one in 'gcc') in the stage_last file.\n+# We name the build directories for the various stages \"stage1-gcc\",\n+# \"stage2-gcc\",\"stage3-gcc\", etc.\n+\n+# Since the 'compare' process will fail (on debugging information) if any\n+# directory names are different, we need to link the gcc directory for\n+# the previous stage to a constant name ('gcc-prev'), and to make the name of\n+# the build directories constant as well. For the latter, we use naked names\n+# like 'gcc', because the scripts in that directory assume it.  We use\n+# mv on platforms where symlinks to directories do not work or are not\n+# reliable.\n+\n+# At the end of the bootstrap, a symlink to 'stage3-gcc' named 'gcc' must\n+# be kept, so that libraries can find it.  Ick!\n+\n+# It would be best to preinstall gcc into a staging area (and in the\n+# future, gather there all prebootstrap packages).  This would allow\n+# assemblers and linkers can be bootstrapped as well as the compiler\n+# (both in a combined tree, or separately).  This however requires some\n+# change to the gcc driver, again in order to avoid comparison failures.\n \n # Bugs: This is almost certainly not parallel-make safe.\n \n@@ -1366,171 +1376,70 @@ STAMP = echo timestamp >\n STAGE1_CFLAGS=@stage1_cflags@\n STAGE1_LANGUAGES=@stage1_languages@\n \n-# For stage 1:\n-# * We force-disable intermodule optimizations, even if\n-#   --enable-intermodule was passed, since the installed compiler probably\n-#   can't handle them.  Luckily, autoconf always respects\n-#   the last argument when conflicting --enable arguments are passed.\n-# * Likewise, we force-disable coverage flags, since the installed compiler\n-#   probably has never heard of them.\n-# * We build only C (and possibly Ada).\n-configure-stage1-gcc:\n-\techo configure-stage1-gcc > stage_last ; \\\n-\tif [ -f stage1-gcc/Makefile ] ; then \\\n-\t  $(STAMP) configure-stage1-gcc ; \\\n-\t  exit 0; \\\n-\telse \\\n-\t  true ; \\\n-\tfi ; \\\n-\t[ -d stage1-gcc ] || mkdir stage1-gcc; \\\n-\tmv stage1-gcc gcc ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n-\ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n-\tTOPLEVEL_CONFIGURE_ARGUMENTS=\"$(TOPLEVEL_CONFIGURE_ARGUMENTS)\"; export TOPLEVEL_CONFIGURE_ARGUMENTS; \\\n-\tCC=\"$(CC)\"; export CC; \\\n-\tCFLAGS=\"$(CFLAGS)\"; export CFLAGS; \\\n-\tCXX=\"$(CXX)\"; export CXX; \\\n-\tCXXFLAGS=\"$(CXXFLAGS)\"; export CXXFLAGS; \\\n-\tAR=\"$(AR)\"; export AR; \\\n-\tAS=\"$(AS)\"; export AS; \\\n-\tCC_FOR_BUILD=\"$(CC_FOR_BUILD)\"; export CC_FOR_BUILD; \\\n-\tDLLTOOL=\"$(DLLTOOL)\"; export DLLTOOL; \\\n-\tLD=\"$(LD)\"; export LD; \\\n-\tLDFLAGS=\"$(LDFLAGS)\"; export LDFLAGS; \\\n-\tNM=\"$(NM)\"; export NM; \\\n-\tRANLIB=\"$(RANLIB)\"; export RANLIB; \\\n-\tWINDRES=\"$(WINDRES)\"; export WINDRES; \\\n-\tOBJCOPY=\"$(OBJCOPY)\"; export OBJCOPY; \\\n-\tOBJDUMP=\"$(OBJDUMP)\"; export OBJDUMP; \\\n-\techo Configuring stage 1 in gcc; \\\n-\tcd gcc || exit 1; \\\n-\tcase $(srcdir) in \\\n-\t  \\.) \\\n-\t    srcdiroption=\"--srcdir=.\"; \\\n-\t    libsrcdir=\".\";; \\\n-\t  /* | [A-Za-z]:[\\\\/]*) \\\n-\t    srcdiroption=\"--srcdir=$(srcdir)/gcc\"; \\\n-\t    libsrcdir=\"$$s/gcc\";; \\\n-\t  *) \\\n-\t    srcdiroption=\"--srcdir=../$(srcdir)/gcc\"; \\\n-\t    libsrcdir=\"$$s/gcc\";; \\\n-\tesac; \\\n-\t$(SHELL) $${libsrcdir}/configure \\\n-\t  $(HOST_CONFIGARGS) $${srcdiroption} \\\n-\t  --disable-intermodule --disable-coverage \\\n-\t  --enable-languages=\"$(STAGE1_LANGUAGES)\"; \\\n-\tcd .. ; \\\n-\tmv gcc stage1-gcc ; \\\n-\t$(STAMP) configure-stage1-gcc\n+# We only want to compare .o files, so set this!\n+objext = .o\n \n # Real targets act phony if they depend on phony targets; this hack\n # prevents gratuitous rebuilding of stage 1.\n prebootstrap:\n \t$(MAKE) all-bootstrap\n \t$(STAMP) prebootstrap\n \n-all-stage1-gcc: configure-stage1-gcc prebootstrap\n-\techo all-stage1-gcc > stage_last ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n-\ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tmv stage1-gcc gcc ; \\\n-\tcd gcc && \\\n-\t$(MAKE) $(GCC_FLAGS_TO_PASS) \\\n-\t\tCFLAGS=\"$(STAGE1_CFLAGS)\" && $(STAMP) ../all-stage1-gcc ; \\\n-\tresult=$$? ; \\\n-\tcd .. ; \\\n-\tmv gcc stage1-gcc ; \\\n-\texit $$result\n-\n-# TODO: Deal with STAGE_PREFIX (which is only for ada, incidentally)\n-# Possibly pass --enable-werror-always (depending on --enable-werror);\n-# that's what @stage2_werror_flag@ is for\n-configure-stage2-gcc: all-stage1-gcc\n-\techo configure-stage2-gcc > stage_last ; \\\n-\tif [ -f stage2-gcc/Makefile ] ; then \\\n-\t  $(STAMP) configure-stage2-gcc ; \\\n-\t  exit 0; \\\n-\telse \\\n-\t  true ; \\\n-\tfi ; \\\n-\t[ -d stage2-gcc ] || mkdir stage2-gcc; \\\n-\tmv stage2-gcc gcc ; \\\n-\tmv stage1-gcc prev-gcc ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n-\ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n-\tTOPLEVEL_CONFIGURE_ARGUMENTS=\"$(TOPLEVEL_CONFIGURE_ARGUMENTS)\"; export TOPLEVEL_CONFIGURE_ARGUMENTS; \\\n-\tCFLAGS=\"$(CFLAGS)\"; export CFLAGS; \\\n-\tCXX=\"$(CXX)\"; export CXX; \\\n-\tCXXFLAGS=\"$(CXXFLAGS)\"; export CXXFLAGS; \\\n-\tAR=\"$(AR)\"; export AR; \\\n-\tAS=\"$(AS)\"; export AS; \\\n-\tDLLTOOL=\"$(DLLTOOL)\"; export DLLTOOL; \\\n-\tLD=\"$(LD)\"; export LD; \\\n-\tLDFLAGS=\"$(LDFLAGS)\"; export LDFLAGS; \\\n-\tNM=\"$(NM)\"; export NM; \\\n-\tRANLIB=\"$(RANLIB)\"; export RANLIB; \\\n-\tWINDRES=\"$(WINDRES)\"; export WINDRES; \\\n-\tOBJCOPY=\"$(OBJCOPY)\"; export OBJCOPY; \\\n-\tOBJDUMP=\"$(OBJDUMP)\"; export OBJDUMP; \\\n-\tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC; \\\n-\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD; \\\n-\techo Configuring stage 2 in gcc; \\\n-\tcd gcc || exit 1; \\\n-\tcase $(srcdir) in \\\n-\t  \\.) \\\n-\t    srcdiroption=\"--srcdir=.\"; \\\n-\t    libsrcdir=\".\";; \\\n-\t  /* | [A-Za-z]:[\\\\/]*) \\\n-\t    srcdiroption=\"--srcdir=$(srcdir)/gcc\"; \\\n-\t    libsrcdir=\"$$s/gcc\";; \\\n-\t  *) \\\n-\t    srcdiroption=\"--srcdir=../$(srcdir)/gcc\"; \\\n-\t    libsrcdir=\"$$s/gcc\";; \\\n-\tesac; \\\n-\t$(SHELL) $${libsrcdir}/configure \\\n-\t  $(HOST_CONFIGARGS) $${srcdiroption} @stage2_werror_flag@ ; \\\n-\tcd .. ; \\\n-\tmv gcc stage2-gcc ; \\\n-\tmv prev-gcc stage1-gcc ; \\\n-\t$(STAMP) configure-stage2-gcc\n-\n # Flags to pass to stage2 and later makes.\n BOOT_CFLAGS= -g -O2\n POSTSTAGE1_FLAGS_TO_PASS = \\\n \tCFLAGS=\"$(BOOT_CFLAGS)\" \\\n \tADAC=\"\\$$(CC)\"\n \n-all-stage2-gcc: all-stage1-gcc configure-stage2-gcc\n-\techo all-stage2-gcc > stage_last ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n-\ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tmv stage2-gcc gcc ; \\\n-\tmv stage1-gcc prev-gcc ; \\\n-\tcd gcc && \\\n-\t$(MAKE) $(GCC_FLAGS_TO_PASS) \\\n-\t\tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n-\t\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n-\t\tSTAGE_PREFIX=$$r/prev-gcc/ \\\n-\t\t$(POSTSTAGE1_FLAGS_TO_PASS) && $(STAMP) ../all-stage2-gcc ; \\\n-\tresult=$$? ; \\\n-\tcd .. ; \\\n-\tmv prev-gcc stage1-gcc ; \\\n-\tmv gcc stage2-gcc ; \\\n-\texit $$result\n-\n-configure-stage3-gcc: all-stage2-gcc\n-\techo configure-stage3-gcc > stage_last ; \\\n-\tif [ -f stage3-gcc/Makefile ] ; then \\\n-\t  $(STAMP) configure-stage3-gcc ; \\\n+# For stage 1:\n+# * We force-disable intermodule optimizations, even if\n+#   --enable-intermodule was passed, since the installed compiler probably\n+#   can't handle them.  Luckily, autoconf always respects\n+#   the last argument when conflicting --enable arguments are passed.\n+# * Likewise, we force-disable coverage flags, since the installed compiler\n+#   probably has never heard of them.\n+# * We build only C (and possibly Ada).\n+\n+[+ FOR bootstrap-stage +]\n+.PHONY: new-stage[+id+]-start new-stage[+id+]-end\n+\n+new-stage[+id+]-start:\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\techo stage[+id+] > stage_last ; \\\n+\t[ -d stage[+id+]-gcc ] || mkdir stage[+id+]-gcc; \\\n+\tset stage[+id+]-gcc gcc ; @CREATE_LINK_TO_DIR@ [+ IF prev +] ; \\\n+\tset stage[+prev+]-gcc prev-gcc ; @CREATE_LINK_TO_DIR@ [+ ENDIF prev +]\n+\n+new-stage[+id+]-end:\n+\trm -f stage_last ; \\\n+\tset gcc stage[+id+]-gcc ; @UNDO_LINK_TO_DIR@ [+ IF prev +] ; \\\n+\tset prev-gcc stage[+prev+]-gcc ; @UNDO_LINK_TO_DIR@ [+ ENDIF prev +]\n+\n+# Bubble a bugfix through all the stages up to stage [+id+].  They\n+# are remade, but not reconfigured.  The next stage (if any) will not\n+# be reconfigured as well.\n+.PHONY: new-stage[+id+]-bubble\n+new-stage[+id+]-bubble: [+ IF prev +]new-stage[+prev+]-bubble[+ ENDIF +]\n+\t@if [ -f all-stage[+id+]-gcc ] ; then \\\n+\t  echo Remaking stage [+id+] ; \\\n+\t  rm -f all-stage[+id+]-gcc ; \\\n+\t  $(MAKE) all-stage[+id+]-gcc [+ IF next +] && \\\n+\t  if [ -f configure-stage[+next+]-gcc ] ; then \\\n+\t    $(STAMP) configure-stage[+next+]-gcc ; \\\n+\t  fi [+ ENDIF next +]; \\\n+\telse \\\n+\t  $(MAKE) all-stage[+id+]-gcc ; \\\n+\tfi\n+\n+configure-stage[+id+]-gcc: [+ IF prev +] all-stage[+prev+]-gcc [+\n+\t  ELSE +] prebootstrap [+ ENDIF prev +]\n+\t$(MAKE) new-stage[+id+]-start\n+\t@if [ -f stage[+id+]-gcc/Makefile ] ; then \\\n+\t  $(STAMP) configure-stage[+id+]-gcc ; \\\n \t  exit 0; \\\n \telse \\\n \t  true ; \\\n \tfi ; \\\n-\t[ -d stage3-gcc ] || mkdir stage3-gcc; \\\n-\tmv stage3-gcc gcc ; \\\n-\tmv stage2-gcc prev-gcc ; \\\n \tr=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n \tCONFIG_SHELL=\"$(SHELL)\"; export CONFIG_SHELL; \\\n@@ -1548,9 +1457,13 @@ configure-stage3-gcc: all-stage2-gcc\n \tWINDRES=\"$(WINDRES)\"; export WINDRES; \\\n \tOBJCOPY=\"$(OBJCOPY)\"; export OBJCOPY; \\\n \tOBJDUMP=\"$(OBJDUMP)\"; export OBJDUMP; \\\n+\tGMPLIBS=\"$(HOST_GMPLIBS)\"; export GMPLIBS; \\\n+\tGMPINC=\"$(HOST_GMPINC)\"; export GMPINC [+ IF prev +] ; \\\n \tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC; \\\n-\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD; \\\n-\techo Configuring stage 3 in gcc; \\\n+\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\"; export CC_FOR_BUILD [+ ELSE +] ; \\\n+\tCC=\"$(CC)\"; export CC; \\\n+\tCC_FOR_BUILD=\"$(CC_FOR_BUILD)\"; export CC_FOR_BUILD [+ ENDIF prev +] ; \\\n+\techo Configuring stage [+id+] in gcc ; \\\n \tcd gcc || exit 1; \\\n \tcase $(srcdir) in \\\n \t  \\.) \\\n@@ -1564,42 +1477,32 @@ configure-stage3-gcc: all-stage2-gcc\n \t    libsrcdir=\"$$s/gcc\";; \\\n \tesac; \\\n \t$(SHELL) $${libsrcdir}/configure \\\n-\t  $(HOST_CONFIGARGS) $${srcdiroption} @stage2_werror_flag@ ; \\\n-\tcd .. ; \\\n-\tmv gcc stage3-gcc ; \\\n-\tmv prev-gcc stage2-gcc ; \\\n-\t$(STAMP) configure-stage3-gcc\n+\t  $(HOST_CONFIGARGS) $${srcdiroption} \\\n+\t  [+extra_configure_flags+] && \\\n+\t  $(STAMP) ../configure-stage[+id+]-gcc\n \n-all-stage3-gcc: all-stage2-gcc configure-stage3-gcc\n-\techo all-stage3-gcc > stage_last ; \\\n-\tr=`${PWD_COMMAND}`; export r; \\\n+all-stage[+id+]-gcc: configure-stage[+id+]-gcc\n+\t$(MAKE) new-stage[+id+]-start\n+\t@r=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n-\tmv stage2-gcc prev-gcc ; \\\n-\tmv stage3-gcc gcc ; \\\n \tcd gcc && \\\n-\t$(MAKE) $(GCC_FLAGS_TO_PASS) \\\n+\t$(MAKE) $(GCC_FLAGS_TO_PASS) [+ IF prev +] \\\n \t\tCC=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n \t\tCC_FOR_BUILD=\"$(STAGE_CC_WRAPPER) $$r/prev-gcc/xgcc$(exeext) -B$$r/prev-gcc/ -B$(build_tooldir)/bin/\" \\\n-\t\tSTAGE_PREFIX=$$r/prev-gcc/ \\\n-\t\t$(POSTSTAGE1_FLAGS_TO_PASS) && $(STAMP) ../all-stage3-gcc \\\n-\tresult=$$? ; \\\n-\tcd .. ; \\\n-\tmv prev-gcc stage2-gcc ; \\\n-\tmv gcc stage3-gcc ; \\\n-\texit $$result\n+\t\tSTAGE_PREFIX=$$r/stage[+prev+]-gcc/ [+ ENDIF prev +] \\\n+\t\t[+extra_make_flags+] && $(STAMP) ../all-stage[+id+]-gcc\n \n-# We only want to compare .o files, so set this!\n-objext = .o\n-\n-compare: all-stage3-gcc\n-\tr=`${PWD_COMMAND}`; export r; \\\n+[+ IF compare-target +]\n+[+compare-target+]: all-stage[+id+]-gcc\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\t@r=`${PWD_COMMAND}`; export r; \\\n \ts=`cd $(srcdir); ${PWD_COMMAND}`; export s; \\\n \trm -f .bad_compare ; \\\n-\tcd stage3-gcc; \\\n+\tcd stage[+id+]-gcc; \\\n \tfiles=`find . -name \"*$(objext)\" -print` ; \\\n \tcd .. ; \\\n \tfor file in $${files} ; do \\\n-\t  f1=$$r/stage2-gcc/$$file; f2=$$r/stage3-gcc/$$file; \\\n+\t  f1=$$r/stage[+prev+]-gcc/$$file; f2=$$r/stage[+id+]-gcc/$$file; \\\n \t  @do_compare@ > /dev/null 2>&1; \\\n \t  test $$? -eq 1 && echo $$file differs >> .bad_compare || true; \\\n \tdone ; \\\n@@ -1610,40 +1513,38 @@ compare: all-stage3-gcc\n \telse \\\n \t  true; \\\n \tfi ; \\\n-        $(STAMP) compare\n-\n-.PHONY: new-bootstrap\n-# This target exists so that everything can be made in one pass.\n-# 'all-gcc' has to avoid stomping on the bootstrap-generated gcc for\n-# this to work.\n-new-bootstrap: compare\n-\tmv stage3-gcc gcc ; \\\n-\t$(MAKE) all ; \\\n-\tmv gcc stage3-gcc\n-\n-new-cleanstrap:\n-\trm -rf configure-stage1-gcc all-stage1-gcc stage1-gcc \\\n-\t  configure-stage2-gcc all-stage2-gcc stage2-gcc \\\n-\t  configure-stage3-gcc all-stage3-gcc stage3-gcc \\\n-\t  compare\n-\t$(MAKE) new-bootstrap\n-\n-new-restage1:\n-\trm -rf all-stage1-gcc \\\n-\t  configure-stage2-gcc all-stage2-gcc stage2-gcc \\\n-\t  configure-stage3-gcc all-stage3-gcc stage3-gcc \\\n-\t  compare\n-\t$(MAKE) all-stage1-gcc\n-\n-new-restage2: all-stage1-gcc\n-\trm -rf all-stage2-gcc \\\n-\t  configure-stage3-gcc all-stage3-gcc stage3-gcc \\\n-\t  compare\n-\t$(MAKE) all-stage2-gcc\n-\n-new-restage3: all-stage2-gcc\n-\trm -rf all-stage3-gcc compare\n-\t$(MAKE) compare\n+\t$(STAMP) [+compare-target+]\n+[+ ENDIF compare-target +]\n+\n+[+ IF bootstrap-target +]\n+.PHONY: [+bootstrap-target+]\n+[+bootstrap-target+]:\n+\t$(MAKE) new-stage[+id+]-bubble [+\n+\t  IF compare-target +] [+compare-target+] [+\n+\t  ENDIF compare-target +] \\\n+\t  new-stage[+id+]-start all new-stage[+id+]-end \n+[+ ENDIF bootstrap-target +]\n+\n+.PHONY: new-restage[+id+] distclean-stage[+id+]\n+\n+distclean-stage[+id+]: [+ IF next +] distclean-stage[+next+] [+ ENDIF next +]\n+\t[ -f stage_last ] && $(MAKE) new-`cat stage_last`-end || :\n+\trm -rf configure-stage[+id+]-gcc all-stage[+id+]-gcc stage[+id+]-gcc [+\n+\t  IF compare-target +][+compare-target+] [+ ENDIF compare-target +]\n+\n+new-restage[+id+]: [+ IF next +] distclean-stage[+next+] [+ ENDIF next +]\n+\trm -rf all-stage[+id+]-gcc [+\n+\t  IF compare-target +][+compare-target+] [+ ENDIF compare-target +]\n+\t$(MAKE) [+\n+\t  IF compare-target +][+compare-target+] [+\n+\t  ELSE +] all-stage[+id+]-gcc [+ ENDIF compare-target +]\n+\n+[+ IF cleanstrap-target +]\n+.PHONY: [+cleanstrap-target+]\n+[+cleanstrap-target+]: distclean-stage1 [+bootstrap-target+]\n+[+ ENDIF cleanstrap-target +]\n+\n+[+ ENDFOR bootstrap-stage +]\n \n # --------------------------------------\n # Dependencies between different modules"}, {"sha": "580c9165d900a6072949ce41c6aade5f29efd3e4", "filename": "configure", "status": "modified", "additions": 116, "deletions": 56, "changes": 172, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/148907eaa6e6cf62e8e253d6124dbd24f653dccc/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/148907eaa6e6cf62e8e253d6124dbd24f653dccc/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=148907eaa6e6cf62e8e253d6124dbd24f653dccc", "patch": "@@ -733,6 +733,27 @@ test -z \"$INSTALL_SCRIPT\" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'\n \n test -z \"$INSTALL_DATA\" && INSTALL_DATA='${INSTALL} -m 644'\n \n+echo $ac_n \"checking whether ln -s works\"\"... $ac_c\" 1>&6\n+echo \"configure:738: checking whether ln -s works\" >&5\n+if eval \"test \\\"`echo '$''{'ac_cv_prog_LN_S'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  rm -f conftestdata\n+if ln -s X conftestdata 2>/dev/null\n+then\n+  rm -f conftestdata\n+  ac_cv_prog_LN_S=\"ln -s\"\n+else\n+  ac_cv_prog_LN_S=ln\n+fi\n+fi\n+LN_S=\"$ac_cv_prog_LN_S\"\n+if test \"$ac_cv_prog_LN_S\" = \"ln -s\"; then\n+  echo \"$ac_t\"\"yes\" 1>&6\n+else\n+  echo \"$ac_t\"\"no\" 1>&6\n+fi\n+\n \n # Autoconf M4 include file defining utility macros for complex Canadian\n # cross builds.\n@@ -1899,7 +1920,7 @@ fi\n # Extract the first word of \"gcc\", so it can be a program name with args.\n set dummy gcc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1903: checking for $ac_word\" >&5\n+echo \"configure:1924: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1929,7 +1950,7 @@ if test -z \"$CC\"; then\n   # Extract the first word of \"cc\", so it can be a program name with args.\n set dummy cc; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1933: checking for $ac_word\" >&5\n+echo \"configure:1954: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -1980,7 +2001,7 @@ fi\n       # Extract the first word of \"cl\", so it can be a program name with args.\n set dummy cl; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:1984: checking for $ac_word\" >&5\n+echo \"configure:2005: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2012,7 +2033,7 @@ fi\n fi\n \n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\"\"... $ac_c\" 1>&6\n-echo \"configure:2016: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n+echo \"configure:2037: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works\" >&5\n \n ac_ext=c\n # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.\n@@ -2023,12 +2044,12 @@ cross_compiling=$ac_cv_prog_cc_cross\n \n cat > conftest.$ac_ext << EOF\n \n-#line 2027 \"configure\"\n+#line 2048 \"configure\"\n #include \"confdefs.h\"\n \n main(){return(0);}\n EOF\n-if { (eval echo configure:2032: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2053: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   ac_cv_prog_cc_works=yes\n   # If we can't run a trivial program, we are probably using a cross compiler.\n   if (./conftest; exit) 2>/dev/null; then\n@@ -2054,12 +2075,12 @@ if test $ac_cv_prog_cc_works = no; then\n   { echo \"configure: error: installation or configuration problem: C compiler cannot create executables.\" 1>&2; exit 1; }\n fi\n echo $ac_n \"checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\"\"... $ac_c\" 1>&6\n-echo \"configure:2058: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n+echo \"configure:2079: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler\" >&5\n echo \"$ac_t\"\"$ac_cv_prog_cc_cross\" 1>&6\n cross_compiling=$ac_cv_prog_cc_cross\n \n echo $ac_n \"checking whether we are using GNU C\"\"... $ac_c\" 1>&6\n-echo \"configure:2063: checking whether we are using GNU C\" >&5\n+echo \"configure:2084: checking whether we are using GNU C\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_gcc'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2068,7 +2089,7 @@ else\n   yes;\n #endif\n EOF\n-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:2072: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:2093: \\\"$ac_try\\\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then\n   ac_cv_prog_gcc=yes\n else\n   ac_cv_prog_gcc=no\n@@ -2087,7 +2108,7 @@ ac_test_CFLAGS=\"${CFLAGS+set}\"\n ac_save_CFLAGS=\"$CFLAGS\"\n CFLAGS=\n echo $ac_n \"checking whether ${CC-cc} accepts -g\"\"... $ac_c\" 1>&6\n-echo \"configure:2091: checking whether ${CC-cc} accepts -g\" >&5\n+echo \"configure:2112: checking whether ${CC-cc} accepts -g\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_cc_g'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2123,7 +2144,7 @@ fi\n # Extract the first word of \"${ac_tool_prefix}gnatbind\", so it can be a program name with args.\n set dummy ${ac_tool_prefix}gnatbind; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2127: checking for $ac_word\" >&5\n+echo \"configure:2148: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_GNATBIND'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2155,7 +2176,7 @@ if test -n \"$ac_tool_prefix\"; then\n   # Extract the first word of \"gnatbind\", so it can be a program name with args.\n set dummy gnatbind; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2159: checking for $ac_word\" >&5\n+echo \"configure:2180: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_GNATBIND'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2188,7 +2209,7 @@ fi\n fi\n \n echo $ac_n \"checking whether compiler driver understands Ada\"\"... $ac_c\" 1>&6\n-echo \"configure:2192: checking whether compiler driver understands Ada\" >&5\n+echo \"configure:2213: checking whether compiler driver understands Ada\" >&5\n if eval \"test \\\"`echo '$''{'acx_cv_cc_gcc_supports_ada'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2221,7 +2242,7 @@ else\n fi\n \n echo $ac_n \"checking how to compare bootstrapped objects\"\"... $ac_c\" 1>&6\n-echo \"configure:2225: checking how to compare bootstrapped objects\" >&5\n+echo \"configure:2246: checking how to compare bootstrapped objects\" >&5\n if eval \"test \\\"`echo '$''{'gcc_cv_prog_cmp_skip'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2294,9 +2315,9 @@ saved_CFLAGS=\"$CFLAGS\"\n CFLAGS=\"$CFLAGS $gmpinc\"\n # Check GMP actually works\n echo $ac_n \"checking for correct version of gmp.h\"\"... $ac_c\" 1>&6\n-echo \"configure:2298: checking for correct version of gmp.h\" >&5\n+echo \"configure:2319: checking for correct version of gmp.h\" >&5\n cat > conftest.$ac_ext <<EOF\n-#line 2300 \"configure\"\n+#line 2321 \"configure\"\n #include \"confdefs.h\"\n #include \"gmp.h\"\n int main() {\n@@ -2307,7 +2328,7 @@ choke me\n \n ; return 0; }\n EOF\n-if { (eval echo configure:2311: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n+if { (eval echo configure:2332: \\\"$ac_compile\\\") 1>&5; (eval $ac_compile) 2>&5; }; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"yes\" 1>&6\n else\n@@ -2320,19 +2341,19 @@ rm -f conftest*\n \n if test x\"$have_gmp\" = xyes; then\n   echo $ac_n \"checking for mpf_init in -lgmp\"\"... $ac_c\" 1>&6\n-echo \"configure:2324: checking for mpf_init in -lgmp\" >&5\n+echo \"configure:2345: checking for mpf_init in -lgmp\" >&5\n \n   saved_LIBS=\"$LIBS\"\n   LIBS=\"$LIBS $gmplibs\"\n   cat > conftest.$ac_ext <<EOF\n-#line 2329 \"configure\"\n+#line 2350 \"configure\"\n #include \"confdefs.h\"\n #include <gmp.h>\n int main() {\n mpf_t n; mpf_init(n);\n ; return 0; }\n EOF\n-if { (eval echo configure:2336: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n+if { (eval echo configure:2357: \\\"$ac_link\\\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then\n   rm -rf conftest*\n   echo \"$ac_t\"\"yes\" 1>&6\n else\n@@ -2794,7 +2815,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2798: checking for $ac_word\" >&5\n+echo \"configure:2819: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_DEFAULT_YACC'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2829,7 +2850,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2833: checking for $ac_word\" >&5\n+echo \"configure:2854: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_DEFAULT_M4'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2864,7 +2885,7 @@ do\n # Extract the first word of \"$ac_prog\", so it can be a program name with args.\n set dummy $ac_prog; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2868: checking for $ac_word\" >&5\n+echo \"configure:2889: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_DEFAULT_LEX'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3439,7 +3460,7 @@ test -n \"$target_alias\" && ncn_target_tool_prefix=$target_alias-\n   # Extract the first word of \"${ncn_tool_prefix}ar\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3443: checking for $ac_word\" >&5\n+echo \"configure:3464: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AR'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3472,7 +3493,7 @@ if test -z \"$ac_cv_prog_AR\" ; then\n     # Extract the first word of \"ar\", so it can be a program name with args.\n set dummy ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3476: checking for $ac_word\" >&5\n+echo \"configure:3497: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_AR'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3511,7 +3532,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}as\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3515: checking for $ac_word\" >&5\n+echo \"configure:3536: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AS'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3544,7 +3565,7 @@ if test -z \"$ac_cv_prog_AS\" ; then\n     # Extract the first word of \"as\", so it can be a program name with args.\n set dummy as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3548: checking for $ac_word\" >&5\n+echo \"configure:3569: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_AS'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3583,7 +3604,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}dlltool\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3587: checking for $ac_word\" >&5\n+echo \"configure:3608: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_DLLTOOL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3616,7 +3637,7 @@ if test -z \"$ac_cv_prog_DLLTOOL\" ; then\n     # Extract the first word of \"dlltool\", so it can be a program name with args.\n set dummy dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3620: checking for $ac_word\" >&5\n+echo \"configure:3641: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_DLLTOOL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3655,7 +3676,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}ld\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3659: checking for $ac_word\" >&5\n+echo \"configure:3680: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3688,7 +3709,7 @@ if test -z \"$ac_cv_prog_LD\" ; then\n     # Extract the first word of \"ld\", so it can be a program name with args.\n set dummy ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3692: checking for $ac_word\" >&5\n+echo \"configure:3713: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_LD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3727,7 +3748,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}nm\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3731: checking for $ac_word\" >&5\n+echo \"configure:3752: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_NM'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3760,7 +3781,7 @@ if test -z \"$ac_cv_prog_NM\" ; then\n     # Extract the first word of \"nm\", so it can be a program name with args.\n set dummy nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3764: checking for $ac_word\" >&5\n+echo \"configure:3785: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_NM'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3799,7 +3820,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3803: checking for $ac_word\" >&5\n+echo \"configure:3824: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3832,7 +3853,7 @@ if test -z \"$ac_cv_prog_RANLIB\" ; then\n     # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3836: checking for $ac_word\" >&5\n+echo \"configure:3857: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3871,7 +3892,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}windres\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3875: checking for $ac_word\" >&5\n+echo \"configure:3896: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_WINDRES'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3904,7 +3925,7 @@ if test -z \"$ac_cv_prog_WINDRES\" ; then\n     # Extract the first word of \"windres\", so it can be a program name with args.\n set dummy windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3908: checking for $ac_word\" >&5\n+echo \"configure:3929: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_WINDRES'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3943,7 +3964,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}objcopy\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}objcopy; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3947: checking for $ac_word\" >&5\n+echo \"configure:3968: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_OBJCOPY'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3976,7 +3997,7 @@ if test -z \"$ac_cv_prog_OBJCOPY\" ; then\n     # Extract the first word of \"objcopy\", so it can be a program name with args.\n set dummy objcopy; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3980: checking for $ac_word\" >&5\n+echo \"configure:4001: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_OBJCOPY'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4015,7 +4036,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}objdump\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}objdump; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4019: checking for $ac_word\" >&5\n+echo \"configure:4040: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_OBJDUMP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4048,7 +4069,7 @@ if test -z \"$ac_cv_prog_OBJDUMP\" ; then\n     # Extract the first word of \"objdump\", so it can be a program name with args.\n set dummy objdump; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4052: checking for $ac_word\" >&5\n+echo \"configure:4073: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_OBJDUMP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4097,7 +4118,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}ar\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4101: checking for $ac_word\" >&5\n+echo \"configure:4122: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_AR_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4130,7 +4151,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_AR_FOR_TARGET\" ; then\n     # Extract the first word of \"ar\", so it can be a program name with args.\n set dummy ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4134: checking for $ac_word\" >&5\n+echo \"configure:4155: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_AR_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4169,7 +4190,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}as\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4173: checking for $ac_word\" >&5\n+echo \"configure:4194: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_AS_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4202,7 +4223,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_AS_FOR_TARGET\" ; then\n     # Extract the first word of \"as\", so it can be a program name with args.\n set dummy as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4206: checking for $ac_word\" >&5\n+echo \"configure:4227: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_AS_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4241,7 +4262,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}dlltool\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4245: checking for $ac_word\" >&5\n+echo \"configure:4266: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_DLLTOOL_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4274,7 +4295,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_DLLTOOL_FOR_TARGET\" ; then\n     # Extract the first word of \"dlltool\", so it can be a program name with args.\n set dummy dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4278: checking for $ac_word\" >&5\n+echo \"configure:4299: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_DLLTOOL_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4313,7 +4334,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}ld\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4317: checking for $ac_word\" >&5\n+echo \"configure:4338: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_LD_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4346,7 +4367,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_LD_FOR_TARGET\" ; then\n     # Extract the first word of \"ld\", so it can be a program name with args.\n set dummy ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4350: checking for $ac_word\" >&5\n+echo \"configure:4371: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_LD_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4385,7 +4406,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}nm\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4389: checking for $ac_word\" >&5\n+echo \"configure:4410: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_NM_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4418,7 +4439,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_NM_FOR_TARGET\" ; then\n     # Extract the first word of \"nm\", so it can be a program name with args.\n set dummy nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4422: checking for $ac_word\" >&5\n+echo \"configure:4443: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_NM_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4457,7 +4478,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4461: checking for $ac_word\" >&5\n+echo \"configure:4482: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_RANLIB_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4490,7 +4511,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_RANLIB_FOR_TARGET\" ; then\n     # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4494: checking for $ac_word\" >&5\n+echo \"configure:4515: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_RANLIB_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4529,7 +4550,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}windres\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4533: checking for $ac_word\" >&5\n+echo \"configure:4554: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_CONFIGURED_WINDRES_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4562,7 +4583,7 @@ if test -z \"$ac_cv_prog_CONFIGURED_WINDRES_FOR_TARGET\" ; then\n     # Extract the first word of \"windres\", so it can be a program name with args.\n set dummy windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:4566: checking for $ac_word\" >&5\n+echo \"configure:4587: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_CONFIGURED_WINDRES_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -4647,7 +4668,7 @@ RANLIB_FOR_TARGET=${RANLIB_FOR_TARGET}${extra_ranlibflags_for_target}\n NM_FOR_TARGET=${NM_FOR_TARGET}${extra_nmflags_for_target}\n \n echo $ac_n \"checking whether to enable maintainer-specific portions of Makefiles\"\"... $ac_c\" 1>&6\n-echo \"configure:4651: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n+echo \"configure:4672: checking whether to enable maintainer-specific portions of Makefiles\" >&5\n # Check whether --enable-maintainer-mode or --disable-maintainer-mode was given.\n if test \"${enable_maintainer_mode+set}\" = set; then\n   enableval=\"$enable_maintainer_mode\"\n@@ -4690,6 +4711,42 @@ case $build in\n esac\n \n \n+# It makes debugging easier if we create as symlinks the stage directories\n+# gcc for stageN-gcc and stage-prev for stage(N-1).  In case this is not\n+# possible, however, we can resort to mv.\n+echo $ac_n \"checking if symbolic links between directories work\"\"... $ac_c\" 1>&6\n+echo \"configure:4719: checking if symbolic links between directories work\" >&5\n+if eval \"test \\\"`echo '$''{'gcc_cv_prog_ln_s_dir'+set}'`\\\" = set\"; then\n+  echo $ac_n \"(cached) $ac_c\" 1>&6\n+else\n+  if test \"${LN_S}\" = \"ln -s\" \\\n+   && mkdir confdir.s1 \\\n+   && ln -s confdir.s1 confdir.s2 \\\n+   && echo timestamp1 > confdir.s1/conftest.1 \\\n+   && cmp confdir.s1/conftest.1 confdir.s2/conftest.1 \\\n+   && echo timestamp2 > confdir.s2/conftest.2 \\\n+   && cmp confdir.s1/conftest.2 confdir.s1/conftest.2 \\\n+   && rm -f confdir.s2; then\n+  gcc_cv_prog_ln_s_dir=yes\n+else\n+  gcc_cv_prog_ln_s_dir=yes\n+fi\n+rm -rf confdir.s1 confdir.s2\n+fi\n+\n+echo \"$ac_t\"\"$gcc_cv_prog_ln_s_dir\" 1>&6\n+\n+case ${gcc_cv_prog_ln_s_dir} in\n+  yes)\n+    CREATE_LINK_TO_DIR='ln -s $$1 $$2'\n+    UNDO_LINK_TO_DIR='rm -f $$1' ;;\n+  *)\n+    CREATE_LINK_TO_DIR='mv $$1 $$2'\n+    UNDO_LINK_TO_DIR='mv $$1 $$2' ;;\n+esac\n+\n+\n+\n # Enable -Werror in bootstrap stage2 and later.\n # Change the default to \"no\" on release branches.\n # Check whether --enable-werror or --disable-werror was given.\n@@ -4869,6 +4926,7 @@ s%@build_os@%$build_os%g\n s%@INSTALL_PROGRAM@%$INSTALL_PROGRAM%g\n s%@INSTALL_SCRIPT@%$INSTALL_SCRIPT%g\n s%@INSTALL_DATA@%$INSTALL_DATA%g\n+s%@LN_S@%$LN_S%g\n s%@TOPLEVEL_CONFIGURE_ARGUMENTS@%$TOPLEVEL_CONFIGURE_ARGUMENTS%g\n s%@build_subdir@%$build_subdir%g\n s%@host_subdir@%$host_subdir%g\n@@ -4970,6 +5028,8 @@ s%@MAINTAINER_MODE_TRUE@%$MAINTAINER_MODE_TRUE%g\n s%@MAINTAINER_MODE_FALSE@%$MAINTAINER_MODE_FALSE%g\n s%@MAINT@%$MAINT%g\n s%@stage1_cflags@%$stage1_cflags%g\n+s%@CREATE_LINK_TO_DIR@%$CREATE_LINK_TO_DIR%g\n+s%@UNDO_LINK_TO_DIR@%$UNDO_LINK_TO_DIR%g\n s%@stage2_werror_flag@%$stage2_werror_flag%g\n \n CEOF"}, {"sha": "42f7beacc7f986a1bb75c7e2c1e3803a13b73f2b", "filename": "configure.in", "status": "modified", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/148907eaa6e6cf62e8e253d6124dbd24f653dccc/configure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/148907eaa6e6cf62e8e253d6124dbd24f653dccc/configure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.in?ref=148907eaa6e6cf62e8e253d6124dbd24f653dccc", "patch": "@@ -25,6 +25,7 @@ AC_ARG_PROGRAM\n \n # Get 'install' or 'install-sh' and its variants.\n AC_PROG_INSTALL\n+AC_PROG_LN_S\n \n sinclude(config/acx.m4)\n \n@@ -2247,6 +2248,36 @@ case $build in\n esac\n AC_SUBST(stage1_cflags)\n \n+# It makes debugging easier if we create as symlinks the stage directories\n+# gcc for stageN-gcc and stage-prev for stage(N-1).  In case this is not\n+# possible, however, we can resort to mv.\n+AC_CACHE_CHECK([if symbolic links between directories work],\n+[gcc_cv_prog_ln_s_dir],\n+[if test \"${LN_S}\" = \"ln -s\" \\\n+   && mkdir confdir.s1 \\\n+   && ln -s confdir.s1 confdir.s2 \\\n+   && echo timestamp1 > confdir.s1/conftest.1 \\\n+   && cmp confdir.s1/conftest.1 confdir.s2/conftest.1 \\\n+   && echo timestamp2 > confdir.s2/conftest.2 \\\n+   && cmp confdir.s1/conftest.2 confdir.s1/conftest.2 \\\n+   && rm -f confdir.s2; then\n+  gcc_cv_prog_ln_s_dir=yes\n+else\n+  gcc_cv_prog_ln_s_dir=yes\n+fi\n+rm -rf confdir.s1 confdir.s2])\n+\n+case ${gcc_cv_prog_ln_s_dir} in\n+  yes)\n+    CREATE_LINK_TO_DIR='ln -s $$1 $$2'\n+    UNDO_LINK_TO_DIR='rm -f $$1' ;;\n+  *)\n+    CREATE_LINK_TO_DIR='mv $$1 $$2'\n+    UNDO_LINK_TO_DIR='mv $$1 $$2' ;;\n+esac\n+AC_SUBST(CREATE_LINK_TO_DIR)\n+AC_SUBST(UNDO_LINK_TO_DIR)\n+\n # Enable -Werror in bootstrap stage2 and later.\n # Change the default to \"no\" on release branches.\n AC_ARG_ENABLE(werror,"}]}