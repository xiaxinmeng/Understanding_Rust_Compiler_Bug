{"sha": "4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDY1M2RhMGI2ZWMyYTVjMjcyZDljZDk4YTk3MGYwMDM3ZjFhNTc4OQ==", "commit": {"author": {"name": "Claudiu Zissulescu", "email": "claziss@synopsys.com", "date": "2019-11-06T13:31:43Z"}, "committer": {"name": "Claudiu Zissulescu", "email": "claziss@gcc.gnu.org", "date": "2019-11-06T13:31:43Z"}, "message": "[ARC] Don't split ior/mov predicated insns.\n\nDo not split long immediate constants for predicated instructions.\n\ngcc/\nxxxx-xx-xx  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* config/arc/arc.c (arc_split_ior): Add asserts.\n\t(arc_split_mov_const): Likewise.\n\t(arc_check_ior_const): Do not match known short immediate values.\n\t* config/arc/arc.md (movsi): Don't split predicated instructions.\n\t(iorsi): Likewise.\n\ntestsuite/\nxxxx-xx-xx  Claudiu Zissulescu  <claziss@synopsys.com>\n\tSahahb Vahedi  <shahab@synopsys.com>\n\tCupertino Miranda  <cmiranda@synopsys.com>\n\n\t* gcc.target/arc/or-cnst-size2.c: New test.\n\nCo-Authored-By: Sahahb Vahedi <shahab@synopsys.com>\n\nFrom-SVN: r277885", "tree": {"sha": "b38dd3628b3a420fe9087caeab3ab18f9ff536d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b38dd3628b3a420fe9087caeab3ab18f9ff536d8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/comments", "author": {"login": "claziss", "id": 2761368, "node_id": "MDQ6VXNlcjI3NjEzNjg=", "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4", "gravatar_id": "", "url": "https://api.github.com/users/claziss", "html_url": "https://github.com/claziss", "followers_url": "https://api.github.com/users/claziss/followers", "following_url": "https://api.github.com/users/claziss/following{/other_user}", "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}", "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/claziss/subscriptions", "organizations_url": "https://api.github.com/users/claziss/orgs", "repos_url": "https://api.github.com/users/claziss/repos", "events_url": "https://api.github.com/users/claziss/events{/privacy}", "received_events_url": "https://api.github.com/users/claziss/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4d9329654ceaa84ebf7c3ac8e579169d5e4f37f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d9329654ceaa84ebf7c3ac8e579169d5e4f37f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d9329654ceaa84ebf7c3ac8e579169d5e4f37f4"}], "stats": {"total": 55, "additions": 47, "deletions": 8}, "files": [{"sha": "1ff3d4b90880ab2f1471043866e78be249e73480", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "patch": "@@ -1,3 +1,11 @@\n+2019-11-06  Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* config/arc/arc.c (arc_split_ior): Add asserts.\n+\t(arc_split_mov_const): Likewise.\n+\t(arc_check_ior_const): Do not match known short immediate values.\n+\t* config/arc/arc.md (movsi): Don't split predicated instructions\n+\t(iorsi): Likewise.\n+\n 2019-11-06  Claudiu Zissulescu  <claziss@synopsys.com>\n \n \t* config/arc/arc.opt (mea): Update help string."}, {"sha": "e8f4133b3383bb247cdd75d0c52c24c0fbbed4c6", "filename": "gcc/config/arc/arc.c", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Fconfig%2Farc%2Farc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Fconfig%2Farc%2Farc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.c?ref=4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "patch": "@@ -11495,8 +11495,10 @@ arc_split_ior (rtx *operands)\n       emit_insn (gen_rtx_SET (operands[0],\n \t\t\t      gen_rtx_IOR (SImode, op1, GEN_INT (maskx))));\n       break;\n-    default:\n+    case 0:\n       break;\n+    default:\n+      gcc_unreachable ();\n     }\n }\n \n@@ -11506,6 +11508,10 @@ bool\n arc_check_ior_const (HOST_WIDE_INT ival)\n {\n   unsigned int mask = (unsigned int) (ival & 0xffffffff);\n+\n+  if (UNSIGNED_INT6 (ival)\n+      || IS_POWEROF2_P (mask))\n+    return false;\n   if (__builtin_popcount (mask) <= 3)\n     return true;\n   if (__builtin_popcount (mask & ~0x3f) <= 1)\n@@ -11527,9 +11533,6 @@ arc_split_mov_const (rtx *operands)\n   gcc_assert (CONST_INT_P (operands[1]));\n   ival = INTVAL (operands[1]) & 0xffffffff;\n \n-  if (SIGNED_INT12 (ival))\n-    return false;\n-\n   /* 1. Check if we can just rotate limm by 8 but using ROR8.  */\n   if (TARGET_BARREL_SHIFTER && TARGET_V2\n       && ((ival & ~0x3f000000) == 0))\n@@ -11596,7 +11599,7 @@ arc_split_mov_const (rtx *operands)\n       return true;\n     }\n \n-  return false;\n+  gcc_unreachable ();\n }\n \n /* Helper to check Cax constraint.  */\n@@ -11606,6 +11609,9 @@ arc_check_mov_const (HOST_WIDE_INT ival)\n {\n   ival = ival & 0xffffffff;\n \n+  if (SIGNED_INT12 (ival))\n+    return false;\n+\n   if ((ival & ~0x8000001f) == 0)\n     return true;\n "}, {"sha": "e3043b575143d5c581febcd31e08337ec95d3fd9", "filename": "gcc/config/arc/arc.md", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Fconfig%2Farc%2Farc.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Fconfig%2Farc%2Farc.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farc%2Farc.md?ref=4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "patch": "@@ -816,8 +816,11 @@ core_3, archs4x, archs4xd, archs4xd_slow\"\n    st%U0%V0\\\\t%1,%0\t;26\n    st%U0%V0\\\\t%1,%0\t;37\n    st%U0%V0\\\\t%1,%0\t;28\"\n-  \"reload_completed && satisfies_constraint_Cax (operands[1])\n-   && register_operand (operands[0], SImode)\"\n+  \"reload_completed\n+   && GET_CODE (PATTERN (insn)) != COND_EXEC\n+   && register_operand (operands[0], SImode)\n+   && IN_RANGE (REGNO (operands[0]) ^ 4, 4, 11)\n+   && satisfies_constraint_Cax (operands[1])\"\n   [(const_int 0)]\n   \"\n    arc_split_mov_const (operands);\n@@ -3370,7 +3373,11 @@ core_3, archs4x, archs4xd, archs4xd_slow\"\n    #\n    or%?\\\\t%0,%1,%2\n    or%?\\\\t%0,%1,%2\"\n-  \"reload_completed && satisfies_constraint_C0x (operands[2])\"\n+  \"reload_completed\n+   && GET_CODE (PATTERN (insn)) != COND_EXEC\n+   && register_operand (operands[0], SImode)\n+   && IN_RANGE (REGNO (operands[0]) ^ 4, 4, 11)\n+   && satisfies_constraint_C0x (operands[2])\"\n   [(const_int 0)]\n   \"\n    arc_split_ior (operands);"}, {"sha": "ca76559817fd8f8ed3f612fc09955742b2ae2b51", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "patch": "@@ -1,3 +1,9 @@\n+2019-11-06  Claudiu Zissulescu  <claziss@synopsys.com>\n+\tSahahb Vahedi  <shahab@synopsys.com>\n+\tCupertino Miranda  <cmiranda@synopsys.com\n+\n+\t* gcc.target/arc/or-cnst-size2.c: New test.\n+\n 2019-11-06  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* gcc.dg/vect/slp-9.c: Use scan-tree-dump rather than"}, {"sha": "33af97bbdbf50d2db9e0143521ed89e837e9f6bf", "filename": "gcc/testsuite/gcc.target/arc/or-cnst-size2.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Ftestsuite%2Fgcc.target%2Farc%2For-cnst-size2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4653da0b6ec2a5c272d9cd98a970f0037f1a5789/gcc%2Ftestsuite%2Fgcc.target%2Farc%2For-cnst-size2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farc%2For-cnst-size2.c?ref=4653da0b6ec2a5c272d9cd98a970f0037f1a5789", "patch": "@@ -0,0 +1,12 @@\n+/* Check if we optimize the immediate of a predicated instruction.  */\n+/* { dg-options \"-Os -fif-conversion -fif-conversion2\" } */\n+\n+int a;\n+int foo (void)\n+{\n+  if ((a & 60) == 0)\n+    return a | 64;\n+}\n+\n+/* { dg-final { scan-assembler \"tst\" } } */\n+/* { dg-final { scan-assembler \"bset.eq\" } } */"}]}