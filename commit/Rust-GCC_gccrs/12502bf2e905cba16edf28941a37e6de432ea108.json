{"sha": "12502bf2e905cba16edf28941a37e6de432ea108", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTI1MDJiZjJlOTA1Y2JhMTZlZGYyODk0MWEzN2U2ZGU0MzJlYTEwOA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-01-24T08:27:39Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-01-24T08:27:39Z"}, "message": "Fix broken filename for .gcda files starting with '..' (PR gcov-profile/88994).\n\n2019-01-24  Martin Liska  <mliska@suse.cz>\n\n\tPR gcov-profile/88994\n\t* gcov-io.c (mangle_path): Do not allocate a bigger buffer,\n\tresult will be always smaller or equal to the original.\n\t* gcov.c (mangle_name): Fix else branch where we should\n\talso copy to PTR and shift the pointer.\n\nFrom-SVN: r268233", "tree": {"sha": "3bb6d2911140400e28773f6ab238f857c25988d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3bb6d2911140400e28773f6ab238f857c25988d5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/12502bf2e905cba16edf28941a37e6de432ea108", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12502bf2e905cba16edf28941a37e6de432ea108", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12502bf2e905cba16edf28941a37e6de432ea108", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12502bf2e905cba16edf28941a37e6de432ea108/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "07fd2247eed45cd69c7b2294fe528c9bbe7a838e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07fd2247eed45cd69c7b2294fe528c9bbe7a838e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07fd2247eed45cd69c7b2294fe528c9bbe7a838e"}], "stats": {"total": 26, "additions": 18, "deletions": 8}, "files": [{"sha": "f7013b71eadaf1173ee16ea4c44afc5a1043d619", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12502bf2e905cba16edf28941a37e6de432ea108/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12502bf2e905cba16edf28941a37e6de432ea108/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=12502bf2e905cba16edf28941a37e6de432ea108", "patch": "@@ -1,3 +1,11 @@\n+2019-01-24  Martin Liska  <mliska@suse.cz>\n+\n+\tPR gcov-profile/88994\n+\t* gcov-io.c (mangle_path): Do not allocate a bigger buffer,\n+\tresult will be always smaller or equal to the original.\n+\t* gcov.c (mangle_name): Fix else branch where we should\n+\talso copy to PTR and shift the pointer.\n+\n 2019-01-24  Xiong Hu Luo  <luoxhu@linux.vnet.ibm.com>\n \n \t* tree-ssa-dom.c (test_for_singularity): fix a comment typo."}, {"sha": "1f8ac375931ce16c5c3e0447c23077a2642003b2", "filename": "gcc/gcov-io.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12502bf2e905cba16edf28941a37e6de432ea108/gcc%2Fgcov-io.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12502bf2e905cba16edf28941a37e6de432ea108/gcc%2Fgcov-io.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcov-io.c?ref=12502bf2e905cba16edf28941a37e6de432ea108", "patch": "@@ -547,7 +547,7 @@ mangle_path (char const *base)\n   /* Convert '/' to '#', convert '..' to '^',\n      convert ':' to '~' on DOS based file system.  */\n   const char *probe;\n-  char *buffer = (char *)xmalloc (strlen (base) + 10);\n+  char *buffer = (char *)xmalloc (strlen (base) + 1);\n   char *ptr = buffer;\n \n #if HAVE_DOS_BASED_FILE_SYSTEM"}, {"sha": "cb6bc7ef85f7bd9c8e808f541e892a18fc5d0a50", "filename": "gcc/gcov.c", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/12502bf2e905cba16edf28941a37e6de432ea108/gcc%2Fgcov.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/12502bf2e905cba16edf28941a37e6de432ea108/gcc%2Fgcov.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcov.c?ref=12502bf2e905cba16edf28941a37e6de432ea108", "patch": "@@ -2520,21 +2520,23 @@ make_gcov_file_name (const char *input_name, const char *src_name)\n   return result;\n }\n \n+/* Mangle BASE name, copy it at the beginning of PTR buffer and\n+   return address of the \\0 character of the buffer.  */\n+\n static char *\n mangle_name (char const *base, char *ptr)\n {\n   size_t len;\n \n   /* Generate the source filename part.  */\n   if (!flag_preserve_paths)\n-    {\n-      base = lbasename (base);\n-      len = strlen (base);\n-      memcpy (ptr, base, len);\n-      ptr += len;\n-    }\n+    base = lbasename (base);\n   else\n-    ptr = mangle_path (base);\n+    base = mangle_path (base);\n+\n+  len = strlen (base);\n+  memcpy (ptr, base, len);\n+  ptr += len;\n \n   return ptr;\n }"}]}