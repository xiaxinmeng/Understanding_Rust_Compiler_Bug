{"sha": "8d852645145d10bbf72cbd82ef080a0057eb9c0e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGQ4NTI2NDUxNDVkMTBiYmY3MmNiZDgyZWYwODBhMDA1N2ViOWMwZQ==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2019-07-28T09:26:13Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2019-07-28T09:26:13Z"}, "message": "[RS6000] Make assembler command line cpu match default for gcc\n\nWhen gcc is configured using --with-cpu=<cpu>, the specified cpu\neffectively becomes a default -mcpu=<cpu> passed to gcc.  This then\naffects the cpu passed to gas via ASM_CPU_SPEC.  If gcc is not\nconfigured using --with-cpu then the cpu passed to gas is that given\nby ASM_DEFAULT_SPEC, which currently does not match the default flags\nselected in default64.h.  This patch makes ASM_DEFAULT_SPEC agree with\nTARGET_DEFAULT flags.\n\nrs6000/default64.h appears in three places in config.gcc, the first\none immediately followed by rs6000/freebsd64.h in $tm_file, and the\nother two immediately followed by rs6000/linux64.h.  To be able to\ndefine ASM_DEFAULT_SPEC in rs6000/default64.h we don't want to\nredefine in the other two files.  rs6000/freebsd64.h is easy since\nthat file is always preceded by rs6000/default64.h, but\nrs6000/linux64.h can appear without rs6000/default64.h (a\npowerpc*-linux config where the default is -m32).  In that case we\nwill have TARGET_DEFAULT flags of 0 (from rs6000/sysv4.h) and want to\nuse -mppc without -m64 and -mppc64 with -m64.  This can be done by\nusing the rs6000/rtems.h ASM_DEFAULT_SPEC in rs6000/sysv4.h, a change\nthat won't affect sysv4 configurations where -m64 is invalid.\n\nThe patch also introduces ASM_DEFAULT_EXTRA for the altivec variant\ntargets so as to enable -maltivec by default.\n\n\tPR target/91050\n\t* config/rs6000/sysv4.h (ASM_DEFAULT_SPEC): Modify if -m64.\n\t* config/rs6000/default64.h (ASM_DEFAULT_SPEC): Define.\n\t* config/rs6000/freebsd64.h (ASM_DEFAULT_SPEC): Don't define.\n\t* config/rs6000/linux64.h (ASM_DEFAULT_SPEC): Likewise.\n\t* config/rs6000/rtems.h (ASM_DEFAULT_SPEC): Likewise.\n\t* config/rs6000/rs6000.h (ASM_DEFAULT_EXTRA): Define and use\n\tin asm_default spec.\n\t* config/rs6000/eabialtivec.h (ASM_DEFAULT_EXTRA): Redefine.\n\t* config/rs6000/linuxaltivec.h (ASM_DEFAULT_EXTRA): Redefine.\n\nFrom-SVN: r273853", "tree": {"sha": "742c00171822737398f231196ec5f81eb2f1719e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/742c00171822737398f231196ec5f81eb2f1719e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8d852645145d10bbf72cbd82ef080a0057eb9c0e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d852645145d10bbf72cbd82ef080a0057eb9c0e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d852645145d10bbf72cbd82ef080a0057eb9c0e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d852645145d10bbf72cbd82ef080a0057eb9c0e/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c5993c9abc360b5dc7ef4d8ebb639725eec7939c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c5993c9abc360b5dc7ef4d8ebb639725eec7939c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c5993c9abc360b5dc7ef4d8ebb639725eec7939c"}], "stats": {"total": 37, "additions": 26, "deletions": 11}, "files": [{"sha": "d005cd965bac0153e374696109c208d5de43cc84", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -1,3 +1,16 @@\n+2019-07-28  Alan Modra  <amodra@gmail.com>\n+\n+\tPR target/91050\n+\t* config/rs6000/sysv4.h (ASM_DEFAULT_SPEC): Modify if -m64.\n+\t* config/rs6000/default64.h (ASM_DEFAULT_SPEC): Define.\n+\t* config/rs6000/freebsd64.h (ASM_DEFAULT_SPEC): Don't define.\n+\t* config/rs6000/linux64.h (ASM_DEFAULT_SPEC): Likewise.\n+\t* config/rs6000/rtems.h (ASM_DEFAULT_SPEC): Likewise.\n+\t* config/rs6000/rs6000.h (ASM_DEFAULT_EXTRA): Define and use\n+\tin asm_default spec.\n+\t* config/rs6000/eabialtivec.h (ASM_DEFAULT_EXTRA): Redefine.\n+\t* config/rs6000/linuxaltivec.h (ASM_DEFAULT_EXTRA): Redefine.\n+\n 2019-07-28  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* doc/include/gpl_v3.texi (Copying): Use https for www.gnu.org."}, {"sha": "10743fee796bf425543fa1fecd444b236d4c8c60", "filename": "gcc/config/rs6000/default64.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Fdefault64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Fdefault64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdefault64.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -25,7 +25,11 @@ along with GCC; see the file COPYING3.  If not see\n #if (TARGET_DEFAULT & MASK_LITTLE_ENDIAN)\n #undef TARGET_DEFAULT\n #define TARGET_DEFAULT (ISA_2_7_MASKS_SERVER | MASK_POWERPC64 | MASK_64BIT | MASK_LITTLE_ENDIAN)\n+#undef ASM_DEFAULT_SPEC\n+#define ASM_DEFAULT_SPEC \"-mpower8\"\n #else\n #undef TARGET_DEFAULT\n #define TARGET_DEFAULT (MASK_PPC_GFXOPT | MASK_PPC_GPOPT | MASK_MFCRF | MASK_POWERPC64 | MASK_64BIT)\n+#undef ASM_DEFAULT_SPEC\n+#define ASM_DEFAULT_SPEC \"-mpower4\"\n #endif"}, {"sha": "6daa92264ea5c540a2b059137a15d8471f6018af", "filename": "gcc/config/rs6000/eabialtivec.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Feabialtivec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Feabialtivec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Feabialtivec.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -23,5 +23,8 @@\n #undef  TARGET_DEFAULT\n #define TARGET_DEFAULT (MASK_EABI | MASK_ALTIVEC)\n \n+#undef\tASM_DEFAULT_EXTRA\n+#define\tASM_DEFAULT_EXTRA \" %{!mvsx:%{!maltivec:%{!no-maltivec:-maltivec}}}\"\n+\n #undef  SUBSUBTARGET_OVERRIDE_OPTIONS\n #define SUBSUBTARGET_OVERRIDE_OPTIONS\trs6000_altivec_abi = 1"}, {"sha": "4951275c9635c2eecca83f02f6d484398c2c2b5b", "filename": "gcc/config/rs6000/freebsd64.h", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Ffreebsd64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Ffreebsd64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Ffreebsd64.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -134,11 +134,9 @@ extern int dot_symbols;\n     }\t\t\t\t\t\t\t\t\\\n   while (0)\n \n-#undef\tASM_DEFAULT_SPEC\n #undef\tASM_SPEC\n #undef\tLINK_OS_FREEBSD_SPEC\n \n-#define\tASM_DEFAULT_SPEC \"-mppc%{!m32:64}\"\n #define\tASM_SPEC\t \"%{m32:%(asm_spec32)}%{!m32:%(asm_spec64)} %(asm_spec_common)\"\n #define\tLINK_OS_FREEBSD_SPEC \"%{m32:%(link_os_freebsd_spec32)}%{!m32:%(link_os_freebsd_spec64)}\"\n "}, {"sha": "ba5f640efc84a81cdba9d4e4a219c106ed88441b", "filename": "gcc/config/rs6000/linux64.h", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Flinux64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Flinux64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Flinux64.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -181,24 +181,20 @@ extern int dot_symbols;\n     }\t\t\t\t\t\t\t\t\\\n   while (0)\n \n-#undef\tASM_DEFAULT_SPEC\n #undef\tASM_SPEC\n #undef\tLINK_OS_LINUX_SPEC\n #undef\tLINK_SECURE_PLT_SPEC\n \n #ifndef\tRS6000_BI_ARCH\n-#define\tASM_DEFAULT_SPEC \"-mppc64\"\n #define\tASM_SPEC\t \"%(asm_spec64) %(asm_spec_common)\"\n #define\tLINK_OS_LINUX_SPEC \"%(link_os_linux_spec64)\"\n #define\tLINK_SECURE_PLT_SPEC \"\"\n #else\n #if DEFAULT_ARCH64_P\n-#define\tASM_DEFAULT_SPEC \"-mppc%{!m32:64}\"\n #define\tASM_SPEC\t \"%{m32:%(asm_spec32)}%{!m32:%(asm_spec64)} %(asm_spec_common)\"\n #define\tLINK_OS_LINUX_SPEC \"%{m32:%(link_os_linux_spec32)}%{!m32:%(link_os_linux_spec64)}\"\n #define\tLINK_SECURE_PLT_SPEC \"%{m32: \" LINK_SECURE_PLT_DEFAULT_SPEC \"}\"\n #else\n-#define\tASM_DEFAULT_SPEC \"-mppc%{m64:64}\"\n #define\tASM_SPEC\t \"%{!m64:%(asm_spec32)}%{m64:%(asm_spec64)} %(asm_spec_common)\"\n #define\tLINK_OS_LINUX_SPEC \"%{!m64:%(link_os_linux_spec32)}%{m64:%(link_os_linux_spec64)}\"\n #define\tLINK_SECURE_PLT_SPEC \"%{!m64: \" LINK_SECURE_PLT_DEFAULT_SPEC \"}\""}, {"sha": "8578f42763a963f44a40d90095cc0302ebdb14a0", "filename": "gcc/config/rs6000/linuxaltivec.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Flinuxaltivec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Flinuxaltivec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Flinuxaltivec.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -28,5 +28,8 @@\n #define\tTARGET_DEFAULT MASK_ALTIVEC\n #endif\n \n+#undef\tASM_DEFAULT_EXTRA\n+#define\tASM_DEFAULT_EXTRA \" %{!mvsx:%{!maltivec:%{!mno-altivec:-maltivec}}}\"\n+\n #undef  SUBSUBTARGET_OVERRIDE_OPTIONS\n #define SUBSUBTARGET_OVERRIDE_OPTIONS rs6000_altivec_abi = 1"}, {"sha": "6c24b48a9abeca4587702d43e4db207dce773657", "filename": "gcc/config/rs6000/rs6000.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Frs6000.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Frs6000.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -157,6 +157,7 @@ ASM_OPT_ANY\n #define CPP_DEFAULT_SPEC \"\"\n \n #define ASM_DEFAULT_SPEC \"\"\n+#define ASM_DEFAULT_EXTRA \"\"\n \n /* This macro defines names of additional specifications to put in the specs\n    that can be used in various specifications like CC1_SPEC.  Its definition\n@@ -174,7 +175,7 @@ ASM_OPT_ANY\n   { \"cpp_default\",\t\tCPP_DEFAULT_SPEC },\t\t\t\\\n   { \"asm_cpu\",\t\t\tASM_CPU_SPEC },\t\t\t\t\\\n   { \"asm_cpu_native\",\t\tASM_CPU_NATIVE_SPEC },\t\t\t\\\n-  { \"asm_default\",\t\tASM_DEFAULT_SPEC },\t\t\t\\\n+  { \"asm_default\",\t\tASM_DEFAULT_SPEC ASM_DEFAULT_EXTRA },\t\\\n   { \"cc1_cpu\",\t\t\tCC1_CPU_SPEC },\t\t\t\t\\\n   SUBTARGET_EXTRA_SPECS\n "}, {"sha": "0c198020a421640b3dd1b3bd5f4af299a4de09cc", "filename": "gcc/config/rs6000/rtems.h", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Frtems.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Frtems.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frtems.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -254,9 +254,6 @@\n %{mcpu=8540: %{!Dppc*: %{!Dmpc*: -Dppc8540}  } } \\\n %{mcpu=e6500: -D__PPC_CPU_E6500__}\"\n \n-#undef\tASM_DEFAULT_SPEC\n-#define\tASM_DEFAULT_SPEC \"-mppc%{m64:64}\"\n-\n #undef\tASM_SPEC\n #define\tASM_SPEC \"%{!m64:%(asm_spec32)}%{m64:%(asm_spec64)} %(asm_spec_common)\"\n "}, {"sha": "4645ef3b21ee68c22fc5a5c57b936c70797c854b", "filename": "gcc/config/rs6000/sysv4.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8d852645145d10bbf72cbd82ef080a0057eb9c0e/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fsysv4.h?ref=8d852645145d10bbf72cbd82ef080a0057eb9c0e", "patch": "@@ -39,7 +39,7 @@\n \n /* Override rs6000.h definition.  */\n #undef\tASM_DEFAULT_SPEC\n-#define\tASM_DEFAULT_SPEC \"-mppc\"\n+#define\tASM_DEFAULT_SPEC \"-mppc%{m64:64}\"\n \n #define\tTARGET_HAS_TOC\t\t(TARGET_64BIT\t\t\t\t\\\n \t\t\t\t || (TARGET_MINIMAL_TOC\t\t\t\\"}]}