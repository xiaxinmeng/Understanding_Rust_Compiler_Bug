{"sha": "6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmNiYWI5NTk0ZTJiOTY1NTEyNmViZjJjZGZiNmNlMDIyNjVkM2Q0Ng==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-01-23T08:42:18Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-01-23T08:42:18Z"}, "message": "[multiple changes]\n\n2012-01-23  Robert Dewar  <dewar@adacore.com>\n\n\t* sem_ch10.adb (Analyze_Subunit): Properly save/restore cunit\n\trestrictions.\n\n2012-01-23  Ed Schonberg  <schonberg@adacore.com>\n\n\t* snames.ads-tmpl: Add Name_Synchronization.\n\t* aspects.ads, aspects.adb: Add Aspect_Synchronization to\n\tenumeration type and related maps.\n\t* sem_ch13.adb (Analyze_Aspect_Specifications): Handle Aspect\n\tSynchronization, build corresponding pragma Implemented.\n\t* sem_util.adb (Implementation_Kind): Handle both explicit and\n\timplicit pragma_argument association to retrieve the given\n\tsynchronization mode.\n\nFrom-SVN: r183410", "tree": {"sha": "0e3a8b5542365c8d18ae8656e213a5e28132dd98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e3a8b5542365c8d18ae8656e213a5e28132dd98"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/comments", "author": null, "committer": null, "parents": [{"sha": "67bdbf1ebd52a2599cae74d4b1b6def861c8c8bc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67bdbf1ebd52a2599cae74d4b1b6def861c8c8bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67bdbf1ebd52a2599cae74d4b1b6def861c8c8bc"}], "stats": {"total": 80, "additions": 69, "deletions": 11}, "files": [{"sha": "1cca2ee384e16828fccc217e0c66b6a444ae01d4", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -1,3 +1,19 @@\n+2012-01-23  Robert Dewar  <dewar@adacore.com>\n+\n+\t* sem_ch10.adb (Analyze_Subunit): Properly save/restore cunit\n+\trestrictions.\n+\n+2012-01-23  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* snames.ads-tmpl: Add Name_Synchronization.\n+\t* aspects.ads, aspects.adb: Add Aspect_Synchronization to\n+\tenumeration type and related maps.\n+\t* sem_ch13.adb (Analyze_Aspect_Specifications): Handle Aspect\n+\tSynchronization, build corresponding pragma Implemented.\n+\t* sem_util.adb (Implementation_Kind): Handle both explicit and\n+\timplicit pragma_argument association to retrieve the given\n+\tsynchronization mode.\n+\n 2012-01-23  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_ch10.adb, errout.adb: Minor reformatting."}, {"sha": "5894a46c9af2ae5e9b77fe3125c34068dc098458", "filename": "gcc/ada/aspects.adb", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Faspects.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Faspects.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Faspects.adb?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2010-2011, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2010-2012, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -305,6 +305,7 @@ package body Aspects is\n     Aspect_Stream_Size                  => Aspect_Stream_Size,\n     Aspect_Suppress                     => Aspect_Suppress,\n     Aspect_Suppress_Debug_Info          => Aspect_Suppress_Debug_Info,\n+    Aspect_Synchronization              => Aspect_Synchronization,\n     Aspect_Test_Case                    => Aspect_Test_Case,\n     Aspect_Type_Invariant               => Aspect_Invariant,\n     Aspect_Unchecked_Union              => Aspect_Unchecked_Union,"}, {"sha": "2f60cb9dca7e9c60af102f120f6099d1d62862e8", "filename": "gcc/ada/aspects.ads", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Faspects.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Faspects.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Faspects.ads?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---         Copyright (C) 2010-2011, Free Software Foundation, Inc.          --\n+--         Copyright (C) 2010-2012, Free Software Foundation, Inc.          --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -81,6 +81,7 @@ package Aspects is\n       Aspect_Storage_Size,\n       Aspect_Stream_Size,\n       Aspect_Suppress,\n+      Aspect_Synchronization,\n       Aspect_Test_Case,                     -- GNAT\n       Aspect_Type_Invariant,\n       Aspect_Unsuppress,\n@@ -281,6 +282,7 @@ package Aspects is\n                         Aspect_Storage_Size            => Expression,\n                         Aspect_Stream_Size             => Expression,\n                         Aspect_Suppress                => Name,\n+                        Aspect_Synchronization         => Name,\n                         Aspect_Test_Case               => Expression,\n                         Aspect_Type_Invariant          => Expression,\n                         Aspect_Unsuppress              => Name,\n@@ -367,6 +369,7 @@ package Aspects is\n      Aspect_Stream_Size                  => Name_Stream_Size,\n      Aspect_Suppress                     => Name_Suppress,\n      Aspect_Suppress_Debug_Info          => Name_Suppress_Debug_Info,\n+     Aspect_Synchronization              => Name_Synchronization,\n      Aspect_Test_Case                    => Name_Test_Case,\n      Aspect_Type_Invariant               => Name_Type_Invariant,\n      Aspect_Unchecked_Union              => Name_Unchecked_Union,"}, {"sha": "e2d1c2b5cd6d849d5d9ffe22d6b846b62004eb63", "filename": "gcc/ada/sem_ch10.adb", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsem_ch10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsem_ch10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch10.adb?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -1962,6 +1962,12 @@ package body Sem_Ch10 is\n       Enclosing_Child : Entity_Id := Empty;\n       Svg             : constant Suppress_Array := Scope_Suppress;\n \n+      Save_Cunit_Restrictions : constant Save_Cunit_Boolean_Restrictions :=\n+                                  Cunit_Boolean_Restrictions_Save;\n+      --  Save non-partition wide restrictions before processing the subunit.\n+      --  All subunits are analyzed with config restrictions reset and we need\n+      --  to restore these saved values at the end.\n+\n       procedure Analyze_Subunit_Context;\n       --  Capture names in use clauses of the subunit. This must be done before\n       --  re-installing parent declarations, because items in the context must\n@@ -2175,6 +2181,15 @@ package body Sem_Ch10 is\n    --  Start of processing for Analyze_Subunit\n \n    begin\n+      --  For subunit in main extended unit, we reset the configuration values\n+      --  for the non-partition-wide restrictions. For other units reset them.\n+\n+      if In_Extended_Main_Source_Unit (N) then\n+         Restore_Config_Cunit_Boolean_Restrictions;\n+      else\n+         Reset_Cunit_Boolean_Restrictions;\n+      end if;\n+\n       if Style_Check then\n          declare\n             Nam : Node_Id := Name (Unit (N));\n@@ -2280,6 +2295,10 @@ package body Sem_Ch10 is\n             end loop;\n          end;\n       end if;\n+\n+      --  Deal with restore of restrictions\n+\n+      Cunit_Boolean_Restrictions_Restore (Save_Cunit_Restrictions);\n    end Analyze_Subunit;\n \n    ----------------------------"}, {"sha": "7e46a78704701bfd2618c53c7fdf24fa741efaa6", "filename": "gcc/ada/sem_ch13.adb", "status": "modified", "additions": 21, "deletions": 5, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsem_ch13.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsem_ch13.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch13.adb?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2011, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2012, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -1103,6 +1103,21 @@ package body Sem_Ch13 is\n \n                   pragma Assert (not Delay_Required);\n \n+               when Aspect_Synchronization =>\n+\n+                  --  The aspect corresponds to pragma Implemented.\n+                  --  Construct the pragma\n+\n+                  Aitem :=\n+                    Make_Pragma (Loc,\n+                      Pragma_Argument_Associations => New_List (\n+                        New_Occurrence_Of (E, Loc),\n+                        Relocate_Node (Expr)),\n+                      Pragma_Identifier            =>\n+                        Make_Identifier (Sloc (Id), Name_Implemented));\n+\n+                  pragma Assert (not Delay_Required);\n+\n                --  Aspects corresponding to pragmas with two arguments, where\n                --  the second argument is a local name referring to the entity,\n                --  and the first argument is the aspect definition expression.\n@@ -6115,11 +6130,12 @@ package body Sem_Ch13 is\n             Analyze (Expression (ASN));\n             return;\n \n-         --  Suppress/Unsuppress/Warnings should never be delayed\n+         --  Suppress/Unsuppress/Synchronization/Warnings should not be delayed\n \n-         when Aspect_Suppress   |\n-              Aspect_Unsuppress |\n-              Aspect_Warnings   =>\n+         when Aspect_Suppress        |\n+              Aspect_Unsuppress      |\n+              Aspect_Synchronization |\n+              Aspect_Warnings        =>\n             raise Program_Error;\n \n          --  Pre/Post/Invariant/Predicate take boolean expressions"}, {"sha": "37ab9508850f97bac6b2b86cd4da21a758399397", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1992-2011, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2012, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -6037,10 +6037,11 @@ package body Sem_Util is\n \n    function Implementation_Kind (Subp : Entity_Id) return Name_Id is\n       Impl_Prag : constant Node_Id := Get_Rep_Pragma (Subp, Name_Implemented);\n+      Arg       : Node_Id;\n    begin\n       pragma Assert (Present (Impl_Prag));\n-      return\n-        Chars (Expression (Last (Pragma_Argument_Associations (Impl_Prag))));\n+      Arg := Last (Pragma_Argument_Associations (Impl_Prag));\n+      return Chars (Get_Pragma_Arg (Arg));\n    end Implementation_Kind;\n \n    --------------------------"}, {"sha": "f40d0f2d24c28b455b89d03c96139c498d2b5691", "filename": "gcc/ada/snames.ads-tmpl", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsnames.ads-tmpl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6cbab9594e2b9655126ebf2cdfb6ce02265d3d46/gcc%2Fada%2Fsnames.ads-tmpl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsnames.ads-tmpl?ref=6cbab9594e2b9655126ebf2cdfb6ce02265d3d46", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                             T e m p l a t e                              --\n --                                                                          --\n---          Copyright (C) 1992-2011, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1992-2012, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -1086,6 +1086,7 @@ package Snames is\n \n    --  Additional reserved words and identifiers used in GNAT Project Files\n    --  Note that Name_External is already previously declared.\n+\n    --  The names with the -- GB annotation are only used in gprbuild.\n \n    Name_Aggregate                          : constant Name_Id := N + $;\n@@ -1226,6 +1227,7 @@ package Snames is\n    Name_Switches                           : constant Name_Id := N + $;\n    Name_Symbolic_Link_Supported            : constant Name_Id := N + $;\n    Name_Synchronize                        : constant Name_Id := N + $;\n+   Name_Synchronization                    : constant Name_Id := N + $;\n    Name_Toolchain_Description              : constant Name_Id := N + $;\n    Name_Toolchain_Version                  : constant Name_Id := N + $;\n    Name_Trailing_Required_Switches         : constant Name_Id := N + $;"}]}