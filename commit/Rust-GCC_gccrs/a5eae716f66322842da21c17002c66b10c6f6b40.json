{"sha": "a5eae716f66322842da21c17002c66b10c6f6b40", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTVlYWU3MTZmNjYzMjI4NDJkYTIxYzE3MDAyYzY2YjEwYzZmNmI0MA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2018-07-02T21:42:10Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2018-07-02T21:42:10Z"}, "message": "parser.c (set_and_check_decl_spec_loc): Use rich_location::add_range in error message about __thread and thread_local...\n\n/cp\n2018-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* parser.c (set_and_check_decl_spec_loc): Use rich_location::add_range\n\tin error message about __thread and thread_local at the same time.\n\n/testsuite\n2018-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\t* g++.dg/diagnostic/thread-thread_local.C: New.\n\nFrom-SVN: r262321", "tree": {"sha": "cc166090c6dc9638364d6616d940031863f435fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cc166090c6dc9638364d6616d940031863f435fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a5eae716f66322842da21c17002c66b10c6f6b40", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5eae716f66322842da21c17002c66b10c6f6b40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5eae716f66322842da21c17002c66b10c6f6b40", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5eae716f66322842da21c17002c66b10c6f6b40/comments", "author": null, "committer": null, "parents": [{"sha": "ee896276f6483832d45c9280915367c825c32098", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee896276f6483832d45c9280915367c825c32098", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee896276f6483832d45c9280915367c825c32098"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "53bcb1f93192e3d0af6a7ac9edf455b87afedd49", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a5eae716f66322842da21c17002c66b10c6f6b40", "patch": "@@ -1,3 +1,8 @@\n+2018-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* parser.c (set_and_check_decl_spec_loc): Use rich_location::add_range\n+\tin error message about __thread and thread_local at the same time.\n+\n 2018-06-29  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/86184"}, {"sha": "5edd0eed76e8983002ee9af22a7b0c4eccf16d77", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=a5eae716f66322842da21c17002c66b10c6f6b40", "patch": "@@ -28377,12 +28377,15 @@ set_and_check_decl_spec_loc (cp_decl_specifier_seq *decl_specs,\n       else if (ds == ds_thread)\n \t{\n \t  bool gnu = token_is__thread (token);\n+\t  gcc_rich_location richloc (location);\n \t  if (gnu != decl_specs->gnu_thread_keyword_p)\n-\t    error_at (location,\n-\t\t      \"both %<__thread%> and %<thread_local%> specified\");\n+\t    {\n+\t      richloc.add_range (decl_specs->locations[ds_thread], false);\n+\t      error_at (&richloc,\n+\t\t\t\"both %<__thread%> and %<thread_local%> specified\");\n+\t    }\n \t  else\n \t    {\n-\t      gcc_rich_location richloc (location);\n \t      richloc.add_fixit_remove ();\n \t      error_at (&richloc, \"duplicate %qD\", token->u.value);\n \t    }"}, {"sha": "f2485db4f0fce57a415c07f28ce217b899f86586", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a5eae716f66322842da21c17002c66b10c6f6b40", "patch": "@@ -1,3 +1,7 @@\n+2018-07-02  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\t* g++.dg/diagnostic/thread-thread_local.C: New.\n+\n 2018-07-02  Martin Liska  <mliska@suse.cz>\n \n         PR testsuite/86366"}, {"sha": "4f2264ce05e6d0951c87591c55b68a41fcd0a10d", "filename": "gcc/testsuite/g++.dg/diagnostic/thread-thread_local.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fthread-thread_local.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5eae716f66322842da21c17002c66b10c6f6b40/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fthread-thread_local.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fthread-thread_local.C?ref=a5eae716f66322842da21c17002c66b10c6f6b40", "patch": "@@ -0,0 +1,13 @@\n+// { dg-options \"-fdiagnostics-show-caret\" }\n+// { dg-do compile { target c++11 } }\n+\n+thread_local __thread int a;  // { dg-error \"14:both .__thread. and .thread_local. specified\" }\n+/* { dg-begin-multiline-output \"\" }\n+ thread_local __thread int a;\n+ ~~~~~~~~~~~~ ^~~~~~~~\n+   { dg-end-multiline-output \"\" } */\n+__thread thread_local int b;  // { dg-error \"10:both .__thread. and .thread_local. specified\" }\n+/* { dg-begin-multiline-output \"\" }\n+ __thread thread_local int b;\n+ ~~~~~~~~ ^~~~~~~~~~~~\n+   { dg-end-multiline-output \"\" } */"}]}