{"sha": "d32ef397c98b50171cb13eb0421ace2479368eec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDMyZWYzOTdjOThiNTAxNzFjYjEzZWIwNDIxYWNlMjQ3OTM2OGVlYw==", "commit": {"author": {"name": "Andreas Simbuerger", "email": "simbuerg@fim.uni-passau.de", "date": "2010-11-11T21:33:24Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2010-11-11T21:33:24Z"}, "message": "Support official CLooG.org versions.\n\n2010-11-11  Andreas Simbuerger  <simbuerg@fim.uni-passau.de>\n\n\t* configure.ac: Support official CLooG.org versions.\n\t* configure: Regenerate.\n\t* config/cloog.m4: New.\n\nFrom-SVN: r166622", "tree": {"sha": "0513271428917e22045e1daa338c643489c93ef8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0513271428917e22045e1daa338c643489c93ef8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d32ef397c98b50171cb13eb0421ace2479368eec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d32ef397c98b50171cb13eb0421ace2479368eec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d32ef397c98b50171cb13eb0421ace2479368eec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d32ef397c98b50171cb13eb0421ace2479368eec/comments", "author": {"login": "simbuerg", "id": 598281, "node_id": "MDQ6VXNlcjU5ODI4MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/598281?v=4", "gravatar_id": "", "url": "https://api.github.com/users/simbuerg", "html_url": "https://github.com/simbuerg", "followers_url": "https://api.github.com/users/simbuerg/followers", "following_url": "https://api.github.com/users/simbuerg/following{/other_user}", "gists_url": "https://api.github.com/users/simbuerg/gists{/gist_id}", "starred_url": "https://api.github.com/users/simbuerg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/simbuerg/subscriptions", "organizations_url": "https://api.github.com/users/simbuerg/orgs", "repos_url": "https://api.github.com/users/simbuerg/repos", "events_url": "https://api.github.com/users/simbuerg/events{/privacy}", "received_events_url": "https://api.github.com/users/simbuerg/received_events", "type": "User", "site_admin": false}, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "77b0efff1d56d9579cb964b5f34a5eaddf146715", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77b0efff1d56d9579cb964b5f34a5eaddf146715", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77b0efff1d56d9579cb964b5f34a5eaddf146715"}], "stats": {"total": 642, "additions": 530, "deletions": 112}, "files": [{"sha": "e3495aec8debf246d749cfc59d814cb351c9e392", "filename": "ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d32ef397c98b50171cb13eb0421ace2479368eec/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d32ef397c98b50171cb13eb0421ace2479368eec/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=d32ef397c98b50171cb13eb0421ace2479368eec", "patch": "@@ -1,3 +1,9 @@\n+2010-11-11  Andreas Simbuerger  <simbuerg@fim.uni-passau.de>\n+\n+\t* configure.ac: Support official CLooG.org versions.\n+\t* configure: Regenerate.\n+\t* config/cloog.m4: New.\n+\n 2010-11-10  Fran\u00e7ois Dumont  <francois.cppdevs@free.fr>\n \n \t* MAINTAINERS (Write After Approval): Add myself."}, {"sha": "9ddea982d1909181e7584447f0232d4b5b8c57c8", "filename": "config/cloog.m4", "status": "added", "additions": 252, "deletions": 0, "changes": 252, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d32ef397c98b50171cb13eb0421ace2479368eec/config%2Fcloog.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d32ef397c98b50171cb13eb0421ace2479368eec/config%2Fcloog.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/config%2Fcloog.m4?ref=d32ef397c98b50171cb13eb0421ace2479368eec", "patch": "@@ -0,0 +1,252 @@\n+# This file is part of GCC.\n+#\n+# GCC is free software; you can redistribute it and/or modify it under\n+# the terms of the GNU General Public License as published by the Free\n+# Software Foundation; either version 3, or (at your option) any later\n+# version.\n+#\n+# GCC is distributed in the hope that it will be useful, but WITHOUT\n+# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+# FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+# for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with GCC; see the file COPYING3.  If not see\n+# <http://www.gnu.org/licenses/>.\n+#\n+# Contributed by Andreas Simbuerger <simbuerg@fim.uni-passau.de>\n+\n+# CLOOG_INIT_FLAGS ()\n+# -------------------------\n+# Provide configure switches for CLooG support.\n+# Initialize clooglibs/clooginc according to the user input.\n+AC_DEFUN([CLOOG_INIT_FLAGS],\n+[\n+  AC_ARG_WITH(cloog,\n+    [AS_HELP_STRING(\n+      [--with-cloog=PATH],\n+      [Specify prefix directory for the installed CLooG-PPL package.\n+       Equivalent to --with-cloog-include=PATH/include\n+       plus --with-cloog-lib=PATH/lib])])\n+  AC_ARG_WITH(cloog_include,\n+    [AS_HELP_STRING(\n+      [--with-cloog-include=PATH],\n+      [Specify directory for installed CLooG include files])])\n+  AC_ARG_WITH(cloog_lib,\n+    [AS_HELP_STRING(\n+      [--with-cloog-lib=PATH],\n+      [Specify the directory for the installed CLooG library])])\n+  \n+  AC_ARG_ENABLE(cloog-version-check,\n+    [AS_HELP_STRING(\n+      [--disable-cloog-version-check],\n+      [disable check for CLooG version])],\n+    ENABLE_CLOOG_CHECK=$enableval,\n+    ENABLE_CLOOG_CHECK=yes)\n+  \n+  # Initialize clooglibs and clooginc.\n+  case $with_cloog in\n+    no)\n+      clooglibs=\n+      clooginc=\n+      ;;\n+    \"\" | yes)\n+      ;;\n+    *)\n+      clooglibs=\"-L$with_cloog/lib\"\n+      clooginc=\"-I$with_cloog/include\"\n+      ;;\n+  esac\n+  if test \"x${with_cloog_include}\" != x ; then\n+    clooginc=\"-I$with_cloog_include\"\n+  fi\n+  if test \"x${with_cloog_lib}\" != x; then\n+    clooglibs=\"-L$with_cloog_lib\"\n+  fi\n+\n+  dnl Flags needed for CLOOG\n+  AC_SUBST(clooglibs)\n+  AC_SUBST(clooginc)\n+]\n+)\n+\n+# CLOOG_REQUESTED (ACTION-IF-REQUESTED, ACTION-IF-NOT)\n+# ----------------------------------------------------\n+# Provide actions for failed CLooG detection.\n+AC_DEFUN([CLOOG_REQUESTED],\n+[\n+  AC_REQUIRE([CLOOG_INIT_FLAGS])\n+\n+  if test \"x${with_cloog}\" != x \\\n+    || test \"x${with_cloog_include}\" != x \\\n+    || test \"x${with_cloog_lib}\" != x ; then\n+    $1\n+  else\n+    $2\n+  fi\n+]\n+)\n+\n+# _CLOOG_ORG_PROG ()\n+# ------------------\n+# Helper for detecting CLooG.org's backend.\n+m4_define([_CLOOG_ORG_PROG],[AC_LANG_PROGRAM(\n+  [#include <cloog/cloog.h>],\n+  [cloog_version ()])])\n+\n+# _CLOOG_PPL_LEGACY_PROG ()\n+# -------------------------\n+# Helper for detecting CLooG-Legacy (CLooG-PPL).\n+m4_define([_CLOOG_PPL_LEGACY_PROG], [AC_LANG_PROGRAM(\n+  [#include <cloog/cloog.h>],\n+  [ppl_version_major ()])])\n+\n+# CLOOG_FIND_FLAGS ()\n+# ------------------\n+# Detect the used CLooG-backend and set clooginc/clooglibs/cloog_org.\n+# Preference: CLooG-PPL (Legacy) > CLooG-ISL > CLooG-PPL\n+AC_DEFUN([CLOOG_FIND_FLAGS],\n+[\n+  AC_REQUIRE([CLOOG_INIT_FLAGS])\n+\n+  _cloog_saved_CFLAGS=$CFLAGS\n+  _cloog_saved_CPPFLAGS=$CPPFLAGS\n+  _cloog_saved_LDFLAGS=$LDFLAGS\n+  _cloog_saved_LIBS=$LIBS\n+\n+  _clooglegacyinc=\"-DCLOOG_PPL_BACKEND\"\n+  _cloogorginc=\"-DCLOOG_INT_GMP -DCLOOG_ORG\"\n+ \n+  dnl clooglibs & clooginc may have been initialized by CLOOG_INIT_FLAGS.\n+  CFLAGS=\"${CFLAGS} ${clooginc} ${pplinc} ${gmpinc}\"\n+  CPPFLAGS=\"${CPPFLAGS} ${_clooglegacyinc} ${_cloogorginc}\"\n+  LDFLAGS=\"${LDFLAGS} ${clooglibs}\"\n+\n+  AC_CACHE_CHECK([for installed CLooG],\n+                 [gcc_cv_cloog_type],\n+    [LIBS=\"-lcloog ${_cloog_saved_LIBS}\"\n+     AC_LINK_IFELSE([_CLOOG_PPL_LEGACY_PROG],\n+      [gcc_cv_cloog_type=\"PPL Legacy\"],\n+      [LIBS=\"-lcloog-isl -lisl ${_cloog_saved_LIBS}\"\n+       AC_LINK_IFELSE([_CLOOG_ORG_PROG],\n+        [gcc_cv_cloog_type=ISL],\n+        [LIBS=\"-lcloog-ppl ${_cloog_saved_LIBS}\"\n+         AC_LINK_IFELSE([_CLOOG_ORG_PROG],\n+          [gcc_cv_cloog_type=PPL],\n+          [gcc_cv_cloog_type=no])])])])\n+\n+  case $gcc_cv_cloog_type in\n+    \"PPL Legacy\")\n+      clooginc=\"${clooginc} ${_clooglegacyinc}\"\n+      clooglibs=\"${clooglibs} -lcloog\"\n+      cloog_org=no\n+      ;;\n+    \"ISL\")\n+      clooginc=\"${clooginc} ${_cloogorginc}\"\n+      clooglibs=\"${clooglibs} -lcloog-isl\"\n+      cloog_org=yes\n+      ;;\n+    \"PPL\")\n+      clooginc=\"${clooginc} ${_cloogorginc}\"\n+      clooglibs=\"${clooglibs} -lcloog-ppl\"\n+      cloog_org=yes\n+      ;;\n+    *)\n+      clooglibs=\n+      clooginc=\n+      cloog_org=\n+      ;;\n+  esac\n+\n+  LIBS=$_cloog_saved_LIBS\n+  CFLAGS=$_cloog_saved_CFLAGS\n+  CPPFLAGS=$_cloog_saved_CPPFLAGS\n+  LDFLAGS=$_cloog_saved_LDFLAGS\n+]\n+)\n+\n+# _CLOOG_CHECK_CT_PROG(MAJOR, MINOR, REVISION)\n+# --------------------------------------------\n+# Helper for verifying CLooG's compile time version.\n+m4_define([_CLOOG_CHECK_CT_PROG],[AC_LANG_PROGRAM(\n+  [#include \"cloog/cloog.h\"],\n+  [#if CLOOG_VERSION_MAJOR != $1 \\\n+    || CLOOG_VERSION_MINOR != $2 \\\n+    || CLOOG_VERSION_REVISION < $3\n+    choke me\n+   #endif])])\n+\n+# _CLOOG_CHECK_RT_PROG ()\n+# -----------------------\n+# Helper for verifying that CLooG's compile time version\n+# matches the run time version.\n+m4_define([_CLOOG_CHECK_RT_PROG],[AC_LANG_PROGRAM(\n+  [#include \"cloog/cloog.h\"],\n+  [if ((cloog_version_major () != CLOOG_VERSION_MAJOR)\n+    && (cloog_version_minor () != CLOOG_VERSION_MINOR)\n+    && (cloog_version_revision () != CLOOG_VERSION_REVISION))\n+    {\n+      return 1;\n+    }])])\n+\n+# CLOOG_CHECK_VERSION CLOOG_CHECK_VERSION (MAJOR, MINOR, REVISION)\n+# ----------------------------------------------------------------\n+# Test the found CLooG to be exact of version MAJOR.MINOR and at least\n+# REVISION.\n+# If we're using the old CLooG-PPL (Legacy), the old version check will\n+# be executed (Ignores the provided version information).\n+AC_DEFUN([CLOOG_CHECK_VERSION],\n+[\n+  AC_REQUIRE([CLOOG_FIND_FLAGS])\n+\n+  if test \"${ENABLE_CLOOG_CHECK}\" = yes ; then\n+    _cloog_saved_CFLAGS=$CFLAGS\n+    _cloog_saved_LDFLAGS=$LDFLAGS\n+\n+    CFLAGS=\"${_cloog_saved_CFLAGS} ${clooginc} ${pplinc} ${gmpinc}\"\n+    LDFLAGS=\"${_cloog_saved_LDFLAGS} ${clooglibs}\"\n+\n+    if test \"${cloog_org}\" = yes ; then\n+      AC_CACHE_CHECK([for verison $1.$2.$3 of CLooG],\n+        [gcc_cv_cloog_ct_0_14_0],\n+        [AC_COMPILE_IFELSE([_CLOOG_CHECK_CT_PROG($1,$2,$3)],\n+          [gcc_cv_cloog_ct_0_14_0=yes],\n+          [gcc_cv_cloog_ct_0_14_0=no])])\n+    elif test \"${cloog_org}\" = no ; then\n+      AC_CACHE_CHECK([for version 0.15.5 (or later revision) of CLooG],\n+        [gcc_cv_cloog_ct_0_15_5],\n+        [AC_COMPILE_IFELSE([_CLOOG_CHECK_CT_PROG(0,15,5)],\n+          [AC_COMPILE_IFELSE([_CLOOG_CHECK_CT_PROG(0,15,9)],\n+           [gcc_cv_cloog_ct_0_15_5=yes],\n+            [gcc_cv_cloog_ct_0_15_5=\"buggy but acceptable\"])],\n+          [gcc_cv_cloog_ct_0_15_5=no])])\n+    fi\n+\n+    CFLAGS=$_cloog_saved_CFLAGS\n+    LDFLAGS=$_cloog_saved_LDFLAGS\n+  fi\n+]\n+)\n+\n+# CLOOG_IF_FAILED (ACTION-IF-FAILED)\n+# ----------------------------------\n+# Executes ACTION-IF-FAILED, if GRAPHITE was requested and\n+# the checks failed.\n+AC_DEFUN([CLOOG_IF_FAILED],\n+[\n+  CLOOG_REQUESTED([graphite_requested=yes], [graphite_requested=no])\n+  \n+  if test \"${gcc_cv_cloog_ct_0_14_0}\" = no \\\n+    || test \"${gcc_cv_cloog_rt_0_14_0}\" = no \\\n+    || test \"${gcc_cv_cloog_ct_0_15_5}\" = no; then\n+    clooglibs=\n+    clooginc=\n+  fi\n+\n+  if test \"${graphite_requested}\" = yes \\\n+    && test \"x${clooglibs}\" = x \\\n+    && test \"x${clooginc}\" = x ; then\n+    $1\n+  fi\n+]\n+)"}, {"sha": "04b930d618f4a1422faa4c95f41cbcc1e37843b4", "filename": "configure", "status": "modified", "additions": 245, "deletions": 56, "changes": 301, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d32ef397c98b50171cb13eb0421ace2479368eec/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d32ef397c98b50171cb13eb0421ace2479368eec/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=d32ef397c98b50171cb13eb0421ace2479368eec", "patch": "@@ -1451,7 +1451,8 @@ Optional Features:\n   --enable-libssp         build libssp directory\n   --enable-build-with-cxx build with C++ compiler instead of C compiler\n   --disable-ppl-version-check    disable check for PPL version\n-  --disable-cloog-version-check  disable check for CLooG version\n+  --disable-cloog-version-check\n+                          disable check for CLooG version\n   --enable-lto            enable link time optimization support\n   --enable-stage1-languages[=all]   choose additional languages to build during\n                           stage1.  Mostly useful for compiler development.\n@@ -1502,11 +1503,14 @@ Optional Packages:\n                           plus --with-ppl-lib=PATH/lib\n   --with-ppl-include=PATH Specify directory for installed PPL include files\n   --with-ppl-lib=PATH     Specify the directory for the installed PPL library\n-  --with-cloog=PATH       Specify prefix directory for the installed CLooG-PPL package\n-                          Equivalent to --with-cloog-include=PATH/include\n-                          plus --with-cloog-lib=PATH/lib\n-  --with-cloog-include=PATH Specify directory for installed CLooG include files\n-  --with-cloog-lib=PATH   Specify the directory for the installed CLooG library\n+  --with-cloog=PATH       Specify prefix directory for the installed CLooG-PPL\n+                          package. Equivalent to\n+                          --with-cloog-include=PATH/include plus\n+                          --with-cloog-lib=PATH/lib\n+  --with-cloog-include=PATH\n+                          Specify directory for installed CLooG include files\n+  --with-cloog-lib=PATH   Specify the directory for the installed CLooG\n+                          library\n   --with-build-sysroot=SYSROOT\n                           use sysroot as the system root during the build\n   --with-debug-prefix-map='A=B C=D ...'\n@@ -5651,8 +5655,7 @@ fi\n \n \n # Check for CLOOG\n-clooglibs=\" -lcloog \"\n-clooginc=\" -DCLOOG_PPL_BACKEND \"\n+\n \n \n # Check whether --with-cloog was given.\n@@ -5673,58 +5676,212 @@ if test \"${with_cloog_lib+set}\" = set; then :\n fi\n \n \n+  # Check whether --enable-cloog-version-check was given.\n+if test \"${enable_cloog_version_check+set}\" = set; then :\n+  enableval=$enable_cloog_version_check; ENABLE_CLOOG_CHECK=$enableval\n+else\n+  ENABLE_CLOOG_CHECK=yes\n+fi\n+\n+\n+  # Initialize clooglibs and clooginc.\n+  case $with_cloog in\n+    no)\n+      clooglibs=\n+      clooginc=\n+      ;;\n+    \"\" | yes)\n+      ;;\n+    *)\n+      clooglibs=\"-L$with_cloog/lib\"\n+      clooginc=\"-I$with_cloog/include\"\n+      ;;\n+  esac\n+  if test \"x${with_cloog_include}\" != x ; then\n+    clooginc=\"-I$with_cloog_include\"\n+  fi\n+  if test \"x${with_cloog_lib}\" != x; then\n+    clooglibs=\"-L$with_cloog_lib\"\n+  fi\n+\n+\n+\n+\n+\n if test \"x$with_ppl\" = \"xno\"; then\n   with_cloog=no\n fi\n+if test \"x${with_cloog}\" = x && test \"x${with_cloog_include}\" = x \\\n+  && test \"x${with_cloog_lib}\" = x && test -d ${srcdir}/cloog; then\n+  clooglibs='-L$$r/$(HOST_SUBDIR)/cloog/'\"$lt_cv_objdir\"' '\n+  clooginc='-I$$r/$(HOST_SUBDIR)/cloog/include -I$$s/cloog/include '\n+fi\n+if test \"x$with_cloog\" != \"xno\"; then\n \n-case $with_cloog in\n-  no)\n-    clooglibs=\n-    clooginc=\n-    ;;\n-  \"\" | yes)\n-    ;;\n-  *)\n-    clooglibs=\"-L$with_cloog/lib -lcloog\"\n-    clooginc=\"-I$with_cloog/include -DCLOOG_PPL_BACKEND \"\n-    ;;\n-esac\n-if test \"x$with_cloog_include\" != x; then\n-  clooginc=\"-I$with_cloog_include -DCLOOG_PPL_BACKEND \"\n+\n+\n+  _cloog_saved_CFLAGS=$CFLAGS\n+  _cloog_saved_CPPFLAGS=$CPPFLAGS\n+  _cloog_saved_LDFLAGS=$LDFLAGS\n+  _cloog_saved_LIBS=$LIBS\n+\n+  _clooglegacyinc=\"-DCLOOG_PPL_BACKEND\"\n+  _cloogorginc=\"-DCLOOG_INT_GMP -DCLOOG_ORG\"\n+\n+    CFLAGS=\"${CFLAGS} ${clooginc} ${pplinc} ${gmpinc}\"\n+  CPPFLAGS=\"${CPPFLAGS} ${_clooglegacyinc} ${_cloogorginc}\"\n+  LDFLAGS=\"${LDFLAGS} ${clooglibs}\"\n+\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for installed CLooG\" >&5\n+$as_echo_n \"checking for installed CLooG... \" >&6; }\n+if test \"${gcc_cv_cloog_type+set}\" = set; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  LIBS=\"-lcloog ${_cloog_saved_LIBS}\"\n+     cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <cloog/cloog.h>\n+int\n+main ()\n+{\n+ppl_version_major ()\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+  gcc_cv_cloog_type=\"PPL Legacy\"\n+else\n+  LIBS=\"-lcloog-isl -lisl ${_cloog_saved_LIBS}\"\n+       cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <cloog/cloog.h>\n+int\n+main ()\n+{\n+cloog_version ()\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+  gcc_cv_cloog_type=ISL\n+else\n+  LIBS=\"-lcloog-ppl ${_cloog_saved_LIBS}\"\n+         cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <cloog/cloog.h>\n+int\n+main ()\n+{\n+cloog_version ()\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+  gcc_cv_cloog_type=PPL\n+else\n+  gcc_cv_cloog_type=no\n fi\n-if test \"x$with_cloog_lib\" != x; then\n-  clooglibs=\"-L$with_cloog_lib -lcloog\"\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n fi\n-if test \"x$with_cloog$with_cloog_include$with_cloog_lib\" = x && test -d ${srcdir}/cloog; then\n-  clooglibs='-L$$r/$(HOST_SUBDIR)/cloog/'\"$lt_cv_objdir\"' -lcloog '\n-  clooginc='-I$$r/$(HOST_SUBDIR)/cloog/include -I$$s/cloog/include -DCLOOG_PPL_BACKEND '\n-  enable_cloog_version_check=no\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n fi\n-\n-# Check whether --enable-cloog-version-check was given.\n-if test \"${enable_cloog_version_check+set}\" = set; then :\n-  enableval=$enable_cloog_version_check; ENABLE_CLOOG_CHECK=$enableval\n-else\n-  ENABLE_CLOOG_CHECK=yes\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $gcc_cv_cloog_type\" >&5\n+$as_echo \"$gcc_cv_cloog_type\" >&6; }\n \n+  case $gcc_cv_cloog_type in\n+    \"PPL Legacy\")\n+      clooginc=\"${clooginc} ${_clooglegacyinc}\"\n+      clooglibs=\"${clooglibs} -lcloog\"\n+      cloog_org=no\n+      ;;\n+    \"ISL\")\n+      clooginc=\"${clooginc} ${_cloogorginc}\"\n+      clooglibs=\"${clooglibs} -lcloog-isl\"\n+      cloog_org=yes\n+      ;;\n+    \"PPL\")\n+      clooginc=\"${clooginc} ${_cloogorginc}\"\n+      clooglibs=\"${clooglibs} -lcloog-ppl\"\n+      cloog_org=yes\n+      ;;\n+    *)\n+      clooglibs=\n+      clooginc=\n+      cloog_org=\n+      ;;\n+  esac\n \n-if test \"x$with_cloog\" != \"xno\" -a \"${ENABLE_CLOOG_CHECK}\" = \"yes\"; then\n-  saved_CFLAGS=\"$CFLAGS\"\n-  CFLAGS=\"$CFLAGS $clooginc $gmpinc $pplinc\"\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for version 0.15.5 (or later revision) of CLooG\" >&5\n+  LIBS=$_cloog_saved_LIBS\n+  CFLAGS=$_cloog_saved_CFLAGS\n+  CPPFLAGS=$_cloog_saved_CPPFLAGS\n+  LDFLAGS=$_cloog_saved_LDFLAGS\n+\n+\n+\n+\n+\n+  if test \"${ENABLE_CLOOG_CHECK}\" = yes ; then\n+    _cloog_saved_CFLAGS=$CFLAGS\n+    _cloog_saved_LDFLAGS=$LDFLAGS\n+\n+    CFLAGS=\"${_cloog_saved_CFLAGS} ${clooginc} ${pplinc} ${gmpinc}\"\n+    LDFLAGS=\"${_cloog_saved_LDFLAGS} ${clooglibs}\"\n+\n+    if test \"${cloog_org}\" = yes ; then\n+      { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for verison 0.14.0 of CLooG\" >&5\n+$as_echo_n \"checking for verison 0.14.0 of CLooG... \" >&6; }\n+if test \"${gcc_cv_cloog_ct_0_14_0+set}\" = set; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include \"cloog/cloog.h\"\n+int\n+main ()\n+{\n+#if CLOOG_VERSION_MAJOR != 0 \\\n+    || CLOOG_VERSION_MINOR != 14 \\\n+    || CLOOG_VERSION_REVISION < 0\n+    choke me\n+   #endif\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_compile \"$LINENO\"; then :\n+  gcc_cv_cloog_ct_0_14_0=yes\n+else\n+  gcc_cv_cloog_ct_0_14_0=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $gcc_cv_cloog_ct_0_14_0\" >&5\n+$as_echo \"$gcc_cv_cloog_ct_0_14_0\" >&6; }\n+    elif test \"${cloog_org}\" = no ; then\n+      { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for version 0.15.5 (or later revision) of CLooG\" >&5\n $as_echo_n \"checking for version 0.15.5 (or later revision) of CLooG... \" >&6; }\n+if test \"${gcc_cv_cloog_ct_0_15_5+set}\" = set; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n   cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n /* end confdefs.h.  */\n #include \"cloog/cloog.h\"\n int\n main ()\n {\n-\n-  #if CLOOG_VERSION_MAJOR != 0 || CLOOG_VERSION_MINOR != 15 || CLOOG_VERSION_REVISION < 5\n-  choke me\n-  #endif\n-\n+#if CLOOG_VERSION_MAJOR != 0 \\\n+    || CLOOG_VERSION_MINOR != 15 \\\n+    || CLOOG_VERSION_REVISION < 5\n+    choke me\n+   #endif\n   ;\n   return 0;\n }\n@@ -5736,35 +5893,67 @@ if ac_fn_c_try_compile \"$LINENO\"; then :\n int\n main ()\n {\n-\n-  #if CLOOG_VERSION_MAJOR != 0 || CLOOG_VERSION_MINOR != 15 || CLOOG_VERSION_REVISION < 9\n-  choke me\n-  #endif\n-\n+#if CLOOG_VERSION_MAJOR != 0 \\\n+    || CLOOG_VERSION_MINOR != 15 \\\n+    || CLOOG_VERSION_REVISION < 9\n+    choke me\n+   #endif\n   ;\n   return 0;\n }\n _ACEOF\n if ac_fn_c_try_compile \"$LINENO\"; then :\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\n-$as_echo \"yes\" >&6; }\n+  gcc_cv_cloog_ct_0_15_5=yes\n else\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: buggy but acceptable\" >&5\n-$as_echo \"buggy but acceptable\" >&6; }\n+  gcc_cv_cloog_ct_0_15_5=\"buggy but acceptable\"\n fi\n rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n else\n-  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n-$as_echo \"no\" >&6; }; clooglibs= ; clooginc=\n+  gcc_cv_cloog_ct_0_15_5=no\n fi\n rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n-  CFLAGS=\"$saved_CFLAGS\"\n fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $gcc_cv_cloog_ct_0_15_5\" >&5\n+$as_echo \"$gcc_cv_cloog_ct_0_15_5\" >&6; }\n+    fi\n+\n+    CFLAGS=$_cloog_saved_CFLAGS\n+    LDFLAGS=$_cloog_saved_LDFLAGS\n+  fi\n \n-# Flags needed for CLOOG\n \n \n \n+\n+\n+\n+  if test \"x${with_cloog}\" != x \\\n+    || test \"x${with_cloog_include}\" != x \\\n+    || test \"x${with_cloog_lib}\" != x ; then\n+    graphite_requested=yes\n+  else\n+    graphite_requested=no\n+  fi\n+\n+\n+\n+  if test \"${gcc_cv_cloog_ct_0_14_0}\" = no \\\n+    || test \"${gcc_cv_cloog_rt_0_14_0}\" = no \\\n+    || test \"${gcc_cv_cloog_ct_0_15_5}\" = no; then\n+    clooglibs=\n+    clooginc=\n+  fi\n+\n+  if test \"${graphite_requested}\" = yes \\\n+    && test \"x${clooglibs}\" = x \\\n+    && test \"x${clooginc}\" = x ; then\n+\n+    as_fn_error \"Unable to find a usable CLooG. See config.log for details.\" \"$LINENO\" 5\n+  fi\n+\n+\n+fi\n+\n # Check for LTO support.\n # Check whether --enable-lto was given.\n if test \"${enable_lto+set}\" = set; then :"}, {"sha": "50c9aee1d5373b5754166851a96ce497a97ad925", "filename": "configure.ac", "status": "modified", "additions": 27, "deletions": 56, "changes": 83, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d32ef397c98b50171cb13eb0421ace2479368eec/configure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d32ef397c98b50171cb13eb0421ace2479368eec/configure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.ac?ref=d32ef397c98b50171cb13eb0421ace2479368eec", "patch": "@@ -28,6 +28,7 @@ m4_include([ltoptions.m4])\n m4_include([ltsugar.m4])\n m4_include([ltversion.m4])\n m4_include([lt~obsolete.m4])\n+m4_include([config/cloog.m4])\n \n AC_INIT(move-if-change)\n AC_PREREQ(2.64)\n@@ -1587,68 +1588,38 @@ AC_SUBST(pplinc)\n \n \n # Check for CLOOG\n-clooglibs=\" -lcloog \"\n-clooginc=\" -DCLOOG_PPL_BACKEND \"\n-\n-AC_ARG_WITH(cloog, [  --with-cloog=PATH       Specify prefix directory for the installed CLooG-PPL package\n-                          Equivalent to --with-cloog-include=PATH/include\n-                          plus --with-cloog-lib=PATH/lib])\n-AC_ARG_WITH(cloog_include, [  --with-cloog-include=PATH Specify directory for installed CLooG include files])\n-AC_ARG_WITH(cloog_lib, [  --with-cloog-lib=PATH   Specify the directory for the installed CLooG library])\n \n+dnl Provide configure switches and initialize clooginc & clooglibs\n+dnl with user input.\n+CLOOG_INIT_FLAGS\n if test \"x$with_ppl\" = \"xno\"; then\n   with_cloog=no\n fi\n-\n-case $with_cloog in \n-  no)\n-    clooglibs=\n-    clooginc=\n-    ;;\n-  \"\" | yes)\n-    ;;\n-  *)\n-    clooglibs=\"-L$with_cloog/lib -lcloog\"\n-    clooginc=\"-I$with_cloog/include -DCLOOG_PPL_BACKEND \"\n-    ;;\n-esac\n-if test \"x$with_cloog_include\" != x; then\n-  clooginc=\"-I$with_cloog_include -DCLOOG_PPL_BACKEND \"\n+if test \"x${with_cloog}\" = x && test \"x${with_cloog_include}\" = x \\\n+  && test \"x${with_cloog_lib}\" = x && test -d ${srcdir}/cloog; then\n+  clooglibs='-L$$r/$(HOST_SUBDIR)/cloog/'\"$lt_cv_objdir\"' '\n+  clooginc='-I$$r/$(HOST_SUBDIR)/cloog/include -I$$s/cloog/include '\n fi\n-if test \"x$with_cloog_lib\" != x; then\n-  clooglibs=\"-L$with_cloog_lib -lcloog\"\n+if test \"x$with_cloog\" != \"xno\"; then\n+  dnl Version check for CLooG-Org\n+  dnl As long as there is no new release of CLooG,\n+  dnl we will check for 0.14.0.\n+  dnl\n+  dnl The first git revision that will work with\n+  dnl GCC is: bd91b845a65805c290d43fc1bef8139864a163fb\n+  dnl This is enforced implictly, as this is the commit that\n+  dnl introduced the versioning information used within our\n+  dnl checks.\n+  dnl\n+  dnl If we're using CLooG-Legacy, the provided version information\n+  dnl will be ignored.\n+  CLOOG_CHECK_VERSION(0,14,0)\n+\n+  dnl Only execute fail-action, if CLooG has been\n+  dnl requested.\n+  CLOOG_IF_FAILED([\n+    AC_MSG_ERROR([Unable to find a usable CLooG. See config.log for details.])])\n fi\n-if test \"x$with_cloog$with_cloog_include$with_cloog_lib\" = x && test -d ${srcdir}/cloog; then\n-  clooglibs='-L$$r/$(HOST_SUBDIR)/cloog/'\"$lt_cv_objdir\"' -lcloog '\n-  clooginc='-I$$r/$(HOST_SUBDIR)/cloog/include -I$$s/cloog/include -DCLOOG_PPL_BACKEND '\n-  enable_cloog_version_check=no\n-fi\n-\n-AC_ARG_ENABLE(cloog-version-check,\n-[  --disable-cloog-version-check  disable check for CLooG version],\n-ENABLE_CLOOG_CHECK=$enableval,\n-ENABLE_CLOOG_CHECK=yes)\n-\n-if test \"x$with_cloog\" != \"xno\" -a \"${ENABLE_CLOOG_CHECK}\" = \"yes\"; then\n-  saved_CFLAGS=\"$CFLAGS\"\n-  CFLAGS=\"$CFLAGS $clooginc $gmpinc $pplinc\"\n-  AC_MSG_CHECKING([for version 0.15.5 (or later revision) of CLooG])\n-  AC_TRY_COMPILE([#include \"cloog/cloog.h\"],[\n-  #if CLOOG_VERSION_MAJOR != 0 || CLOOG_VERSION_MINOR != 15 || CLOOG_VERSION_REVISION < 5\n-  choke me\n-  #endif\n-  ], [AC_TRY_COMPILE([#include \"cloog/cloog.h\"],[\n-  #if CLOOG_VERSION_MAJOR != 0 || CLOOG_VERSION_MINOR != 15 || CLOOG_VERSION_REVISION < 9\n-  choke me\n-  #endif\n-  ], [AC_MSG_RESULT([yes])], [AC_MSG_RESULT([buggy but acceptable])])],\n-  [AC_MSG_RESULT([no]); clooglibs= ; clooginc= ])\n-  CFLAGS=\"$saved_CFLAGS\"\n-fi\n-\n-# Flags needed for CLOOG\n-AC_SUBST(clooglibs)\n-AC_SUBST(clooginc)\n \n # Check for LTO support.\n AC_ARG_ENABLE(lto,"}]}