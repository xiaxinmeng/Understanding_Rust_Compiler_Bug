{"sha": "985a72168a64267df8ad4c73337b3f678787174e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTg1YTcyMTY4YTY0MjY3ZGY4YWQ0YzczMzM3YjNmNjc4Nzg3MTc0ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-03-16T21:18:49Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-03-16T21:18:49Z"}, "message": "re PR fortran/89724 (Fortran diagnostics give wrong line number because of math-vector-fortran.h header file)\n\n\tPR fortran/89724\n\t* scanner.c (load_line): Remove linenum and current_line static\n\tvariables, add warned_tabs automatic variable.  Use current_file->line\n\tinstead of current_line and warned_tabs boolean to avoid diagnosing\n\ttabs multiple times on the same line.\n\n\t* gfortran.dg/continuation_15.f90: New test.\n\t* gfortran.dg/continuation_16.f90: New test.\n\nFrom-SVN: r269734", "tree": {"sha": "0369523f0acf587871766814d44fbe1aedb85986", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0369523f0acf587871766814d44fbe1aedb85986"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/985a72168a64267df8ad4c73337b3f678787174e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/985a72168a64267df8ad4c73337b3f678787174e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/985a72168a64267df8ad4c73337b3f678787174e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/985a72168a64267df8ad4c73337b3f678787174e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0581f5b2ad38ddee2b7de73b0e0efa101d60183a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0581f5b2ad38ddee2b7de73b0e0efa101d60183a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0581f5b2ad38ddee2b7de73b0e0efa101d60183a"}], "stats": {"total": 46, "additions": 39, "deletions": 7}, "files": [{"sha": "762da701b001b29fa2b5ca945abc014606e99ce0", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=985a72168a64267df8ad4c73337b3f678787174e", "patch": "@@ -1,3 +1,11 @@\n+2019-03-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/89724\n+\t* scanner.c (load_line): Remove linenum and current_line static\n+\tvariables, add warned_tabs automatic variable.  Use current_file->line\n+\tinstead of current_line and warned_tabs boolean to avoid diagnosing\n+\ttabs multiple times on the same line.\n+\n 2019-03-16  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/84394"}, {"sha": "e54d483baff1cf92cd9b1996f6e98f947217a36f", "filename": "gcc/fortran/scanner.c", "status": "modified", "additions": 6, "deletions": 7, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ffortran%2Fscanner.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ffortran%2Fscanner.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fscanner.c?ref=985a72168a64267df8ad4c73337b3f678787174e", "patch": "@@ -1738,12 +1738,12 @@ gfc_gobble_whitespace (void)\n static int\n load_line (FILE *input, gfc_char_t **pbuf, int *pbuflen, const int *first_char)\n {\n-  static int linenum = 0, current_line = 1;\n   int c, maxlen, i, preprocessor_flag, buflen = *pbuflen;\n   int trunc_flag = 0, seen_comment = 0;\n   int seen_printable = 0, seen_ampersand = 0, quoted = ' ';\n   gfc_char_t *buffer;\n   bool found_tab = false;\n+  bool warned_tabs = false;\n \n   /* Determine the maximum allowed line length.  */\n   if (gfc_current_form == FORM_FREE)\n@@ -1793,10 +1793,10 @@ load_line (FILE *input, gfc_char_t **pbuf, int *pbuflen, const int *first_char)\n \t    {\n \t      if (pedantic)\n \t\tgfc_error_now (\"%<&%> not allowed by itself in line %d\",\n-\t\t\t       current_line);\n+\t\t\t       current_file->line);\n \t      else\n \t\tgfc_warning_now (0, \"%<&%> not allowed by itself in line %d\",\n-\t\t\t\t current_line);\n+\t\t\t\t current_file->line);\n \t    }\n \t  break;\n \t}\n@@ -1850,12 +1850,12 @@ load_line (FILE *input, gfc_char_t **pbuf, int *pbuflen, const int *first_char)\n \t{\n \t  found_tab = true;\n \n-\t  if (warn_tabs && seen_comment == 0 && current_line != linenum)\n+\t  if (warn_tabs && seen_comment == 0 && !warned_tabs)\n \t    {\n-\t      linenum = current_line;\n+\t      warned_tabs = true;\n \t      gfc_warning_now (OPT_Wtabs,\n \t\t\t       \"Nonconforming tab character in column %d \"\n-\t\t\t       \"of line %d\", i+1, linenum);\n+\t\t\t       \"of line %d\", i + 1, current_file->line);\n \t    }\n \n \t  while (i < 6)\n@@ -1934,7 +1934,6 @@ load_line (FILE *input, gfc_char_t **pbuf, int *pbuflen, const int *first_char)\n \n   *buffer = '\\0';\n   *pbuflen = buflen;\n-  current_line++;\n \n   return trunc_flag;\n }"}, {"sha": "905791df7cb671e4ed29bb72b71fa873a1f96b2d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=985a72168a64267df8ad4c73337b3f678787174e", "patch": "@@ -1,3 +1,9 @@\n+2019-03-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/89724\n+\t* gfortran.dg/continuation_15.f90: New test.\n+\t* gfortran.dg/continuation_16.f90: New test.\n+\n 2019-03-16  John David Anglin  <danglin@gcc.gnu.org>\n \n \t* g++.dg/cpp0x/pr84497.C: Restore dg-require-weak."}, {"sha": "ad9dc6581686645f927a0d55d6ed47b47d23e895", "filename": "gcc/testsuite/gfortran.dg/continuation_15.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontinuation_15.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontinuation_15.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontinuation_15.f90?ref=985a72168a64267df8ad4c73337b3f678787174e", "patch": "@@ -0,0 +1,9 @@\n+! PR fortran/89724\n+! { dg-do compile }\n+! { dg-options \"-std=f95\" }\n+\n+include 'continuation_9.f90'\n+\n+! { dg-warning \"not allowed by itself in line 3\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"not allowed by itself in line 4\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"not allowed by itself in line 5\" \"\" { target *-*-* } 0 }"}, {"sha": "56d2bbee0bbff2e63cf97034d53bea8093682864", "filename": "gcc/testsuite/gfortran.dg/continuation_16.f90", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontinuation_16.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/985a72168a64267df8ad4c73337b3f678787174e/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontinuation_16.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcontinuation_16.f90?ref=985a72168a64267df8ad4c73337b3f678787174e", "patch": "@@ -0,0 +1,10 @@\n+! PR fortran/89724\n+! { dg-do compile }\n+! { dg-options \"-std=f95 -nostdinc -fpre-include=simd-builtins-1.h\" }\n+  &  \n+&\n+ &\n+end\n+! { dg-warning \"not allowed by itself in line 4\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"not allowed by itself in line 5\" \"\" { target *-*-* } 0 }\n+! { dg-warning \"not allowed by itself in line 6\" \"\" { target *-*-* } 0 }"}]}