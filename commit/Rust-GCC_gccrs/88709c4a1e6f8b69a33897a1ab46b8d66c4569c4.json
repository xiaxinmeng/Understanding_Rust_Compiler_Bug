{"sha": "88709c4a1e6f8b69a33897a1ab46b8d66c4569c4", "node_id": "C_kwDOANBUbNoAKDg4NzA5YzRhMWU2ZjhiNjlhMzM4OTdhMWFiNDZiOGQ2NmM0NTY5YzQ", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-12-21T08:10:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-12-21T08:17:48Z"}, "message": "modula2: Fix lto profiledbootstrap on powerpc64le-linux and s390x-linux [PR108153]\n\nLto profiledbootstrap was failing for me on {powerpc64le,s390x}-linux with\nmodula 2 enabled, with:\ncc1gm2: internal compiler error: the location value is corrupt\n0x11a3d2d m2assert_AssertLocation(unsigned int)\n\t../../gcc/m2/gm2-gcc/m2assert.cc:40\n0x11a3d2d m2statement_BuildAssignmentTree\n\t../../gcc/m2/gm2-gcc/m2statement.cc:177\nICE.  The problem was that caller (m2assert_AssertLocation used\nlocation_t M2Options_OverrideLocation (location_t);\nprototype with the libcpp/line-map.h\ntypedef unsigned int location_t;\ntypedef, but the callee defined in Modula 2 was using:\nTYPE\n   location_t = INTEGER ;\nand\nPROCEDURE OverrideLocation (location: location_t) : location_t ;\nNow, on powerpc64le-linux unsigned int is returned and passed zero extended\ninto 64-bits, while signed int is returned and passed sign-extended into 64-bits\nand Modula 2 INTEGER is signed 32-bit type, so when the caller then compared\nM2Options_OverrideLocation (location) != location\nand powerpc64le-linux performed the comparison as 64-bit compare, there\nwas a mismatch for location_t of 0x8000007 or others with the MSB set.\n\nFixed by making Modula 2 location_t a CARDINAL, which is 32-bit unsigned type.\n\n2022-12-21  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR modula2/108153\n\t* gm2-gcc/m2linemap.def (location_t): Use CARDINAL instead of INTEGER.", "tree": {"sha": "8429d7fc8424bfdddaef1f354fa2c549d27ca15a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8429d7fc8424bfdddaef1f354fa2c549d27ca15a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88709c4a1e6f8b69a33897a1ab46b8d66c4569c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88709c4a1e6f8b69a33897a1ab46b8d66c4569c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88709c4a1e6f8b69a33897a1ab46b8d66c4569c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88709c4a1e6f8b69a33897a1ab46b8d66c4569c4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "af49fd41abcb0bcbdf7db39ef6b87df2a79b0e45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af49fd41abcb0bcbdf7db39ef6b87df2a79b0e45", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af49fd41abcb0bcbdf7db39ef6b87df2a79b0e45"}], "stats": {"total": 2, "additions": 1, "deletions": 1}, "files": [{"sha": "f4c17b5677bcf56734095f15c83a06e37ecd5faa", "filename": "gcc/m2/gm2-gcc/m2linemap.def", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88709c4a1e6f8b69a33897a1ab46b8d66c4569c4/gcc%2Fm2%2Fgm2-gcc%2Fm2linemap.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88709c4a1e6f8b69a33897a1ab46b8d66c4569c4/gcc%2Fm2%2Fgm2-gcc%2Fm2linemap.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-gcc%2Fm2linemap.def?ref=88709c4a1e6f8b69a33897a1ab46b8d66c4569c4", "patch": "@@ -30,7 +30,7 @@ EXPORT QUALIFIED StartFile, EndFile, StartLine, GetLocationColumn, GetLocationRa\n                  WarningAtf, NoteAtf, internal_error, location_t ;\n \n TYPE\n-   location_t = INTEGER ;\n+   location_t = CARDINAL ;\n \n \n PROCEDURE StartFile (filename: ADDRESS; linebegin: CARDINAL) ;"}]}