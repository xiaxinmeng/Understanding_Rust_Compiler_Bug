{"sha": "d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg5ODdhZGIyOWI2ZDk4YzkyM2Q5M2ZjYzI5YWI0ZDhkNDdlOGExYQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2005-01-06T15:22:11Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2005-01-06T15:22:11Z"}, "message": "re PR c++/19270 (ice on valid template code)\n\ncp:\n\tPR c++/19270\n\t* pt.c (tsubst_copy) <ARRAY_REF case>: Handle separately.\n\t(tsubst_copy_and_build) <ARRAY_REF case>: Remove obsolete\n\tarray-new handling code.  Use build_x_binary_op.\ntestsuite:\n\tPR c++/19270\n\t* g++.dg/template/array10.C: New.\n\nFrom-SVN: r92992", "tree": {"sha": "2d74b6ffa665ac63661c4f1445afe2b590ad5c6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d74b6ffa665ac63661c4f1445afe2b590ad5c6b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/comments", "author": null, "committer": null, "parents": [{"sha": "9acf766fe1b9fbdda3e7997f408912bfccfaf5fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9acf766fe1b9fbdda3e7997f408912bfccfaf5fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9acf766fe1b9fbdda3e7997f408912bfccfaf5fd"}], "stats": {"total": 55, "additions": 42, "deletions": 13}, "files": [{"sha": "fb98595db1fb05a90704b3b45be2839c286d8d53", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "patch": "@@ -1,3 +1,10 @@\n+2005-01-06  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/19270\n+\t* pt.c (tsubst_copy) <ARRAY_REF case>: Handle separately.\n+\t(tsubst_copy_and_build) <ARRAY_REF case>: Remove obsolete\n+\tarray-new handling code.  Use build_x_binary_op.\n+\n 2005-01-05  Nathan Sidwell  <nathan@codesourcery.com>\n \n \tPR c++/19030"}, {"sha": "e6f4b51098f364a31e593425e8701cf0c57c8462", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 10, "deletions": 13, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "patch": "@@ -7869,7 +7869,6 @@ tsubst_copy (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n     case GE_EXPR:\n     case LT_EXPR:\n     case GT_EXPR:\n-    case ARRAY_REF:\n     case COMPOUND_EXPR:\n     case SCOPE_REF:\n     case DOTSTAR_EXPR:\n@@ -7882,6 +7881,13 @@ tsubst_copy (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \t(code, tsubst_copy (TREE_OPERAND (t, 0), args, complain, in_decl),\n \t tsubst_copy (TREE_OPERAND (t, 1), args, complain, in_decl));\n \n+    case ARRAY_REF:\n+      return build_nt\n+\t(ARRAY_REF,\n+\t tsubst_copy (TREE_OPERAND (t, 0), args, complain, in_decl),\n+\t tsubst_copy (TREE_OPERAND (t, 1), args, complain, in_decl),\n+\t NULL_TREE, NULL_TREE);\n+\n     case CALL_EXPR:\n       return build_nt (code, \n \t\t       tsubst_copy (TREE_OPERAND (t, 0), args,\n@@ -8526,21 +8532,12 @@ tsubst_copy_and_build (tree t,\n     case SCOPE_REF:\n       return tsubst_qualified_id (t, args, complain, in_decl, /*done=*/true,\n \t\t\t\t  /*address_p=*/false);\n-\n     case ARRAY_REF:\n-      if (tsubst_copy (TREE_OPERAND (t, 0), args, complain, in_decl)\n-\t  == NULL_TREE)\n-\t/* new-type-id */\n-\treturn build_nt (ARRAY_REF, NULL_TREE, RECUR (TREE_OPERAND (t, 1)),\n-\t\t\t NULL_TREE, NULL_TREE);\n-\n       op1 = tsubst_non_call_postfix_expression (TREE_OPERAND (t, 0),\n \t\t\t\t\t\targs, complain, in_decl);\n-      /* Remember that there was a reference to this entity.  */\n-      if (DECL_P (op1))\n-\tmark_used (op1);\n-      return grok_array_decl (op1, RECUR (TREE_OPERAND (t, 1)));\n-\n+      return build_x_binary_op (ARRAY_REF, op1, RECUR (TREE_OPERAND (t, 1)),\n+\t\t\t\t/*overloaded_p=*/NULL);\n+      \n     case SIZEOF_EXPR:\n     case ALIGNOF_EXPR:\n       op1 = TREE_OPERAND (t, 0);"}, {"sha": "139d695f2ae0b23208d30eee74d8a9c998628b32", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "patch": "@@ -1,3 +1,8 @@\n+2005-01-06  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/19270\n+\t* g++.dg/template/array10.C: New.\n+\n 2005-01-05  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* g++.old-deja/g++.pt/asm1.C, g++.old-deja/g++.pt/asm2.C,"}, {"sha": "81aac84b0b7e86c4ecbcd020aa76fdad4a580116", "filename": "gcc/testsuite/g++.dg/template/array10.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Farray10.C?ref=d8987adb29b6d98c923d93fcc29ab4d8d47e8a1a", "patch": "@@ -0,0 +1,20 @@\n+// Copyright (C) 2005 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 5 Jan 2005 <nathan@codesourcery.com>\n+\n+// PR 19270: ICE\n+// Origin:  Ralf Wildenhues <Ralf.Wildenhues@gmx.de>\n+\n+template<class T> struct Vec {\n+  T* data;\n+  T& operator[](int i) const;\n+};\n+\n+template<class T> inline T& Vec<T>::operator[](int i) const\n+{\n+  return (&data[0])[i];\n+}\n+\n+inline double foo(Vec<double> v)\n+{\n+  return v[0];\n+}"}]}