{"sha": "59581da6977aeae5819b43ebdd1eed1ee7f0d514", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTk1ODFkYTY5NzdhZWFlNTgxOWI0M2ViZGQxZWVkMWVlN2YwZDUxNA==", "commit": {"author": {"name": "Mark Mitchell", "email": "mmitchell@usa.net", "date": "1998-04-01T16:27:24Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "1998-04-01T16:27:24Z"}, "message": "call.c (build_over_call): Do name resolution for default arguments of function templates in the scope of...\n\n\t* call.c (build_over_call): Do name resolution for default\n\targuments of function templates in the scope of the templates.\n\nFrom-SVN: r18932", "tree": {"sha": "1827084179aea726791cfee72adc008fb5569df5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1827084179aea726791cfee72adc008fb5569df5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/59581da6977aeae5819b43ebdd1eed1ee7f0d514", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59581da6977aeae5819b43ebdd1eed1ee7f0d514", "html_url": "https://github.com/Rust-GCC/gccrs/commit/59581da6977aeae5819b43ebdd1eed1ee7f0d514", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/59581da6977aeae5819b43ebdd1eed1ee7f0d514/comments", "author": null, "committer": null, "parents": [{"sha": "63959c221b111a8fd35f08b1f66831edf740c248", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63959c221b111a8fd35f08b1f66831edf740c248", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63959c221b111a8fd35f08b1f66831edf740c248"}], "stats": {"total": 60, "additions": 57, "deletions": 3}, "files": [{"sha": "7d96732b377836897b1ed4e894a6317452535890", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59581da6977aeae5819b43ebdd1eed1ee7f0d514/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59581da6977aeae5819b43ebdd1eed1ee7f0d514/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=59581da6977aeae5819b43ebdd1eed1ee7f0d514", "patch": "@@ -1,3 +1,8 @@\n+Wed Apr  1 14:58:35 1998  Mark Mitchell  <mmitchell@usa.net>\n+\n+\t* call.c (build_over_call): Do name resolution for default\n+\targuments of function templates in the scope of the templates.\n+\n Tue Mar 31 13:43:57 1998  Jeffrey A Law  (law@cygnus.com)\n \n \t* call.c: Include system.h.  Remove includes, declarations and"}, {"sha": "ab3e05ef196d16bdf93c44e1415d93a50ee1355f", "filename": "gcc/cp/call.c", "status": "modified", "additions": 20, "deletions": 3, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59581da6977aeae5819b43ebdd1eed1ee7f0d514/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59581da6977aeae5819b43ebdd1eed1ee7f0d514/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=59581da6977aeae5819b43ebdd1eed1ee7f0d514", "patch": "@@ -3220,9 +3220,26 @@ build_over_call (fn, convs, args, flags)\n       tree arg = TREE_PURPOSE (parm);\n \n       if (DECL_TEMPLATE_INFO (fn))\n-\t/* This came from a template.  Instantiate the default arg here,\n-\t   not in tsubst.  */\n-\targ = tsubst_expr (arg, DECL_TI_ARGS (fn), NULL_TREE);\n+\t{\n+\t  /* This came from a template.  Instantiate the default arg here,\n+\t     not in tsubst.  In the case of something like:\n+\n+\t       template <class T>\n+\t       struct S {\n+\t         static T t();\n+\t\t void f(T = t());\n+\t       };\n+\n+\t     we must be careful to do name lookup in the scope of\n+\t     S<T>, rather than in the current class.  */\n+\t  if (DECL_REAL_CONTEXT (fn))\n+\t    pushclass (DECL_REAL_CONTEXT (fn), 2);\n+\n+\t  arg = tsubst_expr (arg, DECL_TI_ARGS (fn), NULL_TREE);\n+\n+\t  if (DECL_REAL_CONTEXT (fn))\n+\t    popclass (0);\n+\t}\n       converted_args = expr_tree_cons\n \t(NULL_TREE, convert_default_arg (TREE_VALUE (parm), arg),\n \t converted_args);"}, {"sha": "9d5df8cf2a35b4eb64659e2a9128ffe1cb85c1f8", "filename": "gcc/testsuite/g++.old-deja/g++.pt/defarg4.C", "status": "added", "additions": 32, "deletions": 0, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/59581da6977aeae5819b43ebdd1eed1ee7f0d514/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fdefarg4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/59581da6977aeae5819b43ebdd1eed1ee7f0d514/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fdefarg4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fdefarg4.C?ref=59581da6977aeae5819b43ebdd1eed1ee7f0d514", "patch": "@@ -0,0 +1,32 @@\n+// Build don't link:\n+\n+template <class T>\n+struct S1\n+{\n+  void foo(T = t());\n+\n+  static T t();\n+};\n+\n+\n+template <class T>\n+struct S2\n+{\n+  void bar();\n+};\n+\n+\n+template <class T>\n+void S2<T>::bar ()\n+{\n+  S1<T> st;\n+  st.foo();\n+}\n+\n+\n+int main()\n+{\n+  S2<int> s2i;\n+  s2i.bar();\n+}\n+"}]}