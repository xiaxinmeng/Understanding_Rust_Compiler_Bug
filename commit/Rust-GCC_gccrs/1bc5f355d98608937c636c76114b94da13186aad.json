{"sha": "1bc5f355d98608937c636c76114b94da13186aad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWJjNWYzNTVkOTg2MDg5MzdjNjM2Yzc2MTE0Yjk0ZGExMzE4NmFhZA==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@cs.umass.edu", "date": "2005-05-06T14:24:20Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2005-05-06T14:24:20Z"}, "message": "decl2.c (ssdf_decls, [...]): Use VEC instead of VARRAY.\n\n\t* decl2.c (ssdf_decls, start_static_storage_duration_function,\n\tgenerate_ctor_or_dtor_function): Use VEC instead of VARRAY.\n\nFrom-SVN: r99319", "tree": {"sha": "9369b8a3e7d8dd6374bcd6c793996cc3a7ba8dfa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9369b8a3e7d8dd6374bcd6c793996cc3a7ba8dfa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1bc5f355d98608937c636c76114b94da13186aad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bc5f355d98608937c636c76114b94da13186aad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bc5f355d98608937c636c76114b94da13186aad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bc5f355d98608937c636c76114b94da13186aad/comments", "author": null, "committer": null, "parents": [{"sha": "6394d87daf07139cc3b60e42435a30e4af4d6f29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6394d87daf07139cc3b60e42435a30e4af4d6f29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6394d87daf07139cc3b60e42435a30e4af4d6f29"}], "stats": {"total": 46, "additions": 23, "deletions": 23}, "files": [{"sha": "35e9560f4f91aa5598099840a58c09f9015f6a2d", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bc5f355d98608937c636c76114b94da13186aad/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bc5f355d98608937c636c76114b94da13186aad/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1bc5f355d98608937c636c76114b94da13186aad", "patch": "@@ -2,6 +2,9 @@\n \n \t* decl2.c (spew_debug): Remove.\n \n+\t* decl2.c (ssdf_decls, start_static_storage_duration_function,\n+\tgenerate_ctor_or_dtor_function): Use VEC instead of VARRAY.\n+\n 2005-05-05  Kazu Hirata  <kazu@cs.umass.edu>\n \n \t* decl2.c (deferred_fns, note_vague_linkage_fn,"}, {"sha": "50a1ac700b4affe6b7e016ebf18b2f2ad5554b8c", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 20, "deletions": 23, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bc5f355d98608937c636c76114b94da13186aad/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bc5f355d98608937c636c76114b94da13186aad/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=1bc5f355d98608937c636c76114b94da13186aad", "patch": "@@ -2167,7 +2167,7 @@ static GTY(()) tree ssdf_decl;\n \n /* All the static storage duration functions created in this\n    translation unit.  */\n-static GTY(()) varray_type ssdf_decls;\n+static GTY(()) VEC(tree,gc) *ssdf_decls;\n \n /* A map from priority levels to information about that priority\n    level.  There may be many such levels, so efficient lookup is\n@@ -2215,7 +2215,7 @@ start_static_storage_duration_function (unsigned count)\n      static constructors and destructors.  */\n   if (!ssdf_decls)\n     {\n-      VARRAY_TREE_INIT (ssdf_decls, 32, \"ssdf_decls\");\n+      ssdf_decls = VEC_alloc (tree, gc, 32);\n \n       /* Take this opportunity to initialize the map from priority\n \t numbers to information about that priority level.  */\n@@ -2231,7 +2231,7 @@ start_static_storage_duration_function (unsigned count)\n       get_priority_info (DEFAULT_INIT_PRIORITY);\n     }\n \n-  VARRAY_PUSH_TREE (ssdf_decls, ssdf_decl);\n+  VEC_safe_push (tree, gc, ssdf_decls, ssdf_decl);\n \n   /* Create the argument list.  */\n   initialize_p_decl = cp_build_parm_decl\n@@ -2607,26 +2607,23 @@ generate_ctor_or_dtor_function (bool constructor_p, int priority,\n \n   /* Call the static storage duration function with appropriate\n      arguments.  */\n-  if (ssdf_decls)\n-    for (i = 0; i < ssdf_decls->elements_used; ++i) \n-      {\n-\tfndecl = VARRAY_TREE (ssdf_decls, i);\n-\n-\t/* Calls to pure or const functions will expand to nothing.  */\n-\tif (! (flags_from_decl_or_type (fndecl) & (ECF_CONST | ECF_PURE)))\n-\t  {\n-\t    if (! body)\n-\t      body = start_objects (function_key, priority);\n-\n-\t    arguments = tree_cons (NULL_TREE,\n-\t\t\t\t   build_int_cst (NULL_TREE, priority), \n-\t\t\t\t   NULL_TREE);\n-\t    arguments = tree_cons (NULL_TREE,\n-\t\t\t\t   build_int_cst (NULL_TREE, constructor_p),\n-\t\t\t\t   arguments);\n-\t    finish_expr_stmt (build_function_call (fndecl, arguments));\n-\t  }\n-      }\n+  for (i = 0; VEC_iterate (tree, ssdf_decls, i, fndecl); ++i) \n+    {\n+      /* Calls to pure or const functions will expand to nothing.  */\n+      if (! (flags_from_decl_or_type (fndecl) & (ECF_CONST | ECF_PURE)))\n+\t{\n+\t  if (! body)\n+\t    body = start_objects (function_key, priority);\n+\n+\t  arguments = tree_cons (NULL_TREE,\n+\t\t\t\t build_int_cst (NULL_TREE, priority), \n+\t\t\t\t NULL_TREE);\n+\t  arguments = tree_cons (NULL_TREE,\n+\t\t\t\t build_int_cst (NULL_TREE, constructor_p),\n+\t\t\t\t arguments);\n+\t  finish_expr_stmt (build_function_call (fndecl, arguments));\n+\t}\n+    }\n \n   /* If we're generating code for the DEFAULT_INIT_PRIORITY, throw in\n      calls to any functions marked with attributes indicating that"}]}