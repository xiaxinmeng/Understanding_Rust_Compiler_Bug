{"sha": "60b4ccde85cd8823678f3f424508fe19f9d302e4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjBiNGNjZGU4NWNkODgyMzY3OGYzZjQyNDUwOGZlMTlmOWQzMDJlNA==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@cs.umass.edu", "date": "2005-04-13T15:33:17Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2005-04-13T15:33:17Z"}, "message": "re PR tree-optimization/20913 (copy-prop does not fold conditionals)\n\ngcc/\n\tPR tree-optimization/20913\n\t* tree-ssa-copy.c (copy_prop_visit_cond_stmt): Fold COND_EXPR.\n\ntestsuite/\n\tPR tree-optimization/20913\n\t* gcc.dg/tree-ssa/pr20913.c: New.\n\nFrom-SVN: r98091", "tree": {"sha": "bbc563f0437c0a8340dd241f0a15f7d13ce82259", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bbc563f0437c0a8340dd241f0a15f7d13ce82259"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/60b4ccde85cd8823678f3f424508fe19f9d302e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60b4ccde85cd8823678f3f424508fe19f9d302e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/60b4ccde85cd8823678f3f424508fe19f9d302e4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60b4ccde85cd8823678f3f424508fe19f9d302e4/comments", "author": null, "committer": null, "parents": [{"sha": "9fb6cbd90e1a14cdacfa10af31317ddcd70af21f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9fb6cbd90e1a14cdacfa10af31317ddcd70af21f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9fb6cbd90e1a14cdacfa10af31317ddcd70af21f"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "1f484e004f7bbdf98a42d21c888c2eb56c18d1b7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=60b4ccde85cd8823678f3f424508fe19f9d302e4", "patch": "@@ -3,6 +3,10 @@\n \tPR tree-optimization/20913\n \t* tree-ssa-copy.c (copy_prop_visit_cond_stmt): Fold COND_EXPR.\n \n+\tPR tree-optimization/20702\n+\t* tree-vrp.c (maybe_add_assert_expr): Recurse into\n+\tdominator children that haven't been walked into.\n+\n 2005-04-13  Julian Brown  <julian@codesourcery.com>\n \n \t* config/elfos.h (MAKE_DECL_ONE_ONLY): Redefined to stop DECL_WEAK from"}, {"sha": "91ec4c82b34cc6d3ce15cb2bfc6313f48de913ab", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=60b4ccde85cd8823678f3f424508fe19f9d302e4", "patch": "@@ -3,6 +3,9 @@\n \tPR tree-optimization/20913\n \t* gcc.dg/tree-ssa/pr20913.c: New.\n \n+\tPR tree-optimization/20702\n+\t* gcc.dg/tree-ssa/pr20702.c: New.\n+\n 2005-04-13  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n \tPR c++/13744"}, {"sha": "c6f1ae6654f9e63fce3c9b191be4af9e5f052c76", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr20702.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr20702.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr20702.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr20702.c?ref=60b4ccde85cd8823678f3f424508fe19f9d302e4", "patch": "@@ -0,0 +1,28 @@\n+/* PR tree-optimization/20702\n+   VRP did not insert ASSERT_EXPRs into dominator dominator children\n+   of a basic block ending with COND_EXPR unless the children are also\n+   immediate successors of the basic block.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fno-tree-dominator-opts -fdump-tree-vrp-details\" } */\n+\n+extern void bar (int);\n+\n+int\n+foo (int *p, int b)\n+{\n+  int a;\n+\n+  if (b)\n+    bar (123);\n+  else\n+    bar (321);\n+\n+  a = *p;\n+  if (p == 0)\n+    return 0;\n+\n+  return a;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"Folding predicate\" 1 \"vrp\"} } */"}, {"sha": "e8f52bb72f40491d4c61f47a1de4db44924d5f04", "filename": "gcc/tree-vrp.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2Ftree-vrp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60b4ccde85cd8823678f3f424508fe19f9d302e4/gcc%2Ftree-vrp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vrp.c?ref=60b4ccde85cd8823678f3f424508fe19f9d302e4", "patch": "@@ -1500,6 +1500,7 @@ maybe_add_assert_expr (basic_block bb)\n       edge e;\n       edge_iterator ei;\n       tree op, cond;\n+      basic_block son;\n       \n       cond = COND_EXPR_COND (last);\n \n@@ -1554,6 +1555,17 @@ maybe_add_assert_expr (basic_block bb)\n \n       /* Finally, mark all the COND_EXPR operands as found.  */\n       SET_BIT (found, SSA_NAME_VERSION (op));\n+\n+      /* Recurse into the dominator children of BB that are not BB's\n+\t immediate successors.  Note that we have already visited BB's\n+\t other dominator children above.  */\n+      for (son = first_dom_son (CDI_DOMINATORS, bb);\n+\t   son;\n+\t   son = next_dom_son (CDI_DOMINATORS, son))\n+\t{\n+\t  if (find_edge (bb, son) == NULL)\n+\t    added |= maybe_add_assert_expr (son);\n+\t}\n     }\n   else\n     {"}]}