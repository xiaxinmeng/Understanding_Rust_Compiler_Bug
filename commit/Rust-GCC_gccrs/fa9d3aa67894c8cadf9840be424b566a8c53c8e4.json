{"sha": "fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "node_id": "C_kwDOANBUbNoAKGZhOWQzYWE2Nzg5NGM4Y2FkZjk4NDBiZTQyNGI1NjZhOGM1M2M4ZTQ", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2023-03-13T18:53:04Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2023-03-13T18:53:04Z"}, "message": "analyzer, testsuite: add test coverage for various builtins\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/analyzer/exec-1.c: New test.\n\t* gcc.dg/analyzer/snprintf-concat.c: New test.\n\t* gcc.dg/analyzer/vsnprintf-1.c: New test.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "41ca3fa4c13c36faf05328b9030d67096cbb222a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/41ca3fa4c13c36faf05328b9030d67096cbb222a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c981f61c071757f1f724fe7c3959622c13f079fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c981f61c071757f1f724fe7c3959622c13f079fa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c981f61c071757f1f724fe7c3959622c13f079fa"}], "stats": {"total": 89, "additions": 89, "deletions": 0}, "files": [{"sha": "6b71118bd54687746ae5f2073c727f20390a9c88", "filename": "gcc/testsuite/gcc.dg/analyzer/exec-1.c", "status": "added", "additions": 43, "deletions": 0, "changes": 43, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fexec-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fexec-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fexec-1.c?ref=fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "patch": "@@ -0,0 +1,43 @@\n+#define NULL ((void *)0)\n+\n+extern int execl(const char *pathname, const char *arg, ...);\n+extern int execlp(const char *file, const char *arg, ...);\n+extern int execle(const char *pathname, const char *arg, ...);\n+extern int execv(const char *pathname, char *const argv[]);\n+extern int execvp(const char *file, char *const argv[]);\n+extern int execvpe(const char *file, char *const argv[], char *const envp[]);\n+\n+int test_execl_ls_al ()\n+{\n+  return execl (\"/usr/bin/ls\", \"ls\", \"-al\", NULL);\n+}\n+\n+int test_execlpl_ls_al ()\n+{\n+  return execlp (\"ls\", \"ls\", \"-al\", NULL);\n+}\n+\n+int test_execle_ls_al ()\n+{\n+  const char *env[3] = {\"FOO=BAR\", \"BAZ\", NULL};\n+  return execl (\"/usr/bin/ls\", \"ls\", \"-al\", NULL, env);\n+}\n+\n+int test_execv_ls_al ()\n+{\n+  char *argv[3] = {\"ls\", \"-al\", NULL};\n+  return execv (\"/usr/bin/ls\", argv);\n+}\n+\n+int test_execvp_ls_al ()\n+{\n+  char *argv[3] = {\"ls\", \"-al\", NULL};\n+  return execvp (\"ls\", argv);\n+}\n+\n+int test_execvpe_ls_al ()\n+{\n+  char *env[3] = {\"FOO=BAR\", \"BAZ\", NULL};\n+  char *argv[3] = {\"ls\", \"-al\", NULL};\n+  return execvpe (\"ls\", argv, env);\n+}"}, {"sha": "a557dee6e4406f01f83a1ae36dd4e7185e652f10", "filename": "gcc/testsuite/gcc.dg/analyzer/snprintf-concat.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fsnprintf-concat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fsnprintf-concat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fsnprintf-concat.c?ref=fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "patch": "@@ -0,0 +1,35 @@\n+typedef __SIZE_TYPE__ size_t;\n+#define NULL ((void *)0)\n+\n+extern size_t\n+strlen(const char* __s) __attribute__((__nothrow__, __leaf__))\n+__attribute__((__pure__)) __attribute__((__nonnull__(1)));\n+\n+extern void*\n+malloc(size_t __size) __attribute__((__nothrow__, __leaf__))\n+__attribute__((__malloc__)) __attribute__((__alloc_size__(1)));\n+\n+extern int\n+snprintf(char* __restrict __s, size_t size, const char* __restrict, ...)\n+  __attribute__((__nothrow__));\n+\n+char *\n+test_1 (const char *a, const char *b)\n+{\n+  size_t sz = strlen (a) + strlen (b) + 2;\n+  char *p = malloc (sz);\n+  if (!p)\n+    return NULL;\n+  snprintf (p, sz, \"%s/%s\", a, b);\n+  return p;\n+}\n+\n+void\n+test_2 (const char *a, const char *b)\n+{\n+  size_t sz = strlen (a) + strlen (b) + 2;\n+  char *p = malloc (sz); /* { dg-message \"allocated here\" \"PR 107017\" { xfail *-*-* } } */\n+  if (!p)\n+    return;\n+  snprintf (p, sz, \"%s/%s\", a, b); /* { dg-warning \"leak of 'p'\" \"PR 107017\" { xfail *-*-* } } */\n+}"}, {"sha": "209c4b6cbb699f079d4a8162a34f23a082fe6983", "filename": "gcc/testsuite/gcc.dg/analyzer/vsnprintf-1.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fvsnprintf-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fa9d3aa67894c8cadf9840be424b566a8c53c8e4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fvsnprintf-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fvsnprintf-1.c?ref=fa9d3aa67894c8cadf9840be424b566a8c53c8e4", "patch": "@@ -0,0 +1,11 @@\n+typedef __SIZE_TYPE__ size_t;\n+\n+int\n+my_snprintf(char *pos, size_t left, const char *fmt, ...)\n+{\n+  __builtin_va_list ap;\n+  __builtin_va_start(ap, fmt);\n+  const int len = __builtin_vsnprintf(pos, left, fmt, ap);\n+  __builtin_va_end(ap);\n+  return len;\n+}"}]}