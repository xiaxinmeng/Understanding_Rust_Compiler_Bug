{"sha": "26d815a3e587ac04dbd63eec3fb5aecb04db7242", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjZkODE1YTNlNTg3YWMwNGRiZDYzZWVjM2ZiNWFlY2IwNGRiNzI0Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-09-11T08:34:41Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-09-11T08:34:41Z"}, "message": "re PR tree-optimization/91723 (builtin fma is not optimized or vectorized as *+)\n\n\tPR tree-optimization/91723\n\t* tree-vect-stmts.c (vectorizable_call): Use types_compatible_p check\n\tinstead of pointer equality when checking if argument vectypes are\n\tthe same.\n\n\t* gcc.dg/vect/vect-fma-3.c: New test.\n\nFrom-SVN: r275634", "tree": {"sha": "5b032c0adc701307f94217840e497ba3f0f66ffb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b032c0adc701307f94217840e497ba3f0f66ffb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/26d815a3e587ac04dbd63eec3fb5aecb04db7242", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26d815a3e587ac04dbd63eec3fb5aecb04db7242", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26d815a3e587ac04dbd63eec3fb5aecb04db7242", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26d815a3e587ac04dbd63eec3fb5aecb04db7242/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6d5093dad6a4927d23a914300605e76dd00c7a15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d5093dad6a4927d23a914300605e76dd00c7a15", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d5093dad6a4927d23a914300605e76dd00c7a15"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "33b43862051622bccbfb95fdbc5de4df43298188", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=26d815a3e587ac04dbd63eec3fb5aecb04db7242", "patch": "@@ -1,5 +1,10 @@\n 2019-09-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/91723\n+\t* tree-vect-stmts.c (vectorizable_call): Use types_compatible_p check\n+\tinstead of pointer equality when checking if argument vectypes are\n+\tthe same.\n+\n \tPR middle-end/91725\n \t* match.pd ((A / (1 << B)) -> (A >> B)): Call tree_nonzero_bits instead\n \tof get_nonzero_bits, only call it for integral types."}, {"sha": "d4488b6789c423a1f08f1d22bcf6b89445af058d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=26d815a3e587ac04dbd63eec3fb5aecb04db7242", "patch": "@@ -1,5 +1,8 @@\n 2019-09-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/91723\n+\t* gcc.dg/vect/vect-fma-3.c: New test.\n+\n \tPR middle-end/91725\n \t* gcc.c-torture/compile/pr91725.c: New test.\n "}, {"sha": "b231a328fa59ea3c6722ad28f01a2b19a0a16a00", "filename": "gcc/testsuite/gcc.dg/vect/vect-fma-3.c", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-fma-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-fma-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-fma-3.c?ref=26d815a3e587ac04dbd63eec3fb5aecb04db7242", "patch": "@@ -0,0 +1,17 @@\n+/* PR tree-optimization/91723 */\n+/* { dg-do compile { target { scalar_all_fma || { i?86-*-* x86_64-*-* } } } } */\n+/* { dg-additional-options \"-mfma\" { target { i?86-*-* x86_64-*-* } } } */\n+\n+void\n+foo (double *restrict r, const double *restrict a,\n+     const double *restrict b, const double *restrict c)\n+{\n+  for (int i = 0; i < 1024; i++)\n+    {\n+      double x = __builtin_fma (a[i], b[i], c[i]);\n+      x = __builtin_fma (a[i], b[i], x);\n+      r[i] = x;\n+    }\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"LOOP VECTORIZED\" 1 \"vect\" { target vect_double } } } */"}, {"sha": "edc7e0de4d3e3566ece216d83e1c2a09865e0556", "filename": "gcc/tree-vect-stmts.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2Ftree-vect-stmts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/26d815a3e587ac04dbd63eec3fb5aecb04db7242/gcc%2Ftree-vect-stmts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-stmts.c?ref=26d815a3e587ac04dbd63eec3fb5aecb04db7242", "patch": "@@ -3308,7 +3308,7 @@ vectorizable_call (stmt_vec_info stmt_info, gimple_stmt_iterator *gsi,\n       if (!vectype_in)\n \tvectype_in = vectypes[i];\n       else if (vectypes[i]\n-\t       && vectypes[i] != vectype_in)\n+\t       && !types_compatible_p (vectypes[i], vectype_in))\n \t{\n \t  if (dump_enabled_p ())\n \t    dump_printf_loc (MSG_MISSED_OPTIMIZATION, vect_location,"}]}