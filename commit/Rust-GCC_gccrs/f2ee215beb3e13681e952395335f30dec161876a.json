{"sha": "f2ee215beb3e13681e952395335f30dec161876a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjJlZTIxNWJlYjNlMTM2ODFlOTUyMzk1MzM1ZjMwZGVjMTYxODc2YQ==", "commit": {"author": {"name": "Brendan Kehoe", "email": "brendan@cygnus.com", "date": "1998-05-14T12:29:41Z"}, "committer": {"name": "Brendan Kehoe", "email": "brendan@gcc.gnu.org", "date": "1998-05-14T12:29:41Z"}, "message": "typeck.c (original_type): New function.\n\n\t* typeck.c (original_type): New function.\n\t(common_type): Use it to get the DECL_ORIGINAL_TYPE for T1 and T2,\n\tto see if they're actually the same.\n\t* cp-tree.h (original_type): Declare.\nfix problem when you have multiple identical typedefs\n\nFrom-SVN: r19744", "tree": {"sha": "b46d82143ac93832e81c471489654b32a8aaa020", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b46d82143ac93832e81c471489654b32a8aaa020"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f2ee215beb3e13681e952395335f30dec161876a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2ee215beb3e13681e952395335f30dec161876a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2ee215beb3e13681e952395335f30dec161876a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2ee215beb3e13681e952395335f30dec161876a/comments", "author": null, "committer": null, "parents": [{"sha": "c02cdb7030f74dbc00ea23a6cb02ed929c100a82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c02cdb7030f74dbc00ea23a6cb02ed929c100a82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c02cdb7030f74dbc00ea23a6cb02ed929c100a82"}], "stats": {"total": 35, "additions": 33, "deletions": 2}, "files": [{"sha": "bdd7a16bcef86c94987aa6db4b5398a47a41e733", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2ee215beb3e13681e952395335f30dec161876a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2ee215beb3e13681e952395335f30dec161876a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f2ee215beb3e13681e952395335f30dec161876a", "patch": "@@ -1,3 +1,10 @@\n+Thu May 14 12:27:34 1998  Brendan Kehoe  <brendan@cygnus.com>\n+\n+\t* typeck.c (original_type): New function.\n+\t(common_type): Use it to get the DECL_ORIGINAL_TYPE for T1 and T2,\n+\tto see if they're actually the same.\n+\t* cp-tree.h (original_type): Declare.\n+\n Wed May 13 12:54:30 1998  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* Makefile.in (lex.o): Depend on output.h."}, {"sha": "17e3ac8020a71a330e8d69ab871b63d1541c6cd1", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2ee215beb3e13681e952395335f30dec161876a/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2ee215beb3e13681e952395335f30dec161876a/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=f2ee215beb3e13681e952395335f30dec161876a", "patch": "@@ -2760,6 +2760,7 @@ extern int type_unknown_p\t\t\tPROTO((tree));\n extern int fntype_p\t\t\t\tPROTO((tree));\n extern tree require_instantiated_type\t\tPROTO((tree, tree, tree));\n extern tree commonparms\t\t\t\tPROTO((tree, tree));\n+extern tree original_type\t\t\tPROTO((tree));\n extern tree common_type\t\t\t\tPROTO((tree, tree));\n extern int compexcepttypes\t\t\tPROTO((tree, tree));\n extern int comptypes\t\t\t\tPROTO((tree, tree, int));"}, {"sha": "481467f2772047f6f69ef8c73085704f45371cf4", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 25, "deletions": 2, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2ee215beb3e13681e952395335f30dec161876a/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2ee215beb3e13681e952395335f30dec161876a/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=f2ee215beb3e13681e952395335f30dec161876a", "patch": "@@ -292,6 +292,25 @@ commonparms (p1, p2)\n   return newargs;\n }\n \n+/* Given a type, perhaps copied for a typedef,\n+   find the \"original\" version of it.  */\n+tree\n+original_type (t)\n+     tree t;\n+{\n+  while (TYPE_NAME (t) != NULL_TREE)\n+    {\n+      tree x = TYPE_NAME (t);\n+      if (TREE_CODE (x) != TYPE_DECL)\n+\tbreak;\n+      x = DECL_ORIGINAL_TYPE (x);\n+      if (x == NULL_TREE)\n+\tbreak;\n+      t = x;\n+    }\n+  return t;\n+}\n+\n /* Return the common type of two types.\n    We assume that comptypes has already been done and returned 1;\n    if that isn't so, this may crash.\n@@ -311,8 +330,12 @@ common_type (t1, t2)\n   tree attributes;\n \n   /* Save time if the two types are the same.  */\n-\n-  if (t1 == t2) return t1;\n+  if (t1 == t2)\n+    return t1;\n+  t1 = original_type (t1);\n+  t2 = original_type (t2);\n+  if (t1 == t2)\n+    return t1;\n \n   /* If one type is nonsense, use the other.  */\n   if (t1 == error_mark_node)"}]}