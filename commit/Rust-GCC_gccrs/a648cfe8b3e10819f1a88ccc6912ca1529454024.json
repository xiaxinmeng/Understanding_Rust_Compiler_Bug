{"sha": "a648cfe8b3e10819f1a88ccc6912ca1529454024", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTY0OGNmZThiM2UxMDgxOWYxYTg4Y2NjNjkxMmNhMTUyOTQ1NDAyNA==", "commit": {"author": {"name": "Georg-Johann Lay", "email": "avr@gjlay.de", "date": "2011-07-04T12:48:04Z"}, "committer": {"name": "Georg-Johann Lay", "email": "gjl@gcc.gnu.org", "date": "2011-07-04T12:48:04Z"}, "message": "re PR target/34734 ([avr] attribute((progmem)) not handled properly in C++)\n\n\tPR target/34734\n\tPR target/44643\n\t* gcc.target/avr/avr.exp: Run over cpp files, too.\n\t* gcc.target/avr/torture/avr-torture.exp: Ditto.\n\t* gcc.target/avr/progmem.h: New file.\n\t* gcc.target/avr/exit-abort.h: New file.\n\t* gcc.target/avr/progmem-error-1.c: New file.\n\t* gcc.target/avr/progmem-error-1.cpp: New file.\n\t* gcc.target/avr/progmem-warning-1.c: New file.\n\t* gcc.target/avr/torture/progmem-1.c: New file.\n\t* gcc.target/avr/torture/progmem-1.cpp: New file.\n\nFrom-SVN: r175811", "tree": {"sha": "2cbe3891c85132880ac7daf51ebffe5758df74af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2cbe3891c85132880ac7daf51ebffe5758df74af"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a648cfe8b3e10819f1a88ccc6912ca1529454024", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a648cfe8b3e10819f1a88ccc6912ca1529454024", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a648cfe8b3e10819f1a88ccc6912ca1529454024", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a648cfe8b3e10819f1a88ccc6912ca1529454024/comments", "author": null, "committer": {"login": "sprintersb", "id": 8905355, "node_id": "MDQ6VXNlcjg5MDUzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8905355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sprintersb", "html_url": "https://github.com/sprintersb", "followers_url": "https://api.github.com/users/sprintersb/followers", "following_url": "https://api.github.com/users/sprintersb/following{/other_user}", "gists_url": "https://api.github.com/users/sprintersb/gists{/gist_id}", "starred_url": "https://api.github.com/users/sprintersb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sprintersb/subscriptions", "organizations_url": "https://api.github.com/users/sprintersb/orgs", "repos_url": "https://api.github.com/users/sprintersb/repos", "events_url": "https://api.github.com/users/sprintersb/events{/privacy}", "received_events_url": "https://api.github.com/users/sprintersb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "db297e20845c258a8c02eeab220027d9717a3cd3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db297e20845c258a8c02eeab220027d9717a3cd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db297e20845c258a8c02eeab220027d9717a3cd3"}], "stats": {"total": 89, "additions": 87, "deletions": 2}, "files": [{"sha": "21bab4d45ef243ef65653010bc1f2f9622ffb530", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -1,3 +1,17 @@\n+2011-07-04  Georg-Johann Lay  <avr@gjlay.de>\n+\t\n+\tPR target/34734\n+\tPR target/44643\n+\t* gcc.target/avr/avr.exp: Run over cpp files, too.\n+\t* gcc.target/avr/torture/avr-torture.exp: Ditto.\n+\t* gcc.target/avr/progmem.h: New file.\n+\t* gcc.target/avr/exit-abort.h: New file.\n+\t* gcc.target/avr/progmem-error-1.c: New file.\n+\t* gcc.target/avr/progmem-error-1.cpp: New file.\n+\t* gcc.target/avr/progmem-warning-1.c: New file.\n+\t* gcc.target/avr/torture/progmem-1.c: New file.\n+\t* gcc.target/avr/torture/progmem-1.cpp: New file.\n+\n 2011-07-04  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/49615"}, {"sha": "a552a9685602a8f8fa03065837312037a2b0f8d4", "filename": "gcc/testsuite/gcc.target/avr/avr.exp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Favr.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Favr.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Favr.exp?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -34,7 +34,7 @@ if ![info exists DEFAULT_CFLAGS] then {\n dg-init\r\n \r\n # Main loop.\r\n-dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.\\[cCS\\]]] \\\r\n+dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.{\\[cCS\\],cpp}]] \\\r\n \t\"\" $DEFAULT_CFLAGS\r\n \r\n # All done.\r"}, {"sha": "cf7df203a95ffd8c0b48cec3f8a20fb52a8ee9d3", "filename": "gcc/testsuite/gcc.target/avr/exit-abort.h", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fexit-abort.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fexit-abort.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fexit-abort.h?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,8 @@\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+  extern void exit (int);\n+  extern void abort (void);\n+#ifdef __cplusplus\n+}\n+#endif"}, {"sha": "cf53cc8e92be9d361abd51375d867521bf324b75", "filename": "gcc/testsuite/gcc.target/avr/progmem-error-1.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-error-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-error-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-error-1.c?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,5 @@\n+/* { dg-do compile } */\n+\n+#include \"progmem.h\"\n+\n+char str[] PROGMEM = \"Hallo\"; /* { dg-error \"must be const\" } */"}, {"sha": "cf53cc8e92be9d361abd51375d867521bf324b75", "filename": "gcc/testsuite/gcc.target/avr/progmem-error-1.cpp", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-error-1.cpp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-error-1.cpp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-error-1.cpp?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,5 @@\n+/* { dg-do compile } */\n+\n+#include \"progmem.h\"\n+\n+char str[] PROGMEM = \"Hallo\"; /* { dg-error \"must be const\" } */"}, {"sha": "67af05fe5b3c496fa60a3d780efd50e8c49f909b", "filename": "gcc/testsuite/gcc.target/avr/progmem-warning-1.c", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-warning-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-warning-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem-warning-1.c?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,7 @@\n+/* PR target/34734 */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wuninitialized\" } */\n+\n+#include \"progmem.h\"\n+\n+const char c PROGMEM; /* { dg-warning \"uninitialized variable 'c' put into program memory area\" } */"}, {"sha": "d5e86c9fe3cde89fed992095d7a92d1a027add82", "filename": "gcc/testsuite/gcc.target/avr/progmem.h", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Fprogmem.h?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,14 @@\n+#define PROGMEM __attribute__((progmem))\n+\n+#define PSTR(s)                                             \\\n+    (__extension__({                                        \\\n+            static const char __c[] PROGMEM = (s);          \\\n+            &__c[0];}))\n+\n+#define pgm_read_char(addr)                                 \\\n+    (__extension__({                                        \\\n+            unsigned int __addr16 = (unsigned int)(addr);   \\\n+            char __result;                                  \\\n+            __asm__ (\"lpm %0, %a1\"                          \\\n+                     : \"=r\" (__result) : \"z\" (__addr16));   \\\n+            __result; }))"}, {"sha": "e2f83d6689b3bfd52ace1d5ad5bbbdf2477619ff", "filename": "gcc/testsuite/gcc.target/avr/torture/avr-torture.exp", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Favr-torture.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Favr-torture.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Favr-torture.exp?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -52,7 +52,7 @@ set-torture-options $AVR_TORTURE_OPTIONS\n \r\n \r\n # Main loop.\r\n-gcc-dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.\\[cS\\]]] $DEFAULT_CFLAGS\r\n+gcc-dg-runtest [lsort [glob -nocomplain $srcdir/$subdir/*.{\\[cS\\],cpp}]] $DEFAULT_CFLAGS\r\n \r\n # Finalize use of torture lists.\r\n torture-finish\r"}, {"sha": "790c676c9110a26282059d892a7090c73499abee", "filename": "gcc/testsuite/gcc.target/avr/torture/progmem-1.c", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Fprogmem-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Fprogmem-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Fprogmem-1.c?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,30 @@\n+/* { dg-do run } */\n+\n+#include \"../exit-abort.h\"\n+#include \"../progmem.h\"\n+\n+const char strA[] PROGMEM = \"@A\";\n+const char strc PROGMEM = 'c';\n+\n+unsigned int volatile s = 2;\n+\n+int main()\n+{\n+    char c;\n+    \n+    c = pgm_read_char (&strA[s-1]);\n+    if (c != 'A')\n+        abort();\n+\n+    c = pgm_read_char (&PSTR (\"@@B\")[s]);\n+    if (c != 'B')\n+        abort();\n+\n+    c = pgm_read_char (&strc);\n+    if (c != 'c')\n+        abort();\n+\n+    exit (0);\n+\n+    return 0;\n+}"}, {"sha": "a1df9e78e725224e3874617fe1f4d68af7edc275", "filename": "gcc/testsuite/gcc.target/avr/torture/progmem-1.cpp", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Fprogmem-1.cpp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a648cfe8b3e10819f1a88ccc6912ca1529454024/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Fprogmem-1.cpp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Favr%2Ftorture%2Fprogmem-1.cpp?ref=a648cfe8b3e10819f1a88ccc6912ca1529454024", "patch": "@@ -0,0 +1,2 @@\n+/* { dg-do run } */\n+#include \"progmem-1.c\""}]}