{"sha": "2d3a1837bcf31c9a622d810d29179081613346df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQzYTE4MzdiY2YzMWM5YTYyMmQ4MTBkMjkxNzkwODE2MTMzNDZkZg==", "commit": {"author": {"name": "Olivier Hainque", "email": "hainque@adacore.com", "date": "2009-09-28T17:00:46Z"}, "committer": {"name": "Olivier Hainque", "email": "hainque@gcc.gnu.org", "date": "2009-09-28T17:00:46Z"}, "message": "ada/\n        * gcc-interface/targtyps.c\n        * (get_target_default_allocator_alignment):\n        Account for observable alignments out of default allocators.\n\n        testsuite/\n        * gnat.dg (tagged_alloc_free.adb): New testcase.\n\nFrom-SVN: r152243", "tree": {"sha": "2f8f64723bebd4ae3286b02c84a5c7a1e7eb9732", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f8f64723bebd4ae3286b02c84a5c7a1e7eb9732"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d3a1837bcf31c9a622d810d29179081613346df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d3a1837bcf31c9a622d810d29179081613346df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d3a1837bcf31c9a622d810d29179081613346df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d3a1837bcf31c9a622d810d29179081613346df/comments", "author": {"login": "hainque", "id": 18735142, "node_id": "MDQ6VXNlcjE4NzM1MTQy", "avatar_url": "https://avatars.githubusercontent.com/u/18735142?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hainque", "html_url": "https://github.com/hainque", "followers_url": "https://api.github.com/users/hainque/followers", "following_url": "https://api.github.com/users/hainque/following{/other_user}", "gists_url": "https://api.github.com/users/hainque/gists{/gist_id}", "starred_url": "https://api.github.com/users/hainque/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hainque/subscriptions", "organizations_url": "https://api.github.com/users/hainque/orgs", "repos_url": "https://api.github.com/users/hainque/repos", "events_url": "https://api.github.com/users/hainque/events{/privacy}", "received_events_url": "https://api.github.com/users/hainque/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d366d023cbfcdefc9aebbbef54e49acc4fe4a5dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d366d023cbfcdefc9aebbbef54e49acc4fe4a5dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d366d023cbfcdefc9aebbbef54e49acc4fe4a5dd"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "dd0657407ef009313dc2d6dc3fcb953678c25a8c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2d3a1837bcf31c9a622d810d29179081613346df", "patch": "@@ -1,3 +1,8 @@\n+2009-09-28  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* gcc-interface/targtyps.c (get_target_default_allocator_alignment):\n+\tAccount for observable alignments out of default allocators.\n+\n 2009-09-28  Richard Henderson  <rth@redhat.com>\n \n \t* gcc-interface/utils.c (gnat_install_builtins): Update call to"}, {"sha": "9bc8f0e42ecc11b17d7f9eaf819d89727ce75b48", "filename": "gcc/ada/gcc-interface/targtyps.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Fada%2Fgcc-interface%2Ftargtyps.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Fada%2Fgcc-interface%2Ftargtyps.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Ftargtyps.c?ref=2d3a1837bcf31c9a622d810d29179081613346df", "patch": "@@ -160,10 +160,21 @@ get_target_maximum_default_alignment (void)\n    handy and what alignment it honors).  In the meantime, resort to malloc\n    considerations only.  */\n \n+/* Account for MALLOC_OBSERVABLE_ALIGNMENTs here.  Use this or the ABI\n+   guaranteed alignment if greater.  */\n+\n+#ifdef MALLOC_OBSERVABLE_ALIGNMENT\n+#define MALLOC_ALIGNMENT MALLOC_OBSERVABLE_ALIGNMENT\n+#else\n+#define MALLOC_OBSERVABLE_ALIGNMENT (2 * LONG_TYPE_SIZE)\n+#define MALLOC_ALIGNMENT \\\n+  MAX (MALLOC_ABI_ALIGNMENT, MALLOC_OBSERVABLE_ALIGNMENT)\n+#endif\n+\n Pos\n get_target_default_allocator_alignment (void)\n {\n-  return MALLOC_ABI_ALIGNMENT / BITS_PER_UNIT;\n+  return MALLOC_ALIGNMENT / BITS_PER_UNIT;\n }\n \n /* Standard'Maximum_Allowed_Alignment.  Maximum alignment that we may"}, {"sha": "098dc2da113589e28644aaa70c718ee938754fbd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2d3a1837bcf31c9a622d810d29179081613346df", "patch": "@@ -1,3 +1,7 @@\n+2009-09-28  Olivier Hainque  <hainque@adacore.com>\n+\n+\t* gnat.dg (tagged_alloc_free.adb): New testcase.\n+\t\n 2009-09-28  Janis Johnson  <janis187@us.ibm.com>\n \n \t* g++.dg/dfp: New directory."}, {"sha": "d26916dcb6e9ced28ce59c1d33f2ebbc01253a75", "filename": "gcc/testsuite/gnat.dg/tagged_alloc_free.adb", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Ftestsuite%2Fgnat.dg%2Ftagged_alloc_free.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d3a1837bcf31c9a622d810d29179081613346df/gcc%2Ftestsuite%2Fgnat.dg%2Ftagged_alloc_free.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Ftagged_alloc_free.adb?ref=2d3a1837bcf31c9a622d810d29179081613346df", "patch": "@@ -0,0 +1,22 @@\n+-- { dg-do run }\n+\n+with Ada.Unchecked_Deallocation;\n+with Ada.Strings.Unbounded; use Ada.Strings.Unbounded;\n+\n+procedure Tagged_Alloc_Free is\n+\n+  type Test_Base is tagged null record;\n+  type Test_Class_Access is access all Test_Base'Class;\n+  type Test_Extension is new Test_Base with record\n+    Last_Name : Unbounded_String := Null_Unbounded_String;\n+  end record;\n+\n+  procedure Free is new Ada.Unchecked_Deallocation\n+    (Object => Test_Base'Class,\n+     Name   => Test_Class_Access);\n+\n+  Handle : Test_Class_Access := new Test_Extension;\n+\n+begin\n+  Free (Handle);\n+end;"}]}