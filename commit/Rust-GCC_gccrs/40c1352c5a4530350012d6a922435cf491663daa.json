{"sha": "40c1352c5a4530350012d6a922435cf491663daa", "node_id": "C_kwDOANBUbNoAKDQwYzEzNTJjNWE0NTMwMzUwMDEyZDZhOTIyNDM1Y2Y0OTE2NjNkYWE", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-03-15T03:16:21Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-03-15T12:44:43Z"}, "message": "c++: injected class name as default ttp arg [PR58538]\n\nThis function needs to handle this case like convert_template_argument.\n\n\tPR c++/58538\n\ngcc/cp/ChangeLog:\n\n\t* semantics.cc (check_template_template_default_arg): Check\n\tmaybe_get_template_decl_from_type_decl.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/template/ttp7.C: Remove expected error.", "tree": {"sha": "52af17c72a9a18fb0517ec1aaab11b035f26b66b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/52af17c72a9a18fb0517ec1aaab11b035f26b66b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/40c1352c5a4530350012d6a922435cf491663daa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40c1352c5a4530350012d6a922435cf491663daa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40c1352c5a4530350012d6a922435cf491663daa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40c1352c5a4530350012d6a922435cf491663daa/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3ea64aad06a2b32739028bae03b9b9a5691d2d30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ea64aad06a2b32739028bae03b9b9a5691d2d30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ea64aad06a2b32739028bae03b9b9a5691d2d30"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "57dd7b66da83c4792a58997a6a1ffd10976adb3a", "filename": "gcc/cp/semantics.cc", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/40c1352c5a4530350012d6a922435cf491663daa/gcc%2Fcp%2Fsemantics.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/40c1352c5a4530350012d6a922435cf491663daa/gcc%2Fcp%2Fsemantics.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.cc?ref=40c1352c5a4530350012d6a922435cf491663daa", "patch": "@@ -3468,8 +3468,13 @@ check_template_template_default_arg (tree argument)\n       && TREE_CODE (argument) != UNBOUND_CLASS_TEMPLATE)\n     {\n       if (TREE_CODE (argument) == TYPE_DECL)\n-\terror (\"invalid use of type %qT as a default value for a template \"\n-\t       \"template-parameter\", TREE_TYPE (argument));\n+\t{\n+\t  if (tree t = maybe_get_template_decl_from_type_decl (argument))\n+\t    if (TREE_CODE (t) == TEMPLATE_DECL)\n+\t      return t;\n+\t  error (\"invalid use of type %qT as a default value for a template \"\n+\t\t \"template-parameter\", TREE_TYPE (argument));\n+\t}\n       else\n \terror (\"invalid default argument for a template template parameter\");\n       return error_mark_node;"}, {"sha": "672077e7e7d265f63cac1a452d7fb549d85781f0", "filename": "gcc/testsuite/g++.dg/template/ttp7.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/40c1352c5a4530350012d6a922435cf491663daa/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fttp7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/40c1352c5a4530350012d6a922435cf491663daa/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fttp7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fttp7.C?ref=40c1352c5a4530350012d6a922435cf491663daa", "patch": "@@ -11,6 +11,6 @@ template<template<int> class = A<0> > struct B2 {};  // { dg-error \"as a default\n \n template <typename T>\n struct S {\n-  template <template <typename> class = S>   struct I1 {};  // { dg-error \"as a default value\" }\n+  template <template <typename> class = S>   struct I1 {}; // PR c++/58538\n   template <template <typename> class = ::S> struct I2 {};\n };"}]}