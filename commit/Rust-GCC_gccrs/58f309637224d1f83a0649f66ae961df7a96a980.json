{"sha": "58f309637224d1f83a0649f66ae961df7a96a980", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThmMzA5NjM3MjI0ZDFmODNhMDY0OWY2NmFlOTYxZGY3YTk2YTk4MA==", "commit": {"author": {"name": "Andris Pavenis", "email": "andris.pavenis@iki.fi", "date": "2016-10-21T15:52:25Z"}, "committer": {"name": "Andris Pavenis", "email": "andris@gcc.gnu.org", "date": "2016-10-21T15:52:25Z"}, "message": "re PR preprocessor/71681 (header.gcc file lookup is broken for -remap)\n\n2016-10-21  Andris Pavenis  <andris.pavenis@iki.fi>\n\n\tPR preprocessor/71681\n\t* files.c (remap_filename): Fix handling -remap in subdirectories.\n\nFrom-SVN: r241413", "tree": {"sha": "81baa4513d64c40182e0f4e142ce0714f4552d4d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81baa4513d64c40182e0f4e142ce0714f4552d4d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58f309637224d1f83a0649f66ae961df7a96a980", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58f309637224d1f83a0649f66ae961df7a96a980", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58f309637224d1f83a0649f66ae961df7a96a980", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58f309637224d1f83a0649f66ae961df7a96a980/comments", "author": {"login": "apavenis", "id": 33935463, "node_id": "MDQ6VXNlcjMzOTM1NDYz", "avatar_url": "https://avatars.githubusercontent.com/u/33935463?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apavenis", "html_url": "https://github.com/apavenis", "followers_url": "https://api.github.com/users/apavenis/followers", "following_url": "https://api.github.com/users/apavenis/following{/other_user}", "gists_url": "https://api.github.com/users/apavenis/gists{/gist_id}", "starred_url": "https://api.github.com/users/apavenis/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apavenis/subscriptions", "organizations_url": "https://api.github.com/users/apavenis/orgs", "repos_url": "https://api.github.com/users/apavenis/repos", "events_url": "https://api.github.com/users/apavenis/events{/privacy}", "received_events_url": "https://api.github.com/users/apavenis/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "810cb1913f8132a76280574a2a04f1691c0174e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/810cb1913f8132a76280574a2a04f1691c0174e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/810cb1913f8132a76280574a2a04f1691c0174e0"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "87dae8496e2fa2599add676c03476577f6ab8eba", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58f309637224d1f83a0649f66ae961df7a96a980/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58f309637224d1f83a0649f66ae961df7a96a980/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=58f309637224d1f83a0649f66ae961df7a96a980", "patch": "@@ -1,3 +1,8 @@\n+2016-10-21  Andris Pavenis  <andris.pavenis@iki.fi>\n+\n+\tPR preprocessor/71681\n+\t* files.c (remap_filename): Fix handling -remap in subdirectories.\n+\n 2016-10-12  Jakub Jelinek  <jakub@redhat.com>\n \n \t* include/cpplib.h (struct cpp_options): Add"}, {"sha": "e859dfe369382da287140399ac2aeca1df029044", "filename": "libcpp/files.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58f309637224d1f83a0649f66ae961df7a96a980/libcpp%2Ffiles.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58f309637224d1f83a0649f66ae961df7a96a980/libcpp%2Ffiles.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Ffiles.c?ref=58f309637224d1f83a0649f66ae961df7a96a980", "patch": "@@ -1672,7 +1672,7 @@ static char *\n remap_filename (cpp_reader *pfile, _cpp_file *file)\n {\n   const char *fname, *p;\n-  char *new_dir;\n+  char *new_dir, *p3;\n   cpp_dir *dir;\n   size_t index, len;\n \n@@ -1701,9 +1701,15 @@ remap_filename (cpp_reader *pfile, _cpp_file *file)\n \treturn NULL;\n \n       len = dir->len + (p - fname + 1);\n-      new_dir = XNEWVEC (char, len + 1);\n+      new_dir = XNEWVEC (char, len + 2);\n+      p3 = new_dir + dir->len;\n       memcpy (new_dir, dir->name, dir->len);\n-      memcpy (new_dir + dir->len, fname, p - fname + 1);\n+      if (dir->len && !IS_DIR_SEPARATOR (dir->name[dir->len - 1]))\n+\t{\n+\t  *p3++ = '/';\n+\t  len++;\n+\t}\n+      memcpy (p3, fname, p - fname + 1);\n       new_dir[len] = '\\0';\n \n       dir = make_cpp_dir (pfile, new_dir, dir->sysp);"}]}