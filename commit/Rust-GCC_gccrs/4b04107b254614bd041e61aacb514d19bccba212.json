{"sha": "4b04107b254614bd041e61aacb514d19bccba212", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGIwNDEwN2IyNTQ2MTRiZDA0MWU2MWFhY2I1MTRkMTliY2NiYTIxMg==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2018-01-19T10:41:57Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2018-01-19T10:41:57Z"}, "message": "[arm] Fix gcc.target/arm/negdi-[12].c\n\nThese tests are failing for a silly reason. They scan for an occurrence of the NEGS instruction.\nNEGS (and NEG in general) is a pre-UAL alias of RSB with an immediate of 0 and we only emit it\nin one pattern: *thumb2_negsi2_short in thumb2.md. In all other instances of negation we emit\nthe modern RSB mnemonic. This causes needless differences in assembly output.\nFor example, for these testcases we emit NEG when compiling for -march=armv7-a, but for armv7ve\nwe emit RSB, causing the scan-assembler tests to fail.\n\nThis patch updates the *thumb2_negsi2_short pattern to use the RSB mnemonic and\nfixes the flaky scan-assembler directives.\n\nThese tests now pass for my compiler configured with:\n--with-cpu=cortex-a15 --with-fpu=neon-vfpv4 --with-float=hard --with-mode=thumb\n\nBootstrapped and tested on arm-none-linux-gnueabihf as well.\n\n\t* config/arm/thumb2.md (*thumb2_negsi2_short): Use RSB mnemonic\n\tinstead of NEG.\n\n\t* gcc.target/arm/negdi-1.c: Remove bogus assembler scan for negs.\n\t* gcc.target/arm/negdi-2.c: Likewise.\n\t* gcc.target/arm/thumb-16bit-ops.c: Replace scan for NEGS with RSBS.\n--This line,gand those below, will be ignored--\n\nM    gcc/config/arm/thumb2.md\nM    gcc/ChangeLog\nM    gcc/testsuite/gcc.target/arm/thumb-16bit-ops.c\nM    gcc/testsuite/gcc.target/arm/negdi-1.c\nM    gcc/testsuite/gcc.target/arm/negdi-2.c\nM    gcc/testsuite/ChangeLog\n\nFrom-SVN: r256881", "tree": {"sha": "aae68d5cf391d72bb5f32d48321bd5f44a19a2b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aae68d5cf391d72bb5f32d48321bd5f44a19a2b9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b04107b254614bd041e61aacb514d19bccba212", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b04107b254614bd041e61aacb514d19bccba212", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b04107b254614bd041e61aacb514d19bccba212", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b04107b254614bd041e61aacb514d19bccba212/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9f14d763affc5a001506f485e826ab110b4a2969", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9f14d763affc5a001506f485e826ab110b4a2969", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9f14d763affc5a001506f485e826ab110b4a2969"}], "stats": {"total": 21, "additions": 15, "deletions": 6}, "files": [{"sha": "5feefb2dda8adad19fef52bea9796fb2f29f7dc7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b04107b254614bd041e61aacb514d19bccba212/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b04107b254614bd041e61aacb514d19bccba212/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4b04107b254614bd041e61aacb514d19bccba212", "patch": "@@ -1,3 +1,8 @@\n+2018-01-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* config/arm/thumb2.md (*thumb2_negsi2_short): Use RSB mnemonic\n+\tinstead of NEG.\n+\n 2018-01-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR sanitizer/81715"}, {"sha": "8eb20003ab2f6df847d9344ea78e0175ce6dd902", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=4b04107b254614bd041e61aacb514d19bccba212", "patch": "@@ -1420,7 +1420,7 @@\n \t(neg:SI (match_operand:SI 1 \"low_register_operand\" \"l\")))\n    (clobber (reg:CC CC_REGNUM))]\n   \"TARGET_THUMB2 && reload_completed\"\n-  \"neg%!\\t%0, %1\"\n+  \"rsb%!\\t%0, %1, #0\"\n   [(set_attr \"predicable\" \"yes\")\n    (set_attr \"length\" \"2\")\n    (set_attr \"type\" \"alu_sreg\")]"}, {"sha": "ef525655391d712e630b2df49308bc3408753b8d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4b04107b254614bd041e61aacb514d19bccba212", "patch": "@@ -1,3 +1,9 @@\n+2018-01-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* gcc.target/arm/negdi-1.c: Remove bogus assembler scan for negs.\n+\t* gcc.target/arm/negdi-2.c: Likewise.\n+\t* gcc.target/arm/thumb-16bit-ops.c: Replace scan for NEGS with RSBS.\n+\n 2018-01-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* gcc.target/arm/pr40956.c: Adjust scan-assembler pattern."}, {"sha": "efa49ad62800378ba3ee810931680c159479c7b9", "filename": "gcc/testsuite/gcc.target/arm/negdi-1.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fnegdi-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fnegdi-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fnegdi-1.c?ref=4b04107b254614bd041e61aacb514d19bccba212", "patch": "@@ -12,6 +12,5 @@ Expected output:\n \trsb\tr0, r0, #0\n \tmov\tr1, r0, asr #31\n */\n-/* { dg-final { scan-assembler-times \"rsb\" 1 { target { arm_nothumb } } } } */\n-/* { dg-final { scan-assembler-times \"negs\\\\t\" 1 { target { ! { arm_nothumb } } } } } */\n+/* { dg-final { scan-assembler-times \"rsbs?\\\\t...?, ...?, #0\" 1 } } */\n /* { dg-final { scan-assembler-times \"asr\" 1 } } */"}, {"sha": "38dffeddd54c14d64c39b35992bbb7225efbeb7f", "filename": "gcc/testsuite/gcc.target/arm/negdi-2.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fnegdi-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fnegdi-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fnegdi-2.c?ref=4b04107b254614bd041e61aacb514d19bccba212", "patch": "@@ -11,6 +11,5 @@ Expected output:\n \trsb\tr0, r0, #0\n \tmov\tr1, #0\n */\n-/* { dg-final { scan-assembler-times \"rsb\\\\t...?, ...?, #0\" 1 { target { arm_nothumb } } } } */\n-/* { dg-final { scan-assembler-times \"negs\\\\t...?, ...?\" 1 { target { ! arm_nothumb } } } } */\n+/* { dg-final { scan-assembler-times \"rsbs?\\\\t...?, ...?, #0\" 1 } } */\n /* { dg-final { scan-assembler-times \"mov\" 1 } } */"}, {"sha": "9f4f659b35c062c9c576e9bb2d6aae74f91f6a86", "filename": "gcc/testsuite/gcc.target/arm/thumb-16bit-ops.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-16bit-ops.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b04107b254614bd041e61aacb514d19bccba212/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-16bit-ops.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fthumb-16bit-ops.c?ref=4b04107b254614bd041e61aacb514d19bccba212", "patch": "@@ -200,4 +200,4 @@ s (int a, int b)\n   return -b;\n }\n \n-/* { dg-final { scan-assembler \"negs\tr0, r1\" } } */\n+/* { dg-final { scan-assembler \"rsbs\tr0, r1, #0\" } } */"}]}