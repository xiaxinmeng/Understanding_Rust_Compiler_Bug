{"sha": "a3f3eec079677bc6042dc7b00e8f85f644b97d57", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNmM2VlYzA3OTY3N2JjNjA0MmRjN2IwMGU4Zjg1ZjY0NGI5N2Q1Nw==", "commit": {"author": {"name": "Mark Wielaard", "email": "mjw@redhat.com", "date": "2016-11-01T23:13:10Z"}, "committer": {"name": "Mark Wielaard", "email": "mark@gcc.gnu.org", "date": "2016-11-01T23:13:10Z"}, "message": "libiberty: Fix memory leak in ada_demangle when symbol cannot be demangled.\n\nWhen a symbol cannot be demangled in ada_demangle a new demangled VEC\nwill be allocated without deleting the demangled VEC already in use.\n\nRunning testsuite/test-demangle under valgrind will show the leak for\nthis entry in testsuite/demangle-expected:\n\n    # Elaborated flag (not demangled)\n    --format=gnat\n    x_E\n    <x_E>\n\n 11 bytes in 1 blocks are definitely lost in loss record 1 of 1\n    at 0x4C27BE3: malloc (vg_replace_malloc.c:299)\n    by 0x413FE7: xmalloc (xmalloc.c:148)\n    by 0x4025EC: ada_demangle (cplus-dem.c:930)\n    by 0x402C59: cplus_demangle (cplus-dem.c:892)\n    by 0x400FEC: main (test-demangle.c:317)\n\nlibiberty/ChangeLog:\n\n\t* cplus-dem.c (ada_demangle): Initialize demangled to NULL and\n\tXDELETEVEC demangled when unknown.\n\nFrom-SVN: r241760", "tree": {"sha": "c6c4281d638ba42a7cbf50facf09bdb390eef6ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c6c4281d638ba42a7cbf50facf09bdb390eef6ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3f3eec079677bc6042dc7b00e8f85f644b97d57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3f3eec079677bc6042dc7b00e8f85f644b97d57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3f3eec079677bc6042dc7b00e8f85f644b97d57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3f3eec079677bc6042dc7b00e8f85f644b97d57/comments", "author": null, "committer": null, "parents": [{"sha": "be6218568d56e62aa3b53d962eaf41dd03b76701", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be6218568d56e62aa3b53d962eaf41dd03b76701", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be6218568d56e62aa3b53d962eaf41dd03b76701"}], "stats": {"total": 8, "additions": 7, "deletions": 1}, "files": [{"sha": "73cbcc41c60cbd07cb9b7355ef69fb944e2107e9", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3f3eec079677bc6042dc7b00e8f85f644b97d57/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3f3eec079677bc6042dc7b00e8f85f644b97d57/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=a3f3eec079677bc6042dc7b00e8f85f644b97d57", "patch": "@@ -1,3 +1,8 @@\n+2016-10-31  Mark Wielaard  <mjw@redhat.com>\n+\n+\t* cplus-dem.c (ada_demangle): Initialize demangled to NULL and\n+\tXDELETEVEC demangled when unknown.\n+\n 2016-09-19  Andrew Stubbs  <ams@codesourcery.com>\n \n \t* pex-win32.c (argv_to_cmdline): Quote zero-length parameters."}, {"sha": "7f63397f2d447ef9e06e133c33d3931754b6dd1c", "filename": "libiberty/cplus-dem.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3f3eec079677bc6042dc7b00e8f85f644b97d57/libiberty%2Fcplus-dem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3f3eec079677bc6042dc7b00e8f85f644b97d57/libiberty%2Fcplus-dem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcplus-dem.c?ref=a3f3eec079677bc6042dc7b00e8f85f644b97d57", "patch": "@@ -911,7 +911,7 @@ ada_demangle (const char *mangled, int option ATTRIBUTE_UNUSED)\n   int len0;\n   const char* p;\n   char *d;\n-  char *demangled;\n+  char *demangled = NULL;\n   \n   /* Discard leading _ada_, which is used for library level subprograms.  */\n   if (strncmp (mangled, \"_ada_\", 5) == 0)\n@@ -1156,6 +1156,7 @@ ada_demangle (const char *mangled, int option ATTRIBUTE_UNUSED)\n   return demangled;\n \n  unknown:\n+  XDELETEVEC (demangled);\n   len0 = strlen (mangled);\n   demangled = XNEWVEC (char, len0 + 3);\n "}]}