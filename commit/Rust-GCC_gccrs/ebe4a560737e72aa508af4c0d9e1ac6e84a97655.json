{"sha": "ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWJlNGE1NjA3MzdlNzJhYTUwOGFmNGMwZDllMWFjNmU4NGE5NzY1NQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2015-07-17T17:12:01Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2015-07-17T17:12:01Z"}, "message": "mkoffload.c (process): Constify host data.\n\n\tgcc/\n\t* config/nvptx/mkoffload.c (process): Constify host data.\n\t* config/i386/intelmic-mkoffload.c (generate_target_descr_file):\n\tConstify host data.\n\t(generate_host_descr_file): Likewise.\n\n\tlibgomp/\n\t* target.c (struct_offload_image_descr): Constify host_table.\n\t(gomp_offload_image_to_device): Likewise.\n\t(GOMP_offload_register, GOMP_offload_unregister): Likewise.\n\n\tlibgcc/\n\t* offloadstuff.c: Constify host data.\n\nFrom-SVN: r225943", "tree": {"sha": "0620634b02bd3dbd3f65141af8fbb850d2590361", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0620634b02bd3dbd3f65141af8fbb850d2590361"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/comments", "author": null, "committer": null, "parents": [{"sha": "247577525613274ed246537f195eda285087d814", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/247577525613274ed246537f195eda285087d814", "html_url": "https://github.com/Rust-GCC/gccrs/commit/247577525613274ed246537f195eda285087d814"}], "stats": {"total": 49, "additions": 33, "deletions": 16}, "files": [{"sha": "8ef4de4a230192a9afe377d0498921c3832bdd31", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -1,3 +1,10 @@\n+2015-07-17  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* config/nvptx/mkoffload.c (process): Constify host data.\n+\t* config/i386/intelmic-mkoffload.c (generate_target_descr_file):\n+\tConstify host data.\n+\t(generate_host_descr_file): Likewise.\n+\n 2015-07-17  Aditya Kumar  <aditya.k7@samsung.com>\n \t    Sebastian Pop  <s.pop@samsung.com>\n "}, {"sha": "ca15868dde1aca9833d191091d30f84e6885988d", "filename": "gcc/config/i386/intelmic-mkoffload.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/gcc%2Fconfig%2Fi386%2Fintelmic-mkoffload.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/gcc%2Fconfig%2Fi386%2Fintelmic-mkoffload.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fintelmic-mkoffload.c?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -338,7 +338,7 @@ generate_host_descr_file (const char *host_compiler)\n     fatal_error (input_location, \"cannot open '%s'\", src_filename);\n \n   fprintf (src_file,\n-\t   \"extern void *__OFFLOAD_TABLE__;\\n\"\n+\t   \"extern const void *const __OFFLOAD_TABLE__;\\n\"\n \t   \"extern const void *const __offload_image_intelmic_start;\\n\"\n \t   \"extern const void *const __offload_image_intelmic_end;\\n\\n\"\n \n@@ -350,11 +350,11 @@ generate_host_descr_file (const char *host_compiler)\n \t   \"#ifdef __cplusplus\\n\"\n \t   \"extern \\\"C\\\"\\n\"\n \t   \"#endif\\n\"\n-\t   \"void GOMP_offload_register (void *, int, const void *);\\n\"\n+\t   \"void GOMP_offload_register (const void *, int, const void *);\\n\"\n \t   \"#ifdef __cplusplus\\n\"\n \t   \"extern \\\"C\\\"\\n\"\n \t   \"#endif\\n\"\n-\t   \"void GOMP_offload_unregister (void *, int, const void *);\\n\\n\"\n+\t   \"void GOMP_offload_unregister (const void *, int, const void *);\\n\\n\"\n \n \t   \"__attribute__((constructor))\\n\"\n \t   \"static void\\n\""}, {"sha": "ab381799909c12981c66419d46f95fbf4117facd", "filename": "gcc/config/nvptx/mkoffload.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/gcc%2Fconfig%2Fnvptx%2Fmkoffload.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/gcc%2Fconfig%2Fnvptx%2Fmkoffload.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fmkoffload.c?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -881,12 +881,12 @@ process (FILE *in, FILE *out)\n \t   \"extern \\\"C\\\" {\\n\"\n \t   \"#endif\\n\");\n   fprintf (out, \"extern void GOMP_offload_register\"\n-\t   \" (void *, int, const void *);\\n\");\n+\t   \" (const void *, int, const void *);\\n\");\n   fprintf (out, \"#ifdef __cplusplus\\n\"\n \t   \"}\\n\"\n \t   \"#endif\\n\");\n \n-  fprintf (out, \"extern void *__OFFLOAD_TABLE__[];\\n\\n\");\n+  fprintf (out, \"extern const void *const __OFFLOAD_TABLE__[];\\n\\n\");\n   fprintf (out, \"static __attribute__((constructor)) void init (void)\\n{\\n\");\n   fprintf (out, \"  GOMP_offload_register (__OFFLOAD_TABLE__, %d,\\n\",\n \t   GOMP_DEVICE_NVIDIA_PTX);"}, {"sha": "4bd9f1fd9d5be6d0e3d48bbab0c92d430e01362e", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -1,3 +1,7 @@\n+2015-07-17  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* offloadstuff.c: Constify host data.\n+\n 2015-07-17  Jan Beulich  <jbeulich@suse.com>\n \n \t* config/t-softfp: Split up \"else ifneq\"."}, {"sha": "57e0973288a70ebc1ca6259507894d3b705f3765", "filename": "libgcc/offloadstuff.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgcc%2Foffloadstuff.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgcc%2Foffloadstuff.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Foffloadstuff.c?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -46,28 +46,28 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n #ifdef CRT_BEGIN\n \n #if defined(HAVE_GAS_HIDDEN) && defined(ENABLE_OFFLOADING)\n-void *__offload_func_table[0]\n+const void *const __offload_func_table[0]\n   __attribute__ ((__used__, visibility (\"hidden\"),\n \t\t  section (OFFLOAD_FUNC_TABLE_SECTION_NAME))) = { };\n-void *__offload_var_table[0]\n+const void *const __offload_var_table[0]\n   __attribute__ ((__used__, visibility (\"hidden\"),\n \t\t  section (OFFLOAD_VAR_TABLE_SECTION_NAME))) = { };\n #endif\n \n #elif defined CRT_END\n \n #if defined(HAVE_GAS_HIDDEN) && defined(ENABLE_OFFLOADING)\n-void *__offload_funcs_end[0]\n+const void *const __offload_funcs_end[0]\n   __attribute__ ((__used__, visibility (\"hidden\"),\n \t\t  section (OFFLOAD_FUNC_TABLE_SECTION_NAME))) = { };\n-void *__offload_vars_end[0]\n+const void *const __offload_vars_end[0]\n   __attribute__ ((__used__, visibility (\"hidden\"),\n \t\t  section (OFFLOAD_VAR_TABLE_SECTION_NAME))) = { };\n \n-extern void *__offload_func_table[];\n-extern void *__offload_var_table[];\n+extern const void *const __offload_func_table[];\n+extern const void *const __offload_var_table[];\n \n-void *__OFFLOAD_TABLE__[]\n+const void *const __OFFLOAD_TABLE__[]\n   __attribute__ ((__visibility__ (\"hidden\"))) =\n {\n   &__offload_func_table, &__offload_funcs_end,"}, {"sha": "9810a183737178146e654a64e32767a7fa3b1ce6", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -1,5 +1,9 @@\n 2015-07-17  Nathan Sidwell  <nathan@codesourcery.com>\n \n+\t* target.c (struct_offload_image_descr): Constify host_table.\n+\t(gomp_offload_image_to_device): Likewise.\n+\t(GOMP_offload_register, GOMP_offload_unregister): Likewise.\n+\n \t* libgomp.h (gomp_device_descr): Constify target data arguments.\n \t* target.c (struct offload_image_descr): Constify target_data.\n \t(gomp_offload_image_to_device): Likewise."}, {"sha": "ca536a048d34360a89770c894d78d5cbde1b08cf", "filename": "libgomp/target.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgomp%2Ftarget.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebe4a560737e72aa508af4c0d9e1ac6e84a97655/libgomp%2Ftarget.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftarget.c?ref=ebe4a560737e72aa508af4c0d9e1ac6e84a97655", "patch": "@@ -57,7 +57,7 @@ static gomp_mutex_t register_lock;\n    pointer to target data.  */\n struct offload_image_descr {\n   enum offload_target_type type;\n-  void *host_table;\n+  const void *host_table;\n   const void *target_data;\n };\n \n@@ -642,7 +642,7 @@ gomp_update (struct gomp_device_descr *devicep, size_t mapnum, void **hostaddrs,\n \n static void\n gomp_offload_image_to_device (struct gomp_device_descr *devicep,\n-\t\t\t      void *host_table, const void *target_data,\n+\t\t\t      const void *host_table, const void *target_data,\n \t\t\t      bool is_register_lock)\n {\n   void **host_func_table = ((void ***) host_table)[0];\n@@ -730,7 +730,8 @@ gomp_offload_image_to_device (struct gomp_device_descr *devicep,\n    the target, and TARGET_DATA needed by target plugin.  */\n \n void\n-GOMP_offload_register (void *host_table, enum offload_target_type target_type,\n+GOMP_offload_register (const void *host_table,\n+\t\t       enum offload_target_type target_type,\n \t\t       const void *target_data)\n {\n   int i;\n@@ -764,7 +765,8 @@ GOMP_offload_register (void *host_table, enum offload_target_type target_type,\n    the target, and TARGET_DATA needed by target plugin.  */\n \n void\n-GOMP_offload_unregister (void *host_table, enum offload_target_type target_type,\n+GOMP_offload_unregister (const void *host_table,\n+\t\t\t enum offload_target_type target_type,\n \t\t\t const void *target_data)\n {\n   void **host_func_table = ((void ***) host_table)[0];"}]}