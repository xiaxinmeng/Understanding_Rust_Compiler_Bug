{"sha": "2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmY5YTJjZDc2OWU5NDBiN2Q2ZTdkMjU2YzZiMjRmMzE0ZDZkMDBhZQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2002-05-14T00:04:54Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2002-05-14T00:04:54Z"}, "message": "jcf-write.c (write_classfile): Unlink the temporary file if it cannot be renamed.\n\n\t* jcf-write.c (write_classfile): Unlink the temporary file if it\n\tcannot be renamed.  Use concat to build up the name of the\n\ttemporary file\n\nFrom-SVN: r53439", "tree": {"sha": "432c8db6c62c88d67202af21b4700a36047ce858", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/432c8db6c62c88d67202af21b4700a36047ce858"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae/comments", "author": null, "committer": null, "parents": [{"sha": "546c093ec5f84f1659723329061c47070a9956ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/546c093ec5f84f1659723329061c47070a9956ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/546c093ec5f84f1659723329061c47070a9956ef"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "2838c43a6b02b063aaf3b046c954c6f7d1e664a9", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae", "patch": "@@ -1,6 +1,12 @@\n+2002-05-13  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* jcf-write.c (write_classfile): Unlink the temporary file if it\n+\tcannot be renamed.  Use concat to build up the name of the\n+\ttemporary file.\n+\n 2002-05-08  Mark Mitchell  <mark@codesourcery.com>\n \n-\t* java/jcf-write.c (write_classfile): Write the file to a \n+\t* jcf-write.c (write_classfile): Write the file to a \n \ttemporary file and then rename it.\n \n 2002-05-07  Tom Tromey  <tromey@redhat.com>"}, {"sha": "491b561ed050c1b6370587c3e5acffd10634e0e5", "filename": "gcc/java/jcf-write.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae/gcc%2Fjava%2Fjcf-write.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae/gcc%2Fjava%2Fjcf-write.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fjcf-write.c?ref=2f9a2cd769e940b7d6e7d256c6b24f314d6d00ae", "patch": "@@ -3380,9 +3380,7 @@ write_classfile (clas)\n       /* The .class file is initially written to a \".tmp\" file so that\n \t if multiple instances of the compiler are running at once\n \t they do not see partially formed class files. */\n-      temporary_file_name = xmalloc (strlen (class_file_name) \n-\t\t\t\t     + strlen (\".tmp\") + 1);\n-      sprintf (temporary_file_name, \"%s.tmp\", class_file_name);\n+      temporary_file_name = concat (class_file_name, \".tmp\", NULL);\n       stream = fopen (temporary_file_name, \"wb\");\n       if (stream == NULL)\n \tfatal_io_error (\"can't open %s for writing\", temporary_file_name);\n@@ -3394,7 +3392,10 @@ write_classfile (clas)\n       if (fclose (stream))\n \tfatal_io_error (\"error closing %s\", temporary_file_name);\n       if (rename (temporary_file_name, class_file_name) == -1)\n-\tfatal_io_error (\"can't create %s\", class_file_name);\n+\t{\n+\t  remove (temporary_file_name);\n+\t  fatal_io_error (\"can't create %s\", class_file_name);\n+\t}\n       free (temporary_file_name);\n       free (class_file_name);\n     }"}]}