{"sha": "caef7872f0dc4a62dfc449785974eaa179b0a449", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2FlZjc4NzJmMGRjNGE2MmRmYzQ0OTc4NTk3NGVhYTE3OWIwYTQ0OQ==", "commit": {"author": {"name": "Francois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-04-29T10:45:57Z"}, "committer": {"name": "Fran\u00e7ois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2007-04-29T10:45:57Z"}, "message": "re PR fortran/31645 (Error on reading Byte Order Mark)\n\n\tPR fortran/31645\n\n\t* scanner.c (load_file): Discard the byte order mark if one is\n\tfound on the first non-preprocessor line of a file.\n\n\t* testsuite/gfortran.dg/bom_error.f90: New test.\n\t* testsuite/gfortran.dg/bom_include.f90: New test.\n\t* testsuite/gfortran.dg/bom_UTF16-LE.f90: New test.\n\t* testsuite/gfortran.dg/bom_UTF16-BE.f90: New test.\n\t* testsuite/gfortran.dg/bom_UTF-8.f90: New test.\n\t* testsuite/gfortran.dg/bom_UTF-32.f90: New test.\n\t* testsuite/gfortran.dg/bom_UTF-8.F90: New test.\n\t* testsuite/gfortran.dg/bom_include.inc: New file.\n\nFrom-SVN: r124274", "tree": {"sha": "ebf5c3a3515c694847d6fb1e9ca78d6d75adcd53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ebf5c3a3515c694847d6fb1e9ca78d6d75adcd53"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/caef7872f0dc4a62dfc449785974eaa179b0a449", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caef7872f0dc4a62dfc449785974eaa179b0a449", "html_url": "https://github.com/Rust-GCC/gccrs/commit/caef7872f0dc4a62dfc449785974eaa179b0a449", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/caef7872f0dc4a62dfc449785974eaa179b0a449/comments", "author": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70ec16f7c29de16e0ec824de9a8979ff0a902488", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70ec16f7c29de16e0ec824de9a8979ff0a902488", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70ec16f7c29de16e0ec824de9a8979ff0a902488"}], "stats": {"total": 59, "additions": 59, "deletions": 0}, "files": [{"sha": "4d481c378a70ba0315a5edeb272f1263a2277f48", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -1,3 +1,9 @@\n+2007-04-29  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/31645\n+\t* scanner.c (load_file): Discard the byte order mark if one is\n+\tfound on the first non-preprocessor line of a file.\n+\n 2007-04-29  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/31711"}, {"sha": "5eaa34fd294a295ec4d031259101018465a48e0f", "filename": "gcc/fortran/scanner.c", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ffortran%2Fscanner.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ffortran%2Fscanner.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fscanner.c?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -1404,6 +1404,7 @@ load_file (const char *filename, bool initial)\n   gfc_file *f;\n   FILE *input;\n   int len, line_len;\n+  bool first_line;\n \n   for (f = current_file; f; f = f->up)\n     if (strcmp (filename, f->filename) == 0)\n@@ -1445,6 +1446,7 @@ load_file (const char *filename, bool initial)\n   current_file->line = 1;\n   line = NULL;\n   line_len = 0;\n+  first_line = true;\n \n   if (initial && gfc_src_preprocessor_lines[0])\n     {\n@@ -1467,6 +1469,26 @@ load_file (const char *filename, bool initial)\n       if (feof (input) && len == 0)\n \tbreak;\n \n+      /* If this is the first line of the file, it can contain a byte\n+\t order mark (BOM), which we will ignore:\n+\t   FF FE is UTF-16 little endian,\n+\t   FE FF is UTF-16 big endian,\n+\t   EF BB BF is UTF-8.  */\n+      if (first_line\n+\t  && ((line_len >= 2 && line[0] == '\\xFF' && line[1] == '\\xFE')\n+\t      || (line_len >= 2 && line[0] == '\\xFE' && line[1] == '\\xFF')\n+\t      || (line_len >= 3 && line[0] == '\\xEF' && line[1] == '\\xBB'\n+\t\t  && line[2] == '\\xBF')))\n+\t{\n+\t  int n = line[1] == '\\xBB' ? 3 : 2;\n+\t  char * new = gfc_getmem (line_len);\n+\n+\t  strcpy (new, line + n);\n+\t  gfc_free (line);\n+\t  line = new;\n+\t  len -= n;\n+\t}\n+\n       /* There are three things this line can be: a line of Fortran\n \t source, an include line or a C preprocessor directive.  */\n \n@@ -1476,6 +1498,11 @@ load_file (const char *filename, bool initial)\n \t  continue;\n \t}\n \n+      /* Preprocessed files have preprocessor lines added before the byte\n+         order mark, so first_line is not about the first line of the file\n+\t but the first line that's not a preprocessor line.  */\n+      first_line = false;\n+\n       if (include_line (line))\n \t{\n \t  current_file->line++;"}, {"sha": "f7283eccab4cafec55133477e52e089768662650", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -1,3 +1,15 @@\n+2007-04-29  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR fortran/31645\n+\t* testsuite/gfortran.dg/bom_error.f90: New test.\n+\t* testsuite/gfortran.dg/bom_include.f90: New test.\n+\t* testsuite/gfortran.dg/bom_UTF16-LE.f90: New test.\n+\t* testsuite/gfortran.dg/bom_UTF16-BE.f90: New test.\n+\t* testsuite/gfortran.dg/bom_UTF-8.f90: New test.\n+\t* testsuite/gfortran.dg/bom_UTF-32.f90: New test.\n+\t* testsuite/gfortran.dg/bom_UTF-8.F90: New test.\n+\t* testsuite/gfortran.dg/bom_include.inc: New file.\n+\n 2007-04-28  Andrew Pinski  <andrew_pinski@playstation.sony.com>\n \n \tPR C++/30221"}, {"sha": "d42430313668e7db324a7321eed7ceb635c4c68f", "filename": "gcc/testsuite/gfortran.dg/bom_UTF-32.f90", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-32.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-32.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-32.f90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449"}, {"sha": "f9d9e88d4780fc3f8207deedff2b59dc0feeac84", "filename": "gcc/testsuite/gfortran.dg/bom_UTF-8.F90", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-8.F90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-8.F90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-8.F90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -0,0 +1,3 @@\n+\ufeffprint *, \"Hello world\"\r\n+end\r\n+! { dg-do compile }\r"}, {"sha": "f9d9e88d4780fc3f8207deedff2b59dc0feeac84", "filename": "gcc/testsuite/gfortran.dg/bom_UTF-8.f90", "status": "added", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF-8.f90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -0,0 +1,3 @@\n+\ufeffprint *, \"Hello world\"\r\n+end\r\n+! { dg-do compile }\r"}, {"sha": "f590e71f0d8f716c60167743cc5219e31a12637c", "filename": "gcc/testsuite/gfortran.dg/bom_UTF16-BE.f90", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF16-BE.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF16-BE.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF16-BE.f90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449"}, {"sha": "29e7ca68271cda276f5cda73a995b05541744700", "filename": "gcc/testsuite/gfortran.dg/bom_UTF16-LE.f90", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF16-LE.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF16-LE.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_UTF16-LE.f90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449"}, {"sha": "7c2c86d18115224d2c1f719e7504957e331e9eef", "filename": "gcc/testsuite/gfortran.dg/bom_error.f90", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_error.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_error.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_error.f90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -0,0 +1,4 @@\n+\ufffd\ufffdprint *, \"Hello world!\"\n+\ufffd\ufffdend ! { dg-error \"Invalid character\" }\n+! { dg-do compile }\n+! { dg-excess-errors \"Unexpected end of file\" }"}, {"sha": "65a2898036e35794bd7880f679775747cc1e7bbd", "filename": "gcc/testsuite/gfortran.dg/bom_include.f90", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_include.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_include.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_include.f90?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -0,0 +1,2 @@\n+! { dg-do compile }\n+include \"bom_include.inc\""}, {"sha": "b30290103dab03361a66c2854124e6d898855dec", "filename": "gcc/testsuite/gfortran.dg/bom_include.inc", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_include.inc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/caef7872f0dc4a62dfc449785974eaa179b0a449/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_include.inc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbom_include.inc?ref=caef7872f0dc4a62dfc449785974eaa179b0a449", "patch": "@@ -0,0 +1,2 @@\n+\ufeffprint *, \"Hello world!\"\n+end"}]}