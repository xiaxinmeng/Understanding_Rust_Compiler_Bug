{"sha": "3df9609a72613e190c828cb991277492eede618b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2RmOTYwOWE3MjYxM2UxOTBjODI4Y2I5OTEyNzc0OTJlZWRlNjE4Yg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2009-10-17T07:28:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-10-17T07:28:13Z"}, "message": "re PR debug/40521 (-g causes GCC to generate .eh_frame)\n\n\tPR debug/40521\n\t* debug.h (struct gcc_debug_hooks): Add assembly_start hook.\n\t* cgraphunit.c (cgraph_optimize): Call it.\n\t* dwarf2out.c (dwarf2out_init): Move .cfi_sections printing into...\n\t(dwarf2out_assembly_start): ... here.  New hook.\n\t(dwarf2out_debug_hooks): Add dwarf2out_assembly_start.\n\t* debug.c (do_nothing_debug_hooks): Do nothing for assembly_start\n\thook.\n\t* dbxout.c (dbx_debug_hooks, xcoff_debug_hooks): Likewise.\n\t* sdbout.c (sdb_debug_hooks): Likewise.\n\t* vmsdbgout.c (vmsdbg_debug_hooks): Add vmsdbgout_assembly_start.\n\t(vmsdbgout_assembly_start): New hook.\n\nFrom-SVN: r152930", "tree": {"sha": "23f3349f6a491c65d7cf0e47085ccdcb36592488", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/23f3349f6a491c65d7cf0e47085ccdcb36592488"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3df9609a72613e190c828cb991277492eede618b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3df9609a72613e190c828cb991277492eede618b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3df9609a72613e190c828cb991277492eede618b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3df9609a72613e190c828cb991277492eede618b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "15f01e4ad6100fad0a4ecd8ee920840edc4459d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15f01e4ad6100fad0a4ecd8ee920840edc4459d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15f01e4ad6100fad0a4ecd8ee920840edc4459d3"}], "stats": {"total": 47, "additions": 47, "deletions": 0}, "files": [{"sha": "007d78e10c6603d09671973df0a8f1273054528e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -1,3 +1,18 @@\n+2009-10-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/40521\n+\t* debug.h (struct gcc_debug_hooks): Add assembly_start hook.\n+\t* cgraphunit.c (cgraph_optimize): Call it.\n+\t* dwarf2out.c (dwarf2out_init): Move .cfi_sections printing into...\n+\t(dwarf2out_assembly_start): ... here.  New hook.\n+\t(dwarf2out_debug_hooks): Add dwarf2out_assembly_start.\n+\t* debug.c (do_nothing_debug_hooks): Do nothing for assembly_start\n+\thook.\n+\t* dbxout.c (dbx_debug_hooks, xcoff_debug_hooks): Likewise.\n+\t* sdbout.c (sdb_debug_hooks): Likewise.\n+\t* vmsdbgout.c (vmsdbg_debug_hooks): Add vmsdbgout_assembly_start.\n+\t(vmsdbgout_assembly_start): New hook.\n+\n 2009-10-17  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* rtl.h (RTL_LOCATION): Fix typo."}, {"sha": "47ee7d9ebcdd78215443f065898f1be41db6a7ed", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -1441,6 +1441,7 @@ cgraph_optimize (void)\n   timevar_pop (TV_CGRAPHOPT);\n \n   /* Output everything.  */\n+  (*debug_hooks->assembly_start) ();\n   if (!quiet_flag)\n     fprintf (stderr, \"Assembling functions:\\n\");\n #ifdef ENABLE_CHECKING"}, {"sha": "b5688d98cf15aedd877aff92f062de095d1bd98e", "filename": "gcc/dbxout.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdbxout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdbxout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdbxout.c?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -346,6 +346,7 @@ const struct gcc_debug_hooks dbx_debug_hooks =\n {\n   dbxout_init,\n   dbxout_finish,\n+  debug_nothing_void,\n   debug_nothing_int_charstar,\n   debug_nothing_int_charstar,\n   dbxout_start_source_file,\n@@ -386,6 +387,7 @@ const struct gcc_debug_hooks xcoff_debug_hooks =\n {\n   dbxout_init,\n   dbxout_finish,\n+  debug_nothing_void,\n   debug_nothing_int_charstar,\n   debug_nothing_int_charstar,\n   dbxout_start_source_file,"}, {"sha": "c413595078b8dcfc00ff724b51b432b966151f10", "filename": "gcc/debug.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdebug.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdebug.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdebug.c?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -27,6 +27,7 @@ const struct gcc_debug_hooks do_nothing_debug_hooks =\n {\n   debug_nothing_charstar,\n   debug_nothing_charstar,\n+  debug_nothing_void,\n   debug_nothing_int_charstar,\n   debug_nothing_int_charstar,\n   debug_nothing_int_charstar,"}, {"sha": "ef611d43572f8340c9bc012a5422968e5b6f6224", "filename": "gcc/debug.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdebug.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdebug.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdebug.h?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -31,6 +31,10 @@ struct gcc_debug_hooks\n   /* Output debug symbols.  */\n   void (* finish) (const char *main_filename);\n \n+  /* Called from cgraph_optimize before starting to assemble\n+     functions/variables/toplevel asms.  */\n+  void (* assembly_start) (void);\n+\n   /* Macro defined on line LINE with name and expansion TEXT.  */\n   void (* define) (unsigned int line, const char *text);\n "}, {"sha": "ba59251d66b095e5d1dcc7983f82161734dd0625", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -5401,6 +5401,7 @@ static int output_indirect_string (void **, void *);\n \n static void dwarf2out_init (const char *);\n static void dwarf2out_finish (const char *);\n+static void dwarf2out_assembly_start (void);\n static void dwarf2out_define (unsigned int, const char *);\n static void dwarf2out_undef (unsigned int, const char *);\n static void dwarf2out_start_source_file (unsigned, const char *);\n@@ -5427,6 +5428,7 @@ const struct gcc_debug_hooks dwarf2_debug_hooks =\n {\n   dwarf2out_init,\n   dwarf2out_finish,\n+  dwarf2out_assembly_start,\n   dwarf2out_define,\n   dwarf2out_undef,\n   dwarf2out_start_source_file,\n@@ -20392,6 +20394,14 @@ dwarf2out_init (const char *filename ATTRIBUTE_UNUSED)\n       ASM_OUTPUT_LABEL (asm_out_file, cold_text_section_label);\n     }\n \n+}\n+\n+/* Called before cgraph_optimize starts outputtting functions, variables\n+   and toplevel asms into assembly.  */\n+\n+static void\n+dwarf2out_assembly_start (void)\n+{\n   if (HAVE_GAS_CFI_SECTIONS_DIRECTIVE && dwarf2out_do_cfi_asm ())\n     {\n #ifndef TARGET_UNWIND_INFO\n@@ -21274,6 +21284,7 @@ const struct gcc_debug_hooks dwarf2_debug_hooks =\n {\n   0,\t\t/* init */\n   0,\t\t/* finish */\n+  0,\t\t/* assembly_start */\n   0,\t\t/* define */\n   0,\t\t/* undef */\n   0,\t\t/* start_source_file */"}, {"sha": "e7d52a63c70346691a2c27d5eb928e11800ca511", "filename": "gcc/sdbout.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fsdbout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fsdbout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsdbout.c?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -307,6 +307,7 @@ const struct gcc_debug_hooks sdb_debug_hooks =\n {\n   sdbout_init,\t\t\t         /* init */\n   sdbout_finish,\t\t         /* finish */\n+  debug_nothing_void,\t\t\t /* assembly_start */\n   debug_nothing_int_charstar,\t         /* define */\n   debug_nothing_int_charstar,\t         /* undef */\n   sdbout_start_source_file,\t         /* start_source_file */\n@@ -1705,6 +1706,7 @@ const struct gcc_debug_hooks sdb_debug_hooks =\n {\n   0,\t\t/* init */\n   0,\t\t/* finish */\n+  0,\t\t/* assembly_start */\n   0,\t\t/* define */\n   0,\t\t/* undef */\n   0,\t\t/* start_source_file */"}, {"sha": "b16e76e61c06de17d495eed11f96b9dea58623f9", "filename": "gcc/vmsdbgout.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3df9609a72613e190c828cb991277492eede618b/gcc%2Fvmsdbgout.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3df9609a72613e190c828cb991277492eede618b/gcc%2Fvmsdbgout.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvmsdbgout.c?ref=3df9609a72613e190c828cb991277492eede618b", "patch": "@@ -168,6 +168,7 @@ static int write_srccorrs (int);\n \n static void vmsdbgout_init (const char *);\n static void vmsdbgout_finish (const char *);\n+static void vmsdbgout_assembly_start (void);\n static void vmsdbgout_define (unsigned int, const char *);\n static void vmsdbgout_undef (unsigned int, const char *);\n static void vmsdbgout_start_source_file (unsigned int, const char *);\n@@ -190,6 +191,7 @@ static void vmsdbgout_abstract_function (tree);\n const struct gcc_debug_hooks vmsdbg_debug_hooks\n = {vmsdbgout_init,\n    vmsdbgout_finish,\n+   vmsdbgout_assembly_start,\n    vmsdbgout_define,\n    vmsdbgout_undef,\n    vmsdbgout_start_source_file,\n@@ -1617,6 +1619,15 @@ vmsdbgout_init (const char *main_input_filename)\n \n /* Not implemented in VMS Debug.  */\n \n+static void\n+vmsdbgout_assembly_start (void)\n+{\n+  if (write_symbols == VMS_AND_DWARF2_DEBUG)\n+    (*dwarf2_debug_hooks.assembly_start) ();\n+}\n+\n+/* Not implemented in VMS Debug.  */\n+\n static void\n vmsdbgout_define (unsigned int lineno, const char *buffer)\n {"}]}