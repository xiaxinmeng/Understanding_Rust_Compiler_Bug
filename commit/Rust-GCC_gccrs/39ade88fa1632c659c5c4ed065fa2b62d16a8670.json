{"sha": "39ade88fa1632c659c5c4ed065fa2b62d16a8670", "node_id": "C_kwDOANBUbNoAKDM5YWRlODhmYTE2MzJjNjU5YzVjNGVkMDY1ZmEyYjYyZDE2YTg2NzA", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-01-24T20:29:35Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2023-01-24T22:11:52Z"}, "message": "c++: static lambda in template [PR108526]\n\ntsubst_lambda_expr uses build_memfn_type to build a METHOD_TYPE for the new\nlamba op().  This is not what we want for a C++23 static op(), but since we\nalso use that METHOD_TYPE to communicate the closure type down to\ntsubst_function_decl, let's wait and turn it back at that point.\n\n\tPR c++/108526\n\ngcc/cp/ChangeLog:\n\n\t* pt.cc (tsubst_function_decl): Handle static lambda.\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp23/static-operator-call5.C: New test.", "tree": {"sha": "e0c78eb5f4e883d2c314a33cca76fbf1ebe3939d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e0c78eb5f4e883d2c314a33cca76fbf1ebe3939d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39ade88fa1632c659c5c4ed065fa2b62d16a8670", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39ade88fa1632c659c5c4ed065fa2b62d16a8670", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39ade88fa1632c659c5c4ed065fa2b62d16a8670", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39ade88fa1632c659c5c4ed065fa2b62d16a8670/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1c407dc088231ba5f2cc63d9278f4b797db48de1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c407dc088231ba5f2cc63d9278f4b797db48de1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c407dc088231ba5f2cc63d9278f4b797db48de1"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "51fc246ed71ae73ce62c3655aec5c401c95b16ef", "filename": "gcc/cp/pt.cc", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39ade88fa1632c659c5c4ed065fa2b62d16a8670/gcc%2Fcp%2Fpt.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39ade88fa1632c659c5c4ed065fa2b62d16a8670/gcc%2Fcp%2Fpt.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.cc?ref=39ade88fa1632c659c5c4ed065fa2b62d16a8670", "patch": "@@ -14306,6 +14306,11 @@ tsubst_function_decl (tree t, tree args, tsubst_flags_t complain,\n   tree ctx = closure ? closure : DECL_CONTEXT (t);\n   bool member = ctx && TYPE_P (ctx);\n \n+  /* If this is a static lambda, remove the 'this' pointer added in\n+     tsubst_lambda_expr now that we know the closure type.  */\n+  if (lambda_fntype && DECL_STATIC_FUNCTION_P (t))\n+    lambda_fntype = static_fn_type (lambda_fntype);\n+\n   if (member && !closure)\n     ctx = tsubst_aggr_type (ctx, args,\n \t\t\t    complain, t, /*entering_scope=*/1);"}, {"sha": "ae022d0b9711ae70da5c90640fb0491d0844b912", "filename": "gcc/testsuite/g++.dg/cpp23/static-operator-call5.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39ade88fa1632c659c5c4ed065fa2b62d16a8670/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp23%2Fstatic-operator-call5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39ade88fa1632c659c5c4ed065fa2b62d16a8670/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp23%2Fstatic-operator-call5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp23%2Fstatic-operator-call5.C?ref=39ade88fa1632c659c5c4ed065fa2b62d16a8670", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/108526\n+// { dg-do compile { target c++23 } }\n+\n+template<class> void f()\n+{\n+  auto a = [] (auto x) static { return x; };\n+}\n+template void f<int>();"}]}