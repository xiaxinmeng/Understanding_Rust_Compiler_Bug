{"sha": "dad16761d163a5854d55f27f2e5212d1ade8b799", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGFkMTY3NjFkMTYzYTU4NTRkNTVmMjdmMmU1MjEyZDFhZGU4Yjc5OQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2014-04-02T08:26:57Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2014-04-02T08:26:57Z"}, "message": "re PR middle-end/60729 (Compiler failure for combination of -ftrapv and -O3: compiler error: in prepare_cmp_insn)\n\n2014-04-02  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/60729\n\t* optabs.c (expand_abs_nojump): Honor flag_trapv only for\n\tMODE_INTs.  Properly use negv_optab.\n\t(expand_abs): Likewise.\n\n\t* g++.dg/vect/pr60729.cc: New testcase.\n\nFrom-SVN: r209012", "tree": {"sha": "5acdcf8242a39258c75e71d48d441096c4ada2fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5acdcf8242a39258c75e71d48d441096c4ada2fe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dad16761d163a5854d55f27f2e5212d1ade8b799", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dad16761d163a5854d55f27f2e5212d1ade8b799", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dad16761d163a5854d55f27f2e5212d1ade8b799", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dad16761d163a5854d55f27f2e5212d1ade8b799/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "21b624f069b9e5b9c088f709cbc11704377e7a59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21b624f069b9e5b9c088f709cbc11704377e7a59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21b624f069b9e5b9c088f709cbc11704377e7a59"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "cf26a4128b61281ee25a40e6714b83b95e8385b6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dad16761d163a5854d55f27f2e5212d1ade8b799", "patch": "@@ -1,3 +1,10 @@\n+2014-04-02  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/60729\n+\t* optabs.c (expand_abs_nojump): Honor flag_trapv only for\n+\tMODE_INTs.  Properly use negv_optab.\n+\t(expand_abs): Likewise.\n+\n 2014-04-02  Richard Biener  <rguenther@suse.de>\n \n \tPR bootstrap/60719"}, {"sha": "54f07ab02b9a26a9ac7cdd1e80f279aa77cbd427", "filename": "gcc/optabs.c", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2Foptabs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2Foptabs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foptabs.c?ref=dad16761d163a5854d55f27f2e5212d1ade8b799", "patch": "@@ -3384,7 +3384,8 @@ expand_abs_nojump (enum machine_mode mode, rtx op0, rtx target,\n {\n   rtx temp;\n \n-  if (! flag_trapv)\n+  if (GET_MODE_CLASS (mode) != MODE_INT\n+      || ! flag_trapv)\n     result_unsignedp = 1;\n \n   /* First try to do it with a special abs instruction.  */\n@@ -3407,7 +3408,8 @@ expand_abs_nojump (enum machine_mode mode, rtx op0, rtx target,\n     {\n       rtx last = get_last_insn ();\n \n-      temp = expand_unop (mode, neg_optab, op0, NULL_RTX, 0);\n+      temp = expand_unop (mode, result_unsignedp ? neg_optab : negv_optab,\n+\t\t\t  op0, NULL_RTX, 0);\n       if (temp != 0)\n \ttemp = expand_binop (mode, smax_optab, op0, temp, target, 0,\n \t\t\t     OPTAB_WIDEN);\n@@ -3449,7 +3451,8 @@ expand_abs (enum machine_mode mode, rtx op0, rtx target,\n {\n   rtx temp, op1;\n \n-  if (! flag_trapv)\n+  if (GET_MODE_CLASS (mode) != MODE_INT\n+      || ! flag_trapv)\n     result_unsignedp = 1;\n \n   temp = expand_abs_nojump (mode, op0, target, result_unsignedp);"}, {"sha": "5e3bc26c8e30cc2d1a14e872281c9e33f833f534", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dad16761d163a5854d55f27f2e5212d1ade8b799", "patch": "@@ -1,3 +1,8 @@\n+2014-04-02  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/60729\n+\t* g++.dg/vect/pr60729.cc: New testcase.\n+\n 2014-04-01  Fabien Ch\u00eane  <fabien@gcc.gnu.org>\n \n         * g++.dg/init/ctor4.C: Adjust."}, {"sha": "fd472c50af2202f2f8bf51152e301605b77e7958", "filename": "gcc/testsuite/g++.dg/vect/pr60729.cc", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr60729.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dad16761d163a5854d55f27f2e5212d1ade8b799/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr60729.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fvect%2Fpr60729.cc?ref=dad16761d163a5854d55f27f2e5212d1ade8b799", "patch": "@@ -0,0 +1,10 @@\n+// { dg-do compile }\n+// { dg-additional-options \"-ftrapv\" }\n+\n+void doSomething(int dim, double *Y, double *A) \n+{\n+  for (int k=0; k<dim; k++) \n+    Y[k] += __builtin_fabs (A[k]);\n+}\n+\n+// { dg-final { cleanup-tree-dump \"vect\" } }"}]}