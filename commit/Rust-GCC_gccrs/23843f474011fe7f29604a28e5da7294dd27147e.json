{"sha": "23843f474011fe7f29604a28e5da7294dd27147e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjM4NDNmNDc0MDExZmU3ZjI5NjA0YTI4ZTVkYTcyOTRkZDI3MTQ3ZQ==", "commit": {"author": {"name": "Jeff Law", "email": "law@redhat.com", "date": "2019-03-22T18:14:56Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2019-03-22T18:14:56Z"}, "message": "re PR rtl-optimization/87761 ([MIPS] New FAIL: gcc.target/mips/fix-r4000-10.c   -O1 start with r265398)\n\n\tPR rtl-optimization/87761\n\t* config/mips/mips-protos.h (mips_split_move): Add new argument.\n\t(mips_emit_move_or_split): Pass NULL for INSN into mips_split_move.\n\t(mips_split_move): Accept new INSN argument.  Try to forward SRC\n\tinto the next instruction.\n\t(mips_split_move_insn): Pass INSN through to mips_split_move.\n\nFrom-SVN: r269880", "tree": {"sha": "01b0c27a53f6ad772155a05def557b35f3fe3768", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/01b0c27a53f6ad772155a05def557b35f3fe3768"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/23843f474011fe7f29604a28e5da7294dd27147e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23843f474011fe7f29604a28e5da7294dd27147e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23843f474011fe7f29604a28e5da7294dd27147e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23843f474011fe7f29604a28e5da7294dd27147e/comments", "author": null, "committer": null, "parents": [{"sha": "c07a0a226b6904995d785662bab74c2c68481539", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c07a0a226b6904995d785662bab74c2c68481539", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c07a0a226b6904995d785662bab74c2c68481539"}], "stats": {"total": 35, "additions": 30, "deletions": 5}, "files": [{"sha": "7e31779f7c4d19c035846420f096f65c4f6c9e50", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23843f474011fe7f29604a28e5da7294dd27147e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23843f474011fe7f29604a28e5da7294dd27147e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=23843f474011fe7f29604a28e5da7294dd27147e", "patch": "@@ -1,3 +1,12 @@\n+2019-02-26  Jeff Law  <law@redhat.com>\n+\n+\tPR rtl-optimization/87761\n+\t* config/mips/mips-protos.h (mips_split_move): Add new argument.\n+\t(mips_emit_move_or_split): Pass NULL for INSN into mips_split_move.\n+\t(mips_split_move): Accept new INSN argument.  Try to forward SRC\n+\tinto the next instruction.\n+\t(mips_split_move_insn): Pass INSN through to mips_split_move.\n+\n 2019-03-22  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/89676"}, {"sha": "32070fdb8c9cb9efc961da2fa8f6f3e931848c85", "filename": "gcc/config/mips/mips-protos.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23843f474011fe7f29604a28e5da7294dd27147e/gcc%2Fconfig%2Fmips%2Fmips-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23843f474011fe7f29604a28e5da7294dd27147e/gcc%2Fconfig%2Fmips%2Fmips-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips-protos.h?ref=23843f474011fe7f29604a28e5da7294dd27147e", "patch": "@@ -214,7 +214,7 @@ extern bool mips_legitimize_move (machine_mode, rtx, rtx);\n \n extern rtx mips_subword (rtx, bool);\n extern bool mips_split_move_p (rtx, rtx, enum mips_split_type);\n-extern void mips_split_move (rtx, rtx, enum mips_split_type);\n+extern void mips_split_move (rtx, rtx, enum mips_split_type, rtx);\n extern bool mips_split_move_insn_p (rtx, rtx, rtx);\n extern void mips_split_move_insn (rtx, rtx, rtx);\n extern void mips_split_128bit_move (rtx, rtx);"}, {"sha": "1de33b28c385d32263a687d2b8ae66b7993a861a", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 20, "deletions": 4, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23843f474011fe7f29604a28e5da7294dd27147e/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23843f474011fe7f29604a28e5da7294dd27147e/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=23843f474011fe7f29604a28e5da7294dd27147e", "patch": "@@ -3031,7 +3031,7 @@ static void\n mips_emit_move_or_split (rtx dest, rtx src, enum mips_split_type split_type)\n {\n   if (mips_split_move_p (dest, src, split_type))\n-    mips_split_move (dest, src, split_type);\n+    mips_split_move (dest, src, split_type, NULL);\n   else\n     mips_emit_move (dest, src);\n }\n@@ -4780,10 +4780,11 @@ mips_split_move_p (rtx dest, rtx src, enum mips_split_type split_type)\n }\n \n /* Split a move from SRC to DEST, given that mips_split_move_p holds.\n-   SPLIT_TYPE describes the split condition.  */\n+   SPLIT_TYPE describes the split condition.  INSN is the insn being\n+   split, if we know it, NULL otherwise.  */\n \n void\n-mips_split_move (rtx dest, rtx src, enum mips_split_type split_type)\n+mips_split_move (rtx dest, rtx src, enum mips_split_type split_type, rtx insn_)\n {\n   rtx low_dest;\n \n@@ -4843,6 +4844,21 @@ mips_split_move (rtx dest, rtx src, enum mips_split_type split_type)\n \t  mips_emit_move (mips_subword (dest, true), mips_subword (src, true));\n \t}\n     }\n+\n+  /* This is a hack.  See if the next insn uses DEST and if so, see if we\n+     can forward SRC for DEST.  This is most useful if the next insn is a\n+     simple store.   */\n+  rtx_insn *insn = (rtx_insn *)insn_;\n+  if (insn)\n+    {\n+      rtx_insn *next = next_nonnote_nondebug_insn_bb (insn);\n+      if (next)\n+\t{\n+\t  rtx set = single_set (next);\n+\t  if (set && SET_SRC (set) == dest)\n+\t    validate_change (next, &SET_SRC (set), src, false);\n+\t}\n+    }\n }\n \n /* Return the split type for instruction INSN.  */\n@@ -5070,7 +5086,7 @@ mips_split_move_insn_p (rtx dest, rtx src, rtx insn)\n void\n mips_split_move_insn (rtx dest, rtx src, rtx insn)\n {\n-  mips_split_move (dest, src, mips_insn_split_type (insn));\n+  mips_split_move (dest, src, mips_insn_split_type (insn), insn);\n }\n \f\n /* Return the appropriate instructions to move SRC into DEST.  Assume"}]}