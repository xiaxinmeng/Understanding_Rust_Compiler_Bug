{"sha": "cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2ZiOTFiNjdiODg3ZDU5YmExZDlmZmYwOGZjZDM4ZjhiMTZkNzY2Zg==", "commit": {"author": {"name": "Giovanni Bajo", "email": "giovannibajo@gcc.gnu.org", "date": "2004-01-10T01:18:08Z"}, "committer": {"name": "Giovanni Bajo", "email": "giovannibajo@gcc.gnu.org", "date": "2004-01-10T01:18:08Z"}, "message": "DR 337 PR c++/9256\n\n\tDR 337\n\tPR c++/9256\n\t* pt.c (tsubst): Substitution must fail if we are attempting to\n\tcreate an array with element type that is an abstract class type.\n\t* decl.c (cp_finish_decl): Strip pointers and array types recursively\n\tbefore calling abstract_virtuals_error.\n\nFrom-SVN: r75618", "tree": {"sha": "d98dd18782bf56052dc1f01bd9106a533a6c3f95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d98dd18782bf56052dc1f01bd9106a533a6c3f95"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/comments", "author": {"login": "rasky", "id": 1014109, "node_id": "MDQ6VXNlcjEwMTQxMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1014109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasky", "html_url": "https://github.com/rasky", "followers_url": "https://api.github.com/users/rasky/followers", "following_url": "https://api.github.com/users/rasky/following{/other_user}", "gists_url": "https://api.github.com/users/rasky/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasky/subscriptions", "organizations_url": "https://api.github.com/users/rasky/orgs", "repos_url": "https://api.github.com/users/rasky/repos", "events_url": "https://api.github.com/users/rasky/events{/privacy}", "received_events_url": "https://api.github.com/users/rasky/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rasky", "id": 1014109, "node_id": "MDQ6VXNlcjEwMTQxMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1014109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasky", "html_url": "https://github.com/rasky", "followers_url": "https://api.github.com/users/rasky/followers", "following_url": "https://api.github.com/users/rasky/following{/other_user}", "gists_url": "https://api.github.com/users/rasky/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasky/subscriptions", "organizations_url": "https://api.github.com/users/rasky/orgs", "repos_url": "https://api.github.com/users/rasky/repos", "events_url": "https://api.github.com/users/rasky/events{/privacy}", "received_events_url": "https://api.github.com/users/rasky/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f88e4715761877b42c9459b8c339fa75fbb28103", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f88e4715761877b42c9459b8c339fa75fbb28103", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f88e4715761877b42c9459b8c339fa75fbb28103"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "3dc569c0596b103ce8e9891b20063da8d9776a21", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "patch": "@@ -1,3 +1,12 @@\n+2004-01-10  Giovanni Bajo  <giovannibajo@gcc.gnu.org>\n+\n+\tDR 337\n+\tPR c++/9256\n+\t* pt.c (tsubst): Substitution must fail if we are attempting to \n+\tcreate an array with element type that is an abstract class type.\n+\t* decl.c (cp_finish_decl): Strip pointers and array types recursively\n+\tbefore calling abstract_virtuals_error.\n+\n 2004-01-09  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* name-lookup.c (qualified_lookup_using_namespace): Consider"}, {"sha": "3ce6d0a4b6c0c3a7c032b307579cea398daf2b7d", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "patch": "@@ -4879,8 +4879,19 @@ cp_finish_decl (tree decl, tree init, tree asmspec_tree, int flags)\n \t  || TREE_CODE (type) == METHOD_TYPE)\n \tabstract_virtuals_error (decl,\n \t\t\t\t strip_array_types (TREE_TYPE (type)));\n+      else if (POINTER_TYPE_P (type) || TREE_CODE (type) == ARRAY_TYPE)\n+      {\n+\t/* If it's either a pointer or an array type, strip through all\n+\t   of them but the last one. If the last is an array type, issue \n+\t   an error if the element type is abstract.  */\n+\twhile (POINTER_TYPE_P (TREE_TYPE (type)) \n+\t       || TREE_CODE (TREE_TYPE (type)) == ARRAY_TYPE)\n+\t  type = TREE_TYPE (type);\n+\tif (TREE_CODE (type) == ARRAY_TYPE)\n+\t  abstract_virtuals_error (decl, TREE_TYPE (type));\n+      }\n       else\n-\tabstract_virtuals_error (decl, strip_array_types (type));\n+\tabstract_virtuals_error (decl, type);\n \n       if (TREE_CODE (decl) == FUNCTION_DECL \n \t  || TREE_TYPE (decl) == error_mark_node)"}, {"sha": "040476c2181d9dd185f5439eb9a541739623d74e", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfb91b67b887d59ba1d9fff08fcd38f8b16d766f/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=cfb91b67b887d59ba1d9fff08fcd38f8b16d766f", "patch": "@@ -6975,7 +6975,8 @@ tsubst (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \t   The deduction may fail for any of the following reasons: \n \n \t   -- Attempting to create an array with an element type that\n-\t      is void, a function type, or a reference type.  */\n+\t      is void, a function type, or a reference type, or [DR337] \n+\t      an abstract class type.  */\n \tif (TREE_CODE (type) == VOID_TYPE \n \t    || TREE_CODE (type) == FUNCTION_TYPE\n \t    || TREE_CODE (type) == REFERENCE_TYPE)\n@@ -6984,6 +6985,13 @@ tsubst (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n \t      error (\"creating array of `%T'\", type);\n \t    return error_mark_node;\n \t  }\n+\tif (CLASS_TYPE_P (type) && CLASSTYPE_PURE_VIRTUALS (type))\n+\t  {\n+\t    if (complain & tf_error)\n+\t      error (\"creating array of `%T', which is an abstract class type\", \n+\t\t     type);\n+\t    return error_mark_node;\t    \n+\t  }\n \n \tr = build_cplus_array_type (type, domain);\n \treturn r;"}]}