{"sha": "4c837a1e98526a4835700c70dcee15c62e6afbd2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGM4MzdhMWU5ODUyNmE0ODM1NzAwYzcwZGNlZTE1YzYyZTZhZmJkMg==", "commit": {"author": {"name": "David S. Miller", "email": "davem@sunset.davemloft.net", "date": "2006-03-02T22:47:02Z"}, "committer": {"name": "David S. Miller", "email": "davem@gcc.gnu.org", "date": "2006-03-02T22:47:02Z"}, "message": "Sun Niagara specific optimizations.\n\n\t* config.gcc: Recognize niagara as target.\n\t* config/sparc/sparc.h (SPARC_RELAXED_ORDERING): Mention Niagara.\n\t(TARGET_CPU_niagara): Define.\n\t(CPP_CPU64_DEFAULT_SPEC): Define __sparc_v9__ for Niagara.\n\t(ASM_CPU64_DEFAULT_SPEC): Pass -Av9b for Niagara.\n\t(CPP_CPU_SPEC): Handle -mcpu=niagara.\n\t(ASM_CPU_SPEC): Likewise.\n\t(PROCESSOR_NIAGARA): New enum entry.\n\t(REGISTER_MOVE_COST): Handle Niagara.\n\t(BRANCH_COST, PREFETCH_BLOCK, SIMULTANEOUS_PREFETCHES): Likewise.\n\t* config/sparc/sparc.c (niagara_costs): New processor_costs entry.\n\t(sparc_override_options): Recognize \"niagara\", set appropriate\n\tdefault MASK_* values for it, and align functions to 32-bytes\n\tby default just like ULTRASPARC/ULTRASPARC3.\n\t(sparc_initialize_trampoline): Handle niagara like ultrasparc.\n\t(sparc64_initialize_trampoline): Likewise.\n\t(sparc_use_sched_lookahead): Use zero for niagara.\n\t(sparc_issue_rate): Use one for niagara.\n\t* config/sparc/niagara.md: New file.\n\t* config/sparc/sparc.md: Include it.\n\t* config/sparc/sol2-bi.h (CPP_CPU64_DEFAULT_SPEC,\n\tASM_CPU32_DEFAULT_SPEC, ASM_CPU64_DEFAULT_SPEC): Set appropriately\n\twhen default cpu is niagara.\n\t(CPP_CPU_SPEC): Handle -mcpu=niagara.\n\t(ASM_CPU_SPEC): Likewise.\n\t* config/sparc/sol2.h (ASM_CPU_DEFAULT_SPEC): Set appropriately\n\twhen default cpu is niagara.\n\t(ASM_CPU_SPEC): Handle -mcpu=niagara.\n\t* config/sparc/linux64.h: Handle a default of TARGET_CPU_niagara\n\tjust like v9/ultrasparc/ultrasparc3.\n\t* doc/invoke.texi: Add documentation for \"niagara\" and improve\n\texisting documentation for ultrasparc variants.\n\nFrom-SVN: r111648", "tree": {"sha": "2f68ab667ce3481cc45315d855ec15047d6b4d5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f68ab667ce3481cc45315d855ec15047d6b4d5d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4c837a1e98526a4835700c70dcee15c62e6afbd2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c837a1e98526a4835700c70dcee15c62e6afbd2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4c837a1e98526a4835700c70dcee15c62e6afbd2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4c837a1e98526a4835700c70dcee15c62e6afbd2/comments", "author": null, "committer": null, "parents": [{"sha": "2434ab1da2a1f6230207f5e57ef2f3beb3baa6cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2434ab1da2a1f6230207f5e57ef2f3beb3baa6cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2434ab1da2a1f6230207f5e57ef2f3beb3baa6cd"}], "stats": {"total": 284, "additions": 257, "deletions": 27}, "files": [{"sha": "53fbd75baf70274a453bf589ca492f9068552da7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -1,3 +1,39 @@\n+2006-03-02  David S. Miller  <davem@sunset.davemloft.net>\n+\n+\tSun Niagara specific optimizations.\n+\t* config.gcc: Recognize niagara as target.\n+\t* config/sparc/sparc.h (SPARC_RELAXED_ORDERING): Mention Niagara.\n+\t(TARGET_CPU_niagara): Define.\n+\t(CPP_CPU64_DEFAULT_SPEC): Define __sparc_v9__ for Niagara.\n+\t(ASM_CPU64_DEFAULT_SPEC): Pass -Av9b for Niagara.\n+\t(CPP_CPU_SPEC): Handle -mcpu=niagara.\n+\t(ASM_CPU_SPEC): Likewise.\n+\t(PROCESSOR_NIAGARA): New enum entry.\n+\t(REGISTER_MOVE_COST): Handle Niagara.\n+\t(BRANCH_COST, PREFETCH_BLOCK, SIMULTANEOUS_PREFETCHES): Likewise.\n+\t* config/sparc/sparc.c (niagara_costs): New processor_costs entry.\n+\t(sparc_override_options): Recognize \"niagara\", set appropriate\n+\tdefault MASK_* values for it, and align functions to 32-bytes\n+\tby default just like ULTRASPARC/ULTRASPARC3.\n+\t(sparc_initialize_trampoline): Handle niagara like ultrasparc.\n+\t(sparc64_initialize_trampoline): Likewise.\n+\t(sparc_use_sched_lookahead): Use zero for niagara.\n+\t(sparc_issue_rate): Use one for niagara.\n+\t* config/sparc/niagara.md: New file.\n+\t* config/sparc/sparc.md: Include it.\n+\t* config/sparc/sol2-bi.h (CPP_CPU64_DEFAULT_SPEC,\n+\tASM_CPU32_DEFAULT_SPEC, ASM_CPU64_DEFAULT_SPEC): Set appropriately\n+\twhen default cpu is niagara.\n+\t(CPP_CPU_SPEC): Handle -mcpu=niagara.\n+\t(ASM_CPU_SPEC): Likewise.\n+\t* config/sparc/sol2.h (ASM_CPU_DEFAULT_SPEC): Set appropriately\n+\twhen default cpu is niagara.\n+\t(ASM_CPU_SPEC): Handle -mcpu=niagara.\n+\t* config/sparc/linux64.h: Handle a default of TARGET_CPU_niagara\n+\tjust like v9/ultrasparc/ultrasparc3.\n+\t* doc/invoke.texi: Add documentation for \"niagara\" and improve\n+\texisting documentation for ultrasparc variants.\n+\t\n 2006-03-02  Diego Novillo  <dnovillo@redhat.com>\n \n \t* tree-ssa-operands.c (update_stmt_operands): Update documentation."}, {"sha": "403fb1039cc8e08c42f8744fb0581777a7e52c99", "filename": "gcc/config.gcc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig.gcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig.gcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.gcc?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -2830,7 +2830,7 @@ case \"${target}\" in\n \t\t\t\"\" | sparc | sparcv9 | sparc64 | sparc86x \\\n \t\t\t| v7 | cypress | v8 | supersparc | sparclite | f930 \\\n \t\t\t| f934 | hypersparc | sparclite86x | sparclet | tsc701 \\\n-\t\t\t| v9 | ultrasparc | ultrasparc3)\n+\t\t\t| v9 | ultrasparc | ultrasparc3 | niagara)\n \t\t\t\t# OK\n \t\t\t\t;;\n \t\t\t*)"}, {"sha": "b0ddf4b3d3bea980d3006360d92b080ad4e99687", "filename": "gcc/config/sparc/linux64.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Flinux64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Flinux64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Flinux64.h?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -43,7 +43,8 @@ Boston, MA 02110-1301, USA.  */\n \n #if TARGET_CPU_DEFAULT == TARGET_CPU_v9 \\\n     || TARGET_CPU_DEFAULT == TARGET_CPU_ultrasparc \\\n-    || TARGET_CPU_DEFAULT == TARGET_CPU_ultrasparc3\n+    || TARGET_CPU_DEFAULT == TARGET_CPU_ultrasparc3 \\\n+    || TARGET_CPU_DEFAULT == TARGET_CPU_niagara\n /* A 64 bit v9 compiler with stack-bias,\n    in a Medium/Low code model environment.  */\n "}, {"sha": "ea431b521d65da1f37f8470d2d1b6f7307033b57", "filename": "gcc/config/sparc/niagara.md", "status": "added", "additions": 119, "deletions": 0, "changes": 119, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fniagara.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fniagara.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fniagara.md?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -0,0 +1,119 @@\n+;; Scheduling description for Niagara.\n+;;   Copyright (C) 2006 Free Software Foundation, Inc.\n+;;\n+;; This file is part of GCC.\n+;;\n+;; GCC is free software; you can redistribute it and/or modify\n+;; it under the terms of the GNU General Public License as published by\n+;; the Free Software Foundation; either version 2, or (at your option)\n+;; any later version.\n+;;\n+;; GCC is distributed in the hope that it will be useful,\n+;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n+;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+;; GNU General Public License for more details.\n+;;\n+;; You should have received a copy of the GNU General Public License\n+;; along with GCC; see the file COPYING.  If not, write to\n+;; the Free Software Foundation, 51 Franklin Street, Fifth Floor,\n+;; Boston, MA 02110-1301, USA.\n+\n+;; Niagara is a single-issue processor.\n+\n+(define_automaton \"niagara_0\")\n+\n+(define_cpu_unit \"niag_pipe\" \"niagara_0\")\n+\n+(define_insn_reservation \"niag_5cycle\" 5\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"multi,flushw,iflush,trap\"))\n+  \"niag_pipe*5\")\n+\n+(define_insn_reservation \"niag_4cycle\" 4\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"savew\"))\n+  \"niag_pipe*4\")\n+\n+/* Most basic operations are single-cycle. */\n+(define_insn_reservation \"niag_ialu\" 1\n+ (and (eq_attr \"cpu\" \"niagara\")\n+   (eq_attr \"type\" \"ialu,shift,compare,cmove\"))\n+ \"niag_pipe\")\n+\n+(define_insn_reservation \"niag_imul\" 11\n+ (and (eq_attr \"cpu\" \"niagara\")\n+   (eq_attr \"type\" \"imul\"))\n+ \"niag_pipe*11\")\n+\n+(define_insn_reservation \"niag_idiv\" 72\n+ (and (eq_attr \"cpu\" \"niagara\")\n+   (eq_attr \"type\" \"idiv\"))\n+ \"niag_pipe*72\")\n+\n+(define_insn_reservation \"niag_branch\" 3\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"call,sibcall,call_no_delay_slot,uncond_branch,branch\"))\n+  \"niag_pipe*3\")\n+\n+(define_insn_reservation \"niag_3cycle_load\" 3\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"load\"))\n+  \"niag_pipe*3\")\n+\n+(define_insn_reservation \"niag_9cycle_load\" 9\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpload\"))\n+  \"niag_pipe*9\")\n+\n+(define_insn_reservation \"niag_1cycle_store\" 1\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"store\"))\n+  \"niag_pipe\")\n+\n+(define_insn_reservation \"niag_8cycle_store\" 8\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpstore\"))\n+  \"niag_pipe*8\")\n+\n+/* Things incorrectly modelled here:\n+ *  FPADD{s,d}: 26 cycles\n+ *  FPSUB{s,d}: 26 cycles\n+ *  FABSD: 26 cycles\n+ *  F{s,d}TO{s,d}: 26 cycles\n+ *  F{s,d}TO{i,x}: 26 cycles\n+ *  FSMULD: 29 cycles\n+ */\n+(define_insn_reservation \"niag_fmov\" 8\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpmove,fpcmove,fpcrmove\"))\n+  \"niag_pipe*8\")\n+\n+(define_insn_reservation \"niag_fpcmp\" 26\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpcmp\"))\n+  \"niag_pipe*26\")\n+\n+(define_insn_reservation \"niag_fmult\" 29\n+ (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpmul\"))\n+  \"niag_pipe*29\")\n+\n+(define_insn_reservation \"niag_fdivs\" 54\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpdivs\"))\n+  \"niag_pipe*54\")\n+\n+(define_insn_reservation \"niag_fdivd\" 83\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fpdivd\"))\n+  \"niag_pipe*83\")\n+\n+/* Things incorrectly modelled here:\n+ *  FPADD{16,32}: 10 cycles\n+ *  FPSUB{16,32}: 10 cycles\n+ *  FALIGNDATA: 10 cycles\n+ */\n+(define_insn_reservation \"niag_vis\" 8\n+  (and (eq_attr \"cpu\" \"niagara\")\n+    (eq_attr \"type\" \"fga,fgm_pack,fgm_mul,fgm_cmp,fgm_pdist\"))\n+  \"niag_pipe*8\")"}, {"sha": "87d14f0f1cd6ba28e02ba6d68b80c8bc76b3a29d", "filename": "gcc/config/sparc/sol2-bi.h", "status": "modified", "additions": 12, "deletions": 2, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsol2-bi.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsol2-bi.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsol2-bi.h?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -39,6 +39,15 @@\n #define ASM_CPU64_DEFAULT_SPEC AS_SPARC64_FLAG \"b\"\n #endif\n \n+#if TARGET_CPU_DEFAULT == TARGET_CPU_niagara\n+#undef CPP_CPU64_DEFAULT_SPEC\n+#define CPP_CPU64_DEFAULT_SPEC \"\"\n+#undef ASM_CPU32_DEFAULT_SPEC\n+#define ASM_CPU32_DEFAULT_SPEC \"-xarch=v8plusb\"\n+#undef ASM_CPU64_DEFAULT_SPEC\n+#define ASM_CPU64_DEFAULT_SPEC AS_SPARC64_FLAG \"b\"\n+#endif\n+\n #if DEFAULT_ARCH32_P\n #define DEF_ARCH32_SPEC(__str) \"%{!m64:\" __str \"}\"\n #define DEF_ARCH64_SPEC(__str) \"%{m64:\" __str \"}\"\n@@ -57,7 +66,7 @@\n %{mcpu=sparclite|mcpu-f930|mcpu=f934:-D__sparclite__} \\\n %{mcpu=v8:\" DEF_ARCH32_SPEC(\"-D__sparcv8\") \"} \\\n %{mcpu=supersparc:-D__supersparc__ \" DEF_ARCH32_SPEC(\"-D__sparcv8\") \"} \\\n-%{mcpu=v9|mcpu=ultrasparc|mcpu=ultrasparc3:\" DEF_ARCH32_SPEC(\"-D__sparcv8\") \"} \\\n+%{mcpu=v9|mcpu=ultrasparc|mcpu=ultrasparc3|mcpu=niagara:\" DEF_ARCH32_SPEC(\"-D__sparcv8\") \"} \\\n %{!mcpu*:%{!mcypress:%{!msparclite:%{!mf930:%{!mf934:%{!mv8:%{!msupersparc:%(cpp_cpu_default)}}}}}}} \\\n \"\n \n@@ -66,7 +75,8 @@\n %{mcpu=v9:\" DEF_ARCH32_SPEC(\"-xarch=v8plus\") DEF_ARCH64_SPEC(AS_SPARC64_FLAG) \"} \\\n %{mcpu=ultrasparc:\" DEF_ARCH32_SPEC(\"-xarch=v8plusa\") DEF_ARCH64_SPEC(AS_SPARC64_FLAG \"a\") \"} \\\n %{mcpu=ultrasparc3:\" DEF_ARCH32_SPEC(\"-xarch=v8plusb\") DEF_ARCH64_SPEC(AS_SPARC64_FLAG \"b\") \"} \\\n-%{!mcpu=ultrasparc3:%{!mcpu=ultrasparc:%{!mcpu=v9:%{mcpu*:\" DEF_ARCH32_SPEC(\"-xarch=v8\") DEF_ARCH64_SPEC(AS_SPARC64_FLAG) \"}}}} \\\n+%{mcpu=niagara:\" DEF_ARCH32_SPEC(\"-xarch=v8plusb\") DEF_ARCH64_SPEC(AS_SPARC64_FLAG \"b\") \"} \\\n+%{!mcpu=niagara:%{!mcpu=ultrasparc3:%{!mcpu=ultrasparc:%{!mcpu=v9:%{mcpu*:\" DEF_ARCH32_SPEC(\"-xarch=v8\") DEF_ARCH64_SPEC(AS_SPARC64_FLAG) \"}}}}} \\\n %{!mcpu*:%(asm_cpu_default)} \\\n \"\n "}, {"sha": "d07e0c63685cf658f77fc14ecc1a9daf39e62f81", "filename": "gcc/config/sparc/sol2.h", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsol2.h?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -1,6 +1,6 @@\n /* Definitions of target machine for GCC, for SPARC running Solaris 2\n-   Copyright 1992, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2004, 2005\n-   Free Software Foundation, Inc.\n+   Copyright 1992, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2004, 2005,\n+   2006 Free Software Foundation, Inc.\n    Contributed by Ron Guilmette (rfg@netcom.com).\n    Additional changes by David V. Henkel-Wallace (gumby@cygnus.com).\n \n@@ -41,11 +41,17 @@ Boston, MA 02110-1301, USA.  */\n #define ASM_CPU_DEFAULT_SPEC \"-xarch=v8plusb\"\n #endif\n \n+#if TARGET_CPU_DEFAULT == TARGET_CPU_niagara\n+#undef ASM_CPU_DEFAULT_SPEC\n+#define ASM_CPU_DEFAULT_SPEC \"-xarch=v8plusb\"\n+#endif\n+\n #undef ASM_CPU_SPEC\n #define ASM_CPU_SPEC \"\\\n %{mcpu=v9:-xarch=v8plus} \\\n %{mcpu=ultrasparc:-xarch=v8plusa} \\\n %{mcpu=ultrasparc3:-xarch=v8plusb} \\\n+%{mcpu=niagara:-xarch=v8plusb} \\\n %{!mcpu*:%(asm_cpu_default)} \\\n \"\n "}, {"sha": "709a92b518eee8b3ee2ffacc7282911601443b53", "filename": "gcc/config/sparc/sparc.c", "status": "modified", "additions": 39, "deletions": 3, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsparc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsparc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.c?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -197,6 +197,30 @@ struct processor_costs ultrasparc3_costs = {\n   0, /* shift penalty */\n };\n \n+static const\n+struct processor_costs niagara_costs = {\n+  COSTS_N_INSNS (3), /* int load */\n+  COSTS_N_INSNS (3), /* int signed load */\n+  COSTS_N_INSNS (3), /* int zeroed load */\n+  COSTS_N_INSNS (9), /* float load */\n+  COSTS_N_INSNS (8), /* fmov, fneg, fabs */\n+  COSTS_N_INSNS (8), /* fadd, fsub */\n+  COSTS_N_INSNS (26), /* fcmp */\n+  COSTS_N_INSNS (8), /* fmov, fmovr */\n+  COSTS_N_INSNS (29), /* fmul */\n+  COSTS_N_INSNS (54), /* fdivs */\n+  COSTS_N_INSNS (83), /* fdivd */\n+  COSTS_N_INSNS (100), /* fsqrts - not implemented in hardware */\n+  COSTS_N_INSNS (100), /* fsqrtd - not implemented in hardware */\n+  COSTS_N_INSNS (11), /* imul */\n+  COSTS_N_INSNS (11), /* imulX */\n+  0, /* imul bit factor */\n+  COSTS_N_INSNS (72), /* idiv */\n+  COSTS_N_INSNS (72), /* idivX */\n+  COSTS_N_INSNS (1), /* movcc/movr */\n+  0, /* shift penalty */\n+};\n+\n const struct processor_costs *sparc_costs = &cypress_costs;\n \n #ifdef HAVE_AS_RELAX_OPTION\n@@ -597,6 +621,7 @@ sparc_override_options (void)\n     { TARGET_CPU_v9, \"v9\" },\n     { TARGET_CPU_ultrasparc, \"ultrasparc\" },\n     { TARGET_CPU_ultrasparc3, \"ultrasparc3\" },\n+    { TARGET_CPU_niagara, \"niagara\" },\n     { 0, 0 }\n   };\n   const struct cpu_default *def;\n@@ -632,6 +657,8 @@ sparc_override_options (void)\n     /* TI ultrasparc III */\n     /* ??? Check if %y issue still holds true in ultra3.  */\n     { \"ultrasparc3\", PROCESSOR_ULTRASPARC3, MASK_ISA, MASK_V9|MASK_DEPRECATED_V8_INSNS},\n+    /* UltraSPARC T1 */\n+    { \"niagara\", PROCESSOR_NIAGARA, MASK_ISA, MASK_V9|MASK_DEPRECATED_V8_INSNS},\n     { 0, 0, 0, 0 }\n   };\n   const struct cpu_table *cpu;\n@@ -741,7 +768,8 @@ sparc_override_options (void)\n   /* Supply a default value for align_functions.  */\n   if (align_functions == 0\n       && (sparc_cpu == PROCESSOR_ULTRASPARC\n-\t  || sparc_cpu == PROCESSOR_ULTRASPARC3))\n+\t  || sparc_cpu == PROCESSOR_ULTRASPARC3\n+\t  || sparc_cpu == PROCESSOR_NIAGARA))\n     align_functions = 32;\n \n   /* Validate PCC_STRUCT_RETURN.  */\n@@ -790,6 +818,9 @@ sparc_override_options (void)\n     case PROCESSOR_ULTRASPARC3:\n       sparc_costs = &ultrasparc3_costs;\n       break;\n+    case PROCESSOR_NIAGARA:\n+      sparc_costs = &niagara_costs;\n+      break;\n     };\n \n #ifdef TARGET_DEFAULT_LONG_DOUBLE_128\n@@ -7099,7 +7130,8 @@ sparc_initialize_trampoline (rtx tramp, rtx fnaddr, rtx cxt)\n      aligned on a 16 byte boundary so one flush clears it all.  */\n   emit_insn (gen_flush (validize_mem (gen_rtx_MEM (SImode, tramp))));\n   if (sparc_cpu != PROCESSOR_ULTRASPARC\n-      && sparc_cpu != PROCESSOR_ULTRASPARC3)\n+      && sparc_cpu != PROCESSOR_ULTRASPARC3\n+      && sparc_cpu != PROCESSOR_NIAGARA)\n     emit_insn (gen_flush (validize_mem (gen_rtx_MEM (SImode,\n \t\t\t\t\t\t     plus_constant (tramp, 8)))));\n \n@@ -7141,7 +7173,8 @@ sparc64_initialize_trampoline (rtx tramp, rtx fnaddr, rtx cxt)\n   emit_insn (gen_flushdi (validize_mem (gen_rtx_MEM (DImode, tramp))));\n \n   if (sparc_cpu != PROCESSOR_ULTRASPARC\n-      && sparc_cpu != PROCESSOR_ULTRASPARC3)\n+      && sparc_cpu != PROCESSOR_ULTRASPARC3\n+      && sparc_cpu != PROCESSOR_NIAGARA)\n     emit_insn (gen_flushdi (validize_mem (gen_rtx_MEM (DImode, plus_constant (tramp, 8)))));\n \n   /* Call __enable_execute_stack after writing onto the stack to make sure\n@@ -7321,6 +7354,8 @@ sparc_sched_init (FILE *dump ATTRIBUTE_UNUSED,\n static int\n sparc_use_sched_lookahead (void)\n {\n+  if (sparc_cpu == PROCESSOR_NIAGARA)\n+    return 0;\n   if (sparc_cpu == PROCESSOR_ULTRASPARC\n       || sparc_cpu == PROCESSOR_ULTRASPARC3)\n     return 4;\n@@ -7336,6 +7371,7 @@ sparc_issue_rate (void)\n {\n   switch (sparc_cpu)\n     {\n+    case PROCESSOR_NIAGARA:\n     default:\n       return 1;\n     case PROCESSOR_V9:"}, {"sha": "1d595bc395b9bfced4aef8c7c5917d36c325fa65", "filename": "gcc/config/sparc/sparc.h", "status": "modified", "additions": 27, "deletions": 9, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsparc.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsparc.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.h?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -1,6 +1,6 @@\n /* Definitions of target machine for GNU compiler, for Sun SPARC.\n    Copyright (C) 1987, 1988, 1989, 1992, 1994, 1995, 1996, 1997, 1998, 1999\n-   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.\n+   2000, 2001, 2002, 2003, 2004, 2005, 2006 Free Software Foundation, Inc.\n    Contributed by Michael Tiemann (tiemann@cygnus.com).\n    64-bit SPARC-V9 support by Michael Tiemann, Jim Wilson, and Doug Evans,\n    at Cygnus Support.\n@@ -206,7 +206,7 @@ extern enum cmodel sparc_cmodel;\n    which requires the following macro to be true if enabled.  Prior to V9,\n    there are no instructions to even talk about memory synchronization.\n    Note that the UltraSPARC III processors don't implement RMO, unlike the\n-   UltraSPARC II processors.\n+   UltraSPARC II processors.  Niagara does not implement RMO either.\n \n    Default to false; for example, Solaris never enables RMO, only ever uses\n    total memory ordering (TMO).  */\n@@ -238,10 +238,12 @@ extern enum cmodel sparc_cmodel;\n #define TARGET_CPU_sparc64\t7\t/* alias */\n #define TARGET_CPU_ultrasparc\t8\n #define TARGET_CPU_ultrasparc3\t9\n+#define TARGET_CPU_niagara\t10\n \n #if TARGET_CPU_DEFAULT == TARGET_CPU_v9 \\\n  || TARGET_CPU_DEFAULT == TARGET_CPU_ultrasparc \\\n- || TARGET_CPU_DEFAULT == TARGET_CPU_ultrasparc3\n+ || TARGET_CPU_DEFAULT == TARGET_CPU_ultrasparc3 \\\n+ || TARGET_CPU_DEFAULT == TARGET_CPU_niagara\n \n #define CPP_CPU32_DEFAULT_SPEC \"\"\n #define ASM_CPU32_DEFAULT_SPEC \"\"\n@@ -262,6 +264,10 @@ extern enum cmodel sparc_cmodel;\n #define CPP_CPU64_DEFAULT_SPEC \"-D__sparc_v9__\"\n #define ASM_CPU64_DEFAULT_SPEC \"-Av9b\"\n #endif\n+#if TARGET_CPU_DEFAULT == TARGET_CPU_niagara\n+#define CPP_CPU64_DEFAULT_SPEC \"-D__sparc_v9__\"\n+#define ASM_CPU64_DEFAULT_SPEC \"-Av9b\"\n+#endif\n \n #else\n \n@@ -352,6 +358,7 @@ extern enum cmodel sparc_cmodel;\n %{mcpu=v9:-D__sparc_v9__} \\\n %{mcpu=ultrasparc:-D__sparc_v9__} \\\n %{mcpu=ultrasparc3:-D__sparc_v9__} \\\n+%{mcpu=niagara:-D__sparc_v9__} \\\n %{!mcpu*:%{!mcypress:%{!msparclite:%{!mf930:%{!mf934:%{!mv8:%{!msupersparc:%(cpp_cpu_default)}}}}}}} \\\n \"\n #define CPP_ARCH32_SPEC \"\"\n@@ -401,6 +408,7 @@ extern enum cmodel sparc_cmodel;\n %{mcpu=v9:-Av9} \\\n %{mcpu=ultrasparc:%{!mv8plus:-Av9a}} \\\n %{mcpu=ultrasparc3:%{!mv8plus:-Av9b}} \\\n+%{mcpu=niagara:%{!mv8plus:-Av9b}} \\\n %{!mcpu*:%{!mcypress:%{!msparclite:%{!mf930:%{!mf934:%{!mv8:%{!msupersparc:%(asm_cpu_default)}}}}}}} \\\n \"\n \n@@ -524,7 +532,8 @@ enum processor_type {\n   PROCESSOR_TSC701,\n   PROCESSOR_V9,\n   PROCESSOR_ULTRASPARC,\n-  PROCESSOR_ULTRASPARC3\n+  PROCESSOR_ULTRASPARC3,\n+  PROCESSOR_NIAGARA\n };\n \n /* This is set from -m{cpu,tune}=xxx.  */\n@@ -2137,7 +2146,8 @@ do {                                                                    \\\n     || (GENERAL_OR_I64 (CLASS1) && FP_REG_CLASS_P (CLASS2)) \\\n     || (CLASS1) == FPCC_REGS || (CLASS2) == FPCC_REGS)\t\t\\\n    ? ((sparc_cpu == PROCESSOR_ULTRASPARC \\\n-       || sparc_cpu == PROCESSOR_ULTRASPARC3) ? 12 : 6) : 2)\n+       || sparc_cpu == PROCESSOR_ULTRASPARC3 \\\n+       || sparc_cpu == PROCESSOR_NIAGARA) ? 12 : 6) : 2)\n \n /* Provide the cost of a branch.  For pre-v9 processors we use\n    a value of 3 to take into account the potential annulling of\n@@ -2147,22 +2157,30 @@ do {                                                                    \\\n \n    On v9 and later, which have branch prediction facilities, we set\n    it to the depth of the pipeline as that is the cost of a\n-   mispredicted branch.  */\n+   mispredicted branch.\n+\n+   On Niagara, normal branches insert 3 bubbles into the pipe\n+   and annulled branches insert 4 bubbles.  */\n \n #define BRANCH_COST \\\n \t((sparc_cpu == PROCESSOR_V9 \\\n \t  || sparc_cpu == PROCESSOR_ULTRASPARC) \\\n \t ? 7 \\\n          : (sparc_cpu == PROCESSOR_ULTRASPARC3 \\\n-            ? 9 : 3))\n+            ? 9 \\\n+\t : (sparc_cpu == PROCESSOR_NIAGARA \\\n+\t    ? 4 \\\n+\t : 3)))\n \n #define PREFETCH_BLOCK \\\n \t((sparc_cpu == PROCESSOR_ULTRASPARC \\\n-          || sparc_cpu == PROCESSOR_ULTRASPARC3) \\\n+          || sparc_cpu == PROCESSOR_ULTRASPARC3 \\\n+\t  || sparc_cpu == PROCESSOR_NIAGARA) \\\n          ? 64 : 32)\n \n #define SIMULTANEOUS_PREFETCHES \\\n-\t((sparc_cpu == PROCESSOR_ULTRASPARC) \\\n+\t((sparc_cpu == PROCESSOR_ULTRASPARC \\\n+\t  || sparc_cpu == PROCESSOR_NIAGARA) \\\n          ? 2 \\\n          : (sparc_cpu == PROCESSOR_ULTRASPARC3 \\\n             ? 8 : 3))"}, {"sha": "b6ebb8287a168e9ddf3ab243ae0006c722bf2aa7", "filename": "gcc/config/sparc/sparc.md", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsparc.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fconfig%2Fsparc%2Fsparc.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fsparc.md?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -1,6 +1,6 @@\n ;; Machine description for SPARC chip for GCC\n ;;  Copyright (C) 1987, 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-;;  1999, 2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.\n+;;  1999, 2000, 2001, 2002, 2003, 2004, 2005,2006 Free Software Foundation, Inc.\n ;;  Contributed by Michael Tiemann (tiemann@cygnus.com)\n ;;  64-bit SPARC-V9 support by Michael Tiemann, Jim Wilson, and Doug Evans,\n ;;  at Cygnus Support.\n@@ -94,7 +94,8 @@\n    sparclet,tsc701,\n    v9,\n    ultrasparc,\n-   ultrasparc3\"\n+   ultrasparc3,\n+   niagara\"\n   (const (symbol_ref \"sparc_cpu_attr\")))\n \n ;; Attribute for the instruction set.\n@@ -315,6 +316,7 @@\n (include \"sparclet.md\")\n (include \"ultra1_2.md\")\n (include \"ultra3.md\")\n+(include \"niagara.md\")\n \n \n ;; Operand and operator predicates."}, {"sha": "d1c2efdb98fb6bf50cb3f936c9a853a215084210", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4c837a1e98526a4835700c70dcee15c62e6afbd2/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=4c837a1e98526a4835700c70dcee15c62e6afbd2", "patch": "@@ -12268,8 +12268,8 @@ Set the instruction set, register set, and instruction scheduling parameters\n for machine type @var{cpu_type}.  Supported values for @var{cpu_type} are\n @samp{v7}, @samp{cypress}, @samp{v8}, @samp{supersparc}, @samp{sparclite},\n @samp{f930}, @samp{f934}, @samp{hypersparc}, @samp{sparclite86x},\n-@samp{sparclet}, @samp{tsc701}, @samp{v9}, @samp{ultrasparc}, and\n-@samp{ultrasparc3}.\n+@samp{sparclet}, @samp{tsc701}, @samp{v9}, @samp{ultrasparc},\n+@samp{ultrasparc3}, and @samp{niagara}.\n \n Default instruction scheduling parameters are used for values that select\n an architecture and not an implementation.  These are @samp{v7}, @samp{v8},\n@@ -12283,7 +12283,7 @@ implementations.\n     v8:             supersparc, hypersparc\n     sparclite:      f930, f934, sparclite86x\n     sparclet:       tsc701\n-    v9:             ultrasparc, ultrasparc3\n+    v9:             ultrasparc, ultrasparc3, niagara\n @end smallexample\n \n By default (unless configured otherwise), GCC generates code for the V7\n@@ -12317,9 +12317,11 @@ With @option{-mcpu=v9}, GCC generates code for the V9 variant of the SPARC\n architecture.  This adds 64-bit integer and floating-point move instructions,\n 3 additional floating-point condition code registers and conditional move\n instructions.  With @option{-mcpu=ultrasparc}, the compiler additionally\n-optimizes it for the Sun UltraSPARC I/II chips.  With\n+optimizes it for the Sun UltraSPARC I/II/IIi chips.  With\n @option{-mcpu=ultrasparc3}, the compiler additionally optimizes it for the\n-Sun UltraSPARC III chip.\n+Sun UltraSPARC III/III+/IIIi/IIIi+/IV/IV+ chips.  With\n+@option{-mcpu=niagara}, the compiler additionally optimizes it for\n+Sun UltraSPARC T1 chips.\n \n @item -mtune=@var{cpu_type}\n @opindex mtune\n@@ -12331,8 +12333,8 @@ The same values for @option{-mcpu=@var{cpu_type}} can be used for\n @option{-mtune=@var{cpu_type}}, but the only useful values are those\n that select a particular cpu implementation.  Those are @samp{cypress},\n @samp{supersparc}, @samp{hypersparc}, @samp{f930}, @samp{f934},\n-@samp{sparclite86x}, @samp{tsc701}, @samp{ultrasparc}, and\n-@samp{ultrasparc3}.\n+@samp{sparclite86x}, @samp{tsc701}, @samp{ultrasparc},\n+@samp{ultrasparc3}, and @samp{niagara}.\n \n @item -mv8plus\n @itemx -mno-v8plus"}]}