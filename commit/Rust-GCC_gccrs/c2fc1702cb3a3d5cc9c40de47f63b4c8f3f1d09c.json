{"sha": "c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzJmYzE3MDJjYjNhM2Q1Y2M5YzQwZGU0N2Y2M2I0YzhmM2YxZDA5Yw==", "commit": {"author": {"name": "Philippe Blain", "email": "levraiphilippeblain@gmail.com", "date": "2021-03-13T00:26:46Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2021-04-21T15:55:15Z"}, "message": "libstdc++: Install libstdc++*-gdb.py more robustly [PR 99453]\n\nIn order for GDB to auto-load the pretty printers, they must be installed\nas \"libstdc++.$ext-gdb.py\", where 'libstdc++.$ext' is the name of the\nobject file that is loaded by GDB [1], i.e. the libstdc++ shared library.\n\nThe approach taken in libstdc++-v3/python/Makefile.am is to loop over\nfiles matching 'libstdc++*' in $(DESTDIR)$(toolexeclibdir) and choose\nthe last file matching that glob that is not a symlink, the Libtool\n'*.la' file or a Python file.\n\nThat works fine for ELF targets where the matching names are:\n\n  libstdc++.a\n  libstdc++.so\n  libstdc++.so.6\n  libstdc++.so.6.0.29\n\nBut not for macOS with:\n\n  libstdc++.6.dylib\n  libstdc++.a\n\nOr MinGW with:\n\n  libstdc++-6.dll\n  libstdc++.dll.a\n\nTry to make a better job at installing the pretty printers with the\ncorrect name by copying the approach taken by isl [2], that is, using\na sed invocation on the Libtool-generated 'libstdc++.la' to read the\ncorrect name for the current platform.\n\n[1] https://sourceware.org/gdb/onlinedocs/gdb/objfile_002dgdbdotext-file.html\n[2] https://repo.or.cz/isl.git/blob/HEAD:/Makefile.am#l611\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/99453\n\t* python/Makefile.am: Install libstdc++*-gdb.py more robustly.\n\t* python/Makefile.in: Regenerate.\n\nCo-authored-by: Jonathan Wakely <jwakely@redhat.com>", "tree": {"sha": "d5361d078dac1054eb0bd532e1597ae1ad6d986d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d5361d078dac1054eb0bd532e1597ae1ad6d986d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c/comments", "author": {"login": "phil-blain", "id": 44212482, "node_id": "MDQ6VXNlcjQ0MjEyNDgy", "avatar_url": "https://avatars.githubusercontent.com/u/44212482?v=4", "gravatar_id": "", "url": "https://api.github.com/users/phil-blain", "html_url": "https://github.com/phil-blain", "followers_url": "https://api.github.com/users/phil-blain/followers", "following_url": "https://api.github.com/users/phil-blain/following{/other_user}", "gists_url": "https://api.github.com/users/phil-blain/gists{/gist_id}", "starred_url": "https://api.github.com/users/phil-blain/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/phil-blain/subscriptions", "organizations_url": "https://api.github.com/users/phil-blain/orgs", "repos_url": "https://api.github.com/users/phil-blain/repos", "events_url": "https://api.github.com/users/phil-blain/events{/privacy}", "received_events_url": "https://api.github.com/users/phil-blain/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2d468b13261aa2002e4e093bfc14dbad98cd2ad3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d468b13261aa2002e4e093bfc14dbad98cd2ad3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d468b13261aa2002e4e093bfc14dbad98cd2ad3"}], "stats": {"total": 34, "additions": 6, "deletions": 28}, "files": [{"sha": "0c2b207b86ebd7dbc86569bca49a3b9e2e4c6d67", "filename": "libstdc++-v3/python/Makefile.am", "status": "modified", "additions": 4, "deletions": 16, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c/libstdc%2B%2B-v3%2Fpython%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c/libstdc%2B%2B-v3%2Fpython%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fpython%2FMakefile.am?ref=c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c", "patch": "@@ -44,21 +44,9 @@ gdb.py: hook.in Makefile\n install-data-local: gdb.py\n \t@$(mkdir_p) $(DESTDIR)$(toolexeclibdir)\n ## We want to install gdb.py as SOMETHING-gdb.py.  SOMETHING is the\n-## full name of the final library.  We want to ignore symlinks, the\n-## .la file, and any previous -gdb.py file.  This is inherently\n-## fragile, but there does not seem to be a better option, because\n-## libtool hides the real names from us.\n-\t@here=`pwd`; cd $(DESTDIR)$(toolexeclibdir); \\\n-\t  for file in libstdc++.*; do \\\n-\t    case $$file in \\\n-\t      *-gdb.py) ;; \\\n-\t      *.la) ;; \\\n-\t      *) if test -h $$file; then \\\n-\t           continue; \\\n-\t         fi; \\\n-\t         libname=$$file;; \\\n-\t    esac; \\\n-\t  done; \\\n-\tcd $$here; \\\n+## full name of the final library.  We use the libtool .la file to get\n+## the correct name.\n+\t@libname=`sed -ne \"/^library_names=/{s/.*='//;s/'$$//;s/ .*//;p;}\" \\\n+\t          $(DESTDIR)$(toolexeclibdir)/libstdc++.la`; \\\n \techo \" $(INSTALL_DATA) gdb.py $(DESTDIR)$(toolexeclibdir)/$$libname-gdb.py\"; \\\n \t$(INSTALL_DATA) gdb.py $(DESTDIR)$(toolexeclibdir)/$$libname-gdb.py"}, {"sha": "2efe0b96a19b2f759fb149344535c56c7311025c", "filename": "libstdc++-v3/python/Makefile.in", "status": "modified", "additions": 2, "deletions": 12, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c/libstdc%2B%2B-v3%2Fpython%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c/libstdc%2B%2B-v3%2Fpython%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fpython%2FMakefile.in?ref=c2fc1702cb3a3d5cc9c40de47f63b4c8f3f1d09c", "patch": "@@ -607,18 +607,8 @@ gdb.py: hook.in Makefile\n \n install-data-local: gdb.py\n \t@$(mkdir_p) $(DESTDIR)$(toolexeclibdir)\n-\t@here=`pwd`; cd $(DESTDIR)$(toolexeclibdir); \\\n-\t  for file in libstdc++.*; do \\\n-\t    case $$file in \\\n-\t      *-gdb.py) ;; \\\n-\t      *.la) ;; \\\n-\t      *) if test -h $$file; then \\\n-\t           continue; \\\n-\t         fi; \\\n-\t         libname=$$file;; \\\n-\t    esac; \\\n-\t  done; \\\n-\tcd $$here; \\\n+\t@libname=`sed -ne \"/^library_names=/{s/.*='//;s/'$$//;s/ .*//;p;}\" \\\n+\t          $(DESTDIR)$(toolexeclibdir)/libstdc++.la`; \\\n \techo \" $(INSTALL_DATA) gdb.py $(DESTDIR)$(toolexeclibdir)/$$libname-gdb.py\"; \\\n \t$(INSTALL_DATA) gdb.py $(DESTDIR)$(toolexeclibdir)/$$libname-gdb.py\n "}]}