{"sha": "f28e54bd06f3733ff147128107a8da6d3e6d428e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjI4ZTU0YmQwNmYzNzMzZmYxNDcxMjgxMDdhOGRhNmQzZTZkNDI4ZQ==", "commit": {"author": {"name": "Wilco Dijkstra", "email": "wdijkstr@arm.com", "date": "2017-06-21T10:40:21Z"}, "committer": {"name": "Wilco Dijkstra", "email": "wilco@gcc.gnu.org", "date": "2017-06-21T10:40:21Z"}, "message": "Mark symbols as constant\n\nAarch64_legitimate_constant_p currently returns false for symbols,\neventhough they are always valid constants.  This means LOSYM isn't\nCSEd correctly.  If we return true CSE works better, resulting in\nsmaller/faster code (0.3% smaller code on SPEC2006).  Avoid this\nfor TLS symbols since their sequence is complex.\n\n    gcc/\n\t* config/aarch64/aarch64.c (aarch64_legitimate_constant_p):\n\tReturn true for non-tls symbols.\n\nFrom-SVN: r249442", "tree": {"sha": "75e5d4aa2430008c006906269cdaa5febd0dc848", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/75e5d4aa2430008c006906269cdaa5febd0dc848"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f28e54bd06f3733ff147128107a8da6d3e6d428e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f28e54bd06f3733ff147128107a8da6d3e6d428e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f28e54bd06f3733ff147128107a8da6d3e6d428e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f28e54bd06f3733ff147128107a8da6d3e6d428e/comments", "author": null, "committer": null, "parents": [{"sha": "9a85b75fc414653f4a691ea57b83722489cd3d61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a85b75fc414653f4a691ea57b83722489cd3d61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a85b75fc414653f4a691ea57b83722489cd3d61"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "1aaaf61a073ce2789629d4f0c991a168c06df793", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f28e54bd06f3733ff147128107a8da6d3e6d428e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f28e54bd06f3733ff147128107a8da6d3e6d428e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f28e54bd06f3733ff147128107a8da6d3e6d428e", "patch": "@@ -1,3 +1,8 @@\n+2017-06-21  Wilco Dijkstra  <wdijkstr@arm.com>\n+\n+\t* config/aarch64/aarch64.c (aarch64_legitimate_constant_p):\n+\tReturn true for non-tls symbols.\n+\n 2017-06-21  James Greenhalgh  <james.greenhalgh@arm.com>\n \n \t* config/aarch64/aarch64-cores.def (cortex-a55): New."}, {"sha": "ba6b45fcb3d5d663dcaf5273a91a7ec03b0618ae", "filename": "gcc/config/aarch64/aarch64.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f28e54bd06f3733ff147128107a8da6d3e6d428e/gcc%2Fconfig%2Faarch64%2Faarch64.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f28e54bd06f3733ff147128107a8da6d3e6d428e/gcc%2Fconfig%2Faarch64%2Faarch64.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Faarch64%2Faarch64.c?ref=f28e54bd06f3733ff147128107a8da6d3e6d428e", "patch": "@@ -10129,6 +10129,11 @@ aarch64_legitimate_constant_p (machine_mode mode, rtx x)\n       && aarch64_valid_symref (XEXP (x, 0), GET_MODE (XEXP (x, 0))))\n     return true;\n \n+  /* Treat symbols as constants.  Avoid TLS symbols as they are complex,\n+     so spilling them is better than rematerialization.  */\n+  if (SYMBOL_REF_P (x) && !SYMBOL_REF_TLS_MODEL (x))\n+    return true;\n+\n   return aarch64_constant_address_p (x);\n }\n "}]}