{"sha": "e43ebb1268899ccce28383a361b947493a4f452c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQzZWJiMTI2ODg5OWNjY2UyODM4M2EzNjFiOTQ3NDkzYTRmNDUyYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-07-18T18:45:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-07-18T18:45:18Z"}, "message": "re PR c++/70869 (internal compiler error: Segmentation fault on array of pointer to function members)\n\n\tPR c++/70869\n\tPR c++/71054\n\t* cp-gimplify.c (cp_genericize_r): Revert the 2016-07-07 change.\n\t* tree.c (cp_walk_subtrees): For DECL_EXPR on DECL_ARTIFICIAL\n\tnon-static VAR_DECL, walk the decl's DECL_INITIAL, DECL_SIZE and\n\tDECL_SIZE_UNIT.\n\nFrom-SVN: r238444", "tree": {"sha": "9c08fdd4524a478dac68dbb39ddefd1af7ae54df", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c08fdd4524a478dac68dbb39ddefd1af7ae54df"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e43ebb1268899ccce28383a361b947493a4f452c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e43ebb1268899ccce28383a361b947493a4f452c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e43ebb1268899ccce28383a361b947493a4f452c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e43ebb1268899ccce28383a361b947493a4f452c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "99516432c26d13ba2808daf860253b4f945336d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/99516432c26d13ba2808daf860253b4f945336d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/99516432c26d13ba2808daf860253b4f945336d9"}], "stats": {"total": 33, "additions": 24, "deletions": 9}, "files": [{"sha": "c88b98cbf1b0ab1617f29d01e2239c6daf61df3e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e43ebb1268899ccce28383a361b947493a4f452c/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e43ebb1268899ccce28383a361b947493a4f452c/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e43ebb1268899ccce28383a361b947493a4f452c", "patch": "@@ -1,5 +1,12 @@\n 2016-07-18  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/70869\n+\tPR c++/71054\n+\t* cp-gimplify.c (cp_genericize_r): Revert the 2016-07-07 change.\n+\t* tree.c (cp_walk_subtrees): For DECL_EXPR on DECL_ARTIFICIAL\n+\tnon-static VAR_DECL, walk the decl's DECL_INITIAL, DECL_SIZE and\n+\tDECL_SIZE_UNIT.\n+\n \tPR c++/71835\n \t* call.c (build_op_call_1): Use convert_like_with_context only\n \tif cand->fn is a decl."}, {"sha": "41ab35f8ede03c119fb4bd0aa0aad5571edd3dd9", "filename": "gcc/cp/cp-gimplify.c", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e43ebb1268899ccce28383a361b947493a4f452c/gcc%2Fcp%2Fcp-gimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e43ebb1268899ccce28383a361b947493a4f452c/gcc%2Fcp%2Fcp-gimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-gimplify.c?ref=e43ebb1268899ccce28383a361b947493a4f452c", "patch": "@@ -1351,15 +1351,7 @@ cp_genericize_r (tree *stmt_p, int *walk_subtrees, void *data)\n     {\n       tree d = DECL_EXPR_DECL (stmt);\n       if (TREE_CODE (d) == VAR_DECL)\n-\t{\n-\t  gcc_assert (CP_DECL_THREAD_LOCAL_P (d) == DECL_THREAD_LOCAL_P (d));\n-\t  /* User var initializers should be genericized during containing\n-\t     BIND_EXPR genericization when walk_tree walks DECL_INITIAL\n-\t     of BIND_EXPR_VARS.  Artificial temporaries might not be\n-\t     mentioned there though, so walk them now.  */\n-\t  if (DECL_ARTIFICIAL (d) && !TREE_STATIC (d) && DECL_INITIAL (d))\n-\t    cp_walk_tree (&DECL_INITIAL (d), cp_genericize_r, data, NULL);\n-\t}\n+\tgcc_assert (CP_DECL_THREAD_LOCAL_P (d) == DECL_THREAD_LOCAL_P (d));\n     }\n   else if (TREE_CODE (stmt) == OMP_PARALLEL\n \t   || TREE_CODE (stmt) == OMP_TASK"}, {"sha": "faf096c5c9be9d6cc2fb1a1276c9393b3a9d4754", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e43ebb1268899ccce28383a361b947493a4f452c/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e43ebb1268899ccce28383a361b947493a4f452c/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=e43ebb1268899ccce28383a361b947493a4f452c", "patch": "@@ -4075,6 +4075,22 @@ cp_walk_subtrees (tree *tp, int *walk_subtrees_p, walk_tree_fn func,\n       *walk_subtrees_p = 0;\n       break;\n \n+    case DECL_EXPR:\n+      /* User variables should be mentioned in BIND_EXPR_VARS\n+\t and their initializers and sizes walked when walking\n+\t the containing BIND_EXPR.  Compiler temporaries are\n+\t handled here.  */\n+      if (VAR_P (TREE_OPERAND (*tp, 0))\n+\t  && DECL_ARTIFICIAL (TREE_OPERAND (*tp, 0))\n+\t  && !TREE_STATIC (TREE_OPERAND (*tp, 0)))\n+\t{\n+\t  tree decl = TREE_OPERAND (*tp, 0);\n+\t  WALK_SUBTREE (DECL_INITIAL (decl));\n+\t  WALK_SUBTREE (DECL_SIZE (decl));\n+\t  WALK_SUBTREE (DECL_SIZE_UNIT (decl));\n+\t}\n+      break;\n+\n     default:\n       return NULL_TREE;\n     }"}]}