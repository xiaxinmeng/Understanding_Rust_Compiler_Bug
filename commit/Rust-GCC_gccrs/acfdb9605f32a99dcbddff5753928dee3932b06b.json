{"sha": "acfdb9605f32a99dcbddff5753928dee3932b06b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWNmZGI5NjA1ZjMyYTk5ZGNiZGRmZjU3NTM5MjhkZWUzOTMyYjA2Yg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-10-23T12:35:00Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-10-23T12:35:00Z"}, "message": "constexpr.c (cxx_eval_constant_expression): Temporarily change input_location to CLEANUP_STMT location.\n\n\t* constexpr.c (cxx_eval_constant_expression) <case CLEANUP_STMT>:\n\tTemporarily change input_location to CLEANUP_STMT location.\n\n\t* g++.dg/cpp2a/constexpr-dtor3.C: Expect in 'constexpr' expansion of\n\tmessage on the line with variable declaration.\n\t* g++.dg/ext/constexpr-attr-cleanup1.C: Likewise.\n\nFrom-SVN: r277320", "tree": {"sha": "82fdc942d3d842fd493e527840f3a3c0365cb962", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/82fdc942d3d842fd493e527840f3a3c0365cb962"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/acfdb9605f32a99dcbddff5753928dee3932b06b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acfdb9605f32a99dcbddff5753928dee3932b06b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acfdb9605f32a99dcbddff5753928dee3932b06b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acfdb9605f32a99dcbddff5753928dee3932b06b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "149a3e4d4e3aacdbfee165f0efea4d6327327265", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/149a3e4d4e3aacdbfee165f0efea4d6327327265", "html_url": "https://github.com/Rust-GCC/gccrs/commit/149a3e4d4e3aacdbfee165f0efea4d6327327265"}], "stats": {"total": 37, "additions": 27, "deletions": 10}, "files": [{"sha": "4295b0c3ed6319490cc697fd82442f6f750ffda0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=acfdb9605f32a99dcbddff5753928dee3932b06b", "patch": "@@ -1,3 +1,8 @@\n+2019-10-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* constexpr.c (cxx_eval_constant_expression) <case CLEANUP_STMT>:\n+\tTemporarily change input_location to CLEANUP_STMT location.\n+\n 2019-10-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/85887"}, {"sha": "11a1eaa0e82a3acdd2df33e0152b9c7a393fb1d8", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=acfdb9605f32a99dcbddff5753928dee3932b06b", "patch": "@@ -4988,14 +4988,20 @@ cxx_eval_constant_expression (const constexpr_ctx *ctx, tree t,\n \t\t\t\t\t  non_constant_p, overflow_p,\n \t\t\t\t\t  jump_target);\n \tif (!CLEANUP_EH_ONLY (t) && !*non_constant_p)\n-\t  /* Also evaluate the cleanup.  If we weren't skipping at the\n-\t     start of the CLEANUP_BODY, change jump_target temporarily\n-\t     to &initial_jump_target, so that even a return or break or\n-\t     continue in the body doesn't skip the cleanup.  */\n-\t  cxx_eval_constant_expression (ctx, CLEANUP_EXPR (t), true,\n-\t\t\t\t\tnon_constant_p, overflow_p,\n-\t\t\t\t\tjump_target ? &initial_jump_target\n-\t\t\t\t\t: NULL);\n+\t  {\n+\t    location_t loc = input_location;\n+\t    if (EXPR_HAS_LOCATION (t))\n+\t      input_location = EXPR_LOCATION (t);\n+\t    /* Also evaluate the cleanup.  If we weren't skipping at the\n+\t       start of the CLEANUP_BODY, change jump_target temporarily\n+\t       to &initial_jump_target, so that even a return or break or\n+\t       continue in the body doesn't skip the cleanup.  */\n+\t    cxx_eval_constant_expression (ctx, CLEANUP_EXPR (t), true,\n+\t\t\t\t\t  non_constant_p, overflow_p,\n+\t\t\t\t\t  jump_target ? &initial_jump_target\n+\t\t\t\t\t  : NULL);\n+\t    input_location = loc;\n+\t  }\n       }\n       break;\n "}, {"sha": "790ffe4bf6d10f8bc86e6d4114d459a72d9f751d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=acfdb9605f32a99dcbddff5753928dee3932b06b", "patch": "@@ -1,3 +1,9 @@\n+2019-10-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* g++.dg/cpp2a/constexpr-dtor3.C: Expect in 'constexpr' expansion of\n+\tmessage on the line with variable declaration.\n+\t* g++.dg/ext/constexpr-attr-cleanup1.C: Likewise.\n+\n 2019-10-23  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc.c-torture/execute/20191023-1.c: New test."}, {"sha": "d9461836970760f4e5bee4490c060983b9d9fe83", "filename": "gcc/testsuite/g++.dg/cpp2a/constexpr-dtor3.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconstexpr-dtor3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconstexpr-dtor3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp2a%2Fconstexpr-dtor3.C?ref=acfdb9605f32a99dcbddff5753928dee3932b06b", "patch": "@@ -149,7 +149,7 @@ constexpr int x3 = f3 ();\n constexpr int\n f4 ()\n {\n-  W7 w13 = 5;\n+  W7 w13 = 5;\t\t\t// { dg-message \"in 'constexpr' expansion of\" }\n   return 0;\n }\n "}, {"sha": "b6e7c6913673bd65a7dc03c50b4c87b42bc82d94", "filename": "gcc/testsuite/g++.dg/ext/constexpr-attr-cleanup1.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fconstexpr-attr-cleanup1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acfdb9605f32a99dcbddff5753928dee3932b06b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fconstexpr-attr-cleanup1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fconstexpr-attr-cleanup1.C?ref=acfdb9605f32a99dcbddff5753928dee3932b06b", "patch": "@@ -15,7 +15,7 @@ cleanup2 (int *x)\n constexpr bool\n foo ()\n {\n-  int a __attribute__((cleanup (cleanup))) = 1;\n+  int a __attribute__((cleanup (cleanup))) = 1;\t// { dg-message \"in 'constexpr' expansion of\" }\n   return true;\n }\n "}]}