{"sha": "d4852cd492d78002c1a8e213ab858672ab54106e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ4NTJjZDQ5MmQ3ODAwMmMxYThlMjEzYWI4NTg2NzJhYjU0MTA2ZQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2015-10-02T19:27:30Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2015-10-02T19:27:30Z"}, "message": "[PR target/67822] OpenMP offloading to nvptx fails\n\n\tgcc/\n\tPR target/67822\n\t* config/nvptx/mkoffload.c (main): Scan the argument vector for\n\t-fopenmp, and skip generating an offloading image if specified.\n\nFrom-SVN: r228414", "tree": {"sha": "613e0d332cd269081841abe385531facb9b57700", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/613e0d332cd269081841abe385531facb9b57700"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d4852cd492d78002c1a8e213ab858672ab54106e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4852cd492d78002c1a8e213ab858672ab54106e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4852cd492d78002c1a8e213ab858672ab54106e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4852cd492d78002c1a8e213ab858672ab54106e/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "54070b515503af0361d0d03851fd0082b2a8258e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54070b515503af0361d0d03851fd0082b2a8258e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54070b515503af0361d0d03851fd0082b2a8258e"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "1317a2d6d5e76d59c6c9dfc21452df118469574d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4852cd492d78002c1a8e213ab858672ab54106e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4852cd492d78002c1a8e213ab858672ab54106e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d4852cd492d78002c1a8e213ab858672ab54106e", "patch": "@@ -1,3 +1,9 @@\n+2015-10-02  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\tPR target/67822\n+\t* config/nvptx/mkoffload.c (main): Scan the argument vector for\n+\t-fopenmp, and skip generating an offloading image if specified.\n+\n 2015-10-02  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* system.h (ROUND_UP): New macro definition."}, {"sha": "69eb4eac4156c8726237d67a41630f720ce456d0", "filename": "gcc/config/nvptx/mkoffload.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4852cd492d78002c1a8e213ab858672ab54106e/gcc%2Fconfig%2Fnvptx%2Fmkoffload.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4852cd492d78002c1a8e213ab858672ab54106e/gcc%2Fconfig%2Fnvptx%2Fmkoffload.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fmkoffload.c?ref=d4852cd492d78002c1a8e213ab858672ab54106e", "patch": "@@ -1030,6 +1030,7 @@ main (int argc, char **argv)\n   expandargv (&argc, &argv);\n \n   /* Scan the argument vector.  */\n+  bool fopenmp = false;\n   for (int i = 1; i < argc; i++)\n     {\n #define STR \"-foffload-abi=\"\n@@ -1044,6 +1045,8 @@ main (int argc, char **argv)\n \t\t\t \"unrecognizable argument of option \" STR);\n \t}\n #undef STR\n+      else if (strcmp (argv[i], \"-fopenmp\") == 0)\n+\tfopenmp = true;\n       else if (strcmp (argv[i], \"-v\") == 0)\n \tverbose = true;\n     }\n@@ -1082,8 +1085,8 @@ main (int argc, char **argv)\n     fatal_error (input_location, \"cannot open '%s'\", ptx_cfile_name);\n \n   /* PR libgomp/65099: Currently, we only support offloading in 64-bit\n-     configurations.  */\n-  if (offload_abi == OFFLOAD_ABI_LP64)\n+     configurations.  PR target/67822: OpenMP offloading to nvptx fails.  */\n+  if (offload_abi == OFFLOAD_ABI_LP64 && !fopenmp)\n     {\n       ptx_name = make_temp_file (\".mkoffload\");\n       obstack_ptr_grow (&argv_obstack, \"-o\");"}]}