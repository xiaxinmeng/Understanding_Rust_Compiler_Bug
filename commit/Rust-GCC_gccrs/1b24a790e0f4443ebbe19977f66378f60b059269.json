{"sha": "1b24a790e0f4443ebbe19977f66378f60b059269", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWIyNGE3OTBlMGY0NDQzZWJiZTE5OTc3ZjY2Mzc4ZjYwYjA1OTI2OQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2008-03-24T15:08:52Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2008-03-24T15:08:52Z"}, "message": "re PR c/22371 (C front-end produces mis-match types in MODIFY_EXPR)\n\n2008-03-24  Richard Guenther  <rguenther@suse.de>\n\n\tPR c/22371\n\t* gimplify.c (gimplify_modify_expr): For frontend type-correct\n\tpointer assignments change conversions according to middle-end rules.\n\t(gimplify_modify_expr_rhs): Deal with NULL TARGET_EXPR_INITIAL.\n\t* configure.ac: Include type checking in yes.\n\t* configure: Regenerate.\n\nFrom-SVN: r133479", "tree": {"sha": "a7b12b2f030414354125acf1f0fff3ea55cec094", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a7b12b2f030414354125acf1f0fff3ea55cec094"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b24a790e0f4443ebbe19977f66378f60b059269", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b24a790e0f4443ebbe19977f66378f60b059269", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b24a790e0f4443ebbe19977f66378f60b059269", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b24a790e0f4443ebbe19977f66378f60b059269/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "52249a2e3f3d67b8a86ad232428005c449b77a3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52249a2e3f3d67b8a86ad232428005c449b77a3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52249a2e3f3d67b8a86ad232428005c449b77a3e"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "a1ab32856eb6ec6e7fc2e483d909ca704ffcdfcf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1b24a790e0f4443ebbe19977f66378f60b059269", "patch": "@@ -1,3 +1,12 @@\n+2008-03-24  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR c/22371\n+\t* gimplify.c (gimplify_modify_expr): For frontend type-correct\n+\tpointer assignments change conversions according to middle-end rules.\n+\t(gimplify_modify_expr_rhs): Deal with NULL TARGET_EXPR_INITIAL.\n+\t* configure.ac: Include type checking in yes.\n+\t* configure: Regenerate.\n+\n 2008-03-24  Manuel Lopez-Ibanez  <manu@gcc.gnu.org>\n \n \t* diagnostic.c (diagnostic_count_diagnostic): Delete."}, {"sha": "1be527276b97160ff5014b1c733db0e9d3c8729b", "filename": "gcc/configure", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=1b24a790e0f4443ebbe19977f66378f60b059269", "patch": "@@ -6439,7 +6439,7 @@ do\n \t\t\tac_gc_always_collect= ; ac_rtl_checking= ;\n \t\t\tac_rtlflag_checking=1 ; ac_runtime_checking=1 ;\n \t\t\tac_tree_checking=1 ; ac_valgrind_checking= ;\n-\t\t\tac_types_checking= ;;\n+\t\t\tac_types_checking=1 ;;\n \tno|none)\tac_assert_checking= ; ac_checking= ; ac_df_checking= ;\n \t\t\tac_fold_checking= ; ac_gc_checking= ;\n \t\t\tac_gc_always_collect= ; ac_rtl_checking= ;"}, {"sha": "b4a1744b0ef3fcbf06547e355f3d9bd8189dd2f4", "filename": "gcc/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=1b24a790e0f4443ebbe19977f66378f60b059269", "patch": "@@ -367,7 +367,7 @@ do\n \t\t\tac_gc_always_collect= ; ac_rtl_checking= ;\n \t\t\tac_rtlflag_checking=1 ; ac_runtime_checking=1 ;\n \t\t\tac_tree_checking=1 ; ac_valgrind_checking= ;\n-\t\t\tac_types_checking= ;;\n+\t\t\tac_types_checking=1 ;;\n \tno|none)\tac_assert_checking= ; ac_checking= ; ac_df_checking= ;\n \t\t\tac_fold_checking= ; ac_gc_checking= ;\n \t\t\tac_gc_always_collect= ; ac_rtl_checking= ;"}, {"sha": "4b084e445a8140a186310b786933ac51e04a031b", "filename": "gcc/gimplify.c", "status": "modified", "additions": 13, "deletions": 1, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b24a790e0f4443ebbe19977f66378f60b059269/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=1b24a790e0f4443ebbe19977f66378f60b059269", "patch": "@@ -3599,7 +3599,8 @@ gimplify_modify_expr_rhs (tree *expr_p, tree *from_p, tree *to_p, tree *pre_p,\n \t     references somehow.  */\n \t  tree init = TARGET_EXPR_INITIAL (*from_p);\n \n-\t  if (!VOID_TYPE_P (TREE_TYPE (init)))\n+\t  if (init\n+\t      && !VOID_TYPE_P (TREE_TYPE (init)))\n \t    {\n \t      *from_p = init;\n \t      ret = GS_OK;\n@@ -3870,6 +3871,17 @@ gimplify_modify_expr (tree *expr_p, tree *pre_p, tree *post_p, bool want_value)\n \t      || TREE_CODE (*expr_p) == GIMPLE_MODIFY_STMT\n \t      || TREE_CODE (*expr_p) == INIT_EXPR);\n \n+  /* Insert pointer conversions required by the middle-end that are not\n+     required by the frontend.  This fixes middle-end type checking for\n+     for example gcc.dg/redecl-6.c.  */\n+  if (POINTER_TYPE_P (TREE_TYPE (*to_p))\n+      && lang_hooks.types_compatible_p (TREE_TYPE (*to_p), TREE_TYPE (*from_p)))\n+    {\n+      STRIP_USELESS_TYPE_CONVERSION (*from_p);\n+      if (!useless_type_conversion_p (TREE_TYPE (*to_p), TREE_TYPE (*from_p)))\n+\t*from_p = fold_convert (TREE_TYPE (*to_p), *from_p);\n+    }\n+\n   /* See if any simplifications can be done based on what the RHS is.  */\n   ret = gimplify_modify_expr_rhs (expr_p, from_p, to_p, pre_p, post_p,\n \t\t\t\t  want_value);"}]}