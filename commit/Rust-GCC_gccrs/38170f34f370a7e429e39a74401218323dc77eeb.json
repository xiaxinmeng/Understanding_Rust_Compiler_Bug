{"sha": "38170f34f370a7e429e39a74401218323dc77eeb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzgxNzBmMzRmMzcwYTdlNDI5ZTM5YTc0NDAxMjE4MzIzZGM3N2VlYg==", "commit": {"author": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2010-02-23T15:51:42Z"}, "committer": {"name": "Manuel L\u00f3pez-Ib\u00e1\u00f1ez", "email": "manu@gcc.gnu.org", "date": "2010-02-23T15:51:42Z"}, "message": "re PR target/43123 (wrong value for march or mtune produces confusing output)\n\n2010-02-23  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n\n\tPR 43123\n\t* config/i386/i386.c (override_options): Reorganise to provide\n\tbetter error messages.\ntestsuite/\n\t* gcc.dg/march.c: New.\n\t* gcc.dg/march-generic.c: New.\n\t* gcc.dg/mtune.c: New.\n\nFrom-SVN: r157007", "tree": {"sha": "6e6625a61e5334786e99557d2b39e5e5f527c1b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6e6625a61e5334786e99557d2b39e5e5f527c1b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/38170f34f370a7e429e39a74401218323dc77eeb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38170f34f370a7e429e39a74401218323dc77eeb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38170f34f370a7e429e39a74401218323dc77eeb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38170f34f370a7e429e39a74401218323dc77eeb/comments", "author": null, "committer": null, "parents": [{"sha": "5c8db18ac645579a5974abb6ad0ed922b14dcb32", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c8db18ac645579a5974abb6ad0ed922b14dcb32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c8db18ac645579a5974abb6ad0ed922b14dcb32"}], "stats": {"total": 55, "additions": 41, "deletions": 14}, "files": [{"sha": "7d6c3068af102a72396f2816b5dccac20a8db25e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=38170f34f370a7e429e39a74401218323dc77eeb", "patch": "@@ -1,3 +1,9 @@\n+2010-02-23  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR 43123\n+\t* config/i386/i386.c (override_options): Reorganise to provide\n+\tbetter error messages.\n+\n 2010-02-22  Sebastian Pop  <sebastian.pop@amd.com>\n \n \tPR middle-end/43083"}, {"sha": "27593d761ade4336046cb4b47868eb39d83a421e", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 13, "deletions": 14, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=38170f34f370a7e429e39a74401218323dc77eeb", "patch": "@@ -2621,6 +2621,7 @@ override_options (bool main_args_p)\n {\n   int i;\n   unsigned int ix86_arch_mask, ix86_tune_mask;\n+  const bool ix86_tune_specified = (ix86_tune_string != NULL); \n   const char *prefix;\n   const char *suffix;\n   const char *sw;\n@@ -2821,8 +2822,12 @@ override_options (bool main_args_p)\n \t\t   || !strcmp (ix86_tune_string, \"generic64\")))\n \t;\n       else if (!strncmp (ix86_tune_string, \"generic\", 7))\n-\terror (\"bad value (%s) for %stune=%s %s\",\n+        error (\"bad value (%s) for %stune=%s %s\",\n \t       ix86_tune_string, prefix, suffix, sw);\n+      else if (!strcmp (ix86_tune_string, \"x86-64\"))\n+        warning (OPT_Wdeprecated, \"%stune=x86-64%s is deprecated.  Use \"\n+                 \"%stune=k8%s or %stune=generic%s instead as appropriate.\",\n+                 prefix, suffix, prefix, suffix, prefix, suffix);\n     }\n   else\n     {\n@@ -2846,6 +2851,7 @@ override_options (bool main_args_p)\n \t    ix86_tune_string = \"generic32\";\n \t}\n     }\n+\n   if (ix86_stringop_string)\n     {\n       if (!strcmp (ix86_stringop_string, \"rep_byte\"))\n@@ -2868,23 +2874,12 @@ override_options (bool main_args_p)\n \terror (\"bad value (%s) for %sstringop-strategy=%s %s\",\n \t       ix86_stringop_string, prefix, suffix, sw);\n     }\n-  if (!strcmp (ix86_tune_string, \"x86-64\"))\n-    warning (OPT_Wdeprecated, \"%stune=x86-64%s is deprecated.  Use \"\n-\t     \"%stune=k8%s or %stune=generic%s instead as appropriate.\",\n-\t     prefix, suffix, prefix, suffix, prefix, suffix);\n \n   if (!ix86_arch_string)\n     ix86_arch_string = TARGET_64BIT ? \"x86-64\" : \"i386\";\n   else\n     ix86_arch_specified = 1;\n \n-  if (!strcmp (ix86_arch_string, \"generic\"))\n-    error (\"generic CPU can be used only for %stune=%s %s\",\n-\t   prefix, suffix, sw);\n-  if (!strncmp (ix86_arch_string, \"generic\", 7))\n-    error (\"bad value (%s) for %sarch=%s %s\",\n-\t   ix86_arch_string, prefix, suffix, sw);\n-\n   /* Validate -mabi= value.  */\n   if (ix86_abi_string)\n     {\n@@ -3032,7 +3027,10 @@ override_options (bool main_args_p)\n \tbreak;\n       }\n \n-  if (i == pta_size)\n+  if (!strcmp (ix86_arch_string, \"generic\"))\n+    error (\"generic CPU can be used only for %stune=%s %s\",\n+\t   prefix, suffix, sw);\n+  else if (!strncmp (ix86_arch_string, \"generic\", 7) || i == pta_size)\n     error (\"bad value (%s) for %sarch=%s %s\",\n \t   ix86_arch_string, prefix, suffix, sw);\n \n@@ -3071,7 +3069,8 @@ override_options (bool main_args_p)\n \t  x86_prefetch_sse = true;\n \tbreak;\n       }\n-  if (i == pta_size)\n+\n+  if (ix86_tune_specified && i == pta_size)\n     error (\"bad value (%s) for %stune=%s %s\",\n \t   ix86_tune_string, prefix, suffix, sw);\n "}, {"sha": "bc1ff1f15ba4f29b870d7a6547b313ca2cd57549", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=38170f34f370a7e429e39a74401218323dc77eeb", "patch": "@@ -1,3 +1,10 @@\n+2010-02-23  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n+\n+\tPR 43123\n+\t* gcc.dg/march.c: New.\n+\t* gcc.dg/march-generic.c: New.\n+\t* gcc.dg/mtune.c: New.\n+\t\n 2010-02-22  Sebastian Pop  <sebastian.pop@amd.com>\n \n \tPR middle-end/43083"}, {"sha": "2cebd369de2b5eb96b37a3dc8d566bc624b181cc", "filename": "gcc/testsuite/gcc.dg/march-generic.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2Fgcc.dg%2Fmarch-generic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2Fgcc.dg%2Fmarch-generic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmarch-generic.c?ref=38170f34f370a7e429e39a74401218323dc77eeb", "patch": "@@ -0,0 +1,5 @@\n+/* { dg-do compile { target i?86-*-* } } */\n+/* { dg-options \"-march=generic\" } */\n+/* { dg-error \"generic CPU can be used only for -mtune\" \"\" { target *-*-* } 0 } */\n+/* { dg-bogus \"march\" \"\" { target *-*-* } 0 } */\n+int i;"}, {"sha": "f0a08526ec1047b19f7dc48dc768c9e4c51be19a", "filename": "gcc/testsuite/gcc.dg/march.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2Fgcc.dg%2Fmarch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2Fgcc.dg%2Fmarch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmarch.c?ref=38170f34f370a7e429e39a74401218323dc77eeb", "patch": "@@ -0,0 +1,5 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-march=foo\" } */\n+/* { dg-error \"march\" \"\" { target *-*-* } 0 } */\n+/* { dg-bogus \"mtune\" \"\" { target *-*-* } 0 } */\n+int i;"}, {"sha": "1b0c76db47e37ebd4429bb99db906ce5ffea60fd", "filename": "gcc/testsuite/gcc.dg/mtune.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2Fgcc.dg%2Fmtune.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/38170f34f370a7e429e39a74401218323dc77eeb/gcc%2Ftestsuite%2Fgcc.dg%2Fmtune.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fmtune.c?ref=38170f34f370a7e429e39a74401218323dc77eeb", "patch": "@@ -0,0 +1,5 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-mtune=foo\" } */\n+/* { dg-error \"mtune\" \"\" { target *-*-* } 0 } */\n+/* { dg-bogus \"march\" \"\" { target *-*-* } 0 } */\n+int i;"}]}