{"sha": "d979a676fde85a362cb8d7b142300a494370f3e9", "node_id": "C_kwDOANBUbNoAKGQ5NzlhNjc2ZmRlODVhMzYyY2I4ZDdiMTQyMzAwYTQ5NDM3MGYzZTk", "commit": {"author": {"name": "Piotr Trojanek", "email": "trojanek@adacore.com", "date": "2022-01-19T12:35:46Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2022-05-10T08:19:22Z"}, "message": "[Ada] Replace variables with constants in expanded code for task names\n\nUsing constants instead of variables is cleaner both in human-written\nand auto-generated code.\n\nCleanup related to handling of character values in SPARK\ncounterexamples, which just like the code for names of tasks create\nN_Character_Literal nodes.\n\ngcc/ada/\n\n\t* exp_util.adb (Build_Task_Array_Image): Declare expanded\n\tobjects as constants.\n\t(Build_Task_Image_Prefix): Likewise.\n\t(Build_Task_Record_Image): Likewise.", "tree": {"sha": "95175516735f2af45962b97a05b4d797620d5443", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95175516735f2af45962b97a05b4d797620d5443"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d979a676fde85a362cb8d7b142300a494370f3e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d979a676fde85a362cb8d7b142300a494370f3e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d979a676fde85a362cb8d7b142300a494370f3e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d979a676fde85a362cb8d7b142300a494370f3e9/comments", "author": {"login": "ptroja", "id": 161602, "node_id": "MDQ6VXNlcjE2MTYwMg==", "avatar_url": "https://avatars.githubusercontent.com/u/161602?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ptroja", "html_url": "https://github.com/ptroja", "followers_url": "https://api.github.com/users/ptroja/followers", "following_url": "https://api.github.com/users/ptroja/following{/other_user}", "gists_url": "https://api.github.com/users/ptroja/gists{/gist_id}", "starred_url": "https://api.github.com/users/ptroja/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ptroja/subscriptions", "organizations_url": "https://api.github.com/users/ptroja/orgs", "repos_url": "https://api.github.com/users/ptroja/repos", "events_url": "https://api.github.com/users/ptroja/events{/privacy}", "received_events_url": "https://api.github.com/users/ptroja/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5046228671e991170c19c1c0d9f70a51026e2cab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5046228671e991170c19c1c0d9f70a51026e2cab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5046228671e991170c19c1c0d9f70a51026e2cab"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "c28723c35e08010e02d5af4400e1e02662383f95", "filename": "gcc/ada/exp_util.adb", "status": "modified", "additions": 12, "deletions": 6, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d979a676fde85a362cb8d7b142300a494370f3e9/gcc%2Fada%2Fexp_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d979a676fde85a362cb8d7b142300a494370f3e9/gcc%2Fada%2Fexp_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.adb?ref=d979a676fde85a362cb8d7b142300a494370f3e9", "patch": "@@ -4049,11 +4049,13 @@ package body Exp_Util is\n \n    --  function F return String is\n    --     Pref : String renames Task_Name;\n-   --     T1   : String := Index1'Image (Val1);\n+   --     T1   : constant String := Index1'Image (Val1);\n    --     ...\n-   --     Tn   : String := Indexn'Image (Valn);\n-   --     Len  : Integer := Pref'Length + T1'Length + ... + Tn'Length + n + 1;\n+   --     Tn   : constant String := Indexn'Image (Valn);\n+   --     Len  : constant Integer :=\n+   --       Pref'Length + T1'Length + ... + Tn'Length + n + 1;\n    --     --  Len includes commas and the end parentheses\n+   --\n    --     Res  : String (1 .. Len);\n    --     Pos  : Integer := Pref'Length;\n    --\n@@ -4124,8 +4126,9 @@ package body Exp_Util is\n          Append_To (Decls,\n            Make_Object_Declaration (Loc,\n              Defining_Identifier => Pref,\n-             Object_Definition => New_Occurrence_Of (Standard_String, Loc),\n-             Expression =>\n+             Constant_Present    => True,\n+             Object_Definition   => New_Occurrence_Of (Standard_String, Loc),\n+             Expression          =>\n                Make_String_Literal (Loc,\n                  Strval => String_From_Name_Buffer)));\n \n@@ -4148,6 +4151,7 @@ package body Exp_Util is\n            Make_Object_Declaration (Loc,\n              Defining_Identifier => T,\n              Object_Definition   => New_Occurrence_Of (Standard_String, Loc),\n+             Constant_Present    => True,\n              Expression          =>\n                Make_Attribute_Reference (Loc,\n                  Attribute_Name => Name_Image,\n@@ -4425,6 +4429,7 @@ package body Exp_Util is\n       Append_To (Decls,\n         Make_Object_Declaration (Loc,\n           Defining_Identifier => Len,\n+          Constant_Present    => True,\n           Object_Definition   => New_Occurrence_Of (Standard_Integer, Loc),\n           Expression          => Sum));\n \n@@ -4530,7 +4535,8 @@ package body Exp_Util is\n          Append_To (Decls,\n            Make_Object_Declaration (Loc,\n              Defining_Identifier => Pref,\n-             Object_Definition => New_Occurrence_Of (Standard_String, Loc),\n+             Constant_Present    => True,\n+             Object_Definition   => New_Occurrence_Of (Standard_String, Loc),\n              Expression =>\n                Make_String_Literal (Loc,\n                  Strval => String_From_Name_Buffer)));"}]}