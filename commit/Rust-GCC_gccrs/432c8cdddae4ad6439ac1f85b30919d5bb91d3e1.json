{"sha": "432c8cdddae4ad6439ac1f85b30919d5bb91d3e1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDMyYzhjZGRkYWU0YWQ2NDM5YWMxZjg1YjMwOTE5ZDViYjkxZDNlMQ==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2019-08-19T08:36:44Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-19T08:36:44Z"}, "message": "[Ada] Legality of protected subp. implementing interface operations\n\nThis patch refines the predicate that implements rule in RM 9.4 (11.9/2)\n\nCompiling b94.ads must yield:\n\n   b94.ads:11:17: illegal overriding of subprogram inherited from interface\n   b94.ads:11:17: first formal of \"N\" declared at line 8 must be of mode\n     \"out\", \"in out\" or access-to-variable\n\n----\npackage B94 is\n\n   type Prot2_Int is protected interface;\n   procedure  J (PI : in     Prot2_Int; N : in Integer)  is null;\n   procedure  K (PI : in out Prot2_Int; N : in Integer)  is null;\n   procedure  L (PI :    out Prot2_Int; N : in Integer)  is null;\n   procedure  M (PI : access Prot2_Int; N : in Integer)  is null;\n   procedure  N (PI : access constant Prot2_Int; N : in Integer)  is null;\n\n   protected type Protected_2 is new Prot2_Int with\n      procedure N (N : in Integer);                   -- ERROR: {7;1}\n   end Protected_2;\n\nend B94;\n\n2019-08-19  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch6.adb (Check_Synchronized_Overriding): Complete\n\tpredicate that applies legality check in 9.4 (11.9/2): if an\n\tinherited subprogram is implemented by a protected procedure or\n\tentry, its first paarameter must be out, in_out or\n\taccess_to_varible.\n\nFrom-SVN: r274655", "tree": {"sha": "d07a989f09cbe87aeaeefc3072e2c44ea4b64ecd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d07a989f09cbe87aeaeefc3072e2c44ea4b64ecd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bd5ed03ae9217ae903131e7345cf4ef7e6ba3437", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd5ed03ae9217ae903131e7345cf4ef7e6ba3437", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd5ed03ae9217ae903131e7345cf4ef7e6ba3437"}], "stats": {"total": 31, "additions": 27, "deletions": 4}, "files": [{"sha": "313a5efa165c98deb9485f774bbc6856f13bddab", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=432c8cdddae4ad6439ac1f85b30919d5bb91d3e1", "patch": "@@ -1,3 +1,11 @@\n+2019-08-19  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch6.adb (Check_Synchronized_Overriding): Complete\n+\tpredicate that applies legality check in 9.4 (11.9/2): if an\n+\tinherited subprogram is implemented by a protected procedure or\n+\tentry, its first paarameter must be out, in_out or\n+\taccess_to_varible.\n+\n 2019-08-19  Javier Miranda  <miranda@adacore.com>\n \n \tPR ada/65696"}, {"sha": "fb50ec7998992bf76f50bbe8c6a2c37e201d11a2", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/432c8cdddae4ad6439ac1f85b30919d5bb91d3e1/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=432c8cdddae4ad6439ac1f85b30919d5bb91d3e1", "patch": "@@ -7034,6 +7034,11 @@ package body Sem_Ch6 is\n       In_Scope    : Boolean;\n       Typ         : Entity_Id;\n \n+      function Is_Valid_Formal (F : Entity_Id) return Boolean;\n+      --  Predicate for legality rule in 9.4 (11.9/2): If an inherited\n+      --  subprogram is implemented by a protected procedure or entry,\n+      --  its first parameter must be out, in out, or access-to-variable.\n+\n       function Matches_Prefixed_View_Profile\n         (Prim_Params  : List_Id;\n          Iface_Params : List_Id) return Boolean;\n@@ -7042,6 +7047,19 @@ package body Sem_Ch6 is\n       --  Iface_Params. Also determine if the type of first parameter of\n       --  Iface_Params is an implemented interface.\n \n+      ----------------------\n+      --  Is_Valid_Formal --\n+      ----------------------\n+\n+      function Is_Valid_Formal (F : Entity_Id) return Boolean is\n+      begin\n+         return\n+           Ekind_In (F, E_In_Out_Parameter, E_Out_Parameter)\n+             or else\n+               (Nkind (Parameter_Type (Parent (F))) = N_Access_Definition\n+                 and then not Constant_Present (Parameter_Type (Parent (F))));\n+      end Is_Valid_Formal;\n+\n       -----------------------------------\n       -- Matches_Prefixed_View_Profile --\n       -----------------------------------\n@@ -7295,10 +7313,7 @@ package body Sem_Ch6 is\n \n                   if Ekind_In (Candidate, E_Entry, E_Procedure)\n                     and then Is_Protected_Type (Typ)\n-                    and then Ekind (Formal) /= E_In_Out_Parameter\n-                    and then Ekind (Formal) /= E_Out_Parameter\n-                    and then Nkind (Parameter_Type (Parent (Formal))) /=\n-                                                       N_Access_Definition\n+                    and then not Is_Valid_Formal (Formal)\n                   then\n                      null;\n "}]}