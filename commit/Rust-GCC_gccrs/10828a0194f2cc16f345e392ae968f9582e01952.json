{"sha": "10828a0194f2cc16f345e392ae968f9582e01952", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTA4MjhhMDE5NGYyY2MxNmYzNDVlMzkyYWU5NjhmOTU4MmUwMTk1Mg==", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2014-12-09T02:53:00Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@gcc.gnu.org", "date": "2014-12-09T02:53:00Z"}, "message": "simplify-rtx.c (simplify_relational_operation_1): Handle simplification identities for BICS patterns.\n\n2014-12-08  Sandra Loosemore  <sandra@codesourcery.com>\n\n\tgcc/\n\t* simplify-rtx.c (simplify_relational_operation_1): Handle\n\tsimplification identities for BICS patterns.\n\n\tgcc/testsuite/\n\t* gcc.target/aarch64/bics_4.c: New.\n\nFrom-SVN: r218503", "tree": {"sha": "cd75cdabae8e92253d9371bd0dae743d7c9e863d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cd75cdabae8e92253d9371bd0dae743d7c9e863d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10828a0194f2cc16f345e392ae968f9582e01952", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10828a0194f2cc16f345e392ae968f9582e01952", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10828a0194f2cc16f345e392ae968f9582e01952", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10828a0194f2cc16f345e392ae968f9582e01952/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "58dddbd21adef585e9f049e83bd58a1a08da074d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58dddbd21adef585e9f049e83bd58a1a08da074d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58dddbd21adef585e9f049e83bd58a1a08da074d"}], "stats": {"total": 122, "additions": 122, "deletions": 0}, "files": [{"sha": "9ec29799393c54fbe5c279cbfc25682b1c70d38d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=10828a0194f2cc16f345e392ae968f9582e01952", "patch": "@@ -1,3 +1,8 @@\n+2014-12-08  Sandra Loosemore  <sandra@codesourcery.com>\n+\n+\t* simplify-rtx.c (simplify_relational_operation_1): Handle\n+\tsimplification identities for BICS patterns.\n+\n 2014-12-08  Trevor Saunders  <tsaunders@mozilla.com>\n \n \t* config/nvptx/nvptx.c: Convert htabs to hash_table."}, {"sha": "1cbb157dc71290593446ac9f2ddb18b49c341144", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=10828a0194f2cc16f345e392ae968f9582e01952", "patch": "@@ -4550,6 +4550,32 @@ simplify_relational_operation_1 (enum rtx_code code, machine_mode mode,\n \t\t\t\t    simplify_gen_binary (XOR, cmp_mode,\n \t\t\t\t\t\t\t XEXP (op0, 1), op1));\n \n+  /* (eq/ne (and x y) x) simplifies to (eq/ne (and (not y) x) 0), which\n+     can be implemented with a BICS instruction on some targets, or\n+     constant-folded if y is a constant.  */\n+  if ((code == EQ || code == NE)\n+      && op0code == AND\n+      && rtx_equal_p (XEXP (op0, 0), op1)\n+      && !side_effects_p (op1))\n+    {\n+      rtx not_y = simplify_gen_unary (NOT, cmp_mode, XEXP (op0, 1), cmp_mode);\n+      rtx lhs = simplify_gen_binary (AND, cmp_mode, not_y, XEXP (op0, 0));\n+\n+      return simplify_gen_relational (code, mode, cmp_mode, lhs, const0_rtx);\n+    }\n+\n+  /* Likewise for (eq/ne (and x y) y).  */\n+  if ((code == EQ || code == NE)\n+      && op0code == AND\n+      && rtx_equal_p (XEXP (op0, 1), op1)\n+      && !side_effects_p (op1))\n+    {\n+      rtx not_x = simplify_gen_unary (NOT, cmp_mode, XEXP (op0, 0), cmp_mode);\n+      rtx lhs = simplify_gen_binary (AND, cmp_mode, not_x, XEXP (op0, 1));\n+\n+      return simplify_gen_relational (code, mode, cmp_mode, lhs, const0_rtx);\n+    }\n+\n   /* (eq/ne (bswap x) C1) simplifies to (eq/ne x C2) with C2 swapped.  */\n   if ((code == EQ || code == NE)\n       && GET_CODE (op0) == BSWAP"}, {"sha": "b5ddcca56797e9d9b641be7169b6589cb1fe46e9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=10828a0194f2cc16f345e392ae968f9582e01952", "patch": "@@ -1,3 +1,7 @@\n+2014-12-08  Sandra Loosemore  <sandra@codesourcery.com>\n+\n+\t* gcc.target/aarch64/bics_4.c: New.\n+\n 2014-12-08  Mark Wielaard  <mjw@redhat.com>\n \n \tPR debug/60782"}, {"sha": "ee82c4f7744eb11a3b56696b4fab8016efd5801b", "filename": "gcc/testsuite/gcc.target/aarch64/bics_4.c", "status": "added", "additions": 87, "deletions": 0, "changes": 87, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbics_4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10828a0194f2cc16f345e392ae968f9582e01952/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbics_4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Faarch64%2Fbics_4.c?ref=10828a0194f2cc16f345e392ae968f9582e01952", "patch": "@@ -0,0 +1,87 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O2 --save-temps -fno-inline\" } */\n+\n+extern void abort (void);\n+\n+int\n+bics_si_test1 (int a, int b, int c)\n+{\n+  if ((a & b) == a)\n+    return a;\n+  else\n+    return c;\n+}\n+\n+int\n+bics_si_test2 (int a, int b, int c)\n+{\n+  if ((a & b) == b)\n+    return b;\n+  else\n+    return c;\n+}\n+\n+typedef long long s64;\n+\n+s64\n+bics_di_test1 (s64 a, s64 b, s64 c)\n+{\n+  if ((a & b) == a)\n+    return a;\n+  else\n+    return c;\n+}\n+\n+s64\n+bics_di_test2 (s64 a, s64 b, s64 c)\n+{\n+  if ((a & b) == b)\n+    return b;\n+  else\n+    return c;\n+}\n+\n+int\n+main ()\n+{\n+  int x;\n+  s64 y;\n+\n+  x = bics_si_test1 (0xf00d, 0xf11f, 0);\n+  if (x != 0xf00d)\n+    abort ();\n+\n+  x = bics_si_test1 (0xf11f, 0xf00d, 0);\n+  if (x != 0)\n+    abort ();\n+\n+  x = bics_si_test2 (0xf00d, 0xf11f, 0);\n+  if (x != 0)\n+    abort ();\n+\n+  x = bics_si_test2 (0xf11f, 0xf00d, 0);\n+  if (x != 0xf00d)\n+    abort ();\n+\n+  y = bics_di_test1 (0x10001000f00dll, 0x12341000f00dll, 0ll);\n+  if (y != 0x10001000f00dll)\n+    abort ();\n+\n+  y = bics_di_test1 (0x12341000f00dll, 0x10001000f00dll, 0ll);\n+  if (y != 0)\n+    abort ();\n+\n+  y = bics_di_test2 (0x10001000f00dll, 0x12341000f00dll, 0ll);\n+  if (y != 0)\n+    abort ();\n+\n+  y = bics_di_test2 (0x12341000f00dll, 0x10001000f00dll, 0ll);\n+  if (y != 0x10001000f00dll)\n+    abort ();\n+\n+  return 0;\n+}\n+\n+/* { dg-final { scan-assembler-times \"bics\\twzr, w\\[0-9\\]+, w\\[0-9\\]+\" 2 } } */\n+/* { dg-final { scan-assembler-times \"bics\\txzr, x\\[0-9\\]+, x\\[0-9\\]+\" 2 } } */\n+/* { dg-final { cleanup-saved-temps } } */"}]}