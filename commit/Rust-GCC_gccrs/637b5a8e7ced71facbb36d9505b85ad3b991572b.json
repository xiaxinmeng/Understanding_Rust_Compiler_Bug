{"sha": "637b5a8e7ced71facbb36d9505b85ad3b991572b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM3YjVhOGU3Y2VkNzFmYWNiYjM2ZDk1MDViODVhZDNiOTkxNTcyYg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-04-03T21:01:26Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-04-03T21:01:26Z"}, "message": "re PR fortran/35786 (OpenMP Fortran PRIVATE on parameter gives error in gfc_finish_var_decl)\n\n\tPR fortran/35786\n\t* openmp.c (resolve_omp_clauses): Diagnose if a clause symbol\n\tisn't a variable.\n\n\t* gfortran.dg/gomp/pr35786-1.f90: New test.\n\t* gfortran.dg/gomp/pr35786-2.f90: New test.\n\nFrom-SVN: r133874", "tree": {"sha": "02b953d9998d526e71e6468cb7fbc7b9f9826267", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02b953d9998d526e71e6468cb7fbc7b9f9826267"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/637b5a8e7ced71facbb36d9505b85ad3b991572b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/637b5a8e7ced71facbb36d9505b85ad3b991572b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/637b5a8e7ced71facbb36d9505b85ad3b991572b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/637b5a8e7ced71facbb36d9505b85ad3b991572b/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "940f3b52196cc3ca48200d40d9e9f46e145998d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/940f3b52196cc3ca48200d40d9e9f46e145998d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/940f3b52196cc3ca48200d40d9e9f46e145998d9"}], "stats": {"total": 170, "additions": 169, "deletions": 1}, "files": [{"sha": "851008ed3950ba91be3055c6549c00617908e741", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=637b5a8e7ced71facbb36d9505b85ad3b991572b", "patch": "@@ -1,3 +1,9 @@\n+2008-04-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/35786\n+\t* openmp.c (resolve_omp_clauses): Diagnose if a clause symbol\n+\tisn't a variable.\n+\n 2008-04-03  Tom Tromey  <tromey@redhat.com>\n \n \t* Make-lang.in (fortran_OBJS): New variable."}, {"sha": "245f7951ddc51002282ab7f2b0c9a4111971545e", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=637b5a8e7ced71facbb36d9505b85ad3b991572b", "patch": "@@ -717,7 +717,41 @@ resolve_omp_clauses (gfc_code *code)\n      a symbol can appear on both firstprivate and lastprivate.  */\n   for (list = 0; list < OMP_LIST_NUM; list++)\n     for (n = omp_clauses->lists[list]; n; n = n->next)\n-      n->sym->mark = 0;\n+      {\n+\tn->sym->mark = 0;\n+\tif (n->sym->attr.flavor == FL_VARIABLE)\n+\t  continue;\n+\tif (n->sym->attr.flavor == FL_PROCEDURE\n+\t    && n->sym->result == n->sym\n+\t    && n->sym->attr.function)\n+\t  {\n+\t    if (gfc_current_ns->proc_name == n->sym\n+\t\t|| (gfc_current_ns->parent\n+\t\t    && gfc_current_ns->parent->proc_name == n->sym))\n+\t      continue;\n+\t    if (gfc_current_ns->proc_name->attr.entry_master)\n+\t      {\n+\t\tgfc_entry_list *el = gfc_current_ns->entries;\n+\t\tfor (; el; el = el->next)\n+\t\t  if (el->sym == n->sym)\n+\t\t    break;\n+\t\tif (el)\n+\t\t  continue;\n+\t      }\n+\t    if (gfc_current_ns->parent\n+\t\t&& gfc_current_ns->parent->proc_name->attr.entry_master)\n+\t      {\n+\t\tgfc_entry_list *el = gfc_current_ns->parent->entries;\n+\t\tfor (; el; el = el->next)\n+\t\t  if (el->sym == n->sym)\n+\t\t    break;\n+\t\tif (el)\n+\t\t  continue;\n+\t      }\n+\t  }\n+\tgfc_error (\"Object '%s' is not a variable at %L\", n->sym->name,\n+\t\t   &code->loc);\n+      }\n \n   for (list = 0; list < OMP_LIST_NUM; list++)\n     if (list != OMP_LIST_FIRSTPRIVATE && list != OMP_LIST_LASTPRIVATE)"}, {"sha": "bd7e6e5815de566e3dd117623af5b4e4e7d9108b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=637b5a8e7ced71facbb36d9505b85ad3b991572b", "patch": "@@ -1,3 +1,9 @@\n+2008-04-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/35786\n+\t* gfortran.dg/gomp/pr35786-1.f90: New test.\n+\t* gfortran.dg/gomp/pr35786-2.f90: New test.\n+\n 2008-04-03  Adam Nemet  <anemet@caviumnetworks.com>\n \n \t* gcc.target/mips/scc-1.c: New test."}, {"sha": "c8639abdbbd035f7e3a7f755c285fc941e4ac0db", "filename": "gcc/testsuite/gfortran.dg/gomp/pr35786-1.f90", "status": "added", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr35786-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr35786-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr35786-1.f90?ref=637b5a8e7ced71facbb36d9505b85ad3b991572b", "patch": "@@ -0,0 +1,74 @@\n+! PR fortran/35786\n+! { dg-do compile }\n+! { dg-options \"-fopenmp\" }\n+\n+module pr35768\n+  real, parameter :: one = 1.0\n+contains\n+  subroutine fn1\n+    !$omp parallel firstprivate (one)\t! { dg-error \"is not a variable\" }\n+    !$omp end parallel\n+  end subroutine fn1\n+  subroutine fn2 (doit)\n+    external doit\n+    !$omp parallel firstprivate (doit)\t! { dg-error \"is not a variable\" }\n+      call doit ()\n+    !$omp end parallel\n+  end subroutine fn2\n+  subroutine fn3\n+    interface fn4\n+      subroutine fn4 ()\n+      end subroutine fn4\n+    end interface\n+    !$omp parallel private (fn4)\t! { dg-error \"is not a variable\" }\n+      call fn4 ()\n+    !$omp end parallel\n+  end subroutine fn3\n+  subroutine fn5\n+    interface fn6\n+      function fn6 ()\n+        integer :: fn6\n+      end function fn6\n+    end interface\n+    integer :: x\n+    !$omp parallel private (fn6, x)\t! { dg-error \"is not a variable\" }\n+      x = fn6 ()\n+    !$omp end parallel\n+  end subroutine fn5\n+  function fn7 () result (re7)\n+    integer :: re7\n+    !$omp parallel private (fn7)\t! { dg-error \"is not a variable\" }\n+    !$omp end parallel\n+  end function fn7\n+  function fn8 () result (re8)\n+    integer :: re8\n+    call fn9\n+  contains\n+    subroutine fn9\n+      !$omp parallel private (fn8)\t! { dg-error \"is not a variable\" }\n+      !$omp end parallel\n+    end subroutine fn9\n+  end function fn8\n+  function fn10 () result (re10)\n+    integer :: re10, re11\n+    entry fn11 () result (re11)\n+    !$omp parallel private (fn10)\t! { dg-error \"is not a variable\" }\n+    !$omp end parallel\n+    !$omp parallel private (fn11)\t! { dg-error \"is not a variable\" }\n+    !$omp end parallel\n+  end function fn10\n+  function fn12 () result (re12)\n+    integer :: re12, re13\n+    entry fn13 () result (re13)\n+    call fn14\n+  contains\n+    subroutine fn14\n+      !$omp parallel private (fn12)\t! { dg-error \"is not a variable\" }\n+      !$omp end parallel\n+      !$omp parallel private (fn13)\t! { dg-error \"is not a variable\" }\n+      !$omp end parallel\n+    end subroutine fn14\n+  end function fn12\n+end module\n+\n+! { dg-final { cleanup-modules \"pr35768\" } }"}, {"sha": "beb1a828df29e9ab5b2b7ee9ad281973ceb0fd73", "filename": "gcc/testsuite/gfortran.dg/gomp/pr35786-2.f90", "status": "added", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr35786-2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/637b5a8e7ced71facbb36d9505b85ad3b991572b/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr35786-2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fpr35786-2.f90?ref=637b5a8e7ced71facbb36d9505b85ad3b991572b", "patch": "@@ -0,0 +1,48 @@\n+! PR fortran/35786\n+! { dg-do compile }\n+! { dg-options \"-fopenmp\" }\n+\n+function fn7 ()\n+  integer :: fn7\n+  !$omp parallel private (fn7)\n+    fn7 = 6\n+  !$omp end parallel\n+  fn7 = 7\n+end function fn7\n+function fn8 ()\n+  integer :: fn8\n+  call fn9\n+contains\n+  subroutine fn9\n+    !$omp parallel private (fn8)\n+      fn8 = 6\n+    !$omp end parallel\n+    fn8 = 7\n+  end subroutine fn9\n+end function fn8\n+function fn10 ()\n+  integer :: fn10, fn11\n+  entry fn11 ()\n+  !$omp parallel private (fn10)\n+    fn10 = 6\n+  !$omp end parallel\n+  !$omp parallel private (fn11)\n+    fn11 = 6\n+  !$omp end parallel\n+  fn10 = 7\n+end function fn10\n+function fn12 ()\n+  integer :: fn12, fn13\n+  entry fn13 ()\n+  call fn14\n+contains\n+  subroutine fn14\n+    !$omp parallel private (fn12)\n+      fn12 = 6\n+    !$omp end parallel\n+    !$omp parallel private (fn13)\n+      fn13 = 6\n+    !$omp end parallel\n+    fn12 = 7\n+  end subroutine fn14\n+end function fn12"}]}