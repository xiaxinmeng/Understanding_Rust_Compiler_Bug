{"sha": "a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTkyMmM1ZmY2ZjM4NzJmYzljZTFlNDg0YTBlOTJmMjg4ZmY2YzY4ZA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2016-09-23T17:25:23Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2016-09-23T17:25:23Z"}, "message": "Optimize truncating a basic_string\n\n\t* include/bits/basic_string.h [_GLIBCXX_USE_CXX11_ABI]\n\t(basic_string::erase(size_type, size_type)): Add fast path for\n\ttruncating the string, by calling _M_set_length directly.\n\t(basic_string::erase(__const_iterator, __const_iterator)): Likewise.\n\t* include/bits/basic_string.tcc [_GLIBCXX_USE_CXX11_ABI]\n\t(basic_string::resize(size_type, _CharT)): Likewise.\n\nFrom-SVN: r240446", "tree": {"sha": "62231e54ad2ab9735e402dda27e441a3c84f50bb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/62231e54ad2ab9735e402dda27e441a3c84f50bb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b862552dff04fbd4c7debf07a7c82d361869a552", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b862552dff04fbd4c7debf07a7c82d361869a552", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b862552dff04fbd4c7debf07a7c82d361869a552"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "80bc018c9bba4ec6f270aee2d4c0707b0d74b020", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "patch": "@@ -1,3 +1,12 @@\n+2016-09-23  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\t* include/bits/basic_string.h [_GLIBCXX_USE_CXX11_ABI]\n+\t(basic_string::erase(size_type, size_type)): Add fast path for\n+\ttruncating the string, by calling _M_set_length directly.\n+\t(basic_string::erase(__const_iterator, __const_iterator)): Likewise.\n+\t* include/bits/basic_string.tcc [_GLIBCXX_USE_CXX11_ABI]\n+\t(basic_string::resize(size_type, _CharT)): Likewise.\n+\n 2016-09-22  Jason Merrill  <jason@redhat.com>\n \n \t* configure.ac: Define HAVE_MEMALIGN for newlib."}, {"sha": "2708cbc60b79b70a496dce594505c1eb3a6ce8f1", "filename": "libstdc++-v3/include/bits/basic_string.h", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.h?ref=a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "patch": "@@ -1709,8 +1709,11 @@ _GLIBCXX_BEGIN_NAMESPACE_CXX11\n       basic_string&\n       erase(size_type __pos = 0, size_type __n = npos)\n       {\n-\tthis->_M_erase(_M_check(__pos, \"basic_string::erase\"),\n-\t\t       _M_limit(__pos, __n));\n+\t_M_check(__pos, \"basic_string::erase\");\n+\tif (__n == npos)\n+\t  this->_M_set_length(__pos);\n+\telse if (__n != 0)\n+\t  this->_M_erase(__pos, _M_limit(__pos, __n));\n \treturn *this;\n       }\n \n@@ -1747,7 +1750,10 @@ _GLIBCXX_BEGIN_NAMESPACE_CXX11\n \t_GLIBCXX_DEBUG_PEDASSERT(__first >= begin() && __first <= __last\n \t\t\t\t && __last <= end());\n         const size_type __pos = __first - begin();\n-\tthis->_M_erase(__pos, __last - __first);\n+\tif (__last == end())\n+\t  this->_M_set_length(__pos);\n+\telse\n+\t  this->_M_erase(__pos, __last - __first);\n \treturn iterator(this->_M_data() + __pos);\n       }\n "}, {"sha": "df1e8ddec75f730fdb20830ff93460d154e4bd79", "filename": "libstdc++-v3/include/bits/basic_string.tcc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fbasic_string.tcc?ref=a922c5ff6f3872fc9ce1e484a0e92f288ff6c68d", "patch": "@@ -351,7 +351,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       if (__size < __n)\n \tthis->append(__n - __size, __c);\n       else if (__n < __size)\n-\tthis->_M_erase(__n, __size - __n);\n+\tthis->_M_set_length(__n);\n     }\n \n   template<typename _CharT, typename _Traits, typename _Alloc>"}]}