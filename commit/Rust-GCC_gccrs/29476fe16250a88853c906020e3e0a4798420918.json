{"sha": "29476fe16250a88853c906020e3e0a4798420918", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjk0NzZmZTE2MjUwYTg4ODUzYzkwNjAyMGUzZTBhNDc5ODQyMDkxOA==", "commit": {"author": {"name": "Diego Novillo", "email": "dnovillo@google.com", "date": "2012-07-19T14:35:18Z"}, "committer": {"name": "Diego Novillo", "email": "dnovillo@gcc.gnu.org", "date": "2012-07-19T14:35:18Z"}, "message": "Fix --produce_manifest flag in validate_failures.py.\n\nWhen I added the functionality to use other summary files for\nreporting, I broke the generation of manifests. When sum files are\npassed on, we need to use the list. Otherwise, we need to find summary\nfiles in the build directory.\n\nThis patch factors out that logic into a new function and calls it\nfrom both the reporting and generation routines.\n\nCommitted to trunk.\n\n\t* testsuite-management/validate_failures.py (CollectSumFiles):\n\tRename from GetSumFiles.\n\t(GetSumFiles): Factor out of CheckExpectedResults.\n\t(CheckExpectedResults): Call it.\n\t(ProduceManifest): Call it.\n\nFrom-SVN: r189662", "tree": {"sha": "4a70bce2b2fe2426062cd251190386021f731bf3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4a70bce2b2fe2426062cd251190386021f731bf3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/29476fe16250a88853c906020e3e0a4798420918", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29476fe16250a88853c906020e3e0a4798420918", "html_url": "https://github.com/Rust-GCC/gccrs/commit/29476fe16250a88853c906020e3e0a4798420918", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/29476fe16250a88853c906020e3e0a4798420918/comments", "author": {"login": "dnovillo", "id": 7295335, "node_id": "MDQ6VXNlcjcyOTUzMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/7295335?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dnovillo", "html_url": "https://github.com/dnovillo", "followers_url": "https://api.github.com/users/dnovillo/followers", "following_url": "https://api.github.com/users/dnovillo/following{/other_user}", "gists_url": "https://api.github.com/users/dnovillo/gists{/gist_id}", "starred_url": "https://api.github.com/users/dnovillo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dnovillo/subscriptions", "organizations_url": "https://api.github.com/users/dnovillo/orgs", "repos_url": "https://api.github.com/users/dnovillo/repos", "events_url": "https://api.github.com/users/dnovillo/events{/privacy}", "received_events_url": "https://api.github.com/users/dnovillo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "65e7bfe359febac74ebd3de0c36e735166205950", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65e7bfe359febac74ebd3de0c36e735166205950", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65e7bfe359febac74ebd3de0c36e735166205950"}], "stats": {"total": 31, "additions": 22, "deletions": 9}, "files": [{"sha": "ee68edba2e533b39c7d180b61afe0367edfb600b", "filename": "contrib/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29476fe16250a88853c906020e3e0a4798420918/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29476fe16250a88853c906020e3e0a4798420918/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=29476fe16250a88853c906020e3e0a4798420918", "patch": "@@ -1,3 +1,11 @@\n+2012-07-19   Diego Novillo  <dnovillo@google.com>\n+\n+\t* testsuite-management/validate_failures.py (CollectSumFiles):\n+\tRename from GetSumFiles.\n+\t(GetSumFiles): Factor out of CheckExpectedResults.\n+\t(CheckExpectedResults): Call it.\n+\t(ProduceManifest): Call it.\n+\n 2012-07-18   Diego Novillo  <dnovillo@google.com>\n \n \t* testsuite-management/validate_failures.py: Fix"}, {"sha": "c48e4c3de7032d142339747d97d7156795b612d1", "filename": "contrib/testsuite-management/validate_failures.py", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/29476fe16250a88853c906020e3e0a4798420918/contrib%2Ftestsuite-management%2Fvalidate_failures.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/29476fe16250a88853c906020e3e0a4798420918/contrib%2Ftestsuite-management%2Fvalidate_failures.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Ftestsuite-management%2Fvalidate_failures.py?ref=29476fe16250a88853c906020e3e0a4798420918", "patch": "@@ -195,7 +195,7 @@ def GetManifest(manifest_name):\n     return set()\n \n \n-def GetSumFiles(builddir):\n+def CollectSumFiles(builddir):\n   sum_files = []\n   for root, dirs, files in os.walk(builddir):\n     if '.svn' in dirs:\n@@ -255,6 +255,16 @@ def PrintSummary(msg, summary):\n     print result\n \n \n+def GetSumFiles(results, build_dir):\n+  if not results:\n+    print 'Getting actual results from build'\n+    sum_files = CollectSumFiles(build_dir)\n+  else:\n+    print 'Getting actual results from user-provided results'\n+    sum_files = results.split()\n+  return sum_files\n+\n+\n def CheckExpectedResults(options):\n   if not options.manifest:\n     (srcdir, target, valid_build) = GetBuildData(options)\n@@ -268,13 +278,7 @@ def CheckExpectedResults(options):\n \n   print 'Manifest:         %s' % manifest_name\n   manifest = GetManifest(manifest_name)\n-\n-  if not options.results:\n-    print 'Getting actual results from build'\n-    sum_files = GetSumFiles(options.build_dir)\n-  else:\n-    print 'Getting actual results from user-provided results'\n-    sum_files = options.results.split()\n+  sum_files = GetSumFiles(options.results, options.build_dir)\n   actual = GetResults(sum_files)\n \n   if options.verbosity >= 1:\n@@ -311,7 +315,8 @@ def ProduceManifest(options):\n     Error('Manifest file %s already exists.\\nUse --force to overwrite.' %\n           manifest_name)\n \n-  actual = GetResults(options.build_dir)\n+  sum_files = GetSumFiles(options.results, options.build_dir)\n+  actual = GetResults(sum_files)\n   with open(manifest_name, 'w') as manifest_file:\n     for result in sorted(actual):\n       print result"}]}