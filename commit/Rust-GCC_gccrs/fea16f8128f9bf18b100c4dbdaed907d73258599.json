{"sha": "fea16f8128f9bf18b100c4dbdaed907d73258599", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmVhMTZmODEyOGY5YmYxOGIxMDBjNGRiZGFlZDkwN2Q3MzI1ODU5OQ==", "commit": {"author": {"name": "Danny Smith", "email": "dannysmith@users.sourceforge.net", "date": "2008-09-03T06:07:34Z"}, "committer": {"name": "Danny Smith", "email": "dannysmith@gcc.gnu.org", "date": "2008-09-03T06:07:34Z"}, "message": "gthr-win32.h (CONST_CAST2): Really make sure CONST_CAST2 is defined.\n\n\t* gthr-win32.h (CONST_CAST2): Really make sure CONST_CAST2 is\n\tdefined.\n\t(__gthread_setspecific): Revert 2008-08-31 change to\n\t__GTHREAD_HIDE_W32API case.  Apply it to !__GTHREAD_HIDE_W32API\n\tcase.\n\nFrom-SVN: r139927", "tree": {"sha": "ad7a052c71cb20b5f9e5cb79f828adcde10cefd1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad7a052c71cb20b5f9e5cb79f828adcde10cefd1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fea16f8128f9bf18b100c4dbdaed907d73258599", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fea16f8128f9bf18b100c4dbdaed907d73258599", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fea16f8128f9bf18b100c4dbdaed907d73258599", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fea16f8128f9bf18b100c4dbdaed907d73258599/comments", "author": null, "committer": null, "parents": [{"sha": "4ad610c9785f0022e5ebe686650abaa7ff3c2d5c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ad610c9785f0022e5ebe686650abaa7ff3c2d5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ad610c9785f0022e5ebe686650abaa7ff3c2d5c"}], "stats": {"total": 23, "additions": 18, "deletions": 5}, "files": [{"sha": "6bf89c05c0e1abdb225241aaa94272c0cbaf36f2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fea16f8128f9bf18b100c4dbdaed907d73258599/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fea16f8128f9bf18b100c4dbdaed907d73258599/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fea16f8128f9bf18b100c4dbdaed907d73258599", "patch": "@@ -1,3 +1,11 @@\n+2008-09-03 Danny Smith  <dannysmith@usrs.sourceforge.net>\n+\n+\t* gthr-win32.h (CONST_CAST2): Really make sure CONST_CAST2 is\n+\tdefined.\n+\t(__gthread_setspecific): Revert 2008-08-31 change to\n+\t__GTHREAD_HIDE_W32API case.  Apply it to !__GTHREAD_HIDE_W32API\n+\tcase.\n+\n 2008-09-02  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* diagnostic.c (error_at): New."}, {"sha": "e9a6e8869c4ee175cd6400032522ef715b6a77bb", "filename": "gcc/gthr-win32.h", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fea16f8128f9bf18b100c4dbdaed907d73258599/gcc%2Fgthr-win32.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fea16f8128f9bf18b100c4dbdaed907d73258599/gcc%2Fgthr-win32.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgthr-win32.h?ref=fea16f8128f9bf18b100c4dbdaed907d73258599", "patch": "@@ -32,6 +32,11 @@ Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA\n #ifndef GCC_GTHR_WIN32_H\n #define GCC_GTHR_WIN32_H\n \n+/* Make sure CONST_CAST2 (origin in system.h) is declared.  */\n+#ifndef CONST_CAST2\n+#define CONST_CAST2(TOTYPE,FROMTYPE,X) ((__extension__(union {FROMTYPE _q; TOTYPE _nq;})(X))._nq)\n+#endif\n+\n /* Windows32 threads specific definitions. The windows32 threading model\n    does not map well into pthread-inspired gcc's threading model, and so\n    there are caveats one needs to be aware of.\n@@ -455,10 +460,7 @@ __gthread_getspecific (__gthread_key_t key)\n static inline int\n __gthread_setspecific (__gthread_key_t key, const void *ptr)\n {\n-  if (TlsSetValue (key, CONST_CAST2(void *, const void *, ptr)) != 0)\n-    return 0;\n-  else\n-    return GetLastError ();\n+  return __gthr_win32_setspecific (key, ptr);\n }\n \n static inline void\n@@ -615,7 +617,10 @@ __gthread_getspecific (__gthread_key_t key)\n static inline int\n __gthread_setspecific (__gthread_key_t key, const void *ptr)\n {\n-  return (TlsSetValue (key, (void*) ptr) != 0) ? 0 : (int) GetLastError ();\n+  if (TlsSetValue (key, CONST_CAST2(void *, const void *, ptr)) != 0)\n+    return 0;\n+  else\n+    return GetLastError ();\n }\n \n static inline void"}]}