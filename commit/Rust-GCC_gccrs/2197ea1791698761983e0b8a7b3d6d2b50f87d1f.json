{"sha": "2197ea1791698761983e0b8a7b3d6d2b50f87d1f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjE5N2VhMTc5MTY5ODc2MTk4M2UwYjhhN2IzZDZkMmI1MGY4N2QxZg==", "commit": {"author": {"name": "Tom Tromey", "email": "tom@tromey.com", "date": "2019-01-21T15:25:29Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2019-01-21T15:25:29Z"}, "message": "Fix leak in splay-tree\n\nPhilippe Waroquiers noticed a memory leak in gdb, which he tracked\ndown to a bug in splay-tree.  splay_tree_remove does not call the\n`delete_key' function when it removes the old node; but it should.\n\nI looked at every splay tree in GCC and there is only one that passes\na non-NULL delete function -- the one in lto.c.  That file does not\ncall splay_tree_remove.  So, I think this is safe to check in.\n\nI re-ran the LTO tests to double check.\n\nlibiberty/\n\t* splay-tree.c (splay_tree_remove): Delete the key if necessary.\n\nFrom-SVN: r268116", "tree": {"sha": "eecff65f98f1b03858f03fdc3b8165fba939c075", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eecff65f98f1b03858f03fdc3b8165fba939c075"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2197ea1791698761983e0b8a7b3d6d2b50f87d1f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2197ea1791698761983e0b8a7b3d6d2b50f87d1f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2197ea1791698761983e0b8a7b3d6d2b50f87d1f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2197ea1791698761983e0b8a7b3d6d2b50f87d1f/comments", "author": {"login": "tromey", "id": 1557670, "node_id": "MDQ6VXNlcjE1NTc2NzA=", "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tromey", "html_url": "https://github.com/tromey", "followers_url": "https://api.github.com/users/tromey/followers", "following_url": "https://api.github.com/users/tromey/following{/other_user}", "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}", "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tromey/subscriptions", "organizations_url": "https://api.github.com/users/tromey/orgs", "repos_url": "https://api.github.com/users/tromey/repos", "events_url": "https://api.github.com/users/tromey/events{/privacy}", "received_events_url": "https://api.github.com/users/tromey/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c73e7656f5f64a8ee544270adea13cc39ddae70d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c73e7656f5f64a8ee544270adea13cc39ddae70d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c73e7656f5f64a8ee544270adea13cc39ddae70d"}], "stats": {"total": 6, "additions": 6, "deletions": 0}, "files": [{"sha": "08d0a436cf20880a83238ac276998f9988f1ab2a", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2197ea1791698761983e0b8a7b3d6d2b50f87d1f/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2197ea1791698761983e0b8a7b3d6d2b50f87d1f/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=2197ea1791698761983e0b8a7b3d6d2b50f87d1f", "patch": "@@ -1,3 +1,7 @@\n+2019-01-21  Tom Tromey  <tom@tromey.com>\n+\n+\t* splay-tree.c (splay_tree_remove): Delete the key if necessary.\n+\n 2019-01-14  Tom Honermann  <tom@honermann.net>\n \n \t* cp-demangle.c (cplus_demangle_builtin_types)"}, {"sha": "21d23c38dfc01d5a93846cafb572b94de8597539", "filename": "libiberty/splay-tree.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2197ea1791698761983e0b8a7b3d6d2b50f87d1f/libiberty%2Fsplay-tree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2197ea1791698761983e0b8a7b3d6d2b50f87d1f/libiberty%2Fsplay-tree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fsplay-tree.c?ref=2197ea1791698761983e0b8a7b3d6d2b50f87d1f", "patch": "@@ -425,6 +425,8 @@ splay_tree_remove (splay_tree sp, splay_tree_key key)\n       right = sp->root->right;\n \n       /* Delete the root node itself.  */\n+      if (sp->delete_key)\n+\t(*sp->delete_key) (sp->root->key);\n       if (sp->delete_value)\n \t(*sp->delete_value) (sp->root->value);\n       (*sp->deallocate) (sp->root, sp->allocate_data);"}]}