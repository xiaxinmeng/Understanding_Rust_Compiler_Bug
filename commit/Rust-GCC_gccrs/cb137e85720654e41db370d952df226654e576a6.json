{"sha": "cb137e85720654e41db370d952df226654e576a6", "node_id": "C_kwDOANBUbNoAKGNiMTM3ZTg1NzIwNjU0ZTQxZGIzNzBkOTUyZGYyMjY2NTRlNTc2YTY", "commit": {"author": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2021-11-29T17:00:26Z"}, "committer": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2021-12-01T14:10:41Z"}, "message": "Also pre-process PHIs in range-of-stmt.\n\n\tPR tree-optimization/103464\n\t* gimple-range.cc (gimple_ranger::prefill_name): Process phis also.\n\t(gimple_ranger::prefill_stmt_dependencies): Ditto.", "tree": {"sha": "ff745db58975e7fe175f1fbfb61587ead4ca5677", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff745db58975e7fe175f1fbfb61587ead4ca5677"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cb137e85720654e41db370d952df226654e576a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb137e85720654e41db370d952df226654e576a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb137e85720654e41db370d952df226654e576a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb137e85720654e41db370d952df226654e576a6/comments", "author": null, "committer": null, "parents": [{"sha": "a7fede6704dd207fb32b97bc30f945acc7b953c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a7fede6704dd207fb32b97bc30f945acc7b953c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a7fede6704dd207fb32b97bc30f945acc7b953c5"}], "stats": {"total": 29, "additions": 19, "deletions": 10}, "files": [{"sha": "c8431a7180bd307b1f982d3e9e1eff3515d32bfc", "filename": "gcc/gimple-range.cc", "status": "modified", "additions": 19, "deletions": 10, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb137e85720654e41db370d952df226654e576a6/gcc%2Fgimple-range.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb137e85720654e41db370d952df226654e576a6/gcc%2Fgimple-range.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-range.cc?ref=cb137e85720654e41db370d952df226654e576a6", "patch": "@@ -333,7 +333,7 @@ gimple_ranger::prefill_name (irange &r, tree name)\n   if (!gimple_range_ssa_p (name))\n     return;\n   gimple *stmt = SSA_NAME_DEF_STMT (name);\n-  if (!gimple_range_handler (stmt))\n+  if (!gimple_range_handler (stmt) && !is_a<gphi *> (stmt))\n     return;\n \n   bool current;\n@@ -356,8 +356,8 @@ gimple_ranger::prefill_stmt_dependencies (tree ssa)\n   gimple *stmt = SSA_NAME_DEF_STMT (ssa);\n   gcc_checking_assert (stmt && gimple_bb (stmt));\n \n-  // Only pre-process range-ops.\n-  if (!gimple_range_handler (stmt))\n+  // Only pre-process range-ops and phis.\n+  if (!gimple_range_handler (stmt) && !is_a<gphi *> (stmt))\n     return;\n \n   // Mark where on the stack we are starting.\n@@ -401,13 +401,22 @@ gimple_ranger::prefill_stmt_dependencies (tree ssa)\n \t  print_gimple_stmt (dump_file, stmt, 0, TDF_SLIM);\n \t}\n \n-      gcc_checking_assert (gimple_range_handler (stmt));\n-      tree op = gimple_range_operand2 (stmt);\n-      if (op)\n-\tprefill_name (r, op);\n-      op = gimple_range_operand1 (stmt);\n-      if (op)\n-\tprefill_name (r, op);\n+      gphi *phi = dyn_cast <gphi *> (stmt);\n+      if (phi)\n+\t{\n+\t  for (unsigned x = 0; x < gimple_phi_num_args (phi); x++)\n+\t    prefill_name (r, gimple_phi_arg_def (phi, x));\n+\t}\n+      else\n+\t{\n+\t  gcc_checking_assert (gimple_range_handler (stmt));\n+\t  tree op = gimple_range_operand2 (stmt);\n+\t  if (op)\n+\t    prefill_name (r, op);\n+\t  op = gimple_range_operand1 (stmt);\n+\t  if (op)\n+\t    prefill_name (r, op);\n+\t}\n     }\n   if (idx)\n     tracer.trailer (idx, \"ROS \", false, ssa, r);"}]}