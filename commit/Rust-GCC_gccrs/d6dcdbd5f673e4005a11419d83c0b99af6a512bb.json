{"sha": "d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZkY2RiZDVmNjczZTQwMDVhMTE0MTlkODNjMGI5OWFmNmE1MTJiYg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2010-03-03T19:01:46Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2010-03-03T19:01:46Z"}, "message": "re PR c++/12909 (ambiguity in mangling vector types)\n\n\tPR c++/12909\n\t* method.c (make_alias_for): Handle VAR_DECL, too.\n\t* decl2.c (vague_linkage_p): Rename from vague_linkage_fn_p.\n\t* tree.c (no_linkage_check): Adjust.\n\t* decl.c (maybe_commonize_var): Adjust.\n\t* mangle.c (mangle_decl): Adjust.\n\t* cp-tree.h: Adjust.\n\nFrom-SVN: r157202", "tree": {"sha": "dcb54ad852b4d32d85d9ad046265f49b6f8283d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dcb54ad852b4d32d85d9ad046265f49b6f8283d7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58a15cf8ee953516f101e4320e83c3fed6bb2cd7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58a15cf8ee953516f101e4320e83c3fed6bb2cd7"}], "stats": {"total": 64, "additions": 37, "deletions": 27}, "files": [{"sha": "926bb7b4edfbc1d0363434741e7967a14e9ce3c4", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -6,6 +6,11 @@\n \tABI version, make the later mangled name an alias.\n \t* method.c (make_alias_for): Copy DECL_ARGUMENTS.\n \t* Make-lang.in (mangle.o): Depend on cgraph.h.\n+\t* method.c (make_alias_for): Handle VAR_DECL, too.\n+\t* decl2.c (vague_linkage_p): Rename from vague_linkage_fn_p.\n+\t* tree.c (no_linkage_check): Adjust.\n+\t* decl.c (maybe_commonize_var): Adjust.\n+\t* cp-tree.h: Adjust.\n \n 2010-03-01  Marco Poletti  <poletti.marco@gmail.com>\n "}, {"sha": "5604a9d442d473fb9b10d05bde7ff068c312c4e0", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -4735,7 +4735,7 @@ extern tree build_memfn_type\t\t\t(tree, tree, cp_cv_quals);\n extern tree change_return_type\t\t\t(tree, tree);\n extern void maybe_retrofit_in_chrg\t\t(tree);\n extern void maybe_make_one_only\t\t\t(tree);\n-extern bool vague_linkage_fn_p\t\t\t(tree);\n+extern bool vague_linkage_p\t\t\t(tree);\n extern void grokclassfn\t\t\t\t(tree, tree,\n \t\t\t\t\t\t enum overload_flags);\n extern tree grok_array_decl\t\t\t(tree, tree);"}, {"sha": "67377b0fc8a241226375d547725b0521447c5213", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -4642,7 +4642,7 @@ maybe_commonize_var (tree decl)\n       /* Don't mess with __FUNCTION__.  */\n       && ! DECL_ARTIFICIAL (decl)\n       && DECL_FUNCTION_SCOPE_P (decl)\n-      && vague_linkage_fn_p (DECL_CONTEXT (decl)))\n+      && vague_linkage_p (DECL_CONTEXT (decl)))\n     {\n       if (flag_weak)\n \t{"}, {"sha": "81d7ee3212f4d1c9249d427d1ae55cf60f777215", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -1642,20 +1642,21 @@ maybe_make_one_only (tree decl)\n     }\n }\n \n-/* Returns true iff DECL, a FUNCTION_DECL, has vague linkage.  This\n-   predicate will give the right answer during parsing of the function,\n-   which other tests may not.  */\n+/* Returns true iff DECL, a FUNCTION_DECL or VAR_DECL, has vague linkage.\n+   This predicate will give the right answer during parsing of the\n+   function, which other tests may not.  */\n \n bool\n-vague_linkage_fn_p (tree fn)\n+vague_linkage_p (tree decl)\n {\n   /* Unfortunately, import_export_decl has not always been called\n      before the function is processed, so we cannot simply check\n      DECL_COMDAT.  */\n-  return (DECL_COMDAT (fn)\n-\t  || ((DECL_DECLARED_INLINE_P (fn)\n-\t       || DECL_TEMPLATE_INSTANTIATION (fn))\n-\t      && TREE_PUBLIC (fn)));\n+  return (DECL_COMDAT (decl)\n+\t  || (((TREE_CODE (decl) == FUNCTION_DECL\n+\t\t&& DECL_DECLARED_INLINE_P (decl))\n+\t       || DECL_TEMPLATE_INSTANTIATION (decl))\n+\t      && TREE_PUBLIC (decl)));\n }\n \n /* Determine whether or not we want to specifically import or export CTYPE,"}, {"sha": "02b8a82c26be886ac649188dd36e3b64de57f869", "filename": "gcc/cp/mangle.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fmangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fmangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmangle.c?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -3083,7 +3083,7 @@ mangle_decl (const tree decl)\n       DECL_IGNORED_P (alias) = 1;\n       TREE_PUBLIC (alias) = TREE_PUBLIC (decl);\n       DECL_VISIBILITY (alias) = DECL_VISIBILITY (decl);\n-      if (vague_linkage_fn_p (decl))\n+      if (vague_linkage_p (decl))\n \tDECL_WEAK (alias) = 1;\n       cgraph_same_body_alias (alias, decl);\n     }"}, {"sha": "a93ad068e521b89ace4b0ce5fab74f865765523e", "filename": "gcc/cp/method.c", "status": "modified", "additions": 19, "deletions": 15, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fmethod.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Fmethod.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmethod.c?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -207,34 +207,38 @@ finish_thunk (tree thunk)\n \n static GTY (()) int thunk_labelno;\n \n-/* Create a static alias to function.  */\n+/* Create a static alias to target.  */\n \n tree\n-make_alias_for (tree function, tree newid)\n+make_alias_for (tree target, tree newid)\n {\n-  tree alias = build_decl (DECL_SOURCE_LOCATION (function),\n-\t\t\t   FUNCTION_DECL, newid, TREE_TYPE (function));\n-  DECL_LANG_SPECIFIC (alias) = DECL_LANG_SPECIFIC (function);\n+  tree alias = build_decl (DECL_SOURCE_LOCATION (target),\n+\t\t\t   TREE_CODE (target), newid, TREE_TYPE (target));\n+  DECL_LANG_SPECIFIC (alias) = DECL_LANG_SPECIFIC (target);\n   cxx_dup_lang_specific_decl (alias);\n   DECL_CONTEXT (alias) = NULL;\n-  TREE_READONLY (alias) = TREE_READONLY (function);\n-  TREE_THIS_VOLATILE (alias) = TREE_THIS_VOLATILE (function);\n+  TREE_READONLY (alias) = TREE_READONLY (target);\n+  TREE_THIS_VOLATILE (alias) = TREE_THIS_VOLATILE (target);\n   TREE_PUBLIC (alias) = 0;\n   DECL_INTERFACE_KNOWN (alias) = 1;\n   DECL_NOT_REALLY_EXTERN (alias) = 1;\n-  DECL_THIS_STATIC (alias) = 1;\n-  DECL_SAVED_FUNCTION_DATA (alias) = NULL;\n-  DECL_DESTRUCTOR_P (alias) = 0;\n-  DECL_CONSTRUCTOR_P (alias) = 0;\n   DECL_EXTERNAL (alias) = 0;\n   DECL_ARTIFICIAL (alias) = 1;\n-  DECL_PENDING_INLINE_P (alias) = 0;\n-  DECL_DECLARED_INLINE_P (alias) = 0;\n   DECL_USE_TEMPLATE (alias) = 0;\n   DECL_TEMPLATE_INSTANTIATED (alias) = 0;\n   DECL_TEMPLATE_INFO (alias) = NULL;\n-  DECL_INITIAL (alias) = error_mark_node;\n-  DECL_ARGUMENTS (alias) = copy_list (DECL_ARGUMENTS (target));\n+  if (TREE_CODE (alias) == FUNCTION_DECL)\n+    {\n+      DECL_SAVED_FUNCTION_DATA (alias) = NULL;\n+      DECL_DESTRUCTOR_P (alias) = 0;\n+      DECL_CONSTRUCTOR_P (alias) = 0;\n+      DECL_PENDING_INLINE_P (alias) = 0;\n+      DECL_DECLARED_INLINE_P (alias) = 0;\n+      DECL_INITIAL (alias) = error_mark_node;\n+      DECL_ARGUMENTS (alias) = copy_list (DECL_ARGUMENTS (target));\n+    }\n+  else\n+    TREE_STATIC (alias) = 1;\n   TREE_ADDRESSABLE (alias) = 1;\n   TREE_USED (alias) = 1;\n   SET_DECL_ASSEMBLER_NAME (alias, DECL_NAME (alias));"}, {"sha": "9867d2efb667d33fabc9ff8374316aeda908d853", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6dcdbd5f673e4005a11419d83c0b99af6a512bb/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=d6dcdbd5f673e4005a11419d83c0b99af6a512bb", "patch": "@@ -1607,7 +1607,7 @@ no_linkage_check (tree t, bool relaxed_p)\n \t    return no_linkage_check (TYPE_CONTEXT (t), relaxed_p);\n \t  else if (TREE_CODE (r) == FUNCTION_DECL)\n \t    {\n-\t      if (!relaxed_p || !vague_linkage_fn_p (r))\n+\t      if (!relaxed_p || !vague_linkage_p (r))\n \t\treturn t;\n \t      else\n \t\tr = CP_DECL_CONTEXT (r);"}]}