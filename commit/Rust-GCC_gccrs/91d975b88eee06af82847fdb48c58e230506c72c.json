{"sha": "91d975b88eee06af82847fdb48c58e230506c72c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTFkOTc1Yjg4ZWVlMDZhZjgyODQ3ZmRiNDhjNThlMjMwNTA2YzcyYw==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2005-07-30T01:34:58Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2005-07-30T01:34:58Z"}, "message": "re PR c/23143 (parameter forward declarations broken)\n\n\tPR c/23143\n\t* c-parser.c (c_parser_parms_list_declarator): Call\n\tmark_forward_parm_decls.\n\t* c-decl.c (merge_decls): Only check DECL_IN_SYSTEM_HEADER for\n\tdecls with visibility structure.\n\ntestsuite:\n\t* gcc.dg/parm-forwdecl-1.c, gcc.dg/parm-forwdecl-2.c,\n\tgcc.dg/parm-forwdecl-3.c, gcc.dg/parm-forwdecl-4.c: New tests.\n\nFrom-SVN: r102581", "tree": {"sha": "5b5a77889165a1437cae84a1933af1e14db1f0fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b5a77889165a1437cae84a1933af1e14db1f0fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/91d975b88eee06af82847fdb48c58e230506c72c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91d975b88eee06af82847fdb48c58e230506c72c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/91d975b88eee06af82847fdb48c58e230506c72c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/91d975b88eee06af82847fdb48c58e230506c72c/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "94ad79eaf5616f25f3edb2d2212742359603ce67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94ad79eaf5616f25f3edb2d2212742359603ce67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94ad79eaf5616f25f3edb2d2212742359603ce67"}], "stats": {"total": 79, "additions": 73, "deletions": 6}, "files": [{"sha": "0764a579f348439c3f8218c9797f8f76404e0573", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -1,3 +1,11 @@\n+2005-07-30  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/23143\n+\t* c-parser.c (c_parser_parms_list_declarator): Call\n+\tmark_forward_parm_decls.\n+\t* c-decl.c (merge_decls): Only check DECL_IN_SYSTEM_HEADER for\n+\tdecls with visibility structure.\n+\n 2005-07-30  Paul Brook  <paul@codesourcery.com>\n \n \t* config/arm/arm.c (arm_coproc_mem_operand): Fix inaccurate comment."}, {"sha": "903b5aabcd09d3d98585896e98709bfb48d7e218", "filename": "gcc/c-decl.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -1664,18 +1664,18 @@ merge_decls (tree newdecl, tree olddecl, tree newtype, tree oldtype)\n \t  && !C_DECL_BUILTIN_PROTOTYPE (olddecl)))\n     DECL_SOURCE_LOCATION (newdecl) = DECL_SOURCE_LOCATION (olddecl);\n \n-  /* Merge the unused-warning information.  */\n-  if (DECL_IN_SYSTEM_HEADER (olddecl))\n-    DECL_IN_SYSTEM_HEADER (newdecl) = 1;\n-  else if (DECL_IN_SYSTEM_HEADER (newdecl))\n-    DECL_IN_SYSTEM_HEADER (olddecl) = 1;\n-\n   /* Merge the initialization information.  */\n    if (DECL_INITIAL (newdecl) == 0)\n     DECL_INITIAL (newdecl) = DECL_INITIAL (olddecl);\n \n    if (CODE_CONTAINS_STRUCT (TREE_CODE (olddecl), TS_DECL_WITH_VIS))\n      {\n+       /* Merge the unused-warning information.  */\n+       if (DECL_IN_SYSTEM_HEADER (olddecl))\n+\t DECL_IN_SYSTEM_HEADER (newdecl) = 1;\n+       else if (DECL_IN_SYSTEM_HEADER (newdecl))\n+\t DECL_IN_SYSTEM_HEADER (olddecl) = 1;\n+\n        /* Merge the section attribute.\n \t  We want to issue an error if the sections conflict but that must be\n \t  done later in decl_attributes since we are called before attributes"}, {"sha": "268fa908480fffba0e563eb44adb1982d8bc04c0", "filename": "gcc/c-parser.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-parser.c?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -2463,6 +2463,7 @@ c_parser_parms_list_declarator (c_parser *parser, tree attrs)\n \t{\n \t  tree new_attrs;\n \t  c_parser_consume_token (parser);\n+\t  mark_forward_parm_decls ();\n \t  new_attrs = c_parser_attributes (parser);\n \t  return c_parser_parms_list_declarator (parser, new_attrs);\n \t}"}, {"sha": "27b1a3ce92006154a456d82b147f3b1b4e18c33e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -1,3 +1,9 @@\n+2005-07-30  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/23143\n+\t* gcc.dg/parm-forwdecl-1.c, gcc.dg/parm-forwdecl-2.c,\n+\tgcc.dg/parm-forwdecl-3.c, gcc.dg/parm-forwdecl-4.c: New tests.\n+\n 2005-07-29  Joseph S. Myers  <joseph@codesourcery.com>\n \n \tPR c/529"}, {"sha": "470636de95c453a968e1282225bae2a503433b99", "filename": "gcc/testsuite/gcc.dg/parm-forwdecl-1.c", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-1.c?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -0,0 +1,26 @@\n+/* Test GNU parameter forward declarations.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+/* Valid uses.  */\n+int f1(int a; int a);\n+int f2(int a; int a) { return 0; }\n+int f3(int a; int a; int a);\n+int f4(int a; int a; int a) { return 0; }\n+int f5(int a; int (*x)[a], int a);\n+int f6(int a; int (*x)[a], int a) { return 0; }\n+int f7(int a; int (*x)[a]; int (*y)[x[1][2]], int (*x)[a], int a);\n+int f8(int a; int (*x)[a]; int (*y)[x[1][2]], int (*x)[a], int a) { return 0; }\n+\n+/* Strange uses accepted by GCC 4.0 but not by 3.4 and probably not\n+   desirable to accept.  */\n+int g1(int a;); /* { dg-error \"just a forward declaration\" \"no parms\" { xfail *-*-* } } */\n+int g2(int a; __attribute__((unused))); /* { dg-error \"just a forward declaration\" \"no parms\" { xfail *-*-* } } */\n+int g3(int;); /* { dg-error \"just a forward declaration\" \"no parms\" { xfail *-*-* } } */\n+int g4(int, long;); /* { dg-error \"just a forward declaration\" \"no parms\" { xfail *-*-* } } */\n+\n+/* Invalid uses.  */\n+int h1(int a; int b); /* { dg-error \"just a forward declaration\" } */\n+int h2(int; int b); /* { dg-error \"just a forward declaration\" } */\n+int h3(int a; long a); /* { dg-error \"conflicting types|previous definition|just a forward declaration\" } */"}, {"sha": "cecedf2515cc99bfd99a902ab52195092dc348e4", "filename": "gcc/testsuite/gcc.dg/parm-forwdecl-2.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-2.c?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -0,0 +1,8 @@\n+/* Test GNU parameter forward declarations.  Warning with\n+   -pedantic.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"-pedantic\" } */\n+\n+int f1(int a; int a); /* { dg-warning \"warning: ISO C forbids forward parameter declarations\" } */\n+int f2(int a; int a) { return 0; } /* { dg-warning \"warning: ISO C forbids forward parameter declarations\" } */"}, {"sha": "d99188a0bd4a3061762c2b13f4d80c059f6b808e", "filename": "gcc/testsuite/gcc.dg/parm-forwdecl-3.c", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-3.c?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -0,0 +1,8 @@\n+/* Test GNU parameter forward declarations.  Error with\n+   -pedantic-errors.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"-pedantic-errors\" } */\n+\n+int f1(int a; int a); /* { dg-error \"error: ISO C forbids forward parameter declarations\" } */\n+int f2(int a; int a) { return 0; } /* { dg-error \"error: ISO C forbids forward parameter declarations\" } */"}, {"sha": "a210092e1d5a36eab1747b6b03d406bae1022091", "filename": "gcc/testsuite/gcc.dg/parm-forwdecl-4.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/91d975b88eee06af82847fdb48c58e230506c72c/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fparm-forwdecl-4.c?ref=91d975b88eee06af82847fdb48c58e230506c72c", "patch": "@@ -0,0 +1,10 @@\n+/* Test GNU parameter forward declarations.  OK with\n+   -Wredundant-decls.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wredundant-decls\" } */\n+\n+int f1(int a; int a);\n+int f2(int a; int a) { return 0; }\n+int f3(int a; int a; int a);\n+int f4(int a; int a; int a) { return 0; }"}]}