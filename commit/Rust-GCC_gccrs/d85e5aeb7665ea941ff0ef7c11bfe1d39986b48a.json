{"sha": "d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a", "node_id": "C_kwDOANBUbNoAKGQ4NWU1YWViNzY2NWVhOTQxZmYwZWY3YzExYmZlMWQzOTk4NmI0OGE", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-22T08:13:06Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-22T08:15:23Z"}, "message": "tree-optimization/106403 - fix ICE with VN of .STORE_LANES\n\nWhile .STORE_LANES is not supported by the recent VN patch we were\nstill accessing the stored value and valueizing it - but\ninternal_fn_stored_value_index does not support .STORE_LANES and\nwe failed to honor that case.  Fixed by simply moving the affected\ncode below the check for the actual supported internal functions.\n\n\tPR tree-optimization/106403\n\t* tree-ssa-sccvn.cc (vn_reference_lookup_3): Move stored\n\tvalue valueization after check for IFN_MASKED_STORE or\n\tIFN_LEN_STORE.", "tree": {"sha": "2325ba57a629c00cfba6b8379c8187891d5f64bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2325ba57a629c00cfba6b8379c8187891d5f64bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b2e99bb6900f33f46a0f4ca6ae94b8a39b0b9bb1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2e99bb6900f33f46a0f4ca6ae94b8a39b0b9bb1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2e99bb6900f33f46a0f4ca6ae94b8a39b0b9bb1"}], "stats": {"total": 11, "additions": 6, "deletions": 5}, "files": [{"sha": "a1f6f30960980cfeb88ee24e4be7343c0852edea", "filename": "gcc/tree-ssa-sccvn.cc", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a/gcc%2Ftree-ssa-sccvn.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a/gcc%2Ftree-ssa-sccvn.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-sccvn.cc?ref=d85e5aeb7665ea941ff0ef7c11bfe1d39986b48a", "patch": "@@ -3221,11 +3221,6 @@ vn_reference_lookup_3 (ao_ref *ref, tree vuse, void *data_,\n     {\n       gcall *call = as_a <gcall *> (def_stmt);\n       internal_fn fn = gimple_call_internal_fn (call);\n-      tree def_rhs = gimple_call_arg (call,\n-\t\t\t\t      internal_fn_stored_value_index (fn));\n-      def_rhs = vn_valueize (def_rhs);\n-      if (TREE_CODE (def_rhs) != VECTOR_CST)\n-\treturn (void *)-1;\n \n       tree mask = NULL_TREE, len = NULL_TREE, bias = NULL_TREE;\n       switch (fn)\n@@ -3245,6 +3240,12 @@ vn_reference_lookup_3 (ao_ref *ref, tree vuse, void *data_,\n \tdefault:\n \t  return (void *)-1;\n \t}\n+      tree def_rhs = gimple_call_arg (call,\n+\t\t\t\t      internal_fn_stored_value_index (fn));\n+      def_rhs = vn_valueize (def_rhs);\n+      if (TREE_CODE (def_rhs) != VECTOR_CST)\n+\treturn (void *)-1;\n+\n       ao_ref_init_from_ptr_and_size (&lhs_ref,\n \t\t\t\t     vn_valueize (gimple_call_arg (call, 0)),\n \t\t\t\t     TYPE_SIZE_UNIT (TREE_TYPE (def_rhs)));"}]}