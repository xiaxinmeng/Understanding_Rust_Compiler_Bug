{"sha": "befd29d5fe15c09638f73eeeb1f8a9e62ce569ee", "node_id": "C_kwDOANBUbNoAKGJlZmQyOWQ1ZmUxNWMwOTYzOGY3M2VlZWIxZjhhOWU2MmNlNTY5ZWU", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2022-12-27T15:31:57Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2023-01-09T10:49:31Z"}, "message": "c: check if target_clone attrs are all string\n\n\tPR c/107993\n\ngcc/c-family/ChangeLog:\n\n\t* c-attribs.cc (handle_target_clones_attribute): Check for\n\tstring constant for all target_clone attribute values.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/i386/pr107993.c: New test.", "tree": {"sha": "854ea2c6ef15d61be70dc049a6143770d781c6c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/854ea2c6ef15d61be70dc049a6143770d781c6c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cb93c5f8008b95743b741d6f1842f9be50c6985c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb93c5f8008b95743b741d6f1842f9be50c6985c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb93c5f8008b95743b741d6f1842f9be50c6985c"}], "stats": {"total": 23, "additions": 19, "deletions": 4}, "files": [{"sha": "33d84cb6e073cdd6e6a0a70d4f469df6604f89ce", "filename": "gcc/c-family/c-attribs.cc", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee/gcc%2Fc-family%2Fc-attribs.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee/gcc%2Fc-family%2Fc-attribs.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-attribs.cc?ref=befd29d5fe15c09638f73eeeb1f8a9e62ce569ee", "patch": "@@ -5574,12 +5574,18 @@ handle_target_clones_attribute (tree *node, tree name, tree ARG_UNUSED (args),\n   /* Ensure we have a function type.  */\n   if (TREE_CODE (*node) == FUNCTION_DECL)\n     {\n-      if (TREE_CODE (TREE_VALUE (args)) != STRING_CST)\n+      for (tree t = args; t != NULL_TREE; t = TREE_CHAIN (t))\n \t{\n-\t  error (\"%qE attribute argument not a string constant\", name);\n-\t  *no_add_attrs = true;\n+\t  tree value = TREE_VALUE (t);\n+\t  if (TREE_CODE (value) != STRING_CST)\n+\t    {\n+\t      error (\"%qE attribute argument not a string constant\", name);\n+\t      *no_add_attrs = true;\n+\t      return NULL_TREE;\n+\t    }\n \t}\n-      else if (lookup_attribute (\"always_inline\", DECL_ATTRIBUTES (*node)))\n+\n+      if (lookup_attribute (\"always_inline\", DECL_ATTRIBUTES (*node)))\n \t{\n \t  warning (OPT_Wattributes, \"%qE attribute ignored due to conflict \"\n \t\t   \"with %qs attribute\", name, \"always_inline\");"}, {"sha": "b0b84a677d822117604a83c10cde5a87f44493ea", "filename": "gcc/testsuite/gcc.target/i386/pr107993.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr107993.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/befd29d5fe15c09638f73eeeb1f8a9e62ce569ee/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr107993.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr107993.c?ref=befd29d5fe15c09638f73eeeb1f8a9e62ce569ee", "patch": "@@ -0,0 +1,9 @@\n+/* PR c/107993 */\n+/* { dg-do compile } */\n+\n+typedef union { int x; } u;\n+__attribute__((target_clones(\"arch=alderlake\",!\"default\")))\n+int f (u *x)\n+{ /* { dg-error \".target_clones. attribute argument not a string constant\" } */\n+  return 0;\n+}"}]}