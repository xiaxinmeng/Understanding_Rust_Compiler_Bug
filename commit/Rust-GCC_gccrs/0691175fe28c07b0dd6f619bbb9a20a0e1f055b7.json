{"sha": "0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY5MTE3NWZlMjhjMDdiMGRkNmY2MTliYmI5YTIwYTBlMWYwNTViNw==", "commit": {"author": {"name": "Gabriel Dos Reis", "email": "gdr@integrable-solutions.net", "date": "2013-08-25T05:51:54Z"}, "committer": {"name": "Gabriel Dos Reis", "email": "gdr@gcc.gnu.org", "date": "2013-08-25T05:51:54Z"}, "message": "c-pretty-print.h (c_pretty_printer::translate_string): Declare.\n\nc-family/\n\t* c-pretty-print.h (c_pretty_printer::translate_string): Declare.\n\t* c-pretty-print.c (M_): Remove.\n\t(c_pretty_printer::translate_string): Define.\n\t(pp_c_type_specifier): Use it.\n\t(pp_c_primary_expression): Likewise.\n\t(pp_c_expression): Likewise.\n\ncp/\n\t* cxx-pretty-print.c (M_): Remove.\n\t(pp_cxx_unqualified_id): Use translate_string instead of M_.\n\t(pp_cxx_canonical_template_parameter): Likewise.\n\nFrom-SVN: r201974", "tree": {"sha": "42cae0fae566df7b683d8856116dd9f221c827ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/42cae0fae566df7b683d8856116dd9f221c827ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/comments", "author": {"login": "cxx-undef", "id": 5528103, "node_id": "MDQ6VXNlcjU1MjgxMDM=", "avatar_url": "https://avatars.githubusercontent.com/u/5528103?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cxx-undef", "html_url": "https://github.com/cxx-undef", "followers_url": "https://api.github.com/users/cxx-undef/followers", "following_url": "https://api.github.com/users/cxx-undef/following{/other_user}", "gists_url": "https://api.github.com/users/cxx-undef/gists{/gist_id}", "starred_url": "https://api.github.com/users/cxx-undef/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cxx-undef/subscriptions", "organizations_url": "https://api.github.com/users/cxx-undef/orgs", "repos_url": "https://api.github.com/users/cxx-undef/repos", "events_url": "https://api.github.com/users/cxx-undef/events{/privacy}", "received_events_url": "https://api.github.com/users/cxx-undef/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "66dfe4c4f83eb1a3f42083251c989f271fa3b5cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66dfe4c4f83eb1a3f42083251c989f271fa3b5cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66dfe4c4f83eb1a3f42083251c989f271fa3b5cf"}], "stats": {"total": 65, "additions": 42, "deletions": 23}, "files": [{"sha": "cf2dc3f2139fb5d189becde561dec88be93e0284", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "patch": "@@ -1,3 +1,12 @@\n+2013-08-25  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n+\n+\t* c-pretty-print.h (c_pretty_printer::translate_string): Declare.\n+\t* c-pretty-print.c (M_): Remove.\n+\t(c_pretty_printer::translate_string): Define.\n+\t(pp_c_type_specifier): Use it.\n+\t(pp_c_primary_expression): Likewise.\n+\t(pp_c_expression): Likewise.\n+\n 2013-08-24  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n \n \t* c-pretty-print.h (c_pretty_printer::id_expression): Now a"}, {"sha": "ecc017349252b9b35fea7bdab71cf466f47cef9b", "filename": "gcc/c-family/c-pretty-print.c", "status": "modified", "additions": 21, "deletions": 16, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fc-family%2Fc-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fc-family%2Fc-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-pretty-print.c?ref=0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "patch": "@@ -29,10 +29,6 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree-iterator.h\"\n #include \"diagnostic.h\"\n \n-/* Translate if being used for diagnostics, but not for dump files or\n-   __PRETTY_FUNCTION.  */\n-#define M_(msgid) (pp_translate_identifiers (pp) ? _(msgid) : (msgid))\n-\n /* The pretty-printer code is primarily designed to closely follow\n    (GNU) C and C++ grammars.  That is to be contrasted with spaghetti\n    codes we used to have in the past.  Following a structured\n@@ -341,7 +337,7 @@ pp_c_type_specifier (c_pretty_printer *pp, tree t)\n   switch (code)\n     {\n     case ERROR_MARK:\n-      pp_c_ws_string (pp, M_(\"<type-error>\"));\n+      pp->translate_string (\"<type-error>\");\n       break;\n \n     case IDENTIFIER_NODE:\n@@ -379,15 +375,15 @@ pp_c_type_specifier (c_pretty_printer *pp, tree t)\n \t      switch (code)\n \t\t{\n \t\tcase INTEGER_TYPE:\n-\t\t  pp_string (pp, (TYPE_UNSIGNED (t)\n-\t\t\t\t  ? M_(\"<unnamed-unsigned:\")\n-\t\t\t\t  : M_(\"<unnamed-signed:\")));\n+\t\t  pp->translate_string (TYPE_UNSIGNED (t)\n+                                        ? \"<unnamed-unsigned:\"\n+                                        : \"<unnamed-signed:\");\n \t\t  break;\n \t\tcase REAL_TYPE:\n-\t\t  pp_string (pp, M_(\"<unnamed-float:\"));\n+\t\t  pp->translate_string (\"<unnamed-float:\");\n \t\t  break;\n \t\tcase FIXED_POINT_TYPE:\n-\t\t  pp_string (pp, M_(\"<unnamed-fixed:\"));\n+\t\t  pp->translate_string (\"<unnamed-fixed:\");\n \t\t  break;\n \t\tdefault:\n \t\t  gcc_unreachable ();\n@@ -402,7 +398,7 @@ pp_c_type_specifier (c_pretty_printer *pp, tree t)\n       if (DECL_NAME (t))\n \tpp_id_expression (pp, t);\n       else\n-\tpp_c_ws_string (pp, M_(\"<typedef-error>\"));\n+\tpp->translate_string (\"<typedef-error>\");\n       break;\n \n     case UNION_TYPE:\n@@ -415,12 +411,12 @@ pp_c_type_specifier (c_pretty_printer *pp, tree t)\n       else if (code == ENUMERAL_TYPE)\n \tpp_c_ws_string (pp, \"enum\");\n       else\n-\tpp_c_ws_string (pp, M_(\"<tag-error>\"));\n+\tpp->translate_string (\"<tag-error>\");\n \n       if (TYPE_NAME (t))\n \tpp_id_expression (pp, TYPE_NAME (t));\n       else\n-\tpp_c_ws_string (pp, M_(\"<anonymous>\"));\n+\tpp->translate_string (\"<anonymous>\");\n       break;\n \n     default:\n@@ -1187,6 +1183,15 @@ pp_c_ws_string (c_pretty_printer *pp, const char *str)\n   pp->padding = pp_before;\n }\n \n+void\n+c_pretty_printer::translate_string (const char *gmsgid)\n+{\n+  if (pp_translate_identifiers (this))\n+    pp_c_ws_string (this, _(gmsgid));\n+  else\n+    pp_c_ws_string (this, gmsgid);\n+}\n+\n /* Pretty-print an IDENTIFIER_NODE, which may contain UTF-8 sequences\n    that need converting to the locale encoding, preceded by whitespace\n    is necessary.  */\n@@ -1225,11 +1230,11 @@ pp_c_primary_expression (c_pretty_printer *pp, tree e)\n       break;\n \n     case ERROR_MARK:\n-      pp_c_ws_string (pp, M_(\"<erroneous-expression>\"));\n+      pp->translate_string (\"<erroneous-expression>\");\n       break;\n \n     case RESULT_DECL:\n-      pp_c_ws_string (pp, M_(\"<return-value>\"));\n+      pp->translate_string (\"<return-value>\");\n       break;\n \n     case INTEGER_CST:\n@@ -2155,7 +2160,7 @@ pp_c_expression (c_pretty_printer *pp, tree e)\n \t  && !DECL_ARTIFICIAL (SSA_NAME_VAR (e)))\n \tpp_c_expression (pp, SSA_NAME_VAR (e));\n       else\n-\tpp_c_ws_string (pp, M_(\"<unknown>\"));\n+\tpp->translate_string (\"<unknown>\");\n       break;\n \n     case POSTINCREMENT_EXPR:"}, {"sha": "f347bc53dd77c16d62ecccbba1d348e86715e3f0", "filename": "gcc/c-family/c-pretty-print.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fc-family%2Fc-pretty-print.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fc-family%2Fc-pretty-print.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-pretty-print.h?ref=0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "patch": "@@ -51,6 +51,9 @@ struct c_pretty_printer : pretty_printer\n {\n   c_pretty_printer ();\n \n+  // Format string, possibly translated.\n+  void translate_string (const char *);\n+\n   virtual void constant (tree);\n   virtual void id_expression (tree);\n   /* Points to the first element of an array of offset-list."}, {"sha": "d746f53f31319e6a24b015f1fcce34f8b3bc04a6", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "patch": "@@ -1,3 +1,9 @@\n+2013-08-25  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n+\n+\t* cxx-pretty-print.c (M_): Remove.\n+\t(pp_cxx_unqualified_id): Use translate_string instead of M_.\n+\t(pp_cxx_canonical_template_parameter): Likewise.\n+\n 2013-08-24  Gabriel Dos Reis  <gdr@integrable-solutions.net>\n \n \t* cxx-pretty-print.h (cxx_pretty_printer::id_expression): Declare."}, {"sha": "6e3b2ad1115ea65b8f0a50178405e5be47a3d715", "filename": "gcc/cp/cxx-pretty-print.c", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fcp%2Fcxx-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0691175fe28c07b0dd6f619bbb9a20a0e1f055b7/gcc%2Fcp%2Fcxx-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcxx-pretty-print.c?ref=0691175fe28c07b0dd6f619bbb9a20a0e1f055b7", "patch": "@@ -27,10 +27,6 @@ along with GCC; see the file COPYING3.  If not see\n #include \"cxx-pretty-print.h\"\n #include \"tree-pretty-print.h\"\n \n-/* Translate if being used for diagnostics, but not for dump files or\n-   __PRETTY_FUNCTION.  */\n-#define M_(msgid) (pp_translate_identifiers (pp) ? _(msgid) : (msgid))\n-\n static void pp_cxx_unqualified_id (cxx_pretty_printer *, tree);\n static void pp_cxx_nested_name_specifier (cxx_pretty_printer *, tree);\n static void pp_cxx_qualified_id (cxx_pretty_printer *, tree);\n@@ -149,7 +145,7 @@ pp_cxx_unqualified_id (cxx_pretty_printer *pp, tree t)\n   switch (code)\n     {\n     case RESULT_DECL:\n-      pp_cxx_ws_string (pp, M_(\"<return-value>\"));\n+      pp->translate_string (\"<return-value>\");\n       break;\n \n     case OVERLOAD:\n@@ -168,7 +164,7 @@ pp_cxx_unqualified_id (cxx_pretty_printer *pp, tree t)\n \n     case IDENTIFIER_NODE:\n       if (t == NULL)\n-\tpp_cxx_ws_string (pp, M_(\"<unnamed>\"));\n+\tpp->translate_string (\"<unnamed>\");\n       else if (IDENTIFIER_TYPENAME_P (t))\n \tpp_cxx_conversion_function_id (pp, t);\n       else\n@@ -2154,7 +2150,7 @@ pp_cxx_canonical_template_parameter (cxx_pretty_printer *pp, tree parm)\n     parm = TEMPLATE_TYPE_PARM_INDEX (parm);\n \n   pp_cxx_begin_template_argument_list (pp);\n-  pp_cxx_ws_string (pp, M_(\"template-parameter-\"));\n+  pp->translate_string (\"template-parameter-\");\n   pp_wide_integer (pp, TEMPLATE_PARM_LEVEL (parm));\n   pp_minus (pp);\n   pp_wide_integer (pp, TEMPLATE_PARM_IDX (parm) + 1);"}]}