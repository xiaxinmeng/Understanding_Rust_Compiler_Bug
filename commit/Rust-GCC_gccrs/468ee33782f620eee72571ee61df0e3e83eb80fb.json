{"sha": "468ee33782f620eee72571ee61df0e3e83eb80fb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDY4ZWUzMzc4MmY2MjBlZWU3MjU3MWVlNjFkZjBlM2U4M2ViODBmYg==", "commit": {"author": {"name": "Pascal Obry", "email": "obry@adacore.com", "date": "2009-04-16T12:24:19Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-16T12:24:19Z"}, "message": "adaint.h, adaint.c (__gnat_rmdir): New routine.\n\n2009-04-16  Pascal Obry  <obry@adacore.com>\n\n\t* adaint.h, adaint.c (__gnat_rmdir): New routine.\n\tSimple wrapper routines used to convert to proper encoding on\n\tWindows.\n\n\t* s-crtl.ads: Use __gnat_rmdir instead of direct call to the C library.\n\n\t* g-dirope.adb (Remove_Dir): Fix a bug, the root directory was removed\n\ttwice.\n\nFrom-SVN: r146176", "tree": {"sha": "77bfbb53beec393fc559fe7c0deb44d5bedc9509", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77bfbb53beec393fc559fe7c0deb44d5bedc9509"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/468ee33782f620eee72571ee61df0e3e83eb80fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/468ee33782f620eee72571ee61df0e3e83eb80fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/468ee33782f620eee72571ee61df0e3e83eb80fb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/468ee33782f620eee72571ee61df0e3e83eb80fb/comments", "author": {"login": "TurboGit", "id": 467069, "node_id": "MDQ6VXNlcjQ2NzA2OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/467069?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TurboGit", "html_url": "https://github.com/TurboGit", "followers_url": "https://api.github.com/users/TurboGit/followers", "following_url": "https://api.github.com/users/TurboGit/following{/other_user}", "gists_url": "https://api.github.com/users/TurboGit/gists{/gist_id}", "starred_url": "https://api.github.com/users/TurboGit/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TurboGit/subscriptions", "organizations_url": "https://api.github.com/users/TurboGit/orgs", "repos_url": "https://api.github.com/users/TurboGit/repos", "events_url": "https://api.github.com/users/TurboGit/events{/privacy}", "received_events_url": "https://api.github.com/users/TurboGit/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bca17d5131ae9c0db27fa07078e90ac95aa67d87", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bca17d5131ae9c0db27fa07078e90ac95aa67d87", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bca17d5131ae9c0db27fa07078e90ac95aa67d87"}], "stats": {"total": 48, "additions": 35, "deletions": 13}, "files": [{"sha": "aba44e835d0324f158043afb30c7b1d5d630cbac", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=468ee33782f620eee72571ee61df0e3e83eb80fb", "patch": "@@ -1,3 +1,14 @@\n+2009-04-16  Pascal Obry  <obry@adacore.com>\n+\n+\t* adaint.h, adaint.c (__gnat_rmdir): New routine.\n+\tSimple wrapper routines used to convert to proper encoding on\n+\tWindows.\n+\n+\t* s-crtl.ads: Use __gnat_rmdir instead of direct call to the C library.\n+\n+\t* g-dirope.adb (Remove_Dir): Fix a bug, the root directory was removed\n+\ttwice.\n+\n 2009-04-16  Pascal Obry  <obry@adacore.com>\n \n \t* s-crtl.ads, s-os_lib.adb: Minor code clean-up."}, {"sha": "db9ef9f7c517cebc0683b9b2929136229095611a", "filename": "gcc/ada/a-direct.adb", "status": "modified", "additions": 3, "deletions": 7, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fa-direct.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fa-direct.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-direct.adb?ref=468ee33782f620eee72571ee61df0e3e83eb80fb", "patch": "@@ -70,7 +70,7 @@ package body Ada.Directories is\n \n    type Search_Data is record\n       Is_Valid      : Boolean := False;\n-      Name          : Ada.Strings.Unbounded.Unbounded_String;\n+      Name          : Unbounded_String;\n       Pattern       : Regexp;\n       Filter        : Filter_Type;\n       Dir           : Dir_Type_Value := No_Dir;\n@@ -481,9 +481,7 @@ package body Ada.Directories is\n             C_Dir_Name : constant String := Directory & ASCII.NUL;\n \n          begin\n-            rmdir (C_Dir_Name);\n-\n-            if System.OS_Lib.Is_Directory (Directory) then\n+            if rmdir (C_Dir_Name) /= 0 then\n                raise Use_Error with\n                  \"deletion of directory \"\"\" & Directory & \"\"\" failed\";\n             end if;\n@@ -565,9 +563,7 @@ package body Ada.Directories is\n             C_Dir_Name : constant String := Directory & ASCII.NUL;\n \n          begin\n-            rmdir (C_Dir_Name);\n-\n-            if System.OS_Lib.Is_Directory (Directory) then\n+            if rmdir (C_Dir_Name) /= 0 then\n                raise Use_Error with\n                  \"directory tree rooted at \"\"\" &\n                    Directory & \"\"\" could not be deleted\";"}, {"sha": "43ec6543ea539691ea17dc8f1f756733e1f5b063", "filename": "gcc/ada/adaint.c", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fadaint.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fadaint.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.c?ref=468ee33782f620eee72571ee61df0e3e83eb80fb", "patch": "@@ -725,6 +725,23 @@ __gnat_chdir (char *path)\n #endif\n }\n \n+/* Removing a directory.  */\n+\n+int\n+__gnat_rmdir (char *path)\n+{\n+#if defined (__MINGW32__) && ! defined (__vxworks) && ! defined (CROSS_COMPILE)\n+  {\n+    TCHAR wpath[GNAT_MAX_PATH_LEN];\n+\n+    S2WSU (wpath, path, GNAT_MAX_PATH_LEN);\n+    return _trmdir (wpath);\n+  }\n+#else\n+  return rmdir (path);\n+#endif\n+}\n+\n FILE *\n __gnat_fopen (char *path, char *mode, int encoding ATTRIBUTE_UNUSED)\n {"}, {"sha": "5ed4d76a91b6b02a5a6b16b0e2cbef3f955fce96", "filename": "gcc/ada/adaint.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fadaint.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fadaint.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.h?ref=468ee33782f620eee72571ee61df0e3e83eb80fb", "patch": "@@ -73,6 +73,7 @@ extern int    __gnat_stat\t\t\t   (char *,\n extern int    __gnat_unlink                        (char *);\n extern int    __gnat_rename                        (char *, char *);\n extern int    __gnat_chdir                         (char *);\n+extern int    __gnat_rmdir                         (char *);\n \n extern FILE  *__gnat_fopen\t\t\t   (char *, char *, int);\n extern FILE  *__gnat_freopen\t\t\t   (char *, char *, FILE *,"}, {"sha": "c7670ef558b7430555646407af8b9cc8379c44ed", "filename": "gcc/ada/g-dirope.adb", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fg-dirope.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fg-dirope.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-dirope.adb?ref=468ee33782f620eee72571ee61df0e3e83eb80fb", "patch": "@@ -739,9 +739,7 @@ package body GNAT.Directory_Operations is\n       --  Remove the directory only if it is empty\n \n       if not Recursive then\n-         rmdir (C_Dir_Name);\n-\n-         if GNAT.OS_Lib.Is_Directory (Dir_Name) then\n+         if rmdir (C_Dir_Name) /= 0 then\n             raise Directory_Error;\n          end if;\n \n@@ -764,7 +762,6 @@ package body GNAT.Directory_Operations is\n                      Str (1 .. Last) /= \"..\"\n                   then\n                      Remove_Dir (Str (1 .. Last), True);\n-                     Remove_Dir (Str (1 .. Last));\n                   end if;\n \n                else"}, {"sha": "aa4a8b57086699f2511981e25e645289cb78f52b", "filename": "gcc/ada/s-crtl.ads", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fs-crtl.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/468ee33782f620eee72571ee61df0e3e83eb80fb/gcc%2Fada%2Fs-crtl.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-crtl.ads?ref=468ee33782f620eee72571ee61df0e3e83eb80fb", "patch": "@@ -164,8 +164,8 @@ package System.CRTL is\n    procedure rewind (stream : FILEs);\n    pragma Import (C, rewind, \"rewind\");\n \n-   procedure rmdir (dir_name : String);\n-   pragma Import (C, rmdir, \"rmdir\");\n+   function rmdir (dir_name : String) return int;\n+   pragma Import (C, rmdir, \"__gnat_rmdir\");\n \n    function chdir (dir_name : String) return int;\n    pragma Import (C, chdir, \"__gnat_chdir\");"}]}