{"sha": "cc32e81cdbb7696cd571bdb5ffe52f228f125df5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2MzMmU4MWNkYmI3Njk2Y2Q1NzFiZGI1ZmZlNTJmMjI4ZjEyNWRmNQ==", "commit": {"author": {"name": "qing zhao", "email": "qinzhao@gcc.gnu.org", "date": "2020-11-05T14:57:46Z"}, "committer": {"name": "qing zhao", "email": "qinzhao@gcc.gnu.org", "date": "2020-11-05T14:57:46Z"}, "message": "i386: Fix PR97715\n\nThis change fixes a bug in the i386 backend when adding\n-fzero-call-used-regs=all on a target that has no x87\nregisters.\n\nWhen there is no x87 registers available, we should not\nzero stack registers.\n\ngcc/ChangeLog:\n\n\tPR target/97715\n\t* config/i386/i386.c (zero_all_st_registers): Return\n\tearlier when the FPU is disabled.\n\ngcc/testsuite/ChangeLog:\n\n\tPR target/97715\n\t* gcc.target/i386/zero-scratch-regs-32.c: New test.", "tree": {"sha": "dd80526f8e3f10c246b2eda160fb18daae2a46a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dd80526f8e3f10c246b2eda160fb18daae2a46a4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc32e81cdbb7696cd571bdb5ffe52f228f125df5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc32e81cdbb7696cd571bdb5ffe52f228f125df5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc32e81cdbb7696cd571bdb5ffe52f228f125df5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc32e81cdbb7696cd571bdb5ffe52f228f125df5/comments", "author": null, "committer": null, "parents": [{"sha": "54cbdb528df16686290ad26e2130a1896915639d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54cbdb528df16686290ad26e2130a1896915639d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54cbdb528df16686290ad26e2130a1896915639d"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "789ef727cf8b429243d9ae1f3782600ea646a192", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc32e81cdbb7696cd571bdb5ffe52f228f125df5/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc32e81cdbb7696cd571bdb5ffe52f228f125df5/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=cc32e81cdbb7696cd571bdb5ffe52f228f125df5", "patch": "@@ -3640,6 +3640,11 @@ zero_all_vector_registers (HARD_REG_SET need_zeroed_hardregs)\n static bool\n zero_all_st_registers (HARD_REG_SET need_zeroed_hardregs)\n {\n+\n+  /* If the FPU is disabled, no need to zero all st registers.  */\n+  if (! (TARGET_80387 || TARGET_FLOAT_RETURNS_IN_80387))\n+    return false;\n+\n   unsigned int num_of_st = 0;\n   for (unsigned int regno = 0; regno < FIRST_PSEUDO_REGISTER; regno++)\n     if ((STACK_REGNO_P (regno) || MMX_REGNO_P (regno))"}, {"sha": "ca3261fe5eac71337d90dd7dca2f9cd73e63a09d", "filename": "gcc/testsuite/gcc.target/i386/zero-scratch-regs-32.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc32e81cdbb7696cd571bdb5ffe52f228f125df5/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fzero-scratch-regs-32.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc32e81cdbb7696cd571bdb5ffe52f228f125df5/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fzero-scratch-regs-32.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fzero-scratch-regs-32.c?ref=cc32e81cdbb7696cd571bdb5ffe52f228f125df5", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile { target *-*-linux* } } */\n+/* { dg-options \"-O2 -fzero-call-used-regs=all -mno-80387\" } */\n+\n+int\n+foo (int x)\n+{\n+  return (x + 1);\n+}\n+\n+/* { dg-final { scan-assembler-not \"fldz\" } } */\n+"}]}