{"sha": "651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjUxZWQ5NDI4MGU0Yjg4YmY0ZmI2OWJlMDQ1MWNmMjc2NmVjOWFiMA==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2005-11-04T00:23:01Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2005-11-04T00:23:01Z"}, "message": "re PR preprocessor/22042 (stringification BUG)\n\n2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR preprocessor/22042\n        * macro.c (_cpp_builtin_macro_text): Lower the needed max\n        buffer size.\n        (cpp_quote_string): Don't octalify non printable\n        charactors.\n2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR preprocessor/22042\n        * gcc.dg/cpp/strify4.c: New test.\n\nFrom-SVN: r106463", "tree": {"sha": "e997615dea22c4f55a4cadbd3c4f72ca8ca0ca82", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e997615dea22c4f55a4cadbd3c4f72ca8ca0ca82"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/comments", "author": null, "committer": null, "parents": [{"sha": "abe60efd4bbd222f27ea4095ed0cb5f6c2baf09b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abe60efd4bbd222f27ea4095ed0cb5f6c2baf09b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abe60efd4bbd222f27ea4095ed0cb5f6c2baf09b"}], "stats": {"total": 55, "additions": 42, "deletions": 13}, "files": [{"sha": "722318fdaec934d84357151eea71821ac93ec9b6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "patch": "@@ -1,3 +1,8 @@\n+2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR preprocessor/22042\n+\t* gcc.dg/cpp/strify4.c: New test.\n+\n 2005-11-03  Joseph S. Myers  <joseph@codesourcery.com>\n \n \tPR c++/17964"}, {"sha": "b8b2f11e9d112546225c4d055ea45f0785356b59", "filename": "gcc/testsuite/gcc.dg/cpp/strify4.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fstrify4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fstrify4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fcpp%2Fstrify4.c?ref=651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do run } */\n+/* Tests we stringify without changing unprintable characts.  \n+\n+   Andrew Pinski */\n+\n+extern int strcmp (const char *, const char *);\n+extern int puts (const char *);\n+extern void abort (void);\n+#define err(str) do { puts(str); abort(); } while (0)\n+\n+\n+#define S(X) S2(X)\n+#define S2(X) #X\n+#define TAB \"\t\" /* Note there is a tab character here. */\n+\n+int main (int argc, char *argv[])\n+{\n+  /* The space before \"bar\" here is vital.  */\n+  char a[] = S(S(TAB));\n+\n+  if (strcmp (a, \"\\\"\\\\\\\"\t\\\\\\\"\\\"\"))\n+    err (\"stringification caused octal\");\n+\n+  return 0;\n+}"}, {"sha": "3a489b4c1c0bc139bb0c856e237e5059598adec9", "filename": "libcpp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/libcpp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/libcpp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2FChangeLog?ref=651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "patch": "@@ -1,3 +1,11 @@\n+2005-11-03  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR preprocessor/22042\n+\t* macro.c (_cpp_builtin_macro_text): Lower the needed max\n+\tbuffer size.\n+\t(cpp_quote_string): Don't octalify non printable\n+\tcharactors.\n+\n 2005-11-03  Joseph S. Myers  <joseph@codesourcery.com>\n \n \tPR c++/17964"}, {"sha": "a0aa93ea994acbd5cccc23f02c862bb4ed4bb0a0", "filename": "libcpp/macro.c", "status": "modified", "additions": 4, "deletions": 13, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/libcpp%2Fmacro.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/651ed94280e4b88bf4fb69be0451cf2766ec9ab0/libcpp%2Fmacro.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcpp%2Fmacro.c?ref=651ed94280e4b88bf4fb69be0451cf2766ec9ab0", "patch": "@@ -139,7 +139,7 @@ _cpp_builtin_macro_text (cpp_reader *pfile, cpp_hashnode *node)\n \n \tname = map->to_file;\n \tlen = strlen (name);\n-\tbuf = _cpp_unaligned_alloc (pfile, len * 4 + 3);\n+\tbuf = _cpp_unaligned_alloc (pfile, len * 2 + 3);\n \tresult = buf;\n \t*buf = '\"';\n \tbuf = cpp_quote_string (buf + 1, (const unsigned char *) name, len);\n@@ -292,9 +292,8 @@ builtin_macro (cpp_reader *pfile, cpp_hashnode *node)\n }\n \n /* Copies SRC, of length LEN, to DEST, adding backslashes before all\n-   backslashes and double quotes.  Non-printable characters are\n-   converted to octal.  DEST must be of sufficient size.  Returns\n-   a pointer to the end of the string.  */\n+   backslashes and double quotes. DEST must be of sufficient size.\n+   Returns a pointer to the end of the string.  */\n uchar *\n cpp_quote_string (uchar *dest, const uchar *src, unsigned int len)\n {\n@@ -308,15 +307,7 @@ cpp_quote_string (uchar *dest, const uchar *src, unsigned int len)\n \t  *dest++ = c;\n \t}\n       else\n-\t{\n-\t  if (ISPRINT (c))\n-\t    *dest++ = c;\n-\t  else\n-\t    {\n-\t      sprintf ((char *) dest, \"\\\\%03o\", c);\n-\t      dest += 4;\n-\t    }\n-\t}\n+\t  *dest++ = c;\n     }\n \n   return dest;"}]}