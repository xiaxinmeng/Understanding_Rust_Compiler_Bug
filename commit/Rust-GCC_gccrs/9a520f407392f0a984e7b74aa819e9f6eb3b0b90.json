{"sha": "9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWE1MjBmNDA3MzkyZjBhOTg0ZTdiNzRhYTgxOWU5ZjZlYjNiMGI5MA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2004-09-15T08:19:39Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2004-09-15T08:19:39Z"}, "message": "builtins.c (expand_builtin_memmove): Optimize memmove (x, y, 1) into memcpy (x, y, 1) if memcpy can be expanded inline.\n\n\t* builtins.c (expand_builtin_memmove): Optimize memmove (x, y, 1)\n\tinto memcpy (x, y, 1) if memcpy can be expanded inline.\n\n\t* gcc.c-torture/execute/builtins/memmove.c (main_test): Formatting.\n\t* gcc.c-torture/execute/builtins/memmove-2.c: New test.\n\t* gcc.c-torture/execute/builtins/memmove-2-lib.c: New.\n\nFrom-SVN: r87539", "tree": {"sha": "77eadc5f7abf659773934ba55f1eee0b30a67d3d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77eadc5f7abf659773934ba55f1eee0b30a67d3d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b1d16eff57d17fbab7430d7098ed6ea6144d45f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1d16eff57d17fbab7430d7098ed6ea6144d45f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1d16eff57d17fbab7430d7098ed6ea6144d45f7"}], "stats": {"total": 72, "additions": 65, "deletions": 7}, "files": [{"sha": "cfa747bbb608b74fe7b87ce397e1df55f8a773dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "patch": "@@ -1,3 +1,8 @@\n+2004-09-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* builtins.c (expand_builtin_memmove): Optimize memmove (x, y, 1)\n+\tinto memcpy (x, y, 1) if memcpy can be expanded inline.\n+\n 2004-09-15  Zdenek Dvorak  <rakdver@atrey.karlin.mff.cuni.cz>\n \n \tPR tree-optimization/17468"}, {"sha": "bf5ec081d3522f022e926010b5679eeface5921b", "filename": "gcc/builtins.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "patch": "@@ -2940,6 +2940,16 @@ expand_builtin_memmove (tree arglist, rtx target, enum machine_mode mode)\n \t\t\t      target, mode, EXPAND_NORMAL);\n \t}\n \n+      /* If length is 1 and we can expand memcpy call inline,\n+\t it is ok to use memcpy as well.  */\n+      if (integer_onep (len))\n+        {\n+\t  rtx ret = expand_builtin_mempcpy (arglist, target, mode,\n+\t\t\t\t\t    /*endp=*/0);\n+\t  if (ret)\n+\t    return ret;\n+        }\n+\n       /* Otherwise, call the normal function.  */\n       return 0;\n    }"}, {"sha": "8cda9ffb6893aa1c351bf49289aa48ec3f4cb54a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "patch": "@@ -1,3 +1,9 @@\n+2004-09-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.c-torture/execute/builtins/memmove.c (main_test): Formatting.\n+\t* gcc.c-torture/execute/builtins/memmove-2.c: New test.\n+\t* gcc.c-torture/execute/builtins/memmove-2-lib.c: New.\n+\n 2004-09-14  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/17324"}, {"sha": "5be3df52fe5507b228da06de3f8437974d85b59c", "filename": "gcc/testsuite/gcc.c-torture/execute/builtins/memmove-2-lib.c", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove-2-lib.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove-2-lib.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove-2-lib.c?ref=9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "patch": "@@ -0,0 +1 @@\n+#include \"lib/memmove.c\""}, {"sha": "3afe3431338c190a1931b5eef4c99d492e502420", "filename": "gcc/testsuite/gcc.c-torture/execute/builtins/memmove-2.c", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove-2.c?ref=9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "patch": "@@ -0,0 +1,36 @@\n+/* Copyright (C) 2004  Free Software Foundation.\n+\n+   Check builtin memmove and bcopy optimization when length is 1.\n+\n+   Written by Jakub Jelinek, 9/14/2004.  */\n+\n+extern void abort (void);\n+typedef __SIZE_TYPE__ size_t;\n+extern void *memmove (void *, const void *, size_t);\n+extern void bcopy (const void *, void *, size_t);\n+extern int memcmp (const void *, const void *, size_t);\n+\n+char p[32] = \"abcdefg\";\n+char *q = p + 4;\n+\n+void\n+main_test (void)\n+{\n+  /* memmove with length 1 can be optimized into memcpy if it can be\n+     expanded inline.  */\n+  if (memmove (p + 2, p + 3, 1) != p + 2 || memcmp (p, \"abddefg\", 8))\n+    abort ();\n+  if (memmove (p + 1, p + 1, 1) != p + 1 || memcmp (p, \"abddefg\", 8))\n+    abort ();\n+  if (memmove (q, p + 4, 1) != p + 4 || memcmp (p, \"abddefg\", 8))\n+    abort ();\n+  bcopy (p + 5, p + 6, 1);\n+  if (memcmp (p, \"abddeff\", 8))\n+    abort ();\n+  bcopy (p + 1, p + 1, 1);\n+  if (memcmp (p, \"abddeff\", 8))\n+    abort ();\n+  bcopy (q, p + 4, 1);\n+  if (memcmp (p, \"abddeff\", 8))\n+    abort ();\n+}"}, {"sha": "f52332c6c1376a6371949ec5ec134edba2efd476", "filename": "gcc/testsuite/gcc.c-torture/execute/builtins/memmove.c", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a520f407392f0a984e7b74aa819e9f6eb3b0b90/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fbuiltins%2Fmemmove.c?ref=9a520f407392f0a984e7b74aa819e9f6eb3b0b90", "patch": "@@ -1,4 +1,4 @@\n-/* Copyright (C) 2003  Free Software Foundation.\n+/* Copyright (C) 2003, 2004  Free Software Foundation.\n \n    Ensure builtin memmove and bcopy perform correctly.\n \n@@ -62,13 +62,13 @@ main_test (void)\n   struct bar b1[sizeof bar/sizeof*bar];\n   int bz[sizeof baz/sizeof*baz];\n \n-  if (memmove (f1, foo, sizeof (foo)) != f1 || memcmp (f1, foo, sizeof(foo)))\n-    abort();\n-  if (memmove (b1, bar, sizeof (bar)) != b1 || memcmp (b1, bar, sizeof(bar)))\n-    abort();\n+  if (memmove (f1, foo, sizeof (foo)) != f1 || memcmp (f1, foo, sizeof (foo)))\n+    abort ();\n+  if (memmove (b1, bar, sizeof (bar)) != b1 || memcmp (b1, bar, sizeof (bar)))\n+    abort ();\n   bcopy (baz, bz, sizeof (baz));\n-  if (memcmp (bz, baz, sizeof(baz)))\n-    abort();\n+  if (memcmp (bz, baz, sizeof (baz)))\n+    abort ();\n \n   if (memmove (p, \"abcde\", 6) != p || memcmp (p, \"abcde\", 6))\n     abort ();"}]}