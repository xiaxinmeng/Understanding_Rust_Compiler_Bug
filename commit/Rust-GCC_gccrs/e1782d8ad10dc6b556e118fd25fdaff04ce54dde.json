{"sha": "e1782d8ad10dc6b556e118fd25fdaff04ce54dde", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE3ODJkOGFkMTBkYzZiNTU2ZTExOGZkMjVmZGFmZjA0Y2U1NGRkZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-02-10T06:54:30Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-02-10T06:54:30Z"}, "message": "dwarf2out: Don't prune static data members initialized with constants with -gdwarf-5 [PR98755]\n\nIn DWARF4 and earlier, static data members were represented as DW_TAG_member and the\npruning code wouldn't prune those, but in DWARF5 they are represented as DW_TAG_variable\nwith the class parent and the pruning code prunes those by default unless they are\nreferenced from a separate definition without the class parent (out of class definition).\nC++17 inline vars have the definitions in the class though and even before if the static\ndata member isn't ODR used, it doesn't need to be defined, so we could just never describe\nthose static data members in the debug info.\n\nThis change stops the pruning of DW_TAG_variable with DW_AT_const_value attribute\nwith a class parent for -gdwarf-5 and later.\n\nThis fixes\n-FAIL: g++.dg/debug/dwarf2/constexpr-var-1.C   scan-assembler-times  DW_AT_const_expr 2\n-FAIL: libstdc++-prettyprinters/80276.cc whatis p4\n-FAIL: libstdc++-prettyprinters/80276.cc whatis p4\n-FAIL: libstdc++-prettyprinters/libfundts.cc print as\n-FAIL: libstdc++-prettyprinters/libfundts.cc print as\n-FAIL: libstdc++-prettyprinters/libfundts.cc print os\n-FAIL: libstdc++-prettyprinters/libfundts.cc print os\n\n2021-02-10  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR debug/98755\n\t* dwarf2out.c (prune_unused_types_walk): Mark DW_TAG_variable DIEs\n\tat class scope for DWARF5+.", "tree": {"sha": "2ee4e14f9efd2939355cd81b20cb66a7180b92bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2ee4e14f9efd2939355cd81b20cb66a7180b92bf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e1782d8ad10dc6b556e118fd25fdaff04ce54dde", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1782d8ad10dc6b556e118fd25fdaff04ce54dde", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1782d8ad10dc6b556e118fd25fdaff04ce54dde", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1782d8ad10dc6b556e118fd25fdaff04ce54dde/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f7fb2f662fe12f327ece8b034ab76b36fdca4696", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f7fb2f662fe12f327ece8b034ab76b36fdca4696", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f7fb2f662fe12f327ece8b034ab76b36fdca4696"}], "stats": {"total": 10, "additions": 10, "deletions": 0}, "files": [{"sha": "d6ad40a580f3fc6865dcb8e34d38a12a51a88a11", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e1782d8ad10dc6b556e118fd25fdaff04ce54dde/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e1782d8ad10dc6b556e118fd25fdaff04ce54dde/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=e1782d8ad10dc6b556e118fd25fdaff04ce54dde", "patch": "@@ -29475,6 +29475,16 @@ prune_unused_types_walk (dw_die_ref die)\n \t  if (die->die_perennial_p)\n \t    break;\n \n+\t  /* For static data members, the declaration in the class is supposed\n+\t     to have DW_TAG_member tag in DWARF{3,4} but DW_TAG_variable in\n+\t     DWARF5.  DW_TAG_member will be marked, so mark even such\n+\t     DW_TAG_variables in DWARF5, as long as it has DW_AT_const_value\n+\t     attribute.  */\n+\t  if (dwarf_version >= 5\n+\t      && class_scope_p (die->die_parent)\n+\t      && get_AT (die, DW_AT_const_value))\n+\t    break;\n+\n \t  /* premark_used_variables marks external variables --- don't mark\n \t     them here.  But function-local externals are always considered\n \t     used.  */"}]}