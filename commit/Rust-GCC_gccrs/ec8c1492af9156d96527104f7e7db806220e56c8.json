{"sha": "ec8c1492af9156d96527104f7e7db806220e56c8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWM4YzE0OTJhZjkxNTZkOTY1MjcxMDRmN2U3ZGI4MDYyMjBlNTZjOA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-12-01T19:12:54Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-12-01T19:12:54Z"}, "message": "re PR debug/50317 (missing DW_OP_GNU_implicit_pointer)\n\n\tPR debug/50317\n\t* tree-ssa-dce.c (remove_dead_stmt): Add a debug stmt when removing\n\tas unnecessary a store to a variable with gimple reg type.\n\t* tree-ssa-live.c (remove_unused_locals): Clear TREE_ADDRESSABLE bit\n\ton local unreferenced variables.\n\t* cfgexpand.c (expand_gimple_basic_block): Don't emit DEBUG_INSNs\n\tfor !target_for_debug_bind variables.\n\nFrom-SVN: r181890", "tree": {"sha": "a0a8960c1902ff04d8b319d3ba88cf5c4f64534b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a0a8960c1902ff04d8b319d3ba88cf5c4f64534b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ec8c1492af9156d96527104f7e7db806220e56c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec8c1492af9156d96527104f7e7db806220e56c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec8c1492af9156d96527104f7e7db806220e56c8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec8c1492af9156d96527104f7e7db806220e56c8/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e411850054322167de1ae23af2b7c9b7a1ac9029", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e411850054322167de1ae23af2b7c9b7a1ac9029", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e411850054322167de1ae23af2b7c9b7a1ac9029"}], "stats": {"total": 48, "additions": 46, "deletions": 2}, "files": [{"sha": "0ab88fa1198ffa5f01e6fd773517c87a9a293067", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ec8c1492af9156d96527104f7e7db806220e56c8", "patch": "@@ -1,3 +1,13 @@\n+2011-12-01  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR debug/50317\n+\t* tree-ssa-dce.c (remove_dead_stmt): Add a debug stmt when removing\n+\tas unnecessary a store to a variable with gimple reg type.\n+\t* tree-ssa-live.c (remove_unused_locals): Clear TREE_ADDRESSABLE bit\n+\ton local unreferenced variables.\n+\t* cfgexpand.c (expand_gimple_basic_block): Don't emit DEBUG_INSNs\n+\tfor !target_for_debug_bind variables.\n+\n 2011-12-01  Patrick Marlier  <patrick.marlier@gmail.com>\n \n \tPR middle-end/51273"}, {"sha": "e5a7a392eb473a5c8d6ef27823c90d80ada86f85", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=ec8c1492af9156d96527104f7e7db806220e56c8", "patch": "@@ -3903,6 +3903,11 @@ expand_gimple_basic_block (basic_block bb)\n \t      rtx val;\n \t      enum machine_mode mode;\n \n+\t      if (TREE_CODE (var) != DEBUG_EXPR_DECL\n+\t\t  && TREE_CODE (var) != LABEL_DECL\n+\t\t  && !target_for_debug_bind (var))\n+\t\tgoto delink_debug_stmt;\n+\n \t      if (gimple_debug_bind_has_value_p (stmt))\n \t\tvalue = gimple_debug_bind_get_value (stmt);\n \t      else\n@@ -3932,6 +3937,7 @@ expand_gimple_basic_block (basic_block bb)\n \t\t  PAT_VAR_LOCATION_LOC (val) = (rtx)value;\n \t\t}\n \n+\t    delink_debug_stmt:\n \t      /* In order not to generate too many debug temporaries,\n \t         we delink all uses of debug statements we already expanded.\n \t\t Therefore debug statements between definition and real"}, {"sha": "a710de620df25d37203a97592b55cd8ed32cfc3e", "filename": "gcc/tree-ssa-dce.c", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2Ftree-ssa-dce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2Ftree-ssa-dce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-dce.c?ref=ec8c1492af9156d96527104f7e7db806220e56c8", "patch": "@@ -1215,6 +1215,26 @@ remove_dead_stmt (gimple_stmt_iterator *i, basic_block bb)\n \t  ei_next (&ei);\n     }\n \n+  /* If this is a store into a variable that is being optimized away,\n+     add a debug bind stmt if possible.  */\n+  if (MAY_HAVE_DEBUG_STMTS\n+      && gimple_assign_single_p (stmt)\n+      && is_gimple_val (gimple_assign_rhs1 (stmt)))\n+    {\n+      tree lhs = gimple_assign_lhs (stmt);\n+      if ((TREE_CODE (lhs) == VAR_DECL || TREE_CODE (lhs) == PARM_DECL)\n+\t  && !DECL_IGNORED_P (lhs)\n+\t  && is_gimple_reg_type (TREE_TYPE (lhs))\n+\t  && !is_global_var (lhs)\n+\t  && !DECL_HAS_VALUE_EXPR_P (lhs))\n+\t{\n+\t  tree rhs = gimple_assign_rhs1 (stmt);\n+\t  gimple note\n+\t    = gimple_build_debug_bind (lhs, unshare_expr (rhs), stmt);\n+\t  gsi_insert_after (i, note, GSI_SAME_STMT);\n+\t}\n+    }\n+\n   unlink_stmt_vdef (stmt);\n   gsi_remove (i, true);\n   release_defs (stmt);"}, {"sha": "103e4f7155ae01169d1fc0e1d6df2547f2c7846c", "filename": "gcc/tree-ssa-live.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2Ftree-ssa-live.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec8c1492af9156d96527104f7e7db806220e56c8/gcc%2Ftree-ssa-live.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-live.c?ref=ec8c1492af9156d96527104f7e7db806220e56c8", "patch": "@@ -1,5 +1,5 @@\n /* Liveness for SSA trees.\n-   Copyright (C) 2003, 2004, 2005, 2007, 2008, 2009, 2010\n+   Copyright (C) 2003, 2004, 2005, 2007, 2008, 2009, 2010, 2011\n    Free Software Foundation, Inc.\n    Contributed by Andrew MacLeod <amacleod@redhat.com>\n \n@@ -814,7 +814,15 @@ remove_unused_locals (void)\n \t      bitmap_set_bit (global_unused_vars, DECL_UID (var));\n \t    }\n \t  else\n-\t    continue;\n+\t    {\n+\t      /* For unreferenced local vars drop TREE_ADDRESSABLE\n+\t\t bit in case it is referenced from debug stmts.  */\n+\t      if (DECL_CONTEXT (var) == current_function_decl\n+\t\t  && TREE_ADDRESSABLE (var)\n+\t\t  && is_gimple_reg_type (TREE_TYPE (var)))\n+\t\tTREE_ADDRESSABLE (var) = 0;\n+\t      continue;\n+\t    }\n \t}\n       else if (TREE_CODE (var) == VAR_DECL\n \t       && DECL_HARD_REGISTER (var)"}]}