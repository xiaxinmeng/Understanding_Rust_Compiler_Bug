{"sha": "babf697a2da6eff7ea91e02605023b309119a175", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmFiZjY5N2EyZGE2ZWZmN2VhOTFlMDI2MDUwMjNiMzA5MTE5YTE3NQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2017-09-05T08:14:35Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2017-09-05T08:14:35Z"}, "message": "trans.c (pos_to_constructor): Skip conversions to an unconstrained array type.\n\n\t* gcc-interface/trans.c (pos_to_constructor): Skip conversions to an\n\tunconstrained array type.\n\nFrom-SVN: r251691", "tree": {"sha": "3742a50e2cddae5fa2bd072065f1b69856d49bc9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3742a50e2cddae5fa2bd072065f1b69856d49bc9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/babf697a2da6eff7ea91e02605023b309119a175", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/babf697a2da6eff7ea91e02605023b309119a175", "html_url": "https://github.com/Rust-GCC/gccrs/commit/babf697a2da6eff7ea91e02605023b309119a175", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/babf697a2da6eff7ea91e02605023b309119a175/comments", "author": null, "committer": null, "parents": [{"sha": "02e637d86f9ecb6d0e368438291bb6f6f8feb3ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02e637d86f9ecb6d0e368438291bb6f6f8feb3ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02e637d86f9ecb6d0e368438291bb6f6f8feb3ab"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "32030b55e28c94d7a7c5b61eda232d1068018fcb", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=babf697a2da6eff7ea91e02605023b309119a175", "patch": "@@ -1,3 +1,8 @@\n+2017-09-05  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/trans.c (pos_to_constructor): Skip conversions to an\n+\tunconstrained array type.\n+\n 2017-08-30  Richard Sandiford  <richard.sandiford@linaro.org>\n \t    Alan Hayward  <alan.hayward@arm.com>\n \t    David Sherwood  <david.sherwood@arm.com>"}, {"sha": "f7b51bbbd0aaf661f2753d262db5bfd96179b8c5", "filename": "gcc/ada/gcc-interface/trans.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Ftrans.c?ref=babf697a2da6eff7ea91e02605023b309119a175", "patch": "@@ -9826,7 +9826,14 @@ pos_to_constructor (Node_Id gnat_expr, tree gnu_array_type,\n \t\t\t\t       gnat_component_type);\n       else\n \t{\n-\t  gnu_expr = gnat_to_gnu (gnat_expr);\n+\t  /* If the expression is a conversion to an unconstrained array type,\n+\t     skip it to avoid spilling to memory.  */\n+\t  if (Nkind (gnat_expr) == N_Type_Conversion\n+\t      && Is_Array_Type (Etype (gnat_expr))\n+\t      && !Is_Constrained (Etype (gnat_expr)))\n+\t    gnu_expr = gnat_to_gnu (Expression (gnat_expr));\n+\t  else\n+\t    gnu_expr = gnat_to_gnu (gnat_expr);\n \n \t  /* Before assigning the element to the array, make sure it is\n \t     in range.  */"}, {"sha": "28691293aa6d34779af7b729bc21be34c1293f68", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=babf697a2da6eff7ea91e02605023b309119a175", "patch": "@@ -1,3 +1,7 @@\n+2017-09-05  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* testsuite/gnat.dg/array29.ad[sb]: New test.\n+\n 2017-09-05  Martin Liska  <mliska@suse.cz>\n \n \tPR tree-optimization/82032"}, {"sha": "9736941f3a11d684420abb5bb96501cf39d6b461", "filename": "gcc/testsuite/gnat.dg/array29.adb", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Ftestsuite%2Fgnat.dg%2Farray29.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Ftestsuite%2Fgnat.dg%2Farray29.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Farray29.adb?ref=babf697a2da6eff7ea91e02605023b309119a175", "patch": "@@ -0,0 +1,26 @@\n+-- { dg-do compile }\n+-- { dg-options \"-O\" }\n+\n+package body Array29 is\n+\n+  procedure Copy (Src : in Matrix; Dst : out Matrix) is\n+  begin\n+    for I in Src'Range (1) loop\n+      for J in Src'Range (2) loop\n+        Dst (I, J) := Src (I, J);\n+      end loop;\n+    end loop;\n+  end;\n+\n+  procedure Proc is\n+    N : constant := 2;\n+    FM1 : constant Matrix (1 .. N, 1 .. N) := ((1.0, 2.0), (3.0, 4.0));\n+    FM2 : constant Matrix (1 .. N, 1 .. N) := ((1.0, 2.0), (3.0, 4.0));\n+    A : constant array (1 .. 2) of Matrix (1 .. N, 1 .. N)\n+      := (Matrix (FM1), Matrix (FM2));\n+    Final : Matrix (1 .. N, 1 .. N);\n+  begin\n+    Copy (Src => A (1), Dst => Final);\n+  end;\n+\n+end Array29;"}, {"sha": "049ca1f3c6628a8b0c6e0467bfcad5b7c7c5d258", "filename": "gcc/testsuite/gnat.dg/array29.ads", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Ftestsuite%2Fgnat.dg%2Farray29.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/babf697a2da6eff7ea91e02605023b309119a175/gcc%2Ftestsuite%2Fgnat.dg%2Farray29.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Farray29.ads?ref=babf697a2da6eff7ea91e02605023b309119a175", "patch": "@@ -0,0 +1,7 @@\n+package Array29 is\r\n+\r\n+  type Matrix is array (Integer range <>, Integer range <>) of Long_Float;\r\n+\r\n+  procedure Proc;\r\n+\r\n+end Array29;\r"}]}