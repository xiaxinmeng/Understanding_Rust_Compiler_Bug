{"sha": "e964a55607b3cd9e45a45d3331c6f163df7519f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTk2NGE1NTYwN2IzY2Q5ZTQ1YTQ1ZDMzMzFjNmYxNjNkZjc1MTlmNQ==", "commit": {"author": {"name": "Jason Thorpe", "email": "thorpej@wasabisystems.com", "date": "2002-05-18T19:02:03Z"}, "committer": {"name": "Jason Thorpe", "email": "thorpej@gcc.gnu.org", "date": "2002-05-18T19:02:03Z"}, "message": "c-common.c (c_common_post_options): Warn if -Wformat-zero-length is used without -Wformat.\n\n* c-common.c (c_common_post_options): Warn if -Wformat-zero-length\nis used without -Wformat.\n* c-common.h (warn_format_zero_length): Declare extern.\n* c-decl.c (warn_options): Add \"format-zero-length\".\n* c-format.c (warn_format_zero_length): Declare.\n(set_Wformat): Set warn_format_zero_length for -Wformat.\n(check_format_info): Only warn about zero-length formats if\nwarn_format_zero_length is true.  Include the format type\nname in the warning message.\n* doc/invoke.texi: Document -Wformat-zero-length.\n* testsuite/gcc.dg/format/zero-length-1.c: New test.\n\nFrom-SVN: r53592", "tree": {"sha": "c6b8df55dea21cfdbf9d6f73c35e548d165992b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c6b8df55dea21cfdbf9d6f73c35e548d165992b2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e964a55607b3cd9e45a45d3331c6f163df7519f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e964a55607b3cd9e45a45d3331c6f163df7519f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e964a55607b3cd9e45a45d3331c6f163df7519f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e964a55607b3cd9e45a45d3331c6f163df7519f5/comments", "author": null, "committer": null, "parents": [{"sha": "d92b44865fab81d50fc2db997387f92448d7611a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d92b44865fab81d50fc2db997387f92448d7611a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d92b44865fab81d50fc2db997387f92448d7611a"}], "stats": {"total": 57, "additions": 52, "deletions": 5}, "files": [{"sha": "9951dc1a97938954316823d8a1185a8ad4809a71", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -1,3 +1,17 @@\n+2002-05-18  Jason Thorpe  <thorpej@wasabisystems.com>\n+\n+\t* c-common.c (c_common_post_options): Warn if -Wformat-zero-length\n+\tis used without -Wformat.  \n+\t* c-common.h (warn_format_zero_length): Declare extern.\n+\t* c-decl.c (warn_options): Add \"format-zero-length\".\n+\t* c-format.c (warn_format_zero_length): Declare.\n+\t(set_Wformat): Set warn_format_zero_length for -Wformat.\n+\t(check_format_info): Only warn about zero-length formats if\n+\twarn_format_zero_length is true.  Include the format type\n+\tname in the warning message.\n+\t* doc/invoke.texi: Document -Wformat-zero-length.\n+\t* testsuite/gcc.dg/format/zero-length-1.c: New test.\n+\n 2002-05-18  Kazu Hirata  <kazu@cs.umass.edu>\n \n \t* timevar.c: Fix formatting."}, {"sha": "d851c27637be60f297f7f1c552b517207f0552bb", "filename": "gcc/c-common.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.c?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -4311,6 +4311,8 @@ c_common_post_options ()\n     warning (\"-Wformat-y2k ignored without -Wformat\");\n   if (warn_format_extra_args && !warn_format)\n     warning (\"-Wformat-extra-args ignored without -Wformat\");\n+  if (warn_format_zero_length && !warn_format)\n+    warning (\"-Wformat-zero-length ignored without -Wformat\");\n   if (warn_format_nonliteral && !warn_format)\n     warning (\"-Wformat-nonliteral ignored without -Wformat\");\n   if (warn_format_security && !warn_format)"}, {"sha": "8666095118f783af1c88649d2d98a04ac213103c", "filename": "gcc/c-common.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-common.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-common.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-common.h?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -414,6 +414,10 @@ extern int warn_format_y2k;\n \n extern int warn_format_extra_args;\n \n+/* Warn about zero-length formats.  */\n+\n+extern int warn_format_zero_length;\n+\n /* Warn about non-literal format arguments.  */\n \n extern int warn_format_nonliteral;"}, {"sha": "8825db1653e1fa3cacba0ea40ae985ab2284ceaa", "filename": "gcc/c-decl.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -474,6 +474,7 @@ c_decode_option (argc, argv)\n     { \"div-by-zero\", &warn_div_by_zero },\n     { \"float-equal\", &warn_float_equal },\n     { \"format-extra-args\", &warn_format_extra_args },\n+    { \"format-zero-length\", &warn_format_zero_length },\n     { \"format-nonliteral\", &warn_format_nonliteral },\n     { \"format-security\", &warn_format_security },\n     { \"format-y2k\", &warn_format_y2k },"}, {"sha": "dc73f4d69f1671e34e3be465d6a0a5c929364c1f", "filename": "gcc/c-format.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-format.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fc-format.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-format.c?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -44,6 +44,10 @@ int warn_format_y2k;\n \n int warn_format_extra_args;\n \n+/* Warn about zero-length formats.  */\n+\n+int warn_format_zero_length;\n+\n /* Warn about non-literal format arguments.  */\n \n int warn_format_nonliteral;\n@@ -61,6 +65,7 @@ set_Wformat (setting)\n   warn_format = setting;\n   warn_format_y2k = setting;\n   warn_format_extra_args = setting;\n+  warn_format_zero_length = setting;\n   if (setting != 1)\n     {\n       warn_format_nonliteral = setting;\n@@ -1361,8 +1366,9 @@ check_format_info (status, info, params)\n       && res.number_other == 0 && warn_format_extra_args)\n     status_warning (status, \"unused arguments in $-style format\");\n   if (res.number_empty > 0 && res.number_non_literal == 0\n-      && res.number_other == 0)\n-    status_warning (status, \"zero-length format string\");\n+      && res.number_other == 0 && warn_format_zero_length)\n+    status_warning (status, \"zero-length %s format string\",\n+\t\t    format_types[info->format_type].name);\n \n   if (res.number_wide > 0)\n     status_warning (status, \"format is a wide character string\");"}, {"sha": "855fcd9206286f3df64e6b56bdce08924b30e91c", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -1844,9 +1844,9 @@ Options,,Options Controlling C Dialect}.\n \n @option{-Wformat} is included in @option{-Wall}.  For more control over some\n aspects of format checking, the options @option{-Wno-format-y2k},\n-@option{-Wno-format-extra-args}, @option{-Wformat-nonliteral},\n-@option{-Wformat-security} and @option{-Wformat=2} are available, but are\n-not included in @option{-Wall}.\n+@option{-Wno-format-extra-args}, @option{-Wno-format-zero-length},\n+@option{-Wformat-nonliteral}, @option{-Wformat-security}, and\n+@option{-Wformat=2} are available, but are not included in @option{-Wall}.\n \n @item -Wno-format-y2k\n @opindex Wno-format-y2k\n@@ -1867,6 +1867,11 @@ in the case of @code{scanf} formats, this option will suppress the\n warning if the unused arguments are all pointers, since the Single\n Unix Specification says that such unused arguments are allowed.\n \n+@item -Wno-format-zero-length\n+@opindex Wno-format-zero-length\n+If @option{-Wformat} is specified, do not warn about zero-length formats.\n+The C standard specifies that zero-length formats are allowed.\n+\n @item -Wformat-nonliteral\n @opindex Wformat-nonliteral\n If @option{-Wformat} is specified, also warn if the format string is not a"}, {"sha": "4cf37f3203d02b358459af5d035d4c3bd6c7669f", "filename": "gcc/testsuite/gcc.dg/format/zero-length-1.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fzero-length-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e964a55607b3cd9e45a45d3331c6f163df7519f5/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fzero-length-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fformat%2Fzero-length-1.c?ref=e964a55607b3cd9e45a45d3331c6f163df7519f5", "patch": "@@ -0,0 +1,15 @@\n+/* Test the -Wno-format-zero-length option, which suppresses warnings\n+   about zero-length formats.  */\n+/* Origin: Jason Thorpe <thorpej@wasabisystems.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=iso9899:1990 -pedantic -Wformat -Wno-format-zero-length\" } */\n+\n+#include \"format.h\"\n+\n+void\n+foo (void)\n+{\n+  /* See ISO/IEC 9899:1990 (E) subclause 7.9.6.1 (pages 131-134).  */\n+  /* Zero-length format strings are allowed.  */\n+  printf (\"\");\n+}"}]}