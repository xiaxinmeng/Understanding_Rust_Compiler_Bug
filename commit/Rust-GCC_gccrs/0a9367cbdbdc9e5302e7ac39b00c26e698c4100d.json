{"sha": "0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGE5MzY3Y2JkYmRjOWU1MzAyZTdhYzM5YjAwYzI2ZTY5OGM0MTAwZA==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2006-07-15T09:29:32Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2006-07-15T09:29:32Z"}, "message": "re PR c++/28294 (ICE with invalid use of __builtin_offsetof)\n\n\tPR c++/28294\n\t* semantics.c (finish_offsetof): Use TREE_OPERAND for COMPONENT_REFs\n\tonly.\n\n\t* g++.dg/ext/offsetof1.C: Add test with function pointer arithmetic.\n\nFrom-SVN: r115466", "tree": {"sha": "c2296541e245a9ff4ccd83c21f2f887c4b0714c1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c2296541e245a9ff4ccd83c21f2f887c4b0714c1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/comments", "author": null, "committer": null, "parents": [{"sha": "6ae9b8759e83dcfba6176c397aa703acb48d1f8b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ae9b8759e83dcfba6176c397aa703acb48d1f8b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ae9b8759e83dcfba6176c397aa703acb48d1f8b"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "fe5d0c709c233b274d996a5eb3b7b43d676b527c", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "patch": "@@ -1,5 +1,9 @@\n 2006-07-15  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n+\tPR c++/28294\n+\t* semantics.c (finish_offsetof): Use TREE_OPERAND for COMPONENT_REFs\n+\tonly.\n+\n \tPR c++/28387\n \t* decl2.c (cplus_decl_attributes): Check for invalid decls.\n "}, {"sha": "951f9f4bd590b412ed86290f0160b029b77f93b4", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "patch": "@@ -2905,8 +2905,9 @@ finish_offsetof (tree expr)\n       || TREE_CODE (TREE_TYPE (expr)) == METHOD_TYPE\n       || TREE_CODE (TREE_TYPE (expr)) == UNKNOWN_TYPE)\n     {\n-      error (\"cannot apply %<offsetof%> to member function %qD\",\n-\t     TREE_OPERAND (expr, 1));\n+      if (TREE_CODE (expr) == COMPONENT_REF)\n+\texpr = TREE_OPERAND (expr, 1);\n+      error (\"cannot apply %<offsetof%> to member function %qD\", expr);\n       return error_mark_node;\n     }\n   return fold_offsetof (expr);"}, {"sha": "6a2a4b5c9ba55fa47c1df4f62f86736c03daff4c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "patch": "@@ -1,5 +1,8 @@\n 2006-07-15  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n+\tPR c++/28294\n+\t* g++.dg/ext/offsetof1.C: Add test with function pointer arithmetic.\n+\n \tPR c++/28387\n \t* g++.dg/ext/attrib24.C: New test.\n "}, {"sha": "123a9e3efeb45f0c5c2089dbc834ecc1faf90d31", "filename": "gcc/testsuite/g++.dg/ext/offsetof1.C", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a9367cbdbdc9e5302e7ac39b00c26e698c4100d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Foffsetof1.C?ref=0a9367cbdbdc9e5302e7ac39b00c26e698c4100d", "patch": "@@ -9,6 +9,7 @@ struct bar {\n \n int a = __builtin_offsetof(bar, foo);  // { dg-error \"static data member\" }\n int b = __builtin_offsetof(bar, baz);  // { dg-error \"member function\" }\n+int b0 = __builtin_offsetof(bar, baz[0]);  // { dg-error \"function\" }\n int c = __builtin_offsetof(bar, ~bar);  // { dg-error \"member function\" }\n \n typedef int I;"}]}