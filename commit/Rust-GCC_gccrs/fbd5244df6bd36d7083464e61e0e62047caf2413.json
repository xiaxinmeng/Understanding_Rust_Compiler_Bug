{"sha": "fbd5244df6bd36d7083464e61e0e62047caf2413", "node_id": "C_kwDOANBUbNoAKGZiZDUyNDRkZjZiZDM2ZDcwODM0NjRlNjFlMGU2MjA0N2NhZjI0MTM", "commit": {"author": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2023-02-08T11:23:06Z"}, "committer": {"name": "Arthur Cohen", "email": "arthur.cohen@embecosm.com", "date": "2023-04-06T08:47:22Z"}, "message": "gccrs: expander: Add documentation for `expand_eager_invocations`\n\ngcc/rust/ChangeLog:\n\n\t* expand/rust-macro-expand.cc (MacroExpander::expand_eager_invocations):\n\tAdd documentation explaining the algorithm.", "tree": {"sha": "5e9229104716010f2b7fe74cb10d7a9b7ead0789", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5e9229104716010f2b7fe74cb10d7a9b7ead0789"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fbd5244df6bd36d7083464e61e0e62047caf2413", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbd5244df6bd36d7083464e61e0e62047caf2413", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbd5244df6bd36d7083464e61e0e62047caf2413", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbd5244df6bd36d7083464e61e0e62047caf2413/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3821669164d6d925de393470447e91c31bc78074", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3821669164d6d925de393470447e91c31bc78074", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3821669164d6d925de393470447e91c31bc78074"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "4b494490424570ce538af67c3ed272fe21433fd9", "filename": "gcc/rust/expand/rust-macro-expand.cc", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbd5244df6bd36d7083464e61e0e62047caf2413/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbd5244df6bd36d7083464e61e0e62047caf2413/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fexpand%2Frust-macro-expand.cc?ref=fbd5244df6bd36d7083464e61e0e62047caf2413", "patch": "@@ -197,17 +197,25 @@ MacroExpander::expand_eager_invocations (AST::MacroInvocation &invoc)\n       auto start = kv.first.first;\n       auto end = kv.first.second;\n \n-      // TODO: Add doc\n+      // We're now going to re-add the tokens to the invocation's token tree.\n+      // 1. Basically, what we want to do is insert all tokens up until the\n+      //    beginning of the macro invocation (start).\n+      // 2. Then, we'll insert all of the tokens resulting from the macro\n+      //    expansion: These are in `new_tokens`.\n+      // 3. Finally, we'll do that again from\n+      //    the end of macro and go back to 1.\n+\n       for (size_t i = current_idx; i < start; i++)\n \tnew_stream.emplace_back (stream[i]->clone_token ());\n \n-      // TODO: Add doc\n       for (auto &tok : new_tokens)\n \tnew_stream.emplace_back (tok->clone_token ());\n \n       current_idx = end;\n     }\n-  // TODO: Add doc\n+\n+  // Once all of that is done, we copy the last remaining tokens from the\n+  // original stream\n   for (size_t i = current_idx; i < stream.size (); i++)\n     new_stream.emplace_back (stream[i]->clone_token ());\n "}]}