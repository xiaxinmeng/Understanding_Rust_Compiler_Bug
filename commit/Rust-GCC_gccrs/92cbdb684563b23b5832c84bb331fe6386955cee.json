{"sha": "92cbdb684563b23b5832c84bb331fe6386955cee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTJjYmRiNjg0NTYzYjIzYjU4MzJjODRiYjMzMWZlNjM4Njk1NWNlZQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2009-11-02T21:52:59Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2009-11-02T21:52:59Z"}, "message": "Split up io/io.h\n\nFrom-SVN: r153825", "tree": {"sha": "a5e5ed3ef3340883b852b6a60b5d5922779e68b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a5e5ed3ef3340883b852b6a60b5d5922779e68b1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/92cbdb684563b23b5832c84bb331fe6386955cee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92cbdb684563b23b5832c84bb331fe6386955cee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/92cbdb684563b23b5832c84bb331fe6386955cee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/92cbdb684563b23b5832c84bb331fe6386955cee/comments", "author": null, "committer": null, "parents": [{"sha": "2265f646133c5e7dafc708d6889519a1588d5e69", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2265f646133c5e7dafc708d6889519a1588d5e69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2265f646133c5e7dafc708d6889519a1588d5e69"}], "stats": {"total": 404, "additions": 118, "deletions": 286}, "files": [{"sha": "3ee00936037ede4839c332c5cd5388a846d88079", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 77, "deletions": 0, "changes": 77, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -1,3 +1,80 @@\n+2009-11-02  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\t* Makefile.am (gfor_io_headers): Add fbuf.h, format.h, unix.h.\n+\t* Makefile.in: Regenerated.\n+\t* io/fbuf.h: New file.\n+\t* io/format.h: New file.\n+\t* io/unix.h: New file.\n+\t* io/io.h (struct stream): Move to unix.h, add forward declaration.\n+\t(sread): Likewise.\n+\t(swrite): Likewise.\n+\t(sseek): Likewise.\n+\t(stell): Likewise.\n+\t(struncate): Likewise.\n+\t(sflush): Likewise.\n+\t(sflush): Likewise.\n+\t(sclose): Likewise.\n+\t(compared_files): Move prototype to unix.h.\n+\t(open_external): Likewise.\n+\t(open_internal): Likewise.\n+\t(mem_alloc_w): Likewise.\n+\t(mem_alloc_r): Likewise.\n+\t(input_stream): Likewise.\n+\t(output_stream): Likewise.\n+\t(error_stream): Likewise.\n+\t(compare_file_filename): Likewise.\n+\t(find_file): Likewise.\n+\t(delete_file): Likewise.\n+\t(file_exists): Likewise.\n+\t(inquire_sequential): Likewise.\n+\t(inquire_direct): Likewise.\n+\t(inquire_formatted): Likewise.\n+\t(inquire_unformatted): Likewise.\n+\t(inquire_read): Likewise.\n+\t(inquire_write): Likewise.\n+\t(inquire_readwrite): Likewise.\n+\t(file_length): Likewise.\n+\t(is_seekable): Likewise.\n+\t(is_special): Likewise.\n+\t(flush_if_preconnected): Likewise.\n+\t(empty_internal_buffer): Likewise.\n+\t(stream_isatty): Likewise.\n+\t(stream_ttyname): Likewise.\n+\t(unpack_filename): Likewise.\n+\t(struct fbuf): Move to fbuf.h, add forward declaration.\n+\t(fbuf_init): Move prototype to fbuf.h.\n+\t(fbuf_destroy): Likewise.\n+\t(fbuf_reset): Likewise.\n+\t(fbuf_alloc): Likewise.\n+\t(fbuf_flush): Likewise.\n+\t(fbuf_seek): Likewise.\n+\t(fbuf_read): Likewise.\n+\t(fbuf_getc_refill): Likewise.\n+\t(fbuf_getc): Move inline function to fbuf.h.\n+\t(enum format_token): Move to format.h.\n+\t(struct fnode): Move to format.h, add forward declaration.\n+\t(parse_format): Move prototype to format.h.\n+\t(next_format): Likewise.\n+\t(unget_format): Likewise.\n+\t(format_error): Likewise.\n+\t(free_format_data): Likewise.\n+\t(free_format_hash_table): Likewise.\n+\t(init_format_hash): Likewise.\n+\t(free_format_hash): Likewise.\n+\t* io/close.c: Include unix.h.\n+\t* io/fbuf.c: Include fbuf.h and unix.h.\n+\t* io/file_pos.c: Include fbuf.h and unix.h.\n+\t* io/format.c: Include format.h.\n+\t* io/inquire.c: Include unix.h.\n+\t* io/intrinsics.c: Include fbuf.h and unix.h.\n+\t* io/list_read.c: Include fbuf.h and unix.h.\n+\t* io/open.c: Include fbuf.h and unix.h.\n+\t* io/read.c: Include format.h.\n+\t* io/transfer.c: Include fbuf.h, format.h, and unix.h.\n+\t* io/unit.c: Likewise.\n+\t* io/unix.c: Include unix.h.\n+\t* io/write.c: Include format.h and unix.h.\n+\n 2009-10-31  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR libfortran/41219"}, {"sha": "db086bbc6c5389dd965d5b5452c0baa84392741e", "filename": "libgfortran/Makefile.am", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.am?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -59,7 +59,10 @@ io/write.c \\\n io/fbuf.c\n \n gfor_io_headers= \\\n-io/io.h\n+io/io.h \\\n+io/fbuf.h \\\n+io/format.h \\\n+io/unix.h\n \n gfor_helper_src= \\\n intrinsics/associated.c \\"}, {"sha": "8fca11eaa1c5d65dae9353123e8600555c257017", "filename": "libgfortran/Makefile.in", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.in?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -451,8 +451,8 @@ am__libgfortran_la_SOURCES_DIST = runtime/backtrace.c runtime/bounds.c \\\n \tintrinsics/time.c intrinsics/transpose_generic.c \\\n \tintrinsics/umask.c intrinsics/unlink.c \\\n \tintrinsics/unpack_generic.c runtime/in_pack_generic.c \\\n-\truntime/in_unpack_generic.c io/io.h \\\n-\t$(srcdir)/generated/_abs_c4.F90 \\\n+\truntime/in_unpack_generic.c io/io.h io/fbuf.h io/format.h \\\n+\tio/unix.h $(srcdir)/generated/_abs_c4.F90 \\\n \t$(srcdir)/generated/_abs_c8.F90 \\\n \t$(srcdir)/generated/_abs_c10.F90 \\\n \t$(srcdir)/generated/_abs_c16.F90 \\\n@@ -1004,7 +1004,10 @@ io/write.c \\\n io/fbuf.c\n \n gfor_io_headers = \\\n-io/io.h\n+io/io.h \\\n+io/fbuf.h \\\n+io/format.h \\\n+io/unix.h\n \n gfor_helper_src = \\\n intrinsics/associated.c \\"}, {"sha": "1a4d7d16eb69552d4bd6b733acf0038163909be3", "filename": "libgfortran/io/close.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fclose.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fclose.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fclose.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -23,6 +23,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"unix.h\"\n #include <limits.h>\n \n typedef enum"}, {"sha": "d79cf15c473cd15d69bd61200c23bb98bd1e1c0e", "filename": "libgfortran/io/fbuf.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Ffbuf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Ffbuf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ffbuf.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -24,6 +24,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n \n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"unix.h\"\n #include <string.h>\n #include <stdlib.h>\n \n@@ -37,7 +39,7 @@ fbuf_init (gfc_unit * u, int len)\n   if (len == 0)\n     len = 512;\t\t\t/* Default size.  */\n \n-  u->fbuf = get_mem (sizeof (fbuf));\n+  u->fbuf = get_mem (sizeof (struct fbuf));\n   u->fbuf->buf = get_mem (len);\n   u->fbuf->len = len;\n   u->fbuf->act = u->fbuf->pos = 0;"}, {"sha": "f7d9499616347fb2597491e055ae67484f3284fb", "filename": "libgfortran/io/file_pos.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Ffile_pos.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Ffile_pos.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ffile_pos.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -23,6 +23,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"unix.h\"\n #include <string.h>\n \n /* file_pos.c-- Implement the file positioning statements, i.e. BACKSPACE,"}, {"sha": "cafea8732e46367d83e2011c063ade38bcbb3d04", "filename": "libgfortran/io/format.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fformat.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fformat.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fformat.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -29,6 +29,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n  * interpretation during I/O statements */\n \n #include \"io.h\"\n+#include \"format.h\"\n #include <ctype.h>\n #include <string.h>\n #include <stdbool.h>"}, {"sha": "c36b9e5fa69cd36a76f62e8e4a61bb28f609ab74", "filename": "libgfortran/io/inquire.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Finquire.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Finquire.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Finquire.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -26,6 +26,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n /* Implement the non-IOLENGTH variant of the INQUIRY statement */\n \n #include \"io.h\"\n+#include \"unix.h\"\n \n \n static const char undefined[] = \"UNDEFINED\";"}, {"sha": "9428b759d1518e5598f4cf3dc4dde39a83644e3e", "filename": "libgfortran/io/intrinsics.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fintrinsics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fintrinsics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fintrinsics.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -24,6 +24,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"unix.h\"\n \n #ifdef HAVE_STDLIB_H\n #include <stdlib.h>"}, {"sha": "b24f81026f063059543d26e9a68fa83dca909cd5", "filename": "libgfortran/io/io.h", "status": "modified", "additions": 7, "deletions": 281, "changes": 288, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fio.h?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -42,63 +42,13 @@ typedef enum\n }\n bt;\n \n+/* Forward declarations.  */\n struct st_parameter_dt;\n-\n-typedef struct stream\n-{\n-  ssize_t (*read) (struct stream *, void *, ssize_t);\n-  ssize_t (*write) (struct stream *, const void *, ssize_t);\n-  off_t (*seek) (struct stream *, off_t, int);\n-  off_t (*tell) (struct stream *);\n-  /* Avoid keyword truncate due to AIX namespace collision.  */\n-  int (*trunc) (struct stream *, off_t);\n-  int (*flush) (struct stream *);\n-  int (*close) (struct stream *);\n-}\n-stream;\n-\n-/* Inline functions for doing file I/O given a stream.  */\n-static inline ssize_t\n-sread (stream * s, void * buf, ssize_t nbyte)\n-{\n-  return s->read (s, buf, nbyte);\n-}\n-\n-static inline ssize_t\n-swrite (stream * s, const void * buf, ssize_t nbyte)\n-{\n-  return s->write (s, buf, nbyte);\n-}\n-\n-static inline off_t\n-sseek (stream * s, off_t offset, int whence)\n-{\n-  return s->seek (s, offset, whence);\n-}\n-\n-static inline off_t\n-stell (stream * s)\n-{\n-  return s->tell (s);\n-}\n-\n-static inline int\n-struncate (stream * s, off_t length)\n-{\n-  return s->trunc (s, length);\n-}\n-\n-static inline int\n-sflush (stream * s)\n-{\n-  return s->flush (s);\n-}\n-\n-static inline int\n-sclose (stream * s)\n-{\n-  return s->close (s);\n-}\n+typedef struct stream stream;\n+struct fbuf;\n+struct format_data;\n+typedef struct fnode fnode;\n+struct gfc_unit;\n \n \n /* Macros for testing what kinds of I/O we are doing.  */\n@@ -131,7 +81,7 @@ array_loop_spec;\n \n /* A stucture to build a hash table for format data.  */\n \n-#define FORMAT_HASH_SIZE 16 \n+#define FORMAT_HASH_SIZE 16\n \n typedef struct format_hash_entry\n {\n@@ -386,8 +336,6 @@ typedef struct\n }\n st_parameter_inquire;\n \n-struct gfc_unit;\n-struct format_data;\n \n #define IOPARM_DT_LIST_FORMAT\t\t\t(1 << 7)\n #define IOPARM_DT_NAMELIST_READ_MODE\t\t(1 << 8)\n@@ -564,24 +512,6 @@ typedef struct\n unit_flags;\n \n \n-/* Formatting buffer. This is a temporary scratch buffer. Currently used only\n-   by formatted writes. After every\n-   formatted write statement, this buffer is flushed. This buffer is needed since\n-   not all devices are seekable, and T or TL edit descriptors require \n-   moving backwards in the record.  However, advance='no' complicates the\n-   situation, so the buffer must only be partially flushed from the end of the\n-   last flush until the current position in the record. */\n-\n-typedef struct fbuf\n-{\n-  char *buf;\t\t\t/* Start of buffer.  */\n-  int len;\t\t\t/* Length of buffer.  */\n-  int act;\t\t\t/* Active bytes in buffer.  */\n-  int pos;\t\t\t/* Current position in buffer.  */\n-}\n-fbuf;\n-\n-\n typedef struct gfc_unit\n {\n   int unit_number;\n@@ -645,152 +575,6 @@ typedef struct gfc_unit\n }\n gfc_unit;\n \n-/* Format tokens.  Only about half of these can be stored in the\n-   format nodes.  */\n-\n-typedef enum\n-{\n-  FMT_NONE = 0, FMT_UNKNOWN, FMT_SIGNED_INT, FMT_ZERO, FMT_POSINT, FMT_PERIOD,\n-  FMT_COMMA, FMT_COLON, FMT_SLASH, FMT_DOLLAR, FMT_T, FMT_TR, FMT_TL,\n-  FMT_LPAREN, FMT_RPAREN, FMT_X, FMT_S, FMT_SS, FMT_SP, FMT_STRING,\n-  FMT_BADSTRING, FMT_P, FMT_I, FMT_B, FMT_BN, FMT_BZ, FMT_O, FMT_Z, FMT_F,\n-  FMT_E, FMT_EN, FMT_ES, FMT_G, FMT_L, FMT_A, FMT_D, FMT_H, FMT_END, FMT_DC,\n-  FMT_DP, FMT_STAR, FMT_RC, FMT_RD, FMT_RN, FMT_RP, FMT_RU, FMT_RZ\n-}\n-format_token;\n-\n-\n-/* Format nodes.  A format string is converted into a tree of these\n-   structures, which is traversed as part of a data transfer statement.  */\n-\n-typedef struct fnode\n-{\n-  format_token format;\n-  int repeat;\n-  struct fnode *next;\n-  char *source;\n-\n-  union\n-  {\n-    struct\n-    {\n-      int w, d, e;\n-    }\n-    real;\n-\n-    struct\n-    {\n-      int length;\n-      char *p;\n-    }\n-    string;\n-\n-    struct\n-    {\n-      int w, m;\n-    }\n-    integer;\n-\n-    int w;\n-    int k;\n-    int r;\n-    int n;\n-\n-    struct fnode *child;\n-  }\n-  u;\n-\n-  /* Members for traversing the tree during data transfer.  */\n-\n-  int count;\n-  struct fnode *current;\n-\n-}\n-fnode;\n-\n-\n-/* unix.c */\n-\n-extern int compare_files (stream *, stream *);\n-internal_proto(compare_files);\n-\n-extern stream *open_external (st_parameter_open *, unit_flags *);\n-internal_proto(open_external);\n-\n-extern stream *open_internal (char *, int, gfc_offset);\n-internal_proto(open_internal);\n-\n-extern char * mem_alloc_w (stream *, int *);\n-internal_proto(mem_alloc_w);\n-\n-extern char * mem_alloc_r (stream *, int *);\n-internal_proto(mem_alloc_w);\n-\n-extern stream *input_stream (void);\n-internal_proto(input_stream);\n-\n-extern stream *output_stream (void);\n-internal_proto(output_stream);\n-\n-extern stream *error_stream (void);\n-internal_proto(error_stream);\n-\n-extern int compare_file_filename (gfc_unit *, const char *, int);\n-internal_proto(compare_file_filename);\n-\n-extern gfc_unit *find_file (const char *file, gfc_charlen_type file_len);\n-internal_proto(find_file);\n-\n-extern int delete_file (gfc_unit *);\n-internal_proto(delete_file);\n-\n-extern int file_exists (const char *file, gfc_charlen_type file_len);\n-internal_proto(file_exists);\n-\n-extern const char *inquire_sequential (const char *, int);\n-internal_proto(inquire_sequential);\n-\n-extern const char *inquire_direct (const char *, int);\n-internal_proto(inquire_direct);\n-\n-extern const char *inquire_formatted (const char *, int);\n-internal_proto(inquire_formatted);\n-\n-extern const char *inquire_unformatted (const char *, int);\n-internal_proto(inquire_unformatted);\n-\n-extern const char *inquire_read (const char *, int);\n-internal_proto(inquire_read);\n-\n-extern const char *inquire_write (const char *, int);\n-internal_proto(inquire_write);\n-\n-extern const char *inquire_readwrite (const char *, int);\n-internal_proto(inquire_readwrite);\n-\n-extern gfc_offset file_length (stream *);\n-internal_proto(file_length);\n-\n-extern int is_seekable (stream *);\n-internal_proto(is_seekable);\n-\n-extern int is_special (stream *);\n-internal_proto(is_special);\n-\n-extern void flush_if_preconnected (stream *);\n-internal_proto(flush_if_preconnected);\n-\n-extern void empty_internal_buffer(stream *);\n-internal_proto(empty_internal_buffer);\n-\n-extern int stream_isatty (stream *);\n-internal_proto(stream_isatty);\n-\n-extern char * stream_ttyname (stream *);\n-internal_proto(stream_ttyname);\n-\n-extern int unpack_filename (char *, const char *, int);\n-internal_proto(unpack_filename);\n \n /* unit.c */\n \n@@ -847,31 +631,6 @@ internal_proto(get_unique_unit_number);\n extern gfc_unit *new_unit (st_parameter_open *, gfc_unit *, unit_flags *);\n internal_proto(new_unit);\n \n-/* format.c */\n-\n-extern void parse_format (st_parameter_dt *);\n-internal_proto(parse_format);\n-\n-extern const fnode *next_format (st_parameter_dt *);\n-internal_proto(next_format);\n-\n-extern void unget_format (st_parameter_dt *, const fnode *);\n-internal_proto(unget_format);\n-\n-extern void format_error (st_parameter_dt *, const fnode *, const char *);\n-internal_proto(format_error);\n-\n-extern void free_format_data (struct format_data *);\n-internal_proto(free_format_data);\n-\n-extern void free_format_hash_table (gfc_unit *);\n-internal_proto(free_format_hash_table);\n-\n-extern void init_format_hash (st_parameter_dt *);\n-internal_proto(init_format_hash);\n-\n-extern void free_format_hash (st_parameter_dt *);\n-internal_proto(free_format_hash);\n \n /* transfer.c */\n \n@@ -1014,39 +773,6 @@ internal_proto(size_from_real_kind);\n extern size_t size_from_complex_kind (int);\n internal_proto(size_from_complex_kind);\n \n-/* fbuf.c */\n-extern void fbuf_init (gfc_unit *, int);\n-internal_proto(fbuf_init);\n-\n-extern void fbuf_destroy (gfc_unit *);\n-internal_proto(fbuf_destroy);\n-\n-extern int fbuf_reset (gfc_unit *);\n-internal_proto(fbuf_reset);\n-\n-extern char * fbuf_alloc (gfc_unit *, int);\n-internal_proto(fbuf_alloc);\n-\n-extern int fbuf_flush (gfc_unit *, unit_mode);\n-internal_proto(fbuf_flush);\n-\n-extern int fbuf_seek (gfc_unit *, int, int);\n-internal_proto(fbuf_seek);\n-\n-extern char * fbuf_read (gfc_unit *, int *);\n-internal_proto(fbuf_read);\n-\n-/* Never call this function, only use fbuf_getc().  */\n-extern int fbuf_getc_refill (gfc_unit *);\n-internal_proto(fbuf_getc_refill);\n-\n-static inline int\n-fbuf_getc (gfc_unit * u)\n-{\n-  if (u->fbuf->pos < u->fbuf->act)\n-    return (unsigned char) u->fbuf->buf[u->fbuf->pos++];\n-  return fbuf_getc_refill (u);\n-}\n \n /* lock.c */\n extern void free_ionml (st_parameter_dt *);"}, {"sha": "c281e34eacfbe6510561ba914651dd80c14937f6", "filename": "libgfortran/io/list_read.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Flist_read.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Flist_read.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Flist_read.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -27,6 +27,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n \n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"unix.h\"\n #include <string.h>\n #include <stdlib.h>\n #include <ctype.h>"}, {"sha": "bca21062956a54c1d029bc7d28bb20ec5722edb8", "filename": "libgfortran/io/open.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fopen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fopen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fopen.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -25,6 +25,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"unix.h\"\n #include <unistd.h>\n #include <string.h>\n #include <errno.h>"}, {"sha": "a5cb97a00e571a186441581958afa32711a1adb2", "filename": "libgfortran/io/read.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fread.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fread.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fread.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -24,6 +24,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"format.h\"\n #include <string.h>\n #include <errno.h>\n #include <ctype.h>"}, {"sha": "b5f52b1ccf38811f7025d4c79a0a24daff6461ab", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -29,6 +29,9 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n /* transfer.c -- Top level handling of data transfer statements.  */\n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"format.h\"\n+#include \"unix.h\"\n #include <string.h>\n #include <assert.h>\n #include <stdlib.h>"}, {"sha": "3eb66e9d26d9eec42e29dd5a54f3be3dd4d5bd2b", "filename": "libgfortran/io/unit.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Funit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Funit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funit.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -24,6 +24,9 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"fbuf.h\"\n+#include \"format.h\"\n+#include \"unix.h\"\n #include <stdlib.h>\n #include <string.h>\n "}, {"sha": "d385b040c9e08de64e2cb07cd96f2d2e3ac76cc9", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -27,6 +27,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n /* Unix stream I/O module */\n \n #include \"io.h\"\n+#include \"unix.h\"\n #include <stdlib.h>\n #include <limits.h>\n "}, {"sha": "63482461cc28f0152e7bf83ec83b4f2508a10e6d", "filename": "libgfortran/io/write.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fwrite.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/92cbdb684563b23b5832c84bb331fe6386955cee/libgfortran%2Fio%2Fwrite.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fwrite.c?ref=92cbdb684563b23b5832c84bb331fe6386955cee", "patch": "@@ -26,6 +26,8 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n <http://www.gnu.org/licenses/>.  */\n \n #include \"io.h\"\n+#include \"format.h\"\n+#include \"unix.h\"\n #include <assert.h>\n #include <string.h>\n #include <ctype.h>"}]}