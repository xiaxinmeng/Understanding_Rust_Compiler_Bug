{"sha": "48b155b991003487a50ac171ba5ca7c3409ad417", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDhiMTU1Yjk5MTAwMzQ4N2E1MGFjMTcxYmE1Y2E3YzM0MDlhZDQxNw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2011-08-06T15:19:45Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2011-08-06T15:19:45Z"}, "message": "re PR fortran/50004 (ICE in c_ptr_tests_16.f90)\n\n2011-08-06  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/50004\n\t* target-memory.c (gfc_target_expr-size): Don't clobber typespec\n\tfor derived types.\n\t* simplify.c (gfc_simplify_transfer): Don't calculate source_size\n\ttwice.\n\nFrom-SVN: r177527", "tree": {"sha": "6da2f43976711f93fd4853c2e6a054b5b832db02", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6da2f43976711f93fd4853c2e6a054b5b832db02"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/48b155b991003487a50ac171ba5ca7c3409ad417", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48b155b991003487a50ac171ba5ca7c3409ad417", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48b155b991003487a50ac171ba5ca7c3409ad417", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48b155b991003487a50ac171ba5ca7c3409ad417/comments", "author": null, "committer": null, "parents": [{"sha": "cc3801b0e64026be57b2987d23d3f7c0c97bff2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc3801b0e64026be57b2987d23d3f7c0c97bff2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc3801b0e64026be57b2987d23d3f7c0c97bff2d"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "81eec356b502b5254d89d1275c9c7ef6d42c452b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48b155b991003487a50ac171ba5ca7c3409ad417/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48b155b991003487a50ac171ba5ca7c3409ad417/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=48b155b991003487a50ac171ba5ca7c3409ad417", "patch": "@@ -1,3 +1,11 @@\n+2011-08-06  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/50004\n+\t* target-memory.c (gfc_target_expr-size): Don't clobber typespec\n+\tfor derived types.\n+\t* simplify.c (gfc_simplify_transfer): Don't calculate source_size\n+\ttwice.\n+\n 2011-08-05  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/37211"}, {"sha": "13a9c5147c0dd824d040d1624ade486af11454c7", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48b155b991003487a50ac171ba5ca7c3409ad417/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48b155b991003487a50ac171ba5ca7c3409ad417/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=48b155b991003487a50ac171ba5ca7c3409ad417", "patch": "@@ -6048,8 +6048,6 @@ gfc_simplify_transfer (gfc_expr *source, gfc_expr *mold, gfc_expr *size)\n       && gfc_array_size (source, &tmp) == FAILURE)\n     gfc_internal_error (\"Failure getting length of a constant array.\");\n \n-  source_size = gfc_target_expr_size (source);\n-\n   /* Create an empty new expression with the appropriate characteristics.  */\n   result = gfc_get_constant_expr (mold->ts.type, mold->ts.kind,\n \t\t\t\t  &source->where);"}, {"sha": "63878959b47e39fd4b1e2117eb59d556ce6ec96f", "filename": "gcc/fortran/target-memory.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48b155b991003487a50ac171ba5ca7c3409ad417/gcc%2Ffortran%2Ftarget-memory.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48b155b991003487a50ac171ba5ca7c3409ad417/gcc%2Ffortran%2Ftarget-memory.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftarget-memory.c?ref=48b155b991003487a50ac171ba5ca7c3409ad417", "patch": "@@ -120,8 +120,14 @@ gfc_target_expr_size (gfc_expr *e)\n     case BT_HOLLERITH:\n       return e->representation.length;\n     case BT_DERIVED:\n-      type = gfc_typenode_for_spec (&e->ts);\n-      return int_size_in_bytes (type);\n+      {\n+\t/* Determine type size without clobbering the typespec for ISO C\n+\t   binding types.  */\n+\tgfc_typespec ts;\n+\tts = e->ts;\n+\ttype = gfc_typenode_for_spec (&ts);\n+\treturn int_size_in_bytes (type);\n+      }\n     default:\n       gfc_internal_error (\"Invalid expression in gfc_target_expr_size.\");\n       return 0;"}]}