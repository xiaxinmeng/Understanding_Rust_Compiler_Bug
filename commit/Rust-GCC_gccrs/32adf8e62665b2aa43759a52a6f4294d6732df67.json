{"sha": "32adf8e62665b2aa43759a52a6f4294d6732df67", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzJhZGY4ZTYyNjY1YjJhYTQzNzU5YTUyYTZmNDI5NGQ2NzMyZGY2Nw==", "commit": {"author": {"name": "Andrew Haley", "email": "aph@cygnus.com", "date": "2000-05-02T13:50:25Z"}, "committer": {"name": "Andrew Haley", "email": "aph@gcc.gnu.org", "date": "2000-05-02T13:50:25Z"}, "message": "ia64.c (ia64_encode_section_info): Handle the case where this function is called for the second time on a decl...\n\n2000-05-02  Andrew Haley  <aph@cygnus.com>\n\n        * config/ia64/ia64.c (ia64_encode_section_info): Handle the case\n        where this function is called for the second time on a decl that\n        has had its section info changed in such a way as to move it out\n        of small data/bss.\n        * config/ia64/ia64.h (REDO_SECTION_INFO_P): New definition.\n\nFrom-SVN: r33609", "tree": {"sha": "f8c421a8d25e49c0698bd09fbe180cb5ac803679", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8c421a8d25e49c0698bd09fbe180cb5ac803679"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/32adf8e62665b2aa43759a52a6f4294d6732df67", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32adf8e62665b2aa43759a52a6f4294d6732df67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32adf8e62665b2aa43759a52a6f4294d6732df67", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32adf8e62665b2aa43759a52a6f4294d6732df67/comments", "author": null, "committer": null, "parents": [{"sha": "2b84225632bc28bd72c0a2bbd30a3cf21716f3b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b84225632bc28bd72c0a2bbd30a3cf21716f3b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b84225632bc28bd72c0a2bbd30a3cf21716f3b2"}], "stats": {"total": 36, "additions": 35, "deletions": 1}, "files": [{"sha": "369e05815c47fd7ad2340db418e8835ff874c445", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/32adf8e62665b2aa43759a52a6f4294d6732df67/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/32adf8e62665b2aa43759a52a6f4294d6732df67/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=32adf8e62665b2aa43759a52a6f4294d6732df67", "patch": "@@ -1,3 +1,11 @@\n+2000-05-02  Andrew Haley  <aph@cygnus.com>\n+\n+\t* config/ia64/ia64.c (ia64_encode_section_info): Handle the case\n+\twhere this function is called for the second time on a decl that\n+\thas had its section info changed in such a way as to move it out\n+\tof small data/bss.  \n+\t* config/ia64/ia64.h (REDO_SECTION_INFO_P): New definition.\n+\n 2000-05-01  Richard Henderson  <rth@cygnus.com>\n \n \t* ifcvt.c (dead_or_predicable): Set merge_bb->end to the insn before"}, {"sha": "f5af6546208fd8c1a63a40ecc485c97423494858", "filename": "gcc/config/ia64/ia64.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/32adf8e62665b2aa43759a52a6f4294d6732df67/gcc%2Fconfig%2Fia64%2Fia64.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/32adf8e62665b2aa43759a52a6f4294d6732df67/gcc%2Fconfig%2Fia64%2Fia64.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fia64%2Fia64.c?ref=32adf8e62665b2aa43759a52a6f4294d6732df67", "patch": "@@ -2786,6 +2786,7 @@ ia64_encode_section_info (decl)\n   else if (! TARGET_NO_SDATA\n \t   && TREE_CODE (decl) == VAR_DECL\n \t   && TREE_STATIC (decl)\n+\t   && ! (DECL_ONE_ONLY (decl) || DECL_WEAK (decl))\n \t   && ! (TREE_PUBLIC (decl)\n \t\t && (flag_pic\n \t\t     || (DECL_COMMON (decl)\n@@ -2813,7 +2814,8 @@ ia64_encode_section_info (decl)\n \n       /* If this is an incomplete type with size 0, then we can't put it in\n \t sdata because it might be too big when completed.  */\n-      else if (size > 0 && size <= ia64_section_threshold)\n+      else if (size > 0 && size <= ia64_section_threshold\n+\t       && str[0] != SDATA_NAME_FLAG_CHAR)\n \t{\n \t  int len = strlen (str);\n \t  char *newstr = obstack_alloc (saveable_obstack, len + 2);\n@@ -2822,6 +2824,21 @@ ia64_encode_section_info (decl)\n \t  *newstr = SDATA_NAME_FLAG_CHAR;\n \t  XSTR (XEXP (DECL_RTL (decl), 0), 0) = newstr;\n \t}\n+    }\t    \n+  /* This decl is marked as being in small data/bss but it shouldn't\n+     be; one likely explanation for this is that the decl has been\n+     moved into a different section from the one it was in when\n+     ENCODE_SECTION_INFO was first called.  Remove the '@'.*/\n+  else if (TREE_CODE (decl) == VAR_DECL\n+\t   && (XSTR (XEXP (DECL_RTL (decl), 0), 0)[0] \n+\t       == SDATA_NAME_FLAG_CHAR))\n+    {\n+      char *str = XSTR (XEXP (DECL_RTL (decl), 0), 0);\n+      int len = strlen (str);\n+      char *newstr = obstack_alloc (saveable_obstack, len);\n+\n+      strcpy (newstr, str + 1);\n+      XSTR (XEXP (DECL_RTL (decl), 0), 0) = newstr;\n     }\n }\n \f"}, {"sha": "163f983190d1b2adbd2073265f55e0295bfee11b", "filename": "gcc/config/ia64/ia64.h", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/32adf8e62665b2aa43759a52a6f4294d6732df67/gcc%2Fconfig%2Fia64%2Fia64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/32adf8e62665b2aa43759a52a6f4294d6732df67/gcc%2Fconfig%2Fia64%2Fia64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fia64%2Fia64.h?ref=32adf8e62665b2aa43759a52a6f4294d6732df67", "patch": "@@ -1978,6 +1978,15 @@ do {\t\t\t\t\t\t\t\t\t\\\n \n #define ENCODE_SECTION_INFO(DECL) ia64_encode_section_info (DECL)\n \n+/* If a variable is weakened, made one only or moved into a different\n+   section, it may be necessary to redo the section info to move the\n+   variable out of sdata. */\n+\n+#define REDO_SECTION_INFO_P(DECL)\t\t\t\t\t\\\n+   ((TREE_CODE (DECL) == VAR_DECL)\t\t\t\t\t\\\n+    && (DECL_ONE_ONLY (decl) || DECL_WEAK (decl) || DECL_COMMON (decl)\t\\\n+\t|| DECL_SECTION_NAME (decl) != 0))\n+\n #define SDATA_NAME_FLAG_CHAR '@'\n \n #define IA64_DEFAULT_GVALUE 8"}]}