{"sha": "036b5ad136407a9a399ee4dc7d33067e0d95672e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDM2YjVhZDEzNjQwN2E5YTM5OWVlNGRjN2QzMzA2N2UwZDk1NjcyZQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-04-27T14:01:09Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-04-27T14:01:09Z"}, "message": "[C++ PATCH] cleanup 2\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-04/msg01231.html\n\t* typeck.c (convert_ptrmem): Move local var decls to initialization.\n\nFrom-SVN: r259710", "tree": {"sha": "20205b876ea4b4d7816d9fefb794b8f5154ad66e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/20205b876ea4b4d7816d9fefb794b8f5154ad66e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/036b5ad136407a9a399ee4dc7d33067e0d95672e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/036b5ad136407a9a399ee4dc7d33067e0d95672e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/036b5ad136407a9a399ee4dc7d33067e0d95672e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/036b5ad136407a9a399ee4dc7d33067e0d95672e/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3db18011e5c9f4060dc9cba1440056b2e0de2c00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3db18011e5c9f4060dc9cba1440056b2e0de2c00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3db18011e5c9f4060dc9cba1440056b2e0de2c00"}], "stats": {"total": 32, "additions": 14, "deletions": 18}, "files": [{"sha": "149262c4786745ef4b267682f98d08cb8b385400", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/036b5ad136407a9a399ee4dc7d33067e0d95672e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/036b5ad136407a9a399ee4dc7d33067e0d95672e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=036b5ad136407a9a399ee4dc7d33067e0d95672e", "patch": "@@ -1,5 +1,7 @@\n 2018-04-27  Nathan Sidwell  <nathan@acm.org>\n \n+\t* typeck.c (convert_ptrmem): Move local var decls to initialization.\n+\n \t* cp-tree.h (TEMPLATE_INFO): Fix comments.\n \t(TI_PENDING_TEMPLATE_FLAG): Check TEMPLATE_INFO.\n \t(NON_DEFAULT_TEMPLATE_ARG_COUNT): Wrap line."}, {"sha": "24a206a2511af370faa15ad352a8416a8e081b06", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 12, "deletions": 18, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/036b5ad136407a9a399ee4dc7d33067e0d95672e/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/036b5ad136407a9a399ee4dc7d33067e0d95672e/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=036b5ad136407a9a399ee4dc7d33067e0d95672e", "patch": "@@ -6833,34 +6833,28 @@ convert_ptrmem (tree type, tree expr, bool allow_inverse_p,\n \n   if (TYPE_PTRDATAMEM_P (type))\n     {\n-      tree delta;\n+      tree delta = (get_delta_difference\n+\t\t    (TYPE_PTRMEM_CLASS_TYPE (TREE_TYPE (expr)),\n+\t\t     TYPE_PTRMEM_CLASS_TYPE (type),\n+\t\t     allow_inverse_p, c_cast_p, complain));\n \n-      delta = get_delta_difference (TYPE_PTRMEM_CLASS_TYPE (TREE_TYPE (expr)),\n-\t\t\t\t    TYPE_PTRMEM_CLASS_TYPE (type),\n-\t\t\t\t    allow_inverse_p,\n-\t\t\t\t    c_cast_p, complain);\n       if (delta == error_mark_node)\n \treturn error_mark_node;\n \n       if (!integer_zerop (delta))\n \t{\n-\t  tree cond, op1, op2;\n-\n \t  if (TREE_CODE (expr) == PTRMEM_CST)\n \t    expr = cplus_expand_constant (expr);\n-\t  cond = cp_build_binary_op (input_location,\n-\t\t\t\t     EQ_EXPR,\n-\t\t\t\t     expr,\n-\t\t\t\t     build_int_cst (TREE_TYPE (expr), -1),\n-\t\t\t\t     complain);\n-\t  op1 = build_nop (ptrdiff_type_node, expr);\n-\t  op2 = cp_build_binary_op (input_location,\n-\t\t\t\t    PLUS_EXPR, op1, delta,\n-\t\t\t\t    complain);\n+\n+\t  tree cond = cp_build_binary_op (input_location, EQ_EXPR, expr,\n+\t\t\t\t\t  build_int_cst (TREE_TYPE (expr), -1),\n+\t\t\t\t\t  complain);\n+\t  tree op1 = build_nop (ptrdiff_type_node, expr);\n+\t  tree op2 = cp_build_binary_op (input_location, PLUS_EXPR, op1, delta,\n+\t\t\t\t\t complain);\n \n \t  expr = fold_build3_loc (input_location,\n-\t\t\t      COND_EXPR, ptrdiff_type_node, cond, op1, op2);\n-\t\t\t \n+\t\t\t\t  COND_EXPR, ptrdiff_type_node, cond, op1, op2);\n \t}\n \n       return build_nop (type, expr);"}]}