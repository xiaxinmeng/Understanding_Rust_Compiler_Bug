{"sha": "f3ff72939e52a381d28f3c4879f2eaa1d154ff73", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjNmZjcyOTM5ZTUyYTM4MWQyOGYzYzQ4NzlmMmVhYTFkMTU0ZmY3Mw==", "commit": {"author": {"name": "Dmitriy Anisimkov", "email": "anisimko@adacore.com", "date": "2021-05-18T05:03:31Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-07-07T16:23:12Z"}, "message": "[Ada] Add socket options to control keepalive on TCP connection\n\ngcc/ada/\n\n\t* libgnat/g-socket.ads (Option_Name): Add Keep_Alive_Count,\n\tKeep_Alive_Idle, and Keep_Alive_Interval items to enumeration.\n\t(Option_Type): Add Keep_Alive_Count, Keep_Alive_Idle, and\n\tKeep_Alive_Interval alternatives to the case of discriminated\n\trecord.\n\t* libgnat/g-socket.adb (Options): Add Keep_Alive_Count,\n\tKeep_Alive_Idle, and Keep_Alive_Interval to items enumerator to\n\tOS constant converter.\n\t(Set_Socket_Option): Process Keep_Alive_Count, Keep_Alive_Idle,\n\tand Keep_Alive_Interval socket options.\n\t(Get_Socket_Option): Idem.", "tree": {"sha": "ca226ec60e920afb3b26a143d70d67bee623c98e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ca226ec60e920afb3b26a143d70d67bee623c98e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f3ff72939e52a381d28f3c4879f2eaa1d154ff73", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3ff72939e52a381d28f3c4879f2eaa1d154ff73", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f3ff72939e52a381d28f3c4879f2eaa1d154ff73", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3ff72939e52a381d28f3c4879f2eaa1d154ff73/comments", "author": {"login": "anisimkov", "id": 15864134, "node_id": "MDQ6VXNlcjE1ODY0MTM0", "avatar_url": "https://avatars.githubusercontent.com/u/15864134?v=4", "gravatar_id": "", "url": "https://api.github.com/users/anisimkov", "html_url": "https://github.com/anisimkov", "followers_url": "https://api.github.com/users/anisimkov/followers", "following_url": "https://api.github.com/users/anisimkov/following{/other_user}", "gists_url": "https://api.github.com/users/anisimkov/gists{/gist_id}", "starred_url": "https://api.github.com/users/anisimkov/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/anisimkov/subscriptions", "organizations_url": "https://api.github.com/users/anisimkov/orgs", "repos_url": "https://api.github.com/users/anisimkov/repos", "events_url": "https://api.github.com/users/anisimkov/events{/privacy}", "received_events_url": "https://api.github.com/users/anisimkov/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f8776eeb3613b557cea367f01d7d1b6b2fe9d33b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f8776eeb3613b557cea367f01d7d1b6b2fe9d33b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f8776eeb3613b557cea367f01d7d1b6b2fe9d33b"}], "stats": {"total": 76, "additions": 62, "deletions": 14}, "files": [{"sha": "a246303cb66c27bfd2be68983b8ee21518ae0c46", "filename": "gcc/ada/libgnat/g-socket.adb", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3ff72939e52a381d28f3c4879f2eaa1d154ff73/gcc%2Fada%2Flibgnat%2Fg-socket.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3ff72939e52a381d28f3c4879f2eaa1d154ff73/gcc%2Fada%2Flibgnat%2Fg-socket.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fg-socket.adb?ref=f3ff72939e52a381d28f3c4879f2eaa1d154ff73", "patch": "@@ -96,6 +96,9 @@ package body GNAT.Sockets is\n \n    Options : constant array (Specific_Option_Name) of C.int :=\n                (Keep_Alive          => SOSC.SO_KEEPALIVE,\n+                Keep_Alive_Count    => SOSC.TCP_KEEPCNT,\n+                Keep_Alive_Idle     => SOSC.TCP_KEEPIDLE,\n+                Keep_Alive_Interval => SOSC.TCP_KEEPINTVL,\n                 Reuse_Address       => SOSC.SO_REUSEADDR,\n                 Broadcast           => SOSC.SO_BROADCAST,\n                 Send_Buffer         => SOSC.SO_SNDBUF,\n@@ -1442,6 +1445,9 @@ package body GNAT.Sockets is\n             | Error\n             | Generic_Option\n             | Keep_Alive\n+            | Keep_Alive_Count\n+            | Keep_Alive_Idle\n+            | Keep_Alive_Interval\n             | Multicast_If_V4\n             | Multicast_If_V6\n             | Multicast_Loop_V4\n@@ -1511,6 +1517,15 @@ package body GNAT.Sockets is\n          =>\n             Opt.Enabled := (V4 /= 0);\n \n+         when Keep_Alive_Count =>\n+            Opt.Count := Natural (V4);\n+\n+         when Keep_Alive_Idle =>\n+            Opt.Idle_Seconds := Natural (V4);\n+\n+         when Keep_Alive_Interval =>\n+            Opt.Interval_Seconds := Natural (V4);\n+\n          when Busy_Polling =>\n             Opt.Microseconds := Natural (V4);\n \n@@ -2620,6 +2635,21 @@ package body GNAT.Sockets is\n             Len := V4'Size / 8;\n             Add := V4'Address;\n \n+         when Keep_Alive_Count =>\n+            V4  := C.int (Option.Count);\n+            Len := V4'Size / 8;\n+            Add := V4'Address;\n+\n+         when Keep_Alive_Idle =>\n+            V4  := C.int (Option.Idle_Seconds);\n+            Len := V4'Size / 8;\n+            Add := V4'Address;\n+\n+         when Keep_Alive_Interval =>\n+            V4  := C.int (Option.Interval_Seconds);\n+            Len := V4'Size / 8;\n+            Add := V4'Address;\n+\n          when Busy_Polling =>\n             V4  := C.int (Option.Microseconds);\n             Len := V4'Size / 8;"}, {"sha": "4372f3eace78ee9482a6f5ca6638bc1a6cf83718", "filename": "gcc/ada/libgnat/g-socket.ads", "status": "modified", "additions": 32, "deletions": 14, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f3ff72939e52a381d28f3c4879f2eaa1d154ff73/gcc%2Fada%2Flibgnat%2Fg-socket.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f3ff72939e52a381d28f3c4879f2eaa1d154ff73/gcc%2Fada%2Flibgnat%2Fg-socket.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flibgnat%2Fg-socket.ads?ref=f3ff72939e52a381d28f3c4879f2eaa1d154ff73", "patch": "@@ -845,11 +845,20 @@ package GNAT.Sockets is\n       -- IP_Protocol_For_TCP_Level --\n       -------------------------------\n \n-      No_Delay, -- TCP_NODELAY\n+      No_Delay,            -- TCP_NODELAY\n       --  Disable the Nagle algorithm. This means that output buffer content\n       --  is always sent as soon as possible, even if there is only a small\n       --  amount of data.\n \n+      Keep_Alive_Count,    -- TCP_KEEPCNT\n+      --  Maximum number of keepalive probes\n+\n+      Keep_Alive_Idle,     -- TCP_KEEPIDLE\n+      --  Idle time before TCP starts sending keepalive probes\n+\n+      Keep_Alive_Interval, -- TCP_KEEPINTVL\n+      --  Time between individual keepalive probes\n+\n       ------------------------------\n       -- IP_Protocol_For_IP_Level --\n       ------------------------------\n@@ -923,26 +932,35 @@ package GNAT.Sockets is\n             Enabled : Boolean;\n \n             case Name is\n-               when Linger    =>\n+               when Linger =>\n                   Seconds : Natural;\n-               when others    =>\n+               when others =>\n                   null;\n             end case;\n \n-         when Busy_Polling    =>\n+         when Keep_Alive_Count    =>\n+            Count : Natural;\n+\n+         when Keep_Alive_Idle     =>\n+            Idle_Seconds : Natural;\n+\n+         when Keep_Alive_Interval =>\n+            Interval_Seconds : Natural;\n+\n+         when Busy_Polling        =>\n             Microseconds : Natural;\n \n-         when Send_Buffer     |\n-              Receive_Buffer  =>\n+         when Send_Buffer         |\n+              Receive_Buffer      =>\n             Size : Natural;\n \n-         when Error           =>\n+         when Error               =>\n             Error : Error_Type;\n \n-         when Add_Membership_V4  |\n-              Add_Membership_V6  |\n-              Drop_Membership_V4 |\n-              Drop_Membership_V6 =>\n+         when Add_Membership_V4   |\n+              Add_Membership_V6   |\n+              Drop_Membership_V4  |\n+              Drop_Membership_V6  =>\n             Multicast_Address : Inet_Addr_Type;\n             case Name is\n                when Add_Membership_V4  |\n@@ -958,13 +976,13 @@ package GNAT.Sockets is\n          when Multicast_If_V6 =>\n             Outgoing_If_Index : Natural;\n \n-         when Multicast_TTL  =>\n+         when Multicast_TTL   =>\n             Time_To_Live : Natural;\n \n-         when Multicast_Hops =>\n+         when Multicast_Hops  =>\n             Hop_Limit : Integer range -1 .. 255;\n \n-         when Send_Timeout |\n+         when Send_Timeout    |\n               Receive_Timeout =>\n             Timeout : Timeval_Duration;\n "}]}