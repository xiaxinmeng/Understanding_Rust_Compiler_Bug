{"sha": "6e4da08400087856425b00d401d0232cbe1bb729", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmU0ZGEwODQwMDA4Nzg1NjQyNWIwMGQ0MDFkMDIzMmNiZTFiYjcyOQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2010-07-06T11:44:34Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2010-07-06T11:44:34Z"}, "message": "gimple-fold.c (gimple_fold_obj_type_ref_known_binfo): Check that function is still available to fold into.\n\n\t* gimple-fold.c (gimple_fold_obj_type_ref_known_binfo): Check that\n\tfunction is still available to fold into.\n\nFrom-SVN: r161866", "tree": {"sha": "f61a95301d024ed9b39eeb35adfa978e722ded91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f61a95301d024ed9b39eeb35adfa978e722ded91"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6e4da08400087856425b00d401d0232cbe1bb729", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e4da08400087856425b00d401d0232cbe1bb729", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e4da08400087856425b00d401d0232cbe1bb729", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e4da08400087856425b00d401d0232cbe1bb729/comments", "author": null, "committer": null, "parents": [{"sha": "ebeb2c24db1596f623b3b421f9172deea0d35194", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebeb2c24db1596f623b3b421f9172deea0d35194", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ebeb2c24db1596f623b3b421f9172deea0d35194"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "59455aac58a09b1f41c58f369cb970f68f142b72", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4da08400087856425b00d401d0232cbe1bb729/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4da08400087856425b00d401d0232cbe1bb729/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6e4da08400087856425b00d401d0232cbe1bb729", "patch": "@@ -1,3 +1,8 @@\n+2010-07-05  Jan Hubicka  <jh@suse.cz>\n+\n+\t* gimple-fold.c (gimple_fold_obj_type_ref_known_binfo): Check that\n+\tfunction is still available to fold into.\n+\n 2010-07-05  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* vec.h (FOR_EACH_VEC_ELT_REVERSE): New macro."}, {"sha": "659102b988bd5d6a521b4dd29c86b3223798ef7f", "filename": "gcc/gimple-fold.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6e4da08400087856425b00d401d0232cbe1bb729/gcc%2Fgimple-fold.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6e4da08400087856425b00d401d0232cbe1bb729/gcc%2Fgimple-fold.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-fold.c?ref=6e4da08400087856425b00d401d0232cbe1bb729", "patch": "@@ -1156,7 +1156,7 @@ gimple_fold_builtin (gimple stmt)\n               fold_convert (TREE_TYPE (gimple_call_lhs (stmt)), val[0]);\n \n \t  /* If the result is not a valid gimple value, or not a cast\n-\t     of a valid gimple value, then we can not use the result.  */\n+\t     of a valid gimple value, then we cannot use the result.  */\n \t  if (is_gimple_val (new_val)\n \t      || (is_gimple_cast (new_val)\n \t\t  && is_gimple_val (TREE_OPERAND (new_val, 0))))\n@@ -1351,6 +1351,7 @@ gimple_fold_obj_type_ref_known_binfo (HOST_WIDE_INT token, tree known_binfo)\n {\n   HOST_WIDE_INT i;\n   tree v, fndecl;\n+  struct cgraph_node *node;\n \n   v = BINFO_VIRTUALS (known_binfo);\n   i = 0;\n@@ -1362,6 +1363,14 @@ gimple_fold_obj_type_ref_known_binfo (HOST_WIDE_INT token, tree known_binfo)\n     }\n \n   fndecl = TREE_VALUE (v);\n+  node = cgraph_get_node (fndecl);\n+  /* When cgraph node is missing and function is not public, we cannot\n+     devirtualize.  This can happen in WHOPR when the actual method\n+     ends up in other partition, because we found devirtualization\n+     possibility too late.  */\n+  if ((!node || !node->analyzed)\n+      && (!TREE_PUBLIC (fndecl) || DECL_COMDAT (fndecl)))\n+    return NULL;\n   return build_fold_addr_expr (fndecl);\n }\n "}]}