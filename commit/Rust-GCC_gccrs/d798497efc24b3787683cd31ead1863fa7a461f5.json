{"sha": "d798497efc24b3787683cd31ead1863fa7a461f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDc5ODQ5N2VmYzI0YjM3ODc2ODNjZDMxZWFkMTg2M2ZhN2E0NjFmNQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-02-08T08:30:48Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-02-08T08:30:48Z"}, "message": "re PR tree-optimization/71824 (ICE when compiling libiberty with Graphite loop optimizations)\n\n2017-02-08  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/71824\n\t* graphite-scop-detection.c (scop_detection::build_scop_breadth):\n\tCheck all loops contained in the merged region.\n\n\t* gcc.dg/graphite/pr71824-2.c: New testcase.\n\nFrom-SVN: r245270", "tree": {"sha": "e67e19eeba496fbeca4050cfa440bcc25e72fd05", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e67e19eeba496fbeca4050cfa440bcc25e72fd05"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d798497efc24b3787683cd31ead1863fa7a461f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d798497efc24b3787683cd31ead1863fa7a461f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d798497efc24b3787683cd31ead1863fa7a461f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d798497efc24b3787683cd31ead1863fa7a461f5/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "41cf3f3eb91e46b1465715053791612a1a1d482d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41cf3f3eb91e46b1465715053791612a1a1d482d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41cf3f3eb91e46b1465715053791612a1a1d482d"}], "stats": {"total": 61, "additions": 58, "deletions": 3}, "files": [{"sha": "1b518e68aed7bc99aadaf8a4cdc7ab9c2ecaf776", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d798497efc24b3787683cd31ead1863fa7a461f5", "patch": "@@ -1,3 +1,9 @@\n+2017-02-08  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/71824\n+\t* graphite-scop-detection.c (scop_detection::build_scop_breadth):\n+\tCheck all loops contained in the merged region.\n+\n 2017-02-07  Andrew Pinski  <apinski@cavium.com>\n \n \t* config/aarch64/aarch64.md (popcount<mode>2): New pattern."}, {"sha": "ee1f705b4902dd2e696273aa66d0f3b59c5757be", "filename": "gcc/graphite-scop-detection.c", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2Fgraphite-scop-detection.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2Fgraphite-scop-detection.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-scop-detection.c?ref=d798497efc24b3787683cd31ead1863fa7a461f5", "patch": "@@ -905,9 +905,19 @@ scop_detection::build_scop_breadth (sese_l s1, loop_p loop)\n \n   sese_l combined = merge_sese (s1, s2);\n \n-  if (combined\n-      && loop_is_valid_in_scop (loop, combined)\n-      && loop_is_valid_in_scop (loop->next, combined))\n+  /* Combining adjacent loops may add unrelated loops into the\n+     region so we have to check all sub-loops of the outer loop\n+     that are in the combined region.  */\n+  if (combined)\n+    for (l = loop_outer (loop)->inner; l; l = l->next)\n+      if (bb_in_sese_p (l->header, combined)\n+\t  && ! loop_is_valid_in_scop (l, combined))\n+\t{\n+\t  combined = invalid_sese;\n+\t  break;\n+\t}\n+\n+  if (combined)\n     s1 = combined;\n   else\n     add_scop (s2);"}, {"sha": "260a3a57b60d8895a5bdb68976e0bbd006d4c90f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d798497efc24b3787683cd31ead1863fa7a461f5", "patch": "@@ -1,3 +1,8 @@\n+2017-02-08  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/71824\n+\t* gcc.dg/graphite/pr71824-2.c: New testcase.\n+\n 2017-02-07  Andrew Pinski  <apinski@cavium.com>\n \n \t* gcc.target/aarch64/popcount.c : New Testcase."}, {"sha": "18176568d4aa4f4c5f8dc475203bdd70abfa65cb", "filename": "gcc/testsuite/gcc.dg/graphite/pr71824-2.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr71824-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d798497efc24b3787683cd31ead1863fa7a461f5/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr71824-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgraphite%2Fpr71824-2.c?ref=d798497efc24b3787683cd31ead1863fa7a461f5", "patch": "@@ -0,0 +1,34 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -floop-nest-optimize\" } */\n+\n+typedef struct { float x1; } bx;\n+typedef struct {\n+    int w;\n+    short o;\n+} T2P;\n+T2P a;\n+int b;\n+void fn2();\n+void fn3(bx*,short);\n+void fn1() {\n+    unsigned i = 0;\n+    int c;\n+    bx *d;\n+    bx **h;\n+    if (b == 0) {\n+\tfn2();\n+\treturn;\n+    }\n+    for (; c; c++)\n+      for (; i < 100; i++) {\n+\t  d = h[i];\n+\t  d->x1 = a.w;\n+      }\n+    for (; i < 100; i++) {\n+\td = h[i];\n+\td->x1 = a.w;\n+    }\n+    if (a.o)\n+      for (; b;)\n+\tfn3(d, a.o);\n+}"}]}