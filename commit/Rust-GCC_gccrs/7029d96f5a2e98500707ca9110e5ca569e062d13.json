{"sha": "7029d96f5a2e98500707ca9110e5ca569e062d13", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzAyOWQ5NmY1YTJlOTg1MDA3MDdjYTkxMTBlNWNhNTY5ZTA2MmQxMw==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2019-07-01T13:37:37Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-01T13:37:37Z"}, "message": "[Ada] More permissive use of GNAT attribute Enum_Rep\n\nThis patch allows the prefix of the attribute Enum_Rep to be an\nattribute referece (such as Enum_Type'First). A recent patch had\nrestricted the prefix to be an object of a discrete type, which is\nincompatible with orevious usage.\n\n2019-07-01  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_attr.adb (Analyze_Attribute, case Enum_Rep): Allow prefix\n\tof attribute to be an attribute reference of a discrete type.\n\ngcc/testsuite/\n\n\t* gnat.dg/enum_rep.adb, gnat.dg/enum_rep.ads: New testcase.\n\nFrom-SVN: r272881", "tree": {"sha": "323960aced50decdff1836f6ea1433a9e077e220", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/323960aced50decdff1836f6ea1433a9e077e220"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7029d96f5a2e98500707ca9110e5ca569e062d13", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7029d96f5a2e98500707ca9110e5ca569e062d13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7029d96f5a2e98500707ca9110e5ca569e062d13", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7029d96f5a2e98500707ca9110e5ca569e062d13/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8b9aa1a98fd194ab8fad3f54e232172fd857f077", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b9aa1a98fd194ab8fad3f54e232172fd857f077", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b9aa1a98fd194ab8fad3f54e232172fd857f077"}], "stats": {"total": 44, "additions": 41, "deletions": 3}, "files": [{"sha": "63ed0d8a0a48d53d3fb955bedc344c81d3a36cf3", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=7029d96f5a2e98500707ca9110e5ca569e062d13", "patch": "@@ -1,3 +1,8 @@\n+2019-07-01  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_attr.adb (Analyze_Attribute, case Enum_Rep): Allow prefix\n+\tof attribute to be an attribute reference of a discrete type.\n+\n 2019-07-01  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* sem_ch12.adb (Analyze_Subprogram_Instantiation): Move up"}, {"sha": "bdc76c3b200f0a78602c9cde8ab482f500f31a1f", "filename": "gcc/ada/sem_attr.adb", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Fada%2Fsem_attr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Fada%2Fsem_attr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_attr.adb?ref=7029d96f5a2e98500707ca9110e5ca569e062d13", "patch": "@@ -3833,14 +3833,16 @@ package body Sem_Attr is\n             Check_Discrete_Type;\n             Resolve (E1, P_Base_Type);\n \n-         --  X'Enum_Rep case. X must be an object or enumeration literal, and\n-         --  it must be of a discrete type.\n+         --  X'Enum_Rep case. X must be an object or enumeration literal\n+         --  (including an attribute reference), and it must be of a\n+         --  discrete type.\n \n          elsif not\n            ((Is_Object_Reference (P)\n                or else\n                  (Is_Entity_Name (P)\n-                    and then Ekind (Entity (P)) = E_Enumeration_Literal))\n+                    and then Ekind (Entity (P)) = E_Enumeration_Literal)\n+               or else Nkind (P) = N_Attribute_Reference)\n              and then Is_Discrete_Type (Etype (P)))\n          then\n             Error_Attr_P (\"prefix of % attribute must be discrete object\");"}, {"sha": "8af44998ba6f49f8b21a1c80924b6ecb67c67396", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7029d96f5a2e98500707ca9110e5ca569e062d13", "patch": "@@ -1,3 +1,7 @@\n+2019-07-01  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* gnat.dg/enum_rep.adb, gnat.dg/enum_rep.ads: New testcase.\n+\n 2019-07-01  Ed Schonberg  <schonberg@adacore.com>\n \n \t* gnat.dg/derived_type6.adb, gnat.dg/derived_type6.ads: New"}, {"sha": "4b13078cd5a05dd5e7a313954db92c561b681e93", "filename": "gcc/testsuite/gnat.dg/enum_rep.adb", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Ftestsuite%2Fgnat.dg%2Fenum_rep.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Ftestsuite%2Fgnat.dg%2Fenum_rep.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fenum_rep.adb?ref=7029d96f5a2e98500707ca9110e5ca569e062d13", "patch": "@@ -0,0 +1,5 @@\n+--  { dg-do compile }\n+\n+package body Enum_Rep is\n+   procedure Foo is null;\n+end;"}, {"sha": "acf282c2da9c7153028b4b2ad54e3ee86bc0ead8", "filename": "gcc/testsuite/gnat.dg/enum_rep.ads", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Ftestsuite%2Fgnat.dg%2Fenum_rep.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7029d96f5a2e98500707ca9110e5ca569e062d13/gcc%2Ftestsuite%2Fgnat.dg%2Fenum_rep.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fenum_rep.ads?ref=7029d96f5a2e98500707ca9110e5ca569e062d13", "patch": "@@ -0,0 +1,22 @@\n+with Interfaces;\n+\n+package Enum_Rep is\n+\n+   type My_Type is range 00 .. 100;\n+\n+   subtype My_Subtype2 is Interfaces.Unsigned_32\n+        range My_Type'First'Enum_Rep .. My_Type'Last'Enum_Rep;\n+\n+   My_Type_First : constant My_Type :=  My_Type'First;\n+   My_Type_Last : constant My_Type :=  My_Type'Last;\n+\n+   subtype My_Subtype is Interfaces.Unsigned_32\n+         range My_Type_First'Enum_Rep .. My_Type_Last'Enum_Rep;\n+\n+   subtype My_Subtype1 is Interfaces.Unsigned_32\n+        range My_Type'Enum_Rep (My_Type'First) ..\n+               My_Type'Enum_Rep (MY_Type'Last);\n+\n+   procedure Foo;\n+\n+end;"}]}