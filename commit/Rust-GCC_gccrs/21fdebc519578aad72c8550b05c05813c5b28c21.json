{"sha": "21fdebc519578aad72c8550b05c05813c5b28c21", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjFmZGViYzUxOTU3OGFhZDcyYzg1NTBiMDVjMDU4MTNjNWIyOGMyMQ==", "commit": {"author": {"name": "David Edelsohn", "email": "dje.gcc@gmail.com", "date": "2020-09-16T18:56:00Z"}, "committer": {"name": "David Edelsohn", "email": "dje.gcc@gmail.com", "date": "2020-09-17T14:18:32Z"}, "message": "aix: apply socket.h extern \"C++\" more narrowly.\n\nRecent Technology Levels of AIX 7.2 have made sys/socket.h more C++-aware,\nwhich causes the fix to be applied in too many locations.  This patch adds\nmore context for the selection to apply the fix more narrowly.\n\nfixincludes/ChangeLog:\n\n2020-09-17  David Edelsohn  <dje.gcc@gmail.com>\n\n\t* inclhack.def (aix_externcpp1): Add more context to select.\n\t(aix_externcpp2): Same.\n\t* fixincl.x: Regenerate.\n\t* tests/base/sys/socket.h: Update expected results.", "tree": {"sha": "83333f5e15a717362e6226aa6a1d1a0f0b6f190d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/83333f5e15a717362e6226aa6a1d1a0f0b6f190d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/21fdebc519578aad72c8550b05c05813c5b28c21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21fdebc519578aad72c8550b05c05813c5b28c21", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21fdebc519578aad72c8550b05c05813c5b28c21", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21fdebc519578aad72c8550b05c05813c5b28c21/comments", "author": {"login": "edelsohn", "id": 667700, "node_id": "MDQ6VXNlcjY2NzcwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/667700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edelsohn", "html_url": "https://github.com/edelsohn", "followers_url": "https://api.github.com/users/edelsohn/followers", "following_url": "https://api.github.com/users/edelsohn/following{/other_user}", "gists_url": "https://api.github.com/users/edelsohn/gists{/gist_id}", "starred_url": "https://api.github.com/users/edelsohn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edelsohn/subscriptions", "organizations_url": "https://api.github.com/users/edelsohn/orgs", "repos_url": "https://api.github.com/users/edelsohn/repos", "events_url": "https://api.github.com/users/edelsohn/events{/privacy}", "received_events_url": "https://api.github.com/users/edelsohn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "edelsohn", "id": 667700, "node_id": "MDQ6VXNlcjY2NzcwMA==", "avatar_url": "https://avatars.githubusercontent.com/u/667700?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edelsohn", "html_url": "https://github.com/edelsohn", "followers_url": "https://api.github.com/users/edelsohn/followers", "following_url": "https://api.github.com/users/edelsohn/following{/other_user}", "gists_url": "https://api.github.com/users/edelsohn/gists{/gist_id}", "starred_url": "https://api.github.com/users/edelsohn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edelsohn/subscriptions", "organizations_url": "https://api.github.com/users/edelsohn/orgs", "repos_url": "https://api.github.com/users/edelsohn/repos", "events_url": "https://api.github.com/users/edelsohn/events{/privacy}", "received_events_url": "https://api.github.com/users/edelsohn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b28b621ac67beee81a47adb50b954bcf751570fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b28b621ac67beee81a47adb50b954bcf751570fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b28b621ac67beee81a47adb50b954bcf751570fd"}], "stats": {"total": 38, "additions": 24, "deletions": 14}, "files": [{"sha": "bf54305b9c01574d0f5ca65e688ae4d0fb8ecf89", "filename": "fixincludes/fixincl.x", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21fdebc519578aad72c8550b05c05813c5b28c21/fixincludes%2Ffixincl.x", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21fdebc519578aad72c8550b05c05813c5b28c21/fixincludes%2Ffixincl.x", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/fixincludes%2Ffixincl.x?ref=21fdebc519578aad72c8550b05c05813c5b28c21", "patch": "@@ -2,11 +2,11 @@\n  *\n  * DO NOT EDIT THIS FILE   (fixincl.x)\n  *\n- * It has been AutoGen-ed  January 25, 2020 at 12:15:43 PM by AutoGen 5.18.16\n+ * It has been AutoGen-ed  September 16, 2020 at 06:34:57 PM by AutoGen 5.18\n  * From the definitions    inclhack.def\n  * and the template file   fixincl\n  */\n-/* DO NOT SVN-MERGE THIS FILE, EITHER Sat Jan 25 12:15:43 EST 2020\n+/* DO NOT SVN-MERGE THIS FILE, EITHER Wed Sep 16 18:34:57 UTC 2020\n  *\n  * You must regenerate it.  Use the ./genfixes script.\n  *\n@@ -826,7 +826,8 @@ tSCC* apzAix_Externcpp1Machs[] = {\n  *  content selection pattern - do fix if pattern found\n  */\n tSCC zAix_Externcpp1Select0[] =\n-       \"#ifdef __cplusplus\";\n+       \"#ifndef _KERNEL\\n\\\n+#ifdef __cplusplus\";\n \n #define    AIX_EXTERNCPP1_TEST_CT  1\n static tTestDesc aAix_Externcpp1Tests[] = {\n@@ -837,7 +838,8 @@ static tTestDesc aAix_Externcpp1Tests[] = {\n  */\n static const char* apzAix_Externcpp1Patch[] = {\n     \"format\",\n-    \"#ifdef __cplusplus\\n\\\n+    \"#ifndef _KERNEL\\n\\\n+#ifdef __cplusplus\\n\\\n extern \\\"C++\\\" {\",\n     (char*)NULL };\n \n@@ -864,7 +866,8 @@ tSCC* apzAix_Externcpp2Machs[] = {\n  *  content selection pattern - do fix if pattern found\n  */\n tSCC zAix_Externcpp2Select0[] =\n-       \"#else  /\\\\* __cplusplus \\\\*/\";\n+       \"#endif /\\\\* COMPAT_43 \\\\*/\\n\\\n+#else  /\\\\* __cplusplus \\\\*/\";\n \n #define    AIX_EXTERNCPP2_TEST_CT  1\n static tTestDesc aAix_Externcpp2Tests[] = {\n@@ -875,7 +878,8 @@ static tTestDesc aAix_Externcpp2Tests[] = {\n  */\n static const char* apzAix_Externcpp2Patch[] = {\n     \"format\",\n-    \"} /* extern \\\"C++\\\" */\\n\\\n+    \"#endif /* COMPAT_43 */\\n\\\n+} /* extern \\\"C++\\\" */\\n\\\n #else  /* __cplusplus */\",\n     (char*)NULL };\n "}, {"sha": "3b397422bc1a00dcdc77eb63b14cc94875c283dc", "filename": "fixincludes/inclhack.def", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21fdebc519578aad72c8550b05c05813c5b28c21/fixincludes%2Finclhack.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21fdebc519578aad72c8550b05c05813c5b28c21/fixincludes%2Finclhack.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/fixincludes%2Finclhack.def?ref=21fdebc519578aad72c8550b05c05813c5b28c21", "patch": "@@ -553,24 +553,28 @@ fix = {\n   hackname  = aix_externcpp1;\n   mach      = \"*-*-aix*\";\n   files     = \"sys/socket.h\";\n-  select    = \"#ifdef __cplusplus\";\n+  select    = \"#ifndef _KERNEL\\n\"\n+\t      \"#ifdef __cplusplus\";\n   c_fix     = format;\n-  c_fix_arg = \"#ifdef __cplusplus\\n\"\n+  c_fix_arg = \"#ifndef _KERNEL\\n\"\n+\t      \"#ifdef __cplusplus\\n\"\n               \"extern \\\"C++\\\" {\";\n-  test_text = \"#ifdef __cplusplus\";\n-\n+  test_text = \"#ifndef _KERNEL\\n\"\n+\t      \"#ifdef __cplusplus\";\n };\n \n fix = {\n   hackname  = aix_externcpp2;\n   mach      = \"*-*-aix*\";\n   files     = \"sys/socket.h\";\n-  select    = \"#else  /\\\\* __cplusplus \\\\*/\";\n+  select    = \"#endif /\\\\* COMPAT_43 \\\\*/\\n\"\n+\t      \"#else  /\\\\* __cplusplus \\\\*/\";\n   c_fix     = format;\n-  c_fix_arg = \"} /* extern \\\"C++\\\" */\\n\"\n+  c_fix_arg = \"#endif /* COMPAT_43 */\\n\"\n+\t      \"} /* extern \\\"C++\\\" */\\n\"\n               \"#else  /* __cplusplus */\";\n-  test_text = \"#else  /* __cplusplus */\";\n-\n+  test_text = \"#endif /* COMPAT_43 */\\n\"\n+\t      \"#else  /* __cplusplus */\";\n };\n \n /*"}, {"sha": "c1e2b425be15fff7b7007a8e2d2a2075e1027867", "filename": "fixincludes/tests/base/sys/socket.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/21fdebc519578aad72c8550b05c05813c5b28c21/fixincludes%2Ftests%2Fbase%2Fsys%2Fsocket.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/21fdebc519578aad72c8550b05c05813c5b28c21/fixincludes%2Ftests%2Fbase%2Fsys%2Fsocket.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/fixincludes%2Ftests%2Fbase%2Fsys%2Fsocket.h?ref=21fdebc519578aad72c8550b05c05813c5b28c21", "patch": "@@ -10,12 +10,14 @@\n \n \n #if defined( AIX_EXTERNCPP1_CHECK )\n+#ifndef _KERNEL\n #ifdef __cplusplus\n extern \"C++\" {\n #endif  /* AIX_EXTERNCPP1_CHECK */\n \n \n #if defined( AIX_EXTERNCPP2_CHECK )\n+#endif /* COMPAT_43 */\n } /* extern \"C++\" */\n #else  /* __cplusplus */\n #endif  /* AIX_EXTERNCPP2_CHECK */"}]}