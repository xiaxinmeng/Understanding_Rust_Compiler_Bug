{"sha": "60ae021df56b05cea7e9026e8b5e14975476c0fb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjBhZTAyMWRmNTZiMDVjZWE3ZTkwMjZlOGI1ZTE0OTc1NDc2YzBmYg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2003-10-28T14:18:34Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2003-10-28T14:18:34Z"}, "message": "Change output to be more cpliant with dejagnu framework.\n\nCreate acats.sum and acats.log files under testsuite/ada/acats\n\nFrom-SVN: r73005", "tree": {"sha": "87893a8a53fa95c67b0823d48d09d5d88bfa3d98", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/87893a8a53fa95c67b0823d48d09d5d88bfa3d98"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/60ae021df56b05cea7e9026e8b5e14975476c0fb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60ae021df56b05cea7e9026e8b5e14975476c0fb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/60ae021df56b05cea7e9026e8b5e14975476c0fb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/60ae021df56b05cea7e9026e8b5e14975476c0fb/comments", "author": null, "committer": null, "parents": [{"sha": "cc27f5a21c617db50383a01aa04bcf87b24a6bfa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc27f5a21c617db50383a01aa04bcf87b24a6bfa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc27f5a21c617db50383a01aa04bcf87b24a6bfa"}], "stats": {"total": 87, "additions": 47, "deletions": 40}, "files": [{"sha": "b63af81e1e30006a296df38261547dce21aeaa7b", "filename": "gcc/testsuite/ada/acats/run_all.sh", "status": "modified", "additions": 47, "deletions": 40, "changes": 87, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/60ae021df56b05cea7e9026e8b5e14975476c0fb/gcc%2Ftestsuite%2Fada%2Facats%2Frun_all.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/60ae021df56b05cea7e9026e8b5e14975476c0fb/gcc%2Ftestsuite%2Fada%2Facats%2Frun_all.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fada%2Facats%2Frun_all.sh?ref=60ae021df56b05cea7e9026e8b5e14975476c0fb", "patch": "@@ -18,6 +18,18 @@ $*\n \n # End of customization section.\n \n+display_noeol () {\n+  printf \"$@\"\n+  printf \"$@\" >> $dir/acats.sum\n+  printf \"$@\" >> $dir/acats.log\n+}\n+\n+display () {\n+  echo \"$@\"\n+  echo \"$@\" >> $dir/acats.sum\n+  echo \"$@\" >> $dir/acats.log\n+}\n+\n dir=`pwd`\n \n if [ \"$testdir\" = \"\" ]; then\n@@ -45,21 +57,20 @@ clean_dir () {\n EXTERNAL_OBJECTS=\"\"\n # Global variable to communicate external objects to link with.\n \n-echo \"\"\n-echo ==== CONFIGURATION ==== `date`\n+rm -f $dir/acats.sum $dir/acats.log\n+\n+display \"\t=== CONFIGURATION ===\"\n \n-type gcc\n-gcc -v 2>&1\n-echo host=`host_gcc -dumpmachine`\n-echo target=`gcc -dumpmachine`\n-type gnatmake\n-gnatls -v\n-echo acats src=$testdir\n-echo acats obj=$dir\n-echo \"\"\n+display `type gcc`\n+display `gcc -v 2>&1`\n+display host=`host_gcc -dumpmachine`\n+display target=`gcc -dumpmachine`\n+display `type gnatmake`\n+gnatls -v >> $dir/acats.log\n+display \"\"\n \n-echo ==== SUPPORT ==== `date`\n-printf \"Generating support files...\"\n+display \"\t=== SUPPORT ===\"\n+display_noeol \"Generating support files...\"\n \n rm -rf $dir/support\n mkdir -p $dir/support\n@@ -93,30 +104,30 @@ done\n \n host_gnatmake -q -gnatws macrosub\n if [ $? -ne 0 ]; then\n-   echo \"**** Failed to compile macrosub\"\n+   display \"**** Failed to compile macrosub\"\n    exit 1\n fi\n ./macrosub > macrosub.out 2>&1\n \n host_gcc -c cd300051.c\n host_gnatmake -q -gnatws widechr\n if [ $? -ne 0 ]; then\n-   echo \"**** Failed to compile widechr\"\n+   display \"**** Failed to compile widechr\"\n    exit 1\n fi\n ./widechr > widechr.out 2>&1\n \n rm -f $dir/support/{macrosub,widechr,*.ali,*.o}\n \n-echo \" done.\"\n+display \" done.\"\n \n # From here, all compilations will be made by the target compiler\n \n-printf \"Compiling support files...\"\n+display_noeol \"Compiling support files...\"\n \n target_gcc -c *.c\n if [ $? -ne 0 ]; then\n-   echo \"**** Failed to compile C code\"\n+   display \"**** Failed to compile C code\"\n    exit 1\n fi\n \n@@ -125,9 +136,9 @@ gnatchop *.adt > gnatchop.out 2>&1\n target_gnatmake -c -gnato -gnatE *.ads > /dev/null 2>&1\n target_gnatmake -c -gnato -gnatE *.adb\n \n-echo \" done.\"\n-echo \"\"\n-echo ==== TESTS ==== `date`\n+display \" done.\"\n+display \"\"\n+display \"\t=== ACATS tests ===\"\n \n if [ $# -eq 0 ]; then\n    chapters=`cd $dir/tests; echo *`\n@@ -139,11 +150,11 @@ glob_countn=0\n glob_countok=0\n \n for chapter in $chapters; do\n-   echo ==== CHAPTER $chapter ==== `date`\n+   display Running chapter $chapter ...\n \n    if [ ! -d $dir/tests/$chapter ]; then\n-      echo \"**** CHAPTER $chapter does not exist, skipping.\"\n-      echo \"\"\n+      display \"*** CHAPTER $chapter does not exist, skipping.\"\n+      display \"\"\n       continue\n    fi\n \n@@ -156,9 +167,6 @@ for chapter in $chapters; do\n    counti=0\n    for i in `cat $dir/tests/$chapter/${chapter}.lst`; do \n       counti=`expr $counti + 1`\n-      echo \"\"\n-      echo \"\" \n-      echo ==== $i === `date` === $counti / $countn\n       extraflags=\"\"\n       grep $i $testdir/overflow.lst > /dev/null 2>&1\n       if [ $? -eq 0 ]; then\n@@ -176,7 +184,7 @@ for chapter in $chapters; do\n       ls ${i}.adb >> ${i}.lst 2> /dev/null\n       main=`tail -1 ${i}.lst`\n       binmain=`echo $main | sed -e 's/\\(.*\\)\\..*/\\1/g'`\n-      echo \"BUILD $main\"\n+      echo \"BUILD $main\" >> $dir/acats.log\n       EXTERNAL_OBJECTS=\"\"\n       case $i in\n         cxb30*) EXTERNAL_OBJECTS=\"$dir/support/cxb30040.o $dir/support/cxb30060.o $dir/support/cxb30130.o $dir/support/cxb30131.o\";;\n@@ -185,47 +193,46 @@ for chapter in $chapters; do\n         cxh1001) extraflags=\"-a -f\"; echo \"pragma Normalize_Scalars;\" > gnat.adc\n       esac\n       if [ \"$main\" = \"\" ]; then\n-         echo \"**** SCRIPT-MAIN FAILED $i\"\n+         display \"FAIL:\t$i\"\n          failed=\"${failed}${i} \"\n          clean_dir\n          continue\n       fi\n \n       target_gnatmake $extraflags -I$dir/support $main\n       if [ $? -ne 0 ]; then\n-         echo \"**** SCRIPT-BUILD FAILED $i\"\n+         display \"FAIL:\t$i\"\n          failed=\"${failed}${i} \"\n          clean_dir\n          continue\n       fi\n \n-      echo \"RUN $binmain\"\n+      echo \"RUN $binmain\" >> $dir/acats.log\n       cd $dir/run\n-      target_run $dir/tests/$chapter/$i/$binmain | tee $dir/tests/$chapter/$i/${i}.log 2>&1\n+      target_run $dir/tests/$chapter/$i/$binmain > $dir/tests/$chapter/$i/${i}.log 2>&1\n       cd $dir/tests/$chapter/$i\n+      cat ${i}.log >> $dir/acats.log\n       egrep -e '(==== |\\+\\+\\+\\+ |\\!\\!\\!\\! )' ${i}.log > /dev/null 2>&1\n       if [ $? -ne 0 ]; then\n-         echo \"**** SCRIPT-RUN FAILED $i\"\n+         display \"FAIL:\t$i\"\n          failed=\"${failed}${i} \"\n       else\n+         display \"PASS:\t$i\"\n          countok=`expr $countok + 1`\n       fi\n       clean_dir\n    done\n \n-   echo \"\"\n-   echo ==== CHAPTER $chapter results: $countok / $countn\n-   echo \"\"\n    glob_countok=`expr $glob_countok + $countok`\n    glob_countn=`expr $glob_countn + $countn`\n done\n \n-echo ==== ACATS results: $glob_countok / $glob_countn\n+display \"\t=== ACATS Summary ===\"\n+display \"# of expected passes $glob_countok\"\n+display \"# of unexpected failures `expr $glob_countn - $glob_countok`\"\n \n if [ $glob_countok -ne $glob_countn ]; then\n-   echo \"**** FAILURES: $failed\"\n+   display \"*** FAILURES: $failed\"\n fi\n \n-echo \"#### ACATS done. #### `date`\"\n-\n exit 0"}]}