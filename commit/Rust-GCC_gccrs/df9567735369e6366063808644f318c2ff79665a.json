{"sha": "df9567735369e6366063808644f318c2ff79665a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGY5NTY3NzM1MzY5ZTYzNjYwNjM4MDg2NDRmMzE4YzJmZjc5NjY1YQ==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2005-07-04T13:28:39Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2005-07-04T13:28:39Z"}, "message": "mlib-prj.adb (Auto_Initialize): New constant String\n\n2005-07-04  Vincent Celier  <celier@adacore.com>\n\n\t* mlib-prj.adb (Auto_Initialize): New constant String\n\t(SALs_Use_Constructors): New Boolean function\n\t(Build_Library): Call gnatbind with Auto_Initialize switch when\n\tSALs_Use_Constructors returns True.\n\n\t* mlib-tgt.ads: Minor reformatting\n\n\t* mlib-utl.ads: Minor reformatting\n\n\t* opt.ads: (Use_Pragma_Linker_Constructor): New Boolean flag\n\nFrom-SVN: r101582", "tree": {"sha": "225dcf0a73f36e94043f1f0f435ff2a3189bd7a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/225dcf0a73f36e94043f1f0f435ff2a3189bd7a5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/df9567735369e6366063808644f318c2ff79665a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df9567735369e6366063808644f318c2ff79665a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df9567735369e6366063808644f318c2ff79665a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df9567735369e6366063808644f318c2ff79665a/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f4657cf513a883777da75a8668b3526684f46047", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4657cf513a883777da75a8668b3526684f46047", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f4657cf513a883777da75a8668b3526684f46047"}], "stats": {"total": 54, "additions": 39, "deletions": 15}, "files": [{"sha": "464821ce9336b3a54876842e8d4b0501cd80b68c", "filename": "gcc/ada/mlib-prj.adb", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fmlib-prj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fmlib-prj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-prj.adb?ref=df9567735369e6366063808644f318c2ff79665a", "patch": "@@ -96,6 +96,8 @@ package body MLib.Prj is\n    Compile_Switch_String : aliased String := \"-c\";\n    Compile_Switch : constant String_Access := Compile_Switch_String'Access;\n \n+   Auto_Initialize : constant String := \"-a\";\n+\n    --  List of objects to put inside the library\n \n    Object_Files : Argument_List_Access;\n@@ -241,6 +243,10 @@ package body MLib.Prj is\n    --  Make sure that all the above tables are empty\n    --  (Objects, Foreign_Objects, Ali_Files, Options).\n \n+   function SALs_Use_Constructors return Boolean;\n+   --  Indicate if Stand-Alone Libraries are automatically initialized using\n+   --  the constructor mechanism.\n+\n    ------------------\n    -- Add_Argument --\n    ------------------\n@@ -811,6 +817,10 @@ package body MLib.Prj is\n               (B_Start & Get_Name_String (Data.Library_Name) & \".adb\");\n             Add_Argument (\"-L\" & Get_Name_String (Data.Library_Name));\n \n+            if Data.Lib_Auto_Init and then SALs_Use_Constructors then\n+               Add_Argument (Auto_Initialize);\n+            end if;\n+\n             --  Check if Binder'Default_Switches (\"Ada\") is defined. If it is,\n             --  add these switches to call gnatbind.\n \n@@ -2021,4 +2031,16 @@ package body MLib.Prj is\n       Library_Projs.Init;\n    end Reset_Tables;\n \n+   ---------------------------\n+   -- SALs_Use_Constructors --\n+   ---------------------------\n+\n+   function SALs_Use_Constructors return Boolean is\n+      function C_SALs_Init_Using_Constructors return Integer;\n+      pragma Import (C, C_SALs_Init_Using_Constructors,\n+                     \"__gnat_sals_init_using_constructors\");\n+   begin\n+      return C_SALs_Init_Using_Constructors /= 0;\n+   end SALs_Use_Constructors;\n+\n end MLib.Prj;"}, {"sha": "4e8cd24599fb257faddc7955fc5c9660f2856869", "filename": "gcc/ada/mlib-tgt.ads", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fmlib-tgt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fmlib-tgt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt.ads?ref=df9567735369e6366063808644f318c2ff79665a", "patch": "@@ -27,7 +27,7 @@\n --  This package provides a set of target dependent routines to build\n --  static, dynamic and shared libraries.\n \n---  There are several versions for the body of this package.\n+--  There are several versions for the body of this package\n \n --  In the default version, libraries are not supported, so function\n --  Support_For_Libraries return None.\n@@ -61,11 +61,12 @@ package MLib.Tgt is\n    --  A list of options to invoke the Archive_Builder, usually \"cr\" for \"ar\"\n \n    function Archive_Indexer return String;\n-   --  Returns the name of the program, if any, that generates an index\n-   --  to the contents of an archive, usually \"ranlib\".\n+   --  Returns the name of the program, if any, that generates an index to the\n+   --  contents of an archive, usually \"ranlib\". If there is no archive indexer\n+   --  to be used, returns an empty string.\n \n    function Archive_Indexer_Options return String_List_Access;\n-   --  A list of options to invoke the Archive_Indexer, usually empty.\n+   --  A list of options to invoke the Archive_Indexer, usually empty\n \n    function Dynamic_Option return String;\n    --  gcc option to create a dynamic library."}, {"sha": "bbc895d7e69662e7b0b4f17a337a602eb60fc4e4", "filename": "gcc/ada/mlib-utl.ads", "status": "modified", "additions": 8, "deletions": 11, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fmlib-utl.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fmlib-utl.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-utl.ads?ref=df9567735369e6366063808644f318c2ff79665a", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---            Copyright (C) 2001-2004, Ada Core Technologies, Inc           --\n+--            Copyright (C) 2001-2005, Ada Core Technologies, Inc           --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -29,9 +29,6 @@\n \n package MLib.Utl is\n \n-   No_Argument_List : constant Argument_List := (1 .. 0 => null);\n-   --  Comment needed ???\n-\n    procedure Delete_File (Filename : in String);\n    --  Delete the file Filename\n    --  Why is this different from the standard OS_Lib routine???\n@@ -43,18 +40,18 @@ package MLib.Utl is\n       Options_2   : Argument_List;\n       Driver_Name : Name_Id := No_Name);\n    --  Driver_Name indicates the \"driver\" to invoke; by default, the \"driver\"\n-   --  is gcc.\n-   --  This procedure invokes the driver to create a shared library.\n+   --  is gcc. This procedure invokes the driver to create a shared library.\n    --  Options are passed to gcc before the objects, Options_2 after.\n-   --  Output_File is the name of the library file to create.\n-   --  Objects are the names of the object files to put in the library.\n+   --  Output_File is the name of the library file to create. Objects are the\n+   --  names of the object files to put in the library.\n \n    procedure Ar\n      (Output_File : String;\n       Objects     : Argument_List);\n-   --  Run ar to move all the binaries inside the archive.\n-   --  If ranlib is on the path, run it also.\n-   --  Arguments need documenting ???\n+   --  Run ar to move all the binaries inside the archive. If ranlib is on the\n+   --  path, run it also. Output_File is the path name of the archive to\n+   --  create. Objects is the list of the path names of the object files to be\n+   --  put in the archive.\n \n    function Lib_Directory return String;\n    --  Return the directory containing libgnat"}, {"sha": "a4de938eb9b7c027ab4df661f64fb6f3f0a999ba", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/df9567735369e6366063808644f318c2ff79665a/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=df9567735369e6366063808644f318c2ff79665a", "patch": "@@ -1012,6 +1012,10 @@ package Opt is\n    --  Set to True if -h (-gnath for the compiler) switch encountered\n    --  requesting usage information\n \n+   Use_Pragma_Linker_Constructor : Boolean := False;\n+   --  GNATBIND\n+   --  True if pragma Linker_Constructor applies to adainit\n+\n    Use_VADS_Size : Boolean := False;\n    --  GNAT\n    --  Set to True if a valid pragma Use_VADS_Size is processed"}]}