{"sha": "28462a4496152c76babdb09806762880633191f5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjg0NjJhNDQ5NjE1MmM3NmJhYmRiMDk4MDY3NjI4ODA2MzMxOTFmNQ==", "commit": {"author": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2020-06-16T12:51:34Z"}, "committer": {"name": "Patrick Palka", "email": "ppalka@redhat.com", "date": "2020-06-16T12:51:34Z"}, "message": "c++: TI_DEFERRED_ACCESS_CHECKS and dependent decls\n\nThis adds an assert to enforce_access to verify that we don't defer\naccess checks of dependent decls -- we should instead be rechecking the\naccess of such a decl after tsubst'ing into the user of the decl.\n\ngcc/cp/ChangeLog:\n\n\t* pt.c (perform_instantiation_time_access_checks): No need to\n\ttsubst into decl.\n\t* semantics.c (enforce_access): Verify that decl is not\n\tdependent.", "tree": {"sha": "290c70325c865fc3ec293cce2b280df32d668aca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/290c70325c865fc3ec293cce2b280df32d668aca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/28462a4496152c76babdb09806762880633191f5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28462a4496152c76babdb09806762880633191f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28462a4496152c76babdb09806762880633191f5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28462a4496152c76babdb09806762880633191f5/comments", "author": null, "committer": null, "parents": [{"sha": "668ef28fbb44c1e51d9c5a35b421903c98d87b03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/668ef28fbb44c1e51d9c5a35b421903c98d87b03", "html_url": "https://github.com/Rust-GCC/gccrs/commit/668ef28fbb44c1e51d9c5a35b421903c98d87b03"}], "stats": {"total": 11, "additions": 7, "deletions": 4}, "files": [{"sha": "efc69d5f81c43544c983282dbef625a1cd3ad09f", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 0, "deletions": 4, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28462a4496152c76babdb09806762880633191f5/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28462a4496152c76babdb09806762880633191f5/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=28462a4496152c76babdb09806762880633191f5", "patch": "@@ -11532,10 +11532,6 @@ perform_instantiation_time_access_checks (tree tmpl, tree targs)\n \ttree diag_decl = chk->diag_decl;\n \ttree type_scope = TREE_TYPE (chk->binfo);\n \n-\tif (uses_template_parms (decl)\n-\t    || (TREE_CODE (decl) == FIELD_DECL\n-\t\t&& uses_template_parms (DECL_CONTEXT (decl))))\n-\t  decl = tsubst_copy (decl, targs, tf_error, NULL_TREE);\n \tif (uses_template_parms (type_scope))\n \t  type_scope = tsubst (type_scope, targs, tf_error, NULL_TREE);\n "}, {"sha": "2e65c277542e7dbbacb67528236e54b743dbc3e0", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28462a4496152c76babdb09806762880633191f5/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28462a4496152c76babdb09806762880633191f5/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=28462a4496152c76babdb09806762880633191f5", "patch": "@@ -294,6 +294,13 @@ enforce_access (tree basetype_path, tree decl, tree diag_decl,\n \t     assume it'll be accessible at instantiation time.  */\n \t  return true;\n \n+\t/* Access of a dependent decl should be rechecked after tsubst'ing\n+\t   into the user of the decl, rather than explicitly deferring the\n+\t   check here.  */\n+\tgcc_assert (!uses_template_parms (decl));\n+\tif (TREE_CODE (decl) == FIELD_DECL)\n+\t  gcc_assert (!uses_template_parms (DECL_CONTEXT (decl)));\n+\n \t/* Defer this access check until instantiation time.  */\n \tdeferred_access_check access_check;\n \taccess_check.binfo = basetype_path;"}]}