{"sha": "ab88f3607233376c3145c320e92e71943a495bb5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWI4OGYzNjA3MjMzMzc2YzMxNDVjMzIwZTkyZTcxOTQzYTQ5NWJiNQ==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2021-01-12T01:23:41Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2021-01-12T01:23:41Z"}, "message": "analyzer: fix ICE merging dereferencing unknown ptrs [PR98628]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/98628\n\t* store.cc (binding_cluster::make_unknown_relative_to): Don't mark\n\tdereferenced unknown pointers as having escaped.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/98628\n\t* gcc.dg/analyzer/pr98628.c: New test.", "tree": {"sha": "95414ba8655c1c890bf7eaf910e2ea0a48d84af5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95414ba8655c1c890bf7eaf910e2ea0a48d84af5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ab88f3607233376c3145c320e92e71943a495bb5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab88f3607233376c3145c320e92e71943a495bb5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab88f3607233376c3145c320e92e71943a495bb5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab88f3607233376c3145c320e92e71943a495bb5/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "67fbb7f0fda1fc46253efc31592ffcdda0765098", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67fbb7f0fda1fc46253efc31592ffcdda0765098", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67fbb7f0fda1fc46253efc31592ffcdda0765098"}], "stats": {"total": 26, "additions": 24, "deletions": 2}, "files": [{"sha": "bbd2e7c2d40cac79377094e993960a6d397a7aca", "filename": "gcc/analyzer/store.cc", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab88f3607233376c3145c320e92e71943a495bb5/gcc%2Fanalyzer%2Fstore.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab88f3607233376c3145c320e92e71943a495bb5/gcc%2Fanalyzer%2Fstore.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fstore.cc?ref=ab88f3607233376c3145c320e92e71943a495bb5", "patch": "@@ -1323,8 +1323,11 @@ binding_cluster::make_unknown_relative_to (const binding_cluster *other,\n \t{\n \t  const region *base_reg\n \t    = region_sval->get_pointee ()->get_base_region ();\n-\t  binding_cluster *c = out_store->get_or_create_cluster (base_reg);\n-\t  c->mark_as_escaped ();\n+\t  if (!base_reg->symbolic_for_unknown_ptr_p ())\n+\t    {\n+\t      binding_cluster *c = out_store->get_or_create_cluster (base_reg);\n+\t      c->mark_as_escaped ();\n+\t    }\n \t}\n     }\n }"}, {"sha": "e2fa778472c51715202e40c22c4ed8bf3d351a0f", "filename": "gcc/testsuite/gcc.dg/analyzer/pr98628.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab88f3607233376c3145c320e92e71943a495bb5/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr98628.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab88f3607233376c3145c320e92e71943a495bb5/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr98628.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fpr98628.c?ref=ab88f3607233376c3145c320e92e71943a495bb5", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-additional-options \"-O1\" } */\n+\n+void foo(void *);\n+struct chanset_t help_subst_chan;\n+struct chanset_t *help_subst_chan_0_0;\n+struct chanset_t {\n+  struct chanset_t *next;\n+  char dname[];\n+};\n+void help_subst() {\n+  char *writeidx;\n+  for (;; help_subst_chan = *help_subst_chan_0_0) {\n+    foo(help_subst_chan.next->dname);\n+    if (help_subst_chan_0_0) {\n+      writeidx++;\n+      *writeidx++ = ' ';\n+    }\n+  }\n+}"}]}