{"sha": "8dd00781e17a65c4344681e13f763f8b41880c61", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGRkMDA3ODFlMTdhNjVjNDM0NDY4MWUxM2Y3NjNmOGI0MTg4MGM2MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-08-04T07:40:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-08-04T07:40:24Z"}, "message": "re PR middle-end/49905 (Better sanity checking on sprintf src & dest to produce warning for dodgy code ?)\n\n\tPR middle-end/49905\n\t* tree.h (init_attributes): New prototype.\n\t* attribs.c (init_attributes): No longer static.\n\n\t* decl.c (cxx_init_decl_processing): Add alloc_size (1) attribute\n\tfor operator new and operator new [].  Call init_attributes.\n\n\t* g++.dg/ext/builtin-object-size3.C: New test.\n\nFrom-SVN: r177316", "tree": {"sha": "7fb650606fc204d2c6c911f55570dd8f43df158c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7fb650606fc204d2c6c911f55570dd8f43df158c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8dd00781e17a65c4344681e13f763f8b41880c61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dd00781e17a65c4344681e13f763f8b41880c61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8dd00781e17a65c4344681e13f763f8b41880c61", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dd00781e17a65c4344681e13f763f8b41880c61/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9434c32ec698e22420295be3bccf9d2c91967859", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9434c32ec698e22420295be3bccf9d2c91967859", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9434c32ec698e22420295be3bccf9d2c91967859"}], "stats": {"total": 61, "additions": 57, "deletions": 4}, "files": [{"sha": "03975637f439f680edad1445030f002564cba015", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -1,3 +1,9 @@\n+2011-08-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/49905\n+\t* tree.h (init_attributes): New prototype.\n+\t* attribs.c (init_attributes): No longer static.\n+\n 2011-08-04  Ramana Radhakrishnan  <ramana.radhakrishnan@linaro.org>\n \n \t* config/arm/arm.c (arm_set_fixed_optab_libfunc): Constify"}, {"sha": "9448c0c6beb5bb0cee623fcaec4b452b789a2ab9", "filename": "gcc/attribs.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Fattribs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Fattribs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fattribs.c?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -34,8 +34,6 @@ along with GCC; see the file COPYING3.  If not see\n #include \"hashtab.h\"\n #include \"plugin.h\"\n \n-static void init_attributes (void);\n-\n /* Table of the tables of attributes (common, language, format, machine)\n    searched.  */\n static const struct attribute_spec *attribute_tables[4];\n@@ -107,12 +105,15 @@ eq_attr (const void *p, const void *q)\n /* Initialize attribute tables, and make some sanity checks\n    if --enable-checking.  */\n \n-static void\n+void\n init_attributes (void)\n {\n   size_t i;\n   int k;\n \n+  if (attributes_initialized)\n+    return;\n+\n   attribute_tables[0] = lang_hooks.common_attribute_table;\n   attribute_tables[1] = lang_hooks.attribute_table;\n   attribute_tables[2] = lang_hooks.format_attribute_table;"}, {"sha": "9e2a01d8acda0a2fc479e7e8c213b4fcc1fe9c93", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -1,3 +1,9 @@\n+2011-08-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/49905\n+\t* decl.c (cxx_init_decl_processing): Add alloc_size (1) attribute\n+\tfor operator new and operator new [].  Call init_attributes.\n+\n 2011-08-02  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/43886"}, {"sha": "f0d1a1a326258e5f1b81590155c5b043decc3a4b", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -3629,6 +3629,7 @@ cxx_init_decl_processing (void)\n   current_lang_name = lang_name_cplusplus;\n \n   {\n+    tree newattrs;\n     tree newtype, deltype;\n     tree ptr_ftype_sizetype;\n     tree new_eh_spec;\n@@ -3656,7 +3657,13 @@ cxx_init_decl_processing (void)\n     else\n       new_eh_spec = noexcept_false_spec;\n \n-    newtype = build_exception_variant (ptr_ftype_sizetype, new_eh_spec);\n+    /* Ensure attribs.c is initialized.  */\n+    init_attributes ();\n+    newattrs\n+      = build_tree_list (get_identifier (\"alloc_size\"),\n+\t\t\t build_tree_list (NULL_TREE, integer_one_node));\n+    newtype = cp_build_type_attribute_variant (ptr_ftype_sizetype, newattrs);\n+    newtype = build_exception_variant (newtype, new_eh_spec);\n     deltype = build_exception_variant (void_ftype_ptr, empty_except_spec);\n     push_cp_library_fn (NEW_EXPR, newtype);\n     push_cp_library_fn (VEC_NEW_EXPR, newtype);"}, {"sha": "9565b3e4cfcbd0b0e6e45090fddb3e3f0e377f99", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -1,3 +1,8 @@\n+2011-08-04  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/49905\n+\t* g++.dg/ext/builtin-object-size3.C: New test.\n+\n 2011-08-03  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/49948"}, {"sha": "09263e587196d12e70a3a1f723960f9f92267a16", "filename": "gcc/testsuite/g++.dg/ext/builtin-object-size3.C", "status": "added", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fbuiltin-object-size3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fbuiltin-object-size3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fbuiltin-object-size3.C?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -0,0 +1,26 @@\n+// { dg-do compile }\n+// { dg-options \"-O2\" }\n+\n+void baz (int *, int *);\n+\n+#define MEMCPY(d,s,l) __builtin___memcpy_chk (d, s, l, __builtin_object_size (d, 0))\n+\n+int\n+foo ()\n+{\n+  int *p = new int;\n+  int *q = new int[4];\n+  MEMCPY (p, \"abcdefghijklmnopqrstuvwxyz\", sizeof (int));\n+  MEMCPY (q, \"abcdefghijklmnopqrstuvwxyz\", 4 * sizeof (int));\n+  baz (p, q);\n+}\n+\n+int\n+bar ()\n+{\n+  int *p = new int;\n+  int *q = new int[4];\n+  MEMCPY (p, \"abcdefghijklmnopqrstuvwxyz\", sizeof (int) + 1);\t\t// { dg-warning \"will always overflow destination buffer\" }\n+  MEMCPY (q, \"abcdefghijklmnopqrstuvwxyz\", 4 * sizeof (int) + 1);\t// { dg-warning \"will always overflow destination buffer\" }\n+  baz (p, q);\n+}"}, {"sha": "367c7b92106fd95e49e149776051c17e239b4589", "filename": "gcc/tree.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Ftree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dd00781e17a65c4344681e13f763f8b41880c61/gcc%2Ftree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.h?ref=8dd00781e17a65c4344681e13f763f8b41880c61", "patch": "@@ -5547,6 +5547,8 @@ extern bool must_pass_in_stack_var_size_or_pad (enum machine_mode, const_tree);\n \n extern const struct attribute_spec *lookup_attribute_spec (const_tree);\n \n+extern void init_attributes (void);\n+\n /* Process the attributes listed in ATTRIBUTES and install them in *NODE,\n    which is either a DECL (including a TYPE_DECL) or a TYPE.  If a DECL,\n    it should be modified in place; if a TYPE, a copy should be created"}]}