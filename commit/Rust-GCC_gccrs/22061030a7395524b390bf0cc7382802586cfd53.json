{"sha": "22061030a7395524b390bf0cc7382802586cfd53", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjIwNjEwMzBhNzM5NTUyNGIzOTBiZjBjYzczODI4MDI1ODZjZmQ1Mw==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2010-12-30T11:53:35Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2010-12-30T11:53:35Z"}, "message": "re PR fortran/47085 ([OOP] Problem in allocate( SOURCE=)  for polymorphic component)\n\n2010-12-30  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/47085\n\t* match.c (gfc_match_allocate): Check for 'class_ok'.\n\t* primary.c (gfc_match_varspec): Ditto.\n\n\n2010-12-30  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/47085\n\t* gfortran.dg/allocate_class_1.f90: New.\n\nFrom-SVN: r168340", "tree": {"sha": "bef3e9e1852e6cf04b23e16f4eb7ab3a68eaed6e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bef3e9e1852e6cf04b23e16f4eb7ab3a68eaed6e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/22061030a7395524b390bf0cc7382802586cfd53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22061030a7395524b390bf0cc7382802586cfd53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22061030a7395524b390bf0cc7382802586cfd53", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22061030a7395524b390bf0cc7382802586cfd53/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7831434fbfa750c69867348177e82c752cd69fc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7831434fbfa750c69867348177e82c752cd69fc0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7831434fbfa750c69867348177e82c752cd69fc0"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "d9e91c7dc871a1fad2832b58a9538f3a45f2fac7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=22061030a7395524b390bf0cc7382802586cfd53", "patch": "@@ -1,3 +1,9 @@\n+2010-12-30  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/47085\n+\t* match.c (gfc_match_allocate): Check for 'class_ok'.\n+\t* primary.c (gfc_match_varspec): Ditto.\n+\n 2010-12-29  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \t* dump_parse_tree.c (show_components):  Show"}, {"sha": "a74fdb7fc98d5e7b232394096623a00b10cadb6f", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=22061030a7395524b390bf0cc7382802586cfd53", "patch": "@@ -2956,7 +2956,7 @@ gfc_match_allocate (void)\n       b1 = !(tail->expr->ref\n \t   && (tail->expr->ref->type == REF_COMPONENT\n \t\t|| tail->expr->ref->type == REF_ARRAY));\n-      if (sym && sym->ts.type == BT_CLASS)\n+      if (sym && sym->ts.type == BT_CLASS && sym->attr.class_ok)\n \tb2 = !(CLASS_DATA (sym)->attr.allocatable\n \t       || CLASS_DATA (sym)->attr.class_pointer);\n       else"}, {"sha": "ed85398357aaed129cdcb82caa704e6d3d12dad9", "filename": "gcc/fortran/primary.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ffortran%2Fprimary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ffortran%2Fprimary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fprimary.c?ref=22061030a7395524b390bf0cc7382802586cfd53", "patch": "@@ -1774,7 +1774,8 @@ gfc_match_varspec (gfc_expr *primary, int equiv_flag, bool sub_flag,\n \t  && !gfc_is_proc_ptr_comp (primary, NULL)\n \t  && !(gfc_matching_procptr_assignment\n \t       && sym->attr.flavor == FL_PROCEDURE))\n-      || (sym->ts.type == BT_CLASS && CLASS_DATA (sym)->attr.dimension))\n+      || (sym->ts.type == BT_CLASS && sym->attr.class_ok\n+\t  && CLASS_DATA (sym)->attr.dimension))\n     {\n       /* In EQUIVALENCE, we don't know yet whether we are seeing\n \t an array, character variable or array of character"}, {"sha": "794175161fece4a7f68a70048dd43529d82b79fd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=22061030a7395524b390bf0cc7382802586cfd53", "patch": "@@ -1,3 +1,8 @@\n+2010-12-30  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/47085\n+\t* gfortran.dg/allocate_class_1.f90: New.\n+\n 2010-12-30  Kai Tietz  <kai.tietz@onevision.com>\n \n \tPR testsuite/47050"}, {"sha": "1dea056b74f2d9b1e3beb5f0ebf69bcdd38d9d77", "filename": "gcc/testsuite/gfortran.dg/allocate_class_1.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_class_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22061030a7395524b390bf0cc7382802586cfd53/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_class_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_class_1.f90?ref=22061030a7395524b390bf0cc7382802586cfd53", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+!\n+! PR 47085: [OOP] Problem in allocate( SOURCE=) for polymorphic component\n+!\n+! Contributed by Janus Weil <janus@gcc.gnu.org>\n+\n+ type :: t0\n+ end type\n+ class(t0) :: x  ! { dg-error \"must be dummy, allocatable or pointer\" }\n+ allocate(x)     ! { dg-error \"is not a nonprocedure pointer or an allocatable variable\" }\n+ end"}]}