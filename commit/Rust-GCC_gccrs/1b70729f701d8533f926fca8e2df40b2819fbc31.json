{"sha": "1b70729f701d8533f926fca8e2df40b2819fbc31", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWI3MDcyOWY3MDFkODUzM2Y5MjZmY2E4ZTJkZjQwYjI4MTlmYmMzMQ==", "commit": {"author": {"name": "Rafael Avila de Espindola", "email": "espindola@google.com", "date": "2009-11-16T20:25:42Z"}, "committer": {"name": "Rafael Espindola", "email": "espindola@gcc.gnu.org", "date": "2009-11-16T20:25:42Z"}, "message": "lto-elf.c (lto_elf_file_open): Use strtoll to parse the offset.\n\n2009-11-16  Rafael Avila de Espindola  <espindola@google.com>\n\n\t* lto-elf.c (lto_elf_file_open): Use strtoll to parse the offset.\n\nFrom-SVN: r154215", "tree": {"sha": "daac8a3805e98a02d32f922a7c26d2d5abf2fe62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/daac8a3805e98a02d32f922a7c26d2d5abf2fe62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1b70729f701d8533f926fca8e2df40b2819fbc31", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b70729f701d8533f926fca8e2df40b2819fbc31", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1b70729f701d8533f926fca8e2df40b2819fbc31", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1b70729f701d8533f926fca8e2df40b2819fbc31/comments", "author": null, "committer": null, "parents": [{"sha": "efd0b0d36de2b536225b81804587915e3440c1c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/efd0b0d36de2b536225b81804587915e3440c1c0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/efd0b0d36de2b536225b81804587915e3440c1c0"}], "stats": {"total": 19, "additions": 14, "deletions": 5}, "files": [{"sha": "b37c549fde8c96199820f4bdbb3930473e5b74da", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b70729f701d8533f926fca8e2df40b2819fbc31/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b70729f701d8533f926fca8e2df40b2819fbc31/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=1b70729f701d8533f926fca8e2df40b2819fbc31", "patch": "@@ -1,3 +1,7 @@\n+2009-11-16  Rafael Avila de Espindola  <espindola@google.com>\n+\n+\t* lto-elf.c (lto_elf_file_open): Use strtoll to parse the offset.\n+\n 2009-11-14  Jan Hubicka  <jh@suse.cz>\n \n \t* lto.c (read_cgraph_and_symbols): Set also ipa_transforms_to_apply."}, {"sha": "bc8e137ccc24b922d7c91acc9a236526944c1516", "filename": "gcc/lto/lto-elf.c", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1b70729f701d8533f926fca8e2df40b2819fbc31/gcc%2Flto%2Flto-elf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1b70729f701d8533f926fca8e2df40b2819fbc31/gcc%2Flto%2Flto-elf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-elf.c?ref=1b70729f701d8533f926fca8e2df40b2819fbc31", "patch": "@@ -540,7 +540,7 @@ lto_file *\n lto_elf_file_open (const char *filename, bool writable)\n {\n   lto_elf_file *elf_file;\n-  lto_file *result;\n+  lto_file *result = NULL;\n   off_t offset;\n   const char *offset_p;\n   char *fname;\n@@ -553,13 +553,17 @@ lto_elf_file_open (const char *filename, bool writable)\n     }\n   else\n     {\n-      int64_t t;\n       fname = (char *) xmalloc (offset_p - filename + 1);\n       memcpy (fname, filename, offset_p - filename);\n       fname[offset_p - filename] = '\\0';\n       offset_p++;\n-      sscanf(offset_p, \"%\" PRId64 , &t);\n-      offset = t;\n+      errno = 0;\n+      offset = strtoll (offset_p, NULL, 10);\n+      if (errno != 0)\n+        {\n+          error (\"could not parse offset %s\", offset_p);\n+          goto fail;\n+        }\n       /* elf_rand expects the offset to point to the ar header, not the\n          object itself. Subtract the size of the ar header (60 bytes).\n          We don't uses sizeof (struct ar_hd) to avoid including ar.h */\n@@ -631,7 +635,8 @@ lto_elf_file_open (const char *filename, bool writable)\n   return result;\n \n  fail:\n-  lto_elf_file_close (result);\n+  if (result)\n+    lto_elf_file_close (result);\n   return NULL;\n }\n "}]}