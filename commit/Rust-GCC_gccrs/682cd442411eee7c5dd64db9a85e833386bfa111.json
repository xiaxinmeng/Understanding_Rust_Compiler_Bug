{"sha": "682cd442411eee7c5dd64db9a85e833386bfa111", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjgyY2Q0NDI0MTFlZWU3YzVkZDY0ZGI5YTg1ZTgzMzM4NmJmYTExMQ==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@apple.com", "date": "2006-09-22T23:50:51Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2006-09-22T23:50:51Z"}, "message": "driver-i386.c: Always define host_detect_local_cpu.\n\n\t* config/i386/driver-i386.c: Always define host_detect_local_cpu.\n\t* config/i386/i386.h: Define EXTRA_SPEC_FUNCTIONS on any i386\n\tor x86_64 host.  Define HAVE_LOCAL_CPU_DETECT.\n\t(CC1_CPU_SPEC): Make conditional on HAVE_LOCAL_CPU_DETECT rather\n\tthan replicating condition above.\n\t* config.host (i[34567]86-*-*): Always use driver-i386.o.\n\nFrom-SVN: r117159", "tree": {"sha": "cbd39ac1e4b0c1363025fe74604d784c1f1514de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cbd39ac1e4b0c1363025fe74604d784c1f1514de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/682cd442411eee7c5dd64db9a85e833386bfa111", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/682cd442411eee7c5dd64db9a85e833386bfa111", "html_url": "https://github.com/Rust-GCC/gccrs/commit/682cd442411eee7c5dd64db9a85e833386bfa111", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/682cd442411eee7c5dd64db9a85e833386bfa111/comments", "author": {"login": "geoffk01", "id": 31905243, "node_id": "MDQ6VXNlcjMxOTA1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/31905243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffk01", "html_url": "https://github.com/geoffk01", "followers_url": "https://api.github.com/users/geoffk01/followers", "following_url": "https://api.github.com/users/geoffk01/following{/other_user}", "gists_url": "https://api.github.com/users/geoffk01/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffk01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffk01/subscriptions", "organizations_url": "https://api.github.com/users/geoffk01/orgs", "repos_url": "https://api.github.com/users/geoffk01/repos", "events_url": "https://api.github.com/users/geoffk01/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffk01/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9281e73dd6d9fd79c8542a62374ac530f3e97c78", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9281e73dd6d9fd79c8542a62374ac530f3e97c78", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9281e73dd6d9fd79c8542a62374ac530f3e97c78"}], "stats": {"total": 31, "additions": 16, "deletions": 15}, "files": [{"sha": "0b0ef57d94e4d9d8644f7d869212adcbf7b49386", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=682cd442411eee7c5dd64db9a85e833386bfa111", "patch": "@@ -1,5 +1,12 @@\n 2006-09-22  Geoffrey Keating  <geoffk@apple.com>\n \n+\t* config/i386/driver-i386.c: Always define host_detect_local_cpu.\n+\t* config/i386/i386.h: Define EXTRA_SPEC_FUNCTIONS on any i386\n+\tor x86_64 host.  Define HAVE_LOCAL_CPU_DETECT.\n+\t(CC1_CPU_SPEC): Make conditional on HAVE_LOCAL_CPU_DETECT rather\n+\tthan replicating condition above.\n+\t* config.host (i[34567]86-*-*): Always use driver-i386.o.\n+\n \t* config/darwin.h (LINK_SYSROOT_SPEC): New.\n \t(LINK_SPEC): If TARGET_SYSTEM_ROOT is defined, pass it to\n \tthe linker by default."}, {"sha": "4547864d9c113cd541c0ddd7ee6cd5ef52d827a5", "filename": "gcc/config.host", "status": "modified", "additions": 2, "deletions": 5, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2Fconfig.host", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2Fconfig.host", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.host?ref=682cd442411eee7c5dd64db9a85e833386bfa111", "patch": "@@ -97,11 +97,8 @@ esac\n case ${host} in\n   i[34567]86-*-* \\\n   | x86_64-*-* )\n-    # include the support for -march=native only when not cross compiling\n-    if test x${host} = x${target} ; then\n-      host_extra_gcc_objs=\"driver-i386.o\"\n-      host_xmake_file=\"${host_xmake_file} i386/x-i386\"\n-    fi\n+    host_extra_gcc_objs=\"driver-i386.o\"\n+    host_xmake_file=\"${host_xmake_file} i386/x-i386\"\n     ;;\n esac\n "}, {"sha": "979a6a5025dc1be14e2c892ba06e57ecbc798a38", "filename": "gcc/config/i386/driver-i386.c", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2Fconfig%2Fi386%2Fdriver-i386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2Fconfig%2Fi386%2Fdriver-i386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fdriver-i386.c?ref=682cd442411eee7c5dd64db9a85e833386bfa111", "patch": "@@ -22,11 +22,6 @@ Boston, MA 02110-1301, USA.  */\n #include \"system.h\"\n #include <stdlib.h>\n \n-#ifndef CROSS_COMPILE\n-/* This file shouldn't even be included in a cross compiler, but\n-   let's be sure.  */\n-extern const char *host_detect_local_cpu (int argc, const char **argv);\n-\n #ifdef GCC_VERSION\n #define cpuid(num,a,b,c,d) \\\n   asm volatile (\"xchgl %%ebx, %1; cpuid; xchgl %%ebx, %1\" \\\n@@ -170,5 +165,4 @@ const char *host_detect_local_cpu (int argc, const char **argv)\n {\n   return concat (\"-m\", argv[0], \"=i386\", NULL);\n }\n-#endif\n-#endif\n+#endif /* GCC_VERSION */"}, {"sha": "4993a94f5ce5d277da5aa1be3295ffa1966d7f76", "filename": "gcc/config/i386/i386.h", "status": "modified", "additions": 6, "deletions": 3, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2Fconfig%2Fi386%2Fi386.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/682cd442411eee7c5dd64db9a85e833386bfa111/gcc%2Fconfig%2Fi386%2Fi386.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.h?ref=682cd442411eee7c5dd64db9a85e833386bfa111", "patch": "@@ -274,12 +274,15 @@ extern int x86_prefetch_sse;\n #define OPTIMIZATION_OPTIONS(LEVEL, SIZE) \\\n   optimization_options ((LEVEL), (SIZE))\n \n-/* -march=native handling only makes sense with a native compiler.  */\n-#ifndef CROSS_COMPILE\n+/* -march=native handling only makes sense with compiler running on\n+   an x86 or x86_64 chip.  If changing this condition, also change\n+   the condition in driver-i386.c.  */\n+#if defined(__i386__) || defined(__x86_64__)\n /* In driver-i386.c.  */\n extern const char *host_detect_local_cpu (int argc, const char **argv);\n #define EXTRA_SPEC_FUNCTIONS \\\n   { \"local_cpu_detect\", host_detect_local_cpu },\n+#define HAVE_LOCAL_CPU_DETECT\n #endif\n \n /* Support for configure-time defaults of some command line options.\n@@ -311,7 +314,7 @@ extern const char *host_detect_local_cpu (int argc, const char **argv);\n %{mno-intel-syntax:-masm=att \\\n %n`-mno-intel-syntax' is deprecated. Use `-masm=att' instead.\\n}\"\n \n-#ifdef CROSS_COMPILE\n+#ifndef HAVE_LOCAL_CPU_DETECT\n #define CC1_CPU_SPEC CC1_CPU_SPEC_1\n #else\n #define CC1_CPU_SPEC CC1_CPU_SPEC_1 \\"}]}