{"sha": "97258480438db77e52f4b3947fa2c075b09d3fe1", "node_id": "C_kwDOANBUbNoAKDk3MjU4NDgwNDM4ZGI3N2U1MmY0YjM5NDdmYTJjMDc1YjA5ZDNmZTE", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-01-31T14:45:43Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-02-01T07:47:40Z"}, "message": "middle-end/108500 - replace recursive domtree DFS traversal\n\nThe following replaces the recursive DFS traversal of the dominator\ntree in assign_dfs_numbers with a tree traversal using the fact\nthat we have recorded parents.\n\nBootstrapped and tested on x86_64-unknown-linux-gnu.\n\nThis makes r13-5325 somewhat obsolete, though not computing the\nDFS numbers at all is beneficial in the cases where we perform\nimmediate CFG manipulations.\n\nOK for trunk and later branch(es)?\n\nThanks,\nRichard.\n\n\tPR middle-end/108500\n\t* dominance.cc (assign_dfs_numbers): Replace recursive DFS\n\twith tree traversal algorithm.", "tree": {"sha": "f6e2655eef17bb742f0fe1d5ad414c0b490bff13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f6e2655eef17bb742f0fe1d5ad414c0b490bff13"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/97258480438db77e52f4b3947fa2c075b09d3fe1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97258480438db77e52f4b3947fa2c075b09d3fe1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97258480438db77e52f4b3947fa2c075b09d3fe1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97258480438db77e52f4b3947fa2c075b09d3fe1/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e2f939d30f5b397011d1dc06370dd8196aceebda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2f939d30f5b397011d1dc06370dd8196aceebda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2f939d30f5b397011d1dc06370dd8196aceebda"}], "stats": {"total": 27, "additions": 17, "deletions": 10}, "files": [{"sha": "34fabe40c1893f2d30794e44e1b11762abf562de", "filename": "gcc/dominance.cc", "status": "modified", "additions": 17, "deletions": 10, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/97258480438db77e52f4b3947fa2c075b09d3fe1/gcc%2Fdominance.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/97258480438db77e52f4b3947fa2c075b09d3fe1/gcc%2Fdominance.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdominance.cc?ref=97258480438db77e52f4b3947fa2c075b09d3fe1", "patch": "@@ -639,18 +639,25 @@ dom_info::calc_idoms ()\n static void\n assign_dfs_numbers (struct et_node *node, int *num)\n {\n-  struct et_node *son;\n-\n-  node->dfs_num_in = (*num)++;\n-\n-  if (node->son)\n+  et_node *n = node;\n+  while (1)\n     {\n-      assign_dfs_numbers (node->son, num);\n-      for (son = node->son->right; son != node->son; son = son->right)\n-\tassign_dfs_numbers (son, num);\n+      n->dfs_num_in = (*num)++;\n+      if (n->son)\n+\tn = n->son;\n+      else\n+\t{\n+\t  while (!n->right || n->right == n->father->son)\n+\t    {\n+\t      n->dfs_num_out = (*num)++;\n+\t      if (n == node)\n+\t\treturn;\n+\t      n = n->father;\n+\t    }\n+\t  n->dfs_num_out = (*num)++;\n+\t  n = n->right;\n+\t}\n     }\n-\n-  node->dfs_num_out = (*num)++;\n }\n \n /* Compute the data necessary for fast resolving of dominator queries in a"}]}