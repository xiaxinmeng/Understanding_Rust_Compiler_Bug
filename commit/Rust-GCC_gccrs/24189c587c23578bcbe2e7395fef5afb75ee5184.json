{"sha": "24189c587c23578bcbe2e7395fef5afb75ee5184", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjQxODljNTg3YzIzNTc4YmNiZTJlNzM5NWZlZjVhZmI3NWVlNTE4NA==", "commit": {"author": {"name": "Daniel Franke", "email": "franke.daniel@gmail.com", "date": "2007-06-27T20:02:31Z"}, "committer": {"name": "Daniel Franke", "email": "dfranke@gcc.gnu.org", "date": "2007-06-27T20:02:31Z"}, "message": "re PR fortran/32467 (structure containing allocatable array is accepted in COPYIN clause)\n\ngcc/fortran:\n2007-06-24  Daniel Franke  <franke.daniel@gmail.com>\n\n\tPR fortran/32467\n\t* openmp.c (resolve_omp_clauses): Emit error on allocatable components \n\tin COPYIN, COPYPRIVATE, FIRSTPRIVATE and LASTPRIVATE clauses.\n\ngcc/testsuite:\n2007-06-24  Daniel Franke  <franke.daniel@gmail.com>\n\n        PR fortran/32467\n        * gfortran.dg/gomp/allocatable_components_1.f90: New test.\n\nFrom-SVN: r126063", "tree": {"sha": "889fbe57e5950c52b3f6b693251d8b0c83bd518c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/889fbe57e5950c52b3f6b693251d8b0c83bd518c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/24189c587c23578bcbe2e7395fef5afb75ee5184", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24189c587c23578bcbe2e7395fef5afb75ee5184", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24189c587c23578bcbe2e7395fef5afb75ee5184", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24189c587c23578bcbe2e7395fef5afb75ee5184/comments", "author": {"login": "dfranke76", "id": 15729164, "node_id": "MDQ6VXNlcjE1NzI5MTY0", "avatar_url": "https://avatars.githubusercontent.com/u/15729164?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dfranke76", "html_url": "https://github.com/dfranke76", "followers_url": "https://api.github.com/users/dfranke76/followers", "following_url": "https://api.github.com/users/dfranke76/following{/other_user}", "gists_url": "https://api.github.com/users/dfranke76/gists{/gist_id}", "starred_url": "https://api.github.com/users/dfranke76/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dfranke76/subscriptions", "organizations_url": "https://api.github.com/users/dfranke76/orgs", "repos_url": "https://api.github.com/users/dfranke76/repos", "events_url": "https://api.github.com/users/dfranke76/events{/privacy}", "received_events_url": "https://api.github.com/users/dfranke76/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "20de4d9913045c25b7cbc9d604cb251198f0197a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20de4d9913045c25b7cbc9d604cb251198f0197a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20de4d9913045c25b7cbc9d604cb251198f0197a"}], "stats": {"total": 88, "additions": 85, "deletions": 3}, "files": [{"sha": "6fcd5bc3f2b9b6337c60620e3d562124ada7efc7", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=24189c587c23578bcbe2e7395fef5afb75ee5184", "patch": "@@ -1,3 +1,10 @@\n+2007-06-27  Daniel Franke  <franke.daniel@gmail.com>\n+\n+\tPR fortran/32467\n+\t* openmp.c (resolve_omp_clauses): Emit error on allocatable\n+\tcomponents in COPYIN, COPYPRIVATE, FIRSTPRIVATE and LASTPRIVATE\n+\tclauses.\n+\n 2007-06-25  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/32464"}, {"sha": "54981ef3a6f721c51d94e1c8b97b1dc650a92974", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=24189c587c23578bcbe2e7395fef5afb75ee5184", "patch": "@@ -779,6 +779,9 @@ resolve_omp_clauses (gfc_code *code)\n \t\tif (n->sym->attr.allocatable)\n \t\t  gfc_error (\"COPYIN clause object '%s' is ALLOCATABLE at %L\",\n \t\t\t     n->sym->name, &code->loc);\n+\t\tif (n->sym->ts.type == BT_DERIVED && n->sym->ts.derived->attr.alloc_comp)\n+\t\t  gfc_error (\"COPYIN clause object '%s' at %L has ALLOCATABLE components\",\n+\t\t\t     n->sym->name, &code->loc);\n \t      }\n \t    break;\n \t  case OMP_LIST_COPYPRIVATE:\n@@ -790,6 +793,9 @@ resolve_omp_clauses (gfc_code *code)\n \t\tif (n->sym->attr.allocatable)\n \t\t  gfc_error (\"COPYPRIVATE clause object '%s' is ALLOCATABLE \"\n \t\t\t     \"at %L\", n->sym->name, &code->loc);\n+\t\tif (n->sym->ts.type == BT_DERIVED && n->sym->ts.derived->attr.alloc_comp)\n+\t\t  gfc_error (\"COPYPRIVATE clause object '%s' at %L has ALLOCATABLE components\",\n+\t\t\t     n->sym->name, &code->loc);\n \t      }\n \t    break;\n \t  case OMP_LIST_SHARED:\n@@ -820,6 +826,11 @@ resolve_omp_clauses (gfc_code *code)\n \t\t    if (n->sym->attr.allocatable)\n \t\t      gfc_error (\"%s clause object '%s' is ALLOCATABLE at %L\",\n \t\t\t\t name, n->sym->name, &code->loc);\n+\t\t    /* Variables in REDUCTION-clauses must be of intrinsic type (flagged below).  */\n+\t\t    if ((list < OMP_LIST_REDUCTION_FIRST || list > OMP_LIST_REDUCTION_LAST) &&\n+\t\t        n->sym->ts.type == BT_DERIVED && n->sym->ts.derived->attr.alloc_comp)\n+\t\t      gfc_error (\"%s clause object '%s' has ALLOCATABLE components at %L\",\n+\t\t\t\t name, n->sym->name, &code->loc);\n \t\t    if (n->sym->attr.cray_pointer)\n \t\t      gfc_error (\"Cray pointer '%s' in %s clause at %L\",\n \t\t\t\t n->sym->name, name, &code->loc);\n@@ -839,11 +850,11 @@ resolve_omp_clauses (gfc_code *code)\n \t\t  case OMP_LIST_MULT:\n \t\t  case OMP_LIST_SUB:\n \t\t    if (!gfc_numeric_ts (&n->sym->ts))\n-\t\t      gfc_error (\"%c REDUCTION variable '%s' is %s at %L\",\n+\t\t      gfc_error (\"%c REDUCTION variable '%s' at %L must be of intrinsic type, got %s\",\n \t\t\t\t list == OMP_LIST_PLUS ? '+'\n \t\t\t\t : list == OMP_LIST_MULT ? '*' : '-',\n-\t\t\t\t n->sym->name, gfc_typename (&n->sym->ts),\n-\t\t\t\t &code->loc);\n+\t\t\t\t n->sym->name, &code->loc,\n+\t\t\t\t gfc_typename (&n->sym->ts));\n \t\t    break;\n \t\t  case OMP_LIST_AND:\n \t\t  case OMP_LIST_OR:"}, {"sha": "9fb13b26a0fac801fcdbc2c00dfb747bf96956c5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=24189c587c23578bcbe2e7395fef5afb75ee5184", "patch": "@@ -1,3 +1,8 @@\n+2007-06-27  Daniel Franke  <franke.daniel@gmail.com>\n+\n+\tPR fortran/32467\n+\t* gfortran.dg/gomp/allocatable_components_1.f90: New test.\n+\n 2007-06-27  Richard Guenther  <rguenther@suse.de>\n \n \tPR middle-end/32492"}, {"sha": "02fcb1b432d695847bf46fbb36707b376d62d4b3", "filename": "gcc/testsuite/gfortran.dg/gomp/allocatable_components_1.f90", "status": "added", "additions": 59, "deletions": 0, "changes": 59, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fallocatable_components_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/24189c587c23578bcbe2e7395fef5afb75ee5184/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fallocatable_components_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fallocatable_components_1.f90?ref=24189c587c23578bcbe2e7395fef5afb75ee5184", "patch": "@@ -0,0 +1,59 @@\n+! { dg-do compile }\n+!\n+! PR fortran/32467\n+! Derived types with allocatable components\n+!\n+\n+MODULE test_allocatable_components\n+  type :: t\n+    integer, allocatable :: a(:)\n+  end type\n+\n+CONTAINS\n+  SUBROUTINE test_copyin()\n+    TYPE(t), SAVE :: a\n+\n+    !$omp threadprivate(a)\n+    !$omp parallel copyin(a)        ! { dg-error \"has ALLOCATABLE components\" }\n+      ! do something\n+    !$omp end parallel\n+  END SUBROUTINE\n+\n+  SUBROUTINE test_copyprivate()\n+    TYPE(t) :: a\n+\n+    !$omp single                    ! { dg-error \"has ALLOCATABLE components\" }\n+      ! do something\n+    !$omp end single copyprivate (a)\n+  END SUBROUTINE\n+\n+  SUBROUTINE test_firstprivate\n+    TYPE(t) :: a\n+\n+    !$omp parallel firstprivate(a)  ! { dg-error \"has ALLOCATABLE components\" }\n+      ! do something\n+    !$omp end parallel\n+  END SUBROUTINE\n+\n+  SUBROUTINE test_lastprivate\n+    TYPE(t) :: a\n+    INTEGER :: i\n+\n+    !$omp parallel do lastprivate(a)  ! { dg-error \"has ALLOCATABLE components\" }\n+      DO i = 1, 1\n+      END DO\n+    !$omp end parallel do\n+  END SUBROUTINE\n+\n+  SUBROUTINE test_reduction\n+    TYPE(t) :: a(10)\n+    INTEGER :: i\n+\n+    !$omp parallel do reduction(+: a)   ! { dg-error \"must be of intrinsic type\" }\n+    DO i = 1, SIZE(a)\n+    END DO\n+    !$omp end parallel do\n+  END SUBROUTINE\n+END MODULE\n+\n+! { dg-final { cleanup-modules \"test_allocatable_components\" } }"}]}