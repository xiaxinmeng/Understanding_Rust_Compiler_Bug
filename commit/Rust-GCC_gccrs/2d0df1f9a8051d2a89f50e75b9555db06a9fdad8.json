{"sha": "2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQwZGYxZjlhODA1MWQyYTg5ZjUwZTc1Yjk1NTVkYjA2YTlmZGFkOA==", "commit": {"author": {"name": "Roger Sayle", "email": "roger@eyesopen.com", "date": "2006-06-16T13:21:45Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2006-06-16T13:21:45Z"}, "message": "re PR middle-end/27802 (ICE with longjmp)\n\n\n\tPR middle-end/27802\n\t* reg-stack.c (subst_stack_regs): Handle noreturn function calls\n\tthat (would) return their results in stack registers.\n\n\t* gcc.dg/pr27802-1.c: New test case.\n\nFrom-SVN: r114721", "tree": {"sha": "a40f1b62f264bb2144d100e2c702367189d4d55f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a40f1b62f264bb2144d100e2c702367189d4d55f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/comments", "author": null, "committer": null, "parents": [{"sha": "e046c56eee0e7308f8704c8c13aa6ca5230201f1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e046c56eee0e7308f8704c8c13aa6ca5230201f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e046c56eee0e7308f8704c8c13aa6ca5230201f1"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "17355cefd1ab6da2fcc2c058e2cf784afdf79016", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "patch": "@@ -1,3 +1,9 @@\n+2006-06-16  Roger Sayle  <roger@eyesopen.com>\n+\n+\tPR middle-end/27802\n+\t* reg-stack.c (subst_stack_regs): Handle noreturn function calls\n+\tthat (would) return their results in stack registers.\n+\n 2006-06-16  Michael Matz  <matz@suse.de>\n \tRichard Guenther  <rguenther@suse.de>\n "}, {"sha": "fc742bdce6080d876d02ac36fdf638372cfc0d88", "filename": "gcc/reg-stack.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2Freg-stack.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2Freg-stack.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freg-stack.c?ref=2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "patch": "@@ -2282,6 +2282,16 @@ subst_stack_regs (rtx insn, stack regstack)\n   if (NOTE_P (insn) || INSN_DELETED_P (insn))\n     return control_flow_insn_deleted;\n \n+  /* If this a noreturn call, we can't insert pop insns after it.\n+     Instead, reset the stack state to empty.  */\n+  if (CALL_P (insn)\n+      && find_reg_note (insn, REG_NORETURN, NULL))\n+    {\n+      regstack->top = -1;\n+      CLEAR_HARD_REG_SET (regstack->reg_set);\n+      return control_flow_insn_deleted;\n+    }\n+\n   /* If there is a REG_UNUSED note on a stack register on this insn,\n      the indicated reg must be popped.  The REG_UNUSED note is removed,\n      since the form of the newly emitted pop insn references the reg,"}, {"sha": "31c1fad9a38e2f372770e41eca376a21ec2bb293", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "patch": "@@ -1,3 +1,8 @@\n+2006-06-16  Roger Sayle  <roger@eyesopen.com>\n+\n+\tPR middle-end/27802\n+\t* gcc.dg/pr27802-1.c: New test case.\n+\n 2006-06-15  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/27689"}, {"sha": "839459ac01aa312a2b4364023af40daa044c3572", "filename": "gcc/testsuite/gcc.dg/pr27802-1.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr27802-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d0df1f9a8051d2a89f50e75b9555db06a9fdad8/gcc%2Ftestsuite%2Fgcc.dg%2Fpr27802-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr27802-1.c?ref=2d0df1f9a8051d2a89f50e75b9555db06a9fdad8", "patch": "@@ -0,0 +1,16 @@\n+/* Noreturn functions returning FP types used to confuse reg-stack on x86.  */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+double bar1() __attribute__((noreturn));\n+void foo1() { bar1(); }\n+\n+double bar2() __attribute__((noreturn));\n+double foo2() { return bar2(); }\n+\n+void bar3() __attribute__((noreturn));\n+double foo3() { bar3(); }\n+\n+double bar4() __attribute__((noreturn));\n+double foo4() { bar4(); }\n+"}]}