{"sha": "d699d32f47833cfab959a810dad48774c021c677", "node_id": "C_kwDOANBUbNoAKGQ2OTlkMzJmNDc4MzNjZmFiOTU5YTgxMGRhZDQ4Nzc0YzAyMWM2Nzc", "commit": {"author": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-11-03T17:35:25Z"}, "committer": {"name": "Xi Ruoyao", "email": "xry111@xry111.site", "date": "2022-11-09T09:11:23Z"}, "message": "LoongArch: fix signed overflow in loongarch_emit_int_compare\n\nSigned overflow is an undefined behavior, so we need to prevent it from\nhappening, instead of \"checking\" the result.\n\ngcc/ChangeLog:\n\n\t* config/loongarch/loongarch.cc (loongarch_emit_int_compare):\n\tAvoid signed overflow.", "tree": {"sha": "ad0f3eb8bd34c361d3c9fe8f4882c79a7c9443e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad0f3eb8bd34c361d3c9fe8f4882c79a7c9443e1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d699d32f47833cfab959a810dad48774c021c677", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\niHUEABYKAB0WIQSR0PV2MB+STX3t3OisqtIOGecQ4wUCY2tuuwAKCRCsqtIOGecQ\n4+ndAQClIsPYVOLsQcDFU9p0sXbIsx5BHQtlZ+ZerF9LGr9N8QD/eyN4/891l19g\nVGgENzmVBXSqQVn2/CFEM9I0bjDEfAU=\n=6HWp\n-----END PGP SIGNATURE-----", "payload": "tree ad0f3eb8bd34c361d3c9fe8f4882c79a7c9443e1\nparent 1f9c79367e136e0ca5b775562e6111e1a0d0046f\nauthor Xi Ruoyao <xry111@xry111.site> 1667496925 +0800\ncommitter Xi Ruoyao <xry111@xry111.site> 1667985083 +0800\n\nLoongArch: fix signed overflow in loongarch_emit_int_compare\n\nSigned overflow is an undefined behavior, so we need to prevent it from\nhappening, instead of \"checking\" the result.\n\ngcc/ChangeLog:\n\n\t* config/loongarch/loongarch.cc (loongarch_emit_int_compare):\n\tAvoid signed overflow.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d699d32f47833cfab959a810dad48774c021c677", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d699d32f47833cfab959a810dad48774c021c677", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d699d32f47833cfab959a810dad48774c021c677/comments", "author": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "committer": {"login": "xry111", "id": 8733039, "node_id": "MDQ6VXNlcjg3MzMwMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/8733039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/xry111", "html_url": "https://github.com/xry111", "followers_url": "https://api.github.com/users/xry111/followers", "following_url": "https://api.github.com/users/xry111/following{/other_user}", "gists_url": "https://api.github.com/users/xry111/gists{/gist_id}", "starred_url": "https://api.github.com/users/xry111/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/xry111/subscriptions", "organizations_url": "https://api.github.com/users/xry111/orgs", "repos_url": "https://api.github.com/users/xry111/repos", "events_url": "https://api.github.com/users/xry111/events{/privacy}", "received_events_url": "https://api.github.com/users/xry111/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1f9c79367e136e0ca5b775562e6111e1a0d0046f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f9c79367e136e0ca5b775562e6111e1a0d0046f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f9c79367e136e0ca5b775562e6111e1a0d0046f"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "8d5d8d965dd723f80d4903dcb3cd3577e8864615", "filename": "gcc/config/loongarch/loongarch.cc", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d699d32f47833cfab959a810dad48774c021c677/gcc%2Fconfig%2Floongarch%2Floongarch.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d699d32f47833cfab959a810dad48774c021c677/gcc%2Fconfig%2Floongarch%2Floongarch.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Floongarch%2Floongarch.cc?ref=d699d32f47833cfab959a810dad48774c021c677", "patch": "@@ -4178,10 +4178,13 @@ loongarch_emit_int_compare (enum rtx_code *code, rtx *op0, rtx *op1)\n \t      if (!increment && !decrement)\n \t\tcontinue;\n \n+\t      if ((increment && rhs == HOST_WIDE_INT_MAX)\n+\t\t  || (decrement && rhs == HOST_WIDE_INT_MIN))\n+\t\tbreak;\n+\n \t      new_rhs = rhs + (increment ? 1 : -1);\n \t      if (loongarch_integer_cost (new_rhs)\n-\t\t    < loongarch_integer_cost (rhs)\n-\t\t  && (rhs < 0) == (new_rhs < 0))\n+\t\t    < loongarch_integer_cost (rhs))\n \t\t{\n \t\t  *op1 = GEN_INT (new_rhs);\n \t\t  *code = mag_comparisons[i][increment];"}]}