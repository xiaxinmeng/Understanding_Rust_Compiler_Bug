{"sha": "2d9da1c89778be1d6604cc1465b0dd50f241a352", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQ5ZGExYzg5Nzc4YmUxZDY2MDRjYzE0NjViMGRkNTBmMjQxYTM1Mg==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-08-13T19:20:04Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-08-17T18:48:06Z"}, "message": "Darwin: Reset section names table at the end of compile.\n\nFor a single use (typical compile) this vector will be reclaimed\nas GGC.  For JIT this is not sufficient since it does not reset\nthe pointer to NULL (and thus we think the the vector is already\nallocated when a context is reused).\n\nThe clears the vector and sets the pointer to NULL at the end\nof object output.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\ngcc/ChangeLog:\n\n\t* config/darwin.c (darwin_file_end): Reset and reclaim the\n\tsection names table at the end of compile.", "tree": {"sha": "5d5d82e51bf6f1d59c1668ebbc5844fe609239f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5d5d82e51bf6f1d59c1668ebbc5844fe609239f0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d9da1c89778be1d6604cc1465b0dd50f241a352", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d9da1c89778be1d6604cc1465b0dd50f241a352", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d9da1c89778be1d6604cc1465b0dd50f241a352", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d9da1c89778be1d6604cc1465b0dd50f241a352/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "743b8dd6fd757e997eb060d70fd4ae8e04fb56cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/743b8dd6fd757e997eb060d70fd4ae8e04fb56cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/743b8dd6fd757e997eb060d70fd4ae8e04fb56cd"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "5d1d13c80aaf1278fa33fb591401d2762905e8ac", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d9da1c89778be1d6604cc1465b0dd50f241a352/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d9da1c89778be1d6604cc1465b0dd50f241a352/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=2d9da1c89778be1d6604cc1465b0dd50f241a352", "patch": "@@ -3129,6 +3129,14 @@ darwin_file_end (void)\n      re-arranging data.  */\n   if (!DARWIN_SECTION_ANCHORS || !flag_section_anchors)\n     fprintf (asm_out_file, \"\\t.subsections_via_symbols\\n\");\n+\n+  /* We rely on this being NULL at the start of compilation; reset it here\n+     so that JIT can reuse a context.  */\n+  if (dwarf_sect_names_table != NULL)\n+    {\n+      dwarf_sect_names_table->truncate (0);\n+      dwarf_sect_names_table = NULL;\n+    }\n }\n \n /* TODO: Add a language hook for identifying if a decl is a vtable.  */"}]}