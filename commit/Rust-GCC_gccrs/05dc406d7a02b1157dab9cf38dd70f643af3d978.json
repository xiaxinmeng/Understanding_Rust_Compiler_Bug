{"sha": "05dc406d7a02b1157dab9cf38dd70f643af3d978", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDVkYzQwNmQ3YTAyYjExNTdkYWI5Y2YzOGRkNzBmNjQzYWYzZDk3OA==", "commit": {"author": {"name": "Peter Bergner", "email": "bergner@vnet.ibm.com", "date": "2017-03-30T19:57:20Z"}, "committer": {"name": "Peter Bergner", "email": "bergner@gcc.gnu.org", "date": "2017-03-30T19:57:20Z"}, "message": "re PR target/80246 (Builtin's for POWER's dxex[q] and diex[q] use the wrong types)\n\ngcc/\n\tPR target/80246\n\t* config/rs6000/dfp.md (dfp_dxex_<mode>): Update mode of operand 0.\n\t(dfp_diex_<mode>): Update mode of operand 1.\n\t* doc/extend.texi (dxex, dxexq): Document change to return type.\n\t(diex, diexq): Document change to argument type.\n\ngcc/testsuite/\n\tPR target/80246\n\t* gcc.target/powerpc/dfp-builtin-1.c: Remove unneeded dg-skip-if for\n\tDarwin and SPE.\n\t(dxex, dxexq): Update return type.\n\t(diex, diexq): Update argument type.\n\t* gcc.target/powerpc/pr80246.c: New test.\n\nFrom-SVN: r246594", "tree": {"sha": "59c1ef3970dd6b53307aefe791a3e22171a1cb1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/59c1ef3970dd6b53307aefe791a3e22171a1cb1a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/05dc406d7a02b1157dab9cf38dd70f643af3d978", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05dc406d7a02b1157dab9cf38dd70f643af3d978", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05dc406d7a02b1157dab9cf38dd70f643af3d978", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05dc406d7a02b1157dab9cf38dd70f643af3d978/comments", "author": {"login": "peter-bergner", "id": 17504345, "node_id": "MDQ6VXNlcjE3NTA0MzQ1", "avatar_url": "https://avatars.githubusercontent.com/u/17504345?v=4", "gravatar_id": "", "url": "https://api.github.com/users/peter-bergner", "html_url": "https://github.com/peter-bergner", "followers_url": "https://api.github.com/users/peter-bergner/followers", "following_url": "https://api.github.com/users/peter-bergner/following{/other_user}", "gists_url": "https://api.github.com/users/peter-bergner/gists{/gist_id}", "starred_url": "https://api.github.com/users/peter-bergner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/peter-bergner/subscriptions", "organizations_url": "https://api.github.com/users/peter-bergner/orgs", "repos_url": "https://api.github.com/users/peter-bergner/repos", "events_url": "https://api.github.com/users/peter-bergner/events{/privacy}", "received_events_url": "https://api.github.com/users/peter-bergner/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b0fd4d7e328f0b967d61fdfe44b5e01b26cf3c30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0fd4d7e328f0b967d61fdfe44b5e01b26cf3c30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0fd4d7e328f0b967d61fdfe44b5e01b26cf3c30"}], "stats": {"total": 82, "additions": 68, "deletions": 14}, "files": [{"sha": "d7fbf028456a46fa83a70ed88cc5ad9807ecee03", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=05dc406d7a02b1157dab9cf38dd70f643af3d978", "patch": "@@ -1,3 +1,11 @@\n+2017-03-30  Peter Bergner  <bergner@vnet.ibm.com>\n+\n+\tPR target/80246\n+\t* config/rs6000/dfp.md (dfp_dxex_<mode>): Update mode of operand 0.\n+\t(dfp_diex_<mode>): Update mode of operand 1.\n+\t* doc/extend.texi (dxex, dxexq): Document change to return type.\n+\t(diex, diexq): Document change to argument type.\n+\n 2017-03-30  Martin Jambor  <mjambor@suse.cz>\n \n \tPR ipa/77333"}, {"sha": "790f2e43d495fbc6b6539b1b81105f91f3fd6527", "filename": "gcc/config/rs6000/dfp.md", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Fconfig%2Frs6000%2Fdfp.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Fconfig%2Frs6000%2Fdfp.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fdfp.md?ref=05dc406d7a02b1157dab9cf38dd70f643af3d978", "patch": "@@ -348,16 +348,16 @@\n   [(set_attr \"type\" \"dfp\")])\n \n (define_insn \"dfp_dxex_<mode>\"\n-  [(set (match_operand:D64_D128 0 \"gpc_reg_operand\" \"=d\")\n-\t(unspec:D64_D128 [(match_operand:D64_D128 1 \"gpc_reg_operand\" \"d\")]\n-\t\t\t UNSPEC_DXEX))]\n+  [(set (match_operand:DI 0 \"gpc_reg_operand\" \"=d\")\n+\t(unspec:DI [(match_operand:D64_D128 1 \"gpc_reg_operand\" \"d\")]\n+\t\t   UNSPEC_DXEX))]\n   \"TARGET_DFP\"\n   \"dxex<dfp_suffix> %0,%1\"\n   [(set_attr \"type\" \"dfp\")])\n \n (define_insn \"dfp_diex_<mode>\"\n   [(set (match_operand:D64_D128 0 \"gpc_reg_operand\" \"=d\")\n-\t(unspec:D64_D128 [(match_operand:D64_D128 1 \"gpc_reg_operand\" \"d\")\n+\t(unspec:D64_D128 [(match_operand:DI 1 \"gpc_reg_operand\" \"d\")\n \t\t\t  (match_operand:D64_D128 2 \"gpc_reg_operand\" \"d\")]\n \t\t\t UNSPEC_DXEX))]\n   \"TARGET_DFP\""}, {"sha": "fadbc9673f031340ed4baea08f17eb9f475b94c9", "filename": "gcc/doc/extend.texi", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Fdoc%2Fextend.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Fdoc%2Fextend.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Fextend.texi?ref=05dc406d7a02b1157dab9cf38dd70f643af3d978", "patch": "@@ -15427,14 +15427,14 @@ The following built-in functions are available for the PowerPC family\n of processors when hardware decimal floating point\n (@option{-mhard-dfp}) is available:\n @smallexample\n-_Decimal64 __builtin_dxex (_Decimal64);\n-_Decimal128 __builtin_dxexq (_Decimal128);\n+long long __builtin_dxex (_Decimal64);\n+long long __builtin_dxexq (_Decimal128);\n _Decimal64 __builtin_ddedpd (int, _Decimal64);\n _Decimal128 __builtin_ddedpdq (int, _Decimal128);\n _Decimal64 __builtin_denbcd (int, _Decimal64);\n _Decimal128 __builtin_denbcdq (int, _Decimal128);\n-_Decimal64 __builtin_diex (_Decimal64, _Decimal64);\n-_Decimal128 _builtin_diexq (_Decimal128, _Decimal128);\n+_Decimal64 __builtin_diex (long long, _Decimal64);\n+_Decimal128 _builtin_diexq (long long, _Decimal128);\n _Decimal64 __builtin_dscli (_Decimal64, int);\n _Decimal128 __builtin_dscliq (_Decimal128, int);\n _Decimal64 __builtin_dscri (_Decimal64, int);"}, {"sha": "fcf4013338a0e80b406b44c7b0dc39eca10be823", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=05dc406d7a02b1157dab9cf38dd70f643af3d978", "patch": "@@ -1,3 +1,12 @@\n+2017-03-30  Peter Bergner  <bergner@vnet.ibm.com>\n+\n+\tPR target/80246\n+\t* gcc.target/powerpc/dfp-builtin-1.c: Remove unneeded dg-skip-if for\n+\tDarwin and SPE.\n+\t(dxex, dxexq): Update return type.\n+\t(diex, diexq): Update argument type.\n+\t* gcc.target/powerpc/pr80246.c: New test.\n+\n 2017-03-30  Martin Jambor  <mjambor@suse.cz>\n \n \tPR ipa/77333"}, {"sha": "bb5ad8866972f797b139a492f52f5f6142b8f8d3", "filename": "gcc/testsuite/gcc.target/powerpc/dfp-builtin-1.c", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdfp-builtin-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdfp-builtin-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fdfp-builtin-1.c?ref=05dc406d7a02b1157dab9cf38dd70f643af3d978", "patch": "@@ -1,6 +1,4 @@\n /* { dg-do compile { target { powerpc*-*-linux* } } } */\n-/* { dg-skip-if \"\" { powerpc*-*-darwin* } { \"*\" } { \"\" } } */\n-/* { dg-skip-if \"\" { powerpc*-*-*spe* } { \"*\" } { \"\" } } */\n /* { dg-require-effective-target powerpc_vsx_ok } */\n /* { dg-skip-if \"do not override -mcpu\" { powerpc*-*-* } { \"-mcpu=*\" } { \"-mcpu=power7\" } } */\n /* { dg-options \"-mcpu=power7 -O2\" } */\n@@ -10,11 +8,13 @@\n /* { dg-final { scan-assembler-times \"diex \"   1    } } */\n /* { dg-final { scan-assembler-times \"dscli \"  2    } } */\n /* { dg-final { scan-assembler-times \"dscri \"  2    } } */\n+/* { dg-final { scan-assembler-times \"std \"    1    } } */\n+/* { dg-final { scan-assembler-times \"ld \"     1    } } */\n+/* { dg-final { scan-assembler-times \"stfd \"   1    } } */\n+/* { dg-final { scan-assembler-times \"lfd \"    1    } } */\n /* { dg-final { scan-assembler-not   \"bl __builtin\" } } */\n /* { dg-final { scan-assembler-not   \"dctqpq\"       } } */\n /* { dg-final { scan-assembler-not   \"drdpq\"        } } */\n-/* { dg-final { scan-assembler-not   \"stfd\"         } } */\n-/* { dg-final { scan-assembler-not   \"lfd\"          } } */\n \n _Decimal64\n do_dedpd_0 (_Decimal64 a)\n@@ -52,14 +52,14 @@ do_enbcd_1 (_Decimal64 a)\n   return __builtin_denbcd (1, a);\n }\n \n-_Decimal64\n+long long\n do_xex (_Decimal64 a)\n {\n   return __builtin_dxex (a);\n }\n \n _Decimal64\n-do_iex (_Decimal64 a, _Decimal64 b)\n+do_iex (long long a, _Decimal64 b)\n {\n   return __builtin_diex (a, b);\n }"}, {"sha": "915e31f2023ef28e2035431680b65695c00e577d", "filename": "gcc/testsuite/gcc.target/powerpc/pr80246.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80246.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05dc406d7a02b1157dab9cf38dd70f643af3d978/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80246.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr80246.c?ref=05dc406d7a02b1157dab9cf38dd70f643af3d978", "patch": "@@ -0,0 +1,37 @@\n+/* { dg-do compile { target { powerpc*-*-linux* } } } */\n+/* { dg-require-effective-target dfp } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-final { scan-assembler-times \"dxex \"  1 } } */\n+/* { dg-final { scan-assembler-times \"dxexq \" 1 } } */\n+/* { dg-final { scan-assembler-times \"diex \"  1 } } */\n+/* { dg-final { scan-assembler-times \"diexq \" 1 } } */\n+/* { dg-final { scan-assembler-not \"bl __builtin\" } } */\n+/* Verify we don't generate any drintn., drintnq., dctfix, dctfixq, dcffix\n+   or dcffixq instructions, as they imply we are getting unwanted casting.  */\n+/* { dg-final { scan-assembler-not \"drintn\\[q\\]\\.\" } } */\n+/* { dg-final { scan-assembler-not \"dctfix\\[q\\]\" } } */\n+/* { dg-final { scan-assembler-not \"dcffix\\[q\\]\" } } */\n+\n+long long\n+do_xex (_Decimal64 arg)\n+{\n+  return __builtin_dxex (arg);\n+}\n+\n+long long\n+do_xexq (_Decimal128 arg)\n+{\n+  return __builtin_dxexq (arg);\n+}\n+\n+_Decimal64\n+do_iex (long long exp, _Decimal64 arg)\n+{\n+  return __builtin_diex (exp, arg);\n+}\n+\n+_Decimal128\n+do_iexq (long long exp, _Decimal128 arg)\n+{\n+  return __builtin_diexq (exp, arg);\n+}"}]}