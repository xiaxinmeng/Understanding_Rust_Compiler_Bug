{"sha": "81b405828fd0d3dca3eaf715e2008e7a95686b5c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODFiNDA1ODI4ZmQwZDNkY2EzZWFmNzE1ZTIwMDhlN2E5NTY4NmI1Yw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-09-24T12:45:13Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-09-24T12:45:13Z"}, "message": "re PR middle-end/91866 (Sign extend of an int is not recognized)\n\n\tPR middle-end/91866\n\t* match.pd (((T)(A)) + CST -> (T)(A + CST)): Formatting fix.\n\t(((T)(A + CST1)) + CST2 -> (T)(A) + (T)CST1 + CST2): New optimization.\n\n\t* gcc.dg/tree-ssa/pr91866.c: New test.\n\nFrom-SVN: r276096", "tree": {"sha": "d35d8e4843a77813cecf244387d270f8956e49ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d35d8e4843a77813cecf244387d270f8956e49ea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/81b405828fd0d3dca3eaf715e2008e7a95686b5c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81b405828fd0d3dca3eaf715e2008e7a95686b5c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81b405828fd0d3dca3eaf715e2008e7a95686b5c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81b405828fd0d3dca3eaf715e2008e7a95686b5c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "90acd49f6ba247e4549224c2178910aee95a2617", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90acd49f6ba247e4549224c2178910aee95a2617", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90acd49f6ba247e4549224c2178910aee95a2617"}], "stats": {"total": 42, "additions": 40, "deletions": 2}, "files": [{"sha": "ec00174d26dd112a40003002e1b4c19b4e1d58cb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=81b405828fd0d3dca3eaf715e2008e7a95686b5c", "patch": "@@ -1,3 +1,9 @@\n+2019-09-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/91866\n+\t* match.pd (((T)(A)) + CST -> (T)(A + CST)): Formatting fix.\n+\t(((T)(A + CST1)) + CST2 -> (T)(A) + (T)CST1 + CST2): New optimization.\n+\n 2019-09-24  Martin Liska  <mliska@suse.cz>\n \n \t* cfgexpand.c (gimple_assign_rhs_to_tree): Use switch statement"}, {"sha": "23ce376802f670dccf2c008cd43410db00aecfab", "filename": "gcc/match.pd", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=81b405828fd0d3dca3eaf715e2008e7a95686b5c", "patch": "@@ -2265,8 +2265,9 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n \t\t\t  max_ovf = wi::OVF_OVERFLOW;\n         tree inner_type = TREE_TYPE (@0);\n \n-        wide_int w1 = wide_int::from (wi::to_wide (@1), TYPE_PRECISION (inner_type),\n-\t    TYPE_SIGN (inner_type));\n+\twide_int w1\n+\t  = wide_int::from (wi::to_wide (@1), TYPE_PRECISION (inner_type),\n+\t\t\t    TYPE_SIGN (inner_type));\n \n         wide_int wmin0, wmax0;\n         if (get_range_info (@0, &wmin0, &wmax0) == VR_RANGE)\n@@ -2280,6 +2281,20 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n      )))\n #endif\n \n+/* ((T)(A + CST1)) + CST2 -> (T)(A) + (T)CST1 + CST2  */\n+#if GIMPLE\n+  (for op (plus minus)\n+   (simplify\n+    (plus (convert:s (op:s @0 INTEGER_CST@1)) INTEGER_CST@2)\n+     (if (TREE_CODE (TREE_TYPE (@0)) == INTEGER_TYPE\n+\t  && TREE_CODE (type) == INTEGER_TYPE\n+\t  && TYPE_PRECISION (type) > TYPE_PRECISION (TREE_TYPE (@0))\n+\t  && TYPE_OVERFLOW_UNDEFINED (TREE_TYPE (@0))\n+\t  && !TYPE_OVERFLOW_SANITIZED (TREE_TYPE (@0))\n+\t  && TYPE_OVERFLOW_WRAPS (type))\n+       (plus (convert @0) (op @2 (convert @1))))))\n+#endif\n+\n   /* ~A + A -> -1 */\n   (simplify\n    (plus:c (bit_not @0) @0)"}, {"sha": "582a2a4c69f03948252a1b136cf9632b3fe6e74b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=81b405828fd0d3dca3eaf715e2008e7a95686b5c", "patch": "@@ -1,3 +1,8 @@\n+2019-09-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/91866\n+\t* gcc.dg/tree-ssa/pr91866.c: New test.\n+\n 2019-09-24  Martin Jambor  <mjambor@suse.cz>\n \n \tPR ipa/91831"}, {"sha": "9f5bf197ff6fba256ba810e0b11c73b762eba5ba", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr91866.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr91866.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/81b405828fd0d3dca3eaf715e2008e7a95686b5c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr91866.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr91866.c?ref=81b405828fd0d3dca3eaf715e2008e7a95686b5c", "patch": "@@ -0,0 +1,12 @@\n+/* PR middle-end/91866 */\n+/* { dg-do compile { target { ilp32 || lp64 } } } */\n+/* { dg-options \"-O2 -fdump-tree-optimized\" } * /\n+/* { dg-final { scan-tree-dump-times \" \\\\+ 11;\" 3 \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-times \" \\[+-] \\[0-9-]\\[0-9]*;\" 3 \"optimized\" } } */\n+/* { dg-final { scan-tree-dump-times \"\\\\(long long unsigned int\\\\) x_\" 5 \"optimized\" } } */\n+\n+unsigned long long f1 (int x) { return (x + 1) - 1ULL; }\n+unsigned long long f2 (int x) { return (x - 5) + 5ULL; }\n+unsigned long long f3 (int x) { return (x - 15) + 26ULL; }\n+unsigned long long f4 (int x) { return (x + 6) + 5ULL; }\n+unsigned long long f5 (int x) { return (x - (-1 - __INT_MAX__)) + 10ULL - __INT_MAX__; }"}]}