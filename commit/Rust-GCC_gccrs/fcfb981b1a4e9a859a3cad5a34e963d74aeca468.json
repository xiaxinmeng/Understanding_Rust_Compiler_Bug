{"sha": "fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmNmYjk4MWIxYTRlOWE4NTlhM2NhZDVhMzRlOTYzZDc0YWVjYTQ2OA==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-06-18T10:19:44Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-06-18T10:19:44Z"}, "message": "[multiple changes]\n\n2010-06-18  Geert Bosch  <bosch@adacore.com>\n\n\t* i-forbla-darwin.adb: Include -lgnala and -lm in linker options for\n\tDarwin.\n\n2010-06-18  Robert Dewar  <dewar@adacore.com>\n\n\t* gnat1drv.adb (Adjust_Global_Switches): Set Use_Expression_With_Actions\n\ttrue for gcc.\n\n2010-06-18  Robert Dewar  <dewar@adacore.com>\n\n\t* sprint.adb: Minor format change for N_Expression_With_Actions.\n\t* repinfo.adb: Minor reformatting.\n\n2010-06-18  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_elim.adb (Check_Eliminated): If within a subunit, use\n\tDefining_Entity to obtain the name of the entity in the proper body, to\n\tproperly handle both separate packages and subprograms.\n\n2010-06-18  Emmanuel Briot  <briot@adacore.com>\n\n\t* prj-nmsc.adb (Check_File): New parameter Display_Path.\n\nFrom-SVN: r160976", "tree": {"sha": "de1611efdafdfe9b61b3603d268702c9bb294dd7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de1611efdafdfe9b61b3603d268702c9bb294dd7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/comments", "author": null, "committer": null, "parents": [{"sha": "48b351d92433bfa82001f4b91f6d51fa017a7b95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48b351d92433bfa82001f4b91f6d51fa017a7b95", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48b351d92433bfa82001f4b91f6d51fa017a7b95"}], "stats": {"total": 76, "additions": 55, "deletions": 21}, "files": [{"sha": "5615848e10f945d7a4fde7d66773b3ec64c3b42a", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -1,3 +1,28 @@\n+2010-06-18  Geert Bosch  <bosch@adacore.com>\n+\n+\t* i-forbla-darwin.adb: Include -lgnala and -lm in linker options for\n+\tDarwin.\n+\n+2010-06-18  Robert Dewar  <dewar@adacore.com>\n+\n+\t* gnat1drv.adb (Adjust_Global_Switches): Set Use_Expression_With_Actions\n+\ttrue for gcc.\n+\n+2010-06-18  Robert Dewar  <dewar@adacore.com>\n+\n+\t* sprint.adb: Minor format change for N_Expression_With_Actions.\n+\t* repinfo.adb: Minor reformatting.\n+\n+2010-06-18  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_elim.adb (Check_Eliminated): If within a subunit, use\n+\tDefining_Entity to obtain the name of the entity in the proper body, to\n+\tproperly handle both separate packages and subprograms.\n+\n+2010-06-18  Emmanuel Briot  <briot@adacore.com>\n+\n+\t* prj-nmsc.adb (Check_File): New parameter Display_Path.\n+\n 2010-06-18  Thomas Quinot  <quinot@adacore.com>\n \n \t* g-socket.adb, g-socket.ads (Null_Selector): New object."}, {"sha": "2c95dd649613009ed4a52ee992e3654a5fe66a82", "filename": "gcc/ada/gnat1drv.adb", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fgnat1drv.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fgnat1drv.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgnat1drv.adb?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -353,11 +353,11 @@ procedure Gnat1drv is\n       then\n          Use_Expression_With_Actions := False;\n \n-         --  Otherwise normal gcc back end, for now still turn usage off by\n-         --  default.\n+         --  Otherwise normal gcc back end, which does implement this feature\n+         --  so by default we allow its use.\n \n       else\n-         Use_Expression_With_Actions := False;\n+         Use_Expression_With_Actions := True;\n       end if;\n \n       --  Set switch indicating if back end can handle limited types, and"}, {"sha": "825a8840414cf3cfe3f10ea83e7fa7220abe5120", "filename": "gcc/ada/i-forbla-darwin.adb", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fi-forbla-darwin.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fi-forbla-darwin.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fi-forbla-darwin.adb?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2006-2009, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2006-2010, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -32,5 +32,7 @@\n --  Version for Mac OS X\n \n package body Interfaces.Fortran.BLAS is\n+   pragma Linker_Options (\"-lgnala\");\n+   pragma Linker_Options (\"-lm\");\n    pragma Linker_Options (\"-Wl,-framework,vecLib\");\n end Interfaces.Fortran.BLAS;"}, {"sha": "0e8c041b9b95932f436116f2bd172992ac689ed5", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 20, "deletions": 12, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -298,6 +298,7 @@ package body Prj.Nmsc is\n       Data              : in out Tree_Processing_Data;\n       Source_Dir_Rank   : Natural;\n       Path              : Path_Name_Type;\n+      Display_Path      : Path_Name_Type;\n       File_Name         : File_Name_Type;\n       Display_File_Name : File_Name_Type;\n       Locally_Removed   : Boolean;\n@@ -307,11 +308,12 @@ package body Prj.Nmsc is\n    --  schemes, it is added to various htables through Add_Source and to\n    --  Source_Paths_Htable.\n    --\n-   --  Name is the name of the candidate file. It hasn't been normalized yet\n-   --  and is the direct result of readdir().\n+   --  File_Name is the same as Display_File_Name, but has been normalized.\n+   --  They do not include the directory information.\n    --\n-   --  File_Name is the same as Name, but has been normalized.\n-   --  Display_File_Name, however, has not been normalized.\n+   --  Path and Display_Path on the other hand are the full path to the file.\n+   --  Path must have been normalized (canonical casing and possibly links\n+   --  resolved).\n    --\n    --  Source_Directory is the directory in which the file was found. It is\n    --  neither normalized nor has had links resolved, and must not end with a\n@@ -6663,15 +6665,12 @@ package body Prj.Nmsc is\n       Data              : in out Tree_Processing_Data;\n       Source_Dir_Rank   : Natural;\n       Path              : Path_Name_Type;\n+      Display_Path      : Path_Name_Type;\n       File_Name         : File_Name_Type;\n       Display_File_Name : File_Name_Type;\n       Locally_Removed   : Boolean;\n       For_All_Sources   : Boolean)\n    is\n-      Canonical_Path : constant Path_Name_Type :=\n-                         Path_Name_Type\n-                           (Canonical_Case_File_Name (Name_Id (Path)));\n-\n       Name_Loc              : Name_Location :=\n                                 Source_Names_Htable.Get\n                                   (Project.Source_Names, File_Name);\n@@ -6721,11 +6720,11 @@ package body Prj.Nmsc is\n                Check_Name := True;\n \n             else\n-               Name_Loc.Source.Path := (Canonical_Path, Path);\n+               Name_Loc.Source.Path := (Path, Display_Path);\n \n                Source_Paths_Htable.Set\n                  (Data.Tree.Source_Paths_HT,\n-                  Canonical_Path,\n+                  Path,\n                   Name_Loc.Source);\n \n                --  Check if this is a subunit\n@@ -6734,7 +6733,7 @@ package body Prj.Nmsc is\n                  and then Name_Loc.Source.Kind = Impl\n                then\n                   Src_Ind := Sinput.P.Load_Project_File\n-                    (Get_Name_String (Canonical_Path));\n+                    (Get_Name_String (Path));\n \n                   if Sinput.P.Source_File_Is_Subunit (Src_Ind) then\n                      Override_Kind (Name_Loc.Source, Sep);\n@@ -6786,7 +6785,7 @@ package body Prj.Nmsc is\n                Display_File        => Display_File_Name,\n                Unit                => Unit,\n                Locally_Removed     => Locally_Removed,\n-               Path                => (Canonical_Path, Path));\n+               Path                => (Path, Display_Path));\n \n             --  If it is a source specified in a list, update the entry in\n             --  the Source_Names table.\n@@ -6930,11 +6929,20 @@ package body Prj.Nmsc is\n                               end if;\n                            end if;\n \n+                           --  Preserve the user's original casing and use of\n+                           --  links. The display_value (a directory) already\n+                           --  ends with a directory separator by construction,\n+                           --  so no need to add one.\n+\n+                           Get_Name_String (Element.Display_Value);\n+                           Get_Name_String_And_Append (Display_File_Name);\n+\n                            Check_File\n                              (Project           => Project,\n                               Source_Dir_Rank   => Num_Nod.Number,\n                               Data              => Data,\n                               Path              => Path,\n+                              Display_Path      => Name_Find,\n                               File_Name         => File_Name,\n                               Locally_Removed   => To_Remove,\n                               Display_File_Name => Display_File_Name,"}, {"sha": "362d1d8cead9c61b5fed087e352b0a915ac69acd", "filename": "gcc/ada/repinfo.adb", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Frepinfo.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Frepinfo.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frepinfo.adb?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 1999-2009, Free Software Foundation, Inc.         --\n+--          Copyright (C) 1999-2010, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -403,7 +403,6 @@ package body Repinfo is\n                   if List_Representation_Info >= 2 then\n                      List_Object_Info (E);\n                   end if;\n-\n                end if;\n \n                --  Recurse into nested package, but not if they are package"}, {"sha": "bb42159b99ea672a036363783385abc651bf8aa1", "filename": "gcc/ada/sem_elim.adb", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fsem_elim.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fsem_elim.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_elim.adb?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -299,7 +299,7 @@ package body Sem_Elim is\n             --  parsed as a child unit, but the current compilation unit is in\n             --  fact the parent in which the subunit is embedded. We must skip\n             --  the first name which is that of the subunit to match the pragma\n-            --  specification.\n+            --  specification. Body may be that of a package or subprogram.\n \n             declare\n                Par : Node_Id;\n@@ -308,7 +308,7 @@ package body Sem_Elim is\n                Par := Parent (E);\n                while Present (Par) loop\n                   if Nkind (Par) = N_Subunit then\n-                     if Chars (Defining_Unit_Name (Proper_Body (Par))) =\n+                     if Chars (Defining_Entity (Proper_Body (Par))) =\n                                                          Elmt.Unit_Name (Up)\n                      then\n                         Up := Up - 1;"}, {"sha": "b5e240c97ff5836823090c94ef4b26caa72020de", "filename": "gcc/ada/sprint.adb", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fsprint.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fcfb981b1a4e9a859a3cad5a34e963d74aeca468/gcc%2Fada%2Fsprint.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsprint.adb?ref=fcfb981b1a4e9a859a3cad5a34e963d74aeca468", "patch": "@@ -1537,7 +1537,7 @@ package body Sprint is\n \n          when N_Expression_With_Actions =>\n             Indent_Begin;\n-            Write_Indent_Str_Sloc (\"do\");\n+            Write_Indent_Str_Sloc (\"do \");\n             Indent_Begin;\n             Sprint_Node_List (Actions (Node));\n             Indent_End;"}]}