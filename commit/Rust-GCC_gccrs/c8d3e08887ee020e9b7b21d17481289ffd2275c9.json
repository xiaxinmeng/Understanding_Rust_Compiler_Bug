{"sha": "c8d3e08887ee020e9b7b21d17481289ffd2275c9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzhkM2UwODg4N2VlMDIwZTliN2IyMWQxNzQ4MTI4OWZmZDIyNzVjOQ==", "commit": {"author": {"name": "Anton Blanchard", "email": "anton@samba.org", "date": "2016-01-21T17:32:28Z"}, "committer": {"name": "William Schmidt", "email": "wschmidt@gcc.gnu.org", "date": "2016-01-21T17:32:28Z"}, "message": "re PR target/63354 (gcc -pg -mprofile-kernel creates unused stack frames on leaf functions on ppc64le)\n\n[gcc]\n\n2016-01-21  Anton Blanchard  <anton@samba.org>\n\t    Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR target/63354\n\t* config/rs6000/linux64.h (TARGET_KEEP_LEAF_WHEN_PROFILED): New\n\t#define.\n\t* config/rs6000/rs6000.c (rs6000_keep_leaf_when_profiled): New\n\tfunction.\n\n[gcc/testsuite]\n\n2016-01-21  Anton Blanchard  <anton@samba.org>\n\t    Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n\n\tPR target/63354\n\t* gcc.target/powerpc/pr63354.c:  New test.\n\n\nCo-Authored-By: Bill Schmidt <wschmidt@linux.vnet.ibm.com>\n\nFrom-SVN: r232684", "tree": {"sha": "7c5dbd506d83da38a40f3e5ca1b6772aae479b8e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c5dbd506d83da38a40f3e5ca1b6772aae479b8e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c8d3e08887ee020e9b7b21d17481289ffd2275c9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8d3e08887ee020e9b7b21d17481289ffd2275c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8d3e08887ee020e9b7b21d17481289ffd2275c9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8d3e08887ee020e9b7b21d17481289ffd2275c9/comments", "author": {"login": "antonblanchard", "id": 2029971, "node_id": "MDQ6VXNlcjIwMjk5NzE=", "avatar_url": "https://avatars.githubusercontent.com/u/2029971?v=4", "gravatar_id": "", "url": "https://api.github.com/users/antonblanchard", "html_url": "https://github.com/antonblanchard", "followers_url": "https://api.github.com/users/antonblanchard/followers", "following_url": "https://api.github.com/users/antonblanchard/following{/other_user}", "gists_url": "https://api.github.com/users/antonblanchard/gists{/gist_id}", "starred_url": "https://api.github.com/users/antonblanchard/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/antonblanchard/subscriptions", "organizations_url": "https://api.github.com/users/antonblanchard/orgs", "repos_url": "https://api.github.com/users/antonblanchard/repos", "events_url": "https://api.github.com/users/antonblanchard/events{/privacy}", "received_events_url": "https://api.github.com/users/antonblanchard/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b638c908a7f43892dfe69f58d83cff2ca0a5872b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b638c908a7f43892dfe69f58d83cff2ca0a5872b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b638c908a7f43892dfe69f58d83cff2ca0a5872b"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "ab7dc3a4efa5e62a7e3e5ae376a684a76fa3a673", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c8d3e08887ee020e9b7b21d17481289ffd2275c9", "patch": "@@ -1,3 +1,12 @@\n+2016-01-21  Anton Blanchard  <anton@samba.org>\n+\t    Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR target/63354\n+\t* config/rs6000/linux64.h (TARGET_KEEP_LEAF_WHEN_PROFILED): New\n+\t#define.\n+\t* config/rs6000/rs6000.c (rs6000_keep_leaf_when_profiled): New\n+\tfunction.\n+\n 2016-01-21  Ajit Agarwal  <ajitkum@xilinx.com>\n \n \t* config/microblaze/microblaze.c"}, {"sha": "fefa0c4eef305fc756e6ada67f6c2fd6dfdc569b", "filename": "gcc/config/rs6000/linux64.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Fconfig%2Frs6000%2Flinux64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Fconfig%2Frs6000%2Flinux64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Flinux64.h?ref=c8d3e08887ee020e9b7b21d17481289ffd2275c9", "patch": "@@ -59,6 +59,9 @@ extern int dot_symbols;\n \n #define TARGET_PROFILE_KERNEL profile_kernel\n \n+#undef TARGET_KEEP_LEAF_WHEN_PROFILED\n+#define TARGET_KEEP_LEAF_WHEN_PROFILED rs6000_keep_leaf_when_profiled\n+\n #define TARGET_USES_LINUX64_OPT 1\n #ifdef HAVE_LD_LARGE_TOC\n #undef TARGET_CMODEL"}, {"sha": "4c70f67b0a8353e24e1f9cdcf366d7f461e90625", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=c8d3e08887ee020e9b7b21d17481289ffd2275c9", "patch": "@@ -26237,6 +26237,14 @@ rs6000_output_function_prologue (FILE *file,\n   rs6000_pic_labelno++;\n }\n \n+/* -mprofile-kernel code calls mcount before the function prolog,\n+   so a profiled leaf function should stay a leaf function.  */\n+static bool\n+rs6000_keep_leaf_when_profiled ()\n+{\n+  return TARGET_PROFILE_KERNEL;\n+}\n+\n /* Non-zero if vmx regs are restored before the frame pop, zero if\n    we restore after the pop when possible.  */\n #define ALWAYS_RESTORE_ALTIVEC_BEFORE_POP 0"}, {"sha": "35fb4fc7762d6b4448201f25a7a941b4adcda56e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c8d3e08887ee020e9b7b21d17481289ffd2275c9", "patch": "@@ -1,3 +1,9 @@\n+2016-01-21  Anton Blanchard  <anton@samba.org>\n+\t    Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+\n+\tPR target/63354\n+\t* gcc.target/powerpc/pr63354.c:  New test.\n+\n 2016-01-21  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR rtl-optimization/68990"}, {"sha": "dd2858336e96cec6a712a0150189b52716f81207", "filename": "gcc/testsuite/gcc.target/powerpc/pr63354.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr63354.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c8d3e08887ee020e9b7b21d17481289ffd2275c9/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr63354.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr63354.c?ref=c8d3e08887ee020e9b7b21d17481289ffd2275c9", "patch": "@@ -0,0 +1,11 @@\n+/* Verify that we don't stack a frame for leaf functions when using\n+   -pg -mprofile-kernel.  */\n+\n+/* { dg-do compile { target { powerpc64*-*-* } } } */\n+/* { dg-options \"-O2 -pg -mprofile-kernel\" } */\n+/* { dg-final { scan-assembler-not \"mtlr\" } } */\n+\n+int foo(void)\n+{\n+  return 1;\n+}"}]}