{"sha": "ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmYxZmY5NjBmNTAzOWNmMWQyOTcwYmZlMmJhOTY1ZDFiOTk0Y2FmMQ==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2017-10-24T19:01:03Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2017-10-24T19:01:03Z"}, "message": "re PR c++/82466 (Missing warning for re-declaration of built-in function as variable)\n\n2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/82466\n\t* doc/invoke.texi ([Wbuiltin-declaration-mismatch]): Extend\n\tdescription.\n\n/cp\n2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/82466\n\t* decl.c (duplicate_decls): Warn for built-in functions declared as\n\tnon-function, use OPT_Wbuiltin_declaration_mismatch.\n\n\t* decl.c (duplicate_decls): Avoid redundant '+' in warning_at.\n\n/c\n2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/82466\n\t* c-decl.c (diagnose_mismatched_decls): Use\n\tOPT_Wbuiltin_declaration_mismatch.\n\n/testsuite\n2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/82466\n\t* c-c++-common/Wbuiltin-declaration-mismatch-1.c: New.\n\t* c-c++-common/Wno-builtin-declaration-mismatch-1.c: Likewise.\n\t* g++.dg/warn/Wbuiltin_declaration_mismatch-1.C: Likewise.\n\t* g++.dg/parse/builtin2.C: Adjust.\n\t* g++.old-deja/g++.mike/p811.C: Likewise.\n\nFrom-SVN: r254057", "tree": {"sha": "d7532f5e24aa854260ecf9ab34990aa58a76a622", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d7532f5e24aa854260ecf9ab34990aa58a76a622"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/comments", "author": null, "committer": null, "parents": [{"sha": "f9f43fb3a83af7dc6b2f89d6691ccd33b0b90196", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f9f43fb3a83af7dc6b2f89d6691ccd33b0b90196", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f9f43fb3a83af7dc6b2f89d6691ccd33b0b90196"}], "stats": {"total": 72, "additions": 63, "deletions": 9}, "files": [{"sha": "a27df40cd624ef6fbf92598c9609ea22f41021bd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1,3 +1,9 @@\n+2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/82466\n+\t* doc/invoke.texi ([Wbuiltin-declaration-mismatch]): Extend\n+\tdescription.\n+\n 2017-10-24  Wilco Dijkstra  <wdijkstr@arm.com>\n \n \tPR rtl-optimization/82396\n@@ -55,7 +61,7 @@\n \t* tree-outof-ssa.h (always_initialized_rtx_for_ssa_name_p): Delete.\n \t* expr.c (expand_expr_real_1) <expand_decl_rtl>: Revert latest change.\n \t* loop-iv.c (iv_get_reaching_def): Likewise.\n-\t* cfgexpand.c (expand_one_ssa_partition): Initialize the RTX if the \n+\t* cfgexpand.c (expand_one_ssa_partition): Initialize the RTX if the\n \tvariable is promoted and the partition contains undefined values.\n \n 2017-10-23  Sandra Loosemore  <sandra@codesourcery.com>\n@@ -76,7 +82,7 @@\n \t(nios2_symbolic_constant_allowed): New.\n \t(nios2_symbolic_constant_p): New.\n \t(nios2_plus_symbolic_constant_p): New.\n-\t(nios2_valid_addr_expr_p): Recognize addresses involving \n+\t(nios2_valid_addr_expr_p): Recognize addresses involving\n \tsymbolic constants.\n \t(nios2_legitimate_address_p): Likewise, also LO_SUM.\n \t(nios2_symbolic_memory_operand_p): New.\n@@ -157,7 +163,7 @@\n \t* i386.h (processor_costs): Remove sse_move; add xmm_move, ymm_move\n \tand zmm_move. Increase size of sse load and store tables;\n \tadd unaligned load and store tables; add ssemmx_to_integer.\n-\t* x86-tune-costs.h: Update all entries according to real \n+\t* x86-tune-costs.h: Update all entries according to real\n \tmove latencies from Agner Fog's manual and chip documentation.\n \n 2017-10-23  Jakub Jelinek  <jakub@redhat.com>"}, {"sha": "c260f62b11166edd133d7f8a95e7fac3f35e1ba9", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1,3 +1,9 @@\n+2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/82466\n+\t* c-decl.c (diagnose_mismatched_decls): Use\n+\tOPT_Wbuiltin_declaration_mismatch.\n+\n 2017-10-12  David Malcolm  <dmalcolm@redhat.com>\n \n \t* c-parser.c (c_parser_require): Add \"type_is_unique\" param and"}, {"sha": "5c472e66af8b363e63c0702e94a23c0a35861f0a", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1837,7 +1837,8 @@ diagnose_mismatched_decls (tree newdecl, tree olddecl,\n \t  locate_old_decl (olddecl);\n \t}\n       else if (TREE_PUBLIC (newdecl))\n-\twarning (0, \"built-in function %q+D declared as non-function\",\n+\twarning (OPT_Wbuiltin_declaration_mismatch,\n+\t\t \"built-in function %q+D declared as non-function\",\n \t\t newdecl);\n       else\n \twarning (OPT_Wshadow, \"declaration of %q+D shadows \""}, {"sha": "8c587a3e845db17ee925ede0d725fbaec00ac613", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1,3 +1,11 @@\n+2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/82466\n+\t* decl.c (duplicate_decls): Warn for built-in functions declared as\n+\tnon-function, use OPT_Wbuiltin_declaration_mismatch.\n+\n+\t* decl.c (duplicate_decls): Avoid redundant '+' in warning_at.\n+\n 2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/80991"}, {"sha": "bb48099da56cede342d430006726ddb906b1f153", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1431,7 +1431,15 @@ duplicate_decls (tree newdecl, tree olddecl, bool newdecl_is_friend)\n \t  /* Avoid warnings redeclaring built-ins which have not been\n \t     explicitly declared.  */\n \t  if (DECL_ANTICIPATED (olddecl))\n-\t    return NULL_TREE;\n+\t    {\n+\t      if (TREE_PUBLIC (newdecl)\n+\t\t  && CP_DECL_CONTEXT (newdecl) == global_namespace)\n+\t\twarning_at (DECL_SOURCE_LOCATION (newdecl),\n+\t\t\t    OPT_Wbuiltin_declaration_mismatch,\n+\t\t\t    \"built-in function %qD declared as non-function\",\n+\t\t\t    newdecl);\n+\t      return NULL_TREE;\n+\t    }\n \n \t  /* If you declare a built-in or predefined function name as static,\n \t     the old definition is overridden, but optionally warn this was a\n@@ -1522,7 +1530,7 @@ next_arg:;\n \n \t      warning_at (DECL_SOURCE_LOCATION (newdecl),\n \t\t\t  OPT_Wbuiltin_declaration_mismatch,\n-\t\t\t  \"declaration of %q+#D conflicts with built-in \"\n+\t\t\t  \"declaration of %q#D conflicts with built-in \"\n \t\t\t  \"declaration %q#D\", newdecl, olddecl);\n \t    }\n \t  else if ((DECL_EXTERN_C_P (newdecl)"}, {"sha": "71b2445f70fd5b832c68c08e69e71d8ecad37a4a", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -6320,7 +6320,8 @@ attributes.\n @item -Wno-builtin-declaration-mismatch\n @opindex Wno-builtin-declaration-mismatch\n @opindex Wbuiltin-declaration-mismatch\n-Warn if a built-in function is declared with the wrong signature.\n+Warn if a built-in function is declared with the wrong signature or \n+as non-function.\n This warning is enabled by default.\n \n @item -Wno-builtin-macro-redefined"}, {"sha": "7801c03d1d3f8a832de9dfec6648db8159b7a645", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1,3 +1,12 @@\n+2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/82466\n+\t* c-c++-common/Wbuiltin-declaration-mismatch-1.c: New.\n+\t* c-c++-common/Wno-builtin-declaration-mismatch-1.c: Likewise.\n+\t* g++.dg/warn/Wbuiltin_declaration_mismatch-1.C: Likewise.\n+\t* g++.dg/parse/builtin2.C: Adjust.\n+\t* g++.old-deja/g++.mike/p811.C: Likewise.\n+\n 2017-10-24  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/80991"}, {"sha": "63343b8bfeef259207d5f57e8f1292530f9dc916", "filename": "gcc/testsuite/c-c++-common/Wbuiltin-declaration-mismatch-1.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbuiltin-declaration-mismatch-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbuiltin-declaration-mismatch-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWbuiltin-declaration-mismatch-1.c?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -0,0 +1,4 @@\n+/* PR c++/82466 */\n+/* { dg-options \"-Wbuiltin-declaration-mismatch\" } */\n+\n+int printf;  /* { dg-warning \"declared as non-function\" } */"}, {"sha": "6409412ac6a423f2967e630d773494bac0abc342", "filename": "gcc/testsuite/c-c++-common/Wno-builtin-declaration-mismatch-1.c", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWno-builtin-declaration-mismatch-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWno-builtin-declaration-mismatch-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWno-builtin-declaration-mismatch-1.c?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -0,0 +1,4 @@\n+/* PR c++/82466 */\n+/* { dg-options \"-Wno-builtin-declaration-mismatch\" } */\n+\n+int printf;"}, {"sha": "daa80bb11b02ea3c236d46ea63a63be615cd3999", "filename": "gcc/testsuite/g++.dg/parse/builtin2.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbuiltin2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbuiltin2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fbuiltin2.C?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1,5 +1,5 @@\n // PR c++/14432\n-// { dg-options \"\" }\n+// { dg-options \"-Wno-builtin-declaration-mismatch\" }\n \n struct Y {}; \n Y y1; "}, {"sha": "713073cb421c615cc4208e3ccb695f71d492993f", "filename": "gcc/testsuite/g++.dg/warn/Wbuiltin_declaration_mismatch-1.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWbuiltin_declaration_mismatch-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWbuiltin_declaration_mismatch-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWbuiltin_declaration_mismatch-1.C?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/82466\n+// { dg-options \"-Wbuiltin-declaration-mismatch\" }\n+\n+namespace N\n+{\n+  int printf;\n+}"}, {"sha": "2ca04abdcba79a7015156b268e222bd90e56987b", "filename": "gcc/testsuite/g++.old-deja/g++.mike/p811.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fp811.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff1ff960f5039cf1d2970bfe2ba965d1b994caf1/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fp811.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.mike%2Fp811.C?ref=ff1ff960f5039cf1d2970bfe2ba965d1b994caf1", "patch": "@@ -1,5 +1,5 @@\n // { dg-do assemble  }\n-// { dg-options \"\" }\n+// { dg-options \"-Wno-builtin-declaration-mismatch\" }\n // This test case caused the compiler to abort at one point in time.\n // prms-id: 811\n "}]}