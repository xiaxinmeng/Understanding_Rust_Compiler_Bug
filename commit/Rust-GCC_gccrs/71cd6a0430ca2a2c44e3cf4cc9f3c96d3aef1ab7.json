{"sha": "71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "node_id": "C_kwDOANBUbNoAKDcxY2Q2YTA0MzBjYTJhMmM0NGUzY2Y0Y2M5ZjNjOTZkM2FlZjFhYjc", "commit": {"author": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2022-09-11T00:31:07Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2022-09-12T12:01:05Z"}, "message": "xtensa: gcc: fix builtin_apply return value\n\nxtensa may use up to 4 registers to return a value from a function, but\nrecognition of only one register in the xtensa_function_value_regno_p\nand missing untyped_call pattern result in that only one register is\nsaved by the __builtin_apply and returned by the __builtin_apply_return.\n\ngcc/\n\t* config/xtensa/xtensa.cc (xtensa_function_value_regno_p):\n\tRecognize all 4 return registers.\n\t* config/xtensa/xtensa.h (GP_RETURN_REG_COUNT): New definition.\n\t* config/xtensa/xtensa.md (untyped_call): New pattern.", "tree": {"sha": "748f105e56487b16d6df0e6173fe14bd460d7d62", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/748f105e56487b16d6df0e6173fe14bd460d7d62"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/comments", "author": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c092d894265f3db590585804c30c1ae3cb7b3773", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c092d894265f3db590585804c30c1ae3cb7b3773", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c092d894265f3db590585804c30c1ae3cb7b3773"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "f1b3331ea558cb6bfa785608ee69a64f608ccef1", "filename": "gcc/config/xtensa/xtensa.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/gcc%2Fconfig%2Fxtensa%2Fxtensa.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/gcc%2Fconfig%2Fxtensa%2Fxtensa.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.cc?ref=71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "patch": "@@ -4472,7 +4472,7 @@ xtensa_libcall_value (machine_mode mode, const_rtx fun ATTRIBUTE_UNUSED)\n static bool\n xtensa_function_value_regno_p (const unsigned int regno)\n {\n-  return (regno == GP_RETURN);\n+  return (regno >= GP_RETURN && regno < GP_RETURN + GP_RETURN_REG_COUNT);\n }\n \n /* The static chain is passed in memory.  Provide rtx giving 'mem'"}, {"sha": "16e3d55e89632ae6bb47f32354a1e10ea595a766", "filename": "gcc/config/xtensa/xtensa.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/gcc%2Fconfig%2Fxtensa%2Fxtensa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.h?ref=71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "patch": "@@ -488,6 +488,7 @@ enum reg_class\n    point, and values of coprocessor and user-defined modes.  */\n #define GP_RETURN (GP_REG_FIRST + 2 + WINDOW_SIZE)\n #define GP_OUTGOING_RETURN (GP_REG_FIRST + 2)\n+#define GP_RETURN_REG_COUNT 4\n \n /* Symbolic macros for the first/last argument registers.  */\n #define GP_ARG_FIRST (GP_REG_FIRST + 2)"}, {"sha": "608110c20bcb9c133090285f8ab6efcecd770e86", "filename": "gcc/config/xtensa/xtensa.md", "status": "modified", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7/gcc%2Fconfig%2Fxtensa%2Fxtensa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.md?ref=71cd6a0430ca2a2c44e3cf4cc9f3c96d3aef1ab7", "patch": "@@ -2305,6 +2305,27 @@\n    (set_attr \"mode\"\t\"none\")\n    (set_attr \"length\"\t\"3\")])\n \n+(define_expand \"untyped_call\"\n+  [(parallel [(call (match_operand 0 \"\")\n+\t\t    (const_int 0))\n+\t      (match_operand 1 \"\")\n+\t      (match_operand 2 \"\")])]\n+  \"\"\n+{\n+  int i;\n+\n+  emit_call_insn (gen_call (operands[0], const0_rtx));\n+\n+  for (i = 0; i < XVECLEN (operands[2], 0); i++)\n+    {\n+      rtx set = XVECEXP (operands[2], 0, i);\n+      emit_move_insn (SET_DEST (set), SET_SRC (set));\n+    }\n+\n+  emit_insn (gen_blockage ());\n+  DONE;\n+})\n+\n (define_insn \"entry\"\n   [(set (reg:SI A1_REG)\n \t(unspec_volatile:SI [(match_operand:SI 0 \"const_int_operand\" \"i\")]"}]}