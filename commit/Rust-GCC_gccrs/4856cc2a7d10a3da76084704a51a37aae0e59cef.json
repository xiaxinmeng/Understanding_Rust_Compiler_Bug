{"sha": "4856cc2a7d10a3da76084704a51a37aae0e59cef", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDg1NmNjMmE3ZDEwYTNkYTc2MDg0NzA0YTUxYTM3YWFlMGU1OWNlZg==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2012-10-02T08:10:54Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2012-10-02T08:10:54Z"}, "message": "sem_ch4.adb (Is_Empty_Range): Use bounds of index type to determine whether an array is empty when...\n\n2012-10-02  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch4.adb (Is_Empty_Range): Use bounds of index type\n\tto determine whether an array is empty when optimizing\n\ta quantified expression over a null range. Use of RM_Size\n\twas incorrect. Analyze condition before constant-folding the\n\texpression to catch potential errors. Modify the error message\n\tto avoid mathematical terminology.\n\nFrom-SVN: r191958", "tree": {"sha": "2377288705d822fe4345d9a763c34e97adda307d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2377288705d822fe4345d9a763c34e97adda307d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4856cc2a7d10a3da76084704a51a37aae0e59cef", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4856cc2a7d10a3da76084704a51a37aae0e59cef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4856cc2a7d10a3da76084704a51a37aae0e59cef", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4856cc2a7d10a3da76084704a51a37aae0e59cef/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "538dbb562fc7b3d8792477176eba628498f2ef18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/538dbb562fc7b3d8792477176eba628498f2ef18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/538dbb562fc7b3d8792477176eba628498f2ef18"}], "stats": {"total": 41, "additions": 31, "deletions": 10}, "files": [{"sha": "fa0c5153003703f58c5333948e677f61d2885fa4", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4856cc2a7d10a3da76084704a51a37aae0e59cef/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4856cc2a7d10a3da76084704a51a37aae0e59cef/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=4856cc2a7d10a3da76084704a51a37aae0e59cef", "patch": "@@ -1,3 +1,12 @@\n+2012-10-02  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch4.adb (Is_Empty_Range): Use bounds of index type\n+\tto determine whether an array is empty when optimizing\n+\ta quantified expression over a null range. Use of RM_Size\n+\twas incorrect. Analyze condition before constant-folding the\n+\texpression to catch potential errors. Modify the error message\n+\tto avoid mathematical terminology.\n+\n 2012-10-02  Robert Dewar  <dewar@adacore.com>\n \n \t* usage.adb, gnat_rm.texi, vms_data.ads: Add entry for"}, {"sha": "ef13222b83e40339092930e461c4ef69a003db4a", "filename": "gcc/ada/sem_ch4.adb", "status": "modified", "additions": 22, "deletions": 10, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4856cc2a7d10a3da76084704a51a37aae0e59cef/gcc%2Fada%2Fsem_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4856cc2a7d10a3da76084704a51a37aae0e59cef/gcc%2Fada%2Fsem_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch4.adb?ref=4856cc2a7d10a3da76084704a51a37aae0e59cef", "patch": "@@ -3404,27 +3404,37 @@ package body Sem_Ch4 is\n    procedure Analyze_Quantified_Expression (N : Node_Id) is\n       QE_Scop : Entity_Id;\n \n-      function  Is_Empty_Range (Typ : Entity_Id) return Boolean;\n+      function Is_Empty_Range (Typ : Entity_Id) return Boolean;\n       --  If the iterator is part of a quantified expression, and the range is\n       --  known to be statically empty, emit a warning and replace expression\n-      --  with its static value.\n+      --  with its static value. Returns True if the replacement occurs.\n \n-      function  Is_Empty_Range (Typ : Entity_Id) return Boolean is\n-         Loc     : constant Source_Ptr := Sloc (N);\n+      --------------------\n+      -- Is_Empty_Range --\n+      --------------------\n+\n+      function Is_Empty_Range (Typ : Entity_Id) return Boolean is\n+         Loc : constant Source_Ptr := Sloc (N);\n \n       begin\n          if Is_Array_Type (Typ)\n-           and then Size_Known_At_Compile_Time (Typ)\n-           and then RM_Size (Typ) = 0\n+           and then Compile_Time_Known_Bounds (Typ)\n+           and then\n+             (Expr_Value (Type_Low_Bound (Etype (First_Index (Typ))))\n+               > Expr_Value (Type_High_Bound (Etype (First_Index (Typ)))))\n          then\n+            Preanalyze_And_Resolve (Condition (N), Standard_Boolean);\n+\n             if All_Present (N) then\n-               Error_Msg_N (\"?universal quantified expression \"\n-               & \"over a null range has value True\", N);\n+               Error_Msg_N\n+                 (\"?quantified expression with ALL \"\n+                  & \"over a null range has value True\", N);\n                Rewrite (N, New_Occurrence_Of (Standard_True, Loc));\n \n             else\n-               Error_Msg_N (\"?existential quantified expression \"\n-               & \"over a null range has value False\", N);\n+               Error_Msg_N\n+                 (\"?quantified expression with SOME \"\n+                  & \"over a null range has value False\", N);\n                Rewrite (N, New_Occurrence_Of (Standard_False, Loc));\n             end if;\n \n@@ -3436,6 +3446,8 @@ package body Sem_Ch4 is\n          end if;\n       end Is_Empty_Range;\n \n+   --  Start of processing for Analyze_Quantified_Expression\n+\n    begin\n       Check_SPARK_Restriction (\"quantified expression is not allowed\", N);\n "}]}