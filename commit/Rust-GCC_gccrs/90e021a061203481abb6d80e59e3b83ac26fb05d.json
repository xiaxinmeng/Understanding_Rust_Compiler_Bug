{"sha": "90e021a061203481abb6d80e59e3b83ac26fb05d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTBlMDIxYTA2MTIwMzQ4MWFiYjZkODBlNTllM2I4M2FjMjZmYjA1ZA==", "commit": {"author": {"name": "Jason Thorpe", "email": "thorpej@wasabisystems.com", "date": "2002-10-18T23:10:35Z"}, "committer": {"name": "Jason Thorpe", "email": "thorpej@gcc.gnu.org", "date": "2002-10-18T23:10:35Z"}, "message": "netbsd.h (NETBSD_ENABLE_EXECUTE_STACK): Define __enable_execute_stack function.\n\n* config/netbsd.h (NETBSD_ENABLE_EXECUTE_STACK): Define\n__enable_execute_stack function.\n* config/alpha/netbsd.h (TRANSFER_FROM_TRAMPOLINE): Define\nas NETBSD_ENABLE_EXECUTE_STACK.\n* config/i386/netbsd-elf.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n* config/i386/netbsd.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n* config/i386/netbsd64.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n* config/sparc/netbsd-elf.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n* config/sparc/netbsd.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n\nFrom-SVN: r58292", "tree": {"sha": "c90e88bc94e69040ae166ca3c496a688057eb58c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c90e88bc94e69040ae166ca3c496a688057eb58c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/90e021a061203481abb6d80e59e3b83ac26fb05d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90e021a061203481abb6d80e59e3b83ac26fb05d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90e021a061203481abb6d80e59e3b83ac26fb05d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90e021a061203481abb6d80e59e3b83ac26fb05d/comments", "author": null, "committer": null, "parents": [{"sha": "5791cc29703f503573795fb2ddfad79fb99e8be3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5791cc29703f503573795fb2ddfad79fb99e8be3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5791cc29703f503573795fb2ddfad79fb99e8be3"}], "stats": {"total": 79, "additions": 79, "deletions": 0}, "files": [{"sha": "5ca6ddd6bf0eb299303426743d62000da93095b2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -1,3 +1,15 @@\n+2002-10-18  Jason Thorpe  <thorpej@wasabisystems.com>\n+\n+\t* config/netbsd.h (NETBSD_ENABLE_EXECUTE_STACK): Define \n+\t__enable_execute_stack function. \n+\t* config/alpha/netbsd.h (TRANSFER_FROM_TRAMPOLINE): Define\n+\tas NETBSD_ENABLE_EXECUTE_STACK.\n+\t* config/i386/netbsd-elf.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n+\t* config/i386/netbsd.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n+\t* config/i386/netbsd64.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n+\t* config/sparc/netbsd-elf.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n+\t* config/sparc/netbsd.h (TRANSFER_FROM_TRAMPOLINE): Ditto.\n+\n 2002-10-18  Jason Thorpe  <thorpej@wasabisystems.com>\n \n \t* config/i386/i386.c (x86_initialize_trampoline): Emit a call"}, {"sha": "4dc713ba537acac945c8176626c92d17aaabdf90", "filename": "gcc/config/alpha/netbsd.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Falpha%2Fnetbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Falpha%2Fnetbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Falpha%2Fnetbsd.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -75,5 +75,10 @@ Boston, MA 02111-1307, USA.  */\n    %{!shared:crtend%O%s} %{shared:crtendS%O%s}\"\n \n \n+/* Attempt to enable execute permissions on the stack.  */\n+\n+#define TRANSFER_FROM_TRAMPOLINE NETBSD_ENABLE_EXECUTE_STACK\n+\n+\n #undef TARGET_VERSION\n #define TARGET_VERSION fprintf (stderr, \" (NetBSD/alpha ELF)\");"}, {"sha": "4f49bd3e84fca424b6354618236ccea61347a274", "filename": "gcc/config/i386/netbsd-elf.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fi386%2Fnetbsd-elf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fi386%2Fnetbsd-elf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fnetbsd-elf.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -121,4 +121,7 @@ Boston, MA 02111-1307, USA.  */\n    we don't care about compatibility with older gcc versions.  */\n #define DEFAULT_PCC_STRUCT_RETURN 1\n \n+/* Attempt to enable execute permissions on the stack.  */\n+#define TRANSFER_FROM_TRAMPOLINE NETBSD_ENABLE_EXECUTE_STACK\n+\n #define TARGET_VERSION fprintf (stderr, \" (NetBSD/i386 ELF)\");"}, {"sha": "45ae893595e66e73d4aa21e09f613923a688b967", "filename": "gcc/config/i386/netbsd.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fi386%2Fnetbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fi386%2Fnetbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fnetbsd.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -67,3 +67,6 @@\n    prefix is added.  */\n #undef GOT_SYMBOL_NAME\n #define GOT_SYMBOL_NAME \"GLOBAL_OFFSET_TABLE_\"\n+\n+/* Attempt to enable execute permissions on the stack.  */\n+#define TRANSFER_FROM_TRAMPOLINE NETBSD_ENABLE_EXECUTE_STACK"}, {"sha": "341b6d1189b91da8ab080d7b1a803c6eb6b1f892", "filename": "gcc/config/i386/netbsd64.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fi386%2Fnetbsd64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fi386%2Fnetbsd64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fnetbsd64.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -69,5 +69,7 @@ Boston, MA 02111-1307, USA.  */\n     fprintf (FILE, \"\\tcall __mcount\\n\");\t\t\t\t\\\n }\n \n+/* Attempt to enable execute permissions on the stack.  */\n+#define TRANSFER_FROM_TRAMPOLINE NETBSD_ENABLE_EXECUTE_STACK\n \n #define TARGET_VERSION fprintf (stderr, \" (NetBSD/x86_64 ELF)\");"}, {"sha": "c83ff0f545ebdb95200c88d0be146494fa023b50", "filename": "gcc/config/netbsd.h", "status": "modified", "additions": 48, "deletions": 0, "changes": 48, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fnetbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fnetbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnetbsd.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -161,3 +161,51 @@ Boston, MA 02111-1307, USA.  */\n \n #undef WINT_TYPE\n #define WINT_TYPE \"int\"\n+\f\n+\n+/* Attempt to turn on execute permission for the stack.  This may be\n+   used by TRANSFER_FROM_TRAMPOLINE of the target needs it (that is,\n+   if the target machine can change execute permissions on a page).\n+\n+   There is no way to query the execute permission of the stack, so\n+   we always issue the mprotect() call.\n+\n+   Note that we go out of our way to use namespace-non-invasive calls\n+   here.  Unfortunately, there is no libc-internal name for mprotect().\n+\n+   Also note that no errors should be emitted by this code; it is considered\n+   dangerous for library calls to send messages to stdout/stderr.  */\n+\n+#define NETBSD_ENABLE_EXECUTE_STACK\t\t\t\t\t\\\n+extern void __enable_execute_stack (void *);\t\t\t\t\\\n+void\t\t\t\t\t\t\t\t\t\\\n+__enable_execute_stack (addr)\t\t\t\t\t\t\\\n+     void *addr;\t\t\t\t\t\t\t\\\n+{\t\t\t\t\t\t\t\t\t\\\n+  extern int mprotect (void *, size_t, int);\t\t\t\t\\\n+  extern int __sysctl (int *, unsigned int, void *, size_t *,\t\t\\\n+\t\t       void *, size_t);\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n+  static int size;\t\t\t\t\t\t\t\\\n+  static long mask;\t\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n+  char *page, *end;\t\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n+  if (size == 0)\t\t\t\t\t\t\t\\\n+    {\t\t\t\t\t\t\t\t\t\\\n+      int mib[2];\t\t\t\t\t\t\t\\\n+      size_t len;\t\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n+      mib[0] = 6; /* CTL_HW */\t\t\t\t\t\t\\\n+      mib[1] = 7; /* HW_PAGESIZE */\t\t\t\t\t\\\n+      len = sizeof (size);\t\t\t\t\t\t\\\n+      (void) __sysctl (mib, 2, &size, &len, NULL, 0);\t\t\t\\\n+      mask = ~((long) size - 1);\t\t\t\t\t\\\n+    }\t\t\t\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n+  page = (char *) (((long) addr) & mask);\t\t\t\t\\\n+  end  = (char *) ((((long) (addr + TRAMPOLINE_SIZE)) & mask) + size);\t\\\n+\t\t\t\t\t\t\t\t\t\\\n+  /* 7 == PROT_READ | PROT_WRITE | PROT_EXEC */\t\t\t\t\\\n+  (void) mprotect (page, end - page, 7);\t\t\t\t\\\n+}"}, {"sha": "10788f2ae3b0e7ee840d34b7dce3775673b241ca", "filename": "gcc/config/sparc/netbsd-elf.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fsparc%2Fnetbsd-elf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fsparc%2Fnetbsd-elf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fnetbsd-elf.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -102,6 +102,9 @@ Boston, MA 02111-1307, USA.  */\n \n #undef STDC_0_IN_SYSTEM_HEADERS\n \n+/* Attempt to enable execute permissions on the stack.  */\n+#define TRANSFER_FROM_TRAMPOLINE NETBSD_ENABLE_EXECUTE_STACK\n+\n #undef TARGET_VERSION\n #define TARGET_VERSION fprintf (stderr, \" (%s)\", TARGET_NAME);\n "}, {"sha": "284e288d5e41935e9e1fffd0782068e2d77525f6", "filename": "gcc/config/sparc/netbsd.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fsparc%2Fnetbsd.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/90e021a061203481abb6d80e59e3b83ac26fb05d/gcc%2Fconfig%2Fsparc%2Fnetbsd.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsparc%2Fnetbsd.h?ref=90e021a061203481abb6d80e59e3b83ac26fb05d", "patch": "@@ -44,3 +44,6 @@\n /* Until they use ELF or something that handles dwarf2 unwinds\n    and initialization stuff better.  */\n #define DWARF2_UNWIND_INFO 0\n+\n+/* Attempt to enable execute permissions on the stack.  */\n+#define TRANSFER_FROM_TRAMPOLINE NETBSD_ENABLE_EXECUTE_STACK"}]}