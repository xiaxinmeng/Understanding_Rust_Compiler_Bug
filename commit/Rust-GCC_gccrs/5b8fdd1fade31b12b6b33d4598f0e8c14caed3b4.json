{"sha": "5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWI4ZmRkMWZhZGUzMWIxMmI2YjMzZDQ1OThmMGU4YzE0Y2FlZDNiNA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-05-15T09:57:54Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-05-15T09:57:54Z"}, "message": "re PR fortran/27446 (ICE on OpenMP array REDUCTION clause)\n\n\tPR fortran/27446\n\t* trans-openmp.c (gfc_trans_omp_array_reduction): Ensure\n\tOMP_CLAUSE_REDUCTION_{INIT,MERGE} are set to BIND_EXPR.\n\nFrom-SVN: r113787", "tree": {"sha": "be5d403048ff99d6d1060ac0b9d66a4b664a4728", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be5d403048ff99d6d1060ac0b9d66a4b664a4728"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7e497d0c1f385c09cdf1e20afb02403f2132a8ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e497d0c1f385c09cdf1e20afb02403f2132a8ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e497d0c1f385c09cdf1e20afb02403f2132a8ee"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "f5c36e7a70414d7a8e587643857df266b05f3763", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4", "patch": "@@ -1,3 +1,9 @@\n+2006-05-15  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/27446\n+\t* trans-openmp.c (gfc_trans_omp_array_reduction): Ensure\n+\tOMP_CLAUSE_REDUCTION_{INIT,MERGE} are set to BIND_EXPR.\n+\n 2006-05-14  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* Make-lang.in (fortran/options.o): Depend on $(TARGET_H)."}, {"sha": "f33f1bd374104fff20e3184fc01f75894647e91a", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=5b8fdd1fade31b12b6b33d4598f0e8c14caed3b4", "patch": "@@ -262,7 +262,7 @@ gfc_trans_omp_array_reduction (tree c, gfc_symbol *sym, locus where)\n   gfc_symbol init_val_sym, outer_sym, intrinsic_sym;\n   gfc_expr *e1, *e2, *e3, *e4;\n   gfc_ref *ref;\n-  tree decl, backend_decl;\n+  tree decl, backend_decl, stmt;\n   locus old_loc = gfc_current_locus;\n   const char *iname;\n   try t;\n@@ -400,10 +400,22 @@ gfc_trans_omp_array_reduction (tree c, gfc_symbol *sym, locus where)\n   gcc_assert (t == SUCCESS);\n \n   /* Create the init statement list.  */\n-  OMP_CLAUSE_REDUCTION_INIT (c) = gfc_trans_assignment (e1, e2);\n+  pushlevel (0);\n+  stmt = gfc_trans_assignment (e1, e2);\n+  if (TREE_CODE (stmt) != BIND_EXPR)\n+    stmt = build3_v (BIND_EXPR, NULL, stmt, poplevel (1, 0, 0));\n+  else\n+    poplevel (0, 0, 0);\n+  OMP_CLAUSE_REDUCTION_INIT (c) = stmt;\n \n   /* Create the merge statement list.  */\n-  OMP_CLAUSE_REDUCTION_MERGE (c) = gfc_trans_assignment (e3, e4);\n+  pushlevel (0);\n+  stmt = gfc_trans_assignment (e3, e4);\n+  if (TREE_CODE (stmt) != BIND_EXPR)\n+    stmt = build3_v (BIND_EXPR, NULL, stmt, poplevel (1, 0, 0));\n+  else\n+    poplevel (0, 0, 0);\n+  OMP_CLAUSE_REDUCTION_MERGE (c) = stmt;\n \n   /* And stick the placeholder VAR_DECL into the clause as well.  */\n   OMP_CLAUSE_REDUCTION_PLACEHOLDER (c) = outer_sym.backend_decl;"}]}