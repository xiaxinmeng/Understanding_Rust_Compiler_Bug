{"sha": "10d6109fe183d984a0377a7afe2854a0d794ebeb", "node_id": "C_kwDOANBUbNoAKDEwZDYxMDlmZTE4M2Q5ODRhMDM3N2E3YWZlMjg1NGEwZDc5NGViZWI", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-09-19T07:59:01Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-09-20T17:33:32Z"}, "message": "frange::set_nonnegative should not contain -NAN.\n\nA specifically nonnegative range should not contain -NAN, otherwise\nsignbit_p() would return false, because we'd be unsure of the sign.\n\n\tPR 68097/tree-optimization\n\ngcc/ChangeLog:\n\n\t* value-range.cc (frange::set_nonnegative): Set +NAN.\n\t(range_tests_signed_zeros): New test.\n\t* value-range.h (frange::update_nan): New overload to set NAN sign.", "tree": {"sha": "33d9bf1ef1b19f9bc7f48ff129445a521b7c0ca9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33d9bf1ef1b19f9bc7f48ff129445a521b7c0ca9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/10d6109fe183d984a0377a7afe2854a0d794ebeb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10d6109fe183d984a0377a7afe2854a0d794ebeb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10d6109fe183d984a0377a7afe2854a0d794ebeb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10d6109fe183d984a0377a7afe2854a0d794ebeb/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d812e8cb2a920fd75768e16ca8ded59ad93c172f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d812e8cb2a920fd75768e16ca8ded59ad93c172f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d812e8cb2a920fd75768e16ca8ded59ad93c172f"}], "stats": {"total": 23, "additions": 23, "deletions": 0}, "files": [{"sha": "dc42b6d3120d2ac3f1c47d485e360a4b3894bd51", "filename": "gcc/value-range.cc", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10d6109fe183d984a0377a7afe2854a0d794ebeb/gcc%2Fvalue-range.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10d6109fe183d984a0377a7afe2854a0d794ebeb/gcc%2Fvalue-range.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-range.cc?ref=10d6109fe183d984a0377a7afe2854a0d794ebeb", "patch": "@@ -775,6 +775,10 @@ void\n frange::set_nonnegative (tree type)\n {\n   set (type, dconst0, dconstinf);\n+\n+  // Set +NAN as the only possibility.\n+  if (HONOR_NANS (type))\n+    update_nan (/*sign=*/0);\n }\n \n // Here we copy between any two irange's.  The ranges can be legacy or\n@@ -3823,6 +3827,11 @@ range_tests_signed_zeros ()\n   r1.update_nan ();\n   r0.intersect (r1);\n   ASSERT_TRUE (r0.known_isnan ());\n+\n+  r0.set_nonnegative (float_type_node);\n+  ASSERT_TRUE (r0.signbit_p (signbit) && !signbit);\n+  if (HONOR_NANS (float_type_node))\n+    ASSERT_TRUE (r0.maybe_isnan ());\n }\n \n static void"}, {"sha": "7d5584a9294cd9ae7009bedadb44a1c19e4d8f82", "filename": "gcc/value-range.h", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/10d6109fe183d984a0377a7afe2854a0d794ebeb/gcc%2Fvalue-range.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/10d6109fe183d984a0377a7afe2854a0d794ebeb/gcc%2Fvalue-range.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-range.h?ref=10d6109fe183d984a0377a7afe2854a0d794ebeb", "patch": "@@ -312,6 +312,7 @@ class frange : public vrange\n   const REAL_VALUE_TYPE &lower_bound () const;\n   const REAL_VALUE_TYPE &upper_bound () const;\n   void update_nan ();\n+  void update_nan (bool sign);\n   void clear_nan ();\n \n   // fpclassify like API\n@@ -1099,6 +1100,19 @@ frange::update_nan ()\n     verify_range ();\n }\n \n+// Like above, but set the sign of the NAN.\n+\n+inline void\n+frange::update_nan (bool sign)\n+{\n+  gcc_checking_assert (!undefined_p ());\n+  m_pos_nan = !sign;\n+  m_neg_nan = sign;\n+  normalize_kind ();\n+  if (flag_checking)\n+    verify_range ();\n+}\n+\n // Clear the NAN bit and adjust the range.\n \n inline void"}]}