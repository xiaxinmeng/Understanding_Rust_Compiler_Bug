{"sha": "764ecad43b6cac2d2eded706fccd29cc15481ad2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY0ZWNhZDQzYjZjYWMyZDJlZGVkNzA2ZmNjZDI5Y2MxNTQ4MWFkMg==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2019-01-07T08:10:08Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2019-01-07T08:10:08Z"}, "message": "[nvptx] Eliminate PTX_VECTOR_LENGTH\n\nRemove PTX_VECTOR_LENGTH and replace uses of it with PTX_DEFAULT_VECTOR_LENGTH,\nPTX_MAX_VECTOR_LENGTH and PTX_WARP_SIZE.\n\n2019-01-07  Tom de Vries  <tdevries@suse.de>\n\n\t* config/nvptx/nvptx.c (PTX_VECTOR_LENGTH): Remove.\n\t(PTX_DEFAULT_VECTOR_LENGTH, PTX_MAX_VECTOR_LENGTH): Define.\n\t(nvptx_goacc_validate_dims_1, nvptx_dim_limit)\n\t(nvptx_goacc_reduction_fini): Use PTX_DEFAULT_VECTOR_LENGTH,\n\tPTX_MAX_VECTOR_LENGTH and PTX_WARP_SIZE instead of PTX_VECTOR_LENGTH.\n\nFrom-SVN: r267626", "tree": {"sha": "dab5c71e8adfaedffcb2707b7b161558ae2ae651", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dab5c71e8adfaedffcb2707b7b161558ae2ae651"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/764ecad43b6cac2d2eded706fccd29cc15481ad2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/764ecad43b6cac2d2eded706fccd29cc15481ad2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/764ecad43b6cac2d2eded706fccd29cc15481ad2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/764ecad43b6cac2d2eded706fccd29cc15481ad2/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "21fbea5c338f96a5f291ca8e4bc68a4dfbf6af6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/21fbea5c338f96a5f291ca8e4bc68a4dfbf6af6d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/21fbea5c338f96a5f291ca8e4bc68a4dfbf6af6d"}], "stats": {"total": 23, "additions": 16, "deletions": 7}, "files": [{"sha": "fcaa91fffa09cf51d369e9e65d8712df4bf3bdaf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/764ecad43b6cac2d2eded706fccd29cc15481ad2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/764ecad43b6cac2d2eded706fccd29cc15481ad2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=764ecad43b6cac2d2eded706fccd29cc15481ad2", "patch": "@@ -1,3 +1,11 @@\n+2019-01-07  Tom de Vries  <tdevries@suse.de>\n+\n+\t* config/nvptx/nvptx.c (PTX_VECTOR_LENGTH): Remove.\n+\t(PTX_DEFAULT_VECTOR_LENGTH, PTX_MAX_VECTOR_LENGTH): Define.\n+\t(nvptx_goacc_validate_dims_1, nvptx_dim_limit)\n+\t(nvptx_goacc_reduction_fini): Use PTX_DEFAULT_VECTOR_LENGTH,\n+\tPTX_MAX_VECTOR_LENGTH and PTX_WARP_SIZE instead of PTX_VECTOR_LENGTH.\n+\n 2019-01-07  Tom de Vries  <tdevries@suse.de>\n \n \t* config/nvptx/nvptx.c (nvptx_goacc_validate_dims): Add asserts."}, {"sha": "3d680e9d80a7a8c3ab49a833c4e4c4cb680299c4", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/764ecad43b6cac2d2eded706fccd29cc15481ad2/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/764ecad43b6cac2d2eded706fccd29cc15481ad2/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=764ecad43b6cac2d2eded706fccd29cc15481ad2", "patch": "@@ -82,7 +82,8 @@\n #define WORKAROUND_PTXJIT_BUG_3 1\n \n #define PTX_WARP_SIZE 32\n-#define PTX_VECTOR_LENGTH 32\n+#define PTX_DEFAULT_VECTOR_LENGTH PTX_WARP_SIZE\n+#define PTX_MAX_VECTOR_LENGTH PTX_WARP_SIZE\n #define PTX_WORKER_LENGTH 32\n #define PTX_DEFAULT_RUNTIME_DIM 0 /* Defer to runtime.  */\n \n@@ -5376,14 +5377,14 @@ nvptx_goacc_validate_dims_1 (tree decl, int dims[], int fn_level)\n     }\n \n   if (dims[GOMP_DIM_VECTOR] >= 0\n-      && dims[GOMP_DIM_VECTOR] != PTX_VECTOR_LENGTH)\n+      && dims[GOMP_DIM_VECTOR] != PTX_WARP_SIZE)\n     {\n       warning_at (decl ? DECL_SOURCE_LOCATION (decl) : UNKNOWN_LOCATION, 0,\n \t\t  dims[GOMP_DIM_VECTOR]\n \t\t  ? G_(\"using vector_length (%d), ignoring %d\")\n \t\t  : G_(\"using vector_length (%d), ignoring runtime setting\"),\n-\t\t  PTX_VECTOR_LENGTH, dims[GOMP_DIM_VECTOR]);\n-      dims[GOMP_DIM_VECTOR] = PTX_VECTOR_LENGTH;\n+\t\t  PTX_DEFAULT_VECTOR_LENGTH, dims[GOMP_DIM_VECTOR]);\n+      dims[GOMP_DIM_VECTOR] = PTX_DEFAULT_VECTOR_LENGTH;\n     }\n \n   /* Check the num workers is not too large.  */\n@@ -5397,7 +5398,7 @@ nvptx_goacc_validate_dims_1 (tree decl, int dims[], int fn_level)\n \n   if (oacc_default_dims_p)\n     {\n-      dims[GOMP_DIM_VECTOR] = PTX_VECTOR_LENGTH;\n+      dims[GOMP_DIM_VECTOR] = PTX_DEFAULT_VECTOR_LENGTH;\n       if (dims[GOMP_DIM_WORKER] < 0)\n \tdims[GOMP_DIM_WORKER] = PTX_DEFAULT_RUNTIME_DIM;\n       if (dims[GOMP_DIM_GANG] < 0)\n@@ -5440,7 +5441,7 @@ nvptx_dim_limit (int axis)\n   switch (axis)\n     {\n     case GOMP_DIM_VECTOR:\n-      return PTX_VECTOR_LENGTH;\n+      return PTX_MAX_VECTOR_LENGTH;\n \n     default:\n       break;\n@@ -5937,7 +5938,7 @@ nvptx_goacc_reduction_fini (gcall *call)\n       /* Emit binary shuffle tree.  TODO. Emit this as an actual loop,\n \t but that requires a method of emitting a unified jump at the\n \t gimple level.  */\n-      for (int shfl = PTX_VECTOR_LENGTH / 2; shfl > 0; shfl = shfl >> 1)\n+      for (int shfl = PTX_WARP_SIZE / 2; shfl > 0; shfl = shfl >> 1)\n \t{\n \t  tree other_var = make_ssa_name (TREE_TYPE (var));\n \t  nvptx_generate_vector_shuffle (gimple_location (call),"}]}