{"sha": "2ab71f3d8707c9b292e5853050b5fbba2911fccb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmFiNzFmM2Q4NzA3YzliMjkyZTU4NTMwNTBiNWZiYmEyOTExZmNjYg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2017-10-09T22:32:01Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2017-10-09T22:32:01Z"}, "message": "except.c (setjmp_fn): New global variable.\n\n\t* except.c (setjmp_fn): New global variable.\n\t(init_eh): Initialize it if DONT_USE_BUILTIN_SETJMP is defined.\n\t(sjlj_emit_function_enter): Call it instead of BUILTIN_SETJMP if\n\tDONT_USE_BUILTIN_SETJMP is defined.\n\nFrom-SVN: r253569", "tree": {"sha": "df251f986249456032810cbe349db8303fe1659b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/df251f986249456032810cbe349db8303fe1659b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ab71f3d8707c9b292e5853050b5fbba2911fccb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ab71f3d8707c9b292e5853050b5fbba2911fccb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ab71f3d8707c9b292e5853050b5fbba2911fccb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ab71f3d8707c9b292e5853050b5fbba2911fccb/comments", "author": null, "committer": null, "parents": [{"sha": "3fc40cd783cb149d7d6c328def33606ec17ab15f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3fc40cd783cb149d7d6c328def33606ec17ab15f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3fc40cd783cb149d7d6c328def33606ec17ab15f"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "5ba4c6c1ff555a8eaf7e81fba3d8ce7ffab0407f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ab71f3d8707c9b292e5853050b5fbba2911fccb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ab71f3d8707c9b292e5853050b5fbba2911fccb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2ab71f3d8707c9b292e5853050b5fbba2911fccb", "patch": "@@ -1,3 +1,10 @@\n+2017-10-09  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* except.c (setjmp_fn): New global variable.\n+\t(init_eh): Initialize it if DONT_USE_BUILTIN_SETJMP is defined.\n+\t(sjlj_emit_function_enter): Call it instead of BUILTIN_SETJMP\n+\tif DONT_USE_BUILTIN_SETJMP is defined.\n+\n 2017-10-09  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* target.def (insn_cost): New hook."}, {"sha": "041f89a55e5bbce5b4c12f63d4a9db0962ff5b0a", "filename": "gcc/except.c", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ab71f3d8707c9b292e5853050b5fbba2911fccb/gcc%2Fexcept.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ab71f3d8707c9b292e5853050b5fbba2911fccb/gcc%2Fexcept.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexcept.c?ref=2ab71f3d8707c9b292e5853050b5fbba2911fccb", "patch": "@@ -147,7 +147,9 @@ along with GCC; see the file COPYING3.  If not see\n \n static GTY(()) int call_site_base;\n \n-static GTY (()) hash_map<tree_hash, tree> *type_to_runtime_map;\n+static GTY(()) hash_map<tree_hash, tree> *type_to_runtime_map;\n+\n+static GTY(()) tree setjmp_fn;\n \n /* Describe the SjLj_Function_Context structure.  */\n static GTY(()) tree sjlj_fc_type_node;\n@@ -331,6 +333,16 @@ init_eh (void)\n       sjlj_fc_jbuf_ofs\n \t= (tree_to_uhwi (DECL_FIELD_OFFSET (f_jbuf))\n \t   + tree_to_uhwi (DECL_FIELD_BIT_OFFSET (f_jbuf)) / BITS_PER_UNIT);\n+\n+#ifdef DONT_USE_BUILTIN_SETJMP\n+      tmp = build_function_type_list (integer_type_node, TREE_TYPE (f_jbuf),\n+\t\t\t\t      NULL);\n+      setjmp_fn = build_decl (BUILTINS_LOCATION, FUNCTION_DECL,\n+\t\t\t      get_identifier (\"setjmp\"), tmp);\n+      TREE_PUBLIC (setjmp_fn) = 1;\n+      DECL_EXTERNAL (setjmp_fn) = 1;\n+      DECL_ASSEMBLER_NAME (setjmp_fn);\n+#endif\n     }\n }\n \n@@ -1176,8 +1188,7 @@ sjlj_emit_function_enter (rtx_code_label *dispatch_label)\n       addr = convert_memory_address (ptr_mode, addr);\n       tree addr_tree = make_tree (ptr_type_node, addr);\n \n-      tree fn = builtin_decl_implicit (BUILT_IN_SETJMP);\n-      tree call_expr = build_call_expr (fn, 1, addr_tree);\n+      tree call_expr = build_call_expr (setjmp_fn, 1, addr_tree);\n       rtx x = expand_call (call_expr, NULL_RTX, false);\n \n       emit_cmp_and_jump_insns (x, const0_rtx, NE, 0,"}]}