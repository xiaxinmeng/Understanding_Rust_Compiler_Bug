{"sha": "b0ac84dc27874f5bd69255d55f909e240f0b45a5", "node_id": "C_kwDOANBUbNoAKGIwYWM4NGRjMjc4NzRmNWJkNjkyNTVkNTVmOTA5ZTI0MGYwYjQ1YTU", "commit": {"author": {"name": "liuhongt", "email": "hongtao.liu@intel.com", "date": "2021-09-22T01:54:08Z"}, "committer": {"name": "liuhongt", "email": "hongtao.liu@intel.com", "date": "2021-09-22T06:18:35Z"}, "message": "Support 64bit fma/fms/fnma/fnms under avx512vl.\n\ngcc/ChangeLog:\n\n\t* config/i386/i386.md (define_attr \"isa\"): Add\n\tfma_or_avx512vl.\n\t(define_attr \"enabled\"): Correspond fma_or_avx512vl to\n\tTARGET_FMA || TARGET_AVX512VL.\n\t* config/i386/mmx.md (fmav2sf4): Extend to AVX512 fma.\n\t(fmsv2sf4): Ditto.\n\t(fnmav2sf4): Ditto.\n\t(fnmsv2sf4): Ditto.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/i386/avx512vl-pr95046.c: New test.", "tree": {"sha": "d4877ab16a5048774f1ccca660045bd4f6d4c67f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d4877ab16a5048774f1ccca660045bd4f6d4c67f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0ac84dc27874f5bd69255d55f909e240f0b45a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0ac84dc27874f5bd69255d55f909e240f0b45a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0ac84dc27874f5bd69255d55f909e240f0b45a5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0ac84dc27874f5bd69255d55f909e240f0b45a5/comments", "author": {"login": "algebra84", "id": 22926165, "node_id": "MDQ6VXNlcjIyOTI2MTY1", "avatar_url": "https://avatars.githubusercontent.com/u/22926165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/algebra84", "html_url": "https://github.com/algebra84", "followers_url": "https://api.github.com/users/algebra84/followers", "following_url": "https://api.github.com/users/algebra84/following{/other_user}", "gists_url": "https://api.github.com/users/algebra84/gists{/gist_id}", "starred_url": "https://api.github.com/users/algebra84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/algebra84/subscriptions", "organizations_url": "https://api.github.com/users/algebra84/orgs", "repos_url": "https://api.github.com/users/algebra84/repos", "events_url": "https://api.github.com/users/algebra84/events{/privacy}", "received_events_url": "https://api.github.com/users/algebra84/received_events", "type": "User", "site_admin": false}, "committer": {"login": "algebra84", "id": 22926165, "node_id": "MDQ6VXNlcjIyOTI2MTY1", "avatar_url": "https://avatars.githubusercontent.com/u/22926165?v=4", "gravatar_id": "", "url": "https://api.github.com/users/algebra84", "html_url": "https://github.com/algebra84", "followers_url": "https://api.github.com/users/algebra84/followers", "following_url": "https://api.github.com/users/algebra84/following{/other_user}", "gists_url": "https://api.github.com/users/algebra84/gists{/gist_id}", "starred_url": "https://api.github.com/users/algebra84/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/algebra84/subscriptions", "organizations_url": "https://api.github.com/users/algebra84/orgs", "repos_url": "https://api.github.com/users/algebra84/repos", "events_url": "https://api.github.com/users/algebra84/events{/privacy}", "received_events_url": "https://api.github.com/users/algebra84/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0f4b73f4edf8fa2c24eb4402b1364a1ddb971565", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f4b73f4edf8fa2c24eb4402b1364a1ddb971565", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f4b73f4edf8fa2c24eb4402b1364a1ddb971565"}], "stats": {"total": 34, "additions": 25, "deletions": 9}, "files": [{"sha": "60d877668d59f488501fdeed88fd5fbe74741bd7", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0ac84dc27874f5bd69255d55f909e240f0b45a5/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0ac84dc27874f5bd69255d55f909e240f0b45a5/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=b0ac84dc27874f5bd69255d55f909e240f0b45a5", "patch": "@@ -832,7 +832,7 @@\n \t\t    x64_avx,x64_avx512bw,x64_avx512dq,\n \t\t    sse_noavx,sse2,sse2_noavx,sse3,sse3_noavx,sse4,sse4_noavx,\n \t\t    avx,noavx,avx2,noavx2,bmi,bmi2,fma4,fma,avx512f,noavx512f,\n-\t\t    avx512bw,noavx512bw,avx512dq,noavx512dq,\n+\t\t    avx512bw,noavx512bw,avx512dq,noavx512dq,fma_or_avx512vl,\n \t\t    avx512vl,noavx512vl,avxvnni,avx512vnnivl,avx512fp16\"\n   (const_string \"base\"))\n \n@@ -874,6 +874,8 @@\n \t (eq_attr \"isa\" \"bmi2\") (symbol_ref \"TARGET_BMI2\")\n \t (eq_attr \"isa\" \"fma4\") (symbol_ref \"TARGET_FMA4\")\n \t (eq_attr \"isa\" \"fma\") (symbol_ref \"TARGET_FMA\")\n+\t (eq_attr \"isa\" \"fma_or_avx512vl\")\n+\t   (symbol_ref \"TARGET_FMA || TARGET_AVX512VL\")\n \t (eq_attr \"isa\" \"avx512f\") (symbol_ref \"TARGET_AVX512F\")\n \t (eq_attr \"isa\" \"noavx512f\") (symbol_ref \"!TARGET_AVX512F\")\n \t (eq_attr \"isa\" \"avx512bw\") (symbol_ref \"TARGET_AVX512BW\")"}, {"sha": "b0093778fc6ae9ae023573a5b6a4241bfeb10fbc", "filename": "gcc/config/i386/mmx.md", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0ac84dc27874f5bd69255d55f909e240f0b45a5/gcc%2Fconfig%2Fi386%2Fmmx.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0ac84dc27874f5bd69255d55f909e240f0b45a5/gcc%2Fconfig%2Fi386%2Fmmx.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fmmx.md?ref=b0ac84dc27874f5bd69255d55f909e240f0b45a5", "patch": "@@ -1019,12 +1019,13 @@\n \t  (match_operand:V2SF 1 \"register_operand\" \"%0,v,x\")\n \t  (match_operand:V2SF 2 \"register_operand\" \"v,v,x\")\n \t  (match_operand:V2SF 3 \"register_operand\" \"v,0,x\")))]\n-  \"(TARGET_FMA || TARGET_FMA4) && TARGET_MMX_WITH_SSE\"\n+  \"(TARGET_FMA || TARGET_FMA4 || TARGET_AVX512VL)\n+   && TARGET_MMX_WITH_SSE\"\n   \"@\n    vfmadd132ps\\t{%2, %3, %0|%0, %3, %2}\n    vfmadd231ps\\t{%2, %1, %0|%0, %1, %2}\n    vfmaddps\\t{%3, %2, %1, %0|%0, %1, %2, %3}\"\n-  [(set_attr \"isa\" \"fma,fma,fma4\")\n+  [(set_attr \"isa\" \"fma_or_avx512vl,fma_or_avx512vl,fma4\")\n    (set_attr \"type\" \"ssemuladd\")\n    (set_attr \"mode\" \"V4SF\")])\n \n@@ -1035,12 +1036,13 @@\n \t  (match_operand:V2SF   2 \"register_operand\" \"v,v,x\")\n \t  (neg:V2SF\n \t    (match_operand:V2SF 3 \"register_operand\" \"v,0,x\"))))]\n-  \"(TARGET_FMA || TARGET_FMA4) && TARGET_MMX_WITH_SSE\"\n+  \"(TARGET_FMA || TARGET_FMA4 || TARGET_AVX512VL)\n+   && TARGET_MMX_WITH_SSE\"\n   \"@\n    vfmsub132ps\\t{%2, %3, %0|%0, %3, %2}\n    vfmsub231ps\\t{%2, %1, %0|%0, %1, %2}\n    vfmsubps\\t{%3, %2, %1, %0|%0, %1, %2, %3}\"\n-  [(set_attr \"isa\" \"fma,fma,fma4\")\n+  [(set_attr \"isa\" \"fma_or_avx512vl,fma_or_avx512vl,fma4\")\n    (set_attr \"type\" \"ssemuladd\")\n    (set_attr \"mode\" \"V4SF\")])\n \n@@ -1051,12 +1053,13 @@\n \t    (match_operand:V2SF 1 \"register_operand\" \"%0,v,x\"))\n \t  (match_operand:V2SF   2 \"register_operand\" \"v,v,x\")\n \t  (match_operand:V2SF   3 \"register_operand\" \"v,0,x\")))]\n-  \"(TARGET_FMA || TARGET_FMA4) && TARGET_MMX_WITH_SSE\"\n+  \"(TARGET_FMA || TARGET_FMA4 || TARGET_AVX512VL)\n+   && TARGET_MMX_WITH_SSE\"\n   \"@\n    vfnmadd132ps\\t{%2, %3, %0|%0, %3, %2}\n    vfnmadd231ps\\t{%2, %1, %0|%0, %1, %2}\n    vfnmaddps\\t{%3, %2, %1, %0|%0, %1, %2, %3}\"\n-  [(set_attr \"isa\" \"fma,fma,fma4\")\n+  [(set_attr \"isa\" \"fma_or_avx512vl,fma_or_avx512vl,fma4\")\n    (set_attr \"type\" \"ssemuladd\")\n    (set_attr \"mode\" \"V4SF\")])\n \n@@ -1068,12 +1071,13 @@\n \t  (match_operand:V2SF   2 \"register_operand\" \"v,v,x\")\n \t  (neg:V2SF\n \t    (match_operand:V2SF 3 \"register_operand\" \"v,0,x\"))))]\n-  \"(TARGET_FMA || TARGET_FMA4) && TARGET_MMX_WITH_SSE\"\n+  \"(TARGET_FMA || TARGET_FMA4 || TARGET_AVX512VL)\n+   && TARGET_MMX_WITH_SSE\"\n   \"@\n    vfnmsub132ps\\t{%2, %3, %0|%0, %3, %2}\n    vfnmsub231ps\\t{%2, %1, %0|%0, %1, %2}\n    vfnmsubps\\t{%3, %2, %1, %0|%0, %1, %2, %3}\"\n-  [(set_attr \"isa\" \"fma,fma,fma4\")\n+  [(set_attr \"isa\" \"fma_or_avx512vl,fma_or_avx512vl,fma4\")\n    (set_attr \"type\" \"ssemuladd\")\n    (set_attr \"mode\" \"V4SF\")])\n "}, {"sha": "02204d0e3c20a23e75d140360e4950cad19089cc", "filename": "gcc/testsuite/gcc.target/i386/avx512vl-pr95046.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0ac84dc27874f5bd69255d55f909e240f0b45a5/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vl-pr95046.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0ac84dc27874f5bd69255d55f909e240f0b45a5/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vl-pr95046.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Favx512vl-pr95046.c?ref=b0ac84dc27874f5bd69255d55f909e240f0b45a5", "patch": "@@ -0,0 +1,10 @@\n+/* PR target/95046 */\n+/* { dg-do compile { target { ! ia32 } } } */\n+/* { dg-options \"-O3 -mavx512vl\" } */\n+\n+#include \"pr95046-3.c\"\n+\n+/* { dg-final { scan-assembler \"\\tvfmadd\\[123\\]+ps\" } } */\n+/* { dg-final { scan-assembler \"\\tvfmsub\\[123\\]+ps\" } } */\n+/* { dg-final { scan-assembler \"\\tvfnmadd\\[123\\]+ps\" } } */\n+/* { dg-final { scan-assembler \"\\tvfnmsub\\[123\\]+ps\" } } */"}]}