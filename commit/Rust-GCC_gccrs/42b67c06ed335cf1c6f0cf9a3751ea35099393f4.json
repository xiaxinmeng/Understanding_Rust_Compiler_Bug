{"sha": "42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDJiNjdjMDZlZDMzNWNmMWM2ZjBjZjlhMzc1MWVhMzUwOTkzOTNmNA==", "commit": {"author": {"name": "Paul Brook", "email": "paul@codesourcery.com", "date": "2005-12-29T15:23:23Z"}, "committer": {"name": "Paul Brook", "email": "pbrook@gcc.gnu.org", "date": "2005-12-29T15:23:23Z"}, "message": "m68k.h (RETURN_ADDR_RTX): Define.\n\n2005-12-29  Paul Brook  <paul@codesourcery.com>\n\n\t* config/m68k/m68k.h (RETURN_ADDR_RTX): Define.\n\t* config/m68k/m68k.c (m68k_initial_elimination_offset): Remove FIXME.\n\tInclude offset due to FIRST_PARM_OFFSET.\n\nFrom-SVN: r109147", "tree": {"sha": "8fda8b56306c02f457f73f7a57e9782141294a95", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8fda8b56306c02f457f73f7a57e9782141294a95"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/comments", "author": null, "committer": null, "parents": [{"sha": "1a50d5e9d2eee7a84abcdac1c856b663b4e96b70", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a50d5e9d2eee7a84abcdac1c856b663b4e96b70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a50d5e9d2eee7a84abcdac1c856b663b4e96b70"}], "stats": {"total": 25, "additions": 19, "deletions": 6}, "files": [{"sha": "32606d7694b9d63fd6f7e015be2081d923695401", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "patch": "@@ -1,3 +1,9 @@\n+2005-12-29  Paul Brook  <paul@codesourcery.com>\n+\n+\t* config/m68k/m68k.h (RETURN_ADDR_RTX): Define.\n+\t* config/m68k/m68k.c (m68k_initial_elimination_offset): Remove FIXME.\n+\tInclude offset due to FIRST_PARM_OFFSET.\n+\n 2005-12-29  Paul Brook  <paul@codesourcery.com>\n \n \t* config/m68k/lb1sf68.asm (__cmpdf2): Fix typo in immediate mask."}, {"sha": "0eb4736dcf37829e5dbb151dc816e7770e473735", "filename": "gcc/config/m68k/m68k.c", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/gcc%2Fconfig%2Fm68k%2Fm68k.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/gcc%2Fconfig%2Fm68k%2Fm68k.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fm68k.c?ref=42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "patch": "@@ -434,20 +434,21 @@ m68k_compute_frame_layout (void)\n HOST_WIDE_INT\n m68k_initial_elimination_offset (int from, int to)\n {\n-  /* FIXME: The correct offset to compute here would appear to be\n-       (frame_pointer_needed ? -UNITS_PER_WORD * 2 : -UNITS_PER_WORD);\n-     but for some obscure reason, this must be 0 to get correct code.  */\n+  int argptr_offset;\n+  /* The arg pointer points 8 bytes before the start of the arguments,\n+     as defined by FIRST_PARM_OFFSET.  This makes it coincident with the\n+     frame pointer in most frames.  */\n+  argptr_offset = frame_pointer_needed ? 0 : UNITS_PER_WORD;\n   if (from == ARG_POINTER_REGNUM && to == FRAME_POINTER_REGNUM)\n-    return 0;\n+    return argptr_offset;\n \n   m68k_compute_frame_layout ();\n \n   gcc_assert (to == STACK_POINTER_REGNUM);\n   switch (from)\n     {\n     case ARG_POINTER_REGNUM:\n-      return (current_frame.offset + current_frame.size\n-\t      + (frame_pointer_needed ? -UNITS_PER_WORD * 2 : -UNITS_PER_WORD));\n+      return current_frame.offset + current_frame.size - argptr_offset;\n     case FRAME_POINTER_REGNUM:\n       return current_frame.offset + current_frame.size;\n     default:"}, {"sha": "245747fcf5ce656e684662bf66d416851e9f44c9", "filename": "gcc/config/m68k/m68k.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/gcc%2Fconfig%2Fm68k%2Fm68k.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42b67c06ed335cf1c6f0cf9a3751ea35099393f4/gcc%2Fconfig%2Fm68k%2Fm68k.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fm68k%2Fm68k.h?ref=42b67c06ed335cf1c6f0cf9a3751ea35099393f4", "patch": "@@ -890,6 +890,12 @@ do { if (cc_prev_status.flags & CC_IN_68881)\t\t\t\\\n #define INCOMING_RETURN_ADDR_RTX \\\n   gen_rtx_MEM (VOIDmode, gen_rtx_REG (VOIDmode, STACK_POINTER_REGNUM))\n \n+/* After the prologue, RA is at 4(AP) in the current frame.  */\n+#define RETURN_ADDR_RTX(COUNT, FRAME)\t\t\t\t\t   \\\n+  ((COUNT) == 0\t\t\t\t\t\t\t\t   \\\n+   ? gen_rtx_MEM (Pmode, plus_constant (arg_pointer_rtx, UNITS_PER_WORD)) \\\n+   : gen_rtx_MEM (Pmode, plus_constant (FRAME, UNITS_PER_WORD)))\n+\n /* We must not use the DBX register numbers for the DWARF 2 CFA column\n    numbers because that maps to numbers beyond FIRST_PSEUDO_REGISTER.\n    Instead use the identity mapping.  */"}]}