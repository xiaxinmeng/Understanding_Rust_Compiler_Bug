{"sha": "d05bdd90e646234d08ceb855f9b4ae06896f4337", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDA1YmRkOTBlNjQ2MjM0ZDA4Y2ViODU1ZjliNGFlMDY4OTZmNDMzNw==", "commit": {"author": {"name": "Yannick Moy", "email": "moy@adacore.com", "date": "2018-06-11T09:18:01Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-06-11T09:18:01Z"}, "message": "[Ada] Do not force Part_Of on generic units\n\nThis fixes the code checking SPARK RM 7.2.6(3) so that generic child units\nare not forced to use Part_Of to relate their abstract state to the state\nof their parent.\n\n2018-06-11  Yannick Moy  <moy@adacore.com>\n\ngcc/ada/\n\n\t* sem_prag.adb (Analyze_Part_Of): Only allow Part_Of on non-generic\n\tunit.\n\t(Check_Missing_Part_Of): Do not force Part_Of on generic unit.\n\ngcc/testsuite/\n\n\t* gnat.dg/part_of1-instantiation.adb,\n\tgnat.dg/part_of1-instantiation.ads,\n\tgnat.dg/part_of1-private_generic.adb,\n\tgnat.dg/part_of1-private_generic.ads, gnat.dg/part_of1.ads: New\n\ttestcase.\n\nFrom-SVN: r261412", "tree": {"sha": "d7a6b30d80bf275e88483ae67d9eca7601cd65b8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d7a6b30d80bf275e88483ae67d9eca7601cd65b8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d05bdd90e646234d08ceb855f9b4ae06896f4337", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d05bdd90e646234d08ceb855f9b4ae06896f4337", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d05bdd90e646234d08ceb855f9b4ae06896f4337", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d05bdd90e646234d08ceb855f9b4ae06896f4337/comments", "author": {"login": "yannickmoy", "id": 859440, "node_id": "MDQ6VXNlcjg1OTQ0MA==", "avatar_url": "https://avatars.githubusercontent.com/u/859440?v=4", "gravatar_id": "", "url": "https://api.github.com/users/yannickmoy", "html_url": "https://github.com/yannickmoy", "followers_url": "https://api.github.com/users/yannickmoy/followers", "following_url": "https://api.github.com/users/yannickmoy/following{/other_user}", "gists_url": "https://api.github.com/users/yannickmoy/gists{/gist_id}", "starred_url": "https://api.github.com/users/yannickmoy/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/yannickmoy/subscriptions", "organizations_url": "https://api.github.com/users/yannickmoy/orgs", "repos_url": "https://api.github.com/users/yannickmoy/repos", "events_url": "https://api.github.com/users/yannickmoy/events{/privacy}", "received_events_url": "https://api.github.com/users/yannickmoy/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "270c6b4d6f9300f36cb7e06594d71a62ab59af0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/270c6b4d6f9300f36cb7e06594d71a62ab59af0a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/270c6b4d6f9300f36cb7e06594d71a62ab59af0a"}], "stats": {"total": 85, "additions": 73, "deletions": 12}, "files": [{"sha": "3ab3de7d28c9126b8a83a2bde7628cf52fb6b14d", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -1,3 +1,9 @@\n+2018-06-11  Yannick Moy  <moy@adacore.com>\n+\n+\t* sem_prag.adb (Analyze_Part_Of): Only allow Part_Of on non-generic\n+\tunit.\n+\t(Check_Missing_Part_Of): Do not force Part_Of on generic unit.\n+\n 2018-06-11  Piotr Trojanek  <trojanek@adacore.com>\n \n \t* sem_ch13.adb (Analyze_Aspect_Specifications): Don't split AND THEN"}, {"sha": "3f58f570676704f9d16603c80e46655a5bb3d190", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 16, "deletions": 12, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -3200,20 +3200,21 @@ package body Sem_Prag is\n \n          --  The item appears in the visible state space of some package. In\n          --  general this scenario does not warrant Part_Of except when the\n-         --  package is a private child unit and the encapsulating state is\n-         --  declared in a parent unit or a public descendant of that parent\n-         --  unit.\n+         --  package is a non-generic private child unit and the encapsulating\n+         --  state is declared in a parent unit or a public descendant of that\n+         --  parent unit.\n \n          elsif Placement = Visible_State_Space then\n             if Is_Child_Unit (Pack_Id)\n+              and then not Is_Generic_Unit (Pack_Id)\n               and then Is_Private_Descendant (Pack_Id)\n             then\n                --  A variable or state abstraction which is part of the visible\n-               --  state of a private child unit or its public descendants must\n-               --  have its Part_Of indicator specified. The Part_Of indicator\n-               --  must denote a state declared by either the parent unit of\n-               --  the private unit or by a public descendant of that parent\n-               --  unit.\n+               --  state of a non-generic private child unit or its public\n+               --  descendants must have its Part_Of indicator specified. The\n+               --  Part_Of indicator must denote a state declared by either the\n+               --  parent unit of the private unit or by a public descendant of\n+               --  that parent unit.\n \n                --  Find the nearest private ancestor (which can be the current\n                --  unit itself).\n@@ -3250,8 +3251,9 @@ package body Sem_Prag is\n                   return;\n                end if;\n \n-            --  Indicator Part_Of is not needed when the related package is not\n-            --  a private child unit or a public descendant thereof.\n+            --  Indicator Part_Of is not needed when the related package is\n+            --  not a non-generic private child unit or a public descendant\n+            --  thereof.\n \n             else\n                SPARK_Msg_N\n@@ -28831,11 +28833,13 @@ package body Sem_Prag is\n \n       --  In general an item declared in the visible state space of a package\n       --  does not require a Part_Of indicator. The only exception is when the\n-      --  related package is a private child unit in which case Part_Of must\n-      --  denote a state in the parent unit or in one of its descendants.\n+      --  related package is a non-generic private child unit in which case\n+      --  Part_Of must denote a state in the parent unit or in one of its\n+      --  descendants.\n \n       elsif Placement = Visible_State_Space then\n          if Is_Child_Unit (Pack_Id)\n+           and then not Is_Generic_Unit (Pack_Id)\n            and then Is_Private_Descendant (Pack_Id)\n          then\n             --  A package instantiation does not need a Part_Of indicator when"}, {"sha": "7e8948e3151879ee95177e7cd377e79fc30e67b7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -1,3 +1,11 @@\n+2018-06-11  Yannick Moy  <moy@adacore.com>\n+\n+\t* gnat.dg/part_of1-instantiation.adb,\n+\tgnat.dg/part_of1-instantiation.ads,\n+\tgnat.dg/part_of1-private_generic.adb,\n+\tgnat.dg/part_of1-private_generic.ads, gnat.dg/part_of1.ads: New\n+\ttestcase.\n+\n 2018-06-11  Piotr Trojanek  <trojanek@adacore.com>\n \n \t* gnat.dg/contract1.adb: New testcase."}, {"sha": "0efc1deb9aa1cf221e1da2c5b276c924d5523cd3", "filename": "gcc/testsuite/gnat.dg/part_of1-instantiation.adb", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-instantiation.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-instantiation.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-instantiation.adb?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -0,0 +1,10 @@\n+--  { dg-do compile }\n+\n+with Part_Of1.Private_Generic;\n+\n+package body Part_Of1.Instantiation\n+with\n+   Refined_State => (State => Inst.State)\n+is\n+   package Inst is new Part_Of1.Private_Generic;\n+end Part_Of1.Instantiation;"}, {"sha": "1ad8a2a25ce98c05ddc543b9b11290692128ef0c", "filename": "gcc/testsuite/gnat.dg/part_of1-instantiation.ads", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-instantiation.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-instantiation.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-instantiation.ads?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -0,0 +1,6 @@\n+package Part_Of1.Instantiation\n+with\n+   Abstract_State => State\n+is\n+   pragma Elaborate_Body;\n+end Part_Of1.Instantiation;"}, {"sha": "ec1bba5e0b5991ba84701801816c3da7840297d2", "filename": "gcc/testsuite/gnat.dg/part_of1-private_generic.adb", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-private_generic.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-private_generic.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-private_generic.adb?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -0,0 +1,13 @@\n+package body Part_Of1.Private_Generic\n+with\n+   Refined_State => (State => Numbers)\n+is\n+   Numbers : array (Range_Type) of Integer := (others => 0);\n+\n+   function Get (I : Range_Type) return Integer\n+   is\n+   begin\n+      return Numbers (I);\n+   end Get;\n+\n+end Part_Of1.Private_Generic;"}, {"sha": "f6aacb54c68b788feb2570d23de311f7d5439e13", "filename": "gcc/testsuite/gnat.dg/part_of1-private_generic.ads", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-private_generic.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-private_generic.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1-private_generic.ads?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -0,0 +1,12 @@\n+private generic\n+   Count : Integer := 4;\n+package Part_Of1.Private_Generic\n+with\n+   Abstract_State => State\n+is\n+\n+   subtype Range_Type is Integer range 1 .. Count;\n+\n+   function Get (I : Range_Type) return Integer;\n+\n+end Part_Of1.Private_Generic;"}, {"sha": "edeabb2973abbf82f0f4de09d814be8eefa38153", "filename": "gcc/testsuite/gnat.dg/part_of1.ads", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d05bdd90e646234d08ceb855f9b4ae06896f4337/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fpart_of1.ads?ref=d05bdd90e646234d08ceb855f9b4ae06896f4337", "patch": "@@ -0,0 +1,2 @@\n+package Part_Of1 is\n+end Part_Of1;"}]}