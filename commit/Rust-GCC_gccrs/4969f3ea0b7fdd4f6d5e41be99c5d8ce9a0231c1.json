{"sha": "4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDk2OWYzZWEwYjdmZGQ0ZjZkNWU0MWJlOTljNWQ4Y2U5YTAyMzFjMQ==", "commit": {"author": {"name": "David Daney", "email": "ddaney@avtrex.com", "date": "2007-02-02T15:46:44Z"}, "committer": {"name": "David Daney", "email": "daney@gcc.gnu.org", "date": "2007-02-02T15:46:44Z"}, "message": "class.c (is_compiled_class): Move check to avoid reloading current class.\n\n\t* class.c (is_compiled_class): Move check to avoid reloading\n\tcurrent class.\n\t(layout_class_method): Don't calculate DECL_EXTERNAL if it is\n\talready set.\n\nFrom-SVN: r121506", "tree": {"sha": "2f554598619c543308411b92a4e22989468dc8c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2f554598619c543308411b92a4e22989468dc8c4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1/comments", "author": null, "committer": null, "parents": [{"sha": "c9d607421cc4eb4df08a495a6e075d11381cd13c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9d607421cc4eb4df08a495a6e075d11381cd13c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9d607421cc4eb4df08a495a6e075d11381cd13c"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "56ab178a1efc0d63b081b0d265926a941a13502f", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1", "patch": "@@ -1,3 +1,10 @@\n+2007-02-02  David Daney  <ddaney@avtrex.com>\n+\n+\t* class.c (is_compiled_class): Move check to avoid reloading\n+\tcurrent class.\n+\t(layout_class_method): Don't calculate DECL_EXTERNAL if it is\n+\talready set.\n+\n 2007-02-01  Andrew Haley  <aph@redhat.com>\n \n \tPR java/30641"}, {"sha": "7a14aca6496641951edc748a2c9640d1dc3311fa", "filename": "gcc/java/class.c", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1/gcc%2Fjava%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1/gcc%2Fjava%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Fclass.c?ref=4969f3ea0b7fdd4f6d5e41be99c5d8ce9a0231c1", "patch": "@@ -2134,10 +2134,6 @@ is_compiled_class (tree class)\n     return 1;\n   if (TYPE_ARRAY_P (class))\n     return 0;\n-  /* We have to check this explicitly to avoid trying to load a class\n-     that we're currently parsing.  */\n-  if (class == current_class)\n-    return 2;\n \n   seen_in_zip = (TYPE_JCF (class) && JCF_SEEN_IN_ZIP (TYPE_JCF (class)));\n   if (CLASS_FROM_CURRENTLY_COMPILED_P (class))\n@@ -2147,7 +2143,7 @@ is_compiled_class (tree class)\n \t been loaded already. Load it if necessary. This prevent\n \t build_class_ref () from crashing. */\n \n-      if (seen_in_zip && !CLASS_LOADED_P (class))\n+      if (seen_in_zip && !CLASS_LOADED_P (class) && (class != current_class))\n         load_class (class, 1);\n \n       /* We return 2 for class seen in ZIP and class from files\n@@ -2161,7 +2157,7 @@ is_compiled_class (tree class)\n \t{\n \t  if (CLASS_FROM_SOURCE_P (class))\n \t    safe_layout_class (class);\n-\t  else\n+\t  else if (class != current_class)\n \t    load_class (class, 1);\n \t}\n       return 1;\n@@ -2510,10 +2506,12 @@ layout_class_method (tree this_class, tree super_class,\n   tree method_name = DECL_NAME (method_decl);\n \n   TREE_PUBLIC (method_decl) = 1;\n+\n   /* Considered external unless it is being compiled into this object\n-     file.  */\n-  DECL_EXTERNAL (method_decl) = ((is_compiled_class (this_class) != 2)\n-\t\t\t\t || METHOD_NATIVE (method_decl));\n+     file, or it was already flagged as external.  */\n+  if (!DECL_EXTERNAL (method_decl))\n+    DECL_EXTERNAL (method_decl) = ((is_compiled_class (this_class) != 2)\n+                                   || METHOD_NATIVE (method_decl));\n \n   if (ID_INIT_P (method_name))\n     {"}]}