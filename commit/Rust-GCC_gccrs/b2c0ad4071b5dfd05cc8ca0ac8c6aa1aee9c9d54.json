{"sha": "b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjJjMGFkNDA3MWI1ZGZkMDVjYzhjYTBhYzhjNmFhMWFlZTljOWQ1NA==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@codesourcery.com", "date": "2006-04-17T12:45:25Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2006-04-17T12:45:25Z"}, "message": "cgraph.h (cgraph_edge_p): New.\n\n\t* cgraph.h (cgraph_edge_p): New.\n\tUpdate the prototype of cgraph_function_versioning.\n\t* cgraphunit.c (cgraph_copy_node_for_versioning,\n\tcgraph_function_versioning): Use VEC instead of VARRAY.\n\t* ipa-cp.c (ipcp_insert_stage): Likewise.\n\nFrom-SVN: r113006", "tree": {"sha": "735700184cbda1adba2eb633a9a335a4aba8db10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/735700184cbda1adba2eb633a9a335a4aba8db10"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/comments", "author": null, "committer": null, "parents": [{"sha": "1a5640b4e146e0a991b2172ccac9f0ae99e84ab5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a5640b4e146e0a991b2172ccac9f0ae99e84ab5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a5640b4e146e0a991b2172ccac9f0ae99e84ab5"}], "stats": {"total": 43, "additions": 27, "deletions": 16}, "files": [{"sha": "4f39d985657793e484e5cc673205ff6ee18a86fe", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "patch": "@@ -11,6 +11,12 @@\n \tVEC instead of VARRAY.\n \t(last_alias_set): Remove.\n \n+\t* cgraph.h (cgraph_edge_p): New.\n+\tUpdate the prototype of cgraph_function_versioning.\n+\t* cgraphunit.c (cgraph_copy_node_for_versioning,\n+\tcgraph_function_versioning): Use VEC instead of VARRAY.\n+\t* ipa-cp.c (ipcp_insert_stage): Likewise.\n+\n 2006-04-16  Roger Sayle  <roger@eyesopen.com>\n \n \tPR target/26961"}, {"sha": "8058d97c07968e936aaf0e7f8a499575ab3104b9", "filename": "gcc/cgraph.h", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2Fcgraph.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2Fcgraph.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.h?ref=b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "patch": "@@ -189,6 +189,11 @@ struct cgraph_edge GTY((chain_next (\"%h.next_caller\"), chain_prev (\"%h.prev_call\n   int loop_nest;\n };\n \n+typedef struct cgraph_edge *cgraph_edge_p;\n+\n+DEF_VEC_P(cgraph_edge_p);\n+DEF_VEC_ALLOC_P(cgraph_edge_p,heap);\n+\n /* The cgraph_varpool data structure.\n    Each static variable decl has assigned cgraph_varpool_node.  */\n \n@@ -307,7 +312,8 @@ void cgraph_build_static_cdtor (char which, tree body, int priority);\n void cgraph_reset_static_var_maps (void);\n void init_cgraph (void);\n struct cgraph_node *cgraph_function_versioning (struct cgraph_node *,\n-                                                varray_type, varray_type);\n+                                                VEC(cgraph_edge_p,heap)*,\n+\t\t\t\t\t\tvarray_type);\n void cgraph_analyze_function (struct cgraph_node *);\n struct cgraph_node *save_inline_function_body (struct cgraph_node *);\n "}, {"sha": "030f8681792a01b544349d93a8e7a7f1845777fa", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 9, "deletions": 10, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "patch": "@@ -1575,7 +1575,8 @@ update_call_expr (struct cgraph_node *new_version)\n \n static struct cgraph_node *\n cgraph_copy_node_for_versioning (struct cgraph_node *old_version,\n-\t\t\t\t tree new_decl, varray_type redirect_callers)\n+\t\t\t\t tree new_decl,\n+\t\t\t\t VEC(cgraph_edge_p,heap) *redirect_callers)\n  {\n    struct cgraph_node *new_version;\n    struct cgraph_edge *e, *new_e;\n@@ -1614,14 +1615,12 @@ cgraph_copy_node_for_versioning (struct cgraph_node *old_version,\n        if (!next_callee)\n \t break;\n      }\n-   if (redirect_callers)\n-     for (i = 0; i < VARRAY_ACTIVE_SIZE (redirect_callers); i++)\n-       {\n-         e = VARRAY_GENERIC_PTR (redirect_callers, i);\n-\t /* Redirect calls to the old version node\n-\t    to point to it's new version.  */\n-         cgraph_redirect_edge_callee (e, new_version);\n-       }\n+   for (i = 0; VEC_iterate (cgraph_edge_p, redirect_callers, i, e); i++)\n+     {\n+       /* Redirect calls to the old version node to point to its new\n+\t  version.  */\n+       cgraph_redirect_edge_callee (e, new_version);\n+     }\n \n    return new_version;\n  }\n@@ -1641,7 +1640,7 @@ cgraph_copy_node_for_versioning (struct cgraph_node *old_version,\n \n struct cgraph_node *\n cgraph_function_versioning (struct cgraph_node *old_version_node,\n-\t\t\t    varray_type redirect_callers,\n+\t\t\t    VEC(cgraph_edge_p,heap) *redirect_callers,\n \t\t\t    varray_type tree_map)\n {\n   tree old_decl = old_version_node->decl;"}, {"sha": "3837bfdc97ad326a7d5a6317aebf00153acbb76e", "filename": "gcc/ipa-cp.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2Fipa-cp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54/gcc%2Fipa-cp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-cp.c?ref=b2c0ad4071b5dfd05cc8ca0ac8c6aa1aee9c9d54", "patch": "@@ -1005,7 +1005,8 @@ ipcp_insert_stage (void)\n   struct cgraph_node *node, *node1 = NULL;\n   int i, const_param;\n   union parameter_info *cvalue;\n-  varray_type redirect_callers, replace_trees;\n+  VEC(cgraph_edge_p,heap) *redirect_callers;\n+  varray_type replace_trees;\n   struct cgraph_edge *cs;\n   int node_callers, count;\n   tree parm_tree;\n@@ -1045,15 +1046,14 @@ ipcp_insert_stage (void)\n       node_callers = 0;\n       for (cs = node->callers; cs != NULL; cs = cs->next_caller)\n \tnode_callers++;\n-      VARRAY_GENERIC_PTR_INIT (redirect_callers, node_callers,\n-\t\t\t       \"redirect_callers\");\n+      redirect_callers = VEC_alloc (cgraph_edge_p, heap, node_callers);\n       for (cs = node->callers; cs != NULL; cs = cs->next_caller)\n-\tVARRAY_PUSH_GENERIC_PTR (redirect_callers, cs);\n+\tVEC_quick_push (cgraph_edge_p, redirect_callers, cs);\n       /* Redirecting all the callers of the node to the\n          new versioned node.  */\n       node1 =\n \tcgraph_function_versioning (node, redirect_callers, replace_trees);\n-      VARRAY_CLEAR (redirect_callers);\n+      VEC_free (cgraph_edge_p, heap, redirect_callers);\n       VARRAY_CLEAR (replace_trees);\n       if (node1 == NULL)\n \tcontinue;"}]}