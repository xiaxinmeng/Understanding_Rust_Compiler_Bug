{"sha": "74f091d686a259e096d7fb316d3a2e60623cdd3d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzRmMDkxZDY4NmEyNTllMDk2ZDdmYjMxNmQzYTJlNjA2MjNjZGQzZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-04-12T10:53:47Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-04-12T10:53:47Z"}, "message": "re PR rtl-optimization/48549 (Combiner ICE with -g)\n\n\tPR rtl-optimization/48549\n\t* combine.c (propagate_for_debug): Also stop after BB_END of\n\tthis_basic_block.  Process LAST and just stop processing after it.\n\t(combine_instructions): If last_combined_insn has been deleted,\n\tset last_combined_insn to its PREV_INSN.\n\n\t* g++.dg/opt/pr48549.C: New test.\n\nFrom-SVN: r172311", "tree": {"sha": "9968c5e0e6d0256753bb87b2978322b8ad68df3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9968c5e0e6d0256753bb87b2978322b8ad68df3b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/74f091d686a259e096d7fb316d3a2e60623cdd3d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74f091d686a259e096d7fb316d3a2e60623cdd3d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74f091d686a259e096d7fb316d3a2e60623cdd3d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74f091d686a259e096d7fb316d3a2e60623cdd3d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f20ca7258739d74b12cf381293b10f72125732c5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f20ca7258739d74b12cf381293b10f72125732c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f20ca7258739d74b12cf381293b10f72125732c5"}], "stats": {"total": 91, "additions": 87, "deletions": 4}, "files": [{"sha": "6aea7a491f35c804989af0d3d22e4880f608a338", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=74f091d686a259e096d7fb316d3a2e60623cdd3d", "patch": "@@ -1,3 +1,11 @@\n+2011-04-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/48549\n+\t* combine.c (propagate_for_debug): Also stop after BB_END of\n+\tthis_basic_block.  Process LAST and just stop processing after it.\n+\t(combine_instructions): If last_combined_insn has been deleted,\n+\tset last_combined_insn to its PREV_INSN.\n+\n 2011-04-12  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/46076"}, {"sha": "23015fd9e6e0c9b90668f576448934c78b804ba5", "filename": "gcc/combine.c", "status": "modified", "additions": 11, "deletions": 4, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=74f091d686a259e096d7fb316d3a2e60623cdd3d", "patch": "@@ -1198,8 +1198,13 @@ combine_instructions (rtx f, unsigned int nregs)\n \t  next = 0;\n \t  if (NONDEBUG_INSN_P (insn))\n \t    {\n+\t      while (last_combined_insn\n+\t\t     && INSN_DELETED_P (last_combined_insn))\n+\t\tlast_combined_insn = PREV_INSN (last_combined_insn);\n \t      if (last_combined_insn == NULL_RTX\n-\t\t  || DF_INSN_LUID (last_combined_insn) < DF_INSN_LUID (insn))\n+\t\t  || BARRIER_P (last_combined_insn)\n+\t\t  || BLOCK_FOR_INSN (last_combined_insn) != this_basic_block\n+\t\t  || DF_INSN_LUID (last_combined_insn) <= DF_INSN_LUID (insn))\n \t\tlast_combined_insn = insn;\n \n \t      /* See if we know about function return values before this\n@@ -2446,19 +2451,21 @@ propagate_for_debug_subst (rtx from, const_rtx old_rtx, void *data)\n }\n \n /* Replace all the occurrences of DEST with SRC in DEBUG_INSNs between INSN\n-   and LAST.  */\n+   and LAST, not including INSN, but including LAST.  Also stop at the end\n+   of THIS_BASIC_BLOCK.  */\n \n static void\n propagate_for_debug (rtx insn, rtx last, rtx dest, rtx src)\n {\n-  rtx next, loc;\n+  rtx next, loc, end = NEXT_INSN (BB_END (this_basic_block));\n \n   struct rtx_subst_pair p;\n   p.to = src;\n   p.adjusted = false;\n \n   next = NEXT_INSN (insn);\n-  while (next != last)\n+  last = NEXT_INSN (last);\n+  while (next != last && next != end)\n     {\n       insn = next;\n       next = NEXT_INSN (insn);"}, {"sha": "3eb7c49ef7e2d3d58d2d3da1150bfa44e3765348", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=74f091d686a259e096d7fb316d3a2e60623cdd3d", "patch": "@@ -1,3 +1,8 @@\n+2011-04-12  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/48549\n+\t* g++.dg/opt/pr48549.C: New test.\n+\n 2011-04-12  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/46076"}, {"sha": "30799ee93f241b7d631b0c925af44020c5b0a98f", "filename": "gcc/testsuite/g++.dg/opt/pr48549.C", "status": "added", "additions": 63, "deletions": 0, "changes": 63, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr48549.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74f091d686a259e096d7fb316d3a2e60623cdd3d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr48549.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr48549.C?ref=74f091d686a259e096d7fb316d3a2e60623cdd3d", "patch": "@@ -0,0 +1,63 @@\n+// PR rtl-optimization/48549\n+// { dg-do compile }\n+// { dg-options \"-fcompare-debug -O2\" }\n+\n+void\n+foo (void *from, void *to)\n+{\n+  long offset = reinterpret_cast <long>(to) - reinterpret_cast <long>(from);\n+  if (offset != static_cast <int>(offset))\n+    *(int *) 0xC0DE = 0;\n+  reinterpret_cast <int *>(from)[1] = offset;\n+}\n+struct A\n+{\n+  A () : a () {}\n+  A (void *x) : a (x) {}\n+  void *bar () { return a; }\n+  void *a;\n+};\n+struct C;\n+struct D;\n+struct E : public A\n+{\n+  C m1 (int);\n+  D m2 ();\n+  E () {}\n+  E (A x) : A (x) {}\n+};\n+struct C : public E\n+{\n+  C () {}\n+  C (void *x) : E (x) {}\n+};\n+struct D : public E\n+{\n+  D (void *x) : E (x) {}\n+};\n+C\n+E::m1 (int x)\n+{\n+  return (reinterpret_cast <char *>(bar ()) + x);\n+}\n+D\n+E::m2 ()\n+{\n+  return reinterpret_cast <char *>(bar ());\n+}\n+struct B\n+{\n+  E a;\n+  unsigned b : 16;\n+  unsigned c : 1;\n+};\n+void\n+baz (B *x)\n+{\n+  for (unsigned i = 0; i < 64; i++)\n+    {\n+      D d = x[i].a.m2 ();\n+      C c = x[i].a.m1 (x[i].c);\n+      foo (d.bar (), c.bar ());\n+    }\n+}"}]}