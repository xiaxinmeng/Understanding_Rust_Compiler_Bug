{"sha": "276e31ec6eadb5318f9a826f36642a324668d796", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjc2ZTMxZWM2ZWFkYjUzMThmOWE4MjZmMzY2NDJhMzI0NjY4ZDc5Ng==", "commit": {"author": {"name": "Paolo Carlini", "email": "pcarlini@unitus.it", "date": "2002-07-07T10:15:06Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2002-07-07T10:15:06Z"}, "message": "re PR libstdc++/7186 (DR179 for std::deque::iterator and const_iterator)\n\n2002-07-07  Paolo Carlini  <pcarlini@unitus.it>\n\n\tPR libstdc++/7186\n\t* include/bits/stl_deque.h (_Deque_iterator::operator-):\n\tMake non-member, as already happens for the comparison\n\toperators in accord with DR179 (Ready).\n\t* testsuite/23_containers/deque_operators.cc: Add test02.\n\nFrom-SVN: r55301", "tree": {"sha": "121a8bcacd0f5614814348a2faf67819fe426ae8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/121a8bcacd0f5614814348a2faf67819fe426ae8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/276e31ec6eadb5318f9a826f36642a324668d796", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/276e31ec6eadb5318f9a826f36642a324668d796", "html_url": "https://github.com/Rust-GCC/gccrs/commit/276e31ec6eadb5318f9a826f36642a324668d796", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/276e31ec6eadb5318f9a826f36642a324668d796/comments", "author": null, "committer": null, "parents": [{"sha": "12f2f485a335fadb2d444b134e2eb0d795945e25", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/12f2f485a335fadb2d444b134e2eb0d795945e25", "html_url": "https://github.com/Rust-GCC/gccrs/commit/12f2f485a335fadb2d444b134e2eb0d795945e25"}], "stats": {"total": 51, "additions": 46, "deletions": 5}, "files": [{"sha": "874d673a65cf2a6063081af11b56d4f09a4c4e1f", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/276e31ec6eadb5318f9a826f36642a324668d796/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/276e31ec6eadb5318f9a826f36642a324668d796/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=276e31ec6eadb5318f9a826f36642a324668d796", "patch": "@@ -1,3 +1,11 @@\n+2002-07-07  Paolo Carlini  <pcarlini@unitus.it>\n+\n+\tPR libstdc++/7186\n+\t* include/bits/stl_deque.h (_Deque_iterator::operator-):\n+\tMake non-member, as already happens for the comparison\n+\toperators in accord with DR179 (Ready).\n+\t* testsuite/23_containers/deque_operators.cc: Add test02.\n+\n 2002-07-04  Benjamin Kosnik  <bkoz@redhat.com>\n             Jack Reeves  <jackw_reeves@hotmail.com>\n "}, {"sha": "cbf8ad345779af2c50981752acf26446a5290b16", "filename": "libstdc++-v3/include/bits/stl_deque.h", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/276e31ec6eadb5318f9a826f36642a324668d796/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_deque.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/276e31ec6eadb5318f9a826f36642a324668d796/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_deque.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_deque.h?ref=276e31ec6eadb5318f9a826f36642a324668d796", "patch": "@@ -132,11 +132,6 @@ template <typename _Tp, typename _Ref, typename _Ptr>\n   reference operator*() const { return *_M_cur; }\n   pointer operator->() const { return _M_cur; }\n \n-  difference_type operator-(const _Self& __x) const {\n-    return difference_type(_S_buffer_size()) * (_M_node - __x._M_node - 1) +\n-      (_M_cur - _M_first) + (__x._M_last - __x._M_cur);\n-  }\n-\n   _Self& operator++() {\n     ++_M_cur;\n     if (_M_cur == _M_last) {\n@@ -318,6 +313,22 @@ operator>=(const _Deque_iterator<_Tp, _RefL, _PtrL>& __x,\n   return !(__x < __y);\n }\n \n+// _GLIBCPP_RESOLVE_LIB_DEFECTS\n+// According to the resolution of DR179 not only the various comparison\n+// operators but also operator- must accept mixed iterator/const_iterator\n+// parameters.\n+template <typename _Tp, typename _RefL, typename _PtrL,\n+                        typename _RefR, typename _PtrR>\n+inline typename _Deque_iterator<_Tp, _RefL, _PtrL>::difference_type\n+operator-(const _Deque_iterator<_Tp, _RefL, _PtrL>& __x,\n+\t  const _Deque_iterator<_Tp, _RefR, _PtrR>& __y)\n+{\n+  return _Deque_iterator<_Tp, _RefL, _PtrL>::difference_type\n+    (_Deque_iterator<_Tp, _RefL, _PtrL>::_S_buffer_size()) *\n+    (__x._M_node - __y._M_node - 1) + (__x._M_cur - __x._M_first) +\n+    (__y._M_last - __y._M_cur);\n+}\n+\n template <typename _Tp, typename _Ref, typename _Ptr>\n inline _Deque_iterator<_Tp, _Ref, _Ptr>\n operator+(ptrdiff_t __n, const _Deque_iterator<_Tp, _Ref, _Ptr>& __x)"}, {"sha": "5463b47f1cb119c9a80d4e90f8a866594c180144", "filename": "libstdc++-v3/testsuite/23_containers/deque_operators.cc", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/276e31ec6eadb5318f9a826f36642a324668d796/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fdeque_operators.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/276e31ec6eadb5318f9a826f36642a324668d796/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fdeque_operators.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F23_containers%2Fdeque_operators.cc?ref=276e31ec6eadb5318f9a826f36642a324668d796", "patch": "@@ -56,8 +56,30 @@ void test01()\n   VERIFY( constend <= end );\n }\n \n+// libstdc++/7186\n+void test02()\n+{\n+  bool test = true;\n+\n+  std::deque<int> d(2);       \n+  typedef std::deque<int>::iterator iter;         \n+  typedef std::deque<int>::const_iterator constiter;\n+\n+  iter beg = d.begin();\n+  iter end = d.end();\n+  constiter constbeg = d.begin();\n+  constiter constend = d.end();\n+\n+  VERIFY( beg - constbeg == 0 );\n+  VERIFY( constend - end == 0 );\n+\n+  VERIFY( end - constbeg > 0 );\n+  VERIFY( constend - beg > 0 );\n+}\n+\n int main()\n {\n   test01();\n+  test02();\n   return 0;\n }"}]}