{"sha": "cf015ca24045bf34c6f22951d2d190eb31248d21", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2YwMTVjYTI0MDQ1YmYzNGM2ZjIyOTUxZDJkMTkwZWIzMTI0OGQyMQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-01-01T21:19:53Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-01-01T21:19:53Z"}, "message": "re PR fortran/82743 (uncaught character truncation in derived type initialization)\n\n2019-01-01  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/82743\n\t* primary.c (gfc_convert_to_structure_constructor): If a character\n\tin a constructor is too long, add a warning with\n\t-Wcharacter-truncation.\n\n2019-01-01  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/82743\n\t* gfortran.dg/structure_constructor_16.f90: New test.\n\nFrom-SVN: r267499", "tree": {"sha": "9c2c1f6c1a96bb6a3b4bef4e0117071bd257cd0a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c2c1f6c1a96bb6a3b4bef4e0117071bd257cd0a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf015ca24045bf34c6f22951d2d190eb31248d21", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf015ca24045bf34c6f22951d2d190eb31248d21", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf015ca24045bf34c6f22951d2d190eb31248d21", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf015ca24045bf34c6f22951d2d190eb31248d21/comments", "author": null, "committer": null, "parents": [{"sha": "730832cd7921eb240793634b86d3d026bba58117", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/730832cd7921eb240793634b86d3d026bba58117", "html_url": "https://github.com/Rust-GCC/gccrs/commit/730832cd7921eb240793634b86d3d026bba58117"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "245772de244e1509dd0b4ed3cfb31f2c7e8e39f1", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=cf015ca24045bf34c6f22951d2d190eb31248d21", "patch": "@@ -1,3 +1,10 @@\n+2019-01-01  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/82743\n+\t* primary.c (gfc_convert_to_structure_constructor): If a character\n+\tin a constructor is too long, add a  warning with\n+\t-Wcharacter-truncation.\n+\n 2019-01-01  Jakub Jelinek  <jakub@redhat.com>\n \n \tUpdate copyright years."}, {"sha": "19f97d1cb191a59d1bea0d3909d07c7119704798", "filename": "gcc/fortran/primary.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ffortran%2Fprimary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ffortran%2Fprimary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fprimary.c?ref=cf015ca24045bf34c6f22951d2d190eb31248d21", "patch": "@@ -3074,6 +3074,12 @@ gfc_convert_to_structure_constructor (gfc_expr *e, gfc_symbol *sym, gfc_expr **c\n \n \t      actual->expr->value.character.length = c;\n \t      actual->expr->value.character.string = dest;\n+\n+\t      if (warn_line_truncation && c < e)\n+\t\tgfc_warning_now (OPT_Wcharacter_truncation,\n+\t\t\t\t \"CHARACTER expression will be truncated \"\n+\t\t\t\t \"in constructor (%ld/%ld) at %L\", (long int) c,\n+\t\t\t\t (long int) e, &actual->expr->where);\n \t    }\n \t}\n "}, {"sha": "22534b93ecbca4baa2570ff4e65893859be4fb05", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cf015ca24045bf34c6f22951d2d190eb31248d21", "patch": "@@ -1,3 +1,8 @@\n+2019-01-01  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/82743\n+\t* gfortran.dg/structure_constructor_16.f90: New test.\n+\n 2019-01-01  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* g++.dg/ipa/devirt-36.C: Add dg-do-compile."}, {"sha": "93e8a3f77634b0ff9e0579299dde9e8ae3bfa488", "filename": "gcc/testsuite/gfortran.dg/structure_constructor_16.f90", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ftestsuite%2Fgfortran.dg%2Fstructure_constructor_16.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf015ca24045bf34c6f22951d2d190eb31248d21/gcc%2Ftestsuite%2Fgfortran.dg%2Fstructure_constructor_16.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fstructure_constructor_16.f90?ref=cf015ca24045bf34c6f22951d2d190eb31248d21", "patch": "@@ -0,0 +1,14 @@\n+! { dg-do compile }\n+! { dg-additional-options \"-Wcharacter-truncation\" }\n+! PR 82743 - warnings were missing on truncation of structure\n+! constructors.\n+! Original test case by Simon Kl\u00fcpfel\n+PROGRAM TEST\n+    TYPE A\n+        CHARACTER(LEN=1) :: C\n+    END TYPE A\n+    TYPE(A) :: A1\n+    A1=A(\"123\") ! { dg-warning \"CHARACTER expression will be truncated\" }\n+    A1=A(C=\"123\") ! { dg-warning \"CHARACTER expression will be truncated\" }\n+    A1%C=\"123\" ! { dg-warning \"CHARACTER expression will be truncated\" }\n+END PROGRAM TEST"}]}