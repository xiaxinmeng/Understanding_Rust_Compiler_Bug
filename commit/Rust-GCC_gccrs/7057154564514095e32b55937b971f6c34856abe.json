{"sha": "7057154564514095e32b55937b971f6c34856abe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzA1NzE1NDU2NDUxNDA5NWUzMmI1NTkzN2I5NzFmNmMzNDg1NmFiZQ==", "commit": {"author": {"name": "John David Anglin", "email": "dave.anglin@nrc.ca", "date": "2003-01-04T20:49:49Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2003-01-04T20:49:49Z"}, "message": "configure.in (LD): Improve test for gcc.\n\n\t* configure.in (LD): Improve test for gcc.  Try to set LD to the ld used\n\tby gcc if LD is not defined and we are not doing a Canadian Cross.\n\t* configure: Rebuilt.\n\nFrom-SVN: r60891", "tree": {"sha": "84483d536b187a91b8cda299e02b47d3cfeba6d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/84483d536b187a91b8cda299e02b47d3cfeba6d3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7057154564514095e32b55937b971f6c34856abe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7057154564514095e32b55937b971f6c34856abe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7057154564514095e32b55937b971f6c34856abe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7057154564514095e32b55937b971f6c34856abe/comments", "author": null, "committer": null, "parents": [{"sha": "1bb2cc34af6af55bef26db2a771cff71908ab357", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bb2cc34af6af55bef26db2a771cff71908ab357", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bb2cc34af6af55bef26db2a771cff71908ab357"}], "stats": {"total": 177, "additions": 111, "deletions": 66}, "files": [{"sha": "2f49e45fbc1471f4a623c5d7009ace0612c67ec2", "filename": "ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7057154564514095e32b55937b971f6c34856abe/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7057154564514095e32b55937b971f6c34856abe/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=7057154564514095e32b55937b971f6c34856abe", "patch": "@@ -1,3 +1,9 @@\n+2003-01-04 John David Anglin  <dave.anglin@nrc.ca>\n+\n+\t* configure.in (LD): Improve test for gcc.  Try to set LD to the ld used\n+\tby gcc if LD is not defined and we are not doing a Canadian Cross.\n+\t* configure: Rebuilt.\n+\n 2002-12-31  Tom Tromey  <tromey@redhat.com>\n \n \t* Makefile.in: Rebuilt."}, {"sha": "13ea672086ae1590314a8a0ea84caea7e3fd0c40", "filename": "configure", "status": "modified", "additions": 73, "deletions": 63, "changes": 136, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7057154564514095e32b55937b971f6c34856abe/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7057154564514095e32b55937b971f6c34856abe/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=7057154564514095e32b55937b971f6c34856abe", "patch": "@@ -2113,12 +2113,14 @@ else\n   YACC=\"\\$(USUAL_YACC)\"\n \n   # If CC is still not set, try to get gcc.\n+  cc_prog_is_gcc=\n   if test -z \"${CC}\" ; then\n     IFS=\"${IFS= \t}\"; save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n     for dir in $PATH; do\n       test -z \"$dir\" && dir=.\n       if test -f $dir/gcc; then\n \tCC=\"gcc\"\n+\tcc_prog_is_gcc=yes\n \techo 'void f(){}' > conftest.c\n \tif test -z \"`${CC} -g -c conftest.c 2>&1`\"; then\n \t  CFLAGS=${CFLAGS-\"-g -O2\"}\n@@ -2134,11 +2136,20 @@ else\n     IFS=\"$save_ifs\"\n     CC=${CC-cc}\n   else\n+    # Determine if we are using gcc.\n+    cat > conftest.c <<EOF\n+#ifdef __GNUC__\n+  yes;\n+#endif\n+EOF\n+    if ${CC} -E conftest.c | grep yes >/dev/null 2>&1; then\n+      cc_prog_is_gcc=yes\n+    fi\n+    rm -f conftest.c\n     if test -z \"${CFLAGS}\"; then\n       # Here CC is set but CFLAGS is not.  Use a quick hack to use -O2 if CC\n       # is set to a version of gcc.\n-      case \"${CC}\" in\n-      *gcc)\n+      if test \"$cc_prog_is_gcc\" = yes; then\n \techo 'void f(){}' > conftest.c\n \tif test -z \"`${CC} -g -c conftest.c 2>&1`\"; then\n \t  CFLAGS=${CFLAGS-\"-g -O2\"}\n@@ -2148,7 +2159,25 @@ else\n \t  CXXFLAGS=${CXXFLAGS-\"-O2\"}\n \tfi\n \trm -f conftest*\n-\t;;\n+      fi\n+    fi\n+  fi\n+\n+  # We must set the default linker to the linker used by gcc for the correct\n+  # operation of libtool.  If LD is not defined and we are using gcc, try to\n+  # set the LD default to the ld used by gcc.\n+  if test -z \"$LD\"; then\n+    if test \"$cc_prog_is_gcc\" = yes; then\n+      case $build in\n+      *-*-mingw*)\n+\tgcc_prog_ld=`$CC -print-prog-name=ld 2>&1 | tr -d '\\015'` ;;\n+      *)\n+\tgcc_prog_ld=`$CC -print-prog-name=ld 2>&1` ;;\n+      esac\n+      case $gcc_prog_ld in\n+      # Accept absolute paths.\n+      [\\\\/]* | [A-Za-z]:[\\\\/]*)\n+        LD=\"$gcc_prog_ld\" ;;\n       esac\n     fi\n   fi\n@@ -2684,7 +2713,7 @@ test -n \"$target_alias\" && ncn_target_tool_prefix=$target_alias-\n   # Extract the first word of \"${ncn_tool_prefix}ar\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2688: checking for $ac_word\" >&5\n+echo \"configure:2717: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AR'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2717,7 +2746,7 @@ if test -z \"$ac_cv_prog_AR\" ; then\n     # Extract the first word of \"ar\", so it can be a program name with args.\n set dummy ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2721: checking for $ac_word\" >&5\n+echo \"configure:2750: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_AR'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2756,7 +2785,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}as\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2760: checking for $ac_word\" >&5\n+echo \"configure:2789: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AS'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2789,7 +2818,7 @@ if test -z \"$ac_cv_prog_AS\" ; then\n     # Extract the first word of \"as\", so it can be a program name with args.\n set dummy as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2793: checking for $ac_word\" >&5\n+echo \"configure:2822: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_AS'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2828,7 +2857,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}dlltool\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2832: checking for $ac_word\" >&5\n+echo \"configure:2861: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_DLLTOOL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2861,7 +2890,7 @@ if test -z \"$ac_cv_prog_DLLTOOL\" ; then\n     # Extract the first word of \"dlltool\", so it can be a program name with args.\n set dummy dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2865: checking for $ac_word\" >&5\n+echo \"configure:2894: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_DLLTOOL'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2900,7 +2929,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}ld\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2904: checking for $ac_word\" >&5\n+echo \"configure:2933: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2933,7 +2962,7 @@ if test -z \"$ac_cv_prog_LD\" ; then\n     # Extract the first word of \"ld\", so it can be a program name with args.\n set dummy ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2937: checking for $ac_word\" >&5\n+echo \"configure:2966: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_LD'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -2972,7 +3001,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}nm\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:2976: checking for $ac_word\" >&5\n+echo \"configure:3005: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_NM'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3005,7 +3034,7 @@ if test -z \"$ac_cv_prog_NM\" ; then\n     # Extract the first word of \"nm\", so it can be a program name with args.\n set dummy nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3009: checking for $ac_word\" >&5\n+echo \"configure:3038: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_NM'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3044,7 +3073,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3048: checking for $ac_word\" >&5\n+echo \"configure:3077: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3077,7 +3106,7 @@ if test -z \"$ac_cv_prog_RANLIB\" ; then\n     # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3081: checking for $ac_word\" >&5\n+echo \"configure:3110: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_RANLIB'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3116,7 +3145,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}windres\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3120: checking for $ac_word\" >&5\n+echo \"configure:3149: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_WINDRES'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3149,7 +3178,7 @@ if test -z \"$ac_cv_prog_WINDRES\" ; then\n     # Extract the first word of \"windres\", so it can be a program name with args.\n set dummy windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3153: checking for $ac_word\" >&5\n+echo \"configure:3182: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_WINDRES'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3188,7 +3217,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}objcopy\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}objcopy; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3192: checking for $ac_word\" >&5\n+echo \"configure:3221: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_OBJCOPY'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3221,7 +3250,7 @@ if test -z \"$ac_cv_prog_OBJCOPY\" ; then\n     # Extract the first word of \"objcopy\", so it can be a program name with args.\n set dummy objcopy; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3225: checking for $ac_word\" >&5\n+echo \"configure:3254: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_OBJCOPY'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3260,7 +3289,7 @@ fi\n   # Extract the first word of \"${ncn_tool_prefix}objdump\", so it can be a program name with args.\n set dummy ${ncn_tool_prefix}objdump; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3264: checking for $ac_word\" >&5\n+echo \"configure:3293: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_OBJDUMP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3293,7 +3322,7 @@ if test -z \"$ac_cv_prog_OBJDUMP\" ; then\n     # Extract the first word of \"objdump\", so it can be a program name with args.\n set dummy objdump; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3297: checking for $ac_word\" >&5\n+echo \"configure:3326: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_OBJDUMP'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3341,7 +3370,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}ar\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3345: checking for $ac_word\" >&5\n+echo \"configure:3374: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AR_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3374,7 +3403,7 @@ if test -z \"$ac_cv_prog_AR_FOR_TARGET\" ; then\n     # Extract the first word of \"ar\", so it can be a program name with args.\n set dummy ar; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3378: checking for $ac_word\" >&5\n+echo \"configure:3407: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_AR_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3413,7 +3442,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}as\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3417: checking for $ac_word\" >&5\n+echo \"configure:3446: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_AS_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3446,7 +3475,7 @@ if test -z \"$ac_cv_prog_AS_FOR_TARGET\" ; then\n     # Extract the first word of \"as\", so it can be a program name with args.\n set dummy as; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3450: checking for $ac_word\" >&5\n+echo \"configure:3479: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_AS_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3485,7 +3514,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}dlltool\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3489: checking for $ac_word\" >&5\n+echo \"configure:3518: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_DLLTOOL_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3518,7 +3547,7 @@ if test -z \"$ac_cv_prog_DLLTOOL_FOR_TARGET\" ; then\n     # Extract the first word of \"dlltool\", so it can be a program name with args.\n set dummy dlltool; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3522: checking for $ac_word\" >&5\n+echo \"configure:3551: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_DLLTOOL_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3557,7 +3586,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}ld\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3561: checking for $ac_word\" >&5\n+echo \"configure:3590: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_LD_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3590,7 +3619,7 @@ if test -z \"$ac_cv_prog_LD_FOR_TARGET\" ; then\n     # Extract the first word of \"ld\", so it can be a program name with args.\n set dummy ld; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3594: checking for $ac_word\" >&5\n+echo \"configure:3623: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_LD_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3629,7 +3658,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}nm\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3633: checking for $ac_word\" >&5\n+echo \"configure:3662: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_NM_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3662,7 +3691,7 @@ if test -z \"$ac_cv_prog_NM_FOR_TARGET\" ; then\n     # Extract the first word of \"nm\", so it can be a program name with args.\n set dummy nm; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3666: checking for $ac_word\" >&5\n+echo \"configure:3695: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_NM_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3701,7 +3730,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}ranlib\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3705: checking for $ac_word\" >&5\n+echo \"configure:3734: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_RANLIB_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3734,7 +3763,7 @@ if test -z \"$ac_cv_prog_RANLIB_FOR_TARGET\" ; then\n     # Extract the first word of \"ranlib\", so it can be a program name with args.\n set dummy ranlib; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3738: checking for $ac_word\" >&5\n+echo \"configure:3767: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_RANLIB_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3773,7 +3802,7 @@ fi\n   # Extract the first word of \"${ncn_target_tool_prefix}windres\", so it can be a program name with args.\n set dummy ${ncn_target_tool_prefix}windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3777: checking for $ac_word\" >&5\n+echo \"configure:3806: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_WINDRES_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3806,7 +3835,7 @@ if test -z \"$ac_cv_prog_WINDRES_FOR_TARGET\" ; then\n     # Extract the first word of \"windres\", so it can be a program name with args.\n set dummy windres; ac_word=$2\n echo $ac_n \"checking for $ac_word\"\"... $ac_c\" 1>&6\n-echo \"configure:3810: checking for $ac_word\" >&5\n+echo \"configure:3839: checking for $ac_word\" >&5\n if eval \"test \\\"`echo '$''{'ac_cv_prog_ncn_cv_WINDRES_FOR_TARGET'+set}'`\\\" = set\"; then\n   echo $ac_n \"(cached) $ac_c\" 1>&6\n else\n@@ -3938,34 +3967,15 @@ trap 'rm -f $CONFIG_STATUS conftest*; exit 1' 1 2 15\n # Transform confdefs.h into DEFS.\n # Protect against shell expansion while executing Makefile rules.\n # Protect against Makefile macro expansion.\n-#\n-# If the first sed substitution is executed (which looks for macros that\n-# take arguments), then we branch to the quote section.  Otherwise,\n-# look for a macro that doesn't take arguments.\n-cat >confdef2opt.sed <<\\_ACEOF\n-t clear\n-: clear\n-s,^[ \t]*#[ \t]*define[ \t][ \t]*\\([^ \t(][^ \t(]*([^)]*)\\)[ \t]*\\(.*\\),-D\\1=\\2,g\n-t quote\n-s,^[ \t]*#[ \t]*define[ \t][ \t]*\\([^ \t][^ \t]*\\)[ \t]*\\(.*\\),-D\\1=\\2,g\n-t quote\n-d\n-: quote\n-s,[ \t`~#$^&*(){}\\\\|;'\"<>?],\\\\&,g\n-s,\\[,\\\\&,g\n-s,\\],\\\\&,g\n-s,\\$,$$,g\n-p\n-_ACEOF\n-# We use echo to avoid assuming a particular line-breaking character.\n-# The extra dot is to prevent the shell from consuming trailing\n-# line-breaks from the sub-command output.  A line-break within\n-# single-quotes doesn't work because, if this script is created in a\n-# platform that uses two characters for line-breaks (e.g., DOS), tr\n-# would break.\n-ac_LF_and_DOT=`echo; echo .`\n-DEFS=`sed -n -f confdef2opt.sed confdefs.h | tr \"$ac_LF_and_DOT\" ' .'`\n-rm -f confdef2opt.sed\n+cat > conftest.defs <<\\EOF\n+s%#define \\([A-Za-z_][A-Za-z0-9_]*\\) *\\(.*\\)%-D\\1=\\2%g\n+s%[ \t`~#$^&*(){}\\\\|;'\"<>?]%\\\\&%g\n+s%\\[%\\\\&%g\n+s%\\]%\\\\&%g\n+s%\\$%$$%g\n+EOF\n+DEFS=`sed -f conftest.defs confdefs.h | tr '\\012' ' '`\n+rm -f conftest.defs\n \n \n # Without the \"./\", some shells look in PATH for config.status."}, {"sha": "edf913ecddb4da67762b5eda36a68e84bc52a2bc", "filename": "configure.in", "status": "modified", "additions": 32, "deletions": 3, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7057154564514095e32b55937b971f6c34856abe/configure.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7057154564514095e32b55937b971f6c34856abe/configure.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.in?ref=7057154564514095e32b55937b971f6c34856abe", "patch": "@@ -1456,12 +1456,14 @@ else\n   YACC=\"\\$(USUAL_YACC)\"\n \n   # If CC is still not set, try to get gcc.\n+  cc_prog_is_gcc=\n   if test -z \"${CC}\" ; then\n     IFS=\"${IFS= \t}\"; save_ifs=\"$IFS\"; IFS=\"${IFS}:\"\n     for dir in $PATH; do\n       test -z \"$dir\" && dir=.\n       if test -f $dir/gcc; then\n \tCC=\"gcc\"\n+\tcc_prog_is_gcc=yes\n \techo 'void f(){}' > conftest.c\n \tif test -z \"`${CC} -g -c conftest.c 2>&1`\"; then\n \t  CFLAGS=${CFLAGS-\"-g -O2\"}\n@@ -1477,11 +1479,20 @@ else\n     IFS=\"$save_ifs\"\n     CC=${CC-cc}\n   else\n+    # Determine if we are using gcc.\n+    cat > conftest.c <<EOF\n+#ifdef __GNUC__\n+  yes;\n+#endif\n+EOF\n+    if ${CC} -E conftest.c | grep yes >/dev/null 2>&1; then\n+      cc_prog_is_gcc=yes\n+    fi\n+    rm -f conftest.c\n     if test -z \"${CFLAGS}\"; then\n       # Here CC is set but CFLAGS is not.  Use a quick hack to use -O2 if CC\n       # is set to a version of gcc.\n-      case \"${CC}\" in\n-      *gcc)\n+      if test \"$cc_prog_is_gcc\" = yes; then\n \techo 'void f(){}' > conftest.c\n \tif test -z \"`${CC} -g -c conftest.c 2>&1`\"; then\n \t  CFLAGS=${CFLAGS-\"-g -O2\"}\n@@ -1491,7 +1502,25 @@ else\n \t  CXXFLAGS=${CXXFLAGS-\"-O2\"}\n \tfi\n \trm -f conftest*\n-\t;;\n+      fi\n+    fi\n+  fi\n+\n+  # We must set the default linker to the linker used by gcc for the correct\n+  # operation of libtool.  If LD is not defined and we are using gcc, try to\n+  # set the LD default to the ld used by gcc.\n+  if test -z \"$LD\"; then\n+    if test \"$cc_prog_is_gcc\" = yes; then\n+      case $build in\n+      *-*-mingw*)\n+\tgcc_prog_ld=`$CC -print-prog-name=ld 2>&1 | tr -d '\\015'` ;;\n+      *)\n+\tgcc_prog_ld=`$CC -print-prog-name=ld 2>&1` ;;\n+      esac\n+      case $gcc_prog_ld in\n+      # Accept absolute paths.\n+      [[\\\\/]* | [A-Za-z]:[\\\\/]*)]\n+        LD=\"$gcc_prog_ld\" ;;\n       esac\n     fi\n   fi"}]}