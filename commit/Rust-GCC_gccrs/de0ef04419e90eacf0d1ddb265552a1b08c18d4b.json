{"sha": "de0ef04419e90eacf0d1ddb265552a1b08c18d4b", "node_id": "C_kwDOANBUbNoAKGRlMGVmMDQ0MTllOTBlYWNmMGQxZGRiMjY1NTUyYTFiMDhjMThkNGI", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-03-29T08:32:13Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2022-03-29T12:00:25Z"}, "message": "[nvptx] Add march-map\n\nSay we have an sm_50 board, and we want to run a benchmark using the highest\npossible march setting.\n\nCurrently there's march=sm_30, march=sm_35, march=sm_53, but no march=sm_50.\n\nSo, we'd need to pick march=sm_35.\n\nLikewise, for a test script that handles multiple boards, we'd need a mapping\nfrom native board sm_xx to march, which might have to be updated with newer\ngcc releases.\n\nAdd an option march-map, such that we can just specify march-map=sm_50, and\nlet the compiler map this to the appropriate march.\n\nThe option is implemented as a list of aliases, such that we have a somewhat\nlengthy (17 lines in total):\n...\n$ gcc --help=target\n  ...\n  -march-map=sm_30            Same as -misa=sm_30.\n  -march-map=sm_32            Same as -misa=sm_30.\n  ...\n  -march-map=sm_87            Same as -misa=sm_80.\n  -march-map=sm_90            Same as -misa=sm_80.\n...\n\nThis implementation was chosen in the hope that it'll be easier if\nwe end up with some misa multilib.\n\nIt would be nice to have the mapping list generated from an updated\nnvptx-sm.def, but for now it's spelled out in nvptx.opt.\n\nTested on nvptx.\n\ngcc/ChangeLog:\n\n2022-03-29  Tom de Vries  <tdevries@suse.de>\n\n\tPR target/104714\n\t* config/nvptx/nvptx.opt (march-map=*): Add aliases.\n\ngcc/testsuite/ChangeLog:\n\n2022-03-29  Tom de Vries  <tdevries@suse.de>\n\n\tPR target/104714\n\t* gcc.target/nvptx/march-map.c: New test.", "tree": {"sha": "74ab9cacca608e723dd32f40da34d4d644f8927d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74ab9cacca608e723dd32f40da34d4d644f8927d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de0ef04419e90eacf0d1ddb265552a1b08c18d4b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de0ef04419e90eacf0d1ddb265552a1b08c18d4b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de0ef04419e90eacf0d1ddb265552a1b08c18d4b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de0ef04419e90eacf0d1ddb265552a1b08c18d4b/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "871266756c7aa6a68e36b89d8d56e3fa593cca5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/871266756c7aa6a68e36b89d8d56e3fa593cca5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/871266756c7aa6a68e36b89d8d56e3fa593cca5b"}], "stats": {"total": 56, "additions": 56, "deletions": 0}, "files": [{"sha": "58eddeeabf42ebf413f5bee20c2558f8109b7775", "filename": "gcc/config/nvptx/nvptx.opt", "status": "modified", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de0ef04419e90eacf0d1ddb265552a1b08c18d4b/gcc%2Fconfig%2Fnvptx%2Fnvptx.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de0ef04419e90eacf0d1ddb265552a1b08c18d4b/gcc%2Fconfig%2Fnvptx%2Fnvptx.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.opt?ref=de0ef04419e90eacf0d1ddb265552a1b08c18d4b", "patch": "@@ -60,6 +60,57 @@ march=\n Target RejectNegative Joined Alias(misa=)\n Alias:\n \n+march-map=sm_30\n+Target RejectNegative Alias(misa=,sm_30)\n+\n+march-map=sm_32\n+Target RejectNegative Alias(misa=,sm_30)\n+\n+march-map=sm_35\n+Target RejectNegative Alias(misa=,sm_35)\n+\n+march-map=sm_37\n+Target RejectNegative Alias(misa=,sm_35)\n+\n+march-map=sm_50\n+Target RejectNegative Alias(misa=,sm_35)\n+\n+march-map=sm_52\n+Target RejectNegative Alias(misa=,sm_35)\n+\n+march-map=sm_53\n+Target RejectNegative Alias(misa=,sm_53)\n+\n+march-map=sm_60\n+Target RejectNegative Alias(misa=,sm_53)\n+\n+march-map=sm_61\n+Target RejectNegative Alias(misa=,sm_53)\n+\n+march-map=sm_62\n+Target RejectNegative Alias(misa=,sm_53)\n+\n+march-map=sm_70\n+Target RejectNegative Alias(misa=,sm_70)\n+\n+march-map=sm_72\n+Target RejectNegative Alias(misa=,sm_70)\n+\n+march-map=sm_75\n+Target RejectNegative Alias(misa=,sm_75)\n+\n+march-map=sm_80\n+Target RejectNegative Alias(misa=,sm_80)\n+\n+march-map=sm_86\n+Target RejectNegative Alias(misa=,sm_80)\n+\n+march-map=sm_87\n+Target RejectNegative Alias(misa=,sm_80)\n+\n+march-map=sm_90\n+Target RejectNegative Alias(misa=,sm_80)\n+\n Enum\n Name(ptx_version) Type(int)\n Known PTX ISA versions (for use with the -mptx= option):"}, {"sha": "00838e55fc08874c637a7f2303d99a72c5929b1c", "filename": "gcc/testsuite/gcc.target/nvptx/march-map.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de0ef04419e90eacf0d1ddb265552a1b08c18d4b/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Fmarch-map.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de0ef04419e90eacf0d1ddb265552a1b08c18d4b/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Fmarch-map.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Fmarch-map.c?ref=de0ef04419e90eacf0d1ddb265552a1b08c18d4b", "patch": "@@ -0,0 +1,5 @@\n+/* { dg-options \"-march-map=sm_50\" } */\n+\n+#include \"main.c\"\n+\n+/* { dg-final { scan-assembler-times \"\\\\.target\\tsm_35\" 1 } } */"}]}