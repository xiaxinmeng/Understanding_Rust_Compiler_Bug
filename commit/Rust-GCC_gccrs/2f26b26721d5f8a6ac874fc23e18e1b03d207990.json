{"sha": "2f26b26721d5f8a6ac874fc23e18e1b03d207990", "node_id": "C_kwDOANBUbNoAKDJmMjZiMjY3MjFkNWY4YTZhYzg3NGZjMjNlMThlMWIwM2QyMDc5OTA", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-03-16T20:35:47Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-03-16T21:16:53Z"}, "message": "libstdc++: Fix symbol versioning for Solaris 11.3 [PR103407]\n\nThe new std::from_chars implementation means that those symbols are now\ndefined on Solaris 11.3, which lacks uselocale. They were not present in\ngcc-11, but the linker script gives them the GLIBCXX_3.4.29 symbol\nversion because that is the version where they appeared for systems with\nuselocale.\n\nThis makes the version for those symbols depend on whether uselocale is\navailable or not, so that they get version GLIBCXX_3.4.30 on targets\nwhere they weren't defined in gcc-11.\n\nIn order to avoid needing separate ABI baseline files for Solaris 11.3\nand 11.4, the ABI checker program now treats the floating-point\nstd::from_chars overloads as undesignated if they are not found in the\nbaseline symbols file. This means they can be left out of the SOlaris\nbaseline without causing the check-abi target to fail.\n\nlibstdc++-v3/ChangeLog:\n\n\tPR libstdc++/103407\n\t* config/abi/pre/gnu.ver: Make version for std::from_chars\n\tdepend on HAVE_USELOCALE macro.\n\t* testsuite/util/testsuite_abi.cc (compare_symbols): Treat\n\tstd::from_chars for floating-point types as undesignated if\n\tnot found in the baseline symbols file.", "tree": {"sha": "442986b7b6fa9091a457bea8244265f143722565", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/442986b7b6fa9091a457bea8244265f143722565"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2f26b26721d5f8a6ac874fc23e18e1b03d207990", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f26b26721d5f8a6ac874fc23e18e1b03d207990", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f26b26721d5f8a6ac874fc23e18e1b03d207990", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f26b26721d5f8a6ac874fc23e18e1b03d207990/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69921f4a7ec081c5b37dae13e3372003e4efd49f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69921f4a7ec081c5b37dae13e3372003e4efd49f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69921f4a7ec081c5b37dae13e3372003e4efd49f"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "9b80a31768b0370b96aad20d4dc5ec67909adbfa", "filename": "libstdc++-v3/config/abi/pre/gnu.ver", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f26b26721d5f8a6ac874fc23e18e1b03d207990/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpre%2Fgnu.ver", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f26b26721d5f8a6ac874fc23e18e1b03d207990/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpre%2Fgnu.ver", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fconfig%2Fabi%2Fpre%2Fgnu.ver?ref=2f26b26721d5f8a6ac874fc23e18e1b03d207990", "patch": "@@ -2337,8 +2337,10 @@ GLIBCXX_3.4.28 {\n \n GLIBCXX_3.4.29 {\n \n+#ifdef HAVE_USELOCALE\n     # std::from_chars\n     _ZSt10from_charsPKcS0_R[def]St12chars_format;\n+#endif\n \n     # std::__istream_extract(istream&, char*, streamsize)\n     _ZSt17__istream_extractRSiPc[ilx];\n@@ -2416,6 +2418,11 @@ GLIBCXX_3.4.29 {\n \n GLIBCXX_3.4.30 {\n \n+#ifndef HAVE_USELOCALE\n+    # std::from_chars\n+    _ZSt10from_charsPKcS0_R[def]St12chars_format;\n+#endif\n+\n     _ZSt21__glibcxx_assert_fail*;\n \n #ifdef HAVE_SYMVER_SYMBOL_RENAMING_RUNTIME_SUPPORT"}, {"sha": "5c8383554e583360b6cb99e4dcfbbeb4faa89f69", "filename": "libstdc++-v3/testsuite/util/testsuite_abi.cc", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2f26b26721d5f8a6ac874fc23e18e1b03d207990/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_abi.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2f26b26721d5f8a6ac874fc23e18e1b03d207990/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_abi.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Futil%2Ftestsuite_abi.cc?ref=2f26b26721d5f8a6ac874fc23e18e1b03d207990", "patch": "@@ -499,6 +499,19 @@ compare_symbols(const char* baseline_file, const char* test_file,\n \t  else\n \t    undesignated.push_back(stest);\n \t}\n+      // See PR libstdc++/103407 -  abi_check FAILs on Solaris\n+      else if (stest.type == symbol::function\n+\t\t && stest.name.compare(0, 23, \"_ZSt10from_charsPKcS0_R\") == 0\n+\t\t && stest.name.find_first_of(\"def\", 23) == 23\n+\t\t && (stest.version_name == \"GLIBCXX_3.4.29\"\n+\t\t       || stest.version_name == \"GLIBCXX_3.4.30\"))\n+\t{\n+\t  stest.status = symbol::undesignated;\n+\t  if (!check_version(stest, false))\n+\t    incompatible.push_back(symbol_pair(stest, stest));\n+\t  else\n+\t    undesignated.push_back(stest);\n+\t}\n       else\n \t{\n \t  stest.status = symbol::added;"}]}