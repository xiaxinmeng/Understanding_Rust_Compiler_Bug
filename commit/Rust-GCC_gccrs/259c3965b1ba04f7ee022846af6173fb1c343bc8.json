{"sha": "259c3965b1ba04f7ee022846af6173fb1c343bc8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjU5YzM5NjViMWJhMDRmN2VlMDIyODQ2YWY2MTczZmIxYzM0M2JjOA==", "commit": {"author": {"name": "Jozef Lawrynowicz", "email": "jozef.l@mittosystems.com", "date": "2020-07-22T11:37:29Z"}, "committer": {"name": "Jozef Lawrynowicz", "email": "jozef.l@mittosystems.com", "date": "2020-07-22T11:38:56Z"}, "message": "expmed: Fix possible use of NULL_RTX return value from emit_store_flag\n\nMSP430 does not support have any store-flag instructions, so\nemit_store_flag can return NULL_RTX.  Catch the NULL_RTX in\nexpmed.c:expand_sdiv_pow2.\n\ngcc/ChangeLog:\n\n\t* expmed.c (expand_sdiv_pow2): Check return value from emit_store_flag\n\tis not NULL_RTX before use.", "tree": {"sha": "de7a0af58de95dcdf005eb1e4c8561a80a776e9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de7a0af58de95dcdf005eb1e4c8561a80a776e9b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/259c3965b1ba04f7ee022846af6173fb1c343bc8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/259c3965b1ba04f7ee022846af6173fb1c343bc8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/259c3965b1ba04f7ee022846af6173fb1c343bc8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/259c3965b1ba04f7ee022846af6173fb1c343bc8/comments", "author": {"login": "jozefl-mitto", "id": 36524004, "node_id": "MDQ6VXNlcjM2NTI0MDA0", "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozefl-mitto", "html_url": "https://github.com/jozefl-mitto", "followers_url": "https://api.github.com/users/jozefl-mitto/followers", "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}", "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions", "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs", "repos_url": "https://api.github.com/users/jozefl-mitto/repos", "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}", "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jozefl-mitto", "id": 36524004, "node_id": "MDQ6VXNlcjM2NTI0MDA0", "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozefl-mitto", "html_url": "https://github.com/jozefl-mitto", "followers_url": "https://api.github.com/users/jozefl-mitto/followers", "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}", "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions", "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs", "repos_url": "https://api.github.com/users/jozefl-mitto/repos", "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}", "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4821e0aabee57d5b7f955f138a8bee4588240609", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4821e0aabee57d5b7f955f138a8bee4588240609", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4821e0aabee57d5b7f955f138a8bee4588240609"}], "stats": {"total": 35, "additions": 21, "deletions": 14}, "files": [{"sha": "3d2d2347d791f4a7fdfbfb9d54654c29688f5bc6", "filename": "gcc/expmed.c", "status": "modified", "additions": 21, "deletions": 14, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/259c3965b1ba04f7ee022846af6173fb1c343bc8/gcc%2Fexpmed.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/259c3965b1ba04f7ee022846af6173fb1c343bc8/gcc%2Fexpmed.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpmed.c?ref=259c3965b1ba04f7ee022846af6173fb1c343bc8", "patch": "@@ -4086,9 +4086,12 @@ expand_sdiv_pow2 (scalar_int_mode mode, rtx op0, HOST_WIDE_INT d)\n     {\n       temp = gen_reg_rtx (mode);\n       temp = emit_store_flag (temp, LT, op0, const0_rtx, mode, 0, 1);\n-      temp = expand_binop (mode, add_optab, temp, op0, NULL_RTX,\n-\t\t\t   0, OPTAB_LIB_WIDEN);\n-      return expand_shift (RSHIFT_EXPR, mode, temp, logd, NULL_RTX, 0);\n+      if (temp != NULL_RTX)\n+\t{\n+\t  temp = expand_binop (mode, add_optab, temp, op0, NULL_RTX,\n+\t\t\t       0, OPTAB_LIB_WIDEN);\n+\t  return expand_shift (RSHIFT_EXPR, mode, temp, logd, NULL_RTX, 0);\n+\t}\n     }\n \n   if (HAVE_conditional_move\n@@ -4122,17 +4125,21 @@ expand_sdiv_pow2 (scalar_int_mode mode, rtx op0, HOST_WIDE_INT d)\n \n       temp = gen_reg_rtx (mode);\n       temp = emit_store_flag (temp, LT, op0, const0_rtx, mode, 0, -1);\n-      if (GET_MODE_BITSIZE (mode) >= BITS_PER_WORD\n-\t  || shift_cost (optimize_insn_for_speed_p (), mode, ushift)\n-\t     > COSTS_N_INSNS (1))\n-\ttemp = expand_binop (mode, and_optab, temp, gen_int_mode (d - 1, mode),\n-\t\t\t     NULL_RTX, 0, OPTAB_LIB_WIDEN);\n-      else\n-\ttemp = expand_shift (RSHIFT_EXPR, mode, temp,\n-\t\t\t     ushift, NULL_RTX, 1);\n-      temp = expand_binop (mode, add_optab, temp, op0, NULL_RTX,\n-\t\t\t   0, OPTAB_LIB_WIDEN);\n-      return expand_shift (RSHIFT_EXPR, mode, temp, logd, NULL_RTX, 0);\n+      if (temp != NULL_RTX)\n+\t{\n+\t  if (GET_MODE_BITSIZE (mode) >= BITS_PER_WORD\n+\t      || shift_cost (optimize_insn_for_speed_p (), mode, ushift)\n+\t      > COSTS_N_INSNS (1))\n+\t    temp = expand_binop (mode, and_optab, temp,\n+\t\t\t\t gen_int_mode (d - 1, mode),\n+\t\t\t\t NULL_RTX, 0, OPTAB_LIB_WIDEN);\n+\t  else\n+\t    temp = expand_shift (RSHIFT_EXPR, mode, temp,\n+\t\t\t\t ushift, NULL_RTX, 1);\n+\t  temp = expand_binop (mode, add_optab, temp, op0, NULL_RTX,\n+\t\t\t       0, OPTAB_LIB_WIDEN);\n+\t  return expand_shift (RSHIFT_EXPR, mode, temp, logd, NULL_RTX, 0);\n+\t}\n     }\n \n   label = gen_label_rtx ();"}]}