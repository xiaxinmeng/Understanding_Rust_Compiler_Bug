{"sha": "6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Njk5MmQ2ZmJmMmZmZGI0YTVjNzg2MDRmYmYzM2FlOTU5NTZmZmZkZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-05-31T07:53:48Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-05-31T07:53:48Z"}, "message": "re PR tree-optimization/90671 (ICE on valid code at -Os and above with -g enabled in gsi_split_seq_after, at gimple-iterator.c:345)\n\n\tPR tree-optimization/90671\n\t* tree-ssa-threadupdate.c (ssa_create_duplicates): If\n\ttemplate_block used to be empty on the first call, don't use\n\tgsi_split_seq_after and gsi_insert_seq_after, but remember whole\n\tseq with bb_seq and set it with set_bb_seq.\n\n\t* gcc.dg/torture/pr90671.c: New test.\n\nFrom-SVN: r271802", "tree": {"sha": "60a8f12d775717b56975226f009fb27e15718573", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/60a8f12d775717b56975226f009fb27e15718573"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0eee8eaa834181720cfb4e360a1c69d77c74b552", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0eee8eaa834181720cfb4e360a1c69d77c74b552", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0eee8eaa834181720cfb4e360a1c69d77c74b552"}], "stats": {"total": 48, "additions": 45, "deletions": 3}, "files": [{"sha": "5283feda9d55a185eda23ea105d9cbf6806dab81", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "patch": "@@ -1,3 +1,11 @@\n+2019-05-31  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/90671\n+\t* tree-ssa-threadupdate.c (ssa_create_duplicates): If\n+\ttemplate_block used to be empty on the first call, don't use\n+\tgsi_split_seq_after and gsi_insert_seq_after, but remember whole\n+\tseq with bb_seq and set it with set_bb_seq.\n+\n 2019-05-31  Iain Sandoe  <iain@sandoe.co.uk>\n \n \t* config/i386/darwin.h (ASM_OUTPUT_MAX_SKIP_ALIGN): New."}, {"sha": "c081448df40feaa670103784fabb1a0b11ef69b0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "patch": "@@ -1,3 +1,8 @@\n+2019-05-31  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/90671\n+\t* gcc.dg/torture/pr90671.c: New test.\n+\n 2019-05-31  Iain Sandoe  <iain@sandoe.co.uk>\n \n \t* g++.dg/cpp0x/pr84497.C: Require alias support."}, {"sha": "5a99b9d9a8412502e0b9d073013214819a5821fe", "filename": "gcc/testsuite/gcc.dg/torture/pr90671.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr90671.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr90671.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr90671.c?ref=6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "patch": "@@ -0,0 +1,16 @@\n+/* PR tree-optimization/90671 */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-w -g\" } */\n+\n+int a;\n+\n+int\n+main ()\n+{\n+  int b, c;\n+  for (c = 0; c < 2; c++)\n+    while (a)\n+      if (b)\n+\tbreak;\n+  return 0;\n+}"}, {"sha": "a56ccfbaa8c5d676b99d93ce475428a7dc7ad4c5", "filename": "gcc/tree-ssa-threadupdate.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2Ftree-ssa-threadupdate.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd/gcc%2Ftree-ssa-threadupdate.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-threadupdate.c?ref=6992d6fbf2ffdb4a5c78604fbf33ae95956fffdd", "patch": "@@ -1142,12 +1142,25 @@ ssa_create_duplicates (struct redirection_data **slot,\n       gimple_seq seq = NULL;\n       if (gsi_stmt (local_info->template_last_to_copy)\n \t  != gsi_stmt (gsi_last_bb (local_info->template_block)))\n-\tseq = gsi_split_seq_after (local_info->template_last_to_copy);\n+\t{\n+\t  if (gsi_end_p (local_info->template_last_to_copy))\n+\t    {\n+\t      seq = bb_seq (local_info->template_block);\n+\t      set_bb_seq (local_info->template_block, NULL);\n+\t    }\n+\t  else\n+\t    seq = gsi_split_seq_after (local_info->template_last_to_copy);\n+\t}\n       create_block_for_threading (local_info->template_block, rd, 0,\n \t\t\t\t  &local_info->duplicate_blocks);\n       if (seq)\n-\tgsi_insert_seq_after (&local_info->template_last_to_copy,\n-\t\t\t      seq, GSI_SAME_STMT);\n+\t{\n+\t  if (gsi_end_p (local_info->template_last_to_copy))\n+\t    set_bb_seq (local_info->template_block, seq);\n+\t  else\n+\t    gsi_insert_seq_after (&local_info->template_last_to_copy,\n+\t\t\t\t  seq, GSI_SAME_STMT);\n+\t}\n \n       /* Go ahead and wire up outgoing edges and update PHIs for the duplicate\n \t block.   */"}]}