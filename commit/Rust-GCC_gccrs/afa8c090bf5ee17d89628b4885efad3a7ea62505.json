{"sha": "afa8c090bf5ee17d89628b4885efad3a7ea62505", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWZhOGMwOTBiZjVlZTE3ZDg5NjI4YjQ4ODVlZmFkM2E3ZWE2MjUwNQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2019-10-21T18:45:45Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2019-10-21T18:45:45Z"}, "message": "PR c++/92062 - ODR-use ignored for static member of class template.\n\nhas_value_dependent_address wasn't stripping location wrappers so it\ngave the wrong answer for \"&x\" in the static_assert.  That led us to\nthinking that the expression isn't instantiation-dependent, and we\nskipped static initialization of A<0>::x.\n\nThis patch adds stripping so that has_value_dependent_address gives the\nsame answer as it used to before the location wrappers addition.\n\n\t* pt.c (has_value_dependent_address): Strip location wrappers.\n\n\t* g++.dg/cpp0x/constexpr-odr1.C: New test.\n\t* g++.dg/cpp0x/constexpr-odr2.C: New test.\n\nFrom-SVN: r277266", "tree": {"sha": "65f87ce073121c8d4bd994dcf4e5e74123b412fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/65f87ce073121c8d4bd994dcf4e5e74123b412fd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/afa8c090bf5ee17d89628b4885efad3a7ea62505", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/afa8c090bf5ee17d89628b4885efad3a7ea62505", "html_url": "https://github.com/Rust-GCC/gccrs/commit/afa8c090bf5ee17d89628b4885efad3a7ea62505", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/afa8c090bf5ee17d89628b4885efad3a7ea62505/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e011c0100a83030e0cfd230658debbb6c97660a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e011c0100a83030e0cfd230658debbb6c97660a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e011c0100a83030e0cfd230658debbb6c97660a1"}], "stats": {"total": 51, "additions": 51, "deletions": 0}, "files": [{"sha": "f861fb3e343c96e5a5f67bf536d284ec8d88da78", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=afa8c090bf5ee17d89628b4885efad3a7ea62505", "patch": "@@ -1,3 +1,8 @@\n+2019-10-21  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/92062 - ODR-use ignored for static member of class template.\n+\t* pt.c (has_value_dependent_address): Strip location wrappers.\n+\n 2019-10-21  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/92106 - ICE with structured bindings and -Wreturn-local-addr."}, {"sha": "e154cac7b21b69e01175c261822352f52219773b", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=afa8c090bf5ee17d89628b4885efad3a7ea62505", "patch": "@@ -6542,6 +6542,8 @@ check_valid_ptrmem_cst_expr (tree type, tree expr,\n static bool\n has_value_dependent_address (tree op)\n {\n+  STRIP_ANY_LOCATION_WRAPPER (op);\n+\n   /* We could use get_inner_reference here, but there's no need;\n      this is only relevant for template non-type arguments, which\n      can only be expressed as &id-expression.  */"}, {"sha": "ba280a1beaff709c7158077f013c4cfe21d618b6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=afa8c090bf5ee17d89628b4885efad3a7ea62505", "patch": "@@ -1,3 +1,9 @@\n+2019-10-21  Marek Polacek  <polacek@redhat.com>\n+\n+\tPR c++/92062 - ODR-use ignored for static member of class template.\n+\t* g++.dg/cpp0x/constexpr-odr1.C: New test.\n+\t* g++.dg/cpp0x/constexpr-odr2.C: New test.\n+\n 2019-10-21  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/92106 - ICE with structured bindings and -Wreturn-local-addr."}, {"sha": "cf3f95f0565c30de0d62f382c9eab8e584956108", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-odr1.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-odr1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-odr1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-odr1.C?ref=afa8c090bf5ee17d89628b4885efad3a7ea62505", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/92062 - ODR-use ignored for static member of class template.\n+// { dg-do run { target c++11 } }\n+\n+template<int> struct A {\n+  static const bool x;\n+  static_assert(&x, \"\"); // odr-uses A<...>::x\n+};\n+\n+int g;\n+\n+template<int I>\n+const bool A<I>::x = (g = 42, false);\n+\n+void f(A<0>) {}        // A<0> must be complete, so is instantiated\n+int main()\n+{\n+  if (g != 42)\n+    __builtin_abort ();\n+}"}, {"sha": "0927488e5695f31cd57b5d6bda397006961c775c", "filename": "gcc/testsuite/g++.dg/cpp0x/constexpr-odr2.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-odr2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/afa8c090bf5ee17d89628b4885efad3a7ea62505/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-odr2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fconstexpr-odr2.C?ref=afa8c090bf5ee17d89628b4885efad3a7ea62505", "patch": "@@ -0,0 +1,19 @@\n+// PR c++/92062 - ODR-use ignored for static member of class template.\n+// { dg-do run { target c++11 } }\n+\n+template<int> struct A {\n+  static const bool x;\n+  enum { force_instantiation =! &x}; // odr-uses A<...>::x\n+};\n+\n+int g;\n+\n+template<int I>\n+const bool A<I>::x = (g = 42, false);\n+\n+void f(A<0>) {}        // A<0> must be complete, so is instantiated\n+int main()\n+{\n+  if (g != 42)\n+    __builtin_abort ();\n+}"}]}