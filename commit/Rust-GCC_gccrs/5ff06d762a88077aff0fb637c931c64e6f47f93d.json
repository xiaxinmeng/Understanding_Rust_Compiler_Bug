{"sha": "5ff06d762a88077aff0fb637c931c64e6f47f93d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWZmMDZkNzYyYTg4MDc3YWZmMGZiNjM3YzkzMWM2NGU2ZjQ3ZjkzZA==", "commit": {"author": {"name": "Maciej W. Rozycki", "email": "macro@wdc.com", "date": "2020-04-06T22:32:44Z"}, "committer": {"name": "Maciej W. Rozycki", "email": "macro@wdc.com", "date": "2020-04-06T22:32:44Z"}, "message": "libatomic/test: Fix compilation for build sysroot\n\nFix a problem with the libatomic testsuite using a method to determine\nthe compiler to use resulting in the tool being different from one the\nlibrary has been built with, and causing a catastrophic failure from the\nlack of a suitable `--sysroot=' option where the `--with-build-sysroot='\nconfiguration option has been used to build the compiler resulting in\nthe inability to link executables.\n\nAddress this problem by providing a DejaGNU configuration file defining\nthe compiler to use, via the GCC_UNDER_TEST TCL variable, set from $CC\nby autoconf, which will have all the required options set for the target\ncompiler to build executables in the environment configured, removing\nfailures like:\n\n.../bin/riscv64-linux-gnu-ld: cannot find crt1.o: No such file or directory\n.../bin/riscv64-linux-gnu-ld: cannot find -lm\ncollect2: error: ld returned 1 exit status\ncompiler exited with status 1\nFAIL: libatomic.c/atomic-compare-exchange-1.c (test for excess errors)\nExcess errors:\n.../bin/riscv64-linux-gnu-ld: cannot find crt1.o: No such file or directory\n.../bin/riscv64-linux-gnu-ld: cannot find -lm\n\nUNRESOLVED: libatomic.c/atomic-compare-exchange-1.c compilation failed to produce executable\n\nand bringing overall test results for the `riscv64-linux-gnu' target\n(here with the `x86_64-linux-gnu' host and RISC-V QEMU in the Linux user\nemulation mode as the target board) from:\n\n\t\t=== libatomic Summary ===\n\n# of unexpected failures\t27\n# of unresolved testcases\t27\n\nto:\n\n\t\t=== libatomic Summary ===\n\n# of expected passes\t\t54\n\n\tlibatomic/\n\t* configure.ac: Add testsuite/libatomic-site-extra.exp to output\n\tfiles.\n\t* configure: Regenerate.\n\t* libatomic/testsuite/libatomic-site-extra.exp.in: New file.\n\t* testsuite/Makefile.am (EXTRA_DEJAGNU_SITE_CONFIG): New\n\tvariable.\n\t* testsuite/Makefile.in: Regenerate.", "tree": {"sha": "e357c5bda0b384bab0928f9dd89d62bfb917f49e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e357c5bda0b384bab0928f9dd89d62bfb917f49e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ff06d762a88077aff0fb637c931c64e6f47f93d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ff06d762a88077aff0fb637c931c64e6f47f93d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ff06d762a88077aff0fb637c931c64e6f47f93d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ff06d762a88077aff0fb637c931c64e6f47f93d/comments", "author": null, "committer": null, "parents": [{"sha": "8662d0593438ecd498ab7591ad0d2810886eb6da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8662d0593438ecd498ab7591ad0d2810886eb6da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8662d0593438ecd498ab7591ad0d2810886eb6da"}], "stats": {"total": 22, "additions": 21, "deletions": 1}, "files": [{"sha": "624162db9117b3bd75d61434f1d3dc513ff43e6e", "filename": "libatomic/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2FChangeLog?ref=5ff06d762a88077aff0fb637c931c64e6f47f93d", "patch": "@@ -1,3 +1,13 @@\n+2020-04-06  Maciej W. Rozycki  <macro@wdc.com>\n+\n+\t* configure.ac: Add testsuite/libatomic-site-extra.exp to output\n+\tfiles.\n+\t* configure: Regenerate.\n+\t* libatomic/testsuite/libatomic-site-extra.exp.in: New file.\n+\t* testsuite/Makefile.am (EXTRA_DEJAGNU_SITE_CONFIG): New\n+\tvariable.\n+\t* testsuite/Makefile.in: Regenerate.\n+\n 2020-02-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR other/55930"}, {"sha": "3e2f2ff4f202789a546464dcc2d4d173cb2f335f", "filename": "libatomic/configure", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Fconfigure?ref=5ff06d762a88077aff0fb637c931c64e6f47f93d", "patch": "@@ -15728,6 +15728,8 @@ fi\n \n ac_config_files=\"$ac_config_files Makefile testsuite/Makefile\"\n \n+ac_config_files=\"$ac_config_files testsuite/libatomic-site-extra.exp\"\n+\n cat >confcache <<\\_ACEOF\n # This file is a shell script that caches the results of configure\n # tests run on this system so they can be shared between configure\n@@ -16799,6 +16801,7 @@ do\n     \"gstdint.h\") CONFIG_COMMANDS=\"$CONFIG_COMMANDS gstdint.h\" ;;\n     \"Makefile\") CONFIG_FILES=\"$CONFIG_FILES Makefile\" ;;\n     \"testsuite/Makefile\") CONFIG_FILES=\"$CONFIG_FILES testsuite/Makefile\" ;;\n+    \"testsuite/libatomic-site-extra.exp\") CONFIG_FILES=\"$CONFIG_FILES testsuite/libatomic-site-extra.exp\" ;;\n \n   *) as_fn_error $? \"invalid argument: \\`$ac_config_target'\" \"$LINENO\" 5;;\n   esac"}, {"sha": "7ac8911c342589eb45013bb55aac95e25bbeb104", "filename": "libatomic/configure.ac", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Fconfigure.ac?ref=5ff06d762a88077aff0fb637c931c64e6f47f93d", "patch": "@@ -288,4 +288,5 @@ else\n fi\n \n AC_CONFIG_FILES(Makefile testsuite/Makefile)\n+AC_CONFIG_FILES(testsuite/libatomic-site-extra.exp)\n AC_OUTPUT"}, {"sha": "ce0bda4d54e0dd6a124400a4fa6462056f677f7b", "filename": "libatomic/testsuite/Makefile.am", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Ftestsuite%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Ftestsuite%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Ftestsuite%2FMakefile.am?ref=5ff06d762a88077aff0fb637c931c64e6f47f93d", "patch": "@@ -11,3 +11,5 @@ EXPECT = $(shell if test -f $(top_builddir)/../expect/expect; then \\\n _RUNTEST = $(shell if test -f $(top_srcdir)/../dejagnu/runtest; then \\\n \t     echo $(top_srcdir)/../dejagnu/runtest; else echo runtest; fi)\n RUNTEST = $(_RUNTEST) $(AM_RUNTESTFLAGS)\n+\n+EXTRA_DEJAGNU_SITE_CONFIG = libatomic-site-extra.exp"}, {"sha": "333980ec2c185a5af9402c777f5f04c5f9f70241", "filename": "libatomic/testsuite/Makefile.in", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Ftestsuite%2FMakefile.in?ref=5ff06d762a88077aff0fb637c931c64e6f47f93d", "patch": "@@ -109,7 +109,7 @@ am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n DIST_COMMON = $(srcdir)/Makefile.am\n mkinstalldirs = $(SHELL) $(top_srcdir)/../mkinstalldirs\n CONFIG_HEADER = $(top_builddir)/auto-config.h\n-CONFIG_CLEAN_FILES =\n+CONFIG_CLEAN_FILES = libatomic-site-extra.exp\n CONFIG_CLEAN_VPATH_FILES =\n AM_V_P = $(am__v_P_@AM_V@)\n am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)\n@@ -278,6 +278,7 @@ _RUNTEST = $(shell if test -f $(top_srcdir)/../dejagnu/runtest; then \\\n \t     echo $(top_srcdir)/../dejagnu/runtest; else echo runtest; fi)\n \n RUNTEST = $(_RUNTEST) $(AM_RUNTESTFLAGS)\n+EXTRA_DEJAGNU_SITE_CONFIG = libatomic-site-extra.exp\n all: all-am\n \n .SUFFIXES:\n@@ -310,6 +311,8 @@ $(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)\n $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)\n \tcd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh\n $(am__aclocal_m4_deps):\n+libatomic-site-extra.exp: $(top_builddir)/config.status $(srcdir)/libatomic-site-extra.exp.in\n+\tcd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@\n \n mostlyclean-libtool:\n \t-rm -f *.lo"}, {"sha": "c0d26660bad96f7fcaba6a9073f7fadfff685c0e", "filename": "libatomic/testsuite/libatomic-site-extra.exp.in", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Ftestsuite%2Flibatomic-site-extra.exp.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ff06d762a88077aff0fb637c931c64e6f47f93d/libatomic%2Ftestsuite%2Flibatomic-site-extra.exp.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libatomic%2Ftestsuite%2Flibatomic-site-extra.exp.in?ref=5ff06d762a88077aff0fb637c931c64e6f47f93d", "patch": "@@ -0,0 +1 @@\n+set GCC_UNDER_TEST {@CC@}"}]}