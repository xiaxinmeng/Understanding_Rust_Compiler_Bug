{"sha": "23c3d0f9726912bfa6e423ddb1dba67fb93be343", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjNjM2QwZjk3MjY5MTJiZmE2ZTQyM2RkYjFkYmE2N2ZiOTNiZTM0Mw==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael.morin@sfr.fr", "date": "2011-10-07T19:24:07Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2011-10-07T19:24:07Z"}, "message": "trans-array.h (struct gfc_se): New flag want_coarray.\n\n\t* trans-array.h (struct gfc_se): New flag want_coarray.\n\t* trans-intrinsic.c (trans_this_image, trans_image_index,\n\tconv_intrinsic_cobound): Set want_coarray.\n\t* trans_array.c (gfc_conv_expr_descriptor): Evaluate codimension\n\tearlier and without relying on the scalarizer.\n\nFrom-SVN: r179676", "tree": {"sha": "4953f1f130fa236b6e97751a13f9a6ea32715120", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4953f1f130fa236b6e97751a13f9a6ea32715120"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/23c3d0f9726912bfa6e423ddb1dba67fb93be343", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23c3d0f9726912bfa6e423ddb1dba67fb93be343", "html_url": "https://github.com/Rust-GCC/gccrs/commit/23c3d0f9726912bfa6e423ddb1dba67fb93be343", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/23c3d0f9726912bfa6e423ddb1dba67fb93be343/comments", "author": null, "committer": null, "parents": [{"sha": "89010691e4bf2461727c91d7cfc306feed998577", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/89010691e4bf2461727c91d7cfc306feed998577", "html_url": "https://github.com/Rust-GCC/gccrs/commit/89010691e4bf2461727c91d7cfc306feed998577"}], "stats": {"total": 19, "additions": 18, "deletions": 1}, "files": [{"sha": "9428b5147298400b912a4b572518133f31a70392", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=23c3d0f9726912bfa6e423ddb1dba67fb93be343", "patch": "@@ -1,3 +1,11 @@\n+2011-10-07  Mikael Morin  <mikael.morin@sfr.fr>\n+\n+\t* trans-array.h (struct gfc_se): New flag want_coarray.\n+\t* trans-intrinsic.c (trans_this_image, trans_image_index,\n+\tconv_intrinsic_cobound): Set want_coarray.\n+\t* trans_array.c (gfc_conv_expr_descriptor): Evaluate codimension\n+\tearlier and without relying on the scalarizer.\n+\n 2011-10-07  Mikael Morin  <mikael.morin@sfr.fr>\n \n \t* expr.c (gfc_get_corank): Return 0 if input expression is not a"}, {"sha": "88998dea47ec3dd5656d24a95aedc77367c3fce7", "filename": "gcc/fortran/trans-array.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2Ftrans-array.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2Ftrans-array.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-array.c?ref=23c3d0f9726912bfa6e423ddb1dba67fb93be343", "patch": "@@ -5988,6 +5988,11 @@ gfc_conv_expr_descriptor (gfc_se * se, gfc_expr * expr, gfc_ss * ss)\n       tree to;\n       tree base;\n \n+      if (se->want_coarray)\n+\tcodim = gfc_get_corank (expr);\n+      else\n+\tcodim = 0;\n+\n       /* Set the string_length for a character array.  */\n       if (expr->ts.type == BT_CHARACTER)\n \tse->string_length =  gfc_get_expr_charlen (expr);\n@@ -6036,7 +6041,6 @@ gfc_conv_expr_descriptor (gfc_se * se, gfc_expr * expr, gfc_ss * ss)\n \tbase = NULL_TREE;\n \n       ndim = info->ref ? info->ref->u.ar.dimen : info->dimen;\n-      codim = info->codimen;\n       for (n = 0; n < ndim; n++)\n \t{\n \t  stride = gfc_conv_array_stride (desc, n);"}, {"sha": "c216873b3ff4d7f6be8e2f97ebc33d9c227c83f7", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=23c3d0f9726912bfa6e423ddb1dba67fb93be343", "patch": "@@ -974,6 +974,7 @@ trans_this_image (gfc_se * se, gfc_expr *expr)\n   ss = gfc_walk_expr (expr->value.function.actual->expr);\n   gcc_assert (ss != gfc_ss_terminator);\n   ss->data.info.codimen = corank;\n+  argse.want_coarray = 1;\n   gfc_conv_expr_descriptor (&argse, expr->value.function.actual->expr, ss);\n   gfc_add_block_to_block (&se->pre, &argse.pre);\n   gfc_add_block_to_block (&se->post, &argse.post);\n@@ -1161,6 +1162,7 @@ trans_image_index (gfc_se * se, gfc_expr *expr)\n   ss = gfc_walk_expr (expr->value.function.actual->expr);\n   gcc_assert (ss != gfc_ss_terminator);\n   ss->data.info.codimen = corank;\n+  argse.want_coarray = 1;\n   gfc_conv_expr_descriptor (&argse, expr->value.function.actual->expr, ss);\n   gfc_add_block_to_block (&se->pre, &argse.pre);\n   gfc_add_block_to_block (&se->post, &argse.post);\n@@ -1488,6 +1490,7 @@ conv_intrinsic_cobound (gfc_se * se, gfc_expr * expr)\n   gcc_assert (ss != gfc_ss_terminator);\n   ss->data.info.codimen = corank;\n   gfc_init_se (&argse, NULL);\n+  argse.want_coarray = 1;\n \n   gfc_conv_expr_descriptor (&argse, arg->expr, ss);\n   gfc_add_block_to_block (&se->pre, &argse.pre);"}, {"sha": "6157a885676a03ce94eadf801131008b07f89301", "filename": "gcc/fortran/trans.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2Ftrans.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/23c3d0f9726912bfa6e423ddb1dba67fb93be343/gcc%2Ffortran%2Ftrans.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans.h?ref=23c3d0f9726912bfa6e423ddb1dba67fb93be343", "patch": "@@ -86,6 +86,8 @@ typedef struct gfc_se\n      args alias.  */\n   unsigned force_tmp:1;\n \n+  unsigned want_coarray:1;\n+\n   /* Scalarization parameters.  */\n   struct gfc_se *parent;\n   struct gfc_ss *ss;"}]}