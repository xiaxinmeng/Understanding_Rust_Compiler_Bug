{"sha": "d42ba3b80a51696ae5e68602d1170b05a56af27e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQyYmEzYjgwYTUxNjk2YWU1ZTY4NjAyZDExNzBiMDVhNTZhZjI3ZQ==", "commit": {"author": {"name": "Shujing Zhao", "email": "pearly.zhao@oracle.com", "date": "2010-05-07T08:18:06Z"}, "committer": {"name": "Shujing Zhao", "email": "pzhao@gcc.gnu.org", "date": "2010-05-07T08:18:06Z"}, "message": "c-typeck.c (build_binary_op): Warn ordered comparison of pointer with null pointer and also warn about...\n\ngcc/\n2010-05-07  Shujing Zhao  <pearly.zhao@oracle.com>\n\n        * c-typeck.c (build_binary_op): Warn ordered comparison of pointer\n        with null pointer and also warn about ordered comparison of zero\n        with pointer if -Wextra.\n\ngcc/testsuite/\n2010-05-07  Shujing Zhao  <pearly.zhao@oracle.com>\n\n        * gcc.dg/ordered-comparison-1.c: New test.\n        * gcc.dg/ordered-comparison-2.c: New test.\n        * gcc.dg/ordered-comparison-3.c: New test.\n        * gcc.dg/ordered-comparison-4.c: New test.\n\nFrom-SVN: r159145", "tree": {"sha": "faabccf82b26d0837202f4853566831cd72abc7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/faabccf82b26d0837202f4853566831cd72abc7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d42ba3b80a51696ae5e68602d1170b05a56af27e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d42ba3b80a51696ae5e68602d1170b05a56af27e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d42ba3b80a51696ae5e68602d1170b05a56af27e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d42ba3b80a51696ae5e68602d1170b05a56af27e/comments", "author": null, "committer": null, "parents": [{"sha": "bb9c865802fd2b86e1de373af4cdf1fcde08000e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb9c865802fd2b86e1de373af4cdf1fcde08000e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb9c865802fd2b86e1de373af4cdf1fcde08000e"}], "stats": {"total": 112, "additions": 109, "deletions": 3}, "files": [{"sha": "f1885a9d82915cfed08f1f5c223636aeb2f01d9b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -1,3 +1,9 @@\n+2010-05-07  Shujing Zhao  <pearly.zhao@oracle.com>\n+\n+\t* c-typeck.c (build_binary_op): Warn ordered comparison of pointer\n+\twith null pointer and also warn about ordered comparison of zero with\n+\tpointer if -Wextra.\n+\n 2010-05-05  Andreas Simbuerger  <simbuerg@fim.uni-passau.de>\n \n \t* graphite-blocking.c"}, {"sha": "2f66d6a1446bd72f6f3cb93291bce2b8c2f11f80", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -9625,6 +9625,11 @@ build_binary_op (location_t location, enum tree_code code,\n \t      else if (TREE_CODE (TREE_TYPE (type0)) == FUNCTION_TYPE)\n \t\tpedwarn (location, OPT_pedantic, \"ISO C forbids \"\n \t\t\t \"ordered comparisons of pointers to functions\");\n+\t      else if (null_pointer_constant_p (orig_op0)\n+\t\t       || null_pointer_constant_p (orig_op1))\n+\t\twarning_at (location, OPT_Wextra,\n+\t\t\t    \"ordered comparison of pointer with null pointer\");\n+\n \t    }\n \t  else if (!addr_space_superset (as0, as1, &as_common))\n \t    {\n@@ -9649,13 +9654,17 @@ build_binary_op (location_t location, enum tree_code code,\n \t\t     \"ordered comparison of pointer with integer zero\");\n \t  else if (extra_warnings)\n \t    warning_at (location, OPT_Wextra,\n-\t\t     \"ordered comparison of pointer with integer zero\");\n+\t\t\t\"ordered comparison of pointer with integer zero\");\n \t}\n       else if (code1 == POINTER_TYPE && null_pointer_constant_p (orig_op0))\n \t{\n \t  result_type = type1;\n-\t  pedwarn (location, OPT_pedantic,\n-\t\t   \"ordered comparison of pointer with integer zero\");\n+\t  if (pedantic)\n+\t    pedwarn (location, OPT_pedantic,\n+\t\t     \"ordered comparison of pointer with integer zero\");\n+\t  else if (extra_warnings)\n+\t    warning_at (location, OPT_Wextra,\n+\t\t\t\"ordered comparison of pointer with integer zero\");\n \t}\n       else if (code0 == POINTER_TYPE && code1 == INTEGER_TYPE)\n \t{"}, {"sha": "50397eff888afe3508821ea2133eb4786e3726d6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -1,3 +1,10 @@\n+2010-05-07  Shujing Zhao  <pearly.zhao@oracle.com>\n+\n+\t* gcc.dg/ordered-comparison-1.c: New test.\n+\t* gcc.dg/ordered-comparison-2.c: New test.\n+\t* gcc.dg/ordered-comparison-3.c: New test.\n+\t* gcc.dg/ordered-comparison-4.c: New test.\n+\n 2010-05-06  Mike Stump  <mikestump@comcast.net>\n \n \tPR objc/35165"}, {"sha": "0131c9da8a36e81ffd17e142db0bd63b878b2aed", "filename": "gcc/testsuite/gcc.dg/ordered-comparison-1.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-1.c?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -0,0 +1,21 @@\n+/* Test warning for ordered comparison pointer with null pointer constant. */\n+/* Tested with no warning option. */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+extern void z();\n+void *p;\n+\n+void f() {\n+ if (z >= 0)\n+   z();\n+ if (0 >= z)\n+    z();\n+ if (p >= (void*)0)\n+    z();\n+ if ((void*)0 >= p)\n+    z();\n+ if (z >= (void*)0) /* { dg-warning \"distinct pointer types lacks a cast\" } */\n+    z();\n+ if ((void*)0 >=z) /* { dg-warning \"distinct pointer types lacks a cast\" } */\n+    z();\n+}"}, {"sha": "a99d9c32fb7bdff9e528c591d9f85c9b183024af", "filename": "gcc/testsuite/gcc.dg/ordered-comparison-2.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-2.c?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -0,0 +1,21 @@\n+/* Test warning for ordered comparison pointer with null pointer constant. */\n+/* Tested with -pedantic. */\n+/* { dg-do compile } */\n+/* { dg-options \"-pedantic\" } */\n+extern void z();\n+void *p;\n+\n+void f() {\n+ if (z >= 0) /* { dg-warning \"ordered comparison of pointer with\" } */\n+   z();\n+ if (0 >= z) /* { dg-warning \"ordered comparison of pointer with\" } */\n+    z();\n+ if (p >= (void*)0)\n+    z();\n+ if ((void*)0 >= p)\n+    z();\n+ if (z >= (void*)0) /* { dg-warning \"distinct pointer types lacks a cast\" } */\n+    z();\n+ if ((void*)0 >=z) /* { dg-warning \"distinct pointer types lacks a cast\" } */\n+    z();\n+}"}, {"sha": "2e4be4905e0f4b5340c7ed4b3fd5bf2aa72938e2", "filename": "gcc/testsuite/gcc.dg/ordered-comparison-3.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-3.c?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -0,0 +1,21 @@\n+/* Test warning for ordered comparison pointer with null pointer constant. */\n+/* Test with -pedantic-errors. */\n+/* { dg-do compile } */\n+/* { dg-options \"-pedantic-errors\" } */\n+extern void z();\n+void *p;\n+\n+void f() {\n+ if ( z >= 0 ) /* { dg-error \"ordered comparison of pointer with\" } */\n+   z();\n+ if ( 0 >= z) /* { dg-error \"ordered comparison of pointer with\" } */\n+    z();\n+ if ( p >= (void*)0 )\n+    z();\n+ if ( (void*)0 >= p)\n+    z();\n+ if (z >= (void*)0) /* { dg-error \"distinct pointer types lacks a cast\" } */\n+    z();\n+ if ((void*)0 >=z) /* { dg-error \"distinct pointer types lacks a cast\" } */\n+    z(); \n+}"}, {"sha": "ebe9eddf3e3f77a37ed8e3a53de79e1ee41a5e56", "filename": "gcc/testsuite/gcc.dg/ordered-comparison-4.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d42ba3b80a51696ae5e68602d1170b05a56af27e/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fordered-comparison-4.c?ref=d42ba3b80a51696ae5e68602d1170b05a56af27e", "patch": "@@ -0,0 +1,21 @@\n+/* Test warning for ordered comparison pointer with null pointer constant. */\n+/* Test with -Wextra. */\n+/* { dg-do compile } */\n+/* { dg-options \"-Wextra\" } */\n+extern void z();\n+void *p;\n+\n+void f() {\n+ if (z >= 0) /* { dg-warning \"ordered comparison of pointer with\" } */\n+   z();\n+ if (0 >= z) /* { dg-warning \"ordered comparison of pointer with\" } */\n+    z();\n+ if (p >= (void*)0) /* { dg-warning \"ordered comparison of pointer with null pointer\" } */\n+    z();\n+ if ((void*)0 >= p) /* { dg-warning \"ordered comparison of pointer with null pointer\" } */\n+    z();\n+ if (z >= (void*)0) /* { dg-warning \"distinct pointer types lacks a cast\" } */\n+    z();\n+ if ((void*)0 >=z) /* { dg-warning \"distinct pointer types lacks a cast\" } */\n+    z();\n+}"}]}