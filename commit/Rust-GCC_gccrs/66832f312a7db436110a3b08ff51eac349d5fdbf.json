{"sha": "66832f312a7db436110a3b08ff51eac349d5fdbf", "node_id": "C_kwDOANBUbNoAKDY2ODMyZjMxMmE3ZGI0MzYxMTBhM2IwOGZmNTFlYWMzNDlkNWZkYmY", "commit": {"author": {"name": "Kadoi Takemaru", "email": "diohabara@gmail.com", "date": "2021-10-31T13:22:21Z"}, "committer": {"name": "Kadoi Takemaru", "email": "diohabara@gmail.com", "date": "2021-11-01T11:05:18Z"}, "message": "Get rid of lambda within AST::TypePath and provide a method to return a reference\n\nRemove lambda expressions within AST::TypePath and use get_segments() to\niterate over AST::TypePathSegment\n\nFixes #718\n\nSigned-off-by: Kadoi Takemaru <diohabara@gmail.com>", "tree": {"sha": "56a34e691457a303c5b987b8d8996e16268d8228", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/56a34e691457a303c5b987b8d8996e16268d8228"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66832f312a7db436110a3b08ff51eac349d5fdbf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66832f312a7db436110a3b08ff51eac349d5fdbf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66832f312a7db436110a3b08ff51eac349d5fdbf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66832f312a7db436110a3b08ff51eac349d5fdbf/comments", "author": {"login": "diohabara", "id": 37092773, "node_id": "MDQ6VXNlcjM3MDkyNzcz", "avatar_url": "https://avatars.githubusercontent.com/u/37092773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diohabara", "html_url": "https://github.com/diohabara", "followers_url": "https://api.github.com/users/diohabara/followers", "following_url": "https://api.github.com/users/diohabara/following{/other_user}", "gists_url": "https://api.github.com/users/diohabara/gists{/gist_id}", "starred_url": "https://api.github.com/users/diohabara/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diohabara/subscriptions", "organizations_url": "https://api.github.com/users/diohabara/orgs", "repos_url": "https://api.github.com/users/diohabara/repos", "events_url": "https://api.github.com/users/diohabara/events{/privacy}", "received_events_url": "https://api.github.com/users/diohabara/received_events", "type": "User", "site_admin": false}, "committer": {"login": "diohabara", "id": 37092773, "node_id": "MDQ6VXNlcjM3MDkyNzcz", "avatar_url": "https://avatars.githubusercontent.com/u/37092773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/diohabara", "html_url": "https://github.com/diohabara", "followers_url": "https://api.github.com/users/diohabara/followers", "following_url": "https://api.github.com/users/diohabara/following{/other_user}", "gists_url": "https://api.github.com/users/diohabara/gists{/gist_id}", "starred_url": "https://api.github.com/users/diohabara/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/diohabara/subscriptions", "organizations_url": "https://api.github.com/users/diohabara/orgs", "repos_url": "https://api.github.com/users/diohabara/repos", "events_url": "https://api.github.com/users/diohabara/events{/privacy}", "received_events_url": "https://api.github.com/users/diohabara/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ca0b06f86fd44bd6067563dcbf4a2c021f2a79a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca0b06f86fd44bd6067563dcbf4a2c021f2a79a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca0b06f86fd44bd6067563dcbf4a2c021f2a79a5"}], "stats": {"total": 70, "additions": 24, "deletions": 46}, "files": [{"sha": "4c437cc3646e2a50aa3c7bbe7727bc06011f3560", "filename": "gcc/rust/ast/rust-path.h", "status": "modified", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66832f312a7db436110a3b08ff51eac349d5fdbf/gcc%2Frust%2Fast%2Frust-path.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66832f312a7db436110a3b08ff51eac349d5fdbf/gcc%2Frust%2Fast%2Frust-path.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fast%2Frust-path.h?ref=66832f312a7db436110a3b08ff51eac349d5fdbf", "patch": "@@ -754,15 +754,6 @@ class TypePath : public TypeNoBounds\n   }\n \n   size_t get_num_segments () const { return segments.size (); }\n-\n-  void iterate_segments (std::function<bool (TypePathSegment *)> cb)\n-  {\n-    for (auto it = segments.begin (); it != segments.end (); it++)\n-      {\n-\tif (!cb ((*it).get ()))\n-\t  return;\n-      }\n-  }\n };\n \n struct QualifiedPathType\n@@ -1029,15 +1020,6 @@ class QualifiedPathInType : public TypeNoBounds\n   }\n \n   Location get_locus () const override final { return locus; }\n-\n-  void iterate_segments (std::function<bool (TypePathSegment *)> cb)\n-  {\n-    for (auto it = segments.begin (); it != segments.end (); it++)\n-      {\n-\tif (!cb ((*it).get ()))\n-\t  return;\n-      }\n-  }\n };\n } // namespace AST\n } // namespace Rust"}, {"sha": "c6679321e7f5858edf2231fbec33dd61466fafc7", "filename": "gcc/rust/hir/rust-ast-lower-type.h", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66832f312a7db436110a3b08ff51eac349d5fdbf/gcc%2Frust%2Fhir%2Frust-ast-lower-type.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66832f312a7db436110a3b08ff51eac349d5fdbf/gcc%2Frust%2Fhir%2Frust-ast-lower-type.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower-type.h?ref=66832f312a7db436110a3b08ff51eac349d5fdbf", "patch": "@@ -62,20 +62,18 @@ class ASTLowerTypePath : public ASTLoweringBase\n   {\n     std::vector<std::unique_ptr<HIR::TypePathSegment>> translated_segments;\n \n-    path.iterate_segments ([&] (AST::TypePathSegment *seg) mutable -> bool {\n-      translated_segment = nullptr;\n-      seg->accept_vis (*this);\n-      if (translated_segment == nullptr)\n-\t{\n-\t  rust_fatal_error (seg->get_locus (),\n-\t\t\t    \"failed to translate AST TypePathSegment\");\n-\t  return false;\n-\t}\n-\n-      translated_segments.push_back (\n-\tstd::unique_ptr<HIR::TypePathSegment> (translated_segment));\n-      return true;\n-    });\n+    for (auto &seg : path.get_segments ())\n+      {\n+\ttranslated_segment = nullptr;\n+\tseg->accept_vis (*this);\n+\tif (translated_segment == nullptr)\n+\t  {\n+\t    rust_fatal_error (seg->get_locus (),\n+\t\t\t      \"failed to translate AST TypePathSegment\");\n+\t  }\n+\ttranslated_segments.push_back (\n+\t  std::unique_ptr<HIR::TypePathSegment> (translated_segment));\n+      }\n \n     auto crate_num = mappings->get_current_crate ();\n     auto hirid = mappings->get_next_hir_id (crate_num);"}, {"sha": "5f269b14ff6733e5ccf1f129e4bcbfc889ae4f64", "filename": "gcc/rust/hir/rust-ast-lower.cc", "status": "modified", "additions": 12, "deletions": 14, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66832f312a7db436110a3b08ff51eac349d5fdbf/gcc%2Frust%2Fhir%2Frust-ast-lower.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66832f312a7db436110a3b08ff51eac349d5fdbf/gcc%2Frust%2Fhir%2Frust-ast-lower.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower.cc?ref=66832f312a7db436110a3b08ff51eac349d5fdbf", "patch": "@@ -490,20 +490,18 @@ ASTLowerQualifiedPathInType::visit (AST::QualifiedPathInType &path)\n   std::unique_ptr<HIR::TypePathSegment> associated_segment (translated_segment);\n \n   std::vector<std::unique_ptr<HIR::TypePathSegment> > translated_segments;\n-  path.iterate_segments ([&] (AST::TypePathSegment *seg) mutable -> bool {\n-    translated_segment = nullptr;\n-    seg->accept_vis (*this);\n-    if (translated_segment == nullptr)\n-      {\n-\trust_fatal_error (seg->get_locus (),\n-\t\t\t  \"failed to translate AST TypePathSegment\");\n-\treturn false;\n-      }\n-\n-    translated_segments.push_back (\n-      std::unique_ptr<HIR::TypePathSegment> (translated_segment));\n-    return true;\n-  });\n+  for (auto &seg : path.get_segments ())\n+    {\n+      translated_segment = nullptr;\n+      seg->accept_vis (*this);\n+      if (translated_segment == nullptr)\n+\t{\n+\t  rust_fatal_error (seg->get_locus (),\n+\t\t\t    \"failed to translte AST TypePathSegment\");\n+\t}\n+      translated_segments.push_back (\n+\tstd::unique_ptr<HIR::TypePathSegment> (translated_segment));\n+    }\n \n   Analysis::NodeMapping mapping (crate_num, path.get_node_id (), hirid,\n \t\t\t\t mappings->get_next_localdef_id (crate_num));"}]}