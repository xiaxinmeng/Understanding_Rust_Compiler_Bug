{"sha": "9618fb3c1bf9bf211109d87c435804f164202bda", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTYxOGZiM2MxYmY5YmYyMTExMDlkODdjNDM1ODA0ZjE2NDIwMmJkYQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2009-07-25T13:44:57Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2009-07-25T13:44:57Z"}, "message": "re PR fortran/40005 (segfault in gt_ggc_mx_lang_tree_node)\n\n2009-07-25  Richard Guenther  <rguenther@suse.de>\n\n\tPR fortran/40005\n\t* trans-types.c (gfc_get_array_type_bounds): Use\n\tbuild_distinct_type_copy with a proper TYPE_CANONICAL and\n\tre-use the type-decl of the original type.\n\t* trans-decl.c (build_entry_thunks): Signal cgraph we may not\n\tgarbage collect.\n\t(create_main_function): Likewise.\n\t(gfc_generate_function_code): Likewise.\n\t* trans-expr.c (gfc_trans_subcomponent_assign): Do not use\n\tfold_convert on record types.\n\nFrom-SVN: r150079", "tree": {"sha": "f31a521b266ab7c2fc65803ebeda79fb66969e8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f31a521b266ab7c2fc65803ebeda79fb66969e8f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9618fb3c1bf9bf211109d87c435804f164202bda", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9618fb3c1bf9bf211109d87c435804f164202bda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9618fb3c1bf9bf211109d87c435804f164202bda", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9618fb3c1bf9bf211109d87c435804f164202bda/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "90661f261cdf7b2349d403c4669e0107faad310e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/90661f261cdf7b2349d403c4669e0107faad310e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/90661f261cdf7b2349d403c4669e0107faad310e"}], "stats": {"total": 27, "additions": 20, "deletions": 7}, "files": [{"sha": "189dba0ea3549b4a0d2321c99495e9687bfd3f7f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=9618fb3c1bf9bf211109d87c435804f164202bda", "patch": "@@ -1,3 +1,16 @@\n+2009-07-25  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR fortran/40005\n+\t* trans-types.c (gfc_get_array_type_bounds): Use\n+\tbuild_distinct_type_copy with a proper TYPE_CANONICAL and\n+\tre-use the type-decl of the original type.\n+\t* trans-decl.c (build_entry_thunks): Signal cgraph we may not\n+\tgarbage collect.\n+\t(create_main_function): Likewise.\n+\t(gfc_generate_function_code): Likewise.\n+\t* trans-expr.c (gfc_trans_subcomponent_assign): Do not use\n+\tfold_convert on record types.\n+\n 2009-07-25  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/39630"}, {"sha": "e4ac20f58b28c38ed39609a10638213d530843c0", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=9618fb3c1bf9bf211109d87c435804f164202bda", "patch": "@@ -2032,7 +2032,7 @@ build_entry_thunks (gfc_namespace * ns)\n \n       current_function_decl = NULL_TREE;\n \n-      cgraph_finalize_function (thunk_fndecl, false);\n+      cgraph_finalize_function (thunk_fndecl, true);\n \n       /* We share the symbols in the formal argument list with other entry\n \t points and the master function.  Clear them so that they are\n@@ -4114,7 +4114,7 @@ create_main_function (tree fndecl)\n   /* Output the GENERIC tree.  */\n   dump_function (TDI_original, ftn_main);\n \n-  cgraph_finalize_function (ftn_main, false);\n+  cgraph_finalize_function (ftn_main, true);\n \n   if (old_context)\n     {\n@@ -4385,7 +4385,7 @@ gfc_generate_function_code (gfc_namespace * ns)\n        added to our parent's nested function list.  */\n     (void) cgraph_node (fndecl);\n   else\n-    cgraph_finalize_function (fndecl, false);\n+    cgraph_finalize_function (fndecl, true);\n \n   gfc_trans_use_stmts (ns);\n   gfc_traverse_ns (ns, gfc_emit_parameter_debug_info);"}, {"sha": "9bec2e105137a7b802165a5eb9194193b508c6d2", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=9618fb3c1bf9bf211109d87c435804f164202bda", "patch": "@@ -3763,9 +3763,7 @@ gfc_trans_subcomponent_assign (tree dest, gfc_component * cm, gfc_expr * expr)\n \t  se.want_pointer = 0;\n \t  gfc_conv_expr_descriptor (&se, expr, rss);\n \t  gfc_add_block_to_block (&block, &se.pre);\n-\n-\t  tmp = fold_convert (TREE_TYPE (dest), se.expr);\n-\t  gfc_add_modify (&block, dest, tmp);\n+\t  gfc_add_modify (&block, dest, se.expr);\n \n \t  if (cm->ts.type == BT_DERIVED && cm->ts.derived->attr.alloc_comp)\n \t    tmp = gfc_copy_alloc_comp (cm->ts.derived, se.expr, dest,"}, {"sha": "99967ce3705fb4a54a6c73ee9b218f87fbd4bdcf", "filename": "gcc/fortran/trans-types.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2Ftrans-types.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9618fb3c1bf9bf211109d87c435804f164202bda/gcc%2Ffortran%2Ftrans-types.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-types.c?ref=9618fb3c1bf9bf211109d87c435804f164202bda", "patch": "@@ -1602,7 +1602,9 @@ gfc_get_array_type_bounds (tree etype, int dimen, tree * lbound,\n   int n;\n \n   base_type = gfc_get_array_descriptor_base (dimen);\n-  fat_type = build_variant_type_copy (base_type);\n+  fat_type = build_distinct_type_copy (base_type);\n+  TYPE_CANONICAL (fat_type) = base_type;\n+  TYPE_STUB_DECL (fat_type) = TYPE_STUB_DECL (base_type);\n \n   tmp = TYPE_NAME (etype);\n   if (tmp && TREE_CODE (tmp) == TYPE_DECL)"}]}