{"sha": "ac6a1181209b756882f89cdba6128565fad1a56e", "node_id": "C_kwDOANBUbNoAKGFjNmExMTgxMjA5Yjc1Njg4MmY4OWNkYmE2MTI4NTY1ZmFkMWE1NmU", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-01-14T11:11:00Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-01-14T11:11:00Z"}, "message": "libgfortran: Partly revert my r12-6498 change to fix Solaris build [PR104006]\n\nIn r12-6498 I've added $(version_dep) to BUILT_SOURCES, previously version_dep\non Linux used to be a file in $(srcdir), but with my changes it is a generated\nfile in the object directory (preprocessed version of the $(srcdir) file)\nand I thought generated files belong to BUILT_SOURCES so that they are\ncleaned up etc.\nFor Linux that is fine, but it broke parallel builds on Solaris.\nBUILT_SOURCES is a special variable for automake where automake ensures\nthat for make all, make check and make install all those $(BUILT_SOURCES)\nare generated before actually starting building in parallel the various\nobject files.  That way we can avoid hacks like:\n$(patsubst %.F90,%.lo,$(notdir $(filter %.F90,$(prereq_SRC)))): kinds.inc c99_protos.inc\n$(patsubst %.c,%.lo,$(notdir $(filter %.c,$(prereq_SRC)))): kinds.h\n$(patsubst %.f90,%.lo,selected_real_kind.f90): selected_real_kind.inc\n$(patsubst %.f90,%.lo,selected_int_kind.f90): selected_int_kind.inc\n$(patsubst %.F90,%.lo,ieee_exceptions.F90): fpu-target.inc\n$(patsubst %.F90,%.lo,ieee_arithmetic.F90): fpu-target.inc ieee_exceptions.lo\n$(patsubst %.c,%.lo,fpu.c): fpu-target.h\nwhich makes those dependencies explicit but hides it from automake, so that it\ndoesn't throw away its rules for those object files.\nOn Solaris, $(version_dep) contains gfortran.ver and gfortran.ver-sun.\ngfortran.ver is like on Linux, it can be in $(BUILT_SOURCES), but unfortunately\ngfortran.ver-sun depends on all the object files being compiled already,\nso if gfortran.ver-sun appears in $(BUILT_SOURCES), the BUILT_SOURCES function\nof ensuring the generated files are generated before building object files\nis gone, almost everything is built before all-am is entered and there\nare no explicit dependencies that e.g. *.F90 files depend on\nkinds.inc etc.\n\nSo, this change reverts that mistake and instead adds $(version_dep) to\nwhat is removed during make clean (clean-local in particular).\n\n2022-01-14  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR libfortran/104006\n\t* Makefile.am (BUILT_SOURCES): Don't include $(version_dep).\n\t(clean-local): Remove $(version_dep).\n\t* Makefile.in: Regenerated.", "tree": {"sha": "4baeb190965f5c29c733a3080d2c46599c51b9f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4baeb190965f5c29c733a3080d2c46599c51b9f4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ac6a1181209b756882f89cdba6128565fad1a56e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac6a1181209b756882f89cdba6128565fad1a56e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac6a1181209b756882f89cdba6128565fad1a56e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac6a1181209b756882f89cdba6128565fad1a56e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "cbf06187d5f246634272e3d2892501563bff3d99", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbf06187d5f246634272e3d2892501563bff3d99", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbf06187d5f246634272e3d2892501563bff3d99"}], "stats": {"total": 8, "additions": 4, "deletions": 4}, "files": [{"sha": "5ce0cd7cd0567824c385602ff2ded490e5e06b5a", "filename": "libgfortran/Makefile.am", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac6a1181209b756882f89cdba6128565fad1a56e/libgfortran%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac6a1181209b756882f89cdba6128565fad1a56e/libgfortran%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.am?ref=ac6a1181209b756882f89cdba6128565fad1a56e", "patch": "@@ -1118,7 +1118,7 @@ ieee_arithmetic.mod: ieee_arithmetic.lo\n \t:\n \n BUILT_SOURCES=$(gfor_built_src) $(gfor_built_specific_src) \\\n-\t$(gfor_built_specific2_src) $(gfor_misc_specifics) $(version_dep)\n+\t$(gfor_built_specific2_src) $(gfor_misc_specifics)\n \n prereq_SRC = $(gfor_src) $(gfor_built_src) $(gfor_io_src) \\\n \t$(gfor_helper_src) $(gfor_ieee_src) $(gfor_io_headers) $(gfor_specific_src)\n@@ -1356,7 +1356,7 @@ $(gfor_misc_specifics): m4/misc_specifics.m4 m4/head.m4\n endif\n \n clean-local:\n-\t-rm -rf include\n+\t-rm -rf include $(version_dep)\n \n EXTRA_DIST = $(m4_files)\n "}, {"sha": "7ac6bfba657e09cf6a40d94ae33fbcc943e610db", "filename": "libgfortran/Makefile.in", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac6a1181209b756882f89cdba6128565fad1a56e/libgfortran%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac6a1181209b756882f89cdba6128565fad1a56e/libgfortran%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FMakefile.in?ref=ac6a1181209b756882f89cdba6128565fad1a56e", "patch": "@@ -1652,7 +1652,7 @@ intrinsics/random_init.f90\n \n BUILT_SOURCES = $(gfor_built_src) $(gfor_built_specific_src) \\\n \t$(gfor_built_specific2_src) $(gfor_misc_specifics) \\\n-\t$(version_dep) $(am__append_7)\n+\t$(am__append_7)\n prereq_SRC = $(gfor_src) $(gfor_built_src) $(gfor_io_src) \\\n \t$(gfor_helper_src) $(gfor_ieee_src) $(gfor_io_headers) $(gfor_specific_src)\n \n@@ -7857,7 +7857,7 @@ include/ISO_Fortran_binding.h: $(srcdir)/ISO_Fortran_binding.h\n @MAINTAINER_MODE_TRUE@\t$(M4) -Dfile=$@ -I$(srcdir)/m4 misc_specifics.m4 > $@\n \n clean-local:\n-\t-rm -rf include\n+\t-rm -rf include $(version_dep)\n \n # target overrides\n -include $(tmake_file)"}]}