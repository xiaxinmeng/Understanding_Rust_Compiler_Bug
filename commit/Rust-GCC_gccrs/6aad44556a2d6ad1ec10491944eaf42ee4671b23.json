{"sha": "6aad44556a2d6ad1ec10491944eaf42ee4671b23", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmFhZDQ0NTU2YTJkNmFkMWVjMTA0OTE5NDRlYWY0MmVlNDY3MWIyMw==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2013-02-21T20:16:26Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2013-02-21T20:16:26Z"}, "message": "re PR middle-end/56108 (Asm statement in transaction_relaxed crashes compiler.)\n\n\tPR middle-end/56108\n\t* trans-mem.c (execute_tm_mark): Do not expand transactions that\n\tare sure to go irrevocable.\ntestsuite/\n\t* gcc.dg/tm/memopt-1.c: Declare functions transaction_safe.\n\nFrom-SVN: r196213", "tree": {"sha": "e2aef86ce90ad55c79e619525105d95f17193c00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e2aef86ce90ad55c79e619525105d95f17193c00"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6aad44556a2d6ad1ec10491944eaf42ee4671b23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6aad44556a2d6ad1ec10491944eaf42ee4671b23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6aad44556a2d6ad1ec10491944eaf42ee4671b23", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6aad44556a2d6ad1ec10491944eaf42ee4671b23/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "304886c59c0521ff1c6bfc798181a6b0a17e9368", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/304886c59c0521ff1c6bfc798181a6b0a17e9368", "html_url": "https://github.com/Rust-GCC/gccrs/commit/304886c59c0521ff1c6bfc798181a6b0a17e9368"}], "stats": {"total": 43, "additions": 39, "deletions": 4}, "files": [{"sha": "343417ce958419646e1b5b88c912d7fe1c43dd86", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6aad44556a2d6ad1ec10491944eaf42ee4671b23", "patch": "@@ -1,3 +1,9 @@\n+2013-02-20  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\tPR middle-end/56108\n+\t* trans-mem.c (execute_tm_mark): Do not expand transactions that\n+\tare sure to go irrevocable.\n+\n 2013-02-21  Hans-Peter Nilsson  <hp@axis.com>\n \n \t* doc/rtl.texi (vec_concat, vec_duplicate): Mention that"}, {"sha": "5bffe4317bd1af4278be419a3576840237e056c7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6aad44556a2d6ad1ec10491944eaf42ee4671b23", "patch": "@@ -1,3 +1,8 @@\n+2013-02-20  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\tPR middle-end/56108\n+\t* gcc.dg/tm/memopt-1.c: Declare functions transaction_safe.\n+\n 2013-02-21  Martin Jambor  <mjambor@suse.cz>\n \n \tPR tree-optimization/56310"}, {"sha": "c5ac5ced56c7bcc842baccbd14e516d00f0b3c56", "filename": "gcc/testsuite/gcc.dg/tm/memopt-1.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fmemopt-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fmemopt-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fmemopt-1.c?ref=6aad44556a2d6ad1ec10491944eaf42ee4671b23", "patch": "@@ -2,8 +2,8 @@\n /* { dg-options \"-fgnu-tm -O -fdump-tree-tmmemopt\" } */\n \n long g, xxx, yyy;\n-extern george() __attribute__((transaction_callable));\n-extern ringo(long int);\n+extern george() __attribute__((transaction_safe));\n+extern ringo(long int) __attribute__((transaction_safe));\n int i;\n \n f()"}, {"sha": "81ff574cd472e6bfd321c0c1255ccb4b4a73e5a4", "filename": "gcc/testsuite/gcc.dg/tm/pr56108.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr56108.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr56108.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr56108.c?ref=6aad44556a2d6ad1ec10491944eaf42ee4671b23", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fgnu-tm -O\" } */\n+\n+int\n+main()\n+{\n+  __transaction_relaxed { __asm__(\"\"); }\n+  return 0;\n+}"}, {"sha": "71eaa4464e0758237ee285fe173f679e81696137", "filename": "gcc/trans-mem.c", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftrans-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6aad44556a2d6ad1ec10491944eaf42ee4671b23/gcc%2Ftrans-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftrans-mem.c?ref=6aad44556a2d6ad1ec10491944eaf42ee4671b23", "patch": "@@ -2859,8 +2859,23 @@ execute_tm_mark (void)\n   // Expand memory operations into calls into the runtime.\n   // This collects log entries as well.\n   FOR_EACH_VEC_ELT (bb_regions, i, r)\n-    if (r != NULL)\n-      expand_block_tm (r, BASIC_BLOCK (i));\n+    {\n+      if (r != NULL)\n+\t{\n+\t  if (r->transaction_stmt)\n+\t    {\n+\t      unsigned sub = gimple_transaction_subcode (r->transaction_stmt);\n+\n+\t      /* If we're sure to go irrevocable, there won't be\n+\t\t anything to expand, since the run-time will go\n+\t\t irrevocable right away.  */\n+\t      if (sub & GTMA_DOES_GO_IRREVOCABLE\n+\t\t  && sub & GTMA_MAY_ENTER_IRREVOCABLE)\n+\t\tcontinue;\n+\t    }\n+\t  expand_block_tm (r, BASIC_BLOCK (i));\n+\t}\n+    }\n \n   bb_regions.release ();\n "}]}