{"sha": "58a45ce44a9acf3d15fada265d2a391a8e1bc960", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThhNDVjZTQ0YTlhY2YzZDE1ZmFkYTI2NWQyYTM5MWE4ZTFiYzk2MA==", "commit": {"author": {"name": "Martin Uecker", "email": "muecker@gwdg.de", "date": "2020-12-16T22:47:52Z"}, "committer": {"name": "Martin Uecker", "email": "muecker@gwdg.de", "date": "2020-12-16T22:51:25Z"}, "message": "C: Drop qualifiers of assignment expressions. [PR98047]\n\nISO C17 6.5.15.1 specifies that the result is the\ntype the LHS would have after lvalue conversion.\n\n2020-12-16  Martin Uecker  <muecker@gwdg.de>\n\ngcc/c/\n\tPR c/98047\n\t* c-typeck.c (build_modify_expr): Drop qualifiers.\n\ngcc/testsuite/\n\tPR c/98047\n\t* gcc.dg/qual-assign-7.c: New test.", "tree": {"sha": "69fbd5b87d917a812ff0d60a679afcf7d34d8d34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/69fbd5b87d917a812ff0d60a679afcf7d34d8d34"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58a45ce44a9acf3d15fada265d2a391a8e1bc960", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58a45ce44a9acf3d15fada265d2a391a8e1bc960", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58a45ce44a9acf3d15fada265d2a391a8e1bc960", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58a45ce44a9acf3d15fada265d2a391a8e1bc960/comments", "author": {"login": "uecker", "id": 2036635, "node_id": "MDQ6VXNlcjIwMzY2MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/2036635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/uecker", "html_url": "https://github.com/uecker", "followers_url": "https://api.github.com/users/uecker/followers", "following_url": "https://api.github.com/users/uecker/following{/other_user}", "gists_url": "https://api.github.com/users/uecker/gists{/gist_id}", "starred_url": "https://api.github.com/users/uecker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/uecker/subscriptions", "organizations_url": "https://api.github.com/users/uecker/orgs", "repos_url": "https://api.github.com/users/uecker/repos", "events_url": "https://api.github.com/users/uecker/events{/privacy}", "received_events_url": "https://api.github.com/users/uecker/received_events", "type": "User", "site_admin": false}, "committer": {"login": "uecker", "id": 2036635, "node_id": "MDQ6VXNlcjIwMzY2MzU=", "avatar_url": "https://avatars.githubusercontent.com/u/2036635?v=4", "gravatar_id": "", "url": "https://api.github.com/users/uecker", "html_url": "https://github.com/uecker", "followers_url": "https://api.github.com/users/uecker/followers", "following_url": "https://api.github.com/users/uecker/following{/other_user}", "gists_url": "https://api.github.com/users/uecker/gists{/gist_id}", "starred_url": "https://api.github.com/users/uecker/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/uecker/subscriptions", "organizations_url": "https://api.github.com/users/uecker/orgs", "repos_url": "https://api.github.com/users/uecker/repos", "events_url": "https://api.github.com/users/uecker/events{/privacy}", "received_events_url": "https://api.github.com/users/uecker/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ec13758ed41936bf803640f0dd8c259c034fe4b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec13758ed41936bf803640f0dd8c259c034fe4b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec13758ed41936bf803640f0dd8c259c034fe4b9"}], "stats": {"total": 31, "additions": 21, "deletions": 10}, "files": [{"sha": "f68cb01529b39df044f70989b476907848dbc989", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 3, "deletions": 10, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a45ce44a9acf3d15fada265d2a391a8e1bc960/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a45ce44a9acf3d15fada265d2a391a8e1bc960/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=58a45ce44a9acf3d15fada265d2a391a8e1bc960", "patch": "@@ -6275,16 +6275,9 @@ build_modify_expr (location_t location, tree lhs, tree lhs_origtype,\n \t\t    \"enum conversion in assignment is invalid in C++\");\n     }\n \n-  /* If the lhs is atomic, remove that qualifier.  */\n-  if (is_atomic_op)\n-    {\n-      lhstype = build_qualified_type (lhstype, \n-\t\t\t\t      (TYPE_QUALS (lhstype)\n-\t\t\t\t       & ~TYPE_QUAL_ATOMIC));\n-      olhstype = build_qualified_type (olhstype, \n-\t\t\t\t       (TYPE_QUALS (lhstype)\n-\t\t\t\t\t& ~TYPE_QUAL_ATOMIC));\n-    }\n+  /* Remove qualifiers.  */\n+  lhstype = build_qualified_type (lhstype, TYPE_UNQUALIFIED);\n+  olhstype = build_qualified_type (olhstype, TYPE_UNQUALIFIED);\n \n   /* Convert new value to destination type.  Fold it first, then\n      restore any excess precision information, for the sake of"}, {"sha": "3e064e82f5f3cecc2fe5659b2ba76b95b87db88d", "filename": "gcc/testsuite/gcc.dg/qual-assign-7.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58a45ce44a9acf3d15fada265d2a391a8e1bc960/gcc%2Ftestsuite%2Fgcc.dg%2Fqual-assign-7.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58a45ce44a9acf3d15fada265d2a391a8e1bc960/gcc%2Ftestsuite%2Fgcc.dg%2Fqual-assign-7.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fqual-assign-7.c?ref=58a45ce44a9acf3d15fada265d2a391a8e1bc960", "patch": "@@ -0,0 +1,18 @@\n+/* test that assignment drops qualifiers, Bug 98047 */\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+\n+volatile int jv;\n+extern int j;\n+extern typeof(jv = 1) j;\n+\n+_Atomic int ja;\n+extern typeof(ja = 1) j;\n+\n+int * __restrict pa;\n+extern int *p;\n+extern typeof(pa = 0) p;\n+\n+\n+"}]}