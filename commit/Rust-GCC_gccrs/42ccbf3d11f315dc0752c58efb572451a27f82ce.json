{"sha": "42ccbf3d11f315dc0752c58efb572451a27f82ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDJjY2JmM2QxMWYzMTVkYzA3NTJjNThlZmI1NzI0NTFhMjdmODJjZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2006-07-16T20:17:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2006-07-16T20:17:20Z"}, "message": "re PR c++/28370 (undefined reference to template class static variable in an anonymous namespace)\n\n\tPR c++/28370\n\t* decl2.c (note_vague_linkage_var): Removed.\n\t(finish_static_data_member_decl): Add decl to pending_statics vector\n\tdirectly.  Do it even for non-public decls.\n\n\t* g++.dg/template/anon3.C: New test.\n\nFrom-SVN: r115503", "tree": {"sha": "a8edcb458cc8e6dc5ef694bad053a8ec1a2f1e6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a8edcb458cc8e6dc5ef694bad053a8ec1a2f1e6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/42ccbf3d11f315dc0752c58efb572451a27f82ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42ccbf3d11f315dc0752c58efb572451a27f82ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42ccbf3d11f315dc0752c58efb572451a27f82ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42ccbf3d11f315dc0752c58efb572451a27f82ce/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "22d67c60fa3b3fec0891c03693dbdd86f8389815", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22d67c60fa3b3fec0891c03693dbdd86f8389815", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22d67c60fa3b3fec0891c03693dbdd86f8389815"}], "stats": {"total": 44, "additions": 34, "deletions": 10}, "files": [{"sha": "d1eb30fea24edb8e3fe20e11993d0451c08f06bf", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=42ccbf3d11f315dc0752c58efb572451a27f82ce", "patch": "@@ -1,3 +1,10 @@\n+2006-07-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/28370\n+\t* decl2.c (note_vague_linkage_var): Removed.\n+\t(finish_static_data_member_decl): Add decl to pending_statics vector\n+\tdirectly.  Do it even for non-public decls.\n+\n 2006-07-15  Lee Millward  <lee.millward@gmail.com>\n \n \tPR c++/28292"}, {"sha": "dfb30f25d936d38e3550eb26eb9eeaa4ba267d1c", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 2, "deletions": 10, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=42ccbf3d11f315dc0752c58efb572451a27f82ce", "patch": "@@ -700,14 +700,6 @@ note_vague_linkage_fn (tree decl)\n     }\n }\n \n-/* Like note_vague_linkage_fn but for variables.  */\n-\n-static void\n-note_vague_linkage_var (tree var)\n-{\n-  VEC_safe_push (tree, gc, pending_statics, var);\n-}\n-\n /* We have just processed the DECL, which is a static data member.\n    The other parameters are as for cp_finish_decl.  */\n \n@@ -723,8 +715,8 @@ finish_static_data_member_decl (tree decl,\n      TREE_CHAIN of our decl.  Instead, we modify cp_finish_decl to do\n      the right thing, namely, to put this decl out straight away.  */\n \n-  if (! processing_template_decl && TREE_PUBLIC (decl))\n-    note_vague_linkage_var (decl);\n+  if (! processing_template_decl)\n+    VEC_safe_push (tree, gc, pending_statics, decl);\n \n   if (LOCAL_CLASS_P (current_class_type))\n     pedwarn (\"local class %q#T shall not have static data member %q#D\","}, {"sha": "98eaa25b066650f78e6a08f88fec472b0e5b51d9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=42ccbf3d11f315dc0752c58efb572451a27f82ce", "patch": "@@ -1,3 +1,8 @@\n+2006-07-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/28370\n+\t* g++.dg/template/anon3.C: New test.\n+\n 2006-07-16  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/20844"}, {"sha": "eee7acd820f69a94429a03826ec137775ec65c8e", "filename": "gcc/testsuite/g++.dg/template/anon3.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fanon3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42ccbf3d11f315dc0752c58efb572451a27f82ce/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fanon3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fanon3.C?ref=42ccbf3d11f315dc0752c58efb572451a27f82ce", "patch": "@@ -0,0 +1,20 @@\n+// PR c++/28370\n+// { dg-do run }\n+\n+namespace\n+{\n+  template<typename T> struct A { static int *a; };\n+  template<typename T> int *A<T>::a = 0;\n+}\n+\n+int *\n+foo ()\n+{\n+  return A<int>::a;\n+}\n+\n+int\n+main ()\n+{\n+  return foo() != 0;\n+}"}]}