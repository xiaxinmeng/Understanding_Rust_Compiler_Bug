{"sha": "b75d998f0e5752f78317475b43c9928dcd5d3ed9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yjc1ZDk5OGYwZTU3NTJmNzgzMTc0NzViNDNjOTkyOGRjZDVkM2VkOQ==", "commit": {"author": {"name": "Zack Weinberg", "email": "zack@wolery.stanford.edu", "date": "2000-12-05T22:12:42Z"}, "committer": {"name": "Zack Weinberg", "email": "zack@gcc.gnu.org", "date": "2000-12-05T22:12:42Z"}, "message": "texi2pod.pl: Restructure for comprehensibility, add comments.\n\n\t* texi2pod.pl: Restructure for comprehensibility, add\n\tcomments.  Merge handling of @ignore and @ifxxx.  Handle a\n\twhole bunch more Texinfo commands.  Use consistent formatting\n\tstyle.\n\nFrom-SVN: r38052", "tree": {"sha": "1fefc53ab598af4c1c14d32c53f95525b0d27813", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1fefc53ab598af4c1c14d32c53f95525b0d27813"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b75d998f0e5752f78317475b43c9928dcd5d3ed9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b75d998f0e5752f78317475b43c9928dcd5d3ed9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b75d998f0e5752f78317475b43c9928dcd5d3ed9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b75d998f0e5752f78317475b43c9928dcd5d3ed9/comments", "author": null, "committer": null, "parents": [{"sha": "f4c79fef19baa1fd228a1fafc34e00c2c84e53a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f4c79fef19baa1fd228a1fafc34e00c2c84e53a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f4c79fef19baa1fd228a1fafc34e00c2c84e53a7"}], "stats": {"total": 292, "additions": 190, "deletions": 102}, "files": [{"sha": "b2a4d8d9b6f75f83155556cbaa853c4278968214", "filename": "contrib/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b75d998f0e5752f78317475b43c9928dcd5d3ed9/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b75d998f0e5752f78317475b43c9928dcd5d3ed9/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=b75d998f0e5752f78317475b43c9928dcd5d3ed9", "patch": "@@ -1,3 +1,10 @@\n+2000-12-05  Zack Weinberg  <zack@wolery.stanford.edu>\n+\n+\t* texi2pod.pl: Restructure for comprehensibility, add\n+\tcomments.  Merge handling of @ignore and @ifxxx.  Handle a\n+\twhole bunch more Texinfo commands.  Use consistent formatting\n+\tstyle.\n+\n 2000-12-04  Joseph S. Myers  <jsm28@cam.ac.uk>\n \n \t* gennews: New script."}, {"sha": "70c253c8143278864613f95fd200519ebd983d98", "filename": "contrib/texi2pod.pl", "status": "modified", "additions": 183, "deletions": 102, "changes": 285, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b75d998f0e5752f78317475b43c9928dcd5d3ed9/contrib%2Ftexi2pod.pl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b75d998f0e5752f78317475b43c9928dcd5d3ed9/contrib%2Ftexi2pod.pl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Ftexi2pod.pl?ref=b75d998f0e5752f78317475b43c9928dcd5d3ed9", "patch": "@@ -5,7 +5,6 @@\n # something suitable for a manpage from a Texinfo document.\n \n $output = 0;\n-$ignore = 0;\n $skipping = 0;\n %sects = ();\n $section = \"\";\n@@ -14,9 +13,9 @@\n @skstack = ();\n $shift = \"\";\n %defs = ();\n+$fnno = 1;\n \n-while($_ = shift)\n-{\n+while ($_ = shift) {\n     if (/^-D(.*)$/) {\n \tif ($1 ne \"\") {\n \t    $flag = $1;\n@@ -46,119 +45,133 @@\n \n while(<STDIN>)\n {\n+    # Certain commands are discarded without further processing.\n+    /^\\@(?:\n+\t [a-z]+index\t\t# @*index: useful only in complete manual\n+\t |need\t\t\t# @need: useful only in printed manual\n+\t |(?:end\\s+)?group\t# @group .. @end group: ditto\n+\t |page\t\t\t# @page: ditto\n+\t |node\t\t\t# @node: useful only in .info file\n+\t)\\b/x and next;\n+    \n     chomp;\n+\n+    # Look for filename and title markers.\n+    /^\\@setfilename\\s+([^.]+)/ and $fn = $1, next;\n+    /^\\@settitle\\s+([^.]+)/ and $tl = $1, next;\n+\n+    # Look for blocks surrounded by @c man begin SECTION ... @c man end.\n+    # This really oughta be @ifman ... @end ifman and the like, but such\n+    # would require rev'ing all other Texinfo translators.\n     /^\\@c man begin ([A-Z]+)/ and $sect = $1, $output = 1, next;\n     /^\\@c man end/ and do {\n-\t$_ = $section;\n-\n-\ts/\\@(?:dfn|var|emph|cite)\\{([^\\}]*)\\}/I<$1>/g;\n-\ts/\\@(?:code|kbd)\\{([^\\}]*)\\}/C<$1>/g;\n-\ts/\\@(?:samp|strong|key)\\{([^\\}]*)\\}/B<$1>/g;\n-\ts/\\@value\\{([a-zA-Z0-9_-]+)\\}/$defs{$1}/g;\n-\ts/\\@sc\\{([^\\}]*)\\}/\\U$1/g;\n-\ts/\\@file\\{([^\\}]*)\\}/F<$1>/g;\n-\ts/\\@(?:url|email)\\{([^\\}]*)\\}/E<lt>C<$1>E<rt>/g;\n-\ts/\\@xref\\{(?:[^\\}]*)\\}[^.]*.//g;\n-\ts/\\s+\\(\\@p[a-z]?ref\\{(?:[^\\}]*)\\}\\)//g;\n-\ts/\\@copyright\\{\\}//g;\n-\ts/\\@noindent\\s*//g;\n-\ts/\\@refill//g;\n-\ts/\\@\\././g;\n-\n-\t# Turn B<blah I<blah> blah> into B<blah> I<blah> B<blah> to\n-\t# match Texinfo semantics of @emph inside @samp.\n-\n-\ts/&LT;/</g;\n-\ts/&GT;/>/g;\n-\t1 while (s/B<([^<>]*)I<([^>]+)>/B<$1>I<$2>B</g);\n-\t1 while (s/I<([^<>]*)B<([^>]+)>/I<$1>B<$2>I</g);\n-\ts/[BI]<>//g;\n-\ts/([BI])<(\\s+)([^>]+)>/$2$1<$3>/g;\n-\ts/([BI])<([^>]+?)(\\s+)>/$1<$2>$3/g;\n-\n-\ts/&lt;/E<lt>/g;\n-\ts/&gt;/E<gt>/g;\n-\ts/&lbrace;/\\{/g;\n-\ts/&rbrace;/\\}/g;\n-\n-\t$sects{$sect} = $_;\n+\t$sects{$sect} = postprocess($section);\n \t$section = \"\";\n \t$output = 0;\n \tnext;\n     };\n+    next unless $output;\n \n-    /^\\@(c|[a-z]+index)\\b/ and next;\n-    /^\\@subsection/ and next;\n-    /^\\@need/ and next;\n-    /^\\@node/ and next;\n+    # Discard comments.  (Can't do it above, because then we'd never see\n+    # @c man lines.)\n+    /^\\@c\\b/ and next;\n \n-    /^\\@setfilename\\s+([^.]+)/ and $fn = $1, next;\n-    /^\\@settitle\\s+([^.]+)/ and $tl = $1, next;\n+    # End-block handler goes up here because it needs to operate even\n+    # if we are skipping.\n+    /^\\@end\\s+([a-z]+)/ and do {\n+\tdie \"\\@end $1 without \\@$1 at line $.\\n\" unless defined $endw;\n+\tdie \"\\@$endw ended by \\@end $1 at line $.\\n\" unless $1 eq $endw;\n \n-    next unless $output;\n+\t$endw = pop @endwstack;\n \n-    /^\\@end\\s+([a-z]+)/ and do {\n-\tif(defined $endw)\n-\t{\n-\t    die \"\\@$endw ended by \\@end $1 at line $.\\n\"\n-\t\tunless $1 eq $endw;\n-\n-\t    if($endw =~ /example$/)\n-\t    {\n-\t\t$shift = \"\";\n-\t\t$_ = \"\";\n-\t    }\n-\t    elsif($endw =~ /^if/)\n-\t    {\n-\t\t$skipping = pop @skstack;\n-\t\t$_ = \"\";\n-\t    }\n-\t    else\n-\t    {\n-\t\t$_ = \"\\n=back\\n\";\n-\t\t$ic = pop @icstack;\n-\t    }\n-\t    $endw = pop @endwstack;\n+\tif ($1 =~ /example$/) {\n+\t    $shift = \"\";\n+\t    next;\n+\t} elsif ($1 =~ /^(if|ignore|menu)/) {\n+\t    $skipping = pop @skstack;\n+\t    next;\n+\t} else {\n+\t    $_ = \"\\n=back\\n\";\n+\t    $ic = pop @icstack;\n \t}\n     };\n-\n-    /^\\@end ignore/ and $ignore = 0, next;\n-    next if $ignore;\n     next if $skipping;\n \n-    /^\\@ignore/ and $ignore = 1, next;\n+    # Character entities.  First the ones that can be replaced by raw text\n+    # or discarded outright:\n+    s/\\@copyright\\{\\}/(c)/g;\n+    s/\\@dots\\{\\}/.../g;\n+    s/\\@enddots\\{\\}/..../g;\n+    s/\\@([.!? ])/$1/g;\n+    s/\\@[:-]//g;\n+    s/\\@bullet(?:\\{\\})?/*/g;\n+    s/\\@TeX\\{\\}/TeX/g;\n+    s/\\@pounds\\{\\}/\\#/g;\n+    s/\\@minus(?:\\{\\})?/-/g;\n \n+    # Now the ones that have to be replaced by special escapes\n+    # (which will be turned back into text by unmunge())\n+    s/&/&amp;/g;\n+    s/\\@\\{/&lbrace;/g;\n+    s/\\@\\}/&rbrace;/g;\n+    s/\\@\\@/&at;/g;\n+    # POD doesn't interpret E<> inside a verbatim block.\n+    if ($shift eq \"\") {\n+\ts/</&lt;/g;\n+\ts/>/&gt;/g;\n+    } else {\n+\ts/</&LT;/g;\n+\ts/>/&GT;/g;\n+    }\n+\n+    # Single line command handlers.\n     /^\\@set\\s+([a-zA-Z0-9_-]+)\\s*(.*)$/ and $defs{$1} = $2, next;\n     /^\\@clear\\s+([a-zA-Z0-9_-]+)/ and delete $defs{$1}, next;\n \n+    /^\\@section\\s+(.+)$/ and $_ = \"\\n=head2 $1\\n\";\n+    /^\\@subsection\\s+(.+)$/ and $_ = \"\\n=head3 $1\\n\";\n+\n+    # Block command handlers:\n     /^\\@ifset\\s+([a-zA-Z0-9_-]+)/ and do {\n \tpush @endwstack, $endw;\n \tpush @skstack, $skipping;\n \t$endw = \"ifset\";\n \t$skipping = 1 unless exists $defs{$1};\n+\tnext;\n     };\n \n     /^\\@ifclear\\s+([a-zA-Z0-9_-]+)/ and do {\n \tpush @endwstack, $endw;\n \tpush @skstack, $skipping;\n-\t$endw = \"ifset\";\n+\t$endw = \"ifclear\";\n \t$skipping = 1 if exists $defs{$1};\n+\tnext;\n     };\n \n-    /^\\@itemize (\\@[a-z]+)/ and do {\n+    /^\\@(ignore|menu)\\b/ and do {\n+\tpush @endwstack, $endw;\n+\tpush @skstack, $skipping;\n+\t$endw = $1;\n+\t$skipping = 1;\n+\tnext;\n+    };\n+\n+    /^\\@itemize\\s+(\\@[a-z]+|\\*|-)/ and do {\n \tpush @endwstack, $endw;\n \tpush @icstack, $ic;\n \t$ic = $1;\n-\t$ic =~ s/\\@bullet/*/;\n-\t$ic =~ s/\\@minus/-/;\n \t$_ = \"\\n=over 4\\n\";\n \t$endw = \"itemize\";\n     };\n \n-    /^\\@enumerate\\s+([A-Z0-9]+)/ and do {\n+    /^\\@enumerate(?:\\s+([A-Z0-9]+))?/ and do {\n \tpush @endwstack, $endw;\n \tpush @icstack, $ic;\n-\t$ic = $1 . \".\";\n+\tif (defined $1) {\n+\t    $ic = $1 . \".\";\n+\t} else {\n+\t    $ic = \"1.\";\n+\t}\n \t$_ = \"\\n=over 4\\n\";\n \t$endw = \"enumerate\";\n     };\n@@ -169,7 +182,7 @@\n \t$ic = $1;\n \t$ic =~ s/\\@(?:samp|strong|key)/B/;\n \t$ic =~ s/\\@(?:code|kbd)/C/;\n-\t$ic =~ s/\\@(?:dfn|var|emph|cite)/I/;\n+\t$ic =~ s/\\@(?:dfn|var|emph|cite|i)/I/;\n \t$ic =~ s/\\@(?:file)/F/;\n \t$_ = \"\\n=over 4\\n\";\n \t$endw = \"table\";\n@@ -183,45 +196,30 @@\n     };\n \n     /^\\@itemx?\\s*(.+)?$/ and do {\n-\tif(defined $1)\n-\t{\n-\t    $_ = \"=item $ic\\&LT;$1\\&GT;\\n\";\n-\t}\n-\telse\n-\t{\n-\t    $_ = \"=item $ic\\n\";\n+\tif (defined $1) {\n+\t    # Entity escapes prevent munging by the <> processing below.\n+\t    $_ = \"\\n=item $ic\\&LT;$1\\&GT;\\n\";\n+\t} else {\n+\t    $_ = \"\\n=item $ic\\n\";\n \t    $ic =~ y/A-Ya-y1-8/B-Zb-z2-9/;\n \t}\n     };\n \n-    /^\\@section\\s+(.+)$/ and do {\n-\t$_ = \"\\n=head2 $1\\n\";\n-    };\n-\n-    # POD doesn't interpret E<> inside a verbatim block.\n-    if ($shift eq \"\") {\n-\ts/</&lt;/g;\n-\ts/>/&gt;/g;\n-    } else {\n-\ts/</&LT;/g;\n-\ts/>/&GT;/g;\n-    }\n-    s/\\@\\{/&lbrace;/g;\n-    s/\\@\\}/&rbrace;/g;\n     $section .= $shift.$_.\"\\n\";\n }\n \n+die \"No filename or title\\n\" unless defined $fn && defined $tl;\n+\n $sects{NAME} = \"$fn \\- $tl\\n\";\n+$sects{FOOTNOTES} .= \"=back\\n\" if exists $sects{FOOTNOTES};\n \n for $sect (qw(NAME SYNOPSIS DESCRIPTION OPTIONS ENVIRONMENT FILES\n-\t      BUGS NOTES SEEALSO AUTHOR COPYRIGHT))\n-{\n-    if(exists $sects{$sect})\n-    {\n+\t      BUGS NOTES FOOTNOTES SEEALSO AUTHOR COPYRIGHT)) {\n+    if(exists $sects{$sect}) {\n \t$head = $sect;\n \t$head =~ s/SEEALSO/SEE ALSO/;\n \tprint \"=head1 $head\\n\\n\";\n-\tprint $sects{$sect};\n+\tprint scalar unmunge ($sects{$sect});\n \tprint \"\\n\";\n     }\n }\n@@ -230,3 +228,86 @@ sub usage\n {\n     die \"usage: $0 [-D toggle...] [infile [outfile]]\\n\";\n }\n+\n+sub postprocess\n+{\n+    local $_ = $_[0];\n+\n+    # @value{foo} is replaced by whatever 'foo' is defined as.\n+    s/\\@value\\{([a-zA-Z0-9_-]+)\\}/$defs{$1}/g;\n+\n+    # Formatting commands.\n+    s/\\@(?:dfn|var|emph|cite|i)\\{([^\\}]*)\\}/I<$1>/g;\n+    s/\\@(?:code|kbd)\\{([^\\}]*)\\}/C<$1>/g;\n+    s/\\@(?:samp|strong|key|b)\\{([^\\}]*)\\}/B<$1>/g;\n+    s/\\@sc\\{([^\\}]*)\\}/\\U$1/g;\n+    s/\\@file\\{([^\\}]*)\\}/F<$1>/g;\n+    s/\\@w\\{([^\\}]*)\\}/S<$1>/g;\n+    s/\\@(?:dmn|math)\\{([^\\}]*)\\}/$1/g;\n+\n+    # Cross references are thrown away, as are @noindent and @refill.\n+    # (@noindent is impossible in .pod, and @refill is unnecessary.)\n+    # @* is also impossible in .pod; we discard it and any newline that\n+    # follows it.\n+\n+    s/\\@xref\\{(?:[^\\}]*)\\}[^.]*.//g;\n+    s/\\s+\\(\\@pxref\\{(?:[^\\}]*)\\}\\)//g;\n+    s/;\\s+\\@pxref\\{(?:[^\\}]*)\\}//g;\n+    s/\\@noindent\\s*//g;\n+    s/\\@refill//g;\n+    s/\\@\\*\\s*\\n?//g;\n+\n+    # @uref can take one, two, or three arguments, with different\n+    # semantics each time.  @url and @email are just like @uref with\n+    # one argument, for our purposes.\n+    s/\\@(?:uref|url|email)\\{([^\\},]*)\\}/&lt;C<$1>&gt;/g;\n+    s/\\@uref\\{([^\\},]*),([^\\},]*)\\}/$2 (C<$1>)/g;\n+    s/\\@uref\\{([^\\},]*),([^\\},]*),([^\\},]*)\\}/$3/g;\n+\n+    # Turn B<blah I<blah> blah> into B<blah> I<blah> B<blah> to\n+    # match Texinfo semantics of @emph inside @samp.\n+    s/&LT;/</g;\n+    s/&GT;/>/g;\n+    1 while (s/B<([^<>]*)I<([^>]+)>/B<$1>I<$2>B</g);\n+    1 while (s/I<([^<>]*)B<([^>]+)>/I<$1>B<$2>I</g);\n+    s/[BI]<>//g;\n+    s/([BI])<(\\s+)([^>]+)>/$2$1<$3>/g;\n+    s/([BI])<([^>]+?)(\\s+)>/$1<$2>$3/g;\n+\n+    # Extract footnotes.  This has to be done after all other\n+    # processing because otherwise the regexp will choke on formatting\n+    # inside @footnote.\n+    while (/\\@footnote/g) {\n+\ts/\\@footnote\\{([^\\}]+)\\}/[$fnno]/;\n+\tadd_footnote($1, $fnno);\n+\t$fnno++;\n+    }\n+\n+    return $_;\n+}\n+\n+sub unmunge\n+{\n+    # Replace escaped symbols with their equivalents.\n+    local $_ = $_[0];\n+\n+    s/&lt;/E<lt>/g;\n+    s/&gt;/E<gt>/g;\n+    s/&lbrace;/\\{/g;\n+    s/&rbrace;/\\}/g;\n+    s/&at;/\\@/g;\n+    s/&amp;/&/g;\n+    return $_;\n+}\n+\n+sub add_footnote\n+{\n+    unless (exists $sects{FOOTNOTES}) {\n+\t$sects{FOOTNOTES} = \"\\n=over 4\\n\\n\";\n+    }\n+\n+    $sects{FOOTNOTES} .= \"=item $fnno.\\n\\n\"; $fnno++;\n+    $sects{FOOTNOTES} .= $_[0];\n+    $sects{FOOTNOTES} .= \"\\n\\n\";\n+}\n+    "}]}