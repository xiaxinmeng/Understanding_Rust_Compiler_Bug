{"sha": "67b1d0046b856e95b9c2086be14d1af0d91d8f90", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjdiMWQwMDQ2Yjg1NmU5NWI5YzIwODZiZTE0ZDFhZjBkOTFkOGY5MA==", "commit": {"author": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2013-07-25T08:26:36Z"}, "committer": {"name": "Janus Weil", "email": "janus@gcc.gnu.org", "date": "2013-07-25T08:26:36Z"}, "message": "re PR fortran/57639 ([OOP] ICE with polymorphism (and illegal code))\n\n2013-07-25  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/57639\n\t* interface.c (compare_parameter): Check for class_ok.\n\t* simplify.c (gfc_simplify_same_type_as): Ditto.\n\n2013-07-25  Janus Weil  <janus@gcc.gnu.org>\n\n\tPR fortran/57639\n\t* gfortran.dg/unlimited_polymorphic_9.f90: New.\n\nFrom-SVN: r201239", "tree": {"sha": "5af2ae989df28500809d588e175112778cd329e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5af2ae989df28500809d588e175112778cd329e2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/67b1d0046b856e95b9c2086be14d1af0d91d8f90", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67b1d0046b856e95b9c2086be14d1af0d91d8f90", "html_url": "https://github.com/Rust-GCC/gccrs/commit/67b1d0046b856e95b9c2086be14d1af0d91d8f90", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/67b1d0046b856e95b9c2086be14d1af0d91d8f90/comments", "author": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "janusw", "id": 484108, "node_id": "MDQ6VXNlcjQ4NDEwOA==", "avatar_url": "https://avatars.githubusercontent.com/u/484108?v=4", "gravatar_id": "", "url": "https://api.github.com/users/janusw", "html_url": "https://github.com/janusw", "followers_url": "https://api.github.com/users/janusw/followers", "following_url": "https://api.github.com/users/janusw/following{/other_user}", "gists_url": "https://api.github.com/users/janusw/gists{/gist_id}", "starred_url": "https://api.github.com/users/janusw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/janusw/subscriptions", "organizations_url": "https://api.github.com/users/janusw/orgs", "repos_url": "https://api.github.com/users/janusw/repos", "events_url": "https://api.github.com/users/janusw/events{/privacy}", "received_events_url": "https://api.github.com/users/janusw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "690688b3a055de125642e79d3bff8b0291d1f8cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/690688b3a055de125642e79d3bff8b0291d1f8cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/690688b3a055de125642e79d3bff8b0291d1f8cb"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "d4cc08358e19129a8817d21c1c8a4514dde605d3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=67b1d0046b856e95b9c2086be14d1af0d91d8f90", "patch": "@@ -1,3 +1,9 @@\n+2013-07-25  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/57639\n+\t* interface.c (compare_parameter): Check for class_ok.\n+\t* simplify.c (gfc_simplify_same_type_as): Ditto.\n+\n 2013-07-23   Ond\u0159ej B\u00edlka  <neleai@seznam.cz>\n \n \t* decl.c: Fix comment typos."}, {"sha": "3c794b23c0a06264e7dca50458dd2ac813d4683f", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=67b1d0046b856e95b9c2086be14d1af0d91d8f90", "patch": "@@ -1966,7 +1966,8 @@ compare_parameter (gfc_symbol *formal, gfc_expr *actual,\n     }\n \n   /* F2008, 12.5.2.5; IR F08/0073.  */\n-  if (formal->ts.type == BT_CLASS && actual->expr_type != EXPR_NULL\n+  if (formal->ts.type == BT_CLASS && formal->attr.class_ok\n+      && actual->expr_type != EXPR_NULL\n       && ((CLASS_DATA (formal)->attr.class_pointer\n \t   && !formal->attr.intent == INTENT_IN)\n           || CLASS_DATA (formal)->attr.allocatable))\n@@ -1978,6 +1979,10 @@ compare_parameter (gfc_symbol *formal, gfc_expr *actual,\n \t\t\tformal->name, &actual->where);\n \t  return 0;\n \t}\n+\n+      if (!gfc_expr_attr (actual).class_ok)\n+\treturn 0;\n+\n       if (!gfc_compare_derived_types (CLASS_DATA (actual)->ts.u.derived,\n \t\t\t\t      CLASS_DATA (formal)->ts.u.derived))\n \t{"}, {"sha": "dca9b7e7a9bc238346158831dfb3d4350f4c8c59", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=67b1d0046b856e95b9c2086be14d1af0d91d8f90", "patch": "@@ -2300,7 +2300,8 @@ gfc_simplify_same_type_as (gfc_expr *a, gfc_expr *b)\n \n   /* Return .false. if the dynamic type can never be the\n      same.  */\n-  if ((a->ts.type == BT_CLASS || b->ts.type == BT_CLASS)\n+  if (((a->ts.type == BT_CLASS && gfc_expr_attr (a).class_ok)\n+       || (b->ts.type == BT_CLASS && gfc_expr_attr (b).class_ok))\n       && !gfc_type_compatible (&a->ts, &b->ts)\n       && !gfc_type_compatible (&b->ts, &a->ts))\n     return gfc_get_logical_expr (gfc_default_logical_kind, &a->where, false);"}, {"sha": "16e6c74a976bf3cdb373e7375b2c68ac3525cb6d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=67b1d0046b856e95b9c2086be14d1af0d91d8f90", "patch": "@@ -1,3 +1,8 @@\n+2013-07-25  Janus Weil  <janus@gcc.gnu.org>\n+\n+\tPR fortran/57639\n+\t* gfortran.dg/unlimited_polymorphic_9.f90: New.\n+\n 2013-07-25  Terry Guo  <terry.guo@arm.com>\n \n \t* gcc.target/arm/thumb1-Os-mult.c: New test case."}, {"sha": "5b7fe92e9ee02326ce064b67c62214d4d0342374", "filename": "gcc/testsuite/gfortran.dg/unlimited_polymorphic_9.f90", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ftestsuite%2Fgfortran.dg%2Funlimited_polymorphic_9.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/67b1d0046b856e95b9c2086be14d1af0d91d8f90/gcc%2Ftestsuite%2Fgfortran.dg%2Funlimited_polymorphic_9.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Funlimited_polymorphic_9.f90?ref=67b1d0046b856e95b9c2086be14d1af0d91d8f90", "patch": "@@ -0,0 +1,20 @@\n+! { dg-do compile }\n+!\n+! PR 57639: [OOP] ICE with polymorphism (and illegal code)\n+!\n+! Contributed by Walter Spector <w6ws@earthlink.net>\n+\n+  implicit none\n+\n+  class(*) :: t1, t2      ! { dg-error \"must be dummy, allocatable or pointer\" }\n+\n+  print *, 'main: compare = ', compare (t1, t2)\n+  print *, SAME_TYPE_AS (t1, t2)\n+\n+contains\n+\n+ logical function compare (a, b)\n+    class(*), intent(in), allocatable :: a, b\n+  end function  \n+  \n+end"}]}