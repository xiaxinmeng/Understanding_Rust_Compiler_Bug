{"sha": "d1090a8a805de4e3b33248753e792ab302d3f6db", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDEwOTBhOGE4MDVkZTRlM2IzMzI0ODc1M2U3OTJhYjMwMmQzZjZkYg==", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@gcc.gnu.org", "date": "2019-10-02T22:00:42Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@gcc.gnu.org", "date": "2019-10-02T22:00:42Z"}, "message": "PR tree-optimization/80936 - bcmp, bcopy, and bzero not declared nonnull\n\ngcc/testsuite/ChangeLog:\n\n\tPR tree-optimization/80936\n\t* gcc.dg/Wnonnull-2.c: New test.\n\t* gcc.dg/Wnonnull-3.c: New test.\n\t* gcc.dg/nonnull-3.c: Expect more warnings.\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/80936\n\t* builtins.def (bcmp, bcopy, bzero): Declare nonnull.\n\nFrom-SVN: r276491", "tree": {"sha": "91ca31bbffaccfb18a83ff5eccbe1563d584818f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/91ca31bbffaccfb18a83ff5eccbe1563d584818f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d1090a8a805de4e3b33248753e792ab302d3f6db", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1090a8a805de4e3b33248753e792ab302d3f6db", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1090a8a805de4e3b33248753e792ab302d3f6db", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1090a8a805de4e3b33248753e792ab302d3f6db/comments", "author": null, "committer": null, "parents": [{"sha": "aa29ed6db6d409b54e552830230205a7b4da0d4d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa29ed6db6d409b54e552830230205a7b4da0d4d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa29ed6db6d409b54e552830230205a7b4da0d4d"}], "stats": {"total": 144, "additions": 134, "deletions": 10}, "files": [{"sha": "5b9b706665a3e252301a7fb3d51e18b80746010f", "filename": "gcc/builtins.def", "status": "modified", "additions": 3, "deletions": 5, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Fbuiltins.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Fbuiltins.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.def?ref=d1090a8a805de4e3b33248753e792ab302d3f6db", "patch": "@@ -687,11 +687,9 @@ DEF_C99_COMPL_BUILTIN        (BUILT_IN_CTANHL, \"ctanhl\", BT_FN_COMPLEX_LONGDOUBL\n DEF_C99_COMPL_BUILTIN        (BUILT_IN_CTANL, \"ctanl\", BT_FN_COMPLEX_LONGDOUBLE_COMPLEX_LONGDOUBLE, ATTR_MATHFN_FPROUNDING)\n \n /* Category: string/memory builtins.  */\n-/* bcmp, bcopy and bzero have traditionally accepted NULL pointers\n-   when the length parameter is zero, so don't apply attribute \"nonnull\".  */\n-DEF_EXT_LIB_BUILTIN    (BUILT_IN_BCMP, \"bcmp\", BT_FN_INT_CONST_PTR_CONST_PTR_SIZE, ATTR_PURE_NOTHROW_LEAF_LIST)\n-DEF_EXT_LIB_BUILTIN    (BUILT_IN_BCOPY, \"bcopy\", BT_FN_VOID_CONST_PTR_PTR_SIZE, ATTR_NOTHROW_LEAF_LIST)\n-DEF_EXT_LIB_BUILTIN    (BUILT_IN_BZERO, \"bzero\", BT_FN_VOID_PTR_SIZE, ATTR_NOTHROW_LEAF_LIST)\n+DEF_EXT_LIB_BUILTIN    (BUILT_IN_BCMP, \"bcmp\", BT_FN_INT_CONST_PTR_CONST_PTR_SIZE, ATTR_PURE_NOTHROW_NONNULL_LEAF)\n+DEF_EXT_LIB_BUILTIN    (BUILT_IN_BCOPY, \"bcopy\", BT_FN_VOID_CONST_PTR_PTR_SIZE, ATTR_NOTHROW_NONNULL_LEAF)\n+DEF_EXT_LIB_BUILTIN    (BUILT_IN_BZERO, \"bzero\", BT_FN_VOID_PTR_SIZE, ATTR_NOTHROW_NONNULL_LEAF)\n DEF_EXT_LIB_BUILTIN    (BUILT_IN_INDEX, \"index\", BT_FN_STRING_CONST_STRING_INT, ATTR_PURE_NOTHROW_NONNULL_LEAF)\n DEF_LIB_BUILTIN        (BUILT_IN_MEMCHR, \"memchr\", BT_FN_PTR_CONST_PTR_INT_SIZE, ATTR_PURE_NOTHROW_NONNULL_LEAF)\n DEF_LIB_BUILTIN        (BUILT_IN_MEMCMP, \"memcmp\", BT_FN_INT_CONST_PTR_CONST_PTR_SIZE, ATTR_PURE_NOTHROW_NONNULL_LEAF)"}, {"sha": "d870473d5a92acd36bcdd71d5a11e6ef691abf9a", "filename": "gcc/testsuite/gcc.dg/Wnonnull-2.c", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Ftestsuite%2Fgcc.dg%2FWnonnull-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Ftestsuite%2Fgcc.dg%2FWnonnull-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWnonnull-2.c?ref=d1090a8a805de4e3b33248753e792ab302d3f6db", "patch": "@@ -0,0 +1,55 @@\n+/* PR middle-end/80936 - bcmp, bcopy, and bzero not declared nonnull\n+   Verify that -Wnonnull is issued for calls with constant null pointers\n+   with no optimization.\n+   { dg-do compile }\n+   { dg-options \"-O0 -Wall\" } */\n+\n+void zero0 (void *p, unsigned n)\n+{\n+  __builtin_memset (0, 0, n);           // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+void zero1 (void *p, unsigned n)\n+{\n+  __builtin_bzero (0, n);               // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+void copy0 (void *p, const void *q, unsigned n)\n+{\n+  __builtin_memcpy (0, q, n);           // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+void copy1 (void *p, const void *q, unsigned n)\n+{\n+  __builtin_memcpy (0, q, n);           // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+void copy2 (void *p, const void *q, unsigned n)\n+{\n+  __builtin_bcopy (q, 0, n);            // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+void copy3 (void *p, const void *q, unsigned n)\n+{\n+  __builtin_bcopy (q, 0, n);            // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+int cmp0 (const void *p, const void *q, unsigned n)\n+{\n+  return __builtin_memcmp (0, q, n);    // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+int cmp1 (const void *p, const void *q, unsigned n)\n+{\n+  return __builtin_memcmp (0, q, n);    // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+int cmp2 (const void *p, const void *q, unsigned n)\n+{\n+  return __builtin_bcmp (0, q, n);      // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+int cmp3 (const void *p, const void *q, unsigned n)\n+{\n+  return __builtin_bcmp (p, 0, n);      // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}"}, {"sha": "ad016df93319906f677eddc5490f3ad503452cc8", "filename": "gcc/testsuite/gcc.dg/Wnonnull-3.c", "status": "added", "additions": 71, "deletions": 0, "changes": 71, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Ftestsuite%2Fgcc.dg%2FWnonnull-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Ftestsuite%2Fgcc.dg%2FWnonnull-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWnonnull-3.c?ref=d1090a8a805de4e3b33248753e792ab302d3f6db", "patch": "@@ -0,0 +1,71 @@\n+/* PR middle-end/80936 - bcmp, bcopy, and bzero not declared nonnull\n+   Verify that with optimization, -Wnonnull is issued for calls with\n+   non-constant arguments determined to be null.\n+   { dg-do compile }\n+   { dg-options \"-O2 -Wall\" } */\n+\n+#define NOIPA __attribute__ ((noipa))\n+\n+NOIPA void zero0 (void *p, unsigned n)\n+{\n+  if (p == 0)\n+    __builtin_memset (p, 0, n);         // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+NOIPA void zero1 (void *p, unsigned n)\n+{\n+  if (p == 0)\n+    __builtin_bzero (p, n);             // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+NOIPA void copy0 (void *p, const void *q, unsigned n)\n+{\n+  if (p == 0)\n+    __builtin_memcpy (p, q, n);         // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+NOIPA void copy1 (void *p, const void *q, unsigned n)\n+{\n+  if (q == 0)\n+    __builtin_memcpy (p, q, n);         // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+NOIPA void copy2 (void *p, const void *q, unsigned n)\n+{\n+  if (p == 0)\n+    __builtin_bcopy (q, p, n);          // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+NOIPA void copy3 (void *p, const void *q, unsigned n)\n+{\n+  if (q == 0)\n+    __builtin_bcopy (q, p, n);          // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+}\n+\n+NOIPA int cmp0 (const void *p, const void *q, unsigned n)\n+{\n+  if (p == 0)\n+    return __builtin_memcmp (p, q, n);  // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+  return 0;\n+}\n+\n+NOIPA int cmp1 (const void *p, const void *q, unsigned n)\n+{\n+  if (q == 0)\n+    return __builtin_memcmp (p, q, n);  // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+  return 0;\n+}\n+\n+NOIPA int cmp2 (const void *p, const void *q, unsigned n)\n+{\n+  if (p == 0)\n+    return __builtin_bcmp (p, q, n);    // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+  return 0;\n+}\n+\n+NOIPA int cmp3 (const void *p, const void *q, unsigned n)\n+{\n+  if (q == 0)\n+    return __builtin_bcmp (p, q, n);    // { dg-warning \"\\\\\\[-Wnonnull]\" }\n+  return 0;\n+}"}, {"sha": "c52fe2c830c800a4e2126be2fb4f9859ae21692d", "filename": "gcc/testsuite/gcc.dg/nonnull-3.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Ftestsuite%2Fgcc.dg%2Fnonnull-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d1090a8a805de4e3b33248753e792ab302d3f6db/gcc%2Ftestsuite%2Fgcc.dg%2Fnonnull-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fnonnull-3.c?ref=d1090a8a805de4e3b33248753e792ab302d3f6db", "patch": "@@ -9,11 +9,11 @@\n void\n foo (void *p, char *s)\n {\n-  __builtin_bzero (NULL, 0);\n-  __builtin_bcopy (NULL, p, 0);\n-  __builtin_bcopy (p, NULL, 0);\n-  __builtin_bcmp (NULL, p, 0);\n-  __builtin_bcmp (p, NULL, 0);\n+  __builtin_bzero (NULL, 0);  /* { dg-warning \"null\" \"pr80936\" } */\n+  __builtin_bcopy (NULL, p, 0);  /* { dg-warning \"null\" \"pr80936\" } */\n+  __builtin_bcopy (p, NULL, 0);  /* { dg-warning \"null\" \"pr80936\" } */\n+  __builtin_bcmp (NULL, p, 0);  /* { dg-warning \"null\" \"pr80936\" } */\n+  __builtin_bcmp (p, NULL, 0);  /* { dg-warning \"null\" \"pr80936\" } */\n   __builtin_index (NULL, 16);  /* { dg-warning \"null\" \"null pointer check\" } */\n   __builtin_rindex (NULL, 16);  /* { dg-warning \"null\" \"null pointer check\" } */\n "}]}