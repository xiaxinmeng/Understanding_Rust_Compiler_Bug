{"sha": "c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzRkYzlmNTkwMTgxMzIxYzM2ZDNmM2VmNzJjNTBiM2M0N2JiZmU3Yw==", "commit": {"author": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2021-07-08T23:38:14Z"}, "committer": {"name": "Sandra Loosemore", "email": "sandra@codesourcery.com", "date": "2021-07-28T04:20:21Z"}, "message": "Bind(C): Correct sizes of some types in CFI_establish\n\nCFI_establish was failing to set the default elem_len correctly for\nCFI_type_cptr, CFI_type_cfunptr, CFI_type_long_double, and\nCFI_type_long_double_Complex.\n\n2021-07-13  Sandra Loosemore  <sandra@codesourcery.com>\n\nlibgfortran/\n\tPR libfortran/101305\n\t* runtime/ISO_Fortran_binding.c (CFI_establish): Special-case\n\tCFI_type_cptr and CFI_type_cfunptr.  Correct size of long double\n\ton targets where it has kind 10.", "tree": {"sha": "3115a80b04c45c38075d3e297b0831283c3b57a9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3115a80b04c45c38075d3e297b0831283c3b57a9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c/comments", "author": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "committer": {"login": "SandraLoosemore", "id": 104087111, "node_id": "U_kgDOBjQ-Rw", "avatar_url": "https://avatars.githubusercontent.com/u/104087111?v=4", "gravatar_id": "", "url": "https://api.github.com/users/SandraLoosemore", "html_url": "https://github.com/SandraLoosemore", "followers_url": "https://api.github.com/users/SandraLoosemore/followers", "following_url": "https://api.github.com/users/SandraLoosemore/following{/other_user}", "gists_url": "https://api.github.com/users/SandraLoosemore/gists{/gist_id}", "starred_url": "https://api.github.com/users/SandraLoosemore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/SandraLoosemore/subscriptions", "organizations_url": "https://api.github.com/users/SandraLoosemore/orgs", "repos_url": "https://api.github.com/users/SandraLoosemore/repos", "events_url": "https://api.github.com/users/SandraLoosemore/events{/privacy}", "received_events_url": "https://api.github.com/users/SandraLoosemore/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "fef67987cf502fe322e92ddce22eea7ac46b4d75", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fef67987cf502fe322e92ddce22eea7ac46b4d75", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fef67987cf502fe322e92ddce22eea7ac46b4d75"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "b1e51612e2b2cdb26491fe2b71f69402fc7634fb", "filename": "libgfortran/runtime/ISO_Fortran_binding.c", "status": "modified", "additions": 10, "deletions": 9, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c/libgfortran%2Fruntime%2FISO_Fortran_binding.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c/libgfortran%2Fruntime%2FISO_Fortran_binding.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2FISO_Fortran_binding.c?ref=c4dc9f590181321c36d3f3ef72c50b3c47bbfe7c", "patch": "@@ -380,26 +380,27 @@ int CFI_establish (CFI_cdesc_t *dv, void *base_addr, CFI_attribute_t attribute,\n \n   dv->base_addr = base_addr;\n \n-  if (type == CFI_type_char || type == CFI_type_ucs4_char ||\n-      type == CFI_type_struct || type == CFI_type_other)\n+  if (type == CFI_type_char || type == CFI_type_ucs4_char\n+      || type == CFI_type_struct || type == CFI_type_other)\n     dv->elem_len = elem_len;\n+  else if (type == CFI_type_cptr)\n+    dv->elem_len = sizeof (void *);\n+  else if (type == CFI_type_cfunptr)\n+    dv->elem_len = sizeof (void (*)(void));\n   else\n     {\n       /* base_type describes the intrinsic type with kind parameter. */\n       size_t base_type = type & CFI_type_mask;\n       /* base_type_size is the size in bytes of the variable as given by its\n        * kind parameter. */\n       size_t base_type_size = (type - base_type) >> CFI_type_kind_shift;\n-      /* Kind types 10 have a size of 64 bytes. */\n+      /* Kind type 10 maps onto the 80-bit long double encoding on x86.\n+\t Note that this has different storage size for -m32 than -m64.  */\n       if (base_type_size == 10)\n-\t{\n-\t  base_type_size = 64;\n-\t}\n+\tbase_type_size = sizeof (long double);\n       /* Complex numbers are twice the size of their real counterparts. */\n       if (base_type == CFI_type_Complex)\n-\t{\n-\t  base_type_size *= 2;\n-\t}\n+\tbase_type_size *= 2;\n       dv->elem_len = base_type_size;\n     }\n "}]}