{"sha": "35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzVhNDFiNzNjN2RhY2U0OWI3YWJkOGI4YTZmZGM2ZDU4YTVlNjEyYQ==", "commit": {"author": {"name": "Quentin Ochem", "email": "ochem@adacore.com", "date": "2007-04-06T09:17:01Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-04-06T09:17:01Z"}, "message": "ali.ads, ali.adb (Get_Nat): Raise an exception if the file cursor is not on a natural.\n\n2007-04-06  Quentin Ochem  <ochem@adacore.com>\n\n\t* ali.ads, ali.adb (Get_Nat): Raise an exception if the file cursor is\n\tnot on a natural.\n\t(Scan_ALI): Cancel the xref line if there has been a reading ALI error.\n\nFrom-SVN: r123548", "tree": {"sha": "4bcff816ebdb41bea765ca1719759ac07fd664c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4bcff816ebdb41bea765ca1719759ac07fd664c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a/comments", "author": {"login": "QuentinOchem", "id": 5612750, "node_id": "MDQ6VXNlcjU2MTI3NTA=", "avatar_url": "https://avatars.githubusercontent.com/u/5612750?v=4", "gravatar_id": "", "url": "https://api.github.com/users/QuentinOchem", "html_url": "https://github.com/QuentinOchem", "followers_url": "https://api.github.com/users/QuentinOchem/followers", "following_url": "https://api.github.com/users/QuentinOchem/following{/other_user}", "gists_url": "https://api.github.com/users/QuentinOchem/gists{/gist_id}", "starred_url": "https://api.github.com/users/QuentinOchem/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/QuentinOchem/subscriptions", "organizations_url": "https://api.github.com/users/QuentinOchem/orgs", "repos_url": "https://api.github.com/users/QuentinOchem/repos", "events_url": "https://api.github.com/users/QuentinOchem/events{/privacy}", "received_events_url": "https://api.github.com/users/QuentinOchem/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "320ae22ae0b8d417adf8da52e195eb9aaa026688", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/320ae22ae0b8d417adf8da52e195eb9aaa026688", "html_url": "https://github.com/Rust-GCC/gccrs/commit/320ae22ae0b8d417adf8da52e195eb9aaa026688"}], "stats": {"total": 31, "additions": 28, "deletions": 3}, "files": [{"sha": "b987636ac7bbdb3bd75de108985b87bdf22d0c4c", "filename": "gcc/ada/ali.adb", "status": "modified", "additions": 27, "deletions": 2, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a/gcc%2Fada%2Fali.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a/gcc%2Fada%2Fali.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fali.adb?ref=35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a", "patch": "@@ -195,6 +195,7 @@ package body ALI is\n \n       function Get_Nat return Nat;\n       --  Skip blanks, then scan out an unsigned integer value in Nat range\n+      --  raises ALI_Reading_Error if the encoutered type is not natural.\n \n       function Get_Stamp return Time_Stamp_Type;\n       --  Skip blanks, then scan out a time stamp\n@@ -347,7 +348,6 @@ package body ALI is\n          --  Find start of line\n \n          Ptr1 := P;\n-\n          while Ptr1 > T'First\n            and then T (Ptr1 - 1) /= CR\n            and then T (Ptr1 - 1) /= LF\n@@ -478,9 +478,17 @@ package body ALI is\n       begin\n          Skip_Space;\n \n+         --  Check if we are on a number. In the case of bas ALI files, this\n+         --  may not be true.\n+\n+         if not (Nextc in '0' .. '9') then\n+            Fatal_Error;\n+         end if;\n+\n          V := 0;\n          loop\n             V := V * 10 + (Character'Pos (Getc) - Character'Pos ('0'));\n+\n             exit when At_End_Of_Field;\n             exit when Nextc < '0' or Nextc > '9';\n          end loop;\n@@ -2186,6 +2194,24 @@ package body ALI is\n \n                   XE.Last_Xref := Xref.Last;\n                   C := Nextc;\n+\n+               exception\n+                  when Bad_ALI_Format =>\n+\n+                     --  If ignoring errors, then we skip a line with an\n+                     --  unexpected error, and try to continue subsequent\n+                     --  xref lines.\n+\n+                     if Ignore_Errors then\n+                        Xref_Entity.Decrement_Last;\n+                        Skip_Line;\n+                        C := Nextc;\n+\n+                     --  Otherwise, we reraise the fatal exception\n+\n+                     else\n+                        raise;\n+                     end if;\n                end Read_Refs_For_One_Entity;\n             end loop;\n \n@@ -2209,7 +2235,6 @@ package body ALI is\n    exception\n       when Bad_ALI_Format =>\n          return No_ALI_Id;\n-\n    end Scan_ALI;\n \n    ---------"}, {"sha": "5a4dcaae38a90e575931f680f3d20dded752d46e", "filename": "gcc/ada/ali.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a/gcc%2Fada%2Fali.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a/gcc%2Fada%2Fali.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fali.ads?ref=35a41b73c7dace49b7abd8b8a6fdc6d58a5e612a", "patch": "@@ -839,7 +839,7 @@ package ALI is\n       --  reference for the entity name.\n \n       Oref_File_Num : Sdep_Id;\n-      --  This field is set to No_Sdep_Id is the entity doesn't override any\n+      --  This field is set to No_Sdep_Id if the entity doesn't override any\n       --  other entity, or to the dependency reference for the overriden\n       --  entity.\n "}]}