{"sha": "0a2fba3697411c07a8330abfe7460ce62bce5e7f", "node_id": "C_kwDOANBUbNoAKDBhMmZiYTM2OTc0MTFjMDdhODMzMGFiZmU3NDYwY2U2MmJjZTVlN2Y", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-09-06T18:18:39Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-09-06T20:20:41Z"}, "message": "c++: C++23 operator[] allows default arguments\n\nThis usage was intended to be allowed by P2128, but it didn't make it into\nthe final wording.  Fixed by CWG 2507.\n\n\tDR2507\n\ngcc/cp/ChangeLog:\n\n\t* decl.cc (grok_op_properties): Return sooner for C++23 op[].\n\ngcc/testsuite/ChangeLog:\n\n\t* g++.dg/cpp23/subscript8.C: New test.", "tree": {"sha": "12fda6644d4eba70bc673e621d8c5d37764aeaf4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/12fda6644d4eba70bc673e621d8c5d37764aeaf4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0a2fba3697411c07a8330abfe7460ce62bce5e7f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a2fba3697411c07a8330abfe7460ce62bce5e7f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a2fba3697411c07a8330abfe7460ce62bce5e7f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a2fba3697411c07a8330abfe7460ce62bce5e7f/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0a4a2667dc115ca73b552fcabf8570620dfbe55f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a4a2667dc115ca73b552fcabf8570620dfbe55f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a4a2667dc115ca73b552fcabf8570620dfbe55f"}], "stats": {"total": 18, "additions": 12, "deletions": 6}, "files": [{"sha": "6d20765f40c80ce527171cb9ab5c71b71616aa7a", "filename": "gcc/cp/decl.cc", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a2fba3697411c07a8330abfe7460ce62bce5e7f/gcc%2Fcp%2Fdecl.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a2fba3697411c07a8330abfe7460ce62bce5e7f/gcc%2Fcp%2Fdecl.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.cc?ref=0a2fba3697411c07a8330abfe7460ce62bce5e7f", "patch": "@@ -15331,6 +15331,11 @@ grok_op_properties (tree decl, bool complain)\n        \"operator ()\".  */\n     return true;\n \n+  /* C++23 allows an arbitrary number of parameters and default arguments for\n+     operator[], and none of the other checks below apply.  */\n+  if (operator_code == ARRAY_REF && cxx_dialect >= cxx23)\n+    return true;\n+\n   if (operator_code == COND_EXPR)\n     {\n       /* 13.4.0.3 */\n@@ -15344,10 +15349,6 @@ grok_op_properties (tree decl, bool complain)\n     {\n       if (!arg)\n \t{\n-\t  /* Variadic.  */\n-\t  if (operator_code == ARRAY_REF && cxx_dialect >= cxx23)\n-\t    break;\n-\n \t  error_at (loc, \"%qD must not have variable number of arguments\",\n \t\t    decl);\n \t  return false;\n@@ -15408,8 +15409,6 @@ grok_op_properties (tree decl, bool complain)\n     case OVL_OP_FLAG_BINARY:\n       if (arity != 2)\n \t{\n-\t  if (operator_code == ARRAY_REF && cxx_dialect >= cxx23)\n-\t    break;\n \t  error_at (loc,\n \t\t    methodp\n \t\t    ? G_(\"%qD must have exactly one argument\")"}, {"sha": "fe000359d4143f50c674c6f82066f5ba3e87218f", "filename": "gcc/testsuite/g++.dg/cpp23/subscript8.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a2fba3697411c07a8330abfe7460ce62bce5e7f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp23%2Fsubscript8.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a2fba3697411c07a8330abfe7460ce62bce5e7f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp23%2Fsubscript8.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp23%2Fsubscript8.C?ref=0a2fba3697411c07a8330abfe7460ce62bce5e7f", "patch": "@@ -0,0 +1,7 @@\n+// DR2507: Allow default arguments\n+// { dg-additional-options {-std=c++23} }\n+\n+struct A\n+{\n+  void operator[](int, int = 42);\n+};"}]}