{"sha": "e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTVlN2U1MGQ0Zjc1NzQ5ZTNhZDNhZjQ0ZDM2NGNjZmNiODFjZWQ5ZQ==", "commit": {"author": {"name": "Bogdan Harjoc", "email": "harjoc@gmail.com", "date": "2018-08-03T15:25:35Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2018-08-03T15:25:35Z"}, "message": "Avoid infinite loop with duplicate anonymous union fields (PR c/86690).\n\nIf a struct contains an anonymous union and both have a field with the\nsame name, detect_field_duplicates_hash() will replace one of them\nwith NULL.  If compilation doesn't stop immediately, it may later call\nlookup_field() on the union, which falsely assumes the union's\nLANG_SPECIFIC array is sorted, and may loop indefinitely because of\nthis.\n\n2018-08-03  Bogdan Harjoc  <harjoc@gmail.com>\n\n\tPR c/86690\ngcc/c:\n\t* c-typeck.c (lookup_field): Do not use TYPE_LANG_SPECIFIC after\n\terrors.\n\ngcc/testsuite:\n\t* gcc.dg/union-duplicate-field.c: New test.\n\nFrom-SVN: r263294", "tree": {"sha": "976a94aedd0a8d55a01a8027541c47a938e0e252", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/976a94aedd0a8d55a01a8027541c47a938e0e252"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/comments", "author": {"login": "harjoc", "id": 1830239, "node_id": "MDQ6VXNlcjE4MzAyMzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1830239?v=4", "gravatar_id": "", "url": "https://api.github.com/users/harjoc", "html_url": "https://github.com/harjoc", "followers_url": "https://api.github.com/users/harjoc/followers", "following_url": "https://api.github.com/users/harjoc/following{/other_user}", "gists_url": "https://api.github.com/users/harjoc/gists{/gist_id}", "starred_url": "https://api.github.com/users/harjoc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/harjoc/subscriptions", "organizations_url": "https://api.github.com/users/harjoc/orgs", "repos_url": "https://api.github.com/users/harjoc/repos", "events_url": "https://api.github.com/users/harjoc/events{/privacy}", "received_events_url": "https://api.github.com/users/harjoc/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d198fc5a69964c1d1cf55dd30d1696e531dc12d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d198fc5a69964c1d1cf55dd30d1696e531dc12d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d198fc5a69964c1d1cf55dd30d1696e531dc12d9"}], "stats": {"total": 41, "additions": 39, "deletions": 2}, "files": [{"sha": "40e56f3aaaa22bdf7046bd83ec84e4f302ddc36c", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "patch": "@@ -1,3 +1,9 @@\n+2018-08-03  Bogdan Harjoc  <harjoc@gmail.com>\n+\n+\tPR c/86690\n+\t* c-typeck.c (lookup_field): Do not use TYPE_LANG_SPECIFIC after\n+\terrors.\n+\n 2018-08-01  Martin Sebor  <msebor@redhat.com>\n \n \tPR tree-optimization/86650"}, {"sha": "2e9338e3458b4ccfc07fb5f9a21795321bf2167d", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "patch": "@@ -2207,9 +2207,14 @@ lookup_field (tree type, tree component)\n   /* If TYPE_LANG_SPECIFIC is set, then it is a sorted array of pointers\n      to the field elements.  Use a binary search on this array to quickly\n      find the element.  Otherwise, do a linear search.  TYPE_LANG_SPECIFIC\n-     will always be set for structures which have many elements.  */\n+     will always be set for structures which have many elements.\n \n-  if (TYPE_LANG_SPECIFIC (type) && TYPE_LANG_SPECIFIC (type)->s)\n+     Duplicate field checking replaces duplicates with NULL_TREE so\n+     TYPE_LANG_SPECIFIC arrays are potentially no longer sorted.  In that\n+     case just iterate using DECL_CHAIN.  */\n+\n+  if (TYPE_LANG_SPECIFIC (type) && TYPE_LANG_SPECIFIC (type)->s\n+      && !seen_error ())\n     {\n       int bot, top, half;\n       tree *field_array = &TYPE_LANG_SPECIFIC (type)->s->elts[0];"}, {"sha": "ba0c4c6ef5dff572cda798d53a2ec36b8a27a88a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "patch": "@@ -1,3 +1,8 @@\n+2018-08-03  Bogdan Harjoc  <harjoc@gmail.com>\n+\n+\tPR c/86690\n+\t* gcc.dg/union-duplicate-field.c: New test.\n+\n 2018-08-03  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/86706"}, {"sha": "da9a945d9f386df33e170ef0d2fed7f152099873", "filename": "gcc/testsuite/gcc.dg/union-duplicate-field.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Ftestsuite%2Fgcc.dg%2Funion-duplicate-field.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e/gcc%2Ftestsuite%2Fgcc.dg%2Funion-duplicate-field.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Funion-duplicate-field.c?ref=e5e7e50d4f75749e3ad3af44d364ccfcb81ced9e", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-std=c99\" } */\n+\n+int a0;\n+\n+struct S\n+{\n+    int a1;\n+    union {\n+        int a0;\n+        int a1; /* { dg-error \"duplicate member\" } */\n+        int a2, a3, a4, a5, a6, a7, a8, a9;\n+        int a10, a11, a12, a13, a14, a15;\n+    };\n+};\n+\n+int f()\n+{\n+    struct S s;\n+    return s.a0;\n+}"}]}