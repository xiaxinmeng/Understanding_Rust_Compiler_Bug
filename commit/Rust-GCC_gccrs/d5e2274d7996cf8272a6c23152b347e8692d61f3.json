{"sha": "d5e2274d7996cf8272a6c23152b347e8692d61f3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDVlMjI3NGQ3OTk2Y2Y4MjcyYTZjMjMxNTJiMzQ3ZTg2OTJkNjFmMw==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2014-12-15T18:37:59Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-12-15T18:37:59Z"}, "message": "re PR fortran/61669 (Error recovery ICE)\n\n\tPR fortran/61669\n\t* gfortran.h (struct gfc_namespace): Add OLD_DATA field.\n\t* decl.c (gfc_reject_data): New function.\n\t* parse.c *use_modules): Record roll-back point.\n\t(next_statement): Likewise.\n\t(reject_statement): Roll back to last accepted DATA.\n\n\t* gfortran.dg/pr61669.f90: New test.\n\nCo-Authored-By: Jakub Jelinek <jakub@redhat.com>\n\nFrom-SVN: r218757", "tree": {"sha": "459a209d2169e7738ed70e98e823893506c1f517", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/459a209d2169e7738ed70e98e823893506c1f517"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d5e2274d7996cf8272a6c23152b347e8692d61f3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5e2274d7996cf8272a6c23152b347e8692d61f3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5e2274d7996cf8272a6c23152b347e8692d61f3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5e2274d7996cf8272a6c23152b347e8692d61f3/comments", "author": null, "committer": null, "parents": [{"sha": "76be46db72595b894a6e6da15e892d4a1f8f91cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76be46db72595b894a6e6da15e892d4a1f8f91cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76be46db72595b894a6e6da15e892d4a1f8f91cf"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "83f2aba83737d813a600b998df953082070e2621", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d5e2274d7996cf8272a6c23152b347e8692d61f3", "patch": "@@ -1,3 +1,12 @@\n+2014-12-15  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\tPR fortran/61669\n+\t* gfortran.h (struct gfc_namespace): Add OLD_DATA field.\n+\t* decl.c (gfc_reject_data): New function.\n+\t* parse.c *use_modules): Record roll-back point.\n+\t(next_statement): Likewise.\n+\t(reject_statement): Roll back to last accepted DATA.\n+\n 2014-12-15  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/63727"}, {"sha": "28a7aca6638a1180dc0d668a2c15da44442693c1", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=d5e2274d7996cf8272a6c23152b347e8692d61f3", "patch": "@@ -178,6 +178,20 @@ gfc_free_data_all (gfc_namespace *ns)\n     }\n }\n \n+/* Reject data parsed since the last restore point was marked.  */\n+\n+void\n+gfc_reject_data (gfc_namespace *ns)\n+{\n+  gfc_data *d;\n+\n+  while (ns->data && ns->data != ns->old_data)\n+    {\n+      d = ns->data->next;\n+      free (ns->data);\n+      ns->data = d;\n+    }\n+}\n \n static match var_element (gfc_data_variable *);\n "}, {"sha": "e0e5838504e4d7328407e2fc1db865b7c6c560df", "filename": "gcc/fortran/gfortran.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2Fgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2Fgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fgfortran.h?ref=d5e2274d7996cf8272a6c23152b347e8692d61f3", "patch": "@@ -1627,7 +1627,7 @@ typedef struct gfc_namespace\n   gfc_st_label *st_labels;\n   /* This list holds information about all the data initializers in\n      this namespace.  */\n-  struct gfc_data *data;\n+  struct gfc_data *data, *old_data;\n \n   gfc_charlen *cl_list, *old_cl_list;\n \n@@ -2929,6 +2929,7 @@ void gfc_free_omp_namelist (gfc_omp_namelist *);\n void gfc_free_equiv (gfc_equiv *);\n void gfc_free_equiv_until (gfc_equiv *, gfc_equiv *);\n void gfc_free_data (gfc_data *);\n+void gfc_reject_data (gfc_namespace *);\n void gfc_free_case_list (gfc_case *);\n \n /* matchexp.c -- FIXME too?  */"}, {"sha": "54c0cdc13fa0503a337982e89770c56212f25d51", "filename": "gcc/fortran/parse.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2Fparse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ffortran%2Fparse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.c?ref=d5e2274d7996cf8272a6c23152b347e8692d61f3", "patch": "@@ -119,6 +119,7 @@ use_modules (void)\n   gfc_warning_check ();\n   gfc_current_ns->old_cl_list = gfc_current_ns->cl_list;\n   gfc_current_ns->old_equiv = gfc_current_ns->equiv;\n+  gfc_current_ns->old_data = gfc_current_ns->data;\n   last_was_use_stmt = false;\n }\n \n@@ -1098,6 +1099,7 @@ next_statement (void)\n \n   gfc_current_ns->old_cl_list = gfc_current_ns->cl_list;\n   gfc_current_ns->old_equiv = gfc_current_ns->equiv;\n+  gfc_current_ns->old_data = gfc_current_ns->data;\n   for (;;)\n     {\n       gfc_statement_label = NULL;\n@@ -2043,6 +2045,8 @@ reject_statement (void)\n   gfc_free_equiv_until (gfc_current_ns->equiv, gfc_current_ns->old_equiv);\n   gfc_current_ns->equiv = gfc_current_ns->old_equiv;\n \n+  gfc_reject_data (gfc_current_ns);\n+\n   gfc_new_block = NULL;\n   gfc_undo_symbols ();\n   gfc_clear_warning ();"}, {"sha": "77bd81bbc3bb7c652b530eab024ab06bfea0c4db", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d5e2274d7996cf8272a6c23152b347e8692d61f3", "patch": "@@ -1,3 +1,9 @@\n+2014-12-15  Steven Bosscher  <steven@gcc.gnu.org>\n+\t    Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/61669\n+\t* gfortran.dg/pr61669.f90: New test.\n+\n 2014-12-15  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/64312"}, {"sha": "5bceafda7621e8661f72b4f06ee77ba5f0830759", "filename": "gcc/testsuite/gfortran.dg/pr61669.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr61669.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5e2274d7996cf8272a6c23152b347e8692d61f3/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr61669.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr61669.f90?ref=d5e2274d7996cf8272a6c23152b347e8692d61f3", "patch": "@@ -0,0 +1,7 @@\n+! { dg-do compile }\n+      write (*,\"(a)\") char(12)\n+      CHARACTER*80 A /\"A\"/      ! { dg-error \"Unexpected data declaration statement\" }\n+      REAL*4 B                  ! { dg-error \"Unexpected data declaration statement\" }\n+      write (*,\"(a)\") char(12)\n+      DATA B / 0.02 /           ! { dg-warning \"Obsolescent feature: DATA statement\" }\n+      END"}]}