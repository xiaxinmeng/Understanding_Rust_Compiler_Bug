{"sha": "db613e8fa841259f74740665ee9e508bd73ea1c4", "node_id": "C_kwDOANBUbNoAKGRiNjEzZThmYTg0MTI1OWY3NDc0MDY2NWVlOWU1MDhiZDczZWExYzQ", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-07-26T21:17:18Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-07-26T21:17:18Z"}, "message": "analyzer: fix false +ves from -Wanalyzer-va-arg-type-mismatch on int promotion [PR106319]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/106319\n\t* store.cc (store::set_value): Don't strip away casts if the\n\tregion has NULL type.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/106319\n\t* gcc.dg/analyzer/stdarg-types-3.c: New test.\n\t* gcc.dg/analyzer/stdarg-types-4.c: New test.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "c7b4d5df87043cd0f9e87eaacd679efd9ad93ed9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7b4d5df87043cd0f9e87eaacd679efd9ad93ed9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/db613e8fa841259f74740665ee9e508bd73ea1c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db613e8fa841259f74740665ee9e508bd73ea1c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db613e8fa841259f74740665ee9e508bd73ea1c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db613e8fa841259f74740665ee9e508bd73ea1c4/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0460ba622e833db5cc1cc793201762bbbd30af6b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0460ba622e833db5cc1cc793201762bbbd30af6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0460ba622e833db5cc1cc793201762bbbd30af6b"}], "stats": {"total": 93, "additions": 92, "deletions": 1}, "files": [{"sha": "46475f6a7fa3e56ebe2e8eb4b9f1c3f925a02bcf", "filename": "gcc/analyzer/store.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db613e8fa841259f74740665ee9e508bd73ea1c4/gcc%2Fanalyzer%2Fstore.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db613e8fa841259f74740665ee9e508bd73ea1c4/gcc%2Fanalyzer%2Fstore.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fstore.cc?ref=db613e8fa841259f74740665ee9e508bd73ea1c4", "patch": "@@ -2445,7 +2445,9 @@ store::set_value (store_manager *mgr, const region *lhs_reg,\n \n   remove_overlapping_bindings (mgr, lhs_reg, uncertainty);\n \n-  rhs_sval = simplify_for_binding (rhs_sval);\n+  if (lhs_reg->get_type ())\n+    rhs_sval = simplify_for_binding (rhs_sval);\n+  /* ...but if we have no type for the region, retain any cast.  */\n \n   const region *lhs_base_reg = lhs_reg->get_base_region ();\n   binding_cluster *lhs_cluster;"}, {"sha": "7351261a55c96644e781d17435b3d20d465c30ad", "filename": "gcc/testsuite/gcc.dg/analyzer/stdarg-types-3.c", "status": "added", "additions": 67, "deletions": 0, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db613e8fa841259f74740665ee9e508bd73ea1c4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-types-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db613e8fa841259f74740665ee9e508bd73ea1c4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-types-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-types-3.c?ref=db613e8fa841259f74740665ee9e508bd73ea1c4", "patch": "@@ -0,0 +1,67 @@\n+static void __attribute__((noinline))\n+__analyzer_consume_n_ints (int num, ...)\n+{\n+  __builtin_va_list ap;\n+  __builtin_va_start (ap, num);\n+\n+  int i, v;\n+  for (i = 0; i < num; i++)\n+    v = __builtin_va_arg (ap, int);\n+\n+  __builtin_va_end (ap);\n+}\n+\n+void test_int (int x)\n+{\n+  __analyzer_consume_n_ints (1, x);\n+}\n+\n+void test_3_ints (int x, int y, int z)\n+{\n+  __analyzer_consume_n_ints (3, x, y, z);\n+}\n+\n+/* Verify that we don't complain about types that get promoted to int\n+   at the variadic call.  */\n+\n+void test_short (short s)\n+{\n+  __analyzer_consume_n_ints (1, s);\n+}\n+\n+void test_ushort (unsigned short s)\n+{\n+  __analyzer_consume_n_ints (1, s);\n+}\n+\n+void test_schar (signed char ch)\n+{\n+  __analyzer_consume_n_ints (1, ch);\n+}\n+\n+void test_uchar (unsigned char ch)\n+{\n+  __analyzer_consume_n_ints (1, ch);\n+}\n+\n+struct ust\n+{\n+  int b0123 : 4;\n+  int b4567 : 4;\n+};\n+\n+void test_signed_bitfield (struct ust s)\n+{\n+  __analyzer_consume_n_ints (2, s.b0123, s.b4567);\n+}\n+\n+struct sst\n+{\n+  unsigned int b0123 : 4;\n+  unsigned int b4567 : 4;\n+};\n+\n+void test_unsigned_bitfield (struct sst s)\n+{\n+  __analyzer_consume_n_ints (2, s.b0123, s.b4567);\n+}"}, {"sha": "920eccebc2b96dca22eba445d9d3aa3ee4c28ab2", "filename": "gcc/testsuite/gcc.dg/analyzer/stdarg-types-4.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db613e8fa841259f74740665ee9e508bd73ea1c4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-types-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db613e8fa841259f74740665ee9e508bd73ea1c4/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-types-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fstdarg-types-4.c?ref=db613e8fa841259f74740665ee9e508bd73ea1c4", "patch": "@@ -0,0 +1,22 @@\n+static void __attribute__((noinline))\n+__analyzer_consume_n_uints (int num, ...)\n+{\n+  __builtin_va_list ap;\n+  __builtin_va_start (ap, num);\n+\n+  int i, v;\n+  for (i = 0; i < num; i++)\n+    v = __builtin_va_arg (ap, unsigned int);\n+\n+  __builtin_va_end (ap);\n+}\n+\n+void test_uint (unsigned int x)\n+{\n+  __analyzer_consume_n_uints (1, x);\n+}\n+\n+void test_3_uints (unsigned int x, unsigned int y, unsigned int z)\n+{\n+  __analyzer_consume_n_uints (3, x, y, z);\n+}"}]}