{"sha": "1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWJmN2MyYTcxYzFkZTA4ZGY2NzcyZDBkOWY0YjJlMGQzNTdmMGUxMQ==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2012-04-25T02:21:09Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2012-04-25T02:21:09Z"}, "message": "rs6000.c (rs6000_savres_strategy): Allow out-of-line save/restore for large frames.\n\n\t* config/rs6000/rs6000.c (rs6000_savres_strategy): Allow\n\tout-of-line save/restore for large frames.  Don't disable\n\tout-of-line saves on ABI_AIX when using static chain reg.\n\t(rs6000_emit_prologue): Adjust cr_save_regno on ABI_AIX to not\n\tclobber static chain reg, and tweak for out-of-line gpr saves\n\tthat use r1.\n\nFrom-SVN: r186799", "tree": {"sha": "9e7a9bd06f45fa65e01dbc392641c3def582637f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e7a9bd06f45fa65e01dbc392641c3def582637f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c344e2656abaa01b2afaebb6beef66b90433fbfa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c344e2656abaa01b2afaebb6beef66b90433fbfa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c344e2656abaa01b2afaebb6beef66b90433fbfa"}], "stats": {"total": 26, "additions": 20, "deletions": 6}, "files": [{"sha": "8926b3f25f608de2435774868b2c46cfe8f39663", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11", "patch": "@@ -1,3 +1,12 @@\n+2012-04-25  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/rs6000/rs6000.c (rs6000_savres_strategy): Allow\n+\tout-of-line save/restore for large frames.  Don't disable\n+\tout-of-line saves on ABI_AIX when using static chain reg.\n+\t(rs6000_emit_prologue): Adjust cr_save_regno on ABI_AIX to not\n+\tclobber static chain reg, and tweak for out-of-line gpr saves\n+\tthat use r1.\n+\n 2012-04-25  Alan Modra  <amodra@gmail.com>\n \n \t* config/rs6000/rs6000.c (START_USE, END_USE, NOT_INUSE): Define."}, {"sha": "31c671188f84e10c981b19c7020016cb3dc2c0e7", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=1bf7c2a71c1de08df6772d0d9f4b2e0d357f0e11", "patch": "@@ -17432,8 +17432,7 @@ rs6000_savres_strategy (rs6000_stack_t *info,\n     strategy |= SAVRES_MULTIPLE;\n \n   if (crtl->calls_eh_return\n-      || cfun->machine->ra_need_lr\n-      || info->total_size > 32767)\n+      || cfun->machine->ra_need_lr)\n     strategy |= (SAVE_INLINE_FPRS | REST_INLINE_FPRS\n \t\t | SAVE_INLINE_GPRS | REST_INLINE_GPRS);\n \n@@ -17454,8 +17453,8 @@ rs6000_savres_strategy (rs6000_stack_t *info,\n   /* Don't bother to try to save things out-of-line if r11 is occupied\n      by the static chain.  It would require too much fiddling and the\n      static chain is rarely used anyway.  FPRs are saved w.r.t the stack\n-     pointer on Darwin.  */\n-  if (using_static_chain_p)\n+     pointer on Darwin, and AIX uses r1 or r12.  */\n+  if (using_static_chain_p && DEFAULT_ABI != ABI_AIX)\n     strategy |= ((DEFAULT_ABI == ABI_DARWIN\n \t\t  ? 0 : SAVE_INLINE_FPRS | REST_INLINE_FPRS)\n \t\t | SAVE_INLINE_GPRS);\n@@ -19555,11 +19554,17 @@ rs6000_emit_prologue (void)\n \t}\n     }\n \n-  /* If we need to save CR, put it into r12 or r11.  */\n+  /* If we need to save CR, put it into r12 or r11.  Choose r12 except when\n+     r12 will be needed by out-of-line gpr restore.  */\n+  cr_save_regno = (DEFAULT_ABI == ABI_AIX\n+\t\t   && !(strategy & (SAVE_INLINE_GPRS\n+\t\t\t\t    | SAVE_NOINLINE_GPRS_SAVES_LR))\n+\t\t   ? 11 : 12);\n   cr_save_regno = DEFAULT_ABI == ABI_AIX && !saving_GPRs_inline ? 11 : 12;\n   if (!WORLD_SAVE_P (info)\n       && info->cr_save_p\n-      && REGNO (frame_reg_rtx) != cr_save_regno)\n+      && REGNO (frame_reg_rtx) != cr_save_regno\n+      && !(using_static_chain_p && cr_save_regno == 11))\n     {\n       rtx set;\n "}]}