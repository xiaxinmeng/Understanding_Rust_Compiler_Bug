{"sha": "cf7716a257e24ea77ffc481ba7905bc263d68c14", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2Y3NzE2YTI1N2UyNGVhNzdmZmM0ODFiYTc5MDViYzI2M2Q2OGMxNA==", "commit": {"author": {"name": "Quentin Neill", "email": "quentin.neill@amd.com", "date": "2011-11-08T04:28:04Z"}, "committer": {"name": "Harsha Jagasia", "email": "hjagasia@gcc.gnu.org", "date": "2011-11-08T04:28:04Z"}, "message": "compare_tests: Add ability to compare all .sum files from two build directories.\n\n2011-11-07   Quentin Neill  <quentin.neill@amd.com>\n\n\t* compare_tests: Add ability to compare all .sum\n\tfiles from two build directories.\n\nFrom-SVN: r181149", "tree": {"sha": "a54a52d2f5024050c2a4254452d2daf0e2b328d7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a54a52d2f5024050c2a4254452d2daf0e2b328d7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cf7716a257e24ea77ffc481ba7905bc263d68c14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf7716a257e24ea77ffc481ba7905bc263d68c14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf7716a257e24ea77ffc481ba7905bc263d68c14", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf7716a257e24ea77ffc481ba7905bc263d68c14/comments", "author": null, "committer": null, "parents": [{"sha": "e65cf3bc2d43ba7571d251ba5fc638b264bc9691", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e65cf3bc2d43ba7571d251ba5fc638b264bc9691", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e65cf3bc2d43ba7571d251ba5fc638b264bc9691"}], "stats": {"total": 108, "additions": 98, "deletions": 10}, "files": [{"sha": "ed2ff363555f0e789c80da39df861cafc765d737", "filename": "contrib/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf7716a257e24ea77ffc481ba7905bc263d68c14/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf7716a257e24ea77ffc481ba7905bc263d68c14/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=cf7716a257e24ea77ffc481ba7905bc263d68c14", "patch": "@@ -1,3 +1,8 @@\n+2011-11-07   Quentin Neill  <quentin.neill@amd.com>\n+\n+\t* compare_tests: Add ability to compare all .sum\n+\tfiles from two build directories.\n+\n 2011-11-05  Joern Rennecke  <joern.rennecke@embecosm.com>\n \n \t* contrib-list.mk: Add Epiphany configurations."}, {"sha": "a23fcf6ef3f184e84a18e82d7c6dc1c9b690f248", "filename": "contrib/compare_tests", "status": "modified", "additions": 93, "deletions": 10, "changes": 103, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cf7716a257e24ea77ffc481ba7905bc263d68c14/contrib%2Fcompare_tests", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cf7716a257e24ea77ffc481ba7905bc263d68c14/contrib%2Fcompare_tests", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fcompare_tests?ref=cf7716a257e24ea77ffc481ba7905bc263d68c14", "patch": "@@ -2,24 +2,105 @@\n # This script automatically test the given tool with the tool's test cases,\n # reporting anything of interest.\n \n-# exits with 0 if there is nothing of interest\n-# exits with 1 if there is something interesting\n-# exits with 2 if an error occurred\n-\n-# Give two .sum files to compare them\n+usage()\n+{\n+\tif [ -n \"$1\" ] ; then\n+\t\techo \"$0: Error: $1\" >&2\n+\t\techo >&2\n+\tfi\n+\tcat >&2 <<EOUSAGE\n+Usage: $0 [-strict] PREVIOUS CURRENT\n+\n+Compare the PREVIOUS and CURRENT test case .sum files, reporting anything of interest.\n+\n+\tIf PREVIOUS and CURRENT are directories, find and compare any *.sum files.\n+\n+\tUnless -strict is given, these discrepancies are not counted as errors:\n+\t\tmissing/extra .sum files when comparing directories\n+\t\ttests that failed in PREVIOUS but pass in CURRENT\n+\t\ttests that were not in PREVIOUS but appear in CURRENT\n+\t\ttests in PREVIOUS that are missing in CURRENT\n+\n+\tExit with the following values:\n+\t\t0 if there is nothing of interest\n+\t\t1 if there are errors when comparing single test case files\n+\t\tN for the number of errors found when comparing directories\n+EOUSAGE\n+\texit 2\n+}\n \n # Written by Mike Stump <mrs@cygnus.com>\n+# Subdir comparison added by Quentin Neill <quentin.neill@amd.com>\n \n tool=gxx\n \n tmp1=/tmp/$tool-testing.$$a\n tmp2=/tmp/$tool-testing.$$b\n now_s=/tmp/$tool-testing.$$d\n before_s=/tmp/$tool-testing.$$e\n+lst1=/tmp/$tool-lst1.$$\n+lst2=/tmp/$tool-lst2.$$\n+lst3=/tmp/$tool-lst3.$$\n+lst4=/tmp/$tool-lst4.$$\n+lst5=/tmp/$tool-lst5.$$\n+tmps=\"$tmp1 $tmp2 $now_s $before_s $lst1 $lst2 $lst3 $lst4 $lst5\"\n+\n+[ \"$1\" = \"-strict\" ] && strict=$1 && shift\n+[ \"$1\" = \"-?\" ] && usage\n+[ \"$2\" = \"\" ] && usage \"Must specify both PREVIOUS and CURRENT\"\n+\n+trap \"rm -f $tmps\" 0 1 2 3 5 9 13 15\n+exit_status=0\n \n-if [ \"$2\" = \"\" ]; then\n-\techo \"Usage: $0 previous current\" >&2\n-\texit 2\n+if [ -d \"$1\" -a -d \"$2\" ] ; then\n+\tfind \"$1\" -name '*.sum' >$lst1\n+\tfind \"$2\" -name '*.sum' >$lst2\n+\techo \"# Comparing directories\"\n+\techo \"## Dir1=$1: `cat $lst1 | wc -l` sum files\"\n+\techo \"## Dir2=$2: `cat $lst2 | wc -l` sum files\"\n+\techo\n+\t# remove leading directory components to compare\n+\tsed -e \"s|^$1/||\" $lst1 | sort >$lst3\n+\tsed -e \"s|^$2/||\" $lst2 | sort >$lst4\n+\tcomm -23 $lst3 $lst4 >$lst5\n+\tif [ -s $lst5 ] ; then\n+\t\techo \"# Extra sum files in Dir1=$1\"\n+\t\tsed -e \"s|^|< $1/|\" $lst5\n+\t\techo\n+\t\t[ -n \"$strict\" ] && exit_status=`expr $exit_status + 1`\n+\tfi\n+\tcomm -13 $lst3 $lst4 >$lst5\n+\tif [ -s $lst5 ] ; then\n+\t\techo \"# Extra sum files in Dir2=$2\"\n+\t\tsed -e \"s|^|> $2/|\" $lst5\n+\t\techo\n+\t\t[ -n \"$strict\" ] && exit_status=`expr $exit_status + 1`\n+\tfi\n+\tcomm -12 $lst3 $lst4 | sort -u >$lst5\n+\tif [ ! -s $lst5 ] ; then\n+\t\techo \"# No common sum files\"\n+\t\texit_status=`expr $exit_status + 1`\n+\t\texit $exit_status\n+\tfi\n+\tcmnsums=`cat $lst5 | wc -l`\n+\techo \"# Comparing $cmnsums common sum files\"\n+\t( for fname in `cat $lst5`; do cat $1/$fname; done ) >$sum1\n+\t( for fname in `cat $lst5`; do cat $2/$fname; done ) >$sum2\n+\techo \"## ${CONFIG_SHELL-/bin/sh} $0 $strict $sum1 $sum2\"\n+\t${CONFIG_SHELL-/bin/sh} $0 $strict $sum1 $sum2\n+\tret=$?\n+\tif [ $ret -ne 0 ]; then\n+\t\texit_status=`expr $exit_status + 1`\n+\t\techo \"## Differences found: $fname\"\n+\tfi\n+\tif [ $exit_status -ne 0 ]; then\n+\t\techo \"# $exit_status differences in $cmnsums common sum files found\"\n+\telse\n+\t\techo \"# No differences found in $cmnsums common sum files\"\n+\tfi\n+\texit $exit_status\n+elif [ -d \"$1\" -o -d \"$2\" ] ; then\n+\tusage \"Must specify either two directories or two files\"\n fi\n \n sed 's/^XFAIL/FAIL/; s/^XPASS/PASS/' < \"$1\" | awk '/^Running target / {target = $3} { if (target != \"unix\") { sub(/: /, \"&\"target\": \" ); }; print $0; }' >$tmp1\n@@ -28,8 +109,6 @@ sed 's/^XFAIL/FAIL/; s/^XPASS/PASS/' < \"$2\" | awk '/^Running target / {target =\n before=$tmp1\n now=$tmp2\n \n-exit_status=0\n-trap \"rm -f $tmp1 $tmp2 $now_s $before_s\" 0 1 2 3 5 9 13 15\n \n if sort -k 2 </dev/null >/dev/null 2>&1; then\n   skip1='-k 2'\n@@ -60,6 +139,7 @@ if [ $? = 0 ]; then\n \techo \"Tests that now work, but didn't before:\"\n \techo\n \tcat $tmp2\n+\t[ -n \"$strict\" ] && echo \"Strict test fails\" && exit_status=1\n \techo\n fi\n \n@@ -83,6 +163,7 @@ if [ $? = 0 ]; then\n \techo \"New tests that PASS:\"\n \techo\n \tcat $tmp2\n+\t[ -n \"$strict\" ] && echo \"Strict test fails\" && exit_status=1\n \techo\n fi\n \n@@ -94,6 +175,7 @@ if [ $? = 0 ]; then\n \techo \"Old tests that passed, that have disappeared: (Eeek!)\"\n \techo\n \tcat $tmp2\n+\t[ -n \"$strict\" ] && echo \"Strict test fails\" && exit_status=1\n \techo\n fi\n \n@@ -105,6 +187,7 @@ if [ $? = 0 ]; then\n \techo \"Old tests that failed, that have disappeared: (Eeek!)\"\n \techo\n \tcat $tmp2\n+\t[ -n \"$strict\" ] && echo \"Strict test fails\" && exit_status=1\n \techo\n fi\n "}]}