{"sha": "508d0c3da24c91bdabf7fbd453b511bfccbb2958", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTA4ZDBjM2RhMjRjOTFiZGFiZjdmYmQ0NTNiNTExYmZjY2JiMjk1OA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-01-23T20:36:34Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-01-23T20:36:34Z"}, "message": "re PR sanitizer/83987 (ICE with OpenMP, sanitizer and virtual bases)\n\n\tPR sanitizer/83987\n\t* tree.c (cp_free_lang_data): Change DECL_VALUE_EXPR of\n\tDECL_OMP_PRIVATIZED_MEMBER vars to error_mark_node.\n\n\t* g++.dg/ubsan/pr83987.C: New test.\n\nFrom-SVN: r256997", "tree": {"sha": "783ff70265bd9ba0f304d4c634b318e3605f7b2d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/783ff70265bd9ba0f304d4c634b318e3605f7b2d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/508d0c3da24c91bdabf7fbd453b511bfccbb2958", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/508d0c3da24c91bdabf7fbd453b511bfccbb2958", "html_url": "https://github.com/Rust-GCC/gccrs/commit/508d0c3da24c91bdabf7fbd453b511bfccbb2958", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/508d0c3da24c91bdabf7fbd453b511bfccbb2958/comments", "author": null, "committer": null, "parents": [{"sha": "56dbd05b0ed265ec37f66234487aaad6e330c7ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56dbd05b0ed265ec37f66234487aaad6e330c7ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56dbd05b0ed265ec37f66234487aaad6e330c7ce"}], "stats": {"total": 58, "additions": 47, "deletions": 11}, "files": [{"sha": "a0a3c13d993591dcd27554a2a521f6f04b63c103", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=508d0c3da24c91bdabf7fbd453b511bfccbb2958", "patch": "@@ -1,3 +1,9 @@\n+2018-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/83987\n+\t* tree.c (cp_free_lang_data): Change DECL_VALUE_EXPR of\n+\tDECL_OMP_PRIVATIZED_MEMBER vars to error_mark_node.\n+\n 2018-01-23  Nathan Sidwell  <nathan@acm.org>\n \n \tPR c++/83988"}, {"sha": "e87c59659a5d5e0101dcc8e37a0343d247040629", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=508d0c3da24c91bdabf7fbd453b511bfccbb2958", "patch": "@@ -5274,6 +5274,16 @@ cp_free_lang_data (tree t)\n     /* We do not need the leftover chaining of namespaces from the\n        binding level.  */\n     DECL_CHAIN (t) = NULL_TREE;\n+  /* Set DECL_VALUE_EXPRs of OpenMP privatized member artificial\n+     decls to error_mark_node.  These are DECL_IGNORED_P and after\n+     OpenMP lowering they aren't useful anymore.  Clearing DECL_VALUE_EXPR\n+     doesn't work, as expansion could then consider them as something\n+     to be expanded.  */\n+  if (VAR_P (t)\n+      && DECL_LANG_SPECIFIC (t)\n+      && DECL_OMP_PRIVATIZED_MEMBER (t)\n+      && DECL_IGNORED_P (t))\n+    SET_DECL_VALUE_EXPR (t, error_mark_node);\n }\n \n /* Stub for c-common.  Please keep in sync with c-decl.c."}, {"sha": "ce9c3c8e10bd4c6c2f1c607d589127cb47ae2901", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=508d0c3da24c91bdabf7fbd453b511bfccbb2958", "patch": "@@ -1,12 +1,17 @@\n-2018-23-01  Paul Thomas  <pault@gcc.gnu.org>\n+2018-01-23  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/83987\n+\t* g++.dg/ubsan/pr83987.C: New test.\n+\n+2018-01-23  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/83866\n-\t* gfortran.dg/pdt_29.f03 : New test.\n+\t* gfortran.dg/pdt_29.f03: New test.\n \n-2018-23-01  Paul Thomas  <pault@gcc.gnu.org>\n+2018-01-23  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/83898\n-\t* gfortran.dg/associate_33.f03 : New test.\n+\t* gfortran.dg/associate_33.f03: New test.\n \n 2018-01-23  Martin Liska  <mliska@suse.cz>\n \n@@ -1704,7 +1709,7 @@\n 2018-01-13  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/52162\n-\t* gfortran.dg/bounds_check_19.f90 : New test.\n+\t* gfortran.dg/bounds_check_19.f90: New test.\n \n 2018-01-12  Jakub Jelinek  <jakub@redhat.com>\n \n@@ -2262,12 +2267,12 @@\n 2018-01-08  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/83611\n-\t* gfortran.dg/pdt_15.f03 : Bump count of 'n.data = 0B' to 8.\n-\t* gfortran.dg/pdt_26.f03 : Bump count of '_malloc' to 9.\n-\t* gfortran.dg/pdt_27.f03 : New test.\n+\t* gfortran.dg/pdt_15.f03: Bump count of 'n.data = 0B' to 8.\n+\t* gfortran.dg/pdt_26.f03: Bump count of '_malloc' to 9.\n+\t* gfortran.dg/pdt_27.f03: New test.\n \n \tPR fortran/83731\n-\t* gfortran.dg/pdt_28.f03 : New test.\n+\t* gfortran.dg/pdt_28.f03: New test.\n \n 2018-01-08  Tom de Vries  <tom@codesourcery.com>\n \n@@ -2562,10 +2567,10 @@\n 2018-01-01  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/83076\n-\t* gfortran.dg/coarray_45.f90 : New test.\n+\t* gfortran.dg/coarray_45.f90: New test.\n \n \tPR fortran/83319\n-\t* gfortran.dg/coarray_46.f90 : New test.\n+\t* gfortran.dg/coarray_46.f90: New test.\n \n 2018-01-01  Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "7ba7952b293ea51ffb08557cb576c1091d999328", "filename": "gcc/testsuite/g++.dg/ubsan/pr83987.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr83987.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/508d0c3da24c91bdabf7fbd453b511bfccbb2958/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr83987.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr83987.C?ref=508d0c3da24c91bdabf7fbd453b511bfccbb2958", "patch": "@@ -0,0 +1,15 @@\n+// PR sanitizer/83987\n+// { dg-do compile { target fopenmp } }\n+// { dg-options \"-fopenmp -fsanitize=vptr -O0\" }\n+\n+struct A { int i; };\n+struct B : virtual A { void foo (); };\n+\n+void\n+B::foo ()\n+{\n+#pragma omp sections lastprivate (i)\n+  {\n+    i = 0;\n+  }\n+}"}]}