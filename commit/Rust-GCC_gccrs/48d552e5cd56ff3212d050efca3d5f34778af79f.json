{"sha": "48d552e5cd56ff3212d050efca3d5f34778af79f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDhkNTUyZTVjZDU2ZmYzMjEyZDA1MGVmY2EzZDVmMzQ3NzhhZjc5Zg==", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2019-09-16T18:37:28Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2019-09-16T18:37:28Z"}, "message": "re PR target/91719 (gcc compiles seq_cst store on x86-64 differently from clang/icc)\n\n\tPR target/91719\n\t* config/i386/i386.h (TARGET_USE_XCHG_FOR_ATOMIC_STORE): New macro.\n\t* config/i386/x86-tune.def (X86_TUNE_USE_XCHG_FOR_ATOMIC_STORE): New.\n\t* config/i386/sync.md (atomic_store<mode>): emit XCHG for\n\tTARGET_USE_XCHG_FOR_ATOMIC_STORE.\n\nFrom-SVN: r275754", "tree": {"sha": "03311cf5d034385e71ef869576b11ea1288ebe40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/03311cf5d034385e71ef869576b11ea1288ebe40"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/48d552e5cd56ff3212d050efca3d5f34778af79f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48d552e5cd56ff3212d050efca3d5f34778af79f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/48d552e5cd56ff3212d050efca3d5f34778af79f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/48d552e5cd56ff3212d050efca3d5f34778af79f/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e4ab9e060be99646f066264d6f23320825a46054", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4ab9e060be99646f066264d6f23320825a46054", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e4ab9e060be99646f066264d6f23320825a46054"}], "stats": {"total": 21, "additions": 19, "deletions": 2}, "files": [{"sha": "2f4de49fe8569400f4c235e46ab0dacb0daba2d1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=48d552e5cd56ff3212d050efca3d5f34778af79f", "patch": "@@ -1,3 +1,11 @@\n+2019-09-16  Uro\u0161 Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/91719\n+\t* config/i386/i386.h (TARGET_USE_XCHG_FOR_ATOMIC_STORE): New macro.\n+\t* config/i386/x86-tune.def (X86_TUNE_USE_XCHG_FOR_ATOMIC_STORE): New.\n+\t* config/i386/sync.md (atomic_store<mode>): emit XCHG for\n+\tTARGET_USE_XCHG_FOR_ATOMIC_STORE.\n+\n 2019-09-16  Jason Merrill  <jason@redhat.com>\n \n \t* Makefile.in (build/genmatch.o): Depend on $(CPPLIB_H)."}, {"sha": "885846e0a351fbf6d389fb6dd5724d3f1e59a041", "filename": "gcc/config/i386/i386.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2Fconfig%2Fi386%2Fi386.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2Fconfig%2Fi386%2Fi386.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.h?ref=48d552e5cd56ff3212d050efca3d5f34778af79f", "patch": "@@ -590,6 +590,8 @@ extern unsigned char ix86_tune_features[X86_TUNE_LAST];\n \tix86_tune_features[X86_TUNE_AVOID_FALSE_DEP_FOR_BMI]\n #define TARGET_ONE_IF_CONV_INSN \\\n \tix86_tune_features[X86_TUNE_ONE_IF_CONV_INSN]\n+#define TARGET_USE_XCHG_FOR_ATOMIC_STORE \\\n+\tix86_tune_features[X86_TUNE_USE_XCHG_FOR_ATOMIC_STORE]\n #define TARGET_EMIT_VZEROUPPER \\\n \tix86_tune_features[X86_TUNE_EMIT_VZEROUPPER]\n "}, {"sha": "2614ddb715ab912f37ca4175da33d6bf76e658bf", "filename": "gcc/config/i386/sync.md", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2Fconfig%2Fi386%2Fsync.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2Fconfig%2Fi386%2Fsync.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsync.md?ref=48d552e5cd56ff3212d050efca3d5f34778af79f", "patch": "@@ -306,8 +306,11 @@\n     {\n       operands[1] = force_reg (<MODE>mode, operands[1]);\n \n-      /* For seq-cst stores, when we lack MFENCE, use XCHG.  */\n-      if (is_mm_seq_cst (model) && !(TARGET_64BIT || TARGET_SSE2))\n+      /* For seq-cst stores, use XCHG\n+\t when we lack MFENCE or when target prefers XCHG.  */\n+      if (is_mm_seq_cst (model)\n+\t  && (!(TARGET_64BIT || TARGET_SSE2)\n+\t      || TARGET_USE_XCHG_FOR_ATOMIC_STORE))\n \t{\n \t  emit_insn (gen_atomic_exchange<mode> (gen_reg_rtx (<MODE>mode),\n \t\t\t\t\t\toperands[0], operands[1],"}, {"sha": "e289efdf2e0c34b856566807efd3a9625628d237", "filename": "gcc/config/i386/x86-tune.def", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2Fconfig%2Fi386%2Fx86-tune.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/48d552e5cd56ff3212d050efca3d5f34778af79f/gcc%2Fconfig%2Fi386%2Fx86-tune.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fx86-tune.def?ref=48d552e5cd56ff3212d050efca3d5f34778af79f", "patch": "@@ -313,6 +313,10 @@ DEF_TUNE (X86_TUNE_ONE_IF_CONV_INSN, \"one_if_conv_insn\",\n \t  m_SILVERMONT | m_KNL | m_KNM | m_INTEL | m_CORE_ALL | m_GOLDMONT\n \t  | m_GOLDMONT_PLUS | m_TREMONT | m_GENERIC)\n \n+/* X86_TUNE_USE_XCHG_FOR_ATOMIC_STORE: Use xchg instead of mov+mfence.  */\n+DEF_TUNE (X86_TUNE_USE_XCHG_FOR_ATOMIC_STORE, \"use_xchg_for_atomic_store\",\n+\t m_CORE_ALL | m_BDVER | m_ZNVER | m_GENERIC)\n+\n /*****************************************************************************/\n /* 387 instruction selection tuning                                          */\n /*****************************************************************************/"}]}