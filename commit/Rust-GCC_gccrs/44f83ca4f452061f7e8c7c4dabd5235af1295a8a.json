{"sha": "44f83ca4f452061f7e8c7c4dabd5235af1295a8a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDRmODNjYTRmNDUyMDYxZjdlOGM3YzRkYWJkNTIzNWFmMTI5NWE4YQ==", "commit": {"author": {"name": "Justin Squirek", "email": "squirek@adacore.com", "date": "2019-07-03T08:13:51Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-07-03T08:13:51Z"}, "message": "[Ada] Missing consistency check for constant modifier\n\nThis patch fixes an issue whereby instantiations of generic packages\nwere incorrectly allowed despite formal and actual subprograms not\nhaving matching declarations with anonymous constant access type\nparameters.\n\n------------\n-- Source --\n------------\n\n-- gen1.ads\n\npackage Gen1 is\n   generic\n      with procedure View (IA : not null access constant Integer);\n   procedure Dispatch (IA : access Integer);\nend;\n\n-- gen2.adb\n\npackage body Gen1 is\n   procedure Dispatch (IA : access Integer) is\n   begin\n      View (IA);\n   end;\nend;\n\n-- bad1.ads\n\nwith Gen1;\npackage Bad1 is\n   procedure Bad_View (IA : not null access Integer);\n   procedure Bad_Dispatch is new Gen1.Dispatch (Bad_View);\nend;\n\n-- bad1.adb\n\npackage body Bad1 is\n   procedure Bad_View (IA : not null access Integer) is\n   begin\n      IA.all := IA.all + 1;\n   end;\nend;\n\n-- gen2.ads\n\npackage Gen2 is\n   generic\n      with procedure View (IA : access constant Integer);\n   procedure Dispatch (IA : access Integer);\nend;\n\n-- gen2.adb\n\npackage body Gen2 is\n   procedure Dispatch (IA : access Integer) is\n   begin\n      View (IA);\n   end;\nend;\n\n-- bad2.ads\n\nwith Gen2;\npackage Bad2 is\n   procedure Bad_View (IA : access Integer);\n   procedure Bad_Dispatch is new Gen2.Dispatch (Bad_View);\nend;\n\n-- bad2.adb\n\npackage body Bad2 is\n   procedure Bad_View (IA : access Integer) is\n   begin\n      IA.all := IA.all + 1;\n   end;\nend;\n\n-----------------\n-- Compilation --\n-----------------\n\n$ gnatmake -q bad1.adb\n$ bad1.ads:4:04: instantiation error at gen1.ads:3\n$ bad1.ads:4:04: not mode conformant with declaration at line 3\n$ bad1.ads:4:04: constant modifier does not match\n$ gnatmake: \"bad1.adb\" compilation error\n$ gnatmake -q bad2.adb\n$ bad2.ads:4:04: instantiation error at gen2.ads:3\n$ bad2.ads:4:04: not mode conformant with declaration at line 3\n$ bad2.ads:4:04: constant modifier does not match\n$ gnatmake: \"bad2.adb\" compilation error\n\n2019-07-03  Justin Squirek  <squirek@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch6.adb (Check_Conformance): Add expression checking for\n\tconstant modifiers in anonymous access types (in addition to\n\t\"non-null\" types) so that they are considered \"matching\" for\n\tsubsequent conformance tests.\n\nFrom-SVN: r272963", "tree": {"sha": "6db7a7d600d3e4509734b15863c68707cb9f0ce9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6db7a7d600d3e4509734b15863c68707cb9f0ce9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/44f83ca4f452061f7e8c7c4dabd5235af1295a8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44f83ca4f452061f7e8c7c4dabd5235af1295a8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/44f83ca4f452061f7e8c7c4dabd5235af1295a8a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/44f83ca4f452061f7e8c7c4dabd5235af1295a8a/comments", "author": {"login": "AdaDoom3", "id": 3445599, "node_id": "MDQ6VXNlcjM0NDU1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3445599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdaDoom3", "html_url": "https://github.com/AdaDoom3", "followers_url": "https://api.github.com/users/AdaDoom3/followers", "following_url": "https://api.github.com/users/AdaDoom3/following{/other_user}", "gists_url": "https://api.github.com/users/AdaDoom3/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdaDoom3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdaDoom3/subscriptions", "organizations_url": "https://api.github.com/users/AdaDoom3/orgs", "repos_url": "https://api.github.com/users/AdaDoom3/repos", "events_url": "https://api.github.com/users/AdaDoom3/events{/privacy}", "received_events_url": "https://api.github.com/users/AdaDoom3/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "3e1199e0345c7029db845faa7b4fc4cb14120db9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e1199e0345c7029db845faa7b4fc4cb14120db9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e1199e0345c7029db845faa7b4fc4cb14120db9"}], "stats": {"total": 15, "additions": 13, "deletions": 2}, "files": [{"sha": "879b776d0b4e8374f7046f470f343c221de96100", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44f83ca4f452061f7e8c7c4dabd5235af1295a8a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44f83ca4f452061f7e8c7c4dabd5235af1295a8a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=44f83ca4f452061f7e8c7c4dabd5235af1295a8a", "patch": "@@ -1,3 +1,10 @@\n+2019-07-03  Justin Squirek  <squirek@adacore.com>\n+\n+\t* sem_ch6.adb (Check_Conformance): Add expression checking for\n+\tconstant modifiers in anonymous access types (in addition to\n+\t\"non-null\" types) so that they are considered \"matching\" for\n+\tsubsequent conformance tests.\n+\n 2019-07-03  Arnaud Charlet  <charlet@adacore.com>\n \n \t* doc/gnat_rm/standard_and_implementation_defined_restrictions.rst:"}, {"sha": "cf1b0e7322761752951f79000334b05baaa9fad8", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/44f83ca4f452061f7e8c7c4dabd5235af1295a8a/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/44f83ca4f452061f7e8c7c4dabd5235af1295a8a/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=44f83ca4f452061f7e8c7c4dabd5235af1295a8a", "patch": "@@ -5444,10 +5444,14 @@ package body Sem_Ch6 is\n                and then Directly_Designated_Type (Old_Formal_Base) =\n                                     Directly_Designated_Type (New_Formal_Base)\n            and then ((Is_Itype (Old_Formal_Base)\n-                       and then Can_Never_Be_Null (Old_Formal_Base))\n+                       and then (Can_Never_Be_Null (Old_Formal_Base)\n+                                  or else Is_Access_Constant\n+                                            (Old_Formal_Base)))\n                      or else\n                       (Is_Itype (New_Formal_Base)\n-                        and then Can_Never_Be_Null (New_Formal_Base)));\n+                        and then (Can_Never_Be_Null (New_Formal_Base)\n+                                   or else Is_Access_Constant\n+                                             (New_Formal_Base))));\n \n          --  Types must always match. In the visible part of an instance,\n          --  usual overloading rules for dispatching operations apply, and"}]}