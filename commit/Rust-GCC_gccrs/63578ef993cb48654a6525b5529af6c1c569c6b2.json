{"sha": "63578ef993cb48654a6525b5529af6c1c569c6b2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM1NzhlZjk5M2NiNDg2NTRhNjUyNWI1NTI5YWY2YzFjNTY5YzZiMg==", "commit": {"author": {"name": "Kai Tietz", "email": "ktietz70@googlemail.com", "date": "2015-10-02T08:06:52Z"}, "committer": {"name": "Kai Tietz", "email": "ktietz@gcc.gnu.org", "date": "2015-10-02T08:06:52Z"}, "message": "re PR target/51726 (LTO and attribute 'selectany')\n\n\tPR target/51726\n\t* config/i386/winnt.c (ix86_handle_selectany_attribute): Handle\n\tselectany within this function without need to keep attribute.\n\t(i386_pe_encode_section_info): Remove selectany-code.\n\nFrom-SVN: r228370", "tree": {"sha": "b500bce9a64bd45d610be02e0e9867fb72172581", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b500bce9a64bd45d610be02e0e9867fb72172581"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63578ef993cb48654a6525b5529af6c1c569c6b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63578ef993cb48654a6525b5529af6c1c569c6b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63578ef993cb48654a6525b5529af6c1c569c6b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63578ef993cb48654a6525b5529af6c1c569c6b2/comments", "author": {"login": "kai1970", "id": 11942286, "node_id": "MDQ6VXNlcjExOTQyMjg2", "avatar_url": "https://avatars.githubusercontent.com/u/11942286?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kai1970", "html_url": "https://github.com/kai1970", "followers_url": "https://api.github.com/users/kai1970/followers", "following_url": "https://api.github.com/users/kai1970/following{/other_user}", "gists_url": "https://api.github.com/users/kai1970/gists{/gist_id}", "starred_url": "https://api.github.com/users/kai1970/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kai1970/subscriptions", "organizations_url": "https://api.github.com/users/kai1970/orgs", "repos_url": "https://api.github.com/users/kai1970/repos", "events_url": "https://api.github.com/users/kai1970/events{/privacy}", "received_events_url": "https://api.github.com/users/kai1970/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6a8b77b2fa3520d5f6e572b52cb68e53358dd677", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a8b77b2fa3520d5f6e572b52cb68e53358dd677", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a8b77b2fa3520d5f6e572b52cb68e53358dd677"}], "stats": {"total": 43, "additions": 20, "deletions": 23}, "files": [{"sha": "b9d21ec119291464cc6a21b158587833aaebbe32", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63578ef993cb48654a6525b5529af6c1c569c6b2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63578ef993cb48654a6525b5529af6c1c569c6b2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=63578ef993cb48654a6525b5529af6c1c569c6b2", "patch": "@@ -1,3 +1,10 @@\n+2015-10-02  Kai Tietz  <ktietz70@googlemail.com>\n+\n+\tPR target/51726\n+\t* config/i386/winnt.c (ix86_handle_selectany_attribute): Handle\n+\tselectany within this function without need to keep attribute.\n+\t(i386_pe_encode_section_info): Remove selectany-code.\n+\n 2015-10-02  Richard Biener  <rguenther@suse.de>\n \n \t* tree-ssa-sccvn.c (has_VN_INFO): New function."}, {"sha": "e9efec0007134c5b89eecc9f1a0ea3adedc3e131", "filename": "gcc/config/i386/winnt.c", "status": "modified", "additions": 13, "deletions": 23, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63578ef993cb48654a6525b5529af6c1c569c6b2/gcc%2Fconfig%2Fi386%2Fwinnt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63578ef993cb48654a6525b5529af6c1c569c6b2/gcc%2Fconfig%2Fi386%2Fwinnt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fwinnt.c?ref=63578ef993cb48654a6525b5529af6c1c569c6b2", "patch": "@@ -89,17 +89,23 @@ tree\n ix86_handle_selectany_attribute (tree *node, tree name, tree, int,\n \t\t\t\t bool *no_add_attrs)\n {\n+  tree decl = *node;\n   /* The attribute applies only to objects that are initialized and have\n      external linkage.  However, we may not know about initialization\n-     until the language frontend has processed the decl. We'll check for\n-     initialization later in encode_section_info.  */\n-  if (TREE_CODE (*node) != VAR_DECL || !TREE_PUBLIC (*node))\n-    {\t\n-      error (\"%qE attribute applies only to initialized variables\"\n-       \t     \" with external linkage\", name);\n-      *no_add_attrs = true;\n+     until the language frontend has processed the decl.   Therefore\n+     we make sure that variable isn't initialized as common.  */\n+  if (TREE_CODE (decl) != VAR_DECL || !TREE_PUBLIC (decl))\n+    error (\"%qE attribute applies only to initialized variables\"\n+       \t   \" with external linkage\", name);\n+  else\n+    {\n+      make_decl_one_only (decl, DECL_ASSEMBLER_NAME (decl));\n+      /* A variable with attribute selectany never can be common.  */\n+      DECL_COMMON (decl) = 0;\n     }\n \n+  /* We don't need to keep attribute itself.  */\n+  *no_add_attrs = true;\n   return NULL_TREE;\n }\n \n@@ -320,23 +326,7 @@ i386_pe_encode_section_info (tree decl, rtx rtl, int first)\n   switch (TREE_CODE (decl))\n     {\n     case FUNCTION_DECL:\n-      break;\n-\n     case VAR_DECL:\n-      if (lookup_attribute (\"selectany\", DECL_ATTRIBUTES (decl)))\n-\t{\n-\t  if (DECL_INITIAL (decl)\n-\t      /* If an object is initialized with a ctor, the static\n-\t\t initialization and destruction code for it is present in\n-\t\t each unit defining the object.  The code that calls the\n-\t\t ctor is protected by a link-once guard variable, so that\n-\t\t the object still has link-once semantics,  */\n-\t      || TYPE_NEEDS_CONSTRUCTING (TREE_TYPE (decl)))\n-\t    make_decl_one_only (decl, DECL_ASSEMBLER_NAME (decl));\n-\t  else\n-\t    error (\"%q+D:'selectany' attribute applies only to \"\n-\t\t   \"initialized objects\", decl);\n-\t}\n       break;\n \n     default:"}]}