{"sha": "0559979c6428e3b0dd5f181634a3c6775b3babd6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDU1OTk3OWM2NDI4ZTNiMGRkNWYxODE2MzRhM2M2Nzc1YjNiYWJkNg==", "commit": {"author": {"name": "Ilya Leoshkevich", "email": "iii@linux.ibm.com", "date": "2018-07-18T06:58:39Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2018-07-18T06:58:39Z"}, "message": "S/390: Add CFI for mcount call sequences\n\n2018-07-18  Ilya Leoshkevich  <iii@linux.ibm.com>\n\n\t* config/s390/s390.c (s390_function_profiler): Generate CFI.\n\nFrom-SVN: r262850", "tree": {"sha": "d107e6e1628b1c3efcebdb08c7ade3f7219f77e6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d107e6e1628b1c3efcebdb08c7ade3f7219f77e6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0559979c6428e3b0dd5f181634a3c6775b3babd6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0559979c6428e3b0dd5f181634a3c6775b3babd6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0559979c6428e3b0dd5f181634a3c6775b3babd6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0559979c6428e3b0dd5f181634a3c6775b3babd6/comments", "author": {"login": "iii-i", "id": 45998171, "node_id": "MDQ6VXNlcjQ1OTk4MTcx", "avatar_url": "https://avatars.githubusercontent.com/u/45998171?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iii-i", "html_url": "https://github.com/iii-i", "followers_url": "https://api.github.com/users/iii-i/followers", "following_url": "https://api.github.com/users/iii-i/following{/other_user}", "gists_url": "https://api.github.com/users/iii-i/gists{/gist_id}", "starred_url": "https://api.github.com/users/iii-i/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iii-i/subscriptions", "organizations_url": "https://api.github.com/users/iii-i/orgs", "repos_url": "https://api.github.com/users/iii-i/repos", "events_url": "https://api.github.com/users/iii-i/events{/privacy}", "received_events_url": "https://api.github.com/users/iii-i/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "97f132350479327123dc157b66c8a2a2fddeacfd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/97f132350479327123dc157b66c8a2a2fddeacfd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/97f132350479327123dc157b66c8a2a2fddeacfd"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "9ed75cd6d788a5e3d225e2d99aeb8929e9efa113", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0559979c6428e3b0dd5f181634a3c6775b3babd6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0559979c6428e3b0dd5f181634a3c6775b3babd6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0559979c6428e3b0dd5f181634a3c6775b3babd6", "patch": "@@ -1,3 +1,7 @@\n+2018-07-18  Ilya Leoshkevich  <iii@linux.ibm.com>\n+\n+\t* config/s390/s390.c (s390_function_profiler): Generate CFI.\n+\n 2018-07-17  Jeff Law  <law@redhat.com>\n \n \t* config/arm/arm.c (get_label_padding): Update for recent"}, {"sha": "a579e9d5a27f68c4fe05d9b9cc008baba5a3be5b", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0559979c6428e3b0dd5f181634a3c6775b3babd6/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0559979c6428e3b0dd5f181634a3c6775b3babd6/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=0559979c6428e3b0dd5f181634a3c6775b3babd6", "patch": "@@ -13154,7 +13154,7 @@ output_asm_nops (const char *user, int hw)\n void\n s390_function_profiler (FILE *file, int labelno)\n {\n-  rtx op[7];\n+  rtx op[8];\n \n   char label[128];\n   ASM_GENERATE_INTERNAL_LABEL (label, \"LP\", labelno);\n@@ -13164,6 +13164,7 @@ s390_function_profiler (FILE *file, int labelno)\n   op[0] = gen_rtx_REG (Pmode, RETURN_REGNUM);\n   op[1] = gen_rtx_REG (Pmode, STACK_POINTER_REGNUM);\n   op[1] = gen_rtx_MEM (Pmode, plus_constant (Pmode, op[1], UNITS_PER_LONG));\n+  op[7] = GEN_INT (UNITS_PER_LONG);\n \n   op[2] = gen_rtx_REG (Pmode, 1);\n   op[3] = gen_rtx_SYMBOL_REF (Pmode, label);\n@@ -13197,9 +13198,13 @@ s390_function_profiler (FILE *file, int labelno)\n       else\n         {\n           output_asm_insn (\"stg\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_rel_offset\\t%0,%7\", op);\n           output_asm_insn (\"larl\\t%2,%3\", op);\n           output_asm_insn (\"brasl\\t%0,%4\", op);\n           output_asm_insn (\"lg\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_restore\\t%0\", op);\n         }\n     }\n   else if (TARGET_CPU_ZARCH)\n@@ -13210,9 +13215,13 @@ s390_function_profiler (FILE *file, int labelno)\n       else\n         {\n           output_asm_insn (\"st\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_rel_offset\\t%0,%7\", op);\n           output_asm_insn (\"larl\\t%2,%3\", op);\n           output_asm_insn (\"brasl\\t%0,%4\", op);\n           output_asm_insn (\"l\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_restore\\t%0\", op);\n         }\n     }\n   else if (!flag_pic)\n@@ -13226,6 +13235,8 @@ s390_function_profiler (FILE *file, int labelno)\n       else\n         {\n           output_asm_insn (\"st\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_rel_offset\\t%0,%7\", op);\n           output_asm_insn (\"bras\\t%2,%l6\", op);\n           output_asm_insn (\".long\\t%4\", op);\n           output_asm_insn (\".long\\t%3\", op);\n@@ -13235,6 +13246,8 @@ s390_function_profiler (FILE *file, int labelno)\n           output_asm_insn (\"l\\t%2,4(%2)\", op);\n           output_asm_insn (\"basr\\t%0,%0\", op);\n           output_asm_insn (\"l\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_restore\\t%0\", op);\n         }\n     }\n   else\n@@ -13249,6 +13262,8 @@ s390_function_profiler (FILE *file, int labelno)\n       else\n         {\n           output_asm_insn (\"st\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_rel_offset\\t%0,%7\", op);\n           output_asm_insn (\"bras\\t%2,%l6\", op);\n           targetm.asm_out.internal_label (file, \"L\",\n                                           CODE_LABEL_NUMBER (op[5]));\n@@ -13261,6 +13276,8 @@ s390_function_profiler (FILE *file, int labelno)\n           output_asm_insn (\"a\\t%2,4(%2)\", op);\n           output_asm_insn (\"basr\\t%0,%0\", op);\n           output_asm_insn (\"l\\t%0,%1\", op);\n+          if (flag_dwarf2_cfi_asm)\n+            output_asm_insn (\".cfi_restore\\t%0\", op);\n         }\n     }\n "}]}