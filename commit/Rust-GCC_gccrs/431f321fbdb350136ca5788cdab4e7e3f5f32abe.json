{"sha": "431f321fbdb350136ca5788cdab4e7e3f5f32abe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDMxZjMyMWZiZGIzNTAxMzZjYTU3ODhjZGFiNGU3ZTNmNWYzMmFiZQ==", "commit": {"author": {"name": "H.J. Lu", "email": "hongjiu.lu@intel.com", "date": "2010-11-16T17:56:50Z"}, "committer": {"name": "H.J. Lu", "email": "hjl@gcc.gnu.org", "date": "2010-11-16T17:56:50Z"}, "message": "Properly demangle a global constructor symbol.\n\n2010-11-16  H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR other/42670\n\tPR binutils/11137\n\t* cp-demangle.c (d_make_demangle_mangled_name): New.\n\t(d_demangle_callback): Use it on DCT_GLOBAL_XTORS.\n\n\t* testsuite/demangle-expected: Updated.\n\nFrom-SVN: r166810", "tree": {"sha": "9d3533fc1dff04194be510a494ce250339df5c37", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9d3533fc1dff04194be510a494ce250339df5c37"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/431f321fbdb350136ca5788cdab4e7e3f5f32abe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/431f321fbdb350136ca5788cdab4e7e3f5f32abe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/431f321fbdb350136ca5788cdab4e7e3f5f32abe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/431f321fbdb350136ca5788cdab4e7e3f5f32abe/comments", "author": {"login": "hjl-tools", "id": 1072356, "node_id": "MDQ6VXNlcjEwNzIzNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4", "gravatar_id": "", "url": "https://api.github.com/users/hjl-tools", "html_url": "https://github.com/hjl-tools", "followers_url": "https://api.github.com/users/hjl-tools/followers", "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}", "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}", "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions", "organizations_url": "https://api.github.com/users/hjl-tools/orgs", "repos_url": "https://api.github.com/users/hjl-tools/repos", "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}", "received_events_url": "https://api.github.com/users/hjl-tools/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b9b9d34254d1111aa6c8bf0bc48ca68d5ca92c24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9b9d34254d1111aa6c8bf0bc48ca68d5ca92c24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9b9d34254d1111aa6c8bf0bc48ca68d5ca92c24"}], "stats": {"total": 29, "additions": 26, "deletions": 3}, "files": [{"sha": "488fd2d094cffba04b6f60a91b7b15cc00a35a28", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/431f321fbdb350136ca5788cdab4e7e3f5f32abe/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/431f321fbdb350136ca5788cdab4e7e3f5f32abe/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=431f321fbdb350136ca5788cdab4e7e3f5f32abe", "patch": "@@ -1,3 +1,12 @@\n+2010-11-16  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR other/42670\n+\tPR binutils/11137\n+\t* cp-demangle.c (d_make_demangle_mangled_name): New.\n+\t(d_demangle_callback): Use it on DCT_GLOBAL_XTORS.\n+\n+\t* testsuite/demangle-expected: Updated.\n+\n 2010-11-14  Kai Tietz  <kai.tietz@onevision.com>\n \n \t* simple-object-coff.c (simple_object_coff_read_strtab): Fix reading"}, {"sha": "7e951cc78428ccfbc86a3ed59c2ad81d013c3dc1", "filename": "libiberty/cp-demangle.c", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/431f321fbdb350136ca5788cdab4e7e3f5f32abe/libiberty%2Fcp-demangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/431f321fbdb350136ca5788cdab4e7e3f5f32abe/libiberty%2Fcp-demangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcp-demangle.c?ref=431f321fbdb350136ca5788cdab4e7e3f5f32abe", "patch": "@@ -321,6 +321,9 @@ d_make_comp (struct d_info *, enum demangle_component_type,\n static struct demangle_component *\n d_make_name (struct d_info *, const char *, int);\n \n+static struct demangle_component *\n+d_make_demangle_mangled_name (struct d_info *, const char *);\n+\n static struct demangle_component *\n d_make_builtin_type (struct d_info *,\n                      const struct demangle_builtin_type_info *);\n@@ -869,6 +872,17 @@ d_make_comp (struct d_info *di, enum demangle_component_type type,\n   return p;\n }\n \n+/* Add a new demangle mangled name component.  */\n+\n+static struct demangle_component *\n+d_make_demangle_mangled_name (struct d_info *di, const char *s)\n+{\n+  if (d_peek_char (di) != '_' || d_peek_next_char (di) != 'Z')\n+    return d_make_name (di, s, strlen (s));\n+  d_advance (di, 2);\n+  return d_encoding (di, 0);\n+}\n+\n /* Add a new name component.  */\n \n static struct demangle_component *\n@@ -4823,7 +4837,7 @@ d_demangle_callback (const char *mangled, int options,\n \t\t\t  (type == DCT_GLOBAL_CTORS\n \t\t\t   ? DEMANGLE_COMPONENT_GLOBAL_CONSTRUCTORS\n \t\t\t   : DEMANGLE_COMPONENT_GLOBAL_DESTRUCTORS),\n-\t\t\t  d_make_name (&di, d_str (&di), strlen (d_str (&di))),\n+\t\t\t  d_make_demangle_mangled_name (&di, d_str (&di)),\n \t\t\t  NULL);\n \td_advance (&di, strlen (d_str (&di)));\n \tbreak;"}, {"sha": "5ce0377b13bf57f6c38b2b862ff3baa9ba6d6c2f", "filename": "libiberty/testsuite/demangle-expected", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/431f321fbdb350136ca5788cdab4e7e3f5f32abe/libiberty%2Ftestsuite%2Fdemangle-expected", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/431f321fbdb350136ca5788cdab4e7e3f5f32abe/libiberty%2Ftestsuite%2Fdemangle-expected", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Ftestsuite%2Fdemangle-expected?ref=431f321fbdb350136ca5788cdab4e7e3f5f32abe", "patch": "@@ -3610,8 +3610,8 @@ std::_Alloc_traits<std::basic_string<char, std::string_char_traits<char>, libcw:\n #\n --format=gnu-v3 --no-params\n _GLOBAL__I__Z2fnv\n-global constructors keyed to _Z2fnv\n-global constructors keyed to _Z2fnv\n+global constructors keyed to fn()\n+global constructors keyed to fn()\n #\n --format=gnu-v3 --no-params\n _Z1rM1GFivEMS_KFivES_M1HFivES1_4whatIKS_E5what2IS8_ES3_"}]}