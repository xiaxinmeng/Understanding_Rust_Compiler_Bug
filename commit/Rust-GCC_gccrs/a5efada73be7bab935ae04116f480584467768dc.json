{"sha": "a5efada73be7bab935ae04116f480584467768dc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTVlZmFkYTczYmU3YmFiOTM1YWUwNDExNmY0ODA1ODQ0Njc3NjhkYw==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2012-05-14T15:04:39Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2012-05-14T15:04:39Z"}, "message": "tree-dfa.c (make_rename_temp): Be forgiving if not in SSA form.\n\n2012-05-14  Richard Guenther  <rguenther@suse.de>\n\n\t* tree-dfa.c (make_rename_temp): Be forgiving if not in SSA form.\n\t* omp-low.c (expand_omp_taskreg): Properly conditionalize call\n\tto update_ssa.\n\t(expand_omp_for): Likewise.\n\t(expand_omp_for_generic): Adjust conditional add to referenced vars.\n\tUse make_rename_temp for temporaries that should be rewritten into\n\tSSA form.\n\t(expand_omp_for_static_nochunk): Likewise.\n\t(expand_omp_atomic_pipeline): Likewise.\n\nFrom-SVN: r187467", "tree": {"sha": "ff2beffdc8832d9936332aee2f2e9b6275bad992", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ff2beffdc8832d9936332aee2f2e9b6275bad992"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a5efada73be7bab935ae04116f480584467768dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5efada73be7bab935ae04116f480584467768dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5efada73be7bab935ae04116f480584467768dc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5efada73be7bab935ae04116f480584467768dc/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a82960aa3f53932913e9f026cf817f48c5845f9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a82960aa3f53932913e9f026cf817f48c5845f9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a82960aa3f53932913e9f026cf817f48c5845f9e"}], "stats": {"total": 42, "additions": 27, "deletions": 15}, "files": [{"sha": "40a0f73b9ebf4935203bad520b1d3204f88d916b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5efada73be7bab935ae04116f480584467768dc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5efada73be7bab935ae04116f480584467768dc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a5efada73be7bab935ae04116f480584467768dc", "patch": "@@ -1,3 +1,15 @@\n+2012-05-14  Richard Guenther  <rguenther@suse.de>\n+\n+\t* tree-dfa.c (make_rename_temp): Be forgiving if not in SSA form.\n+\t* omp-low.c (expand_omp_taskreg): Properly conditionalize call\n+\tto update_ssa.\n+\t(expand_omp_for): Likewise.\n+\t(expand_omp_for_generic): Adjust conditional add to referenced vars.\n+\tUse make_rename_temp for temporaries that should be rewritten into\n+\tSSA form.\n+\t(expand_omp_for_static_nochunk): Likewise.\n+\t(expand_omp_atomic_pipeline): Likewise.\n+\n 2012-05-14  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/53331"}, {"sha": "7136a7b8ae2d3e55adb850899d0fad340cecf99f", "filename": "gcc/omp-low.c", "status": "modified", "additions": 12, "deletions": 11, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5efada73be7bab935ae04116f480584467768dc/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5efada73be7bab935ae04116f480584467768dc/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=a5efada73be7bab935ae04116f480584467768dc", "patch": "@@ -3598,7 +3598,8 @@ expand_omp_taskreg (struct omp_region *region)\n     expand_parallel_call (region, new_bb, entry_stmt, ws_args);\n   else\n     expand_task_call (new_bb, entry_stmt);\n-  update_ssa (TODO_update_ssa_only_virtuals);\n+  if (gimple_in_ssa_p (cfun))\n+    update_ssa (TODO_update_ssa_only_virtuals);\n }\n \n \n@@ -3709,7 +3710,7 @@ expand_omp_for_generic (struct omp_region *region,\n   iend0 = create_tmp_var (fd->iter_type, \".iend0\");\n   TREE_ADDRESSABLE (istart0) = 1;\n   TREE_ADDRESSABLE (iend0) = 1;\n-  if (gimple_in_ssa_p (cfun))\n+  if (gimple_referenced_vars (cfun))\n     {\n       add_referenced_var (istart0);\n       add_referenced_var (iend0);\n@@ -3793,7 +3794,7 @@ expand_omp_for_generic (struct omp_region *region,\n \t    counts[i] = t;\n \t  else\n \t    {\n-\t      counts[i] = create_tmp_var (type, \".count\");\n+\t      counts[i] = make_rename_temp (type, \".count\");\n \t      t = force_gimple_operand_gsi (&gsi, t, false, NULL_TREE,\n \t\t\t\t\t    true, GSI_SAME_STMT);\n \t      stmt = gimple_build_assign (counts[i], t);\n@@ -3918,8 +3919,7 @@ expand_omp_for_generic (struct omp_region *region,\n \t\t\t\t   false, GSI_CONTINUE_LINKING);\n   if (fd->collapse > 1)\n     {\n-      tree tem = create_tmp_var (type, \".tem\");\n-\n+      tree tem = make_rename_temp (type, \".tem\");\n       stmt = gimple_build_assign (tem, fd->loop.v);\n       gsi_insert_after (&gsi, stmt, GSI_CONTINUE_LINKING);\n       for (i = fd->collapse - 1; i >= 0; i--)\n@@ -4207,12 +4207,12 @@ expand_omp_for_static_nochunk (struct omp_region *region,\n   t = fold_convert (itype, t);\n   n = force_gimple_operand_gsi (&gsi, t, true, NULL_TREE, true, GSI_SAME_STMT);\n \n-  q = create_tmp_var (itype, \"q\");\n+  q = make_rename_temp (itype, \"q\");\n   t = fold_build2 (TRUNC_DIV_EXPR, itype, n, nthreads);\n   t = force_gimple_operand_gsi (&gsi, t, false, NULL_TREE, true, GSI_SAME_STMT);\n   gsi_insert_before (&gsi, gimple_build_assign (q, t), GSI_SAME_STMT);\n \n-  tt = create_tmp_var (itype, \"tt\");\n+  tt = make_rename_temp (itype, \"tt\");\n   t = fold_build2 (TRUNC_MOD_EXPR, itype, n, nthreads);\n   t = force_gimple_operand_gsi (&gsi, t, false, NULL_TREE, true, GSI_SAME_STMT);\n   gsi_insert_before (&gsi, gimple_build_assign (tt, t), GSI_SAME_STMT);\n@@ -4433,7 +4433,7 @@ expand_omp_for_static_chunk (struct omp_region *region, struct omp_for_data *fd)\n   n = force_gimple_operand_gsi (&si, t, true, NULL_TREE,\n \t\t\t\ttrue, GSI_SAME_STMT);\n \n-  trip_var = create_tmp_var (itype, \".trip\");\n+  trip_var = create_tmp_reg (itype, \".trip\");\n   if (gimple_in_ssa_p (cfun))\n     {\n       add_referenced_var (trip_var);\n@@ -4679,7 +4679,8 @@ expand_omp_for (struct omp_region *region)\n \t\t\t      (enum built_in_function) next_ix);\n     }\n \n-  update_ssa (TODO_update_ssa_only_virtuals);\n+  if (gimple_in_ssa_p (cfun))\n+    update_ssa (TODO_update_ssa_only_virtuals);\n }\n \n \n@@ -5281,8 +5282,8 @@ expand_omp_atomic_pipeline (basic_block load_bb, basic_block store_bb,\n     {\n       tree iaddr_val;\n \n-      iaddr = create_tmp_var (build_pointer_type_for_mode (itype, ptr_mode,\n-\t\t\t\t\t\t\t   true), NULL);\n+      iaddr = make_rename_temp (build_pointer_type_for_mode (itype, ptr_mode,\n+\t\t\t\t\t\t\t     true), NULL);\n       iaddr_val\n \t= force_gimple_operand_gsi (&si,\n \t\t\t\t    fold_convert (TREE_TYPE (iaddr), addr),"}, {"sha": "6944fc76e8d8708f379403706eae803cb3293350", "filename": "gcc/tree-dfa.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a5efada73be7bab935ae04116f480584467768dc/gcc%2Ftree-dfa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a5efada73be7bab935ae04116f480584467768dc/gcc%2Ftree-dfa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-dfa.c?ref=a5efada73be7bab935ae04116f480584467768dc", "patch": "@@ -198,10 +198,9 @@ make_rename_temp (tree type, const char *prefix)\n   tree t = create_tmp_reg (type, prefix);\n \n   if (gimple_referenced_vars (cfun))\n-    {\n-      add_referenced_var (t);\n-      mark_sym_for_renaming (t);\n-    }\n+    add_referenced_var (t);\n+  if (gimple_in_ssa_p (cfun))\n+    mark_sym_for_renaming (t);\n \n   return t;\n }"}]}