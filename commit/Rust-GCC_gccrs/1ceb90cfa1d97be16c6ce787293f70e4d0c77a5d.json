{"sha": "1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWNlYjkwY2ZhMWQ5N2JlMTZjNmNlNzg3MjkzZjcwZTRkMGM3N2E1ZA==", "commit": {"author": {"name": "Petur Runolfsson", "email": "peturr02@ru.is", "date": "2003-01-23T22:53:35Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2003-01-23T22:53:35Z"}, "message": "re PR libstdc++/9322 (return value of basic_streambuf<>::getloc affected by locale::global)\n\n\n2003-01-23  Petur Runolfsson  <peturr02@ru.is>\n\n\tPR libstdc++/9322\n\t* include/std/std_streambuf.h\n\t(basic_streambuf::basic_streambuf,\n\tbasic_streambuf::~basic_streambuf,\n\tbasic_streambuf::getloc, basic_streambuf::imbue):\n\tRemove _M_buf_locale_init use.\n\t* include/bits/fstream.tcc (basic_filebuf::imbue):  Likewise\n\t* testsuite/27_io/filebuf_virtuals.cc (test08):  Add.\n\t* testsuite/27_io/streambuf_members.cc (test08):  Add.\n\t* testsuite/27_io/stringbuf_virtuals.cc (test08):  Add.\n\nFrom-SVN: r61678", "tree": {"sha": "6e6f05ca3780e30c6e94fb8dcc7556a942ff45de", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6e6f05ca3780e30c6e94fb8dcc7556a942ff45de"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/comments", "author": null, "committer": null, "parents": [{"sha": "806e09354fd41e8783964a2403ac57b25ef8a64e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/806e09354fd41e8783964a2403ac57b25ef8a64e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/806e09354fd41e8783964a2403ac57b25ef8a64e"}], "stats": {"total": 114, "additions": 90, "deletions": 24}, "files": [{"sha": "bda8f070798803591fa96e4681d980a3c294c8b3", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "patch": "@@ -1,3 +1,16 @@\n+2003-01-23  Petur Runolfsson  <peturr02@ru.is>\n+\n+\tPR libstdc++/9322\n+\t* include/std/std_streambuf.h\n+\t(basic_streambuf::basic_streambuf,\n+\tbasic_streambuf::~basic_streambuf,\n+\tbasic_streambuf::getloc, basic_streambuf::imbue):\n+\tRemove _M_buf_locale_init\n+\t* include/bits/fstream.tcc (basic_filebuf::imbue):  Likewise\n+\t* testsuite/27_io/filebuf_virtuals.cc (test08):  Add.\n+\t* testsuite/27_io/streambuf_members.cc (test08):  Add.\n+\t* testsuite/27_io/stringbuf_virtuals.cc (test08):  Add.\n+\n 2003-01-23  Benjamin Kosnik  <bkoz@redhat.com>\n \n \tRevert include ordering."}, {"sha": "bf1c42e8ce2247a4b3d8195764d7caaa908655cc", "filename": "libstdc++-v3/include/bits/fstream.tcc", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffstream.tcc?ref=1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "patch": "@@ -477,10 +477,7 @@ namespace std\n       bool __testbeg = gptr() == eback() && pptr() == pbase();\n \n       if (__testbeg && this->_M_buf_locale != __loc)\n-\t{\n-\t  this->_M_buf_locale = __loc;\n-\t  this->_M_buf_locale_init = true;\n-\t}\n+\tthis->_M_buf_locale = __loc;\n \n       // NB this may require the reconversion of previously\n       // converted chars. This in turn may cause the reconstruction"}, {"sha": "e7dca92d00bc72d5b3b31ebaaf9a1988f8870c41", "filename": "libstdc++-v3/include/std/std_streambuf.h", "status": "modified", "additions": 3, "deletions": 17, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstd_streambuf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstd_streambuf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstd_streambuf.h?ref=1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "patch": "@@ -1,6 +1,6 @@\n // Stream buffer classes -*- C++ -*-\n \n-// Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002\n+// Copyright (C) 1997, 1998, 1999, 2000, 2001, 2002, 2003\n // Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n@@ -224,13 +224,6 @@ namespace std\n       */\n       locale \t\t\t_M_buf_locale;\t\n \n-      /**\n-       *  @if maint\n-       *  True iff locale is initialized.\n-       *  @endif\n-      */\n-      bool \t\t\t_M_buf_locale_init;\n-\n       //@{\n       /**\n        *  @if maint\n@@ -364,7 +357,6 @@ namespace std\n \t_M_buf_size = 0;\n \t_M_buf_size_opt = 0;\n \t_M_mode = ios_base::openmode(0);\n-\t_M_buf_locale_init = false;\n       }\n \n       // [27.5.2.2.1] locales\n@@ -393,12 +385,7 @@ namespace std\n       */\n       locale   \n       getloc() const\n-      {\n-\tif (_M_buf_locale_init)\n-\t  return _M_buf_locale; \n-\telse \n-\t  return locale();\n-      } \n+      { return _M_buf_locale; } \n \n       // [27.5.2.2.2] buffer management and positioning\n       //@{\n@@ -584,7 +571,7 @@ namespace std\n       _M_buf_unified(false), _M_in_beg(0), _M_in_cur(0), _M_in_end(0), \n       _M_out_beg(0), _M_out_cur(0), _M_out_end(0), \n       _M_mode(ios_base::openmode(0)), _M_buf_locale(locale()), \n-      _M_buf_locale_init(false), _M_pback_cur_save(0), _M_pback_end_save(0), \n+      _M_pback_cur_save(0), _M_pback_end_save(0), \n       _M_pback_init(false)\n       { }\n \n@@ -700,7 +687,6 @@ namespace std\n       virtual void \n       imbue(const locale& __loc) \n       { \n-\t_M_buf_locale_init = true;\n \tif (_M_buf_locale != __loc)\n \t  _M_buf_locale = __loc;\n       }"}, {"sha": "c02e1a77be90b16a6f6678e2a661d834ecfb1b43", "filename": "libstdc++-v3/testsuite/27_io/filebuf_virtuals.cc", "status": "modified", "additions": 25, "deletions": 1, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilebuf_virtuals.cc?ref=1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "patch": "@@ -1,6 +1,6 @@\n // 2001-05-21 Benjamin Kosnik  <bkoz@redhat.com>\n \n-// Copyright (C) 2001, 2002 Free Software Foundation, Inc.\n+// Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -21,6 +21,7 @@\n // 27.8.1.4 Overridden virtual functions\n \n #include <fstream>\n+#include <locale>\n #include <testsuite_hooks.h>\n \n // @require@ %-*.tst %-*.txt\n@@ -514,6 +515,28 @@ void test06()\n   VERIFY( buffer[0] == 'a' );\n }\n \n+// libstdc++/9322\n+void test07()\n+{\n+  using std::locale;\n+  bool test = true;\n+\n+  locale loc;\n+  std::filebuf ob;\n+  VERIFY( ob.getloc() == loc );\n+\n+  locale::global(locale(\"en_US\"));\n+  VERIFY( ob.getloc() == loc );\n+\n+  locale loc_de (\"de_DE\");\n+  locale ret = ob.pubimbue(loc_de);\n+  VERIFY( ob.getloc() == loc_de );\n+  VERIFY( ret == loc );\n+\n+  locale::global(loc);\n+  VERIFY( ob.getloc() == loc_de );\n+}\n+\n main() \n {\n   test01();\n@@ -524,5 +547,6 @@ main()\n   test05();\n   test06();\n \n+  test07();\n   return 0;\n }"}, {"sha": "aaad07dc47ff7a07e633c06041f3e4c360633780", "filename": "libstdc++-v3/testsuite/27_io/streambuf_members.cc", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fstreambuf_members.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fstreambuf_members.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fstreambuf_members.cc?ref=1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "patch": "@@ -1,6 +1,6 @@\n // 1999-10-11 bkoz\n \n-// Copyright (C) 1999, 2000, 2001, 2002 Free Software Foundation, Inc.\n+// Copyright (C) 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -364,6 +364,28 @@ test07()\n   VERIFY(out.good());\n }\n \n+// libstdc++/9322\n+void test08()\n+{\n+  using std::locale;\n+  bool test = true;\n+\n+  locale loc;\n+  testbuf2 ob;\n+  VERIFY( ob.getloc() == loc );\n+\n+  locale::global(locale(\"en_US\"));\n+  VERIFY( ob.getloc() == loc );\n+\n+  locale loc_de (\"de_DE\");\n+  locale ret = ob.pubimbue(loc_de);\n+  VERIFY( ob.getloc() == loc_de );\n+  VERIFY( ret == loc );\n+\n+  locale::global(loc);\n+  VERIFY( ob.getloc() == loc_de );\n+}\n+\n int main() \n {\n   test01();\n@@ -374,5 +396,6 @@ int main()\n   test05();\n \n   test07();\n+  test08();\n   return 0;\n }"}, {"sha": "8a6add9dfc596e0aaee70fa7c73a329d4212235b", "filename": "libstdc++-v3/testsuite/27_io/stringbuf_virtuals.cc", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fstringbuf_virtuals.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fstringbuf_virtuals.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Fstringbuf_virtuals.cc?ref=1ceb90cfa1d97be16c6ce787293f70e4d0c77a5d", "patch": "@@ -1,6 +1,6 @@\n // 2001-05-21 Benjamin Kosnik  <bkoz@redhat.com>\n \n-// Copyright (C) 2001, 2002 Free Software Foundation, Inc.\n+// Copyright (C) 2001, 2002, 2003 Free Software Foundation, Inc.\n //\n // This file is part of the GNU ISO C++ Library.  This library is free\n // software; you can redistribute it and/or modify it under the\n@@ -70,6 +70,28 @@ void test02(std::stringbuf& in, bool pass)\n   VERIFY( p == bad );\n }\n \n+// libstdc++/9322\n+void test08()\n+{\n+  using std::locale;\n+  bool test = true;\n+\n+  locale loc;\n+  std::stringbuf ob;\n+  VERIFY( ob.getloc() == loc );\n+\n+  locale::global(locale(\"en_US\"));\n+  VERIFY( ob.getloc() == loc );\n+\n+  locale loc_de (\"de_DE\");\n+  locale ret = ob.pubimbue(loc_de);\n+  VERIFY( ob.getloc() == loc_de );\n+  VERIFY( ret == loc );\n+\n+  locale::global(loc);\n+  VERIFY( ob.getloc() == loc_de );\n+}\n+\n int main() \n {\n   using namespace std;\n@@ -83,5 +105,6 @@ int main()\n   test02(in2, false);\n   test02(in3, false);\n \n+  test08();\n   return 0;\n }"}]}