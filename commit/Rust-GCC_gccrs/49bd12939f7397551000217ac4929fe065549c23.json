{"sha": "49bd12939f7397551000217ac4929fe065549c23", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDliZDEyOTM5ZjczOTc1NTEwMDAyMTdhYzQ5MjlmZTA2NTU0OWMyMw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2015-04-13T08:44:56Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2015-04-13T08:44:56Z"}, "message": "gcc_release: Fix up thinko in the last commit, improve error message.\n\n\t* gcc_release: Fix up thinko in the last commit, improve error\n\tmessage.  Commit all ChangeLog, DEV-PHASE and BASE-VER changes\n\ttogether, rather than doing dozens of separate commits.\n\nFrom-SVN: r222042", "tree": {"sha": "5ce8cdcfb17a8e1543eff30ce718f863c232286d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5ce8cdcfb17a8e1543eff30ce718f863c232286d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/49bd12939f7397551000217ac4929fe065549c23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49bd12939f7397551000217ac4929fe065549c23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49bd12939f7397551000217ac4929fe065549c23", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49bd12939f7397551000217ac4929fe065549c23/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4fa6a2a079c62225d5a282b0876f741528dd646d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fa6a2a079c62225d5a282b0876f741528dd646d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4fa6a2a079c62225d5a282b0876f741528dd646d"}], "stats": {"total": 38, "additions": 24, "deletions": 14}, "files": [{"sha": "2f7e2271586b7115e8f00ff66c369005e1448f2f", "filename": "maintainer-scripts/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/49bd12939f7397551000217ac4929fe065549c23/maintainer-scripts%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/49bd12939f7397551000217ac4929fe065549c23/maintainer-scripts%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/maintainer-scripts%2FChangeLog?ref=49bd12939f7397551000217ac4929fe065549c23", "patch": "@@ -1,3 +1,9 @@\n+2015-04-13  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc_release: Fix up thinko in the last commit, improve error\n+\tmessage.  Commit all ChangeLog, DEV-PHASE and BASE-VER changes\n+\ttogether, rather than doing dozens of separate commits.\n+\n 2015-04-12  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc_release: For RELEASE_MAJOR 5+ only use the major"}, {"sha": "639b2559aec327740458bb099e5af6755781498f", "filename": "maintainer-scripts/gcc_release", "status": "modified", "additions": 18, "deletions": 14, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/49bd12939f7397551000217ac4929fe065549c23/maintainer-scripts%2Fgcc_release", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/49bd12939f7397551000217ac4929fe065549c23/maintainer-scripts%2Fgcc_release", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/maintainer-scripts%2Fgcc_release?ref=49bd12939f7397551000217ac4929fe065549c23", "patch": "@@ -109,45 +109,49 @@ build_sources() {\n \n     ${SVN} -q co \"${SVNROOT}/${SVNBRANCH}\" \"`basename ${SOURCE_DIRECTORY}`\" ||\\\n            error \"Could not check out release sources\"\n-    for x in `find ${SOURCE_DIRECTORY} -name ChangeLog`; do\n+    svnciargs=\"\"\n+    for x in `changedir ${SOURCE_DIRECTORY} && \\\n+\t      find . -name ChangeLog`; do\n       # Update this ChangeLog file only if it does not yet contain the\n       # entry we are going to add.  (This is a safety net for repeated\n       # runs of this script for the same release.)\n-      if ! grep \"GCC ${RELEASE} released.\" ${x} > /dev/null ; then       \n-        cat - ${x} > ${x}.new <<EOF\n+      if ! grep \"GCC ${RELEASE} released.\" ${SOURCE_DIRECTORY}/${x} > /dev/null ; then       \n+\tcat - ${SOURCE_DIRECTORY}/${x} > ${SOURCE_DIRECTORY}/${x}.new <<EOF\n ${LONG_DATE}  Release Manager\n \n \t* GCC ${RELEASE} released.\n \n EOF\n-        mv ${x}.new ${x} || \\\n-            error \"Could not update ${x}\"\n-        (changedir `dirname ${x}` && \\\n-            ${SVN} -q ci -m 'Mark ChangeLog' `basename ${x}`) || \\\n-            error \"Could not commit ${x}\"\n+\tmv ${SOURCE_DIRECTORY}/${x}.new ${SOURCE_DIRECTORY}/${x} \\\n+\t  || error \"Could not update ${x}\"\n+\tsvnciargs=\"${svnciargs} ${x}\"\n       fi\n     done\n \n     # Update gcc/DEV-PHASE.\n \n-    if [ `cat ${SOURCE_DIRECTORY}/gcc/BASE-VER` = ${RELEASE} ]; then\n+    if [ `cat ${SOURCE_DIRECTORY}/gcc/BASE-VER` != ${RELEASE} ]; then\n       [ ${RELEASE_MAJOR} -lt 5 ] && \\\n \terror \"Release number ${RELEASE} does not match BASE-VER\"\n       if [ `cat ${SOURCE_DIRECTORY}/gcc/BASE-VER` \\\n \t   = ${RELEASE_MAJOR}.`expr ${RELEASE_MINOR} - 1`.1 \\\n \t   -a x${RELEASE_REVISION} = x0 ]; then\n \t(changedir ${SOURCE_DIRECTORY}/gcc && \\\n-\t echo ${RELEASE} > BASE-VER && \\\n-\t ${SVN} -q ci -m 'Bump release' BASE-VER) || \\\n+\t echo ${RELEASE} > BASE-VER) || \\\n \terror \"Could not update BASE-VER\"\n+\tsvnciargs=\"${svnciargs} gcc/BASE-VER\"\n       else\n-\terror \"Release number ${RELEASE} does not match BASE-VER\"\n+\terror \"Release number ${RELEASE} does not immediately follow BASE-VER\"\n       fi\n     fi\n     (changedir ${SOURCE_DIRECTORY}/gcc && \\\n-     : > DEV-PHASE && \\\n-     ${SVN} -q ci -m 'Mark as release' DEV-PHASE) || \\\n+     : > DEV-PHASE) || \\\n     error \"Could not update DEV-PHASE\"\n+    svnciargs=\"${svnciargs} gcc/DEV-PHASE\"\n+\n+    (changedir ${SOURCE_DIRECTORY} && \\\n+     ${SVN} -q ci -m 'Update ChangeLog and version files for release' ${svnciargs}) || \\\n+    error \"Could not commit ChangeLog and version file updates\"\n \n     # Make sure we tag the sources for a final release.\n     TAG=\"tags/gcc_`echo ${RELEASE} | tr . _`_release\""}]}