{"sha": "d04e6ed5ae7668dc8a68069cd456d278c59fd972", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDA0ZTZlZDVhZTc2NjhkYzhhNjgwNjljZDQ1NmQyNzhjNTlmZDk3Mg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-03-09T12:13:55Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-03-09T12:13:55Z"}, "message": "[PR c++/84733] ICE in check-local-shadow\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-03/msg00425.html\n\tPR c++/84733\n\t* name-lookup.c (do_pushdecl_with_scope): Only clear\n\tcurrent_function_decl when pushing a non-class (i.e. namespace)\n\tscope.\n\nFrom-SVN: r258383", "tree": {"sha": "e0926d3f76b09c3b20bde7e7cfce55282fdfca45", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e0926d3f76b09c3b20bde7e7cfce55282fdfca45"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d04e6ed5ae7668dc8a68069cd456d278c59fd972", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d04e6ed5ae7668dc8a68069cd456d278c59fd972", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d04e6ed5ae7668dc8a68069cd456d278c59fd972", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d04e6ed5ae7668dc8a68069cd456d278c59fd972/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "77a5c1b62dad78448fedb355a22be81adf5892f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/77a5c1b62dad78448fedb355a22be81adf5892f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/77a5c1b62dad78448fedb355a22be81adf5892f7"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "eeaf71d445e5a677f0ea6259d529a72504461efd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d04e6ed5ae7668dc8a68069cd456d278c59fd972/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d04e6ed5ae7668dc8a68069cd456d278c59fd972/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d04e6ed5ae7668dc8a68069cd456d278c59fd972", "patch": "@@ -1,3 +1,10 @@\n+2018-03-09  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/84733\n+\t* name-lookup.c (do_pushdecl_with_scope): Only clear\n+\tcurrent_function_decl when pushing a non-class (i.e. namespace)\n+\tscope.\n+\n 2018-03-08  Jason Merrill  <jason@redhat.com>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "80a92ab0ac4874109eaaf0c02b6ae386d669c776", "filename": "gcc/cp/name-lookup.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d04e6ed5ae7668dc8a68069cd456d278c59fd972/gcc%2Fcp%2Fname-lookup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d04e6ed5ae7668dc8a68069cd456d278c59fd972/gcc%2Fcp%2Fname-lookup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fname-lookup.c?ref=d04e6ed5ae7668dc8a68069cd456d278c59fd972", "patch": "@@ -3965,9 +3965,7 @@ static tree\n do_pushdecl_with_scope (tree x, cp_binding_level *level, bool is_friend)\n {\n   cp_binding_level *b;\n-  tree function_decl = current_function_decl;\n \n-  current_function_decl = NULL_TREE;\n   if (level->kind == sk_class)\n     {\n       b = class_binding_level;\n@@ -3977,12 +3975,15 @@ do_pushdecl_with_scope (tree x, cp_binding_level *level, bool is_friend)\n     }\n   else\n     {\n+      tree function_decl = current_function_decl;\n+      if (level->kind == sk_namespace)\n+\tcurrent_function_decl = NULL_TREE;\n       b = current_binding_level;\n       current_binding_level = level;\n       x = pushdecl (x, is_friend);\n       current_binding_level = b;\n+      current_function_decl = function_decl;\n     }\n-  current_function_decl = function_decl;\n   return x;\n }\n "}]}