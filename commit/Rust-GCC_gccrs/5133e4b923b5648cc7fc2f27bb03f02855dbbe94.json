{"sha": "5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTEzM2U0YjkyM2I1NjQ4Y2M3ZmMyZjI3YmIwM2YwMjg1NWRiYmU5NA==", "commit": {"author": {"name": "Thomas Koenig", "email": "Thomas.Koenig@online.de", "date": "2005-07-12T19:52:19Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2005-07-12T19:52:19Z"}, "message": "io/unix.c: Add member special_file to type unix_stream.\n\n2005-07-12  Thomas Koenig  <Thomas.Koenig@online.de>\n\n\tio/unix.c:  Add member special_file to type unix_stream.\n\t(fd_truncate):  Don't call ftruncate or chsize if\n\ts refers to a special file.\n\t(fd_to_stream):  initialize s->special_file.\n\n2005-07-12  Thomas Koenig  <Thomas.Koenig@online.de>\n\n\tgfortran.dg/dev_null.f90:  Remove targets.\n\nFrom-SVN: r101937", "tree": {"sha": "da374bb9ec1399b596949ba90944c887ee748ce6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/da374bb9ec1399b596949ba90944c887ee748ce6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/comments", "author": null, "committer": null, "parents": [{"sha": "04be5ce5ec84b1dab39372f89d59888988a3195e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04be5ce5ec84b1dab39372f89d59888988a3195e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04be5ce5ec84b1dab39372f89d59888988a3195e"}], "stats": {"total": 25, "additions": 20, "deletions": 5}, "files": [{"sha": "8cead7dc3d6507373097de07afdb52421822d38a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "patch": "@@ -1,3 +1,7 @@\n+2005-07-11  Thomas Koenig  <Thomas.Koenig@online.de>\n+\n+\tgfortran.dg/dev_null.f90:  Remove targets.\n+\n 2005-07-12  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \tPR tree-opt/22335"}, {"sha": "c8db001fa1c217d9fa2db0c0d776ac5fa6374709", "filename": "gcc/testsuite/gfortran.dg/dev_null.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/gcc%2Ftestsuite%2Fgfortran.dg%2Fdev_null.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/gcc%2Ftestsuite%2Fgfortran.dg%2Fdev_null.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdev_null.f90?ref=5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "patch": "@@ -1,4 +1,4 @@\n-! { dg-do run { target *-*-linux* *-*-solaris* } }\n+! { dg-do run }\n ! This test currently only runs on systems where using ftruncate on\n !   /dev/null fails (errno set to EINVAL). See PR 21593 for details.\n !"}, {"sha": "e96c422bc3ba9ab6f790fa8a421ffb8408023653", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "patch": "@@ -1,3 +1,10 @@\n+2005-07-12  Thomas Koenig  <Thomas.Koenig@online.de>\n+\n+\tio/unix.c:  Add member special_file to type unix_stream.\n+\t(fd_truncate):  Don't call ftruncate or chsize if\n+\ts refers to a special file.\n+\t(fd_to_stream):  initialize s->special_file.\n+\n 2005-07-11  David Edelsohn  <edelsohn@gnu.org>\n \n         PR libgfortran/22412"}, {"sha": "b35182d61696d89c9fde77a466762e9d9f4669a9", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5133e4b923b5648cc7fc2f27bb03f02855dbbe94/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=5133e4b923b5648cc7fc2f27bb03f02855dbbe94", "patch": "@@ -138,6 +138,8 @@ typedef struct\n   int prot;\n   int ndirty;\t\t\t/* Dirty bytes starting at dirty_offset */\n \n+  int special_file;\t\t/* =1 if the fd refers to a special file */\n+\n   unsigned unbuffered:1, mmaped:1;\n \n   char small_buffer[BUFFER_SIZE];\n@@ -509,13 +511,14 @@ fd_truncate (unix_stream * s)\n     return FAILURE;\n \n   /* non-seekable files, like terminals and fifo's fail the lseek.\n-     the fd is a regular file at this point */\n-\n+     Using ftruncate on a seekable special file (like /dev/null)\n+     is undefined, so we treat it as if the ftruncate failed.\n+  */\n #ifdef HAVE_FTRUNCATE\n-  if (ftruncate (s->fd, s->logical_offset))\n+  if (s->special_file || ftruncate (s->fd, s->logical_offset))\n #else\n #ifdef HAVE_CHSIZE\n-  if (chsize (s->fd, s->logical_offset))\n+  if (s->special_file || chsize (s->fd, s->logical_offset))\n #endif\n #endif\n     {\n@@ -915,6 +918,7 @@ fd_to_stream (int fd, int prot, int avoid_mmap)\n \n   fstat (fd, &statbuf);\n   s->file_length = S_ISREG (statbuf.st_mode) ? statbuf.st_size : -1;\n+  s->special_file = !S_ISREG (statbuf.st_mode);\n \n #if HAVE_MMAP\n   if (avoid_mmap)"}]}