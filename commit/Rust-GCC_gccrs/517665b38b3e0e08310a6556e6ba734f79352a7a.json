{"sha": "517665b38b3e0e08310a6556e6ba734f79352a7a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTE3NjY1YjM4YjNlMGUwODMxMGE2NTU2ZTZiYTczNGY3OTM1MmE3YQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2015-06-29T23:23:10Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2015-06-29T23:23:10Z"}, "message": "nvptx.md (nvptx_reorg_subreg): New fn, broken out of ...\n\n\t* config/nvptx/nvptx.md (nvptx_reorg_subreg): New fn, broken out of ...\n\t(nvptx_reorg): Here.  Keep the non-subreg pieces.\n\nFrom-SVN: r225154", "tree": {"sha": "83f36160f250583112fc7d3f297197b4e5b12755", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/83f36160f250583112fc7d3f297197b4e5b12755"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/517665b38b3e0e08310a6556e6ba734f79352a7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/517665b38b3e0e08310a6556e6ba734f79352a7a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/517665b38b3e0e08310a6556e6ba734f79352a7a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/517665b38b3e0e08310a6556e6ba734f79352a7a/comments", "author": null, "committer": null, "parents": [{"sha": "71506d4107f7cf3eef78bb9fa9743b7765e43fd9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/71506d4107f7cf3eef78bb9fa9743b7765e43fd9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/71506d4107f7cf3eef78bb9fa9743b7765e43fd9"}], "stats": {"total": 51, "additions": 39, "deletions": 12}, "files": [{"sha": "fc4a4424645ca1ef344d5eab8e82cf25efae9983", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/517665b38b3e0e08310a6556e6ba734f79352a7a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/517665b38b3e0e08310a6556e6ba734f79352a7a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=517665b38b3e0e08310a6556e6ba734f79352a7a", "patch": "@@ -1,3 +1,8 @@\n+2015-06-29  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* config/nvptx/nvptx.md (nvptx_reorg_subreg): New fn, broken out of ...\n+\t(nvptx_reorg): Here.  Keep the non-subreg pieces.\n+\n 2015-06-29  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/gnu-user.h (GNU_USER_TARGET_ENDFILE_SPEC): Use"}, {"sha": "3d6315a76b02e83af699baf2a357385e5dd52187", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 34, "deletions": 12, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/517665b38b3e0e08310a6556e6ba734f79352a7a/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/517665b38b3e0e08310a6556e6ba734f79352a7a/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=517665b38b3e0e08310a6556e6ba734f79352a7a", "patch": "@@ -1,3 +1,4 @@\n+\n /* Target code for NVPTX.\n    Copyright (C) 2014-2015 Free Software Foundation, Inc.\n    Contributed by Bernd Schmidt <bernds@codesourcery.com>\n@@ -1877,20 +1878,11 @@ get_replacement (struct reg_replace *r)\n    conversion copyin/copyout instructions.  */\n \n static void\n-nvptx_reorg (void)\n+nvptx_reorg_subreg (void)\n {\n   struct reg_replace qiregs, hiregs, siregs, diregs;\n   rtx_insn *insn, *next;\n \n-  /* We are freeing block_for_insn in the toplev to keep compatibility\n-     with old MDEP_REORGS that are not CFG based.  Recompute it now.  */\n-  compute_bb_for_insn ();\n-\n-  df_clear_flags (DF_LR_RUN_DCE);\n-  df_analyze ();\n-\n-  thread_prologue_and_epilogue_insns ();\n-\n   qiregs.n_allocated = 0;\n   hiregs.n_allocated = 0;\n   siregs.n_allocated = 0;\n@@ -1966,14 +1958,44 @@ nvptx_reorg (void)\n \t  validate_change (insn, recog_data.operand_loc[i], new_reg, false);\n \t}\n     }\n+}\n \n-  int maxregs = max_reg_num ();\n+/* PTX-specific reorganization\n+   1) mark now-unused registers, so function begin doesn't declare\n+   unused registers.\n+   2) replace subregs with suitable sequences.\n+*/\n+\n+static void\n+nvptx_reorg (void)\n+{\n+  struct reg_replace qiregs, hiregs, siregs, diregs;\n+  rtx_insn *insn, *next;\n+\n+  /* We are freeing block_for_insn in the toplev to keep compatibility\n+     with old MDEP_REORGS that are not CFG based.  Recompute it now.  */\n+  compute_bb_for_insn ();\n+\n+  thread_prologue_and_epilogue_insns ();\n+\n+  df_clear_flags (DF_LR_RUN_DCE);\n+  df_set_flags (DF_NO_INSN_RESCAN | DF_NO_HARD_REGS);\n+  df_analyze ();\n   regstat_init_n_sets_and_refs ();\n \n-  for (int i = LAST_VIRTUAL_REGISTER + 1; i < maxregs; i++)\n+  int max_regs = max_reg_num ();\n+\n+  /* Mark unused regs as unused.  */\n+  for (int i = LAST_VIRTUAL_REGISTER + 1; i < max_regs; i++)\n     if (REG_N_SETS (i) == 0 && REG_N_REFS (i) == 0)\n       regno_reg_rtx[i] = const0_rtx;\n+\n+  /* Replace subregs.  */\n+  nvptx_reorg_subreg (max_regs);\n+\n   regstat_free_n_sets_and_refs ();\n+\n+  df_finish_pass (true);\n }\n \f\n /* Handle a \"kernel\" attribute; arguments as in"}]}