{"sha": "3c488e6c8675f069c94567107f777f693671f7ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2M0ODhlNmM4Njc1ZjA2OWM5NDU2NzEwN2Y3NzdmNjkzNjcxZjdlZA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2019-08-21T08:30:58Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2019-08-21T08:30:58Z"}, "message": "[Ada] More complete information level for -gnatR4 output\n\nThis instructs -gnatR4 to also list the Etype of components in\nuser-declared record types if it is compiler-generated, for example in:\n\npackage P3 is\n\n    type idx is range 1 .. 100;\n\n    type Arr is array (Idx range <>) of Character;\n\n    type Rec is record\n       C : Arr (1 .. 5);\n    end record;\n\nend P3;\n\n2019-08-21  Eric Botcazou  <ebotcazou@adacore.com>\n\ngcc/ada/\n\n\t* repinfo.adb (List_Array_Info): In -gnatR4 mode, set the\n\trelevant flag on the component type here instead of...\n\t(List_Object_Info): Likewise for the object type.\n\t(List_Entities): ...here.  In -gnatR4 mode, recurse into\n\tentities local to a record type.\n\t(List_Component_Layout): In -gnatR4 mode, mark the type as\n\trelevant.\n\nFrom-SVN: r274786", "tree": {"sha": "59df0d123d5e527c37e3c3a5cd6c253c2057b68f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/59df0d123d5e527c37e3c3a5cd6c253c2057b68f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3c488e6c8675f069c94567107f777f693671f7ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c488e6c8675f069c94567107f777f693671f7ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c488e6c8675f069c94567107f777f693671f7ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c488e6c8675f069c94567107f777f693671f7ed/comments", "author": null, "committer": null, "parents": [{"sha": "abdeafa67a8ec7c99830fd5039d38168abba52a9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/abdeafa67a8ec7c99830fd5039d38168abba52a9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/abdeafa67a8ec7c99830fd5039d38168abba52a9"}], "stats": {"total": 52, "additions": 36, "deletions": 16}, "files": [{"sha": "a6508ae4ec1bb7ab59fe2709fc1992f9ae1f465d", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c488e6c8675f069c94567107f777f693671f7ed/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c488e6c8675f069c94567107f777f693671f7ed/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3c488e6c8675f069c94567107f777f693671f7ed", "patch": "@@ -1,3 +1,13 @@\n+2019-08-21  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* repinfo.adb (List_Array_Info): In -gnatR4 mode, set the\n+\trelevant flag on the component type here instead of...\n+\t(List_Object_Info): Likewise for the object type.\n+\t(List_Entities): ...here.  In -gnatR4 mode, recurse into\n+\tentities local to a record type.\n+\t(List_Component_Layout): In -gnatR4 mode, mark the type as\n+\trelevant.\n+\n 2019-08-21  Bob Duff  <duff@adacore.com>\n \n \t* Makefile.rtl (GNATRTL_NONTASKING_OBJS): Add s-bitutil.o and"}, {"sha": "219fa3be26f032d00d5cb0222b67443d9c142b72", "filename": "gcc/ada/repinfo.adb", "status": "modified", "additions": 26, "deletions": 16, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3c488e6c8675f069c94567107f777f693671f7ed/gcc%2Fada%2Frepinfo.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3c488e6c8675f069c94567107f777f693671f7ed/gcc%2Fada%2Frepinfo.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frepinfo.adb?ref=3c488e6c8675f069c94567107f777f693671f7ed", "patch": "@@ -357,6 +357,14 @@ package body Repinfo is\n          Write_Eol;\n          Write_Line (\"}\");\n       end if;\n+\n+      --  The component type is relevant for an array\n+\n+      if List_Representation_Info = 4\n+        and then Is_Itype (Component_Type (Base_Type (Ent)))\n+      then\n+         Relevant_Entities.Set (Component_Type (Base_Type (Ent)), True);\n+      end if;\n    end List_Array_Info;\n \n    ---------------------------\n@@ -539,20 +547,17 @@ package body Repinfo is\n                      List_Record_Info (E, Bytes_Big_Endian);\n                   end if;\n \n+                  --  Recurse into entities local to a record type\n+\n+                  if List_Representation_Info = 4 then\n+                     List_Entities (E, Bytes_Big_Endian, False);\n+                  end if;\n+\n                elsif Is_Array_Type (E) then\n                   if List_Representation_Info >= 1 then\n                      List_Array_Info (E, Bytes_Big_Endian);\n                   end if;\n \n-                  --  The component type is relevant for an array\n-\n-                  if List_Representation_Info = 4\n-                    and then Is_Itype (Component_Type (Base_Type (E)))\n-                  then\n-                     Relevant_Entities.Set\n-                       (Component_Type (Base_Type (E)), True);\n-                  end if;\n-\n                elsif Is_Type (E) then\n                   if List_Representation_Info >= 2 then\n                      List_Type_Info (E);\n@@ -564,13 +569,6 @@ package body Repinfo is\n                                   E_Loop_Parameter,\n                                   E_Variable)\n                then\n-                  --  The type is relevant for an object\n-\n-                  if List_Representation_Info = 4 and then Is_Itype (Etype (E))\n-                  then\n-                     Relevant_Entities.Set (Etype (E), True);\n-                  end if;\n-\n                   if List_Representation_Info >= 2 then\n                      List_Object_Info (E);\n                   end if;\n@@ -975,6 +973,12 @@ package body Repinfo is\n \n          List_Linker_Section (Ent);\n       end if;\n+\n+      --  The type is relevant for an object\n+\n+      if List_Representation_Info = 4 and then Is_Itype (Etype (Ent)) then\n+         Relevant_Entities.Set (Etype (Ent), True);\n+      end if;\n    end List_Object_Info;\n \n    ----------------------\n@@ -1283,6 +1287,12 @@ package body Repinfo is\n          else\n             Write_Line (\";\");\n          end if;\n+\n+         --  The type is relevant for a component\n+\n+         if List_Representation_Info = 4 and then Is_Itype (Etype (Ent)) then\n+            Relevant_Entities.Set (Etype (Ent), True);\n+         end if;\n       end List_Component_Layout;\n \n       ------------------------"}]}