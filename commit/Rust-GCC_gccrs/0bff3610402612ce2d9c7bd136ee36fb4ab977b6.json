{"sha": "0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGJmZjM2MTA0MDI2MTJjZTJkOWM3YmQxMzZlZTM2ZmI0YWI5NzdiNg==", "commit": {"author": {"name": "Paulo Matos", "email": "pmatos@broadcom.com", "date": "2013-10-21T15:41:46Z"}, "committer": {"name": "Paulo Matos", "email": "pmatos@gcc.gnu.org", "date": "2013-10-21T15:41:46Z"}, "message": "ipa-inline.c (edge_badness): Cap edge->count at max_count for badness calculations.\n\n\t* ipa-inline.c (edge_badness): Cap edge->count at max_count for badness\n\tcalculations.\n\nFrom-SVN: r203897", "tree": {"sha": "2a9fd481e9c8fd018520bd4852cf18ab8bae6b08", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a9fd481e9c8fd018520bd4852cf18ab8bae6b08"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bff3610402612ce2d9c7bd136ee36fb4ab977b6/comments", "author": null, "committer": null, "parents": [{"sha": "b5c4ff7888a8fc17c0ce047f539548dacf2c8f8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5c4ff7888a8fc17c0ce047f539548dacf2c8f8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5c4ff7888a8fc17c0ce047f539548dacf2c8f8d"}], "stats": {"total": 19, "additions": 13, "deletions": 6}, "files": [{"sha": "06a31ad3cd26cd2c3e478a1a923ae494c9975dc1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bff3610402612ce2d9c7bd136ee36fb4ab977b6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bff3610402612ce2d9c7bd136ee36fb4ab977b6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "patch": "@@ -1,3 +1,8 @@\n+2013-10-21  Paulo Matos  <pmatos@broadcom.com>\n+\n+\t* ipa-inline.c (edge_badness): Cap edge->count at max_count for badness\n+\tcalculations.\n+\n 2013-10-21  Jeff Law  <law@redhat.com>\n \n \t* tree-ssa-threadedge.c (thread_through_normal_block): New argument VISITED."}, {"sha": "26c410ba39c7c178cfc7940d9317b5fbb1987077", "filename": "gcc/ipa-inline.c", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0bff3610402612ce2d9c7bd136ee36fb4ab977b6/gcc%2Fipa-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0bff3610402612ce2d9c7bd136ee36fb4ab977b6/gcc%2Fipa-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-inline.c?ref=0bff3610402612ce2d9c7bd136ee36fb4ab977b6", "patch": "@@ -903,12 +903,16 @@ edge_badness (struct cgraph_edge *edge, bool dump)\n     {\n       sreal tmp, relbenefit_real, growth_real;\n       int relbenefit = relative_time_benefit (callee_info, edge, edge_time);\n+      /* Capping edge->count to max_count. edge->count can be larger than\n+\t max_count if an inline adds new edges which increase max_count\n+\t after max_count is computed.  */\n+      int edge_count = edge->count > max_count ? max_count : edge->count;\n \n       sreal_init (&relbenefit_real, relbenefit, 0);\n       sreal_init (&growth_real, growth, 0);\n \n       /* relative_edge_count.  */\n-      sreal_init (&tmp, edge->count, 0);\n+      sreal_init (&tmp, edge_count, 0);\n       sreal_div (&tmp, &tmp, &max_count_real);\n \n       /* relative_time_benefit.  */\n@@ -921,16 +925,14 @@ edge_badness (struct cgraph_edge *edge, bool dump)\n \n       badness = -1 * sreal_to_int (&tmp);\n  \n-      /* Be sure that insanity of the profile won't lead to increasing counts\n-\t in the scalling and thus to overflow in the computation above.  */\n-      gcc_assert (max_count >= edge->count);\n       if (dump)\n \t{\n \t  fprintf (dump_file,\n-\t\t   \"      %i (relative %f): profile info. Relative count %f\"\n+\t\t   \"      %i (relative %f): profile info. Relative count %f%s\"\n \t\t   \" * Relative benefit %f\\n\",\n \t\t   (int) badness, (double) badness / INT_MIN,\n-\t\t   (double) edge->count / max_count,\n+\t\t   (double) edge_count / max_count,\n+\t\t   edge->count > max_count ? \" (capped to max_count)\" : \"\",\n \t\t   relbenefit * 100.0 / RELATIVE_TIME_BENEFIT_RANGE);\n \t}\n     }"}]}