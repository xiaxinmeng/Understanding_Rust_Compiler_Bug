{"sha": "16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTY1NzBjMTJjOTFkYzI1YmVhYzJmOTZjZjhiOWQ5YjVjY2QzY2VmMw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-12-14T11:19:07Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-12-14T11:19:07Z"}, "message": "re PR ipa/92357 (ICE in IPA pass fnsummary in openmp offload)\n\n\tPR ipa/92357\n\t* ipa-fnsummary.c (ipa_fn_summary_write): Use\n\tlto_symtab_encoder_iterator with lsei_start_function_in_partition and\n\tlsei_next_function_in_partition instead of walking all cgraph nodes\n\tin encoder.\n\nFrom-SVN: r279395", "tree": {"sha": "f55691f6fe8eecfde229f1a2058529d442c1fe80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f55691f6fe8eecfde229f1a2058529d442c1fe80"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "813b70a17b0cf8056b3005c3cdb882d522e02d84", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/813b70a17b0cf8056b3005c3cdb882d522e02d84", "html_url": "https://github.com/Rust-GCC/gccrs/commit/813b70a17b0cf8056b3005c3cdb882d522e02d84"}], "stats": {"total": 24, "additions": 15, "deletions": 9}, "files": [{"sha": "a8d4a8192bd0d75573bd607d74daca283b780e38", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3", "patch": "@@ -1,5 +1,11 @@\n 2019-12-14  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR ipa/92357\n+\t* ipa-fnsummary.c (ipa_fn_summary_write): Use\n+\tlto_symtab_encoder_iterator with lsei_start_function_in_partition and\n+\tlsei_next_function_in_partition instead of walking all cgraph nodes\n+\tin encoder.\n+\n \tPR tree-optimization/92930\n \t* ipa-pure-const.c (special_builtin_state): Don't handle\n \tBUILT_IN_APPLY.  Formatting fixes."}, {"sha": "a54703fb34775a8e1b8dce30f801fd790dd94ce2", "filename": "gcc/ipa-fnsummary.c", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3/gcc%2Fipa-fnsummary.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3/gcc%2Fipa-fnsummary.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-fnsummary.c?ref=16570c12c91dc25beac2f96cf8b9d9b5ccd3cef3", "patch": "@@ -4364,24 +4364,24 @@ static void\n ipa_fn_summary_write (void)\n {\n   struct output_block *ob = create_output_block (LTO_section_ipa_fn_summary);\n+  lto_symtab_encoder_iterator lsei;\n   lto_symtab_encoder_t encoder = ob->decl_state->symtab_node_encoder;\n   unsigned int count = 0;\n-  int i;\n \n-  for (i = 0; i < lto_symtab_encoder_size (encoder); i++)\n+  for (lsei = lsei_start_function_in_partition (encoder); !lsei_end_p (lsei);\n+       lsei_next_function_in_partition (&lsei))\n     {\n-      symtab_node *snode = lto_symtab_encoder_deref (encoder, i);\n-      cgraph_node *cnode = dyn_cast <cgraph_node *> (snode);\n-      if (cnode && cnode->definition && !cnode->alias)\n+      cgraph_node *cnode = lsei_cgraph_node (lsei);\n+      if (cnode->definition && !cnode->alias)\n \tcount++;\n     }\n   streamer_write_uhwi (ob, count);\n \n-  for (i = 0; i < lto_symtab_encoder_size (encoder); i++)\n+  for (lsei = lsei_start_function_in_partition (encoder); !lsei_end_p (lsei);\n+       lsei_next_function_in_partition (&lsei))\n     {\n-      symtab_node *snode = lto_symtab_encoder_deref (encoder, i);\n-      cgraph_node *cnode = dyn_cast <cgraph_node *> (snode);\n-      if (cnode && cnode->definition && !cnode->alias)\n+      cgraph_node *cnode = lsei_cgraph_node (lsei);\n+      if (cnode->definition && !cnode->alias)\n \t{\n \t  class ipa_fn_summary *info = ipa_fn_summaries->get (cnode);\n \t  class ipa_size_summary *size_info = ipa_size_summaries->get (cnode);"}]}