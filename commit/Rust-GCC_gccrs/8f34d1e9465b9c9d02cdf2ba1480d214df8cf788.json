{"sha": "8f34d1e9465b9c9d02cdf2ba1480d214df8cf788", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGYzNGQxZTk0NjViOWM5ZDAyY2RmMmJhMTQ4MGQyMTRkZjhjZjc4OA==", "commit": {"author": {"name": "Bruce Korb", "email": "korbb@gcc.gnu.org", "date": "1999-03-31T12:02:19Z"}, "committer": {"name": "Bruce Korb", "email": "korbb@gcc.gnu.org", "date": "1999-03-31T12:02:19Z"}, "message": "added spaces to ensure correct shell syntax.\n\nAdded test to ensure '//' comments were not deleted inside strings\nAdded the missing c_asm.h fix\n\nFrom-SVN: r26087", "tree": {"sha": "ec5dd1528661e0c69a4dd5c14737800ee44786c6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ec5dd1528661e0c69a4dd5c14737800ee44786c6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f34d1e9465b9c9d02cdf2ba1480d214df8cf788", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f34d1e9465b9c9d02cdf2ba1480d214df8cf788", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f34d1e9465b9c9d02cdf2ba1480d214df8cf788", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f34d1e9465b9c9d02cdf2ba1480d214df8cf788/comments", "author": null, "committer": null, "parents": [{"sha": "7d9ccd90ff6f18f17f8b99722a3a53bc276be48c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d9ccd90ff6f18f17f8b99722a3a53bc276be48c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d9ccd90ff6f18f17f8b99722a3a53bc276be48c"}], "stats": {"total": 323, "additions": 156, "deletions": 167}, "files": [{"sha": "f8bddd63255649d23378728d1a6f3d48e7f94914", "filename": "gcc/fixinc/inclhack.def", "status": "modified", "additions": 156, "deletions": 167, "changes": 323, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f34d1e9465b9c9d02cdf2ba1480d214df8cf788/gcc%2Ffixinc%2Finclhack.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f34d1e9465b9c9d02cdf2ba1480d214df8cf788/gcc%2Ffixinc%2Finclhack.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffixinc%2Finclhack.def?ref=8f34d1e9465b9c9d02cdf2ba1480d214df8cf788", "patch": "@@ -48,12 +48,7 @@ fix = {\n \n \n /* \n- * Determine if we're on Interactive Unix 2.2 or later, in which case we\n- * need to fix some additional files.  This is the same test for ISC that\n- * Autoconf uses.  On Interactive 2.2, certain traditional Unix\n- * definitions (notably getc and putc in stdio.h) are omitted if __STDC__\n- * is defined, not just if _POSIX_SOURCE is defined.  This makes it\n- * impossible to compile any nontrivial program except with -posix.\n+ * Remove erroneous parentheses in sym.h on Alpha OSF/1.\n  */\n fix = {\n     hackname = alpha_parens;\n@@ -114,6 +109,7 @@ fix = {\n /*\n  *  For C++, avoid any typedef or macro definition of bool,\n  *  and use the built in type instead.\n+ *  HP/UX 10.20 also has it in curses_colr/curses.h.\n  */\n fix = {\n     hackname = avoid_bool;\n@@ -136,25 +132,6 @@ fix = {\n };\n \n \n-/*\n- *  rpc/types.h on OSF1/2.0 is not C++ ready, even though NO_IMPLICIT_EXTERN_C\n- *  is defined for the alpha.  The problem is the declaration of malloc.\n- */\n-fix = {\n-    hackname = bad_malloc_decl;\n-    files    = rpc/types.h;\n-    bypass   = '\"C\"';\n-    sed      = \"1i\\\\\\n\"\n-               \"#ifdef __cplusplus\\\\\\n\"\n-               \"extern \\\"C\\\" {\\\\\\n\"\n-               \"#endif\\\\\\n\\n\";\n-    sed      = \"$a\\\\\\n\"\n-               \"#ifdef __cplusplus\\\\\\n\"\n-               \"}\\\\\\n\"\n-               \"#endif\\n\";\n-};\n-\n-\n /*\n  *  Fix `typedef struct term;' on hppa1.1-hp-hpux9.\n  */\n@@ -252,7 +229,22 @@ fix = {\n     sed = \"/#[ \\t]*define[ \\t]*[ \\t]BSD43__IO/\" 's/\\'\\([cgx]\\)\\'/\\1/g';\n };\n \n-#IFDEF no_more\n+\n+/*\n+ *  Fix <c_asm.h> on Digital UNIX V4.0:\n+ *  It contains a prototype for a DEC C internal asm() function,\n+ *  clashing with gcc's asm keyword.  So protect this with __DECC.\n+ */\n+fix = {\n+    hackname = dec_intern_asm;\n+    files    = c_asm.h;\n+    sed = \"/^[ \\t]*float[ \\t]*fasm/i\\n#ifdef __DECC\\n\";\n+    sed = \"/^[ \\t]*#[ \\t]*pragma[ \\t]*intrinsic([ \\t]*dasm/a\\n\"\n+          \"#endif\\n\";\n+};\n+\n+\n+#ifdef no_more\n /*\n  *  And also with the HP-UX 10 and HP-UX 11 sys/pci.h file\n  */\n@@ -304,8 +296,8 @@ fix = {\n /*\n  *  Remove the double-slash comments\n  *  They *must* be removed so it will not create nested comments!!\n- *  However, they will *not* be removed if '++' is in any part of\n- *  the file name, or if the name ends with \".hh\" or \".H\".\n+ *  However, they will *not* be removed if the file name ends with\n+ *  any of \"++\", \".hh\" or \".H\", or if the file name contains \"cxx/\".\n  *\n  *  There *used* to be a number of similar problems in various OSes:\n \n@@ -320,27 +312,27 @@ fix = {\n  *  There is a similar problem with the VxWorks drv/netif/if_med.h file.\n \n  *  And also with the HP-UX 10 and HP-UX 11 sys/pci.h file\n- */\n-fix = {\n-    hackname = no_double_slash;\n-    test     = '-z \"`echo ${file}|egrep \\'++$|\\.hh$|\\.H$\\'`\"';\n-    select = '//[^*]';\n-    sed    = '/\\/\\/[^*]/' \"s|//.*$||g\";\n-};\n \n+ *  Now that we delete the // comments instead of converting them to / * * /,\n+ *  traditional hacks like irix_bogus_cxx_cmnt, no longer work (which\n+ *  strangely enough was also used on alpha-dec-osf4.0d).  If we skip the\n+ *  hack whenever we see ``\"//\"'', then the need for the secondary hack\n+ *  disappears.  Note: it is painful to ensure that the first quote\n+ *  exists, so we just check for the trailing quote directly abutting\n+ *  the //.  Note: We should never touch a line that has // completely\n+ *  within quotes but this is somewhat hard to check for.\n \n-/*\n- *  Multiline comment after typedef on IRIX 4.0.1.\n+ *  Ultimately, this fix ought to go inside of C code where\n+ *  we can do a better analysis on the need and method for fixing.\n  */\n fix = {\n-    hackname = irix_bogus_cxx_cmnt;\n-    files  = \"elf_abi.h\";\n-    files  = \"elf.h\";\n+    hackname = no_double_slash;\n     /*\n-     *  This really looks like it is replacing \"/ * * /\" with \"//\"\n-     *  Shouldn't the replacement really be \" ## \"?\n+     *  Test that the file-to-fix does not look like a C++ file\n      */\n-    sed      = 's@\"/\\*\"\\*/@\"//\"@';\n+    test     = '-z \"`echo ${file}|egrep \\'cxx/|++$|\\.hh$|\\.H$\\'`\"';\n+    select = '//[^\"*]';\n+    sed    = '/\\/\\/[^\"*]/' \"s|//.*$||g\";\n };\n \n \n@@ -444,10 +436,14 @@ fix = {\n /*\n  *  sys/mman.h on HP/UX is not C++ ready,\n  *  even though NO_IMPLICIT_EXTERN_C is defined on HP/UX.\n+ *\n+ *  rpc/types.h on OSF1/2.0 is not C++ ready, even though NO_IMPLICIT_EXTERN_C\n+ *  is defined for the alpha.  The problem is the declaration of malloc.\n  */\n fix = {\n-    hackname = hpux_cxx_unready;\n+    hackname = cxx_unready;\n     files    = sys/mman.h;\n+    files    = rpc/types.h;\n     bypass = '\"C\"|__BEGIN_DECLS';\n \n     sed      = \"1i\\\\\\n\"\n@@ -487,13 +483,18 @@ fix = {\n \n \n /*\n- *  Fix various _IO* defines, but do *not* quote the characters cgxtf.\n+ *  Determine if we're on Interactive Unix 2.2 or later, in which case we\n+ *  need to fix some additional files.  This is the same test for ISC that\n+ *  Autoconf uses.  On Interactive 2.2, certain traditional Unix\n+ *  definitions (notably getc and putc in stdio.h) are omitted if __STDC__\n+ *  is defined, not just if _POSIX_SOURCE is defined.  This makes it\n+ *  impossible to compile any nontrivial program except with -posix.\n  */\n fix = {\n     hackname = interactv_add1;\n \n-    test   = \"-d /etc/conf/kconfig.d\";\n-    test   = '-n \"`grep _POSIX_VERSION /usr/include/sys/unistd.h`\"';\n+    test   = \" -d /etc/conf/kconfig.d\";\n+    test   = ' -n \"`grep _POSIX_VERSION /usr/include/sys/unistd.h`\"';\n \n     files  = \"stdio.h\";\n     files  = \"math.h\";\n@@ -509,8 +510,8 @@ fix = {\n fix = {\n     hackname = interactv_add2;\n \n-    test   = \"-d /etc/conf/kconfig.d\";\n-    test   = '-n \"`grep _POSIX_VERSION /usr/include/sys/unistd.h`\"';\n+    test   = \" -d /etc/conf/kconfig.d\";\n+    test   = ' -n \"`grep _POSIX_VERSION /usr/include/sys/unistd.h`\"';\n \n     files  = math.h;\n     sed    = \"s/fmod(double)/fmod(double, double)/\";\n@@ -519,8 +520,8 @@ fix = {\n fix = {\n     hackname = interactv_add3;\n \n-    test   = \"-d /etc/conf/kconfig.d\";\n-    test   = '-n \"`grep _POSIX_VERSION /usr/include/sys/unistd.h`\"';\n+    test   = \" -d /etc/conf/kconfig.d\";\n+    test   = ' -n \"`grep _POSIX_VERSION /usr/include/sys/unistd.h`\"';\n \n     files  = sys/limits.h;\n \n@@ -530,14 +531,13 @@ fix = {\n \n \n /*\n- *  Remove erroneous parentheses in sym.h on Alpha OSF/1.\n+ *  Fix various _IO* defines, but do *not* quote the characters cgxtf.\n  */\n fix = {\n     hackname = io_def_quotes;\n-    select = \"[ \\t]_IO[A-Z]*[ \\t]*\\\\([A-Za-z]\";\n-    sed = \"s/\\\\([ \\t]_IO[A-Z]*[ \\t]*(\\\\)\\\\([A-Za-z]\\\\),/\\\\1'\\\\2',/\";\n-    sed = \"/#[ \\t]*define[ \\t]*[ \\t]_IO/\"\n-              \"s/'\\\\([cgxtf]\\\\)'/\\\\1/g\";\n+    select = \"[ \\t](_|DES)IO[A-Z]*[ \\t]*\\\\( *[^,']\";\n+    sed = \"s/\\\\([ \\t](_|DES)IO[A-Z]*[ \\t]*(\\\\)\\\\([^,']\\\\),/\\\\1'\\\\2',/\";\n+    sed = \"/#[ \\t]*define[ \\t]*[ \\t]_IO/\"       \"s/'\\\\([cgxtf]\\\\)'/\\\\1/g\";\n     sed = \"/#[ \\t]*define[ \\t]*[ \\t]DESIOC/\"    's/\\'\\([cdgx]\\)\\'/\\1/g';\n };\n \n@@ -629,6 +629,7 @@ fix = {\n  */\n fix = {\n     hackname = motorola_nested;\n+    mach     = \"m68k-motorola-sysv*\";\n     files    = limits.h;\n     files    = sys/limits.h;\n     sed = \"s@^\\\\(#undef[ \\t][ \\t]*PIPE_BUF[ \\t]*\"\n@@ -675,7 +676,7 @@ fix = {\n     files  = \"Xm.acorn/XmP.h\";\n     files  = bsd43/bsd43_.h;\n     select = '/\\*\\*/';\n-    sed    = 's|/\\*\\*/| ## |g';\n+    sed    = 's|/\\*\\*/|##|g';\n };\n \n \n@@ -727,13 +728,16 @@ fix = {\n fix = {\n     hackname = lynxos_fcntl_proto;\n     files    = fcntl.h;\n-\n-  sed = 's/\\(fcntl.*(int, int, \\)int)/\\1...)/';\n+    select   = 'fcntl.*\\(int, int, int\\)';\n+    sed      = 's/\\(fcntl.*(int, int, \\)int)/\\1...)/';\n };\n \n \n /*\n- *  Fix incorrect S_IF* definitions on m88k-sysv3.\n+ *  libm.a on m88k-motorola-sysv3 contains a stupid optimization for\n+ *  function hypot(), which returns the second argument without even\n+ *  looking at its value, if the other is 0.0.  Another drawback is\n+ *  that fix-header doesn't fix fabs' prototype, and I have no idea why.\n  */\n fix = {\n     hackname = m88k_bad_hypot_opt;\n@@ -760,11 +764,8 @@ fix = {\n \n \n /*\n- *  Fix non-ansi machine name defines\n- *  This is split into two parts:  the shell version as a single\n- *  patch, and the program version with each patch separate.\n- *  Each is substantially faster for the particular environment.\n- * You have a dual maintenance problem here.  */\n+ *  Fix incorrect S_IF* definitions on m88k-sysv3.\n+ */\n fix = {\n     hackname = m88k_bad_s_if;\n     mach     = \"m88k-*-sysv3*\";\n@@ -793,19 +794,19 @@ fix = {\n     shell    =\n       \"echo Fixing $file, to protect against multiple inclusion. >&2\n       cpp_wrapper=`echo $file | sed -e 's,\\\\.,_,g' -e 's,/,_,g'`\n-      sed -e \\\"1i\\\\\\n\"\n-        \"#ifndef __GCC_GOT_${cpp_wrapper}_\\\\\\n\"\n-        \"#define __GCC_GOT_${cpp_wrapper}_\\\\\\n\\\" \\\\\\n\"\n-                \"\\t-e \\\"$a\\\\\\n\"\n-        \"#endif /* ! __GCC_GOT_${cpp_wrapper}_ */\\n\\\"\";\n+      echo \\\"#ifndef __GCC_GOT_${cpp_wrapper}_\\\"\n+      echo \\\"#define __GCC_GOT_${cpp_wrapper}_\\\"\n+      cat\n+      echo \\\"#endif /* ! __GCC_GOT_${cpp_wrapper}_ */\\\"\";\n };\n \n \n /*\n- *  libm.a on m88k-motorola-sysv3 contains a stupid optimization for\n- *  function hypot(), which returns the second argument without even\n- *  looking at its value if the other is 0.0 Another drawback is that\n- *  fix-header doesn't fix fabs' prototype, and I have no idea why.\n+ *  Fix non-ansi machine name defines\n+ *  This is split into two parts:  the shell version as a single\n+ *  patch, and the program version with each patch separate.\n+ *  Each is substantially faster for the particular environment.\n+ *  You have a dual maintenance problem here.\n  */\n fix = {\n     hackname = machine_name;\n@@ -932,51 +933,36 @@ fix = {\n fix = {\n     hackname = math_gcc_ifndefs;\n     files    = math.h;\n-    shell    = \" dbl_max_def=\"\n-        \"\\\"`egrep 'define[ \\t]+DBL_MAX[ \\t]+.*' ${SRCDIR}/float.h \"\n-                \"2>/dev/null`\\\"\\n\\n\"\n \n-        \"\\tif ( test -n \\\"${dbl_max_def}\\\" \\\\\\n\"\n-        \"\\t\\t-a -n \\\"`egrep '#define[ \\t]*HUGE_VAL[ \\t]+DBL_MAX' $file`\\\" \\\\\\n\"\n-        \"\\t\\t-a -z \\\"`egrep '#define[ \\t]+DBL_MAX[ \\t]+' $file`\\\"\\n\"\n-              \"\\t   ) > /dev/null 2>&1\\n\"\n+    shell    =\n+    /*\n+     *  First see if we have a definition for DBL_MAX in float.h\n+     *  If we do, we will replace the one in math.h with that one.\n+     */\n \n-        \"\\tthen sed -e '/define[ \\t]HUGE_VAL[ \\t]/i\\\\\\n\"\n-            \"#ifndef HUGE_VAL\\n' \\\\\\n\"\n-        \"\\t-e '/define[ \\t]HUGE_VAL[ \\t]/a\\\\\\n#endif\\n'\\\\\\n\"\n-        \"\\t-e \\\"/define[ \\t]HUGE_VAL[ \\t]DBL_MAX/s/DBL_MAX/$dbl_max_def/\\\"\\n\"\n+    /*\n+     *  IF we have such a define *and* HUGE_VAL is defined to be DBL_MAX\n+     *     *and* DBL_MAX is _not_ defined in the current file (math.h),\n+     *  THEN replace the defined value of HUGE_VAL\n+     *  ELSE just copy stdin to stdout so the main filter can process it\n+     */\n \n-        \"\\telse sed -e '/define[ \\t]HUGE_VAL[ \\t]/i\\\\\\n\"\n-            \"#ifndef HUGE_VAL\\n' \\\\\\n\"\n-        \"\\t-e '/define[ \\t]HUGE_VAL[ \\t]/a\\\\\\n#endif\\n'\\n\"\n-        \"\\tfi\";\n-};\n+    /*\n+     *  Put conditional guards around the HUGE_VAL definition.\n+     */\n \n+    \"\\tdbl_max_def=`egrep 'define[ \\t]+DBL_MAX[ \\t]+.*' float.h \"\n+                \"2>/dev/null`\\n\\n\"\n \n-/*\n- * libm.a on m88k-motorola-sysv3 contains a stupid optimization for\n- * function hypot(), which returns the second argument without even\n- * looking at its value\n- */\n-fix = {\n-    hackname = motorola_stupid_opt;\n-    mach     = \"m88k-motorola-sysv3*\";\n-    files    = math.h;\n-    select   = \"^extern double hypot();$\";\n-    sed      =\n-          '/^extern double hypot();$/a' \"\\\\\\n\"\n-          '\\/* Workaround a stupid Motorola optimization if one' \"\\\\\\n\"\n-          '   of x or y is 0.0 and the other is negative!  *\\/' \"\\\\\\n\"\n-          '#ifdef __STDC__' \"\\\\\\n\"\n-          'static __inline__ double fake_hypot (double x, double y)' \"\\\\\\n\"\n-          '#else' \"\\\\\\n\"\n-          'static __inline__ double fake_hypot (x, y)' \"\\\\\\n\"\n-          \"\\tdouble x, y;\\\\\\n\"\n-          '#endif' \"\\\\\\n\"\n-          '{' \"\\\\\\n\"\n-          \"\\treturn fabs (hypot (x, y));\\\\\\n\"\n-          '}' \"\\\\\\n\"\n-          \"#define hypot\\tfake_hypot\\n\";\n+    \"\\tif ( test -n \\\"${dbl_max_def}\\\" \\\\\\n\"\n+    \"\\t\\t-a -n \\\"`egrep '#define[ \\t]*HUGE_VAL[ \\t]+DBL_MAX' $file`\\\" \\\\\\n\"\n+    \"\\t\\t-a -z \\\"`egrep '#define[ \\t]+DBL_MAX[ \\t]+' $file`\\\"\\n\"\n+             \"\\t   ) > /dev/null 2>&1\\n\"\n+    \"\\tthen sed -e '/define[ \\t]HUGE_VAL[ \\t]DBL_MAX/s/DBL_MAX/$dbl_max_def/'\"\n+    \"\\n\\telse cat ; fi |\\n\"\n+\n+    \"\\tsed -e'/define[ \\t]HUGE_VAL[ \\t]/i\\\\\\n#ifndef HUGE_VAL\\n' \"\n+          \"-e'/define[ \\t]HUGE_VAL[ \\t]/a\\\\\\n#endif\\n'\";\n };\n \n \n@@ -1087,10 +1073,10 @@ fix = {\n     hackname = osf_namespace_a;\n     files    = reg_types.h;\n     files    = sys/lc_core.h;\n-    test     =    \"-r reg_types.h\"\n-               \"-a -r sys/lc_core.h\"\n-               \"-a -n \\\"`grep '} regex_t;' reg_types.h`\\\"\"\n-               \"-a -z \\\"`grep __regex_t regex.h`\\\"\";\n+    test     = \" -r reg_types.h\";\n+    test     = \" -r sys/lc_core.h\";\n+    test     = \" -n \\\"`grep '} regex_t;' reg_types.h`\\\"\";\n+    test     = \" -z \\\"`grep __regex_t regex.h`\\\"\";\n \n     sed      = \"s/regex_t/__regex_t/g\";\n     sed      = \"s/regoff_t/__regoff_t/g\";\n@@ -1100,10 +1086,11 @@ fix = {\n fix = {\n     hackname = osf_namespace_b;\n     files    = regex.h;\n-    test     =    \"-r reg_types.h\"\n-               \"-a -r sys/lc_core.h\"\n-               \"-a -n \\\"`grep '} regex_t;' reg_types.h`\\\"\"\n-               \"-a -z \\\"`grep __regex_t regex.h`\\\"\";\n+    test     = \" -r reg_types.h\";\n+    test     = \" -r sys/lc_core.h\";\n+    test     = \" -n \\\"`grep '} regex_t;' reg_types.h`\\\"\";\n+    test     = \" -z \\\"`grep __regex_t regex.h`\\\"\";\n+\n     sed      = \"/#include <reg_types.h>/a\\\\\\n\"\n                \"typedef __regex_t\\tregex_t;\\\\\\n\"\n                \"typedef __regoff_t\\tregoff_t;\\\\\\n\"\n@@ -1182,8 +1169,8 @@ fix = {\n fix = {\n     hackname = sony_ctype;\n     files    = ctype.h;\n-    test     = \"-x /bin/sony\";\n-    test     = \"! -z \\\"`if /bin/sony ; then echo true ; fi`\\\"\";\n+    test     = \" -x /bin/sony\";\n+    test     = \" ! -z \\\"`if /bin/sony ; then echo true ; fi`\\\"\";\n     sed      = \"s/__ctype/_ctype/g\";\n };\n #endif\n@@ -1206,8 +1193,8 @@ fix = {\n fix = {\n     hackname = sony_stdio;\n     files    = stdio.h;\n-    test     = \"-x /bin/sony\";\n-    test     = \"! -z \\\"`if /bin/sony ; then echo true ; fi`\\\"\";\n+    test     = \" -x /bin/sony\";\n+    test     = \" ! -z \\\"`if /bin/sony ; then echo true ; fi`\\\"\";\n     sed      = \"s/__filbuf/_filbuf/g\\n\"\n                \"s/__flsbuf/_flsbuf/g\\n\"\n                \"s/__iob/_iob/g\";\n@@ -1446,21 +1433,6 @@ fix = {\n };\n \n \n-/*\n- *  This file on SunOS 4 has a very large macro.  When the sed loop\n- *  tries pull it in, it overflows the pattern space size of the SunOS\n- *  sed (GNU sed does not have this problem).  Since the file does not\n- *  require fixing, we remove it from the fixed directory.\n- */\n-fix = {\n-    hackname = sunos_large_macro;\n-    files    = sundev/ipi_error.h;\n-    shell    =\n-        \"echo \\\"Removing incorrect fix to SunOS <sundev/ipi_error.h>\\\" >&2\\n\"\n-         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\ncat > /dev/null\";\n-};\n-\n-\n /*\n  *  math.h on SunOS 4 puts the declaration of matherr before the definition\n  *  of struct exception, so the prototype (added by fixproto) causes havoc.\n@@ -1469,14 +1441,10 @@ fix = {\n     hackname = sunos_matherr_decl;\n     files    = math.h;\n     /*\n-     *  Find the first occurrance of 'struct exception'.\n-     *  If it is the definition, then the file is okay.\n-     *  If it is a usage, then the order is wrong and we\n-     *  must insert a forward reference.\n+     *  Once a declaration for 'struct exception' is found,\n+     *  stop trying to insert a forward reference for it.\n      */\n-    test = \"\\\"`fgrep 'struct exception' $file | line`\\\"\"\n-                  \" != 'struct exception {'\";\n-\n+    sed = \"/^struct exception/,$b\";\n     sed = \"/matherr/i\\\\\\nstruct exception;\\n\";\n };\n \n@@ -1927,14 +1895,13 @@ fix = {\n \n \n /*\n- *  Replace definitions of size_t, ptrdiff_t and wchar_t\n- *  Install the proper definition of the three standard types\n- *  in header files that they come from.\n+ *  Fix return type of exit and abort in <stdlib.h> on SunOS 4.1.\n+ *  Also wrap protection around size_t for m88k-sysv3 systems.\n  */\n fix = {\n     hackname = sysz_stdlib_for_sun;\n-    mach     = \"*-sun-*\";\n-    mach     = \"m88k-*-sysv3*\";\n+    mach     = \"*-sun*\";\n+    mach     = \"m88k-*sysv3*\";\n     files    = stdlib.h;\n \n     sed   = \"s/int\\tabort/void\\tabort/g\";\n@@ -2193,9 +2160,9 @@ fix = {\n fix = {\n     hackname = vxworks_needs_vxworks;\n     files    = sys/stat.h;\n-    test     = \"-r types/vxTypesOld.h\";\n-    test     = \"-n \\\"`fgrep '#include' $file`\\\"\";\n-    test     = \"-n \\\"`fgrep ULONG $file`\\\"\";\n+    test     = \" -r types/vxTypesOld.h\";\n+    test     = \" -n \\\"`egrep '#include' $file`\\\"\";\n+    test     = \" -n \\\"`egrep ULONG $file`\\\"\";\n     select   = \"#[ \\t]define[ \\t][ \\t]*__INCstath\";\n \n     sed = \"/#[ \\t]define[ \\t][ \\t]*__INCstath/a\\\\\\n\"\n@@ -2210,7 +2177,7 @@ fix = {\n     hackname = vxworks_time;\n     files    = time.h;\n     select   = \"VOIDFUNCPTR\";\n-    test     = \"-r vxWorks.h\";\n+    test     = \" -r vxWorks.h\";\n     sed      = \"/VOIDFUNCPTR/i\\\\\\n\"\n                \"#ifndef __gcc_VOIDFUNCPTR_defined\\\\\\n\"\n                \"#ifdef __cplusplus\\\\\\n\"\n@@ -2294,8 +2261,9 @@ fix = {\n     files    = sys/ki_iface.h;\n     select   = 'These definitions are for HP Internal developers';\n     shell    =\n-        \"echo \\\"Removing incorrect fix to HP-UX <$file>\\\" >&2\\n\"\n-         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\ncat > /dev/null\";\n+         \"echo \\\"Removing incorrect fix to <$file>\\\" >&2\\n\"\n+         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\n\"\n+         \"cat > /dev/null\";\n };\n \n \n@@ -2307,8 +2275,9 @@ fix = {\n     files    = sys/ki.h;\n     select   = '11.00 HP-UX LP64';\n     shell    =\n-        \"echo \\\"Removing incorrect fix to HP-UX <$file>\\\" >&2\\n\"\n-         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\ncat > /dev/null\";\n+         \"echo \\\"Removing incorrect fix to <$file>\\\" >&2\\n\"\n+         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\n\"\n+         \"cat > /dev/null\";\n };\n \n \n@@ -2320,8 +2289,9 @@ fix = {\n     files    = sys/ki_calls.h;\n     select   = 'KI_MAX_PROCS is an arbitrary number';\n     shell    =\n-        \"echo \\\"Removing incorrect fix to HP-UX <$file>\\\" >&2\\n\"\n-         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\ncat > /dev/null\";\n+         \"echo \\\"Removing incorrect fix to <$file>\\\" >&2\\n\"\n+         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\n\"\n+         \"cat > /dev/null\";\n };\n \n \n@@ -2333,8 +2303,26 @@ fix = {\n     files    = sys/ki_defs.h;\n     select   = 'Kernel Instrumentation Definitions';\n     shell    =\n-        \"echo \\\"Removing incorrect fix to HP-UX <$file>\\\" >&2\\n\"\n-         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\ncat > /dev/null\";\n+         \"echo \\\"Removing incorrect fix to <$file>\\\" >&2\\n\"\n+         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\n\"\n+         \"cat > /dev/null\";\n+};\n+\n+\n+/*\n+ *  This file on SunOS 4 has a very large macro.  When the sed loop\n+ *  tries pull it in, it overflows the pattern space size of the SunOS\n+ *  sed (GNU sed does not have this problem).  Since the file does not\n+ *  require fixing, we remove it from the fixed directory.\n+ */\n+fix = {\n+    hackname = zzz_bad_fixes;\n+    files    = sundev/ipi_error.h;\n+    /* shouldn't there be a select expression here??? */\n+    shell    =\n+         \"echo \\\"Removing incorrect fix to <$file>\\\" >&2\\n\"\n+         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\n\"\n+         \"cat > /dev/null\";\n };\n \n \n@@ -2346,8 +2334,9 @@ fix = {\n     files    = sys/time.h;\n     select   = 'For CASPEC, look in';\n     shell    =\n-        \"echo \\\"Removing incorrect fix to HP-UX <$file>\\\" >&2\\n\"\n-         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\ncat > /dev/null\";\n+         \"echo \\\"Removing incorrect fix to <$file>\\\" >&2\\n\"\n+         \"rm -f ${DESTDIR}/$file ${DESTDIR}/$file.\\n\"\n+         \"cat > /dev/null\";\n };\n \n "}]}