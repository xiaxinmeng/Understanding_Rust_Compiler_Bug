{"sha": "ebd06e5ca705e69711eb58277b6f820132bb7b67", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWJkMDZlNWNhNzA1ZTY5NzExZWI1ODI3N2I2ZjgyMDEzMmJiN2I2Nw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-09T05:47:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-09T05:47:24Z"}, "message": "re PR middle-end/84237 (xen build faiulre only zero initializers are allowed in section '.bss.page_aligned.const')\n\n\tPR middle-end/84237\n\t* output.h (bss_initializer_p): Add NAMED argument, defaulted to false.\n\t* varasm.c (bss_initializer_p): Add NAMED argument, if true, ignore\n\tTREE_READONLY bit.\n\t(get_variable_section): For decls in named .bss* sections pass true as\n\tsecond argument to bss_initializer_p.\n\n\t* gcc.dg/pr84237.c: New test.\n\nFrom-SVN: r257513", "tree": {"sha": "4b0528d68555212c7996fffdc4ae21b6d20e1c9a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4b0528d68555212c7996fffdc4ae21b6d20e1c9a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ebd06e5ca705e69711eb58277b6f820132bb7b67", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebd06e5ca705e69711eb58277b6f820132bb7b67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ebd06e5ca705e69711eb58277b6f820132bb7b67", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebd06e5ca705e69711eb58277b6f820132bb7b67/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ebe4bf41d2b96a6b2f1de6a184eb0a7f5c2e5d00", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ebe4bf41d2b96a6b2f1de6a184eb0a7f5c2e5d00", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ebe4bf41d2b96a6b2f1de6a184eb0a7f5c2e5d00"}], "stats": {"total": 30, "additions": 25, "deletions": 5}, "files": [{"sha": "cacb10e9a8427c4c2cd632f99dd9de0caf6ef60f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ebd06e5ca705e69711eb58277b6f820132bb7b67", "patch": "@@ -1,3 +1,12 @@\n+2018-02-09  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/84237\n+\t* output.h (bss_initializer_p): Add NAMED argument, defaulted to false.\n+\t* varasm.c (bss_initializer_p): Add NAMED argument, if true, ignore\n+\tTREE_READONLY bit.\n+\t(get_variable_section): For decls in named .bss* sections pass true as\n+\tsecond argument to bss_initializer_p.\n+\n 2018-02-09  Marek Polacek  <polacek@redhat.com>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "f708cc75fa7c23778ef7b01c8cbe93694fcd5952", "filename": "gcc/output.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Foutput.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Foutput.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Foutput.h?ref=ebd06e5ca705e69711eb58277b6f820132bb7b67", "patch": "@@ -552,7 +552,7 @@ extern void output_file_directive (FILE *, const char *);\n extern unsigned int default_section_type_flags (tree, const char *, int);\n \n extern bool have_global_bss_p (void);\n-extern bool bss_initializer_p (const_tree);\n+extern bool bss_initializer_p (const_tree, bool = false);\n \n extern void default_no_named_section (const char *, unsigned int, tree);\n extern void default_elf_asm_named_section (const char *, unsigned int, tree);"}, {"sha": "0177e2b4270cd0603fd0ed39618318324d10a7cb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ebd06e5ca705e69711eb58277b6f820132bb7b67", "patch": "@@ -1,3 +1,8 @@\n+2018-02-09  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/84237\n+\t* gcc.dg/pr84237.c: New test.\n+\n 2018-02-09  Marek Polacek  <polacek@redhat.com>\n \t    Jakub Jelinek  <jakub@redhat.com>\n "}, {"sha": "5a2697f316771a815f7c9574c3397960ffa1644c", "filename": "gcc/testsuite/gcc.dg/pr84237.c", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84237.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84237.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84237.c?ref=ebd06e5ca705e69711eb58277b6f820132bb7b67", "patch": "@@ -0,0 +1,5 @@\n+/* PR middle-end/84237 */\n+/* { dg-do compile { target *-*-linux* } } */\n+/* { dg-options \"\" } */\n+\n+const char __attribute__((__section__(\".bss.page_aligned.const\"), __aligned__(4096))) zero_page[4096];"}, {"sha": "6e345d39d31ff48e2080ac62707640bc94c1253e", "filename": "gcc/varasm.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ebd06e5ca705e69711eb58277b6f820132bb7b67/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=ebd06e5ca705e69711eb58277b6f820132bb7b67", "patch": "@@ -983,11 +983,11 @@ decode_reg_name (const char *name)\n /* Return true if DECL's initializer is suitable for a BSS section.  */\n \n bool\n-bss_initializer_p (const_tree decl)\n+bss_initializer_p (const_tree decl, bool named)\n {\n   /* Do not put non-common constants into the .bss section, they belong in\n-     a readonly section.  */\n-  return ((!TREE_READONLY (decl) || DECL_COMMON (decl))\n+     a readonly section, except when NAMED is true.  */\n+  return ((!TREE_READONLY (decl) || DECL_COMMON (decl) || named)\n \t  && (DECL_INITIAL (decl) == NULL\n \t      /* In LTO we have no errors in program; error_mark_node is used\n \t         to mark offlined constructors.  */\n@@ -1165,7 +1165,8 @@ get_variable_section (tree decl, bool prefer_noswitch_p)\n     {\n       section *sect = get_named_section (decl, NULL, reloc);\n \n-      if ((sect->common.flags & SECTION_BSS) && !bss_initializer_p (decl))\n+      if ((sect->common.flags & SECTION_BSS)\n+\t  && !bss_initializer_p (decl, true))\n \t{\n \t  error_at (DECL_SOURCE_LOCATION (decl),\n \t\t    \"only zero initializers are allowed in section %qs\","}]}