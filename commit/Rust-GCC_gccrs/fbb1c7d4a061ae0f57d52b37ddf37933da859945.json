{"sha": "fbb1c7d4a061ae0f57d52b37ddf37933da859945", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmJiMWM3ZDRhMDYxYWUwZjU3ZDUyYjM3ZGRmMzc5MzNkYTg1OTk0NQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2017-05-22T09:38:09Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2017-05-22T09:38:09Z"}, "message": "decl.c (gnat_to_gnu_entity): Skip regular processing for Itypes that are E_Access_Subtype.\n\n\t* gcc-interface/decl.c (gnat_to_gnu_entity): Skip regular processing\n\tfor Itypes that are E_Access_Subtype.\n\t<E_Access_Subtype>: Use the DECL of the base type directly.\n\nFrom-SVN: r248323", "tree": {"sha": "e5b3b25705b1cb6996e6c1a91d7f490de80156c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e5b3b25705b1cb6996e6c1a91d7f490de80156c9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fbb1c7d4a061ae0f57d52b37ddf37933da859945", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbb1c7d4a061ae0f57d52b37ddf37933da859945", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fbb1c7d4a061ae0f57d52b37ddf37933da859945", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fbb1c7d4a061ae0f57d52b37ddf37933da859945/comments", "author": null, "committer": null, "parents": [{"sha": "61890ff25a24b2ddb289c61c1e5fbcae6f9f613d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61890ff25a24b2ddb289c61c1e5fbcae6f9f613d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61890ff25a24b2ddb289c61c1e5fbcae6f9f613d"}], "stats": {"total": 32, "additions": 27, "deletions": 5}, "files": [{"sha": "702ac99cd874c8f96aa8154b2409bcce1a806084", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=fbb1c7d4a061ae0f57d52b37ddf37933da859945", "patch": "@@ -1,3 +1,9 @@\n+2017-05-22  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/decl.c (gnat_to_gnu_entity): Skip regular processing\n+\tfor Itypes that are E_Access_Subtype.\n+\t<E_Access_Subtype>: Use the DECL of the base type directly.\n+\n 2017-05-22  Ed Schonberg  <schonberg@adacore.com>\n             Eric Botcazou  <ebotcazou@adacore.com>\n "}, {"sha": "eab244e910c176c888f3642c94583ddea215e798", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=fbb1c7d4a061ae0f57d52b37ddf37933da859945", "patch": "@@ -310,11 +310,13 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, bool definition)\n   /* Contains the list of attributes directly attached to the entity.  */\n   struct attrib *attr_list = NULL;\n \n-  /* Since a use of an Itype is a definition, process it as such if it\n-     is not in a with'ed unit.  */\n+  /* Since a use of an Itype is a definition, process it as such if it is in\n+     the main unit, except for E_Access_Subtype because it's actually a use\n+     of its base type, see below.  */\n   if (!definition\n       && is_type\n       && Is_Itype (gnat_entity)\n+      && Ekind (gnat_entity) != E_Access_Subtype\n       && !present_gnu_tree (gnat_entity)\n       && In_Extended_Main_Code_Unit (gnat_entity))\n     {\n@@ -3823,7 +3825,8 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, bool definition)\n     case E_Access_Subtype:\n       /* We treat this as identical to its base type; any constraint is\n \t meaningful only to the front-end.  */\n-      gnu_type = gnat_to_gnu_type (Etype (gnat_entity));\n+      gnu_decl = gnat_to_gnu_entity (Etype (gnat_entity), NULL_TREE, false);\n+      saved = true;\n \n       /* The designated subtype must be elaborated as well, if it does\n \t not have its own freeze node.  But designated subtypes created\n@@ -3855,8 +3858,6 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, bool definition)\n \t    gnat_to_gnu_entity (Directly_Designated_Type (gnat_entity),\n \t\t\t\tNULL_TREE, false);\n \t}\n-\n-      maybe_present = true;\n       break;\n \n     /* Subprogram Entities"}, {"sha": "b23bdeb81b3c7705a36b216d281a487150635eb0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fbb1c7d4a061ae0f57d52b37ddf37933da859945", "patch": "@@ -1,3 +1,7 @@\n+2017-05-22  Pierre-Marie de Rodat  <derodat@adacore.com>\n+\n+\t* gnat.dg/specs/not_null1.ads: New test.\n+\n 2017-05-22  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/limited_with5.ad[sb]: New test."}, {"sha": "ccf55e56904ea58c2fd68dc899cd6b6d191da82c", "filename": "gcc/testsuite/gnat.dg/specs/not_null1.ads", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fnot_null1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fbb1c7d4a061ae0f57d52b37ddf37933da859945/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fnot_null1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fnot_null1.ads?ref=fbb1c7d4a061ae0f57d52b37ddf37933da859945", "patch": "@@ -0,0 +1,11 @@\n+-- { dg-do compile }\n+\n+package Not_Null1 is\n+   type T is null record;\n+   type T_Access is access all T;\n+\n+   procedure Proc (This : in not null T_Access) is null;\n+\n+   type Proc_Access is access procedure (This : in not null T_Access);\n+   PA : Proc_Access := Proc'Access;\n+end Not_Null1;"}]}