{"sha": "0418f237b2143b16fd344fedcebafaf73faab571", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDQxOGYyMzdiMjE0M2IxNmZkMzQ0ZmVkY2ViYWZhZjczZmFhYjU3MQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2018-12-17T13:21:52Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2018-12-17T13:21:52Z"}, "message": "coverage.c (struct conts_entry): Add n_counts.\n\n\n\t* coverage.c (struct conts_entry): Add n_counts.\n\t(remap_counts_file): Record number of ocunts.\n\t(get_coverage_counts): Verify that counts match.\n\t* coverage.h (get_coverage_counts): Update prototype.\n\t* profile.c (get_exec_counts. compute_value_histograms): Add\n\tn_counts parametrs.\n\nFrom-SVN: r267200", "tree": {"sha": "a51c791c9e0adbc06a8714b2da504ae64680f193", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a51c791c9e0adbc06a8714b2da504ae64680f193"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0418f237b2143b16fd344fedcebafaf73faab571", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0418f237b2143b16fd344fedcebafaf73faab571", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0418f237b2143b16fd344fedcebafaf73faab571", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0418f237b2143b16fd344fedcebafaf73faab571/comments", "author": null, "committer": null, "parents": [{"sha": "d7c00826362598d636ef1eb92a1b194d46b41473", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7c00826362598d636ef1eb92a1b194d46b41473", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7c00826362598d636ef1eb92a1b194d46b41473"}], "stats": {"total": 45, "additions": 34, "deletions": 11}, "files": [{"sha": "17b32f52c8f67471911f63c3de832293addbd17f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0418f237b2143b16fd344fedcebafaf73faab571", "patch": "@@ -1,3 +1,12 @@\n+2018-12-15  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* coverage.c (struct conts_entry): Add n_counts.\n+\t(remap_counts_file): Record number of ocunts.\n+\t(get_coverage_counts): Verify that counts match.\n+\t* coverage.h (get_coverage_counts): Update prototype.\n+\t* profile.c (get_exec_counts. compute_value_histograms): Add\n+\tn_counts parametrs.\n+\n 2018-12-17  Senthil Kumar Selvaraj  <senthilkumar.selvaraj@microchip.com>\n \n \tPR rtl-optimization/88253"}, {"sha": "f3ffac5f11e14a8dd28806276b70b60b65651bd5", "filename": "gcc/coverage.c", "status": "modified", "additions": 20, "deletions": 8, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2Fcoverage.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2Fcoverage.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcoverage.c?ref=0418f237b2143b16fd344fedcebafaf73faab571", "patch": "@@ -74,6 +74,7 @@ struct counts_entry : pointer_hash <counts_entry>\n   unsigned lineno_checksum;\n   unsigned cfg_checksum;\n   gcov_type *counts;\n+  unsigned n_counts;\n \n   /* hash_table support.  */\n   static inline hashval_t hash (const counts_entry *);\n@@ -260,6 +261,7 @@ read_counts_file (void)\n \t      entry->lineno_checksum = lineno_checksum;\n \t      entry->cfg_checksum = cfg_checksum;\n \t      entry->counts = XCNEWVEC (gcov_type, n_counts);\n+\t      entry->n_counts = n_counts;\n \t    }\n \t  else if (entry->lineno_checksum != lineno_checksum\n \t\t   || entry->cfg_checksum != cfg_checksum)\n@@ -295,7 +297,7 @@ read_counts_file (void)\n \n gcov_type *\n get_coverage_counts (unsigned counter, unsigned cfg_checksum,\n-\t\t     unsigned lineno_checksum)\n+\t\t     unsigned lineno_checksum, unsigned int n_counts)\n {\n   counts_entry *entry, elt;\n \n@@ -344,17 +346,27 @@ get_coverage_counts (unsigned counter, unsigned cfg_checksum,\n       return NULL;\n     }\n   \n-  if (entry->cfg_checksum != cfg_checksum)\n+  if (entry->cfg_checksum != cfg_checksum || entry->n_counts != n_counts)\n     {\n       static int warned = 0;\n       bool warning_printed = false;\n \n-      warning_printed =\n-\twarning_at (DECL_SOURCE_LOCATION (current_function_decl),\n-\t\t    OPT_Wcoverage_mismatch,\n-\t\t    \"the control flow of function %qD does not match \"\n-\t\t    \"its profile data (counter %qs)\", current_function_decl,\n-\t\t    ctr_names[counter]);\n+      if (entry->n_counts != n_counts)\n+\twarning_printed =\n+\t  warning_at (DECL_SOURCE_LOCATION (current_function_decl),\n+\t\t      OPT_Wcoverage_mismatch,\n+\t\t      \"number of counters in profile data for function %qD \"\n+\t\t      \"does not match \"\n+\t\t      \"its profile data (counter %qs, expected %i and have %i)\",\n+\t\t      current_function_decl,\n+\t\t      ctr_names[counter], entry->n_counts, n_counts);\n+      else\n+\twarning_printed =\n+\t  warning_at (DECL_SOURCE_LOCATION (current_function_decl),\n+\t\t      OPT_Wcoverage_mismatch,\n+\t\t      \"the control flow of function %qD does not match \"\n+\t\t      \"its profile data (counter %qs)\", current_function_decl,\n+\t\t      ctr_names[counter]);\n       if (warning_printed && dump_enabled_p ())\n \t{\n \t  dump_user_location_t loc"}, {"sha": "f2a8c2939ac8300546c621136fca00ea00ddcd8e", "filename": "gcc/coverage.h", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2Fcoverage.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2Fcoverage.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcoverage.h?ref=0418f237b2143b16fd344fedcebafaf73faab571", "patch": "@@ -52,7 +52,8 @@ extern tree tree_coverage_counter_addr (unsigned /*counter*/, unsigned/*num*/);\n /* Get all the counters for the current function.  */\n extern gcov_type *get_coverage_counts (unsigned /*counter*/,\n \t\t\t\t       unsigned /*cfg_checksum*/,\n-\t\t\t\t       unsigned /*lineno_checksum*/);\n+\t\t\t\t       unsigned /*lineno_checksum*/,\n+\t\t\t\t       unsigned /*n_counts*/);\n \n extern tree get_gcov_type (void);\n extern bool coverage_node_map_initialized_p (void);"}, {"sha": "3c2ac33da554cbc5436584636f4ecd9077dfc127", "filename": "gcc/profile.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2Fprofile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0418f237b2143b16fd344fedcebafaf73faab571/gcc%2Fprofile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprofile.c?ref=0418f237b2143b16fd344fedcebafaf73faab571", "patch": "@@ -218,7 +218,7 @@ get_exec_counts (unsigned cfg_checksum, unsigned lineno_checksum)\n     }\n \n   counts = get_coverage_counts (GCOV_COUNTER_ARCS, cfg_checksum,\n-\t\t\t\tlineno_checksum);\n+\t\t\t\tlineno_checksum, num_edges);\n   if (!counts)\n     return NULL;\n \n@@ -780,7 +780,8 @@ compute_value_histograms (histogram_values values, unsigned cfg_checksum,\n \n       histogram_counts[t] = get_coverage_counts (COUNTER_FOR_HIST_TYPE (t),\n \t\t\t\t\t\t cfg_checksum,\n-\t\t\t\t\t\t lineno_checksum);\n+\t\t\t\t\t\t lineno_checksum,\n+\t\t\t\t\t\t n_histogram_counters[t]);\n       if (histogram_counts[t])\n \tany = 1;\n       act_count[t] = histogram_counts[t];"}]}