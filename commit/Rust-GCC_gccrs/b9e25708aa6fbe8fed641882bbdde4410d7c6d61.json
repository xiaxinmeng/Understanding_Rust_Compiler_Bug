{"sha": "b9e25708aa6fbe8fed641882bbdde4410d7c6d61", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjllMjU3MDhhYTZmYmU4ZmVkNjQxODgyYmJkZGU0NDEwZDdjNmQ2MQ==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-01-19T11:03:28Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2019-01-19T11:03:28Z"}, "message": "re PR fortran/88871 (ICE segmentation fault in f951)\n\n2019-01-17  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/88871\n\t* resolve.c (resolve_ref): Fix logic for removal of\n\treference.\n\nFrom-SVN: r268092", "tree": {"sha": "83d04ac7fb0f334ddaabf0121e35775d84782376", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/83d04ac7fb0f334ddaabf0121e35775d84782376"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b9e25708aa6fbe8fed641882bbdde4410d7c6d61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9e25708aa6fbe8fed641882bbdde4410d7c6d61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9e25708aa6fbe8fed641882bbdde4410d7c6d61", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9e25708aa6fbe8fed641882bbdde4410d7c6d61/comments", "author": null, "committer": null, "parents": [{"sha": "152f258f9a05d338a7e71c469e4e10fa02e038dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/152f258f9a05d338a7e71c469e4e10fa02e038dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/152f258f9a05d338a7e71c469e4e10fa02e038dd"}], "stats": {"total": 20, "additions": 15, "deletions": 5}, "files": [{"sha": "21e4c884f7ca43764f63a91d55436cc0a82bbb37", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9e25708aa6fbe8fed641882bbdde4410d7c6d61/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9e25708aa6fbe8fed641882bbdde4410d7c6d61/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b9e25708aa6fbe8fed641882bbdde4410d7c6d61", "patch": "@@ -1,3 +1,9 @@\n+2019-01-17  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/88871\n+\t* resolve.c (resolve_ref): Fix logic for removal of\n+\treference.\n+\n 2019-01-19  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR fortran/88902"}, {"sha": "3f893f1f802f4a5d85e3dd1eb1de534f1ca843ae", "filename": "gcc/fortran/resolve.c", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9e25708aa6fbe8fed641882bbdde4410d7c6d61/gcc%2Ffortran%2Fresolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9e25708aa6fbe8fed641882bbdde4410d7c6d61/gcc%2Ffortran%2Fresolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fresolve.c?ref=b9e25708aa6fbe8fed641882bbdde4410d7c6d61", "patch": "@@ -5046,6 +5046,7 @@ resolve_ref (gfc_expr *expr)\n   int current_part_dimension, n_components, seen_part_dimension;\n   gfc_ref *ref, **prev;\n   bool equal_length;\n+  bool breakout;\n \n   for (ref = expr->ref; ref; ref = ref->next)\n     if (ref->type == REF_ARRAY && ref->u.ar.as == NULL)\n@@ -5054,12 +5055,12 @@ resolve_ref (gfc_expr *expr)\n \tbreak;\n       }\n \n-  \n-  for (ref = expr->ref, prev = &expr->ref; ref; prev = &ref->next, ref = ref->next)\n-    switch (ref->type)\n+  breakout = false;\n+  for (prev = &expr->ref; !breakout && *prev != NULL; prev = &(*prev)->next)\n+    switch ((*prev)->type)\n       {\n       case REF_ARRAY:\n-\tif (!resolve_array_ref (&ref->u.ar))\n+\tif (!resolve_array_ref (&(*prev)->u.ar))\n \t  return false;\n \tbreak;\n \n@@ -5069,17 +5070,20 @@ resolve_ref (gfc_expr *expr)\n \n       case REF_SUBSTRING:\n \tequal_length = false;\n-\tif (!resolve_substring (ref, &equal_length))\n+\tif (!resolve_substring (*prev, &equal_length))\n \t  return false;\n \n \tif (expr->expr_type != EXPR_SUBSTRING && equal_length)\n \t  {\n \t    /* Remove the reference and move the charlen, if any.  */\n+\t    ref = *prev;\n \t    *prev = ref->next;\n \t    ref->next = NULL;\n \t    expr->ts.u.cl = ref->u.ss.length;\n \t    ref->u.ss.length = NULL;\n \t    gfc_free_ref_list (ref);\n+\t    if (*prev == NULL)\n+\t      breakout = true;\n \t  }\n \tbreak;\n       }"}]}