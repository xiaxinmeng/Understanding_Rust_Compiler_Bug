{"sha": "84eb39556cc8449e04b5f48bd5c131941a7a2529", "node_id": "C_kwDOANBUbNoAKDg0ZWIzOTU1NmNjODQ0OWUwNGI1ZjQ4YmQ1YzEzMTk0MWE3YTI1Mjk", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2023-01-27T21:38:57Z"}, "committer": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2023-01-27T21:38:57Z"}, "message": "c: Disallow braces around C2x auto initializers\n\nWG14 agreed at this week's meeting to remove support for braces around\nauto scalar initializers, as incompatible with C++ auto handling of\nbraced initializers; thus remove that support in GCC.\n\nBootstrapped with no regressions for x86_64-pc-linux-gnu.\n\ngcc/c/\n\t* c-parser.cc (c_parser_declaration_or_fndef): Do not allow braces\n\taround auto initializer.\n\ngcc/testsuite/\n\t* gcc.dg/c2x-auto-1.c, gcc.dg/c2x-auto-3.c: Expect braces around\n\tauto initializers to be disallowed.", "tree": {"sha": "0056eecba51f070de3a4e06310aa0c71361bd500", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0056eecba51f070de3a4e06310aa0c71361bd500"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/84eb39556cc8449e04b5f48bd5c131941a7a2529", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84eb39556cc8449e04b5f48bd5c131941a7a2529", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84eb39556cc8449e04b5f48bd5c131941a7a2529", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84eb39556cc8449e04b5f48bd5c131941a7a2529/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "815e5740162d2d0b7b54031f72c201065016d58c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/815e5740162d2d0b7b54031f72c201065016d58c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/815e5740162d2d0b7b54031f72c201065016d58c"}], "stats": {"total": 24, "additions": 10, "deletions": 14}, "files": [{"sha": "69230002bc8f38006463b7917f0467f4e16fc77c", "filename": "gcc/c/c-parser.cc", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84eb39556cc8449e04b5f48bd5c131941a7a2529/gcc%2Fc%2Fc-parser.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84eb39556cc8449e04b5f48bd5c131941a7a2529/gcc%2Fc%2Fc-parser.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.cc?ref=84eb39556cc8449e04b5f48bd5c131941a7a2529", "patch": "@@ -2480,18 +2480,7 @@ c_parser_declaration_or_fndef (c_parser *parser, bool fndef_ok,\n \t\t  int flag_sanitize_save = flag_sanitize;\n \t\t  if (nested && !empty_ok)\n \t\t    flag_sanitize = 0;\n-\t\t  if (std_auto_type_p\n-\t\t      && c_parser_next_token_is (parser, CPP_OPEN_BRACE))\n-\t\t    {\n-\t\t      matching_braces braces;\n-\t\t      braces.consume_open (parser);\n-\t\t      init = c_parser_expr_no_commas (parser, NULL);\n-\t\t      if (c_parser_next_token_is (parser, CPP_COMMA))\n-\t\t\tc_parser_consume_token (parser);\n-\t\t      braces.skip_until_found_close (parser);\n-\t\t    }\n-\t\t  else\n-\t\t    init = c_parser_expr_no_commas (parser, NULL);\n+\t\t  init = c_parser_expr_no_commas (parser, NULL);\n \t\t  if (std_auto_type_p)\n \t\t    finish_underspecified_init (underspec_name,\n \t\t\t\t\t\tunderspec_state);"}, {"sha": "c50daccfe89fe5c06753e7c4d9dd874950919dc3", "filename": "gcc/testsuite/gcc.dg/c2x-auto-1.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84eb39556cc8449e04b5f48bd5c131941a7a2529/gcc%2Ftestsuite%2Fgcc.dg%2Fc2x-auto-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84eb39556cc8449e04b5f48bd5c131941a7a2529/gcc%2Ftestsuite%2Fgcc.dg%2Fc2x-auto-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc2x-auto-1.c?ref=84eb39556cc8449e04b5f48bd5c131941a7a2529", "patch": "@@ -4,14 +4,14 @@\n \n auto i = 1;\n extern int i;\n-static auto l = { 0L };\n+static auto l = 0L;\n extern long l;\n extern auto const d = 0.0; /* { dg-warning \"initialized and declared 'extern'\" } */\n extern const double d;\n double dx;\n auto ((i2)) = 3;\n extern int i2;\n-const auto i3 [[]] = { 4, };\n+const auto i3 [[]] = 4;\n extern int i4;\n thread_local auto f = 1.0f;\n float ff;"}, {"sha": "1ab3cc74d355ea41d582873ca97e79fa4a9deacc", "filename": "gcc/testsuite/gcc.dg/c2x-auto-3.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/84eb39556cc8449e04b5f48bd5c131941a7a2529/gcc%2Ftestsuite%2Fgcc.dg%2Fc2x-auto-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/84eb39556cc8449e04b5f48bd5c131941a7a2529/gcc%2Ftestsuite%2Fgcc.dg%2Fc2x-auto-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc2x-auto-3.c?ref=84eb39556cc8449e04b5f48bd5c131941a7a2529", "patch": "@@ -62,3 +62,10 @@ f5 ()\n {\n   static int auto e10 = 3; /* { dg-error \"multiple storage classes in declaration specifiers\" } */\n }\n+\n+void\n+f6 ()\n+{\n+  static auto l = { 0L }; /* { dg-error \"expected expression\" } */\n+  const auto i3 [[]] = { 4, }; /* { dg-error \"expected expression\" } */\n+}"}]}