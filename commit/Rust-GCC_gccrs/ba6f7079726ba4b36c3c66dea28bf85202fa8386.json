{"sha": "ba6f7079726ba4b36c3c66dea28bf85202fa8386", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmE2ZjcwNzk3MjZiYTRiMzZjM2M2NmRlYTI4YmY4NTIwMmZhODM4Ng==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2009-10-02T16:25:50Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2009-10-02T16:25:50Z"}, "message": "re PR fortran/41479 (intent(out) for types with default initialization)\n\n2009-10-02  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/41479\n        * trans-decl.c (gfc_init_default_dt): Check for presence of\n        the argument only if it is optional or in entry master.\n        (init_intent_out_dt): Ditto; call gfc_init_default_dt\n        for all derived types with initializers.\n\n2009-10-02  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/41479\n        * gfortran.dg/intent_out_5.f90: New test.\n\nFrom-SVN: r152407", "tree": {"sha": "381e04543967b0b4c7519693b32c6643b41ff68d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/381e04543967b0b4c7519693b32c6643b41ff68d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ba6f7079726ba4b36c3c66dea28bf85202fa8386", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba6f7079726ba4b36c3c66dea28bf85202fa8386", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ba6f7079726ba4b36c3c66dea28bf85202fa8386", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ba6f7079726ba4b36c3c66dea28bf85202fa8386/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b19736c9cb95e484e1b3595e23fbb5e155e3820e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b19736c9cb95e484e1b3595e23fbb5e155e3820e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b19736c9cb95e484e1b3595e23fbb5e155e3820e"}], "stats": {"total": 59, "additions": 51, "deletions": 8}, "files": [{"sha": "c325d258ae8a7d0e993dc87d9dce95039eb04e54", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=ba6f7079726ba4b36c3c66dea28bf85202fa8386", "patch": "@@ -1,3 +1,11 @@\n+2009-10-02  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/41479\n+\t* trans-decl.c (gfc_init_default_dt): Check for presence of\n+\tthe argument only if it is optional or in entry master.\n+\t(init_intent_out_dt): Ditto; call gfc_init_default_dt\n+\tfor all derived types with initializers.\n+\n 2009-10-01  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \tPR fortran/33197"}, {"sha": "ee38efbe27c14b1abda01ff4eab7f6834f5200e6", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=ba6f7079726ba4b36c3c66dea28bf85202fa8386", "patch": "@@ -2991,7 +2991,8 @@ gfc_init_default_dt (gfc_symbol * sym, tree body)\n   gfc_set_sym_referenced (sym);\n   e = gfc_lval_expr_from_sym (sym);\n   tmp = gfc_trans_assignment (e, sym->value, false);\n-  if (sym->attr.dummy)\n+  if (sym->attr.dummy && (sym->attr.optional\n+\t\t\t  || sym->ns->proc_name->attr.entry_master))\n     {\n       present = gfc_conv_expr_present (sym);\n       tmp = build3 (COND_EXPR, TREE_TYPE (tmp), present,\n@@ -3023,21 +3024,23 @@ init_intent_out_dt (gfc_symbol * proc_sym, tree body)\n \t&& !f->sym->attr.pointer\n \t&& f->sym->ts.type == BT_DERIVED)\n       {\n-\tif (f->sym->ts.u.derived->attr.alloc_comp)\n+\tif (f->sym->ts.u.derived->attr.alloc_comp && !f->sym->value)\n \t  {\n \t    tmp = gfc_deallocate_alloc_comp (f->sym->ts.u.derived,\n \t\t\t\t\t     f->sym->backend_decl,\n \t\t\t\t\t     f->sym->as ? f->sym->as->rank : 0);\n \n-\t    present = gfc_conv_expr_present (f->sym);\n-\t    tmp = build3 (COND_EXPR, TREE_TYPE (tmp), present,\n-\t\t\t  tmp, build_empty_stmt (input_location));\n+\t    if (f->sym->attr.optional\n+\t\t|| f->sym->ns->proc_name->attr.entry_master)\n+\t      {\n+\t\tpresent = gfc_conv_expr_present (f->sym);\n+\t\ttmp = build3 (COND_EXPR, TREE_TYPE (tmp), present,\n+\t\t\t      tmp, build_empty_stmt (input_location));\n+\t      }\n \n \t    gfc_add_expr_to_block (&fnblock, tmp);\n \t  }\n-\n-\tif (!f->sym->ts.u.derived->attr.alloc_comp\n-\t      && f->sym->value)\n+       else if (f->sym->value)\n \t  body = gfc_init_default_dt (f->sym, body);\n       }\n "}, {"sha": "888064b3174acca44d55dbc8e5adc60143792388", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ba6f7079726ba4b36c3c66dea28bf85202fa8386", "patch": "@@ -1,3 +1,8 @@\n+2009-10-02  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/41479\n+\t* gfortran.dg/intent_out_5.f90: New test.\n+\n 2009-10-02  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/41404"}, {"sha": "acd2b60652596b46de4bc2c994bb45b7c5430255", "filename": "gcc/testsuite/gfortran.dg/intent_out_5.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ftestsuite%2Fgfortran.dg%2Fintent_out_5.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ba6f7079726ba4b36c3c66dea28bf85202fa8386/gcc%2Ftestsuite%2Fgfortran.dg%2Fintent_out_5.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fintent_out_5.f90?ref=ba6f7079726ba4b36c3c66dea28bf85202fa8386", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do run}\n+!\n+! PR fortran/41479\n+!\n+! Contributed by Juergen Reuter.\n+!\n+program main\n+ type :: container_t\n+    integer :: n = 42\n+    ! if the following line is omitted, the problem disappears\n+    integer, dimension(:), allocatable :: a\n+ end type container_t\n+\n+ type(container_t) :: container\n+\n+ if (container%n /= 42) call abort()\n+ if (allocated(container%a)) call abort()\n+ container%n = 1\n+ allocate(container%a(50))\n+ call init (container)\n+ if (container%n /= 42) call abort()\n+ if (allocated(container%a)) call abort()\n+contains\n+ subroutine init (container)\n+   type(container_t), intent(out) :: container\n+ end subroutine init\n+end program main"}]}