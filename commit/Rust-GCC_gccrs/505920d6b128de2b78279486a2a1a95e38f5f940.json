{"sha": "505920d6b128de2b78279486a2a1a95e38f5f940", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTA1OTIwZDZiMTI4ZGUyYjc4Mjc5NDg2YTJhMWE5NWUzOGY1Zjk0MA==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2011-08-30T15:34:01Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2011-08-30T15:34:01Z"}, "message": "re PR fortran/45170 ([F2003] allocatable character lengths)\n\n2011-08-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/45170\n\t* trans-stmt.c (gfc_trans_allocate): Evaluate the substring.\n\n2011-08-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n\n\tPR fortran/45170\n\t* gfortran.dg/allocate_with_source_2.f90: New test\n\nFrom-SVN: r178329", "tree": {"sha": "571e9966557aae713059987b1bd1f315293784a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/571e9966557aae713059987b1bd1f315293784a7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/505920d6b128de2b78279486a2a1a95e38f5f940", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/505920d6b128de2b78279486a2a1a95e38f5f940", "html_url": "https://github.com/Rust-GCC/gccrs/commit/505920d6b128de2b78279486a2a1a95e38f5f940", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/505920d6b128de2b78279486a2a1a95e38f5f940/comments", "author": null, "committer": null, "parents": [{"sha": "a728a2ada0698cbd8688d5eb6d88d357ec27eb5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a728a2ada0698cbd8688d5eb6d88d357ec27eb5b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a728a2ada0698cbd8688d5eb6d88d357ec27eb5b"}], "stats": {"total": 35, "additions": 35, "deletions": 0}, "files": [{"sha": "4f906b26666bc1cfadb93c4b1a651a29c70ae1db", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=505920d6b128de2b78279486a2a1a95e38f5f940", "patch": "@@ -1,3 +1,8 @@\n+2011-08-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/45170\n+\t* trans-stmt.c (gfc_trans_allocate): Evaluate the substring.\n+\n 2011-08-29  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/50225"}, {"sha": "7d8b4e00827f600fa2901652c5669503b4be2967", "filename": "gcc/fortran/trans-stmt.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ffortran%2Ftrans-stmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ffortran%2Ftrans-stmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-stmt.c?ref=505920d6b128de2b78279486a2a1a95e38f5f940", "patch": "@@ -4783,6 +4783,10 @@ gfc_trans_allocate (gfc_code * code)\n \t\t\t|| code->expr3->expr_type == EXPR_CONSTANT)\n \t\t    {\n \t\t      gfc_conv_expr (&se_sz, code->expr3);\n+\t\t      gfc_add_block_to_block (&se.pre, &se_sz.pre);\n+\t\t      se_sz.string_length\n+\t\t\t= gfc_evaluate_now (se_sz.string_length, &se.pre);\n+\t\t      gfc_add_block_to_block (&se.pre, &se_sz.post);\n \t\t      memsz = se_sz.string_length;\n \t\t    }\n \t\t  else if (code->expr3->mold"}, {"sha": "0820eaf92fbd6c1ada3b9e84262f654075e375c5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=505920d6b128de2b78279486a2a1a95e38f5f940", "patch": "@@ -1,3 +1,8 @@\n+2011-08-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n+\n+\tPR fortran/45170\n+\t* gfortran.dg/allocate_with_source_2.f90: New test\n+\n 2011-08-30  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/50220"}, {"sha": "8e48b226062285347512c75c8bfa4b8287a72386", "filename": "gcc/testsuite/gfortran.dg/allocate_with_source_2.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/505920d6b128de2b78279486a2a1a95e38f5f940/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fallocate_with_source_2.f90?ref=505920d6b128de2b78279486a2a1a95e38f5f940", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do run }\n+! PR 45170\n+! A variation of a theme for deferred type parameters.  The\n+! substring reference in the source= portion of the allocate\n+! was not probably resolved.  Testcase is a modified version\n+! of a program due to Hans-Werner Boschmann <boschmann at tp1\n+! dot physik dot uni-siegen dot de>\n+!\n+program helloworld\n+  character(:),allocatable::string\n+  real::rnd\n+  call hello(5, string)\n+  if (string /= 'hello' .or. len(string) /= 5) call abort\n+contains\n+  subroutine hello (n,string)\n+    character(:),allocatable,intent(out)::string\n+    integer,intent(in)::n\n+    character(20)::helloworld=\"hello world\"\n+   allocate(string, source=helloworld(:n))\n+  end subroutine hello\n+end program helloworld"}]}