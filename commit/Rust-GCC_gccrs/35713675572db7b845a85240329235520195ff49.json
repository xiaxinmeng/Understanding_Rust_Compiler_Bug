{"sha": "35713675572db7b845a85240329235520195ff49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzU3MTM2NzU1NzJkYjdiODQ1YTg1MjQwMzI5MjM1NTIwMTk1ZmY0OQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2010-08-02T06:22:23Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2010-08-02T06:22:23Z"}, "message": "Don't update the position flag for non-seekable files, check for stell() error.\n\nFrom-SVN: r162810", "tree": {"sha": "b7882064a4e558562d0f7321b64b8535c9f23143", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b7882064a4e558562d0f7321b64b8535c9f23143"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/35713675572db7b845a85240329235520195ff49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35713675572db7b845a85240329235520195ff49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/35713675572db7b845a85240329235520195ff49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/35713675572db7b845a85240329235520195ff49/comments", "author": null, "committer": null, "parents": [{"sha": "0093ddee9684ad9df246c464c97114f9aaa27c2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0093ddee9684ad9df246c464c97114f9aaa27c2b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0093ddee9684ad9df246c464c97114f9aaa27c2b"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "700cb60e7868a323fe0e58cf84a01767574a40ff", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35713675572db7b845a85240329235520195ff49/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35713675572db7b845a85240329235520195ff49/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=35713675572db7b845a85240329235520195ff49", "patch": "@@ -1,3 +1,8 @@\n+2010-08-02  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\t* io/unit.c (update_position): Don't update the position flag for\n+\tnon-seekable files, check for stell() error.\n+\n 2010-08-01  Janne Blomqvist  <jb@gcc.gnu.org>\n \n         * io/unix.c (file_exists): Use access(2) instead of stat(2) to"}, {"sha": "1d52217263552f2cf89726f09a767e20c1dc6fbc", "filename": "libgfortran/io/unit.c", "status": "modified", "additions": 13, "deletions": 6, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/35713675572db7b845a85240329235520195ff49/libgfortran%2Fio%2Funit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/35713675572db7b845a85240329235520195ff49/libgfortran%2Fio%2Funit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funit.c?ref=35713675572db7b845a85240329235520195ff49", "patch": "@@ -714,12 +714,19 @@ close_units (void)\n void\n update_position (gfc_unit *u)\n {\n-  if (stell (u->s) == 0)\n-    u->flags.position = POSITION_REWIND;\n-  else if (file_length (u->s) == stell (u->s))\n-    u->flags.position = POSITION_APPEND;\n-  else\n-    u->flags.position = POSITION_ASIS;\n+  /* If unit is not seekable, this makes no sense (and the standard is\n+     silent on this matter), and thus we don't change the position for\n+     a non-seekable file.  */\n+  if (is_seekable (u->s))\n+    {\n+      gfc_offset cur = stell (u->s);\n+      if (cur == 0)\n+\tu->flags.position = POSITION_REWIND;\n+      else if (cur != -1 && (file_length (u->s) == cur))\n+\tu->flags.position = POSITION_APPEND;\n+      else\n+\tu->flags.position = POSITION_ASIS;\n+    }\n }\n \n "}]}