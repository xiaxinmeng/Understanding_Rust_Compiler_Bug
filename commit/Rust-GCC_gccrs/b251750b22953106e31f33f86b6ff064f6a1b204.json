{"sha": "b251750b22953106e31f33f86b6ff064f6a1b204", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjI1MTc1MGIyMjk1MzEwNmUzMWYzM2Y4NmI2ZmYwNjRmNmExYjIwNA==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2010-10-26T13:15:05Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-10-26T13:15:05Z"}, "message": "opt.ads (Checksum_Accumulate_Token_Checksum): New Boolean flag, defaulted to True.\n\n2010-10-26  Vincent Celier  <celier@adacore.com>\n\n\t* opt.ads (Checksum_Accumulate_Token_Checksum): New Boolean flag,\n\tdefaulted to True.\n\t(Checksum_GNAT_6_3): New name of Old_Checksums\n\t(Checksum_GNAT_5_03): New name of Old_Old_Checksums\n\t* prj-nmsc.adb (Process_Project_Level_Array_Attributes): Adapt to new\n\tnames of Opt flags.\n\tSet Checksum_Accumulate_Token_Checksum to False if GNAT version is 5.03\n\tor before.\n\t* scng.adb (Accumulate_Token_Checksum_GNAT_6_3): New name of procedure\n\tAccumulate_Token_Checksum_Old.\n\t(Accumulate_Token_Checksum_GNAT_5_03): New name of procedure\n\tAccumulate_Token_Checksum_Old_Old.\n\t(Nlit): Call Accumulate_Token_Checksum only if\n\tOpt.Checksum_Accumulate_Token_Checksum is True.\n\t(Scan): Ditto\n\nFrom-SVN: r165961", "tree": {"sha": "4a832f2252eeeda8fa993dde3064c4bdaf25d7a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4a832f2252eeeda8fa993dde3064c4bdaf25d7a1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b251750b22953106e31f33f86b6ff064f6a1b204", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b251750b22953106e31f33f86b6ff064f6a1b204", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b251750b22953106e31f33f86b6ff064f6a1b204", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b251750b22953106e31f33f86b6ff064f6a1b204/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f2264ac2cd6325b96d5a742ce72159a011636f38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2264ac2cd6325b96d5a742ce72159a011636f38", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2264ac2cd6325b96d5a742ce72159a011636f38"}], "stats": {"total": 170, "additions": 117, "deletions": 53}, "files": [{"sha": "58e75aac9a58ef119d42b16daf267dcc3454ee68", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=b251750b22953106e31f33f86b6ff064f6a1b204", "patch": "@@ -1,3 +1,21 @@\n+2010-10-26  Vincent Celier  <celier@adacore.com>\n+\n+\t* opt.ads (Checksum_Accumulate_Token_Checksum): New Boolean flag,\n+\tdefaulted to True.\n+\t(Checksum_GNAT_6_3): New name of Old_Checksums\n+\t(Checksum_GNAT_5_03): New name of Old_Old_Checksums\n+\t* prj-nmsc.adb (Process_Project_Level_Array_Attributes): Adapt to new\n+\tnames of Opt flags.\n+\tSet Checksum_Accumulate_Token_Checksum to False if GNAT version is 5.03\n+\tor before.\n+\t* scng.adb (Accumulate_Token_Checksum_GNAT_6_3): New name of procedure\n+\tAccumulate_Token_Checksum_Old.\n+\t(Accumulate_Token_Checksum_GNAT_5_03): New name of procedure\n+\tAccumulate_Token_Checksum_Old_Old.\n+\t(Nlit): Call Accumulate_Token_Checksum only if\n+\tOpt.Checksum_Accumulate_Token_Checksum is True.\n+\t(Scan): Ditto\n+\n 2010-10-26  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_ch13.adb (Build_Invariant_Procedure): New calling sequence."}, {"sha": "1bc9729652b6262c2801ce4455033d85cdf2cfee", "filename": "gcc/ada/opt.ads", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2Fopt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2Fopt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fopt.ads?ref=b251750b22953106e31f33f86b6ff064f6a1b204", "patch": "@@ -933,12 +933,25 @@ package Opt is\n    --  GNATMAKE\n    --  Set to True when an object directory is specified with option -D\n \n-   Old_Checksums     : Boolean := False;\n-   Old_Old_Checksums : Boolean := False;\n+   Checksum_Accumulate_Token_Checksum : Boolean := True;\n    --  GPRBUILD\n-   --  Set to True when the old ways of computing checksums needs to be used.\n-   --  For reserved words, the old ways were to use the token value, while the\n-   --  new way is to use Tok_Identifier for reserved word too.\n+   --  Set to False by gprbuild when the version of GNAT is 5.02 or before.\n+   --  There were no call to procedure Accumulate_Token_Checksum in these\n+   --  versions.\n+\n+   Checksum_GNAT_6_3 : Boolean := False;\n+   --  GPRBUILD\n+   --  Set to True by gprbuild when the version of GNAT is 6.3 or before. For\n+   --  GNAT versions 5.04 to 6.3, Accumulate_Token_Checksum were called with\n+   --  the token values of the keywords, instead of Tok_Identifier for later\n+   --  versions, and Tok_Some was not in Token_Type.\n+\n+   Checksum_GNAT_5_03 : Boolean := False;\n+   --  GPRBUILD\n+   --  Set to True by gprbuild when the version of GNAT is 5.03. For GNAT 5.04,\n+   --  Accumulate_Token_Checksum were called with the token values of the\n+   --  keywords, and Tok_Interface, Tok_Overriding, Tok_Synchronized and\n+   --  Tok_Some were not in Token_Type.\n \n    One_Compilation_Per_Obj_Dir : Boolean := False;\n    --  GNATMAKE, GPRBUILD"}, {"sha": "6786e927b9119bae09874c861d39e72e6e2e50f6", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 46, "deletions": 22, "changes": 68, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=b251750b22953106e31f33f86b6ff064f6a1b204", "patch": "@@ -2399,23 +2399,44 @@ package body Prj.Nmsc is\n                         Lang_Index.Config.Toolchain_Version :=\n                           Element.Value.Value;\n \n-                        --  We need a complete comment section discussing the\n-                        --  need for three versions of the checksum algorithm\n-                        --  and what is going on here??? Also Old and Old_Old\n-                        --  are rather poor names I would say. How about\n-\n-                        --    Opt.Checksum_503\n-                        --    Opt.Checksum_63\n-\n-                        --  If the Ada compiler is version 6.3 or before, then\n-                        --  checksums need to be computed using the old way.\n-\n-                        --  Also, how about an abstraction for checking\n-                        --  version numbers, something like ???\n-\n-                        --    if Version_Is_Before (5, 3) ....\n-\n                         if Lang_Index.Name = Name_Ada then\n+                           --  The way the checksum is computed has evolved\n+                           --  across the different versions of GNAT. When\n+                           --  gprbuild is called with -m, the checksums need\n+                           --  to be computed the same way in gprbuild as it\n+                           --  was in the GNAT version of the compiler.\n+                           --  The different ways are:\n+                           --    - version 6.4 and later:\n+                           --      procedure Accumulate_Token_Checksum is\n+                           --      called after each numeric literal and each\n+                           --      identifier/keyword. For keywords,\n+                           --      Tok_Identifier is used in the call to\n+                           --      Accumulate_Token_Checksum.\n+                           --    - versions 5.04 to 6.3:\n+                           --      for keywords, the token value were used in\n+                           --      the call to Accumulate_Token_Checksum. Type\n+                           --      Token_Type did not include Tok_Some.\n+                           --    - versions 5.03:\n+                           --      for keywords, the token value were used in\n+                           --      the call to Accumulate_Token_Checksum. Type\n+                           --      Token_Type did not include Tok_Interface,\n+                           --      Tok_Overriding, Tok_Synchronized and\n+                           --      Tok_Some.\n+                           --    - versions 5.02 and before:\n+                           --      no call to Accumulate_Token_Checksum.\n+                           --\n+                           --  To signal to the scanner that\n+                           --  Accumulate_Token_Checksum needs to be called and\n+                           --  what versions to call, 3 Booleans flags are used\n+                           --  in Opt:\n+                           --    - Checksum_Accumulate_Token_Checksum: True for\n+                           --      versions 5.03 and later, False for 5.02 and\n+                           --      before.\n+                           --    - Checksum_GNAT_6_3: False for versions 6.4\n+                           --      and later, True for versions 6.3 and before.\n+                           --    - Checksum_GNAT_5_03: False for versions 5.04\n+                           --    and later, True for versions 5.03 and before.\n+\n                            declare\n                               Vers : constant String :=\n                                        Get_Name_String (Element.Value.Value);\n@@ -2430,17 +2451,20 @@ package body Prj.Nmsc is\n                                     or else\n                                       (Vers (6) = '6' and then Vers (8) < '4'))\n                               then\n-                                 Opt.Old_Checksums := True;\n-\n-                                 --  If the Ada compiler is version 5.03 or\n-                                 --  before, then checksums need to be computed\n-                                 --  using the other old way.\n+                                 Checksum_GNAT_6_3 := True;\n \n                                  if Vers (6) < '5'\n                                    or else (Vers (6) = '5'\n                                              and then Vers (Vers'Last) < '4')\n                                  then\n-                                    Opt.Old_Old_Checksums := True;\n+                                    Checksum_GNAT_5_03 := True;\n+\n+                                    if Vers (6) /= '5'\n+                                      or else Vers (Vers'Last) < '3'\n+                                    then\n+                                       Checksum_Accumulate_Token_Checksum :=\n+                                       False;\n+                                    end if;\n                                  end if;\n                               end if;\n                            end;"}, {"sha": "f1386f8fce887457e7cbee38a291af2386677b03", "filename": "gcc/ada/scng.adb", "status": "modified", "additions": 35, "deletions": 26, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2Fscng.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b251750b22953106e31f33f86b6ff064f6a1b204/gcc%2Fada%2Fscng.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fscng.adb?ref=b251750b22953106e31f33f86b6ff064f6a1b204", "patch": "@@ -68,17 +68,18 @@ package body Scng is\n    --  the token used is Tok_Identifier. This allows to detect additional\n    --  spaces added in sources when using the builder switch -m.\n \n-   procedure Accumulate_Token_Checksum_Old;\n-   --  Used in place of Accumulate_Token_Checksum for previous releases, when\n-   --  Tok_Some was not included in Token_Type and the actual Token_Type was\n-   --  used for keywords. This procedure is never used in the compiler or\n-   --  gnatmake.\n-\n-   procedure Accumulate_Token_Checksum_Old_Old;\n-   --  Used in place of Accumulate_Token_Checksum for previous releases, when\n+   procedure Accumulate_Token_Checksum_GNAT_6_3;\n+   --  Used in place of Accumulate_Token_Checksum for GNAT versions 5.04 to\n+   --  6.3, when Tok_Some was not included in Token_Type and the actual\n+   --  Token_Type was used for keywords. This procedure is never used in the\n+   --  compiler or gnatmake, only in gprbuild.\n+\n+   procedure Accumulate_Token_Checksum_GNAT_5_03;\n+   --  Used in place of Accumulate_Token_Checksum for GNAT version 5.03, when\n    --  Tok_Interface, Tok_Some, Tok_Synchronized and Tok_Overriding were not\n    --  included in Token_Type and the actual Token_Type was used for keywords.\n-   --  This procedure is never used in the compiler or gnatmake.\n+   --  This procedure is never used in the compiler or gnatmake, only in\n+   --  gprbuild.\n \n    procedure Accumulate_Checksum (C : Character);\n    pragma Inline (Accumulate_Checksum);\n@@ -135,11 +136,11 @@ package body Scng is\n          Character'Val (Token_Type'Pos (Token)));\n    end Accumulate_Token_Checksum;\n \n-   -----------------------------------\n-   -- Accumulate_Token_Checksum_Old --\n-   -----------------------------------\n+   ----------------------------------------\n+   -- Accumulate_Token_Checksum_GNAT_6_3 --\n+   ----------------------------------------\n \n-   procedure Accumulate_Token_Checksum_Old is\n+   procedure Accumulate_Token_Checksum_GNAT_6_3 is\n    begin\n       --  Individual values of Token_Type are used, instead of subranges, so\n       --  that additions or suppressions of enumerated values in type\n@@ -189,13 +190,13 @@ package body Scng is\n               (System.CRC32.CRC32 (Checksum),\n                Character'Val (Token_Type'Pos (Token_Type'Pred (Token))));\n       end case;\n-   end Accumulate_Token_Checksum_Old;\n+   end Accumulate_Token_Checksum_GNAT_6_3;\n \n-   ---------------------------------------\n-   -- Accumulate_Token_Checksum_Old_Old --\n-   ---------------------------------------\n+   -----------------------------------------\n+   -- Accumulate_Token_Checksum_GNAT_5_03 --\n+   -----------------------------------------\n \n-   procedure Accumulate_Token_Checksum_Old_Old is\n+   procedure Accumulate_Token_Checksum_GNAT_5_03 is\n    begin\n       --  Individual values of Token_Type are used, instead of subranges, so\n       --  that additions or suppressions of enumerated values in type\n@@ -254,7 +255,7 @@ package body Scng is\n               (System.CRC32.CRC32 (Checksum),\n                Character'Val (Token_Type'Pos (Token) - 4));\n       end case;\n-   end Accumulate_Token_Checksum_Old_Old;\n+   end Accumulate_Token_Checksum_GNAT_5_03;\n \n    ----------------------------\n    -- Determine_Token_Casing --\n@@ -891,7 +892,10 @@ package body Scng is\n             end if;\n          end if;\n \n-         Accumulate_Token_Checksum;\n+         if Checksum_Accumulate_Token_Checksum then\n+            Accumulate_Token_Checksum;\n+         end if;\n+\n          return;\n       end Nlit;\n \n@@ -2553,13 +2557,15 @@ package body Scng is\n          --  Here is where we check if it was a keyword\n \n          if Is_Keyword_Name (Token_Name) then\n-            if Opt.Old_Checksums then\n+            if Opt.Checksum_GNAT_6_3 then\n                Token := Token_Type'Val (Get_Name_Table_Byte (Token_Name));\n \n-               if Opt.Old_Old_Checksums then\n-                  Accumulate_Token_Checksum_Old_Old;\n-               else\n-                  Accumulate_Token_Checksum_Old;\n+               if Checksum_Accumulate_Token_Checksum then\n+                  if Checksum_GNAT_5_03 then\n+                     Accumulate_Token_Checksum_GNAT_5_03;\n+                  else\n+                     Accumulate_Token_Checksum_GNAT_6_3;\n+                  end if;\n                end if;\n \n             else\n@@ -2622,7 +2628,10 @@ package body Scng is\n          --  It is an identifier after all\n \n          else\n-            Accumulate_Token_Checksum;\n+            if Checksum_Accumulate_Token_Checksum then\n+               Accumulate_Token_Checksum;\n+            end if;\n+\n             Post_Scan;\n             return;\n          end if;"}]}