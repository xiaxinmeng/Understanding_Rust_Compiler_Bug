{"sha": "c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzMzODI5NzlkMDAxNmY2YmY0ZTNjYjJmYmQ0OGI5NTFiMjRlMzVkZg==", "commit": {"author": {"name": "Sebastian Pop", "email": "sebastian.pop@amd.com", "date": "2010-02-23T12:59:17Z"}, "committer": {"name": "Sebastian Pop", "email": "spop@gcc.gnu.org", "date": "2010-02-23T12:59:17Z"}, "message": "Fix PR43097: rename only SSA_NAMEs.\n\n2010-02-22  Sebastian Pop  <sebastian.pop@amd.com>\n\n\tPR middle-end/43140\n\t* sese.c (get_rename): Assert that old_name is an SSA_NAME.\n\t(rename_variables_in_stmt): Continue when the use is not an SSA_NAME.\n\n\t* gfortran.dg/graphite/pr43097.f: New.\n\nFrom-SVN: r156995", "tree": {"sha": "9fb8f64603818b3925ac8f939c7c8bf463bb6431", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9fb8f64603818b3925ac8f939c7c8bf463bb6431"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/comments", "author": null, "committer": {"login": "sebpop", "id": 568397, "node_id": "MDQ6VXNlcjU2ODM5Nw==", "avatar_url": "https://avatars.githubusercontent.com/u/568397?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sebpop", "html_url": "https://github.com/sebpop", "followers_url": "https://api.github.com/users/sebpop/followers", "following_url": "https://api.github.com/users/sebpop/following{/other_user}", "gists_url": "https://api.github.com/users/sebpop/gists{/gist_id}", "starred_url": "https://api.github.com/users/sebpop/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sebpop/subscriptions", "organizations_url": "https://api.github.com/users/sebpop/orgs", "repos_url": "https://api.github.com/users/sebpop/repos", "events_url": "https://api.github.com/users/sebpop/events{/privacy}", "received_events_url": "https://api.github.com/users/sebpop/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "13cd10a221731f7393656e130078ac23083f82ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13cd10a221731f7393656e130078ac23083f82ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13cd10a221731f7393656e130078ac23083f82ec"}], "stats": {"total": 45, "additions": 42, "deletions": 3}, "files": [{"sha": "aae16e7fc22f97cc0d0acae6ced7db330646e41e", "filename": "gcc/ChangeLog.graphite", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/gcc%2FChangeLog.graphite", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/gcc%2FChangeLog.graphite", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog.graphite?ref=c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "patch": "@@ -1,3 +1,11 @@\n+2010-02-22  Sebastian Pop  <sebastian.pop@amd.com>\n+\n+\tPR middle-end/43140\n+\t* sese.c (get_rename): Assert that old_name is an SSA_NAME.\n+\t(rename_variables_in_stmt): Continue when the use is not an SSA_NAME.\n+\n+\t* gfortran.dg/graphite/pr43097.f: New.\n+\n 2010-02-22  Sebastian Pop  <sebastian.pop@amd.com>\n \t    Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n "}, {"sha": "d7a9faa1ad8298cdade244c2bdec4c7339d302f1", "filename": "gcc/sese.c", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/gcc%2Fsese.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/gcc%2Fsese.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsese.c?ref=c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "patch": "@@ -494,6 +494,7 @@ get_rename (htab_t map, tree old_name)\n   struct rename_map_elt_s tmp;\n   PTR *slot;\n \n+  gcc_assert (TREE_CODE (old_name) == SSA_NAME);\n   tmp.old_name = old_name;\n   slot = htab_find_slot (map, &tmp, NO_INSERT);\n \n@@ -658,14 +659,19 @@ rename_variables_in_stmt (gimple stmt, htab_t map, gimple_stmt_iterator *insert_\n   FOR_EACH_SSA_USE_OPERAND (use_p, stmt, iter, SSA_OP_ALL_USES)\n     {\n       tree use = USE_FROM_PTR (use_p);\n-      tree expr = get_rename (map, use);\n-      tree type_use = TREE_TYPE (use);\n-      tree type_expr = TREE_TYPE (expr);\n+      tree expr, type_use, type_expr;\n       gimple_seq stmts;\n \n+      if (TREE_CODE (use) != SSA_NAME)\n+\tcontinue;\n+\n+      expr = get_rename (map, use);\n       if (use == expr)\n \tcontinue;\n \n+      type_use = TREE_TYPE (use);\n+      type_expr = TREE_TYPE (expr);\n+\n       if (type_use != type_expr\n \t  || (TREE_CODE (expr) != SSA_NAME\n \t      && is_gimple_reg (use)))"}, {"sha": "4ddeed8ae7db41ad1c1df564cc530e41a30e035d", "filename": "gcc/testsuite/gfortran.dg/graphite/pr43097.f", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/gcc%2Ftestsuite%2Fgfortran.dg%2Fgraphite%2Fpr43097.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3382979d0016f6bf4e3cb2fbd48b951b24e35df/gcc%2Ftestsuite%2Fgfortran.dg%2Fgraphite%2Fpr43097.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgraphite%2Fpr43097.f?ref=c3382979d0016f6bf4e3cb2fbd48b951b24e35df", "patch": "@@ -0,0 +1,25 @@\n+! { dg-options \"-O2 -fgraphite-identity\" }\n+\n+      subroutine foo (ldmx,ldmy,nx,ny,v)\n+      implicit real*8 (a-h, o-z)\n+      dimension v(5,ldmx,ldmy,*)\n+      dimension tmat(5,5)\n+\n+      k = 2\n+      do j = 2, ny-1\n+         do i = 2, nx-1\n+            do ip = 1, 4\n+               do m = ip+1, 5\n+                  v(m,i,j,k) = v(m,i,j,k) * m\n+               end do\n+            end do\n+            do m = 5, 1, -1\n+               do l = m+1, 5\n+                  v(m,i,j,k) = v(l,i,j,k)\n+               end do\n+               v(m,i,j,k) = m\n+           end do\n+         end do\n+      end do\n+      return\n+      end"}]}