{"sha": "017b3258fa075ff64facea88e200ee6b88bcd602", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDE3YjMyNThmYTA3NWZmNjRmYWNlYTg4ZTIwMGVlNmI4OGJjZDYwMg==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "rakdver@atrey.karlin.mff.cuni.cz", "date": "2004-02-17T19:51:15Z"}, "committer": {"name": "Jeff Law", "email": "law@gcc.gnu.org", "date": "2004-02-17T19:51:15Z"}, "message": "* cfghooks.c (split_edge): Speed up updating of dominators.\n\nFrom-SVN: r77973", "tree": {"sha": "8a82c181579a38d2a696ed2860af7e1f75ec4e38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8a82c181579a38d2a696ed2860af7e1f75ec4e38"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/017b3258fa075ff64facea88e200ee6b88bcd602", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/017b3258fa075ff64facea88e200ee6b88bcd602", "html_url": "https://github.com/Rust-GCC/gccrs/commit/017b3258fa075ff64facea88e200ee6b88bcd602", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/017b3258fa075ff64facea88e200ee6b88bcd602/comments", "author": null, "committer": null, "parents": [{"sha": "e70e9b0faac98b2f123c0cd1c20da1d54e986738", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e70e9b0faac98b2f123c0cd1c20da1d54e986738", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e70e9b0faac98b2f123c0cd1c20da1d54e986738"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "33c57331d0fce5e155f356db512c64598f166d9a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/017b3258fa075ff64facea88e200ee6b88bcd602/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/017b3258fa075ff64facea88e200ee6b88bcd602/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=017b3258fa075ff64facea88e200ee6b88bcd602", "patch": "@@ -1,3 +1,7 @@\n+2004-02-17  Zdenek Dvorak  <rakdver@atrey.karlin.mff.cuni.cz>\n+\n+\t* cfghooks.c (split_edge): Speed up updating of dominators.\n+\n 2004-02-17  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/11326"}, {"sha": "e25612424d704d415519006a6e4334349c2ce00e", "filename": "gcc/cfghooks.c", "status": "modified", "additions": 28, "deletions": 3, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/017b3258fa075ff64facea88e200ee6b88bcd602/gcc%2Fcfghooks.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/017b3258fa075ff64facea88e200ee6b88bcd602/gcc%2Fcfghooks.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfghooks.c?ref=017b3258fa075ff64facea88e200ee6b88bcd602", "patch": "@@ -373,6 +373,7 @@ split_edge (edge e)\n   basic_block ret;\n   gcov_type count = e->count;\n   int freq = EDGE_FREQUENCY (e);\n+  edge f;\n \n   if (!cfg_hooks->split_edge)\n     internal_error (\"%s does not support split_edge.\", cfg_hooks->name);\n@@ -387,9 +388,33 @@ split_edge (edge e)\n     set_immediate_dominator (CDI_DOMINATORS, ret, ret->pred->src);\n \n   if (dom_computed[CDI_DOMINATORS] >= DOM_NO_FAST_QUERY)\n-    set_immediate_dominator (CDI_DOMINATORS, ret->succ->dest,\n-\t\t\t     recount_dominator (CDI_DOMINATORS,\n-\t\t\t\t\t\tret->succ->dest));\n+    {\n+      /* There are two cases:\n+\n+\t If the immediate dominator of e->dest is not e->src, it\n+\t remains unchanged.\n+\n+\t If immediate dominator of e->dest is e->src, it may become\n+\t ret, provided that all other predecessors of e->dest are\n+\t dominated by e->dest.  */\n+\n+      if (get_immediate_dominator (CDI_DOMINATORS, ret->succ->dest)\n+\t  == ret->pred->src)\n+\t{\n+\t  for (f = ret->succ->dest->pred; f; f = f->pred_next)\n+\t    {\n+\t      if (f == ret->succ)\n+\t\tcontinue;\n+\n+\t      if (!dominated_by_p (CDI_DOMINATORS, f->src,\n+\t\t\t\t   ret->succ->dest))\n+\t\tbreak;\n+\t    }\n+\n+\t  if (!f)\n+\t    set_immediate_dominator (CDI_DOMINATORS, ret->succ->dest, ret);\n+\t}\n+    };\n \n   return ret;\n }"}]}