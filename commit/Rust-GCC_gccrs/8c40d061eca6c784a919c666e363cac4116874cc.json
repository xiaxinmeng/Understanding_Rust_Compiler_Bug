{"sha": "8c40d061eca6c784a919c666e363cac4116874cc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGM0MGQwNjFlY2E2Yzc4NGE5MTljNjY2ZTM2M2NhYzQxMTY4NzRjYw==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2009-08-23T09:46:00Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2009-08-23T09:46:00Z"}, "message": "re PR target/40718 (Invalid code produced with -foptimize-sibling-calls)\n\n\tPR target/40718\n\t* config/i386/i386.c (*call_pop_1): Disable for sibling calls.\n\t(*sibcall_pop_1): New insn pattern.\n\ntestsuite/ChangeLog:\n\n\tPR target/40718\n\t* gcc.target/i386/pr40718.c: New test.\n\nFrom-SVN: r151028", "tree": {"sha": "5efa39dfb4f50d17c08703d97e16086240be1957", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5efa39dfb4f50d17c08703d97e16086240be1957"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8c40d061eca6c784a919c666e363cac4116874cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c40d061eca6c784a919c666e363cac4116874cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c40d061eca6c784a919c666e363cac4116874cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c40d061eca6c784a919c666e363cac4116874cc/comments", "author": null, "committer": null, "parents": [{"sha": "98791cfdb3d796c9f0c4febc1b342621343f92ad", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98791cfdb3d796c9f0c4febc1b342621343f92ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98791cfdb3d796c9f0c4febc1b342621343f92ad"}], "stats": {"total": 98, "additions": 71, "deletions": 27}, "files": [{"sha": "defd6b7b431c5203e1821b34264fdfcba654a352", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 14, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8c40d061eca6c784a919c666e363cac4116874cc", "patch": "@@ -1,3 +1,9 @@\n+2009-08-23  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/40718\n+\t* config/i386/i386.c (*call_pop_1): Disable for sibling calls.\n+\t(*sibcall_pop_1): New insn pattern.\n+\n 2009-08-23  Alan Modra  <amodra@bigpond.net.au>\n \n \tPR target/41081\n@@ -71,8 +77,7 @@\n \n \tPR target/40671\n \t* config/rs6000/rs6000.c (rs6000_override_options): Use\n-\tTARGET_64BIT instead of TARGET_POWERPC64 to set the size of\n-\tpointers.\n+\tTARGET_64BIT instead of TARGET_POWERPC64 to set the size of pointers.\n \n \tPR target/41145\n \t* config/rs6000/rs6000.c (rs6000_handle_altivec_attribute): Fix\n@@ -105,8 +110,7 @@\n \n 2009-08-20  Richard Guenther  <rguenther@suse.de>\n \n-\t* c-objc-common.h (LANG_HOOKS_DUP_LANG_SPECIFIC_DECL): Do not\n-\tdefine.\n+\t* c-objc-common.h (LANG_HOOKS_DUP_LANG_SPECIFIC_DECL): Do not define.\n \t* c-tree.h (c_dup_lang_specific_decl): Remove.\n \t(struct lang_decl, struct lang_type): Move definitions ...\n \t* c-lang.h: ... here.  New file.\n@@ -253,8 +257,7 @@\n \n 2009-08-16  Douglas B Rupp  <rupp@gnat.com>\n \n-\t* doc/invoke.texi (Target options):\n-\tAdd new option list for IA-64/VMS.\n+\t* doc/invoke.texi (Target options): Add new option list for IA-64/VMS.\n \t(menu): Add IA-64/VMS Options.\n \t(IA-64/VMS Options): Likewise.\n \n@@ -337,15 +340,12 @@\n \n \t* doc/extend.texi (Symbol-Renaming Pragmas): redefine_extname is\n \tsupported on all platforms.\n-\t* target.h (struct gcc_target): Remove\n-\thandle_pragma_redefine_extname.\n-\t* c-cppbuiltin.c: Remove use of\n-\ttargetm.handle_pragma_redefine_extname.\n+\t* target.h (struct gcc_target): Remove handle_pragma_redefine_extname.\n+\t* c-cppbuiltin.c: Remove use of targetm.handle_pragma_redefine_extname.\n \t* c-pragma.c: Likewise.\n \t* target-def.h (TARGET_INITIALIZER): Remove\n \tTARGET_HANDLE_PRAGMA_REDEFINE_EXTNAME.\n-\t* config/sol2.h: Remove use of\n-\tTARGET_HANDLE_PRAGMA_REDEFINE_EXTNAME.\n+\t* config/sol2.h: Remove use of TARGET_HANDLE_PRAGMA_REDEFINE_EXTNAME.\n \n 2009-08-14  Douglas B Rupp  <rupp@gnat.com>\n \n@@ -400,8 +400,8 @@\n 2009-08-14  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \tPR middle-end/30789\n-\t* builtins.c (do_mpc_arg2): Make extern, define for any MPC\n-\tversion.  Move declaration...\n+\t* builtins.c (do_mpc_arg2): Make extern, define for any MPC version.\n+\tMove declaration...\n \t* real.h (do_mpc_arg2): ... here.\n \t* fold-const.c (const_binop): Use MPC for complex MULT_EXPR\n \tand RDIV_EXPR."}, {"sha": "3be44d3cbe9beab01df8b03917c79b7c635a7648", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=8c40d061eca6c784a919c666e363cac4116874cc", "patch": "@@ -15476,22 +15476,25 @@\n \t (match_operand:SI 1 \"\" \"\"))\n    (set (reg:SI SP_REG) (plus:SI (reg:SI SP_REG)\n \t\t\t    (match_operand:SI 2 \"immediate_operand\" \"i\")))]\n-  \"!TARGET_64BIT\"\n+  \"!SIBLING_CALL_P (insn) && !TARGET_64BIT\"\n {\n   if (constant_call_address_operand (operands[0], Pmode))\n-    {\n-      if (SIBLING_CALL_P (insn))\n-\treturn \"jmp\\t%P0\";\n-      else\n-\treturn \"call\\t%P0\";\n-    }\n-  if (SIBLING_CALL_P (insn))\n-    return \"jmp\\t%A0\";\n-  else\n-    return \"call\\t%A0\";\n+    return \"call\\t%P0\";\n+  return \"call\\t%A0\";\n }\n   [(set_attr \"type\" \"call\")])\n \n+(define_insn \"*sibcall_pop_1\"\n+  [(call (mem:QI (match_operand:SI 0 \"sibcall_insn_operand\" \"s,U\"))\n+\t (match_operand:SI 1 \"\" \"\"))\n+   (set (reg:SI SP_REG) (plus:SI (reg:SI SP_REG)\n+\t\t\t    (match_operand:SI 2 \"immediate_operand\" \"i,i\")))]\n+  \"SIBLING_CALL_P (insn) && !TARGET_64BIT\"\n+  \"@\n+   jmp\\t%P0\n+   jmp\\t%A0\"\n+  [(set_attr \"type\" \"call\")])\n+\n (define_expand \"call\"\n   [(call (match_operand:QI 0 \"\" \"\")\n \t (match_operand 1 \"\" \"\"))"}, {"sha": "7fc7d23b95c0807f0a9de1bed21ef0aed7fadd5d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8c40d061eca6c784a919c666e363cac4116874cc", "patch": "@@ -1,3 +1,8 @@\n+2009-08-23  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/40718\n+\t* gcc.target/i386/pr40718.c: New test.\n+\n 2009-08-22  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \t* gfortran.dg/proc_ptr_24.f90: New test.\n@@ -22,8 +27,8 @@\n \n 2009-08-21  Uros Bizjak  <ubizjak@gmail.com>\n \n-\t* gfortran.dg/boz_9.f90: Do not generate denormal floating\n-\tpoint numbers.  Remove -mieee option for alpha*-*-* targets.\n+\t* gfortran.dg/boz_9.f90: Do not load denormal floating\n+\tpoint constants.  Remove -mieee option for alpha*-*-* targets.\n \n 2009-08-21  Janus Weil  <janus@gcc.gnu.org>\n "}, {"sha": "f6029ed98ab75a174d7fae0fe91cb59bdff57552", "filename": "gcc/testsuite/gcc.target/i386/pr40718.c", "status": "added", "additions": 36, "deletions": 0, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40718.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8c40d061eca6c784a919c666e363cac4116874cc/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40718.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr40718.c?ref=8c40d061eca6c784a919c666e363cac4116874cc", "patch": "@@ -0,0 +1,36 @@\n+/* { dg-do run } */\n+/* { dg-require-effective-target ilp32 } */\n+/* { dg-options \"-O1 -foptimize-sibling-calls\" } */\n+\n+void abort (void);\n+\n+struct S\n+{\n+  void (__attribute__((__stdcall__)) *f) (struct S *);\n+  int i;\n+};\n+\n+void __attribute__((__stdcall__))\n+foo (struct S *s)\n+{\n+  s->i++;\n+}\n+\n+void __attribute__((__stdcall__))\n+bar (struct S *s)\n+{\n+  foo(s);\n+  s->f(s);\n+}\n+\n+int main (void)\n+{\n+  struct S s = { foo, 0 };\n+\n+  bar (&s);\n+  if (s.i != 2)\n+    abort ();\n+\n+  return 0;\n+}\n+"}]}