{"sha": "73f942c08deef3cce312263b3347f7a44dd44150", "node_id": "C_kwDOANBUbNoAKDczZjk0MmMwOGRlZWYzY2NlMzEyMjYzYjMzNDdmN2E0NGRkNDQxNTA", "commit": {"author": {"name": "Haochen Jiang", "email": "haochen.jiang@intel.com", "date": "2022-05-30T09:12:31Z"}, "committer": {"name": "Haochen Jiang", "email": "haochen.jiang@intel.com", "date": "2022-07-04T06:21:53Z"}, "message": "i386: Extend cvtps2pd to memory\n\ngcc/ChangeLog:\n\n\tPR target/43618\n\t* config/i386/sse.md (extendv2sfv2df2): New define_expand.\n\t(sse2_cvtps2pd_<mask_name>): Change constraint of operands[1].\n\t(*sse2_cvtps2pd_<mask_name>_1): Rename from extendvsdfv2df2.\n\ngcc/testsuite/ChangeLog:\n\n\tPR target/43618\n\t* gcc.target/i386/pr43618-1.c: New test.", "tree": {"sha": "062ec60619de33306305304148ce32a40bccab90", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/062ec60619de33306305304148ce32a40bccab90"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/73f942c08deef3cce312263b3347f7a44dd44150", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73f942c08deef3cce312263b3347f7a44dd44150", "html_url": "https://github.com/Rust-GCC/gccrs/commit/73f942c08deef3cce312263b3347f7a44dd44150", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/73f942c08deef3cce312263b3347f7a44dd44150/comments", "author": {"login": "jianghc724", "id": 10798680, "node_id": "MDQ6VXNlcjEwNzk4Njgw", "avatar_url": "https://avatars.githubusercontent.com/u/10798680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jianghc724", "html_url": "https://github.com/jianghc724", "followers_url": "https://api.github.com/users/jianghc724/followers", "following_url": "https://api.github.com/users/jianghc724/following{/other_user}", "gists_url": "https://api.github.com/users/jianghc724/gists{/gist_id}", "starred_url": "https://api.github.com/users/jianghc724/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jianghc724/subscriptions", "organizations_url": "https://api.github.com/users/jianghc724/orgs", "repos_url": "https://api.github.com/users/jianghc724/repos", "events_url": "https://api.github.com/users/jianghc724/events{/privacy}", "received_events_url": "https://api.github.com/users/jianghc724/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jianghc724", "id": 10798680, "node_id": "MDQ6VXNlcjEwNzk4Njgw", "avatar_url": "https://avatars.githubusercontent.com/u/10798680?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jianghc724", "html_url": "https://github.com/jianghc724", "followers_url": "https://api.github.com/users/jianghc724/followers", "following_url": "https://api.github.com/users/jianghc724/following{/other_user}", "gists_url": "https://api.github.com/users/jianghc724/gists{/gist_id}", "starred_url": "https://api.github.com/users/jianghc724/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jianghc724/subscriptions", "organizations_url": "https://api.github.com/users/jianghc724/orgs", "repos_url": "https://api.github.com/users/jianghc724/repos", "events_url": "https://api.github.com/users/jianghc724/events{/privacy}", "received_events_url": "https://api.github.com/users/jianghc724/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "bbe836bc7c557b3f4119e03d24cb61f23906cba9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bbe836bc7c557b3f4119e03d24cb61f23906cba9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bbe836bc7c557b3f4119e03d24cb61f23906cba9"}], "stats": {"total": 38, "additions": 33, "deletions": 5}, "files": [{"sha": "3396ff748daed6cc07d2795542d06240ed4187b6", "filename": "gcc/config/i386/sse.md", "status": "modified", "additions": 21, "deletions": 5, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73f942c08deef3cce312263b3347f7a44dd44150/gcc%2Fconfig%2Fi386%2Fsse.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73f942c08deef3cce312263b3347f7a44dd44150/gcc%2Fconfig%2Fi386%2Fsse.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fsse.md?ref=73f942c08deef3cce312263b3347f7a44dd44150", "patch": "@@ -9176,11 +9176,27 @@\n    (set_attr \"prefix\" \"evex\")\n    (set_attr \"mode\" \"<sseinsnmode>\")])\n \n+(define_expand \"extendv2sfv2df2\"\n+  [(set (match_operand:V2DF 0 \"register_operand\")\n+\t(float_extend:V2DF\n+\t  (match_operand:V2SF 1 \"nonimmediate_operand\")))]\n+  \"TARGET_MMX_WITH_SSE\"\n+{\n+  if (!MEM_P (operands[1]))\n+    {\n+      operands[1] = lowpart_subreg (V4SFmode,\n+\t\t\t\t    force_reg (V2SFmode, operands[1]),\n+\t\t\t\t    V2SFmode);\n+      emit_insn (gen_sse2_cvtps2pd (operands[0], operands[1]));\n+      DONE;\n+    }\n+})\n+\n (define_insn \"sse2_cvtps2pd<mask_name>\"\n   [(set (match_operand:V2DF 0 \"register_operand\" \"=v\")\n \t(float_extend:V2DF\n \t  (vec_select:V2SF\n-\t    (match_operand:V4SF 1 \"vector_operand\" \"vm\")\n+\t    (match_operand:V4SF 1 \"register_operand\" \"v\")\n \t    (parallel [(const_int 0) (const_int 1)]))))]\n   \"TARGET_SSE2 && <mask_avx512vl_condition>\"\n   \"%vcvtps2pd\\t{%1, %0<mask_operand2>|%0<mask_operand2>, %q1}\"\n@@ -9192,12 +9208,12 @@\n    (set_attr \"prefix\" \"maybe_vex\")\n    (set_attr \"mode\" \"V2DF\")])\n \n-(define_insn \"extendv2sfv2df2\"\n+(define_insn \"*sse2_cvtps2pd<mask_name>_1\"\n   [(set (match_operand:V2DF 0 \"register_operand\" \"=v\")\n \t(float_extend:V2DF\n-\t  (match_operand:V2SF 1 \"register_operand\" \"v\")))]\n-  \"TARGET_MMX_WITH_SSE\"\n-  \"%vcvtps2pd\\t{%1, %0|%0, %1}\"\n+\t  (match_operand:V2SF 1 \"memory_operand\" \"m\")))]\n+  \"TARGET_SSE2 && <mask_avx512vl_condition>\"\n+  \"%vcvtps2pd\\t{%1, %0<mask_operand2>|%0<mask_operand2>, %q1}\"\n   [(set_attr \"type\" \"ssecvt\")\n    (set_attr \"amdfam10_decode\" \"direct\")\n    (set_attr \"athlon_decode\" \"double\")"}, {"sha": "7d16f0e0cf99bc7928944b1d30d2ce97cc1c2030", "filename": "gcc/testsuite/gcc.target/i386/pr43618-1.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/73f942c08deef3cce312263b3347f7a44dd44150/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr43618-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/73f942c08deef3cce312263b3347f7a44dd44150/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr43618-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr43618-1.c?ref=73f942c08deef3cce312263b3347f7a44dd44150", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile { target { ! ia32 } } } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-final { scan-assembler-not \"movq\" } } */\n+/* { dg-final { scan-assembler \"cvtps2pd\" } } */\n+\n+void\n+foo (float a[2], double b[2])\n+{\n+    int i;\n+    for (i = 0; i < 2; i++)\n+      b[i] = a[i];\n+}"}]}