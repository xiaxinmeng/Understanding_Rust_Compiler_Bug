{"sha": "4053a5a0aff55ae8e4be6ecb0267d5c1668232a5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDA1M2E1YTBhZmY1NWFlOGU0YmU2ZWNiMDI2N2Q1YzE2NjgyMzJhNQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@google.com", "date": "2011-01-11T22:58:35Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2011-01-11T22:58:35Z"}, "message": "godump.c (go_output_var): Don't output the variable if there is already a type with the same name.\n\n\t* godump.c (go_output_var): Don't output the variable if there is\n\talready a type with the same name.\n\nFrom-SVN: r168683", "tree": {"sha": "7fb03b7a58793be01beab7e1afb0ff1426858776", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7fb03b7a58793be01beab7e1afb0ff1426858776"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5/comments", "author": null, "committer": null, "parents": [{"sha": "fa3e04d2db350acfc275a678668c2370fc7d6f88", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fa3e04d2db350acfc275a678668c2370fc7d6f88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fa3e04d2db350acfc275a678668c2370fc7d6f88"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "a9bb4c2506b35c7746c31040b0de909932a7b7dc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4053a5a0aff55ae8e4be6ecb0267d5c1668232a5", "patch": "@@ -1,3 +1,8 @@\n+2011-01-11  Ian Lance Taylor  <iant@google.com>\n+\n+\t* godump.c (go_output_var): Don't output the variable if there is\n+\talready a type with the same name.\n+\n 2011-01-11  Ian Lance Taylor  <iant@google.com>\n \n \t* godump.c (go_format_type): Don't generate float80."}, {"sha": "4ec41f041567adb6b9074f78b063b1cbd1317548", "filename": "gcc/godump.c", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5/gcc%2Fgodump.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4053a5a0aff55ae8e4be6ecb0267d5c1668232a5/gcc%2Fgodump.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgodump.c?ref=4053a5a0aff55ae8e4be6ecb0267d5c1668232a5", "patch": "@@ -715,13 +715,27 @@ go_output_typedef (struct godump_container *container, tree decl)\n static void\n go_output_var (struct godump_container *container, tree decl)\n {\n+  bool is_valid;\n+\n   if (pointer_set_contains (container->decls_seen, decl)\n       || pointer_set_contains (container->decls_seen, DECL_NAME (decl)))\n     return;\n   pointer_set_insert (container->decls_seen, decl);\n   pointer_set_insert (container->decls_seen, DECL_NAME (decl));\n-  if (!go_format_type (container, TREE_TYPE (decl), true, false))\n+\n+  is_valid = go_format_type (container, TREE_TYPE (decl), true, false);\n+  if (is_valid\n+      && htab_find_slot (container->type_hash,\n+\t\t\t IDENTIFIER_POINTER (DECL_NAME (decl)),\n+\t\t\t NO_INSERT) != NULL)\n+    {\n+      /* There is already a type with this name, probably from a\n+\t struct tag.  Prefer the type to the variable.  */\n+      is_valid = false;\n+    }\n+  if (!is_valid)\n     fprintf (go_dump_file, \"// \");\n+\n   fprintf (go_dump_file, \"var _%s \",\n \t   IDENTIFIER_POINTER (DECL_NAME (decl)));\n   go_output_type (container);"}]}