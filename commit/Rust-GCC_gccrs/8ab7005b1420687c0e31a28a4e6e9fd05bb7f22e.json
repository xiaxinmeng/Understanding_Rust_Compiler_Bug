{"sha": "8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGFiNzAwNWIxNDIwNjg3YzBlMzFhMjhhNGU2ZTlmZDA1YmI3ZjIyZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-06-08T19:10:49Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-06-08T19:10:49Z"}, "message": "re PR c/81006 (ICE with zero-size array and #pragma omp task depend)\n\n\tPR c/81006\n\t* c-typeck.c (handle_omp_array_sections_1): Convert TYPE_MAX_VALUE\n\tto sizetype before size_binop.\n\n\t* semantics.c (handle_omp_array_sections_1): Convert TYPE_MAX_VALUE\n\tto sizetype before size_binop.\n\n\t* c-c++-common/gomp/pr81006.c: New test.\n\nFrom-SVN: r249035", "tree": {"sha": "aec1d25f339f1ecbb52d004325a72dfac4ffc379", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aec1d25f339f1ecbb52d004325a72dfac4ffc379"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "20e96b489ea501861c0bb6e509888275d682ed2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20e96b489ea501861c0bb6e509888275d682ed2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20e96b489ea501861c0bb6e509888275d682ed2f"}], "stats": {"total": 35, "additions": 29, "deletions": 6}, "files": [{"sha": "e94bcead994e75c65a46ac5d028a8142a3725ea9", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "patch": "@@ -1,3 +1,9 @@\n+2017-06-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/81006\n+\t* c-typeck.c (handle_omp_array_sections_1): Convert TYPE_MAX_VALUE\n+\tto sizetype before size_binop.\n+\n 2017-06-07  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gimple-parser.c (c_parser_parse_gimple_body): Use TDI_gimple instead"}, {"sha": "00e16e8e4350c3c9452100858e5a0de59c18cb61", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "patch": "@@ -12364,9 +12364,9 @@ handle_omp_array_sections_1 (tree c, tree t, vec<tree> &types,\n \t  && TREE_CODE (TYPE_MAX_VALUE (TYPE_DOMAIN (type)))\n \t\t\t== INTEGER_CST)\n \t{\n-\t  tree size = size_binop (PLUS_EXPR,\n-\t\t\t\t  TYPE_MAX_VALUE (TYPE_DOMAIN (type)),\n-\t\t\t\t  size_one_node);\n+\t  tree size\n+\t    = fold_convert (sizetype, TYPE_MAX_VALUE (TYPE_DOMAIN (type)));\n+\t  size = size_binop (PLUS_EXPR, size, size_one_node);\n \t  if (TREE_CODE (low_bound) == INTEGER_CST)\n \t    {\n \t      if (tree_int_cst_lt (size, low_bound))"}, {"sha": "38b04faf0e1223f04b1d46f3ee33390bc8194c6a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "patch": "@@ -1,5 +1,9 @@\n 2017-06-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c/81006\n+\t* semantics.c (handle_omp_array_sections_1): Convert TYPE_MAX_VALUE\n+\tto sizetype before size_binop.\n+\n \tPR c++/81011\n \t* cp-gimplify.c (cxx_omp_finish_clause): When changing clause\n \tto OMP_CLAUSE_SHARED, also clear OMP_CLAUSE_SHARED_FIRSTPRIVATE"}, {"sha": "94de17f6e3e4da546a0a4814aea9172028ba803c", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "patch": "@@ -4731,9 +4731,9 @@ handle_omp_array_sections_1 (tree c, tree t, vec<tree> &types,\n \t  && TREE_CODE (TYPE_MAX_VALUE (TYPE_DOMAIN (type)))\n \t\t\t== INTEGER_CST)\n \t{\n-\t  tree size = size_binop (PLUS_EXPR,\n-\t\t\t\t  TYPE_MAX_VALUE (TYPE_DOMAIN (type)),\n-\t\t\t\t  size_one_node);\n+\t  tree size\n+\t    = fold_convert (sizetype, TYPE_MAX_VALUE (TYPE_DOMAIN (type)));\n+\t  size = size_binop (PLUS_EXPR, size, size_one_node);\n \t  if (TREE_CODE (low_bound) == INTEGER_CST)\n \t    {\n \t      if (tree_int_cst_lt (size, low_bound))"}, {"sha": "ca0862640fafb349af51dfa4d0f0006b42bbeb3b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "patch": "@@ -1,5 +1,8 @@\n 2017-06-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c/81006\n+\t* c-c++-common/gomp/pr81006.c: New test.\n+\n \tPR c++/81011\n \t* g++.dg/gomp/pr81011.C: New test.\n "}, {"sha": "a826c5f5a5395edfd43319eaaa3ae1de55f5b4ff", "filename": "gcc/testsuite/c-c++-common/gomp/pr81006.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr81006.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr81006.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgomp%2Fpr81006.c?ref=8ab7005b1420687c0e31a28a4e6e9fd05bb7f22e", "patch": "@@ -0,0 +1,10 @@\n+/* PR c/81006 */\n+/* { dg-do compile } */\n+\n+int a[] = {};\n+\n+void foo()\n+{\n+  #pragma omp task depend(out: a[:])\t/* { dg-error \"zero length array section in .depend. clause\" } */\n+    {}\n+}"}]}