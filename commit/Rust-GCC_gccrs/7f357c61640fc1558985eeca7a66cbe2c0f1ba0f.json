{"sha": "7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2YzNTdjNjE2NDBmYzE1NTg5ODVlZWNhN2E2NmNiZTJjMGYxYmEwZg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2017-01-31T15:10:41Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2017-01-31T15:10:41Z"}, "message": "re PR c++/79264 (ICE verify_type failed)\n\n\tPR c++/79264\n\t* lambda.c (maybe_generic_this_capture): Deal with\n\ttemplate-id-exprs.\n\t* semantics.c (finish_member_declaration): Assert class is being\n\tdefined.\n\n\tPR c++/79264\n\t* g++.dg/cpp1y/pr61636-1.C: Augment.\n\nFrom-SVN: r245065", "tree": {"sha": "3d604b4184e9611d9c196a1136cc32ae6be34e40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d604b4184e9611d9c196a1136cc32ae6be34e40"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8eedca0df166131d7999cec1ba7c83bac8e681c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8eedca0df166131d7999cec1ba7c83bac8e681c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8eedca0df166131d7999cec1ba7c83bac8e681c8"}], "stats": {"total": 43, "additions": 37, "deletions": 6}, "files": [{"sha": "ea1435d05b60bc736a87799176a102be9b454ac9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "patch": "@@ -1,3 +1,10 @@\n+2017-01-31  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/79264\n+\t* lambda.c (maybe_generic_this_capture): Deal with template-id-exprs.\n+\t* semantics.c (finish_member_declaration): Assert class is being\n+\tdefined.\n+\n 2017-01-30  Alexandre Oliva <aoliva@redhat.com>\n \n \tIntroduce C++ support in libcc1."}, {"sha": "46ab30f0a76df8f14c68bb87a26ccc9f47de953c", "filename": "gcc/cp/lambda.c", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Fcp%2Flambda.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Fcp%2Flambda.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flambda.c?ref=7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "patch": "@@ -849,13 +849,21 @@ maybe_generic_this_capture (tree object, tree fns)\n \t   interest.  */\n \tif (BASELINK_P (fns))\n \t  fns = BASELINK_FUNCTIONS (fns);\n+\tbool id_expr = TREE_CODE (fns) == TEMPLATE_ID_EXPR;\n+\tif (id_expr)\n+\t  fns = TREE_OPERAND (fns, 0);\n \tfor (; fns; fns = OVL_NEXT (fns))\n-\t  if (DECL_NONSTATIC_MEMBER_FUNCTION_P (OVL_CURRENT (fns)))\n-\t    {\n-\t      /* Found a non-static member.  Capture this.  */\n-\t      lambda_expr_this_capture (lam, true);\n-\t      break;\n-\t    }\n+\t  {\n+\t    tree fn = OVL_CURRENT (fns);\n+\n+\t    if ((!id_expr || TREE_CODE (fn) == TEMPLATE_DECL)\n+\t\t&& DECL_NONSTATIC_MEMBER_FUNCTION_P (fn))\n+\t      {\n+\t\t/* Found a non-static member.  Capture this.  */\n+\t\tlambda_expr_this_capture (lam, true);\n+\t\tbreak;\n+\t      }\n+\t  }\n       }\n }\n "}, {"sha": "e4f2a6a8807931a693654c18946dc2be7623be41", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "patch": "@@ -2962,6 +2962,12 @@ finish_member_declaration (tree decl)\n   /* We should see only one DECL at a time.  */\n   gcc_assert (DECL_CHAIN (decl) == NULL_TREE);\n \n+  /* Don't add decls after definition.  */\n+  gcc_assert (TYPE_BEING_DEFINED (current_class_type)\n+\t      /* We can add lambda types when late parsing default\n+\t\t arguments.  */\n+\t      || LAMBDA_TYPE_P (TREE_TYPE (decl)));\n+\n   /* Set up access control for DECL.  */\n   TREE_PRIVATE (decl)\n     = (current_access_specifier == access_private_node);"}, {"sha": "675c190bb1ac0a868661d4386dd5c5eb72134e7d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "patch": "@@ -1,3 +1,8 @@\n+2017-01-31  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/79264\n+\t* g++.dg/cpp1y/pr61636-1.C: Augment.\n+\n 2017-01-31  Christophe Lyon  <christophe.lyon@linaro.org>\n \n \t* gcc.dg/memcmp-1.c (static void test_driver_memcmp): Call"}, {"sha": "5cc8ca1d274edee009717d54abc5c6de9d567bbe", "filename": "gcc/testsuite/g++.dg/cpp1y/pr61636-1.C", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr61636-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f357c61640fc1558985eeca7a66cbe2c0f1ba0f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr61636-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1y%2Fpr61636-1.C?ref=7f357c61640fc1558985eeca7a66cbe2c0f1ba0f", "patch": "@@ -1,4 +1,5 @@\n // PR c++/61636\n+// PR c++/79264\n // { dg-do compile { target c++14 } }\n \n // ICE because we figure this capture too late.\n@@ -28,4 +29,8 @@ void A::b() {\n   auto lam2 = [&](auto asdf) { Baz (asdf); };\n \n   lam2 (0);\n+\n+  auto lam3 = [&](auto asdf) { Baz<int> (asdf); };\n+\n+  lam3 (0);\n }"}]}