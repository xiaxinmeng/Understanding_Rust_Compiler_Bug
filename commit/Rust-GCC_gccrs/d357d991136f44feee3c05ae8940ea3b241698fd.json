{"sha": "d357d991136f44feee3c05ae8940ea3b241698fd", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDM1N2Q5OTExMzZmNDRmZWVlM2MwNWFlODk0MGVhM2IyNDE2OThmZA==", "commit": {"author": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2012-08-02T19:10:38Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2012-08-02T19:10:38Z"}, "message": "iresolve.c (resolve_bound, [...]): Don't set the shape for assumed rank arrays.\n\n\t* iresolve.c (resolve_bound, gfc_resolve_shape):\n\tDon't set the shape for assumed rank arrays.\n\t* simplify.c (gfc_simplify_shape): Don't try to simplify if the\n\targument is assumed rank.\n\nFrom-SVN: r190094", "tree": {"sha": "496e4ca3cd80f27b6f5c9a64b4cfe5786e33ed06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/496e4ca3cd80f27b6f5c9a64b4cfe5786e33ed06"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d357d991136f44feee3c05ae8940ea3b241698fd", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d357d991136f44feee3c05ae8940ea3b241698fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d357d991136f44feee3c05ae8940ea3b241698fd", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d357d991136f44feee3c05ae8940ea3b241698fd/comments", "author": null, "committer": null, "parents": [{"sha": "742b0bcd66e1d8d40b19e33bf86764bbd3aa1744", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/742b0bcd66e1d8d40b19e33bf86764bbd3aa1744", "html_url": "https://github.com/Rust-GCC/gccrs/commit/742b0bcd66e1d8d40b19e33bf86764bbd3aa1744"}], "stats": {"total": 27, "additions": 22, "deletions": 5}, "files": [{"sha": "94bb958aa5f1998f00ef79639e18eefbfcde4d7e", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d357d991136f44feee3c05ae8940ea3b241698fd/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d357d991136f44feee3c05ae8940ea3b241698fd/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d357d991136f44feee3c05ae8940ea3b241698fd", "patch": "@@ -1,3 +1,10 @@\n+2012-08-02  Mikael Morin  <mikael@gcc.gnu.org>\n+\n+\t* iresolve.c (resolve_bound, gfc_resolve_shape):\n+\tDon't set the shape for assumed rank arrays.\n+\t* simplify.c (gfc_simplify_shape): Don't try to simplify if the\n+\targument is assumed rank.\n+\n 2012-08-02  Mikael Morin  <mikael@gcc.gnu.org>\n \n \t* array.c (gfc_copy_array_ref): Don't copy the offset field."}, {"sha": "3f981d88c1bd5b685ec281ed3531a80901486046", "filename": "gcc/fortran/iresolve.c", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d357d991136f44feee3c05ae8940ea3b241698fd/gcc%2Ffortran%2Firesolve.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d357d991136f44feee3c05ae8940ea3b241698fd/gcc%2Ffortran%2Firesolve.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Firesolve.c?ref=d357d991136f44feee3c05ae8940ea3b241698fd", "patch": "@@ -134,9 +134,12 @@ resolve_bound (gfc_expr *f, gfc_expr *array, gfc_expr *dim, gfc_expr *kind,\n   if (dim == NULL)\n     {\n       f->rank = 1;\n-      f->shape = gfc_get_shape (1);\n-      mpz_init_set_ui (f->shape[0], coarray ? gfc_get_corank (array)\n-\t\t\t\t\t    : array->rank);\n+      if (array->rank != -1)\n+\t{\n+\t  f->shape = gfc_get_shape (1);\n+\t  mpz_init_set_ui (f->shape[0], coarray ? gfc_get_corank (array)\n+\t\t\t\t\t\t: array->rank);\n+\t}\n     }\n \n   f->value.function.name = xstrdup (name);\n@@ -2225,8 +2228,12 @@ gfc_resolve_shape (gfc_expr *f, gfc_expr *array, gfc_expr *kind)\n     f->ts.kind = gfc_default_integer_kind;\n \n   f->rank = 1;\n-  f->shape = gfc_get_shape (1);\n-  mpz_init_set_ui (f->shape[0], array->rank);\n+  if (array->rank != -1)\n+    {\n+      f->shape = gfc_get_shape (1);\n+      mpz_init_set_ui (f->shape[0], array->rank);\n+    }\n+\n   f->value.function.name = gfc_get_string (PREFIX (\"shape_%d\"), f->ts.kind);\n }\n "}, {"sha": "e4ccddf967cb764577bc4b06db4b36666ef122b0", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d357d991136f44feee3c05ae8940ea3b241698fd/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d357d991136f44feee3c05ae8940ea3b241698fd/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=d357d991136f44feee3c05ae8940ea3b241698fd", "patch": "@@ -5470,6 +5470,9 @@ gfc_simplify_shape (gfc_expr *source, gfc_expr *kind)\n   gfc_try t;\n   int k = get_kind (BT_INTEGER, kind, \"SHAPE\", gfc_default_integer_kind);\n \n+  if (source->rank == -1)\n+    return NULL;\n+\n   result = gfc_get_array_expr (BT_INTEGER, k, &source->where);\n \n   if (source->rank == 0)"}]}