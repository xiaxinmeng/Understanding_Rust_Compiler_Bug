{"sha": "50ff02b534195c12298c64311d03a8b2d2dc261f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTBmZjAyYjUzNDE5NWMxMjI5OGM2NDMxMWQwM2E4YjJkMmRjMjYxZg==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-06-10T14:07:10Z"}, "committer": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2020-06-10T14:07:10Z"}, "message": "gcc-changelog: fix parse_git_name_status for renames.\n\nRenamed files are listed in the following format:\n\nM\tgcc/ada/Makefile.rtl\nM\tgcc/ada/impunit.adb\nR097\tgcc/ada/libgnat/s-atopar.adb\tgcc/ada/libgnat/s-aoinar.adb\nR095\tgcc/ada/libgnat/s-atopar.ads\tgcc/ada/libgnat/s-aoinar.ads\nA\tgcc/ada/libgnat/s-aomoar.adb\nA\tgcc/ada/libgnat/s-aomoar.ads\n\nSo 'R' is followed by a percentage number.\n\ncontrib/ChangeLog:\n\n\t* gcc-changelog/git_commit.py: Fix renamed files in\n\tparse_git_name_status.\n\t* gcc-changelog/test_email.py: Add test for it.", "tree": {"sha": "29d6a412d7b2d28cfc1fa7ac486ac059e419f9a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29d6a412d7b2d28cfc1fa7ac486ac059e419f9a8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/50ff02b534195c12298c64311d03a8b2d2dc261f", "comment_count": 0, "verification": {"verified": false, "reason": "unknown_key", "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEE6I4wzqqylQBfXaRhTcGC3A+nN4UFAl7g6WcACgkQTcGC3A+n\nN4V52ggAiQyT3PPQK+XedC7mwQrXvBtQeZRLAI9Bf6OI8j63JRVRcpNqim7XmWjr\nGYYILsIgrf4kpVYOFOW1fjpL7HrfU7c8TIChVtS1b9CRhk40bV5XIWbaZB7Ypfsg\n6xBVIAorGMyaE5CmOwKmbe0tNiy8ZMdBHVfscMyfyrguiCj5ARGULoTT03VAGVE6\nKvucCMAWF6edy0fKGF3bJTQyt/T+oJ65gzhFjjkuIkjw5qeQmoqF8hF3mJbD/aQJ\nzo2G//iGsjl7jG45jElRrezeMU5+7ZLxfOcKOUrc0LnJb7X7ikpZroYVT9KBdElG\nfFej5ISvhQzh3LFhlYG6llahtqbVxQ==\n=wB2a\n-----END PGP SIGNATURE-----", "payload": "tree 29d6a412d7b2d28cfc1fa7ac486ac059e419f9a8\nparent 4fed5d5dd85e3f5d812d125f692351646a0417cb\nauthor Martin Liska <mliska@suse.cz> 1591798030 +0200\ncommitter Martin Liska <mliska@suse.cz> 1591798030 +0200\n\ngcc-changelog: fix parse_git_name_status for renames.\n\nRenamed files are listed in the following format:\n\nM\tgcc/ada/Makefile.rtl\nM\tgcc/ada/impunit.adb\nR097\tgcc/ada/libgnat/s-atopar.adb\tgcc/ada/libgnat/s-aoinar.adb\nR095\tgcc/ada/libgnat/s-atopar.ads\tgcc/ada/libgnat/s-aoinar.ads\nA\tgcc/ada/libgnat/s-aomoar.adb\nA\tgcc/ada/libgnat/s-aomoar.ads\n\nSo 'R' is followed by a percentage number.\n\ncontrib/ChangeLog:\n\n\t* gcc-changelog/git_commit.py: Fix renamed files in\n\tparse_git_name_status.\n\t* gcc-changelog/test_email.py: Add test for it.\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50ff02b534195c12298c64311d03a8b2d2dc261f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50ff02b534195c12298c64311d03a8b2d2dc261f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50ff02b534195c12298c64311d03a8b2d2dc261f/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4fed5d5dd85e3f5d812d125f692351646a0417cb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fed5d5dd85e3f5d812d125f692351646a0417cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4fed5d5dd85e3f5d812d125f692351646a0417cb"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "e868e02822505896a9f4e3da5039ae01220b2514", "filename": "contrib/gcc-changelog/git_commit.py", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50ff02b534195c12298c64311d03a8b2d2dc261f/contrib%2Fgcc-changelog%2Fgit_commit.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50ff02b534195c12298c64311d03a8b2d2dc261f/contrib%2Fgcc-changelog%2Fgit_commit.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Fgit_commit.py?ref=50ff02b534195c12298c64311d03a8b2d2dc261f", "patch": "@@ -322,7 +322,7 @@ def parse_git_name_status(cls, string):\n             t = parts[0]\n             if t == 'A' or t == 'D' or t == 'M':\n                 modified_files.append((parts[1], t))\n-            elif t == 'R':\n+            elif t.startswith('R'):\n                 modified_files.append((parts[1], 'D'))\n                 modified_files.append((parts[2], 'A'))\n         return modified_files"}, {"sha": "a185b85e8380c3b6dc6869c89e344a8bb2e60491", "filename": "contrib/gcc-changelog/test_email.py", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/50ff02b534195c12298c64311d03a8b2d2dc261f/contrib%2Fgcc-changelog%2Ftest_email.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/50ff02b534195c12298c64311d03a8b2d2dc261f/contrib%2Fgcc-changelog%2Ftest_email.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-changelog%2Ftest_email.py?ref=50ff02b534195c12298c64311d03a8b2d2dc261f", "patch": "@@ -20,6 +20,8 @@\n import tempfile\n import unittest\n \n+from git_commit import GitCommit\n+\n from git_email import GitEmail\n \n import unidiff\n@@ -29,6 +31,12 @@\n unidiff_supports_renaming = hasattr(unidiff.PatchedFile(), 'is_rename')\n \n \n+NAME_STATUS1 = \"\"\"\n+M\tgcc/ada/impunit.adb'\n+R097\tgcc/ada/libgnat/s-atopar.adb\tgcc/ada/libgnat/s-aoinar.adb\n+\"\"\"\n+\n+\n class TestGccChangelog(unittest.TestCase):\n     def setUp(self):\n         self.patches = {}\n@@ -337,3 +345,9 @@ def test_not_deduce(self):\n         email = self.from_patch_glob('0001-configure.patch')\n         assert not email.errors\n         assert len(email.changelog_entries) == 2\n+\n+    def test_parse_git_name_status(self):\n+        modified_files = GitCommit.parse_git_name_status(NAME_STATUS1)\n+        assert len(modified_files) == 3\n+        assert modified_files[1] == ('gcc/ada/libgnat/s-atopar.adb', 'D')\n+        assert modified_files[2] == ('gcc/ada/libgnat/s-aoinar.adb', 'A')"}]}