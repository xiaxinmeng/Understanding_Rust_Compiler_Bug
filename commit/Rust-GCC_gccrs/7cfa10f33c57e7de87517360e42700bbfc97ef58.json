{"sha": "7cfa10f33c57e7de87517360e42700bbfc97ef58", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2NmYTEwZjMzYzU3ZTdkZTg3NTE3MzYwZTQyNzAwYmJmYzk3ZWY1OA==", "commit": {"author": {"name": "Maxim Ostapenko", "email": "m.ostapenko@samsung.com", "date": "2016-06-10T12:57:14Z"}, "committer": {"name": "Maxim Ostapenko", "email": "chefmax@gcc.gnu.org", "date": "2016-06-10T12:57:14Z"}, "message": "re PR sanitizer/71480 (ASan should align string constants to shadow granularity.)\n\n2016-06-10  Maxim Ostapenko  <m.ostapenko@samsung.com>\n\n\tPR sanitizer/71480\n\t* varasm.c (place_block_symbol): Adjust alignment for asan protected\n\tSTRING_CSTs even if TREE_CONSTANT_POOL_ADDRESS_P.\n\n\t* c-c++-common/asan/pr71480.c: New test.\n\nFrom-SVN: r237306", "tree": {"sha": "7eeb6904969950f8b4667881368ec5fae1d03df8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7eeb6904969950f8b4667881368ec5fae1d03df8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7cfa10f33c57e7de87517360e42700bbfc97ef58", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cfa10f33c57e7de87517360e42700bbfc97ef58", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7cfa10f33c57e7de87517360e42700bbfc97ef58", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7cfa10f33c57e7de87517360e42700bbfc97ef58/comments", "author": null, "committer": null, "parents": [{"sha": "aade5c72c6adb395d2bddb0d08c6626d537a1714", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aade5c72c6adb395d2bddb0d08c6626d537a1714", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aade5c72c6adb395d2bddb0d08c6626d537a1714"}], "stats": {"total": 59, "additions": 58, "deletions": 1}, "files": [{"sha": "73ba814f135b914104a539ef20ab38ba16b0691c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7cfa10f33c57e7de87517360e42700bbfc97ef58", "patch": "@@ -1,3 +1,9 @@\n+2016-06-10  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR sanitizer/71480\n+\t* varasm.c (place_block_symbol): Adjust alignment for asan protected\n+\tSTRING_CSTs even if TREE_CONSTANT_POOL_ADDRESS_P.\n+\n 2016-06-10  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* profile.c: Include cfgloop.h."}, {"sha": "19f379340233c4e71bcad7524b82f94cc6ea7905", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7cfa10f33c57e7de87517360e42700bbfc97ef58", "patch": "@@ -1,3 +1,8 @@\n+2016-06-10  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR sanitizer/71480\n+\t* c-c++-common/asan/pr71480.c: New test.\n+\n 2016-06-10  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.dg/guality/pr68037-1.c (ASMNAME): New."}, {"sha": "c23ea5385b490916882bb9a8c9076e2c317d7556", "filename": "gcc/testsuite/c-c++-common/asan/pr71480.c", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fpr71480.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fpr71480.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fpr71480.c?ref=7cfa10f33c57e7de87517360e42700bbfc97ef58", "patch": "@@ -0,0 +1,42 @@\n+/* { dg-do run } */\n+\n+__attribute__ ((noinline, noclone)) int\n+foo (char *c)\n+{\n+  asm volatile (\"\" : : \"r\" (c) : \"memory\");\n+  return 1;\n+}\n+\n+__attribute__ ((noinline, noclone)) void\n+bar (char *c)\n+{\n+  asm volatile (\"\" : : \"r\" (c) : \"memory\");\n+}\n+\n+int main ()\n+{\n+  char tpl[20] = \"/tmp/test.XXXXXX\";\n+  char tpl2[20] = \"/tmp/test.XXXXXX\";\n+  int fd = foo (tpl);\n+  int fd2 = foo (tpl2);\n+  if (fd == -1)\n+    {\n+      if (fd2 != -1)\n+\t bar (tpl2);\n+      return 1;\n+    }\n+\n+  if (fd2 == -1)\n+    return 1;\n+\n+  bar (tpl);\n+  bar (tpl2);\n+\n+  if (__builtin_strcmp (tpl, \"/tmp/test.XXXXXX\") != 0)\n+    return 1;\n+\n+  if (__builtin_strcmp (tpl, tpl2) != 0)\n+    return 1;\n+\n+   return 0;\n+}"}, {"sha": "de8bcd6f20c823acd03991f813da3521b80547ff", "filename": "gcc/varasm.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7cfa10f33c57e7de87517360e42700bbfc97ef58/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=7cfa10f33c57e7de87517360e42700bbfc97ef58", "patch": "@@ -7201,7 +7201,11 @@ place_block_symbol (rtx symbol)\n       if ((flag_sanitize & SANITIZE_ADDRESS)\n \t  && TREE_CODE (DECL_INITIAL (decl)) == STRING_CST\n \t  && asan_protect_global (DECL_INITIAL (decl)))\n-\tsize += asan_red_zone_size (size);\n+\t{\n+\t  size += asan_red_zone_size (size);\n+\t  alignment = MAX (alignment,\n+\t\t\t   ASAN_RED_ZONE_SIZE * BITS_PER_UNIT);\n+\t}\n     }\n   else\n     {"}]}