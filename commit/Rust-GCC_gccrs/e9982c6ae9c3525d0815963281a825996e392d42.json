{"sha": "e9982c6ae9c3525d0815963281a825996e392d42", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTk5ODJjNmFlOWMzNTI1ZDA4MTU5NjMyODFhODI1OTk2ZTM5MmQ0Mg==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2017-09-06T09:25:00Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2017-09-06T09:25:00Z"}, "message": "Enqueue all SRA links for write flag propagation\n\n2017-09-06  Martin Jambor  <mjambor@suse.cz>\n\n\tPR tree-optimization/82078\ngcc/\n\t* tree-sra.c (sort_and_splice_var_accesses): Move call to\n\tadd_access_to_work_queue...\n\t(build_accesses_from_assign): ...here.\n\t(propagate_all_subaccesses): Make sure racc is the group\n\trepresentative, if there is one.\n\ngcc/testsuite/\n\t* gcc.dg/tree-ssa/pr82078.c: New test.\n\nFrom-SVN: r251756", "tree": {"sha": "b1a1cc1aa54de0f4c913401af9eb5b8e08779489", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1a1cc1aa54de0f4c913401af9eb5b8e08779489"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e9982c6ae9c3525d0815963281a825996e392d42", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9982c6ae9c3525d0815963281a825996e392d42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9982c6ae9c3525d0815963281a825996e392d42", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9982c6ae9c3525d0815963281a825996e392d42/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c7a494c99b4a421f6b80af834adb0d4c703d47a5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7a494c99b4a421f6b80af834adb0d4c703d47a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7a494c99b4a421f6b80af834adb0d4c703d47a5"}], "stats": {"total": 46, "additions": 45, "deletions": 1}, "files": [{"sha": "50c61063083e61aff4fb604e75bc61053478f872", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e9982c6ae9c3525d0815963281a825996e392d42", "patch": "@@ -1,3 +1,12 @@\n+2017-09-06  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/82078\n+\t* tree-sra.c (sort_and_splice_var_accesses): Move call to\n+\tadd_access_to_work_queue...\n+\t(build_accesses_from_assign): ...here.\n+\t(propagate_all_subaccesses): Make sure racc is the group\n+\trepresentative, if there is one.\n+\n 2017-09-06  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/82095"}, {"sha": "75f6f89f567d20de52a008293f069ff095dd8247", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e9982c6ae9c3525d0815963281a825996e392d42", "patch": "@@ -1,3 +1,8 @@\n+2017-09-06  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/82078\n+\t* gcc.dg/tree-ssa/pr82078.c: New test.\n+\n 2017-09-06  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/82095"}, {"sha": "3774986324bf5dec634a273e813667dbfadbeefa", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr82078.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr82078.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr82078.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr82078.c?ref=e9982c6ae9c3525d0815963281a825996e392d42", "patch": "@@ -0,0 +1,27 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O\" } */\n+\n+struct S0 {\n+  signed f4;\n+  signed f9 : 5;\n+} a[6][5], b = {2}\n+\n+;\n+int c, d;\n+int fn1() {\n+  struct S0 e[5][6];\n+  struct S0 f;\n+  b = f = e[2][5] = a[5][0];\n+  if (d)\n+    ;\n+  else\n+    return f.f9;\n+  e[c][45] = a[4][4];\n+}\n+\n+int main() {\n+  fn1();\n+  if (b.f4 != 0)\n+    __builtin_abort ();\n+  return 0;\n+}"}, {"sha": "163b7a2d03b27a6527c735019b9812e58419b982", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9982c6ae9c3525d0815963281a825996e392d42/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=e9982c6ae9c3525d0815963281a825996e392d42", "patch": "@@ -1359,6 +1359,8 @@ build_accesses_from_assign (gimple *stmt)\n       link->lacc = lacc;\n       link->racc = racc;\n       add_link_to_rhs (racc, link);\n+      add_access_to_work_queue (racc);\n+\n       /* Let's delay marking the areas as written until propagation of accesses\n \t across link, unless the nature of rhs tells us that its data comes\n \t from elsewhere.  */\n@@ -2118,7 +2120,6 @@ sort_and_splice_var_accesses (tree var)\n       access->grp_total_scalarization = total_scalarization;\n       access->grp_partial_lhs = grp_partial_lhs;\n       access->grp_unscalarizable_region = unscalarizable_region;\n-      add_access_to_work_queue (access);\n \n       *prev_acc_ptr = access;\n       prev_acc_ptr = &access->next_grp;\n@@ -2712,6 +2713,8 @@ propagate_all_subaccesses (void)\n       struct access *racc = pop_access_from_work_queue ();\n       struct assign_link *link;\n \n+      if (racc->group_representative)\n+\tracc= racc->group_representative;\n       gcc_assert (racc->first_link);\n \n       for (link = racc->first_link; link; link = link->next)"}]}