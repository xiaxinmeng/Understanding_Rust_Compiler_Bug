{"sha": "33237e93d59ee7bb215cd5b726880bcbd679bb36", "node_id": "C_kwDOANBUbNoAKDMzMjM3ZTkzZDU5ZWU3YmIyMTVjZDViNzI2ODgwYmNiZDY3OWJiMzY", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-01-18T14:27:55Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2023-01-18T21:47:58Z"}, "message": "libstdc++: Deprecate std::filesystem::u8path for C++20\n\nP0482R6 deprecated these functions for C++20. There was a ballot comment\non the C++23 CD saying to un-deprecate it, but LEWG just rejected that,\nso let's add attributes to deprecate them.\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/bits/fs_path.h (u8path): Add deprecated attribute.\n\t* testsuite/27_io/filesystem/path/construct/90281.cc: Add\n\t-Wno-deprecated-declarations for C++20 and later.\n\t* testsuite/27_io/filesystem/path/factory/u8path-char8_t.cc:\n\tLikewise.\n\t* testsuite/27_io/filesystem/path/factory/u8path.cc: Likewise.\n\t* testsuite/27_io/filesystem/path/native/string.cc: Likewise.\n\t* testsuite/27_io/filesystem/path/factory/u8path-depr.cc: New test.", "tree": {"sha": "7af228b8a2e835bd63fcf3c09d70460177270405", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7af228b8a2e835bd63fcf3c09d70460177270405"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/33237e93d59ee7bb215cd5b726880bcbd679bb36", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33237e93d59ee7bb215cd5b726880bcbd679bb36", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33237e93d59ee7bb215cd5b726880bcbd679bb36", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33237e93d59ee7bb215cd5b726880bcbd679bb36/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "26c68b8c31f637cc01f4bf511f9a0ca714231161", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/26c68b8c31f637cc01f4bf511f9a0ca714231161", "html_url": "https://github.com/Rust-GCC/gccrs/commit/26c68b8c31f637cc01f4bf511f9a0ca714231161"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "1cbfaaa542790d268307b913e14de579fd8f461e", "filename": "libstdc++-v3/include/bits/fs_path.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffs_path.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffs_path.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Ffs_path.h?ref=33237e93d59ee7bb215cd5b726880bcbd679bb36", "patch": "@@ -808,6 +808,7 @@ namespace __detail\n \t   typename _Require = __detail::_Path2<_InputIterator>,\n \t   typename _CharT\n \t     = __detail::__value_type_is_char_or_char8_t<_InputIterator>>\n+    _GLIBCXX20_DEPRECATED_SUGGEST(\"path(u8string(first, last))\")\n     inline path\n     u8path(_InputIterator __first, _InputIterator __last)\n     {\n@@ -830,6 +831,7 @@ namespace __detail\n   template<typename _Source,\n \t   typename _Require = __detail::_Path<_Source>,\n \t   typename _CharT = __detail::__value_type_is_char_or_char8_t<_Source>>\n+    _GLIBCXX20_DEPRECATED_SUGGEST(\"path((const char8_t*)&*source)\")\n     inline path\n     u8path(const _Source& __source)\n     {"}, {"sha": "d26b5e15b298607d75e7587a9db89370678d066c", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/construct/90281.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fconstruct%2F90281.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fconstruct%2F90281.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fconstruct%2F90281.cc?ref=33237e93d59ee7bb215cd5b726880bcbd679bb36", "patch": "@@ -16,6 +16,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do run { target c++17 } }\n+// { dg-additional-options \"-Wno-deprecated-declarations\" { target c++20 } }\n \n #include <filesystem>\n #include <testsuite_hooks.h>"}, {"sha": "eff95c18bdfb5d083718f658311d2cdf1bdb87e8", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/factory/u8path-char8_t.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path-char8_t.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path-char8_t.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path-char8_t.cc?ref=33237e93d59ee7bb215cd5b726880bcbd679bb36", "patch": "@@ -17,6 +17,7 @@\n \n // { dg-options \"-fchar8_t -Wno-stringop-overread\" }\n // { dg-do run { target c++17 } }\n+// { dg-additional-options \"-Wno-deprecated-declarations\" { target c++20 } }\n \n #include <filesystem>\n #include <string_view>"}, {"sha": "de54668c05521024c50f32052dcd6ea0affe8799", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/factory/u8path-depr.cc", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path-depr.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path-depr.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path-depr.cc?ref=33237e93d59ee7bb215cd5b726880bcbd679bb36", "patch": "@@ -0,0 +1,16 @@\n+// { dg-options \"-std=gnu++20\" }\n+// { dg-do compile { target c++20 } }\n+\n+#include <filesystem>\n+\n+namespace fs = std::filesystem;\n+\n+const char* s = \"\";\n+auto p1 = fs::u8path(s); // { dg-warning \"deprecated\" }\n+auto p2 = fs::u8path(s, s); // { dg-warning \"deprecated\" }\n+\n+#if __cpp_lib_char8_t\n+const char8_t* u = u8\"\";\n+auto p3 = fs::u8path(u); // { dg-warning \"deprecated\" }\n+auto p4 = fs::u8path(u, u); // { dg-warning \"deprecated\" }\n+#endif"}, {"sha": "4c41fc28da9e2caff6e56be21c9ad92cb4be95dd", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/factory/u8path.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Ffactory%2Fu8path.cc?ref=33237e93d59ee7bb215cd5b726880bcbd679bb36", "patch": "@@ -16,6 +16,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do run { target c++17 } }\n+// { dg-additional-options \"-Wno-deprecated-declarations\" { target c++20 } }\n \n #include <filesystem>\n #include <string_view>"}, {"sha": "d5942c9beaac59ef6728d881c83ec68fd258dd36", "filename": "libstdc++-v3/testsuite/27_io/filesystem/path/native/string.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fnative%2Fstring.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33237e93d59ee7bb215cd5b726880bcbd679bb36/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fnative%2Fstring.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F27_io%2Ffilesystem%2Fpath%2Fnative%2Fstring.cc?ref=33237e93d59ee7bb215cd5b726880bcbd679bb36", "patch": "@@ -16,6 +16,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do run { target c++17 } }\n+// { dg-additional-options \"-Wno-deprecated-declarations\" { target c++20 } }\n \n #include <filesystem>\n #include <string>"}]}