{"sha": "4f6843aa8c8a7216d0949c7ecf3d3f973222195a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY2ODQzYWE4YzhhNzIxNmQwOTQ5YzdlY2YzZDNmOTczMjIyMTk1YQ==", "commit": {"author": {"name": "Xinliang David Li", "email": "davidxl@google.com", "date": "2013-12-04T19:46:36Z"}, "committer": {"name": "Xinliang David Li", "email": "davidxl@gcc.gnu.org", "date": "2013-12-04T19:46:36Z"}, "message": "Update changed bit when constraint set changes\n\nFrom-SVN: r205677", "tree": {"sha": "39741fbe98131f4e88af36ea392030b4bf0d6a02", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/39741fbe98131f4e88af36ea392030b4bf0d6a02"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f6843aa8c8a7216d0949c7ecf3d3f973222195a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f6843aa8c8a7216d0949c7ecf3d3f973222195a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f6843aa8c8a7216d0949c7ecf3d3f973222195a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f6843aa8c8a7216d0949c7ecf3d3f973222195a/comments", "author": {"login": "vns-mn", "id": 57157229, "node_id": "MDQ6VXNlcjU3MTU3MjI5", "avatar_url": "https://avatars.githubusercontent.com/u/57157229?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vns-mn", "html_url": "https://github.com/vns-mn", "followers_url": "https://api.github.com/users/vns-mn/followers", "following_url": "https://api.github.com/users/vns-mn/following{/other_user}", "gists_url": "https://api.github.com/users/vns-mn/gists{/gist_id}", "starred_url": "https://api.github.com/users/vns-mn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vns-mn/subscriptions", "organizations_url": "https://api.github.com/users/vns-mn/orgs", "repos_url": "https://api.github.com/users/vns-mn/repos", "events_url": "https://api.github.com/users/vns-mn/events{/privacy}", "received_events_url": "https://api.github.com/users/vns-mn/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d80608d0349977db5af3bae45221d25a318785c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d80608d0349977db5af3bae45221d25a318785c7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d80608d0349977db5af3bae45221d25a318785c7"}], "stats": {"total": 36, "additions": 28, "deletions": 8}, "files": [{"sha": "320f186477f530864e41764c4780c0594577d92b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f6843aa8c8a7216d0949c7ecf3d3f973222195a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f6843aa8c8a7216d0949c7ecf3d3f973222195a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4f6843aa8c8a7216d0949c7ecf3d3f973222195a", "patch": "@@ -1,3 +1,10 @@\n+2013-12-03  Xinliang David Li  <davidxl@google.com>\n+\n+\t* tree-ssa-structalias.c (constraint_set_union): Change return type\n+\tfrom void to bool.\n+\t(merge_node_constraints): Ditto.\n+\t(unify_nodes): Update changed set when constraints set changes.\n+\n 2013-12-04  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* configure.ac: Append gdbasan.in to .gdbinit if CFLAGS contains"}, {"sha": "16679f41ce942c00caefe798bdbbec53aec19a2d", "filename": "gcc/tree-ssa-structalias.c", "status": "modified", "additions": 21, "deletions": 8, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f6843aa8c8a7216d0949c7ecf3d3f973222195a/gcc%2Ftree-ssa-structalias.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f6843aa8c8a7216d0949c7ecf3d3f973222195a/gcc%2Ftree-ssa-structalias.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-structalias.c?ref=4f6843aa8c8a7216d0949c7ecf3d3f973222195a", "patch": "@@ -892,23 +892,27 @@ constraint_vec_find (vec<constraint_t> vec,\n   return found;\n }\n \n-/* Union two constraint vectors, TO and FROM.  Put the result in TO.  */\n+/* Union two constraint vectors, TO and FROM.  Put the result in TO. \n+   Returns true of TO set is changed.  */\n \n-static void\n+static bool\n constraint_set_union (vec<constraint_t> *to,\n \t\t      vec<constraint_t> *from)\n {\n   int i;\n   constraint_t c;\n+  bool any_change = false;\n \n   FOR_EACH_VEC_ELT (*from, i, c)\n     {\n       if (constraint_vec_find (*to, *c) == NULL)\n \t{\n \t  unsigned int place = to->lower_bound (c, constraint_less);\n \t  to->safe_insert (place, c);\n+          any_change = true;\n \t}\n     }\n+  return any_change;\n }\n \n /* Expands the solution in SET to all sub-fields of variables included.  */\n@@ -1028,22 +1032,24 @@ insert_into_complex (constraint_graph_t graph,\n \n \n /* Condense two variable nodes into a single variable node, by moving\n-   all associated info from SRC to TO.  */\n+   all associated info from FROM to TO. Returns true if TO node's \n+   constraint set changes after the merge.  */\n \n-static void\n+static bool\n merge_node_constraints (constraint_graph_t graph, unsigned int to,\n \t\t\tunsigned int from)\n {\n   unsigned int i;\n   constraint_t c;\n+  bool any_change = false;\n \n   gcc_checking_assert (find (from) == to);\n \n   /* Move all complex constraints from src node into to node  */\n   FOR_EACH_VEC_ELT (graph->complex[from], i, c)\n     {\n-      /* In complex constraints for node src, we may have either\n-\t a = *src, and *src = a, or an offseted constraint which are\n+      /* In complex constraints for node FROM, we may have either\n+\t a = *FROM, and *FROM = a, or an offseted constraint which are\n \t always added to the rhs node's constraints.  */\n \n       if (c->rhs.type == DEREF)\n@@ -1052,9 +1058,12 @@ merge_node_constraints (constraint_graph_t graph, unsigned int to,\n \tc->lhs.var = to;\n       else\n \tc->rhs.var = to;\n+\n     }\n-  constraint_set_union (&graph->complex[to], &graph->complex[from]);\n+  any_change = constraint_set_union (&graph->complex[to],\n+\t\t\t\t     &graph->complex[from]);\n   graph->complex[from].release ();\n+  return any_change;\n }\n \n \n@@ -1472,7 +1481,11 @@ unify_nodes (constraint_graph_t graph, unsigned int to, unsigned int from,\n     stats.unified_vars_static++;\n \n   merge_graph_nodes (graph, to, from);\n-  merge_node_constraints (graph, to, from);\n+  if (merge_node_constraints (graph, to, from))\n+    {\n+      if (update_changed)\n+\tbitmap_set_bit (changed, to);\n+    }\n \n   /* Mark TO as changed if FROM was changed. If TO was already marked\n      as changed, decrease the changed count.  */"}]}