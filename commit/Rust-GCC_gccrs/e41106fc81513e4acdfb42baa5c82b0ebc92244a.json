{"sha": "e41106fc81513e4acdfb42baa5c82b0ebc92244a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTQxMTA2ZmM4MTUxM2U0YWNkZmI0MmJhYTVjODJiMGViYzkyMjQ0YQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2014-03-19T11:35:59Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2014-03-19T11:35:59Z"}, "message": "lto.c (lto_wpa_write_files): Move call to lto_promote_cross_file_statics ...\n\n2014-03-19  Richard Biener  <rguenther@suse.de>\n\n\t* lto.c (lto_wpa_write_files): Move call to\n\tlto_promote_cross_file_statics ...\n\t(do_whole_program_analysis): ... here, into the partitioning\n\tblock.  Do not ggc_collect after lto_wpa_write_files but\n\tfor a last time before it.\n\nFrom-SVN: r208679", "tree": {"sha": "98d450ba0f0a5224ee12be421db311ac7e1a25a3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/98d450ba0f0a5224ee12be421db311ac7e1a25a3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e41106fc81513e4acdfb42baa5c82b0ebc92244a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e41106fc81513e4acdfb42baa5c82b0ebc92244a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e41106fc81513e4acdfb42baa5c82b0ebc92244a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e41106fc81513e4acdfb42baa5c82b0ebc92244a/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8c9cfbe630d539a250f3018976ae6f47202f8667", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c9cfbe630d539a250f3018976ae6f47202f8667", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c9cfbe630d539a250f3018976ae6f47202f8667"}], "stats": {"total": 27, "additions": 19, "deletions": 8}, "files": [{"sha": "101fbfb7b2598defa41eb2f80039c40af360f5ba", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e41106fc81513e4acdfb42baa5c82b0ebc92244a/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e41106fc81513e4acdfb42baa5c82b0ebc92244a/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=e41106fc81513e4acdfb42baa5c82b0ebc92244a", "patch": "@@ -1,3 +1,11 @@\n+2014-03-19  Richard Biener  <rguenther@suse.de>\n+\n+\t* lto.c (lto_wpa_write_files): Move call to\n+\tlto_promote_cross_file_statics ...\n+\t(do_whole_program_analysis): ... here, into the partitioning\n+\tblock.  Do not ggc_collect after lto_wpa_write_files but\n+\tfor a last time before it.\n+\n 2014-03-19  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR lto/60571"}, {"sha": "df9f031518af0dbf4bdf5e97557dd0db29871be5", "filename": "gcc/lto/lto.c", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e41106fc81513e4acdfb42baa5c82b0ebc92244a/gcc%2Flto%2Flto.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e41106fc81513e4acdfb42baa5c82b0ebc92244a/gcc%2Flto%2Flto.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto.c?ref=e41106fc81513e4acdfb42baa5c82b0ebc92244a", "patch": "@@ -2568,11 +2568,6 @@ lto_wpa_write_files (void)\n   FOR_EACH_VEC_ELT (ltrans_partitions, i, part)\n     lto_stats.num_output_symtab_nodes += lto_symtab_encoder_size (part->encoder);\n \n-  /* Find out statics that need to be promoted\n-     to globals with hidden visibility because they are accessed from multiple\n-     partitions.  */\n-  lto_promote_cross_file_statics ();\n-\n   timevar_pop (TV_WHOPR_WPA);\n \n   timevar_push (TV_WHOPR_WPA_IO);\n@@ -3284,11 +3279,21 @@ do_whole_program_analysis (void)\n     node->aux = NULL;\n \n   lto_stats.num_cgraph_partitions += ltrans_partitions.length ();\n+\n+  /* Find out statics that need to be promoted\n+     to globals with hidden visibility because they are accessed from multiple\n+     partitions.  */\n+  lto_promote_cross_file_statics ();\n   timevar_pop (TV_WHOPR_PARTITIONING);\n \n   timevar_stop (TV_PHASE_OPT_GEN);\n-  timevar_start (TV_PHASE_STREAM_OUT);\n \n+  /* Collect a last time - in lto_wpa_write_files we may end up forking\n+     with the idea that this doesn't increase memory usage.  So we\n+     absoultely do not want to collect after that.  */\n+  ggc_collect ();\n+\n+  timevar_start (TV_PHASE_STREAM_OUT);\n   if (!quiet_flag)\n     {\n       fprintf (stderr, \"\\nStreaming out\");\n@@ -3297,10 +3302,8 @@ do_whole_program_analysis (void)\n   lto_wpa_write_files ();\n   if (!quiet_flag)\n     fprintf (stderr, \"\\n\");\n-\n   timevar_stop (TV_PHASE_STREAM_OUT);\n \n-  ggc_collect ();\n   if (post_ipa_mem_report)\n     {\n       fprintf (stderr, \"Memory consumption after IPA\\n\");"}]}