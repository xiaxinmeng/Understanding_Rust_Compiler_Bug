{"sha": "d90ec4f2bc82f513821be7054b1eeb5c200e81af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDkwZWM0ZjJiYzgyZjUxMzgyMWJlNzA1NGIxZWViNWMyMDBlODFhZg==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2015-10-28T18:54:48Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2015-10-28T18:54:48Z"}, "message": "* c-common.c (pointer_int_sum): Fold the MULT_EXPR.\n\nFrom-SVN: r229500", "tree": {"sha": "635b63931eff5f7c9588deaa1ee992fb3b36ee91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/635b63931eff5f7c9588deaa1ee992fb3b36ee91"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d90ec4f2bc82f513821be7054b1eeb5c200e81af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d90ec4f2bc82f513821be7054b1eeb5c200e81af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d90ec4f2bc82f513821be7054b1eeb5c200e81af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d90ec4f2bc82f513821be7054b1eeb5c200e81af/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a6392fdc0b4210929c40be82e93184a20dba2766", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6392fdc0b4210929c40be82e93184a20dba2766", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6392fdc0b4210929c40be82e93184a20dba2766"}], "stats": {"total": 16, "additions": 12, "deletions": 4}, "files": [{"sha": "fb017fa464e0ad3adf2c6cfe05bd1339361c45d3", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d90ec4f2bc82f513821be7054b1eeb5c200e81af/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d90ec4f2bc82f513821be7054b1eeb5c200e81af/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=d90ec4f2bc82f513821be7054b1eeb5c200e81af", "patch": "@@ -1,3 +1,7 @@\n+2015-10-28  Jason Merrill  <jason@redhat.com>\n+\n+\t* c-common.c (pointer_int_sum): Fold the MULT_EXPR.\n+\n 2015-10-27  Thomas Schwinge  <thomas@codesourcery.com>\n \t    James Norris  <jnorris@codesourcery.com>\n \t    Cesar Philippidis  <cesar@codesourcery.com>"}, {"sha": "f957018845bf19995bff242555684bb042d2addf", "filename": "gcc/c-family/c-common.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d90ec4f2bc82f513821be7054b1eeb5c200e81af/gcc%2Fc-family%2Fc-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d90ec4f2bc82f513821be7054b1eeb5c200e81af/gcc%2Fc-family%2Fc-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-common.c?ref=d90ec4f2bc82f513821be7054b1eeb5c200e81af", "patch": "@@ -4849,9 +4849,8 @@ pointer_int_sum (location_t loc, enum tree_code resultcode,\n      for the pointer operation and disregard an overflow that occurred only\n      because of the sign-extension change in the latter conversion.  */\n   {\n-    tree t = build_binary_op (loc,\n-\t\t\t      MULT_EXPR, intop,\n-\t\t\t      convert (TREE_TYPE (intop), size_exp), 1);\n+    tree t = fold_build2_loc (loc, MULT_EXPR, TREE_TYPE (intop), intop,\n+\t\t\t      convert (TREE_TYPE (intop), size_exp));\n     intop = convert (sizetype, t);\n     if (TREE_OVERFLOW_P (intop) && !TREE_OVERFLOW (t))\n       intop = wide_int_to_tree (TREE_TYPE (intop), intop);"}, {"sha": "35e2b11ef96b74408a27cfa3ed15091d92348383", "filename": "gcc/testsuite/gcc.dg/pointer-arith-10.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d90ec4f2bc82f513821be7054b1eeb5c200e81af/gcc%2Ftestsuite%2Fgcc.dg%2Fpointer-arith-10.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d90ec4f2bc82f513821be7054b1eeb5c200e81af/gcc%2Ftestsuite%2Fgcc.dg%2Fpointer-arith-10.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpointer-arith-10.c?ref=d90ec4f2bc82f513821be7054b1eeb5c200e81af", "patch": "@@ -6,4 +6,9 @@ char *foo(char *p, __UINTPTR_TYPE__ i)\n   return (char *)i + (__UINTPTR_TYPE__)p;\n }\n \n-/* { dg-final { scan-tree-dump \"p +\" \"original\" } } */\n+/* Check that we use a POINTER_PLUS_EXPR, not something like\n+   return (char *) ((sizetype) p + (sizetype) i); */\n+/* { dg-final { scan-tree-dump-not \"sizetype.*sizetype\" \"original\" } } */\n+\n+/* And also that we don't swap the operands.  */\n+/* { dg-final { scan-tree-dump-not \"return p +\" \"original\" } } */"}]}