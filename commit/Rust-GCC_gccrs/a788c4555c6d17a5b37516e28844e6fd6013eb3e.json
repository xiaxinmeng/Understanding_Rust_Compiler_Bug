{"sha": "a788c4555c6d17a5b37516e28844e6fd6013eb3e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTc4OGM0NTU1YzZkMTdhNWIzNzUxNmUyODg0NGU2ZmQ2MDEzZWIzZQ==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2020-09-26T09:15:28Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2020-10-10T16:04:45Z"}, "message": "Objective-C, Darwin : Use special string sections for V2 NeXT runtime.\n\nNewer versions of the runtime expect to find strings for class, method\nand method types in set-aside sections rather than the general c_strings\none.\n\ngcc/ChangeLog:\n\n\t* config/darwin-sections.def (objc2_class_names_section,\n\tobjc2_method_names_section, objc2_method_types_section): New\n\t* config/darwin.c (output_objc_section_asm_op): Output new\n\tsections.  (darwin_objc2_section): Select new sections where\n\tused.\n\ngcc/objc/ChangeLog:\n\n\t* objc-next-runtime-abi-02.c\n\t(next_runtime_abi_02_init_metadata_attributes): Attach metadata\n\tfor the special string sections to class, method and method type\n\tstring sections.", "tree": {"sha": "f33fa20c14b152ec1f1f8756d111edb63c3110bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f33fa20c14b152ec1f1f8756d111edb63c3110bd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a788c4555c6d17a5b37516e28844e6fd6013eb3e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a788c4555c6d17a5b37516e28844e6fd6013eb3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a788c4555c6d17a5b37516e28844e6fd6013eb3e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a788c4555c6d17a5b37516e28844e6fd6013eb3e/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "900c0ca22673ec4d382ce588057de240f887be3a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/900c0ca22673ec4d382ce588057de240f887be3a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/900c0ca22673ec4d382ce588057de240f887be3a"}], "stats": {"total": 26, "additions": 23, "deletions": 3}, "files": [{"sha": "d3251db9d89b3d7780a67fd3fe430f390deab101", "filename": "gcc/config/darwin-sections.def", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a788c4555c6d17a5b37516e28844e6fd6013eb3e/gcc%2Fconfig%2Fdarwin-sections.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a788c4555c6d17a5b37516e28844e6fd6013eb3e/gcc%2Fconfig%2Fdarwin-sections.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-sections.def?ref=a788c4555c6d17a5b37516e28844e6fd6013eb3e", "patch": "@@ -198,3 +198,14 @@ DEF_SECTION (objc2_image_info_section, 0,\n \t     \".section __DATA, __objc_imageinfo, regular, no_dead_strip\", 1)\n DEF_SECTION (objc2_constant_string_object_section, 0,\n \t     \".section __DATA, __objc_stringobj, regular, no_dead_strip\", 1)\n+\n+/* Additions for compatibility with later runtime conventions especially for\n+   sections containing strings.  */\n+DEF_SECTION (objc2_class_names_section, 0,\n+\t     \".section __TEXT, __objc_classname, cstring_literals\", 1)\n+\n+DEF_SECTION (objc2_method_names_section, 0,\n+\t     \".section __TEXT, __objc_methname, cstring_literals\", 1)\n+\n+DEF_SECTION (objc2_method_types_section, 0,\n+\t     \".section __TEXT, __objc_methtype, cstring_literals\", 1)"}, {"sha": "7eb288ec3f8781b0290d9add9dc364eb1ff2b320", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a788c4555c6d17a5b37516e28844e6fd6013eb3e/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a788c4555c6d17a5b37516e28844e6fd6013eb3e/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=a788c4555c6d17a5b37516e28844e6fd6013eb3e", "patch": "@@ -174,10 +174,12 @@ output_objc_section_asm_op (const void *directive)\n       /* ABI=2 */\n       static const enum darwin_section_enum tomarkv2[] =\n \t{\n+\t  objc2_method_names_section,\n \t  objc2_message_refs_section,\n \t  objc2_classdefs_section,\n \t  objc2_metadata_section,\n \t  objc2_classrefs_section,\n+\t  objc2_class_names_section,\n \t  objc2_classlist_section,\n \t  objc2_categorylist_section,\n \t  objc2_selector_refs_section,\n@@ -1447,6 +1449,12 @@ darwin_objc2_section (tree decl ATTRIBUTE_UNUSED, tree meta, section * base)\n      first.  */\n   if      (!strncmp (p, \"V2_BASE\", 7))\n     return base;\n+  else if (!strncmp (p, \"V2_CNAM\", 7))\n+    return darwin_sections[objc2_class_names_section];\n+  else if (!strncmp (p, \"V2_MNAM\", 7))\n+    return darwin_sections[objc2_method_names_section];\n+  else if (!strncmp (p, \"V2_MTYP\", 7))\n+    return darwin_sections[objc2_method_types_section];\n   else if (!strncmp (p, \"V2_STRG\", 7))\n     return darwin_sections[cstring_section];\n "}, {"sha": "b4019cd4fe0574ea10446150660168be40be9482", "filename": "gcc/objc/objc-next-runtime-abi-02.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a788c4555c6d17a5b37516e28844e6fd6013eb3e/gcc%2Fobjc%2Fobjc-next-runtime-abi-02.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a788c4555c6d17a5b37516e28844e6fd6013eb3e/gcc%2Fobjc%2Fobjc-next-runtime-abi-02.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-next-runtime-abi-02.c?ref=a788c4555c6d17a5b37516e28844e6fd6013eb3e", "patch": "@@ -323,9 +323,10 @@ next_runtime_abi_02_init_metadata_attributes (void)\n \n   meta_sel_refs = get_identifier (\"V2_SRFS\");\n \n-  meta_class_name =\n-  meta_meth_name =\n-  meta_meth_type =\n+  meta_class_name = get_identifier (\"V2_CNAM\");\n+  meta_meth_name = get_identifier (\"V2_MNAM\");\n+\n+  meta_meth_type = get_identifier (\"V2_MTYP\");\n   meta_prop_name_attr = get_identifier (\"V2_STRG\");\n \n   meta_mref = get_identifier (\"V2_MREF\");"}]}