{"sha": "f353733a26494c2b5684382f06d152381529077b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjM1MzczM2EyNjQ5NGMyYjU2ODQzODJmMDZkMTUyMzgxNTI5MDc3Yg==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2007-08-03T22:09:10Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2007-08-03T22:09:10Z"}, "message": "re PR libfortran/32977 (All gfortran tests fail on Tru64 UNIX V4.0F: vsnprintf missing)\n\n2007-08-03  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR libfortran/32977\n\t* io/unix.c:  If there is no vsnprintf, use vsprintf and issue\n\ta fatal error when a buffer overrun occurs.\n\nFrom-SVN: r127187", "tree": {"sha": "7c1981a62b5a05fcb566b6985611348493c6918d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c1981a62b5a05fcb566b6985611348493c6918d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f353733a26494c2b5684382f06d152381529077b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f353733a26494c2b5684382f06d152381529077b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f353733a26494c2b5684382f06d152381529077b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f353733a26494c2b5684382f06d152381529077b/comments", "author": null, "committer": null, "parents": [{"sha": "0a4221f6e4bedc3d1e395a69f60f263f52361c09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a4221f6e4bedc3d1e395a69f60f263f52361c09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a4221f6e4bedc3d1e395a69f60f263f52361c09"}], "stats": {"total": 25, "additions": 23, "deletions": 2}, "files": [{"sha": "2ccb46b02dd1ef3fd13c9b9da01b24416f9c0ba8", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f353733a26494c2b5684382f06d152381529077b/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f353733a26494c2b5684382f06d152381529077b/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=f353733a26494c2b5684382f06d152381529077b", "patch": "@@ -1,3 +1,9 @@\n+2007-08-03  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR libfortran/32977\n+\t* io/unix.c:  If there is no vsnprintf, use vsprintf and issue\n+\ta fatal error when a buffer overrun occurs.\n+\n 2007-08-03  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/31202"}, {"sha": "75721cc2ff5e9c829152a796a4e6efea752140a1", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 17, "deletions": 2, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f353733a26494c2b5684382f06d152381529077b/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f353733a26494c2b5684382f06d152381529077b/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=f353733a26494c2b5684382f06d152381529077b", "patch": "@@ -1386,7 +1386,8 @@ error_stream (void)\n    overruns, we limit the length of the buffer to ST_VPRINTF_SIZE.  2k\n    is big enough to completely fill a 80x25 terminal, so it shuld be\n    OK.  We use a direct write() because it is simpler and least likely\n-   to be clobbered by memory corruption.  */\n+   to be clobbered by memory corruption.  Writing an error message\n+   longer than that is an error.  */\n \n #define ST_VPRINTF_SIZE 2048\n \n@@ -1401,8 +1402,22 @@ st_vprintf (const char *format, va_list ap)\n #ifdef HAVE_VSNPRINTF\n   written = vsnprintf(buffer, ST_VPRINTF_SIZE, format, ap);\n #else\n-  written = __builtin_vsnprintf(buffer, ST_VPRINTF_SIZE, format, ap);\n+  written = vsprintf(buffer, format, ap);\n+\n+  if (written >= ST_VPRINTF_SIZE-1)\n+    {\n+      /* The error message was longer than our buffer.  Ouch.  Because\n+\t we may have messed up things badly, report the error and\n+\t quit.  */\n+#define ERROR_MESSAGE \"Internal error: buffer overrun in st_vprintf()\\n\"\n+      write (fd, buffer, ST_VPRINTF_SIZE-1);\n+      write (fd, ERROR_MESSAGE, strlen(ERROR_MESSAGE));\n+      sys_exit(2);\n+#undef ERROR_MESSAGE\n+\n+    }\n #endif\n+\n   written = write (fd, buffer, written);\n   return written;\n }"}]}