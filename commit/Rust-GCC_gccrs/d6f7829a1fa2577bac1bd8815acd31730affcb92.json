{"sha": "d6f7829a1fa2577bac1bd8815acd31730affcb92", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZmNzgyOWExZmEyNTc3YmFjMWJkODgxNWFjZDMxNzMwYWZmY2I5Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-03-05T08:43:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-03-05T08:43:16Z"}, "message": "re PR tree-optimization/89566 (ICE on compilable C++ code: in gimple_call_arg, at gimple.h:3166)\n\n\tPR tree-optimization/89566\n\t* gimple-ssa-sprintf.c (sprintf_dom_walker::handle_gimple_call):\n\tSet info.fncode to BUILT_IN_NONE if gimple_call_builtin_p failed.\n\tPunt if get_user_idx_format succeeds, but idx_format argument is\n\tnot provided or doesn't have pointer type, or if idx_args is above\n\tnumber of provided arguments.\n\n\t* c-c++-common/pr89566.c: New test.\n\nFrom-SVN: r269384", "tree": {"sha": "8002b8c05a197626eed6b4dcc4b741aa9980a0ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8002b8c05a197626eed6b4dcc4b741aa9980a0ed"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6f7829a1fa2577bac1bd8815acd31730affcb92", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6f7829a1fa2577bac1bd8815acd31730affcb92", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6f7829a1fa2577bac1bd8815acd31730affcb92", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6f7829a1fa2577bac1bd8815acd31730affcb92/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "da7382442e127e54ba65edeab4d9444e786ffd73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da7382442e127e54ba65edeab4d9444e786ffd73", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da7382442e127e54ba65edeab4d9444e786ffd73"}], "stats": {"total": 42, "additions": 38, "deletions": 4}, "files": [{"sha": "22ce3646ee1bb547548dd522ffc95469eacef9dd", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d6f7829a1fa2577bac1bd8815acd31730affcb92", "patch": "@@ -1,3 +1,12 @@\n+2019-03-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/89566\n+\t* gimple-ssa-sprintf.c (sprintf_dom_walker::handle_gimple_call):\n+\tSet info.fncode to BUILT_IN_NONE if gimple_call_builtin_p failed.\n+\tPunt if get_user_idx_format succeeds, but idx_format argument is\n+\tnot provided or doesn't have pointer type, or if idx_args is above\n+\tnumber of provided arguments.\n+\n 2019-03-04  Wilco Dijkstra  <wdijkstr@arm.com>\n \n \tPR tree-optimization/89437"}, {"sha": "ced1c4c577702e908add6c47f3862eebce0ce027", "filename": "gcc/gimple-ssa-sprintf.c", "status": "modified", "additions": 9, "deletions": 4, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2Fgimple-ssa-sprintf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2Fgimple-ssa-sprintf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-sprintf.c?ref=d6f7829a1fa2577bac1bd8815acd31730affcb92", "patch": "@@ -3858,16 +3858,21 @@ sprintf_dom_walker::handle_gimple_call (gimple_stmt_iterator *gsi)\n   if (!info.func)\n     return false;\n \n-  info.fncode = DECL_FUNCTION_CODE (info.func);\n-\n   /* Format string argument number (valid for all functions).  */\n   unsigned idx_format = UINT_MAX;\n-  if (!gimple_call_builtin_p (info.callstmt, BUILT_IN_NORMAL))\n+  if (gimple_call_builtin_p (info.callstmt, BUILT_IN_NORMAL))\n+    info.fncode = DECL_FUNCTION_CODE (info.func);\n+  else\n     {\n       unsigned idx_args;\n       idx_format = get_user_idx_format (info.func, &idx_args);\n-      if (idx_format == UINT_MAX)\n+      if (idx_format == UINT_MAX\n+\t  || idx_format >= gimple_call_num_args (info.callstmt)\n+\t  || idx_args > gimple_call_num_args (info.callstmt)\n+\t  || !POINTER_TYPE_P (TREE_TYPE (gimple_call_arg (info.callstmt,\n+\t\t\t\t\t\t\t  idx_format))))\n \treturn false;\n+      info.fncode = BUILT_IN_NONE;\n       info.argidx = idx_args;\n     }\n "}, {"sha": "a5e25c3284dad78123a827ee8e810072fb7cd87a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d6f7829a1fa2577bac1bd8815acd31730affcb92", "patch": "@@ -1,3 +1,8 @@\n+2019-03-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/89566\n+\t* c-c++-common/pr89566.c: New test.\n+\n 2019-03-04  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/84605"}, {"sha": "d96765653596c4b8dd7a913dc12529064993b7b2", "filename": "gcc/testsuite/c-c++-common/pr89566.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr89566.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6f7829a1fa2577bac1bd8815acd31730affcb92/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr89566.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr89566.c?ref=d6f7829a1fa2577bac1bd8815acd31730affcb92", "patch": "@@ -0,0 +1,15 @@\n+/* PR tree-optimization/89566 */\n+/* { dg-do compile } */\n+\n+typedef struct FILE { int i; } FILE;\n+#ifdef __cplusplus\n+extern \"C\"\n+#endif\n+int fprintf (FILE *, const char *, ...);\n+\n+int\n+main ()\n+{\n+  ((void (*)()) fprintf) ();\t// { dg-warning \"function called through a non-compatible type\" \"\" { target c } }\n+  return 0;\n+}"}]}