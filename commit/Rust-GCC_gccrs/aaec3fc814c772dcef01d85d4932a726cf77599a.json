{"sha": "aaec3fc814c772dcef01d85d4932a726cf77599a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWFlYzNmYzgxNGM3NzJkY2VmMDFkODVkNDkzMmE3MjZjZjc3NTk5YQ==", "commit": {"author": {"name": "Andreas Krebbel", "email": "Andreas.Krebbel@de.ibm.com", "date": "2013-04-23T11:33:50Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2013-04-23T11:33:50Z"}, "message": "sjlj.S: New file.\n\n2013-04-23  Andreas Krebbel  <Andreas.Krebbel@de.ibm.com>\n\n\t* config/s390/sjlj.S: New file.\n\t* config/s390/target.h: New file.\n\t* configure.tgt: Set options for S/390.\n\nFrom-SVN: r198190", "tree": {"sha": "c1653f515fe48b846f760e7405e9ac00957c1f33", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1653f515fe48b846f760e7405e9ac00957c1f33"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/aaec3fc814c772dcef01d85d4932a726cf77599a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaec3fc814c772dcef01d85d4932a726cf77599a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aaec3fc814c772dcef01d85d4932a726cf77599a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aaec3fc814c772dcef01d85d4932a726cf77599a/comments", "author": null, "committer": null, "parents": [{"sha": "5af46aa9c5a32ba14603a49d3c4ebe029c5e3cd9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5af46aa9c5a32ba14603a49d3c4ebe029c5e3cd9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5af46aa9c5a32ba14603a49d3c4ebe029c5e3cd9"}], "stats": {"total": 173, "additions": 173, "deletions": 0}, "files": [{"sha": "a5e1c236b35a06684dedddde1b6591a08c6d52f3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaec3fc814c772dcef01d85d4932a726cf77599a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaec3fc814c772dcef01d85d4932a726cf77599a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=aaec3fc814c772dcef01d85d4932a726cf77599a", "patch": "@@ -1,3 +1,9 @@\n+2013-04-23  Andreas Krebbel  <Andreas.Krebbel@de.ibm.com>\n+\n+\t* config/s390/sjlj.S: New file.\n+\t* config/s390/target.h: New file.\n+\t* configure.tgt: Set options for S/390.\n+\n 2013-04-23  Andreas Schwab  <schwab@linux-m68k.org>\n \n \t* coretypes.h (gimple_stmt_iterator): Add struct to make"}, {"sha": "592d9af2cfd4e48ba5749346f7bb75e7431708ba", "filename": "libitm/config/s390/sjlj.S", "status": "added", "additions": 108, "deletions": 0, "changes": 108, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaec3fc814c772dcef01d85d4932a726cf77599a/libitm%2Fconfig%2Fs390%2Fsjlj.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaec3fc814c772dcef01d85d4932a726cf77599a/libitm%2Fconfig%2Fs390%2Fsjlj.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig%2Fs390%2Fsjlj.S?ref=aaec3fc814c772dcef01d85d4932a726cf77599a", "patch": "@@ -0,0 +1,108 @@\n+/* Copyright (C) 2013 Free Software Foundation, Inc.\n+   Contributed by Andreas Krebbel <krebbel@linux.vnet.ibm.com>\n+\n+   This file is part of the GNU Transactional Memory Library (libitm).\n+\n+   Libitm is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   Libitm is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+\n+#include \"asmcfi.h\"\n+\n+.text\n+\t.align 4\n+.globl\t_ITM_beginTransaction\n+\t.type _ITM_beginTransaction, @function\n+\n+\t/* _ITM_beginTransaction (int props); props -> r2 */\n+_ITM_beginTransaction:\n+\tcfi_startproc\n+#ifdef __s390x__\n+\tlgr\t%r3,%r15\t/* backup stack pointer */\n+\taghi\t%r15,-304\t/* jump buffer (144) + reg save area (160) */\n+\tcfi_adjust_cfa_offset(304)\n+\tstmg\t%r6,%r14,160(%r15)\n+\tstg\t%r3,72+160(%r15) /* store the old stack pointer */\n+\tstd\t%f8,80+160(%r15)\n+\tstd\t%f9,88+160(%r15)\n+\tstd\t%f10,96+160(%r15)\n+\tstd\t%f11,104+160(%r15)\n+\tstd\t%f12,112+160(%r15)\n+\tstd\t%f13,120+160(%r15)\n+\tstd\t%f14,128+160(%r15)\n+\tstd\t%f15,136+160(%r15)\n+\tla\t%r3,160(%r15)\t/* second argument to GTM_begin_transaction */\n+\tbrasl\t%r14,GTM_begin_transaction\n+\tlg\t%r1,64+160(%r15)\n+\taghi\t%r15,304\n+\tcfi_adjust_cfa_offset(-304)\n+\tbr\t%r1\n+#else\n+\tlr\t%r3,%r15\t/* backup stack pointer */\n+\tahi\t%r15,-152\t/* jump buffer (56) + reg save area (96) */\n+\tcfi_adjust_cfa_offset(152)\n+\tstm\t%r6,%r14,96(%r15)\n+\tst\t%r3,36+96(%r15)\t/* store the old stack pointer */\n+\tstd\t%f4,40+96(%r15)\n+\tstd\t%f6,48+96(%r15)\n+\tla\t%r3,96(%r15)\t/* second argument to GTM_begin_transaction */\n+\t/* begin_transaction (uint32_t prop, const gtm_jmpbuf *jb) */\n+\tbrasl\t%r14,GTM_begin_transaction /* requires mzarch */\n+\tl\t%r1,32+96(%r15)\n+\tahi\t%r15,152\n+\tcfi_adjust_cfa_offset(-152)\n+\tbr\t%r1\n+#endif\n+\tcfi_endproc\n+\n+\t.size _ITM_beginTransaction, .-_ITM_beginTransaction\n+\n+\t.align 4\n+.globl\tGTM_longjmp\n+\t.type GTM_longjmp, @function\n+\t.hidden GTM_longjmp\n+\n+\t/* uint32_t GTM_longjmp (uint32_t, const gtm_jmpbuf *, uint32_t) */\n+GTM_longjmp:\n+\t/* First parameter becomes the return value of\n+\t   _ITM_beginTransaction (r2).\n+\t   Third parameter is ignored for now.  */\n+\tcfi_startproc\n+#ifdef __s390x__\n+\tld\t%f8,80(%r3)\n+\tld\t%f9,88(%r3)\n+\tld\t%f10,96(%r3)\n+\tld\t%f11,104(%r3)\n+\tld\t%f12,112(%r3)\n+\tld\t%f13,120(%r3)\n+\tld\t%f14,128(%r3)\n+\tld\t%f15,136(%r3)\n+\tlmg\t%r6,%r15,0(%r3)\n+\tbr\t%r14\n+#else\n+\tld\t%f4,40(%r3)\n+\tld\t%f6,48(%r3)\n+\tlm\t%r6,%r15,0(%r3)\n+\tbr\t%r14\n+#endif\n+\tcfi_endproc\n+\n+\t.size GTM_longjmp, .-GTM_longjmp\n+\n+\t.section .note.GNU-stack, \"\", @progbits"}, {"sha": "a102e1e3d3d58abaf106a60bd64321c687639976", "filename": "libitm/config/s390/target.h", "status": "added", "additions": 55, "deletions": 0, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaec3fc814c772dcef01d85d4932a726cf77599a/libitm%2Fconfig%2Fs390%2Ftarget.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaec3fc814c772dcef01d85d4932a726cf77599a/libitm%2Fconfig%2Fs390%2Ftarget.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig%2Fs390%2Ftarget.h?ref=aaec3fc814c772dcef01d85d4932a726cf77599a", "patch": "@@ -0,0 +1,55 @@\n+/* Copyright (C) 2013 Free Software Foundation, Inc.\n+   Contributed by Andreas Krebbel <krebbel@linux.vnet.ibm.com>.\n+\n+   This file is part of the GNU Transactional Memory Library (libitm).\n+\n+   Libitm is free software; you can redistribute it and/or modify it\n+   under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   Libitm is distributed in the hope that it will be useful, but WITHOUT ANY\n+   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS\n+   FOR A PARTICULAR PURPOSE.  See the GNU General Public License for\n+   more details.\n+\n+   Under Section 7 of GPL version 3, you are granted additional\n+   permissions described in the GCC Runtime Library Exception, version\n+   3.1, as published by the Free Software Foundation.\n+\n+   You should have received a copy of the GNU General Public License and\n+   a copy of the GCC Runtime Library Exception along with this program;\n+   see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+   <http://www.gnu.org/licenses/>.  */\n+\n+namespace GTM HIDDEN {\n+\n+#define HW_CACHELINE_SIZE 256\n+\n+typedef struct gtm_jmpbuf\n+{\n+  /* We save registers r6-r14.  */\n+  long int __gregs[9];\n+  /* r15 is stored into cfa field.  It needs to be named that way\n+     since tls.h is accessing the field by name.  Be aware that this\n+     is not actually what we consider the CFA on s390 (since there is\n+     a fix offset between sp and CFA).  It is merely the saved stack\n+     pointer.  */\n+  void *cfa;\n+\n+#ifdef __s390x__\n+  /* We save fpu registers f8 - f15.  */\n+  long __fpregs[8];\n+#else\n+  /* We save fpu registers f4 and f6.  */\n+  long __fpregs[4];\n+#endif\n+} gtm_jmpbuf;\n+\n+static inline void\n+cpu_relax (void)\n+{\n+  __asm volatile (\"\" : : : \"memory\");\n+}\n+\n+} // namespace GTM"}, {"sha": "ab3953b16d726962fd1f1b661b3973a9762a7e22", "filename": "libitm/configure.tgt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/aaec3fc814c772dcef01d85d4932a726cf77599a/libitm%2Fconfigure.tgt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/aaec3fc814c772dcef01d85d4932a726cf77599a/libitm%2Fconfigure.tgt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfigure.tgt?ref=aaec3fc814c772dcef01d85d4932a726cf77599a", "patch": "@@ -105,6 +105,10 @@ case \"${target_cpu}\" in\n \tXCFLAGS=\"${XCFLAGS} -mrtm\"\n \tARCH=x86\n \t;;\n+  s390|s390x)\n+\tARCH=s390\n+\tXCFLAGS=\"${XCFLAGS} -mzarch\"\n+\t;;\n \n   *)\n \tARCH=\"${target_cpu}\""}]}