{"sha": "279dc7a3624ff68e9bb4f44293877250a8097c14", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mjc5ZGM3YTM2MjRmZjY4ZTliYjRmNDQyOTM4NzcyNTBhODA5N2MxNA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-08-09T08:33:05Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-08-09T08:33:05Z"}, "message": "Add -flto=auto option value.\n\n2019-08-09  Martin Liska  <mliska@suse.cz>\n\n\t* doc/invoke.texi: Document the option value.\n\t* lto-wrapper.c (run_gcc): Set auto_parallel\n\tonly with -flto=auto.\n2019-08-09  Martin Liska  <mliska@suse.cz>\n\n\t* g++.dg/lto/devirt-19_0.C: Add -flto=auto.\n\nFrom-SVN: r274232", "tree": {"sha": "9e772532a84db5a3a69ea4de5a9c886310f02d31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e772532a84db5a3a69ea4de5a9c886310f02d31"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/279dc7a3624ff68e9bb4f44293877250a8097c14", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/279dc7a3624ff68e9bb4f44293877250a8097c14", "html_url": "https://github.com/Rust-GCC/gccrs/commit/279dc7a3624ff68e9bb4f44293877250a8097c14", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/279dc7a3624ff68e9bb4f44293877250a8097c14/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "40077d15a87e7fe707b7282ab6f241737d2b3b18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40077d15a87e7fe707b7282ab6f241737d2b3b18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40077d15a87e7fe707b7282ab6f241737d2b3b18"}], "stats": {"total": 38, "additions": 25, "deletions": 13}, "files": [{"sha": "8bc3d91816c7c59050379e3e06177859db6bbc72", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=279dc7a3624ff68e9bb4f44293877250a8097c14", "patch": "@@ -1,3 +1,9 @@\n+2019-08-09  Martin Liska  <mliska@suse.cz>\n+\n+\t* doc/invoke.texi: Document the option value.\n+\t* lto-wrapper.c (run_gcc): Set auto_parallel\n+\tonly with -flto=auto.\n+\n 2019-08-09  Martin Liska  <mliska@suse.cz>\n \n \t* opts.c (common_handle_option): Error for an invalid argument"}, {"sha": "5b6b824bdd3bab39bc2957975a6818884083e7c2", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=279dc7a3624ff68e9bb4f44293877250a8097c14", "patch": "@@ -10415,8 +10415,7 @@ If you specify the optional @var{n}, the optimization and code\n generation done at link time is executed in parallel using @var{n}\n parallel jobs by utilizing an installed @command{make} program.  The\n environment variable @env{MAKE} may be used to override the program\n-used.  The default value for @var{n} is automatically detected based\n-on number of cores.\n+used.\n \n You can also specify @option{-flto=jobserver} to use GNU make's\n job server mode to determine the number of parallel jobs. This\n@@ -10425,6 +10424,10 @@ You must prepend a @samp{+} to the command recipe in the parent Makefile\n for this to work.  This option likely only works if @env{MAKE} is\n GNU make.\n \n+Use @option{-flto=auto} to use GNU make's job server, if available,\n+or otherwise fall back to autodetection of the number of CPU threads\n+present in your system.\n+\n @item -flto-partition=@var{alg}\n @opindex flto-partition\n Specify the partitioning algorithm used by the link-time optimizer."}, {"sha": "84f59cf1a1f1d62aecc46b2bf2f29a8091c21235", "filename": "gcc/lto-wrapper.c", "status": "modified", "additions": 8, "deletions": 10, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Flto-wrapper.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Flto-wrapper.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-wrapper.c?ref=279dc7a3624ff68e9bb4f44293877250a8097c14", "patch": "@@ -1252,8 +1252,7 @@ run_gcc (unsigned argc, char *argv[])\n   char *list_option_full = NULL;\n   const char *linker_output = NULL;\n   const char *collect_gcc, *collect_gcc_options;\n-  /* Make linking parallel by default.  */\n-  int parallel = 1;\n+  int parallel = 0;\n   int jobserver = 0;\n   int auto_parallel = 0;\n   bool no_partition = false;\n@@ -1380,6 +1379,11 @@ run_gcc (unsigned argc, char *argv[])\n \tcase OPT_flto_:\n \t  if (strcmp (option->arg, \"jobserver\") == 0)\n \t    jobserver = 1;\n+\t  else if (strcmp (option->arg, \"auto\") == 0)\n+\t    {\n+\t      parallel = 1;\n+\t      auto_parallel = 1;\n+\t    }\n \t  else\n \t    {\n \t      parallel = atoi (option->arg);\n@@ -1423,14 +1427,8 @@ run_gcc (unsigned argc, char *argv[])\n       auto_parallel = 0;\n       parallel = 0;\n     }\n-  else if (!jobserver && parallel)\n-    {\n-      /* If there's no explicit usage of jobserver and\n-\t parallel is enabled, then automatically detect\n-\t jobserver or number of cores.  */\n-      auto_parallel = 1;\n-      jobserver = jobserver_active_p ();\n-    }\n+  else if (!jobserver && auto_parallel)\n+    jobserver = jobserver_active_p ();\n \n   if (linker_output)\n     {"}, {"sha": "bb0d8b5e7dbc64bb20c3fb393fc0c63ab695529b", "filename": "gcc/opts.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Fopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Fopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.c?ref=279dc7a3624ff68e9bb4f44293877250a8097c14", "patch": "@@ -2825,6 +2825,7 @@ common_handle_option (struct gcc_options *opts,\n     case OPT_flto_:\n       if (strcmp (arg, \"none\") != 0\n \t  && strcmp (arg, \"jobserver\") != 0\n+\t  && strcmp (arg, \"auto\") != 0\n \t  && atoi (arg) == 0)\n \terror_at (loc,\n \t\t  \"unrecognized argument to %<-flto=%> option: %qs\", arg);"}, {"sha": "58e5fe500f99f11ffa7e7770cf5a485fa133f033", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=279dc7a3624ff68e9bb4f44293877250a8097c14", "patch": "@@ -1,3 +1,7 @@\n+2019-08-09  Martin Liska  <mliska@suse.cz>\n+\n+\t* g++.dg/lto/devirt-19_0.C: Add -flto=auto.\n+\n 2019-08-09  Martin Liska  <mliska@suse.cz>\n \n \t* gcc.dg/spellcheck-options-21.c: New test."}, {"sha": "b43527e324e564ac140d1fc0a52a624bfec36a13", "filename": "gcc/testsuite/g++.dg/lto/devirt-19_0.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fdevirt-19_0.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/279dc7a3624ff68e9bb4f44293877250a8097c14/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fdevirt-19_0.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flto%2Fdevirt-19_0.C?ref=279dc7a3624ff68e9bb4f44293877250a8097c14", "patch": "@@ -1,5 +1,5 @@\n /* { dg-lto-do link } */\n /* { dg-lto-options { \"-O2 -fdump-ipa-cp -Wno-return-type -flto -r -nostdlib\" } } */\n-/* { dg-extra-ld-options \"-flinker-output=nolto-rel\" } */\n+/* { dg-extra-ld-options \"-flinker-output=nolto-rel -flto=auto\" } */\n #include \"../ipa/devirt-19.C\"\n /* { dg-final { scan-wpa-ipa-dump-times \"Discovered a virtual call to a known target\" 1 \"cp\"  } } */"}]}