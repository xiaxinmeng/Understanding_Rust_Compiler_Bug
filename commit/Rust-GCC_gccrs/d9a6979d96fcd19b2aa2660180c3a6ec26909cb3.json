{"sha": "d9a6979d96fcd19b2aa2660180c3a6ec26909cb3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDlhNjk3OWQ5NmZjZDE5YjJhYTI2NjAxODBjM2E2ZWMyNjkwOWNiMw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-03-02T12:18:39Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-03-02T12:18:39Z"}, "message": "var-tracking.c (vt_initialize): Scan insns in ebb chunks instead of bb.\n\n\t* var-tracking.c (vt_initialize): Scan insns in ebb chunks instead\n\tof bb.\n\nCo-Authored-By: Steven Bosscher <steven@gcc.gnu.org>\n\nFrom-SVN: r157164", "tree": {"sha": "79ae7ab23fa1f60d595bc76405b4cf936ec7d794", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/79ae7ab23fa1f60d595bc76405b4cf936ec7d794"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2542496c7022185de67a2098e93f966c610835c3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2542496c7022185de67a2098e93f966c610835c3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2542496c7022185de67a2098e93f966c610835c3"}], "stats": {"total": 171, "additions": 100, "deletions": 71}, "files": [{"sha": "4b0d5acb15e4c21a9a1b629b8625aaa68778fc2c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d9a6979d96fcd19b2aa2660180c3a6ec26909cb3", "patch": "@@ -1,3 +1,9 @@\n+2010-03-02  Jakub Jelinek  <jakub@redhat.com>\n+\t    Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\t* var-tracking.c (vt_initialize): Scan insns in ebb chunks instead\n+\tof bb.\n+\n 2010-03-02  Reza Yazdani  <reza.yazdani@amd.com>\n \n \tPR middle-end/42640"}, {"sha": "374e333de6383647f64df9b54929f96f508c01bd", "filename": "gcc/var-tracking.c", "status": "modified", "additions": 94, "deletions": 71, "changes": 165, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3/gcc%2Fvar-tracking.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9a6979d96fcd19b2aa2660180c3a6ec26909cb3/gcc%2Fvar-tracking.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvar-tracking.c?ref=d9a6979d96fcd19b2aa2660180c3a6ec26909cb3", "patch": "@@ -7399,9 +7399,9 @@ vt_initialize (void)\n     {\n       rtx insn;\n       HOST_WIDE_INT pre, post = 0;\n-      int count;\n       unsigned int next_uid_before = cselib_get_next_uid ();\n       unsigned int next_uid_after = next_uid_before;\n+      basic_block first_bb, last_bb;\n \n       if (MAY_HAVE_DEBUG_INSNS)\n \t{\n@@ -7411,55 +7411,70 @@ vt_initialize (void)\n \t\t     cselib_get_next_uid ());\n \t}\n \n+      first_bb = bb;\n+      for (;;)\n+\t{\n+\t  edge e;\n+\t  if (bb->next_bb == EXIT_BLOCK_PTR\n+\t      || ! single_pred_p (bb->next_bb))\n+\t    break;\n+\t  e = find_edge (bb, bb->next_bb);\n+\t  if (! e || (e->flags & EDGE_FALLTHRU) == 0)\n+\t    break;\n+\t  bb = bb->next_bb;\n+\t}\n+      last_bb = bb;\n+\n       /* Count the number of micro operations.  */\n-      VTI (bb)->n_mos = 0;\n-      for (insn = BB_HEAD (bb); insn != NEXT_INSN (BB_END (bb));\n-\t   insn = NEXT_INSN (insn))\n+      FOR_BB_BETWEEN (bb, first_bb, last_bb->next_bb, next_bb)\n \t{\n-\t  if (INSN_P (insn))\n+\t  VTI (bb)->n_mos = 0;\n+\t  for (insn = BB_HEAD (bb); insn != NEXT_INSN (BB_END (bb));\n+\t       insn = NEXT_INSN (insn))\n \t    {\n-\t      if (!frame_pointer_needed)\n+\t      if (INSN_P (insn))\n \t\t{\n-\t\t  insn_stack_adjust_offset_pre_post (insn, &pre, &post);\n-\t\t  if (pre)\n+\t\t  if (!frame_pointer_needed)\n \t\t    {\n-\t\t      VTI (bb)->n_mos++;\n-\t\t      if (dump_file && (dump_flags & TDF_DETAILS))\n-\t\t\tlog_op_type (GEN_INT (pre), bb, insn,\n-\t\t\t\t     MO_ADJUST, dump_file);\n+\t\t      insn_stack_adjust_offset_pre_post (insn, &pre, &post);\n+\t\t      if (pre)\n+\t\t\t{\n+\t\t\t  VTI (bb)->n_mos++;\n+\t\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t\t    log_op_type (GEN_INT (pre), bb, insn,\n+\t\t\t\t\t MO_ADJUST, dump_file);\n+\t\t\t}\n+\t\t      if (post)\n+\t\t\t{\n+\t\t\t  VTI (bb)->n_mos++;\n+\t\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t\t    log_op_type (GEN_INT (post), bb, insn,\n+\t\t\t\t\t MO_ADJUST, dump_file);\n+\t\t\t}\n \t\t    }\n-\t\t  if (post)\n+\t\t  cselib_hook_called = false;\n+\t\t  if (MAY_HAVE_DEBUG_INSNS)\n \t\t    {\n-\t\t      VTI (bb)->n_mos++;\n+\t\t      cselib_process_insn (insn);\n \t\t      if (dump_file && (dump_flags & TDF_DETAILS))\n-\t\t\tlog_op_type (GEN_INT (post), bb, insn,\n-\t\t\t\t     MO_ADJUST, dump_file);\n+\t\t\t{\n+\t\t\t  print_rtl_single (dump_file, insn);\n+\t\t\t  dump_cselib_table (dump_file);\n+\t\t\t}\n \t\t    }\n-\t\t}\n-\t      cselib_hook_called = false;\n-\t      if (MAY_HAVE_DEBUG_INSNS)\n-\t\t{\n-\t\t  cselib_process_insn (insn);\n-\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t  if (!cselib_hook_called)\n+\t\t    count_with_sets (insn, 0, 0);\n+\t\t  if (CALL_P (insn))\n \t\t    {\n-\t\t      print_rtl_single (dump_file, insn);\n-\t\t      dump_cselib_table (dump_file);\n+\t\t      VTI (bb)->n_mos++;\n+\t\t      if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t\tlog_op_type (PATTERN (insn), bb, insn,\n+\t\t\t\t     MO_CALL, dump_file);\n \t\t    }\n \t\t}\n-\t      if (!cselib_hook_called)\n-\t\tcount_with_sets (insn, 0, 0);\n-\t      if (CALL_P (insn))\n-\t\t{\n-\t\t  VTI (bb)->n_mos++;\n-\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n-\t\t    log_op_type (PATTERN (insn), bb, insn,\n-\t\t\t\t MO_CALL, dump_file);\n-\t\t}\n \t    }\n \t}\n \n-      count = VTI (bb)->n_mos;\n-\n       if (MAY_HAVE_DEBUG_INSNS)\n \t{\n \t  cselib_preserve_only_values (false);\n@@ -7472,58 +7487,66 @@ vt_initialize (void)\n \t}\n \n       /* Add the micro-operations to the array.  */\n-      VTI (bb)->mos = XNEWVEC (micro_operation, VTI (bb)->n_mos);\n-      VTI (bb)->n_mos = 0;\n-      for (insn = BB_HEAD (bb); insn != NEXT_INSN (BB_END (bb));\n-\t   insn = NEXT_INSN (insn))\n+      FOR_BB_BETWEEN (bb, first_bb, last_bb->next_bb, next_bb)\n \t{\n-\t  if (INSN_P (insn))\n+\t  int count = VTI (bb)->n_mos;\n+\t  VTI (bb)->mos = XNEWVEC (micro_operation, count);\n+\t  VTI (bb)->n_mos = 0;\n+\t  for (insn = BB_HEAD (bb); insn != NEXT_INSN (BB_END (bb));\n+\t       insn = NEXT_INSN (insn))\n \t    {\n-\t      if (!frame_pointer_needed)\n+\t      if (INSN_P (insn))\n \t\t{\n-\t\t  insn_stack_adjust_offset_pre_post (insn, &pre, &post);\n-\t\t  if (pre)\n+\t\t  if (!frame_pointer_needed)\n \t\t    {\n-\t\t      micro_operation *mo = VTI (bb)->mos + VTI (bb)->n_mos++;\n+\t\t      insn_stack_adjust_offset_pre_post (insn, &pre, &post);\n+\t\t      if (pre)\n+\t\t\t{\n+\t\t\t  micro_operation *mo\n+\t\t\t    = VTI (bb)->mos + VTI (bb)->n_mos++;\n \n-\t\t      mo->type = MO_ADJUST;\n-\t\t      mo->u.adjust = pre;\n-\t\t      mo->insn = insn;\n+\t\t\t  mo->type = MO_ADJUST;\n+\t\t\t  mo->u.adjust = pre;\n+\t\t\t  mo->insn = insn;\n \n-\t\t      if (dump_file && (dump_flags & TDF_DETAILS))\n-\t\t\tlog_op_type (PATTERN (insn), bb, insn,\n-\t\t\t\t     MO_ADJUST, dump_file);\n+\t\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t\t    log_op_type (PATTERN (insn), bb, insn,\n+\t\t\t\t\t MO_ADJUST, dump_file);\n+\t\t\t}\n \t\t    }\n-\t\t}\n \n-\t      cselib_hook_called = false;\n-\t      if (MAY_HAVE_DEBUG_INSNS)\n-\t\t{\n-\t\t  cselib_process_insn (insn);\n-\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t  cselib_hook_called = false;\n+\t\t  if (MAY_HAVE_DEBUG_INSNS)\n \t\t    {\n-\t\t      print_rtl_single (dump_file, insn);\n-\t\t      dump_cselib_table (dump_file);\n+\t\t      cselib_process_insn (insn);\n+\t\t      if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t\t{\n+\t\t\t  print_rtl_single (dump_file, insn);\n+\t\t\t  dump_cselib_table (dump_file);\n+\t\t\t}\n \t\t    }\n-\t\t}\n-\t      if (!cselib_hook_called)\n-\t\tadd_with_sets (insn, 0, 0);\n+\t\t  if (!cselib_hook_called)\n+\t\t    add_with_sets (insn, 0, 0);\n \n-\t      if (!frame_pointer_needed && post)\n-\t\t{\n-\t\t  micro_operation *mo = VTI (bb)->mos + VTI (bb)->n_mos++;\n+\t\t  if (!frame_pointer_needed && post)\n+\t\t    {\n+\t\t      micro_operation *mo = VTI (bb)->mos + VTI (bb)->n_mos++;\n \n-\t\t  mo->type = MO_ADJUST;\n-\t\t  mo->u.adjust = post;\n-\t\t  mo->insn = insn;\n+\t\t      mo->type = MO_ADJUST;\n+\t\t      mo->u.adjust = post;\n+\t\t      mo->insn = insn;\n \n-\t\t  if (dump_file && (dump_flags & TDF_DETAILS))\n-\t\t    log_op_type (PATTERN (insn), bb, insn,\n-\t\t\t\t MO_ADJUST, dump_file);\n+\t\t      if (dump_file && (dump_flags & TDF_DETAILS))\n+\t\t\tlog_op_type (PATTERN (insn), bb, insn,\n+\t\t\t\t     MO_ADJUST, dump_file);\n+\t\t    }\n \t\t}\n \t    }\n+\t  gcc_assert (count == VTI (bb)->n_mos);\n \t}\n-      gcc_assert (count == VTI (bb)->n_mos);\n+\n+      bb = last_bb;\n+\n       if (MAY_HAVE_DEBUG_INSNS)\n \t{\n \t  cselib_preserve_only_values (true);"}]}