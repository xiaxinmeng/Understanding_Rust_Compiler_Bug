{"sha": "5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWVhOWNiNmVkZTM4MjUwZmEwZmVmNTkyODkwOGQxMGJhMTNlNjNkMA==", "commit": {"author": {"name": "Roger Sayle", "email": "roger@eyesopen.com", "date": "2004-04-12T23:23:16Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2004-04-12T23:23:16Z"}, "message": "i386.c (output_387_reg_move): New function.\n\n\n\t* config/i386/i386.c (output_387_reg_move): New function.\n\t* config/i386/i386-protos.h (output_387_reg_move): Prototype here.\n\t* config/i386/i386.md (*movsf_1, *movsf1_nointerunit,\n\t*movdf_nointeger, *movdf_integer, *movxf_nointeger, *movxf_integer,\n\t*extendsfdf2_1,  *extendsfxf2_1, *extenddfxf2_1, truncdfsf2_noop,\n\ttruncxfsf2_noop, truncxfdf2_noop): Call output_387_reg_move.\n\nFrom-SVN: r80631", "tree": {"sha": "3fa86f7ce4c6891a3230a78c0029036923ddbc85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3fa86f7ce4c6891a3230a78c0029036923ddbc85"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/comments", "author": null, "committer": null, "parents": [{"sha": "1c9766da11d71cb57f8962a2eb88833c1ca966f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c9766da11d71cb57f8962a2eb88833c1ca966f5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c9766da11d71cb57f8962a2eb88833c1ca966f5"}], "stats": {"total": 152, "additions": 42, "deletions": 110}, "files": [{"sha": "504da82aea2fcc4b6bb0206dbae851dfcdc4ec5c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "patch": "@@ -1,3 +1,12 @@\n+2004-04-12  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* config/i386/i386.c (output_387_reg_move): New function.\n+\t* config/i386/i386-protos.h (output_387_reg_move): Prototype here.\n+\t* config/i386/i386.md (*movsf_1, *movsf1_nointerunit,\n+\t*movdf_nointeger, *movdf_integer, *movxf_nointeger, *movxf_integer,\n+\t*extendsfdf2_1,  *extendsfxf2_1, *extenddfxf2_1, truncdfsf2_noop,\n+\ttruncxfsf2_noop, truncxfdf2_noop): Call output_387_reg_move.\n+\n 2004-04-12  Richard Kenner  <kenner@vlsi1.ultra.nyu.edu>\n \n \t* c-decl.c (finish_decl): Make a decl_stmt for a variable-sized"}, {"sha": "d95be60e23f03558a5e05a8be8aa86b6e7431c0f", "filename": "gcc/config/i386/i386-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2Fconfig%2Fi386%2Fi386-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-protos.h?ref=5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "patch": "@@ -117,6 +117,7 @@ extern void split_ti (rtx[], int, rtx[], rtx[]);\n \n extern const char *output_set_got (rtx);\n extern const char *output_387_binary_op (rtx, rtx*);\n+extern const char *output_387_reg_move (rtx, rtx*);\n extern const char *output_fix_trunc (rtx, rtx*);\n extern const char *output_fp_compare (rtx, rtx*, int, int);\n "}, {"sha": "615f2eeec49a58b63558f6e09d7253aa878a08d2", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "patch": "@@ -15909,4 +15909,23 @@ ix86_reverse_condition (enum rtx_code code, enum machine_mode mode)\n \t  : reverse_condition_maybe_unordered (code));\n }\n \n+/* Output code to perform an x87 FP register move, from OPERANDS[1]\n+   to OPERANDS[0].  */\n+\n+const char *\n+output_387_reg_move (rtx insn, rtx *operands)\n+{\n+  if (REG_P (operands[1])\n+      && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n+    {\n+      if (REGNO (operands[0]) == FIRST_STACK_REG\n+\t  && TARGET_USE_FFREEP)\n+\treturn \"ffreep\\t%y0\";\n+      return \"fstp\\t%y0\";\n+    }\n+  if (STACK_TOP_P (operands[0]))\n+    return \"fld%z1\\t%y1\";\n+  return \"fst\\t%y0\";\n+}\n+\n #include \"gt-i386.h\""}, {"sha": "c8590d55074318270eefdaae8c65f846ec39fe61", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 13, "deletions": 110, "changes": 123, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ea9cb6ede38250fa0fef5928908d10ba13e63d0/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=5ea9cb6ede38250fa0fef5928908d10ba13e63d0", "patch": "@@ -2197,13 +2197,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-        return \"fstp\\t%y0\";\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       if (find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n@@ -2291,18 +2285,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-\t{\n-\t  if (REGNO (operands[0]) == FIRST_STACK_REG\n-\t      && TARGET_USE_FFREEP)\n-\t    return \"ffreep\\t%y0\";\n-          return \"fstp\\t%y0\";\n-\t}\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       if (find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n@@ -2466,18 +2449,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-\t{\n-\t  if (REGNO (operands[0]) == FIRST_STACK_REG\n-\t      && TARGET_USE_FFREEP)\n-\t    return \"ffreep\\t%y0\";\n-          return \"fstp\\t%y0\";\n-\t}\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       if (find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n@@ -2578,18 +2550,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-\t{\n-\t  if (REGNO (operands[0]) == FIRST_STACK_REG\n-\t      && TARGET_USE_FFREEP)\n-\t    return \"ffreep\\t%y0\";\n-          return \"fstp\\t%y0\";\n-\t}\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       if (find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n@@ -2781,18 +2742,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-\t{\n-\t  if (REGNO (operands[0]) == FIRST_STACK_REG\n-\t      && TARGET_USE_FFREEP)\n-\t    return \"ffreep\\t%y0\";\n-          return \"fstp\\t%y0\";\n-\t}\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       /* There is no non-popping store to memory for XFmode.  So if\n@@ -2825,18 +2775,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-\t{\n-\t  if (REGNO (operands[0]) == FIRST_STACK_REG\n-\t      && TARGET_USE_FFREEP)\n-\t    return \"ffreep\\t%y0\";\n-          return \"fstp\\t%y0\";\n-\t}\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       /* There is no non-popping store to memory for XFmode.  So if\n@@ -3520,20 +3459,14 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-        return \"fstp\\t%y0\";\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       if (find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n         return \"fstp%z0\\t%y0\";\n-\n       else\n         return \"fst%z0\\t%y0\";\n+\n     case 2:\n       return \"cvtss2sd\\t{%1, %0|%0, %1}\";\n \n@@ -3575,13 +3508,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-        return \"fstp\\t%y0\";\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       /* There is no non-popping store to memory for XFmode.  So if\n@@ -3620,13 +3547,7 @@\n   switch (which_alternative)\n     {\n     case 0:\n-      if (REG_P (operands[1])\n-          && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-        return \"fstp\\t%y0\";\n-      else if (STACK_TOP_P (operands[0]))\n-        return \"fld%z1\\t%y1\";\n-      else\n-        return \"fst\\t%y0\";\n+      return output_387_reg_move (insn, operands);\n \n     case 1:\n       /* There is no non-popping store to memory for XFmode.  So if\n@@ -3678,13 +3599,7 @@\n \t(float_truncate:SF (match_operand:DF 1 \"register_operand\" \"f\")))]\n   \"TARGET_80387 && flag_unsafe_math_optimizations\"\n {\n-  if (REG_P (operands[1])\n-      && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-    return \"fstp\\t%y0\";\n-  else if (STACK_TOP_P (operands[0]))\n-    return \"fld%z1\\t%y1\";\n-  else\n-    return \"fst\\t%y0\";\n+  return output_387_reg_move (insn, operands);\n }\n   [(set_attr \"type\" \"fmov\")\n    (set_attr \"mode\" \"SF\")])\n@@ -3931,13 +3846,7 @@\n \t(float_truncate:SF (match_operand:XF 1 \"register_operand\" \"f\")))]\n   \"TARGET_80387 && flag_unsafe_math_optimizations\"\n {\n-  if (REG_P (operands[1])\n-      && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-    return \"fstp\\t%y0\";\n-  else if (STACK_TOP_P (operands[0]))\n-    return \"fld%z1\\t%y1\";\n-  else\n-    return \"fst\\t%y0\";\n+  return output_387_reg_move (insn, operands);\n }\n   [(set_attr \"type\" \"fmov\")\n    (set_attr \"mode\" \"SF\")])\n@@ -4020,13 +3929,7 @@\n \t(float_truncate:DF (match_operand:XF 1 \"register_operand\" \"f\")))]\n   \"TARGET_80387 && flag_unsafe_math_optimizations\"\n {\n-  if (REG_P (operands[1])\n-      && find_regno_note (insn, REG_DEAD, REGNO (operands[1])))\n-    return \"fstp\\t%y0\";\n-  else if (STACK_TOP_P (operands[0]))\n-    return \"fld%z1\\t%y1\";\n-  else\n-    return \"fst\\t%y0\";\n+  return output_387_reg_move (insn, operands);\n }\n   [(set_attr \"type\" \"fmov\")\n    (set_attr \"mode\" \"DF\")])"}]}