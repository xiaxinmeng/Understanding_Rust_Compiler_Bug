{"sha": "1d9335766d86262f8335d63d99b328bb44543b01", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWQ5MzM1NzY2ZDg2MjYyZjgzMzVkNjNkOTliMzI4YmI0NDU0M2IwMQ==", "commit": {"author": {"name": "Bernd Edlinger", "email": "bernd.edlinger@hotmail.de", "date": "2017-09-15T17:21:50Z"}, "committer": {"name": "Bernd Edlinger", "email": "edlinger@gcc.gnu.org", "date": "2017-09-15T17:21:50Z"}, "message": "common.opt (Wcast-align=strict): New warning option.\n\n2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        * common.opt (Wcast-align=strict): New warning option.\n        * doc/invoke.texi: Document -Wcast-align=strict.\n\nc:\n2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        * c-typeck.c (build_c_cast): Implement -Wcast-align=strict.\n\ncp:\n2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        * typeck.c (build_reinterpret_cast_1,\n        build_const_cast_1): Implement -Wcast-align=strict.\n\ntestsuite:\n2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n        * c-c++-common/Wcast-align.c: New test.\n\nFrom-SVN: r252832", "tree": {"sha": "5e9491b32fa26d79e07318fdf780451f77607b38", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5e9491b32fa26d79e07318fdf780451f77607b38"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1d9335766d86262f8335d63d99b328bb44543b01", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d9335766d86262f8335d63d99b328bb44543b01", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d9335766d86262f8335d63d99b328bb44543b01", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d9335766d86262f8335d63d99b328bb44543b01/comments", "author": {"login": "bernd-edlinger", "id": 17638929, "node_id": "MDQ6VXNlcjE3NjM4OTI5", "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bernd-edlinger", "html_url": "https://github.com/bernd-edlinger", "followers_url": "https://api.github.com/users/bernd-edlinger/followers", "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}", "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}", "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions", "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs", "repos_url": "https://api.github.com/users/bernd-edlinger/repos", "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}", "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4a8ca690b0b73f4e0bae542fd69a1ee0d9e73126", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a8ca690b0b73f4e0bae542fd69a1ee0d9e73126", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a8ca690b0b73f4e0bae542fd69a1ee0d9e73126"}], "stats": {"total": 76, "additions": 69, "deletions": 7}, "files": [{"sha": "050aef814452be39bfae5d5dad2f381a7a450b43", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -1,3 +1,8 @@\n+2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\t* common.opt (Wcast-align=strict): New warning option.\n+\t* doc/invoke.texi: Document -Wcast-align=strict. \n+\n 2017-09-15  Pierre-Marie de Rodat  <derodat@adacore.com>\n \n \t* cgraph.h (cgraph_thunk_info): Add comments."}, {"sha": "e8e0fb087d349d1db598c3f8143c9c4f281c7094", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -1,3 +1,7 @@\n+2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\t* c-typeck.c (build_c_cast): Implement -Wcast-align=strict.\n+\n 2017-09-13  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/82167"}, {"sha": "1956d45e2517a54945267b7716d0a62e9c4f9d24", "filename": "gcc/c/c-typeck.c", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-typeck.c?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -5578,7 +5578,7 @@ build_c_cast (location_t loc, tree type, tree expr)\n \t}\n \n       /* Warn about possible alignment problems.  */\n-      if (STRICT_ALIGNMENT\n+      if ((STRICT_ALIGNMENT || warn_cast_align == 2)\n \t  && TREE_CODE (type) == POINTER_TYPE\n \t  && TREE_CODE (otype) == POINTER_TYPE\n \t  && TREE_CODE (TREE_TYPE (otype)) != VOID_TYPE\n@@ -5587,7 +5587,8 @@ build_c_cast (location_t loc, tree type, tree expr)\n \t     restriction is unknown.  */\n \t  && !(RECORD_OR_UNION_TYPE_P (TREE_TYPE (otype))\n \t       && TYPE_MODE (TREE_TYPE (otype)) == VOIDmode)\n-\t  && TYPE_ALIGN (TREE_TYPE (type)) > TYPE_ALIGN (TREE_TYPE (otype)))\n+\t  && min_align_of_type (TREE_TYPE (type))\n+\t     > min_align_of_type (TREE_TYPE (otype)))\n \twarning_at (loc, OPT_Wcast_align,\n \t\t    \"cast increases required alignment of target type\");\n "}, {"sha": "fa6dd845d54f5fa2563202c62db6d06b0ad05dff", "filename": "gcc/common.opt", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fcommon.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fcommon.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon.opt?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -566,6 +566,10 @@ Wcast-align\n Common Var(warn_cast_align) Warning\n Warn about pointer casts which increase alignment.\n \n+Wcast-align=strict\n+Common Var(warn_cast_align,2) Warning\n+Warn about pointer casts which increase alignment.\n+\n Wcpp\n Common Var(warn_cpp) Init(1) Warning\n Warn when a #warning directive is encountered."}, {"sha": "c0132251edc6c7613011593570a74f3ddabfd91f", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -1,3 +1,8 @@\n+2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\t* typeck.c (build_reinterpret_cast_1,\n+\tbuild_const_cast_1): Implement -Wcast-align=strict.\n+\n 2017-09-15  Jakub Jelinek  <jakub@redhat.com>\n \n \t* decl.c (redeclaration_error_message): Use cxx17 instead of cxx1z,"}, {"sha": "028d56ff18cde8686f72d82085ee29c8c4d929f0", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -7265,15 +7265,16 @@ build_reinterpret_cast_1 (tree type, tree expr, bool c_cast_p,\n \t\t\t\t\t       complain))\n \treturn error_mark_node;\n       /* Warn about possible alignment problems.  */\n-      if (STRICT_ALIGNMENT && warn_cast_align\n-          && (complain & tf_warning)\n+      if ((STRICT_ALIGNMENT || warn_cast_align == 2)\n+\t  && (complain & tf_warning)\n \t  && !VOID_TYPE_P (type)\n \t  && TREE_CODE (TREE_TYPE (intype)) != FUNCTION_TYPE\n \t  && COMPLETE_TYPE_P (TREE_TYPE (type))\n \t  && COMPLETE_TYPE_P (TREE_TYPE (intype))\n-\t  && TYPE_ALIGN (TREE_TYPE (type)) > TYPE_ALIGN (TREE_TYPE (intype)))\n+\t  && min_align_of_type (TREE_TYPE (type))\n+\t     > min_align_of_type (TREE_TYPE (intype)))\n \twarning (OPT_Wcast_align, \"cast from %qH to %qI \"\n-                 \"increases required alignment of target type\", intype, type);\n+\t\t \"increases required alignment of target type\", intype, type);\n \n       /* We need to strip nops here, because the front end likes to\n \t create (int *)&a for array-to-pointer decay, instead of &a[0].  */\n@@ -7447,6 +7448,14 @@ build_const_cast_1 (tree dst_type, tree expr, tsubst_flags_t complain,\n \t\t the user is making a potentially unsafe cast.  */\n \t      check_for_casting_away_constness (src_type, dst_type,\n \t\t\t\t\t\tCAST_EXPR, complain);\n+\t      /* ??? comp_ptr_ttypes_const ignores TYPE_ALIGN.  */\n+\t      if ((STRICT_ALIGNMENT || warn_cast_align == 2)\n+\t\t  && (complain & tf_warning)\n+\t\t  && min_align_of_type (TREE_TYPE (dst_type))\n+\t\t     > min_align_of_type (TREE_TYPE (src_type)))\n+\t\twarning (OPT_Wcast_align, \"cast from %qH to %qI \"\n+\t\t\t \"increases required alignment of target type\",\n+\t\t\t src_type, dst_type);\n \t    }\n \t  if (reference_type)\n \t    {"}, {"sha": "60650c8391762b09e7a71f11cb7b1062ecd2d35d", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -266,7 +266,8 @@ Objective-C and Objective-C++ Dialects}.\n -Wno-attributes  -Wbool-compare  -Wbool-operation @gol\n -Wno-builtin-declaration-mismatch @gol\n -Wno-builtin-macro-redefined  -Wc90-c99-compat  -Wc99-c11-compat @gol\n--Wc++-compat  -Wc++11-compat  -Wc++14-compat  -Wcast-align  -Wcast-qual  @gol\n+-Wc++-compat  -Wc++11-compat  -Wc++14-compat  @gol\n+-Wcast-align  -Wcast-align=strict  -Wcast-qual  @gol\n -Wchar-subscripts  -Wchkp  -Wcatch-value  -Wcatch-value=@var{n} @gol\n -Wclobbered  -Wcomment  -Wconditionally-supported @gol\n -Wconversion  -Wcoverage-mismatch  -Wno-cpp  -Wdangling-else  -Wdate-time @gol\n@@ -5931,6 +5932,12 @@ target is increased.  For example, warn if a @code{char *} is cast to\n an @code{int *} on machines where integers can only be accessed at\n two- or four-byte boundaries.\n \n+@item -Wcast-align=strict\n+@opindex Wcast-align=strict\n+Warn whenever a pointer is cast such that the required alignment of the\n+target is increased.  For example, warn if a @code{char *} is cast to\n+an @code{int *} regardless of the target machine.\n+\n @item -Wwrite-strings\n @opindex Wwrite-strings\n @opindex Wno-write-strings"}, {"sha": "0091855e2c9607f6bce1d18938bd1168fd5cd282", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -1,3 +1,7 @@\n+2017-09-15  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\t* c-c++-common/Wcast-align.c: New test.\n+\n 2017-09-15  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* g++.dg/sso-1.C: New test."}, {"sha": "fac1795476ca1f4209980b75172c110cdf561a53", "filename": "gcc/testsuite/c-c++-common/Wcast-align.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWcast-align.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d9335766d86262f8335d63d99b328bb44543b01/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWcast-align.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2FWcast-align.c?ref=1d9335766d86262f8335d63d99b328bb44543b01", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Wcast-align=strict\" } */\n+\n+typedef char __attribute__ ((__aligned__(__BIGGEST_ALIGNMENT__))) c;\n+typedef struct __attribute__ ((__aligned__(__BIGGEST_ALIGNMENT__)))\n+{\n+  char x;\n+} d;\n+\n+char *x;\n+c *y;\n+d *z;\n+struct s { long long x; } *p;\n+struct t { double x; } *q;\n+\n+void\n+foo (void)\n+{\n+  y = (c *) x;  /* { dg-warning \"alignment\" } */\n+  z = (d *) x;  /* { dg-warning \"alignment\" } */\n+  (long long *) p;  /* { dg-bogus \"alignment\" } */\n+  (double *) q;     /* { dg-bogus \"alignment\" } */\n+}"}]}