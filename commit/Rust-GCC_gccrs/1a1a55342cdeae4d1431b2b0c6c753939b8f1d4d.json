{"sha": "1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWExYTU1MzQyY2RlYWU0ZDE0MzFiMmIwYzZjNzUzOTM5YjhmMWQ0ZA==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@arm.com", "date": "2013-11-07T08:34:02Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2013-11-07T08:34:02Z"}, "message": "tree-ssa-loop-ivopts.c (get_shiftadd_cost): Check equality using operand_equal_p.\n\n\n\t* tree-ssa-loop-ivopts.c (get_shiftadd_cost): Check equality\n\tusing operand_equal_p.\n\nFrom-SVN: r204498", "tree": {"sha": "d117536054d5fdf9039e45d6c0a4d1915332bb5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d117536054d5fdf9039e45d6c0a4d1915332bb5d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d/comments", "author": null, "committer": null, "parents": [{"sha": "be8c1c8cc0ff3da71e4cfb553e27a2832f4a939d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/be8c1c8cc0ff3da71e4cfb553e27a2832f4a939d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/be8c1c8cc0ff3da71e4cfb553e27a2832f4a939d"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "89ce09751e6cca985ffb579f65ddce1896e15ec2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d", "patch": "@@ -1,3 +1,8 @@\n+2013-11-07  Bin Cheng  <bin.cheng@arm.com>\n+\n+\t* tree-ssa-loop-ivopts.c (get_shiftadd_cost): Check equality\n+\tusing operand_equal_p.\n+\n 2013-11-07  Bin Cheng  <bin.cheng@arm.com>\n \n \t* tree-ssa-loop-ivopts.c (alloc_iv): Lower address expressions."}, {"sha": "f7da1267416141820f2dc0ee95bf9ec1ba82c7ab", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=1a1a55342cdeae4d1431b2b0c6c753939b8f1d4d", "patch": "@@ -3500,17 +3500,21 @@ get_shiftadd_cost (tree expr, enum machine_mode mode, comp_cost cost0,\n   int m = exact_log2 (int_cst_value (cst));\n   int maxm = MIN (BITS_PER_WORD, GET_MODE_BITSIZE (mode));\n   int sa_cost;\n+  bool equal_p = false;\n \n   if (!(m >= 0 && m < maxm))\n     return false;\n \n+  if (operand_equal_p (op1, mult, 0))\n+    equal_p = true;\n+\n   sa_cost = (TREE_CODE (expr) != MINUS_EXPR\n              ? shiftadd_cost (speed, mode, m)\n-             : (mult == op1\n+             : (equal_p\n                 ? shiftsub1_cost (speed, mode, m)\n                 : shiftsub0_cost (speed, mode, m)));\n   res = new_cost (sa_cost, 0);\n-  res = add_costs (res, mult == op1 ? cost0 : cost1);\n+  res = add_costs (res, equal_p ? cost0 : cost1);\n \n   STRIP_NOPS (multop);\n   if (!is_gimple_val (multop))"}]}