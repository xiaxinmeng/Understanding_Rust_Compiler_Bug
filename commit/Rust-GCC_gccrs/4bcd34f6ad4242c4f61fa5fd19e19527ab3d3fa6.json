{"sha": "4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGJjZDM0ZjZhZDQyNDJjNGY2MWZhNWZkMTllMTk1MjdhYjNkM2ZhNg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-04-07T18:09:28Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2015-04-07T18:09:28Z"}, "message": "re PR go/63731 (Fallback to netgo does not work)\n\n\tPR go/63731\nlibgo: Build and install libnetgo.a\n\nlibnetgo.a provides the net\npackage built with the netgo\ntag enabled.  This provides the\nnetgo fallback solution for gccgo.\nThis lib must be explicitly linked\nin using the -gccgoflags, so is\nnot included by default.\n\nFrom-SVN: r221906", "tree": {"sha": "ca08284b09771b9246cbe76531eee0f20ebf2d71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ca08284b09771b9246cbe76531eee0f20ebf2d71"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6/comments", "author": null, "committer": null, "parents": [{"sha": "293da85bc32b0f4cd9ce02993926502bb08f625c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/293da85bc32b0f4cd9ce02993926502bb08f625c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/293da85bc32b0f4cd9ce02993926502bb08f625c"}], "stats": {"total": 120, "additions": 89, "deletions": 31}, "files": [{"sha": "00fbaabae398c0be1aeba492f31f1194b8959a11", "filename": "libgo/Makefile.am", "status": "modified", "additions": 26, "deletions": 4, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6/libgo%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6/libgo%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.am?ref=4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6", "patch": "@@ -105,7 +105,7 @@ toolexeclib_LTLIBRARIES = libgo-llgo.la\n toolexeclib_LIBRARIES = libgobegin-llgo.a\n else\n toolexeclib_LTLIBRARIES = libgo.la\n-toolexeclib_LIBRARIES = libgobegin.a\n+toolexeclib_LIBRARIES = libgobegin.a libnetgo.a\n endif\n \n toolexeclibgo_DATA = \\\n@@ -774,9 +774,7 @@ endif\n endif\n endif\n \n-go_net_files = \\\n-\tgo/net/cgo_unix.go \\\n-\t$(go_net_cgo_file) \\\n+go_net_common_files = \\\n \t$(go_net_cloexec_file) \\\n \tgo/net/dial.go \\\n \tgo/net/dnsclient.go \\\n@@ -820,6 +818,15 @@ go_net_files = \\\n \tgo/net/unixsock.go \\\n \tgo/net/unixsock_posix.go\n \n+go_net_files = \\\n+\tgo/net/cgo_unix.go \\\n+\t$(go_net_cgo_file) \\\n+\t$(go_net_common_files)\n+\n+go_netgo_files = \\\n+\tgo/net/cgo_stub.go \\\n+\t$(go_net_common_files)\n+\n if LIBGO_IS_SOLARIS\n if LIBGO_IS_386\n go_os_dir_file = go/os/dir_largefile.go\n@@ -2025,6 +2032,9 @@ libgobegin_a_SOURCES = \\\n libgobegin_llgo_a_SOURCES = \\\n \truntime/go-main.c\n \n+libnetgo_a_SOURCES = $(go_netgo_files)\n+libnetgo_a_LIBADD = netgo.o\n+\n LTLDFLAGS = $(shell $(SHELL) $(top_srcdir)/../libtool-ldflags $(LDFLAGS))\n \n GOCFLAGS = $(CFLAGS)\n@@ -2049,6 +2059,12 @@ BUILDPACKAGE = \\\n \tfiles=`echo $^ | sed -e 's/[^ ]*\\.gox//g'`; \\\n \t$(LTGOCOMPILE) -I . -c -fgo-pkgpath=`echo $@ | sed -e 's/.lo$$//' -e 's/-go$$//'` -o $@ $$files\n \n+# Build netgo.o.\n+BUILDNETGO = \\\n+\t$(MKDIR_P) $(@D); \\\n+\tfiles=`echo $^ | sed -e 's/[^ ]*\\.gox//g'`; \\\n+\t$(GOCOMPILE) -I . -c -fgo-pkgpath=net -o $@ $$files\n+\n GOTESTFLAGS =\n GOBENCH = \n \n@@ -2270,6 +2286,12 @@ net/check: $(CHECK_DEPS)\n \t@$(CHECK)\n .PHONY: net/check\n \n+@go_include@ netgo.o.dep\n+netgo.o.dep: $(go_netgo_files)\n+\t$(BUILDDEPS)\n+netgo.o: $(go_netgo_files)\n+\t$(BUILDNETGO)\n+\n @go_include@ os.lo.dep\n os.lo.dep: $(go_os_files)\n \t$(BUILDDEPS)"}, {"sha": "8ecc339012b5cc29560b354713d18e4ab4ed89c4", "filename": "libgo/Makefile.in", "status": "modified", "additions": 63, "deletions": 27, "changes": 90, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6/libgo%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6/libgo%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.in?ref=4bcd34f6ad4242c4f61fa5fd19e19527ab3d3fa6", "patch": "@@ -136,6 +136,15 @@ libgobegin_a_AR = $(AR) $(ARFLAGS)\n libgobegin_a_LIBADD =\n am_libgobegin_a_OBJECTS = go-main.$(OBJEXT)\n libgobegin_a_OBJECTS = $(am_libgobegin_a_OBJECTS)\n+libnetgo_a_AR = $(AR) $(ARFLAGS)\n+libnetgo_a_DEPENDENCIES = netgo.o\n+am__objects_1 =\n+am__objects_2 = $(am__objects_1) $(am__objects_1) $(am__objects_1) \\\n+\t$(am__objects_1) $(am__objects_1) $(am__objects_1) \\\n+\t$(am__objects_1)\n+am__objects_3 = $(am__objects_2)\n+am_libnetgo_a_OBJECTS = $(am__objects_3)\n+libnetgo_a_OBJECTS = $(am_libnetgo_a_OBJECTS)\n LTLIBRARIES = $(toolexeclib_LTLIBRARIES)\n am__DEPENDENCIES_1 =\n am__DEPENDENCIES_2 = bufio.lo bytes.lo bytes/index.lo crypto.lo \\\n@@ -183,23 +192,23 @@ am__DEPENDENCIES_3 = $(am__DEPENDENCIES_2) \\\n \t$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \\\n \t$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)\n libgo_llgo_la_DEPENDENCIES = $(am__DEPENDENCIES_3)\n-@LIBGO_IS_LINUX_FALSE@am__objects_1 = lock_sema.lo thread-sema.lo\n-@LIBGO_IS_LINUX_TRUE@am__objects_1 = lock_futex.lo thread-linux.lo\n-@HAVE_SYS_MMAN_H_FALSE@am__objects_2 = mem_posix_memalign.lo\n-@HAVE_SYS_MMAN_H_TRUE@am__objects_2 = mem.lo\n-@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_FALSE@am__objects_3 = netpoll_kqueue.lo\n-@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_TRUE@am__objects_3 = netpoll_select.lo\n-@LIBGO_IS_LINUX_TRUE@am__objects_3 = netpoll_epoll.lo\n-@LIBGO_IS_RTEMS_TRUE@am__objects_4 = rtems-task-variable-add.lo\n-@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_FREEBSD_FALSE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_NETBSD_FALSE@@LIBGO_IS_SOLARIS_FALSE@am__objects_5 = getncpu-none.lo\n-@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_FREEBSD_FALSE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_NETBSD_TRUE@@LIBGO_IS_SOLARIS_FALSE@am__objects_5 = getncpu-bsd.lo\n-@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_FREEBSD_TRUE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_FALSE@am__objects_5 = getncpu-bsd.lo\n-@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_TRUE@am__objects_5 = getncpu-solaris.lo\n-@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_IRIX_TRUE@@LIBGO_IS_LINUX_FALSE@am__objects_5 = getncpu-irix.lo\n-@LIBGO_IS_DARWIN_TRUE@@LIBGO_IS_LINUX_FALSE@am__objects_5 =  \\\n+@LIBGO_IS_LINUX_FALSE@am__objects_4 = lock_sema.lo thread-sema.lo\n+@LIBGO_IS_LINUX_TRUE@am__objects_4 = lock_futex.lo thread-linux.lo\n+@HAVE_SYS_MMAN_H_FALSE@am__objects_5 = mem_posix_memalign.lo\n+@HAVE_SYS_MMAN_H_TRUE@am__objects_5 = mem.lo\n+@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_FALSE@am__objects_6 = netpoll_kqueue.lo\n+@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_TRUE@am__objects_6 = netpoll_select.lo\n+@LIBGO_IS_LINUX_TRUE@am__objects_6 = netpoll_epoll.lo\n+@LIBGO_IS_RTEMS_TRUE@am__objects_7 = rtems-task-variable-add.lo\n+@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_FREEBSD_FALSE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_NETBSD_FALSE@@LIBGO_IS_SOLARIS_FALSE@am__objects_8 = getncpu-none.lo\n+@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_FREEBSD_FALSE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_NETBSD_TRUE@@LIBGO_IS_SOLARIS_FALSE@am__objects_8 = getncpu-bsd.lo\n+@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_FREEBSD_TRUE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_FALSE@am__objects_8 = getncpu-bsd.lo\n+@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_IRIX_FALSE@@LIBGO_IS_LINUX_FALSE@@LIBGO_IS_SOLARIS_TRUE@am__objects_8 = getncpu-solaris.lo\n+@LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_IRIX_TRUE@@LIBGO_IS_LINUX_FALSE@am__objects_8 = getncpu-irix.lo\n+@LIBGO_IS_DARWIN_TRUE@@LIBGO_IS_LINUX_FALSE@am__objects_8 =  \\\n @LIBGO_IS_DARWIN_TRUE@@LIBGO_IS_LINUX_FALSE@\tgetncpu-bsd.lo\n-@LIBGO_IS_LINUX_TRUE@am__objects_5 = getncpu-linux.lo\n-am__objects_6 = go-append.lo go-assert.lo go-assert-interface.lo \\\n+@LIBGO_IS_LINUX_TRUE@am__objects_8 = getncpu-linux.lo\n+am__objects_9 = go-append.lo go-assert.lo go-assert-interface.lo \\\n \tgo-byte-array-to-string.lo go-breakpoint.lo go-caller.lo \\\n \tgo-callers.lo go-can-convert-interface.lo go-cdiv.lo go-cgo.lo \\\n \tgo-check-interface.lo go-construct-map.lo \\\n@@ -221,21 +230,21 @@ am__objects_6 = go-append.lo go-assert.lo go-assert-interface.lo \\\n \tgo-type-string.lo go-typedesc-equal.lo go-unsafe-new.lo \\\n \tgo-unsafe-newarray.lo go-unsafe-pointer.lo go-unsetenv.lo \\\n \tgo-unwind.lo go-varargs.lo env_posix.lo heapdump.lo \\\n-\t$(am__objects_1) mcache.lo mcentral.lo $(am__objects_2) \\\n-\tmfixalloc.lo mgc0.lo mheap.lo msize.lo $(am__objects_3) \\\n+\t$(am__objects_4) mcache.lo mcentral.lo $(am__objects_5) \\\n+\tmfixalloc.lo mgc0.lo mheap.lo msize.lo $(am__objects_6) \\\n \tpanic.lo parfor.lo print.lo proc.lo runtime.lo signal_unix.lo \\\n-\tthread.lo yield.lo $(am__objects_4) chan.lo cpuprof.lo \\\n+\tthread.lo yield.lo $(am__objects_7) chan.lo cpuprof.lo \\\n \tgo-iface.lo lfstack.lo malloc.lo map.lo mprof.lo netpoll.lo \\\n \trdebug.lo reflect.lo runtime1.lo sema.lo sigqueue.lo string.lo \\\n-\ttime.lo $(am__objects_5)\n-am_libgo_llgo_la_OBJECTS = $(am__objects_6)\n+\ttime.lo $(am__objects_8)\n+am_libgo_llgo_la_OBJECTS = $(am__objects_9)\n libgo_llgo_la_OBJECTS = $(am_libgo_llgo_la_OBJECTS)\n libgo_llgo_la_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) \\\n \t$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \\\n \t$(libgo_llgo_la_LDFLAGS) $(LDFLAGS) -o $@\n @GOC_IS_LLGO_TRUE@am_libgo_llgo_la_rpath = -rpath $(toolexeclibdir)\n libgo_la_DEPENDENCIES = $(am__DEPENDENCIES_3)\n-am_libgo_la_OBJECTS = $(am__objects_6)\n+am_libgo_la_OBJECTS = $(am__objects_9)\n libgo_la_OBJECTS = $(am_libgo_la_OBJECTS)\n libgo_la_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \\\n \t--mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(libgo_la_LDFLAGS) \\\n@@ -255,7 +264,8 @@ LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \\\n \t--mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \\\n \t$(LDFLAGS) -o $@\n SOURCES = $(libgobegin_llgo_a_SOURCES) $(libgobegin_a_SOURCES) \\\n-\t$(libgo_llgo_la_SOURCES) $(libgo_la_SOURCES)\n+\t$(libnetgo_a_SOURCES) $(libgo_llgo_la_SOURCES) \\\n+\t$(libgo_la_SOURCES)\n MULTISRCTOP = \n MULTIBUILDTOP = \n MULTIDIRS = \n@@ -522,7 +532,7 @@ AM_MAKEFLAGS = \\\n FLAGS_TO_PASS = $(AM_MAKEFLAGS)\n @GOC_IS_LLGO_FALSE@toolexeclib_LTLIBRARIES = libgo.la\n @GOC_IS_LLGO_TRUE@toolexeclib_LTLIBRARIES = libgo-llgo.la\n-@GOC_IS_LLGO_FALSE@toolexeclib_LIBRARIES = libgobegin.a\n+@GOC_IS_LLGO_FALSE@toolexeclib_LIBRARIES = libgobegin.a libnetgo.a\n @GOC_IS_LLGO_TRUE@toolexeclib_LIBRARIES = libgobegin-llgo.a\n toolexeclibgo_DATA = \\\n \tbufio.gox \\\n@@ -1025,9 +1035,7 @@ go_mime_files = \\\n @LIBGO_IS_DARWIN_FALSE@@LIBGO_IS_OPENBSD_FALSE@@LIBGO_IS_SOLARIS_TRUE@go_net_tcpsockopt_file = go/net/tcpsockopt_solaris.go\n @LIBGO_IS_DARWIN_TRUE@@LIBGO_IS_OPENBSD_FALSE@go_net_tcpsockopt_file = go/net/tcpsockopt_darwin.go\n @LIBGO_IS_OPENBSD_TRUE@go_net_tcpsockopt_file = go/net/tcpsockopt_openbsd.go\n-go_net_files = \\\n-\tgo/net/cgo_unix.go \\\n-\t$(go_net_cgo_file) \\\n+go_net_common_files = \\\n \t$(go_net_cloexec_file) \\\n \tgo/net/dial.go \\\n \tgo/net/dnsclient.go \\\n@@ -1071,6 +1079,15 @@ go_net_files = \\\n \tgo/net/unixsock.go \\\n \tgo/net/unixsock_posix.go\n \n+go_net_files = \\\n+\tgo/net/cgo_unix.go \\\n+\t$(go_net_cgo_file) \\\n+\t$(go_net_common_files)\n+\n+go_netgo_files = \\\n+\tgo/net/cgo_stub.go \\\n+\t$(go_net_common_files)\n+\n @LIBGO_IS_386_FALSE@@LIBGO_IS_SOLARIS_TRUE@@LIBGO_IS_SPARC_FALSE@go_os_dir_file = go/os/dir_regfile.go\n @LIBGO_IS_386_FALSE@@LIBGO_IS_SOLARIS_TRUE@@LIBGO_IS_SPARC_TRUE@go_os_dir_file = go/os/dir_largefile.go\n @LIBGO_IS_386_TRUE@@LIBGO_IS_SOLARIS_TRUE@go_os_dir_file = go/os/dir_largefile.go\n@@ -2081,6 +2098,8 @@ libgobegin_a_SOURCES = \\\n libgobegin_llgo_a_SOURCES = \\\n \truntime/go-main.c\n \n+libnetgo_a_SOURCES = $(go_netgo_files)\n+libnetgo_a_LIBADD = netgo.o\n LTLDFLAGS = $(shell $(SHELL) $(top_srcdir)/../libtool-ldflags $(LDFLAGS))\n AM_GOCFLAGS = $(STRINGOPS_FLAG)\n GOCOMPILE = $(GOC) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_GOCFLAGS) $(GOCFLAGS)\n@@ -2104,6 +2123,13 @@ BUILDPACKAGE = \\\n \tfiles=`echo $^ | sed -e 's/[^ ]*\\.gox//g'`; \\\n \t$(LTGOCOMPILE) -I . -c -fgo-pkgpath=`echo $@ | sed -e 's/.lo$$//' -e 's/-go$$//'` -o $@ $$files\n \n+\n+# Build netgo.o.\n+BUILDNETGO = \\\n+\t$(MKDIR_P) $(@D); \\\n+\tfiles=`echo $^ | sed -e 's/[^ ]*\\.gox//g'`; \\\n+\t$(GOCOMPILE) -I . -c -fgo-pkgpath=net -o $@ $$files\n+\n GOTESTFLAGS = \n GOBENCH = \n \n@@ -2391,6 +2417,10 @@ libgobegin.a: $(libgobegin_a_OBJECTS) $(libgobegin_a_DEPENDENCIES)\n \t-rm -f libgobegin.a\n \t$(libgobegin_a_AR) libgobegin.a $(libgobegin_a_OBJECTS) $(libgobegin_a_LIBADD)\n \t$(RANLIB) libgobegin.a\n+libnetgo.a: $(libnetgo_a_OBJECTS) $(libnetgo_a_DEPENDENCIES) \n+\t-rm -f libnetgo.a\n+\t$(libnetgo_a_AR) libnetgo.a $(libnetgo_a_OBJECTS) $(libnetgo_a_LIBADD)\n+\t$(RANLIB) libnetgo.a\n install-toolexeclibLTLIBRARIES: $(toolexeclib_LTLIBRARIES)\n \t@$(NORMAL_INSTALL)\n \ttest -z \"$(toolexeclibdir)\" || $(MKDIR_P) \"$(DESTDIR)$(toolexeclibdir)\"\n@@ -4615,6 +4645,12 @@ net/check: $(CHECK_DEPS)\n \t@$(CHECK)\n .PHONY: net/check\n \n+@go_include@ netgo.o.dep\n+netgo.o.dep: $(go_netgo_files)\n+\t$(BUILDDEPS)\n+netgo.o: $(go_netgo_files)\n+\t$(BUILDNETGO)\n+\n @go_include@ os.lo.dep\n os.lo.dep: $(go_os_files)\n \t$(BUILDDEPS)"}]}