{"sha": "37f3b02bf8edbf707e6156feec593b9b0d7da027", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzdmM2IwMmJmOGVkYmY3MDdlNjE1NmZlZWM1OTNiOWIwZDdkYTAyNw==", "commit": {"author": {"name": "CohenArthur", "email": "arthur.cohen@epita.fr", "date": "2021-09-06T10:07:50Z"}, "committer": {"name": "CohenArthur", "email": "arthur.cohen@epita.fr", "date": "2021-09-06T10:07:50Z"}, "message": "mangling: Use Enum(frust_mangling) for option instead of string\n\nCo-authored-by: Marc Poulhies <dkm@kataplop.net>", "tree": {"sha": "bb57652658a6676fa95283302d6aa374f4c5f176", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb57652658a6676fa95283302d6aa374f4c5f176"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37f3b02bf8edbf707e6156feec593b9b0d7da027", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37f3b02bf8edbf707e6156feec593b9b0d7da027", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37f3b02bf8edbf707e6156feec593b9b0d7da027", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37f3b02bf8edbf707e6156feec593b9b0d7da027/comments", "author": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "committer": {"login": "CohenArthur", "id": 43524065, "node_id": "MDQ6VXNlcjQzNTI0MDY1", "avatar_url": "https://avatars.githubusercontent.com/u/43524065?v=4", "gravatar_id": "", "url": "https://api.github.com/users/CohenArthur", "html_url": "https://github.com/CohenArthur", "followers_url": "https://api.github.com/users/CohenArthur/followers", "following_url": "https://api.github.com/users/CohenArthur/following{/other_user}", "gists_url": "https://api.github.com/users/CohenArthur/gists{/gist_id}", "starred_url": "https://api.github.com/users/CohenArthur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/CohenArthur/subscriptions", "organizations_url": "https://api.github.com/users/CohenArthur/orgs", "repos_url": "https://api.github.com/users/CohenArthur/repos", "events_url": "https://api.github.com/users/CohenArthur/events{/privacy}", "received_events_url": "https://api.github.com/users/CohenArthur/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "04ea1955ee6a70390a171328c537ed121eb05078", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04ea1955ee6a70390a171328c537ed121eb05078", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04ea1955ee6a70390a171328c537ed121eb05078"}], "stats": {"total": 31, "additions": 17, "deletions": 14}, "files": [{"sha": "9e77c54423189bfdff9e41292273099c1bf6d7dd", "filename": "gcc/rust/backend/rust-mangle.h", "status": "modified", "additions": 5, "deletions": 10, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37f3b02bf8edbf707e6156feec593b9b0d7da027/gcc%2Frust%2Fbackend%2Frust-mangle.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37f3b02bf8edbf707e6156feec593b9b0d7da027/gcc%2Frust%2Fbackend%2Frust-mangle.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fbackend%2Frust-mangle.h?ref=37f3b02bf8edbf707e6156feec593b9b0d7da027", "patch": "@@ -26,8 +26,9 @@ class Mangler\n public:\n   enum MangleVersion\n   {\n+    // Values defined in rust/lang.opt\n     LEGACY = 0,\n-    V0,\n+    V0 = 1,\n   };\n \n   // this needs to support Legacy and V0 see github #429 or #305\n@@ -40,18 +41,12 @@ class Mangler\n \t\t\t\tconst std::string &name,\n \t\t\t\tconst std::string &crate_name) const;\n \n-  static bool choose_mangling (std::string arg)\n+  static void set_mangling (int frust_mangling_value)\n   {\n-    if (arg == \"legacy\")\n-      version = MangleVersion::LEGACY;\n-    else if (arg == \"v0\")\n-      version = MangleVersion::V0;\n-    else\n-      return false;\n-\n-    return true;\n+    version = static_cast<MangleVersion> (frust_mangling_value);\n   }\n \n+private:\n   static enum MangleVersion version;\n };\n } // namespace Compile"}, {"sha": "27e3c443b386ffd99d8d21893f6366813771ba43", "filename": "gcc/rust/lang.opt", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37f3b02bf8edbf707e6156feec593b9b0d7da027/gcc%2Frust%2Flang.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37f3b02bf8edbf707e6156feec593b9b0d7da027/gcc%2Frust%2Flang.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Flang.opt?ref=37f3b02bf8edbf707e6156feec593b9b0d7da027", "patch": "@@ -44,8 +44,17 @@ Rust Joined RejectNegative\n -frust-dump-<type>\tDump Rust frontend internal information.\n \n frust-mangling=\n-Rust Joined RejectNegative\n--frust-mangling=<version> Choose which version to use for name mangling (legacy, v0)\n+Rust Joined RejectNegative Enum(frust_mangling) Var(flag_rust_mangling)\n+-frust-mangling=[legacy|v0]     Choose which version to use for name mangling\n+\n+Enum\n+Name(frust_mangling) Type(int) UnknownError(unknown rust mangling option %qs)\n+\n+EnumValue\n+Enum(frust_mangling) String(legacy) Value(0)\n+\n+EnumValue\n+Enum(frust_mangling) String(v0) Value(1)\n \n o\n Rust Joined Separate"}, {"sha": "a924c4b9581c26106472215e2eed551f3d8ecdc2", "filename": "gcc/rust/rust-session-manager.cc", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37f3b02bf8edbf707e6156feec593b9b0d7da027/gcc%2Frust%2Frust-session-manager.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37f3b02bf8edbf707e6156feec593b9b0d7da027/gcc%2Frust%2Frust-session-manager.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Frust-session-manager.cc?ref=37f3b02bf8edbf707e6156feec593b9b0d7da027", "patch": "@@ -371,8 +371,7 @@ Session::handle_option (\n \t}\n       break;\n     case OPT_frust_mangling_:\n-      if (arg != nullptr)\n-\tret = Compile::Mangler::choose_mangling (std::string (arg));\n+      Compile::Mangler::set_mangling (flag_rust_mangling);\n     // no option handling for -o\n     default:\n       // return 1 to indicate option is valid"}]}