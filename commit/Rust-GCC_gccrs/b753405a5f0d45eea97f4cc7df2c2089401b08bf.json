{"sha": "b753405a5f0d45eea97f4cc7df2c2089401b08bf", "node_id": "C_kwDOANBUbNoAKGI3NTM0MDVhNWYwZDQ1ZWVhOTdmNGNjN2RmMmMyMDg5NDAxYjA4YmY", "commit": {"author": {"name": "Takayuki 'January June' Suwa", "email": "jjsuwa_sys3175@yahoo.co.jp", "date": "2022-05-13T13:26:30Z"}, "committer": {"name": "Max Filippov", "email": "jcmvbkbc@gmail.com", "date": "2022-05-26T16:40:14Z"}, "message": "xtensa: Simplify EXTUI instruction maskimm validations\n\nNo functional changes.\n\ngcc/ChangeLog:\n\n\t* config/xtensa/predicates.md (extui_fldsz_operand): Simplify.\n\t* config/xtensa/xtensa.cc (xtensa_mask_immediate, print_operand):\n\tDitto.", "tree": {"sha": "7975b2b5376f3702d87ca85c8958f54abb3d90a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7975b2b5376f3702d87ca85c8958f54abb3d90a7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b753405a5f0d45eea97f4cc7df2c2089401b08bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b753405a5f0d45eea97f4cc7df2c2089401b08bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b753405a5f0d45eea97f4cc7df2c2089401b08bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b753405a5f0d45eea97f4cc7df2c2089401b08bf/comments", "author": {"login": "jjsuwa-sys3175", "id": 73290592, "node_id": "MDQ6VXNlcjczMjkwNTky", "avatar_url": "https://avatars.githubusercontent.com/u/73290592?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jjsuwa-sys3175", "html_url": "https://github.com/jjsuwa-sys3175", "followers_url": "https://api.github.com/users/jjsuwa-sys3175/followers", "following_url": "https://api.github.com/users/jjsuwa-sys3175/following{/other_user}", "gists_url": "https://api.github.com/users/jjsuwa-sys3175/gists{/gist_id}", "starred_url": "https://api.github.com/users/jjsuwa-sys3175/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jjsuwa-sys3175/subscriptions", "organizations_url": "https://api.github.com/users/jjsuwa-sys3175/orgs", "repos_url": "https://api.github.com/users/jjsuwa-sys3175/repos", "events_url": "https://api.github.com/users/jjsuwa-sys3175/events{/privacy}", "received_events_url": "https://api.github.com/users/jjsuwa-sys3175/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jcmvbkbc", "id": 166731, "node_id": "MDQ6VXNlcjE2NjczMQ==", "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jcmvbkbc", "html_url": "https://github.com/jcmvbkbc", "followers_url": "https://api.github.com/users/jcmvbkbc/followers", "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}", "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}", "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions", "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs", "repos_url": "https://api.github.com/users/jcmvbkbc/repos", "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}", "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "47b20d027ade5bfbd932724d0ea2aedee7421243", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/47b20d027ade5bfbd932724d0ea2aedee7421243", "html_url": "https://github.com/Rust-GCC/gccrs/commit/47b20d027ade5bfbd932724d0ea2aedee7421243"}], "stats": {"total": 26, "additions": 4, "deletions": 22}, "files": [{"sha": "daea63b182c102047e2ad2770c21a7d7c2961a9c", "filename": "gcc/config/xtensa/predicates.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b753405a5f0d45eea97f4cc7df2c2089401b08bf/gcc%2Fconfig%2Fxtensa%2Fpredicates.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b753405a5f0d45eea97f4cc7df2c2089401b08bf/gcc%2Fconfig%2Fxtensa%2Fpredicates.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fpredicates.md?ref=b753405a5f0d45eea97f4cc7df2c2089401b08bf", "patch": "@@ -55,7 +55,7 @@\n \n (define_predicate \"extui_fldsz_operand\"\n   (and (match_code \"const_int\")\n-       (match_test \"xtensa_mask_immediate ((1 << INTVAL (op)) - 1)\")))\n+       (match_test \"IN_RANGE (INTVAL (op), 1, 16)\")))\n \n (define_predicate \"sext_operand\"\n   (if_then_else (match_test \"TARGET_SEXT\")"}, {"sha": "a1f77b2bd35e622edcb72857ce582e8bf82334f9", "filename": "gcc/config/xtensa/xtensa.cc", "status": "modified", "additions": 3, "deletions": 21, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b753405a5f0d45eea97f4cc7df2c2089401b08bf/gcc%2Fconfig%2Fxtensa%2Fxtensa.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b753405a5f0d45eea97f4cc7df2c2089401b08bf/gcc%2Fconfig%2Fxtensa%2Fxtensa.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fxtensa%2Fxtensa.cc?ref=b753405a5f0d45eea97f4cc7df2c2089401b08bf", "patch": "@@ -456,19 +456,7 @@ xtensa_b4constu (HOST_WIDE_INT v)\n bool\n xtensa_mask_immediate (HOST_WIDE_INT v)\n {\n-#define MAX_MASK_SIZE 16\n-  int mask_size;\n-\n-  for (mask_size = 1; mask_size <= MAX_MASK_SIZE; mask_size++)\n-    {\n-      if ((v & 1) == 0)\n-\treturn false;\n-      v = v >> 1;\n-      if (v == 0)\n-\treturn true;\n-    }\n-\n-  return false;\n+  return IN_RANGE (exact_log2 (v + 1), 1, 16);\n }\n \n \n@@ -2430,17 +2418,11 @@ print_operand (FILE *file, rtx x, int letter)\n     case 'K':\n       if (GET_CODE (x) == CONST_INT)\n \t{\n-\t  int num_bits = 0;\n \t  unsigned val = INTVAL (x);\n-\t  while (val & 1)\n-\t    {\n-\t      num_bits += 1;\n-\t      val = val >> 1;\n-\t    }\n-\t  if ((val != 0) || (num_bits == 0) || (num_bits > 16))\n+\t  if (!xtensa_mask_immediate (val))\n \t    fatal_insn (\"invalid mask\", x);\n \n-\t  fprintf (file, \"%d\", num_bits);\n+\t  fprintf (file, \"%d\", floor_log2 (val + 1));\n \t}\n       else\n \toutput_operand_lossage (\"invalid %%K value\");"}]}