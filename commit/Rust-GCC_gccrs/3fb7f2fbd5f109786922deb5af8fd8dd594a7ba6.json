{"sha": "3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2ZiN2YyZmJkNWYxMDk3ODY5MjJkZWI1YWY4ZmQ4ZGQ1OTRhN2JhNg==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-03-28T13:01:57Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-03-28T13:01:57Z"}, "message": "[Fortran] Fix result-variable handling of MODULE PROCEDURE (PR94348)\n\n\tPR fortran/94348\n\t* decl.c (gfc_match_submod_proc): Add result var to the\n\tproc's namespace.\n\n\tPR fortran/94348\n\t* gfortran.dg/module_procedure_3.f90: New.", "tree": {"sha": "1de04be18996b7af821d5b5d29dd86d0d484cac0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1de04be18996b7af821d5b5d29dd86d0d484cac0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7981c06ae92548bd66f07121db1802eb6aec73ed", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7981c06ae92548bd66f07121db1802eb6aec73ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7981c06ae92548bd66f07121db1802eb6aec73ed"}], "stats": {"total": 55, "additions": 50, "deletions": 5}, "files": [{"sha": "48bf8bfc7fa2152c95f059b17d03acdc4317b313", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "patch": "@@ -1,3 +1,9 @@\n+2020-03-28  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/94348\n+\t* decl.c (gfc_match_submod_proc): Add result var to the\n+\tproc's namespace.\n+\n 2020-03-27  Tobias Burnus  <tobias@codesourcery.com>\n \n \tPR fortran/93957"}, {"sha": "79c951003ad5572f4604017a25b2433c05fc4df7", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "patch": "@@ -9699,13 +9699,20 @@ gfc_match_submod_proc (void)\n   if (get_proc_name (name, &sym, false))\n     return MATCH_ERROR;\n \n-  /* Make sure that the result field is appropriately filled, even though\n-     the result symbol will be replaced later on.  */\n+  /* Make sure that the result field is appropriately filled.  */\n   if (sym->tlink && sym->tlink->attr.function)\n     {\n-      if (sym->tlink->result\n-\t  && sym->tlink->result != sym->tlink)\n-\tsym->result= sym->tlink->result;\n+      if (sym->tlink->result && sym->tlink->result != sym->tlink)\n+\t{\n+\t  sym->result = sym->tlink->result;\n+\t  if (!sym->result->attr.use_assoc)\n+\t    {\n+\t      gfc_symtree *st = gfc_new_symtree (&gfc_current_ns->sym_root,\n+\t\t\t\t\t\t sym->result->name);\n+\t      st->n.sym = sym->result;\n+\t      sym->result->refs++;\n+\t    }\n+\t}\n       else\n \tsym->result = sym;\n     }"}, {"sha": "92f161f197aef8c892c1d0b56a72a23d6a602cf5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "patch": "@@ -1,3 +1,8 @@\n+2020-03-28  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/94348\n+\t* gfortran.dg/module_procedure_3.f90: New.\n+\n 2020-03-28  Patrick Palka  <ppalka@redhat.com>\n \n \tPR c++/94306"}, {"sha": "50a83d9e5b1dfcc1c814e3267a84b715ac37781e", "filename": "gcc/testsuite/gfortran.dg/module_procedure_3.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_procedure_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_procedure_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fmodule_procedure_3.f90?ref=3fb7f2fbd5f109786922deb5af8fd8dd594a7ba6", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do run }\n+!\n+! PR fortran/94348\n+!\n+! Contributed by Damian Rouson\n+\n+module foo_module\n+  implicit none\n+\n+  interface\n+     module function foo() result(bar)\n+       implicit none\n+       integer bar\n+     end function\n+  end interface\n+\n+contains\n+  module procedure foo\n+    bar = 5\n+  end procedure\n+end module\n+\n+program main\n+  use foo_module\n+  implicit none\n+  if (foo() /= 5) stop 1\n+end program main"}]}