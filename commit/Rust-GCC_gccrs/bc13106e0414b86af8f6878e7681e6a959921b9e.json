{"sha": "bc13106e0414b86af8f6878e7681e6a959921b9e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmMxMzEwNmUwNDE0Yjg2YWY4ZjY4NzhlNzY4MWU2YTk1OTkyMWI5ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-09-22T19:06:32Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-09-22T19:08:02Z"}, "message": "c++: Ignore __sanitizer_ptr_{sub,cmp} builtin calls during constant expression evaluation [PR97145]\n\nThese two builtin calls are added already during parsing before pointer\nsubtractions or comparisons, normally they perform runtime verification\nof whether the pointers point to the same object or different objects,\nbut during constant expressione valuation we don't really need those\nbuiltins for anything.\n\n2020-09-22  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR c++/97145\n\t* constexpr.c (cxx_eval_builtin_function_call): Return void_node for\n\tcalls to __sanitize_ptr_{sub,cmp} builtins.\n\n\t* g++.dg/asan/pr97145.C: New test.", "tree": {"sha": "0d5cd7575d2446eb14fd507d7791cf9f9cbbe234", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d5cd7575d2446eb14fd507d7791cf9f9cbbe234"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bc13106e0414b86af8f6878e7681e6a959921b9e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc13106e0414b86af8f6878e7681e6a959921b9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bc13106e0414b86af8f6878e7681e6a959921b9e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bc13106e0414b86af8f6878e7681e6a959921b9e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "49ff88bd0d8a36a9e903f01ce05685cfe07dee5d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49ff88bd0d8a36a9e903f01ce05685cfe07dee5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49ff88bd0d8a36a9e903f01ce05685cfe07dee5d"}], "stats": {"total": 13, "additions": 13, "deletions": 0}, "files": [{"sha": "dacce58fcffee9e3a1fc7570e8db7776681a2d64", "filename": "gcc/cp/constexpr.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc13106e0414b86af8f6878e7681e6a959921b9e/gcc%2Fcp%2Fconstexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc13106e0414b86af8f6878e7681e6a959921b9e/gcc%2Fcp%2Fconstexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fconstexpr.c?ref=bc13106e0414b86af8f6878e7681e6a959921b9e", "patch": "@@ -1355,6 +1355,12 @@ cxx_eval_builtin_function_call (const constexpr_ctx *ctx, tree t, tree fun,\n       case BUILT_IN_STRSTR:\n \tstrops = 2;\n \tstrret = 1;\n+\tbreak;\n+      case BUILT_IN_ASAN_POINTER_COMPARE:\n+      case BUILT_IN_ASAN_POINTER_SUBTRACT:\n+\t/* These builtins shall be ignored during constant expression\n+\t   evaluation.  */\n+\treturn void_node;\n       default:\n \tbreak;\n       }"}, {"sha": "993c8a5dfa7c86c5ae95065a6d2f4d45c70b94a7", "filename": "gcc/testsuite/g++.dg/asan/pr97145.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bc13106e0414b86af8f6878e7681e6a959921b9e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fasan%2Fpr97145.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bc13106e0414b86af8f6878e7681e6a959921b9e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fasan%2Fpr97145.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fasan%2Fpr97145.C?ref=bc13106e0414b86af8f6878e7681e6a959921b9e", "patch": "@@ -0,0 +1,7 @@\n+// PR c++/97145\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-fsanitize=address,pointer-subtract,pointer-compare\" }\n+\n+constexpr char *a = nullptr;\n+constexpr auto b = a - a;\n+constexpr auto c = a < a;"}]}