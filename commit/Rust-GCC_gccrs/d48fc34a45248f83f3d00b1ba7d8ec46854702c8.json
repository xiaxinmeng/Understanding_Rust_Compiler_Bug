{"sha": "d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQ4ZmMzNGE0NTI0OGY4M2YzZDAwYjFiYTdkOGVjNDY4NTQ3MDJjOA==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-02-19T18:21:45Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2018-02-19T18:21:45Z"}, "message": "re PR fortran/35339 (Improve translation of implied do loop in transfer)\n\n2018-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/35339\n\t* frontend-passes.c (traverse_io_block): Remove workaround for\n\tPR 80945.\n\n2018-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/35339\n\t* gfortran.dg/implied_do_io_4.f90: New test.\n\nFrom-SVN: r257814", "tree": {"sha": "8911af3884db63e3c5cc087dcd54215f4f0be8d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8911af3884db63e3c5cc087dcd54215f4f0be8d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/comments", "author": null, "committer": null, "parents": [{"sha": "87e8aa3bd9787cf64314e41ee5b5261b389ad060", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/87e8aa3bd9787cf64314e41ee5b5261b389ad060", "html_url": "https://github.com/Rust-GCC/gccrs/commit/87e8aa3bd9787cf64314e41ee5b5261b389ad060"}], "stats": {"total": 40, "additions": 33, "deletions": 7}, "files": [{"sha": "32646ebf8f700eacaccd59b62bfe2f7dba4ddecf", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "patch": "@@ -1,3 +1,9 @@\n+2018-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/35339\n+\t* frontend-passes.c (traverse_io_block): Remove workaround for\n+\tPR 80945.\n+\n 2018-02-19  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \t* gfortran.texi: Document additional src/dst_type.  Fix some typos."}, {"sha": "1ffd27d686a495ff7989c0af08ce86b4f8f8cd67", "filename": "gcc/fortran/frontend-passes.c", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ffortran%2Ffrontend-passes.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ffortran%2Ffrontend-passes.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ffrontend-passes.c?ref=d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "patch": "@@ -1162,14 +1162,7 @@ traverse_io_block (gfc_code *code, bool *has_reached, gfc_code *prev)\n \n   gcc_assert (curr->op == EXEC_TRANSFER);\n \n-  /* FIXME: Workaround for PR 80945 - array slices with deferred character\n-     lenghts do not work.  Remove this section when the PR is fixed.  */\n   e = curr->expr1;\n-  if (e->expr_type == EXPR_VARIABLE && e->ts.type == BT_CHARACTER\n-      && e->ts.deferred)\n-    return false;\n-  /* End of section to be removed.  */\n-\n   ref = e->ref;\n   if (!ref || ref->type != REF_ARRAY || ref->u.ar.codimen != 0 || ref->next)\n     return false;"}, {"sha": "7f989013c9022b2b4170aee5ea57bd723925d4dc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "patch": "@@ -1,3 +1,8 @@\n+2018-02-19  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/35339\n+\t* gfortran.dg/implied_do_io_4.f90: New test.\n+\n 2018-02-19  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \t* gfortran.dg/coarray_alloc_comp_6.f08: New test."}, {"sha": "4b484d7d5000579c72e92ab6a12a384dc88eb05e", "filename": "gcc/testsuite/gfortran.dg/implied_do_io_4.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ftestsuite%2Fgfortran.dg%2Fimplied_do_io_4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d48fc34a45248f83f3d00b1ba7d8ec46854702c8/gcc%2Ftestsuite%2Fgfortran.dg%2Fimplied_do_io_4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fimplied_do_io_4.f90?ref=d48fc34a45248f83f3d00b1ba7d8ec46854702c8", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do  run }\n+! { dg-additional-options \"-ffrontend-optimize -fdump-tree-original\" }\n+! PR fortran/35339  - make sure that I/O of an implied DO loop\n+! of allocatable character arrays a) works and b) is converted\n+! to a transfer_array\n+program main\n+    implicit none\n+    integer:: i\n+    integer, parameter:: N = 10\n+    character(len=:), dimension(:),allocatable:: ca\n+    allocate(character(len=N):: ca(3))\n+    open(unit=10,status=\"scratch\")\n+    ca(1) = \"foo\"\n+    ca(2) = \"bar\"\n+    ca(3) = \"xyzzy\"\n+    write (10, '(3A10)') (ca(i),i=1,3)\n+    rewind (10)\n+    ca(:) = ''\n+    read (10, '(3A10)') (ca(i),i=1,3)\n+    if (ca(1) /= 'foo' .or. ca(2) /= 'bar' .or. ca(3) /= 'xyzzy') call abort\n+end program\n+! { dg-final { scan-tree-dump-times \"_gfortran_transfer_array\" 2 \"original\" } }"}]}