{"sha": "02fd37f505a164d921432503748a6f772a8f08c5", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDJmZDM3ZjUwNWExNjRkOTIxNDMyNTAzNzQ4YTZmNzcyYThmMDhjNQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2018-07-17T08:11:43Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-17T08:11:43Z"}, "message": "[Ada] Fix incompatibility Default_Scalar_Storage_Order/tagged types\n\nThe pragma Default_Scalar_Storage_Order cannot reliably be used to set the\nnon-default scalar storage order for a program that declares tagged types, if\nit also declares user-defined primitives.\n\nThis is fixed by making Make_Tags use the same base array type as Make_DT and\nMake_Secondary_DT when accessing the array of user-defined primitives.\n\n2018-07-17  Eric Botcazou  <ebotcazou@adacore.com>\n\ngcc/ada/\n\n\t* exp_disp.adb (Make_Tags): When the type has user-defined primitives,\n\tbuild the access type that is later used by Build_Get_Prim_Op_Address\n\tas pointing to a subtype of Ada.Tags.Address_Array.\n\ngcc/testsuite/\n\n\t* gnat.dg/sso10.adb, gnat.dg/sso10_pkg.ads: New testcase.\n\nFrom-SVN: r262797", "tree": {"sha": "6ca455c4333eead9f5aeb9e814a8747cb8e4ae24", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ca455c4333eead9f5aeb9e814a8747cb8e4ae24"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/02fd37f505a164d921432503748a6f772a8f08c5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02fd37f505a164d921432503748a6f772a8f08c5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02fd37f505a164d921432503748a6f772a8f08c5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02fd37f505a164d921432503748a6f772a8f08c5/comments", "author": null, "committer": null, "parents": [{"sha": "c343f1dc19cd16e0fb995c2d3c27c13ab27e0a26", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c343f1dc19cd16e0fb995c2d3c27c13ab27e0a26", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c343f1dc19cd16e0fb995c2d3c27c13ab27e0a26"}], "stats": {"total": 62, "additions": 48, "deletions": 14}, "files": [{"sha": "662c099e167e93a145620477705b5bbff7a6e6ae", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=02fd37f505a164d921432503748a6f772a8f08c5", "patch": "@@ -1,3 +1,9 @@\n+2018-07-17  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* exp_disp.adb (Make_Tags): When the type has user-defined primitives,\n+\tbuild the access type that is later used by Build_Get_Prim_Op_Address\n+\tas pointing to a subtype of Ada.Tags.Address_Array.\n+\n 2018-07-17  Patrick Bernardi  <bernardi@adacore.com>\n \n \t* libgnat/s-memory__mingw.adb: Remove."}, {"sha": "2fa990bc11bd9a602d1a74aa21e937ed64cde6c6", "filename": "gcc/ada/exp_disp.adb", "status": "modified", "additions": 13, "deletions": 14, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Fada%2Fexp_disp.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Fada%2Fexp_disp.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_disp.adb?ref=02fd37f505a164d921432503748a6f772a8f08c5", "patch": "@@ -7179,7 +7179,7 @@ package body Exp_Disp is\n          Analyze_List (Result);\n \n       --     Generate:\n-      --       type Typ_DT is array (1 .. Nb_Prims) of Prim_Ptr;\n+      --       subtype Typ_DT is Address_Array (1 .. Nb_Prims);\n       --       type Typ_DT_Acc is access Typ_DT;\n \n       else\n@@ -7196,20 +7196,19 @@ package body Exp_Disp is\n                                     Name_DT_Prims_Acc);\n          begin\n             Append_To (Result,\n-              Make_Full_Type_Declaration (Loc,\n+              Make_Subtype_Declaration (Loc,\n                 Defining_Identifier => DT_Prims,\n-                Type_Definition =>\n-                  Make_Constrained_Array_Definition (Loc,\n-                    Discrete_Subtype_Definitions => New_List (\n-                      Make_Range (Loc,\n-                        Low_Bound  => Make_Integer_Literal (Loc, 1),\n-                        High_Bound => Make_Integer_Literal (Loc,\n-                                       DT_Entry_Count\n-                                         (First_Tag_Component (Typ))))),\n-                    Component_Definition =>\n-                      Make_Component_Definition (Loc,\n-                        Subtype_Indication =>\n-                          New_Occurrence_Of (RTE (RE_Prim_Ptr), Loc)))));\n+                Subtype_Indication  =>\n+                  Make_Subtype_Indication (Loc,\n+                    Subtype_Mark =>\n+                      New_Occurrence_Of (RTE (RE_Address_Array), Loc),\n+                    Constraint =>\n+                      Make_Index_Or_Discriminant_Constraint (Loc, New_List (\n+                        Make_Range (Loc,\n+                          Low_Bound  => Make_Integer_Literal (Loc, 1),\n+                          High_Bound => Make_Integer_Literal (Loc,\n+                                         DT_Entry_Count\n+                                           (First_Tag_Component (Typ)))))))));\n \n             Append_To (Result,\n               Make_Full_Type_Declaration (Loc,"}, {"sha": "e24b35d5d190d5864f2f90b9d37450eb046ec305", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=02fd37f505a164d921432503748a6f772a8f08c5", "patch": "@@ -1,3 +1,7 @@\n+2018-07-17  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/sso10.adb, gnat.dg/sso10_pkg.ads: New testcase.\n+\n 2018-07-17  Patrick Bernardi  <bernardi@adacore.com>\n \n \t* gnat.dg/memorytest.adb: New testcase."}, {"sha": "5a796f2d493f331c88d85e992dc8c9cc4bb61d25", "filename": "gcc/testsuite/gnat.dg/sso10.adb", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Ftestsuite%2Fgnat.dg%2Fsso10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Ftestsuite%2Fgnat.dg%2Fsso10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fsso10.adb?ref=02fd37f505a164d921432503748a6f772a8f08c5", "patch": "@@ -0,0 +1,16 @@\n+--  { dg-do run }\n+\n+with SSO10_Pkg; use SSO10_Pkg;\n+\n+procedure SSO10 is\n+\n+  procedure Inner (R : Root'Class) is\n+  begin\n+    Run (R);\n+  end;\n+\n+  R : Root;\n+\n+begin\n+  Inner (R);\n+end;"}, {"sha": "c1c4d5cfe410c17a1b685b4633f3603de6d6da45", "filename": "gcc/testsuite/gnat.dg/sso10_pkg.ads", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Ftestsuite%2Fgnat.dg%2Fsso10_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/02fd37f505a164d921432503748a6f772a8f08c5/gcc%2Ftestsuite%2Fgnat.dg%2Fsso10_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fsso10_pkg.ads?ref=02fd37f505a164d921432503748a6f772a8f08c5", "patch": "@@ -0,0 +1,9 @@\n+pragma Default_Scalar_Storage_Order (High_Order_First);\n+\n+package SSO10_Pkg is\n+\n+  type Root is tagged null record;\n+\n+  procedure Run (R : Root) is null;\n+\n+end SSO10_Pkg;"}]}