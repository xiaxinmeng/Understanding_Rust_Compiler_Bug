{"sha": "2ff656f4210b6637bdb648b596932036bca6bf4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmZmNjU2ZjQyMTBiNjYzN2JkYjY0OGI1OTY5MzIwMzZiY2E2YmY0Zg==", "commit": {"author": {"name": "John David Anglin", "email": "dave.anglin@bell.net", "date": "2019-03-12T23:13:36Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2019-03-12T23:13:36Z"}, "message": "re PR libstdc++/89461 (FAIL: experimental/net/timer/waitable/cons.cc)\n\n\tPR libstdc++/89461\n\t* testsuite/lib/libstdc++.exp: Locate libatomic.\n\t* testsuite/lib/dg-options.exp (add_options_for_libatomic): New.\n\t* testsuite/20_util/shared_ptr/thread/default_weaktoshared.cc: Add\n\tlibatomic options.\n\t* testsuite/20_util/shared_ptr/thread/mutex_weaktoshared.cc: Likewise.\n\t* testsuite/experimental/net/timer/waitable/cons.cc: Likewise.\n\t* testsuite/experimental/net/timer/waitable/dest.cc: Likewise.\n\t* testsuite/experimental/net/timer/waitable/ops.cc: Likewise.\n\nFrom-SVN: r269628", "tree": {"sha": "ad9eb668eae30afe743003d682be1f5d03a59a71", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad9eb668eae30afe743003d682be1f5d03a59a71"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2ff656f4210b6637bdb648b596932036bca6bf4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ff656f4210b6637bdb648b596932036bca6bf4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ff656f4210b6637bdb648b596932036bca6bf4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ff656f4210b6637bdb648b596932036bca6bf4f/comments", "author": {"login": "danglin44", "id": 53313928, "node_id": "MDQ6VXNlcjUzMzEzOTI4", "avatar_url": "https://avatars.githubusercontent.com/u/53313928?v=4", "gravatar_id": "", "url": "https://api.github.com/users/danglin44", "html_url": "https://github.com/danglin44", "followers_url": "https://api.github.com/users/danglin44/followers", "following_url": "https://api.github.com/users/danglin44/following{/other_user}", "gists_url": "https://api.github.com/users/danglin44/gists{/gist_id}", "starred_url": "https://api.github.com/users/danglin44/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/danglin44/subscriptions", "organizations_url": "https://api.github.com/users/danglin44/orgs", "repos_url": "https://api.github.com/users/danglin44/repos", "events_url": "https://api.github.com/users/danglin44/events{/privacy}", "received_events_url": "https://api.github.com/users/danglin44/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b9da0278667b43843b750a1ad35a9d6dbc1d1b54", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9da0278667b43843b750a1ad35a9d6dbc1d1b54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9da0278667b43843b750a1ad35a9d6dbc1d1b54"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "59f857db3fe8416fb5e108f4badd36cba31f2204", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -1,3 +1,15 @@\n+2019-03-12  John David Anglin  <dave.anglin@bell.net>\n+\n+\tPR libstdc++/89461\n+\t* testsuite/lib/libstdc++.exp: Locate libatomic.\n+\t* testsuite/lib/dg-options.exp (add_options_for_libatomic): New.\n+\t* testsuite/20_util/shared_ptr/thread/default_weaktoshared.cc: Add\n+\tlibatomic options.\n+\t* testsuite/20_util/shared_ptr/thread/mutex_weaktoshared.cc: Likewise.\n+\t* testsuite/experimental/net/timer/waitable/cons.cc: Likewise.\n+\t* testsuite/experimental/net/timer/waitable/dest.cc: Likewise.\n+\t* testsuite/experimental/net/timer/waitable/ops.cc: Likewise.\n+\n 2019-03-11  Jonathan Wakely  <jwakely@redhat.com>\n \n \tPR libstdc++/89460"}, {"sha": "251e9371b5876467acd1813c93b67a443bebe12f", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/thread/default_weaktoshared.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fthread%2Fdefault_weaktoshared.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fthread%2Fdefault_weaktoshared.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fthread%2Fdefault_weaktoshared.cc?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -19,6 +19,7 @@\n \n // { dg-do run }\n // { dg-options \"-pthread\"  }\n+// { dg-add-options libatomic }\n // { dg-require-effective-target c++11 }\n // { dg-require-effective-target pthread }\n // { dg-require-cstdint \"\" }"}, {"sha": "b3485697bfb7165b47f8e5daa6309ed0b4bb83dc", "filename": "libstdc++-v3/testsuite/20_util/shared_ptr/thread/mutex_weaktoshared.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fthread%2Fmutex_weaktoshared.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fthread%2Fmutex_weaktoshared.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fshared_ptr%2Fthread%2Fmutex_weaktoshared.cc?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -19,6 +19,7 @@\n \n // { dg-do run }\n // { dg-options \"-pthread\"  }\n+// { dg-add-options libatomic }\n // { dg-require-effective-target c++11 }\n // { dg-require-effective-target pthread }\n // { dg-require-cstdint \"\" }"}, {"sha": "d1886e75f06364f5c3d439e51195897ee50966d4", "filename": "libstdc++-v3/testsuite/experimental/net/timer/waitable/cons.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fcons.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fcons.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fcons.cc?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -16,6 +16,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do run { target c++14 } }\n+// { dg-add-options libatomic }\n \n #include <experimental/timer>\n #include <testsuite_hooks.h>"}, {"sha": "cc3b6ee5658dc57bc501ec70f7c46401b423a2c5", "filename": "libstdc++-v3/testsuite/experimental/net/timer/waitable/dest.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fdest.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fdest.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fdest.cc?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -16,6 +16,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do run { target c++14 } }\n+// { dg-add-options libatomic }\n \n #include <experimental/timer>\n #include <testsuite_hooks.h>"}, {"sha": "0f89bec16cda2d5f7ac02b86bdd81c6055a570b5", "filename": "libstdc++-v3/testsuite/experimental/net/timer/waitable/ops.cc", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Fexperimental%2Fnet%2Ftimer%2Fwaitable%2Fops.cc?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -16,6 +16,7 @@\n // <http://www.gnu.org/licenses/>.\n \n // { dg-do run { target c++14 } }\n+// { dg-add-options libatomic }\n \n #include <experimental/timer>\n #include <testsuite_hooks.h>"}, {"sha": "aa4747ea787af23be2ed871e9ca660caf4fb58c3", "filename": "libstdc++-v3/testsuite/lib/dg-options.exp", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Fdg-options.exp?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -257,6 +257,15 @@ proc add_options_for_net_ts { flags } {\n     return $flags\n }\n \n+# Add to FLAGS all the target-specific flags to link to libatomic, if required.\n+\n+proc add_options_for_libatomic { flags } {\n+    if { [istarget hppa*-*-hpux*] || [istarget riscv*-*-*] } {\n+\treturn \"$flags -L../../libatomic/.libs -latomic\"\n+    }\n+    return $flags\n+}\n+\n # Like dg-options, but adds to the default options rather than replacing them.\n \n proc dg-additional-options { args } {"}, {"sha": "02952a4334c249c00748da4d20321e1e11d94b51", "filename": "libstdc++-v3/testsuite/lib/libstdc++.exp", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2ff656f4210b6637bdb648b596932036bca6bf4f/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2Flib%2Flibstdc%2B%2B.exp?ref=2ff656f4210b6637bdb648b596932036bca6bf4f", "patch": "@@ -161,6 +161,17 @@ proc libstdc++_init { testfile } {\n     }\n     v3track gccdir 3\n \n+    # Locate libatomic.\n+    set v3-libatomic 0\n+    set libatomicdir [lookfor_file $blddir/../libatomic .libs/libatomic.$shlib_ext]\n+    if {$libatomicdir != \"\"} {\n+\tset v3-libatomic 1\n+\tset libatomicdir [file dirname $libatomicdir]\n+\tappend ld_library_path_tmp \":${libatomicdir}\"\n+\tverbose -log \"libatomic support detected\"\n+    }\n+    v3track libatomicdir 3\n+\n     # Locate libgomp. This is only required for parallel mode.\n     set v3-libgomp 0\n     set libgompdir [lookfor_file $blddir/../libgomp .libs/libgomp.$shlib_ext]"}]}