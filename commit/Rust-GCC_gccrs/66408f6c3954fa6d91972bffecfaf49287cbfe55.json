{"sha": "66408f6c3954fa6d91972bffecfaf49287cbfe55", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjY0MDhmNmMzOTU0ZmE2ZDkxOTcyYmZmZWNmYWY0OTI4N2NiZmU1NQ==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2018-07-16T23:02:11Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2018-07-16T23:02:11Z"}, "message": "rs6000: Improve truncifsf2\n\nThe current implementation leaves an unnecessary register move.  It is\neasier to just expand things in the expander already.  This patch does\nthat.\n\n\n\t* config/rs6000/rs6000.md (trunc<mode>sf2): Expand truncates of\n\tdouble-double modes to SFmode directly directly.\n\t(trunc<mode>sf2_fprs): Delete.\n\nFrom-SVN: r262754", "tree": {"sha": "fc9fbf1b492ef8c62191b6bdd9734fbf97014a49", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fc9fbf1b492ef8c62191b6bdd9734fbf97014a49"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/66408f6c3954fa6d91972bffecfaf49287cbfe55", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66408f6c3954fa6d91972bffecfaf49287cbfe55", "html_url": "https://github.com/Rust-GCC/gccrs/commit/66408f6c3954fa6d91972bffecfaf49287cbfe55", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/66408f6c3954fa6d91972bffecfaf49287cbfe55/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "56a6c9b4b2aa227c2d5bd21f2fb43b561a5b7d96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56a6c9b4b2aa227c2d5bd21f2fb43b561a5b7d96", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56a6c9b4b2aa227c2d5bd21f2fb43b561a5b7d96"}], "stats": {"total": 29, "additions": 11, "deletions": 18}, "files": [{"sha": "6bdf930d06f5a835a9428ad5886c7dbe0e74244b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66408f6c3954fa6d91972bffecfaf49287cbfe55/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66408f6c3954fa6d91972bffecfaf49287cbfe55/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=66408f6c3954fa6d91972bffecfaf49287cbfe55", "patch": "@@ -1,3 +1,9 @@\n+2018-07-16  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\t* config/rs6000/rs6000.md (trunc<mode>sf2): Expand truncates of\n+\tdouble-double modes to SFmode directly directly.\n+\t(trunc<mode>sf2_fprs): Delete.\n+\n 2018-07-16  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* config/rs6000/rs6000.c (init_float128_ibm): Use the correct names"}, {"sha": "94a0f7d9a662a0fbf69d2f337a70325b5d930ae6", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 5, "deletions": 18, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/66408f6c3954fa6d91972bffecfaf49287cbfe55/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/66408f6c3954fa6d91972bffecfaf49287cbfe55/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=66408f6c3954fa6d91972bffecfaf49287cbfe55", "patch": "@@ -7702,28 +7702,15 @@\n {\n   if (FLOAT128_IEEE_P (<MODE>mode))\n     rs6000_expand_float128_convert (operands[0], operands[1], false);\n-  else if (<MODE>mode == TFmode)\n-    emit_insn (gen_trunctfsf2_fprs (operands[0], operands[1]));\n-  else if (<MODE>mode == IFmode)\n-    emit_insn (gen_truncifsf2_fprs (operands[0], operands[1]));\n   else\n-    gcc_unreachable ();\n+    {\n+      rtx tmp = gen_reg_rtx (DFmode);\n+      emit_insn (gen_trunc<mode>df2 (tmp, operands[1]));\n+      emit_insn (gen_truncdfsf2 (operands[0], tmp));\n+    }\n   DONE;\n })\n \n-(define_insn_and_split \"trunc<mode>sf2_fprs\"\n-  [(set (match_operand:SF 0 \"gpc_reg_operand\" \"=f\")\n-\t(float_truncate:SF (match_operand:IBM128 1 \"gpc_reg_operand\" \"d\")))\n-   (clobber (match_scratch:DF 2 \"=d\"))]\n-  \"TARGET_HARD_FLOAT && TARGET_LONG_DOUBLE_128 && FLOAT128_IBM_P (<MODE>mode)\"\n-  \"#\"\n-  \"&& reload_completed\"\n-  [(set (match_dup 2)\n-\t(float_truncate:DF (match_dup 1)))\n-   (set (match_dup 0)\n-\t(float_truncate:SF (match_dup 2)))]\n-  \"\")\n-\n (define_expand \"floatsi<mode>2\"\n   [(parallel [(set (match_operand:FLOAT128 0 \"gpc_reg_operand\")\n \t\t   (float:FLOAT128 (match_operand:SI 1 \"gpc_reg_operand\")))"}]}