{"sha": "0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGNmZTFiNDY5OGRhM2IzZWY2Yjc1MTQyZjBkYWVmOTY4N2U0ZDYzYQ==", "commit": {"author": {"name": "Balaji V. Iyer", "email": "balaji.v.iyer@intel.com", "date": "2014-02-19T03:43:21Z"}, "committer": {"name": "Balaji V. Iyer", "email": "bviyer@gcc.gnu.org", "date": "2014-02-19T03:43:21Z"}, "message": "+\t* include/cilk/common.h (__CILKRTS_ABI_VERSION): Set the ABI version +\tto 1 instead of 0.\n\n2014-02-18  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n+\n+\t* include/cilk/common.h (__CILKRTS_ABI_VERSION): Set the ABI version\n+\tto 1 instead of 0.\n+\t* runtime/cilk-abi-cilk-for.cpp (cilk_for_recursive): Added a fix to\n+\tinitialize stack frame correctly.\n+\n\nFrom-SVN: r207870", "tree": {"sha": "122619ab8476ac382844c8e13cb6a27127b78948", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/122619ab8476ac382844c8e13cb6a27127b78948"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/comments", "author": null, "committer": null, "parents": [{"sha": "b9809dc4cf74a31f6b7a059c48b0995518e6e782", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9809dc4cf74a31f6b7a059c48b0995518e6e782", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9809dc4cf74a31f6b7a059c48b0995518e6e782"}], "stats": {"total": 28, "additions": 22, "deletions": 6}, "files": [{"sha": "434b974d635c5d2aa726fd1a3c709e2e4d2e36e9", "filename": "libcilkrts/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/libcilkrts%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/libcilkrts%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2FChangeLog?ref=0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "patch": "@@ -1,3 +1,10 @@\n+2014-02-18  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n+\n+\t* include/cilk/common.h (__CILKRTS_ABI_VERSION): Set the ABI version\n+\tto 1 instead of 0.\n+\t* runtime/cilk-abi-cilk-for.cpp (cilk_for_recursive): Added a fix to\n+\tinitialize stack frame correctly.\n+\n 2014-02-10  Balaji V. Iyer  <balaji.v.iyer@intel.com>\n \n \tPR target/59691"}, {"sha": "97dd66e0639b4ca7d709905507e3753ffe282583", "filename": "libcilkrts/include/cilk/common.h", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/libcilkrts%2Finclude%2Fcilk%2Fcommon.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/libcilkrts%2Finclude%2Fcilk%2Fcommon.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2Finclude%2Fcilk%2Fcommon.h?ref=0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "patch": "@@ -317,13 +317,12 @@ namespace cilk {\n #ifndef __CILKRTS_ABI_VERSION\n #   ifdef IN_CILK_RUNTIME\n #       define __CILKRTS_ABI_VERSION 1\n-#   elif __INTEL_COMPILER > 1200\n-        // Intel compiler version >= 12.1\n-#       define __CILKRTS_ABI_VERSION 1\n-#   else\n-        // Compiler does not support ABI version 1\n-        // (Non-Intel compiler or Intel compiler prior to version 12.1).\n+#   elif defined(__INTEL_COMPILER) && (__INTEL_COMPILER <= 1200)\n+        // Intel compilers prior to version 12.1 support only ABI 0\n #       define __CILKRTS_ABI_VERSION 0\n+#   else\n+        // Non-Intel compiler or Intel compiler after version 12.0.\n+#       define __CILKRTS_ABI_VERSION 1\n #   endif\n #endif\n "}, {"sha": "4cd04f521cf2428d36c88bac1d7424dc75cf9ebd", "filename": "libcilkrts/runtime/cilk-abi-cilk-for.cpp", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/libcilkrts%2Fruntime%2Fcilk-abi-cilk-for.cpp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0cfe1b4698da3b3ef6b75142f0daef9687e4d63a/libcilkrts%2Fruntime%2Fcilk-abi-cilk-for.cpp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libcilkrts%2Fruntime%2Fcilk-abi-cilk-for.cpp?ref=0cfe1b4698da3b3ef6b75142f0daef9687e4d63a", "patch": "@@ -256,9 +256,19 @@ void cilk_for_recursive(count_t low, count_t high,\n         // argument list of the spawned function, hence the call to\n         // capture_spawn_arg_stack_frame().\n         __cilkrts_stack_frame *sf;\n+#if defined(__GNUC__) && ! defined(__INTEL_COMPILER) && ! defined(__clang__)\n+        // The current version of gcc initializes the sf structure eagerly.\n+        // We can take advantage of this fact to avoid calling\n+        // `capture_spawn_arg_stack_frame` when compiling with gcc.\n+        // Remove this if the \"shrink-wrap\" optimization is implemented.\n+        sf = w->current_stack_frame;\n+        _Cilk_spawn cilk_for_recursive(low, mid, body, data, grain, w,\n+                                       loop_root_pedigree);\n+#else        \n         _Cilk_spawn cilk_for_recursive(low, mid, body, data, grain,\n                                        capture_spawn_arg_stack_frame(sf, w),\n                                        loop_root_pedigree);\n+#endif\n         w = sf->worker;\n         low = mid;\n "}]}