{"sha": "292ffe8608e86772301bf7463ecd1e5e66de8c8d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjkyZmZlODYwOGU4Njc3MjMwMWJmNzQ2M2VjZDFlNWU2NmRlOGM4ZA==", "commit": {"author": {"name": "Cary Coutant", "email": "ccoutant@google.com", "date": "2012-08-06T22:49:05Z"}, "committer": {"name": "Cary Coutant", "email": "ccoutant@gcc.gnu.org", "date": "2012-08-06T22:49:05Z"}, "message": "cgraphunit.c (assemble_thunk): Add source line info.\n\n2012-08-06  Cary Coutant  <ccoutant@google.com>\n\ngcc/\n\t* cgraphunit.c (assemble_thunk): Add source line info.\n\t* final.c (final): Check for non-null cfg pointer.\n\ngcc/testsuite/\n\t* g++.dg/debug/dwarf2/non-virtual-thunk.C: New test case.\n\nFrom-SVN: r190190", "tree": {"sha": "b93db13b742aa3913318cc28093782f8de4635c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b93db13b742aa3913318cc28093782f8de4635c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/292ffe8608e86772301bf7463ecd1e5e66de8c8d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/292ffe8608e86772301bf7463ecd1e5e66de8c8d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/292ffe8608e86772301bf7463ecd1e5e66de8c8d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/292ffe8608e86772301bf7463ecd1e5e66de8c8d/comments", "author": null, "committer": null, "parents": [{"sha": "d28cfc4ae6c8651b1631c8c00f016d8258de7458", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d28cfc4ae6c8651b1631c8c00f016d8258de7458", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d28cfc4ae6c8651b1631c8c00f016d8258de7458"}], "stats": {"total": 64, "additions": 59, "deletions": 5}, "files": [{"sha": "e87e0d4f091755218861112b65c41592bf3975f5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=292ffe8608e86772301bf7463ecd1e5e66de8c8d", "patch": "@@ -1,3 +1,8 @@\n+2012-08-06  Cary Coutant  <ccoutant@google.com>\n+\n+\t* cgraphunit.c (assemble_thunk): Add source line info.\n+\t* final.c (final): Check for non-null cfg pointer.\n+\n 2012-08-06  Sandra Loosemore  <sandra@codesourcery.com>\n \t    Maxim Kuvyrkov  <maxim@codesourcery.com>\n \t    Julian Brown  <julian@codesourcery.com>"}, {"sha": "2dd0871e73681f15d68c8b5bc212454db068279b", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=292ffe8608e86772301bf7463ecd1e5e66de8c8d", "patch": "@@ -1381,6 +1381,10 @@ assemble_thunk (struct cgraph_node *node)\n       init_function_start (thunk_fndecl);\n       cfun->is_thunk = 1;\n       assemble_start_function (thunk_fndecl, fnname);\n+      (*debug_hooks->source_line) (DECL_SOURCE_LINE (thunk_fndecl),\n+\t\t\t\t   DECL_SOURCE_FILE (thunk_fndecl),\n+\t\t\t\t   /* discriminator */ 0,\n+\t\t\t\t   /* is_stmt */ 1);\n \n       targetm.asm_out.output_mi_thunk (asm_out_file, thunk_fndecl,\n \t\t\t\t       fixed_offset, virtual_value, alias);"}, {"sha": "30890b3ce223df7a918691583b9adf6b9515eef4", "filename": "gcc/final.c", "status": "modified", "additions": 7, "deletions": 5, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=292ffe8608e86772301bf7463ecd1e5e66de8c8d", "patch": "@@ -1863,11 +1863,13 @@ final (rtx first, FILE *file, int optimize_p)\n       start_to_bb = XCNEWVEC (basic_block, bb_map_size);\n       end_to_bb = XCNEWVEC (basic_block, bb_map_size);\n \n-      FOR_EACH_BB_REVERSE (bb)\n-\t{\n-\t  start_to_bb[INSN_UID (BB_HEAD (bb))] = bb;\n-\t  end_to_bb[INSN_UID (BB_END (bb))] = bb;\n-\t}\n+      /* There is no cfg for a thunk.  */\n+      if (!cfun->is_thunk)\n+\tFOR_EACH_BB_REVERSE (bb)\n+\t  {\n+\t    start_to_bb[INSN_UID (BB_HEAD (bb))] = bb;\n+\t    end_to_bb[INSN_UID (BB_END (bb))] = bb;\n+\t  }\n     }\n \n   /* Output the insns.  */"}, {"sha": "5eeb52629eb83130c2a8436d414f61c28178ba4a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=292ffe8608e86772301bf7463ecd1e5e66de8c8d", "patch": "@@ -1,3 +1,7 @@\n+2012-08-06  Cary Coutant  <ccoutant@google.com>\n+\n+\t* g++.dg/debug/dwarf2/non-virtual-thunk.C: New test case.\n+\n 2012-08-06  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/35831"}, {"sha": "8ad347a7cc3f0fa4727a053560a8ba1142ad5d50", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/non-virtual-thunk.C", "status": "added", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnon-virtual-thunk.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/292ffe8608e86772301bf7463ecd1e5e66de8c8d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnon-virtual-thunk.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fnon-virtual-thunk.C?ref=292ffe8608e86772301bf7463ecd1e5e66de8c8d", "patch": "@@ -0,0 +1,39 @@\n+// { dg-do compile }\n+// { dg-options \"-g2 -dA\" }\n+\n+// Verify that line number info is output for the non-virtual\n+// thunks for C::~C().\n+// { dg-final { scan-assembler \"thunk.C:30\" } }\n+\n+class A\n+{\n+ public:\n+  A();\n+  virtual ~A();\n+ private:\n+  int i;\n+};\n+\n+class B\n+{\n+ public:\n+  B();\n+  virtual ~B();\n+ private:\n+  int i;\n+};\n+\n+class C : public A, public B\n+{\n+ public:\n+  C();\n+  virtual ~C(); // line 30\n+};\n+\n+C::C()\n+{\n+}\n+\n+C::~C()\n+{\n+}"}]}