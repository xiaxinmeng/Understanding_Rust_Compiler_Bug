{"sha": "f698fccf099a69415619858062431c9383caf070", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjY5OGZjY2YwOTlhNjk0MTU2MTk4NTgwNjI0MzFjOTM4M2NhZjA3MA==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2018-07-31T14:23:34Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2018-07-31T14:23:34Z"}, "message": "[21/46] Make grouped_stores and reduction_chains use stmt_vec_infos\n\nThis patch changes the SLP lists grouped_stores and reduction_chains\nfrom auto_vec<gimple *> to auto_vec<stmt_vec_info>.  It was easier\nto do them together due to the way vect_analyze_slp is structured.\n\n2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/\n\t* tree-vectorizer.h (vec_info::grouped_stores): Change from\n\tan auto_vec<gimple *> to an auto_vec<stmt_vec_info>.\n\t(_loop_vec_info::reduction_chains): Likewise.\n\t* tree-vect-loop.c (vect_fixup_scalar_cycles_with_patterns): Update\n\taccordingly.\n\t* tree-vect-slp.c (vect_analyze_slp): Likewise.\n\nFrom-SVN: r263136", "tree": {"sha": "b6feb44b4ea43dc76e88f7c5f85471d232ce0b73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b6feb44b4ea43dc76e88f7c5f85471d232ce0b73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f698fccf099a69415619858062431c9383caf070", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f698fccf099a69415619858062431c9383caf070", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f698fccf099a69415619858062431c9383caf070", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f698fccf099a69415619858062431c9383caf070/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bffb8014d0566af64c3cd5c7afac21c125a14df2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bffb8014d0566af64c3cd5c7afac21c125a14df2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bffb8014d0566af64c3cd5c7afac21c125a14df2"}], "stats": {"total": 33, "additions": 20, "deletions": 13}, "files": [{"sha": "91deba0361a46d34e4268c4d19843534bb0c859d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f698fccf099a69415619858062431c9383caf070/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f698fccf099a69415619858062431c9383caf070/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f698fccf099a69415619858062431c9383caf070", "patch": "@@ -1,3 +1,12 @@\n+2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-vectorizer.h (vec_info::grouped_stores): Change from\n+\tan auto_vec<gimple *> to an auto_vec<stmt_vec_info>.\n+\t(_loop_vec_info::reduction_chains): Likewise.\n+\t* tree-vect-loop.c (vect_fixup_scalar_cycles_with_patterns): Update\n+\taccordingly.\n+\t* tree-vect-slp.c (vect_analyze_slp): Likewise.\n+\n 2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* tree-vectorizer.h (_stmt_vec_info::first_element): Change from"}, {"sha": "e611e9908e33d227325e2914db12a0f32b058b45", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f698fccf099a69415619858062431c9383caf070/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f698fccf099a69415619858062431c9383caf070/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=f698fccf099a69415619858062431c9383caf070", "patch": "@@ -677,13 +677,13 @@ vect_fixup_reduc_chain (gimple *stmt)\n static void\n vect_fixup_scalar_cycles_with_patterns (loop_vec_info loop_vinfo)\n {\n-  gimple *first;\n+  stmt_vec_info first;\n   unsigned i;\n \n   FOR_EACH_VEC_ELT (LOOP_VINFO_REDUCTION_CHAINS (loop_vinfo), i, first)\n-    if (STMT_VINFO_IN_PATTERN_P (vinfo_for_stmt (first)))\n+    if (STMT_VINFO_IN_PATTERN_P (first))\n       {\n-\tstmt_vec_info next = REDUC_GROUP_NEXT_ELEMENT (vinfo_for_stmt (first));\n+\tstmt_vec_info next = REDUC_GROUP_NEXT_ELEMENT (first);\n \twhile (next)\n \t  {\n \t    if (! STMT_VINFO_IN_PATTERN_P (next))\n@@ -696,7 +696,7 @@ vect_fixup_scalar_cycles_with_patterns (loop_vec_info loop_vinfo)\n \t  {\n \t    vect_fixup_reduc_chain (first);\n \t    LOOP_VINFO_REDUCTION_CHAINS (loop_vinfo)[i]\n-\t      = STMT_VINFO_RELATED_STMT (vinfo_for_stmt (first));\n+\t      = STMT_VINFO_RELATED_STMT (first);\n \t  }\n       }\n }"}, {"sha": "67877959dde1d8500a46706a8e33a94cf43d4ca8", "filename": "gcc/tree-vect-slp.c", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f698fccf099a69415619858062431c9383caf070/gcc%2Ftree-vect-slp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f698fccf099a69415619858062431c9383caf070/gcc%2Ftree-vect-slp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-slp.c?ref=f698fccf099a69415619858062431c9383caf070", "patch": "@@ -2202,7 +2202,7 @@ bool\n vect_analyze_slp (vec_info *vinfo, unsigned max_tree_size)\n {\n   unsigned int i;\n-  gimple *first_element;\n+  stmt_vec_info first_element;\n \n   DUMP_VECT_SCOPE (\"vect_analyze_slp\");\n \n@@ -2220,17 +2220,15 @@ vect_analyze_slp (vec_info *vinfo, unsigned max_tree_size)\n \t\t\t\t\t     max_tree_size))\n \t      {\n \t\t/* Dissolve reduction chain group.  */\n-\t\tgimple *stmt = first_element;\n-\t\twhile (stmt)\n+\t\tstmt_vec_info vinfo = first_element;\n+\t\twhile (vinfo)\n \t\t  {\n-\t\t    stmt_vec_info vinfo = vinfo_for_stmt (stmt);\n \t\t    stmt_vec_info next = REDUC_GROUP_NEXT_ELEMENT (vinfo);\n \t\t    REDUC_GROUP_FIRST_ELEMENT (vinfo) = NULL;\n \t\t    REDUC_GROUP_NEXT_ELEMENT (vinfo) = NULL;\n-\t\t    stmt = next;\n+\t\t    vinfo = next;\n \t\t  }\n-\t\tSTMT_VINFO_DEF_TYPE (vinfo_for_stmt (first_element))\n-\t\t  = vect_internal_def;\n+\t\tSTMT_VINFO_DEF_TYPE (first_element) = vect_internal_def;\n \t      }\n \t}\n "}, {"sha": "24020d239f124ab86334eeebd39c621c9e19ff91", "filename": "gcc/tree-vectorizer.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f698fccf099a69415619858062431c9383caf070/gcc%2Ftree-vectorizer.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f698fccf099a69415619858062431c9383caf070/gcc%2Ftree-vectorizer.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vectorizer.h?ref=f698fccf099a69415619858062431c9383caf070", "patch": "@@ -259,7 +259,7 @@ struct vec_info {\n \n   /* All interleaving chains of stores, represented by the first\n      stmt in the chain.  */\n-  auto_vec<gimple *> grouped_stores;\n+  auto_vec<stmt_vec_info> grouped_stores;\n \n   /* Cost data used by the target cost model.  */\n   void *target_cost_data;\n@@ -479,7 +479,7 @@ typedef struct _loop_vec_info : public vec_info {\n \n   /* All reduction chains in the loop, represented by the first\n      stmt in the chain.  */\n-  auto_vec<gimple *> reduction_chains;\n+  auto_vec<stmt_vec_info> reduction_chains;\n \n   /* Cost vector for a single scalar iteration.  */\n   auto_vec<stmt_info_for_cost> scalar_cost_vec;"}]}