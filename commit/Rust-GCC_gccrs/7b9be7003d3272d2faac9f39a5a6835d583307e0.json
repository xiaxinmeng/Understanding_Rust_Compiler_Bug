{"sha": "7b9be7003d3272d2faac9f39a5a6835d583307e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2I5YmU3MDAzZDMyNzJkMmZhYWM5ZjM5YTVhNjgzNWQ1ODMzMDdlMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-03-16T08:06:41Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-03-16T08:06:41Z"}, "message": "re PR tree-optimization/84841 (ICE: tree check: expected ssa_name, have real_cst in rewrite_expr_tree_parallel, at tree-ssa-reassoc.c:4624)\n\n\tPR tree-optimization/84841\n\t* tree-ssa-reassoc.c (INTEGER_CONST_TYPE): Change to 1 << 4 from\n\t1 << 3.\n\t(FLOAT_ONE_CONST_TYPE): Define.\n\t(constant_type): Return FLOAT_ONE_CONST_TYPE for -1.0 and 1.0.\n\t(sort_by_operand_rank): Put entries with higher constant_type last\n\trather than first to match comments.\n\n\t* gcc.dg/pr84841.c: New test.\n\nFrom-SVN: r258586", "tree": {"sha": "403b3c0cc2e831ced8bc874ee678a2f81afae208", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/403b3c0cc2e831ced8bc874ee678a2f81afae208"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b9be7003d3272d2faac9f39a5a6835d583307e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b9be7003d3272d2faac9f39a5a6835d583307e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b9be7003d3272d2faac9f39a5a6835d583307e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b9be7003d3272d2faac9f39a5a6835d583307e0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "828fd2fbe88ee6adb16b708d584caf96237046da", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/828fd2fbe88ee6adb16b708d584caf96237046da", "html_url": "https://github.com/Rust-GCC/gccrs/commit/828fd2fbe88ee6adb16b708d584caf96237046da"}], "stats": {"total": 36, "additions": 33, "deletions": 3}, "files": [{"sha": "57e92ac762af037649509c3cc5039781c3d60c60", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7b9be7003d3272d2faac9f39a5a6835d583307e0", "patch": "@@ -1,3 +1,13 @@\n+2018-03-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/84841\n+\t* tree-ssa-reassoc.c (INTEGER_CONST_TYPE): Change to 1 << 4 from\n+\t1 << 3.\n+\t(FLOAT_ONE_CONST_TYPE): Define.\n+\t(constant_type): Return FLOAT_ONE_CONST_TYPE for -1.0 and 1.0.\n+\t(sort_by_operand_rank): Put entries with higher constant_type last\n+\trather than first to match comments.\n+\n 2018-03-15  Sandra Loosemore  <sandra@codesourcery.com>\n \n \t* config/nios2/nios2.md (movsi_internal): Fix thinko in "}, {"sha": "4c03ff22ea7f1fd1d18a36f377e38555f4e64bca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7b9be7003d3272d2faac9f39a5a6835d583307e0", "patch": "@@ -1,5 +1,8 @@\n 2018-03-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/84841\n+\t* gcc.dg/pr84841.c: New test.\n+\n \tPR c++/84874\n \t* g++.dg/cpp2a/desig7.C: New test.\n "}, {"sha": "4f7422a659ffd3b6b0cdacc8071a6ca3f67614b6", "filename": "gcc/testsuite/gcc.dg/pr84841.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84841.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84841.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr84841.c?ref=7b9be7003d3272d2faac9f39a5a6835d583307e0", "patch": "@@ -0,0 +1,9 @@\n+/* PR tree-optimization/84841 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fassociative-math -frounding-math -fno-signed-zeros -fno-trapping-math -fno-tree-forwprop\" } */\n+\n+double\n+foo (double x)\n+{\n+  return -x * 0.1 * 0.1;\n+}"}, {"sha": "0e59bb595ea7c034fb49cf8583d0a8567c3edf12", "filename": "gcc/tree-ssa-reassoc.c", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2Ftree-ssa-reassoc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b9be7003d3272d2faac9f39a5a6835d583307e0/gcc%2Ftree-ssa-reassoc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-reassoc.c?ref=7b9be7003d3272d2faac9f39a5a6835d583307e0", "patch": "@@ -470,7 +470,8 @@ get_rank (tree e)\n \n /* We want integer ones to end up last no matter what, since they are\n    the ones we can do the most with.  */\n-#define INTEGER_CONST_TYPE 1 << 3\n+#define INTEGER_CONST_TYPE 1 << 4\n+#define FLOAT_ONE_CONST_TYPE 1 << 3\n #define FLOAT_CONST_TYPE 1 << 2\n #define OTHER_CONST_TYPE 1 << 1\n \n@@ -482,7 +483,14 @@ constant_type (tree t)\n   if (INTEGRAL_TYPE_P (TREE_TYPE (t)))\n     return INTEGER_CONST_TYPE;\n   else if (SCALAR_FLOAT_TYPE_P (TREE_TYPE (t)))\n-    return FLOAT_CONST_TYPE;\n+    {\n+      /* Sort -1.0 and 1.0 constants last, while in some cases\n+\t const_binop can't optimize some inexact operations, multiplication\n+\t by -1.0 or 1.0 can be always merged with others.  */\n+      if (real_onep (t) || real_minus_onep (t))\n+\treturn FLOAT_ONE_CONST_TYPE;\n+      return FLOAT_CONST_TYPE;\n+    }\n   else\n     return OTHER_CONST_TYPE;\n }\n@@ -504,7 +512,7 @@ sort_by_operand_rank (const void *pa, const void *pb)\n   if (oea->rank == 0)\n     {\n       if (constant_type (oeb->op) != constant_type (oea->op))\n-\treturn constant_type (oeb->op) - constant_type (oea->op);\n+\treturn constant_type (oea->op) - constant_type (oeb->op);\n       else\n \t/* To make sorting result stable, we use unique IDs to determine\n \t   order.  */"}]}