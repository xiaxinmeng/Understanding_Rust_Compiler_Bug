{"sha": "b0fe107eedb0f6d1f86639372e614587d8df3a5d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjBmZTEwN2VlZGIwZjZkMWY4NjYzOTM3MmU2MTQ1ODdkOGRmM2E1ZA==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2013-01-15T16:17:28Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2013-01-15T16:17:28Z"}, "message": "re PR target/43961 ([ARM thumb] \"branch out of range\" with thumb1_output_casesi)\n\n2013-01-15  Joseph Myers  <joseph@codesourcery.com>\n\t    Mikael Pettersson  <mikpe@it.uu.se>\n\n\tPR target/43961\n\t* config/arm/arm.h (ADDR_VEC_ALIGN): Align SImode jump tables for\n\tThumb.\n\t(ASM_OUTPUT_CASE_LABEL): Remove.\n\t(ASM_OUTPUT_BEFORE_CASE_LABEL): Define to empty.\n\t* final.c (shorten_branches): Update alignment of labels before\n\tjump tables if CASE_VECTOR_SHORTEN_MODE.\n\nCo-Authored-By: Mikael Pettersson <mikpe@it.uu.se>\n\nFrom-SVN: r195208", "tree": {"sha": "6ca9b91464994dadabc30601888a873a0f454f7c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ca9b91464994dadabc30601888a873a0f454f7c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0fe107eedb0f6d1f86639372e614587d8df3a5d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0fe107eedb0f6d1f86639372e614587d8df3a5d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0fe107eedb0f6d1f86639372e614587d8df3a5d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0fe107eedb0f6d1f86639372e614587d8df3a5d/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b164615d7992868eed1ff874b2ac0e2d1a73bffb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b164615d7992868eed1ff874b2ac0e2d1a73bffb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b164615d7992868eed1ff874b2ac0e2d1a73bffb"}], "stats": {"total": 55, "additions": 41, "deletions": 14}, "files": [{"sha": "f900422f2d9819fff4bc843c6e2eb7fe296695fa", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0fe107eedb0f6d1f86639372e614587d8df3a5d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0fe107eedb0f6d1f86639372e614587d8df3a5d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b0fe107eedb0f6d1f86639372e614587d8df3a5d", "patch": "@@ -1,3 +1,14 @@\n+2013-01-15  Joseph Myers  <joseph@codesourcery.com>\n+\t    Mikael Pettersson  <mikpe@it.uu.se>\n+\n+\tPR target/43961\n+\t* config/arm/arm.h (ADDR_VEC_ALIGN): Align SImode jump tables for\n+\tThumb.\n+\t(ASM_OUTPUT_CASE_LABEL): Remove.\n+\t(ASM_OUTPUT_BEFORE_CASE_LABEL): Define to empty.\n+\t* final.c (shorten_branches): Update alignment of labels before\n+\tjump tables if CASE_VECTOR_SHORTEN_MODE.\n+\n 2013-01-15  Richard Biener  <rguenther@suse.de>\n \n \tPR bootstrap/55961"}, {"sha": "6d336e89ee9527a7b91df7115e7dfcab623b757d", "filename": "gcc/config/arm/arm.h", "status": "modified", "additions": 7, "deletions": 14, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0fe107eedb0f6d1f86639372e614587d8df3a5d/gcc%2Fconfig%2Farm%2Farm.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0fe107eedb0f6d1f86639372e614587d8df3a5d/gcc%2Fconfig%2Farm%2Farm.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.h?ref=b0fe107eedb0f6d1f86639372e614587d8df3a5d", "patch": "@@ -2129,20 +2129,13 @@ extern int making_const_table;\n \tasm_fprintf (STREAM, \"\\tpop {%r}\\n\", REGNO);\t\\\n     } while (0)\n \n-/* Jump table alignment is explicit in ASM_OUTPUT_CASE_LABEL.  */\n-#define ADDR_VEC_ALIGN(JUMPTABLE) 0\n-\n-/* This is how to output a label which precedes a jumptable.  Since\n-   Thumb instructions are 2 bytes, we may need explicit alignment here.  */\n-#undef  ASM_OUTPUT_CASE_LABEL\n-#define ASM_OUTPUT_CASE_LABEL(FILE, PREFIX, NUM, JUMPTABLE)\t\t\\\n-  do\t\t\t\t\t\t\t\t\t\\\n-    {\t\t\t\t\t\t\t\t\t\\\n-      if (TARGET_THUMB && GET_MODE (PATTERN (JUMPTABLE)) == SImode)\t\\\n-        ASM_OUTPUT_ALIGN (FILE, 2);\t\t\t\t\t\\\n-      (*targetm.asm_out.internal_label) (FILE, PREFIX, NUM);\t\t\\\n-    }\t\t\t\t\t\t\t\t\t\\\n-  while (0)\n+#define ADDR_VEC_ALIGN(JUMPTABLE)\t\\\n+  ((TARGET_THUMB && GET_MODE (PATTERN (JUMPTABLE)) == SImode) ? 2 : 0)\n+\n+/* Alignment for case labels comes from ADDR_VEC_ALIGN; avoid the\n+   default alignment from elfos.h.  */\n+#undef ASM_OUTPUT_BEFORE_CASE_LABEL\n+#define ASM_OUTPUT_BEFORE_CASE_LABEL(FILE, PREFIX, NUM, TABLE) /* Empty.  */\n \n /* Make sure subsequent insns are aligned after a TBB.  */\n #define ASM_OUTPUT_CASE_END(FILE, NUM, JUMPTABLE)\t\\"}, {"sha": "d5154db2c4288ddd1b3290c726c1fc5881c430b0", "filename": "gcc/final.c", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0fe107eedb0f6d1f86639372e614587d8df3a5d/gcc%2Ffinal.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0fe107eedb0f6d1f86639372e614587d8df3a5d/gcc%2Ffinal.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffinal.c?ref=b0fe107eedb0f6d1f86639372e614587d8df3a5d", "patch": "@@ -1182,6 +1182,29 @@ shorten_branches (rtx first)\n \t  if (LABEL_P (insn))\n \t    {\n \t      int log = LABEL_TO_ALIGNMENT (insn);\n+\n+#ifdef CASE_VECTOR_SHORTEN_MODE\n+\t      /* If the mode of a following jump table was changed, we\n+\t\t may need to update the alignment of this label.  */\n+\t      rtx next;\n+\t      bool next_is_jumptable;\n+\n+\t      next = next_nonnote_insn (insn);\n+\t      next_is_jumptable = next && JUMP_TABLE_DATA_P (next);\n+\t      if ((JUMP_TABLES_IN_TEXT_SECTION\n+\t\t   || readonly_data_section == text_section)\n+\t\t  && next_is_jumptable)\n+\t\t{\n+\t\t  int newlog = ADDR_VEC_ALIGN (next);\n+\t\t  if (newlog != log)\n+\t\t    {\n+\t\t      log = newlog;\n+\t\t      LABEL_TO_ALIGNMENT (insn) = log;\n+\t\t      something_changed = 1;\n+\t\t    }\n+\t\t}\n+#endif\n+\n \t      if (log > insn_current_align)\n \t\t{\n \t\t  int align = 1 << log;"}]}