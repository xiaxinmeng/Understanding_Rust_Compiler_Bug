{"sha": "d2903ce05bf055daeafe14e8b0b2be133ce180be", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDI5MDNjZTA1YmYwNTVkYWVhZmUxNGU4YjBiMmJlMTMzY2UxODBiZQ==", "commit": {"author": {"name": "Andrew Stubbs", "email": "ams@codesourcery.com", "date": "2019-11-13T12:37:59Z"}, "committer": {"name": "Andrew Stubbs", "email": "ams@gcc.gnu.org", "date": "2019-11-13T12:37:59Z"}, "message": "Add device number to GOMP_OFFLOAD_openacc_async_construct\n\n2019-11-13  Andrew Stubbs  <ams@codesourcery.com>\n\t    Julian Brown  <julian@codesourcery.com>\n\n\tlibgomp/\n\t* libgomp-plugin.h (GOMP_OFFLOAD_openacc_async_construct): Add int\n\tparameter.\n\t* oacc-async.c (lookup_goacc_asyncqueue): Pass device number to the\n\tqueue constructor.\n\t* oacc-host.c (host_openacc_async_construct): Add device parameter.\n\t* plugin/plugin-nvptx.c (GOMP_OFFLOAD_openacc_async_construct): Add\n\tdevice parameter.\n\nCo-Authored-By: Julian Brown <julian@codesourcery.com>\n\nFrom-SVN: r278134", "tree": {"sha": "575a571c8a489083b17dc60bb57a3f8890e81f5f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/575a571c8a489083b17dc60bb57a3f8890e81f5f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2903ce05bf055daeafe14e8b0b2be133ce180be", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2903ce05bf055daeafe14e8b0b2be133ce180be", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2903ce05bf055daeafe14e8b0b2be133ce180be", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2903ce05bf055daeafe14e8b0b2be133ce180be/comments", "author": {"login": "ams-cs", "id": 2235130, "node_id": "MDQ6VXNlcjIyMzUxMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2235130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ams-cs", "html_url": "https://github.com/ams-cs", "followers_url": "https://api.github.com/users/ams-cs/followers", "following_url": "https://api.github.com/users/ams-cs/following{/other_user}", "gists_url": "https://api.github.com/users/ams-cs/gists{/gist_id}", "starred_url": "https://api.github.com/users/ams-cs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ams-cs/subscriptions", "organizations_url": "https://api.github.com/users/ams-cs/orgs", "repos_url": "https://api.github.com/users/ams-cs/repos", "events_url": "https://api.github.com/users/ams-cs/events{/privacy}", "received_events_url": "https://api.github.com/users/ams-cs/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "15e9e6795d044364c9d852f48665778c96728955", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15e9e6795d044364c9d852f48665778c96728955", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15e9e6795d044364c9d852f48665778c96728955"}], "stats": {"total": 20, "additions": 16, "deletions": 4}, "files": [{"sha": "c8977988060fc638338e25b5923cd7d09fc12f94", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=d2903ce05bf055daeafe14e8b0b2be133ce180be", "patch": "@@ -1,3 +1,14 @@\n+2019-11-13  Andrew Stubbs  <ams@codesourcery.com>\n+\t    Julian Brown  <julian@codesourcery.com>\n+\n+\t* libgomp-plugin.h (GOMP_OFFLOAD_openacc_async_construct): Add int\n+\tparameter.\n+\t* oacc-async.c (lookup_goacc_asyncqueue): Pass device number to the\n+\tqueue constructor.\n+\t* oacc-host.c (host_openacc_async_construct): Add device parameter.\n+\t* plugin/plugin-nvptx.c (GOMP_OFFLOAD_openacc_async_construct): Add\n+\tdevice parameter.\n+\n 2019-11-13  Andrew Stubbs  <ams@codesourcery.com>\n \n \t* configure.tgt (nvptx*-*-*): Add \"accel\" directory."}, {"sha": "de969e1ba4562e9f81fbd61a3edde23722c7520c", "filename": "libgomp/libgomp-plugin.h", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Flibgomp-plugin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Flibgomp-plugin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Flibgomp-plugin.h?ref=d2903ce05bf055daeafe14e8b0b2be133ce180be", "patch": "@@ -112,7 +112,7 @@ extern void GOMP_OFFLOAD_openacc_exec (void (*) (void *), size_t, void **,\n \t\t\t\t       void **, unsigned *, void *);\n extern void *GOMP_OFFLOAD_openacc_create_thread_data (int);\n extern void GOMP_OFFLOAD_openacc_destroy_thread_data (void *);\n-extern struct goacc_asyncqueue *GOMP_OFFLOAD_openacc_async_construct (void);\n+extern struct goacc_asyncqueue *GOMP_OFFLOAD_openacc_async_construct (int);\n extern bool GOMP_OFFLOAD_openacc_async_destruct (struct goacc_asyncqueue *);\n extern int GOMP_OFFLOAD_openacc_async_test (struct goacc_asyncqueue *);\n extern bool GOMP_OFFLOAD_openacc_async_synchronize (struct goacc_asyncqueue *);"}, {"sha": "2b24ae7adc28a71293bae94bbcb5e31b23125e63", "filename": "libgomp/oacc-async.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Foacc-async.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Foacc-async.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Foacc-async.c?ref=d2903ce05bf055daeafe14e8b0b2be133ce180be", "patch": "@@ -100,7 +100,8 @@ lookup_goacc_asyncqueue (struct goacc_thread *thr, bool create, int async)\n \n   if (!dev->openacc.async.asyncqueue[async])\n     {\n-      dev->openacc.async.asyncqueue[async] = dev->openacc.async.construct_func ();\n+      dev->openacc.async.asyncqueue[async]\n+\t= dev->openacc.async.construct_func (dev->target_id);\n \n       if (!dev->openacc.async.asyncqueue[async])\n \t{"}, {"sha": "cbcac9bf7b3319e7d29180035a9b2fd9b2ae9dd2", "filename": "libgomp/oacc-host.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Foacc-host.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Foacc-host.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Foacc-host.c?ref=d2903ce05bf055daeafe14e8b0b2be133ce180be", "patch": "@@ -211,7 +211,7 @@ host_openacc_async_queue_callback (struct goacc_asyncqueue *aq\n }\n \n static struct goacc_asyncqueue *\n-host_openacc_async_construct (void)\n+host_openacc_async_construct (int device __attribute__((unused)))\n {\n   /* Non-NULL 0xffff... value as opaque dummy.  */\n   return (struct goacc_asyncqueue *) -1;"}, {"sha": "911d0f66a6e4dad9108061d98886dae234cd2f04", "filename": "libgomp/plugin/plugin-nvptx.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Fplugin%2Fplugin-nvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2903ce05bf055daeafe14e8b0b2be133ce180be/libgomp%2Fplugin%2Fplugin-nvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fplugin-nvptx.c?ref=d2903ce05bf055daeafe14e8b0b2be133ce180be", "patch": "@@ -1575,7 +1575,7 @@ GOMP_OFFLOAD_openacc_cuda_set_stream (struct goacc_asyncqueue *aq, void *stream)\n }\n \n struct goacc_asyncqueue *\n-GOMP_OFFLOAD_openacc_async_construct (void)\n+GOMP_OFFLOAD_openacc_async_construct (int device __attribute__((unused)))\n {\n   CUstream stream = NULL;\n   CUDA_CALL_ERET (NULL, cuStreamCreate, &stream, CU_STREAM_DEFAULT);"}]}