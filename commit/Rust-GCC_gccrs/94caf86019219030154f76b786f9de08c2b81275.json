{"sha": "94caf86019219030154f76b786f9de08c2b81275", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTRjYWY4NjAxOTIxOTAzMDE1NGY3NmI3ODZmOWRlMDhjMmI4MTI3NQ==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2016-10-24T16:45:55Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2016-10-24T16:45:55Z"}, "message": "Fix error handling in filesystem::is_empty\n\n\t* src/filesystem/ops.cc (is_empty): Fix error handling.\n\t* testsuite/experimental/filesystem/operations/is_empty.cc: New test.\n\nFrom-SVN: r241488", "tree": {"sha": "512d1099877f7738338a4b5227574b47cfa24b7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/512d1099877f7738338a4b5227574b47cfa24b7e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94caf86019219030154f76b786f9de08c2b81275", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94caf86019219030154f76b786f9de08c2b81275", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94caf86019219030154f76b786f9de08c2b81275", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94caf86019219030154f76b786f9de08c2b81275/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6daff2d946a2a656b5796e00d6ad65660315d565", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6daff2d946a2a656b5796e00d6ad65660315d565", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6daff2d946a2a656b5796e00d6ad65660315d565"}], "stats": {"total": 17, "additions": 12, "deletions": 5}, "files": [{"sha": "e551d392da1bb15a2393c304ae6b21ac688523c8", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94caf86019219030154f76b786f9de08c2b81275/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94caf86019219030154f76b786f9de08c2b81275/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=94caf86019219030154f76b786f9de08c2b81275", "patch": "@@ -1,5 +1,8 @@\n 2016-10-24  Jonathan Wakely  <jwakely@redhat.com>\n \n+\t* src/filesystem/ops.cc (is_empty): Fix error handling.\n+\t* testsuite/experimental/filesystem/operations/is_empty.cc: New test.\n+\n \tPR libstdc++/71337\n \t* src/filesystem/ops.cc (temp_directory_path): Pass error_code\n \targument to other filesystem operations."}, {"sha": "d9a12df5fa20848fc03b804556ea04002b56598c", "filename": "libstdc++-v3/src/filesystem/ops.cc", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94caf86019219030154f76b786f9de08c2b81275/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94caf86019219030154f76b786f9de08c2b81275/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Fsrc%2Ffilesystem%2Fops.cc?ref=94caf86019219030154f76b786f9de08c2b81275", "patch": "@@ -1022,20 +1022,24 @@ fs::hard_link_count(const path& p, error_code& ec) noexcept\n bool\n fs::is_empty(const path& p)\n {\n-  return fs::is_directory(status(p))\n-    ? fs::directory_iterator(p) == fs::directory_iterator()\n-    : fs::file_size(p) == 0;\n+  error_code ec;\n+  bool e = is_empty(p, ec);\n+  if (ec)\n+    _GLIBCXX_THROW_OR_ABORT(filesystem_error(\"cannot check is file is empty\",\n+\t\t\t\t\t     p, ec));\n+  return e;\n }\n \n bool\n fs::is_empty(const path& p, error_code& ec) noexcept\n {\n   auto s = status(p, ec);\n-  if (ec.value())\n+  if (ec)\n     return false;\n-  return fs::is_directory(s)\n+  bool empty = fs::is_directory(s)\n     ? fs::directory_iterator(p, ec) == fs::directory_iterator()\n     : fs::file_size(p, ec) == 0;\n+  return ec ? false : empty;\n }\n \n fs::file_time_type"}]}