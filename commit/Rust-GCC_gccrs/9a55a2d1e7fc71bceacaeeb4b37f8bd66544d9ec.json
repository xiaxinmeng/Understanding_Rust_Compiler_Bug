{"sha": "9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWE1NWEyZDFlN2ZjNzFiY2VhY2FlZWI0YjM3ZjhiZDY2NTQ0ZDllYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2019-02-27T14:50:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2019-02-27T14:50:35Z"}, "message": "re PR target/70341 (cost model for addresses is incorrect, slsr is using reg + reg + CST for arm)\n\n\tPR target/70341\n\t* config/arm/arm.md (arm_casesi_internal): New define_expand.  Rename\n\told define_insn to ...\n\t(*arm_casesi_internal): ... this.  Add mode to LABEL_REFs.\n\t* config/arm/thumb2.md (thumb2_casesi_internal): New define_expand.\n\tRename old define_insn to ...\n\t(*thumb2_casesi_internal): ... this.  Add mode to LABEL_REFs.\n\t(thumb2_casesi_internal_pic): New define_expand.  Rename old\n\tdefine_insn to ...\n\t(*thumb2_casesi_internal_pic): ... this.  Add mode to LABEL_REFs.\n\nFrom-SVN: r269255", "tree": {"sha": "abb5c7e4caa6deaa38cb997f6093d7b570607969", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/abb5c7e4caa6deaa38cb997f6093d7b570607969"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a8a8944415f2c9abec196a3110a6f674524ffaa8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a8a8944415f2c9abec196a3110a6f674524ffaa8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a8a8944415f2c9abec196a3110a6f674524ffaa8"}], "stats": {"total": 97, "additions": 85, "deletions": 12}, "files": [{"sha": "2fd847ac1fee02c9b3146214f7a35402d8526c26", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "patch": "@@ -1,3 +1,16 @@\n+2019-02-27  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/70341\n+\t* config/arm/arm.md (arm_casesi_internal): New define_expand.  Rename\n+\told define_insn to ...\n+\t(*arm_casesi_internal): ... this.  Add mode to LABEL_REFs.\n+\t* config/arm/thumb2.md (thumb2_casesi_internal): New define_expand.\n+\tRename old define_insn to ...\n+\t(*thumb2_casesi_internal): ... this.  Add mode to LABEL_REFs.\n+\t(thumb2_casesi_internal_pic): New define_expand.  Rename old\n+\tdefine_insn to ...\n+\t(*thumb2_casesi_internal_pic): ... this.  Add mode to LABEL_REFs.\n+\n 2019-02-27  Richard Biener  <rguenther@suse.de>\n \n \tPR debug/88878"}, {"sha": "baf71a546bc431a24ebdadf8623496a8efbcb840", "filename": "gcc/config/arm/arm.md", "status": "modified", "additions": 23, "deletions": 4, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/gcc%2Fconfig%2Farm%2Farm.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/gcc%2Fconfig%2Farm%2Farm.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.md?ref=9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "patch": "@@ -8939,16 +8939,35 @@\n \n ;; The USE in this pattern is needed to tell flow analysis that this is\n ;; a CASESI insn.  It has no other purpose.\n-(define_insn \"arm_casesi_internal\"\n+(define_expand \"arm_casesi_internal\"\n+  [(parallel [(set (pc)\n+\t       (if_then_else\n+\t\t(leu (match_operand:SI 0 \"s_register_operand\")\n+\t\t     (match_operand:SI 1 \"arm_rhs_operand\"))\n+\t\t(match_dup 4)\n+\t\t(label_ref:SI (match_operand 3 \"\"))))\n+\t      (clobber (reg:CC CC_REGNUM))\n+\t      (use (label_ref:SI (match_operand 2 \"\")))])]\n+  \"TARGET_ARM\"\n+{\n+  operands[4] = gen_rtx_MULT (SImode, operands[0], GEN_INT (4));\n+  operands[4] = gen_rtx_PLUS (SImode, operands[4],\n+\t\t\t      gen_rtx_LABEL_REF (SImode, operands[2]));\n+  operands[4] = gen_rtx_MEM (SImode, operands[4]);\n+  MEM_READONLY_P (operands[4]) = 1;\n+  MEM_NOTRAP_P (operands[4]) = 1;\n+})\n+\n+(define_insn \"*arm_casesi_internal\"\n   [(parallel [(set (pc)\n \t       (if_then_else\n \t\t(leu (match_operand:SI 0 \"s_register_operand\" \"r\")\n \t\t     (match_operand:SI 1 \"arm_rhs_operand\" \"rI\"))\n \t\t(mem:SI (plus:SI (mult:SI (match_dup 0) (const_int 4))\n-\t\t\t\t (label_ref (match_operand 2 \"\" \"\"))))\n-\t\t(label_ref (match_operand 3 \"\" \"\"))))\n+\t\t\t\t (label_ref:SI (match_operand 2 \"\" \"\"))))\n+\t\t(label_ref:SI (match_operand 3 \"\" \"\"))))\n \t      (clobber (reg:CC CC_REGNUM))\n-\t      (use (label_ref (match_dup 2)))])]\n+\t      (use (label_ref:SI (match_dup 2)))])]\n   \"TARGET_ARM\"\n   \"*\n     if (flag_pic)"}, {"sha": "111692466d1bfe89eaf87450d8afbecb86029c47", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 49, "deletions": 8, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=9a55a2d1e7fc71bceacaeeb4b37f8bd66544d9ec", "patch": "@@ -1079,36 +1079,77 @@\n    (set_attr \"neg_pool_range\" \"*,250\")]\n )\n \n-(define_insn \"thumb2_casesi_internal\"\n+(define_expand \"thumb2_casesi_internal\"\n+  [(parallel [(set (pc)\n+\t       (if_then_else\n+\t\t(leu (match_operand:SI 0 \"s_register_operand\")\n+\t\t     (match_operand:SI 1 \"arm_rhs_operand\"))\n+\t\t(match_dup 4)\n+\t\t(label_ref:SI (match_operand 3 \"\"))))\n+\t      (clobber (reg:CC CC_REGNUM))\n+\t      (clobber (match_scratch:SI 5))\n+\t      (use (label_ref:SI (match_operand 2 \"\")))])]\n+  \"TARGET_THUMB2 && !flag_pic\"\n+{\n+  operands[4] = gen_rtx_MULT (SImode, operands[0], GEN_INT (4));\n+  operands[4] = gen_rtx_PLUS (SImode, operands[4],\n+\t\t\t      gen_rtx_LABEL_REF (SImode, operands[2]));\n+  operands[4] = gen_rtx_MEM (SImode, operands[4]);\n+  MEM_READONLY_P (operands[4]) = 1;\n+  MEM_NOTRAP_P (operands[4]) = 1;\n+})\n+\n+(define_insn \"*thumb2_casesi_internal\"\n   [(parallel [(set (pc)\n \t       (if_then_else\n \t\t(leu (match_operand:SI 0 \"s_register_operand\" \"r\")\n \t\t     (match_operand:SI 1 \"arm_rhs_operand\" \"rI\"))\n \t\t(mem:SI (plus:SI (mult:SI (match_dup 0) (const_int 4))\n-\t\t\t\t (label_ref (match_operand 2 \"\" \"\"))))\n-\t\t(label_ref (match_operand 3 \"\" \"\"))))\n+\t\t\t\t (label_ref:SI (match_operand 2 \"\" \"\"))))\n+\t\t(label_ref:SI (match_operand 3 \"\" \"\"))))\n \t      (clobber (reg:CC CC_REGNUM))\n \t      (clobber (match_scratch:SI 4 \"=&r\"))\n-\t      (use (label_ref (match_dup 2)))])]\n+\t      (use (label_ref:SI (match_dup 2)))])]\n   \"TARGET_THUMB2 && !flag_pic\"\n   \"* return thumb2_output_casesi(operands);\"\n   [(set_attr \"conds\" \"clob\")\n    (set_attr \"length\" \"16\")\n    (set_attr \"type\" \"multiple\")]\n )\n \n-(define_insn \"thumb2_casesi_internal_pic\"\n+(define_expand \"thumb2_casesi_internal_pic\"\n+  [(parallel [(set (pc)\n+\t       (if_then_else\n+\t\t(leu (match_operand:SI 0 \"s_register_operand\")\n+\t\t     (match_operand:SI 1 \"arm_rhs_operand\"))\n+\t\t(match_dup 4)\n+\t\t(label_ref:SI (match_operand 3 \"\"))))\n+\t      (clobber (reg:CC CC_REGNUM))\n+\t      (clobber (match_scratch:SI 5))\n+\t      (clobber (match_scratch:SI 6))\n+\t      (use (label_ref:SI (match_operand 2 \"\")))])]\n+  \"TARGET_THUMB2 && flag_pic\"\n+{\n+  operands[4] = gen_rtx_MULT (SImode, operands[0], GEN_INT (4));\n+  operands[4] = gen_rtx_PLUS (SImode, operands[4],\n+\t\t\t      gen_rtx_LABEL_REF (SImode, operands[2]));\n+  operands[4] = gen_rtx_MEM (SImode, operands[4]);\n+  MEM_READONLY_P (operands[4]) = 1;\n+  MEM_NOTRAP_P (operands[4]) = 1;\n+})\n+\n+(define_insn \"*thumb2_casesi_internal_pic\"\n   [(parallel [(set (pc)\n \t       (if_then_else\n \t\t(leu (match_operand:SI 0 \"s_register_operand\" \"r\")\n \t\t     (match_operand:SI 1 \"arm_rhs_operand\" \"rI\"))\n \t\t(mem:SI (plus:SI (mult:SI (match_dup 0) (const_int 4))\n-\t\t\t\t (label_ref (match_operand 2 \"\" \"\"))))\n-\t\t(label_ref (match_operand 3 \"\" \"\"))))\n+\t\t\t\t (label_ref:SI (match_operand 2 \"\" \"\"))))\n+\t\t(label_ref:SI (match_operand 3 \"\" \"\"))))\n \t      (clobber (reg:CC CC_REGNUM))\n \t      (clobber (match_scratch:SI 4 \"=&r\"))\n \t      (clobber (match_scratch:SI 5 \"=r\"))\n-\t      (use (label_ref (match_dup 2)))])]\n+\t      (use (label_ref:SI (match_dup 2)))])]\n   \"TARGET_THUMB2 && flag_pic\"\n   \"* return thumb2_output_casesi(operands);\"\n   [(set_attr \"conds\" \"clob\")"}]}