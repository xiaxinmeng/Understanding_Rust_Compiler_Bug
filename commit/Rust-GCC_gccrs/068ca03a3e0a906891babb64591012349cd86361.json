{"sha": "068ca03a3e0a906891babb64591012349cd86361", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDY4Y2EwM2EzZTBhOTA2ODkxYmFiYjY0NTkxMDEyMzQ5Y2Q4NjM2MQ==", "commit": {"author": {"name": "David Daney", "email": "ddaney@caviumnetworks.com", "date": "2009-08-06T05:27:40Z"}, "committer": {"name": "David Daney", "email": "daney@gcc.gnu.org", "date": "2009-08-06T05:27:40Z"}, "message": "mips.h (TARGET_SYNC_AFTER_SC): New macro.\n\n2009-08-04  David Daney  <ddaney@caviumnetworks.com>\n\n\t* config/mips/mips.h (TARGET_SYNC_AFTER_SC): New macro.\n\t* mips_output_sync_loop (mips_output_sync_loop): Only emit\n\ttrailing sync if TARGET_SYNC_AFTER_SC.\n\nFrom-SVN: r150513", "tree": {"sha": "2fd7a9b79799de01645c8f0847361d7e5f1cedb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2fd7a9b79799de01645c8f0847361d7e5f1cedb3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/068ca03a3e0a906891babb64591012349cd86361", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/068ca03a3e0a906891babb64591012349cd86361", "html_url": "https://github.com/Rust-GCC/gccrs/commit/068ca03a3e0a906891babb64591012349cd86361", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/068ca03a3e0a906891babb64591012349cd86361/comments", "author": null, "committer": null, "parents": [{"sha": "40a4a37bd7dab0686d2f36414eebc1b82764ddc5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40a4a37bd7dab0686d2f36414eebc1b82764ddc5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40a4a37bd7dab0686d2f36414eebc1b82764ddc5"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "db42dadd97f4e1209f9e7c753a2f49afaa289210", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/068ca03a3e0a906891babb64591012349cd86361/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/068ca03a3e0a906891babb64591012349cd86361/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=068ca03a3e0a906891babb64591012349cd86361", "patch": "@@ -1,3 +1,9 @@\n+2009-08-04  David Daney  <ddaney@caviumnetworks.com>\n+\n+\t* config/mips/mips.h (TARGET_SYNC_AFTER_SC): New macro.\n+\t* mips_output_sync_loop (mips_output_sync_loop): Only emit\n+\ttrailing sync if TARGET_SYNC_AFTER_SC.\n+\n 2009-08-05  David Daney  <ddaney@caviumnetworks.com>\n \n \t* gcc/config/mips/sync.md (sync_compare_and_swap<mode>,"}, {"sha": "1b9c6e72575efff7afaaa0df089c0515e108a3ec", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/068ca03a3e0a906891babb64591012349cd86361/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/068ca03a3e0a906891babb64591012349cd86361/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=068ca03a3e0a906891babb64591012349cd86361", "patch": "@@ -10764,9 +10764,17 @@ mips_output_sync_loop (bool barrier_before,\n     output_asm_insn (\"sync\", NULL);\n   /* Use branch-likely instructions to work around the LL/SC R10000 errata.  */\n   mips_branch_likely = TARGET_FIX_R10000;\n-  output_asm_insn (loop, operands);\n \n-  return \"sync\";\n+  /* If the target needs a sync after the loop, emit the loop now and\n+     return the sync.  */\n+\n+  if (TARGET_SYNC_AFTER_SC)\n+    {\n+      output_asm_insn (loop, operands);\n+      loop = \"sync\";\n+    }\n+ \n+  return loop;\n }\n \f\n /* Return the assembly code for DIV or DDIV instruction DIVISION, which has"}, {"sha": "89f905621258d7a6b60e9093059080b3c89c6d05", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/068ca03a3e0a906891babb64591012349cd86361/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/068ca03a3e0a906891babb64591012349cd86361/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=068ca03a3e0a906891babb64591012349cd86361", "patch": "@@ -337,7 +337,15 @@ enum mips_code_readable_setting {\n    in use.  */\n #define TARGET_HARD_FLOAT (TARGET_HARD_FLOAT_ABI && !TARGET_MIPS16)\n #define TARGET_SOFT_FLOAT (TARGET_SOFT_FLOAT_ABI || TARGET_MIPS16)\n-  \n+\n+/* False if SC acts as a memory barrier with respect to itself,\n+   otherwise a SYNC will be emitted after SC for atomic operations\n+   that require ordering between the SC and following loads and\n+   stores.  It does not tell anything about ordering of loads and\n+   stores prior to and following the SC, only about the SC itself and\n+   those loads and stores follow it.  */\n+#define TARGET_SYNC_AFTER_SC (!TARGET_OCTEON)\n+\n /* IRIX specific stuff.  */\n #define TARGET_IRIX\t   0\n #define TARGET_IRIX6\t   0"}]}