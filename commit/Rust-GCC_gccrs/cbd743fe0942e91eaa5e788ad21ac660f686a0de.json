{"sha": "cbd743fe0942e91eaa5e788ad21ac660f686a0de", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2JkNzQzZmUwOTQyZTkxZWFhNWU3ODhhZDIxYWM2NjBmNjg2YTBkZQ==", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2020-12-07T13:16:34Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-04-28T09:37:56Z"}, "message": "[Ada] Incorrect error with Default_Value on private/modular type\n\ngcc/ada/\n\n\t* exp_ch3.adb (Simple_Init_Defaulted_Type): Simplify the code,\n\tand always use OK_Convert_To, rather than Unchecked_Convert_To\n\tand Convert_To.", "tree": {"sha": "f2798f10f10afdd1baab9c8a36d210bc44f32f7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f2798f10f10afdd1baab9c8a36d210bc44f32f7e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cbd743fe0942e91eaa5e788ad21ac660f686a0de", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbd743fe0942e91eaa5e788ad21ac660f686a0de", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbd743fe0942e91eaa5e788ad21ac660f686a0de", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbd743fe0942e91eaa5e788ad21ac660f686a0de/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3cb4256addca89ff6d6c47ed3ea53499d5b97a52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3cb4256addca89ff6d6c47ed3ea53499d5b97a52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3cb4256addca89ff6d6c47ed3ea53499d5b97a52"}], "stats": {"total": 37, "additions": 15, "deletions": 22}, "files": [{"sha": "b916aef2972db4585a5a04ef3f3073765a5fae1e", "filename": "gcc/ada/exp_ch3.adb", "status": "modified", "additions": 15, "deletions": 22, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cbd743fe0942e91eaa5e788ad21ac660f686a0de/gcc%2Fada%2Fexp_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cbd743fe0942e91eaa5e788ad21ac660f686a0de/gcc%2Fada%2Fexp_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch3.adb?ref=cbd743fe0942e91eaa5e788ad21ac660f686a0de", "patch": "@@ -8597,35 +8597,28 @@ package body Exp_Ch3 is\n       --------------------------------\n \n       function Simple_Init_Defaulted_Type return Node_Id is\n-         Subtyp : constant Entity_Id := First_Subtype (Typ);\n+         Subtyp : Entity_Id := First_Subtype (Typ);\n \n       begin\n-         --  Use the Sloc of the context node when constructing the initial\n-         --  value because the expression of Default_Value may come from a\n-         --  different unit. Updating the Sloc will result in accurate error\n-         --  diagnostics.\n-\n          --  When the first subtype is private, retrieve the expression of the\n          --  Default_Value from the underlying type.\n \n          if Is_Private_Type (Subtyp) then\n-            return\n-              Unchecked_Convert_To\n-                (Typ  => Typ,\n-                 Expr =>\n-                   New_Copy_Tree\n-                     (Source   => Default_Aspect_Value (Full_View (Subtyp)),\n-                      New_Sloc => Loc));\n-\n-         else\n-            return\n-              Convert_To\n-                (Typ  => Typ,\n-                 Expr =>\n-                   New_Copy_Tree\n-                     (Source   => Default_Aspect_Value (Subtyp),\n-                      New_Sloc => Loc));\n+            Subtyp := Full_View (Subtyp);\n          end if;\n+\n+         --  Use the Sloc of the context node when constructing the initial\n+         --  value because the expression of Default_Value may come from a\n+         --  different unit. Updating the Sloc will result in accurate error\n+         --  diagnostics.\n+\n+         return\n+           OK_Convert_To\n+             (Typ  => Typ,\n+              Expr =>\n+                New_Copy_Tree\n+                  (Source   => Default_Aspect_Value (Subtyp),\n+                   New_Sloc => Loc));\n       end Simple_Init_Defaulted_Type;\n \n       -----------------------------------------"}]}