{"sha": "801f04e010b85f6f3132476215be3f13e672dd2e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODAxZjA0ZTAxMGI4NWY2ZjMxMzI0NzYyMTViZTNmMTNlNjcyZGQyZQ==", "commit": {"author": {"name": "Palmer Dabbelt", "email": "palmer@dabbelt.com", "date": "2017-03-20T16:43:21Z"}, "committer": {"name": "Palmer Dabbelt", "email": "palmer@gcc.gnu.org", "date": "2017-03-20T16:43:21Z"}, "message": "RISC-V: Don't prefer FP_REGS for integers\n\nOn RISC-V we can't store integers in floating-point registers as this is\nforbidden by the ISA.  We've always disallowed this, but we were\nsetting the preferred mode to FP_REGS for some integer modes.  This\ncaused the LRA to blow up with some hard to read error messages.\n\nThis patch removes the prefered mode hook, as the right thing to do here\nis nothing.\n\nThanks to Kito for finding the bug, and mpf for the fix.  See also\n<https://gcc.gnu.org/bugzilla/show_bug.cgi?id=79912>.\n\nPR target/79912\n\nFrom-SVN: r246283", "tree": {"sha": "0f9d9bb773cc73d305413ea658406c94de71f06b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f9d9bb773cc73d305413ea658406c94de71f06b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/801f04e010b85f6f3132476215be3f13e672dd2e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/801f04e010b85f6f3132476215be3f13e672dd2e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/801f04e010b85f6f3132476215be3f13e672dd2e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/801f04e010b85f6f3132476215be3f13e672dd2e/comments", "author": {"login": "palmer-dabbelt", "id": 1383006, "node_id": "MDQ6VXNlcjEzODMwMDY=", "avatar_url": "https://avatars.githubusercontent.com/u/1383006?v=4", "gravatar_id": "", "url": "https://api.github.com/users/palmer-dabbelt", "html_url": "https://github.com/palmer-dabbelt", "followers_url": "https://api.github.com/users/palmer-dabbelt/followers", "following_url": "https://api.github.com/users/palmer-dabbelt/following{/other_user}", "gists_url": "https://api.github.com/users/palmer-dabbelt/gists{/gist_id}", "starred_url": "https://api.github.com/users/palmer-dabbelt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/palmer-dabbelt/subscriptions", "organizations_url": "https://api.github.com/users/palmer-dabbelt/orgs", "repos_url": "https://api.github.com/users/palmer-dabbelt/repos", "events_url": "https://api.github.com/users/palmer-dabbelt/events{/privacy}", "received_events_url": "https://api.github.com/users/palmer-dabbelt/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e05a9f8e560a09d920555dec2960497dcb9e9ede", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e05a9f8e560a09d920555dec2960497dcb9e9ede", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e05a9f8e560a09d920555dec2960497dcb9e9ede"}], "stats": {"total": 19, "additions": 6, "deletions": 13}, "files": [{"sha": "7164d10df6bccb749aafb412b4c6d0bffb563880", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/801f04e010b85f6f3132476215be3f13e672dd2e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/801f04e010b85f6f3132476215be3f13e672dd2e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=801f04e010b85f6f3132476215be3f13e672dd2e", "patch": "@@ -1,3 +1,9 @@\n+2017-03-17  Palmer Dabbelt  <palmer@dabbelt.com>\n+\n+\tPR target/79912\n+\t* config/riscv/riscv.c (riscv_preferred_reload_class): Remove.\n+\t(TARGET_PREFERRED_RELOAD_CLASS): Likewise.\n+\n 2017-03-17  Palmer Dabbelt  <palmer@dabbelt.com>\n \n \t* config/riscv/riscv.c (riscv_print_operand): Use \"fence"}, {"sha": "d5928c334de9633a04d5d9057801401111d7289a", "filename": "gcc/config/riscv/riscv.c", "status": "modified", "additions": 0, "deletions": 13, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/801f04e010b85f6f3132476215be3f13e672dd2e/gcc%2Fconfig%2Friscv%2Friscv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/801f04e010b85f6f3132476215be3f13e672dd2e/gcc%2Fconfig%2Friscv%2Friscv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.c?ref=801f04e010b85f6f3132476215be3f13e672dd2e", "patch": "@@ -3629,16 +3629,6 @@ riscv_class_max_nregs (reg_class_t rclass, enum machine_mode mode)\n   return 0;\n }\n \n-/* Implement TARGET_PREFERRED_RELOAD_CLASS.  */\n-\n-static reg_class_t\n-riscv_preferred_reload_class (rtx x ATTRIBUTE_UNUSED, reg_class_t rclass)\n-{\n-  return reg_class_subset_p (FP_REGS, rclass) ? FP_REGS :\n-\t reg_class_subset_p (GR_REGS, rclass) ? GR_REGS :\n-\t rclass;\n-}\n-\n /* Implement TARGET_MEMORY_MOVE_COST.  */\n \n static int\n@@ -4031,9 +4021,6 @@ riscv_cannot_copy_insn_p (rtx_insn *insn)\n #undef TARGET_ADDRESS_COST\n #define TARGET_ADDRESS_COST riscv_address_cost\n \n-#undef  TARGET_PREFERRED_RELOAD_CLASS\n-#define TARGET_PREFERRED_RELOAD_CLASS riscv_preferred_reload_class\n-\n #undef TARGET_ASM_FILE_START\n #define TARGET_ASM_FILE_START riscv_file_start\n #undef TARGET_ASM_FILE_START_FILE_DIRECTIVE"}]}