{"sha": "a0c595386fa322e1874d33742fc56c6a0c13c4a5", "node_id": "C_kwDOANBUbNoAKGEwYzU5NTM4NmZhMzIyZTE4NzRkMzM3NDJmYzU2YzZhMGMxM2M0YTU", "commit": {"author": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-01-16T18:09:04Z"}, "committer": {"name": "Gaius Mulley", "email": "gaiusmod2@gmail.com", "date": "2023-01-16T18:09:04Z"}, "message": "Detect errors when dereferencing an undeclared variable.\n\nAttempting to dereference an undeclared variable will cause an ICE.\nAlso attempting to pass an undeclared variable as an array of type\nwill also cause an ICE.  This patch detects both conditions and\ngenerates an appropriate error.\n\ngcc/m2/ChangeLog:\n\n\t* gm2-compiler/M2Quads.mod (AssignUnboundedVar): Check Type\n\tagainst NulSym and call MetaErrorT1 if necessary.\n\t(AssignUnboundedNonVar): Check Type against NulSym and\n\tcall MetaErrorT1 if necessary.\n\t(BuildDesignatorPointer): Check Type1 against NulSym and\n\tcall MetaErrorT1 if necessary.\n\nSigned-off-by: Gaius Mulley <gaiusmod2@gmail.com>", "tree": {"sha": "09ec7c9ab44797b26648a2ab8c6e037130e253e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/09ec7c9ab44797b26648a2ab8c6e037130e253e7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a0c595386fa322e1874d33742fc56c6a0c13c4a5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0c595386fa322e1874d33742fc56c6a0c13c4a5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a0c595386fa322e1874d33742fc56c6a0c13c4a5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a0c595386fa322e1874d33742fc56c6a0c13c4a5/comments", "author": null, "committer": null, "parents": [{"sha": "b1f30bf42d8d47228e52de998f3172b2f5dd7265", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1f30bf42d8d47228e52de998f3172b2f5dd7265", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1f30bf42d8d47228e52de998f3172b2f5dd7265"}], "stats": {"total": 15, "additions": 12, "deletions": 3}, "files": [{"sha": "a58de93e4a84c31f0ad0ee07b96ef309155291f0", "filename": "gcc/m2/gm2-compiler/M2Quads.mod", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a0c595386fa322e1874d33742fc56c6a0c13c4a5/gcc%2Fm2%2Fgm2-compiler%2FM2Quads.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a0c595386fa322e1874d33742fc56c6a0c13c4a5/gcc%2Fm2%2Fgm2-compiler%2FM2Quads.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-compiler%2FM2Quads.mod?ref=a0c595386fa322e1874d33742fc56c6a0c13c4a5", "patch": "@@ -6327,7 +6327,10 @@ BEGIN\n    ELSIF IsVar(Sym)\n    THEN\n       Type := GetDType(Sym) ;\n-      IF IsUnbounded(Type)\n+      IF Type = NulSym\n+      THEN\n+         MetaErrorT1 (tok, '{%1ad} has no type and cannot be passed to a VAR formal parameter', Sym)\n+      ELSIF IsUnbounded(Type)\n       THEN\n          IF Type = GetSType (UnboundedSym)\n          THEN\n@@ -6382,7 +6385,10 @@ BEGIN\n    ELSIF IsVar (Sym)\n    THEN\n       Type := GetDType (Sym) ;\n-      IF IsUnbounded (Type)\n+      IF Type = NulSym\n+      THEN\n+         MetaErrorT1 (tok, '{%1ad} has no type and cannot be passed to a non VAR formal parameter', Sym)\n+      ELSIF IsUnbounded (Type)\n       THEN\n          UnboundedNonVarLinkToArray (tok, Sym, ArraySym, UnboundedSym, ParamType, dim)\n       ELSIF IsArray (Type) OR IsGenericSystemType (ParamType)\n@@ -11386,7 +11392,10 @@ VAR\n BEGIN\n    PopTFrwtok (Sym1, Type1, rw, exprtok) ;\n    Type1 := SkipType (Type1) ;\n-   IF IsUnknown (Sym1)\n+   IF Type1 = NulSym\n+   THEN\n+      MetaErrorT1 (ptrtok, '{%1ad} has no type and therefore cannot be dereferenced by ^', Sym1)\n+   ELSIF IsUnknown (Sym1)\n    THEN\n       MetaError1 ('{%1EMad} is undefined and therefore {%1ad}^ cannot be resolved', Sym1)\n    ELSIF IsPointer (Type1)"}]}