{"sha": "13926b249f974bcb0428e4379f0338da45bbcd70", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTM5MjZiMjQ5Zjk3NGJjYjA0MjhlNDM3OWYwMzM4ZGE0NWJiY2Q3MA==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2016-10-24T21:42:29Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2016-10-24T21:42:29Z"}, "message": "re PR libfortran/77828 (Linking gfortran-7 compiled program with libgfortran of 5.x allowed but crashes when containing write to string)\n\n2016-10-24  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR fortran/77828\n\t* io/io.h (st_parameter_dt): Reorder for readability and sanity.\n\t* io/transfer.c (data_transfer_init): Remove TODO and enable the\n\truntime error message, rec= specifier not allowed in STREAM\n\taccess.\n\t* libtool-version: Bump major version of libgfortran to 4.\n\n\t* ioparm.def: Reorder dt parameters to match libgfortran.\n\t* libgfortran.h: Swap definitions of GFC_INTERNAL_UNIT and\n\tGFC_INTERNAL_UNIT4.\n\nFrom-SVN: r241497", "tree": {"sha": "cf05fdc76f680d7d48536813516af7143972b359", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cf05fdc76f680d7d48536813516af7143972b359"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/13926b249f974bcb0428e4379f0338da45bbcd70", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13926b249f974bcb0428e4379f0338da45bbcd70", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13926b249f974bcb0428e4379f0338da45bbcd70", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13926b249f974bcb0428e4379f0338da45bbcd70/comments", "author": null, "committer": null, "parents": [{"sha": "c708217135607d42ff3926164f0472ef6aa66719", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c708217135607d42ff3926164f0472ef6aa66719", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c708217135607d42ff3926164f0472ef6aa66719"}], "stats": {"total": 73, "additions": 46, "deletions": 27}, "files": [{"sha": "0050bf8cdd1b18c538ba6a3ba5c848ba471402db", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -1,3 +1,10 @@\n+2016-10-24  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/77828\n+\t* ioparm.def: Reorder dt parameters to match libgfortran.\n+\t* libgfortran.h: Swap definitions of GFC_INTERNAL_UNIT and\n+\tGFC_INTERNAL_UNIT4.\n+\n 2016-10-24  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/71895"}, {"sha": "bd628ce26f5932ad40b609a729b257c864584c62", "filename": "gcc/fortran/ioparm.def", "status": "modified", "additions": 2, "deletions": 4, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ffortran%2Fioparm.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ffortran%2Fioparm.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fioparm.def?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -90,11 +90,9 @@ IOPARM (inquire, id,\t\t1 << 7,  pint4)\n IOPARM (inquire, iqstream,\t1 << 8,  char1)\n IOPARM (wait,    common,\t0,\t common)\n IOPARM (wait,    id,\t\t1 << 7,  pint4)\n-#ifndef IOPARM_dt_list_format\n+IOPARM (dt,      common,\t0,\t common)\n #define IOPARM_dt_list_format\t\t(1 << 7)\n #define IOPARM_dt_namelist_read_mode\t(1 << 8)\n-#endif\n-IOPARM (dt,      common,\t0,\t common)\n IOPARM (dt,      rec,\t\t1 << 9,  intio)\n IOPARM (dt,      size,\t\t1 << 10, pintio)\n IOPARM (dt,      iolength,\t1 << 11, pintio)\n@@ -103,7 +101,6 @@ IOPARM (dt,      format,\t1 << 12, char1)\n IOPARM (dt,      advance,\t1 << 13, char2)\n IOPARM (dt,      internal_unit,\t1 << 14, char1)\n IOPARM (dt,      namelist_name,\t1 << 15, char2)\n-IOPARM (dt,      u,\t\t0,\t pad)\n IOPARM (dt,      id,\t\t1 << 16, pint4)\n IOPARM (dt,      pos,\t\t1 << 17, intio)\n IOPARM (dt,      asynchronous, \t1 << 18, char1)\n@@ -115,3 +112,4 @@ IOPARM (dt,      round,\t\t1 << 23, char2)\n IOPARM (dt,      sign,\t\t1 << 24, char1)\n #define IOPARM_dt_f2003\t\t      (1 << 25)\n #define IOPARM_dt_dtio\t\t      (1 << 26)\n+IOPARM (dt,      u,\t\t0,\t pad)"}, {"sha": "8494ddc398e8fe1e034a4af3b82e2c1f4163430f", "filename": "gcc/fortran/libgfortran.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ffortran%2Flibgfortran.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ffortran%2Flibgfortran.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Flibgfortran.h?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -70,8 +70,8 @@ along with GCC; see the file COPYING3.  If not see\n \n /* Special unit numbers used to convey certain conditions.  Numbers -4\n    thru -9 available.  NEWUNIT values start at -10.  */\n-#define GFC_INTERNAL_UNIT4 -1    /* KIND=4 Internal Unit.  */\n-#define GFC_INTERNAL_UNIT  -2    /* KIND=1 Internal Unit.  */\n+#define GFC_INTERNAL_UNIT  -1    /* KIND=1 Internal Unit.  */\n+#define GFC_INTERNAL_UNIT4 -2    /* KIND=4 Internal Unit.  */\n #define GFC_INVALID_UNIT   -3\n \n /* Possible values for the CONVERT I/O specifier.  */"}, {"sha": "41fa0b98f9e95756ea37c2e736d92915c6e67737", "filename": "gcc/testsuite/gfortran.dg/streamio_17.f90", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ftestsuite%2Fgfortran.dg%2Fstreamio_17.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/gcc%2Ftestsuite%2Fgfortran.dg%2Fstreamio_17.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fstreamio_17.f90?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -0,0 +1,12 @@\n+! { dg-do run }\n+program stream_test\n+implicit none\n+integer :: ios\n+character(128) :: message\n+open(10, status='scratch', access='stream')\n+write (10, rec=1, iostat=ios, iomsg=message) \"This is a test\" !\n+if (ios.ne.5001) call abort\n+if (message.ne. &\n+  &\"Record number not allowed for stream access data transfer\") &\n+  call abort\n+end program"}, {"sha": "2e3056f2157562c912b1498cd30d855b5b664745", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -1,3 +1,12 @@\n+2016-10-24  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR fortran/77828\n+\t* io/io.h (st_parameter_dt): Reorder for readability and sanity.\n+\t* io/transfer.c (data_transfer_init): Remove TODO and enable the\n+\truntime error message, rec= specifier not allowed in STREAM\n+\taccess.\n+\t* libtool-version: Bump major version of libgfortran to 4.\n+\n 2016-10-21  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libfortran/78055"}, {"sha": "8c6caefec6eb910ddda3be519a6acd55765c38c2", "filename": "libgfortran/io/io.h", "status": "modified", "additions": 12, "deletions": 12, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2Fio%2Fio.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2Fio%2Fio.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fio.h?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -424,6 +424,15 @@ typedef struct st_parameter_dt\n   CHARACTER2 (advance);\n   CHARACTER1 (internal_unit);\n   CHARACTER2 (namelist_name);\n+  GFC_INTEGER_4 *id;\n+  GFC_IO_INT pos;\n+  CHARACTER1 (asynchronous);\n+  CHARACTER2 (blank);\n+  CHARACTER1 (decimal);\n+  CHARACTER2 (delim);\n+  CHARACTER1 (pad);\n+  CHARACTER2 (round);\n+  CHARACTER1 (sign);\n   /* Private part of the structure.  The compiler just needs\n      to reserve enough space.  */\n   union\n@@ -440,7 +449,8 @@ typedef struct st_parameter_dt\n \t  unit_blank blank_status;\n \t  unit_sign sign_status;\n \t  int scale_factor;\n-\t  int max_pos; /* Maximum righthand column written to.  */\n+\t  /* Maximum righthand column written to.  */\n+\t  int max_pos;\n \t  /* Number of skips + spaces to be done for T and X-editing.  */\n \t  int skips;\n \t  /* Number of spaces to be done for T and X-editing.  */\n@@ -494,8 +504,7 @@ typedef struct st_parameter_dt\n \t     are an unsigned char, EOF, or EOF - 1 used to mark the\n \t     field as not valid.  */\n \t  int last_char; /* No longer used, moved to gfc_unit.  */\n-\t  char nml_delim;\n-\n+\t  int nml_delim;\n \t  int repeat_count;\n \t  int saved_length;\n \t  int saved_used;\n@@ -523,15 +532,6 @@ typedef struct st_parameter_dt\n \t must be smaller or equal to this array.  */\n       char pad[16 * sizeof (char *) + 32 * sizeof (int)];\n     } u;\n-  GFC_INTEGER_4 *id;\n-  GFC_IO_INT pos;\n-  CHARACTER1 (asynchronous);\n-  CHARACTER2 (blank);\n-  CHARACTER1 (decimal);\n-  CHARACTER2 (delim);\n-  CHARACTER1 (pad);\n-  CHARACTER2 (round);\n-  CHARACTER1 (sign);\n }\n st_parameter_dt;\n "}, {"sha": "e3f75b67d4e5938c5a47c55ac88638a80626a30f", "filename": "libgfortran/io/transfer.c", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2Fio%2Ftransfer.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2Fio%2Ftransfer.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Ftransfer.c?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -3026,20 +3026,13 @@ data_transfer_init (st_parameter_dt *dtp, int read_flag)\n \t  return;\n \t}\n \n-      /* TODO: This is required to maintain compatibility between\n-         4.3 and 4.4 runtime. Remove when ABI changes from 4.3 */\n-\n-      if (is_stream_io (dtp))\n-        dtp->u.p.current_unit->strm_pos = dtp->rec;\n-\n-      /* TODO: Un-comment this code when ABI changes from 4.3.\n       if (dtp->u.p.current_unit->flags.access == ACCESS_STREAM)\n        {\n          generate_error (&dtp->common, LIBERROR_OPTION_CONFLICT,\n                      \"Record number not allowed for stream access \"\n                      \"data transfer\");\n          return;\n-       }  */\n+       }\n     }\n \n   /* Bugware for badly written mixed C-Fortran I/O.  */"}, {"sha": "712199096ebb2b221dec33dfd4beea45baccf6b2", "filename": "libgfortran/libtool-version", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2Flibtool-version", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/13926b249f974bcb0428e4379f0338da45bbcd70/libgfortran%2Flibtool-version", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Flibtool-version?ref=13926b249f974bcb0428e4379f0338da45bbcd70", "patch": "@@ -3,4 +3,4 @@\n # This is a separate file so that version updates don't involve re-running\n # automake.\n # CURRENT:REVISION:AGE\n-3:0:0\n+4:0:0"}]}