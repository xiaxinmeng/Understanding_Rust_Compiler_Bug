{"sha": "477ee35f51115282b8eb56c0077e197f282b765e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDc3ZWUzNWY1MTExNTI4MmI4ZWI1NmMwMDc3ZTE5N2YyODJiNzY1ZQ==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2015-10-26T11:51:47Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2015-10-26T11:51:47Z"}, "message": "[auto-inc-dec.c] Account for cost of move operation in FORM_PRE_ADD and FORM_POST_ADD cases\n\n\t* auto-inc-dec.c (insert_move_insn_before): Delete.\n\t(attempt_change): Remember to cost the simple move in the\n\tFORM_PRE_ADD and FORM_POST_ADD cases.\n\nFrom-SVN: r229344", "tree": {"sha": "e702335a62f4be984b0bf9854ee92d56ae1c5767", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e702335a62f4be984b0bf9854ee92d56ae1c5767"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/477ee35f51115282b8eb56c0077e197f282b765e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/477ee35f51115282b8eb56c0077e197f282b765e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/477ee35f51115282b8eb56c0077e197f282b765e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/477ee35f51115282b8eb56c0077e197f282b765e/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a2667f14a89bc5492f51ff0ee794ee75d8068f43", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2667f14a89bc5492f51ff0ee794ee75d8068f43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2667f14a89bc5492f51ff0ee794ee75d8068f43"}], "stats": {"total": 45, "additions": 23, "deletions": 22}, "files": [{"sha": "69d2ccbf6f0112dffc326999b2fb2362fd3e0098", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/477ee35f51115282b8eb56c0077e197f282b765e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/477ee35f51115282b8eb56c0077e197f282b765e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=477ee35f51115282b8eb56c0077e197f282b765e", "patch": "@@ -1,3 +1,9 @@\n+2015-10-26  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\t* auto-inc-dec.c (insert_move_insn_before): Delete.\n+\t(attempt_change): Remember to cost the simple move in the\n+\tFORM_PRE_ADD and FORM_POST_ADD cases.\n+\n 2015-10-26  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \tPR target/68091"}, {"sha": "9f7c8e0ef263bf9bda7eea9c0e8f0aebac77713d", "filename": "gcc/auto-inc-dec.c", "status": "modified", "additions": 17, "deletions": 22, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/477ee35f51115282b8eb56c0077e197f282b765e/gcc%2Fauto-inc-dec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/477ee35f51115282b8eb56c0077e197f282b765e/gcc%2Fauto-inc-dec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fauto-inc-dec.c?ref=477ee35f51115282b8eb56c0077e197f282b765e", "patch": "@@ -439,24 +439,6 @@ move_dead_notes (rtx_insn *to_insn, rtx_insn *from_insn, rtx pattern)\n     }\n }\n \n-\n-/* Create a mov insn DEST_REG <- SRC_REG and insert it before\n-   NEXT_INSN.  */\n-\n-static rtx_insn *\n-insert_move_insn_before (rtx_insn *next_insn, rtx dest_reg, rtx src_reg)\n-{\n-  rtx_insn *insns;\n-\n-  start_sequence ();\n-  emit_move_insn (dest_reg, src_reg);\n-  insns = get_insns ();\n-  end_sequence ();\n-  emit_insn_before (insns, next_insn);\n-  return insns;\n-}\n-\n-\n /* Change mem_insn.mem_loc so that uses NEW_ADDR which has an\n    increment of INC_REG.  To have reached this point, the change is a\n    legitimate one from a dataflow point of view.  The only questions\n@@ -490,8 +472,21 @@ attempt_change (rtx new_addr, rtx inc_reg)\n \n   old_cost = (set_src_cost (mem, mode, speed)\n \t      + set_rtx_cost (PATTERN (inc_insn.insn), speed));\n+\n   new_cost = set_src_cost (mem_tmp, mode, speed);\n \n+  /* In the FORM_PRE_ADD and FORM_POST_ADD cases we emit an extra move\n+     whose cost we should account for.  */\n+  if (inc_insn.form == FORM_PRE_ADD\n+      || inc_insn.form == FORM_POST_ADD)\n+    {\n+      start_sequence ();\n+      emit_move_insn (inc_insn.reg_res, inc_insn.reg0);\n+      mov_insn = get_insns ();\n+      end_sequence ();\n+      new_cost += seq_cost (mov_insn, speed);\n+    }\n+\n   /* The first item of business is to see if this is profitable.  */\n   if (old_cost < new_cost)\n     {\n@@ -522,8 +517,8 @@ attempt_change (rtx new_addr, rtx inc_reg)\n       /* Replace the addition with a move.  Do it at the location of\n \t the addition since the operand of the addition may change\n \t before the memory reference.  */\n-      mov_insn = insert_move_insn_before (inc_insn.insn,\n-\t\t\t\t\t  inc_insn.reg_res, inc_insn.reg0);\n+      gcc_assert (mov_insn);\n+      emit_insn_before (mov_insn, inc_insn.insn);\n       move_dead_notes (mov_insn, inc_insn.insn, inc_insn.reg0);\n \n       regno = REGNO (inc_insn.reg_res);\n@@ -548,8 +543,8 @@ attempt_change (rtx new_addr, rtx inc_reg)\n       break;\n \n     case FORM_POST_ADD:\n-      mov_insn = insert_move_insn_before (mem_insn.insn,\n-\t\t\t\t\t  inc_insn.reg_res, inc_insn.reg0);\n+      gcc_assert (mov_insn);\n+      emit_insn_before (mov_insn, mem_insn.insn);\n       move_dead_notes (mov_insn, inc_insn.insn, inc_insn.reg0);\n \n       /* Do not move anything to the mov insn because the instruction"}]}