{"sha": "2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041", "node_id": "C_kwDOANBUbNoAKDI0NzJkY2FhOGNiOWUwMmU5MDJmODNkNDE5YzNlZTdlMGYzZDkwNDE", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-03-07T10:14:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-03-07T10:14:04Z"}, "message": "s390: Fix up *cmp_and_trap_unsigned_int<mode> constraints [PR104775]\n\nThe following testcase fails to assemble due to clgte %r6,0(%r1,%r10)\ninsn not being accepted by assembler.\nMy rough understanding is that in the RSY-b insn format the spot\nin other formats used for index registers is used instead for M3 what\nkind of comparison it is, so this patch follows what other similar\ninstructions use for constraint (i.e. one without index register).\n\n2022-03-07  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/104775\n\t* config/s390/s390.md (*cmp_and_trap_unsigned_int<mode>): Use\n\tS constraint instead of T in the last alternative.\n\n\t* gcc.target/s390/pr104775.c: New test.", "tree": {"sha": "6700866dd34edacc67d6cc613b8fb98f943eca59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6700866dd34edacc67d6cc613b8fb98f943eca59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "93ecb25cc63f92d12821f8e5186bf165a4f54ab3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93ecb25cc63f92d12821f8e5186bf165a4f54ab3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93ecb25cc63f92d12821f8e5186bf165a4f54ab3"}], "stats": {"total": 16, "additions": 15, "deletions": 1}, "files": [{"sha": "d0f233e016b2b7e782152ed9f7a7ea0115b9f065", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041", "patch": "@@ -9578,7 +9578,7 @@\n (define_insn \"*cmp_and_trap_unsigned_int<mode>\"\n   [(trap_if (match_operator 0 \"s390_unsigned_integer_comparison\"\n \t       [(match_operand:GPR 1 \"register_operand\" \"d,d,d\")\n-\t\t(match_operand:GPR 2 \"general_operand\"  \"d,D,T\")])\n+\t\t(match_operand:GPR 2 \"general_operand\"  \"d,D,S\")])\n \t    (const_int 0))]\n   \"TARGET_Z10\"\n   \"@"}, {"sha": "fd4258bb36f74ee28b6feb1ec3185e14a3462a6f", "filename": "gcc/testsuite/gcc.target/s390/pr104775.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr104775.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr104775.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr104775.c?ref=2472dcaa8cb9e02e902f83d419c3ee7e0f3d9041", "patch": "@@ -0,0 +1,14 @@\n+/* PR target/104775 */\n+/* { dg-do assemble { target s390_zEC12_hw } } */\n+/* { dg-options \"-O2 -march=zEC12\" } */\n+\n+long a[64];\n+void bar (void);\n+\n+void\n+foo (int x, int y)\n+{\n+  if (x != a[y])\n+    bar ();\n+  __builtin_trap ();\n+}"}]}