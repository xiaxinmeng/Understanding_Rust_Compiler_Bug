{"sha": "0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGI0MWViZWY3MjYzMWVjOGNmNWZmZDE2NTM3ZDEyNzRjM2ZkNjgwMA==", "commit": {"author": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2011-11-22T09:57:19Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2011-11-22T09:57:19Z"}, "message": "sjlj.S (CONCAT1, [...]): Respond to __USER_LABEL_PREFIX__ for targets that use it.\n\n\nlibitm:\n\n\t* config/x86/sjlj.S (CONCAT1, CONCAT2, SYM): Respond to\n\t__USER_LABEL_PREFIX__ for targets that use it.\n\tTYPE, SIZE, HIDDEN): New macros to assist on non-elf targets.\n\t(_ITM_beginTransaction): Use SYM, TYPE, SIZE macros to assist\n\tin portability to non-elf targets.\n\t(GTM_longjmp): LIkewise.\n\t* libitm_i.h (begin_transaction): Apply __USER_LABEL_PREFIX__\n\twhere required.\n\nFrom-SVN: r181612", "tree": {"sha": "dbf525527b3ae9e4434c36c077376e4711f90020", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dbf525527b3ae9e4434c36c077376e4711f90020"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9c9d352aba3c5b3d921c2f73f0bbcda45f99b99c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c9d352aba3c5b3d921c2f73f0bbcda45f99b99c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c9d352aba3c5b3d921c2f73f0bbcda45f99b99c"}], "stats": {"total": 76, "additions": 57, "deletions": 19}, "files": [{"sha": "ae091d871810eb2f24e2df350e47b6b439059a8a", "filename": "libitm/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/libitm%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/libitm%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2FChangeLog?ref=0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "patch": "@@ -1,3 +1,14 @@\n+2011-11-22  Iain Sandoe  <iains@gcc.gnu.org>\n+\n+\t* config/x86/sjlj.S (CONCAT1, CONCAT2, SYM): Respond to\n+\t__USER_LABEL_PREFIX__ for targets that use it.\n+\tTYPE, SIZE, HIDDEN): New macros to assist on non-elf targets.\n+\t(_ITM_beginTransaction): Use SYM, TYPE, SIZE macros to assist\n+\tin portability to non-elf targets.\n+\t(GTM_longjmp): LIkewise.\n+\t* libitm_i.h (begin_transaction): Apply __USER_LABEL_PREFIX__\n+\twhere required.\n+\n 2011-11-22  Iain Sandoe  <iains@gcc.gnu.org>\n \n \t* testsuite/libitm.c/memcpy-1.c: Allow for MAP_ANON spelling."}, {"sha": "39e0c758d6d0aec08f47a44cc88cad2e86c5c40c", "filename": "libitm/config/x86/sjlj.S", "status": "modified", "additions": 39, "deletions": 18, "changes": 57, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/libitm%2Fconfig%2Fx86%2Fsjlj.S", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/libitm%2Fconfig%2Fx86%2Fsjlj.S", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Fconfig%2Fx86%2Fsjlj.S?ref=0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "patch": "@@ -25,12 +25,39 @@\n \n #include \"asmcfi.h\"\n \n+#define CONCAT1(a, b) CONCAT2(a, b)\n+#define CONCAT2(a, b) a ## b\n+\n+#ifdef __USER_LABEL_PREFIX__\n+#  define SYM(x) CONCAT1 (__USER_LABEL_PREFIX__, x)\n+#else\n+#  define SYM(x) x\n+#endif\n+\n+#ifdef __ELF__\n+#  define TYPE(x) .type SYM(x), @function\n+#  define SIZE(x) .size SYM(x), . - SYM(x)\n+#  ifdef HAVE_ATTRIBUTE_VISIBILITY\n+#    define HIDDEN(x) .hidden SYM(x)\n+#  else\n+#    define HIDDEN(x)\n+#  endif\n+#else\n+#  define TYPE(x)\n+#  define SIZE(x)\n+#  ifdef __MACH__\n+#    define HIDDEN(x) .private_extern SYM(x)\n+#  else\n+#    define HIDDEN(x)\n+#  endif\n+#endif\n+\n \t.text\n \n \t.align 4\n-\t.globl\t_ITM_beginTransaction\n+\t.globl\tSYM(_ITM_beginTransaction)\n \n-_ITM_beginTransaction:\n+SYM(_ITM_beginTransaction):\n \tcfi_startproc\n #ifdef __x86_64__\n \tleaq\t8(%rsp), %rax\n@@ -46,7 +73,7 @@ _ITM_beginTransaction:\n \tmovq\t%r14, 48(%rsp)\n \tmovq\t%r15, 56(%rsp)\n \tmovq\t%rsp, %rsi\n-\tcall\tGTM_begin_transaction\n+\tcall\tSYM(GTM_begin_transaction)\n \taddq\t$72, %rsp\n \tcfi_def_cfa_offset(8)\n \tret\n@@ -61,12 +88,12 @@ _ITM_beginTransaction:\n \tmovl\t%ebp, 24(%esp)\n \tleal\t8(%esp), %edx\n #if defined HAVE_ATTRIBUTE_VISIBILITY || !defined __PIC__\n-\tcall\tGTM_begin_transaction\n+\tcall\tSYM(GTM_begin_transaction)\n #elif defined __ELF__\n \tcall\t1f\n 1:\tpopl\t%ebx\n \taddl\t$_GLOBAL_OFFSET_TABLE_+[.-1b], %ebx\n-\tcall\tGTM_begin_transaction@PLT\n+\tcall\tSYM(GTM_begin_transaction)@PLT\n \tmovl\t12(%esp), %ebx\n #else\n # error \"Unsupported PIC sequence\"\n@@ -77,15 +104,13 @@ _ITM_beginTransaction:\n #endif\n \tcfi_endproc\n \n-#ifdef __ELF__\n-\t.type\t_ITM_beginTransaction, @function\n-\t.size\t_ITM_beginTransaction, .-_ITM_beginTransaction\n-#endif\n+\tTYPE(_ITM_beginTransaction)\n+\tSIZE(_ITM_beginTransaction)\n \n \t.align 4\n-\t.globl\tGTM_longjmp\n+\t.globl\tSYM(GTM_longjmp)\n \n-GTM_longjmp:\n+SYM(GTM_longjmp):\n \tcfi_startproc\n #ifdef __x86_64__\n \tmovq\t(%rdi), %rcx\n@@ -116,13 +141,9 @@ GTM_longjmp:\n #endif\n \tcfi_endproc\n \n-#ifdef __ELF__\n-\t.type\tGTM_longjmp, @function\n-#ifdef HAVE_ATTRIBUTE_VISIBILITY\n-\t.hidden\tGTM_longjmp\n-#endif\n-\t.size\tGTM_longjmp, .-GTM_longjmp\n-#endif\n+\tTYPE(GTM_longjmp)\n+\tHIDDEN(GTM_longjmp)\n+\tSIZE(GTM_longjmp)\n \n #ifdef __linux__\n .section .note.GNU-stack, \"\", @progbits"}, {"sha": "ba1afb4710c8ff073d834bcc419d22a854e410f8", "filename": "libitm/libitm_i.h", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/libitm%2Flibitm_i.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b41ebef72631ec8cf5ffd16537d1274c3fd6800/libitm%2Flibitm_i.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libitm%2Flibitm_i.h?ref=0b41ebef72631ec8cf5ffd16537d1274c3fd6800", "patch": "@@ -240,9 +240,15 @@ struct gtm_thread\n \n   // Invoked from assembly language, thus the \"asm\" specifier on\n   // the name, avoiding complex name mangling.\n+#ifdef __USER_LABEL_PREFIX__\n+#define UPFX1(t) UPFX(t)\n+#define UPFX(t) #t\n+  static uint32_t begin_transaction(uint32_t, const gtm_jmpbuf *)\n+\t__asm__(UPFX1(__USER_LABEL_PREFIX__) \"GTM_begin_transaction\") ITM_REGPARM;\n+#else\n   static uint32_t begin_transaction(uint32_t, const gtm_jmpbuf *)\n \t__asm__(\"GTM_begin_transaction\") ITM_REGPARM;\n-\n+#endif\n   // In eh_cpp.cc\n   void revert_cpp_exceptions (gtm_transaction_cp *cp = 0);\n "}]}