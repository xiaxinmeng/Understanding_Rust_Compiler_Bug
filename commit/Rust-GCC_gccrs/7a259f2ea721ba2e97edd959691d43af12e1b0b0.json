{"sha": "7a259f2ea721ba2e97edd959691d43af12e1b0b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2EyNTlmMmVhNzIxYmEyZTk3ZWRkOTU5NjkxZDQzYWYxMmUxYjBiMA==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2010-10-11T07:14:08Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2010-10-11T07:14:08Z"}, "message": "Makefile.rtl: Add s-multip.\n\n2010-10-11  Vincent Celier  <celier@adacore.com>\n\n\t* Makefile.rtl: Add s-multip.\n\t* adaint.c: New function __gnat_number_of_cpus, implemented for Linux,\n\tdefaulting to 1 for other platforms.\n\t* adaint.h: New function __gnat_number_of_cpus.\n\t* impunit.adb (Non_Imp_File_Names_12): New file list for Ada 2012,\n\twith a single component \"s-multip\".\n\t* impunit.ads (Kind_Of_Unit): New enumerated value Ada_12_Unit for Ada\n\t2012.\n\t* rtsfind.ads (RTU_Id): New enumerated value System_Multiprocessors\n\t* s-multip.ads, s-multip.adb: New Ada 2012 package.\n\t* sem_ch10.adb (Analyze_With_Clause): Check also Ada 2012 units.\n\nFrom-SVN: r165274", "tree": {"sha": "6ec3d69c3f4021f1aad41adf4ef0be271bd70e6e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ec3d69c3f4021f1aad41adf4ef0be271bd70e6e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7a259f2ea721ba2e97edd959691d43af12e1b0b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a259f2ea721ba2e97edd959691d43af12e1b0b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7a259f2ea721ba2e97edd959691d43af12e1b0b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7a259f2ea721ba2e97edd959691d43af12e1b0b0/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "065598527a987b859f68d014d0e0f5ebd99682e1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/065598527a987b859f68d014d0e0f5ebd99682e1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/065598527a987b859f68d014d0e0f5ebd99682e1"}], "stats": {"total": 158, "additions": 152, "deletions": 6}, "files": [{"sha": "862999534b77e63c574302feb5f9a90d8af9d8af", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -1,3 +1,17 @@\n+2010-10-11  Vincent Celier  <celier@adacore.com>\n+\n+\t* Makefile.rtl: Add s-multip.\n+\t* adaint.c: New function __gnat_number_of_cpus, implemented for Linux,\n+\tdefaulting to 1 for other platforms.\n+\t* adaint.h: New function __gnat_number_of_cpus.\n+\t* impunit.adb (Non_Imp_File_Names_12): New file list for Ada 2012,\n+\twith a single component \"s-multip\".\n+\t* impunit.ads (Kind_Of_Unit): New enumerated value Ada_12_Unit for Ada\n+\t2012.\n+\t* rtsfind.ads (RTU_Id): New enumerated value System_Multiprocessors\n+\t* s-multip.ads, s-multip.adb: New Ada 2012 package.\n+\t* sem_ch10.adb (Analyze_With_Clause): Check also Ada 2012 units.\n+\n 2010-10-11  Javier Miranda  <miranda@adacore.com>\n \n \t* a-textio.adb: Move new implementation of Get_Line to a subunit."}, {"sha": "856dd4964895d4f691b59d0bdde4bd8835368569", "filename": "gcc/ada/Makefile.rtl", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2FMakefile.rtl", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2FMakefile.rtl", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FMakefile.rtl?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -504,6 +504,7 @@ GNATRTL_NONTASKING_OBJS= \\\n   s-mastop$(objext) \\\n   s-memcop$(objext) \\\n   s-memory$(objext) \\\n+  s-multip$(objext) \\\n   s-os_lib$(objext) \\\n   s-osprim$(objext) \\\n   s-pack03$(objext) \\"}, {"sha": "a012ab639ab1c825497e6b841310c61072957141", "filename": "gcc/ada/adaint.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fadaint.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fadaint.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.c?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -2358,6 +2358,18 @@ __gnat_dup2 (int oldfd, int newfd)\n #endif\n }\n \n+int\n+__gnat_number_of_cpus (void)\n+{\n+  int cores = 1;\n+\n+#if defined (linux)\n+  cores = (int)sysconf(_SC_NPROCESSORS_ONLN);\n+#endif\n+\n+  return cores;\n+}\n+\n /* WIN32 code to implement a wait call that wait for any child process.  */\n \n #if defined (_WIN32) && !defined (RTX)"}, {"sha": "999c024eca8f59aefeb9061016db989a1a984598", "filename": "gcc/ada/adaint.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fadaint.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fadaint.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fadaint.h?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -235,6 +235,8 @@ extern int    __gnat_set_close_on_exec\t\t   (int, int);\n extern int    __gnat_dup\t\t\t   (int);\n extern int    __gnat_dup2\t\t\t   (int, int);\n \n+extern int    __gnat_number_of_cpus                (void);\n+\n extern void   __gnat_os_filename                   (char *, char *, char *,\n \t\t\t\t\t\t    int *, char *, int *);\n #if defined (linux)"}, {"sha": "6b427f0de1bf84d71fb21ffed22cceaecdc06520", "filename": "gcc/ada/impunit.adb", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fimpunit.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fimpunit.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fimpunit.adb?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -497,6 +497,15 @@ package body Impunit is\n      \"g-zspche\",    -- GNAT.Wide_Wide_Spelling_Checker\n      \"g-zstspl\");   -- GNAT.Wide_Wide_String_Split\n \n+   --------------------\n+   -- Ada 2012 Units --\n+   --------------------\n+\n+   --  The following units should be used only in Ada 05 mode\n+\n+   Non_Imp_File_Names_12 : constant File_List := (\n+     0 => \"s-multip\");   -- System.Mutiprocessors\n+\n    -----------------------\n    -- Alternative Units --\n    -----------------------\n@@ -596,14 +605,22 @@ package body Impunit is\n          end if;\n       end loop;\n \n-      --  See if name is in 05 list\n+      --  See if name is in 2005 list\n \n       for J in Non_Imp_File_Names_05'Range loop\n          if Name_Buffer (1 .. 8) = Non_Imp_File_Names_05 (J) then\n             return Ada_05_Unit;\n          end if;\n       end loop;\n \n+      --  See if name is in 2012 list\n+\n+      for J in Non_Imp_File_Names_12'Range loop\n+         if Name_Buffer (1 .. 8) = Non_Imp_File_Names_12 (J) then\n+            return Ada_12_Unit;\n+         end if;\n+      end loop;\n+\n       --  Only remaining special possibilities are children of System.RPC and\n       --  System.Garlic and special files of the form System.Aux...\n "}, {"sha": "5eb66e905b6060b3dd45fd30c8d8660ea093aa53", "filename": "gcc/ada/impunit.ads", "status": "modified", "additions": 10, "deletions": 5, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fimpunit.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fimpunit.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fimpunit.ads?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2000-2009, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2000-2010, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -48,10 +48,15 @@ package Impunit is\n       --  in both Ada 95 mode and Ada 05 mode. Note that in Ada 83 mode, no\n       --  child units are allowed, so you can't even name such a unit.\n \n-      Ada_05_Unit);\n-   --  This unit is defined in the Ada 05 RM. Withing this unit from a\n-   --  Ada 95 mode program will generate a warning (again, strictly speaking\n-   --  this should be an error, but that seems over-strenuous).\n+      Ada_05_Unit,\n+      --  This unit is defined in the Ada 2005 RM. Withing this unit from a\n+      --  Ada 95 mode program will generate a warning (again, strictly speaking\n+      --  this should be an error, but that seems over-strenuous).\n+\n+      Ada_12_Unit);\n+      --  This unit is defined in the Ada 2012 RM. Withing this unit from a Ada\n+      --  95 mode or Ada 2005 program will generate a warning (again, strictly\n+      --  speaking this should be an error, but that seems over-strenuous).\n \n    function Get_Kind_Of_Unit (U : Unit_Number_Type) return Kind_Of_Unit;\n    --  Given the unit number of a unit, this function determines the type"}, {"sha": "33621f5bfb8f580f1ed01c0a7b6f0e815efd00fc", "filename": "gcc/ada/rtsfind.ads", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Frtsfind.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Frtsfind.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.ads?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -265,6 +265,7 @@ package Rtsfind is\n       System_Machine_Code,\n       System_Mantissa,\n       System_Memcop,\n+      System_Multiprocessors,\n       System_Pack_03,\n       System_Pack_05,\n       System_Pack_06,"}, {"sha": "ce6c9dcfa773e9c7b855aa4f8e94247b59b0292d", "filename": "gcc/ada/s-multip.adb", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fs-multip.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fs-multip.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-multip.adb?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -0,0 +1,44 @@\n+------------------------------------------------------------------------------\n+--                                                                          --\n+--                         GNAT COMPILER COMPONENTS                         --\n+--                                                                          --\n+--               S Y S T E M . M U L T I P R O C E S S O R S                --\n+--                                                                          --\n+--                                  B o d y                                 --\n+--                                                                          --\n+--           Copyright (C) 2010, Free Software Foundation, Inc.             --\n+--                                                                          --\n+-- GNARL is free software; you can  redistribute it  and/or modify it under --\n+-- terms of the  GNU General Public License as published  by the Free Soft- --\n+-- ware  Foundation;  either version 3,  or (at your option) any later ver- --\n+-- sion.  GNAT is distributed in the hope that it will be useful, but WITH- --\n+-- OUT ANY WARRANTY;  without even the  implied warranty of MERCHANTABILITY --\n+-- or FITNESS FOR A PARTICULAR PURPOSE.                                     --\n+--                                                                          --\n+-- As a special exception under Section 7 of GPL version 3, you are granted --\n+-- additional permissions described in the GCC Runtime Library Exception,   --\n+-- version 3.1, as published by the Free Software Foundation.               --\n+--                                                                          --\n+-- You should have received a copy of the GNU General Public License and    --\n+-- a copy of the GCC Runtime Library Exception along with this program;     --\n+-- see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see    --\n+-- <http://www.gnu.org/licenses/>.                                          --\n+--                                                                          --\n+------------------------------------------------------------------------------\n+\n+with Interfaces.C; use Interfaces.C;\n+\n+package body System.Multiprocessors is\n+   function Gnat_Number_Of_CPUs return int;\n+   pragma Import (C, Gnat_Number_Of_CPUs, \"__gnat_number_of_cpus\");\n+\n+   --------------------\n+   -- Number_Of_CPUs --\n+   --------------------\n+\n+   function Number_Of_CPUs return CPU is\n+   begin\n+      return CPU (Gnat_Number_Of_CPUs);\n+   end Number_Of_CPUs;\n+\n+end System.Multiprocessors;"}, {"sha": "33cb01bc10b574a4491d087c6b4bda4c65e3a8b4", "filename": "gcc/ada/s-multip.ads", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fs-multip.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fs-multip.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-multip.ads?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -0,0 +1,44 @@\n+------------------------------------------------------------------------------\n+--                                                                          --\n+--                         GNAT COMPILER COMPONENTS                         --\n+--                                                                          --\n+--               S Y S T E M . M U L T I P R O C E S S O R S                --\n+--                                                                          --\n+--                                  S p e c                                 --\n+--                                                                          --\n+--           Copyright (C) 2010, Free Software Foundation, Inc.             --\n+--                                                                          --\n+-- GNARL is free software; you can  redistribute it  and/or modify it under --\n+-- terms of the  GNU General Public License as published  by the Free Soft- --\n+-- ware  Foundation;  either version 3,  or (at your option) any later ver- --\n+-- sion.  GNAT is distributed in the hope that it will be useful, but WITH- --\n+-- OUT ANY WARRANTY;  without even the  implied warranty of MERCHANTABILITY --\n+-- or FITNESS FOR A PARTICULAR PURPOSE.                                     --\n+--                                                                          --\n+-- As a special exception under Section 7 of GPL version 3, you are granted --\n+-- additional permissions described in the GCC Runtime Library Exception,   --\n+-- version 3.1, as published by the Free Software Foundation.               --\n+--                                                                          --\n+-- You should have received a copy of the GNU General Public License and    --\n+-- a copy of the GCC Runtime Library Exception along with this program;     --\n+-- see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see    --\n+-- <http://www.gnu.org/licenses/>.                                          --\n+--                                                                          --\n+------------------------------------------------------------------------------\n+\n+--  This unit may be used directly from an application program by providing\n+--  an appropriate WITH, and the interface can be expected to remain stable.\n+\n+package System.Multiprocessors is\n+   pragma Preelaborate (Multiprocessors);\n+\n+   type CPU_Range is range 0 .. 2 ** 16 - 1;\n+\n+   subtype CPU is CPU_Range range 1 .. CPU_Range'Last;\n+\n+   Not_A_Specific_CPU : constant CPU_Range := 0;\n+\n+   function Number_Of_CPUs return CPU;\n+   --  Number of available CPUs\n+\n+end System.Multiprocessors;"}, {"sha": "804bbf339f6c130d7f9831dad9a2ab4ba48722b1", "filename": "gcc/ada/sem_ch10.adb", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fsem_ch10.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7a259f2ea721ba2e97edd959691d43af12e1b0b0/gcc%2Fada%2Fsem_ch10.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch10.adb?ref=7a259f2ea721ba2e97edd959691d43af12e1b0b0", "patch": "@@ -2457,6 +2457,12 @@ package body Sem_Ch10 is\n                  and then Warn_On_Ada_2005_Compatibility\n                then\n                   Error_Msg_N (\"& is an Ada 2005 unit?\", Name (N));\n+\n+               elsif U_Kind = Ada_12_Unit\n+                 and then Ada_Version < Ada_12\n+                 and then Warn_On_Ada_2012_Compatibility\n+               then\n+                  Error_Msg_N (\"& is an Ada 2012 unit?\", Name (N));\n                end if;\n             end;\n          end if;"}]}