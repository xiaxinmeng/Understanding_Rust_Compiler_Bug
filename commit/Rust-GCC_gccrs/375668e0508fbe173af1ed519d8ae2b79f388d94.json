{"sha": "375668e0508fbe173af1ed519d8ae2b79f388d94", "node_id": "C_kwDOANBUbNoAKDM3NTY2OGUwNTA4ZmJlMTczYWYxZWQ1MTlkOGFlMmI3OWYzODhkOTQ", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-21T11:20:47Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-21T11:20:47Z"}, "message": "tree-optimization/106379 - add missing ~(a ^ b) folding for _Bool\n\nThe following makes sure to fold ~(a ^ b) to a == b for truth\nvalues (but not vectors, we'd have to check for vector support of\nequality).  That turns the PR106379 testcase into a ranger one.\n\nNote that while we arrive at ~(a ^ b) in a convoluted way from\noriginal !a == !b one can eventually write the expression this\nway directly as well.\n\n\tPR tree-optimization/106379\n\t* match.pd (~(a ^ b) -> a == b): New pattern.\n\n\t* gcc.dg/pr106379-1.c: New testcase.", "tree": {"sha": "f477d9a9880b00e974211c7beb58ff3fd1e73935", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f477d9a9880b00e974211c7beb58ff3fd1e73935"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/375668e0508fbe173af1ed519d8ae2b79f388d94", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/375668e0508fbe173af1ed519d8ae2b79f388d94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/375668e0508fbe173af1ed519d8ae2b79f388d94", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/375668e0508fbe173af1ed519d8ae2b79f388d94/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dc477ffb4aba21e9cf47de22a4df6f2b23849505", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc477ffb4aba21e9cf47de22a4df6f2b23849505", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc477ffb4aba21e9cf47de22a4df6f2b23849505"}], "stats": {"total": 15, "additions": 15, "deletions": 0}, "files": [{"sha": "88a1a5aa9cc7692bbd59eb5b7e1d05cd69ce51a2", "filename": "gcc/match.pd", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375668e0508fbe173af1ed519d8ae2b79f388d94/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375668e0508fbe173af1ed519d8ae2b79f388d94/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=375668e0508fbe173af1ed519d8ae2b79f388d94", "patch": "@@ -1938,6 +1938,12 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n  (if (tree_nop_conversion_p (type, TREE_TYPE (@0)))\n   (bit_not (bit_xor (view_convert @0) @1))))\n \n+/* ~(a ^ b) is a == b for truth valued a and b.  */\n+(simplify\n+ (bit_not (bit_xor:s truth_valued_p@0 truth_valued_p@1))\n+ (if (!VECTOR_TYPE_P (type))\n+  (convert (eq @0 @1))))\n+\n /* (x & ~m) | (y & m) -> ((x ^ y) & m) ^ x */\n (simplify\n  (bit_ior:c (bit_and:cs @0 (bit_not @2)) (bit_and:cs @1 @2))"}, {"sha": "7f2575e02dceaf844db2c47270bf49c006bd50f2", "filename": "gcc/testsuite/gcc.dg/pr106379-1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/375668e0508fbe173af1ed519d8ae2b79f388d94/gcc%2Ftestsuite%2Fgcc.dg%2Fpr106379-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/375668e0508fbe173af1ed519d8ae2b79f388d94/gcc%2Ftestsuite%2Fgcc.dg%2Fpr106379-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr106379-1.c?ref=375668e0508fbe173af1ed519d8ae2b79f388d94", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O -fdump-tree-forwprop1\" } */\n+\n+_Bool foo (_Bool a, _Bool b)\n+{\n+  return !a == !b;\n+}\n+\n+/* { dg-final { scan-tree-dump \"\\[ab\\]_\\[0-9\\]+\\\\(D\\\\) == \\[ba\\]_\\[0-9\\]+\\\\(D\\\\)\" \"forwprop1\" } } */"}]}