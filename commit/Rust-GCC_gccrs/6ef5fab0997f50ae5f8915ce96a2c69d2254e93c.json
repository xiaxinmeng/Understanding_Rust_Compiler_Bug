{"sha": "6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmVmNWZhYjA5OTdmNTBhZTVmODkxNWNlOTZhMmM2OWQyMjU0ZTkzYw==", "commit": {"author": {"name": "John David Anglin", "email": "dave.anglin@nrc-cnrc.gc.ca", "date": "2008-04-10T22:50:49Z"}, "committer": {"name": "John David Anglin", "email": "danglin@gcc.gnu.org", "date": "2008-04-10T22:50:49Z"}, "message": "re PR target/35768 (gcc.c-torture/compile/20010226-1.c:22: ICE: in do_output_reload, at reload1.c:7331)\n\n\tPR target/35768\n\t* pa.md: Define mode iterator P.  Define mode attribute dwc.\n\t(dcacheflush): Update pattern to use iterator P and attribute dwc.\n\t(icacheflush): Likewise.\n\t* pa.h (INITIALIZE_TRAMPOLINE): Use dcacheflushsi/icacheflushsi if\n\t!TARGET_64BIT, and dcacheflushdi/icacheflushdi if TARGET_64BIT.\n\nFrom-SVN: r134182", "tree": {"sha": "68e8ce128420058c828d76e41af33d0fa93c7a9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/68e8ce128420058c828d76e41af33d0fa93c7a9e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/comments", "author": null, "committer": null, "parents": [{"sha": "e47f8bba9ce987d62b82ec250940ac865b658649", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e47f8bba9ce987d62b82ec250940ac865b658649", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e47f8bba9ce987d62b82ec250940ac865b658649"}], "stats": {"total": 73, "additions": 39, "deletions": 34}, "files": [{"sha": "5fbf40d32cd8046e705875d6696f6c5c9a379a96", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "patch": "@@ -1,3 +1,12 @@\n+2008-04-10  John David Anglin  <dave.anglin@nrc-cnrc.gc.ca>\n+\n+\tPR target/35768\n+\t* pa.md: Define mode iterator P.  Define mode attribute dwc.\n+\t(dcacheflush): Update pattern to use iterator P and attribute dwc.\n+\t(icacheflush): Likewise.\n+\t* pa.h (INITIALIZE_TRAMPOLINE): Use dcacheflushsi/icacheflushsi if\n+\t!TARGET_64BIT, and dcacheflushdi/icacheflushdi if TARGET_64BIT.\n+\n 2008-04-11  Ben Elliston  <bje@au.ibm.com>\n \n \t* config/spu/spu.c (spu_init_builtins): Mark builtins as nothrow."}, {"sha": "bcbacb4c69cc7d4ce775ab16c10fa18c4acb0191", "filename": "gcc/config/pa/pa.h", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/gcc%2Fconfig%2Fpa%2Fpa.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/gcc%2Fconfig%2Fpa%2Fpa.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.h?ref=6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "patch": "@@ -1,6 +1,6 @@\n /* Definitions of target machine for GNU compiler, for the HP Spectrum.\n-   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,\n-   2001, 2002, 2003, 2004, 2005, 2006, 2007 Free Software Foundation, Inc.\n+   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,\n+   2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.\n    Contributed by Michael Tiemann (tiemann@cygnus.com) of Cygnus Support\n    and Tim Moore (moore@defmacro.cs.utah.edu) of the Center for\n    Software Science at the University of Utah.\n@@ -921,8 +921,8 @@ extern int may_call_alloca;\n       emit_insn (gen_andsi3 (end_addr, tmp,\t\t\t\t\\\n \t\t\t     GEN_INT (-MIN_CACHELINE_SIZE)));\t\t\\\n       emit_move_insn (line_length, GEN_INT (MIN_CACHELINE_SIZE));\t\\\n-      emit_insn (gen_dcacheflush (start_addr, end_addr, line_length));\t\\\n-      emit_insn (gen_icacheflush (start_addr, end_addr, line_length,\t\\\n+      emit_insn (gen_dcacheflushsi (start_addr, end_addr, line_length));\\\n+      emit_insn (gen_icacheflushsi (start_addr, end_addr, line_length,\t\\\n \t\t\t\t  gen_reg_rtx (Pmode),\t\t\t\\\n \t\t\t\t  gen_reg_rtx (Pmode)));\t\t\\\n     }\t\t\t\t\t\t\t\t\t\\\n@@ -953,8 +953,8 @@ extern int may_call_alloca;\n       emit_insn (gen_anddi3 (end_addr, tmp,\t\t\t\t\\\n \t\t\t     GEN_INT (-MIN_CACHELINE_SIZE)));\t\t\\\n       emit_move_insn (line_length, GEN_INT (MIN_CACHELINE_SIZE));\t\\\n-      emit_insn (gen_dcacheflush (start_addr, end_addr, line_length));\t\\\n-      emit_insn (gen_icacheflush (start_addr, end_addr, line_length,\t\\\n+      emit_insn (gen_dcacheflushdi (start_addr, end_addr, line_length));\\\n+      emit_insn (gen_icacheflushdi (start_addr, end_addr, line_length,\t\\\n \t\t\t\t  gen_reg_rtx (Pmode),\t\t\t\\\n \t\t\t\t  gen_reg_rtx (Pmode)));\t\t\\\n     }\t\t\t\t\t\t\t\t\t\\"}, {"sha": "ee6037a75b6e2fc555017e7a0d24d3b54a0d5046", "filename": "gcc/config/pa/pa.md", "status": "modified", "additions": 24, "deletions": 28, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/gcc%2Fconfig%2Fpa%2Fpa.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ef5fab0997f50ae5f8915ce96a2c69d2254e93c/gcc%2Fconfig%2Fpa%2Fpa.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fpa%2Fpa.md?ref=6ef5fab0997f50ae5f8915ce96a2c69d2254e93c", "patch": "@@ -1,6 +1,6 @@\n ;;- Machine description for HP PA-RISC architecture for GCC compiler\n ;;   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001,\n-;;   2002, 2003, 2004, 2005, 2006, 2007 Free Software Foundation, Inc.\n+;;   2002, 2003, 2004, 2005, 2006, 2007, 2008 Free Software Foundation, Inc.\n ;;   Contributed by the Center for Software Science at the University\n ;;   of Utah.\n \n@@ -64,6 +64,16 @@\n    (MAX_17BIT_OFFSET   262100)\t; 17-bit branch\n   ])\n \n+;; Mode and code iterators\n+\n+;; This mode iterator allows :P to be used for patterns that operate on\n+;; pointer-sized quantities.  Exactly one of the two alternatives will match.\n+(define_mode_iterator P [(SI \"Pmode == SImode\") (DI \"Pmode == DImode\")])\n+\n+;; This attribute defines the condition prefix for word and double word\n+;; add, compare, subtract and logical instructions.\n+(define_mode_attr dwc [(SI \"\") (DI \"*\")])\n+\n ;; Insn type.  Used to default other attribute values.\n \n ;; type \"unary\" insns have one input operand (1) and one output operand (0)\n@@ -9610,58 +9620,44 @@ add,l %2,%3,%3\\;bv,n %%r0(%3)\"\n   [(set_attr \"type\" \"fpalu\")\n    (set_attr \"length\" \"4\")])\n \n-;; Flush the I and D cache lines from the start address (operand0)\n-;; to the end address (operand1).  No lines are flushed if the end\n-;; address is less than the start address (unsigned).\n+;; The following two patterns are used by the trampoline code for nested\n+;; functions.  They flush the I and D cache lines from the start address\n+;; (operand0) to the end address (operand1).  No lines are flushed if the\n+;; end address is less than the start address (unsigned).\n ;;\n-;; Because the range of memory flushed is variable and the size of\n-;; a MEM can only be a CONST_INT, the patterns specify that they\n-;; perform an unspecified volatile operation on all memory.\n+;; Because the range of memory flushed is variable and the size of a MEM\n+;; can only be a CONST_INT, the patterns specify that they perform an\n+;; unspecified volatile operation on all memory.\n ;;\n ;; The address range for an icache flush must lie within a single\n ;; space on targets with non-equivalent space registers.\n ;;\n-;; This is used by the trampoline code for nested functions.\n-;;\n ;; Operand 0 contains the start address.\n ;; Operand 1 contains the end address.\n ;; Operand 2 contains the line length to use.\n-;; Operands 3 and 4 (icacheflush) are clobbered scratch registers.\n-(define_insn \"dcacheflush\"\n+(define_insn \"dcacheflush<P:mode>\"\n   [(const_int 1)\n    (unspec_volatile [(mem:BLK (scratch))] UNSPECV_DCACHE)\n    (use (match_operand 0 \"pmode_register_operand\" \"r\"))\n    (use (match_operand 1 \"pmode_register_operand\" \"r\"))\n    (use (match_operand 2 \"pmode_register_operand\" \"r\"))\n-   (clobber (match_scratch 3 \"=&0\"))]\n+   (clobber (match_scratch:P 3 \"=&0\"))]\n   \"\"\n-  \"*\n-{\n-  if (TARGET_64BIT)\n-    return \\\"cmpb,*<<=,n %3,%1,.\\;fdc,m %2(%3)\\;sync\\\";\n-  else\n-    return \\\"cmpb,<<=,n %3,%1,.\\;fdc,m %2(%3)\\;sync\\\";\n-}\"\n+  \"cmpb,<dwc><<=,n %3,%1,.\\;fdc,m %2(%3)\\;sync\"\n   [(set_attr \"type\" \"multi\")\n    (set_attr \"length\" \"12\")])\n \n-(define_insn \"icacheflush\"\n+(define_insn \"icacheflush<P:mode>\"\n   [(const_int 2)\n    (unspec_volatile [(mem:BLK (scratch))] UNSPECV_ICACHE)\n    (use (match_operand 0 \"pmode_register_operand\" \"r\"))\n    (use (match_operand 1 \"pmode_register_operand\" \"r\"))\n    (use (match_operand 2 \"pmode_register_operand\" \"r\"))\n    (clobber (match_operand 3 \"pmode_register_operand\" \"=&r\"))\n    (clobber (match_operand 4 \"pmode_register_operand\" \"=&r\"))\n-   (clobber (match_scratch 5 \"=&0\"))]\n+   (clobber (match_scratch:P 5 \"=&0\"))]\n   \"\"\n-  \"*\n-{\n-  if (TARGET_64BIT)\n-    return \\\"mfsp %%sr0,%4\\;ldsid (%5),%3\\;mtsp %3,%%sr0\\;cmpb,*<<=,n %5,%1,.\\;fic,m %2(%%sr0,%5)\\;sync\\;mtsp %4,%%sr0\\;nop\\;nop\\;nop\\;nop\\;nop\\;nop\\\";\n-  else\n-    return \\\"mfsp %%sr0,%4\\;ldsid (%5),%3\\;mtsp %3,%%sr0\\;cmpb,<<=,n %5,%1,.\\;fic,m %2(%%sr0,%5)\\;sync\\;mtsp %4,%%sr0\\;nop\\;nop\\;nop\\;nop\\;nop\\;nop\\\";\n-}\"\n+  \"mfsp %%sr0,%4\\;ldsid (%5),%3\\;mtsp %3,%%sr0\\;cmpb,<dwc><<=,n %5,%1,.\\;fic,m %2(%%sr0,%5)\\;sync\\;mtsp %4,%%sr0\\;nop\\;nop\\;nop\\;nop\\;nop\\;nop\"\n   [(set_attr \"type\" \"multi\")\n    (set_attr \"length\" \"52\")])\n "}]}