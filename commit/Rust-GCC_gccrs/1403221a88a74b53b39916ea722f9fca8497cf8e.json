{"sha": "1403221a88a74b53b39916ea722f9fca8497cf8e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQwMzIyMWE4OGE3NGI1M2IzOTkxNmVhNzIyZjlmY2E4NDk3Y2Y4ZQ==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2001-10-25T22:56:07Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2001-10-25T22:56:07Z"}, "message": "locale_facets.tcc (collate::do_transform): Fix.\n\n\n2001-10-25  Benjamin Kosnik  <bkoz@redhat.com>\n\n\t* include/bits/locale_facets.tcc (collate::do_transform): Fix.\n\nFrom-SVN: r46500", "tree": {"sha": "44238b2950ea4dece169c10229fe81ea38098eba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/44238b2950ea4dece169c10229fe81ea38098eba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1403221a88a74b53b39916ea722f9fca8497cf8e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1403221a88a74b53b39916ea722f9fca8497cf8e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1403221a88a74b53b39916ea722f9fca8497cf8e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1403221a88a74b53b39916ea722f9fca8497cf8e/comments", "author": null, "committer": null, "parents": [{"sha": "e6a7e62eb3f46044027a4b7f2217d5f87a3e8bf3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6a7e62eb3f46044027a4b7f2217d5f87a3e8bf3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6a7e62eb3f46044027a4b7f2217d5f87a3e8bf3"}], "stats": {"total": 25, "additions": 14, "deletions": 11}, "files": [{"sha": "b64f5705499f8d7ea79270a64d76670be590fe20", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1403221a88a74b53b39916ea722f9fca8497cf8e/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1403221a88a74b53b39916ea722f9fca8497cf8e/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=1403221a88a74b53b39916ea722f9fca8497cf8e", "patch": "@@ -1,3 +1,7 @@\n+2001-10-25  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\t* include/bits/locale_facets.tcc (collate::do_transform): Fix.\n+\n 2001-10-25  Phil Edwards  <pme@gcc.gnu.org>\n \n \t* docs/html/documentation.html:  Fix typo."}, {"sha": "e574db09ab2f3b966b3001a7ec6dfc121e69879c", "filename": "libstdc++-v3/include/bits/locale_facets.tcc", "status": "modified", "additions": 10, "deletions": 11, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1403221a88a74b53b39916ea722f9fca8497cf8e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1403221a88a74b53b39916ea722f9fca8497cf8e/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Flocale_facets.tcc?ref=1403221a88a74b53b39916ea722f9fca8497cf8e", "patch": "@@ -1879,19 +1879,18 @@ namespace std\n     collate<_CharT>::\n     do_transform(const _CharT* __lo, const _CharT* __hi) const\n     {\n-      string_type __orig(__lo, __hi);\n-      string_type __trans(__orig.size(), char_type());\n-      size_t __res = _M_transform_helper(__trans.begin().base(), \n-\t\t\t\t\t __orig.c_str(), __trans.size());\n-      while (__res >= __trans.size())\n+      size_t __len = __hi - __lo;\n+      _CharT* __c = static_cast<_CharT*>(__builtin_alloca(sizeof(_CharT) * __len));\n+      size_t __res = _M_transform_helper(__c, __lo, __len);\n+      if (__res >= __len)\n \t{\n-\t  // Increment size of translated string.\n-\t  typename string_type::size_type __newsize = __trans.size() * 2;\n-\t  __trans.resize(__newsize);\n-\t  __res = _M_transform_helper(__trans.begin().base(), __orig.c_str(), \n-\t\t\t\t      __trans.size());\n+\t  // Try to increment size of translated string.\n+\t  size_t __len2 = __len * 2;\n+\t  _CharT* __c2 = static_cast<_CharT*>(__builtin_alloca(sizeof(_CharT) * __len2));\n+\t  __res = _M_transform_helper(__c2, __lo, __len);\n+\t  // XXX Throw exception if still indeterminate?\n \t}\n-      return __trans;\n+      return string_type(__c);\n     }\n \n  template<typename _CharT>"}]}