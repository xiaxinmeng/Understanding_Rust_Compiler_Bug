{"sha": "8b91074ea7a39c710c32fbfe45a594b6a26e01f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGI5MTA3NGVhN2EzOWM3MTBjMzJmYmZlNDVhNTk0YjZhMjZlMDFmNg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@cygnus.com", "date": "1999-05-05T11:56:28Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "1999-05-05T11:56:28Z"}, "message": "libjava.exp (libjava_arguments): Don't use -nodefaultlibs.\n\n\t* lib/libjava.exp (libjava_arguments): Don't use -nodefaultlibs.\n\t(libjava_find_lib): Add `-L' option to find the actual library.\n\nFrom-SVN: r26782", "tree": {"sha": "230a577b93adac4399472557276ce79b3bc7bc65", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/230a577b93adac4399472557276ce79b3bc7bc65"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b91074ea7a39c710c32fbfe45a594b6a26e01f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b91074ea7a39c710c32fbfe45a594b6a26e01f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b91074ea7a39c710c32fbfe45a594b6a26e01f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b91074ea7a39c710c32fbfe45a594b6a26e01f6/comments", "author": null, "committer": null, "parents": [{"sha": "395e3bf94cb0c810ef09999ce433715e9bbb103d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/395e3bf94cb0c810ef09999ce433715e9bbb103d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/395e3bf94cb0c810ef09999ce433715e9bbb103d"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "4015384ba4792ab069e17c4ebb66c6b510c79e37", "filename": "libjava/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b91074ea7a39c710c32fbfe45a594b6a26e01f6/libjava%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b91074ea7a39c710c32fbfe45a594b6a26e01f6/libjava%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2FChangeLog?ref=8b91074ea7a39c710c32fbfe45a594b6a26e01f6", "patch": "@@ -1,5 +1,8 @@\n 1999-05-03  Tom Tromey  <tromey@cygnus.com>\n \n+\t* lib/libjava.exp (libjava_arguments): Don't use -nodefaultlibs.\n+\t(libjava_find_lib): Add `-L' option to find the actual library.\n+\n \t* libjava.mauve/mauve.exp (test_mauve): Pass `link' to\n \tlibjava_arguments when linking.\n \t(test_mauve_sim): Likewise."}, {"sha": "fad617503da0d28e3195321e03b87a639e125821", "filename": "libjava/testsuite/lib/libjava.exp", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b91074ea7a39c710c32fbfe45a594b6a26e01f6/libjava%2Ftestsuite%2Flib%2Flibjava.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b91074ea7a39c710c32fbfe45a594b6a26e01f6/libjava%2Ftestsuite%2Flib%2Flibjava.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2Flib%2Flibjava.exp?ref=8b91074ea7a39c710c32fbfe45a594b6a26e01f6", "patch": "@@ -80,18 +80,24 @@ proc libjava_init { args } {\n }\n \n # Find a library.  We know where libtool puts the actual libraries,\n-# and we look there.\n+# and we look there.  The implementation is fairly hacky.  We can't\n+# compile with -nodefaultlibs, because that will also eliminate the\n+# system libraries we need.  In order to have gcj still work, it must\n+# find the appropriate libraries so we must add -L options for their\n+# paths.  However we can't simply use those libraries; we still need\n+# libtool for linking.\n proc libjava_find_lib {dir name} {\n     global base_dir\n     set gp [get_multilibs]\n     foreach sub {.libs _libs} {\n \tif {$gp != \"\"} {\n \t    if {[file exists $gp/$dir/$sub/lib${name}.a]} then {\n-\t\treturn \"$gp/$dir/lib${name}.la\"\n+\t\treturn \"$gp/$dir/lib${name}.la -L$gp/$dir/$sub\"\n \t    }\n \t}\n \tset lib [findfile $base_dir/../../$dir/$sub/lib${name}.a \\\n-\t\t   \"$base_dir/../../$dir/lib${name}.la\" \"\"]\n+\t\t   \"$base_dir/../../$dir/lib${name}.la -L$base_dir/../../$dir/$sub\" \\\n+\t\t   \"\"]\n \tif {$lib != \"\"} {\n \t    return $lib\n \t}\n@@ -194,10 +200,6 @@ proc libjava_arguments {{mode compile}} {\n \t}\n     }\n \n-    if {$mode == \"link\"} {\n-\tlappend args \"additional_flags=-nodefaultlibs -lm -lgcc -lc -lgcc\"\n-    }\n-\n     return $args\n }\n "}]}