{"sha": "ac1359be3a39f4d12342c98c2a2e77bd59a839f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWMxMzU5YmUzYTM5ZjRkMTIzNDJjOThjMmEyZTc3YmQ1OWE4MzlmNA==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2018-07-31T14:21:17Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2018-07-31T14:21:17Z"}, "message": "[02/46] Remove dead vectorizable_reduction code\n\nvectorizable_reduction has old code to cope with cases in which the\ngiven statement belongs to a reduction group but isn't the first statement.\nThat can no longer happen, since all statements in the group go into the\nsame SLP node, and we only check the first statement in each node.\n\nThe point is to remove the only path through vectorizable_reduction\nin which stmt and stmt_info refer to different statements.\n\n2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/\n\t* tree-vect-loop.c (vectorizable_reduction): Assert that the\n\tfunction is not called for second and subsequent members of\n\ta reduction group.\n\nFrom-SVN: r263117", "tree": {"sha": "55bb816655bd609e6ffbfdfae2ac19e7502a0ec5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/55bb816655bd609e6ffbfdfae2ac19e7502a0ec5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ac1359be3a39f4d12342c98c2a2e77bd59a839f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac1359be3a39f4d12342c98c2a2e77bd59a839f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ac1359be3a39f4d12342c98c2a2e77bd59a839f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ac1359be3a39f4d12342c98c2a2e77bd59a839f4/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0847049dc7a630e4bfa079767ed42c742ff6276b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0847049dc7a630e4bfa079767ed42c742ff6276b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0847049dc7a630e4bfa079767ed42c742ff6276b"}], "stats": {"total": 21, "additions": 9, "deletions": 12}, "files": [{"sha": "39c280b42e7d59646768af6e619f26659060c3d2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac1359be3a39f4d12342c98c2a2e77bd59a839f4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac1359be3a39f4d12342c98c2a2e77bd59a839f4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ac1359be3a39f4d12342c98c2a2e77bd59a839f4", "patch": "@@ -1,3 +1,9 @@\n+2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* tree-vect-loop.c (vectorizable_reduction): Assert that the\n+\tfunction is not called for second and subsequent members of\n+\ta reduction group.\n+\n 2018-07-31  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* tree-vect-loop.c (get_initial_def_for_reduction): Move special"}, {"sha": "fb818c65202aad2654c9a2bf4bea7bb4c21c8d1b", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 3, "deletions": 12, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ac1359be3a39f4d12342c98c2a2e77bd59a839f4/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ac1359be3a39f4d12342c98c2a2e77bd59a839f4/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=ac1359be3a39f4d12342c98c2a2e77bd59a839f4", "patch": "@@ -6162,7 +6162,6 @@ vectorizable_reduction (gimple *stmt, gimple_stmt_iterator *gsi,\n   auto_vec<gimple *> phis;\n   int vec_num;\n   tree def0, tem;\n-  bool first_p = true;\n   tree cr_index_scalar_type = NULL_TREE, cr_index_vector_type = NULL_TREE;\n   tree cond_reduc_val = NULL_TREE;\n \n@@ -6178,15 +6177,8 @@ vectorizable_reduction (gimple *stmt, gimple_stmt_iterator *gsi,\n       nested_cycle = true;\n     }\n \n-  /* In case of reduction chain we switch to the first stmt in the chain, but\n-     we don't update STMT_INFO, since only the last stmt is marked as reduction\n-     and has reduction properties.  */\n-  if (REDUC_GROUP_FIRST_ELEMENT (stmt_info)\n-      && REDUC_GROUP_FIRST_ELEMENT (stmt_info) != stmt)\n-    {\n-      stmt = REDUC_GROUP_FIRST_ELEMENT (stmt_info);\n-      first_p = false;\n-    }\n+  if (REDUC_GROUP_FIRST_ELEMENT (stmt_info))\n+    gcc_assert (slp_node && REDUC_GROUP_FIRST_ELEMENT (stmt_info) == stmt);\n \n   if (gimple_code (stmt) == GIMPLE_PHI)\n     {\n@@ -7050,8 +7042,7 @@ vectorizable_reduction (gimple *stmt, gimple_stmt_iterator *gsi,\n \n   if (!vec_stmt) /* transformation not required.  */\n     {\n-      if (first_p)\n-\tvect_model_reduction_cost (stmt_info, reduc_fn, ncopies, cost_vec);\n+      vect_model_reduction_cost (stmt_info, reduc_fn, ncopies, cost_vec);\n       if (loop_vinfo && LOOP_VINFO_CAN_FULLY_MASK_P (loop_vinfo))\n \t{\n \t  if (reduction_type != FOLD_LEFT_REDUCTION"}]}