{"sha": "1210fd6e69e51516c935acc49e223fce14a0dd86", "node_id": "C_kwDOANBUbNoAKDEyMTBmZDZlNjllNTE1MTZjOTM1YWNjNDllMjIzZmNlMTRhMGRkODY", "commit": {"author": {"name": "Przemyslaw Wirkus", "email": "Przemyslaw.Wirkus@arm.com", "date": "2022-04-11T12:14:01Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2022-04-12T09:40:23Z"}, "message": "arm: remove unnecessary armv9-a multilib variant [PR104144]\n\nRemove the armv9-a specific multilib variants.  Instead, arrange to\nuse either the armv8-a multilibs or the armv7-a versions, depeding on\nthe configuration.  This eliminates the need to have a version of gas\nthat understands --march=armv9-a when building GCC.  Very little, if\nanything in the standard libraries directly uses Armv9-a features\nanyway.\n\nAlso remove the +crc variant rules for Armv9-a.  CRC is an implicit\npart of Armv9-a, so doesn't have a explicit feature to handle it.\n\ngcc/ChangeLog:\n\n\tPR target/104144\n\t* config/arm/t-aprofile (MULTI_ARCH_OPTS_A): Remove Armv9-a options.\n\t(MULTI_ARCH_DIRS_A): Remove Armv9-a diretories.\n\t(MULTILIB_REQUIRED): Don't require Armv9-a libraries.\n\t(MULTILIB_MATCHES): Treat Armv9-a as equivalent to Armv8-a.\n\t(MULTILIB_REUSE): Remove remap rules for Armv9-a.\n\t* config/arm/t-multilib (v9_a_nosimd_variants): Delete.\n\t(MULTILIB_MATCHES): Remove mappings for v9_a_nosimd_variants.\n\ngcc/testsuite/ChangeLog:\n\n\tPR target/104144\n\t* gcc.target/arm/multilib.exp: Updated tests.", "tree": {"sha": "6ea6a0aec5913c8aa8105b4369f63f725961f114", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ea6a0aec5913c8aa8105b4369f63f725961f114"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1210fd6e69e51516c935acc49e223fce14a0dd86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1210fd6e69e51516c935acc49e223fce14a0dd86", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1210fd6e69e51516c935acc49e223fce14a0dd86", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1210fd6e69e51516c935acc49e223fce14a0dd86/comments", "author": {"login": "PrzemekWirkus", "id": 6360720, "node_id": "MDQ6VXNlcjYzNjA3MjA=", "avatar_url": "https://avatars.githubusercontent.com/u/6360720?v=4", "gravatar_id": "", "url": "https://api.github.com/users/PrzemekWirkus", "html_url": "https://github.com/PrzemekWirkus", "followers_url": "https://api.github.com/users/PrzemekWirkus/followers", "following_url": "https://api.github.com/users/PrzemekWirkus/following{/other_user}", "gists_url": "https://api.github.com/users/PrzemekWirkus/gists{/gist_id}", "starred_url": "https://api.github.com/users/PrzemekWirkus/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/PrzemekWirkus/subscriptions", "organizations_url": "https://api.github.com/users/PrzemekWirkus/orgs", "repos_url": "https://api.github.com/users/PrzemekWirkus/repos", "events_url": "https://api.github.com/users/PrzemekWirkus/events{/privacy}", "received_events_url": "https://api.github.com/users/PrzemekWirkus/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1bd96873cf73c4f59de48e9bc0d17a498f1ede04", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1bd96873cf73c4f59de48e9bc0d17a498f1ede04", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1bd96873cf73c4f59de48e9bc0d17a498f1ede04"}], "stats": {"total": 53, "additions": 21, "deletions": 32}, "files": [{"sha": "fe2ec88d92de55813816deabd9da461c86c6c7e3", "filename": "gcc/config/arm/t-aprofile", "status": "modified", "additions": 8, "deletions": 17, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1210fd6e69e51516c935acc49e223fce14a0dd86/gcc%2Fconfig%2Farm%2Ft-aprofile", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1210fd6e69e51516c935acc49e223fce14a0dd86/gcc%2Fconfig%2Farm%2Ft-aprofile", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Ft-aprofile?ref=1210fd6e69e51516c935acc49e223fce14a0dd86", "patch": "@@ -26,8 +26,8 @@\n \n # Arch and FPU variants to build libraries with\n \n-MULTI_ARCH_OPTS_A       = march=armv7-a/march=armv7-a+fp/march=armv7-a+simd/march=armv7ve+simd/march=armv8-a/march=armv8-a+simd/march=armv9-a/march=armv9-a+simd\n-MULTI_ARCH_DIRS_A       = v7-a v7-a+fp v7-a+simd v7ve+simd v8-a v8-a+simd v9-a v9-a+simd\n+MULTI_ARCH_OPTS_A       = march=armv7-a/march=armv7-a+fp/march=armv7-a+simd/march=armv7ve+simd/march=armv8-a/march=armv8-a+simd\n+MULTI_ARCH_DIRS_A       = v7-a v7-a+fp v7-a+simd v7ve+simd v8-a v8-a+simd\n \n # ARMv7-A - build nofp, fp-d16 and SIMD variants\n \n@@ -46,11 +46,6 @@ MULTILIB_REQUIRED\t+= mthumb/march=armv8-a/mfloat-abi=soft\n MULTILIB_REQUIRED\t+= mthumb/march=armv8-a+simd/mfloat-abi=hard\n MULTILIB_REQUIRED\t+= mthumb/march=armv8-a+simd/mfloat-abi=softfp\n \n-# Armv9-A - build nofp and SIMD variants.\n-MULTILIB_REQUIRED\t+= mthumb/march=armv9-a/mfloat-abi=soft\n-MULTILIB_REQUIRED\t+= mthumb/march=armv9-a+simd/mfloat-abi=hard\n-MULTILIB_REQUIRED\t+= mthumb/march=armv9-a+simd/mfloat-abi=softfp\n-\n # Matches\n \n # Arch Matches\n@@ -135,28 +130,24 @@ MULTILIB_MATCHES\t+= $(foreach ARCH, $(v8_6_a_simd_variants), \\\n \t\t\t     march?armv8-a+simd=march?armv8.6-a$(ARCH))\n \n # Armv9 without SIMD: map down to base architecture\n-MULTILIB_MATCHES\t+= $(foreach ARCH, $(v9_a_nosimd_variants), \\\n-\t\t\t     march?armv9-a=march?armv9-a$(ARCH))\n+MULTILIB_MATCHES    += march?armv8-a=march?armv9-a\n+# No variants without SIMD.\n \n # Armv9 with SIMD: map down to base arch + simd\n-MULTILIB_MATCHES\t+= march?armv9-a+simd=march?armv9-a+crc+simd \\\n-\t\t\t   $(foreach ARCH, $(filter-out +simd, $(v9_a_simd_variants)), \\\n-\t\t\t     march?armv9-a+simd=march?armv9-a$(ARCH) \\\n-\t\t\t     march?armv9-a+simd=march?armv9-a+crc$(ARCH))\n+MULTILIB_MATCHES    += $(foreach ARCH, $(v9_a_simd_variants), \\\n+\t\t\t     march?armv8-a+simd=march?armv9-a$(ARCH))\n \n # Use Thumb libraries for everything.\n \n MULTILIB_REUSE\t\t+= mthumb/march.armv7-a/mfloat-abi.soft=marm/march.armv7-a/mfloat-abi.soft\n \n MULTILIB_REUSE\t\t+= mthumb/march.armv8-a/mfloat-abi.soft=marm/march.armv8-a/mfloat-abi.soft\n \n-MULTILIB_REUSE\t\t+= mthumb/march.armv9-a/mfloat-abi.soft=marm/march.armv9-a/mfloat-abi.soft\n-\n MULTILIB_REUSE\t\t+= $(foreach ABI, hard softfp, \\\n-\t\t\t     $(foreach ARCH, armv7-a+fp armv7-a+simd armv7ve+simd armv8-a+simd armv9-a+simd, \\\n+\t\t\t     $(foreach ARCH, armv7-a+fp armv7-a+simd armv7ve+simd armv8-a+simd, \\\n \t\t\t       mthumb/march.$(ARCH)/mfloat-abi.$(ABI)=marm/march.$(ARCH)/mfloat-abi.$(ABI)))\n \n # Softfp but no FP, use the soft-float libraries.\n MULTILIB_REUSE\t\t+= $(foreach MODE, arm thumb, \\\n-\t\t\t     $(foreach ARCH, armv7-a armv8-a armv9-a, \\\n+\t\t\t     $(foreach ARCH, armv7-a armv8-a, \\\n \t\t\t       mthumb/march.$(ARCH)/mfloat-abi.soft=m$(MODE)/march.$(ARCH)/mfloat-abi.softfp))"}, {"sha": "6bb58d39ea90f717218b7e4fa5671c65a764ffc7", "filename": "gcc/config/arm/t-multilib", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1210fd6e69e51516c935acc49e223fce14a0dd86/gcc%2Fconfig%2Farm%2Ft-multilib", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1210fd6e69e51516c935acc49e223fce14a0dd86/gcc%2Fconfig%2Farm%2Ft-multilib", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Ft-multilib?ref=1210fd6e69e51516c935acc49e223fce14a0dd86", "patch": "@@ -78,7 +78,6 @@ v8_4_a_simd_variants\t:= $(call all_feat_combs, simd fp16 crypto i8mm bf16)\n v8_5_a_simd_variants\t:= $(call all_feat_combs, simd fp16 crypto i8mm bf16)\n v8_6_a_simd_variants\t:= $(call all_feat_combs, simd fp16 crypto i8mm bf16)\n v8_r_nosimd_variants\t:= +crc\n-v9_a_nosimd_variants\t:= +crc\n v9_a_simd_variants\t:= $(call all_feat_combs, simd fp16 crypto i8mm bf16)\n \n ifneq (,$(HAS_APROFILE))\n@@ -206,14 +205,10 @@ MULTILIB_MATCHES\t+= $(foreach ARCH, $(v8_6_a_simd_variants), \\\n \n # Armv9\n MULTILIB_MATCHES\t+= march?armv7=march?armv9-a\n-MULTILIB_MATCHES\t+= $(foreach ARCH, $(v9_a_nosimd_variants), \\\n-\t\t\t     march?armv7=march?armv9-a$(ARCH))\n \n # Armv9 with SIMD\n-MULTILIB_MATCHES\t+= march?armv7+fp=march?armv9-a+crc+simd \\\n-\t\t\t   $(foreach ARCH, $(v9_a_simd_variants), \\\n-\t\t\t     march?armv7+fp=march?armv9-a$(ARCH) \\\n-\t\t\t     march?armv7+fp=march?armv9-a+crc$(ARCH))\n+MULTILIB_MATCHES\t+= $(foreach ARCH, $(v9_a_simd_variants), \\\n+\t\t\t     march?armv7+fp=march?armv9-a$(ARCH))\n endif\t\t# Not APROFILE.\n \n # Use Thumb libraries for everything."}, {"sha": "2fa648c61dafebb663969198bf7849400a7547f6", "filename": "gcc/testsuite/gcc.target/arm/multilib.exp", "status": "modified", "additions": 11, "deletions": 8, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1210fd6e69e51516c935acc49e223fce14a0dd86/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1210fd6e69e51516c935acc49e223fce14a0dd86/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fmultilib.exp?ref=1210fd6e69e51516c935acc49e223fce14a0dd86", "patch": "@@ -135,14 +135,17 @@ if {[multilib_config \"aprofile\"] } {\n \t{-march=armv8.6-a+simd+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n \t{-march=armv8.6-a+simd+fp16+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n \t{-march=armv8.6-a+simd+nofp+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n-\t{-march=armv9-a+crypto -mfloat-abi=soft} \"thumb/v9-a/nofp\"\n-\t{-march=armv9-a+simd+crypto -mfloat-abi=softfp} \"thumb/v9-a+simd/softfp\"\n-\t{-march=armv9-a+simd+crypto+nofp -mfloat-abi=softfp} \"thumb/v9-a/nofp\"\n-\t{-march=armv9-a+simd+nofp+crypto -mfloat-abi=softfp} \"thumb/v9-a+simd/softfp\"\n-\t{-march=armv9-a+fp16 -mfloat-abi=soft} \"thumb/v9-a/nofp\"\n-\t{-march=armv9-a+simd+fp16 -mfloat-abi=softfp} \"thumb/v9-a+simd/softfp\"\n-\t{-march=armv9-a+simd+fp16+nofp -mfloat-abi=softfp} \"thumb/v9-a/nofp\"\n-\t{-march=armv9-a+simd+nofp+fp16 -mfloat-abi=softfp} \"thumb/v9-a+simd/softfp\"\n+\t{-march=armv9-a+crypto -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv9-a+simd+crypto -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv9-a+simd+crypto+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv9-a+simd+nofp+crypto -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv9-a+fp16 -mfloat-abi=soft} \"thumb/v8-a/nofp\"\n+\t{-march=armv9-a+simd+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv9-a+simd+fp16+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n+\t{-march=armv9-a+simd+nofp+fp16 -mfloat-abi=softfp} \"thumb/v8-a+simd/softfp\"\n+\t{-march=armv9-a+simd -mfpu=auto -mfloat-abi=hard} \"thumb/v8-a+simd/hard\"\n+\t{-march=armv9-a+simd -mfpu=auto -mfloat-abi=hard -marm} \"thumb/v8-a+simd/hard\"\n+\t{-march=armv9-a+simd -mfpu=auto -mfloat-abi=hard -mthumb} \"thumb/v8-a+simd/hard\"\n \t{-mcpu=cortex-a53+crypto -mfloat-abi=hard} \"thumb/v8-a+simd/hard\"\n \t{-mcpu=cortex-a53+nofp -mfloat-abi=softfp} \"thumb/v8-a/nofp\"\n \t{-march=armv8-a+crc -mfloat-abi=hard -mfpu=vfp} \"thumb/v8-a+simd/hard\""}]}