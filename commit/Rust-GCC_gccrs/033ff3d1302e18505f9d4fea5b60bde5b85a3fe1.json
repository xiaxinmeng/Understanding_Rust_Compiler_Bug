{"sha": "033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDMzZmYzZDEzMDJlMTg1MDVmOWQ0ZmVhNWI2MGJkZTViODVhM2ZlMQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2016-02-02T12:48:31Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2016-02-02T12:48:31Z"}, "message": "libgomp: Use HSA_RUNTIME_LIB, HSA_KMT_LIB in the testsuite\n\n\tlibgomp/\n\t* plugin/configfrag.ac (HSA_KMT_LIB, HSA_KMT_LDFLAGS): New\n\tvariables.\n\t* testsuite/libgomp-test-support.exp.in (hsa_runtime_lib)\n\t(hsa_kmt_lib): Set variables.\n\t* testsuite/lib/libgomp.exp (libgomp_init): Use them to amend\n\talways_ld_library_path.\n\t* Makefile.in: Regenerate.\n\t* configure: Likewise.\n\t* testsuite/Makefile.in: Likewise.\n\nFrom-SVN: r233072", "tree": {"sha": "483c8497b17f73fbdff760e7930a19a10466166f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/483c8497b17f73fbdff760e7930a19a10466166f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4a88d9b77a7619c0d6ea3b8692c95a7847b61de3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a88d9b77a7619c0d6ea3b8692c95a7847b61de3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a88d9b77a7619c0d6ea3b8692c95a7847b61de3"}], "stats": {"total": 51, "additions": 42, "deletions": 9}, "files": [{"sha": "806e23d642874734663c3cee3f692505081dbe53", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -1,5 +1,15 @@\n 2016-02-02  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\t* plugin/configfrag.ac (HSA_KMT_LIB, HSA_KMT_LDFLAGS): New\n+\tvariables.\n+\t* testsuite/libgomp-test-support.exp.in (hsa_runtime_lib)\n+\t(hsa_kmt_lib): Set variables.\n+\t* testsuite/lib/libgomp.exp (libgomp_init): Use them to amend\n+\talways_ld_library_path.\n+\t* Makefile.in: Regenerate.\n+\t* configure: Likewise.\n+\t* testsuite/Makefile.in: Likewise.\n+\n \t* plugin/configfrag.ac (offload_additional_options)\n \t(offload_additional_lib_paths): Don't amend for hsa offloading.\n \t* configure: Regenerate."}, {"sha": "88c8517fddd6697cf99d1f271dde6047d41b6f3f", "filename": "libgomp/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FMakefile.in?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -268,6 +268,7 @@ FC = @FC@\n FCFLAGS = @FCFLAGS@\n FGREP = @FGREP@\n GREP = @GREP@\n+HSA_KMT_LIB = @HSA_KMT_LIB@\n HSA_RUNTIME_INCLUDE = @HSA_RUNTIME_INCLUDE@\n HSA_RUNTIME_LIB = @HSA_RUNTIME_LIB@\n INSTALL = @INSTALL@"}, {"sha": "8d03eb6cddce92e57e0b755a6cdce8a599ade488", "filename": "libgomp/configure", "status": "modified", "additions": 11, "deletions": 5, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fconfigure?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -637,6 +637,7 @@ PLUGIN_HSA_LIBS\n PLUGIN_HSA_LDFLAGS\n PLUGIN_HSA_CPPFLAGS\n PLUGIN_HSA\n+HSA_KMT_LIB\n HSA_RUNTIME_LIB\n HSA_RUNTIME_INCLUDE\n PLUGIN_NVPTX_LIBS\n@@ -11144,7 +11145,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11147 \"configure\"\n+#line 11148 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11250,7 +11251,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11253 \"configure\"\n+#line 11254 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -15292,15 +15293,20 @@ if test \"x$HSA_RUNTIME_LIB\" != x; then\n   HSA_RUNTIME_LDFLAGS=-L$HSA_RUNTIME_LIB\n fi\n \n+HSA_KMT_LIB=\n+\n+HSA_KMT_LDFLAGS=\n \n # Check whether --with-hsa-kmt-lib was given.\n if test \"${with_hsa_kmt_lib+set}\" = set; then :\n   withval=$with_hsa_kmt_lib;\n fi\n \n if test \"x$with_hsa_kmt_lib\" != x; then\n-  HSA_RUNTIME_LDFLAGS=\"$HSA_RUNTIME_LDFLAGS -L$with_hsa_kmt_lib\"\n-  HSA_RUNTIME_LIB=\n+  HSA_KMT_LIB=$with_hsa_kmt_lib\n+fi\n+if test \"x$HSA_KMT_LIB\" != x; then\n+  HSA_KMT_LDFLAGS=-L$HSA_KMT_LIB\n fi\n \n PLUGIN_HSA=0\n@@ -15378,7 +15384,7 @@ rm -f core conftest.err conftest.$ac_objext \\\n \t        tgt_name=hsa\n \t        PLUGIN_HSA=$tgt\n \t        PLUGIN_HSA_CPPFLAGS=$HSA_RUNTIME_CPPFLAGS\n-\t        PLUGIN_HSA_LDFLAGS=$HSA_RUNTIME_LDFLAGS\n+\t        PLUGIN_HSA_LDFLAGS=\"$HSA_RUNTIME_LDFLAGS $HSA_KMT_LDFLAGS\"\n \t        PLUGIN_HSA_LIBS=\"-lhsa-runtime64 -lhsakmt\"\n \n \t        PLUGIN_HSA_save_CPPFLAGS=$CPPFLAGS"}, {"sha": "88b4156188ebfaae5928945d3151aef0aa84fb45", "filename": "libgomp/plugin/configfrag.ac", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Fplugin%2Fconfigfrag.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Fplugin%2Fconfigfrag.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fplugin%2Fconfigfrag.ac?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -118,12 +118,17 @@ if test \"x$HSA_RUNTIME_LIB\" != x; then\n   HSA_RUNTIME_LDFLAGS=-L$HSA_RUNTIME_LIB\n fi\n \n+HSA_KMT_LIB=\n+AC_SUBST(HSA_KMT_LIB)\n+HSA_KMT_LDFLAGS=\n AC_ARG_WITH(hsa-kmt-lib,\n \t[AS_HELP_STRING([--with-hsa-kmt-lib=PATH],\n \t\t[specify directory for installed HSA KMT library.])])\n if test \"x$with_hsa_kmt_lib\" != x; then\n-  HSA_RUNTIME_LDFLAGS=\"$HSA_RUNTIME_LDFLAGS -L$with_hsa_kmt_lib\"\n-  HSA_RUNTIME_LIB=\n+  HSA_KMT_LIB=$with_hsa_kmt_lib\n+fi\n+if test \"x$HSA_KMT_LIB\" != x; then\n+  HSA_KMT_LDFLAGS=-L$HSA_KMT_LIB\n fi\n \n PLUGIN_HSA=0\n@@ -190,7 +195,7 @@ if test x\"$enable_offload_targets\" != x; then\n \t        tgt_name=hsa\n \t        PLUGIN_HSA=$tgt\n \t        PLUGIN_HSA_CPPFLAGS=$HSA_RUNTIME_CPPFLAGS\n-\t        PLUGIN_HSA_LDFLAGS=$HSA_RUNTIME_LDFLAGS\n+\t        PLUGIN_HSA_LDFLAGS=\"$HSA_RUNTIME_LDFLAGS $HSA_KMT_LDFLAGS\"\n \t        PLUGIN_HSA_LIBS=\"-lhsa-runtime64 -lhsakmt\"\n \n \t        PLUGIN_HSA_save_CPPFLAGS=$CPPFLAGS"}, {"sha": "4dbb406545078e0cb6b5ac2c6e3973b3f7150cb1", "filename": "libgomp/testsuite/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2FMakefile.in?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -111,6 +111,7 @@ FC = @FC@\n FCFLAGS = @FCFLAGS@\n FGREP = @FGREP@\n GREP = @GREP@\n+HSA_KMT_LIB = @HSA_KMT_LIB@\n HSA_RUNTIME_INCLUDE = @HSA_RUNTIME_INCLUDE@\n HSA_RUNTIME_LIB = @HSA_RUNTIME_LIB@\n INSTALL = @INSTALL@"}, {"sha": "bb9b15f3a41ca59c318af81d119e89c07546bd01", "filename": "libgomp/testsuite/lib/libgomp.exp", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Ftestsuite%2Flib%2Flibgomp.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Ftestsuite%2Flib%2Flibgomp.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flib%2Flibgomp.exp?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -184,7 +184,7 @@ proc libgomp_init { args } {\n     }\n     lappend ALWAYS_CFLAGS \"additional_flags=-I${srcdir}/..\"\n \n-    # For build-tree testing, also consider the CUDA paths used for builing.\n+    # For build-tree testing, also consider the library paths used for builing.\n     # For installed testing, we assume all that to be provided in the sysroot.\n     if { $blddir != \"\" } {\n \tglobal cuda_driver_include\n@@ -200,6 +200,14 @@ proc libgomp_init { args } {\n \t    lappend ALWAYS_CFLAGS \"additional_flags=-L$cuda_driver_lib\"\n \t    append always_ld_library_path \":$cuda_driver_lib\"\n \t}\n+\tglobal hsa_runtime_lib\n+\tglobal hsa_kmt_lib\n+\tif { $hsa_runtime_lib != \"\" } {\n+\t    append always_ld_library_path \":$hsa_runtime_lib\"\n+\t}\n+\tif { $hsa_kmt_lib != \"\" } {\n+\t    append always_ld_library_path \":$hsa_kmt_lib\"\n+\t}\n     }\n \n     # We use atomic operations in the testcases to validate results."}, {"sha": "5a724fb007a4676d6486205fb099d2b6173e1885", "filename": "libgomp/testsuite/libgomp-test-support.exp.in", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Ftestsuite%2Flibgomp-test-support.exp.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/033ff3d1302e18505f9d4fea5b60bde5b85a3fe1/libgomp%2Ftestsuite%2Flibgomp-test-support.exp.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp-test-support.exp.in?ref=033ff3d1302e18505f9d4fea5b60bde5b85a3fe1", "patch": "@@ -1,4 +1,6 @@\n set cuda_driver_include \"@CUDA_DRIVER_INCLUDE@\"\n set cuda_driver_lib \"@CUDA_DRIVER_LIB@\"\n+set hsa_runtime_lib \"@HSA_RUNTIME_LIB@\"\n+set hsa_kmt_lib \"@HSA_KMT_LIB@\"\n \n set offload_targets \"@offload_targets@\""}]}