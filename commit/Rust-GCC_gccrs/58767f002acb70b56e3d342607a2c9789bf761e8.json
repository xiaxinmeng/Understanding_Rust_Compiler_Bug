{"sha": "58767f002acb70b56e3d342607a2c9789bf761e8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTg3NjdmMDAyYWNiNzBiNTZlM2QzNDI2MDdhMmM5Nzg5YmY3NjFlOA==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-11-26T02:04:11Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-11-26T02:04:11Z"}, "message": "re PR c++/6764 (Throwing exception causes crash with '-O2 -fomit-frame-pointer')\n\n        PR c++/6764\n        * reload1.c (set_initial_eh_label_offset): New.\n        (set_initial_label_offsets): Use it.\n\nFrom-SVN: r91318", "tree": {"sha": "3fa952152c9b5c12679f9886dabc9757ef4bd77b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3fa952152c9b5c12679f9886dabc9757ef4bd77b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58767f002acb70b56e3d342607a2c9789bf761e8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58767f002acb70b56e3d342607a2c9789bf761e8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58767f002acb70b56e3d342607a2c9789bf761e8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58767f002acb70b56e3d342607a2c9789bf761e8/comments", "author": null, "committer": null, "parents": [{"sha": "c9ffaa8d79d65e1386541e508c8c281c9b63428e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9ffaa8d79d65e1386541e508c8c281c9b63428e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9ffaa8d79d65e1386541e508c8c281c9b63428e"}], "stats": {"total": 50, "additions": 50, "deletions": 0}, "files": [{"sha": "c4f82e3584b3dcb9eed921a55f0bdd4ea9b1a3ac", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58767f002acb70b56e3d342607a2c9789bf761e8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58767f002acb70b56e3d342607a2c9789bf761e8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=58767f002acb70b56e3d342607a2c9789bf761e8", "patch": "@@ -1,3 +1,9 @@\n+2004-11-25  Ricahrd Henderson  <rth@redhat.com>\n+\n+\tPR c++/6764\n+        * reload1.c (set_initial_eh_label_offset): New.\n+        (set_initial_label_offsets): Use it.\n+\n 2004-11-25  Kaz Kojima  <kkojima@gcc.gnu.org>\n \n \t* config/sh/sh.c (sh_output_mi_thunk): Initialize bitmap obstacks"}, {"sha": "c90c8b61eea36796092f255eaa5aceac641f8f2f", "filename": "gcc/reload1.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58767f002acb70b56e3d342607a2c9789bf761e8/gcc%2Freload1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58767f002acb70b56e3d342607a2c9789bf761e8/gcc%2Freload1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Freload1.c?ref=58767f002acb70b56e3d342607a2c9789bf761e8", "patch": "@@ -3316,6 +3316,14 @@ set_initial_elim_offsets (void)\n   num_not_at_initial_offset = 0;\n }\n \n+/* Subroutine of set_initial_label_offsets called via for_each_eh_label.  */\n+\n+static void\n+set_initial_eh_label_offset (rtx label)\n+{\n+  set_label_offsets (label, NULL_RTX, 1);\n+}\n+\n /* Initialize the known label offsets.\n    Set a known offset for each forced label to be at the initial offset\n    of each elimination.  We do this because we assume that all\n@@ -3332,6 +3340,8 @@ set_initial_label_offsets (void)\n   for (x = forced_labels; x; x = XEXP (x, 1))\n     if (XEXP (x, 0))\n       set_label_offsets (XEXP (x, 0), NULL_RTX, 1);\n+\n+  for_each_eh_label (set_initial_eh_label_offset);\n }\n \n /* Set all elimination offsets to the known values for the code label given"}, {"sha": "7cb49f00cee71719550d0cfae2633a426bf6b05f", "filename": "gcc/testsuite/g++.dg/opt/eh2.C", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58767f002acb70b56e3d342607a2c9789bf761e8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Feh2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58767f002acb70b56e3d342607a2c9789bf761e8/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Feh2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Feh2.C?ref=58767f002acb70b56e3d342607a2c9789bf761e8", "patch": "@@ -0,0 +1,34 @@\n+// PR 6764\n+// { dg-do run }\n+// { dg-options \"-O -fomit-frame-pointer\" }\n+\n+extern \"C\" void abort ();\n+\n+class test\n+{\n+ public:\n+  test * const me;\n+  test () : me(this) { }\n+  ~test () { if (me != this) abort (); }\n+};\n+\n+void x1 ()\n+{\n+  test w1;\n+  throw 1;\n+}\n+\n+void x2 ()\n+{\n+  test w2;\n+  x1 ();\n+}\n+\n+int main (void)\n+{\n+  try {\n+    x2 ();\n+  } catch (...) {\n+  }\n+  return 0;\n+}"}]}