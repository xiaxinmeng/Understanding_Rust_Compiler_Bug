{"sha": "9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWMxMzI2YWE1ZjgwMzFjYjM3ZmM2ZWZiOWExZTM3M2FhNTBmZmQ0OA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-05-14T15:53:58Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2018-05-14T15:53:58Z"}, "message": "re PR target/85756 (wrong code at -Os on x86-64-linux-gnu in 32-bit mode)\n\n\tPR target/85756\n\t* config/i386/i386.md: Disallow non-commutative arithmetics in\n\tlast twpeephole for mem {+,-,&,|,^}= x; mem != 0 after cmpelim\n\toptimization.  Use COMMUTATIVE_ARITH_P test rather than != MINUS\n\tin the peephole2 before it.\n\ntestsuite/ChangeLog:\n\n\t* gcc.c-torture/execute/pr85756.c: New test.\n\nFrom-SVN: r260231", "tree": {"sha": "e01d8b22bf6a56b33c93e5ee0f9722121e54ff3d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e01d8b22bf6a56b33c93e5ee0f9722121e54ff3d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cd2f262b2fa4292a39b97ab590b46e79d349817c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cd2f262b2fa4292a39b97ab590b46e79d349817c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cd2f262b2fa4292a39b97ab590b46e79d349817c"}], "stats": {"total": 68, "additions": 65, "deletions": 3}, "files": [{"sha": "879fdbb87e8985f4c03b51bfa18d6664fc95bffc", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "patch": "@@ -1,3 +1,11 @@\n+2018-05-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/85756\n+\t* config/i386/i386.md: Disallow non-commutative arithmetics in\n+\tlast twpeephole for mem {+,-,&,|,^}= x; mem != 0 after cmpelim\n+\toptimization.  Use COMMUTATIVE_ARITH_P test rather than != MINUS\n+\tin the peephole2 before it.\n+\n 2018-05-14  Sebastian Peryt  <sebastian.peryt@intel.com>\n \n \t* common/config/i386/i386-common.c (OPTION_MASK_ISA_CLDEMOTE_SET,"}, {"sha": "9c54131bf3abd8dcacd5c19b1fd6e0d91afa3bcc", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "patch": "@@ -19370,7 +19370,7 @@\n    (set (match_dup 1) (match_dup 0))\n    (set (reg FLAGS_REG) (compare (match_dup 0) (const_int 0)))]\n   \"(TARGET_READ_MODIFY_WRITE || optimize_insn_for_size_p ())\n-   && GET_CODE (operands[2]) != MINUS\n+   && COMMUTATIVE_ARITH_P (operands[2])\n    && peep2_reg_dead_p (3, operands[0])\n    && !reg_overlap_mentioned_p (operands[0], operands[1])\n    && ix86_match_ccmode (peep2_next_insn (2),\n@@ -19400,11 +19400,11 @@\n \t      (set (match_dup 0) (match_dup 2))])\n    (set (match_dup 1) (match_dup 0))]\n   \"(TARGET_READ_MODIFY_WRITE || optimize_insn_for_size_p ())\n+   && COMMUTATIVE_ARITH_P (operands[2])\n    && peep2_reg_dead_p (2, operands[0])\n    && !reg_overlap_mentioned_p (operands[0], operands[1])\n    && ix86_match_ccmode (peep2_next_insn (0),\n-\t\t\t (GET_CODE (operands[2]) == PLUS\n-\t\t\t  || GET_CODE (operands[2]) == MINUS)\n+\t\t\t GET_CODE (operands[2]) == PLUS\n \t\t\t ? CCGOCmode : CCNOmode)\"\n   [(parallel [(set (match_dup 3) (match_dup 5))\n \t      (set (match_dup 1) (match_dup 4))])]"}, {"sha": "6aae7355f04483f7eb9354ef2464f9bc1fcc3179", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "patch": "@@ -1,3 +1,7 @@\n+2018-05-14  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.c-torture/execute/pr85756.c: New test.\n+\n 2018-05-14  Sebastian Peryt  <sebastian.peryt@intel.com>\n \n \t* gcc.target/i386/cldemote-1.c: New test."}, {"sha": "8c959660143019fa194155cf28cb531a0241c0a1", "filename": "gcc/testsuite/gcc.c-torture/execute/pr85756.c", "status": "added", "additions": 50, "deletions": 0, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr85756.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr85756.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2Fpr85756.c?ref=9c1326aa5f8031cb37fc6efb9a1e373aa50ffd48", "patch": "@@ -0,0 +1,50 @@\n+/* PR target/85756 */\n+\n+#if __CHAR_BIT__ == 8 && __SIZEOF_SHORT__ == 2 && __SIZEOF_INT__ == 4\n+int a, c, *e, f, h = 10;\n+short b;\n+unsigned int p;\n+\n+__attribute__((noipa)) void\n+bar (int a)\n+{\n+  asm volatile (\"\" : : \"r\" (a) : \"memory\");\n+}\n+\n+void\n+foo ()\n+{\n+  unsigned j = 1, m = 430523;\n+  int k, n = 1, *l = &h;\n+lab:\n+  p = m;\n+  m = -((~65535U | j) - n);\n+  f = b << ~(n - 8);\n+  n = (m || b) ^ f;\n+  j = p;\n+  if (p < m)\n+    *l = k < 3;\n+  if (!n)\n+    l = &k;\n+  if (c)\n+    {\n+      bar (a);\n+      goto lab;\n+    }\n+  if (!*l)\n+    *e = 1;\n+}\n+\n+int\n+main ()\n+{\n+  foo ();\n+  return 0;\n+}\n+#else\n+int\n+main ()\n+{\n+  return 0;\n+}\n+#endif"}]}