{"sha": "9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWU2NGRkNmIzZjY3MDZkZTU3MWM2ZWQzYzRiN2E4YzhiNjdmMjJiNw==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2021-03-05T20:49:34Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2021-03-05T20:54:00Z"}, "message": "c++: Duplicate namespace bindings [PR 99245]\n\nHeader units can declare the same entity, and this can lead to one of\nthem containing a (non-using) binding to an import.  If one gets the\ncluster ordering just right, an assert will trigger.  Relax that assert.\n\n\tPR c++/99245\n\tgcc/cp/\n\t* module.cc (module_state::write_cluster): Relax binding assert.\n\tgcc/testsuite/\n\t* g++.dg/modules/pr99245_a.H: New.\n\t* g++.dg/modules/pr99245_b.H: New.", "tree": {"sha": "b79057eb3e58ba87d4acfcb499b08a20ff59903b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b79057eb3e58ba87d4acfcb499b08a20ff59903b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b1bee29167df6b0fbc9a4c8d06e2acbf3367af47", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b1bee29167df6b0fbc9a4c8d06e2acbf3367af47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b1bee29167df6b0fbc9a4c8d06e2acbf3367af47"}], "stats": {"total": 47, "additions": 33, "deletions": 14}, "files": [{"sha": "48862dd9bbc86fede29cd7d3f237074fe732eae6", "filename": "gcc/cp/module.cc", "status": "modified", "additions": 19, "deletions": 14, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/gcc%2Fcp%2Fmodule.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/gcc%2Fcp%2Fmodule.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fmodule.cc?ref=9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "patch": "@@ -14496,20 +14496,25 @@ module_state::write_cluster (elf_out *to, depset *scc[], unsigned size,\n \t  gcc_unreachable ();\n \n \tcase depset::EK_BINDING:\n-\t  dump (dumper::CLUSTER)\n-\t    && dump (\"[%u]=%s %P\", ix, b->entity_kind_name (),\n-\t\t     b->get_entity (), b->get_name ());\n-\t  for (unsigned jx = b->deps.length (); jx--;)\n-\t    {\n-\t      depset *dep = b->deps[jx];\n-\t      if (jx)\n-\t\tgcc_checking_assert (dep->get_entity_kind () == depset::EK_USING\n-\t\t\t\t     || TREE_VISITED (dep->get_entity ()));\n-\t      else\n-\t\tgcc_checking_assert (dep->get_entity_kind ()\n-\t\t\t\t     == depset::EK_NAMESPACE\n-\t\t\t\t     && dep->get_entity () == b->get_entity ());\n-\t    }\n+\t  {\n+\t    dump (dumper::CLUSTER)\n+\t      && dump (\"[%u]=%s %P\", ix, b->entity_kind_name (),\n+\t\t       b->get_entity (), b->get_name ());\n+\t    depset *ns_dep = b->deps[0];\n+\t    gcc_checking_assert (ns_dep->get_entity_kind ()\n+\t\t\t\t == depset::EK_NAMESPACE\n+\t\t\t\t && ns_dep->get_entity () == b->get_entity ());\n+\t    for (unsigned jx = b->deps.length (); --jx;)\n+\t      {\n+\t\tdepset *dep = b->deps[jx];\n+\t\t// We could be declaring something that is also a\n+\t\t// (merged) import\n+\t\tgcc_checking_assert (dep->is_import ()\n+\t\t\t\t     || TREE_VISITED (dep->get_entity ())\n+\t\t\t\t     || (dep->get_entity_kind ()\n+\t\t\t\t\t == depset::EK_USING));\n+\t      }\n+\t  }\n \t  break;\n \n \tcase depset::EK_DECL:"}, {"sha": "94c6bf11995b9acc2d5baa8ab87e33ab71f7d498", "filename": "gcc/testsuite/g++.dg/modules/pr99245_a.H", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fpr99245_a.H", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fpr99245_a.H", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fpr99245_a.H?ref=9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "patch": "@@ -0,0 +1,5 @@\n+// PR 99245 ICE writing out user of type_info\n+// { dg-additional-options -fmodule-header }\n+// { dg-module-cmi {} }\n+\n+namespace std { class type_info {}; }"}, {"sha": "548c2720ef5a52e4342445478e1b82eb0ff912b9", "filename": "gcc/testsuite/g++.dg/modules/pr99245_b.H", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fpr99245_b.H", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fpr99245_b.H", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fmodules%2Fpr99245_b.H?ref=9e64dd6b3f6706de571c6ed3c4b7a8c8b67f22b7", "patch": "@@ -0,0 +1,9 @@\n+// { dg-additional-options -fmodule-header }\n+// { dg-module-cmi {} }\n+namespace std { class type_info; }\n+\n+import \"pr99245_a.H\";\n+\n+namespace std {\n+  const type_info* __cxa_exception_type () noexcept;\n+}"}]}