{"sha": "4f9c6b6e187417a15ac89f7e76019f27fd637076", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY5YzZiNmUxODc0MTdhMTVhYzg5ZjdlNzYwMTlmMjdmZDYzNzA3Ng==", "commit": {"author": {"name": "Tobias Schl\u00fcter", "email": "tobias.schlueter@physik.uni-muenchen.de", "date": "2004-05-14T15:32:01Z"}, "committer": {"name": "Tobias Schl\u00fcter", "email": "tobi@gcc.gnu.org", "date": "2004-05-14T15:32:01Z"}, "message": "re PR fortran/15206 (RRSPACING intrinsics returns wrong result for 0.0)\n\nPR fortran/15206\n* trans-intrinsic.c (gfc_conv_intrinsic_rrspacing): Fixed to\nhandle zero correctly.\n\nFrom-SVN: r81848", "tree": {"sha": "0f426de4696a0f958be60cb977b3fd72c51e44be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0f426de4696a0f958be60cb977b3fd72c51e44be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f9c6b6e187417a15ac89f7e76019f27fd637076", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f9c6b6e187417a15ac89f7e76019f27fd637076", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f9c6b6e187417a15ac89f7e76019f27fd637076", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f9c6b6e187417a15ac89f7e76019f27fd637076/comments", "author": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "committer": {"login": "TobiSchluter", "id": 11887541, "node_id": "MDQ6VXNlcjExODg3NTQx", "avatar_url": "https://avatars.githubusercontent.com/u/11887541?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TobiSchluter", "html_url": "https://github.com/TobiSchluter", "followers_url": "https://api.github.com/users/TobiSchluter/followers", "following_url": "https://api.github.com/users/TobiSchluter/following{/other_user}", "gists_url": "https://api.github.com/users/TobiSchluter/gists{/gist_id}", "starred_url": "https://api.github.com/users/TobiSchluter/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TobiSchluter/subscriptions", "organizations_url": "https://api.github.com/users/TobiSchluter/orgs", "repos_url": "https://api.github.com/users/TobiSchluter/repos", "events_url": "https://api.github.com/users/TobiSchluter/events{/privacy}", "received_events_url": "https://api.github.com/users/TobiSchluter/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "571325db5977ad68205f88d6e4d86b1ffaeaaeec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/571325db5977ad68205f88d6e4d86b1ffaeaaeec", "html_url": "https://github.com/Rust-GCC/gccrs/commit/571325db5977ad68205f88d6e4d86b1ffaeaaeec"}], "stats": {"total": 37, "additions": 26, "deletions": 11}, "files": [{"sha": "605a5726b05fa63e17365088e845585a48fd3d1e", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f9c6b6e187417a15ac89f7e76019f27fd637076/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f9c6b6e187417a15ac89f7e76019f27fd637076/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=4f9c6b6e187417a15ac89f7e76019f27fd637076", "patch": "@@ -1,3 +1,9 @@\n+2004-05-08  Tobias Schl\ufffdter <tobias.schlueter@physik.uni-muenchen.de>\n+\n+\tPR fortran/15206\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_rrspacing): Fixed to\n+\thandle zero correctly.\n+\n 2004-05-14  Tobias Schlueter  <tobias.schlueter@physik.uni-muenchen.de>\n \n \t* match.c (gfc_match): Eliminate dead code."}, {"sha": "96eb306adc1763f85f57ab60ecde0da43c758669", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 20, "deletions": 11, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f9c6b6e187417a15ac89f7e76019f27fd637076/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f9c6b6e187417a15ac89f7e76019f27fd637076/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=4f9c6b6e187417a15ac89f7e76019f27fd637076", "patch": "@@ -2398,23 +2398,28 @@ gfc_conv_intrinsic_spacing (gfc_se * se, gfc_expr * expr)\n    se->expr = tmp;\n }\n \n-/* Generate code for RRSPACING (X) intrinsic function. We generate:                                                                            \n-    sedigits = edigits + 1;\n-    if (expn == 0)\n-    {\n-      t1 = leadzero (frac);\n-      frac = frac << (t1 + sedigits);\n-      frac = frac >> (sedigits);\n-    }\n-    t = bias + BITS_OF_FRACTION_OF;\n-    res = (t << BITS_OF_FRACTION_OF) | frac;\n+/* Generate code for RRSPACING (X) intrinsic function. We generate:\n+\n+    if (expn == 0 && frac == 0)\n+       res = 0;\n+    else\n+    {\n+       sedigits = edigits + 1;\n+       if (expn == 0)\n+       {\n+         t1 = leadzero (frac);\n+         frac = frac << (t1 + sedigits);\n+         frac = frac >> (sedigits);\n+       }\n+       t = bias + BITS_OF_FRACTION_OF;\n+       res = (t << BITS_OF_FRACTION_OF) | frac;\n */\n \n static void\n gfc_conv_intrinsic_rrspacing (gfc_se * se, gfc_expr * expr)\n {\n    tree masktype;\n-   tree tmp, t1, t2, cond;\n+   tree tmp, t1, t2, cond, cond2;\n    tree one, zero;\n    tree fdigits, fraction;\n    real_compnt_info rcs;\n@@ -2438,6 +2443,10 @@ gfc_conv_intrinsic_rrspacing (gfc_se * se, gfc_expr * expr)\n    tmp = build (LSHIFT_EXPR, masktype, tmp, fdigits);\n    tmp = build (BIT_IOR_EXPR, masktype, tmp, fraction);\n \n+   cond2 = build (EQ_EXPR, boolean_type_node, rcs.frac, zero);\n+   cond = build (TRUTH_ANDIF_EXPR, boolean_type_node, cond, cond2);\n+   tmp = build (COND_EXPR, masktype, cond, integer_zero_node, tmp);\n+\n    tmp = build1 (VIEW_CONVERT_EXPR, rcs.type, tmp);\n    se->expr = tmp;\n }"}]}