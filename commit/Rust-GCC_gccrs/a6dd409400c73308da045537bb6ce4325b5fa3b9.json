{"sha": "a6dd409400c73308da045537bb6ce4325b5fa3b9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTZkZDQwOTQwMGM3MzMwOGRhMDQ1NTM3YmI2Y2U0MzI1YjVmYTNiOQ==", "commit": {"author": {"name": "Geoffrey Keating", "email": "geoffk@apple.com", "date": "2004-01-16T07:20:38Z"}, "committer": {"name": "Geoffrey Keating", "email": "geoffk@gcc.gnu.org", "date": "2004-01-16T07:20:38Z"}, "message": "Index: ChangeLog\n2004-01-15  Geoffrey Keating  <geoffk@apple.com>\n\n\tPR pch/13361\n\t* c-typeck.c (constructor_asmspec): Delete.\n\t(struct initializer_stack): Delete field 'asmspec'.\n\t(start_init): Delete saving of asmspec.\n\t(finish_init): Don't update constructor_asmspec.\n\t* dwarf2out.c (rtl_for_decl_location): Duplicate string from tree.\n\t* stmt.c (expand_asm): Duplicate strings from tree.\n\t(expand_asm_operands): Likewise.\n\t* tree.c (tree_size): Update computation of size of STRING_CST.\n\t(make_node): Don't make STRING_CST nodes.\n\t(build_string): Allocate string with tree node.\n\t* tree.def (STRING_CST): Update comment.\n\t* tree.h (TREE_STRING_POINTER): Adjust for change to STRING_CST.\n\t(tree_string): Place contents of string in tree node.\n\t* config/sh/sh.c (sh_handle_sp_switch_attribute): Duplicate string\n\tfrom tree.\n\nIndex: cp/ChangeLog\n2004-01-15  Geoffrey Keating  <geoffk@apple.com>\n\n\tPR pch/13361\n\t* cp/lex.c (handle_pragma_interface): Duplicate string from tree.\n\t(handle_pragma_implementation): Likewise.\n\nIndex: testsuite/ChangeLog\n2004-01-15  Geoffrey Keating  <geoffk@apple.com>\n\n\tPR pch/13361\n\t* testsuite/g++.dg/pch/wchar-1.C: New.\n\t* testsuite/g++.dg/pch/wchar-1.Hs: New.\n\nFrom-SVN: r75961", "tree": {"sha": "2bb0b3d31da2f2479b8780b6008c14e696427d17", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2bb0b3d31da2f2479b8780b6008c14e696427d17"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a6dd409400c73308da045537bb6ce4325b5fa3b9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6dd409400c73308da045537bb6ce4325b5fa3b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a6dd409400c73308da045537bb6ce4325b5fa3b9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a6dd409400c73308da045537bb6ce4325b5fa3b9/comments", "author": {"login": "geoffk01", "id": 31905243, "node_id": "MDQ6VXNlcjMxOTA1MjQz", "avatar_url": "https://avatars.githubusercontent.com/u/31905243?v=4", "gravatar_id": "", "url": "https://api.github.com/users/geoffk01", "html_url": "https://github.com/geoffk01", "followers_url": "https://api.github.com/users/geoffk01/followers", "following_url": "https://api.github.com/users/geoffk01/following{/other_user}", "gists_url": "https://api.github.com/users/geoffk01/gists{/gist_id}", "starred_url": "https://api.github.com/users/geoffk01/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/geoffk01/subscriptions", "organizations_url": "https://api.github.com/users/geoffk01/orgs", "repos_url": "https://api.github.com/users/geoffk01/repos", "events_url": "https://api.github.com/users/geoffk01/events{/privacy}", "received_events_url": "https://api.github.com/users/geoffk01/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b0fadda7ece3959434d698de5800c2ee95c215fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0fadda7ece3959434d698de5800c2ee95c215fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0fadda7ece3959434d698de5800c2ee95c215fd"}], "stats": {"total": 109, "additions": 74, "deletions": 35}, "files": [{"sha": "35f3b982131f7caf89d4643fe3e0efa6b4b30b3f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,5 +1,22 @@\n 2004-01-15  Geoffrey Keating  <geoffk@apple.com>\n \n+\tPR pch/13361\n+\t* c-typeck.c (constructor_asmspec): Delete.\n+\t(struct initializer_stack): Delete field 'asmspec'.\n+\t(start_init): Delete saving of asmspec.\n+\t(finish_init): Don't update constructor_asmspec.\n+\t* dwarf2out.c (rtl_for_decl_location): Duplicate string from tree.\n+\t* stmt.c (expand_asm): Duplicate strings from tree.\n+\t(expand_asm_operands): Likewise.\n+\t* tree.c (tree_size): Update computation of size of STRING_CST.\n+\t(make_node): Don't make STRING_CST nodes.\n+\t(build_string): Allocate string with tree node.\n+\t* tree.def (STRING_CST): Update comment.\n+\t* tree.h (TREE_STRING_POINTER): Adjust for change to STRING_CST.\n+\t(tree_string): Place contents of string in tree node.\n+\t* config/sh/sh.c (sh_handle_sp_switch_attribute): Duplicate string\n+\tfrom tree.\n+\n \t* config/rs6000/rs6000.c (rs6000_va_arg): No need to special-case\n \taltivec operands.\n "}, {"sha": "e8bec8f9b69f62821a7e0b07c574e4021504a17b", "filename": "gcc/c-typeck.c", "status": "modified", "additions": 1, "deletions": 12, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fc-typeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fc-typeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-typeck.c?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -4304,9 +4304,6 @@ static int require_constant_elements;\n    such as (struct foo) {...}.  */\n static tree constructor_decl;\n \n-/* start_init saves the ASMSPEC arg here for really_start_incremental_init.  */\n-static const char *constructor_asmspec;\n-\n /* Nonzero if this is an initializer for a top-level decl.  */\n static int constructor_top_level;\n \n@@ -4378,7 +4375,6 @@ struct initializer_stack\n {\n   struct initializer_stack *next;\n   tree decl;\n-  const char *asmspec;\n   struct constructor_stack *constructor_stack;\n   struct constructor_range_stack *constructor_range_stack;\n   tree elements;\n@@ -4395,17 +4391,12 @@ struct initializer_stack *initializer_stack;\n /* Prepare to parse and output the initializer for variable DECL.  */\n \n void\n-start_init (tree decl, tree asmspec_tree, int top_level)\n+start_init (tree decl, tree asmspec_tree ATTRIBUTE_UNUSED, int top_level)\n {\n   const char *locus;\n   struct initializer_stack *p = xmalloc (sizeof (struct initializer_stack));\n-  const char *asmspec = 0;\n-\n-  if (asmspec_tree)\n-    asmspec = TREE_STRING_POINTER (asmspec_tree);\n \n   p->decl = constructor_decl;\n-  p->asmspec = constructor_asmspec;\n   p->require_constant_value = require_constant_value;\n   p->require_constant_elements = require_constant_elements;\n   p->constructor_stack = constructor_stack;\n@@ -4419,7 +4410,6 @@ start_init (tree decl, tree asmspec_tree, int top_level)\n   initializer_stack = p;\n \n   constructor_decl = decl;\n-  constructor_asmspec = asmspec;\n   constructor_designated = 0;\n   constructor_top_level = top_level;\n \n@@ -4476,7 +4466,6 @@ finish_init (void)\n   free (spelling_base);\n   \n   constructor_decl = p->decl;\n-  constructor_asmspec = p->asmspec;\n   require_constant_value = p->require_constant_value;\n   require_constant_elements = p->require_constant_elements;\n   constructor_stack = p->constructor_stack;"}, {"sha": "757f5aa1ee829f82cc2fb463ccaa64e5572d69e4", "filename": "gcc/config/sh/sh.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fconfig%2Fsh%2Fsh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fconfig%2Fsh%2Fsh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.c?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -6774,8 +6774,8 @@ sh_handle_sp_switch_attribute (tree *node, tree name, tree args,\n     }\n   else\n     {\n-      sp_switch = gen_rtx_SYMBOL_REF (VOIDmode,\n-\t\t\t\t      TREE_STRING_POINTER (TREE_VALUE (args)));\n+      char *s = ggc_strdup (TREE_STRING_POINTER (TREE_VALUE (args)));\n+      sp_switch = gen_rtx_SYMBOL_REF (VOIDmode, s);\n     }\n \n   return NULL_TREE;"}, {"sha": "f78d9af6f230b546fa4d36c4a499d7d37accf7cb", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,3 +1,9 @@\n+2004-01-15  Geoffrey Keating  <geoffk@apple.com>\n+\n+\tPR pch/13361\n+\t* cp/lex.c (handle_pragma_interface): Duplicate string from tree.\n+\t(handle_pragma_implementation): Likewise.\n+\n 2004-01-15  Giovanni Bajo  <giovannibajo@gcc.gnu.org>\n \n \tPR c++/9259"}, {"sha": "4fb45280e2eef8582dc59aedc8291839cf420fcf", "filename": "gcc/cp/lex.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fcp%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fcp%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Flex.c?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,6 +1,6 @@\n /* Separate lexical analyzer for GNU C++.\n    Copyright (C) 1987, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n+   1999, 2000, 2001, 2002, 2003, 2004 Free Software Foundation, Inc.\n    Hacked by Michael Tiemann (tiemann@cygnus.com)\n \n This file is part of GCC.\n@@ -535,7 +535,7 @@ handle_pragma_interface (cpp_reader* dfile ATTRIBUTE_UNUSED )\n   else if (fname == 0)\n     main_filename = lbasename (input_filename);\n   else\n-    main_filename = TREE_STRING_POINTER (fname);\n+    main_filename = ggc_strdup (TREE_STRING_POINTER (fname));\n \n   finfo = get_fileinfo (input_filename);\n \n@@ -585,7 +585,7 @@ handle_pragma_implementation (cpp_reader* dfile ATTRIBUTE_UNUSED )\n     }\n   else\n     {\n-      main_filename = TREE_STRING_POINTER (fname);\n+      main_filename = ggc_strdup (TREE_STRING_POINTER (fname));\n       if (cpp_included (parse_in, main_filename))\n \twarning (\"#pragma implementation for %s appears after file is included\",\n \t\t main_filename);"}, {"sha": "6e45394c0bbf16f8906fe89ed60f49d7f0f72d5c", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -9398,7 +9398,8 @@ rtl_for_decl_location (tree decl)\n \t\t\t\t   TREE_STRING_LENGTH (init) - 1) == 0\n \t      && ((size_t) TREE_STRING_LENGTH (init)\n \t\t  == strlen (TREE_STRING_POINTER (init)) + 1))\n-\t    rtl = gen_rtx_CONST_STRING (VOIDmode, TREE_STRING_POINTER (init));\n+\t    rtl = gen_rtx_CONST_STRING (VOIDmode,\n+\t\t\t\t\tggc_strdup (TREE_STRING_POINTER (init)));\n \t}\n       /* If the initializer is something that we know will expand into an\n \t immediate RTL constant, expand it now.  Expanding anything else"}, {"sha": "6288341a48f55f0ab02576389a317cb57fa9ee3d", "filename": "gcc/stmt.c", "status": "modified", "additions": 10, "deletions": 7, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fstmt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Fstmt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fstmt.c?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,6 +1,6 @@\n /* Expands front end tree to back end RTL for GCC\n    Copyright (C) 1987, 1988, 1989, 1992, 1993, 1994, 1995, 1996, 1997,\n-   1998, 1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n+   1998, 1999, 2000, 2001, 2002, 2003, 2004 Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -1106,7 +1106,8 @@ expand_asm (tree string, int vol)\n   if (TREE_CODE (string) == ADDR_EXPR)\n     string = TREE_OPERAND (string, 0);\n \n-  body = gen_rtx_ASM_INPUT (VOIDmode, TREE_STRING_POINTER (string));\n+  body = gen_rtx_ASM_INPUT (VOIDmode,\n+\t\t\t    ggc_strdup (TREE_STRING_POINTER (string)));\n \n   MEM_VOLATILE_P (body) = vol;\n \n@@ -1668,7 +1669,7 @@ expand_asm_operands (tree string, tree outputs, tree inputs,\n \n   body = gen_rtx_ASM_OPERANDS ((noutputs == 0 ? VOIDmode\n \t\t\t\t: GET_MODE (output_rtx[0])),\n-\t\t\t       TREE_STRING_POINTER (string),\n+\t\t\t       ggc_strdup (TREE_STRING_POINTER (string)),\n \t\t\t       empty_string, 0, argvec, constraintvec,\n \t\t\t       locus.file, locus.line);\n \n@@ -1749,7 +1750,8 @@ expand_asm_operands (tree string, tree outputs, tree inputs,\n       ASM_OPERANDS_INPUT (body, i) = op;\n \n       ASM_OPERANDS_INPUT_CONSTRAINT_EXP (body, i)\n-\t= gen_rtx_ASM_INPUT (TYPE_MODE (type), constraints[i + noutputs]);\n+\t= gen_rtx_ASM_INPUT (TYPE_MODE (type), \n+\t\t\t     ggc_strdup (constraints[i + noutputs]));\n \n       if (decl_conflicts_with_clobbers_p (val, clobbered_regs))\n \tclobber_conflict_found = 1;\n@@ -1790,7 +1792,7 @@ expand_asm_operands (tree string, tree outputs, tree inputs,\n \n   if (noutputs == 1 && nclobbers == 0)\n     {\n-      ASM_OPERANDS_OUTPUT_CONSTRAINT (body) = constraints[0];\n+      ASM_OPERANDS_OUTPUT_CONSTRAINT (body) = ggc_strdup (constraints[0]);\n       emit_insn (gen_rtx_SET (VOIDmode, output_rtx[0], body));\n     }\n \n@@ -1818,8 +1820,9 @@ expand_asm_operands (tree string, tree outputs, tree inputs,\n \t\t\t   output_rtx[i],\n \t\t\t   gen_rtx_ASM_OPERANDS\n \t\t\t   (GET_MODE (output_rtx[i]),\n-\t\t\t    TREE_STRING_POINTER (string),\n-\t\t\t    constraints[i], i, argvec, constraintvec,\n+\t\t\t    ggc_strdup (TREE_STRING_POINTER (string)),\n+\t\t\t    ggc_strdup (constraints[i]),\n+\t\t\t    i, argvec, constraintvec,\n \t\t\t    locus.file, locus.line));\n \n \t  MEM_VOLATILE_P (SET_SRC (XVECEXP (body, 0, i))) = vol;"}, {"sha": "196bce820a0738402c1231e07191c79ba2a4b296", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,3 +1,9 @@\n+2004-01-15  Geoffrey Keating  <geoffk@apple.com>\n+\n+\tPR pch/13361\n+\t* testsuite/g++.dg/pch/wchar-1.C: New.\n+\t* testsuite/g++.dg/pch/wchar-1.Hs: New.\n+\n 2004-01-15  Giovanni Bajo  <giovannibajo@gcc.gnu.org>\n \n \tPR c++/9259"}, {"sha": "6cb5fe15e4c74b116c5bb22802a2cb8821efa887", "filename": "gcc/testsuite/g++.dg/pch/wchar-1.C", "status": "added", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpch%2Fwchar-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpch%2Fwchar-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpch%2Fwchar-1.C?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -0,0 +1 @@\n+#include \"wchar-1.H\""}, {"sha": "431908b88b1eb46a0ec3440a2d9e26d522a64fcd", "filename": "gcc/testsuite/g++.dg/pch/wchar-1.Hs", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpch%2Fwchar-1.Hs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpch%2Fwchar-1.Hs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpch%2Fwchar-1.Hs?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -0,0 +1,2 @@\n+#include <stddef.h>\n+const wchar_t test_var[] = L\"wide string\";"}, {"sha": "da94c4a5893f14b1ac7202301edb3d4724b3d082", "filename": "gcc/tree.c", "status": "modified", "additions": 20, "deletions": 6, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,6 +1,6 @@\n /* Language-independent node constructors for parse phase of GNU compiler.\n    Copyright (C) 1987, 1988, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003 Free Software Foundation, Inc.\n+   1999, 2000, 2001, 2002, 2003, 2004 Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -168,7 +168,8 @@ tree_size (tree node)\n \tcase REAL_CST:\t\treturn sizeof (struct tree_real_cst);\n \tcase COMPLEX_CST:\treturn sizeof (struct tree_complex);\n \tcase VECTOR_CST:\treturn sizeof (struct tree_vector);\n-\tcase STRING_CST:\treturn sizeof (struct tree_string);\n+\tcase STRING_CST:\n+\t  return sizeof (struct tree_string) + TREE_STRING_LENGTH (node);\n \tdefault:\n \t  return (*lang_hooks.tree_size) (code);\n \t}\n@@ -212,8 +213,8 @@ make_node (enum tree_code code)\n   struct tree_common ttmp;\n \n   /* We can't allocate a TREE_VEC without knowing how many elements\n-     it will have.  */\n-  if (code == TREE_VEC)\n+     it will have; likewise a STRING_CST without knowing the length.  */\n+  if (code == TREE_VEC || code == STRING_CST)\n     abort ();\n \n   TREE_SET_CODE ((tree)&ttmp, code);\n@@ -525,10 +526,23 @@ build_real_from_int_cst (tree type, tree i)\n tree\n build_string (int len, const char *str)\n {\n-  tree s = make_node (STRING_CST);\n+  tree s;\n+  size_t length;\n+  \n+  length = len + sizeof (struct tree_string);\n+\n+#ifdef GATHER_STATISTICS\n+  tree_node_counts[(int) c_kind]++;\n+  tree_node_sizes[(int) c_kind] += length;\n+#endif  \n+\n+  s = ggc_alloc_tree (length);\n \n+  memset (s, 0, sizeof (struct tree_common));\n+  TREE_SET_CODE (s, STRING_CST);\n   TREE_STRING_LENGTH (s) = len;\n-  TREE_STRING_POINTER (s) = ggc_alloc_string (str, len);\n+  memcpy ((char *) TREE_STRING_POINTER (s), str, len);\n+  ((char *) TREE_STRING_POINTER (s))[len] = '\\0';\n \n   return s;\n }"}, {"sha": "48028ee351f9d4730780c5209b5f38de9dff6e5f", "filename": "gcc/tree.def", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftree.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftree.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.def?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -1,6 +1,6 @@\n /* This file contains the definitions and documentation for the\n    tree codes used in GCC.\n-   Copyright (C) 1987, 1988, 1993, 1995, 1997, 1998, 2000, 2001\n+   Copyright (C) 1987, 1988, 1993, 1995, 1997, 1998, 2000, 2001, 2004\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -274,7 +274,7 @@ DEFTREECODE (COMPLEX_CST, \"complex_cst\", 'c', 0)\n /* Contents are in TREE_VECTOR_CST_ELTS field.  */\n DEFTREECODE (VECTOR_CST, \"vector_cst\", 'c', 0)     \n \n-/* Contents are TREE_STRING_LENGTH and TREE_STRING_POINTER fields.  */\n+/* Contents are TREE_STRING_LENGTH and the actual contents of the string.  */\n DEFTREECODE (STRING_CST, \"string_cst\", 'c', 0)\n \n /* Declarations.  All references to names are represented as ..._DECL"}, {"sha": "7503fa5aaefc9cde1b812242bb45f5e251523804", "filename": "gcc/tree.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a6dd409400c73308da045537bb6ce4325b5fa3b9/gcc%2Ftree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.h?ref=a6dd409400c73308da045537bb6ce4325b5fa3b9", "patch": "@@ -700,13 +700,13 @@ struct tree_real_cst GTY(())\n \n /* In a STRING_CST */\n #define TREE_STRING_LENGTH(NODE) (STRING_CST_CHECK (NODE)->string.length)\n-#define TREE_STRING_POINTER(NODE) (STRING_CST_CHECK (NODE)->string.pointer)\n+#define TREE_STRING_POINTER(NODE) (STRING_CST_CHECK (NODE)->string.str)\n \n struct tree_string GTY(())\n {\n   struct tree_common common;\n   int length;\n-  const char *pointer;\n+  const char str[1];\n };\n \n /* In a COMPLEX_CST node.  */"}]}