{"sha": "37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzdiNjhhNDM4OWJkNDUyZTliNWFhMDM4NzBmNmI4MWU0ZjI2YjcxYw==", "commit": {"author": {"name": "Tamar Christina", "email": "tamar.christina@arm.com", "date": "2017-06-09T13:22:39Z"}, "committer": {"name": "Tamar Christina", "email": "tnfchris@gcc.gnu.org", "date": "2017-06-09T13:22:39Z"}, "message": "arm.c (arm_rtx_costs_internal): Make sdiv more expensive than udiv.\n\n2017-06-09  Tamar Christina  <tamar.christina@arm.com>\n\n\t* config/arm/arm.c (arm_rtx_costs_internal): Make sdiv more expensive than udiv.\n\n\ngcc/testsuite/\n2017-06-09  Tamar Christina  <tamar.christina@arm.com>\n\n\t* gcc.target/arm/sdiv_costs_1.c: New.\n\nFrom-SVN: r249062", "tree": {"sha": "ad8aa5432626a6d75a036d2a5b0b1037944f2d69", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ad8aa5432626a6d75a036d2a5b0b1037944f2d69"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/comments", "author": {"login": "TamarChristinaArm", "id": 48126768, "node_id": "MDQ6VXNlcjQ4MTI2NzY4", "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4", "gravatar_id": "", "url": "https://api.github.com/users/TamarChristinaArm", "html_url": "https://github.com/TamarChristinaArm", "followers_url": "https://api.github.com/users/TamarChristinaArm/followers", "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}", "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}", "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions", "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs", "repos_url": "https://api.github.com/users/TamarChristinaArm/repos", "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}", "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "53d01fd9e9568250e4304b5e0a5227e90f07cc40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53d01fd9e9568250e4304b5e0a5227e90f07cc40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53d01fd9e9568250e4304b5e0a5227e90f07cc40"}], "stats": {"total": 54, "additions": 53, "deletions": 1}, "files": [{"sha": "d4d2c11617c80d956c39e23ef33bad0d4c25cfc2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "patch": "@@ -1,3 +1,7 @@\n+2017-06-09  Tamar Christina  <tamar.christina@arm.com>\n+\n+\t* config/arm/arm.c (arm_rtx_costs_internal): Make sdiv more expensive than udiv.\n+\n 2017-06-09  Tom de Vries  <tom@codesourcery.com>\n \n \tPR target/80855"}, {"sha": "259597d8890ee84c5bd92b12b6f9f6521c8dcd2e", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "patch": "@@ -9315,6 +9315,10 @@ arm_rtx_costs_internal (rtx x, enum rtx_code code, enum rtx_code outer_code,\n \t*cost += COSTS_N_INSNS (speed_p ? extra_cost->mult[0].idiv : 0);\n       else\n \t*cost = LIBCALL_COST (2);\n+\n+      /* Make the cost of sdiv more expensive so when both sdiv and udiv are\n+\t possible udiv is prefered.  */\n+      *cost += (code == DIV ? COSTS_N_INSNS (1) : 0);\n       return false;\t/* All arguments must be in registers.  */\n \n     case MOD:\n@@ -9337,7 +9341,9 @@ arm_rtx_costs_internal (rtx x, enum rtx_code code, enum rtx_code outer_code,\n \n     /* Fall-through.  */\n     case UMOD:\n-      *cost = LIBCALL_COST (2);\n+      /* Make the cost of sdiv more expensive so when both sdiv and udiv are\n+\t possible udiv is prefered.  */\n+      *cost = LIBCALL_COST (2) + (code == MOD ? COSTS_N_INSNS (1) : 0);\n       return false;\t/* All arguments must be in registers.  */\n \n     case ROTATE:"}, {"sha": "01f2d1842ba8c96653ab87e86fd6800c1353049c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "patch": "@@ -1,3 +1,7 @@\n+2017-06-09  Tamar Christina  <tamar.christina@arm.com>\n+\n+\t* gcc.target/arm/sdiv_costs_1.c: New.\n+\n 2017-06-09  Tom de Vries  <tom@codesourcery.com>\n \n \tPR target/80855"}, {"sha": "76086ab9ce28fceb37a4e8a615a38923fa7b985a", "filename": "gcc/testsuite/gcc.target/arm/sdiv_costs_1.c", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsdiv_costs_1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37b68a4389bd452e9b5aa03870f6b81e4f26b71c/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsdiv_costs_1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fsdiv_costs_1.c?ref=37b68a4389bd452e9b5aa03870f6b81e4f26b71c", "patch": "@@ -0,0 +1,38 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -march=armv8-a\" } */\n+\n+/* Both sdiv and udiv can be used here, so prefer udiv.  */\n+int f1 (unsigned char *p)\n+{\n+  return 100 / p[1];\n+}\n+\n+int f2 (unsigned char *p, unsigned short x)\n+{\n+  return x / p[0];\n+}\n+\n+int f3 (unsigned char *p, int x)\n+{\n+  x &= 0x7fffffff;\n+  return x / p[0];\n+}\n+\n+int f5 (unsigned char *p, unsigned short x)\n+{\n+  return x % p[0];\n+}\n+\n+/* This should only generate signed divisions.  */\n+int f4 (unsigned char *p)\n+{\n+  return -100 / p[1];\n+}\n+\n+int f6 (unsigned char *p, short x)\n+{\n+  return x % p[0];\n+}\n+\n+/* { dg-final { scan-assembler-times \"udiv\\tr\\[0-9\\]+, r\\[0-9\\]+, r\\[0-9\\]+\" 4 } } */\n+/* { dg-final { scan-assembler-times \"sdiv\\tr\\[0-9\\]+, r\\[0-9\\]+, r\\[0-9\\]+\" 2 } } */"}]}