{"sha": "2c4074268983c92c1c8554b591a6877b4e92d7bb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmM0MDc0MjY4OTgzYzkyYzFjODU1NGI1OTFhNjg3N2I0ZTkyZDdiYg==", "commit": {"author": {"name": "Bin Cheng", "email": "bin.cheng@arm.com", "date": "2014-01-11T09:33:39Z"}, "committer": {"name": "Bin Cheng", "email": "amker@gcc.gnu.org", "date": "2014-01-11T09:33:39Z"}, "message": "tree-ssa-loop-ivopts.c (iv_ca_narrow): New parameter.\n\n\n\t* tree-ssa-loop-ivopts.c (iv_ca_narrow): New parameter.\n\tStart narrowing with START.  Apply candidate-use pair\n\tand check overall cost in narrowing.\n\t(iv_ca_prune): Pass new argument.\n\nFrom-SVN: r206552", "tree": {"sha": "287af300fe6f96b18a3119d658f1e2505f6c47be", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/287af300fe6f96b18a3119d658f1e2505f6c47be"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2c4074268983c92c1c8554b591a6877b4e92d7bb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c4074268983c92c1c8554b591a6877b4e92d7bb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c4074268983c92c1c8554b591a6877b4e92d7bb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c4074268983c92c1c8554b591a6877b4e92d7bb/comments", "author": null, "committer": null, "parents": [{"sha": "730e409386c1e3b2d2a2d50d0c9ef5e4b9e40d59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/730e409386c1e3b2d2a2d50d0c9ef5e4b9e40d59", "html_url": "https://github.com/Rust-GCC/gccrs/commit/730e409386c1e3b2d2a2d50d0c9ef5e4b9e40d59"}], "stats": {"total": 52, "additions": 34, "deletions": 18}, "files": [{"sha": "a66a01d05e719f9960217fe1dc8de1f16d9212b2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4074268983c92c1c8554b591a6877b4e92d7bb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4074268983c92c1c8554b591a6877b4e92d7bb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2c4074268983c92c1c8554b591a6877b4e92d7bb", "patch": "@@ -1,3 +1,10 @@\n+2014-01-11  Bin Cheng  <bin.cheng@arm.com>\n+\n+\t* tree-ssa-loop-ivopts.c (iv_ca_narrow): New parameter.\n+\tStart narrowing with START.  Apply candidate-use pair\n+\tand check overall cost in narrowing.\n+\t(iv_ca_prune): Pass new argument.\n+\n 2014-01-10  Jeff Law  <law@redhat.com>\n \n \tPR middle-end/59743"}, {"sha": "2d96fcefbd59317331444c41d8b2838f900967a4", "filename": "gcc/tree-ssa-loop-ivopts.c", "status": "modified", "additions": 27, "deletions": 18, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2c4074268983c92c1c8554b591a6877b4e92d7bb/gcc%2Ftree-ssa-loop-ivopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2c4074268983c92c1c8554b591a6877b4e92d7bb/gcc%2Ftree-ssa-loop-ivopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-ivopts.c?ref=2c4074268983c92c1c8554b591a6877b4e92d7bb", "patch": "@@ -5733,18 +5733,20 @@ iv_ca_extend (struct ivopts_data *data, struct iv_ca *ivs,\n }\n \n /* Try narrowing set IVS by removing CAND.  Return the cost of\n-   the new set and store the differences in DELTA.  */\n+   the new set and store the differences in DELTA.  START is\n+   the candidate with which we start narrowing.  */\n \n static comp_cost\n iv_ca_narrow (struct ivopts_data *data, struct iv_ca *ivs,\n-\t      struct iv_cand *cand, struct iv_ca_delta **delta)\n+\t      struct iv_cand *cand, struct iv_cand *start,\n+\t      struct iv_ca_delta **delta)\n {\n   unsigned i, ci;\n   struct iv_use *use;\n   struct cost_pair *old_cp, *new_cp, *cp;\n   bitmap_iterator bi;\n   struct iv_cand *cnd;\n-  comp_cost cost;\n+  comp_cost cost, best_cost, acost;\n \n   *delta = NULL;\n   for (i = 0; i < n_iv_uses (data); i++)\n@@ -5755,13 +5757,15 @@ iv_ca_narrow (struct ivopts_data *data, struct iv_ca *ivs,\n       if (old_cp->cand != cand)\n \tcontinue;\n \n-      new_cp = NULL;\n+      best_cost = iv_ca_cost (ivs);\n+      /* Start narrowing with START.  */\n+      new_cp = get_use_iv_cost (data, use, start);\n \n       if (data->consider_all_candidates)\n \t{\n \t  EXECUTE_IF_SET_IN_BITMAP (ivs->cands, 0, ci, bi)\n \t    {\n-\t      if (ci == cand->id)\n+\t      if (ci == cand->id || (start && ci == start->id))\n \t\tcontinue;\n \n \t      cnd = iv_cand (data, ci);\n@@ -5770,36 +5774,41 @@ iv_ca_narrow (struct ivopts_data *data, struct iv_ca *ivs,\n \t      if (!cp)\n \t\tcontinue;\n \n-\t      if (!iv_ca_has_deps (ivs, cp))\n-                continue; \n+\t      iv_ca_set_cp (data, ivs, use, cp);\n+\t      acost = iv_ca_cost (ivs);\n \n-\t      if (!cheaper_cost_pair (cp, new_cp))\n-\t\tcontinue;\n-\n-\t      new_cp = cp;\n+\t      if (compare_costs (acost, best_cost) < 0)\n+\t\t{\n+\t\t  best_cost = acost;\n+\t\t  new_cp = cp;\n+\t\t}\n \t    }\n \t}\n       else\n \t{\n \t  EXECUTE_IF_AND_IN_BITMAP (use->related_cands, ivs->cands, 0, ci, bi)\n \t    {\n-\t      if (ci == cand->id)\n+\t      if (ci == cand->id || (start && ci == start->id))\n \t\tcontinue;\n \n \t      cnd = iv_cand (data, ci);\n \n \t      cp = get_use_iv_cost (data, use, cnd);\n \t      if (!cp)\n \t\tcontinue;\n-\t      if (!iv_ca_has_deps (ivs, cp))\n-\t\tcontinue;\n \n-\t      if (!cheaper_cost_pair (cp, new_cp))\n-\t\tcontinue;\n+\t      iv_ca_set_cp (data, ivs, use, cp);\n+\t      acost = iv_ca_cost (ivs);\n \n-\t      new_cp = cp;\n+\t      if (compare_costs (acost, best_cost) < 0)\n+\t\t{\n+\t\t  best_cost = acost;\n+\t\t  new_cp = cp;\n+\t\t}\n \t    }\n \t}\n+      /* Restore to old cp for use.  */\n+      iv_ca_set_cp (data, ivs, use, old_cp);\n \n       if (!new_cp)\n \t{\n@@ -5841,7 +5850,7 @@ iv_ca_prune (struct ivopts_data *data, struct iv_ca *ivs,\n       if (cand == except_cand)\n \tcontinue;\n \n-      acost = iv_ca_narrow (data, ivs, cand, &act_delta);\n+      acost = iv_ca_narrow (data, ivs, cand, except_cand, &act_delta);\n \n       if (compare_costs (acost, best_cost) < 0)\n \t{"}]}