{"sha": "4d4473645282ded9c162611b8a658ad34671c824", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQ0NDczNjQ1MjgyZGVkOWMxNjI2MTFiOGE2NThhZDM0NjcxYzgyNA==", "commit": {"author": {"name": "Maciej W. Rozycki", "email": "macro@linux-mips.org", "date": "2004-08-03T20:36:23Z"}, "committer": {"name": "Nathanael Nerode", "email": "neroden@gcc.gnu.org", "date": "2004-08-03T20:36:23Z"}, "message": "acinclude.m4 (AC_FUNC_MMAP_BLACKLIST): Check for <sys/mman.h> and mmap() explicitly instead of relying on preset...\n\n2004-07-30  Maciej W. Rozycki  <macro@linux-mips.org>\n\n\t* acinclude.m4 (AC_FUNC_MMAP_BLACKLIST): Check for <sys/mman.h>\n\tand mmap() explicitly instead of relying on preset autoconf cache\n\tvariables.\n\t* aclocal.m4: Regenerate.\n\t* configure: Regenerate.\n\nFrom-SVN: r85500", "tree": {"sha": "33d61d719d255a8c77f377dd7936927e2fbf7284", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/33d61d719d255a8c77f377dd7936927e2fbf7284"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d4473645282ded9c162611b8a658ad34671c824", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d4473645282ded9c162611b8a658ad34671c824", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d4473645282ded9c162611b8a658ad34671c824", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d4473645282ded9c162611b8a658ad34671c824/comments", "author": null, "committer": null, "parents": [{"sha": "b522f768aba8391c18c16353cf42cc576ec88c06", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b522f768aba8391c18c16353cf42cc576ec88c06", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b522f768aba8391c18c16353cf42cc576ec88c06"}], "stats": {"total": 259, "additions": 255, "deletions": 4}, "files": [{"sha": "edfe44320fe7cb436a7e6ff234ccab3c46098f37", "filename": "libffi/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d4473645282ded9c162611b8a658ad34671c824/libffi%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d4473645282ded9c162611b8a658ad34671c824/libffi%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2FChangeLog?ref=4d4473645282ded9c162611b8a658ad34671c824", "patch": "@@ -1,3 +1,11 @@\n+2004-07-30  Maciej W. Rozycki  <macro@linux-mips.org>\n+\n+\t* acinclude.m4 (AC_FUNC_MMAP_BLACKLIST): Check for <sys/mman.h>\n+\tand mmap() explicitly instead of relying on preset autoconf cache\n+\tvariables.\n+\t* aclocal.m4: Regenerate.\n+\t* configure: Regenerate.\n+\n 2004-07-11  Ulrich Weigand  <uweigand@de.ibm.com>\n \n \t* src/s390/ffi.c (ffi_prep_args): Fix C aliasing violation."}, {"sha": "61187cfa5648502437e173e4d47783f70ed6eb17", "filename": "libffi/acinclude.m4", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d4473645282ded9c162611b8a658ad34671c824/libffi%2Facinclude.m4", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d4473645282ded9c162611b8a658ad34671c824/libffi%2Facinclude.m4", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Facinclude.m4?ref=4d4473645282ded9c162611b8a658ad34671c824", "patch": "@@ -11,8 +11,12 @@ AC_SUBST(LIBTOOL)\n # mmap(2) blacklisting.  Some platforms provide the mmap library routine\n # but don't support all of the features we need from it.\n AC_DEFUN([AC_FUNC_MMAP_BLACKLIST],\n-[if test $ac_cv_header_sys_mman_h != yes \\\n- || test $ac_cv_func_mmap != yes; then\n+[\n+AC_CHECK_HEADER([sys/mman.h],\n+\t\t[libffi_header_sys_mman_h=yes], [libffi_header_sys_mman_h=no])\n+AC_CHECK_FUNC([mmap], [libffi_func_mmap=yes], [libffi_func_mmap=no])\n+if test \"$libffi_header_sys_mman_h\" != yes \\\n+ || test \"$libffi_func_mmap\" != yes; then\n    ac_cv_func_mmap_file=no\n    ac_cv_func_mmap_dev_zero=no\n    ac_cv_func_mmap_anon=no"}, {"sha": "fe7f7d1b5d7a9d787288d133cae144a72371313d", "filename": "libffi/configure", "status": "modified", "additions": 241, "deletions": 2, "changes": 243, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d4473645282ded9c162611b8a658ad34671c824/libffi%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d4473645282ded9c162611b8a658ad34671c824/libffi%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libffi%2Fconfigure?ref=4d4473645282ded9c162611b8a658ad34671c824", "patch": "@@ -4883,8 +4883,247 @@ _ACEOF\n fi\n done\n \n-if test $ac_cv_header_sys_mman_h != yes \\\n- || test $ac_cv_func_mmap != yes; then\n+\n+if test \"${ac_cv_header_sys_mman_h+set}\" = set; then\n+  echo \"$as_me:$LINENO: checking for sys/mman.h\" >&5\n+echo $ECHO_N \"checking for sys/mman.h... $ECHO_C\" >&6\n+if test \"${ac_cv_header_sys_mman_h+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+fi\n+echo \"$as_me:$LINENO: result: $ac_cv_header_sys_mman_h\" >&5\n+echo \"${ECHO_T}$ac_cv_header_sys_mman_h\" >&6\n+else\n+  # Is the header compilable?\n+echo \"$as_me:$LINENO: checking sys/mman.h usability\" >&5\n+echo $ECHO_N \"checking sys/mman.h usability... $ECHO_C\" >&6\n+cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+$ac_includes_default\n+#include <sys/mman.h>\n+_ACEOF\n+rm -f conftest.$ac_objext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_compile\\\"\") >&5\n+  (eval $ac_compile) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest.$ac_objext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  ac_header_compiler=yes\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+ac_header_compiler=no\n+fi\n+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext\n+echo \"$as_me:$LINENO: result: $ac_header_compiler\" >&5\n+echo \"${ECHO_T}$ac_header_compiler\" >&6\n+\n+# Is the header present?\n+echo \"$as_me:$LINENO: checking sys/mman.h presence\" >&5\n+echo $ECHO_N \"checking sys/mman.h presence... $ECHO_C\" >&6\n+cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+#include <sys/mman.h>\n+_ACEOF\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_cpp conftest.$ac_ext\\\"\") >&5\n+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } >/dev/null; then\n+  if test -s conftest.err; then\n+    ac_cpp_err=$ac_c_preproc_warn_flag\n+    ac_cpp_err=$ac_cpp_err$ac_c_werror_flag\n+  else\n+    ac_cpp_err=\n+  fi\n+else\n+  ac_cpp_err=yes\n+fi\n+if test -z \"$ac_cpp_err\"; then\n+  ac_header_preproc=yes\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+  ac_header_preproc=no\n+fi\n+rm -f conftest.err conftest.$ac_ext\n+echo \"$as_me:$LINENO: result: $ac_header_preproc\" >&5\n+echo \"${ECHO_T}$ac_header_preproc\" >&6\n+\n+# So?  What about this header?\n+case $ac_header_compiler:$ac_header_preproc:$ac_c_preproc_warn_flag in\n+  yes:no: )\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h: accepted by the compiler, rejected by the preprocessor!\" >&5\n+echo \"$as_me: WARNING: sys/mman.h: accepted by the compiler, rejected by the preprocessor!\" >&2;}\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h: proceeding with the compiler's result\" >&5\n+echo \"$as_me: WARNING: sys/mman.h: proceeding with the compiler's result\" >&2;}\n+    ac_header_preproc=yes\n+    ;;\n+  no:yes:* )\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h: present but cannot be compiled\" >&5\n+echo \"$as_me: WARNING: sys/mman.h: present but cannot be compiled\" >&2;}\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h:     check for missing prerequisite headers?\" >&5\n+echo \"$as_me: WARNING: sys/mman.h:     check for missing prerequisite headers?\" >&2;}\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h: see the Autoconf documentation\" >&5\n+echo \"$as_me: WARNING: sys/mman.h: see the Autoconf documentation\" >&2;}\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h:     section \\\"Present But Cannot Be Compiled\\\"\" >&5\n+echo \"$as_me: WARNING: sys/mman.h:     section \\\"Present But Cannot Be Compiled\\\"\" >&2;}\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h: proceeding with the preprocessor's result\" >&5\n+echo \"$as_me: WARNING: sys/mman.h: proceeding with the preprocessor's result\" >&2;}\n+    { echo \"$as_me:$LINENO: WARNING: sys/mman.h: in the future, the compiler will take precedence\" >&5\n+echo \"$as_me: WARNING: sys/mman.h: in the future, the compiler will take precedence\" >&2;}\n+    (\n+      cat <<\\_ASBOX\n+## ------------------------------------------- ##\n+## Report this to http://gcc.gnu.org/bugs.html ##\n+## ------------------------------------------- ##\n+_ASBOX\n+    ) |\n+      sed \"s/^/$as_me: WARNING:     /\" >&2\n+    ;;\n+esac\n+echo \"$as_me:$LINENO: checking for sys/mman.h\" >&5\n+echo $ECHO_N \"checking for sys/mman.h... $ECHO_C\" >&6\n+if test \"${ac_cv_header_sys_mman_h+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+else\n+  ac_cv_header_sys_mman_h=$ac_header_preproc\n+fi\n+echo \"$as_me:$LINENO: result: $ac_cv_header_sys_mman_h\" >&5\n+echo \"${ECHO_T}$ac_cv_header_sys_mman_h\" >&6\n+\n+fi\n+if test $ac_cv_header_sys_mman_h = yes; then\n+  libffi_header_sys_mman_h=yes\n+else\n+  libffi_header_sys_mman_h=no\n+fi\n+\n+\n+echo \"$as_me:$LINENO: checking for mmap\" >&5\n+echo $ECHO_N \"checking for mmap... $ECHO_C\" >&6\n+if test \"${ac_cv_func_mmap+set}\" = set; then\n+  echo $ECHO_N \"(cached) $ECHO_C\" >&6\n+else\n+  cat >conftest.$ac_ext <<_ACEOF\n+/* confdefs.h.  */\n+_ACEOF\n+cat confdefs.h >>conftest.$ac_ext\n+cat >>conftest.$ac_ext <<_ACEOF\n+/* end confdefs.h.  */\n+/* Define mmap to an innocuous variant, in case <limits.h> declares mmap.\n+   For example, HP-UX 11i <limits.h> declares gettimeofday.  */\n+#define mmap innocuous_mmap\n+\n+/* System header to define __stub macros and hopefully few prototypes,\n+    which can conflict with char mmap (); below.\n+    Prefer <limits.h> to <assert.h> if __STDC__ is defined, since\n+    <limits.h> exists even on freestanding compilers.  */\n+\n+#ifdef __STDC__\n+# include <limits.h>\n+#else\n+# include <assert.h>\n+#endif\n+\n+#undef mmap\n+\n+/* Override any gcc2 internal prototype to avoid an error.  */\n+#ifdef __cplusplus\n+extern \"C\"\n+{\n+#endif\n+/* We use char because int might match the return type of a gcc2\n+   builtin and then its argument prototype would still apply.  */\n+char mmap ();\n+/* The GNU C library defines this for functions which it implements\n+    to always fail with ENOSYS.  Some functions are actually named\n+    something starting with __ and the normal name is an alias.  */\n+#if defined (__stub_mmap) || defined (__stub___mmap)\n+choke me\n+#else\n+char (*f) () = mmap;\n+#endif\n+#ifdef __cplusplus\n+}\n+#endif\n+\n+int\n+main ()\n+{\n+return f != mmap;\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+rm -f conftest.$ac_objext conftest$ac_exeext\n+if { (eval echo \"$as_me:$LINENO: \\\"$ac_link\\\"\") >&5\n+  (eval $ac_link) 2>conftest.er1\n+  ac_status=$?\n+  grep -v '^ *+' conftest.er1 >conftest.err\n+  rm -f conftest.er1\n+  cat conftest.err >&5\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); } &&\n+\t { ac_try='test -z \"$ac_c_werror_flag\"\t\t\t || test ! -s conftest.err'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; } &&\n+\t { ac_try='test -s conftest$ac_exeext'\n+  { (eval echo \"$as_me:$LINENO: \\\"$ac_try\\\"\") >&5\n+  (eval $ac_try) 2>&5\n+  ac_status=$?\n+  echo \"$as_me:$LINENO: \\$? = $ac_status\" >&5\n+  (exit $ac_status); }; }; then\n+  ac_cv_func_mmap=yes\n+else\n+  echo \"$as_me: failed program was:\" >&5\n+sed 's/^/| /' conftest.$ac_ext >&5\n+\n+ac_cv_func_mmap=no\n+fi\n+rm -f conftest.err conftest.$ac_objext \\\n+      conftest$ac_exeext conftest.$ac_ext\n+fi\n+echo \"$as_me:$LINENO: result: $ac_cv_func_mmap\" >&5\n+echo \"${ECHO_T}$ac_cv_func_mmap\" >&6\n+if test $ac_cv_func_mmap = yes; then\n+  libffi_func_mmap=yes\n+else\n+  libffi_func_mmap=no\n+fi\n+\n+if test \"$libffi_header_sys_mman_h\" != yes \\\n+ || test \"$libffi_func_mmap\" != yes; then\n    ac_cv_func_mmap_file=no\n    ac_cv_func_mmap_dev_zero=no\n    ac_cv_func_mmap_anon=no"}]}