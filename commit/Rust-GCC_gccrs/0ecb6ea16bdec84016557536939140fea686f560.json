{"sha": "0ecb6ea16bdec84016557536939140fea686f560", "node_id": "C_kwDOANBUbNoAKDBlY2I2ZWExNmJkZWM4NDAxNjU1NzUzNjkzOTE0MGZlYTY4NmY1NjA", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-11-18T13:53:47Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-11-18T13:53:47Z"}, "message": "Remove implicit name hack for trait associated types\n\nBefore the TypePath resolution was updated to support associated type paths\nand projections, we used an implict name hack of Self::<associated-type> as\nwell as the usual TraitName::<associates-type> this was a hack in the short\nterm to get things working which can now be removed.\n\nAddresses: #739", "tree": {"sha": "8a4a116d01cf42ff7507832321618320eed77c3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8a4a116d01cf42ff7507832321618320eed77c3e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0ecb6ea16bdec84016557536939140fea686f560", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ecb6ea16bdec84016557536939140fea686f560", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ecb6ea16bdec84016557536939140fea686f560", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ecb6ea16bdec84016557536939140fea686f560/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0995184e26f81f8ba6872c3efb59f640a7fe7162", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0995184e26f81f8ba6872c3efb59f640a7fe7162", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0995184e26f81f8ba6872c3efb59f640a7fe7162"}], "stats": {"total": 39, "additions": 4, "deletions": 35}, "files": [{"sha": "f60732c6f77d13e792700e5cdca945eecda22c18", "filename": "gcc/rust/resolve/rust-ast-resolve-item.h", "status": "modified", "additions": 4, "deletions": 23, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Frust%2Fresolve%2Frust-ast-resolve-item.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Frust%2Fresolve%2Frust-ast-resolve-item.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fresolve%2Frust-ast-resolve-item.h?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -35,29 +35,14 @@ class ResolveTraitItems : public ResolverBase\n   using Rust::Resolver::ResolverBase::visit;\n \n public:\n-  static void go (AST::TraitItem *item, const CanonicalPath &self)\n+  static void go (AST::TraitItem *item)\n   {\n-    ResolveTraitItems resolver (self);\n+    ResolveTraitItems resolver;\n     item->accept_vis (resolver);\n   };\n \n   void visit (AST::TraitItemType &type) override\n   {\n-    // insert Self::type_alias for TypePath lookup\n-    auto path\n-      = self.append (ResolveTraitItemTypeToCanonicalPath::resolve (type));\n-    resolver->get_type_scope ().insert (\n-      path, type.get_node_id (), type.get_locus (), false,\n-      [&] (const CanonicalPath &, NodeId, Location locus) -> void {\n-\tRichLocation r (type.get_locus ());\n-\tr.add_range (locus);\n-\trust_error_at (r, \"redefined multiple times\");\n-      });\n-\n-    // FIXME this stops the erronious unused decls which will be fixed later on\n-    resolver->get_type_scope ().append_reference_for_def (type.get_node_id (),\n-\t\t\t\t\t\t\t  type.get_node_id ());\n-\n     for (auto &bound : type.get_type_param_bounds ())\n       ResolveTypeBound::go (bound.get (), type.get_node_id ());\n   }\n@@ -189,11 +174,7 @@ class ResolveTraitItems : public ResolverBase\n   }\n \n private:\n-  ResolveTraitItems (const CanonicalPath &self)\n-    : ResolverBase (UNKNOWN_NODEID), self (self)\n-  {}\n-\n-  const CanonicalPath &self;\n+  ResolveTraitItems () : ResolverBase (UNKNOWN_NODEID) {}\n };\n \n class ResolveItem : public ResolverBase\n@@ -649,7 +630,7 @@ class ResolveItem : public ResolverBase\n \n     for (auto &item : trait.get_trait_items ())\n       {\n-\tResolveTraitItems::go (item.get (), Self);\n+\tResolveTraitItems::go (item.get ());\n       }\n \n     resolver->get_type_scope ().pop ();"}, {"sha": "9aa00fe0d0864f084bfb31b0fef41467de1cdea9", "filename": "gcc/testsuite/rust/compile/torture/issue-808.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fissue-808.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fissue-808.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Fissue-808.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -1,6 +1,5 @@\n pub trait Foo {\n     type Target;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn bar(&self) -> &Self::Target;\n     // { dg-warning \"unused name .self.\" \"\" { target *-*-* } .-1 }"}, {"sha": "41c82f01b6ddcd2402fce86c48bae5722ea7269c", "filename": "gcc/testsuite/rust/compile/torture/traits11.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits11.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits11.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits11.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -1,6 +1,5 @@\n trait Foo {\n     type A;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn test(a: Self::A) -> Self::A {\n         a"}, {"sha": "10d9479fb0da76a8b8cfc2debc936ff100f65baa", "filename": "gcc/testsuite/rust/compile/torture/traits4.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits4.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits4.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits4.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -1,8 +1,6 @@\n trait Foo {\n     type A;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n     type B;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn new(a: Self::A, b: Self::B) -> Self;\n     // { dg-warning \"unused name .a.\" \"\" { target *-*-* } .-1 }"}, {"sha": "4a396a0ffa5dae9d5b14ee4a8c6049053fe8f0e4", "filename": "gcc/testsuite/rust/compile/torture/traits5.rs", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits5.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits5.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits5.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -1,8 +1,6 @@\n trait Foo {\n     type A;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n     type B;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn new(a: Self::A, b: Self::B) -> Self;\n     // { dg-warning \"unused name .a.\" \"\" { target *-*-* } .-1 }"}, {"sha": "a69c6fd14a6c1aea7307840ddb49284f5c34d2ce", "filename": "gcc/testsuite/rust/compile/torture/traits6.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits6.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits6.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fcompile%2Ftorture%2Ftraits6.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -1,6 +1,5 @@\n trait Foo {\n     type A;\n-    // { dg-warning \"unused name .Foo::A.\" \"\" { target *-*-* } .-1 }\n \n     fn baz(a: Self::A) -> Self::A;\n     // { dg-warning \"unused name .a.\" \"\" { target *-*-* } .-1 }"}, {"sha": "997ab04f5f186ef7886a6bd16858711883e1a065", "filename": "gcc/testsuite/rust/execute/torture/operator_overload_1.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_1.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_1.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_1.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -6,7 +6,6 @@ extern \"C\" {\n #[lang = \"add\"]\n pub trait Add<Rhs = Self> {\n     type Output;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn add(self, rhs: Rhs) -> Self::Output;\n     // { dg-warning \"unused name .self.\" \"\" { target *-*-* } .-1 }"}, {"sha": "8d6a0739ff0f421b2af487e3817fb98d94d67280", "filename": "gcc/testsuite/rust/execute/torture/operator_overload_2.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_2.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_2.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_2.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -6,7 +6,6 @@ extern \"C\" {\n #[lang = \"add\"]\n pub trait Add<Rhs = Self> {\n     type Output;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn add(self, rhs: Rhs) -> Self::Output;\n     // { dg-warning \"unused name .self.\" \"\" { target *-*-* } .-1 }"}, {"sha": "50ff7991a30e17809805ed189ae04fd70040a007", "filename": "gcc/testsuite/rust/execute/torture/operator_overload_3.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_3.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_3.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_3.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -6,7 +6,6 @@ extern \"C\" {\n #[lang = \"add\"]\n pub trait Add<Rhs = Self> {\n     type Output;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn add(self, rhs: Rhs) -> Self::Output;\n     // { dg-warning \"unused name .self.\" \"\" { target *-*-* } .-1 }"}, {"sha": "5ca5c7aec50254d084df3114dd45547cd9b495cb", "filename": "gcc/testsuite/rust/execute/torture/operator_overload_4.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_4.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_4.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_4.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -6,7 +6,6 @@ extern \"C\" {\n #[lang = \"neg\"]\n pub trait Neg {\n     type Output;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn neg(self) -> Self::Output;\n     // { dg-warning \"unused name .self.\" \"\" { target *-*-* } .-1 }"}, {"sha": "5aac3ad0589a902f83abe64212799f2ee43bceb4", "filename": "gcc/testsuite/rust/execute/torture/operator_overload_5.rs", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_5.rs", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ecb6ea16bdec84016557536939140fea686f560/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_5.rs", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Frust%2Fexecute%2Ftorture%2Foperator_overload_5.rs?ref=0ecb6ea16bdec84016557536939140fea686f560", "patch": "@@ -6,7 +6,6 @@ extern \"C\" {\n #[lang = \"not\"]\n pub trait Not {\n     type Output;\n-    // { dg-warning \"unused name\" \"\" { target *-*-* } .-1 }\n \n     fn not(self) -> Self::Output;\n     // { dg-warning \"unused name .self.\" \"\" { target *-*-* } .-1 }"}]}