{"sha": "06c2a74f557ec98896c9f71ba666bd969c4735d2", "node_id": "C_kwDOANBUbNoAKDA2YzJhNzRmNTU3ZWM5ODg5NmM5ZjcxYmE2NjZiZDk2OWM0NzM1ZDI", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-01-13T21:29:06Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-01-13T21:29:22Z"}, "message": "Add HIR lowering for FunctionQualifiers", "tree": {"sha": "0d3cf0acf66467261c08165ec9339693374bb513", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0d3cf0acf66467261c08165ec9339693374bb513"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/06c2a74f557ec98896c9f71ba666bd969c4735d2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06c2a74f557ec98896c9f71ba666bd969c4735d2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/06c2a74f557ec98896c9f71ba666bd969c4735d2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/06c2a74f557ec98896c9f71ba666bd969c4735d2/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f51d8fd538681cd66791ac6e93d094651cde174d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f51d8fd538681cd66791ac6e93d094651cde174d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f51d8fd538681cd66791ac6e93d094651cde174d"}], "stats": {"total": 49, "additions": 44, "deletions": 5}, "files": [{"sha": "ad503cfce2357bc826c134450165e3c7757f13fe", "filename": "gcc/rust/ast/rust-item.h", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fast%2Frust-item.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fast%2Frust-item.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fast%2Frust-item.h?ref=06c2a74f557ec98896c9f71ba666bd969c4735d2", "patch": "@@ -518,6 +518,11 @@ struct FunctionQualifiers\n   }\n \n   std::string as_string () const;\n+\n+  AsyncConstStatus get_const_status () const { return const_status; }\n+  bool is_unsafe () const { return has_unsafe; }\n+  bool is_extern () const { return has_extern; }\n+  std::string get_extern_abi () const { return extern_abi; }\n };\n \n // A function parameter\n@@ -1587,7 +1592,7 @@ class Function : public VisItem, public InherentImplItem, public TraitImplItem\n     return function_body;\n   }\n \n-  FunctionQualifiers get_qualifiers () const { return qualifiers; }\n+  const FunctionQualifiers &get_qualifiers () const { return qualifiers; }\n \n   Identifier get_function_name () const { return function_name; }\n "}, {"sha": "047d531c25fe91e89b94cdf1fa149fd5ac845796", "filename": "gcc/rust/hir/rust-ast-lower-base.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Frust-ast-lower-base.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Frust-ast-lower-base.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower-base.h?ref=06c2a74f557ec98896c9f71ba666bd969c4735d2", "patch": "@@ -278,6 +278,9 @@ class ASTLoweringBase : public AST::ASTVisitor\n \n   HIR::QualifiedPathType\n   lower_qual_path_type (AST::QualifiedPathType &qual_path_type);\n+\n+  HIR::FunctionQualifiers\n+  lower_qualifiers (const AST::FunctionQualifiers &qualifiers);\n };\n \n } // namespace HIR"}, {"sha": "af9e1299946e66fca7faccd9521ea0ee4a240db9", "filename": "gcc/rust/hir/rust-ast-lower-item.h", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Frust-ast-lower-item.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Frust-ast-lower-item.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower-item.h?ref=06c2a74f557ec98896c9f71ba666bd969c4735d2", "patch": "@@ -429,8 +429,8 @@ class ASTLoweringItem : public ASTLoweringBase\n       }\n \n     HIR::WhereClause where_clause (std::move (where_clause_items));\n-    HIR::FunctionQualifiers qualifiers (\n-      HIR::FunctionQualifiers::AsyncConstStatus::NONE, Unsafety::Normal);\n+    HIR::FunctionQualifiers qualifiers\n+      = lower_qualifiers (function.get_qualifiers ());\n     HIR::Visibility vis = HIR::Visibility::create_public ();\n \n     // need\n@@ -439,7 +439,6 @@ class ASTLoweringItem : public ASTLoweringBase\n       {\n \tgeneric_params = lower_generic_params (function.get_generic_params ());\n       }\n-\n     Identifier function_name = function.get_function_name ();\n     Location locus = function.get_locus ();\n "}, {"sha": "326412b46631c3f5c20e7bc32b83f8933673807a", "filename": "gcc/rust/hir/rust-ast-lower.cc", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Frust-ast-lower.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Frust-ast-lower.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Frust-ast-lower.cc?ref=06c2a74f557ec98896c9f71ba666bd969c4735d2", "patch": "@@ -593,5 +593,33 @@ struct_field_name_exists (std::vector<HIR::StructField> &fields,\n   return false;\n }\n \n+HIR::FunctionQualifiers\n+ASTLoweringBase::lower_qualifiers (const AST::FunctionQualifiers &qualifiers)\n+{\n+  HIR::FunctionQualifiers::AsyncConstStatus const_status;\n+  switch (qualifiers.get_const_status ())\n+    {\n+    case AST::FunctionQualifiers::AsyncConstStatus::NONE:\n+      const_status = HIR::FunctionQualifiers::AsyncConstStatus::NONE;\n+      break;\n+    case AST::FunctionQualifiers::AsyncConstStatus::CONST:\n+      const_status = HIR::FunctionQualifiers::AsyncConstStatus::CONST;\n+      break;\n+    case AST::FunctionQualifiers::AsyncConstStatus::ASYNC:\n+      const_status = HIR::FunctionQualifiers::AsyncConstStatus::ASYNC;\n+      break;\n+    }\n+\n+  Unsafety unsafety\n+    = qualifiers.is_unsafe () ? Unsafety::Unsafe : Unsafety::Normal;\n+  bool has_extern = qualifiers.is_extern ();\n+\n+  // FIXME turn this into the Rust::ABI enum\n+  std::string extern_abi = qualifiers.get_extern_abi ();\n+\n+  return HIR::FunctionQualifiers (const_status, unsafety, has_extern,\n+\t\t\t\t  extern_abi);\n+}\n+\n } // namespace HIR\n } // namespace Rust"}, {"sha": "09f9d381ef5d23aae02e366446aee31ddd479bb9", "filename": "gcc/rust/hir/tree/rust-hir-item.h", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-item.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/06c2a74f557ec98896c9f71ba666bd969c4735d2/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-item.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fhir%2Ftree%2Frust-hir-item.h?ref=06c2a74f557ec98896c9f71ba666bd969c4735d2", "patch": "@@ -511,6 +511,10 @@ struct FunctionQualifiers\n   }\n \n   std::string as_string () const;\n+\n+  AsyncConstStatus get_status () const { return const_status; }\n+\n+  bool is_const () const { return const_status == AsyncConstStatus::CONST; }\n };\n \n // A function parameter\n@@ -1216,7 +1220,7 @@ class Function : public VisItem, public ImplItem\n     return function_body;\n   }\n \n-  FunctionQualifiers get_qualifiers () const { return qualifiers; }\n+  const FunctionQualifiers &get_qualifiers () const { return qualifiers; }\n \n   Identifier get_function_name () const { return function_name; }\n "}]}