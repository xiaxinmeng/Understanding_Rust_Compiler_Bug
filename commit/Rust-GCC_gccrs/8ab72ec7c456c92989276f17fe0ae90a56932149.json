{"sha": "8ab72ec7c456c92989276f17fe0ae90a56932149", "node_id": "C_kwDOANBUbNoAKDhhYjcyZWM3YzQ1NmM5Mjk4OTI3NmYxN2ZlMGFlOTBhNTY5MzIxNDk", "commit": {"author": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2022-03-08T23:18:34Z"}, "committer": {"name": "Roger Sayle", "email": "roger@nextmovesoftware.com", "date": "2022-03-08T23:18:34Z"}, "message": "PR c++/96329: ICE-on-invalid-code error recovery.\n\nThis patch fixes PR c++/96329 which is an ICE-on-invalid-code regression\naffecting mainline.\n\n2022-03-08  Roger Sayle  <roger@nextmovesoftware.com>\n\ngcc/cp/ChangeLog\n\tPR c++/96329\n\t* parser.cc (cp_parser_linkage_specification): Treat the case where\n\tlinkage is error_mark_node as \"invalid linkage-specification\".\n\ngcc/testsuite/ChangeLog\n\tPR c++/96329\n\t* g++.dg/template/pr96329.C: New test case.", "tree": {"sha": "a9b1ad12e782bf0ee691f8d9c76ed800a543a903", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a9b1ad12e782bf0ee691f8d9c76ed800a543a903"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8ab72ec7c456c92989276f17fe0ae90a56932149", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ab72ec7c456c92989276f17fe0ae90a56932149", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ab72ec7c456c92989276f17fe0ae90a56932149", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ab72ec7c456c92989276f17fe0ae90a56932149/comments", "author": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rogersayle", "id": 13512313, "node_id": "MDQ6VXNlcjEzNTEyMzEz", "avatar_url": "https://avatars.githubusercontent.com/u/13512313?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rogersayle", "html_url": "https://github.com/rogersayle", "followers_url": "https://api.github.com/users/rogersayle/followers", "following_url": "https://api.github.com/users/rogersayle/following{/other_user}", "gists_url": "https://api.github.com/users/rogersayle/gists{/gist_id}", "starred_url": "https://api.github.com/users/rogersayle/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rogersayle/subscriptions", "organizations_url": "https://api.github.com/users/rogersayle/orgs", "repos_url": "https://api.github.com/users/rogersayle/repos", "events_url": "https://api.github.com/users/rogersayle/events{/privacy}", "received_events_url": "https://api.github.com/users/rogersayle/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d54ce4641ed106666208be36fd514cae8ff1153c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d54ce4641ed106666208be36fd514cae8ff1153c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d54ce4641ed106666208be36fd514cae8ff1153c"}], "stats": {"total": 9, "additions": 7, "deletions": 2}, "files": [{"sha": "dc2d39a875122df7ff21083aabb90b8f3ca3b47a", "filename": "gcc/cp/parser.cc", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab72ec7c456c92989276f17fe0ae90a56932149/gcc%2Fcp%2Fparser.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab72ec7c456c92989276f17fe0ae90a56932149/gcc%2Fcp%2Fparser.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.cc?ref=8ab72ec7c456c92989276f17fe0ae90a56932149", "patch": "@@ -16148,8 +16148,9 @@ cp_parser_linkage_specification (cp_parser* parser, tree prefix_attr)\n   /* Transform the literal into an identifier.  If the literal is a\n      wide-character string, or contains embedded NULs, then we can't\n      handle it as the user wants.  */\n-  if (strlen (TREE_STRING_POINTER (linkage))\n-      != (size_t) (TREE_STRING_LENGTH (linkage) - 1))\n+  if (linkage == error_mark_node\n+      || strlen (TREE_STRING_POINTER (linkage))\n+\t != (size_t) (TREE_STRING_LENGTH (linkage) - 1))\n     {\n       cp_parser_error (parser, \"invalid linkage-specification\");\n       /* Assume C++ linkage.  */"}, {"sha": "36643228afb89346fd45a826bd107258da556942", "filename": "gcc/testsuite/g++.dg/template/pr96329.C", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8ab72ec7c456c92989276f17fe0ae90a56932149/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr96329.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8ab72ec7c456c92989276f17fe0ae90a56932149/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr96329.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Fpr96329.C?ref=8ab72ec7c456c92989276f17fe0ae90a56932149", "patch": "@@ -0,0 +1,4 @@\n+/* { dg-do compile } */\n+/* { dg-excess-errors \"\" } */\n+\n+extern \"C\" \"\"a"}]}