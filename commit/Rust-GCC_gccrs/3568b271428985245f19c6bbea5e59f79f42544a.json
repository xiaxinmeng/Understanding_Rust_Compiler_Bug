{"sha": "3568b271428985245f19c6bbea5e59f79f42544a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzU2OGIyNzE0Mjg5ODUyNDVmMTljNmJiZWE1ZTU5Zjc5ZjQyNTQ0YQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-20T09:38:27Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-20T09:38:27Z"}, "message": "[multiple changes]\n\n2009-04-20  Thomas Quinot  <quinot@adacore.com>\n\n\t* g-socket.ads: Add new constants:\n\t  Loopback_Inet_Addr\n\t  Unspecified_Group_Inet_Addr\n\t  All_Hosts_Group_Inet_Addr\n\t  All_Routers_Group_Inet_Addr\n\n\t* s-oscons-tmplt.c, g-sttsne-vxworks.adb (System.OS_Constants): Add\n\tERANGE (Result too large).\n\t(GNAT.Sockets.Thin.Task_Safe_NetDB, VxWorks version): Add missing\n\tpropagation of errno to caller.\n\n2009-04-20  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* a-calend.adb, a-calend-vms.adb: Increase the number of leap seconds\n\tto 24. Increment Leap_Seconds_Count and add an entry to aggregate\n\tLeap_Second_Times.\n\n2009-04-20  Vincent Celier  <celier@adacore.com>\n\n\t* mlib-prj.adb (Build_Library): Use the shared library linker, if one\n\thas been declared (Library_GCC or Linker'Driver), for the driver name.\n\n\t* prj-nmsc.adb (Process_Linker): If Library_GCC is not declared and\n\tLinker'Driver is, use Linker'Driver as the shared library linker.\n\t(Process_Project_Level_Simple_Attributes): Issue a warning if attribute\n\tLibrary_GCC is declared.\n\t(Check_Library_Attributes): Set up the shared linker driver: either\n\tLibrary_GCC or Linker'Driver. Issue a warning if Library_GCC is\n\tdeclared.\n\nFrom-SVN: r146386", "tree": {"sha": "eb7899588c7d92f99fa0ad64e72f96baad11fbfe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb7899588c7d92f99fa0ad64e72f96baad11fbfe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3568b271428985245f19c6bbea5e59f79f42544a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3568b271428985245f19c6bbea5e59f79f42544a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3568b271428985245f19c6bbea5e59f79f42544a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3568b271428985245f19c6bbea5e59f79f42544a/comments", "author": null, "committer": null, "parents": [{"sha": "16212e894ae04b6de4d10d6992c2eabe1d6866ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16212e894ae04b6de4d10d6992c2eabe1d6866ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16212e894ae04b6de4d10d6992c2eabe1d6866ac"}], "stats": {"total": 190, "additions": 164, "deletions": 26}, "files": [{"sha": "bcebd6e54ed34b11f4caf7f39f479d973e7da54f", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 61, "deletions": 0, "changes": 61, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -1,3 +1,64 @@\n+2009-04-20  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* g-socket.ads: Add new constants:\n+\t  Loopback_Inet_Addr\n+\t  Unspecified_Group_Inet_Addr\n+\t  All_Hosts_Group_Inet_Addr\n+\t  All_Routers_Group_Inet_Addr\n+\n+\t* s-oscons-tmplt.c, g-sttsne-vxworks.adb (System.OS_Constants): Add\n+\tERANGE (Result too large).\n+\t(GNAT.Sockets.Thin.Task_Safe_NetDB, VxWorks version): Add missing\n+\tpropagation of errno to caller.\n+\n+2009-04-20  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* a-calend.adb, a-calend-vms.adb: Increase the number of leap seconds\n+\tto 24. Increment Leap_Seconds_Count and add an entry to aggregate\n+\tLeap_Second_Times.\n+\n+2009-04-20  Gary Dismukes  <dismukes@adacore.com>\n+\n+\t* sem_elim.ads (Check_For_Eliminated_Subprogram): New procedure for\n+\tchecking for references to eliminated subprograms that should be\n+\tflagged.\n+\t(Eliminate_Error_Message): Update comment to say \"references\" rather\n+\tthan \"calls\" (since attribute cases are handled here as well).\n+\n+\t* sem_elim.adb (Check_For_Eliminated_Subprogram): New procedure for\n+\tchecking for references to eliminated subprograms that should be\n+\tflagged.  Add with and use of Sem and Sem_Util.\n+\n+\t* sem_res.adb (Resolve_Call): Reject calls to eliminated subprograms.\n+\tAdd with and use of Sem_Elim.\n+\n+\t* sem_attr.adb (Analyze_Access_Attribute): Reject access attributes\n+\tapplied to eliminated subprograms.\n+\t(Analyze_Attribute): Reject 'Address and 'Code_Address applied to\n+\teliminated subprograms.\n+\tAdd with and use of Sem_Elim.\n+\n+\t* sem_disp.adb (Check_Dispatching_Call): Remove error check for calls\n+\tto eliminated subprograms, now handled during Resolve_Call.\n+\tRemove with and use of Sem_Elim.\n+\n+\t* exp_disp.adb (Make_DT): Get Ultimate_Alias of primitive before\n+\ttesting Is_Eliminated, for proper handling of primitive derived from\n+\teliminated subprograms.\n+\n+2009-04-20  Vincent Celier  <celier@adacore.com>\n+\n+\t* mlib-prj.adb (Build_Library): Use the shared library linker, if one\n+\thas been declared (Library_GCC or Linker'Driver), for the driver name.\n+\n+\t* prj-nmsc.adb (Process_Linker): If Library_GCC is not declared and\n+\tLinker'Driver is, use Linker'Driver as the shared library linker.\n+\t(Process_Project_Level_Simple_Attributes): Issue a warning if attribute\n+\tLibrary_GCC is declared.\n+\t(Check_Library_Attributes): Set up the shared linker driver: either\n+\tLibrary_GCC or Linker'Driver. Issue a warning if Library_GCC is\n+\tdeclared.\n+\n 2009-04-20  Thomas Quinot  <quinot@adacore.com>\n \n \t* g-socket.ads (Send_Socket): Fix misleading comment."}, {"sha": "374ea715ff62700c51361fcaa87b5ab62738b95f", "filename": "gcc/ada/a-calend-vms.adb", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fa-calend-vms.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fa-calend-vms.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-calend-vms.adb?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -126,7 +126,7 @@ package body Ada.Calendar is\n    --  The above flag controls the usage of leap seconds in all Ada.Calendar\n    --  routines.\n \n-   Leap_Seconds_Count : constant Natural := 23;\n+   Leap_Seconds_Count : constant Natural := 24;\n \n    ---------------------\n    -- Local Constants --\n@@ -176,7 +176,8 @@ package body Ada.Calendar is\n       43271712190000000,\n       43744320200000000,\n       44218656210000000,\n-      46427904220000000);\n+      46427904220000000,\n+      47374848230000000);\n \n    ---------\n    -- \"+\" --"}, {"sha": "4c340eec0d19b247509d649028470bfc363be3c7", "filename": "gcc/ada/a-calend.adb", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fa-calend.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fa-calend.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fa-calend.adb?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -139,7 +139,7 @@ package body Ada.Calendar is\n    --  The above flag controls the usage of leap seconds in all Ada.Calendar\n    --  routines.\n \n-   Leap_Seconds_Count : constant Natural := 23;\n+   Leap_Seconds_Count : constant Natural := 24;\n \n    ---------------------\n    -- Local Constants --\n@@ -212,7 +212,8 @@ package body Ada.Calendar is\n       -4859827181000000000,\n       -4812566380000000000,\n       -4765132779000000000,\n-      -4544207978000000000);\n+      -4544207978000000000,\n+      -4449513577000000000);\n \n    ---------\n    -- \"+\" --"}, {"sha": "3680d751ff6ce8d32accafe4220093811bb5b0f8", "filename": "gcc/ada/g-socket.ads", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fg-socket.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fg-socket.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-socket.ads?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -491,6 +491,13 @@ package GNAT.Sockets is\n    Any_Inet_Addr       : constant Inet_Addr_Type;\n    No_Inet_Addr        : constant Inet_Addr_Type;\n    Broadcast_Inet_Addr : constant Inet_Addr_Type;\n+   Loopback_Inet_Addr  : constant Inet_Addr_Type;\n+\n+   --  Useful constants for IPv4 multicast addresses\n+\n+   Unspecified_Group_Inet_Addr : constant Inet_Addr_Type;\n+   All_Hosts_Group_Inet_Addr   : constant Inet_Addr_Type;\n+   All_Routers_Group_Inet_Addr : constant Inet_Addr_Type;\n \n    type Sock_Addr_Type (Family : Family_Type := Family_Inet) is record\n       Addr : Inet_Addr_Type (Family);\n@@ -1155,6 +1162,15 @@ private\n                            (Family_Inet, (others => 0));\n    Broadcast_Inet_Addr : constant Inet_Addr_Type :=\n                            (Family_Inet, (others => 255));\n+   Loopback_Inet_Addr  : constant Inet_Addr_Type :=\n+                           (Family_Inet, (127, 0, 0, 1));\n+\n+   Unspecified_Group_Inet_Addr : constant Inet_Addr_Type :=\n+                                   (Family_Inet, (224, 0, 0, 0));\n+   All_Hosts_Group_Inet_Addr   : constant Inet_Addr_Type :=\n+                                   (Family_Inet, (224, 0, 0, 1));\n+   All_Routers_Group_Inet_Addr : constant Inet_Addr_Type :=\n+                                   (Family_Inet, (224, 0, 0, 2));\n \n    No_Sock_Addr : constant Sock_Addr_Type := (Family_Inet, No_Inet_Addr, 0);\n "}, {"sha": "a91cd873c3bd516adb4d8a62ef574e2e86eb62dc", "filename": "gcc/ada/g-sttsne-vxworks.adb", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fg-sttsne-vxworks.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fg-sttsne-vxworks.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-sttsne-vxworks.adb?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -77,9 +77,6 @@ package body GNAT.Sockets.Thin.Task_Safe_NetDB is\n       pragma Import (Ada, Netdb_Data);\n       for Netdb_Data'Address use Buf;\n \n-      pragma Unreferenced (H_Errnop);\n-      --  VxWorks does not provide h_errno\n-\n    begin\n       pragma Assert (Addr_Type = SOSC.AF_INET);\n       pragma Assert (Addr_Len = In_Addr'Size / 8);\n@@ -88,13 +85,15 @@ package body GNAT.Sockets.Thin.Task_Safe_NetDB is\n       --  data we want to return.\n \n       if Netdb_Data'Size / 8 > Buflen then\n+         H_Errnop.all := SOSC.ERANGE;\n          return -1;\n       end if;\n \n       if VxWorks_hostGetByAddr (To_Pointer (Addr).all,\n                                 Netdb_Data.Name'Address)\n            /= SOSC.OK\n       then\n+         H_Errnop.all := C.int (Host_Errno);\n          return -1;\n       end if;\n \n@@ -130,12 +129,10 @@ package body GNAT.Sockets.Thin.Task_Safe_NetDB is\n \n       Addr : C.int;\n \n-      pragma Unreferenced (H_Errnop);\n-      --  VxWorks does not provide h_errno\n-\n    begin\n       Addr := VxWorks_hostGetByName (Name);\n       if Addr = SOSC.ERROR then\n+         H_Errnop.all := C.int (Host_Errno);\n          return -1;\n       end if;\n \n@@ -149,6 +146,7 @@ package body GNAT.Sockets.Thin.Task_Safe_NetDB is\n          --  data we want to return.\n \n          if Netdb_Data'Size / 8 > Buflen then\n+            H_Errnop.all := SOSC.ERANGE;\n             return -1;\n          end if;\n "}, {"sha": "3256bf754917b2989e57e05e816321d4f631aeaa", "filename": "gcc/ada/mlib-prj.adb", "status": "modified", "additions": 4, "deletions": 7, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fmlib-prj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fmlib-prj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-prj.adb?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -340,7 +340,6 @@ package body MLib.Prj is\n       Success : Boolean := False;\n \n       Library_Options : Variable_Value := Nil_Variable_Value;\n-      Library_GCC     : Variable_Value := Nil_Variable_Value;\n \n       Driver_Name : Name_Id := No_Name;\n \n@@ -1282,13 +1281,11 @@ package body MLib.Prj is\n \n       if Link then\n \n-         --  If attribute Library_GCC was specified, get the driver name\n+         --  If attributes Library_GCC or Linker'Driver were specified, get the\n+         --  driver name.\n \n-         Library_GCC :=\n-           Value_Of (Name_Library_GCC, Data.Decl.Attributes, In_Tree);\n-\n-         if not Library_GCC.Default then\n-            Driver_Name := Library_GCC.Value;\n+         if Data.Config.Shared_Lib_Driver /= No_File then\n+            Driver_Name := Name_Id (Data.Config.Shared_Lib_Driver);\n          end if;\n \n          --  If attribute Library_Options was specified, add these additional"}, {"sha": "158e75bc174a7096803c51751231c9c021890c78", "filename": "gcc/ada/prj-nmsc.adb", "status": "modified", "additions": 68, "deletions": 9, "changes": 77, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fprj-nmsc.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fprj-nmsc.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-nmsc.adb?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -1842,6 +1842,15 @@ package body Prj.Nmsc is\n                      Data.Config.Linker :=\n                        Path_Name_Type (Attribute.Value.Value);\n \n+                     --  Linker'Driver is also used to link shared libraries\n+                     --  if the obsolescent attribute Library_GCC has not been\n+                     --  specified.\n+\n+                     if Data.Config.Shared_Lib_Driver = No_File then\n+                        Data.Config.Shared_Lib_Driver :=\n+                          File_Name_Type (Attribute.Value.Value);\n+                     end if;\n+\n                   elsif Attribute.Name = Name_Required_Switches then\n \n                      --  Attribute Required_Switches: the minimum\n@@ -2067,6 +2076,12 @@ package body Prj.Nmsc is\n                elsif Attribute.Name = Name_Library_GCC then\n                   Data.Config.Shared_Lib_Driver :=\n                     File_Name_Type (Attribute.Value.Value);\n+                  Error_Msg\n+                    (Project,\n+                     In_Tree,\n+                     \"?Library_'G'C'C is an obsolescent attribute, \" &\n+                     \"use Linker''Driver instead\",\n+                     Attribute.Value.Location);\n \n                elsif Attribute.Name = Name_Archive_Suffix then\n                   Data.Config.Archive_Suffix :=\n@@ -3613,6 +3628,10 @@ package body Prj.Nmsc is\n                        Prj.Util.Value_Of\n                          (Snames.Name_Library_Ali_Dir, Attributes, In_Tree);\n \n+      Lib_GCC      : constant Prj.Variable_Value :=\n+                       Prj.Util.Value_Of\n+                         (Snames.Name_Library_GCC, Attributes, In_Tree);\n+\n       The_Lib_Kind : constant Prj.Variable_Value :=\n                        Prj.Util.Value_Of\n                          (Snames.Name_Library_Kind, Attributes, In_Tree);\n@@ -4205,15 +4224,55 @@ package body Prj.Nmsc is\n                      Write_Line (Kind_Name);\n                   end if;\n \n-                  if Data.Library_Kind /= Static and then\n-                    Support_For_Libraries = Prj.Static_Only\n-                  then\n-                     Error_Msg\n-                       (Project, In_Tree,\n-                        \"only static libraries are supported \" &\n-                        \"on this platform\",\n-                        The_Lib_Kind.Location);\n-                     Data.Library := False;\n+                  if Data.Library_Kind /= Static then\n+                     if Support_For_Libraries = Prj.Static_Only then\n+                        Error_Msg\n+                          (Project, In_Tree,\n+                           \"only static libraries are supported \" &\n+                           \"on this platform\",\n+                           The_Lib_Kind.Location);\n+                        Data.Library := False;\n+\n+                     else\n+                        --  Check if (obsolescent) attribute Library_GCC or\n+                        --  Linker'Driver is declared.\n+\n+                        if Lib_GCC.Value /= Empty_String then\n+                           Error_Msg\n+                             (Project,\n+                              In_Tree,\n+                              \"?Library_'G'C'C is an obsolescent attribute, \" &\n+                              \"use Linker''Driver instead\",\n+                              Lib_GCC.Location);\n+                           Data.Config.Shared_Lib_Driver :=\n+                             File_Name_Type (Lib_GCC.Value);\n+\n+                        else\n+                           declare\n+                              Linker : constant Package_Id :=\n+                                         Value_Of\n+                                           (Name_Linker,\n+                                            Data.Decl.Packages,\n+                                            In_Tree);\n+                              Driver : constant Variable_Value :=\n+                                         Value_Of\n+                                           (Name                    => No_Name,\n+                                            Attribute_Or_Array_Name =>\n+                                              Name_Driver,\n+                                            In_Package              => Linker,\n+                                            In_Tree                 =>\n+                                              In_Tree);\n+\n+                           begin\n+                              if Driver /= Nil_Variable_Value\n+                                 and then Driver.Value /= Empty_String\n+                              then\n+                                 Data.Config.Shared_Lib_Driver :=\n+                                   File_Name_Type (Driver.Value);\n+                              end if;\n+                           end;\n+                        end if;\n+                     end if;\n                   end if;\n                end;\n             end if;"}, {"sha": "be35f1b216d2b35593038c2457c25c80a5bd3c1c", "filename": "gcc/ada/s-oscons-tmplt.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fs-oscons-tmplt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3568b271428985245f19c6bbea5e59f79f42544a/gcc%2Fada%2Fs-oscons-tmplt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-oscons-tmplt.c?ref=3568b271428985245f19c6bbea5e59f79f42544a", "patch": "@@ -471,6 +471,11 @@ CND(EPROTONOSUPPORT, \"Unknown protocol\")\n #endif\n CND(EPROTOTYPE, \"Unknown protocol type\")\n \n+#ifndef ERANGE\n+# define ERANGE -1\n+#endif\n+CND(ERANGE, \"Result too large\")\n+\n #ifndef ESHUTDOWN\n # define ESHUTDOWN -1\n #endif"}]}