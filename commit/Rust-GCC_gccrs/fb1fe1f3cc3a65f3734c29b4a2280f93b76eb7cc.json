{"sha": "fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmIxZmUxZjNjYzNhNjVmMzczNGMyOWI0YTIyODBmOTNiNzZlYjdjYw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-10-10T13:26:15Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-10-10T13:26:15Z"}, "message": "tree-cfgcleanup.c (cleanup_tree_cfg_noloop): Avoid compacting blocks if SCEV is active.\n\n2017-10-10  Richard Biener  <rguenther@suse.de>\n\n\t* tree-cfgcleanup.c (cleanup_tree_cfg_noloop): Avoid compacting\n\tblocks if SCEV is active.\n\t* tree-scalar-evolution.c (analyze_scalar_evolution_1): Remove\n\tdead code.\n\t(analyze_scalar_evolution): Handle cached evolutions the obvious way.\n\t(scev_initialize): Assert we are not yet initialized.\n\nFrom-SVN: r253585", "tree": {"sha": "c387c0bcdedbd737377a25613d0f4a667268c75f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c387c0bcdedbd737377a25613d0f4a667268c75f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0c6ddd1ddeccd6982ddedd3a05ea4db4769b18d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0c6ddd1ddeccd6982ddedd3a05ea4db4769b18d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0c6ddd1ddeccd6982ddedd3a05ea4db4769b18d5"}], "stats": {"total": 38, "additions": 23, "deletions": 15}, "files": [{"sha": "f7f41ed3358f29a7cd20dd4ff8055727c6e2fd2b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "patch": "@@ -1,3 +1,12 @@\n+2017-10-10  Richard Biener  <rguenther@suse.de>\n+\n+\t* tree-cfgcleanup.c (cleanup_tree_cfg_noloop): Avoid compacting\n+\tblocks if SCEV is active.\n+\t* tree-scalar-evolution.c (analyze_scalar_evolution_1): Remove\n+\tdead code.\n+\t(analyze_scalar_evolution): Handle cached evolutions the obvious way.\n+\t(scev_initialize): Assert we are not yet initialized.\n+\n 2017-10-10  Bin Cheng  <bin.cheng@arm.com>\n \n \t* tree-loop-distribution.c (generate_loops_for_partition): Remove"}, {"sha": "1a71c93aeedc439652ae5d3de83f7507e6163762", "filename": "gcc/tree-cfgcleanup.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/gcc%2Ftree-cfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/gcc%2Ftree-cfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfgcleanup.c?ref=fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "patch": "@@ -892,7 +892,11 @@ cleanup_tree_cfg_noloop (void)\n   changed |= cleanup_tree_cfg_1 ();\n \n   gcc_assert (dom_info_available_p (CDI_DOMINATORS));\n-  compact_blocks ();\n+\n+  /* Do not renumber blocks if the SCEV cache is active, it is indexed by\n+     basic-block numbers.  */\n+  if (! scev_initialized_p ())\n+    compact_blocks ();\n \n   checking_verify_flow_info ();\n "}, {"sha": "cdf940a38745430e2e405b173990907f1e6e2ca5", "filename": "gcc/tree-scalar-evolution.c", "status": "modified", "additions": 9, "deletions": 14, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/gcc%2Ftree-scalar-evolution.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc/gcc%2Ftree-scalar-evolution.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-scalar-evolution.c?ref=fb1fe1f3cc3a65f3734c29b4a2280f93b76eb7cc", "patch": "@@ -281,7 +281,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree-ssa-propagate.h\"\n #include \"gimple-fold.h\"\n \n-static tree analyze_scalar_evolution_1 (struct loop *, tree, tree);\n+static tree analyze_scalar_evolution_1 (struct loop *, tree);\n static tree analyze_scalar_evolution_for_address_of (struct loop *loop,\n \t\t\t\t\t\t     tree var);\n \n@@ -2036,18 +2036,19 @@ compute_scalar_evolution_in_loop (struct loop *wrto_loop,\n   if (no_evolution_in_loop_p (res, wrto_loop->num, &val) && val)\n     return res;\n \n-  return analyze_scalar_evolution_1 (wrto_loop, res, chrec_not_analyzed_yet);\n+  return analyze_scalar_evolution_1 (wrto_loop, res);\n }\n \n /* Helper recursive function.  */\n \n static tree\n-analyze_scalar_evolution_1 (struct loop *loop, tree var, tree res)\n+analyze_scalar_evolution_1 (struct loop *loop, tree var)\n {\n   tree type = TREE_TYPE (var);\n   gimple *def;\n   basic_block bb;\n   struct loop *def_loop;\n+  tree res;\n \n   if (loop == NULL\n       || TREE_CODE (type) == VECTOR_TYPE\n@@ -2069,18 +2070,9 @@ analyze_scalar_evolution_1 (struct loop *loop, tree var, tree res)\n       goto set_and_end;\n     }\n \n-  if (res != chrec_not_analyzed_yet)\n-    {\n-      if (loop != bb->loop_father)\n-\tres = compute_scalar_evolution_in_loop\n-\t    (find_common_loop (loop, bb->loop_father), bb->loop_father, res);\n-\n-      goto set_and_end;\n-    }\n-\n   if (loop != def_loop)\n     {\n-      res = analyze_scalar_evolution_1 (def_loop, var, chrec_not_analyzed_yet);\n+      res = analyze_scalar_evolution_1 (def_loop, var);\n       res = compute_scalar_evolution_in_loop (loop, def_loop, res);\n \n       goto set_and_end;\n@@ -2144,7 +2136,8 @@ analyze_scalar_evolution (struct loop *loop, tree var)\n     }\n \n   res = get_scalar_evolution (block_before_loop (loop), var);\n-  res = analyze_scalar_evolution_1 (loop, var, res);\n+  if (res == chrec_not_analyzed_yet)\n+    res = analyze_scalar_evolution_1 (loop, var);\n \n   if (dump_file && (dump_flags & TDF_SCEV))\n     fprintf (dump_file, \")\\n\");\n@@ -3264,6 +3257,8 @@ scev_initialize (void)\n {\n   struct loop *loop;\n \n+  gcc_assert (! scev_initialized_p ());\n+\n   scalar_evolution_info = hash_table<scev_info_hasher>::create_ggc (100);\n \n   initialize_scalar_evolutions_analyzer ();"}]}