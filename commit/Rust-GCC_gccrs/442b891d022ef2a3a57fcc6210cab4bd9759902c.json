{"sha": "442b891d022ef2a3a57fcc6210cab4bd9759902c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDQyYjg5MWQwMjJlZjJhM2E1N2ZjYzYyMTBjYWI0YmQ5NzU5OTAyYw==", "commit": {"author": {"name": "Revital Eres", "email": "revital.eres@linaro.org", "date": "2011-09-30T13:10:56Z"}, "committer": {"name": "Revital Eres", "email": "revitale@gcc.gnu.org", "date": "2011-09-30T13:10:56Z"}, "message": "SMS: Avoid generating redundant reg-moves\n\nFrom-SVN: r179380", "tree": {"sha": "24e675ed3ce342877a15ea45c250d0032fc8eed0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/24e675ed3ce342877a15ea45c250d0032fc8eed0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/442b891d022ef2a3a57fcc6210cab4bd9759902c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/442b891d022ef2a3a57fcc6210cab4bd9759902c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/442b891d022ef2a3a57fcc6210cab4bd9759902c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/442b891d022ef2a3a57fcc6210cab4bd9759902c/comments", "author": null, "committer": null, "parents": [{"sha": "f27a3d372a48c2f3ef8e256a61020f23fa8b57d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f27a3d372a48c2f3ef8e256a61020f23fa8b57d9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f27a3d372a48c2f3ef8e256a61020f23fa8b57d9"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "b0756d0683740cf04ba0020b2222fa634b3e83a2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/442b891d022ef2a3a57fcc6210cab4bd9759902c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/442b891d022ef2a3a57fcc6210cab4bd9759902c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=442b891d022ef2a3a57fcc6210cab4bd9759902c", "patch": "@@ -1,3 +1,9 @@\n+2011-09-30  Revital Eres  <revital.eres@linaro.org>\n+\n+\t* modulo-sched.c (generate_reg_moves): Skip instructions that\n+\tdo not set a register and verify no regmoves are created for\n+\t!single_set instructions.\n+\n 2011-09-30  Bernd Schmidt  <bernds@codesourcery.com>\n \n \t* hw-doloop.c (scan_loop): Compute register usage only for non-debug"}, {"sha": "7c33be54bb5d7f0fd5498b949ac1757d6f909cbf", "filename": "gcc/modulo-sched.c", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/442b891d022ef2a3a57fcc6210cab4bd9759902c/gcc%2Fmodulo-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/442b891d022ef2a3a57fcc6210cab4bd9759902c/gcc%2Fmodulo-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmodulo-sched.c?ref=442b891d022ef2a3a57fcc6210cab4bd9759902c", "patch": "@@ -476,7 +476,12 @@ generate_reg_moves (partial_schedule_ptr ps, bool rescan)\n       sbitmap *uses_of_defs;\n       rtx last_reg_move;\n       rtx prev_reg, old_reg;\n-\n+      rtx set = single_set (u->insn);\n+      \n+      /* Skip instructions that do not set a register.  */\n+      if ((set && !REG_P (SET_DEST (set))))\n+        continue;\n+ \n       /* Compute the number of reg_moves needed for u, by looking at life\n \t ranges started at u (excluding self-loops).  */\n       for (e = u->out; e; e = e->next_out)\n@@ -493,6 +498,16 @@ generate_reg_moves (partial_schedule_ptr ps, bool rescan)\n \t\t&& SCHED_COLUMN (e->dest) < SCHED_COLUMN (e->src))\n \t      nreg_moves4e--;\n \n+            if (nreg_moves4e >= 1)\n+\t      {\n+\t\t/* !single_set instructions are not supported yet and\n+\t\t   thus we do not except to encounter them in the loop\n+\t\t   except from the doloop part.  For the latter case\n+\t\t   we assume no regmoves are generated as the doloop\n+\t\t   instructions are tied to the branch with an edge.  */\n+\t\tgcc_assert (set);\n+\t      }\n+\t    \n \t    nreg_moves = MAX (nreg_moves, nreg_moves4e);\n \t  }\n "}]}