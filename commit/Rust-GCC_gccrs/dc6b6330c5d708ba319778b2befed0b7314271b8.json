{"sha": "dc6b6330c5d708ba319778b2befed0b7314271b8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM2YjYzMzBjNWQ3MDhiYTMxOTc3OGIyYmVmZWQwYjczMTQyNzFiOA==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2018-10-24T11:27:35Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2018-10-24T11:27:35Z"}, "message": "Disable string merging with alignment > 1 before Solaris 11.4/SPARC\n\n\t* configure.ac (gcc_cv_ld_aligned_shf_merge): New test.\n\t* configure: Regenerate.\n\t* config.in: Regenerate.\n\t* varasm.c (mergeable_string_section): Use readonly_data_section\n\tif linker doesn't support SHF_MERGE with alignment > 8.\n\t(mergeable_constant_section): Likewise.\n\nFrom-SVN: r265456", "tree": {"sha": "9ac6e997fc7dddbff9a6f78b9fd4c4e4b7715b61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9ac6e997fc7dddbff9a6f78b9fd4c4e4b7715b61"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc6b6330c5d708ba319778b2befed0b7314271b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc6b6330c5d708ba319778b2befed0b7314271b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc6b6330c5d708ba319778b2befed0b7314271b8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc6b6330c5d708ba319778b2befed0b7314271b8/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "53b8a7107e6c6a774d5e69b8fd5ce46e94c35adb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/53b8a7107e6c6a774d5e69b8fd5ce46e94c35adb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/53b8a7107e6c6a774d5e69b8fd5ce46e94c35adb"}], "stats": {"total": 79, "additions": 69, "deletions": 10}, "files": [{"sha": "55ac3b99e2c5da9a6fc3d6928ec37e0953662d0a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dc6b6330c5d708ba319778b2befed0b7314271b8", "patch": "@@ -1,3 +1,12 @@\n+2018-10-24  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* configure.ac (gcc_cv_ld_aligned_shf_merge): New test.\n+\t* configure: Regenerate.\n+\t* config.in: Regenerate.\n+\t* varasm.c (mergeable_string_section): Use readonly_data_section\n+\tif linker doesn't support SHF_MERGE with alignment > 8.\n+\t(mergeable_constant_section): Likewise.\n+\n 2018-10-24  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/84013"}, {"sha": "7116579c5126a344b104eb7a3977f01eb346c68d", "filename": "gcc/config.in", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=dc6b6330c5d708ba319778b2befed0b7314271b8", "patch": "@@ -55,8 +55,7 @@\n #endif\n \n \n-/* Define to larger than zero set to the default stack clash protector size as\n-   a power of two in bytes. */\n+/* Define to larger than zero set the default stack clash protector size. */\n #ifndef USED_FOR_TARGET\n #undef DEFAULT_STK_CLASH_GUARD_SIZE\n #endif\n@@ -1430,6 +1429,13 @@\n #endif\n \n \n+/* Define 0/1 if your linker supports the SHF_MERGE flag with section\n+   alignment > 1. */\n+#ifndef USED_FOR_TARGET\n+#undef HAVE_LD_ALIGNED_SHF_MERGE\n+#endif\n+\n+\n /* Define if your linker supports --as-needed/--no-as-needed or equivalent\n    options. */\n #ifndef USED_FOR_TARGET\n@@ -1993,13 +1999,7 @@\n #endif\n \n \n-/* Define if we should link with --large-address-aware by default */\n-#ifndef USED_FOR_TARGET\n-#undef MINGW_DEFAULT_LARGE_ADDR_AWARE\n-#endif\n-\n-\n-/* Define if we should link with --large-address-aware by default */\n+/* Define if we should link mingw executables with --large-address-aware */\n #ifndef USED_FOR_TARGET\n #undef MINGW_DEFAULT_LARGE_ADDR_AWARE\n #endif"}, {"sha": "c49b4b264e8389fff5de5502c003f32131d10e97", "filename": "gcc/configure", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=dc6b6330c5d708ba319778b2befed0b7314271b8", "patch": "@@ -23739,6 +23739,30 @@ cat >>confdefs.h <<_ACEOF\n _ACEOF\n \n \n+gcc_cv_ld_aligned_shf_merge=yes\n+case \"$target\" in\n+  # While Solaris 10/SPARC ld isn't affected, disable to avoid problems\n+  # relinking on Solaris 11 < 11.4.\n+  sparc*-*-solaris2.10*)\n+    if test x\"$gnu_ld\" = xno; then\n+      gcc_cv_ld_aligned_shf_merge=no\n+    fi\n+    ;;\n+  # SHF_MERGE support is broken in Solaris ld up to Solaris 11.3/SPARC for\n+  # alignment > 1.\n+  sparc*-*-solaris2.11*)\n+    if test x\"$gnu_ld\" = xno \\\n+       && test \"$ld_vers_major\" -lt 2 && test \"$ld_vers_minor\" -lt 3159; then\n+      gcc_cv_ld_aligned_shf_merge=no\n+    fi\n+    ;;\n+esac\n+\n+cat >>confdefs.h <<_ACEOF\n+#define HAVE_LD_ALIGNED_SHF_MERGE `if test $gcc_cv_ld_aligned_shf_merge = yes; then echo 1; else echo 0; fi`\n+_ACEOF\n+\n+\n { $as_echo \"$as_me:${as_lineno-$LINENO}: checking assembler for stabs directive\" >&5\n $as_echo_n \"checking assembler for stabs directive... \" >&6; }\n if test \"${gcc_cv_as_stabs_directive+set}\" = set; then :"}, {"sha": "f43af0b8d204aef971d3e5c38fd91af0f8595f98", "filename": "gcc/configure.ac", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=dc6b6330c5d708ba319778b2befed0b7314271b8", "patch": "@@ -3039,6 +3039,28 @@ AC_DEFINE_UNQUOTED(HAVE_GAS_SHF_MERGE,\n   [`if test $gcc_cv_as_shf_merge = yes; then echo 1; else echo 0; fi`],\n [Define 0/1 if your assembler supports marking sections with SHF_MERGE flag.])\n \n+gcc_cv_ld_aligned_shf_merge=yes\n+case \"$target\" in\n+  # While Solaris 10/SPARC ld isn't affected, disable to avoid problems\n+  # relinking on Solaris 11 < 11.4.\n+  sparc*-*-solaris2.10*)\n+    if test x\"$gnu_ld\" = xno; then\n+      gcc_cv_ld_aligned_shf_merge=no\n+    fi\n+    ;;\n+  # SHF_MERGE support is broken in Solaris ld up to Solaris 11.3/SPARC for\n+  # alignment > 1.\n+  sparc*-*-solaris2.11*)\n+    if test x\"$gnu_ld\" = xno \\\n+       && test \"$ld_vers_major\" -lt 2 && test \"$ld_vers_minor\" -lt 3159; then\n+      gcc_cv_ld_aligned_shf_merge=no\n+    fi\n+    ;;\n+esac\n+AC_DEFINE_UNQUOTED(HAVE_LD_ALIGNED_SHF_MERGE,\n+  [`if test $gcc_cv_ld_aligned_shf_merge = yes; then echo 1; else echo 0; fi`],\n+[Define 0/1 if your linker supports the SHF_MERGE flag with section alignment > 1.])\n+\n gcc_GAS_CHECK_FEATURE([stabs directive], gcc_cv_as_stabs_directive, ,,\n [.stabs \"gcc2_compiled.\",60,0,0,0],,\n [AC_DEFINE(HAVE_AS_STABS_DIRECTIVE, 1,"}, {"sha": "06f41d002fd120e327c2667a083e622e7b47ba67", "filename": "gcc/varasm.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc6b6330c5d708ba319778b2befed0b7314271b8/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=dc6b6330c5d708ba319778b2befed0b7314271b8", "patch": "@@ -823,6 +823,9 @@ mergeable_string_section (tree decl ATTRIBUTE_UNUSED,\n \t  if (align < modesize)\n \t    align = modesize;\n \n+\t  if (!HAVE_LD_ALIGNED_SHF_MERGE && align > 8)\n+\t    return readonly_data_section;\n+\n \t  str = TREE_STRING_POINTER (decl);\n \t  unit = GET_MODE_SIZE (mode);\n \n@@ -861,7 +864,8 @@ mergeable_constant_section (machine_mode mode ATTRIBUTE_UNUSED,\n       && known_le (GET_MODE_BITSIZE (mode), align)\n       && align >= 8\n       && align <= 256\n-      && (align & (align - 1)) == 0)\n+      && (align & (align - 1)) == 0\n+      && (HAVE_LD_ALIGNED_SHF_MERGE ? 1 : align == 8))\n     {\n       const char *prefix = function_mergeable_rodata_prefix ();\n       char *name = (char *) alloca (strlen (prefix) + 30);"}]}