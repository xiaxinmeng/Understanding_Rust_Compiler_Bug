{"sha": "8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGRjODc3ZWJjNDA1OTM3YzcwMjZmOGZhNzYzMmIyM2UxZjZlYmNjYg==", "commit": {"author": {"name": "Rainer Orth", "email": "ro@CeBiTec.Uni-Bielefeld.DE", "date": "2017-06-22T06:54:04Z"}, "committer": {"name": "Rainer Orth", "email": "ro@gcc.gnu.org", "date": "2017-06-22T06:54:04Z"}, "message": "Support --sysroot with Solaris ld\n\n\t* configure.ac (gcc_cv_ld_static_dynamic): Also check stderr for\n\t$gcc_cv_ld --help output.\n\t(gcc_cv_ld_demangle): Likewise.\n\t(gcc_cv_ld_eh_frame_hdr): Likewise.\n\t(gcc_cv_ld_pie): Likewise.\n\t(gcc_cv_ld_as_needed): Likewise.  Prefer native forms unless $gnu_ld.\n\t(gcc_cv_ld_buildid): Likewise.\n\t(gcc_cv_ld_sysroot): Likewise.\n\t(ld_bndplt_support): Likewise.\n\t(ld_pushpopstate_support): Likewise.\n\t* configure: Regenerate.\n\t* config/sol2.h [!USE_GLD] (SYSROOT_SPEC): Define.\n\nFrom-SVN: r249496", "tree": {"sha": "bdecf810e54179f0df4a028886bef5312a1a2078", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bdecf810e54179f0df4a028886bef5312a1a2078"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/comments", "author": {"login": "rorth", "id": 3930951, "node_id": "MDQ6VXNlcjM5MzA5NTE=", "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rorth", "html_url": "https://github.com/rorth", "followers_url": "https://api.github.com/users/rorth/followers", "following_url": "https://api.github.com/users/rorth/following{/other_user}", "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rorth/subscriptions", "organizations_url": "https://api.github.com/users/rorth/orgs", "repos_url": "https://api.github.com/users/rorth/repos", "events_url": "https://api.github.com/users/rorth/events{/privacy}", "received_events_url": "https://api.github.com/users/rorth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c83c219a6359e2ab655e7b8a7fabe829fd7bc6b9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c83c219a6359e2ab655e7b8a7fabe829fd7bc6b9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c83c219a6359e2ab655e7b8a7fabe829fd7bc6b9"}], "stats": {"total": 108, "additions": 64, "deletions": 44}, "files": [{"sha": "c056ae4609bfb1b99bfa749060799868485aea35", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "patch": "@@ -1,3 +1,18 @@\n+2017-06-22  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n+\n+\t* configure.ac (gcc_cv_ld_static_dynamic): Also check stderr for\n+\t$gcc_cv_ld --help output.\n+\t(gcc_cv_ld_demangle): Likewise.\n+\t(gcc_cv_ld_eh_frame_hdr): Likewise.\n+\t(gcc_cv_ld_pie): Likewise.\n+\t(gcc_cv_ld_as_needed): Likewise.  Prefer native forms unless $gnu_ld.\n+\t(gcc_cv_ld_buildid): Likewise.\n+\t(gcc_cv_ld_sysroot): Likewise.\n+\t(ld_bndplt_support): Likewise.\n+\t(ld_pushpopstate_support): Likewise.\n+\t* configure: Regenerate.\n+\t* config/sol2.h [!USE_GLD] (SYSROOT_SPEC): Define.\n+\n 2017-06-21  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/81151"}, {"sha": "b8398d082a93cdbc92d8280044e2ed9f347ad741", "filename": "gcc/config/sol2.h", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2Fconfig%2Fsol2.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2Fconfig%2Fsol2.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsol2.h?ref=8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "patch": "@@ -330,6 +330,11 @@ along with GCC; see the file COPYING3.  If not see\n #define RDYNAMIC_SPEC \"--export-dynamic\"\n #endif\n \n+#ifndef USE_GLD\n+/* Prefer native form with Solaris ld.  */\n+#define SYSROOT_SPEC \"-z sysroot=%R\"\n+#endif\n+\n #ifndef USE_GLD\n /* With Sun ld, use mapfile to enforce direct binding to libgcc_s unwinder.  */\n #define LINK_LIBGCC_MAPFILE_SPEC \\"}, {"sha": "317517c1ab0247c7d546bb5b1f1a01987f935005", "filename": "gcc/configure", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "patch": "@@ -24372,8 +24372,8 @@ if test $in_tree_ld = yes ; then\n   fi\n elif test x$gcc_cv_ld != x; then\n   # Check if linker supports -Bstatic/-Bdynamic option\n-  if $gcc_cv_ld --help 2>/dev/null | grep -- -Bstatic > /dev/null \\\n-     && $gcc_cv_ld --help 2>/dev/null | grep -- -Bdynamic > /dev/null; then\n+  if $gcc_cv_ld --help 2>&1 | grep -- -Bstatic > /dev/null \\\n+     && $gcc_cv_ld --help 2>&1 | grep -- -Bdynamic > /dev/null; then\n       gcc_cv_ld_static_dynamic=yes\n   else\n     case \"$target\" in\n@@ -24426,7 +24426,7 @@ $as_echo_n \"checking linker --demangle support... \" >&6; }\n     fi\n   elif test x$gcc_cv_ld != x -a x\"$gnu_ld\" = xyes; then\n     # Check if the GNU linker supports --demangle option\n-    if $gcc_cv_ld --help 2>/dev/null | grep no-demangle > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep no-demangle > /dev/null; then\n       gcc_cv_ld_demangle=yes\n     fi\n   fi\n@@ -28058,7 +28058,7 @@ if test $in_tree_ld = yes ; then\n elif test x$gcc_cv_ld != x; then\n   if echo \"$ld_ver\" | grep GNU > /dev/null; then\n     # Check if linker supports --eh-frame-hdr option\n-    if $gcc_cv_ld --help 2>/dev/null | grep eh-frame-hdr > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep eh-frame-hdr > /dev/null; then\n       gcc_cv_ld_eh_frame_hdr=yes\n     fi\n   else\n@@ -28136,7 +28136,7 @@ if test $in_tree_ld = yes ; then\n   fi\n elif test x$gcc_cv_ld != x; then\n   # Check if linker supports -pie option\n-  if $gcc_cv_ld --help 2>/dev/null | grep -- -pie > /dev/null; then\n+  if $gcc_cv_ld --help 2>&1 | grep -- -pie > /dev/null; then\n     gcc_cv_ld_pie=yes\n     case \"$target\" in\n       *-*-solaris2*)\n@@ -28493,19 +28493,19 @@ if test $in_tree_ld = yes ; then\n     gcc_cv_ld_as_needed=yes\n   fi\n elif test x$gcc_cv_ld != x; then\n-\t# Check if linker supports --as-needed and --no-as-needed options\n-\tif $gcc_cv_ld --help 2>/dev/null | grep as-needed > /dev/null; then\n-\t\tgcc_cv_ld_as_needed=yes\n-\telse\n-\t  case \"$target\" in\n-\t    # Solaris 2 ld always supports -z ignore/-z record.\n-\t    *-*-solaris2*)\n-\t      gcc_cv_ld_as_needed=yes\n-\t      gcc_cv_ld_as_needed_option=\"-z ignore\"\n-\t      gcc_cv_ld_no_as_needed_option=\"-z record\"\n-\t      ;;\n-\t  esac\n-\tfi\n+  # Check if linker supports --as-needed and --no-as-needed options\n+  if $gcc_cv_ld --help 2>&1 | grep as-needed > /dev/null; then\n+    gcc_cv_ld_as_needed=yes\n+  fi\n+  case \"$target:$gnu_ld\" in\n+    *-*-solaris2*:no)\n+      # Solaris 2 ld always supports -z ignore/-z record.  Prefer the native\n+      # forms.\n+      gcc_cv_ld_as_needed=yes\n+      gcc_cv_ld_as_needed_option=\"-z ignore\"\n+      gcc_cv_ld_no_as_needed_option=\"-z record\"\n+      ;;\n+  esac\n fi\n # --as-needed/-z ignore can only be used if libgcc_s.so.1 uses\n # dl_iterate_phdr, i.e. since Solaris 11.\n@@ -28808,7 +28808,7 @@ else\n       gcc_cv_ld_buildid=yes\n     fi\n   elif test x$gcc_cv_ld != x; then\n-    if $gcc_cv_ld --help 2>/dev/null | grep build-id > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep build-id > /dev/null; then\n       gcc_cv_ld_buildid=yes\n     fi\n   fi\n@@ -28881,7 +28881,7 @@ else\n         gcc_cv_ld_sysroot=yes\n       fi\n   elif test x$gcc_cv_ld != x; then\n-    if $gcc_cv_ld --help 2>/dev/null | grep sysroot > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep sysroot > /dev/null; then\n       gcc_cv_ld_sysroot=yes\n     fi\n   fi\n@@ -29857,7 +29857,7 @@ if test x\"$ld_is_gold\" = xno; then\n     fi\n   elif test x$gcc_cv_ld != x; then\n     # Check if linker supports -a bndplt option\n-    if $gcc_cv_ld --help 2>/dev/null | grep -- '-z bndplt' > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep -- '-z bndplt' > /dev/null; then\n       ld_bndplt_support=yes\n     fi\n   fi\n@@ -29881,7 +29881,7 @@ if test x\"$ld_is_gold\" = xno; then\n     fi\n   elif test x$gcc_cv_ld != x; then\n     # Check if linker supports --push-state/--pop-state options\n-    if $gcc_cv_ld --help 2>/dev/null | grep -- '--push-state' > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep -- '--push-state' > /dev/null; then\n       ld_pushpopstate_support=yes\n     fi\n   fi"}, {"sha": "e1b03a9ac96a4363407a4a82feaaffceea1e055c", "filename": "gcc/configure.ac", "status": "modified", "additions": 22, "deletions": 22, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8dc877ebc405937c7026f8fa7632b23e1f6ebccb/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=8dc877ebc405937c7026f8fa7632b23e1f6ebccb", "patch": "@@ -3569,8 +3569,8 @@ if test $in_tree_ld = yes ; then\n   fi\n elif test x$gcc_cv_ld != x; then\n   # Check if linker supports -Bstatic/-Bdynamic option\n-  if $gcc_cv_ld --help 2>/dev/null | grep -- -Bstatic > /dev/null \\\n-     && $gcc_cv_ld --help 2>/dev/null | grep -- -Bdynamic > /dev/null; then\n+  if $gcc_cv_ld --help 2>&1 | grep -- -Bstatic > /dev/null \\\n+     && $gcc_cv_ld --help 2>&1 | grep -- -Bdynamic > /dev/null; then\n       gcc_cv_ld_static_dynamic=yes\n   else\n     case \"$target\" in\n@@ -3614,7 +3614,7 @@ if test x\"$demangler_in_ld\" = xyes; then\n     fi\n   elif test x$gcc_cv_ld != x -a x\"$gnu_ld\" = xyes; then\n     # Check if the GNU linker supports --demangle option\n-    if $gcc_cv_ld --help 2>/dev/null | grep no-demangle > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep no-demangle > /dev/null; then\n       gcc_cv_ld_demangle=yes\n     fi\n   fi\n@@ -4985,7 +4985,7 @@ if test $in_tree_ld = yes ; then\n elif test x$gcc_cv_ld != x; then\n   if echo \"$ld_ver\" | grep GNU > /dev/null; then\n     # Check if linker supports --eh-frame-hdr option\n-    if $gcc_cv_ld --help 2>/dev/null | grep eh-frame-hdr > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep eh-frame-hdr > /dev/null; then\n       gcc_cv_ld_eh_frame_hdr=yes\n     fi\n   else\n@@ -5056,7 +5056,7 @@ if test $in_tree_ld = yes ; then\n   fi\n elif test x$gcc_cv_ld != x; then\n   # Check if linker supports -pie option\n-  if $gcc_cv_ld --help 2>/dev/null | grep -- -pie > /dev/null; then\n+  if $gcc_cv_ld --help 2>&1 | grep -- -pie > /dev/null; then\n     gcc_cv_ld_pie=yes\n     case \"$target\" in\n       *-*-solaris2*)\n@@ -5382,19 +5382,19 @@ if test $in_tree_ld = yes ; then\n     gcc_cv_ld_as_needed=yes\n   fi\n elif test x$gcc_cv_ld != x; then\n-\t# Check if linker supports --as-needed and --no-as-needed options\n-\tif $gcc_cv_ld --help 2>/dev/null | grep as-needed > /dev/null; then\n-\t\tgcc_cv_ld_as_needed=yes\n-\telse\n-\t  case \"$target\" in\n-\t    # Solaris 2 ld always supports -z ignore/-z record.\n-\t    *-*-solaris2*)\n-\t      gcc_cv_ld_as_needed=yes\n-\t      gcc_cv_ld_as_needed_option=\"-z ignore\"\n-\t      gcc_cv_ld_no_as_needed_option=\"-z record\"\n-\t      ;;\n-\t  esac\n-\tfi\n+  # Check if linker supports --as-needed and --no-as-needed options\n+  if $gcc_cv_ld --help 2>&1 | grep as-needed > /dev/null; then\n+    gcc_cv_ld_as_needed=yes\n+  fi\n+  case \"$target:$gnu_ld\" in\n+    *-*-solaris2*:no)\n+      # Solaris 2 ld always supports -z ignore/-z record.  Prefer the native\n+      # forms.\n+      gcc_cv_ld_as_needed=yes\n+      gcc_cv_ld_as_needed_option=\"-z ignore\"\n+      gcc_cv_ld_no_as_needed_option=\"-z record\"\n+      ;;\n+  esac\n fi\n # --as-needed/-z ignore can only be used if libgcc_s.so.1 uses\n # dl_iterate_phdr, i.e. since Solaris 11.\n@@ -5634,7 +5634,7 @@ AC_CACHE_CHECK(linker --build-id support,\n       gcc_cv_ld_buildid=yes\n     fi\n   elif test x$gcc_cv_ld != x; then\n-    if $gcc_cv_ld --help 2>/dev/null | grep build-id > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep build-id > /dev/null; then\n       gcc_cv_ld_buildid=yes\n     fi\n   fi])\n@@ -5689,7 +5689,7 @@ AC_CACHE_CHECK(linker --sysroot support,\n         gcc_cv_ld_sysroot=yes\n       fi\n   elif test x$gcc_cv_ld != x; then \n-    if $gcc_cv_ld --help 2>/dev/null | grep sysroot > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep sysroot > /dev/null; then\n       gcc_cv_ld_sysroot=yes\n     fi\n   fi])\n@@ -6363,7 +6363,7 @@ if test x\"$ld_is_gold\" = xno; then\n     fi\n   elif test x$gcc_cv_ld != x; then\n     # Check if linker supports -a bndplt option\n-    if $gcc_cv_ld --help 2>/dev/null | grep -- '-z bndplt' > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep -- '-z bndplt' > /dev/null; then\n       ld_bndplt_support=yes\n     fi\n   fi\n@@ -6384,7 +6384,7 @@ if test x\"$ld_is_gold\" = xno; then\n     fi\n   elif test x$gcc_cv_ld != x; then\n     # Check if linker supports --push-state/--pop-state options\n-    if $gcc_cv_ld --help 2>/dev/null | grep -- '--push-state' > /dev/null; then\n+    if $gcc_cv_ld --help 2>&1 | grep -- '--push-state' > /dev/null; then\n       ld_pushpopstate_support=yes\n     fi\n   fi"}]}