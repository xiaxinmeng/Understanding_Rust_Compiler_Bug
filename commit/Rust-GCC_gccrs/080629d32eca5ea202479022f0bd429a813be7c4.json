{"sha": "080629d32eca5ea202479022f0bd429a813be7c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDgwNjI5ZDMyZWNhNWVhMjAyNDc5MDIyZjBiZDQyOWE4MTNiZTdjNA==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2019-05-06T07:35:59Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2019-05-06T07:35:59Z"}, "message": "Error only when a non-default -mabi is used with sanitizers (PR sanitizer/90312).\n\n2019-05-06  Martin Liska  <mliska@suse.cz>\n\n\tPR sanitizer/90312\n\t* config/i386/i386-options.c (ix86_option_override_internal): Error only\n\twhen -mabi is selected to a non-default version.\n2019-05-06  Martin Liska  <mliska@suse.cz>\n\n\tPR sanitizer/90312\n\t* gcc.dg/asan/pr87930.c: Run the test only on *linux or *gnu\n\tsystems.\n\t* gcc.dg/tsan/pr88017.c: Likewise.\n\nFrom-SVN: r270899", "tree": {"sha": "d685a6e391fe2a44edd6a81bc75ae1bc0276ca7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d685a6e391fe2a44edd6a81bc75ae1bc0276ca7b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/080629d32eca5ea202479022f0bd429a813be7c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/080629d32eca5ea202479022f0bd429a813be7c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/080629d32eca5ea202479022f0bd429a813be7c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/080629d32eca5ea202479022f0bd429a813be7c4/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ee7a003f97cbab8571afdc34aae6300dc756045e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ee7a003f97cbab8571afdc34aae6300dc756045e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ee7a003f97cbab8571afdc34aae6300dc756045e"}], "stats": {"total": 34, "additions": 26, "deletions": 8}, "files": [{"sha": "9db79406e07ad13e7c9fe45040bcdc7165961166", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=080629d32eca5ea202479022f0bd429a813be7c4", "patch": "@@ -1,3 +1,9 @@\n+2019-05-06  Martin Liska  <mliska@suse.cz>\n+\n+\tPR sanitizer/90312\n+\t* config/i386/i386-options.c (ix86_option_override_internal): Error only\n+\twhen -mabi is selected to a non-default version.\n+\n 2019-05-06  Hrishikesh Kulkarni  <hrishikeshparag@gmail.com>\n \t    Martin Liska  <mliska@suse.cz>\n "}, {"sha": "4ec10efacfabb5eca1455bf6f422b250a41b2259", "filename": "gcc/config/i386/i386-options.c", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Fconfig%2Fi386%2Fi386-options.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Fconfig%2Fi386%2Fi386-options.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-options.c?ref=080629d32eca5ea202479022f0bd429a813be7c4", "patch": "@@ -1704,12 +1704,17 @@ ix86_option_override_internal (bool main_args_p,\n     error (\"%<-mabi=ms%> not supported with X32 ABI\");\n   gcc_assert (opts->x_ix86_abi == SYSV_ABI || opts->x_ix86_abi == MS_ABI);\n \n-  if ((opts->x_flag_sanitize & SANITIZE_USER_ADDRESS) && opts->x_ix86_abi == MS_ABI)\n-    error (\"%<-mabi=ms%> not supported with %<-fsanitize=address%>\");\n-  if ((opts->x_flag_sanitize & SANITIZE_KERNEL_ADDRESS) && opts->x_ix86_abi == MS_ABI)\n-    error (\"%<-mabi=ms%> not supported with %<-fsanitize=kernel-address%>\");\n-  if ((opts->x_flag_sanitize & SANITIZE_THREAD) && opts->x_ix86_abi == MS_ABI)\n-    error (\"%<-mabi=ms%> not supported with %<-fsanitize=thread%>\");\n+  const char *abi_name = opts->x_ix86_abi == MS_ABI ? \"ms\" : \"sysv\";\n+  if ((opts->x_flag_sanitize & SANITIZE_USER_ADDRESS)\n+      && opts->x_ix86_abi != DEFAULT_ABI)\n+    error (\"%<-mabi=%s%> not supported with %<-fsanitize=address%>\", abi_name);\n+  if ((opts->x_flag_sanitize & SANITIZE_KERNEL_ADDRESS)\n+      && opts->x_ix86_abi != DEFAULT_ABI)\n+    error (\"%<-mabi=%s%> not supported with %<-fsanitize=kernel-address%>\",\n+\t   abi_name);\n+  if ((opts->x_flag_sanitize & SANITIZE_THREAD)\n+      && opts->x_ix86_abi != DEFAULT_ABI)\n+    error (\"%<-mabi=%s%> not supported with %<-fsanitize=thread%>\", abi_name);\n \n   /* For targets using ms ABI enable ms-extensions, if not\n      explicit turned off.  For non-ms ABI we turn off this"}, {"sha": "3e4bf2b56ee65a39a1254448995856f69982dcfb", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=080629d32eca5ea202479022f0bd429a813be7c4", "patch": "@@ -1,3 +1,10 @@\n+2019-05-06  Martin Liska  <mliska@suse.cz>\n+\n+\tPR sanitizer/90312\n+\t* gcc.dg/asan/pr87930.c: Run the test only on *linux or *gnu\n+\tsystems.\n+\t* gcc.dg/tsan/pr88017.c: Likewise.\n+\n 2019-05-06  Li Jia He  <helijia@linux.ibm.com>\n \n \t* gcc.dg/tree-ssa/pr37508.c: Add the no-ssa-phiopt option to skip phi"}, {"sha": "5a65d3fb03097943c659b062bd5db59ad02f601d", "filename": "gcc/testsuite/gcc.dg/asan/pr87930.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr87930.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr87930.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fasan%2Fpr87930.c?ref=080629d32eca5ea202479022f0bd429a813be7c4", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile { target { { i?86-*-* x86_64-*-* } && lp64 } } } */\n+/* { dg-do compile { target { { i?86-*-linux* i?86-*-gnu* x86_64-*-linux* } && lp64 } } } */\n /* { dg-options \"-fsanitize=address -mabi=ms\" } */\n \n int i;"}, {"sha": "10df2818b0d35a10d597868f9ce97ef6ed136869", "filename": "gcc/testsuite/gcc.dg/tsan/pr88017.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Ftestsuite%2Fgcc.dg%2Ftsan%2Fpr88017.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/080629d32eca5ea202479022f0bd429a813be7c4/gcc%2Ftestsuite%2Fgcc.dg%2Ftsan%2Fpr88017.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftsan%2Fpr88017.c?ref=080629d32eca5ea202479022f0bd429a813be7c4", "patch": "@@ -1,4 +1,4 @@\n-/* { dg-do compile { target { { i?86-*-* x86_64-*-* } && lp64 } } } */\n+/* { dg-do compile { target { { i?86-*-linux* i?86-*-gnu* x86_64-*-linux* } && lp64 } } } */\n /* { dg-options \"-fsanitize=thread -mabi=ms\" } */\n \n int i;"}]}