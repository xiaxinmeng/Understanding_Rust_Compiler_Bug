{"sha": "0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGJlNzJlM2E1ZWJlYzk3YTAwYzcwY2MyZWNkMWUyODZhMDlmYzUwZg==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-09-06T01:20:02Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2007-09-06T01:20:02Z"}, "message": "re PR libfortran/33253 (namelist: reading back a string with apostrophe)\n\n2007-09-05  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n\n\tPR libfortran/33253\n\t* io/write.c (nml_write_obj): Set the delimiter correctly before calling\n\twrite_character. (namelist_write): Clean up the code a little and add\n\tcomments to clarify what its doing.\n\nFrom-SVN: r128170", "tree": {"sha": "b90754cbdf4efd6d1bf2700fbd6908b2619d148e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b90754cbdf4efd6d1bf2700fbd6908b2619d148e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f/comments", "author": null, "committer": null, "parents": [{"sha": "221818503d867c0f7cd84ed989a60fc830e40707", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/221818503d867c0f7cd84ed989a60fc830e40707", "html_url": "https://github.com/Rust-GCC/gccrs/commit/221818503d867c0f7cd84ed989a60fc830e40707"}], "stats": {"total": 29, "additions": 20, "deletions": 9}, "files": [{"sha": "c1589e8a7f387bb8c2291946be3efef943528b47", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f", "patch": "@@ -1,4 +1,11 @@\n-2007-03-04  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+2007-09-05  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n+\n+\tPR libfortran/33253\n+\t* io/write.c (nml_write_obj): Set the delimiter correctly before calling\n+\twrite_character. (namelist_write): Clean up the code a little and add\n+\tcomments to clarify what its doing.\n+\n+2007-09-04  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR libfortran/33225\n \t* io/write.c (stdbool.h): Add include. (sign_t): Move typedef to"}, {"sha": "4792a222b9a7e07fde184f0f043784f66a9815c2", "filename": "libgfortran/io/write.c", "status": "modified", "additions": 12, "deletions": 8, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f/libgfortran%2Fio%2Fwrite.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f/libgfortran%2Fio%2Fwrite.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fwrite.c?ref=0be72e3a5ebec97a00c70cc2ecd1e286a09fc50f", "patch": "@@ -868,6 +868,7 @@ nml_write_obj (st_parameter_dt *dtp, namelist_info * obj, index_type offset,\n   size_t base_name_len;\n   size_t base_var_name_len;\n   size_t tot_len;\n+  unit_delim tmp_delim;\n \n   /* Write namelist variable names in upper case. If a derived type,\n      nothing is output.  If a component, base and base_name are set.  */\n@@ -984,11 +985,13 @@ nml_write_obj (st_parameter_dt *dtp, namelist_info * obj, index_type offset,\n               break;\n \n \t    case GFC_DTYPE_CHARACTER:\n-\t      if (dtp->u.p.nml_delim)\n-\t\twrite_character (dtp, &dtp->u.p.nml_delim, 1);\n+\t      tmp_delim = dtp->u.p.current_unit->flags.delim;\n+\t      if (dtp->u.p.nml_delim == '\"')\n+\t\tdtp->u.p.current_unit->flags.delim = DELIM_QUOTE;\n+\t      if (dtp->u.p.nml_delim == '\\'')\n+\t\tdtp->u.p.current_unit->flags.delim = DELIM_APOSTROPHE;\n \t      write_character (dtp, p, obj->string_length);\n-\t      if (dtp->u.p.nml_delim)\n-\t\twrite_character (dtp, &dtp->u.p.nml_delim, 1);\n+\t      dtp->u.p.current_unit->flags.delim = tmp_delim;\n               break;\n \n \t    case GFC_DTYPE_REAL:\n@@ -1130,7 +1133,6 @@ namelist_write (st_parameter_dt *dtp)\n   /* Set the delimiter for namelist output.  */\n \n   tmp_delim = dtp->u.p.current_unit->flags.delim;\n-  dtp->u.p.current_unit->flags.delim = DELIM_NONE;\n   switch (tmp_delim)\n     {\n     case (DELIM_QUOTE):\n@@ -1146,10 +1148,12 @@ namelist_write (st_parameter_dt *dtp)\n       break;\n     }\n \n+  /* Temporarily disable namelist delimters.  */\n+  dtp->u.p.current_unit->flags.delim = DELIM_NONE;\n+\n   write_character (dtp, \"&\", 1);\n \n   /* Write namelist name in upper case - f95 std.  */\n-\n   for (i = 0 ;i < dtp->namelist_name_len ;i++ )\n     {\n       c = toupper (dtp->namelist_name[i]);\n@@ -1165,14 +1169,14 @@ namelist_write (st_parameter_dt *dtp)\n \t  t1 = nml_write_obj (dtp, t2, dummy_offset, dummy, dummy_name);\n \t}\n     }\n+\n #ifdef HAVE_CRLF\n   write_character (dtp, \"  /\\r\\n\", 5);\n #else\n   write_character (dtp, \"  /\\n\", 4);\n #endif\n \n-  /* Recover the original delimiter.  */\n-\n+  /* Restore the original delimiter.  */\n   dtp->u.p.current_unit->flags.delim = tmp_delim;\n }\n "}]}