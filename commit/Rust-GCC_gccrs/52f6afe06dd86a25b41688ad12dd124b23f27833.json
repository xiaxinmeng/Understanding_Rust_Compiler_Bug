{"sha": "52f6afe06dd86a25b41688ad12dd124b23f27833", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTJmNmFmZTA2ZGQ4NmEyNWI0MTY4OGFkMTJkZDEyNGIyM2YyNzgzMw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2019-09-12T10:51:39Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2019-09-12T10:51:39Z"}, "message": "PR libstdc++/91748 fix std::for_each_n for random access iterators\n\n\tPR libstdc++/91748\n\t* include/bits/stl_algo.h (for_each_n): Fix random access iterator\n\tcase.\n\t* testsuite/25_algorithms/for_each/for_each_n.cc: Test with random\n\taccess iterators.\n\nFrom-SVN: r275683", "tree": {"sha": "571e610703702655d902c08dad36f7aa176b4df9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/571e610703702655d902c08dad36f7aa176b4df9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/52f6afe06dd86a25b41688ad12dd124b23f27833", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52f6afe06dd86a25b41688ad12dd124b23f27833", "html_url": "https://github.com/Rust-GCC/gccrs/commit/52f6afe06dd86a25b41688ad12dd124b23f27833", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/52f6afe06dd86a25b41688ad12dd124b23f27833/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "58cc98767aa1d8136d36467b892dc4adaf427acc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58cc98767aa1d8136d36467b892dc4adaf427acc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58cc98767aa1d8136d36467b892dc4adaf427acc"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "3984e9968f6942eb55facc1e63ee5e377fcb0b12", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52f6afe06dd86a25b41688ad12dd124b23f27833/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52f6afe06dd86a25b41688ad12dd124b23f27833/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=52f6afe06dd86a25b41688ad12dd124b23f27833", "patch": "@@ -1,3 +1,11 @@\n+2019-09-12  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/91748\n+\t* include/bits/stl_algo.h (for_each_n): Fix random access iterator\n+\tcase.\n+\t* testsuite/25_algorithms/for_each/for_each_n.cc: Test with random\n+\taccess iterators.\n+\n 2019-09-11  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* python/libstdcxx/v6/xmethods.py (SharedPtrUseCountWorker.__call__):"}, {"sha": "7fe1d8a57340f1aae6e13c5026aeaf2d4e063f1a", "filename": "libstdc++-v3/include/bits/stl_algo.h", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52f6afe06dd86a25b41688ad12dd124b23f27833/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_algo.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52f6afe06dd86a25b41688ad12dd124b23f27833/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_algo.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fstl_algo.h?ref=52f6afe06dd86a25b41688ad12dd124b23f27833", "patch": "@@ -3993,7 +3993,11 @@ _GLIBCXX_BEGIN_NAMESPACE_ALGO\n       auto __n2 = std::__size_to_integer(__n);\n       using _Cat = typename iterator_traits<_InputIterator>::iterator_category;\n       if constexpr (is_base_of_v<random_access_iterator_tag, _Cat>)\n-\treturn std::for_each(__first, __first + __n2, __f);\n+\t{\n+\t  auto __last = __first + __n2;\n+\t  std::for_each(__first, __last, std::move(__f));\n+\t  return __last;\n+\t}\n       else\n \t{\n \t  while (__n2-->0)"}, {"sha": "016ff57cb2874dbc0d3a8e82a96564fc68f7372f", "filename": "libstdc++-v3/testsuite/25_algorithms/for_each/for_each_n.cc", "status": "modified", "additions": 32, "deletions": 1, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/52f6afe06dd86a25b41688ad12dd124b23f27833/libstdc%2B%2B-v3%2Ftestsuite%2F25_algorithms%2Ffor_each%2Ffor_each_n.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/52f6afe06dd86a25b41688ad12dd124b23f27833/libstdc%2B%2B-v3%2Ftestsuite%2F25_algorithms%2Ffor_each%2Ffor_each_n.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F25_algorithms%2Ffor_each%2Ffor_each_n.cc?ref=52f6afe06dd86a25b41688ad12dd124b23f27833", "patch": "@@ -47,11 +47,42 @@ void test01()\n   };\n   auto res = std::for_each_n(con.begin(), Size(con.size()), Func(sum));\n \n-  VERIFY( res.ptr == con.end().ptr );\n+  VERIFY( res == con.end() );\n   VERIFY( sum == 15 );\n }\n \n+void\n+test02()\n+{\n+  using __gnu_test::test_container;\n+  using __gnu_test::random_access_iterator_wrapper;\n+  int array[5] = { 2, 4, 6, 8, 10 };\n+  test_container<int, random_access_iterator_wrapper> con(array);\n+\n+  int prod = 1;\n+  struct Func\n+  {\n+    Func(int& i) : i(i) { }\n+    Func(Func&&) = default;\n+    Func& operator=(Func&&) = delete;\n+    void operator()(int n) const { i *= n; }\n+    int& i;\n+  };\n+\n+  struct Size\n+  {\n+    Size(short v) : val(v) { }\n+    operator short() const { return val; }\n+    short val;\n+  };\n+  auto res = std::for_each_n(con.begin(), Size(con.size()), Func(prod));\n+\n+  VERIFY( res == con.end() );\n+  VERIFY( prod == 3840 );\n+}\n+\n int main()\n {\n   test01();\n+  test02();\n }"}]}