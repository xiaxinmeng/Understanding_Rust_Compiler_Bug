{"sha": "83059741a0a58b6cccb105522bf7f07813a55c23", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODMwNTk3NDFhMGE1OGI2Y2NjYjEwNTUyMmJmN2YwNzgxM2E1NWMyMw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2017-06-07T11:34:36Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2017-06-07T11:34:36Z"}, "message": "PR c++/80990 use cv-qualifiers in class template argument deduction\n\ngcc/cp:\n\n\tPR c++/80990\n\t* pt.c (do_class_deduction): Build qualified type.\n\ngcc/testsuite:\n\n\tPR c++/80990\n\t* g++.dg/cpp1z/class-deduction39.C: New.\n\nFrom-SVN: r248966", "tree": {"sha": "beb693a70da20c26df8031058c455c7027780241", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/beb693a70da20c26df8031058c455c7027780241"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/83059741a0a58b6cccb105522bf7f07813a55c23", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83059741a0a58b6cccb105522bf7f07813a55c23", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83059741a0a58b6cccb105522bf7f07813a55c23", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83059741a0a58b6cccb105522bf7f07813a55c23/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "09a939a0d5c407e94b03421b87450af8fecdfe52", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/09a939a0d5c407e94b03421b87450af8fecdfe52", "html_url": "https://github.com/Rust-GCC/gccrs/commit/09a939a0d5c407e94b03421b87450af8fecdfe52"}], "stats": {"total": 27, "additions": 26, "deletions": 1}, "files": [{"sha": "e47c4299748186563e0b699172d7b69dd936d3b7", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=83059741a0a58b6cccb105522bf7f07813a55c23", "patch": "@@ -1,3 +1,8 @@\n+2017-06-07  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/80990\n+\t* pt.c (do_class_deduction): Build qualified type.\n+\n 2017-06-06  Nathan Sidwell  <nathan@acm.org>\n \n \t* name-lookup.c (suggest_alternatives_for): Use qualified lookup"}, {"sha": "ada94bd65ed14ae16569cdfe5d9b12dc1c6ca2be", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=83059741a0a58b6cccb105522bf7f07813a55c23", "patch": "@@ -25367,7 +25367,7 @@ do_class_deduction (tree ptype, tree tmpl, tree init, int flags,\n   --cp_unevaluated_operand;\n   release_tree_vector (args);\n \n-  return TREE_TYPE (t);\n+  return cp_build_qualified_type (TREE_TYPE (t), cp_type_quals (ptype));\n }\n \n /* Replace occurrences of 'auto' in TYPE with the appropriate type deduced"}, {"sha": "e5a4dbd229ba89620cbddf09b216c4df76816b07", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=83059741a0a58b6cccb105522bf7f07813a55c23", "patch": "@@ -1,3 +1,8 @@\n+2017-06-07  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/80990\n+\t* g++.dg/cpp1z/class-deduction39.C: New.\n+\n 2017-06-07  Marek Polacek  <polacek@redhat.com>\n \n \tPR sanitizer/80932"}, {"sha": "98a3664f5b274166d66a95fc52a4cd7fdd69e919", "filename": "gcc/testsuite/g++.dg/cpp1z/class-deduction39.C", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fclass-deduction39.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83059741a0a58b6cccb105522bf7f07813a55c23/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fclass-deduction39.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp1z%2Fclass-deduction39.C?ref=83059741a0a58b6cccb105522bf7f07813a55c23", "patch": "@@ -0,0 +1,15 @@\n+// { dg-options -std=c++1z }\n+\n+template <class T> struct A { };\n+\n+A<int> a;\n+const A c = a;\n+volatile A v = a;\n+const volatile A cv = a;\n+\n+template <class,class> struct same;\n+template <class T> struct same<T,T> {};\n+\n+same<decltype(c), const A<int>> s1;\n+same<decltype(v), volatile A<int>> s2;\n+same<decltype(cv), const volatile A<int>> s3;"}]}