{"sha": "a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTJjYjExOTZjZjlhOGU0NmUwYmJhYTI5OThiOThlY2JjOGVjZDU5NQ==", "commit": {"author": {"name": "Nicolas Koenig", "email": "koenigni@student.ethz.ch", "date": "2017-04-10T20:58:21Z"}, "committer": {"name": "Nicolas Koenig", "email": "koenigni@gcc.gnu.org", "date": "2017-04-10T20:58:21Z"}, "message": "re PR fortran/69498 (ICE on disjunct cases with displaced or incomplete embedded statement)\n\n\n2017-04-10  Nicolas Koenig  <koenigni@student.ethz.ch>\n            Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/69498 \n\t* module.c (gfc_match_submodule): Add error\n\tif function is called in the wrong state.\n\n2017-04-10  Nicolas Koenig  <koenigni@student.ethz.ch>\n\n\tPR fortran/69498 \n\t* gfortran.dg/submodule_unexp.f90: Modified test\n\tto account for new error.\n\t* gfortran.dg/submodule_twice.f90: New Test\n\n\nCo-Authored-By: Paul Thomas <pault@gcc.gnu.org>\n\nFrom-SVN: r246826", "tree": {"sha": "b37c089fe660171581ae1e8c7c6220ba7b269715", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b37c089fe660171581ae1e8c7c6220ba7b269715"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/comments", "author": null, "committer": null, "parents": [{"sha": "b447b28c5e434eb949e30985a7c2d49f6aa592fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b447b28c5e434eb949e30985a7c2d49f6aa592fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b447b28c5e434eb949e30985a7c2d49f6aa592fe"}], "stats": {"total": 31, "additions": 30, "deletions": 1}, "files": [{"sha": "9f31ad946d83b682dd70d32abfeac999d14f76c1", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "patch": "@@ -1,3 +1,11 @@\n+\n+2017-04-10  Nicolas Koenig  <koenigni@student.ethz.ch>\n+            Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/69498 \n+\t* module.c (gfc_match_submodule): Add error\n+\tif function is called in the wrong state.\n+\n 2017-04-10  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/80046"}, {"sha": "28b8ea1db57ba8ba196b80de92ae506352d1236a", "filename": "gcc/fortran/module.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ffortran%2Fmodule.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ffortran%2Fmodule.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmodule.c?ref=a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "patch": "@@ -741,6 +741,13 @@ gfc_match_submodule (void)\n   if (!gfc_notify_std (GFC_STD_F2008, \"SUBMODULE declaration at %C\"))\n     return MATCH_ERROR;\n \n+  if (gfc_current_state () != COMP_NONE)\n+    {\n+      gfc_error (\"SUBMODULE declaration at %C cannot appear within \"\n+\t\t \"another scoping unit\");\n+      return MATCH_ERROR;\n+    }\n+\n   gfc_new_block = NULL;\n   gcc_assert (module_list == NULL);\n "}, {"sha": "21043924bebcf7581b608cd8bcd316a354ab9010", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "patch": "@@ -1,3 +1,10 @@\n+2017-04-10  Nicolas Koenig  <koenigni@student.ethz.ch>\n+\n+\tPR fortran/69498 \n+\t* gfortran.dg/submodule_unexp.f90: Modified test\n+\tto account for new error.\n+\t* gfortran.dg/submodule_twice.f90: New Test\n+\n 2017-04-10  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/80176"}, {"sha": "fdb4dcb10e582b5b8f0db01e6623d0812e607a30", "filename": "gcc/testsuite/gfortran.dg/submodule_twice.f90", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_twice.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_twice.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_twice.f90?ref=a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "patch": "@@ -0,0 +1,7 @@\n+! { dg-do compile }\n+! PR fortran/69498\n+! This used to ICE\n+program main\n+    submodule (m) sm ! { dg-error \"SUBMODULE declaration at\" }\n+    submodule (m2) sm2  ! { dg-error \"SUBMODULE declaration at\" }\n+end program"}, {"sha": "39b57a585e715afd2990bc72f451f94cc5a7b6cd", "filename": "gcc/testsuite/gfortran.dg/submodule_unexp.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_unexp.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_unexp.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fsubmodule_unexp.f90?ref=a2cb1196cf9a8e46e0bbaa2998b98ecbc8ecd595", "patch": "@@ -3,6 +3,6 @@\n ! This used to ICE\n program p\n    type t\n-   submodule (m) sm ! { dg-error \"Unexpected SUBMODULE statement at\" }\n+   submodule (m) sm ! { dg-error \"SUBMODULE declaration at\" }\n    end type\n end"}]}