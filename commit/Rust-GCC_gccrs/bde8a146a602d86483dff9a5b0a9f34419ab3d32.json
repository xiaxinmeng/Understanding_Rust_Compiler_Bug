{"sha": "bde8a146a602d86483dff9a5b0a9f34419ab3d32", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmRlOGExNDZhNjAyZDg2NDgzZGZmOWE1YjBhOWYzNDQxOWFiM2QzMg==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2010-10-13T18:57:31Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2010-10-13T18:57:31Z"}, "message": "Centralize knowledge of eh personality routines.\n\nFrom-SVN: r165433", "tree": {"sha": "3c1d073f5371ed3d1591b0a5f61b529b6c5b86af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3c1d073f5371ed3d1591b0a5f61b529b6c5b86af"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bde8a146a602d86483dff9a5b0a9f34419ab3d32", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bde8a146a602d86483dff9a5b0a9f34419ab3d32", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bde8a146a602d86483dff9a5b0a9f34419ab3d32", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bde8a146a602d86483dff9a5b0a9f34419ab3d32/comments", "author": null, "committer": null, "parents": [{"sha": "d1655e0b38cecbdeed551818b2406fcb39919ba7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1655e0b38cecbdeed551818b2406fcb39919ba7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1655e0b38cecbdeed551818b2406fcb39919ba7"}], "stats": {"total": 119, "additions": 71, "deletions": 48}, "files": [{"sha": "1fbd88153463d61a53fe7a9ad7295a7656f623ea", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -1,3 +1,11 @@\n+2010-10-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* expr.c (build_personality_function): Take parameter LANG instead\n+\tof parameter NAME.  Build the name based on the lang prefix and the\n+\tunwind method in use.\n+\t* tree.c (lhd_gcc_personality): Update call to\n+\tbuild_personality_function.\n+\n 2010-10-13  Richard Guenther  <rguenther@suse.de>\n \n \tPR objc/45878"}, {"sha": "df5b433fda0565ebcd3e40ab43140c78ce0dbf61", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -1,3 +1,10 @@\n+2010-10-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* gcc-interface/misc.c (gnat_eh_personality): Update call to\n+\tbuild_personality_function.\n+\t* raise-gcc.c (PERSONALITY_FUNCTION): Change to match other languages;\n+\tuse__gnat_personality_{v,sj}0.\n+\n 2010-10-12  Vincent Celier  <celier@adacore.com>\n \n \t* prj-nmsc.adb (Add_Source): Put source in hash table Source_Files_HT"}, {"sha": "a1b249072141fe72f5239029f61af8369e99d50e", "filename": "gcc/ada/gcc-interface/misc.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fada%2Fgcc-interface%2Fmisc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fada%2Fgcc-interface%2Fmisc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fmisc.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -687,11 +687,7 @@ static tree\n gnat_eh_personality (void)\n {\n   if (!gnat_eh_personality_decl)\n-    gnat_eh_personality_decl\n-      = build_personality_function (targetm.except_unwind_info () == UI_SJLJ\n-\t\t\t\t    ? \"__gnat_eh_personality_sj\"\n-\t\t\t\t    : \"__gnat_eh_personality\");\n-\n+    gnat_eh_personality_decl = build_personality_function (\"gnat\");\n   return gnat_eh_personality_decl;\n }\n "}, {"sha": "512ff368e39f5866dc8e4e8e30613c818fc5a85c", "filename": "gcc/ada/raise-gcc.c", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fada%2Fraise-gcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fada%2Fraise-gcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fraise-gcc.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -407,7 +407,7 @@ db_phases (int phases)\n    ===================================\n \n    The major point of this unit is to provide an exception propagation\n-   personality routine for Ada. This is __gnat_eh_personality.\n+   personality routine for Ada. This is __gnat_personality_v0.\n \n    It is provided with a pointer to the propagated exception, an unwind\n    context describing a location the propagation is going through, and a\n@@ -440,7 +440,7 @@ db_phases (int phases)\n      |\n      |   (Ada frame)\n      |\n-     +--> __gnat_eh_personality (context, exception)\n+     +--> __gnat_personality_v0 (context, exception)\n \t   |\n \t   +--> get_region_descriptor_for (context)\n \t   |\n@@ -1028,9 +1028,9 @@ extern void __gnat_notify_unhandled_exception (void);\n    GNU-Ada exceptions are met.  */\n \n #ifdef __USING_SJLJ_EXCEPTIONS__\n-#define PERSONALITY_FUNCTION    __gnat_eh_personality_sj\n+#define PERSONALITY_FUNCTION    __gnat_personality_sj0\n #else\n-#define PERSONALITY_FUNCTION    __gnat_eh_personality\n+#define PERSONALITY_FUNCTION    __gnat_personality_v0\n #endif\n \n /* Major tweak for ia64-vms : the CHF propagation phase calls this personality"}, {"sha": "683e439ac47612fd42a02536fb75d071b2f0e024", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -1,3 +1,9 @@\n+2010-10-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* cp-lang.c (cp_eh_personality): Update call to\n+\tbuild_personality_function.\n+\t* except.c (choose_personality_routine): Update function comment.\n+\n 2010-10-13  Richard Guenther  <rguenther@suse.de>\n \n \t* tree.c (cp_free_lang_data): Free DECL_NAMESPACE_USERS and"}, {"sha": "a07d7be1871b88e5e146b69390c7181567be990d", "filename": "gcc/cp/cp-lang.c", "status": "modified", "additions": 2, "deletions": 11, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fcp%2Fcp-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fcp%2Fcp-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-lang.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -166,17 +166,8 @@ cp_eh_personality (void)\n {\n   if (!cp_eh_personality_decl)\n     {\n-      const char *name;\n-\n-      name = (targetm.except_unwind_info () == UI_SJLJ\n-\t      ? (pragma_java_exceptions\n-\t\t ? \"__gcj_personality_sj0\"\n-\t\t : \"__gxx_personality_sj0\")\n-\t      : (pragma_java_exceptions\n-\t\t ? \"__gcj_personality_v0\"\n-\t\t : \"__gxx_personality_v0\"));\n-\n-      cp_eh_personality_decl = build_personality_function (name);\n+      const char *lang = (pragma_java_exceptions ? \"gcj\" : \"gxx\");\n+      cp_eh_personality_decl = build_personality_function (lang);\n     }\n \n   return cp_eh_personality_decl;"}, {"sha": "b9176647ba70366eeade7e30ee88e22d6bf20509", "filename": "gcc/cp/except.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fcp%2Fexcept.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fcp%2Fexcept.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fexcept.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -295,9 +295,8 @@ decl_is_java_type (tree decl, int err)\n /* Select the personality routine to be used for exception handling,\n    or issue an error if we need two different ones in the same\n    translation unit.\n-   ??? At present eh_personality_decl is set to\n-   __gxx_personality_(sj|v)0 in init_exception_processing - should it\n-   be done here instead?  */\n+   ??? At present DECL_FUNCTION_PERSONALITY is set via\n+   LANG_HOOKS_EH_PERSONALITY.  Should it be done here instead?  */\n void\n choose_personality_routine (enum languages lang)\n {"}, {"sha": "0050518d8c859e640b14b3039b1a6c3c9dbd6114", "filename": "gcc/expr.c", "status": "modified", "additions": 21, "deletions": 3, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -10255,13 +10255,31 @@ const_vector_from_tree (tree exp)\n   return gen_rtx_CONST_VECTOR (mode, v);\n }\n \n-\n-/* Build a decl for a EH personality function named NAME. */\n+/* Build a decl for a personality function given a language prefix.  */\n \n tree\n-build_personality_function (const char *name)\n+build_personality_function (const char *lang)\n {\n+  const char *unwind_and_version;\n   tree decl, type;\n+  char *name;\n+\n+  switch (targetm.except_unwind_info ())\n+    {\n+    case UI_NONE:\n+      return NULL;\n+    case UI_SJLJ:\n+      unwind_and_version = \"_sj0\";\n+      break;\n+    case UI_DWARF2:\n+    case UI_TARGET:\n+      unwind_and_version = \"_v0\";\n+      break;\n+    default:\n+      gcc_unreachable ();\n+    }\n+\n+  name = ACONCAT ((\"__\", lang, \"_personality\", unwind_and_version, NULL));\n \n   type = build_function_type_list (integer_type_node, integer_type_node,\n \t\t\t\t   long_long_unsigned_type_node,"}, {"sha": "41ae31c159f00872b86e74a1b3b8c1c9db1de696", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -1,3 +1,8 @@\n+2010-10-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* lang.c (java_eh_personality): Update call to\n+\tbuild_personality_function.\n+\n 2010-10-12  Joseph Myers  <joseph@codesourcery.com>\n \n \t* Make-lang.in (java/lang.o): Use $(OPTIONS_H) instead of"}, {"sha": "45722e56480f41e3d49abf058566d25830bc97a7", "filename": "gcc/java/lang.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fjava%2Flang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fjava%2Flang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Flang.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -911,11 +911,7 @@ static tree\n java_eh_personality (void)\n {\n   if (!java_eh_personality_decl)\n-    java_eh_personality_decl\n-      = build_personality_function (targetm.except_unwind_info () == UI_SJLJ\n-\t\t\t\t    ? \"__gcj_personality_sj0\"\n-\t\t\t\t    : \"__gcj_personality_v0\");\n-\n+    java_eh_personality_decl = build_personality_function (\"gcj\");\n   return java_eh_personality_decl;\n }\n "}, {"sha": "81a872d1ff80bf5c604aa0d9440212fecc1d105f", "filename": "gcc/objc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2FChangeLog?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -1,3 +1,8 @@\n+2010-10-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* objc-act.c (objc_eh_personality): Update call to\n+\tbuild_personality_function.\n+\n 2010-10-13  Iain Sandoe  <iains@gcc.gnu.org>\n \n \tmerge from FSF apple 'trunk' branch. "}, {"sha": "edde784c4228e95f8c4b58c87e28e4e7798d15ee", "filename": "gcc/objc/objc-act.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjc%2Fobjc-act.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjc%2Fobjc-act.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-act.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -3716,13 +3716,8 @@ objc_eh_runtime_type (tree type)\n tree\n objc_eh_personality (void)\n {\n-  if (!flag_objc_sjlj_exceptions\n-      && !objc_eh_personality_decl)\n-    objc_eh_personality_decl\n-      = build_personality_function (targetm.except_unwind_info () == UI_SJLJ\n-\t\t\t\t    ? \"__gnu_objc_personality_sj0\"\n-\t\t\t\t    : \"__gnu_objc_personality_v0\");\n-\n+  if (!flag_objc_sjlj_exceptions && !objc_eh_personality_decl)\n+    objc_eh_personality_decl = build_personality_function (\"gnu_objc\");\n   return objc_eh_personality_decl;\n }\n #endif"}, {"sha": "26e3c7a1e2dc0698e11307535721c869d2ece764", "filename": "gcc/objcp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjcp%2FChangeLog?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -1,3 +1,8 @@\n+2010-10-13  Richard Henderson  <rth@redhat.com>\n+\n+\t* objcp-lang.c (objcxx_eh_personality): Update call to\n+\tbuild_personality_function.\n+\n 2010-10-11  Andi Kleen  <ak@linux.intel.com>\n \n \t* Make-lang.in (cc1objplus-checksum.c): Use correct temporary"}, {"sha": "6a45404a96a6c6e39e63e6ae9edde23217fc2a8c", "filename": "gcc/objcp/objcp-lang.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjcp%2Fobjcp-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Fobjcp%2Fobjcp-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjcp%2Fobjcp-lang.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -147,11 +147,7 @@ static tree\n objcxx_eh_personality (void)\n {\n   if (!objcp_eh_personality_decl)\n-    objcp_eh_personality_decl\n-\t= build_personality_function (targetm.except_unwind_info () == UI_SJLJ\n-\t\t\t\t      ? \"__gxx_personality_sj0\"\n-\t\t\t\t      : \"__gxx_personality_v0\");\n-\n+    objcp_eh_personality_decl = build_personality_function (\"gxx\");\n   return objcp_eh_personality_decl;\n }\n "}, {"sha": "28cc2d8c97e6f8e57e0e6346cfea4417a0689ad1", "filename": "gcc/tree.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bde8a146a602d86483dff9a5b0a9f34419ab3d32/gcc%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree.c?ref=bde8a146a602d86483dff9a5b0a9f34419ab3d32", "patch": "@@ -10874,11 +10874,7 @@ tree\n lhd_gcc_personality (void)\n {\n   if (!gcc_eh_personality_decl)\n-    gcc_eh_personality_decl\n-      = build_personality_function (targetm.except_unwind_info () == UI_SJLJ\n-\t\t\t\t    ? \"__gcc_personality_sj0\"\n-\t\t\t\t    : \"__gcc_personality_v0\");\n-\n+    gcc_eh_personality_decl = build_personality_function (\"gcc\");\n   return gcc_eh_personality_decl;\n }\n "}]}