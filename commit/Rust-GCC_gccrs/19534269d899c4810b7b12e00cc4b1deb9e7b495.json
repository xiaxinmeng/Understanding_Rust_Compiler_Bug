{"sha": "19534269d899c4810b7b12e00cc4b1deb9e7b495", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTk1MzQyNjlkODk5YzQ4MTBiN2IxMmUwMGNjNGIxZGViOWU3YjQ5NQ==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.ibm.com", "date": "2020-10-26T10:41:55Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@linux.ibm.com", "date": "2020-10-26T10:42:06Z"}, "message": "IBM Z: Add vcond_mask expander\n\nAfter adding vec_cmp expanders we have seen various performance\nrelated regression in the testsuite.  These appear to be caused by a\nmissing vcond_mask definition in the backend.  Fixed with this patch.\n\nThe patch fixes the following testsuite fails:\n\nFAIL: gcc.dg/vect/vect-21.c -flto -ffat-lto-objects  scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-21.c scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-23.c -flto -ffat-lto-objects  scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-23.c scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-24.c -flto -ffat-lto-objects  scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-24.c scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-live-6.c -flto -ffat-lto-objects  scan-tree-dump vect \"vectorized 1 loops\"\nFAIL: gcc.dg/vect/vect-live-6.c scan-tree-dump vect \"vectorized 1 loops\"\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrab\\\\t%v.?,%v.?,7 6\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesraf\\\\t%v.?,%v.?,31 6\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrah\\\\t%v.?,%v.?,15 6\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrlb\\\\t%v.?,%v.?,7 4\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrlf\\\\t%v.?,%v.?,31 4\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrlh\\\\t%v.?,%v.?,15 4\nFAIL: gcc.dg/vect/vect-21.c -flto -ffat-lto-objects  scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-21.c scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-23.c -flto -ffat-lto-objects  scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-23.c scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-24.c -flto -ffat-lto-objects  scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-24.c scan-tree-dump-times vect \"vectorized 3 loops\" 1\nFAIL: gcc.dg/vect/vect-live-6.c -flto -ffat-lto-objects  scan-tree-dump vect \"vectorized 1 loops\"\nFAIL: gcc.dg/vect/vect-live-6.c scan-tree-dump vect \"vectorized 1 loops\"\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrab\\\\t%v.?,%v.?,7 6\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesraf\\\\t%v.?,%v.?,31 6\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrah\\\\t%v.?,%v.?,15 6\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrlb\\\\t%v.?,%v.?,7 4\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrlf\\\\t%v.?,%v.?,31 4\nFAIL: gcc.target/s390/vector/vcond-shift.c scan-assembler-times vesrlh\\\\t%v.?,%v.?,15 4\n\ngcc/ChangeLog:\n\n\t* config/s390/vector.md (\"vcond_mask_<mode><mode>\"): New expander.", "tree": {"sha": "383b52586fe7dac70d05300357570ea0f7e03cc5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/383b52586fe7dac70d05300357570ea0f7e03cc5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19534269d899c4810b7b12e00cc4b1deb9e7b495", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19534269d899c4810b7b12e00cc4b1deb9e7b495", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19534269d899c4810b7b12e00cc4b1deb9e7b495", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19534269d899c4810b7b12e00cc4b1deb9e7b495/comments", "author": {"login": "Andreas-Krebbel", "id": 38103320, "node_id": "MDQ6VXNlcjM4MTAzMzIw", "avatar_url": "https://avatars.githubusercontent.com/u/38103320?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Andreas-Krebbel", "html_url": "https://github.com/Andreas-Krebbel", "followers_url": "https://api.github.com/users/Andreas-Krebbel/followers", "following_url": "https://api.github.com/users/Andreas-Krebbel/following{/other_user}", "gists_url": "https://api.github.com/users/Andreas-Krebbel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Andreas-Krebbel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Andreas-Krebbel/subscriptions", "organizations_url": "https://api.github.com/users/Andreas-Krebbel/orgs", "repos_url": "https://api.github.com/users/Andreas-Krebbel/repos", "events_url": "https://api.github.com/users/Andreas-Krebbel/events{/privacy}", "received_events_url": "https://api.github.com/users/Andreas-Krebbel/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Andreas-Krebbel", "id": 38103320, "node_id": "MDQ6VXNlcjM4MTAzMzIw", "avatar_url": "https://avatars.githubusercontent.com/u/38103320?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Andreas-Krebbel", "html_url": "https://github.com/Andreas-Krebbel", "followers_url": "https://api.github.com/users/Andreas-Krebbel/followers", "following_url": "https://api.github.com/users/Andreas-Krebbel/following{/other_user}", "gists_url": "https://api.github.com/users/Andreas-Krebbel/gists{/gist_id}", "starred_url": "https://api.github.com/users/Andreas-Krebbel/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Andreas-Krebbel/subscriptions", "organizations_url": "https://api.github.com/users/Andreas-Krebbel/orgs", "repos_url": "https://api.github.com/users/Andreas-Krebbel/repos", "events_url": "https://api.github.com/users/Andreas-Krebbel/events{/privacy}", "received_events_url": "https://api.github.com/users/Andreas-Krebbel/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "50f9e1f4d458e36d306b2449c689e45492847f68", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/50f9e1f4d458e36d306b2449c689e45492847f68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/50f9e1f4d458e36d306b2449c689e45492847f68"}], "stats": {"total": 11, "additions": 11, "deletions": 0}, "files": [{"sha": "3e621daf7b1a0d879248b0283d33709fd70b7149", "filename": "gcc/config/s390/vector.md", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19534269d899c4810b7b12e00cc4b1deb9e7b495/gcc%2Fconfig%2Fs390%2Fvector.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19534269d899c4810b7b12e00cc4b1deb9e7b495/gcc%2Fconfig%2Fs390%2Fvector.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fvector.md?ref=19534269d899c4810b7b12e00cc4b1deb9e7b495", "patch": "@@ -658,6 +658,17 @@\n   DONE;\n })\n \n+(define_expand \"vcond_mask_<mode><mode>\"\n+  [(set (match_operand:V 0 \"register_operand\" \"\")\n+\t(if_then_else:V\n+\t (eq (match_operand:<tointvec> 3 \"register_operand\" \"\")\n+\t     (match_dup 4))\n+\t (match_operand:V 2 \"register_operand\" \"\")\n+\t (match_operand:V 1 \"register_operand\" \"\")))]\n+  \"TARGET_VX\"\n+  \"operands[4] = CONST0_RTX (<tointvec>mode);\")\n+\n+\n ; We only have HW support for byte vectors.  The middle-end is\n ; supposed to lower the mode if required.\n (define_insn \"vec_permv16qi\""}]}