{"sha": "94ec37a909697bbf29db73278c77621ccdf60693", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTRlYzM3YTkwOTY5N2JiZjI5ZGI3MzI3OGM3NzYyMWNjZGY2MDY5Mw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2019-03-08T10:20:12Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2019-03-08T10:20:12Z"}, "message": "re PR target/89578 (5% runtime regression for 481.wrf at -Ofast -flto)\n\n2019-03-08  Richard Biener  <rguenther@suse.de>\n\n\tPR middle-end/89578\n\t* cfgloop.h (struct loop): Add owned_clique field.\n\t* cfgloopmanip.c (copy_loop_info): Copy it.\n\t* tree-cfg.c (gimple_duplicate_bb): Do not remap owned_clique\n\tcliques.\n\t* tree-inline.c (copy_loops): Remap owned_clique.\n\t* lto-streamer-in.c (input_cfg): Stream owned_clique.\n\t* lto-streamer-out.c (output_cfg): Likewise.\n\nFrom-SVN: r269484", "tree": {"sha": "b688ace11870b78027045997e18c5e38315eddb7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b688ace11870b78027045997e18c5e38315eddb7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/94ec37a909697bbf29db73278c77621ccdf60693", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94ec37a909697bbf29db73278c77621ccdf60693", "html_url": "https://github.com/Rust-GCC/gccrs/commit/94ec37a909697bbf29db73278c77621ccdf60693", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/94ec37a909697bbf29db73278c77621ccdf60693/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5d1504d42af6b12efeb83a2056424ceb1512961f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5d1504d42af6b12efeb83a2056424ceb1512961f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5d1504d42af6b12efeb83a2056424ceb1512961f"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "b46c5aff26618b4a5d7c6ac19f6de09decb8962f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -1,3 +1,14 @@\n+2019-03-08  Richard Biener  <rguenther@suse.de>\n+\n+\tPR middle-end/89578\n+\t* cfgloop.h (struct loop): Add owned_clique field.\n+\t* cfgloopmanip.c (copy_loop_info): Copy it.\n+\t* tree-cfg.c (gimple_duplicate_bb): Do not remap owned_clique\n+\tcliques.\n+\t* tree-inline.c (copy_loops): Remap owned_clique.\n+\t* lto-streamer-in.c (input_cfg): Stream owned_clique.\n+\t* lto-streamer-out.c (output_cfg): Likewise.\n+\n 2019-03-08  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/80190"}, {"sha": "e82cd7a034a43d275f044c9fc3529c6ae1b76f00", "filename": "gcc/cfgloop.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Fcfgloop.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Fcfgloop.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloop.h?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -227,6 +227,10 @@ struct GTY ((chain_next (\"%h.next\"))) loop {\n      Other values means unroll with the given unrolling factor.  */\n   unsigned short unroll;\n \n+  /* If this loop was inlined the main clique of the callee which does\n+     not need remapping when copying the loop body.  */\n+  unsigned short owned_clique;\n+\n   /* For SIMD loops, this is a unique identifier of the loop, referenced\n      by IFN_GOMP_SIMD_VF, IFN_GOMP_SIMD_LANE and IFN_GOMP_SIMD_LAST_LANE\n      builtins.  */"}, {"sha": "bfee48ed8ccdea326d56bf252df03f0c2b814fb4", "filename": "gcc/cfgloopmanip.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Fcfgloopmanip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Fcfgloopmanip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgloopmanip.c?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -1024,6 +1024,7 @@ copy_loop_info (struct loop *loop, struct loop *target)\n   target->force_vectorize = loop->force_vectorize;\n   target->in_oacc_kernels_region = loop->in_oacc_kernels_region;\n   target->unroll = loop->unroll;\n+  target->owned_clique = loop->owned_clique;\n }\n \n /* Copies copy of LOOP as subloop of TARGET loop, placing newly"}, {"sha": "7727b9be760f34e6dcfb49a4c5c7bf0479585e2c", "filename": "gcc/lto-streamer-in.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Flto-streamer-in.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Flto-streamer-in.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-in.c?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -826,6 +826,7 @@ input_cfg (struct lto_input_block *ib, struct data_in *data_in,\n       /* Read OMP SIMD related info.  */\n       loop->safelen = streamer_read_hwi (ib);\n       loop->unroll = streamer_read_hwi (ib);\n+      loop->owned_clique = streamer_read_hwi (ib);\n       loop->dont_vectorize = streamer_read_hwi (ib);\n       loop->force_vectorize = streamer_read_hwi (ib);\n       loop->simduid = stream_read_tree (ib, data_in);"}, {"sha": "b6e395b53fd994cf5171a23a74338316e95fb191", "filename": "gcc/lto-streamer-out.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Flto-streamer-out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Flto-streamer-out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-streamer-out.c?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -1938,6 +1938,7 @@ output_cfg (struct output_block *ob, struct function *fn)\n       /* Write OMP SIMD related info.  */\n       streamer_write_hwi (ob, loop->safelen);\n       streamer_write_hwi (ob, loop->unroll);\n+      streamer_write_hwi (ob, loop->owned_clique);\n       streamer_write_hwi (ob, loop->dont_vectorize);\n       streamer_write_hwi (ob, loop->force_vectorize);\n       stream_write_tree (ob, loop->simduid, true);"}, {"sha": "f433efc89c0fc53c8a038773d238314543d983ac", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -6244,7 +6244,8 @@ gimple_duplicate_bb (basic_block bb, copy_bb_data *id)\n \t      op = TREE_OPERAND (op, 0);\n \t    if ((TREE_CODE (op) == MEM_REF\n \t\t || TREE_CODE (op) == TARGET_MEM_REF)\n-\t\t&& MR_DEPENDENCE_CLIQUE (op) > 1)\n+\t\t&& MR_DEPENDENCE_CLIQUE (op) > 1\n+\t\t&& MR_DEPENDENCE_CLIQUE (op) != bb->loop_father->owned_clique)\n \t      {\n \t\tif (!id->dependence_map)\n \t\t  id->dependence_map = new hash_map<dependence_hash,"}, {"sha": "956e39f97682a83042782b9127b751ae8eb3d75d", "filename": "gcc/tree-inline.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Ftree-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/94ec37a909697bbf29db73278c77621ccdf60693/gcc%2Ftree-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-inline.c?ref=94ec37a909697bbf29db73278c77621ccdf60693", "patch": "@@ -2670,6 +2670,11 @@ copy_loops (copy_body_data *id,\n \t    cfun->has_unroll = true;\n \t  if (dest_loop->force_vectorize)\n \t    cfun->has_force_vectorize_loops = true;\n+\t  if (id->src_cfun->last_clique != 0)\n+\t    dest_loop->owned_clique\n+\t      = remap_dependence_clique (id,\n+\t\t\t\t\t src_loop->owned_clique\n+\t\t\t\t\t ? src_loop->owned_clique : 1);\n \n \t  /* Finally place it into the loop array and the loop tree.  */\n \t  place_new_loop (cfun, dest_loop);"}]}