{"sha": "83cc5e2b2f887d4bb2305658da382a65fdcaab29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODNjYzVlMmIyZjg4N2Q0YmIyMzA1NjU4ZGEzODJhNjVmZGNhYWIyOQ==", "commit": {"author": {"name": "Cl\u00e9ment Chigot", "email": "clement.chigot@atos.net", "date": "2020-07-16T09:29:49Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-07-23T21:26:36Z"}, "message": "libgo: add AIX FAT libraries support\n\nAIX-style libraries contains both 32 and 64 bit shared objects.\nThis patch follows the adding of FAT libraries support in other gcc\nlibraries (libgcc, listdc++, etc).\n\nReviewed-on: https://go-review.googlesource.com/c/gofrontend/+/242957", "tree": {"sha": "8df77f6a205ef2474f3d57434d7f5f9464a3a4dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8df77f6a205ef2474f3d57434d7f5f9464a3a4dc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/83cc5e2b2f887d4bb2305658da382a65fdcaab29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83cc5e2b2f887d4bb2305658da382a65fdcaab29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/83cc5e2b2f887d4bb2305658da382a65fdcaab29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/83cc5e2b2f887d4bb2305658da382a65fdcaab29/comments", "author": null, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8598657c607500512075f6c4ee3b10460c94903d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8598657c607500512075f6c4ee3b10460c94903d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8598657c607500512075f6c4ee3b10460c94903d"}], "stats": {"total": 48, "additions": 45, "deletions": 3}, "files": [{"sha": "d23e73773068ac750f4a6174a4339c507ad63708", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83cc5e2b2f887d4bb2305658da382a65fdcaab29/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83cc5e2b2f887d4bb2305658da382a65fdcaab29/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=83cc5e2b2f887d4bb2305658da382a65fdcaab29", "patch": "@@ -1,4 +1,4 @@\n-2d105e65cca6b536320284273353b7c640b12c5f\n+587d4595e446c597efe97ccdc81b2f05cbc04a21\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "52a8330ed2a2d8b53a81702858c29ff28a270984", "filename": "libgo/Makefile.am", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.am?ref=83cc5e2b2f887d4bb2305658da382a65fdcaab29", "patch": "@@ -1228,3 +1228,17 @@ distclean-local:\n \tfind . -name '*.lo.dep' -print | xargs rm -f\n \n include $(top_srcdir)/../multilib.am\n+\n+if LIBGO_IS_AIX\n+ALL_LOCAL_DEPS = add-aix-fat-library\n+else\n+ALL_LOCAL_DEPS =\n+endif\n+all-local: $(ALL_LOCAL_DEPS)\n+\n+MAJOR=$(firstword $(subst :, ,$(libtool_VERSION)))\n+add-aix-fat-library: all-multi\n+    @if test \"$(MULTIBUILDTOP)\" = \"\"; then \\\n+        ${AR} -X$(AIX_DEFAULT_ARCH) rc .libs/$(PACKAGE).a ../ppc$(AIX_DEFAULT_ARCH)/$(PACKAGE)/.libs/$(PACKAGE).so.$(MAJOR); \\\n+        ${AR} -X$(AIX_DEFAULT_ARCH) rc ../pthread/$(PACKAGE)/.libs/$(PACKAGE).a ../pthread/ppc$(AIX_DEFAULT_ARCH)/$(PACKAGE)/.libs/$(PACKAGE).so.$(MAJOR); \\\n+    fi"}, {"sha": "5cb44841c78bd2f06ab383b5b7a529bfdce74839", "filename": "libgo/Makefile.in", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2FMakefile.in?ref=83cc5e2b2f887d4bb2305658da382a65fdcaab29", "patch": "@@ -377,6 +377,7 @@ CTAGS = ctags\n CSCOPE = cscope\n DIST_SUBDIRS = testsuite\n ACLOCAL = @ACLOCAL@\n+AIX_DEFAULT_ARCH = @AIX_DEFAULT_ARCH@\n ALLGOARCH = @ALLGOARCH@\n ALLGOARCHFAMILY = @ALLGOARCHFAMILY@\n ALLGOOS = @ALLGOOS@\n@@ -1160,6 +1161,9 @@ MULTIDIRS =\n MULTISUBDIR = \n MULTIDO = true\n MULTICLEAN = true\n+@LIBGO_IS_AIX_FALSE@ALL_LOCAL_DEPS = \n+@LIBGO_IS_AIX_TRUE@ALL_LOCAL_DEPS = add-aix-fat-library\n+MAJOR = $(firstword $(subst :, ,$(libtool_VERSION)))\n all: config.h\n \t$(MAKE) $(AM_MAKEFLAGS) all-recursive\n \n@@ -3080,6 +3084,12 @@ mostlyclean-local: mostlyclean-multi\n clean-local: clean-multi\n distclean-local: distclean-multi\n maintainer-clean-local: maintainer-clean-multi\n+all-local: $(ALL_LOCAL_DEPS)\n+add-aix-fat-library: all-multi\n+\t@if test \"$(MULTIBUILDTOP)\" = \"\"; then \\\n+\t\t${AR} -X$(AIX_DEFAULT_ARCH) rc .libs/$(PACKAGE).a ../ppc$(AIX_DEFAULT_ARCH)/$(PACKAGE)/.libs/$(PACKAGE).so.$(MAJOR); \\\n+\t\t${AR} -X$(AIX_DEFAULT_ARCH) rc ../pthread/$(PACKAGE)/.libs/$(PACKAGE).a ../pthread/ppc$(AIX_DEFAULT_ARCH)/$(PACKAGE)/.libs/$(PACKAGE).so.$(MAJOR); \\\n+\tfi\n \n # Tell versions [3.59,3.63) of GNU make to not export all variables.\n # Otherwise a system limit (for SysV at least) may be exceeded."}, {"sha": "67470acbadba9125530b0f105dd7f30f3503d97b", "filename": "libgo/configure", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fconfigure?ref=83cc5e2b2f887d4bb2305658da382a65fdcaab29", "patch": "@@ -733,6 +733,7 @@ SED\n MAINT\n MAINTAINER_MODE_FALSE\n MAINTAINER_MODE_TRUE\n+AIX_DEFAULT_ARCH\n am__fastdepCCAS_FALSE\n am__fastdepCCAS_TRUE\n CCASDEPMODE\n@@ -4713,6 +4714,14 @@ case ${host} in\n     # static hash tables crashes on AIX when libgo is built with O2\n     CFLAGS=\"$CFLAGS -fno-section-anchors\"\n     GOCFLAGS=\"$GOCFLAGS -fno-section-anchors\"\n+\n+    # Check default architecture for FAT library creation\n+    if test -z \"`$(CC) -x c -E /dev/null -g3 -o - | grep 64BIT`\" ; then\n+        AIX_DEFAULT_ARCH='64'\n+    else\n+        AIX_DEFAULT_ARCH='32'\n+    fi\n+\n     ;;\n esac\n \n@@ -11492,7 +11501,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11495 \"configure\"\n+#line 11602 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11598,7 +11607,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11601 \"configure\"\n+#line 11708 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H"}, {"sha": "841cba1768eeb3f3e037794c915ef65f1f3a46e4", "filename": "libgo/configure.ac", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fconfigure.ac?ref=83cc5e2b2f887d4bb2305658da382a65fdcaab29", "patch": "@@ -36,6 +36,14 @@ case ${host} in\n     # static hash tables crashes on AIX when libgo is built with O2\n     CFLAGS=\"$CFLAGS -fno-section-anchors\"\n     GOCFLAGS=\"$GOCFLAGS -fno-section-anchors\"\n+\n+    # Check default architecture for FAT library creation\n+    if test -z \"`$(CC) -x c -E /dev/null -g3 -o - | grep 64BIT`\" ; then\n+        AIX_DEFAULT_ARCH='64'\n+    else\n+        AIX_DEFAULT_ARCH='32'\n+    fi\n+    AC_SUBST(AIX_DEFAULT_ARCH)\n     ;;\n esac\n "}, {"sha": "ae42fad38e50d8a8931569722533810393eecf5d", "filename": "libgo/testsuite/Makefile.in", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2Ftestsuite%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/83cc5e2b2f887d4bb2305658da382a65fdcaab29/libgo%2Ftestsuite%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Ftestsuite%2FMakefile.in?ref=83cc5e2b2f887d4bb2305658da382a65fdcaab29", "patch": "@@ -131,6 +131,7 @@ am__tagged_files = $(HEADERS) $(SOURCES) $(TAGS_FILES) $(LISP)\n DEJATOOL = $(PACKAGE)\n RUNTESTDEFAULTFLAGS = --tool $$tool --srcdir $$srcdir\n ACLOCAL = @ACLOCAL@\n+AIX_DEFAULT_ARCH = @AIX_DEFAULT_ARCH@\n ALLGOARCH = @ALLGOARCH@\n ALLGOARCHFAMILY = @ALLGOARCHFAMILY@\n ALLGOOS = @ALLGOOS@"}]}