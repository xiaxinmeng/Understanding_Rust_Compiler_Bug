{"sha": "39719c84006d2dc2873cef482de74755925e631f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Mzk3MTljODQwMDZkMmRjMjg3M2NlZjQ4MmRlNzQ3NTU5MjVlNjMxZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-01-04T11:23:16Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-01-04T11:23:16Z"}, "message": "re PR tree-optimization/59519 (ICE on valid code at -O3 on x86_64-linux-gnu in slpeel_update_phi_nodes_for_guard1, at tree-vect-loop-manip.c:486)\n\n\tPR tree-optimization/59519\n\t* tree-vect-loop-manip.c (slpeel_update_phi_nodes_for_guard1): Don't\n\tICE if get_current_def (current_new_name) is already non-NULL, as long\n\tas it is a phi result of some other phi in *new_exit_bb that has\n\tthe same argument.\n\n\t* gcc.dg/vect/pr59519-1.c: New test.\n\t* gcc.dg/vect/pr59519-2.c: New test.\n\nFrom-SVN: r206333", "tree": {"sha": "6ad38258eeb4e950de82db56f085a0ed7cf7ff77", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ad38258eeb4e950de82db56f085a0ed7cf7ff77"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/39719c84006d2dc2873cef482de74755925e631f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39719c84006d2dc2873cef482de74755925e631f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/39719c84006d2dc2873cef482de74755925e631f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/39719c84006d2dc2873cef482de74755925e631f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "dad5ed2eb152e85ae2ebb3582d57d895488011a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dad5ed2eb152e85ae2ebb3582d57d895488011a4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dad5ed2eb152e85ae2ebb3582d57d895488011a4"}], "stats": {"total": 62, "additions": 61, "deletions": 1}, "files": [{"sha": "9ce39739045a20984f150b55b0ec34f00ae98ccf", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39719c84006d2dc2873cef482de74755925e631f/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39719c84006d2dc2873cef482de74755925e631f/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=39719c84006d2dc2873cef482de74755925e631f", "patch": "@@ -1,5 +1,11 @@\n 2014-01-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/59519\n+\t* tree-vect-loop-manip.c (slpeel_update_phi_nodes_for_guard1): Don't\n+\tICE if get_current_def (current_new_name) is already non-NULL, as long\n+\tas it is a phi result of some other phi in *new_exit_bb that has\n+\tthe same argument.\n+\n \t* config/i386/sse.md (avx512f_load<mode>_mask): Emit vmovup{s,d}\n \tor vmovdqu* for misaligned_operand.\n \t(<sse>_loadu<ssemodesuffix><avxsizesuffix><mask_name>,"}, {"sha": "395607aa307752b77362446d960e0b31d07d0e19", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=39719c84006d2dc2873cef482de74755925e631f", "patch": "@@ -1,5 +1,9 @@\n 2014-01-04  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR tree-optimization/59519\n+\t* gcc.dg/vect/pr59519-1.c: New test.\n+\t* gcc.dg/vect/pr59519-2.c: New test.\n+\n \t* gcc.target/i386/avx512f-vmovdqu32-1.c: Allow vmovdqu64 instead of\n \tvmovdqu32.\n "}, {"sha": "428d4ec32e7b80214444b90a0f4967de623d4d88", "filename": "gcc/testsuite/gcc.dg/vect/pr59519-1.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr59519-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr59519-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr59519-1.c?ref=39719c84006d2dc2873cef482de74755925e631f", "patch": "@@ -0,0 +1,19 @@\n+/* PR tree-optimization/59519 */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-O3\" } */\n+\n+int a, b, c, d;\n+\n+void\n+foo (void)\n+{\n+  for (; d; d++)\n+    for (b = 0; b < 14; b++)\n+      {\n+\tc |= 1;\n+\tif (a)\n+\t  break;\n+      }\n+}\n+\n+/* { dg-final { cleanup-tree-dump \"vect\" } } */"}, {"sha": "2b109d2557d810601115aad6e447491871f47f8a", "filename": "gcc/testsuite/gcc.dg/vect/pr59519-2.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr59519-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr59519-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr59519-2.c?ref=39719c84006d2dc2873cef482de74755925e631f", "patch": "@@ -0,0 +1,20 @@\n+/* PR tree-optimization/59519 */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-O3\" } */\n+\n+struct S { int f0; } d;\n+int a[8] = { 0 }, b, c, e;\n+\n+void\n+foo (void)\n+{\n+  for (; e < 1; e++)\n+    for (b = 0; b < 7; b++)\n+      {\n+\tc |= (a[b + 1] != 0);\n+\tif (d.f0)\n+\t  break;\n+      }\n+}\n+\n+/* { dg-final { cleanup-tree-dump \"vect\" } } */"}, {"sha": "f68626171d147db29722f356cbb768574445be00", "filename": "gcc/tree-vect-loop-manip.c", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftree-vect-loop-manip.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/39719c84006d2dc2873cef482de74755925e631f/gcc%2Ftree-vect-loop-manip.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.c?ref=39719c84006d2dc2873cef482de74755925e631f", "patch": "@@ -483,7 +483,18 @@ slpeel_update_phi_nodes_for_guard1 (edge guard_edge, struct loop *loop,\n \t  if (!current_new_name)\n \t    continue;\n         }\n-      gcc_assert (get_current_def (current_new_name) == NULL_TREE);\n+      tree new_name = get_current_def (current_new_name);\n+      /* Because of peeled_chrec optimization it is possible that we have\n+\t set this earlier.  Verify the PHI has the same value.  */\n+      if (new_name)\n+\t{\n+\t  gimple phi = SSA_NAME_DEF_STMT (new_name);\n+\t  gcc_assert (gimple_code (phi) == GIMPLE_PHI\n+\t\t      && gimple_bb (phi) == *new_exit_bb\n+\t\t      && (PHI_ARG_DEF_FROM_EDGE (phi, single_exit (loop))\n+\t\t\t  == loop_arg));\n+\t  continue;\n+\t}\n \n       set_current_def (current_new_name, PHI_RESULT (new_phi));\n     }"}]}