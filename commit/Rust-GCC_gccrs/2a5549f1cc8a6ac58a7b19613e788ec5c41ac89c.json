{"sha": "2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c", "node_id": "C_kwDOANBUbNoAKDJhNTU0OWYxY2M4YTZhYzU4YTdiMTk2MTNlNzg4ZWM1YzQxYWM4OWM", "commit": {"author": {"name": "Andrew Pinski", "email": "apinski@marvell.com", "date": "2022-08-15T22:48:25Z"}, "committer": {"name": "Andrew Pinski", "email": "apinski@marvell.com", "date": "2022-08-24T19:15:33Z"}, "message": "[RISCV] Add constraints for not_single_bit_mask_operand/single_bit_mask_operand\n\nLike a previous patch, just add constraints for predicates\nnot_single_bit_mask_operand and single_bit_mask_operand.\n\nOK? Built and tested for riscv32-linux-gnu and riscv64-linux-gnu.\n\nThanks,\nAndrew Pinski\n\ngcc/ChangeLog:\n\n\t* config/riscv/constraints.md (DbS): New constraint.\n\t(DnS): New constraint.\n\t* config/riscv/bitmanip.md (*bset<mode>_1_mask): Use new constraint.\n\t(*bclr<mode>): Likewise.\n\t(*binvi<mode>): Likewise.", "tree": {"sha": "87e3434af149560729f5679960189ce309378693", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/87e3434af149560729f5679960189ce309378693"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c/comments", "author": {"login": "apinski-cavium", "id": 6335315, "node_id": "MDQ6VXNlcjYzMzUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6335315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apinski-cavium", "html_url": "https://github.com/apinski-cavium", "followers_url": "https://api.github.com/users/apinski-cavium/followers", "following_url": "https://api.github.com/users/apinski-cavium/following{/other_user}", "gists_url": "https://api.github.com/users/apinski-cavium/gists{/gist_id}", "starred_url": "https://api.github.com/users/apinski-cavium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apinski-cavium/subscriptions", "organizations_url": "https://api.github.com/users/apinski-cavium/orgs", "repos_url": "https://api.github.com/users/apinski-cavium/repos", "events_url": "https://api.github.com/users/apinski-cavium/events{/privacy}", "received_events_url": "https://api.github.com/users/apinski-cavium/received_events", "type": "User", "site_admin": false}, "committer": {"login": "apinski-cavium", "id": 6335315, "node_id": "MDQ6VXNlcjYzMzUzMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/6335315?v=4", "gravatar_id": "", "url": "https://api.github.com/users/apinski-cavium", "html_url": "https://github.com/apinski-cavium", "followers_url": "https://api.github.com/users/apinski-cavium/followers", "following_url": "https://api.github.com/users/apinski-cavium/following{/other_user}", "gists_url": "https://api.github.com/users/apinski-cavium/gists{/gist_id}", "starred_url": "https://api.github.com/users/apinski-cavium/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/apinski-cavium/subscriptions", "organizations_url": "https://api.github.com/users/apinski-cavium/orgs", "repos_url": "https://api.github.com/users/apinski-cavium/repos", "events_url": "https://api.github.com/users/apinski-cavium/events{/privacy}", "received_events_url": "https://api.github.com/users/apinski-cavium/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2c721ea9473ad7615bb47b66509097bd254bb839", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2c721ea9473ad7615bb47b66509097bd254bb839", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2c721ea9473ad7615bb47b66509097bd254bb839"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "2c0c8bb7f30c952595fbe389e1cb038adf851c9d", "filename": "gcc/config/riscv/bitmanip.md", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c/gcc%2Fconfig%2Friscv%2Fbitmanip.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c/gcc%2Fconfig%2Friscv%2Fbitmanip.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Fbitmanip.md?ref=2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c", "patch": "@@ -324,7 +324,7 @@\n (define_insn \"*bseti<mode>\"\n   [(set (match_operand:X 0 \"register_operand\" \"=r\")\n \t(ior:X (match_operand:X 1 \"register_operand\" \"r\")\n-\t       (match_operand 2 \"single_bit_mask_operand\" \"i\")))]\n+\t       (match_operand:X 2 \"single_bit_mask_operand\" \"DbS\")))]\n   \"TARGET_ZBS\"\n   \"bseti\\t%0,%1,%S2\"\n   [(set_attr \"type\" \"bitmanip\")])\n@@ -341,7 +341,7 @@\n (define_insn \"*bclri<mode>\"\n   [(set (match_operand:X 0 \"register_operand\" \"=r\")\n \t(and:X (match_operand:X 1 \"register_operand\" \"r\")\n-\t       (match_operand 2 \"not_single_bit_mask_operand\" \"i\")))]\n+\t       (match_operand:X 2 \"not_single_bit_mask_operand\" \"DnS\")))]\n   \"TARGET_ZBS\"\n   \"bclri\\t%0,%1,%T2\"\n   [(set_attr \"type\" \"bitmanip\")])\n@@ -358,7 +358,7 @@\n (define_insn \"*binvi<mode>\"\n   [(set (match_operand:X 0 \"register_operand\" \"=r\")\n \t(xor:X (match_operand:X 1 \"register_operand\" \"r\")\n-\t       (match_operand 2 \"single_bit_mask_operand\" \"i\")))]\n+\t       (match_operand:X 2 \"single_bit_mask_operand\" \"DbS\")))]\n   \"TARGET_ZBS\"\n   \"binvi\\t%0,%1,%S2\"\n   [(set_attr \"type\" \"bitmanip\")])"}, {"sha": "2873d533cb5af0477079e97286f9109946c44b5a", "filename": "gcc/config/riscv/constraints.md", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c/gcc%2Fconfig%2Friscv%2Fconstraints.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c/gcc%2Fconfig%2Friscv%2Fconstraints.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Fconstraints.md?ref=2a5549f1cc8a6ac58a7b19613e788ec5c41ac89c", "patch": "@@ -72,6 +72,16 @@\n   (and (match_code \"const_int\")\n        (match_test \"ival == 63\")))\n \n+(define_constraint \"DbS\"\n+  \"@internal\"\n+  (and (match_code \"const_int\")\n+       (match_test \"SINGLE_BIT_MASK_OPERAND (ival)\")))\n+\n+(define_constraint \"DnS\"\n+  \"@internal\"\n+  (and (match_code \"const_int\")\n+       (match_test \"SINGLE_BIT_MASK_OPERAND (~ival)\")))\n+\n ;; Floating-point constant +0.0, used for FCVT-based moves when FMV is\n ;; not available in RV32.\n (define_constraint \"G\""}]}