{"sha": "9766135bb18d75cd0d5257d21de485e953e3505e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTc2NjEzNWJiMThkNzVjZDBkNTI1N2QyMWRlNDg1ZTk1M2UzNTA1ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-01-03T20:59:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-01-03T20:59:20Z"}, "message": "re PR rtl-optimization/47157 (ICE: in calc_dfs_tree, at dominance.c:395 with -O)\n\n\tPR rtl-optimization/47157\n\t* combine.c (try_combine): If undobuf.other_insn becomes\n\t(set (pc) (pc)) jump, call update_cfg_for_uncondjump on it\n\tand set *new_direct_jump_p too.\n\n\t* gcc.c-torture/compile/pr47157.c: New test.\n\nFrom-SVN: r168439", "tree": {"sha": "a5d208c43ab55221a90b175688171ca074b3ad73", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a5d208c43ab55221a90b175688171ca074b3ad73"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9766135bb18d75cd0d5257d21de485e953e3505e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9766135bb18d75cd0d5257d21de485e953e3505e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9766135bb18d75cd0d5257d21de485e953e3505e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9766135bb18d75cd0d5257d21de485e953e3505e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d652f226fca1e942b7851d1205f8a6a472d9e0a0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d652f226fca1e942b7851d1205f8a6a472d9e0a0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d652f226fca1e942b7851d1205f8a6a472d9e0a0"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "62bd11e655a3cb88e59e8e9e76b8639de10bd2b9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9766135bb18d75cd0d5257d21de485e953e3505e", "patch": "@@ -1,3 +1,10 @@\n+2011-01-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/47157\n+\t* combine.c (try_combine): If undobuf.other_insn becomes\n+\t(set (pc) (pc)) jump, call update_cfg_for_uncondjump on it\n+\tand set *new_direct_jump_p too.\n+\n 2011-01-03  Sebastian Pop  <sebastian.pop@amd.com>\n \n \tPR tree-optimization/47021"}, {"sha": "3ee53e6ccd9637b915cd5a7511b75f1ff91b3e0c", "filename": "gcc/combine.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=9766135bb18d75cd0d5257d21de485e953e3505e", "patch": "@@ -1,7 +1,7 @@\n /* Optimize by combining instructions for GNU compiler.\n    Copyright (C) 1987, 1988, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010\n-   Free Software Foundation, Inc.\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,\n+   2011 Free Software Foundation, Inc.\n \n This file is part of GCC.\n \n@@ -4378,6 +4378,15 @@ try_combine (rtx i3, rtx i2, rtx i1, rtx i0, int *new_direct_jump_p)\n       update_cfg_for_uncondjump (i3);\n     }\n \n+  if (undobuf.other_insn != NULL_RTX\n+      && GET_CODE (PATTERN (undobuf.other_insn)) == SET\n+      && SET_SRC (PATTERN (undobuf.other_insn)) == pc_rtx\n+      && SET_DEST (PATTERN (undobuf.other_insn)) == pc_rtx)\n+    {\n+      *new_direct_jump_p = 1;\n+      update_cfg_for_uncondjump (undobuf.other_insn);\n+    }\n+\n   combine_successes++;\n   undo_commit ();\n "}, {"sha": "910fa08c98c9ae76b9f5201fe6238a05387f7db2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9766135bb18d75cd0d5257d21de485e953e3505e", "patch": "@@ -1,3 +1,8 @@\n+2011-01-03  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/47157\n+\t* gcc.c-torture/compile/pr47157.c: New test.\n+\n 2011-01-03  Ulrich Weigand  <Ulrich.Weigand@de.ibm.com>\n \n \t* gcc.dg/torture/vector-shift2.c (schar): Define."}, {"sha": "0947a5f9a3eda2fe9536b1f816ac9dce70f25048", "filename": "gcc/testsuite/gcc.c-torture/compile/pr47157.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr47157.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9766135bb18d75cd0d5257d21de485e953e3505e/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr47157.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr47157.c?ref=9766135bb18d75cd0d5257d21de485e953e3505e", "patch": "@@ -0,0 +1,20 @@\n+/* PR rtl-optimization/47157 */\n+\n+struct S { unsigned a; unsigned b; } c = { 1, 0 };\n+unsigned long int e;\n+void bar (int);\n+int baz (void);\n+\n+static int\n+foo (int x, short y)\n+{\n+  return ((x ^ y) & ((x ^ (x ^ y) & ~__INT_MAX__) - y ^ y)) < 0 ? x : x - y;\n+}\n+\n+void\n+test (void)\n+{\n+  bar (foo (baz () != (c.a | c.b), -1L));\n+  for (e = 0; e; e = 1)\n+    ;\n+}"}]}