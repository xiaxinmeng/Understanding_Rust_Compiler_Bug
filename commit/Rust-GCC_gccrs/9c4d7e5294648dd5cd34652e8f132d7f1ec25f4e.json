{"sha": "9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWM0ZDdlNTI5NDY0OGRkNWNkMzQ2NTJlOGYxMzJkN2YxZWMyNWY0ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-06-10T15:15:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-06-10T15:15:18Z"}, "message": "re PR other/43838 (Incorrect output from abi::__cxa_demangle)\n\n\tPR other/43838\n\t* cp-demangle.c (struct d_print_info): Add flush_count field.\n\t(d_print_init): Initialize it to 0.\n\t(d_print_flush): Increment it.\n\t(d_print_comp): If needed flush before appending \", \".  Only\n\tdecrement dpi->len if no flushes happened during the recursive\n\tcall.\n\t* testsuite/demangle-expected: Add a test for this.\n\nFrom-SVN: r160554", "tree": {"sha": "f174971e55e9632277db22acbf4cb9e81140fd3c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f174971e55e9632277db22acbf4cb9e81140fd3c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1cb4261144d0e97c0f0faf79fbfa0230dcedaf63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1cb4261144d0e97c0f0faf79fbfa0230dcedaf63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1cb4261144d0e97c0f0faf79fbfa0230dcedaf63"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "ea95ca54a7014675d5d1c2b7b15de5d344b4018d", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "patch": "@@ -1,3 +1,14 @@\n+2010-06-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR other/43838\n+\t* cp-demangle.c (struct d_print_info): Add flush_count field.\n+\t(d_print_init): Initialize it to 0.\n+\t(d_print_flush): Increment it.\n+\t(d_print_comp): If needed flush before appending \", \".  Only\n+\tdecrement dpi->len if no flushes happened during the recursive\n+\tcall.\n+\t* testsuite/demangle-expected: Add a test for this.\n+\n 2010-06-08  Laurynas Biveinis  <laurynas.biveinis@gmail.com>\n \n \t* splay-tree.c: Update copyright years."}, {"sha": "d2d15e9b91aa83e85156b4340414766a8517bc89", "filename": "libiberty/cp-demangle.c", "status": "modified", "additions": 11, "deletions": 1, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/libiberty%2Fcp-demangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/libiberty%2Fcp-demangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcp-demangle.c?ref=9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "patch": "@@ -302,6 +302,8 @@ struct d_print_info\n   /* The current index into any template argument packs we are using\n      for printing.  */\n   int pack_index;\n+  /* Number of d_print_flush calls so far.  */\n+  unsigned long int flush_count;\n };\n \n #ifdef CP_DEMANGLE_DEBUG\n@@ -3285,6 +3287,7 @@ d_print_init (struct d_print_info *dpi, int options,\n   dpi->last_char = '\\0';\n   dpi->templates = NULL;\n   dpi->modifiers = NULL;\n+  dpi->flush_count = 0;\n \n   dpi->callback = callback;\n   dpi->opaque = opaque;\n@@ -3314,6 +3317,7 @@ d_print_flush (struct d_print_info *dpi)\n   dpi->buf[dpi->len] = '\\0';\n   dpi->callback (dpi->buf, dpi->len, dpi->opaque);\n   dpi->len = 0;\n+  dpi->flush_count++;\n }\n \n /* Append characters and buffers for printing.  */\n@@ -4047,12 +4051,18 @@ d_print_comp (struct d_print_info *dpi,\n       if (d_right (dc) != NULL)\n \t{\n \t  size_t len;\n+\t  unsigned long int flush_count;\n+\t  /* Make sure \", \" isn't flushed by d_append_string, otherwise\n+\t     dpi->len -= 2 wouldn't work.  */\n+\t  if (dpi->len >= sizeof (dpi->buf) - 2)\n+\t    d_print_flush (dpi);\n \t  d_append_string (dpi, \", \");\n \t  len = dpi->len;\n+\t  flush_count = dpi->flush_count;\n \t  d_print_comp (dpi, d_right (dc));\n \t  /* If that didn't print anything (which can happen with empty\n \t     template argument packs), remove the comma and space.  */\n-\t  if (dpi->len == len)\n+\t  if (dpi->flush_count == flush_count && dpi->len == len)\n \t    dpi->len -= 2;\n \t}\n       return;"}, {"sha": "15a0fe75509dd1f4b9800fa0d5f698dd99fb45ef", "filename": "libiberty/testsuite/demangle-expected", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/libiberty%2Ftestsuite%2Fdemangle-expected", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e/libiberty%2Ftestsuite%2Fdemangle-expected", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Ftestsuite%2Fdemangle-expected?ref=9c4d7e5294648dd5cd34652e8f132d7f1ec25f4e", "patch": "@@ -3951,6 +3951,9 @@ decltype (({parm#1}.(operator-))()) h<A>(A)\n --format=gnu-v3\n _Z1fDn\n f(decltype(nullptr))\n+--format=gnu-v3\n+_ZN5aaaaa6bbbbbb5cccccIN23ddddddddddddddddddddddd3eeeENS2_4ffff16ggggggggggggggggENS0_9hhhhhhhhhES6_S6_S6_S6_S6_S6_S6_EE\n+aaaaa::bbbbbb::ccccc<ddddddddddddddddddddddd::eee, ddddddddddddddddddddddd::ffff::gggggggggggggggg, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh, aaaaa::bbbbbb::hhhhhhhhh>\n #\n # Ada (GNAT) tests.\n #"}]}