{"sha": "4989673889a86eb98ffa1045984957e8e6900091", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDk4OTY3Mzg4OWE4NmViOThmZmExMDQ1OTg0OTU3ZThlNjkwMDA5MQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2005-10-11T19:18:24Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2005-10-11T19:18:24Z"}, "message": "re PR tree-optimization/24300 (segfault in operand_equal_p with -ftree-vectorize)\n\n        PR tree-opt/24300\n        * Makefile.in (tree-ssa-dce.o): Depend on CFGLOOP_H.\n        * tree-ssa-dce.c: Include cfgloop.h.\n        (tree_ssa_dce_loop, pass_dce_loop): New.\n        * tree-pass.h (pass_dce_loop): Declare it.\n        * passes.c (init_optimization_passes): Use it.\n\nFrom-SVN: r105250", "tree": {"sha": "353917f75a114dab0d531ae6c3d4e0f631715ec8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/353917f75a114dab0d531ae6c3d4e0f631715ec8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4989673889a86eb98ffa1045984957e8e6900091", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4989673889a86eb98ffa1045984957e8e6900091", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4989673889a86eb98ffa1045984957e8e6900091", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4989673889a86eb98ffa1045984957e8e6900091/comments", "author": null, "committer": null, "parents": [{"sha": "5e8b5b0868f23c72e9a4789196c60d076f2ef580", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5e8b5b0868f23c72e9a4789196c60d076f2ef580", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5e8b5b0868f23c72e9a4789196c60d076f2ef580"}], "stats": {"total": 82, "additions": 75, "deletions": 7}, "files": [{"sha": "091ceb80c1aefb01a05893f9af9950c8911b475e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4989673889a86eb98ffa1045984957e8e6900091/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4989673889a86eb98ffa1045984957e8e6900091/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4989673889a86eb98ffa1045984957e8e6900091", "patch": "@@ -1,3 +1,12 @@\n+2005-10-11  Richard Henderson  <rth@redhat.com>\n+\n+\tPR tree-opt/24300\n+\t* Makefile.in (tree-ssa-dce.o): Depend on CFGLOOP_H.\n+\t* tree-ssa-dce.c: Include cfgloop.h.\n+\t(tree_ssa_dce_loop, pass_dce_loop): New.\n+\t* tree-pass.h (pass_dce_loop): Declare it.\n+\t* passes.c (init_optimization_passes): Use it.\n+\n 2005-10-11  Eric Botcazou  <ebotcazou@libertysurf.fr>\n \n \tPR middle-end/24263 "}, {"sha": "e72eef9338a097304196dfa45049340de686332b", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4989673889a86eb98ffa1045984957e8e6900091/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4989673889a86eb98ffa1045984957e8e6900091/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=4989673889a86eb98ffa1045984957e8e6900091", "patch": "@@ -2230,7 +2230,7 @@ mode-switching.o : mode-switching.c $(CONFIG_H) $(SYSTEM_H) coretypes.h \\\n tree-ssa-dce.o : tree-ssa-dce.c $(CONFIG_H) $(SYSTEM_H) $(TREE_H) \\\n     $(RTL_H) $(TM_P_H) $(TREE_FLOW_H) $(DIAGNOSTIC_H) $(TIMEVAR_H) $(TM_H) \\\n     coretypes.h $(TREE_DUMP_H) tree-pass.h $(FLAGS_H) $(BASIC_BLOCK_H) \\\n-    $(GGC_H) hard-reg-set.h $(OBSTACK_H) $(TREE_GIMPLE_H)\n+    $(GGC_H) hard-reg-set.h $(OBSTACK_H) $(TREE_GIMPLE_H) $(CFGLOOP_H)\n tree-ssa-ccp.o : tree-ssa-ccp.c $(TREE_FLOW_H) $(CONFIG_H) \\\n    $(SYSTEM_H) $(RTL_H) $(TREE_H) $(TM_P_H) $(EXPR_H) $(GGC_H) output.h \\\n    $(DIAGNOSTIC_H) function.h $(TIMEVAR_H) $(TM_H) coretypes.h \\"}, {"sha": "0053f70dcce40313b89b6d51242cf198147586e5", "filename": "gcc/passes.c", "status": "modified", "additions": 1, "deletions": 6, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Fpasses.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Fpasses.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpasses.c?ref=4989673889a86eb98ffa1045984957e8e6900091", "patch": "@@ -595,12 +595,7 @@ init_optimization_passes (void)\n \n   p = &pass_vectorize.sub;\n   NEXT_PASS (pass_lower_vector_ssa);\n-  /* ??? The loop optimizers are not GC safe.  See PR 21805.\n-     Turn off GC while registering this pass.  */\n-  pass_dce.todo_flags_finish &= ~TODO_ggc_collect;\n-  NEXT_PASS (pass_dce);\n-  pass_dce.todo_flags_finish |= TODO_ggc_collect;\n-  gcc_assert (p != &pass_dce.next);\n+  NEXT_PASS (pass_dce_loop);\n   *p = NULL;\n \n   p = &pass_loop2.sub;"}, {"sha": "26eae81af21053378f7c4bd64298f74456124341", "filename": "gcc/testsuite/gcc.dg/vect/pr24300.c", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr24300.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr24300.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fpr24300.c?ref=4989673889a86eb98ffa1045984957e8e6900091", "patch": "@@ -0,0 +1,35 @@\n+/* { dg-do compile } */\n+\n+static int *** foo (int);\n+\n+void\n+bar ()\n+{\n+  int ***p = foo (2);\n+}\n+\n+extern int *nd;\n+extern int ***tc;\n+extern int *ap;\n+extern int *as;\n+extern float ss;\n+\n+static int ***\n+foo (int Fc)\n+{\n+  int i, j, s, p, n, t;\n+\n+  n = 0;\n+  for (s = 0; s < 4; s++)\n+    n += nd[s];\n+\n+  for (i = 0; i < n; i++)\n+    {\n+      p = ap[i];\n+      s = as[i];\n+      for (j = 0; j < Fc; j++)\n+\ttc[p][s][j] = i * ss + j;\n+    }\n+\n+  return (tc);\n+}"}, {"sha": "1f45ffd57192d659423e74e9612a9fc2ecfcccd2", "filename": "gcc/tree-pass.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Ftree-pass.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Ftree-pass.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-pass.h?ref=4989673889a86eb98ffa1045984957e8e6900091", "patch": "@@ -243,6 +243,7 @@ extern struct tree_opt_pass pass_build_ssa;\n extern struct tree_opt_pass pass_del_ssa;\n extern struct tree_opt_pass pass_dominator;\n extern struct tree_opt_pass pass_dce;\n+extern struct tree_opt_pass pass_dce_loop;\n extern struct tree_opt_pass pass_cd_dce;\n extern struct tree_opt_pass pass_merge_phi;\n extern struct tree_opt_pass pass_may_alias;"}, {"sha": "6ad8cf26e5a951d285c9668db1b4f3c5b9718528", "filename": "gcc/tree-ssa-dce.c", "status": "modified", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Ftree-ssa-dce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4989673889a86eb98ffa1045984957e8e6900091/gcc%2Ftree-ssa-dce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-dce.c?ref=4989673889a86eb98ffa1045984957e8e6900091", "patch": "@@ -64,6 +64,7 @@ Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA\n #include \"tree-pass.h\"\n #include \"timevar.h\"\n #include \"flags.h\"\n+#include \"cfgloop.h\"\n \f\n static struct stmt_stats\n {\n@@ -941,6 +942,13 @@ tree_ssa_dce (void)\n   perform_tree_ssa_dce (/*aggressive=*/false);\n }\n \n+static void\n+tree_ssa_dce_loop (void)\n+{\n+  perform_tree_ssa_dce (/*aggressive=*/false);\n+  free_numbers_of_iterations_estimates (current_loops);\n+}\n+\n static void\n tree_ssa_cd_dce (void)\n {\n@@ -974,6 +982,26 @@ struct tree_opt_pass pass_dce =\n   0\t\t\t\t\t/* letter */\n };\n \n+struct tree_opt_pass pass_dce_loop =\n+{\n+  \"dceloop\",\t\t\t\t/* name */\n+  gate_dce,\t\t\t\t/* gate */\n+  tree_ssa_dce_loop,\t\t\t/* execute */\n+  NULL,\t\t\t\t\t/* sub */\n+  NULL,\t\t\t\t\t/* next */\n+  0,\t\t\t\t\t/* static_pass_number */\n+  TV_TREE_DCE,\t\t\t\t/* tv_id */\n+  PROP_cfg | PROP_ssa | PROP_alias,\t/* properties_required */\n+  0,\t\t\t\t\t/* properties_provided */\n+  0,\t\t\t\t\t/* properties_destroyed */\n+  0,\t\t\t\t\t/* todo_flags_start */\n+  TODO_dump_func \n+    | TODO_update_ssa_no_phi \n+    | TODO_cleanup_cfg\n+    | TODO_verify_ssa,\t\t\t/* todo_flags_finish */\n+  0\t\t\t\t\t/* letter */\n+};\n+\n struct tree_opt_pass pass_cd_dce =\n {\n   \"cddce\",\t\t\t\t/* name */"}]}