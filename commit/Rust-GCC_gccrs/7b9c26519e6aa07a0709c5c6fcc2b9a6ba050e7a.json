{"sha": "7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2I5YzI2NTE5ZTZhYTA3YTA3MDljNWM2ZmNjMmI5YTZiYTA1MGU3YQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2020-09-09T16:43:13Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2020-09-09T17:22:07Z"}, "message": "[nvptx, libgcc] Fix Wbuiltin-declaration-mismatch in atomic.c\n\nWhen building for target nvptx, we get this and similar warnings for libgcc:\n...\nsrc/libgcc/config/nvptx/atomic.c:39:1: warning: conflicting types for \\\n  built-in function \u2018__sync_val_compare_and_swap_1\u2019; expected \\\n  \u2018unsigned char(volatile void *, unsigned char,  unsigned char)\u2019 \\\n  [-Wbuiltin-declaration-mismatch]\n...\n\nFix this by making sure in atomic.c that the pointers used are of type\n'volatile void *'.\n\nTested by rebuilding atomic.c.\n\nlibgcc/ChangeLog:\n\n\t* config/nvptx/atomic.c (__SYNC_SUBWORD_COMPARE_AND_SWAP): Fix\n\tWbuiltin-declaration-mismatch.", "tree": {"sha": "694f4b91c7843b6ba15de43ae777d7ac5e7f1902", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/694f4b91c7843b6ba15de43ae777d7ac5e7f1902"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "69ca5f3a988266da8905aef9cf22aa02807e0471", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/69ca5f3a988266da8905aef9cf22aa02807e0471", "html_url": "https://github.com/Rust-GCC/gccrs/commit/69ca5f3a988266da8905aef9cf22aa02807e0471"}], "stats": {"total": 12, "additions": 8, "deletions": 4}, "files": [{"sha": "60f21f3ff7fc59fb61768593cc86cd638fdd8ba1", "filename": "libgcc/config/nvptx/atomic.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a/libgcc%2Fconfig%2Fnvptx%2Fatomic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a/libgcc%2Fconfig%2Fnvptx%2Fatomic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fnvptx%2Fatomic.c?ref=7b9c26519e6aa07a0709c5c6fcc2b9a6ba050e7a", "patch": "@@ -36,10 +36,13 @@\n #define __SYNC_SUBWORD_COMPARE_AND_SWAP(TYPE, SIZE)\t\t\t     \\\n \t\t\t\t\t\t\t\t\t     \\\n TYPE\t\t\t\t\t\t\t\t\t     \\\n-__sync_val_compare_and_swap_##SIZE (TYPE *ptr, TYPE oldval, TYPE newval)     \\\n+__sync_val_compare_and_swap_##SIZE (volatile void *vptr, TYPE oldval,\t     \\\n+\t\t\t\t    TYPE newval)\t\t\t     \\\n {\t\t\t\t\t\t\t\t\t     \\\n-  unsigned int *wordptr = (unsigned int *)((__UINTPTR_TYPE__ ) ptr & ~3UL);  \\\n-  int shift = ((__UINTPTR_TYPE__ ) ptr & 3UL) * 8;\t\t\t     \\\n+  volatile TYPE *ptr = vptr;\t\t\t\t\t\t     \\\n+  volatile unsigned int *wordptr\t\t\t\t\t     \\\n+    = (volatile unsigned int *)((__UINTPTR_TYPE__) ptr & ~3UL);\t     \\\n+  int shift = ((__UINTPTR_TYPE__) ptr & 3UL) * 8;\t\t\t     \\\n   unsigned int valmask = (1 << (SIZE * 8)) - 1;\t\t\t\t     \\\n   unsigned int wordmask = ~(valmask << shift);\t\t\t\t     \\\n   unsigned int oldword = *wordptr;\t\t\t\t\t     \\\n@@ -64,7 +67,8 @@ __sync_val_compare_and_swap_##SIZE (TYPE *ptr, TYPE oldval, TYPE newval)     \\\n }\t\t\t\t\t\t\t\t\t     \\\n \t\t\t\t\t\t\t\t\t     \\\n bool\t\t\t\t\t\t\t\t\t     \\\n-__sync_bool_compare_and_swap_##SIZE (TYPE *ptr, TYPE oldval, TYPE newval)    \\\n+__sync_bool_compare_and_swap_##SIZE (volatile void *ptr, TYPE oldval,\t     \\\n+\t\t\t\t     TYPE newval)\t\t\t     \\\n {\t\t\t\t\t\t\t\t\t     \\\n   return __sync_val_compare_and_swap_##SIZE (ptr, oldval, newval) == oldval; \\\n }"}]}