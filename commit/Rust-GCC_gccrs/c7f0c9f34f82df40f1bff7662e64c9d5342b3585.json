{"sha": "c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzdmMGM5ZjM0ZjgyZGY0MGYxYmZmNzY2MmU2NGM5ZDUzNDJiMzU4NQ==", "commit": {"author": {"name": "Michael Meissner", "email": "meissner@linux.vnet.ibm.com", "date": "2017-03-01T18:33:21Z"}, "committer": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "2017-03-01T18:33:21Z"}, "message": "re PR target/79439 (Missing nop instruction after recursive call corrupts TOC register)\n\n[gcc]\n2017-03-01  Michael Meissner  <meissner@linux.vnet.ibm.com>\n\n\tPR target/79439\n\t* config/rs6000/predicates.md (current_file_function_operand): Do\n\tnot allow self calls to be local if the function is replaceable.\n\n[gcc/testsuite]\n2017-03-01  Michael Meissner  <meissner@linux.vnet.ibm.com>\n\n\tPR target/79439\n\t* gcc.target/powerpc/pr79439.c: New test.\n\nFrom-SVN: r245813", "tree": {"sha": "956bfe58267a1acc98b592348be48dcf5371667f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/956bfe58267a1acc98b592348be48dcf5371667f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/comments", "author": null, "committer": null, "parents": [{"sha": "f5ef6bfc3049187c0d84e12ed676b1b74207a693", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5ef6bfc3049187c0d84e12ed676b1b74207a693", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5ef6bfc3049187c0d84e12ed676b1b74207a693"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "c4f879818a4cf2dd64d69dffc60e2d6a109bf813", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "patch": "@@ -1,3 +1,9 @@\n+2017-03-01  Michael Meissner  <meissner@linux.vnet.ibm.com>\n+\n+\tPR target/79439\n+\t* config/rs6000/predicates.md (current_file_function_operand): Do\n+\tnot allow self calls to be local if the function is replaceable.\n+\n 2017-03-01  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n \n \tPR target/79395"}, {"sha": "eb9321bf5cd3445acd1c4c14f10f3b9793d61a24", "filename": "gcc/config/rs6000/predicates.md", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2Fconfig%2Frs6000%2Fpredicates.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2Fconfig%2Frs6000%2Fpredicates.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fpredicates.md?ref=c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "patch": "@@ -1110,7 +1110,8 @@\n   (and (match_code \"symbol_ref\")\n        (match_test \"(DEFAULT_ABI != ABI_AIX || SYMBOL_REF_FUNCTION_P (op))\n \t\t    && (SYMBOL_REF_LOCAL_P (op)\n-\t\t\t|| op == XEXP (DECL_RTL (current_function_decl), 0))\n+\t\t\t|| (op == XEXP (DECL_RTL (current_function_decl), 0)\n+\t\t\t    && !decl_replaceable_p (current_function_decl)))\n \t\t    && !((DEFAULT_ABI == ABI_AIX\n \t\t\t  || DEFAULT_ABI == ABI_ELFv2)\n \t\t\t && (SYMBOL_REF_EXTERNAL_P (op)"}, {"sha": "b3ba66bc7c9cc6564b296aa5c606a938d0732487", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "patch": "@@ -1,3 +1,8 @@\n+2017-03-01  Michael Meissner  <meissner@linux.vnet.ibm.com>\n+\n+\tPR target/79439\n+\t* gcc.target/powerpc/pr79439.c: New test.\n+\n 2017-03-01  Pat Haugen  <pthaugen@us.ibm.com>\n \n \t* gcc.target/powerpc/pr79544.c: Add test for vec_vsrad and fix up"}, {"sha": "23c9a24fdc3887574c0763dbe7a9dcc5fec55b80", "filename": "gcc/testsuite/gcc.target/powerpc/pr79439.c", "status": "added", "additions": 29, "deletions": 0, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr79439.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7f0c9f34f82df40f1bff7662e64c9d5342b3585/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr79439.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Fpr79439.c?ref=c7f0c9f34f82df40f1bff7662e64c9d5342b3585", "patch": "@@ -0,0 +1,29 @@\n+/* { dg-do compile { target { powerpc64*-*-linux* && lp64 } } } */\n+/* { dg-options \"-O2 -fpic\" } */\n+\n+/* On the Linux 64-bit ABIs, we should not eliminate NOP in the 'rec' call if\n+   -fpic is used because rec can be interposed at link time (since it is\n+   external), and the recursive call should call the interposed function.  The\n+   Linux 32-bit ABIs do not require NOPs after the BL instruction.  */\n+\n+int f (void);\n+\n+void\n+g (void)\n+{\n+}\n+\n+int\n+rec (int a)\n+{\n+  int ret = 0;\n+  if (a > 10 && f ())\n+    ret += rec (a - 1);\n+  g ();\n+  return a + ret;\n+}\n+\n+/* { dg-final { scan-assembler-times {\\mbl f\\M}   1 } } */\n+/* { dg-final { scan-assembler-times {\\mbl g\\M}   1 } } */\n+/* { dg-final { scan-assembler-times {\\mbl rec\\M} 1 } } */\n+/* { dg-final { scan-assembler-times {\\mnop\\M}    3 } } */"}]}