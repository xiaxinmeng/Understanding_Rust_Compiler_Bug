{"sha": "a93952d2bee108c94f802aa14be0348bcf4bcb29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTkzOTUyZDJiZWUxMDhjOTRmODAyYWExNGJlMDM0OGJjZjRiY2IyOQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-09-22T18:56:23Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-09-22T18:56:23Z"}, "message": "re PR middle-end/35691 (Missed (a == 0) && (b == 0) into (a|(typeof(a)(b)) == 0 when the types don't match)\n\n\tPR middle-end/35691\n\t* match.pd: Simplify x == -1 & y == -1 into (x & y) == -1\n\tand x != -1 | y != -1 into (x & y) != -1.\n\n\t* gcc.dg/pr35691-1.c: Use -fdump-tree-forwprop1-details\n\tinstead of -fdump-tree-forwprop-details in dg-options.\n\t* gcc.dg/pr35691-2.c: Likewise.\n\t* gcc.dg/pr35691-3.c: New test.\n\t* gcc.dg/pr35691-4.c: New test.\n\nFrom-SVN: r253107", "tree": {"sha": "849d3a7452f4b4b9d765e628ec63a4a5f3f199f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/849d3a7452f4b4b9d765e628ec63a4a5f3f199f4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a93952d2bee108c94f802aa14be0348bcf4bcb29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a93952d2bee108c94f802aa14be0348bcf4bcb29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a93952d2bee108c94f802aa14be0348bcf4bcb29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a93952d2bee108c94f802aa14be0348bcf4bcb29/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2dc589be3cb487eda8f537c535cab0f5a9a4a6a1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dc589be3cb487eda8f537c535cab0f5a9a4a6a1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2dc589be3cb487eda8f537c535cab0f5a9a4a6a1"}], "stats": {"total": 62, "additions": 54, "deletions": 8}, "files": [{"sha": "af92ec3424d098608ad248c9f8793a64e8ee9350", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -1,3 +1,9 @@\n+2017-09-22  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR middle-end/35691\n+\t* match.pd: Simplify x == -1 & y == -1 into (x & y) == -1\n+\tand x != -1 | y != -1 into (x & y) != -1.\n+\n 2017-09-22  Steve Ellcey  <sellcey@cavium.com>\n \n \t* config.gcc: Add new case statement to set"}, {"sha": "0863273b244fa1d50c340b9bb722b6e9a95b6516", "filename": "gcc/match.pd", "status": "modified", "additions": 15, "deletions": 6, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Fmatch.pd", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Fmatch.pd", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fmatch.pd?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -630,17 +630,26 @@ DEFINE_INT_AND_FLOAT_ROUND_FN (RINT)\n   (if (TYPE_UNSIGNED (type))\n     (bit_and @0 (bit_not (lshift { build_all_ones_cst (type); } @1)))))\n \n-/* PR35691: Transform\n-   (x == 0 & y == 0) -> (x | typeof(x)(y)) == 0.\n-   (x != 0 | y != 0) -> (x | typeof(x)(y)) != 0.  */\n (for bitop (bit_and bit_ior)\n      cmp (eq ne)\n+ /* PR35691: Transform\n+    (x == 0 & y == 0) -> (x | typeof(x)(y)) == 0.\n+    (x != 0 | y != 0) -> (x | typeof(x)(y)) != 0.  */\n  (simplify\n   (bitop (cmp @0 integer_zerop@2) (cmp @1 integer_zerop))\n    (if (INTEGRAL_TYPE_P (TREE_TYPE (@0))\n-       && INTEGRAL_TYPE_P (TREE_TYPE (@1))\n-       && TYPE_PRECISION (TREE_TYPE (@0)) == TYPE_PRECISION (TREE_TYPE (@1)))\n-    (cmp (bit_ior @0 (convert @1)) @2))))\n+\t&& INTEGRAL_TYPE_P (TREE_TYPE (@1))\n+\t&& TYPE_PRECISION (TREE_TYPE (@0)) == TYPE_PRECISION (TREE_TYPE (@1)))\n+    (cmp (bit_ior @0 (convert @1)) @2)))\n+ /* Transform:\n+    (x == -1 & y == -1) -> (x & typeof(x)(y)) == -1.\n+    (x != -1 | y != -1) -> (x & typeof(x)(y)) != -1.  */\n+ (simplify\n+  (bitop (cmp @0 integer_all_onesp@2) (cmp @1 integer_all_onesp))\n+   (if (INTEGRAL_TYPE_P (TREE_TYPE (@0))\n+\t&& INTEGRAL_TYPE_P (TREE_TYPE (@1))\n+\t&& TYPE_PRECISION (TREE_TYPE (@0)) == TYPE_PRECISION (TREE_TYPE (@1)))\n+    (cmp (bit_and @0 (convert @1)) @2))))\n \n /* Fold (A & ~B) - (A & B) into (A ^ B) - B.  */\n (simplify"}, {"sha": "6bdfdfedda15d32bc98a7b1822564fbacc3dc8bd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -1,5 +1,12 @@\n 2017-09-22  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/35691\n+\t* gcc.dg/pr35691-1.c: Use -fdump-tree-forwprop1-details\n+\tinstead of -fdump-tree-forwprop-details in dg-options.\n+\t* gcc.dg/pr35691-2.c: Likewise.\n+\t* gcc.dg/pr35691-3.c: New test.\n+\t* gcc.dg/pr35691-4.c: New test.\n+\n \tPR sanitizer/81929\n \t* g++.dg/ubsan/pr81929.C: New test.\n "}, {"sha": "34dc02ab560bf48df5c7e24b21061a16236c929a", "filename": "gcc/testsuite/gcc.dg/pr35691-1.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-1.c?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -fdump-tree-forwprop-details\" } */\n+/* { dg-options \"-O2 -fdump-tree-forwprop1-details\" } */\n \n int foo(int z0, unsigned z1)\n {"}, {"sha": "b89ce481c6cb7d20f3cb59d2e0a26e1aa3726023", "filename": "gcc/testsuite/gcc.dg/pr35691-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-2.c?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -fdump-tree-forwprop-details\" } */\n+/* { dg-options \"-O2 -fdump-tree-forwprop1-details\" } */\n \n int foo(int z0, unsigned z1)\n {"}, {"sha": "75b49a6e2ca057f182fd0082727062184cb96ffc", "filename": "gcc/testsuite/gcc.dg/pr35691-3.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-3.c?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-forwprop1-details\" } */\n+\n+int foo(int z0, unsigned z1)\n+{\n+  int t0 = (z0 == -1);\n+  int t1 = (z1 == -1U);\n+  int t2 = (t0 & t1);\n+  return t2;\n+}\n+\n+/* { dg-final { scan-tree-dump \"gimple_simplified to _\\[0-9\\]* = \\\\(int\\\\) z1_\\[0-9\\]*\\\\(D\\\\);\" \"forwprop1\" } } */"}, {"sha": "2d9456bd16f6bfb451b343f4e700d159c6868a4a", "filename": "gcc/testsuite/gcc.dg/pr35691-4.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a93952d2bee108c94f802aa14be0348bcf4bcb29/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr35691-4.c?ref=a93952d2bee108c94f802aa14be0348bcf4bcb29", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-forwprop1-details\" } */\n+\n+int foo(int z0, unsigned z1)\n+{\n+  int t0 = (z0 != -1);\n+  int t1 = (z1 != -1U);\n+  int t2 = (t0 | t1);\n+  return t2;\n+}\n+\n+/* { dg-final { scan-tree-dump \"gimple_simplified to _\\[0-9\\]* = \\\\(int\\\\) z1_\\[0-9\\]*\\\\(D\\\\);\" \"forwprop1\" } } */"}]}