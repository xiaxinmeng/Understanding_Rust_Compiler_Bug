{"sha": "30251f7a3a5406def690197174f9769cecf152c8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzAyNTFmN2EzYTU0MDZkZWY2OTAxOTcxNzRmOTc2OWNlY2YxNTJjOA==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "dvorakz@suse.cz", "date": "2007-04-27T20:40:26Z"}, "committer": {"name": "Zdenek Dvorak", "email": "rakdver@gcc.gnu.org", "date": "2007-04-27T20:40:26Z"}, "message": "tree-cfgcleanup.c (cleanup_tree_cfg): Verify dominance info if it claims to be available.\n\n\t* tree-cfgcleanup.c (cleanup_tree_cfg): Verify dominance info\n\tif it claims to be available.\n\t* tree-ssa-dce.c (remove_dead_stmt): Mark cfg as altered when\n\tedge is redirected.\n\t(perform_tree_ssa_dce): Always free postdominators.\n\nFrom-SVN: r124236", "tree": {"sha": "087570880b62309f6060a8d11007bfeccdbbb2b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/087570880b62309f6060a8d11007bfeccdbbb2b6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/30251f7a3a5406def690197174f9769cecf152c8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30251f7a3a5406def690197174f9769cecf152c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/30251f7a3a5406def690197174f9769cecf152c8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/30251f7a3a5406def690197174f9769cecf152c8/comments", "author": null, "committer": null, "parents": [{"sha": "e1535fe0c5c04202d35b11c818205f5577870cc1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e1535fe0c5c04202d35b11c818205f5577870cc1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e1535fe0c5c04202d35b11c818205f5577870cc1"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "b50c1aab5fcc54f3768c599b28b20a13bdd3e49c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/30251f7a3a5406def690197174f9769cecf152c8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/30251f7a3a5406def690197174f9769cecf152c8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=30251f7a3a5406def690197174f9769cecf152c8", "patch": "@@ -1,3 +1,11 @@\n+2007-04-27  Zdenek Dvorak  <dvorakz@suse.cz>\n+\n+\t* tree-cfgcleanup.c (cleanup_tree_cfg): Verify dominance info\n+\tif it claims to be available.\n+\t* tree-ssa-dce.c (remove_dead_stmt): Mark cfg as altered when\n+\tedge is redirected.\n+\t(perform_tree_ssa_dce): Always free postdominators.\n+\n 2007-04-27  Richard Henderson  <rth@redhat.com>\n \n \t* config/alpha/predicates.md (aligned_memory_operand): Mark"}, {"sha": "aaf6ce8ee268c97a1ab6cd83a46e595de617d0aa", "filename": "gcc/tree-cfgcleanup.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/30251f7a3a5406def690197174f9769cecf152c8/gcc%2Ftree-cfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/30251f7a3a5406def690197174f9769cecf152c8/gcc%2Ftree-cfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfgcleanup.c?ref=30251f7a3a5406def690197174f9769cecf152c8", "patch": "@@ -615,7 +615,12 @@ cleanup_tree_cfg (void)\n       calculate_dominance_info (CDI_DOMINATORS);\n     }\n   else\n-    changed = false;\n+    {\n+#ifdef ENABLE_CHECKING\n+      verify_dominators (CDI_DOMINATORS);\n+#endif\n+      changed = false;\n+    }\n \n   changed |= cleanup_tree_cfg_1 ();\n "}, {"sha": "7da5cdffbb0cb1393113bbb505137e54a3fd8bac", "filename": "gcc/tree-ssa-dce.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/30251f7a3a5406def690197174f9769cecf152c8/gcc%2Ftree-ssa-dce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/30251f7a3a5406def690197174f9769cecf152c8/gcc%2Ftree-ssa-dce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-dce.c?ref=30251f7a3a5406def690197174f9769cecf152c8", "patch": "@@ -607,7 +607,6 @@ remove_dead_stmt (block_stmt_iterator *i, basic_block bb)\n \t 3. If the post dominator has PHI nodes we may be able to compute\n \t    the right PHI args for them.\n \n-\n \t In each of these cases we must remove the control statement\n \t as it may reference SSA_NAMEs which are going to be removed and\n \t we remove all but one outgoing edge from the block.  */\n@@ -620,6 +619,11 @@ remove_dead_stmt (block_stmt_iterator *i, basic_block bb)\n \t  /* Redirect the first edge out of BB to reach POST_DOM_BB.  */\n \t  redirect_edge_and_branch (EDGE_SUCC (bb, 0), post_dom_bb);\n \t  PENDING_STMT (EDGE_SUCC (bb, 0)) = NULL;\n+\n+\t  /* It is not sufficient to set cfg_altered below during edge\n+\t     removal, in case BB has two successors and one of them\n+\t     is POST_DOM_BB.  */\n+\t  cfg_altered = true;\n \t}\n       EDGE_SUCC (bb, 0)->probability = REG_BR_PROB_BASE;\n       EDGE_SUCC (bb, 0)->count = bb->count;\n@@ -718,6 +722,7 @@ eliminate_unnecessary_stmts (void)\n \t    }\n \t}\n     }\n+\n   return something_changed;\n }\n \n@@ -837,8 +842,8 @@ perform_tree_ssa_dce (bool aggressive)\n   something_changed |= eliminate_unnecessary_stmts ();\n   something_changed |= cfg_altered;\n \n-  if (aggressive && something_changed)\n-    free_dominance_info (CDI_POST_DOMINATORS);\n+  /* We do not update postdominators, so free them unconditionally.  */\n+  free_dominance_info (CDI_POST_DOMINATORS);\n \n   /* If we removed paths in the CFG, then we need to update\n      dominators as well.  I haven't investigated the possibility"}]}