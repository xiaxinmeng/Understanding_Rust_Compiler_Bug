{"sha": "b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjZhMGFlMWQyMmM5Njc1ZjQzNzRjMmNiMmI1YzA4MzNiYjE0NjFmMQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-04-23T19:45:34Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-04-29T07:46:07Z"}, "message": "[gcn] Fix 'omp-device-properties-gcn' handling\n\nFix-up for commit 955cd057454b323419e06affa7df7d59dc3cd1fb \"Add\ngcc/config/gcn/t-omp-device for OpenMP declare variant kind/arch/isa\".\n\nWith AMD GCN offloading configured, I'm seeing occasional GCC build hangs.\nI've now captured and analyzed one of them:\n\n    $ ps -f\n    UID        PID  PPID  C STIME TTY          TIME CMD\n    [...]\n    tschwing  5113  4508  0 20:24 pts/5    00:00:00 /bin/sh -c rm -f tmp-omp-device-properties.h; \\ for kind in kind arch isa; do \\   echo 'const char omp_offload_device_'${kind}'[] = ' \\     >> tmp-omp-device-properties.h; \\   for prop in no\n    tschwing  5126  5113  0 20:24 pts/5    00:00:00 sed -n s/^kind: //p\n    tschwing  5127  5113  0 20:24 pts/5    00:00:00 sed s/[[:blank:]]/ /g;s/  */ /g;s/^ //;s/ $//;s/ /\\\\0/g;s/^/\"/;s/$/\\\\0\\\\0\"/\n    [...]\n    $ pstree -p $$\n    [...]---sh(5113)-+-sed(5126)\n                     `-sed(5127)\n    $ ls -lrt build-gcc/gcc/*omp-device*\n    -rw-r--r-- 1 tschwing eeg  39 Apr 23 20:24 build-gcc/gcc/omp-device-properties-nvptx\n    -rw-r--r-- 1 tschwing eeg 634 Apr 23 20:24 build-gcc/gcc/omp-device-properties-i386\n    -rw-r--r-- 1 tschwing eeg  58 Apr 23 20:24 build-gcc/gcc/tmp-omp-device-properties.h\n\nNotably missing is the 'omp-device-properties-gcn' file...\n\n    $ grep ^ build-gcc/gcc/*omp-device*\n    build-gcc/gcc/omp-device-properties-i386:kind: cpu\n    build-gcc/gcc/omp-device-properties-i386:arch: x86 x86_64 i386 i486 i586 i686 ia32\n    build-gcc/gcc/omp-device-properties-i386:isa: sse4 cx16 [...]\n    build-gcc/gcc/omp-device-properties-nvptx:kind: gpu\n    build-gcc/gcc/omp-device-properties-nvptx:arch: nvptx\n    build-gcc/gcc/omp-device-properties-nvptx:isa: sm_30 sm_35\n    build-gcc/gcc/tmp-omp-device-properties.h:const char omp_offload_device_kind[] =\n    build-gcc/gcc/tmp-omp-device-properties.h:\"amdgcn-amdhsa\\0\"\n\n..., which we here seem to be intending to fill into\n'tmp-omp-device-properties.h'.\n\n    $ grep ^omp_device_properties\\ = build-gcc/gcc/Makefile\n    omp_device_properties =  amdgcn-amdhsa= nvptx-none=omp-device-properties-nvptx x86_64-intelmicemul-linux-gnu=omp-device-properties-i386\n\nGiven the 's-omp-device-properties-h' Makefile rule, indeed there is an\nunescaped '$${props}', which is meant to be the filename following the equals\nsign -- but there is none for 'amdgcn-amdhsa=', so this tries to read from\n'stdin'!\n\nThe real problem of course is elsewhere.\n\n\tgcc/\n\t* configure.ac <$enable_offload_targets>: 'amdgcn' is 'gcn'.\n\t* configure: Regenerate.", "tree": {"sha": "bc7bdf3aa73bab824e6953bcde08328476842c9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc7bdf3aa73bab824e6953bcde08328476842c9e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f2c2eaaf8fb5c66ae372bb526b2b2fe67a9c5c39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2c2eaaf8fb5c66ae372bb526b2b2fe67a9c5c39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2c2eaaf8fb5c66ae372bb526b2b2fe67a9c5c39"}], "stats": {"total": 7, "additions": 5, "deletions": 2}, "files": [{"sha": "85d1c2b6f758868735b8b777fb79519cd124bb77", "filename": "gcc/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "patch": "@@ -1,5 +1,8 @@\n 2020-04-29  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\t* configure.ac <$enable_offload_targets>: 'amdgcn' is 'gcn'.\n+\t* configure: Regenerate.\n+\n \tPR target/94279\n \t* rtlanal.c (set_noop_p): Handle non-constant selectors.\n "}, {"sha": "83101072aea0b940b7d316217ba4248f5c248057", "filename": "gcc/configure", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "patch": "@@ -7924,7 +7924,7 @@ for tgt in `echo $enable_offload_targets | sed 's/,/ /g'`; do\n \tomp_device_property=omp-device-properties-i386\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/i386/t-omp-device\"\n \t;;\n-      gcn*-*)\n+      amdgcn*-*)\n \tomp_device_property=omp-device-properties-gcn\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/gcn/t-omp-device\"\n \t;;"}, {"sha": "b604047ae456a928218fc19c00279af12553b2ab", "filename": "gcc/configure.ac", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=b6a0ae1d22c9675f4374c2cb2b5c0833bb1461f1", "patch": "@@ -1049,7 +1049,7 @@ for tgt in `echo $enable_offload_targets | sed 's/,/ /g'`; do\n \tomp_device_property=omp-device-properties-i386\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/i386/t-omp-device\"\n \t;;\n-      gcn*-*)\n+      amdgcn*-*)\n \tomp_device_property=omp-device-properties-gcn\n \tomp_device_property_tmake_file=\"${omp_device_property_tmake_file} \\$(srcdir)/config/gcn/t-omp-device\"\n \t;;"}]}