{"sha": "ca85f659109df84a4119c39afc5231f1eedc1459", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2E4NWY2NTkxMDlkZjg0YTQxMTljMzlhZmM1MjMxZjFlZWRjMTQ1OQ==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2005-10-11T16:38:52Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2005-10-11T16:38:52Z"}, "message": "re PR c++/21369 (Template function definition rejected if function return type begins with 'struct')\n\n\tPR c++/21369\n\t* parser.c (cp_parser_elaborated_type_specifier): Don't treat\n\tclass types as templates if the type is not appearing as part of a\n\ttype definition or declaration.\n\tPR c++/21369\n\t* g++.dg/parse/ret-type3.C: New test.\n\nFrom-SVN: r105241", "tree": {"sha": "023c7aeb69682b23b3d71f879065e214f8895f29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/023c7aeb69682b23b3d71f879065e214f8895f29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ca85f659109df84a4119c39afc5231f1eedc1459", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca85f659109df84a4119c39afc5231f1eedc1459", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ca85f659109df84a4119c39afc5231f1eedc1459", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ca85f659109df84a4119c39afc5231f1eedc1459/comments", "author": null, "committer": null, "parents": [{"sha": "386cfa6f3f1aeba33362f4f3717c2df2980ade6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/386cfa6f3f1aeba33362f4f3717c2df2980ade6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/386cfa6f3f1aeba33362f4f3717c2df2980ade6c"}], "stats": {"total": 29, "additions": 27, "deletions": 2}, "files": [{"sha": "7842a019fe7576440f0da494dcdfc8e8d200298a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ca85f659109df84a4119c39afc5231f1eedc1459", "patch": "@@ -1,3 +1,10 @@\n+2005-10-11  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/21369\n+\t* parser.c (cp_parser_elaborated_type_specifier): Don't treat\n+\tclass types as templates if the type is not appearing as part of a\n+\ttype definition or declaration.\n+\n 2005-10-10  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/24277"}, {"sha": "6d7d3c8cac6cd6a4a05e0c9138baacb8bfaf8869", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=ca85f659109df84a4119c39afc5231f1eedc1459", "patch": "@@ -10066,6 +10066,8 @@ cp_parser_elaborated_type_specifier (cp_parser* parser,\n \t     declaration context.  */\n \n \t  tag_scope ts;\n+\t  bool template_p;\n+\n \t  if (is_friend)\n \t    /* Friends have special name lookup rules.  */\n \t    ts = ts_within_enclosing_non_class;\n@@ -10082,8 +10084,11 @@ cp_parser_elaborated_type_specifier (cp_parser* parser,\n \t    warning (OPT_Wattributes,\n \t\t     \"type attributes are honored only at type definition\");\n \n-\t  type = xref_tag (tag_type, identifier, ts,\n-\t\t\t   parser->num_template_parameter_lists);\n+\t  template_p = \n+\t    (parser->num_template_parameter_lists\n+\t     && (cp_parser_next_token_starts_class_definition_p (parser)\n+\t\t || cp_lexer_next_token_is (parser->lexer, CPP_SEMICOLON)));\n+\t  type = xref_tag (tag_type, identifier, ts, template_p);\n \t}\n     }\n   if (tag_type != enum_type)"}, {"sha": "949c1da07ea5609269db6682bdf4765ff5f192a7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=ca85f659109df84a4119c39afc5231f1eedc1459", "patch": "@@ -1,3 +1,8 @@\n+2005-10-11  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/21369\n+\t* g++.dg/parse/ret-type3.C: New test.\n+\n 2005-10-11  Andrew Pinski  <pinskia@physics.uc.edu>\n \n \tPR tree-opt/23946"}, {"sha": "33ee317482527d02805356c2903925db679a63bb", "filename": "gcc/testsuite/g++.dg/parse/ret-type3.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fret-type3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ca85f659109df84a4119c39afc5231f1eedc1459/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fret-type3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fparse%2Fret-type3.C?ref=ca85f659109df84a4119c39afc5231f1eedc1459", "patch": "@@ -0,0 +1,8 @@\n+// PR c++/21369\n+\n+struct bar;\n+\n+template <class T> struct bar *foo (T *p)\n+{\n+  return p->t;\n+}"}]}