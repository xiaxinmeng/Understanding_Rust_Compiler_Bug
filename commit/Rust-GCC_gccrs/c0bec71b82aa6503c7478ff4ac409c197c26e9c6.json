{"sha": "c0bec71b82aa6503c7478ff4ac409c197c26e9c6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzBiZWM3MWI4MmFhNjUwM2M3NDc4ZmY0YWM0MDljMTk3YzI2ZTljNg==", "commit": {"author": {"name": "Benjamin Kosnik", "email": "bkoz@redhat.com", "date": "2004-03-07T02:17:19Z"}, "committer": {"name": "Benjamin Kosnik", "email": "bkoz@gcc.gnu.org", "date": "2004-03-07T02:17:19Z"}, "message": "mt_allocator.h (_S_initialize): If !__GTHREAD_MUTEX_INIT, then initialize _S_thread_freelist_mutex.\n\n\n2004-03-06  Benjamin Kosnik  <bkoz@redhat.com>\n\n\t* include/ext/mt_allocator.h (_S_initialize): If\n\t!__GTHREAD_MUTEX_INIT, then initialize _S_thread_freelist_mutex.\n\nFrom-SVN: r79044", "tree": {"sha": "caad79ef327b6c35aa3189468ea18f7fac73dd59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/caad79ef327b6c35aa3189468ea18f7fac73dd59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c0bec71b82aa6503c7478ff4ac409c197c26e9c6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0bec71b82aa6503c7478ff4ac409c197c26e9c6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c0bec71b82aa6503c7478ff4ac409c197c26e9c6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c0bec71b82aa6503c7478ff4ac409c197c26e9c6/comments", "author": null, "committer": null, "parents": [{"sha": "f83295bafc73a70666d5d67e05918b0e6882402c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f83295bafc73a70666d5d67e05918b0e6882402c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f83295bafc73a70666d5d67e05918b0e6882402c"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "36decc1b2a87e66cc74f2860654630f8ca63662e", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0bec71b82aa6503c7478ff4ac409c197c26e9c6/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0bec71b82aa6503c7478ff4ac409c197c26e9c6/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=c0bec71b82aa6503c7478ff4ac409c197c26e9c6", "patch": "@@ -1,3 +1,8 @@\n+2004-03-06  Benjamin Kosnik  <bkoz@redhat.com>\n+\n+\t* include/ext/mt_allocator.h (_S_initialize): If\n+\t!__GTHREAD_MUTEX_INIT, then initialize _S_thread_freelist_mutex.\n+\n 2004-03-06  Benjamin Kosnik  <bkoz@redhat.com>\n \n \tPR libstdc++/12658"}, {"sha": "7b42300ba46191d44ba7c6a07dbbf545f1d6d715", "filename": "libstdc++-v3/include/ext/mt_allocator.h", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c0bec71b82aa6503c7478ff4ac409c197c26e9c6/libstdc%2B%2B-v3%2Finclude%2Fext%2Fmt_allocator.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c0bec71b82aa6503c7478ff4ac409c197c26e9c6/libstdc%2B%2B-v3%2Finclude%2Fext%2Fmt_allocator.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fext%2Fmt_allocator.h?ref=c0bec71b82aa6503c7478ff4ac409c197c26e9c6", "patch": "@@ -548,7 +548,7 @@ namespace __gnu_cxx\n     {\n       if (_S_options._M_force_new)\n \treturn;\n-\t\n+\n       // Calculate the number of bins required based on _M_max_bytes.\n       // _S_bin_size is statically-initialized to one.\n       size_t bin_size = 1;\n@@ -598,6 +598,11 @@ namespace __gnu_cxx\n           _S_thread_freelist_first[i - 1].next = NULL;\n           _S_thread_freelist_first[i - 1].id = i;\n \n+\n+\t  // Make sure this is initialized.\n+#ifndef __GTHREAD_MUTEX_INIT\n+\t  __GTHREAD_MUTEX_INIT_FUNCTION(&_S_thread_freelist_mutex);\n+#endif\n           // Initialize per thread key to hold pointer to\n           // _S_thread_freelist.\n           __gthread_key_create(&_S_thread_key, _S_destroy_thread_key);\n@@ -745,7 +750,6 @@ namespace __gnu_cxx\n #ifdef __GTHREAD_MUTEX_INIT\n     __mt_alloc<_Tp>::_S_thread_freelist_mutex = __GTHREAD_MUTEX_INIT;\n #else\n-  // XXX\n     __mt_alloc<_Tp>::_S_thread_freelist_mutex;\n #endif\n #endif"}]}