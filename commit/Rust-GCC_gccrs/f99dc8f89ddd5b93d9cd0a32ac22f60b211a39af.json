{"sha": "f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjk5ZGM4Zjg5ZGRkNWI5M2Q5Y2QwYTMyYWMyMmY2MGIyMTFhMzlhZg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-08-14T22:27:15Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-08-17T23:32:53Z"}, "message": "compiler: export thunks referenced by inline functions\n\nThe test case is https://golang.org/cl/248637.\n\nFixes golang/go#40252\n\nReviewed-on: https://go-review.googlesource.com/c/gofrontend/+/248638", "tree": {"sha": "773d2ab46e9a8a78d5dfde4df81ae51f21dee806", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/773d2ab46e9a8a78d5dfde4df81ae51f21dee806"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b00a83047574eb6f8d1e670ad439609125873506", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b00a83047574eb6f8d1e670ad439609125873506", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b00a83047574eb6f8d1e670ad439609125873506"}], "stats": {"total": 19, "additions": 10, "deletions": 9}, "files": [{"sha": "e425f15285eaa4a83786412270f51924d68ec582", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "patch": "@@ -1,4 +1,4 @@\n-fe5d94c5792f7f990004c3dee0ea501835512200\n+823c91088bc6ac606362fc34b2880ce0de1624ad\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "8bbc557c65ffbafeb1b447eb0870a4fb9e482379", "filename": "gcc/go/gofrontend/expressions.cc", "status": "modified", "additions": 4, "deletions": 5, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/gcc%2Fgo%2Fgofrontend%2Fexpressions.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/gcc%2Fgo%2Fgofrontend%2Fexpressions.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fexpressions.cc?ref=f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "patch": "@@ -1635,16 +1635,15 @@ Func_descriptor_expression::do_get_backend(Translate_context* context)\n \t      || no->name().find(\"equal\") != std::string::npos))\n \tis_exported_runtime = true;\n \n-      bool is_referenced_by_inline =\n-\tno->is_function() && no->func_value()->is_referenced_by_inline();\n-\n       bool is_hidden = ((no->is_function()\n \t\t\t && no->func_value()->enclosing() != NULL)\n \t\t\t|| (Gogo::is_hidden_name(no->name())\n-\t\t\t    && !is_exported_runtime\n-\t\t\t    && !is_referenced_by_inline)\n+\t\t\t    && !is_exported_runtime)\n \t\t\t|| Gogo::is_thunk(no));\n \n+      if (no->is_function() && no->func_value()->is_referenced_by_inline())\n+\tis_hidden = false;\n+\n       bvar = context->backend()->immutable_struct(var_name, asm_name,\n                                                   is_hidden, false,\n \t\t\t\t\t\t  btype, bloc);"}, {"sha": "82d4c1fd54d5b1729a1ff36eba8d85413a8b749f", "filename": "gcc/go/gofrontend/gogo.cc", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af/gcc%2Fgo%2Fgofrontend%2Fgogo.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2Fgogo.cc?ref=f99dc8f89ddd5b93d9cd0a32ac22f60b211a39af", "patch": "@@ -3370,16 +3370,18 @@ class Create_function_descriptors : public Traverse\n   Gogo* gogo_;\n };\n \n-// Create a descriptor for every top-level exported function.\n+// Create a descriptor for every top-level exported function and every\n+// function referenced by an inline function.\n \n int\n Create_function_descriptors::function(Named_object* no)\n {\n   if (no->is_function()\n       && no->func_value()->enclosing() == NULL\n       && !no->func_value()->is_method()\n-      && !Gogo::is_hidden_name(no->name())\n-      && !Gogo::is_thunk(no))\n+      && ((!Gogo::is_hidden_name(no->name())\n+\t   && !Gogo::is_thunk(no))\n+\t  || no->func_value()->is_referenced_by_inline()))\n     no->func_value()->descriptor(this->gogo_, no);\n \n   return TRAVERSE_CONTINUE;"}]}