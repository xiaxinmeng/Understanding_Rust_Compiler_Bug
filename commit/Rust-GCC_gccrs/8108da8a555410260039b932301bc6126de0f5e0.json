{"sha": "8108da8a555410260039b932301bc6126de0f5e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODEwOGRhOGE1NTU0MTAyNjAwMzliOTMyMzAxYmM2MTI2ZGUwZjVlMA==", "commit": {"author": {"name": "Andrew Stubbs", "email": "ams@codesourcery.com", "date": "2019-07-02T11:57:17Z"}, "committer": {"name": "Andrew Stubbs", "email": "ams@gcc.gnu.org", "date": "2019-07-02T11:57:17Z"}, "message": "Fix amdgcn regrename ICE.\n\n2019-07-02  Andrew Stubbs  <ams@codesourcery.com>\n\n\tgcc/\n\t* config/gcn/gcn.md (movdi_symbol_save_scc): Convert to define_insn\n\twith inlined save and restore.\n\nFrom-SVN: r272932", "tree": {"sha": "b081c225e467d652361d040e6f2995635c016ed4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b081c225e467d652361d040e6f2995635c016ed4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8108da8a555410260039b932301bc6126de0f5e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8108da8a555410260039b932301bc6126de0f5e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8108da8a555410260039b932301bc6126de0f5e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8108da8a555410260039b932301bc6126de0f5e0/comments", "author": {"login": "ams-cs", "id": 2235130, "node_id": "MDQ6VXNlcjIyMzUxMzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2235130?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ams-cs", "html_url": "https://github.com/ams-cs", "followers_url": "https://api.github.com/users/ams-cs/followers", "following_url": "https://api.github.com/users/ams-cs/following{/other_user}", "gists_url": "https://api.github.com/users/ams-cs/gists{/gist_id}", "starred_url": "https://api.github.com/users/ams-cs/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ams-cs/subscriptions", "organizations_url": "https://api.github.com/users/ams-cs/orgs", "repos_url": "https://api.github.com/users/ams-cs/repos", "events_url": "https://api.github.com/users/ams-cs/events{/privacy}", "received_events_url": "https://api.github.com/users/ams-cs/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4887c9e80839eee3628490003abab18b17492401", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4887c9e80839eee3628490003abab18b17492401", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4887c9e80839eee3628490003abab18b17492401"}], "stats": {"total": 39, "additions": 31, "deletions": 8}, "files": [{"sha": "77d8ff3c0424f251919eb088c036b525e20e7938", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8108da8a555410260039b932301bc6126de0f5e0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8108da8a555410260039b932301bc6126de0f5e0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8108da8a555410260039b932301bc6126de0f5e0", "patch": "@@ -1,3 +1,8 @@\n+2019-07-02  Andrew Stubbs  <ams@codesourcery.com>\n+\n+\t* config/gcn/gcn.md (movdi_symbol_save_scc): Convert to define_insn\n+\twith inlined save and restore.\n+\n 2019-07-02  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* cfgexpand.c (pass_expand::execute): Deal specially with instructions"}, {"sha": "7e5cf17629dee85d3ca1732231c13c7bde751167", "filename": "gcc/config/gcn/gcn.md", "status": "modified", "additions": 26, "deletions": 8, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8108da8a555410260039b932301bc6126de0f5e0/gcc%2Fconfig%2Fgcn%2Fgcn.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8108da8a555410260039b932301bc6126de0f5e0/gcc%2Fconfig%2Fgcn%2Fgcn.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fgcn%2Fgcn.md?ref=8108da8a555410260039b932301bc6126de0f5e0", "patch": "@@ -830,18 +830,36 @@\n  [(set_attr \"type\" \"mult\")\n   (set_attr \"length\" \"32\")])\n \n-(define_insn_and_split \"movdi_symbol_save_scc\"\n+(define_insn \"movdi_symbol_save_scc\"\n  [(set (match_operand:DI 0 \"nonimmediate_operand\" \"=Sg\")\n        (match_operand:DI 1 \"general_operand\" \"Y\"))\n   (clobber (reg:BI CC_SAVE_REG))]\n- \"GET_CODE (operands[1]) == SYMBOL_REF || GET_CODE (operands[1]) == LABEL_REF\n+ \"(GET_CODE (operands[1]) == SYMBOL_REF || GET_CODE (operands[1]) == LABEL_REF)\n   && (lra_in_progress || reload_completed)\"\n- \"#\"\n- \"reload_completed\"\n- [(set (reg:BI CC_SAVE_REG) (reg:BI SCC_REG))\n-  (parallel [(set (match_dup 0) (match_dup 1))\n-\t     (clobber (reg:BI SCC_REG))])\n-  (set (reg:BI SCC_REG) (reg:BI CC_SAVE_REG))])\n+  {\n+    /* !!! These sequences clobber CC_SAVE_REG.  */\n+\n+    if (SYMBOL_REF_P (operands[1])\n+\t&& SYMBOL_REF_WEAK (operands[1]))\n+\treturn \"; s_mov_b32\\ts22, scc is not supported by the assembler.\\;\"\n+\t       \".long\\t0xbe9600fd\\;\"\n+\t       \"s_getpc_b64\\t%0\\;\"\n+\t       \"s_add_u32\\t%L0, %L0, %1@gotpcrel32@lo+4\\;\"\n+\t       \"s_addc_u32\\t%H0, %H0, %1@gotpcrel32@hi+4\\;\"\n+\t       \"s_load_dwordx2\\t%0, %0\\;\"\n+\t       \"s_cmpk_lg_u32\\ts22, 0\\;\"\n+\t       \"s_waitcnt\\tlgkmcnt(0)\";\n+\n+    return \"; s_mov_b32\\ts22, scc is not supported by the assembler.\\;\"\n+\t   \".long\\t0xbe9600fd\\;\"\n+\t   \"s_getpc_b64\\t%0\\;\"\n+\t   \"s_add_u32\\t%L0, %L0, %1@rel32@lo+4\\;\"\n+\t   \"s_addc_u32\\t%H0, %H0, %1@rel32@hi+4\\;\"\n+\t   \"s_cmpk_lg_u32\\ts22, 0\";\n+  }\n+ [(set_attr \"type\" \"mult\")\n+  (set_attr \"length\" \"40\")])\n+\n \n (define_insn \"gcn_indirect_call\"\n   [(call (mem (match_operand:DI 0 \"register_operand\" \"Sg\"))"}]}