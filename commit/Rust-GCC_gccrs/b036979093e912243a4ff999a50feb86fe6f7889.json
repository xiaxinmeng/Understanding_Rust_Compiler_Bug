{"sha": "b036979093e912243a4ff999a50feb86fe6f7889", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjAzNjk3OTA5M2U5MTIyNDNhNGZmOTk5YTUwZmViODZmZTZmNzg4OQ==", "commit": {"author": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2017-11-08T22:56:58Z"}, "committer": {"name": "Steven G. Kargl", "email": "kargl@gcc.gnu.org", "date": "2017-11-08T22:56:58Z"}, "message": "re PR fortran/82841 (Segfault in gfc_simplify_transfer)\n\n2017-11-08  Steven G. Kargl  <kargl@kgcc.gnu.org>\n\n\tPR Fortran/82841\n\t* simplify.c(gfc_simplify_transfer): Do not dereference a NULL pointer.\n\tUnwrap a short line.\n \n2017-11-08  Steven G. Kargl  <kargl@kgcc.gnu.org>\n\n\tPR Fortran/82841\n\t* gfortran.dg/transfer_simplify_11.f90: new test.\n\nFrom-SVN: r254555", "tree": {"sha": "edd4daf21b07035131c368cddec9626932a8eb1e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/edd4daf21b07035131c368cddec9626932a8eb1e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b036979093e912243a4ff999a50feb86fe6f7889", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b036979093e912243a4ff999a50feb86fe6f7889", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b036979093e912243a4ff999a50feb86fe6f7889", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b036979093e912243a4ff999a50feb86fe6f7889/comments", "author": null, "committer": null, "parents": [{"sha": "fb5621b1841b56a88f66fb1e08dd87db0009c57b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fb5621b1841b56a88f66fb1e08dd87db0009c57b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fb5621b1841b56a88f66fb1e08dd87db0009c57b"}], "stats": {"total": 24, "additions": 21, "deletions": 3}, "files": [{"sha": "6c9f246d64ea2bddfb1249e1e9072edf41727d32", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=b036979093e912243a4ff999a50feb86fe6f7889", "patch": "@@ -1,3 +1,9 @@\n+2017-11-08  Steven G. Kargl  <kargl@kgcc.gnu.org>\n+\n+\tPR Fortran/82841\n+\t* simplify.c(gfc_simplify_transfer): Do not dereference a NULL pointer.\n+\tUnwrap a short line.\n+\n 2017-11-08  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/82884"}, {"sha": "c7b7e1a8297c2e26df995c84f3cc098aad8cc5fe", "filename": "gcc/fortran/simplify.c", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ffortran%2Fsimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ffortran%2Fsimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fsimplify.c?ref=b036979093e912243a4ff999a50feb86fe6f7889", "patch": "@@ -6576,16 +6576,15 @@ gfc_simplify_transfer (gfc_expr *source, gfc_expr *mold, gfc_expr *size)\n     return NULL;\n \n   /* Calculate the size of the source.  */\n-  if (source->expr_type == EXPR_ARRAY\n-      && !gfc_array_size (source, &tmp))\n+  if (source->expr_type == EXPR_ARRAY && !gfc_array_size (source, &tmp))\n     gfc_internal_error (\"Failure getting length of a constant array.\");\n \n   /* Create an empty new expression with the appropriate characteristics.  */\n   result = gfc_get_constant_expr (mold->ts.type, mold->ts.kind,\n \t\t\t\t  &source->where);\n   result->ts = mold->ts;\n \n-  mold_element = mold->expr_type == EXPR_ARRAY\n+  mold_element = (mold->expr_type == EXPR_ARRAY && mold->value.constructor)\n \t\t ? gfc_constructor_first (mold->value.constructor)->expr\n \t\t : mold;\n "}, {"sha": "75c8a0ab752bfbedc4712bb97117de749ba80d34", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b036979093e912243a4ff999a50feb86fe6f7889", "patch": "@@ -1,3 +1,8 @@\n+2017-11-08  Steven G. Kargl  <kargl@kgcc.gnu.org>\n+\n+\tPR Fortran/82841\n+\t* gfortran.dg/transfer_simplify_11.f90: New test.\n+\n 2017-11-08  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/82884"}, {"sha": "ce7a4ad5e56845d171250bffaa010453e5d14866", "filename": "gcc/testsuite/gfortran.dg/transfer_simplify_11.f90", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_simplify_11.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b036979093e912243a4ff999a50feb86fe6f7889/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_simplify_11.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Ftransfer_simplify_11.f90?ref=b036979093e912243a4ff999a50feb86fe6f7889", "patch": "@@ -0,0 +1,8 @@\n+! { dg-do run }\n+! PR Fortran/82841\n+!\n+   integer, parameter :: N = 2\n+   character(len=1) :: chr(N)\n+   chr = transfer(repeat(\"x\",ncopies=N),[character(len=1) ::], N)\n+   if (chr(1) /= 'x' .and. chr(2) /= 'x') call abort\n+end"}]}