{"sha": "d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "node_id": "C_kwDOANBUbNoAKGQ5ZDhjOTY3NGFkM2FkM2FhMzg0MTlkMjRiMWFhYWZmZTMxZjVkM2Y", "commit": {"author": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2022-12-10T18:12:43Z"}, "committer": {"name": "Iain Buclaw", "email": "ibuclaw@gdcproject.org", "date": "2022-12-11T16:56:58Z"}, "message": "d: Fix internal compiler error: in visit, at d/imports.cc:72 (PR108050)\n\nThe visitor for lowering IMPORTED_DECLs did not have an override for\ndealing with importing OverloadSet symbols.  This has now been\nimplemented in the code generator.\n\n\tPR d/108050\n\ngcc/d/ChangeLog:\n\n\t* decl.cc (DeclVisitor::visit (Import *)): Handle build_import_decl\n\treturning a TREE_LIST.\n\t* imports.cc (ImportVisitor::visit (OverloadSet *)): New override.\n\ngcc/testsuite/ChangeLog:\n\n\t* gdc.dg/imports/pr108050/mod1.d: New.\n\t* gdc.dg/imports/pr108050/mod2.d: New.\n\t* gdc.dg/imports/pr108050/package.d: New.\n\t* gdc.dg/pr108050.d: New test.", "tree": {"sha": "fb549ab2543c785e17320cba16f4f836bfacef61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fb549ab2543c785e17320cba16f4f836bfacef61"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/comments", "author": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ibuclaw", "id": 397929, "node_id": "MDQ6VXNlcjM5NzkyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ibuclaw", "html_url": "https://github.com/ibuclaw", "followers_url": "https://api.github.com/users/ibuclaw/followers", "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}", "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}", "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions", "organizations_url": "https://api.github.com/users/ibuclaw/orgs", "repos_url": "https://api.github.com/users/ibuclaw/repos", "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}", "received_events_url": "https://api.github.com/users/ibuclaw/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b045179973161115c7ea029b2788f5156fc55cda", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b045179973161115c7ea029b2788f5156fc55cda", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b045179973161115c7ea029b2788f5156fc55cda"}], "stats": {"total": 36, "additions": 34, "deletions": 2}, "files": [{"sha": "bed16323fec5fee09bb0ebab8615a03e706f792e", "filename": "gcc/d/decl.cc", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Fd%2Fdecl.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Fd%2Fdecl.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fdecl.cc?ref=d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "patch": "@@ -198,8 +198,16 @@ class DeclVisitor : public Visitor\n \t    tree name = (alias != NULL)\n \t      ? get_identifier (alias->toChars ()) : NULL_TREE;\n \n-\t    debug_hooks->imported_module_or_decl (decl, name, context,\n-\t\t\t\t\t\t  false, false);\n+\t    if (TREE_CODE (decl) != TREE_LIST)\n+\t      debug_hooks->imported_module_or_decl (decl, name, context,\n+\t\t\t\t\t\t    false, false);\n+\t    else\n+\t      {\n+\t\t/* Overload sets return a list of imported decls.  */\n+\t\tfor (; decl != NULL_TREE; decl = TREE_CHAIN (decl))\n+\t\t  debug_hooks->imported_module_or_decl (TREE_VALUE (decl), name,\n+\t\t\t\t\t\t\tcontext, false, false);\n+\t      }\n \t  }\n       }\n     else"}, {"sha": "2d331f46c355e7bd18ee71c8b9ad993f8f9386b3", "filename": "gcc/d/imports.cc", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Fd%2Fimports.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Fd%2Fimports.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fd%2Fimports.cc?ref=d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "patch": "@@ -160,6 +160,20 @@ class ImportVisitor : public Visitor\n       d->aliassym->accept (this);\n   }\n \n+  /* Build IMPORTED_DECLs for all overloads in a set.  */\n+  void visit (OverloadSet *d) final override\n+  {\n+    vec<tree, va_gc> *tset = NULL;\n+\n+    vec_alloc (tset, d->a.length);\n+\n+    for (size_t i = 0; i < d->a.length; i++)\n+      vec_safe_push (tset, build_import_decl (d->a[i]));\n+\n+    this->result_ = build_tree_list_vec (tset);\n+    tset->truncate (0);\n+  }\n+\n   /* Function aliases are the same as alias symbols.  */\n   void visit (FuncAliasDeclaration *d) final override\n   {"}, {"sha": "f27a13dc0515fd7359f7ea23e980f534c06b4296", "filename": "gcc/testsuite/gdc.dg/imports/pr108050/mod1.d", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fmod1.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fmod1.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fmod1.d?ref=d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "patch": "@@ -0,0 +1,2 @@\n+module imports.pr108050.mod1;\n+string[] split() { return null; }"}, {"sha": "29d8aa8f53ef09caf6f5d24bcf82aa1ecf6ee313", "filename": "gcc/testsuite/gdc.dg/imports/pr108050/mod2.d", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fmod2.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fmod2.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fmod2.d?ref=d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "patch": "@@ -0,0 +1,2 @@\n+module imports.pr108050.mod2;\n+string[] split() { return null; }"}, {"sha": "b8b03b832afd324c63c43d4ed887a6f4c9fafce7", "filename": "gcc/testsuite/gdc.dg/imports/pr108050/package.d", "status": "added", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fpackage.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fpackage.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.dg%2Fimports%2Fpr108050%2Fpackage.d?ref=d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "patch": "@@ -0,0 +1,2 @@\n+module imports.pr108050;\n+public import imports.pr108050.mod1, imports.pr108050.mod2;"}, {"sha": "69134e73137c2b27a383b16288c5484833065846", "filename": "gcc/testsuite/gdc.dg/pr108050.d", "status": "added", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fpr108050.d", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f/gcc%2Ftestsuite%2Fgdc.dg%2Fpr108050.d", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgdc.dg%2Fpr108050.d?ref=d9d8c9674ad3ad3aa38419d24b1aaaffe31f5d3f", "patch": "@@ -0,0 +1,4 @@\n+// { dg-do compile }\n+// { dg-additional-sources \"imports/pr108050/package.d imports/pr108050/mod1.d imports/pr108050/mod2.d\" }\n+// { dg-options \"-g\" }\n+import imports.pr108050 : split;"}]}