{"sha": "4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGZlMzM3ZjY3YTc2ZDFiODI4OGEzYzYzZGVjODZkYmFlZDc3ZGE0Yw==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2006-09-10T20:08:58Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2006-09-10T20:08:58Z"}, "message": "re PR middle-end/26983 (Missing label with builtin_setjmp/longjmp)\n\nPR middle-end/26983\n\ngcc/\n\t* builtins.c (expand_builtin_setjmp): Force next_lab to be\n\tpreserved.\n\ntestsuite/\n\t* gcc.dg/pr26983.c: New test.\n\nFrom-SVN: r116826", "tree": {"sha": "2a5c9f6b9fe4b4a6d75c7244076cbbdc460f588c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a5c9f6b9fe4b4a6d75c7244076cbbdc460f588c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/comments", "author": null, "committer": null, "parents": [{"sha": "9226543b679c84014627a7bdec0503061b3af43d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9226543b679c84014627a7bdec0503061b3af43d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9226543b679c84014627a7bdec0503061b3af43d"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "c4066f353b2ccdd7454820d6b8af60cc751671b6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "patch": "@@ -1,3 +1,9 @@\n+2006-09-10  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\tPR middle-end/26983\n+\t* builtins.c (expand_builtin_setjmp): Force next_lab to be\n+\tpreserved.\n+\n 2006-09-10  Richard Sandiford  <richard@codesourcery.com>\n \n \tPR target/29006"}, {"sha": "5bcba14d7c277365ef6a6ff804c5fb219c5cb841", "filename": "gcc/builtins.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "patch": "@@ -760,6 +760,12 @@ expand_builtin_setjmp (tree arglist, rtx target)\n \n   emit_label (next_lab);\n \n+  /* Because setjmp and longjmp are not represented in the CFG, a cfgcleanup\n+     may find that the basic block starting with NEXT_LAB is unreachable.\n+     The whole block, along with NEXT_LAB, would be removed (see PR26983).\n+     Make sure that never happens.  */\n+  LABEL_PRESERVE_P (next_lab) = 1;\n+     \n   expand_builtin_setjmp_receiver (next_lab);\n \n   /* Set TARGET to one.  */"}, {"sha": "55eee6b150554cea8f42db828409a3aff0ce7cd2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "patch": "@@ -1,3 +1,8 @@\n+2006-09-10  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\tPR middle-end/26983\n+\t* gcc.dg/pr26983.c: New test.\n+\n 2006-09-10  Richard Sandiford  <richard@codesourcery.com>\n \n \tPR target/29006"}, {"sha": "5e2120a1ffe3363967bca72ddd805dd57f6c4030", "filename": "gcc/testsuite/gcc.dg/pr26983.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2Ftestsuite%2Fgcc.dg%2Fpr26983.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4fe337f67a76d1b8288a3c63dec86dbaed77da4c/gcc%2Ftestsuite%2Fgcc.dg%2Fpr26983.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr26983.c?ref=4fe337f67a76d1b8288a3c63dec86dbaed77da4c", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do link } */\n+\n+/* This used to cause a linker failure because GCC would output\n+   assembler code referencing labels that it had not output.  */\n+\n+void *jmpbuf[6];\n+\n+void\n+foo (void)\n+{\n+  __builtin_setjmp (jmpbuf);\n+}\n+\n+int\n+main (void)\n+{\n+  return 0;\n+}\n+"}]}