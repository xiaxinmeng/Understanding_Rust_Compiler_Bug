{"sha": "da76b2532f85d0e928862303b1fc92fa2a5a6138", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGE3NmIyNTMyZjg1ZDBlOTI4ODYyMzAzYjFmYzkyZmEyYTVhNjEzOA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-10-24T13:51:45Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-10-24T13:51:45Z"}, "message": "re PR tree-optimization/82697 (Wrong optimization with aliasing and \"if\")\n\n2017-10-24  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/82697\n\t* tree-ssa-phiopt.c (cond_store_replacement): Use alias-set\n\tzero for conditional load and unconditional store.\n\n\t* gcc.dg/torture/pr82697.c: New testcase.\n\nFrom-SVN: r254047", "tree": {"sha": "f72cf1f121e8ed72233293ec677e54a9f8894541", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f72cf1f121e8ed72233293ec677e54a9f8894541"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da76b2532f85d0e928862303b1fc92fa2a5a6138", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da76b2532f85d0e928862303b1fc92fa2a5a6138", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da76b2532f85d0e928862303b1fc92fa2a5a6138", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da76b2532f85d0e928862303b1fc92fa2a5a6138/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "eab01c18fdf287aaac60224ddbecae6574631b7b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eab01c18fdf287aaac60224ddbecae6574631b7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eab01c18fdf287aaac60224ddbecae6574631b7b"}], "stats": {"total": 51, "additions": 50, "deletions": 1}, "files": [{"sha": "63bb64fafeb76deacdb9894e0733bd0681cc962d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=da76b2532f85d0e928862303b1fc92fa2a5a6138", "patch": "@@ -1,3 +1,9 @@\n+2017-10-24  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/82697\n+\t* tree-ssa-phiopt.c (cond_store_replacement): Use alias-set\n+\tzero for conditional load and unconditional store.\n+\n 2017-10-24  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* doc/install.texi: Document bootstrap-cet."}, {"sha": "18794e49c641bd846eb9973d0c714d8ca961375a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=da76b2532f85d0e928862303b1fc92fa2a5a6138", "patch": "@@ -1,3 +1,8 @@\n+2017-10-24  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/82697\n+\t* gcc.dg/torture/pr82697.c: New testcase.\n+\n 2017-10-24  Mukesh Kapoor  <mukesh.kapoor@oracle.com>\n \t    Paolo Carlini  <paolo.carlini@oracle.com>\n "}, {"sha": "57da8a264b95f67ca4350f4c41cf7ce03a4358fe", "filename": "gcc/testsuite/gcc.dg/torture/pr82697.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr82697.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr82697.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr82697.c?ref=da76b2532f85d0e928862303b1fc92fa2a5a6138", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do run } */\n+\n+__attribute__((noinline,noclone))\n+void test(int *pi, long *pl, int f)\n+{\n+  *pl = 0;\n+\n+  *pi = 1;\n+\n+  if (f)\n+    *pl = 2;\n+}\n+\n+int main()\n+{\n+  void *p = __builtin_malloc(sizeof (long));\n+\n+  test(p, p, 0);\n+\n+  if (*(int *)p != 1)\n+    __builtin_abort ();\n+  return 0;\n+}"}, {"sha": "6e0e18689dab15eb932e8d7d7c28564271ea2b53", "filename": "gcc/tree-ssa-phiopt.c", "status": "modified", "additions": 16, "deletions": 1, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2Ftree-ssa-phiopt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da76b2532f85d0e928862303b1fc92fa2a5a6138/gcc%2Ftree-ssa-phiopt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-phiopt.c?ref=da76b2532f85d0e928862303b1fc92fa2a5a6138", "patch": "@@ -1912,9 +1912,24 @@ cond_store_replacement (basic_block middle_bb, basic_block join_bb,\n   gsi_remove (&gsi, true);\n   release_defs (assign);\n \n+  /* Make both store and load use alias-set zero as we have to\n+     deal with the case of the store being a conditional change\n+     of the dynamic type.  */\n+  lhs = unshare_expr (lhs);\n+  tree *basep = &lhs;\n+  while (handled_component_p (*basep))\n+    basep = &TREE_OPERAND (*basep, 0);\n+  if (TREE_CODE (*basep) == MEM_REF\n+      || TREE_CODE (*basep) == TARGET_MEM_REF)\n+    TREE_OPERAND (*basep, 1)\n+      = fold_convert (ptr_type_node, TREE_OPERAND (*basep, 1));\n+  else\n+    *basep = build2 (MEM_REF, TREE_TYPE (*basep),\n+\t\t     build_fold_addr_expr (*basep),\n+\t\t     build_zero_cst (ptr_type_node));\n+\n   /* 2) Insert a load from the memory of the store to the temporary\n         on the edge which did not contain the store.  */\n-  lhs = unshare_expr (lhs);\n   name = make_temp_ssa_name (TREE_TYPE (lhs), NULL, \"cstore\");\n   new_stmt = gimple_build_assign (name, lhs);\n   gimple_set_location (new_stmt, locus);"}]}