{"sha": "a41baa6442862b5ad7847d3ddf60d9ed50e55833", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQxYmFhNjQ0Mjg2MmI1YWQ3ODQ3ZDNkZGY2MGQ5ZWQ1MGU1NTgzMw==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2005-12-01T06:58:04Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2005-12-01T06:58:04Z"}, "message": "re PR fortran/24789 ([gfortran] ICE when assigning to array of strings)\n\n2005-12-01  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/24789\n\t* trans-decl.c (gfc_get_symbol_decl):  Move the expression for\n\tunit size of automatic character length, dummy pointer array\n\telements down a few lines from the version that fixed PR15809.\n\n2005-12-01  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/24789\n\t*  gfortran.dg/auto_char_dummy_array_2.f90: New test.\n\nFrom-SVN: r107805", "tree": {"sha": "9300fe88bbeb767ca5d194a50e0a21c529a8804e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9300fe88bbeb767ca5d194a50e0a21c529a8804e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a41baa6442862b5ad7847d3ddf60d9ed50e55833", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a41baa6442862b5ad7847d3ddf60d9ed50e55833", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a41baa6442862b5ad7847d3ddf60d9ed50e55833", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a41baa6442862b5ad7847d3ddf60d9ed50e55833/comments", "author": null, "committer": null, "parents": [{"sha": "ada8006795ce5c3d1486c9b39c2f52dd39e71b97", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ada8006795ce5c3d1486c9b39c2f52dd39e71b97", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ada8006795ce5c3d1486c9b39c2f52dd39e71b97"}], "stats": {"total": 54, "additions": 38, "deletions": 16}, "files": [{"sha": "f9fd567e785208529b836040f368f0bdc94eb01c", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=a41baa6442862b5ad7847d3ddf60d9ed50e55833", "patch": "@@ -1,3 +1,10 @@\n+2005-12-01  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/24789\n+\t* trans-decl.c (gfc_get_symbol_decl):  Move the expression for\n+\tunit size of automatic character length, dummy pointer array\n+\telements down a few lines from the version that fixed PR15809.\n+\n 2005-11-30  Bernhard Fischer <rep.nop@aon.at>\n \n \tPR fortran/21302"}, {"sha": "ea127d090f8a5cdba8a4ff35964f7152d2229247", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 15, "deletions": 16, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=a41baa6442862b5ad7847d3ddf60d9ed50e55833", "patch": "@@ -847,25 +847,24 @@ gfc_get_symbol_decl (gfc_symbol * sym)\n \t      if (TREE_CODE (length) != INTEGER_CST)\n \t\t{\n \t\t  gfc_finish_var_decl (length, sym);\n-\n-\t\t  /* Set the element size of automatic character length\n-\t\t     length, dummy, pointer arrays.  */\n-\t\t  if (sym->attr.pointer && sym->attr.dummy\n-\t\t\t&& sym->attr.dimension)\n-\t\t    {\n-\t\t      tmp = gfc_build_indirect_ref (sym->backend_decl);\n-\t\t      etype = gfc_get_element_type (TREE_TYPE (tmp));\n-\t\t      if (TYPE_SIZE_UNIT (etype) == NULL_TREE)\n-\t\t\t{\n-\t\t\t  tmp = TYPE_SIZE_UNIT (gfc_character1_type_node);\n-\t\t\t  tmp = fold_convert (TREE_TYPE (tmp), length);\n-\t\t\t  TYPE_SIZE_UNIT (etype) = tmp;\n-\t\t\t}\n-\t\t    }\n-\n \t\t  gfc_defer_symbol_init (sym);\n \t\t}\n \t    }\n+\n+\t  /* Set the element size of automatic and assumed character length\n+\t     length, dummy, pointer arrays.  */\n+\t  if (sym->attr.pointer && sym->attr.dummy\n+\t\t&& sym->attr.dimension)\n+\t    {\n+\t      tmp = gfc_build_indirect_ref (sym->backend_decl);\n+\t      etype = gfc_get_element_type (TREE_TYPE (tmp));\n+\t      if (TYPE_SIZE_UNIT (etype) == NULL_TREE)\n+\t\t{\n+\t\t  tmp = TYPE_SIZE_UNIT (gfc_character1_type_node);\n+\t\t  tmp = fold_convert (TREE_TYPE (tmp), sym->ts.cl->backend_decl);\n+\t\t  TYPE_SIZE_UNIT (etype) = tmp;\n+\t\t}\n+\t    }\n \t}\n \n       /* Use a copy of the descriptor for dummy arrays.  */"}, {"sha": "d0d6b5283f8abf50a7447d05b460bec69b4b13fd", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a41baa6442862b5ad7847d3ddf60d9ed50e55833", "patch": "@@ -1,3 +1,8 @@\n+2005-12-01  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/24789\n+\t*  gfortran.dg/auto_char_dummy_array_2.f90: New test.\n+\n 2005-12-01  Uros Bizjak  <uros@kss-loka.si>\n \n \tPR target/24475"}, {"sha": "666418301e50481a73a0560f8d17617b882bb505", "filename": "gcc/testsuite/gfortran.dg/auto_char_dummy_array_2.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ftestsuite%2Fgfortran.dg%2Fauto_char_dummy_array_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a41baa6442862b5ad7847d3ddf60d9ed50e55833/gcc%2Ftestsuite%2Fgfortran.dg%2Fauto_char_dummy_array_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fauto_char_dummy_array_2.f90?ref=a41baa6442862b5ad7847d3ddf60d9ed50e55833", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! Test fix for pr24789 - would segfault on the assignment\n+! because the array descriptor size was not set.\n+!\n+! This is the example submitted by Martin Reineke  <martin@mpa-garching.mpg.de>\n+\n+subroutine foo(vals)\n+  character(len = *), pointer :: vals(:)\n+  vals = ''\n+end subroutine\n+"}]}