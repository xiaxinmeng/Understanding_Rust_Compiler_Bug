{"sha": "717809895b889a8fb39866d5ace71544b5d65945", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzE3ODA5ODk1Yjg4OWE4ZmIzOTg2NmQ1YWNlNzE1NDRiNWQ2NTk0NQ==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2007-06-06T10:38:46Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-06-06T10:38:46Z"}, "message": "osinte-c.ads, [...] (Set_Library_Info_Name): Fail if base name of specified object file is not equal to base name of source.\n\n2007-04-20  Vincent Celier  <celier@adacore.com>\n\n\t* osinte-c.ads, osint-c.adb (Set_Library_Info_Name): Fail if base name\n\tof specified object file is not equal to base name of source.\n\nFrom-SVN: r125436", "tree": {"sha": "9b44a80d4f17287c42e19ff3e76003c87a96c3eb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9b44a80d4f17287c42e19ff3e76003c87a96c3eb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/717809895b889a8fb39866d5ace71544b5d65945", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/717809895b889a8fb39866d5ace71544b5d65945", "html_url": "https://github.com/Rust-GCC/gccrs/commit/717809895b889a8fb39866d5ace71544b5d65945", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/717809895b889a8fb39866d5ace71544b5d65945/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b5755e2ba523ae36cb5f033ec1dd29d4cda71c09", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5755e2ba523ae36cb5f033ec1dd29d4cda71c09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5755e2ba523ae36cb5f033ec1dd29d4cda71c09"}], "stats": {"total": 44, "additions": 29, "deletions": 15}, "files": [{"sha": "67eb98284e98c79bcb66eb2eb138c80d38113a7c", "filename": "gcc/ada/osint-c.adb", "status": "modified", "additions": 25, "deletions": 12, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/717809895b889a8fb39866d5ace71544b5d65945/gcc%2Fada%2Fosint-c.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/717809895b889a8fb39866d5ace71544b5d65945/gcc%2Fada%2Fosint-c.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint-c.adb?ref=717809895b889a8fb39866d5ace71544b5d65945", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 B o d y                                  --\n --                                                                          --\n---          Copyright (C) 2001-2006, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -25,7 +25,6 @@\n ------------------------------------------------------------------------------\n \n with Hostparm;\n-with Namet;    use Namet;\n with Opt;      use Opt;\n with Tree_IO;  use Tree_IO;\n \n@@ -49,10 +48,10 @@ package body Osint.C is\n    --  repinfo/list file where xxx is specified extension.\n \n    procedure Set_Library_Info_Name;\n-   --  Sets a default ali file name from the main compiler source name.\n+   --  Sets a default ALI file name from the main compiler source name.\n    --  This is used by Create_Output_Library_Info, and by the version of\n    --  Read_Library_Info that takes a default file name. The name is in\n-   --  Name_Buffer (with length in Name_Len) on return from the call\n+   --  Name_Buffer (with length in Name_Len) on return from the call.\n \n    ----------------------\n    -- Close_Debug_File --\n@@ -190,6 +189,7 @@ package body Osint.C is\n    begin\n       if S (S'First) = '.' then\n          F := Create_Auxiliary_File (Current_Main, S (S'First + 1 .. S'Last));\n+\n       else\n          Name_Buffer (1 .. S'Length) := S;\n          Name_Len := S'Length + 1;\n@@ -212,10 +212,13 @@ package body Osint.C is\n    -- Create_Repinfo_File --\n    -------------------------\n \n-   procedure Create_Repinfo_File (Src : File_Name_Type) is\n-      S : constant File_Name_Type := Create_Auxiliary_File (Src, \"rep\");\n-      pragma Warnings (Off, S);\n+   procedure Create_Repinfo_File (Src : String) is\n+      Discard : File_Name_Type;\n+      pragma Warnings (Off, Discard);\n    begin\n+      Name_Buffer (1 .. Src'Length) := Src;\n+      Name_Len := Src'Length;\n+      Discard := Create_Auxiliary_File (Name_Find, \"rep\");\n       return;\n    end Create_Repinfo_File;\n \n@@ -313,8 +316,8 @@ package body Osint.C is\n          --  Remove extension preparing to replace it\n \n          declare\n-            Name : constant String  := Name_Buffer (1 .. Dot_Index);\n-            Len  : constant Natural := Dot_Index;\n+            Name  : constant String  := Name_Buffer (1 .. Dot_Index);\n+            First : Positive;\n \n          begin\n             Name_Buffer (1 .. Output_Object_File_Name'Length) :=\n@@ -328,13 +331,24 @@ package body Osint.C is\n                end if;\n             end loop;\n \n-            --  Dot_Index should be zero now (we check for extension elsewhere)\n+            --  Dot_Index should not be zero now (we check for extension\n+            --  elsewhere).\n \n             pragma Assert (Dot_Index /= 0);\n \n+            --  Look for first character of file name\n+\n+            First := Dot_Index;\n+            while First > 1\n+              and then Name_Buffer (First - 1) /= Directory_Separator\n+              and then Name_Buffer (First - 1) /= '/'\n+            loop\n+               First := First - 1;\n+            end loop;\n+\n             --  Check name of object file is what we expect\n \n-            if Name /= Name_Buffer (Dot_Index - Len + 1 .. Dot_Index) then\n+            if Name /= Name_Buffer (First .. Dot_Index) then\n                Fail (\"incorrect object file name\");\n             end if;\n          end;\n@@ -471,5 +485,4 @@ begin\n    Opt.Close_List_File_Access  := Close_List_File'Access;\n \n    Set_Program (Compiler);\n-\n end Osint.C;"}, {"sha": "2848bb59bfff5cc990e93b08412bf56b740034df", "filename": "gcc/ada/osint-c.ads", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/717809895b889a8fb39866d5ace71544b5d65945/gcc%2Fada%2Fosint-c.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/717809895b889a8fb39866d5ace71544b5d65945/gcc%2Fada%2Fosint-c.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fosint-c.ads?ref=717809895b889a8fb39866d5ace71544b5d65945", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2001-2006, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2001-2007, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -91,9 +91,10 @@ package Osint.C is\n    --  procedures in appropriate variables in Repinfo, so that they can\n    --  be called indirectly without creating a dependence.\n \n-   procedure Create_Repinfo_File (Src : File_Name_Type);\n+   procedure Create_Repinfo_File (Src : String);\n    --  Given the simple name of a source file, this routine creates the\n-   --  corresponding file to hold representation information\n+   --  corresponding file to hold representation information. Note that the\n+   --  call destroys the contents of Name_Buffer and Name_Len.\n \n    procedure Write_Repinfo_Line (Info : String);\n    --  Writes contents of given string as next line of the current debug"}]}