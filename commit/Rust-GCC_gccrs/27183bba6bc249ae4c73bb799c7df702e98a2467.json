{"sha": "27183bba6bc249ae4c73bb799c7df702e98a2467", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjcxODNiYmE2YmMyNDlhZTRjNzNiYjc5OWM3ZGY3MDJlOThhMjQ2Nw==", "commit": {"author": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2008-04-06T06:40:47Z"}, "committer": {"name": "Uros Bizjak", "email": "uros@gcc.gnu.org", "date": "2008-04-06T06:40:47Z"}, "message": "re PR target/12329 (x86: local function declared with attribute((regparm(3))) gets corrupted parent frame pointer)\n\n        PR target/12329\n        * config/i386/i386.c (ix86_function_regparm): Error if regparm(3)\n        attribute is used for nested functions.\n\ntestsuite/ChangeLog:\n\n        PR target/12329\n        * gcc.target/i386/pr12329.c: New test.\n\nFrom-SVN: r133954", "tree": {"sha": "fab042be595339e8cc2b6a43e033a7b1e7d24655", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fab042be595339e8cc2b6a43e033a7b1e7d24655"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/27183bba6bc249ae4c73bb799c7df702e98a2467", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27183bba6bc249ae4c73bb799c7df702e98a2467", "html_url": "https://github.com/Rust-GCC/gccrs/commit/27183bba6bc249ae4c73bb799c7df702e98a2467", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/27183bba6bc249ae4c73bb799c7df702e98a2467/comments", "author": null, "committer": null, "parents": [{"sha": "93f14b2fc38a2221142d513151a437ef9f14feb8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/93f14b2fc38a2221142d513151a437ef9f14feb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/93f14b2fc38a2221142d513151a437ef9f14feb8"}], "stats": {"total": 65, "additions": 56, "deletions": 9}, "files": [{"sha": "56c8a9407f56f103e4122e896858e3bbf8cfc857", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=27183bba6bc249ae4c73bb799c7df702e98a2467", "patch": "@@ -1,3 +1,9 @@\n+2008-04-05  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/12329\n+\t* config/i386/i386.c (ix86_function_regparm): Error if regparm(3)\n+\tattribute is used for nested functions.\n+\n 2008-04-05  Jan Hubicka  <jh@suse.cz>\n \n \t* emit-rtl.c (init_emit): xcalloc regno_pointer_align.\n@@ -13,8 +19,8 @@\n \tit out based on pass type.\n \t(register_dump_files_1): Likewise.\n \t(init_optimization_passes): Update register_one_dump_file calls.\n-\t(execute_one_pass): Sanity check that IPA passes are called at IPA level\n-\tand RTL passes at RTL level.\n+\t(execute_one_pass): Sanity check that IPA passes are called at IPA\n+\tlevel and RTL passes at RTL level.\n \t(execute_pass_list): IPA pass can not be after or subpass of\n \tGIMPLE/RTL pass.\n \t(execute_ipa_pass_list): Handle IPA subpasses of IPA subpasses and"}, {"sha": "161f9e4fbd159daaedbf9a0a2b9486d4c81331fc", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 22, "deletions": 1, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=27183bba6bc249ae4c73bb799c7df702e98a2467", "patch": "@@ -3250,12 +3250,33 @@ ix86_function_regparm (const_tree type, const_tree decl)\n   tree attr;\n   int regparm = ix86_regparm;\n \n+  static bool error_issued;\n+\n   if (TARGET_64BIT)\n     return regparm;\n \n   attr = lookup_attribute (\"regparm\", TYPE_ATTRIBUTES (type));\n   if (attr)\n-    return TREE_INT_CST_LOW (TREE_VALUE (TREE_VALUE (attr)));\n+    {\n+      regparm\n+\t= TREE_INT_CST_LOW (TREE_VALUE (TREE_VALUE (attr)));\n+\n+      if (decl && TREE_CODE (decl) == FUNCTION_DECL)\n+\t{\n+\t  /* We can't use regparm(3) for nested functions because\n+\t     these pass static chain pointer in %ecx register.  */\n+\t  if (!error_issued && regparm == 3\n+\t      && decl_function_context (decl)\n+\t      && !DECL_NO_STATIC_CHAIN (decl))\n+\t    {\n+\t      error (\"nested functions are limited to 2 register parameters\");\n+\t      error_issued = true;\n+\t      return 0;\n+\t    }\n+\t}\n+\n+      return regparm;\n+    }\n \n   if (lookup_attribute (\"fastcall\", TYPE_ATTRIBUTES (type)))\n     return 2;"}, {"sha": "ee449b600e33d6927c7d367f0224274499fd167f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 11, "deletions": 6, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=27183bba6bc249ae4c73bb799c7df702e98a2467", "patch": "@@ -1,3 +1,8 @@\n+2008-04-06  Uros Bizjak  <ubizjak@gmail.com>\n+\n+\tPR target/12329\n+\t* gcc.target/i386/pr12329.c: New test.\n+\n 2008-04-05  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/pr35823.adb: Rename to size_attribute.adb.\n@@ -163,12 +168,12 @@\n \n \t* lib/gfortran-dg.exp:  New harness to compile Fortran progs\n \twith all combinations of debug options available on target.\n-        * gfortran.dg/debug/debug.exp:  Ditto.\n-        * gfortran.dg/debug/trivial.f:  Ditto.\n-        * gfortran.dg/debug/pr35154-stabs.f:  New test case for\n-        .stabs functionality.\n-        * gfortran.dg/debug/pr35154-dwarf2.f:  New test case for\n-        DWARF functionality.\n+\t* gfortran.dg/debug/debug.exp:  Ditto.\n+\t* gfortran.dg/debug/trivial.f:  Ditto.\n+\t* gfortran.dg/debug/pr35154-stabs.f:  New test case for\n+\t.stabs functionality.\n+\t* gfortran.dg/debug/pr35154-dwarf2.f:  New test case for\n+\tDWARF functionality.\n \n 2008-04-01  Volker Reichelt  <v.reichelt@netcologne.de>\n "}, {"sha": "aeefeb0ce802cf36ddaa2ca25aca6e787049cbc7", "filename": "gcc/testsuite/gcc.target/i386/pr12329.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr12329.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/27183bba6bc249ae4c73bb799c7df702e98a2467/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr12329.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr12329.c?ref=27183bba6bc249ae4c73bb799c7df702e98a2467", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target ilp32 } */\n+/* { dg-options \"-O2\" } */\n+\n+extern void abort (void);\n+\n+int test_nested (int i)\n+{\n+  int __attribute__ ((__noinline__, __regparm__(3))) foo(int j, int k, int l)\n+  { /* { dg-error \"nested functions are limited to 2 register parameters\" } */\n+    return i + j + k + l;\n+  }\n+\n+  return foo (i, i+1, i+2);\n+}"}]}