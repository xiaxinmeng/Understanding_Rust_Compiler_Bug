{"sha": "8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGIyYjMyYWIyZDhjZmY0ZWIwZGFkMGVmNGU3MmUzMzI1NzU3NGNiNg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-05-28T11:05:39Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2021-05-28T12:25:33Z"}, "message": "c/100803 - diagnose invalid GIMPLE condition\n\nanother easy fix for GIMPLE FE parser robustness.\n\n2021-05-28  Richard Biener   <rguenther@suse.de>\n\n\tPR c/100803\ngcc/c/\n\t* gimple-parser.c (c_parser_gimple_paren_condition): Diagnose\n\tinvalid if conditions.\n\ngcc/testsuite/\n\t* gcc.dg/gimplefe-error-11.c: New testcase.", "tree": {"sha": "aa42c7a633285545c834b2abe8501c42ad11917c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aa42c7a633285545c834b2abe8501c42ad11917c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d2a913c76f41692fd0bb955d1768f462133d813a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2a913c76f41692fd0bb955d1768f462133d813a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2a913c76f41692fd0bb955d1768f462133d813a"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "c8d9db61f0aa087e133b42c404db48c3ba290a31", "filename": "gcc/c/gimple-parser.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6/gcc%2Fc%2Fgimple-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6/gcc%2Fc%2Fgimple-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fgimple-parser.c?ref=8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6", "patch": "@@ -2112,6 +2112,14 @@ c_parser_gimple_paren_condition (gimple_parser &parser)\n   if (! c_parser_require (parser, CPP_OPEN_PAREN, \"expected %<(%>\"))\n     return error_mark_node;\n   tree cond = c_parser_gimple_binary_expression (parser).value;\n+  if (cond != error_mark_node\n+      && ! COMPARISON_CLASS_P (cond)\n+      && ! CONSTANT_CLASS_P (cond)\n+      && ! SSA_VAR_P (cond))\n+    {\n+      c_parser_error (parser, \"comparison required\");\n+      cond = error_mark_node;\n+    }\n   if (! c_parser_require (parser, CPP_CLOSE_PAREN, \"expected %<)%>\"))\n     return error_mark_node;\n   return cond;"}, {"sha": "9c29717676a22808d9bf4d0588f421efadbbc7e6", "filename": "gcc/testsuite/gcc.dg/gimplefe-error-11.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6/gcc%2Ftestsuite%2Fgcc.dg%2Fgimplefe-error-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6/gcc%2Ftestsuite%2Fgcc.dg%2Fgimplefe-error-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgimplefe-error-11.c?ref=8b2b32ab2d8cff4eb0dad0ef4e72e33257574cb6", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fgimple\" } */\n+\n+int bar();\n+__GIMPLE\n+int foo()\n+{\n+  if (bar()) /* { dg-error \"comparison required\" } */\n+    goto bb1;\n+  else\n+    goto bb2;\n+}"}]}