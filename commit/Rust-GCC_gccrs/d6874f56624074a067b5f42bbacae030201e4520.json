{"sha": "d6874f56624074a067b5f42bbacae030201e4520", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDY4NzRmNTY2MjQwNzRhMDY3YjVmNDJiYmFjYWUwMzAyMDFlNDUyMA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-01-19T14:35:16Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-01-19T14:35:16Z"}, "message": "Fix memory chunk corruption for opts_obstack (PR jit/68446)\n\ngcc/ChangeLog:\n\tPR jit/68446\n\t* gcc.c (driver::decode_argv): Add call to\n\tinit_opts_obstack before init_options_struct.\n\t* opts.c (init_opts_obstack): Remove idempotency.\n\t(init_options_struct): Replace call to init_opts_obstack\n\twith a gcc_assert to verify that it has already been called.\n\t* toplev.c (toplev::main): Add call to init_opts_obstack before\n\tcalls to init_options_struct.\n\t(toplev::finalize): Move cleanup of opts_obstack next to\n\tcleanup of save_decoded_options, clearing the latter, and\n\tsave_decoded_options_count.\n\nFrom-SVN: r232567", "tree": {"sha": "d79b1923ebfa78c9386a4fa276282c145ef07993", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d79b1923ebfa78c9386a4fa276282c145ef07993"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6874f56624074a067b5f42bbacae030201e4520", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6874f56624074a067b5f42bbacae030201e4520", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6874f56624074a067b5f42bbacae030201e4520", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6874f56624074a067b5f42bbacae030201e4520/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "962801c550a859cc05fd761fac09ade6beb5e34a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/962801c550a859cc05fd761fac09ade6beb5e34a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/962801c550a859cc05fd761fac09ade6beb5e34a"}], "stats": {"total": 36, "additions": 26, "deletions": 10}, "files": [{"sha": "56890c1b97615c37c51636433383f0c95cc61f50", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6874f56624074a067b5f42bbacae030201e4520/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6874f56624074a067b5f42bbacae030201e4520/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d6874f56624074a067b5f42bbacae030201e4520", "patch": "@@ -1,3 +1,17 @@\n+2016-01-19  David Malcolm  <dmalcolm@redhat.com>\n+\n+\tPR jit/68446\n+\t* gcc.c (driver::decode_argv): Add call to\n+\tinit_opts_obstack before init_options_struct.\n+\t* opts.c (init_opts_obstack): Remove idempotency.\n+\t(init_options_struct): Replace call to init_opts_obstack\n+\twith a gcc_assert to verify that it has already been called.\n+\t* toplev.c (toplev::main): Add call to init_opts_obstack before\n+\tcalls to init_options_struct.\n+\t(toplev::finalize): Move cleanup of opts_obstack next to\n+\tcleanup of save_decoded_options, clearing the latter, and\n+\tsave_decoded_options_count.\n+\n 2016-01-19  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \tPR target/69135"}, {"sha": "683b30fcbab1e291c85d06221e54cc6fa1f81ab7", "filename": "gcc/gcc.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6874f56624074a067b5f42bbacae030201e4520/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6874f56624074a067b5f42bbacae030201e4520/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=d6874f56624074a067b5f42bbacae030201e4520", "patch": "@@ -7216,6 +7216,7 @@ driver::decode_argv (int argc, const char **argv)\n   global_init_params ();\n   finish_params ();\n \n+  init_opts_obstack ();\n   init_options_struct (&global_options, &global_options_set);\n \n   decode_cmdline_options_to_array (argc, argv,"}, {"sha": "b4e8144489cde2a86087c9c0fe99ff60a7c23c63", "filename": "gcc/opts.c", "status": "modified", "additions": 5, "deletions": 9, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6874f56624074a067b5f42bbacae030201e4520/gcc%2Fopts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6874f56624074a067b5f42bbacae030201e4520/gcc%2Fopts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fopts.c?ref=d6874f56624074a067b5f42bbacae030201e4520", "patch": "@@ -266,18 +266,12 @@ add_comma_separated_to_vector (void **pvec, const char *arg)\n   *pvec = v;\n }\n \n-/* Initialize opts_obstack if not initialized.  */\n+/* Initialize opts_obstack.  */\n \n void\n init_opts_obstack (void)\n {\n-  static bool opts_obstack_initialized = false;\n-\n-  if (!opts_obstack_initialized)\n-    {\n-      opts_obstack_initialized = true;\n-      gcc_obstack_init (&opts_obstack);\n-    }\n+  gcc_obstack_init (&opts_obstack);\n }\n \n /* Initialize OPTS and OPTS_SET before using them in parsing options.  */\n@@ -287,7 +281,9 @@ init_options_struct (struct gcc_options *opts, struct gcc_options *opts_set)\n {\n   size_t num_params = get_num_compiler_params ();\n \n-  init_opts_obstack ();\n+  /* Ensure that opts_obstack has already been initialized by the time\n+     that we initialize any gcc_options instances (PR jit/68446).  */\n+  gcc_assert (opts_obstack.chunk_size > 0);\n \n   *opts = global_options_init;\n "}, {"sha": "28c115d71c4faa764609a9508f105f97820c825a", "filename": "gcc/toplev.c", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6874f56624074a067b5f42bbacae030201e4520/gcc%2Ftoplev.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6874f56624074a067b5f42bbacae030201e4520/gcc%2Ftoplev.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftoplev.c?ref=d6874f56624074a067b5f42bbacae030201e4520", "patch": "@@ -2053,6 +2053,7 @@ toplev::main (int argc, char **argv)\n   /* One-off initialization of options that does not need to be\n      repeated when options are added for particular functions.  */\n   init_options_once ();\n+  init_opts_obstack ();\n \n   /* Initialize global options structures; this must be repeated for\n      each structure used for parsing options.  */\n@@ -2134,11 +2135,15 @@ toplev::finalize (void)\n   finalize_options_struct (&global_options);\n   finalize_options_struct (&global_options_set);\n \n+  /* save_decoded_options uses opts_obstack, so these must\n+     be cleaned up together.  */\n+  obstack_free (&opts_obstack, NULL);\n   XDELETEVEC (save_decoded_options);\n+  save_decoded_options = NULL;\n+  save_decoded_options_count = 0;\n \n   /* Clean up the context (and pass_manager etc). */\n   delete g;\n   g = NULL;\n \n-  obstack_free (&opts_obstack, NULL);\n }"}]}