{"sha": "0a8e3de3c825de0edac26dc0875e823b1b9d6e9b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGE4ZTNkZTNjODI1ZGUwZWRhYzI2ZGMwODc1ZTgyM2IxYjlkNmU5Yg==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2003-03-12T14:15:09Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2003-03-12T14:15:09Z"}, "message": "hashtab.c (htab_expand): Compute the size of hashtable based on the number of elements actually used.\n\n\t* hashtab.c (htab_expand): Compute the size of hashtable based\n\ton the number of elements actually used.\n\t(htab_traverse):  Call htab_expand when table is too empty.\n\nFrom-SVN: r64246", "tree": {"sha": "185c9ce9c769ea7a3f9729796fff47cc59493df1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/185c9ce9c769ea7a3f9729796fff47cc59493df1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b/comments", "author": null, "committer": null, "parents": [{"sha": "32cf27e58ed0e95c54c2c2f29ed8130df55f843f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/32cf27e58ed0e95c54c2c2f29ed8130df55f843f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/32cf27e58ed0e95c54c2c2f29ed8130df55f843f"}], "stats": {"total": 25, "additions": 22, "deletions": 3}, "files": [{"sha": "16d0b98e123a637793ae15c3b8f9eb5d70e14934", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=0a8e3de3c825de0edac26dc0875e823b1b9d6e9b", "patch": "@@ -1,3 +1,9 @@\n+2003-12-03  Jan Hubicka  <jh@suse.cz>\n+\n+\t* hashtab.c (htab_expand): Compute the size of hashtable based\n+\ton the number of elements actually used.\n+\t(htab_traverse):  Call htab_expand when table is too empty.\n+\n 2003-03-11  Carlo Wood  <carlo@gnu.org>\n \n \t* cplus-dem.c (demangle_integral_value): Correction to reflect"}, {"sha": "a0cb5a75820b559b1f50bf19070cd97bf4f21803", "filename": "libiberty/hashtab.c", "status": "modified", "additions": 16, "deletions": 3, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b/libiberty%2Fhashtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a8e3de3c825de0edac26dc0875e823b1b9d6e9b/libiberty%2Fhashtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fhashtab.c?ref=0a8e3de3c825de0edac26dc0875e823b1b9d6e9b", "patch": "@@ -373,7 +373,14 @@ htab_expand (htab)\n   oentries = htab->entries;\n   olimit = oentries + htab->size;\n \n-  nsize = higher_prime_number (htab->size * 2);\n+  /* Resize only when table after removal of unused elements is either\n+     too full or too empty.  */\n+  if ((htab->n_elements - htab->n_deleted) * 2 > htab->size\n+      || (htab->n_elements - htab->n_deleted) * 8 < htab->size\n+    && htab->size > 32)\n+    nsize = higher_prime_number ((htab->n_elements - htab->n_deleted) * 2);\n+  else\n+    nsize = htab->size;\n \n   if (htab->alloc_with_arg_f != NULL)\n     nentries = (PTR *) (*htab->alloc_with_arg_f) (htab->alloc_arg, nsize,\n@@ -601,8 +608,14 @@ htab_traverse (htab, callback, info)\n      htab_trav callback;\n      PTR info;\n {\n-  PTR *slot = htab->entries;\n-  PTR *limit = slot + htab->size;\n+  PTR *slot;\n+  PTR *limit;\n+\n+  if ((htab->n_elements - htab->n_deleted) * 8 < htab->size)\n+    htab_expand (htab);\n+\n+  slot = htab->entries;\n+  limit = slot + htab->size;\n \n   do\n     {"}]}