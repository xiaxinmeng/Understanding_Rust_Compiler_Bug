{"sha": "e9f57686fcfaf04788a27d6433e7bf727d08001c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTlmNTc2ODZmY2ZhZjA0Nzg4YTI3ZDY0MzNlN2JmNzI3ZDA4MDAxYw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2011-06-06T10:21:58Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2011-06-06T10:21:58Z"}, "message": "trans.c (Identifier_to_gnu): Also handle deferred constants whose full view has discriminants specially.\n\n\t* gcc-interface/trans.c (Identifier_to_gnu): Also handle deferred\n\tconstants whose full view has discriminants specially.\n\nFrom-SVN: r174689", "tree": {"sha": "58ca3843861d0db20c5609c5d70894d34d72aa5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/58ca3843861d0db20c5609c5d70894d34d72aa5b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e9f57686fcfaf04788a27d6433e7bf727d08001c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9f57686fcfaf04788a27d6433e7bf727d08001c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9f57686fcfaf04788a27d6433e7bf727d08001c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9f57686fcfaf04788a27d6433e7bf727d08001c/comments", "author": null, "committer": null, "parents": [{"sha": "10e4d0563e0862eaf29529134cc7b6495fecaa51", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10e4d0563e0862eaf29529134cc7b6495fecaa51", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10e4d0563e0862eaf29529134cc7b6495fecaa51"}], "stats": {"total": 69, "additions": 66, "deletions": 3}, "files": [{"sha": "6587ffd9a0b526f357d06471562ca0b943ed20f4", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e9f57686fcfaf04788a27d6433e7bf727d08001c", "patch": "@@ -1,3 +1,8 @@\n+2011-06-06  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/trans.c (Identifier_to_gnu): Also handle deferred\n+\tconstants whose full view has discriminants specially.\n+\n 2011-06-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/utils.c: Include diagnostic.h."}, {"sha": "ca47e9347de37a50bcf493c67f7e0e8fb3a6ae31", "filename": "gcc/ada/gcc-interface/trans.c", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Fada%2Fgcc-interface%2Ftrans.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Ftrans.c?ref=e9f57686fcfaf04788a27d6433e7bf727d08001c", "patch": "@@ -906,9 +906,11 @@ Identifier_to_gnu (Node_Id gnat_node, tree *gnu_result_type_p)\n      attribute Position, generated for dispatching code (see Make_DT in\n      exp_disp,adb). In that case we need the type itself, not is parent,\n      in particular if it is a derived type  */\n-  if (Is_Private_Type (gnat_temp_type)\n-      && Has_Unknown_Discriminants (gnat_temp_type)\n-      && Ekind (gnat_temp) == E_Constant\n+  if (Ekind (gnat_temp) == E_Constant\n+      && Is_Private_Type (gnat_temp_type)\n+      && (Has_Unknown_Discriminants (gnat_temp_type)\n+\t  || (Present (Full_View (gnat_temp_type))\n+ \t      && Has_Discriminants (Full_View (gnat_temp_type))))\n       && Present (Full_View (gnat_temp)))\n     {\n       gnat_temp = Full_View (gnat_temp);"}, {"sha": "131da5e774334ec30e5add2e791214c1d3e52304", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e9f57686fcfaf04788a27d6433e7bf727d08001c", "patch": "@@ -1,3 +1,8 @@\n+2011-06-06  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/deferred_const4.ad[sb]: New test.\n+\t* gnat.dg/deferred_const4_pkg.ads: New helper.\n+\n 2011-06-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/test_tamdt.adb: Rename to..."}, {"sha": "46f21103ae5eea47a968d8d7eebe347f80883125", "filename": "gcc/testsuite/gnat.dg/deferred_const4.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4.adb?ref=e9f57686fcfaf04788a27d6433e7bf727d08001c", "patch": "@@ -0,0 +1,12 @@\n+-- { dg-do compile }\n+\n+package body Deferred_Const4 is\n+\n+  function F return My_Q.T is\n+    R : My_Q.T;\n+  begin\n+    R := My_Q.Null_T;\n+    return R;\n+  end;\n+\n+end Deferred_Const4;"}, {"sha": "18a4171e8b2da149285bbe286f1340dd86e4be3c", "filename": "gcc/testsuite/gnat.dg/deferred_const4.ads", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4.ads?ref=e9f57686fcfaf04788a27d6433e7bf727d08001c", "patch": "@@ -0,0 +1,17 @@\n+with Deferred_Const4_Pkg;\n+\n+package Deferred_Const4 is\n+\n+  type R1 is tagged record\n+    I1 : Integer;\n+  end record;\n+\n+  type R2 is new R1 with record\n+    I2 : Integer;\n+  end record;\n+\n+  package My_Q is new Deferred_Const4_Pkg (R2);\n+\n+  function F return My_Q.T;\n+\n+end Deferred_Const4;"}, {"sha": "c189063a758074db3ef899d9308b6c114abfbbdd", "filename": "gcc/testsuite/gnat.dg/deferred_const4_pkg.ads", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9f57686fcfaf04788a27d6433e7bf727d08001c/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fdeferred_const4_pkg.ads?ref=e9f57686fcfaf04788a27d6433e7bf727d08001c", "patch": "@@ -0,0 +1,22 @@\n+generic\n+\n+  type User_T is private;\n+\n+package Deferred_Const4_Pkg is\n+\n+  type T is private;\n+\n+  Null_T : constant T;\n+\n+private\n+\n+  type T (Valid : Boolean := False) is record\n+    case Valid is\n+      when True  => Value : User_T;\n+      when False => null;\n+    end case;\n+  end record;\n+\n+  Null_T : constant T := (Valid => False);\n+\n+end Deferred_Const4_Pkg;"}]}