{"sha": "213cfa8d0a9d0bb28bd973323ee2055ee6699d86", "node_id": "C_kwDOANBUbNoAKDIxM2NmYThkMGE5ZDBiYjI4YmQ5NzMzMjNlZTIwNTVlZTY2OTlkODY", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-05-19T09:58:15Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2022-05-19T09:58:15Z"}, "message": "cfgexpand: Yet another spot with debug insns references to global vars without varpool nodes [PR105630]\n\nThis is similar to the earlier patch to avoid having MEM_EXPRs\nreferencing global vars without varpool nodes, but this time\nthe difference is that during gimplification some hashing\nactually created DECL_RTLs for the n VAR_DECL and the previous\nchange was in the if above this when DECL_RTL is NULL and we are\nconsidering creating it.\n\nThe following patch drops on the floor references to vars where\nwe've optimized away the varpool node even when it has DECL_RTL.\n\nBootstrapped/regtested on x86_64-linux and i686-linux, plus\nbootstrapped on those without the cfgexpand.cc change, reapplied\nit and rebuilt stage3 cc1/cc1plus, the resulting cc1/cc1plus\nbinaries on both targets were identical except for the 16-byte\nexecutable_checksum (I've done the second bootstraps in the same\ndirectory as the first one after moving the previous one elsewhere,\nso pathnames were the same, just checksum hasn't been regenerated).\nSo, at least on those binaries this patch doesn't affect debug info\nat all.\n\n2022-05-19  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR debug/105630\n\t* cfgexpand.cc (expand_debug_expr): For VAR_DECL, punt for\n\tglobal vars without symtab node even when they have DECL_RTL\n\tset.\n\n\t* gcc.dg/pr105630.c: New test.", "tree": {"sha": "96df56552f200c91f9af41838b3f8c5ddbb07733", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96df56552f200c91f9af41838b3f8c5ddbb07733"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/213cfa8d0a9d0bb28bd973323ee2055ee6699d86", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/213cfa8d0a9d0bb28bd973323ee2055ee6699d86", "html_url": "https://github.com/Rust-GCC/gccrs/commit/213cfa8d0a9d0bb28bd973323ee2055ee6699d86", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/213cfa8d0a9d0bb28bd973323ee2055ee6699d86/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3b4daa0b3c3d8eb2ac3b40ad6898f314ed4d7919", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b4daa0b3c3d8eb2ac3b40ad6898f314ed4d7919", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b4daa0b3c3d8eb2ac3b40ad6898f314ed4d7919"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "bb33c1b939e054054034e47509f34ad4863988c8", "filename": "gcc/cfgexpand.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/213cfa8d0a9d0bb28bd973323ee2055ee6699d86/gcc%2Fcfgexpand.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/213cfa8d0a9d0bb28bd973323ee2055ee6699d86/gcc%2Fcfgexpand.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.cc?ref=213cfa8d0a9d0bb28bd973323ee2055ee6699d86", "patch": "@@ -4575,6 +4575,10 @@ expand_debug_expr (tree exp)\n \t      || SYMBOL_REF_DECL (XEXP (op0, 0)) != exp)\n \t    return NULL;\n \t}\n+      else if (VAR_P (exp)\n+\t       && is_global_var (exp)\n+\t       && symtab_node::get (exp) == NULL)\n+\treturn NULL;\n       else\n \top0 = copy_rtx (op0);\n "}, {"sha": "c39ca7dda272a730da3d6059fb3cf631a3859861", "filename": "gcc/testsuite/gcc.dg/pr105630.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/213cfa8d0a9d0bb28bd973323ee2055ee6699d86/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105630.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/213cfa8d0a9d0bb28bd973323ee2055ee6699d86/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105630.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr105630.c?ref=213cfa8d0a9d0bb28bd973323ee2055ee6699d86", "patch": "@@ -0,0 +1,22 @@\n+/* PR debug/105630 */\n+/* { dg-do compile { target pthread } } */\n+/* { dg-options \"-O1 -ftree-parallelize-loops=2 -fcompare-debug\" } */\n+\n+int m;\n+static int n;\n+\n+void\n+foo (void)\n+{\n+  int *arr[] = { &n, &n, &n };\n+  int unused = n;\n+\n+  m = 0;\n+}\n+\n+void\n+bar (int *arr, int i)\n+{\n+  while (i < 1)\n+    arr[i++] = 1;\n+}"}]}