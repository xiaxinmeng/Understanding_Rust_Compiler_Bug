{"sha": "31eee11b7cf2f550581949d87443b688232bd2a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzFlZWUxMWI3Y2YyZjU1MDU4MTk0OWQ4NzQ0M2I2ODgyMzJiZDJhNg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-12-13T10:35:41Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-12-13T10:35:41Z"}, "message": "s-tassta.adb (Create_Task): Take into account tasks created by foreign threads.\n\n\t* s-tassta.adb (Create_Task): Take into account tasks created by\n\tforeign threads.\n\tCode clean up: use constants instead of hard coded values.\n\nFrom-SVN: r130865", "tree": {"sha": "bed8b7d025a1c50e17125549d28ffebc431f7ef7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bed8b7d025a1c50e17125549d28ffebc431f7ef7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/31eee11b7cf2f550581949d87443b688232bd2a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31eee11b7cf2f550581949d87443b688232bd2a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/31eee11b7cf2f550581949d87443b688232bd2a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/31eee11b7cf2f550581949d87443b688232bd2a6/comments", "author": null, "committer": null, "parents": [{"sha": "e4b551223d976bfa9117c3e3b9eaaaf952441db3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e4b551223d976bfa9117c3e3b9eaaaf952441db3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e4b551223d976bfa9117c3e3b9eaaaf952441db3"}], "stats": {"total": 17, "additions": 14, "deletions": 3}, "files": [{"sha": "9c574f06dc81442c2221ef7676a8ea07eb507f1f", "filename": "gcc/ada/s-tassta.adb", "status": "modified", "additions": 14, "deletions": 3, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/31eee11b7cf2f550581949d87443b688232bd2a6/gcc%2Fada%2Fs-tassta.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/31eee11b7cf2f550581949d87443b688232bd2a6/gcc%2Fada%2Fs-tassta.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-tassta.adb?ref=31eee11b7cf2f550581949d87443b688232bd2a6", "patch": "@@ -614,7 +614,18 @@ package body System.Tasking.Stages is\n            (Storage_Error'Identity, \"Failed to initialize task\");\n       end if;\n \n-      T.Master_of_Task := Master;\n+      if Master = Foreign_Task_Level + 2 then\n+\n+         --  This should not happen, except when a foreign task creates non\n+         --  library-level Ada tasks. In this case, we pretend the master is\n+         --  a regular library level task, otherwise the run-time will get\n+         --  confused when waiting for these tasks to terminate.\n+\n+         T.Master_of_Task := Library_Task_Level;\n+      else\n+         T.Master_of_Task := Master;\n+      end if;\n+\n       T.Master_Within := T.Master_of_Task + 1;\n \n       for L in T.Entry_Calls'Range loop\n@@ -1276,7 +1287,7 @@ package body System.Tasking.Stages is\n       --  Check if the current task is an independent task If so, decrement\n       --  the Independent_Task_Count value.\n \n-      if Master_of_Task = 2 then\n+      if Master_of_Task = Independent_Task_Level then\n          if Single_Lock then\n             Utilities.Independent_Task_Count :=\n               Utilities.Independent_Task_Count - 1;\n@@ -1772,7 +1783,7 @@ package body System.Tasking.Stages is\n \n          if (T.Common.Parent /= null\n               and then T.Common.Parent.Common.Parent /= null)\n-           or else T.Master_of_Task > 3\n+           or else T.Master_of_Task > Library_Task_Level\n          then\n             Initialization.Task_Lock (Self_ID);\n "}]}