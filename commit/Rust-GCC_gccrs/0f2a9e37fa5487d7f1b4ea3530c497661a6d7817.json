{"sha": "0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGYyYTllMzdmYTU0ODdkN2YxYjRlYTM1MzBjNDk3NjYxYTZkNzgxNw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-10-24T18:44:30Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-10-24T18:44:30Z"}, "message": "dwarf2out.c (gen_subprogram_die): Add DW_AT_reference or DW_AT_rvalue_reference attributes.\n\n\t* dwarf2out.c (gen_subprogram_die): Add DW_AT_reference or\n\tDW_AT_rvalue_reference attributes.\n\n\t* cp-objcp-common.c (cp_decl_dwarf_attribute): Handle DW_AT_reference\n\tand DW_AT_rvalue_reference.\n\n\t* g++.dg/debug/dwarf2/ref-2.C: New test.\n\nFrom-SVN: r241492", "tree": {"sha": "6675f8e8df8869495a58275f084067520862325c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6675f8e8df8869495a58275f084067520862325c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "331075711a0f19224c11cc880c695fd52723b881", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/331075711a0f19224c11cc880c695fd52723b881", "html_url": "https://github.com/Rust-GCC/gccrs/commit/331075711a0f19224c11cc880c695fd52723b881"}], "stats": {"total": 73, "additions": 73, "deletions": 0}, "files": [{"sha": "88bace4ea16b5c7ece1a433f95dadf825e641c01", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "patch": "@@ -1,3 +1,8 @@\n+2016-10-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* dwarf2out.c (gen_subprogram_die): Add DW_AT_reference or\n+\tDW_AT_rvalue_reference attributes.\n+\n 2016-10-24  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* doc/invoke.text (Wint-in-bool-context): Update documentation."}, {"sha": "744eb5288a2949b7b4c2c9936e0bc207236c887b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "patch": "@@ -1,5 +1,8 @@\n 2016-10-24  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* cp-objcp-common.c (cp_decl_dwarf_attribute): Handle DW_AT_reference\n+\tand DW_AT_rvalue_reference.\n+\n \t* cxx-pretty-print.c (pp_cxx_check_constraint): Use VAR_P (x)\n \tinstead of TREE_CODE (x) == VAR_DECL.\n \t* constraint.cc (get_concept_definition): Likewise."}, {"sha": "070b64c5d826022fcb43c6e3146cd7ceb814d663", "filename": "gcc/cp/cp-objcp-common.c", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Fcp%2Fcp-objcp-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Fcp%2Fcp-objcp-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-objcp-common.c?ref=0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "patch": "@@ -173,6 +173,32 @@ cp_decl_dwarf_attribute (const_tree decl, int attr)\n \treturn 1;\n       break;\n \n+    case DW_AT_reference:\n+      if (TREE_CODE (decl) == FUNCTION_DECL\n+\t  && DECL_NONSTATIC_MEMBER_FUNCTION_P (decl)\n+\t  && FUNCTION_REF_QUALIFIED (TREE_TYPE (decl))\n+\t  && !FUNCTION_RVALUE_QUALIFIED (TREE_TYPE (decl)))\n+\treturn 1;\n+      if ((TREE_CODE (decl) == FUNCTION_TYPE\n+\t   || TREE_CODE (decl) == METHOD_TYPE)\n+\t  && FUNCTION_REF_QUALIFIED (decl)\n+\t  && !FUNCTION_RVALUE_QUALIFIED (decl))\n+\treturn 1;\n+      break;\n+\n+    case DW_AT_rvalue_reference:\n+      if (TREE_CODE (decl) == FUNCTION_DECL\n+\t  && DECL_NONSTATIC_MEMBER_FUNCTION_P (decl)\n+\t  && FUNCTION_REF_QUALIFIED (TREE_TYPE (decl))\n+\t  && FUNCTION_RVALUE_QUALIFIED (TREE_TYPE (decl)))\n+\treturn 1;\n+      if ((TREE_CODE (decl) == FUNCTION_TYPE\n+\t   || TREE_CODE (decl) == METHOD_TYPE)\n+\t  && FUNCTION_REF_QUALIFIED (decl)\n+\t  && FUNCTION_RVALUE_QUALIFIED (decl))\n+\treturn 1;\n+      break;\n+\n     default:\n       break;\n     }"}, {"sha": "515ee6e4261e4a2b5e866cfd561e802d513c546b", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "patch": "@@ -20662,6 +20662,21 @@ gen_subprogram_die (tree decl, dw_die_ref context_die)\n \t      if (defaulted != -1)\n \t\tadd_AT_unsigned (subr_die, DW_AT_defaulted, defaulted);\n \t    }\n+\n+\t  /* If this is a C++11 non-static member function with & ref-qualifier\n+\t     then generate a DW_AT_reference attribute.  */\n+\t  if ((dwarf_version >= 5 || !dwarf_strict)\n+\t      && lang_hooks.decls.decl_dwarf_attribute (decl,\n+\t\t\t\t\t\t\tDW_AT_reference) == 1)\n+\t    add_AT_flag (subr_die, DW_AT_reference, 1);\n+\n+\t  /* If this is a C++11 non-static member function with &&\n+\t     ref-qualifier then generate a DW_AT_reference attribute.  */\n+\t  if ((dwarf_version >= 5 || !dwarf_strict)\n+\t      && lang_hooks.decls.decl_dwarf_attribute (decl,\n+\t\t\t\t\t\t\tDW_AT_rvalue_reference)\n+\t\t == 1)\n+\t    add_AT_flag (subr_die, DW_AT_rvalue_reference, 1);\n \t}\n     }\n   /* Tag abstract instances with DW_AT_inline.  */"}, {"sha": "dc5f13ee3918b7b3c392b779a6372a960c1b56b6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "patch": "@@ -1,3 +1,7 @@\n+2016-10-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* g++.dg/debug/dwarf2/ref-2.C: New test.\n+\n 2016-10-24  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* c-c++-common/Wint-in-bool-context-3.c: New test."}, {"sha": "dd1f457d3ec37a93254d31ed0eead6266a382b6d", "filename": "gcc/testsuite/g++.dg/debug/dwarf2/ref-2.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fref-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f2a9e37fa5487d7f1b4ea3530c497661a6d7817/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fref-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdebug%2Fdwarf2%2Fref-2.C?ref=0f2a9e37fa5487d7f1b4ea3530c497661a6d7817", "patch": "@@ -0,0 +1,20 @@\n+// { dg-do compile { target c++11 } }\n+// { dg-options \"-g -gno-strict-dwarf -dA\" }\n+// { dg-final { scan-assembler-times \" DW_AT_reference\" 1 } }\n+// { dg-final { scan-assembler-times \" DW_AT_rvalue_reference\" 1 } }\n+\n+struct S\n+{\n+  void foo ();\n+  void bar () &;\n+  void baz () &&;\n+};\n+\n+void\n+test ()\n+{\n+  S s;\n+  s.foo ();\n+  s.bar ();\n+  S ().baz ();\n+}"}]}