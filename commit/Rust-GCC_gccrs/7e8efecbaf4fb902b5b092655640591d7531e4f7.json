{"sha": "7e8efecbaf4fb902b5b092655640591d7531e4f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2U4ZWZlY2JhZjRmYjkwMmI1YjA5MjY1NTY0MDU5MWQ3NTMxZTRmNw==", "commit": {"author": {"name": "Gregor Richards", "email": "gregor.richards@uwaterloo.ca", "date": "2015-10-23T19:07:05Z"}, "committer": {"name": "Szabolcs Nagy", "email": "nsz@gcc.gnu.org", "date": "2015-10-23T19:07:05Z"}, "message": "powerpc musl libc support\n\ngcc/\n\t* config/rs6000/linux64.h (MUSL_DYNAMIC_LINKER32): Define.\n\t(MUSL_DYNAMIC_LINKER64): Define.\n\t(GNU_USER_DYNAMIC_LINKER32): Update.\n\t(GNU_USER_DYNAMIC_LINKER64): Update.\n\t(CHOOSE_DYNAMIC_LINKER): Update.\n\n\t* config/rs6000/sysv4.h (GNU_USER_DYNAMIC_LINKER): Update.\n\t(MUSL_DYNAMIC_LINKER, MUSL_DYNAMIC_LINKER_E,)\n\t(INCLUDE_DEFAULTS_MUSL_GPP, INCLUDE_DEFAULTS_MUSL_LOCAL,)\n\t(INCLUDE_DEFAULTS_MUSL_PREFIX, INCLUDE_DEFAULTS_MUSL_CROSS,)\n\t(INCLUDE_DEFAULTS_MUSL_TOOL, INCLUDE_DEFAULTS_MUSL_NATIVE): Define.\n\t(CHOOSE_DYNAMIC_LINKER): Update.\n\t(INCLUDE_DEFAULTS): Redefine.\n\n\t* config/rs6000/sysv4le.h (MUSL_DYNAMIC_LINKER_E): Define.\n\n\nCo-Authored-By: Szabolcs Nagy <szabolcs.nagy@arm.com>\n\nFrom-SVN: r229266", "tree": {"sha": "2dc592ba7d62f267297f24a69136840a7b3ac904", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2dc592ba7d62f267297f24a69136840a7b3ac904"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7e8efecbaf4fb902b5b092655640591d7531e4f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e8efecbaf4fb902b5b092655640591d7531e4f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7e8efecbaf4fb902b5b092655640591d7531e4f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7e8efecbaf4fb902b5b092655640591d7531e4f7/comments", "author": null, "committer": null, "parents": [{"sha": "addf86347db70c659be57197ac92d9abe0549bd8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/addf86347db70c659be57197ac92d9abe0549bd8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/addf86347db70c659be57197ac92d9abe0549bd8"}], "stats": {"total": 127, "additions": 120, "deletions": 7}, "files": [{"sha": "5aef5b72cd16b791022d5b5e277dd8f97d3fb148", "filename": "gcc/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7e8efecbaf4fb902b5b092655640591d7531e4f7", "patch": "@@ -1,3 +1,22 @@\n+2015-10-23  Gregor Richards  <gregor.richards@uwaterloo.ca>\n+\t    Szabolcs Nagy  <szabolcs.nagy@arm.com>\n+\n+\t* config/rs6000/linux64.h (MUSL_DYNAMIC_LINKER32): Define.\n+\t(MUSL_DYNAMIC_LINKER64): Define.\n+\t(GNU_USER_DYNAMIC_LINKER32): Update.\n+\t(GNU_USER_DYNAMIC_LINKER64): Update.\n+\t(CHOOSE_DYNAMIC_LINKER): Update.\n+\n+\t* config/rs6000/sysv4.h (GNU_USER_DYNAMIC_LINKER): Update.\n+\t(MUSL_DYNAMIC_LINKER, MUSL_DYNAMIC_LINKER_E,)\n+\t(INCLUDE_DEFAULTS_MUSL_GPP, INCLUDE_DEFAULTS_MUSL_LOCAL,)\n+\t(INCLUDE_DEFAULTS_MUSL_PREFIX, INCLUDE_DEFAULTS_MUSL_CROSS,)\n+\t(INCLUDE_DEFAULTS_MUSL_TOOL, INCLUDE_DEFAULTS_MUSL_NATIVE): Define.\n+\t(CHOOSE_DYNAMIC_LINKER): Update.\n+\t(INCLUDE_DEFAULTS): Redefine.\n+\n+\t* config/rs6000/sysv4le.h (MUSL_DYNAMIC_LINKER_E): Define.\n+\n 2015-10-23  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* fold-const.c (operand_equal_p): Do not compare TYPE_MODE when"}, {"sha": "810d2f8b0d826dbb3a99d4cf959e76b7de79aa99", "filename": "gcc/config/rs6000/linux64.h", "status": "modified", "additions": 16, "deletions": 4, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2Fconfig%2Frs6000%2Flinux64.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2Fconfig%2Frs6000%2Flinux64.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Flinux64.h?ref=7e8efecbaf4fb902b5b092655640591d7531e4f7", "patch": "@@ -421,19 +421,31 @@ extern int dot_symbols;\n \":%(dynamic_linker_prefix)/lib64/ld64.so.1}\"\n #endif\n \n+#define MUSL_DYNAMIC_LINKER32 \\\n+  \"/lib/ld-musl-powerpc\" MUSL_DYNAMIC_LINKER_E \"%{msoft-float:-sf}.so.1\"\n+#define MUSL_DYNAMIC_LINKER64 \\\n+  \"/lib/ld-musl-powerpc64\" MUSL_DYNAMIC_LINKER_E \"%{msoft-float:-sf}.so.1\"\n+\n #define UCLIBC_DYNAMIC_LINKER32 \"/lib/ld-uClibc.so.0\"\n #define UCLIBC_DYNAMIC_LINKER64 \"/lib/ld64-uClibc.so.0\"\n #if DEFAULT_LIBC == LIBC_UCLIBC\n-#define CHOOSE_DYNAMIC_LINKER(G, U) \"%{mglibc:\" G \";:\" U \"}\"\n+#define CHOOSE_DYNAMIC_LINKER(G, U, M) \\\n+  \"%{mglibc:\" G \";:%{mmusl:\" M \";:\" U \"}}\"\n #elif DEFAULT_LIBC == LIBC_GLIBC\n-#define CHOOSE_DYNAMIC_LINKER(G, U) \"%{muclibc:\" U \";:\" G \"}\"\n+#define CHOOSE_DYNAMIC_LINKER(G, U, M) \\\n+  \"%{muclibc:\" U \";:%{mmusl:\" M \";:\" G \"}}\"\n+#elif DEFAULT_LIBC == LIBC_MUSL\n+#define CHOOSE_DYNAMIC_LINKER(G, U, M) \\\n+  \"%{mglibc:\" G \";:%{muclibc:\" U \";:\" M \"}}\"\n #else\n #error \"Unsupported DEFAULT_LIBC\"\n #endif\n #define GNU_USER_DYNAMIC_LINKER32 \\\n-  CHOOSE_DYNAMIC_LINKER (GLIBC_DYNAMIC_LINKER32, UCLIBC_DYNAMIC_LINKER32)\n+  CHOOSE_DYNAMIC_LINKER (GLIBC_DYNAMIC_LINKER32, UCLIBC_DYNAMIC_LINKER32, \\\n+\t\t\t MUSL_DYNAMIC_LINKER32)\n #define GNU_USER_DYNAMIC_LINKER64 \\\n-  CHOOSE_DYNAMIC_LINKER (GLIBC_DYNAMIC_LINKER64, UCLIBC_DYNAMIC_LINKER64)\n+  CHOOSE_DYNAMIC_LINKER (GLIBC_DYNAMIC_LINKER64, UCLIBC_DYNAMIC_LINKER64, \\\n+\t\t\t MUSL_DYNAMIC_LINKER64)\n \n #undef  DEFAULT_ASM_ENDIAN\n #if (TARGET_DEFAULT & MASK_LITTLE_ENDIAN)"}, {"sha": "20fa3eb07c52ea374c8a65bbf767c420bd025504", "filename": "gcc/config/rs6000/sysv4.h", "status": "modified", "additions": 83, "deletions": 3, "changes": 86, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2Fconfig%2Frs6000%2Fsysv4.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fsysv4.h?ref=7e8efecbaf4fb902b5b092655640591d7531e4f7", "patch": "@@ -762,17 +762,27 @@ ENDIAN_SELECT(\" -mbig\", \" -mlittle\", DEFAULT_ASM_ENDIAN)\n \n #define LINK_START_LINUX_SPEC \"\"\n \n+#define MUSL_DYNAMIC_LINKER_E ENDIAN_SELECT(\"\",\"le\",\"\")\n+\n #define GLIBC_DYNAMIC_LINKER \"/lib/ld.so.1\"\n #define UCLIBC_DYNAMIC_LINKER \"/lib/ld-uClibc.so.0\"\n+#define MUSL_DYNAMIC_LINKER \\\n+  \"/lib/ld-musl-powerpc\" MUSL_DYNAMIC_LINKER_E \"%{msoft-float:-sf}.so.1\"\n #if DEFAULT_LIBC == LIBC_UCLIBC\n-#define CHOOSE_DYNAMIC_LINKER(G, U) \"%{mglibc:\" G \";:\" U \"}\"\n+#define CHOOSE_DYNAMIC_LINKER(G, U, M) \\\n+  \"%{mglibc:\" G \";:%{mmusl:\" M \";:\" U \"}}\"\n+#elif DEFAULT_LIBC == LIBC_MUSL\n+#define CHOOSE_DYNAMIC_LINKER(G, U, M) \\\n+  \"%{mglibc:\" G \";:%{muclibc:\" U \";:\" M \"}}\"\n #elif !defined (DEFAULT_LIBC) || DEFAULT_LIBC == LIBC_GLIBC\n-#define CHOOSE_DYNAMIC_LINKER(G, U) \"%{muclibc:\" U \";:\" G \"}\"\n+#define CHOOSE_DYNAMIC_LINKER(G, U, M) \\\n+  \"%{muclibc:\" U \";:%{mmusl:\" M \";:\" G \"}}\"\n #else\n #error \"Unsupported DEFAULT_LIBC\"\n #endif\n #define GNU_USER_DYNAMIC_LINKER \\\n-  CHOOSE_DYNAMIC_LINKER (GLIBC_DYNAMIC_LINKER, UCLIBC_DYNAMIC_LINKER)\n+  CHOOSE_DYNAMIC_LINKER (GLIBC_DYNAMIC_LINKER, UCLIBC_DYNAMIC_LINKER, \\\n+\t\t\t MUSL_DYNAMIC_LINKER)\n \n #define LINK_OS_LINUX_SPEC \"-m elf32ppclinux %{!shared: %{!static: \\\n   %{rdynamic:-export-dynamic} \\\n@@ -949,3 +959,73 @@ ncrtn.o%s\"\n /* This target uses the sysv4.opt file.  */\n #define TARGET_USES_SYSV4_OPT 1\n \n+/* Include order changes for musl, same as in generic linux.h.  */\n+#if DEFAULT_LIBC == LIBC_MUSL\n+#define INCLUDE_DEFAULTS_MUSL_GPP\t\t\t\\\n+    { GPLUSPLUS_INCLUDE_DIR, \"G++\", 1, 1,\t\t\\\n+      GPLUSPLUS_INCLUDE_DIR_ADD_SYSROOT, 0 },\t\t\\\n+    { GPLUSPLUS_TOOL_INCLUDE_DIR, \"G++\", 1, 1,\t\t\\\n+      GPLUSPLUS_INCLUDE_DIR_ADD_SYSROOT, 1 },\t\t\\\n+    { GPLUSPLUS_BACKWARD_INCLUDE_DIR, \"G++\", 1, 1,\t\\\n+      GPLUSPLUS_INCLUDE_DIR_ADD_SYSROOT, 0 },\n+\n+#ifdef LOCAL_INCLUDE_DIR\n+#define INCLUDE_DEFAULTS_MUSL_LOCAL\t\t\t\\\n+    { LOCAL_INCLUDE_DIR, 0, 0, 1, 1, 2 },\t\t\\\n+    { LOCAL_INCLUDE_DIR, 0, 0, 1, 1, 0 },\n+#else\n+#define INCLUDE_DEFAULTS_MUSL_LOCAL\n+#endif\n+\n+#ifdef PREFIX_INCLUDE_DIR\n+#define INCLUDE_DEFAULTS_MUSL_PREFIX\t\t\t\\\n+    { PREFIX_INCLUDE_DIR, 0, 0, 1, 0, 0},\n+#else\n+#define INCLUDE_DEFAULTS_MUSL_PREFIX\n+#endif\n+\n+#ifdef CROSS_INCLUDE_DIR\n+#define INCLUDE_DEFAULTS_MUSL_CROSS\t\t\t\\\n+    { CROSS_INCLUDE_DIR, \"GCC\", 0, 0, 0, 0},\n+#else\n+#define INCLUDE_DEFAULTS_MUSL_CROSS\n+#endif\n+\n+#ifdef TOOL_INCLUDE_DIR\n+#define INCLUDE_DEFAULTS_MUSL_TOOL\t\t\t\\\n+    { TOOL_INCLUDE_DIR, \"BINUTILS\", 0, 1, 0, 0},\n+#else\n+#define INCLUDE_DEFAULTS_MUSL_TOOL\n+#endif\n+\n+#ifdef NATIVE_SYSTEM_HEADER_DIR\n+#define INCLUDE_DEFAULTS_MUSL_NATIVE\t\t\t\\\n+    { NATIVE_SYSTEM_HEADER_DIR, 0, 0, 0, 1, 2 },\t\\\n+    { NATIVE_SYSTEM_HEADER_DIR, 0, 0, 0, 1, 0 },\n+#else\n+#define INCLUDE_DEFAULTS_MUSL_NATIVE\n+#endif\n+\n+#if defined (CROSS_DIRECTORY_STRUCTURE) && !defined (TARGET_SYSTEM_ROOT)\n+# undef INCLUDE_DEFAULTS_MUSL_LOCAL\n+# define INCLUDE_DEFAULTS_MUSL_LOCAL\n+# undef INCLUDE_DEFAULTS_MUSL_NATIVE\n+# define INCLUDE_DEFAULTS_MUSL_NATIVE\n+#else\n+# undef INCLUDE_DEFAULTS_MUSL_CROSS\n+# define INCLUDE_DEFAULTS_MUSL_CROSS\n+#endif\n+\n+#undef INCLUDE_DEFAULTS\n+#define INCLUDE_DEFAULTS\t\t\t\t\\\n+  {\t\t\t\t\t\t\t\\\n+    INCLUDE_DEFAULTS_MUSL_GPP\t\t\t\t\\\n+    INCLUDE_DEFAULTS_MUSL_LOCAL\t\t\t\t\\\n+    INCLUDE_DEFAULTS_MUSL_PREFIX\t\t\t\\\n+    INCLUDE_DEFAULTS_MUSL_CROSS\t\t\t\t\\\n+    INCLUDE_DEFAULTS_MUSL_TOOL\t\t\t\t\\\n+    INCLUDE_DEFAULTS_MUSL_NATIVE\t\t\t\\\n+    { GCC_INCLUDE_DIR, \"GCC\", 0, 1, 0, 0 },\t\t\\\n+    { 0, 0, 0, 0, 0, 0 }\t\t\t\t\\\n+  }\n+#endif"}, {"sha": "f00e8b0b8320571f400c18751603c04876170023", "filename": "gcc/config/rs6000/sysv4le.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2Fconfig%2Frs6000%2Fsysv4le.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7e8efecbaf4fb902b5b092655640591d7531e4f7/gcc%2Fconfig%2Frs6000%2Fsysv4le.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fsysv4le.h?ref=7e8efecbaf4fb902b5b092655640591d7531e4f7", "patch": "@@ -31,3 +31,5 @@\n /* Little-endian PowerPC64 Linux uses the ELF v2 ABI by default.  */\n #define LINUX64_DEFAULT_ABI_ELFv2\n \n+#undef MUSL_DYNAMIC_LINKER_E\n+#define MUSL_DYNAMIC_LINKER_E ENDIAN_SELECT(\"\",\"le\",\"le\")"}]}