{"sha": "2324b3fd3862e466c3098c17eeb06b056f1d16ee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjMyNGIzZmQzODYyZTQ2NmMzMDk4YzE3ZWViMDZiMDU2ZjFkMTZlZQ==", "commit": {"author": {"name": "Emmanuel Briot", "email": "briot@adacore.com", "date": "2009-04-24T13:25:35Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2009-04-24T13:25:35Z"}, "message": "2009-04-24  Emmanuel Briot  <briot@adacore.com>\n\n\t* make.adb, prj.adb, prj.ads, makeutl.adb, makeutl.ads:\n\t(Project_Data.Dir_Path): field removed, since it can be computed\n\tdirectly from .Directory, and is needed only once when processing the\n\tproject is buildgpr.adb or make.adb\n\nFrom-SVN: r146719", "tree": {"sha": "3cb23ab452a5575705b017da687491f2eb562291", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3cb23ab452a5575705b017da687491f2eb562291"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2324b3fd3862e466c3098c17eeb06b056f1d16ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2324b3fd3862e466c3098c17eeb06b056f1d16ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2324b3fd3862e466c3098c17eeb06b056f1d16ee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2324b3fd3862e466c3098c17eeb06b056f1d16ee/comments", "author": {"login": "briot", "id": 42402, "node_id": "MDQ6VXNlcjQyNDAy", "avatar_url": "https://avatars.githubusercontent.com/u/42402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/briot", "html_url": "https://github.com/briot", "followers_url": "https://api.github.com/users/briot/followers", "following_url": "https://api.github.com/users/briot/following{/other_user}", "gists_url": "https://api.github.com/users/briot/gists{/gist_id}", "starred_url": "https://api.github.com/users/briot/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/briot/subscriptions", "organizations_url": "https://api.github.com/users/briot/orgs", "repos_url": "https://api.github.com/users/briot/repos", "events_url": "https://api.github.com/users/briot/events{/privacy}", "received_events_url": "https://api.github.com/users/briot/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "74744c7bdaabf1a34fb5e613b193d59b61a81c85", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74744c7bdaabf1a34fb5e613b193d59b61a81c85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74744c7bdaabf1a34fb5e613b193d59b61a81c85"}], "stats": {"total": 95, "additions": 38, "deletions": 57}, "files": [{"sha": "be36f83729a3c4d59ac3bdcad29ba939e770589b", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=2324b3fd3862e466c3098c17eeb06b056f1d16ee", "patch": "@@ -1,3 +1,10 @@\n+2009-04-24  Emmanuel Briot  <briot@adacore.com>\n+\n+\t* make.adb, prj.adb, prj.ads, makeutl.adb, makeutl.ads:\n+\t(Project_Data.Dir_Path): field removed, since it can be computed\n+\tdirectly from .Directory, and is needed only once when processing the\n+\tproject is buildgpr.adb or make.adb\n+\n 2009-04-24  Robert Dewar  <dewar@adacore.com>\n \n \t* prj-env.adb, prj-proc.adb, prj.adb, prj.ads,"}, {"sha": "b9c9bb7df7b85c7cd45adea9b93b314d47f4abec", "filename": "gcc/ada/make.adb", "status": "modified", "additions": 19, "deletions": 27, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fmake.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fmake.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmake.adb?ref=2324b3fd3862e466c3098c17eeb06b056f1d16ee", "patch": "@@ -2351,16 +2351,10 @@ package body Make is\n                --  We get the project directory for the relative path\n                --  switches and arguments.\n \n+               Arguments_Project := Ultimate_Extending_Project_Of\n+                 (Arguments_Project, Project_Tree);\n                Data := Project_Tree.Projects.Table (Arguments_Project);\n \n-               --  If the source is in an extended project, we go to\n-               --  the ultimate extending project.\n-\n-               while Data.Extended_By /= No_Project loop\n-                  Arguments_Project := Data.Extended_By;\n-                  Data := Project_Tree.Projects.Table (Arguments_Project);\n-               end loop;\n-\n                --  If building a dynamic or relocatable library, compile with\n                --  PIC option, if it exists.\n \n@@ -2375,13 +2369,6 @@ package body Make is\n                   end;\n                end if;\n \n-               if Data.Dir_Path = null then\n-                  Data.Dir_Path :=\n-                    new String'(Get_Name_String (Data.Directory.Display_Name));\n-                  Project_Tree.Projects.Table (Arguments_Project) :=\n-                    Data;\n-               end if;\n-\n                --  We now look for package Compiler and get the switches from\n                --  this package.\n \n@@ -2431,6 +2418,8 @@ package body Make is\n                         declare\n                            New_Args : Argument_List (1 .. Number);\n                            Last_New : Natural := 0;\n+                           Dir_Path : constant String :=\n+                             Get_Name_String (Data.Directory.Name);\n \n                         begin\n                            Current := Switches.Values;\n@@ -2446,7 +2435,7 @@ package body Make is\n                                    new String'(Name_Buffer (1 .. Name_Len));\n                                  Test_If_Relative_Path\n                                    (New_Args (Last_New),\n-                                    Parent => Data.Dir_Path,\n+                                    Parent => Dir_Path,\n                                     Including_Non_Switch => False);\n                               end if;\n \n@@ -2471,11 +2460,13 @@ package body Make is\n                         New_Args : Argument_List :=\n                                      (1 => new String'\n                                             (Name_Buffer (1 .. Name_Len)));\n+                        Dir_Path : constant String :=\n+                          Get_Name_String (Data.Directory.Name);\n \n                      begin\n                         Test_If_Relative_Path\n                           (New_Args (1),\n-                           Parent               => Data.Dir_Path,\n+                           Parent               => Dir_Path,\n                            Including_Non_Switch => False);\n                         Add_Arguments\n                           (Configuration_Pragmas_Switch (Arguments_Project) &\n@@ -5411,10 +5402,10 @@ package body Make is\n          --  project file.\n \n          declare\n-            Dir_Path : constant String_Access :=\n-                         new String'(Get_Name_String\n+            Dir_Path : constant String :=\n+                         Get_Name_String\n                            (Project_Tree.Projects.Table\n-                              (Main_Project).Directory.Name));\n+                              (Main_Project).Directory.Name);\n          begin\n             for J in 1 .. Binder_Switches.Last loop\n                Test_If_Relative_Path\n@@ -5425,7 +5416,7 @@ package body Make is\n             for J in 1 .. Saved_Binder_Switches.Last loop\n                Test_If_Relative_Path\n                  (Saved_Binder_Switches.Table (J),\n-                  Parent => Current_Work_Dir, Including_L_Switch => False);\n+                  Parent => Current_Work_Dir.all, Including_L_Switch => False);\n             end loop;\n \n             for J in 1 .. Linker_Switches.Last loop\n@@ -5435,7 +5426,8 @@ package body Make is\n \n             for J in 1 .. Saved_Linker_Switches.Last loop\n                Test_If_Relative_Path\n-                 (Saved_Linker_Switches.Table (J), Parent => Current_Work_Dir);\n+                 (Saved_Linker_Switches.Table (J),\n+                  Parent => Current_Work_Dir.all);\n             end loop;\n \n             for J in 1 .. Gcc_Switches.Last loop\n@@ -5448,7 +5440,7 @@ package body Make is\n             for J in 1 .. Saved_Gcc_Switches.Last loop\n                Test_If_Relative_Path\n                  (Saved_Gcc_Switches.Table (J),\n-                  Parent => Current_Work_Dir,\n+                  Parent => Current_Work_Dir.all,\n                   Including_Non_Switch => False);\n             end loop;\n          end;\n@@ -6581,10 +6573,10 @@ package body Make is\n                   --  relative path in the project file.\n \n                   declare\n-                     Dir_Path : constant String_Access :=\n-                       new String'(Get_Name_String\n-                                     (Project_Tree.Projects.Table\n-                                        (Main_Project).Directory.Name));\n+                     Dir_Path : constant String :=\n+                       Get_Name_String\n+                         (Project_Tree.Projects.Table\n+                              (Main_Project).Directory.Name);\n                   begin\n                      for\n                        J in Last_Binder_Switch + 1 .. Binder_Switches.Last"}, {"sha": "c5bd942881e7572f55916b31c1426641b140427f", "filename": "gcc/ada/makeutl.adb", "status": "modified", "additions": 8, "deletions": 16, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fmakeutl.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fmakeutl.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeutl.adb?ref=2324b3fd3862e466c3098c17eeb06b056f1d16ee", "patch": "@@ -422,17 +422,10 @@ package body Makeutl is\n             Proj    : constant Project_Id :=\n                         Linker_Opts.Table (Index).Project;\n             Option  : Name_Id;\n+            Dir_Path : constant String :=\n+              Get_Name_String (In_Tree.Projects.Table (Proj).Directory.Name);\n \n          begin\n-            --  If Dir_Path has not been computed for this project, do it now\n-\n-            if In_Tree.Projects.Table (Proj).Dir_Path = null then\n-               In_Tree.Projects.Table (Proj).Dir_Path :=\n-                 new String'\n-                   (Get_Name_String\n-                        (In_Tree.Projects.Table (Proj).Directory.Name));\n-            end if;\n-\n             while Options /= Nil_String loop\n                Option := In_Tree.String_Elements.Table (Options).Value;\n                Get_Name_String (Option);\n@@ -447,7 +440,7 @@ package body Makeutl is\n \n                   Test_If_Relative_Path\n                     (Switch => Linker_Options_Buffer (Last_Linker_Option),\n-                     Parent => In_Tree.Projects.Table (Proj).Dir_Path,\n+                     Parent => Dir_Path,\n                      Including_L_Switch => True);\n                end if;\n \n@@ -604,7 +597,7 @@ package body Makeutl is\n \n    procedure Test_If_Relative_Path\n      (Switch               : in out String_Access;\n-      Parent               : String_Access;\n+      Parent               : String;\n       Including_L_Switch   : Boolean := True;\n       Including_Non_Switch : Boolean := True)\n    is\n@@ -645,7 +638,7 @@ package body Makeutl is\n                --  arguments are not converted.\n \n                if not Is_Absolute_Path (Sw (Start .. Sw'Last)) then\n-                  if Parent = null or else Parent'Length = 0 then\n+                  if Parent'Length = 0 then\n                      Do_Fail\n                        (\"relative search path switches (\"\"\"\n                         & Sw\n@@ -655,20 +648,19 @@ package body Makeutl is\n                      Switch :=\n                        new String'\n                          (Sw (1 .. Start - 1) &\n-                          Parent.all &\n+                          Parent &\n                           Directory_Separator &\n                           Sw (Start .. Sw'Last));\n                   end if;\n                end if;\n \n             elsif Including_Non_Switch then\n                if not Is_Absolute_Path (Sw) then\n-                  if Parent = null or else Parent'Length = 0 then\n+                  if Parent'Length = 0 then\n                      Do_Fail\n                        (\"relative paths (\"\"\" & Sw & \"\"\") are not allowed\");\n                   else\n-                     Switch :=\n-                       new String'(Parent.all & Directory_Separator & Sw);\n+                     Switch := new String'(Parent & Directory_Separator & Sw);\n                   end if;\n                end if;\n             end if;"}, {"sha": "bb8ac84d6bf1b314912ed9924dce4a8b46d3f1a2", "filename": "gcc/ada/makeutl.ads", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fmakeutl.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fmakeutl.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmakeutl.ads?ref=2324b3fd3862e466c3098c17eeb06b056f1d16ee", "patch": "@@ -6,7 +6,7 @@\n --                                                                          --\n --                                 S p e c                                  --\n --                                                                          --\n---          Copyright (C) 2004-2008, Free Software Foundation, Inc.         --\n+--          Copyright (C) 2004-2009, Free Software Foundation, Inc.         --\n --                                                                          --\n -- GNAT is free software;  you can  redistribute it  and/or modify it under --\n -- terms of the  GNU General Public License as published  by the Free Soft- --\n@@ -128,12 +128,12 @@ package Makeutl is\n \n    procedure Test_If_Relative_Path\n      (Switch               : in out String_Access;\n-      Parent               : String_Access;\n+      Parent               : String;\n       Including_L_Switch   : Boolean := True;\n       Including_Non_Switch : Boolean := True);\n    --  Test if Switch is a relative search path switch.\n-   --  If it is, fail if Parent is null, otherwise prepend the path with\n-   --  Parent. This subprogram is only called when using project files.\n+   --  If it is, fail if Parent is the empty string, otherwise prepend the path\n+   --  with Parent. This subprogram is only called when using project files.\n    --  For gnatbind switches, Including_L_Switch is False, because the\n    --  argument of the -L switch is not a path.\n "}, {"sha": "ec2e6467141ee57304bbd26408371e6ba18db127", "filename": "gcc/ada/prj.adb", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fprj.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fprj.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.adb?ref=2324b3fd3862e466c3098c17eeb06b056f1d16ee", "patch": "@@ -93,7 +93,6 @@ package body Prj is\n                       Location                       => No_Location,\n                       Mains                          => Nil_String,\n                       Directory                      => No_Path_Information,\n-                      Dir_Path                       => null,\n                       Library                        => False,\n                       Library_Dir                    => No_Path_Information,\n                       Library_Src_Dir                => No_Path_Information,\n@@ -108,7 +107,6 @@ package body Prj is\n                       Symbol_Data                    => No_Symbols,\n                       Ada_Sources                    => Nil_String,\n                       Interfaces_Defined             => False,\n-                      Imported_Directories_Switches  => null,\n                       Include_Path                   => null,\n                       Include_Data_Set               => False,\n                       Source_Dirs                    => Nil_String,\n@@ -826,7 +824,6 @@ package body Prj is\n \n    procedure Free (Project : in out Project_Data) is\n    begin\n-      Free (Project.Dir_Path);\n       Free (Project.Include_Path);\n       Free (Project.Ada_Include_Path);\n       Free (Project.Objects_Path);"}, {"sha": "01e9946fe52d3669087b290ac1624f759285cb3f", "filename": "gcc/ada/prj.ads", "status": "modified", "additions": 0, "deletions": 7, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fprj.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2324b3fd3862e466c3098c17eeb06b056f1d16ee/gcc%2Fada%2Fprj.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj.ads?ref=2324b3fd3862e466c3098c17eeb06b056f1d16ee", "patch": "@@ -1194,9 +1194,6 @@ package Prj is\n       Directory : Path_Information := No_Path_Information;\n       --  Path name of the directory where the project file resides\n \n-      Dir_Path : String_Access;\n-      --  Same as Directory.Name, but as an access to String\n-\n       Object_Directory : Path_Information := No_Path_Information;\n       --  The path name of the object directory of this project file\n \n@@ -1269,10 +1266,6 @@ package Prj is\n       --  True if attribute Interfaces is declared for the project or any\n       --  project it extends.\n \n-      Imported_Directories_Switches : Argument_List_Access := null;\n-      --  List of the source search switches (-I<source dir>) to be used when\n-      --  compiling.\n-\n       Include_Path : String_Access := null;\n       --  The search source path for the project. Used as the value for an\n       --  environment variable, specified by attribute Include_Path"}]}