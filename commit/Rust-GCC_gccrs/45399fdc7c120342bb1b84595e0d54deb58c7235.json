{"sha": "45399fdc7c120342bb1b84595e0d54deb58c7235", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDUzOTlmZGM3YzEyMDM0MmJiMWI4NDU5NWUwZDU0ZGViNThjNzIzNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-01-26T11:48:05Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-01-26T11:48:05Z"}, "message": "re PR rtl-optimization/83985 (Compile time hog for 32-bit BE powerpc targets)\n\n\tPR rtl-optimization/83985\n\t* dce.c (deletable_insn_p): Return false for separate shrink wrapping\n\tREG_CFA_RESTORE insns.\n\t(delete_unmarked_insns): Don't ignore separate shrink wrapping\n\tREG_CFA_RESTORE insns here.\n\n\t* gcc.dg/pr83985.c: New test.\n\nFrom-SVN: r257087", "tree": {"sha": "26b1069c17b0e7061e660af8f998563a8d4a12e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/26b1069c17b0e7061e660af8f998563a8d4a12e3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/45399fdc7c120342bb1b84595e0d54deb58c7235", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45399fdc7c120342bb1b84595e0d54deb58c7235", "html_url": "https://github.com/Rust-GCC/gccrs/commit/45399fdc7c120342bb1b84595e0d54deb58c7235", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/45399fdc7c120342bb1b84595e0d54deb58c7235/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "79fbdeb87e6e91a8179465ea56007e493c7ca751", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/79fbdeb87e6e91a8179465ea56007e493c7ca751", "html_url": "https://github.com/Rust-GCC/gccrs/commit/79fbdeb87e6e91a8179465ea56007e493c7ca751"}], "stats": {"total": 49, "additions": 40, "deletions": 9}, "files": [{"sha": "764368ae20accd01b670a824bd295baaa8a4fa00", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=45399fdc7c120342bb1b84595e0d54deb58c7235", "patch": "@@ -1,5 +1,11 @@\n 2018-01-26  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR rtl-optimization/83985\n+\t* dce.c (deletable_insn_p): Return false for separate shrink wrapping\n+\tREG_CFA_RESTORE insns.\n+\t(delete_unmarked_insns): Don't ignore separate shrink wrapping\n+\tREG_CFA_RESTORE insns here.\n+\n \tPR c/83989\n \t* gimple-ssa-warn-restrict.c (builtin_memref::builtin_memref): Don't\n \tuse SSA_NAME_VAR as base for SSA_NAMEs with non-NULL SSA_NAME_VAR."}, {"sha": "e00d029db651dc719f9989855c513ec2ac5c8130", "filename": "gcc/dce.c", "status": "modified", "additions": 6, "deletions": 9, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2Fdce.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2Fdce.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdce.c?ref=45399fdc7c120342bb1b84595e0d54deb58c7235", "patch": "@@ -131,6 +131,12 @@ deletable_insn_p (rtx_insn *insn, bool fast, bitmap arg_stores)\n \t     && REGNO (pic_offset_table_rtx) >= FIRST_PSEUDO_REGISTER)\n       return false;\n \n+  /* Callee-save restores are needed.  */\n+  if (RTX_FRAME_RELATED_P (insn)\n+      && crtl->shrink_wrapped_separate\n+      && find_reg_note (insn, REG_CFA_RESTORE, NULL))\n+    return false;\n+\n   body = PATTERN (insn);\n   switch (GET_CODE (body))\n     {\n@@ -592,15 +598,6 @@ delete_unmarked_insns (void)\n \t  if (!dbg_cnt (dce))\n \t    continue;\n \n-\t  if (crtl->shrink_wrapped_separate\n-\t      && find_reg_note (insn, REG_CFA_RESTORE, NULL))\n-\t    {\n-\t      if (dump_file)\n-\t\tfprintf (dump_file, \"DCE: NOT deleting insn %d, it's a \"\n-\t\t\t\t    \"callee-save restore\\n\", INSN_UID (insn));\n-\t      continue;\n-\t    }\n-\n \t  if (dump_file)\n \t    fprintf (dump_file, \"DCE: Deleting insn %d\\n\", INSN_UID (insn));\n "}, {"sha": "5fa94c88af95b87554114b609c8a62feda307e88", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=45399fdc7c120342bb1b84595e0d54deb58c7235", "patch": "@@ -1,5 +1,8 @@\n 2018-01-26  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR rtl-optimization/83985\n+\t* gcc.dg/pr83985.c: New test.\n+\n \tPR c/83989\n \t* c-c++-common/Wrestrict-3.c: New test.\n "}, {"sha": "51cfc49a193c5922ad935a0bab31dea8b28bdb43", "filename": "gcc/testsuite/gcc.dg/pr83985.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83985.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/45399fdc7c120342bb1b84595e0d54deb58c7235/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83985.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr83985.c?ref=45399fdc7c120342bb1b84595e0d54deb58c7235", "patch": "@@ -0,0 +1,25 @@\n+/* PR rtl-optimization/83985 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+/* { dg-additional-options \"-mcpu=e300c3 -mtune=e300c3\" { target { powerpc*-*-* && ilp32 } } } */\n+\n+long long int v;\n+\n+void\n+foo (int x)\n+{\n+  if (x == 0)\n+    return;\n+\n+  while (v < 2)\n+    {\n+      signed char *a;\n+      v /= x;\n+      a = v == 0 ? (signed char *) &x : (signed char *) &v;\n+      ++*a;\n+      ++v;\n+    }\n+\n+  while (1)\n+    ;\n+}"}]}