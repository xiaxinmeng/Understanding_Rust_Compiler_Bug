{"sha": "3d20d4d843d62e0bc37b4edc232c44be04400377", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2QyMGQ0ZDg0M2Q2MmUwYmMzN2I0ZWRjMjMyYzQ0YmUwNDQwMDM3Nw==", "commit": {"author": {"name": "Mike Stump", "email": "mrs@apple.com", "date": "2005-04-23T14:58:52Z"}, "committer": {"name": "Mike Stump", "email": "mrs@gcc.gnu.org", "date": "2005-04-23T14:58:52Z"}, "message": "darwin.c (machopic_indirection_name): Don't use quotes needlessly.\n\n        * config/darwin.c (machopic_indirection_name): Don't use\n        quotes needlessly.\n        (darwin_emit_unwind_label): Use user_label_prefix instead of\n        \"_\".\n\nFrom-SVN: r98615", "tree": {"sha": "000b9c0fcb3806b6342fbbde5dffc6a2a830c2fa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/000b9c0fcb3806b6342fbbde5dffc6a2a830c2fa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d20d4d843d62e0bc37b4edc232c44be04400377", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d20d4d843d62e0bc37b4edc232c44be04400377", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d20d4d843d62e0bc37b4edc232c44be04400377", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d20d4d843d62e0bc37b4edc232c44be04400377/comments", "author": null, "committer": null, "parents": [{"sha": "b6dae270a24c68aeca4bb9e6b4379f6add1d5f91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6dae270a24c68aeca4bb9e6b4379f6add1d5f91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6dae270a24c68aeca4bb9e6b4379f6add1d5f91"}], "stats": {"total": 74, "additions": 39, "deletions": 35}, "files": [{"sha": "3df5cec4b409617c98cdb9e3c7236b2bc1785cd3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d20d4d843d62e0bc37b4edc232c44be04400377/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d20d4d843d62e0bc37b4edc232c44be04400377/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3d20d4d843d62e0bc37b4edc232c44be04400377", "patch": "@@ -1,3 +1,10 @@\n+2005-04-23  Mike Stump  <mrs@apple.com>\n+\n+\t* config/darwin.c (machopic_indirection_name): Don't use\n+\tquotes needlessly.\n+\t(darwin_emit_unwind_label): Use user_label_prefix instead of\n+\t\"_\".\n+\n 2005-04-23  Kazu Hirata  <kazu@cs.umass.edu>\n \n \t* final.c, ipa-inline.c, varasm.c: Fix comment typos."}, {"sha": "8c26bf5d496bf2fd9811bc35e929fe0e6d424cb2", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 32, "deletions": 35, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d20d4d843d62e0bc37b4edc232c44be04400377/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d20d4d843d62e0bc37b4edc232c44be04400377/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=3d20d4d843d62e0bc37b4edc232c44be04400377", "patch": "@@ -302,44 +302,41 @@ machopic_indirection_name (rtx sym_ref, bool stub_p)\n   size_t namelen = strlen (name);\n   machopic_indirection *p;\n   void ** slot;\n+  bool saw_star = false;\n+  bool needs_quotes;\n+  const char *suffix;\n+  const char *prefix = user_label_prefix;\n+  const char *quote = \"\";\n   \n-  /* Construct the name of the non-lazy pointer or stub.  */\n-  if (stub_p)\n+  if (name[0] == '*')\n     {\n-      int needs_quotes = name_needs_quotes (name);\n-      buffer = alloca (strlen (\"&L\")\n-\t\t       + namelen\n-\t\t       + strlen (STUB_SUFFIX)\n-\t\t       + 2 /* possible quotes */\n-\t\t       + 1 /* '\\0' */);\n-\n-      if (needs_quotes)\n-\t{\n-\t  if (name[0] == '*')\n-\t    sprintf (buffer, \"&\\\"L%s\" STUB_SUFFIX \"\\\"\", name + 1);\n-\t  else\n-\t    sprintf (buffer, \"&\\\"L%s%s\" STUB_SUFFIX \"\\\"\", user_label_prefix, \n-\t\t     name);\n-\t}\n-      else if (name[0] == '*')\n-\tsprintf (buffer, \"&L%s\" STUB_SUFFIX, name + 1);\n-      else\n-\tsprintf (buffer, \"&L%s%s\" STUB_SUFFIX, user_label_prefix, name);\n+      saw_star = true;\n+      prefix = \"\";\n+      ++name;\n+      --namelen;\n     }\n-  else\n+\n+  needs_quotes = name_needs_quotes (name);\n+  if (needs_quotes)\n     {\n-      buffer = alloca (strlen (\"&L\")\n-\t\t       + strlen (user_label_prefix)\n-\t\t       + namelen\n-\t\t       + strlen (NON_LAZY_POINTER_SUFFIX)\n-\t\t       + 1 /* '\\0' */);\n-      if (name[0] == '*')\n-\tsprintf (buffer, \"&L%s\" NON_LAZY_POINTER_SUFFIX, name + 1);\n-      else\n-\tsprintf (buffer, \"&L%s%s\" NON_LAZY_POINTER_SUFFIX, \n-\t\t user_label_prefix, name);\n+      quote = \"\\\"\";\n     }\n \n+  if (stub_p)\n+    suffix = STUB_SUFFIX;\n+  else\n+    suffix = NON_LAZY_POINTER_SUFFIX;\n+\n+  buffer = alloca (strlen (\"&L\")\n+\t\t   + strlen (prefix)\n+\t\t   + namelen\n+\t\t   + strlen (suffix)\n+\t\t   + 2 * strlen (quote)\n+\t\t   + 1 /* '\\0' */);\n+\n+  /* Construct the name of the non-lazy pointer or stub.  */\n+  sprintf (buffer, \"&%sL%s%s%s%s\", quote, prefix, name, suffix, quote);\n+\n   if (!machopic_indirections)\n     machopic_indirections = htab_create_ggc (37, \n \t\t\t\t\t     machopic_indirection_hash,\n@@ -1261,8 +1258,7 @@ darwin_emit_unwind_label (FILE *file, tree decl, int for_eh, int empty)\n     ? DECL_ASSEMBLER_NAME (decl)\n     : DECL_NAME (decl);\n \n-  const char *prefix = \"_\";\n-  const int prefix_len = 1;\n+  const char *prefix = user_label_prefix;\n \n   const char *base = IDENTIFIER_POINTER (id);\n   unsigned int base_len = IDENTIFIER_LENGTH (id);\n@@ -1276,7 +1272,8 @@ darwin_emit_unwind_label (FILE *file, tree decl, int for_eh, int empty)\n   if (! for_eh)\n     suffix = \".eh1\";\n \n-  lab = xmalloc (prefix_len + base_len + strlen (suffix) + quotes_len + 1);\n+  lab = xmalloc (strlen (prefix)\n+\t\t + base_len + strlen (suffix) + quotes_len + 1);\n   lab[0] = '\\0';\n \n   if (need_quotes)"}]}