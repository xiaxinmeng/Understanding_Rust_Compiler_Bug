{"sha": "db9c37294126d7c918b0cc918bd73feade0599c2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGI5YzM3Mjk0MTI2ZDdjOTE4YjBjYzkxOGJkNzNmZWFkZTA1OTljMg==", "commit": {"author": {"name": "Dominique d'Humieres", "email": "dominiq@gcc.gnu.org", "date": "2019-05-01T17:40:22Z"}, "committer": {"name": "Dominique d'Humieres", "email": "dominiq@gcc.gnu.org", "date": "2019-05-01T17:40:22Z"}, "message": "re PR fortran/60144 (Misleading error message when missing \"then\" after \"if\" and \"else if\")\n\n2019-05-01 Dominique d'Humieres  <dominiq@gcc.gnu.org>\n\n\tPR fortran/60144\n\t* match.c (gfc_match_parens): Change the location for missing ')'.\n\t(gfc_match_if): Detect a missing '('. Remove the spurious named\n\tconstant error. Change the wording of some errors.\n\t(gfc_match_else): Change the wording of an error.\n\t(gfc_match_elseif): Detect a missing '('. Improve the matching\n\tprocess to get a better syntax analysis.\n\n\tPR fortran/60144\n\t* gfortran.dg/block_name_2.f90: Adjust dg-error.\n\t* gfortran.dg/dec_type_print_3.f90.f90: Likewise\n\t* gfortran.dg/pr60144.f90: New test.\n\nFrom-SVN: r270776", "tree": {"sha": "ead616d93576d559efec6dca4437939b85eb2c28", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ead616d93576d559efec6dca4437939b85eb2c28"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/db9c37294126d7c918b0cc918bd73feade0599c2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db9c37294126d7c918b0cc918bd73feade0599c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db9c37294126d7c918b0cc918bd73feade0599c2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db9c37294126d7c918b0cc918bd73feade0599c2/comments", "author": null, "committer": null, "parents": [{"sha": "d36405344205c58beb1947719345ec80fdc00a34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d36405344205c58beb1947719345ec80fdc00a34", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d36405344205c58beb1947719345ec80fdc00a34"}], "stats": {"total": 136, "additions": 101, "deletions": 35}, "files": [{"sha": "2d76d9cb5bb56257c068d84316f0fe9ab010f129", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=db9c37294126d7c918b0cc918bd73feade0599c2", "patch": "@@ -1,3 +1,13 @@\n+2019-05-01 Dominique d'Humieres  <dominiq@gcc.gnu.org>\n+\n+\tPR fortran/60144\n+\t* match.c (gfc_match_parens): Change the location for missing ')'.\n+\t(gfc_match_if): Detect a missing '('. Remove the spurious named\n+\tconstant error. Change the wording of some errors.\n+\t(gfc_match_else): Change the wording of an error.\n+\t(gfc_match_elseif): Detect a missing '('. Improve the matching\n+\tprocess to get a better syntax analysis.\n+\n 2019-04-19  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/90166"}, {"sha": "268217a4a5fe62a0897c04aeecf2787492fabd8e", "filename": "gcc/fortran/match.c", "status": "modified", "additions": 53, "deletions": 31, "changes": 84, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ffortran%2Fmatch.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ffortran%2Fmatch.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fmatch.c?ref=db9c37294126d7c918b0cc918bd73feade0599c2", "patch": "@@ -262,6 +262,8 @@ gfc_match_parens (void)\n \n   for (;;)\n     {\n+      if (count > 0)\n+\twhere = gfc_current_locus;\n       c = gfc_next_char_literal (instring);\n       if (c == '\\n')\n \tbreak;\n@@ -281,7 +283,6 @@ gfc_match_parens (void)\n       if (c == '(' && quote == ' ')\n \t{\n \t  count++;\n-\t  where = gfc_current_locus;\n \t}\n       if (c == ')' && quote == ' ')\n \t{\n@@ -292,14 +293,10 @@ gfc_match_parens (void)\n \n   gfc_current_locus = old_loc;\n \n-  if (count > 0)\n-    {\n-      gfc_error (\"Missing %<)%> in statement at or before %L\", &where);\n-      return MATCH_ERROR;\n-    }\n-  if (count < 0)\n+  if (count != 0)\n     {\n-      gfc_error (\"Missing %<(%> in statement at or before %L\", &where);\n+      gfc_error (\"Missing %qs in statement at or before %L\",\n+\t\t count > 0? \")\":\"(\", &where);\n       return MATCH_ERROR;\n     }\n \n@@ -1495,7 +1492,17 @@ gfc_match_if (gfc_statement *if_type)\n \n   old_loc = gfc_current_locus;\n \n-  m = gfc_match (\" if ( %e\", &expr);\n+  m = gfc_match (\" if \", &expr);\n+  if (m != MATCH_YES)\n+    return m;\n+\n+  if (gfc_match_char ('(') != MATCH_YES)\n+    {\n+      gfc_error (\"Missing %<(%> in IF-expression at %C\");\n+      return MATCH_ERROR;\n+    }\n+\n+  m = gfc_match (\"%e\", &expr);\n   if (m != MATCH_YES)\n     return m;\n \n@@ -1648,30 +1655,17 @@ gfc_match_if (gfc_statement *if_type)\n   if (flag_dec)\n     match (\"type\", gfc_match_print, ST_WRITE)\n \n-  /* The gfc_match_assignment() above may have returned a MATCH_NO\n-     where the assignment was to a named constant.  Check that\n-     special case here.  */\n-  m = gfc_match_assignment ();\n-  if (m == MATCH_NO)\n-   {\n-      gfc_error (\"Cannot assign to a named constant at %C\");\n-      gfc_free_expr (expr);\n-      gfc_undo_symbols ();\n-      gfc_current_locus = old_loc;\n-      return MATCH_ERROR;\n-   }\n-\n   /* All else has failed, so give up.  See if any of the matchers has\n      stored an error message of some sort.  */\n   if (!gfc_error_check ())\n-    gfc_error (\"Unclassifiable statement in IF-clause at %C\");\n+    gfc_error (\"Syntax error in IF-clause after %C\");\n \n   gfc_free_expr (expr);\n   return MATCH_ERROR;\n \n got_match:\n   if (m == MATCH_NO)\n-    gfc_error (\"Syntax error in IF-clause at %C\");\n+    gfc_error (\"Syntax error in IF-clause after %C\");\n   if (m != MATCH_YES)\n     {\n       gfc_free_expr (expr);\n@@ -1714,7 +1708,7 @@ gfc_match_else (void)\n       || gfc_current_block () == NULL\n       || gfc_match_eos () != MATCH_YES)\n     {\n-      gfc_error (\"Unexpected junk after ELSE statement at %C\");\n+      gfc_error (\"Invalid character(s) in ELSE statement after %C\");\n       return MATCH_ERROR;\n     }\n \n@@ -1735,31 +1729,59 @@ match\n gfc_match_elseif (void)\n {\n   char name[GFC_MAX_SYMBOL_LEN + 1];\n-  gfc_expr *expr;\n+  gfc_expr *expr, *then;\n+  locus where;\n   match m;\n \n-  m = gfc_match (\" ( %e ) then\", &expr);\n+  if (gfc_match_char ('(') != MATCH_YES)\n+    {\n+      gfc_error (\"Missing %<(%> in ELSE IF expression at %C\");\n+      return MATCH_ERROR;\n+    }\n+\n+  m = gfc_match (\" %e \", &expr);\n   if (m != MATCH_YES)\n     return m;\n \n-  if (gfc_match_eos () == MATCH_YES)\n+  if (gfc_match_char (')') != MATCH_YES)\n+    {\n+      gfc_error (\"Missing %<)%> in ELSE IF expression at %C\");\n+      goto cleanup;\n+    }\n+\n+  m = gfc_match (\" then \", &then);\n+\n+  where = gfc_current_locus;\n+\n+  if (m == MATCH_YES && (gfc_match_eos () == MATCH_YES\n+\t\t\t || (gfc_current_block ()\n+\t\t\t     && gfc_match_name (name) == MATCH_YES)))\n     goto done;\n \n+  if (gfc_match_eos () == MATCH_YES)\n+    {\n+      gfc_error (\"Missing THEN in ELSE IF statement after %L\", &where);\n+      goto cleanup;\n+    }\n+\n   if (gfc_match_name (name) != MATCH_YES\n       || gfc_current_block () == NULL\n       || gfc_match_eos () != MATCH_YES)\n     {\n-      gfc_error (\"Unexpected junk after ELSE IF statement at %C\");\n+      gfc_error (\"Syntax error in ELSE IF statement after %L\", &where);\n       goto cleanup;\n     }\n \n   if (strcmp (name, gfc_current_block ()->name) != 0)\n     {\n-      gfc_error (\"Label %qs at %C doesn't match IF label %qs\",\n-\t\t name, gfc_current_block ()->name);\n+      gfc_error (\"Label %qs after %L doesn't match IF label %qs\",\n+\t\t name, &where, gfc_current_block ()->name);\n       goto cleanup;\n     }\n \n+  if (m != MATCH_YES)\n+    return m;\n+\n done:\n   new_st.op = EXEC_IF;\n   new_st.expr1 = expr;"}, {"sha": "45b181a24f89383af398c22553530d805907e4b0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=db9c37294126d7c918b0cc918bd73feade0599c2", "patch": "@@ -1,3 +1,10 @@\n+2019-05-01  Dominique d'Humieres  <dominiq@gcc.gnu.org>\n+\n+\tPR fortran/60144\n+\t* gfortran.dg/block_name_2.f90: Adjust dg-error.\n+\t* gfortran.dg/dec_type_print_3.f90.f90: Likewise\n+\t* gfortran.dg/pr60144.f90: New test. \n+\n 2019-05-01  Jeff Law  <law@redhat.com>\n \n \tPR tree-optimization/90037"}, {"sha": "289ea99f26ce3ed2a10f4b17953779e3c35240c8", "filename": "gcc/testsuite/gfortran.dg/block_name_2.f90", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2Fgfortran.dg%2Fblock_name_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2Fgfortran.dg%2Fblock_name_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fblock_name_2.f90?ref=db9c37294126d7c918b0cc918bd73feade0599c2", "patch": "@@ -37,8 +37,8 @@ program blocks\n   end do\n \n   if (i > 0) then\n-  else if (i ==0) then i2 ! { dg-error \"Unexpected junk after ELSE IF statement\" }\n-  else i2 ! { dg-error \"Unexpected junk after ELSE statement\" }\n+  else if (i ==0) then i2 ! { dg-error \"Syntax error in ELSE IF statement\" }\n+  else i2 ! { dg-error \"Invalid character.s. in ELSE statement\" }\n   end if i2 ! { dg-error \"Syntax error in END IF statement\" }\n   end if\n \n@@ -49,7 +49,7 @@ program blocks\n   end select\n \n   where (a > 0)\n-  elsewhere w2  ! { dg-error \"Unexpected junk after ELSE statement\" }\n+  elsewhere w2  ! { dg-error \"Invalid character.s. in ELSE statement\" }\n   end where w2 ! { dg-error \"Syntax error in END WHERE statement\" }\n   end where\n "}, {"sha": "409e991b84bb92fbf3fd3abb261f1b0009f62323", "filename": "gcc/testsuite/gfortran.dg/dec_type_print_3.f90", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_type_print_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_type_print_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_type_print_3.f90?ref=db9c37294126d7c918b0cc918bd73feade0599c2", "patch": "@@ -16,5 +16,5 @@\n ! { dg-error \"Invalid character in name\" \"\" { target *-*-* } 57 }\n ! { dg-error \"Invalid character in name\" \"\" { target *-*-* } 58 }\n ! { dg-error \"conflicts with PROCEDURE\" \"\" { target *-*-* } 60 }\n-! { dg-error \"Cannot assign to a named constant\" \"\" { target *-*-* } 80 }\n+! { dg-error \"Syntax error in IF-clause\" \"\" { target *-*-* } 80 }\n "}, {"sha": "fe6c1824cb76576e5c4d6b1663454d0298a92397", "filename": "gcc/testsuite/gfortran.dg/pr60144.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr60144.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/db9c37294126d7c918b0cc918bd73feade0599c2/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr60144.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr60144.f90?ref=db9c37294126d7c918b0cc918bd73feade0599c2", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do compile }\n+!\n+! fortran PR/60144\n+! Contributed by Sergio Losilla\n+!\n+program ifelif\n+    if a=b                 ! { dg-error \"Missing ... in IF-expression\" }\n+    if (a=b                ! { dg-error \"Missing ... in statement at or before\" }\n+    if (a=b then           ! { dg-error \"Missing ... in statement at or before\" }\n+    if ((a=b)              ! { dg-error \"Expected a right parenthesis in expression\" }\n+    if ((a==b              ! { dg-error \"Expected a right parenthesis in expression\" }\n+    if ((a==b)             ! { dg-error \"Missing ... in statement at or before\" }\n+    if ((a==b) then        ! { dg-error \"Missing ... in statement at or before\" }\n+    if (a=b))              ! { dg-error \"Missing ... in statement at or before\" }\n+    if .TRUE.)             ! { dg-error \"Missing ... in IF-expression\" }\n+    if (.TRUE.)            ! { dg-error \"Syntax error in IF-clause after\" }\n+    if (.TRUE.) the        ! { dg-error \"Syntax error in IF-clause after\" }\n+    if ((.TRUE.)           ! { dg-error \"Missing ... in statement at or before\" }\n+    else if .FALSE.)       ! { dg-error \"Missing ... in ELSE IF expression\" }\n+    else if (.FALSE.       ! { dg-error \"Missing ... in ELSE IF expression\" }\n+    else if (.FALSE.)      ! { dg-error \"Missing THEN in ELSE IF statement\" }\n+    else if (.FALSE.) the  ! { dg-error \"doesn't match IF label\" }\n+    else (.true.)          ! { dg-error \"Invalid character.s. in ELSE statement after\" }\n+    else a=1               ! { dg-error \"Invalid character.s. in ELSE statement after\" }\n+    if a=b                 ! { dg-error \"Missing ... in IF-expression\" }\n+!    end if\n+end program"}]}