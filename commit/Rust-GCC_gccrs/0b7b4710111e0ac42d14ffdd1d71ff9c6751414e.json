{"sha": "0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGI3YjQ3MTAxMTFlMGFjNDJkMTRmZmRkMWQ3MWZmOWM2NzUxNDE0ZQ==", "commit": {"author": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2020-12-29T08:15:19Z"}, "committer": {"name": "Kito Cheng", "email": "kito.cheng@sifive.com", "date": "2021-01-08T03:14:02Z"}, "message": "RISC-V: Move class riscv_subset_list and riscv_subset_t to riscv-protos.h\n\nPre-work of new style of architecture extension test macros, we need the\nlist used in `config/riscv/riscv-c.c`, so those struct/class declaration\nmust move to header file rather than local C file.\n\ngcc/ChangeLog\n\n\t* common/config/riscv/riscv-common.c (RISCV_DONT_CARE_VERSION):\n\tMove to riscv-subset.h.\n\t(struct riscv_subset_t): Ditto.\n\t(class riscv_subset_list): Ditto.\n\t* config/riscv/riscv-subset.h (RISCV_DONT_CARE_VERSION): Move\n\tfrom riscv-common.c.\n\t(struct riscv_subset_t): Ditto.\n\t(class riscv_subset_list): Ditto.\n\t* config/riscv/t-riscv ($(common_out_file)): Add file\n\tdependency.", "tree": {"sha": "3fe47553c57f97fd93cd55079eee0908c6fec714", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3fe47553c57f97fd93cd55079eee0908c6fec714"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/comments", "author": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "committer": {"login": "kito-cheng", "id": 2723185, "node_id": "MDQ6VXNlcjI3MjMxODU=", "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kito-cheng", "html_url": "https://github.com/kito-cheng", "followers_url": "https://api.github.com/users/kito-cheng/followers", "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}", "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}", "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions", "organizations_url": "https://api.github.com/users/kito-cheng/orgs", "repos_url": "https://api.github.com/users/kito-cheng/repos", "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}", "received_events_url": "https://api.github.com/users/kito-cheng/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7d187e4f6f582b7589b0201e6be3d2c96abe4d2a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d187e4f6f582b7589b0201e6be3d2c96abe4d2a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d187e4f6f582b7589b0201e6be3d2c96abe4d2a"}], "stats": {"total": 161, "additions": 94, "deletions": 67}, "files": [{"sha": "934c716a2e8db51d5be514b584d6cd0f2d397557", "filename": "gcc/common/config/riscv/riscv-common.c", "status": "modified", "additions": 1, "deletions": 66, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcommon%2Fconfig%2Friscv%2Friscv-common.c?ref=0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "patch": "@@ -30,22 +30,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"flags.h\"\n #include \"diagnostic-core.h\"\n #include \"config/riscv/riscv-protos.h\"\n-\n-#define RISCV_DONT_CARE_VERSION -1\n-\n-/* Subset info.  */\n-struct riscv_subset_t\n-{\n-  riscv_subset_t ();\n-\n-  std::string name;\n-  int major_version;\n-  int minor_version;\n-  struct riscv_subset_t *next;\n-\n-  bool explicit_version_p;\n-  bool implied_p;\n-};\n+#include \"config/riscv/riscv-subset.h\"\n \n /* Type for implied ISA info.  */\n struct riscv_implied_info_t\n@@ -123,56 +108,6 @@ static const riscv_cpu_info riscv_cpu_tables[] =\n     {NULL, NULL, NULL}\n };\n \n-/* Subset list.  */\n-class riscv_subset_list\n-{\n-private:\n-  /* Original arch string.  */\n-  const char *m_arch;\n-\n-  /* Location of arch string, used for report error.  */\n-  location_t m_loc;\n-\n-  /* Head of subset info list.  */\n-  riscv_subset_t *m_head;\n-\n-  /* Tail of subset info list.  */\n-  riscv_subset_t *m_tail;\n-\n-  /* X-len of m_arch. */\n-  unsigned m_xlen;\n-\n-  riscv_subset_list (const char *, location_t);\n-\n-  const char *parsing_subset_version (const char *, const char *, unsigned *,\n-\t\t\t\t      unsigned *, bool, bool *);\n-\n-  const char *parse_std_ext (const char *);\n-\n-  const char *parse_multiletter_ext (const char *, const char *,\n-\t\t\t\t     const char *);\n-\n-  void handle_implied_ext (riscv_subset_t *);\n-\n-public:\n-  ~riscv_subset_list ();\n-\n-  void add (const char *, int, int, bool, bool);\n-\n-  void add (const char *, bool);\n-\n-  riscv_subset_t *lookup (const char *,\n-\t\t\t  int major_version = RISCV_DONT_CARE_VERSION,\n-\t\t\t  int minor_version = RISCV_DONT_CARE_VERSION) const;\n-\n-  std::string to_string (bool) const;\n-\n-  unsigned xlen() const {return m_xlen;};\n-\n-  static riscv_subset_list *parse (const char *, location_t);\n-\n-};\n-\n static const char *riscv_supported_std_ext (void);\n \n static riscv_subset_list *current_subset_list = NULL;"}, {"sha": "ae7401ac0c471c6b258ea5e4267f9492e73644f2", "filename": "gcc/config/riscv/riscv-subset.h", "status": "added", "additions": 90, "deletions": 0, "changes": 90, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/gcc%2Fconfig%2Friscv%2Friscv-subset.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/gcc%2Fconfig%2Friscv%2Friscv-subset.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv-subset.h?ref=0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "patch": "@@ -0,0 +1,90 @@\n+/* Definition of data structure of RISC-V subset for GNU compiler.\n+   Copyright (C) 2011-2021 Free Software Foundation, Inc.\n+   Contributed by Andrew Waterman (andrew@sifive.com).\n+   Based on MIPS target for GNU compiler.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify\n+it under the terms of the GNU General Public License as published by\n+the Free Software Foundation; either version 3, or (at your option)\n+any later version.\n+\n+GCC is distributed in the hope that it will be useful,\n+but WITHOUT ANY WARRANTY; without even the implied warranty of\n+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+GNU General Public License for more details.\n+\n+You should have received a copy of the GNU General Public License\n+along with GCC; see the file COPYING3.  If not see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#ifndef GCC_RISCV_SUBSET_H\n+#define GCC_RISCV_SUBSET_H\n+\n+#define RISCV_DONT_CARE_VERSION -1\n+\n+/* Subset info.  */\n+struct riscv_subset_t\n+{\n+  riscv_subset_t ();\n+\n+  std::string name;\n+  int major_version;\n+  int minor_version;\n+  struct riscv_subset_t *next;\n+\n+  bool explicit_version_p;\n+  bool implied_p;\n+};\n+\n+/* Subset list.  */\n+class riscv_subset_list\n+{\n+private:\n+  /* Original arch string.  */\n+  const char *m_arch;\n+\n+  /* Location of arch string, used for report error.  */\n+  location_t m_loc;\n+\n+  /* Head of subset info list.  */\n+  riscv_subset_t *m_head;\n+\n+  /* Tail of subset info list.  */\n+  riscv_subset_t *m_tail;\n+\n+  /* X-len of m_arch. */\n+  unsigned m_xlen;\n+\n+  riscv_subset_list (const char *, location_t);\n+\n+  const char *parsing_subset_version (const char *, const char *, unsigned *,\n+\t\t\t\t      unsigned *, bool, bool *);\n+\n+  const char *parse_std_ext (const char *);\n+\n+  const char *parse_multiletter_ext (const char *, const char *,\n+\t\t\t\t     const char *);\n+\n+  void handle_implied_ext (riscv_subset_t *);\n+\n+public:\n+  ~riscv_subset_list ();\n+\n+  void add (const char *, int, int, bool, bool);\n+\n+  void add (const char *, bool);\n+\n+  riscv_subset_t *lookup (const char *,\n+\t\t\t  int major_version = RISCV_DONT_CARE_VERSION,\n+\t\t\t  int minor_version = RISCV_DONT_CARE_VERSION) const;\n+\n+  std::string to_string (bool) const;\n+\n+  unsigned xlen () const {return m_xlen;};\n+\n+  static riscv_subset_list *parse (const char *, location_t);\n+};\n+\n+#endif /* ! GCC_RISCV_SUBSET_H */"}, {"sha": "1215ea8b73496c2e91559ff031b5a8e68cf07b8e", "filename": "gcc/config/riscv/t-riscv", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/gcc%2Fconfig%2Friscv%2Ft-riscv", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0b7b4710111e0ac42d14ffdd1d71ff9c6751414e/gcc%2Fconfig%2Friscv%2Ft-riscv", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Ft-riscv?ref=0b7b4710111e0ac42d14ffdd1d71ff9c6751414e", "patch": "@@ -25,4 +25,6 @@ riscv-shorten-memrefs.o: $(srcdir)/config/riscv/riscv-shorten-memrefs.c\n \n PASSES_EXTRA += $(srcdir)/config/riscv/riscv-passes.def\n \n-$(common_out_file): $(srcdir)/config/riscv/riscv-cores.def\n+$(common_out_file): $(srcdir)/config/riscv/riscv-cores.def \\\n+    $(srcdir)/config/riscv/riscv-protos.h \\\n+    $(srcdir)/config/riscv/riscv-subset.h"}]}