{"sha": "6fb118f3e2ed4a189198936a82e0f68ccf954044", "node_id": "C_kwDOANBUbNoAKDZmYjExOGYzZTJlZDRhMTg5MTk4OTM2YTgyZTBmNjhjY2Y5NTQwNDQ", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-04-08T14:16:04Z"}, "committer": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2022-04-09T20:53:06Z"}, "message": "Support mangling *const ptr and slices like *const [T]\n\nThe legacy mangling scheme needs to convert the canonical path containing\n* for pointers and the [] brackets representing slices into:\n\n  * = $BP$\n  [ = $u5b$\n  ] = $u5d$\n\nThese symbols are not allowed in asm symbols.\n\nAddresses #849", "tree": {"sha": "a879009b7ce8b3eceb420f1427cfcf08bab63620", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a879009b7ce8b3eceb420f1427cfcf08bab63620"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6fb118f3e2ed4a189198936a82e0f68ccf954044", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fb118f3e2ed4a189198936a82e0f68ccf954044", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6fb118f3e2ed4a189198936a82e0f68ccf954044", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6fb118f3e2ed4a189198936a82e0f68ccf954044/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e43a5c5373b341d217d2f5403f31f5174b8c4e2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e43a5c5373b341d217d2f5403f31f5174b8c4e2f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e43a5c5373b341d217d2f5403f31f5174b8c4e2f"}], "stats": {"total": 16, "additions": 16, "deletions": 0}, "files": [{"sha": "82f643a1b90e16e99e6cb52accc0b007bb692992", "filename": "gcc/rust/backend/rust-mangle.cc", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6fb118f3e2ed4a189198936a82e0f68ccf954044/gcc%2Frust%2Fbackend%2Frust-mangle.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6fb118f3e2ed4a189198936a82e0f68ccf954044/gcc%2Frust%2Fbackend%2Frust-mangle.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fbackend%2Frust-mangle.cc?ref=6fb118f3e2ed4a189198936a82e0f68ccf954044", "patch": "@@ -11,6 +11,9 @@ static const std::string kMangledSubstBegin = \"$LT$\";\n static const std::string kMangledSubstEnd = \"$GT$\";\n static const std::string kMangledSpace = \"$u20$\";\n static const std::string kMangledRef = \"$RF$\";\n+static const std::string kMangledPtr = \"$BP$\";\n+static const std::string kMangledLeftSqParen = \"$u5b$\";\t // [\n+static const std::string kMangledRightSqParen = \"$u5d$\"; // ]\n static const std::string kQualPathBegin = \"_\" + kMangledSubstBegin;\n \n namespace Rust {\n@@ -29,8 +32,15 @@ legacy_mangle_name (const std::string &name)\n   // <example::Bar as example::A>::fooA:\n   // _ZN43_$LT$example..Bar$u20$as$u20$example..A$GT$4fooA17hfc615fa76c7db7a0E:\n   //\n+  // core::ptr::const_ptr::<impl *const T>::cast:\n+  // _ZN4core3ptr9const_ptr33_$LT$impl$u20$$BP$const$u20$T$GT$4cast17hb79f4617226f1d55E:\n+  //\n+  // core::ptr::const_ptr::<impl *const [T]>::as_ptr:\n+  // _ZN4core3ptr9const_ptr43_$LT$impl$u20$$BP$const$u20$$u5b$T$u5d$$GT$6as_ptr17he16e0dcd9473b04fE:\n+  //\n   // example::Foo<T>::new:\n   // _ZN7example12Foo$LT$T$GT$3new17h9a2aacb7fd783515E:\n+\n   std::string buffer;\n   for (size_t i = 0; i < name.size (); i++)\n     {\n@@ -47,6 +57,12 @@ legacy_mangle_name (const std::string &name)\n \tm = kMangledSubstBegin;\n       else if (c == '>')\n \tm = kMangledSubstEnd;\n+      else if (c == '*')\n+\tm = kMangledPtr;\n+      else if (c == '[')\n+\tm = kMangledLeftSqParen;\n+      else if (c == ']')\n+\tm = kMangledRightSqParen;\n       else if (c == ':')\n \t{\n \t  rust_assert (i + 1 < name.size ());"}]}