{"sha": "c66c59d18298436c9b5fe29df16f499d843ba75a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzY2YzU5ZDE4Mjk4NDM2YzliNWZlMjlkZjE2ZjQ5OWQ4NDNiYTc1YQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2001-12-12T01:40:58Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2001-12-12T01:40:58Z"}, "message": "objc-act.c (build_string_class_template): New.\n\n        * objc/objc-act.c (build_string_class_template): New.\n        (build_objc_string_object): Call it.\n\nFrom-SVN: r47908", "tree": {"sha": "116b36391006dca608659e14300f2f778e95ce31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/116b36391006dca608659e14300f2f778e95ce31"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c66c59d18298436c9b5fe29df16f499d843ba75a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c66c59d18298436c9b5fe29df16f499d843ba75a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c66c59d18298436c9b5fe29df16f499d843ba75a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c66c59d18298436c9b5fe29df16f499d843ba75a/comments", "author": null, "committer": null, "parents": [{"sha": "0b09835f1f9a32e9a4d30d47692d2f4809db6bb3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0b09835f1f9a32e9a4d30d47692d2f4809db6bb3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0b09835f1f9a32e9a4d30d47692d2f4809db6bb3"}], "stats": {"total": 43, "additions": 41, "deletions": 2}, "files": [{"sha": "6d2a91faaaab21160bf8fe5161927adbf7aee275", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c66c59d18298436c9b5fe29df16f499d843ba75a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c66c59d18298436c9b5fe29df16f499d843ba75a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c66c59d18298436c9b5fe29df16f499d843ba75a", "patch": "@@ -1,3 +1,8 @@\n+2001-12-11  Richard Henderson  <rth@redhat.com>\n+\n+\t* objc/objc-act.c (build_string_class_template): New.\n+\t(build_objc_string_object): Call it.\n+\n 2001-12-11  Steve Ellcey  <sje@cup.hp.com>\n \n \t* doc/tm.texi (FUNCTION_ARG_REG_LITTLE_ENDIAN): New."}, {"sha": "3c696acdbcbdcb10cf97999444a767995fff2633", "filename": "gcc/objc/objc-act.c", "status": "modified", "additions": 36, "deletions": 2, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c66c59d18298436c9b5fe29df16f499d843ba75a/gcc%2Fobjc%2Fobjc-act.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c66c59d18298436c9b5fe29df16f499d843ba75a/gcc%2Fobjc%2Fobjc-act.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-act.c?ref=c66c59d18298436c9b5fe29df16f499d843ba75a", "patch": "@@ -278,6 +278,7 @@ static tree lookup_protocol_in_reflist\t\tPARAMS ((tree, tree));\n static tree create_builtin_decl\t\t\tPARAMS ((enum tree_code,\n \t\t\t\t\t\t       tree, const char *));\n static void setup_string_decl\t\t\tPARAMS ((void));\n+static void build_string_class_template\t\tPARAMS ((void));\n static tree my_build_string\t\t\tPARAMS ((int, const char *));\n static void build_objc_symtab_template\t\tPARAMS ((void));\n static tree init_def_list\t\t\tPARAMS ((tree));\n@@ -1231,11 +1232,39 @@ synth_module_prologue ()\n   /* Forward declare constant_string_id and constant_string_type.  */\n   if (!constant_string_class_name)\n     constant_string_class_name = STRING_OBJECT_CLASS_NAME;\n-  \n+\n   constant_string_id = get_identifier (constant_string_class_name);\n   constant_string_type = xref_tag (RECORD_TYPE, constant_string_id);\n }\n \n+/* Predefine the following data type:\n+\n+   struct STRING_OBJECT_CLASS_NAME \n+   {\n+     Object isa;\n+     char *cString;\n+     unsigned int length;\n+   }; */\n+\n+static void\n+build_string_class_template ()\n+{\n+  tree field_decl, field_decl_chain;\n+\n+  field_decl = create_builtin_decl (FIELD_DECL, id_type, \"isa\");\n+  field_decl_chain = field_decl;\n+\n+  field_decl = create_builtin_decl (FIELD_DECL,\n+\t\t\t\t    build_pointer_type (char_type_node),\n+\t\t\t\t    \"cString\");\n+  chainon (field_decl_chain, field_decl);\n+\n+  field_decl = create_builtin_decl (FIELD_DECL, unsigned_type_node, \"length\");\n+  chainon (field_decl_chain, field_decl);\n+\n+  finish_struct (constant_string_type, field_decl_chain, NULL_TREE);\n+}\n+\n /* Custom build_string which sets TREE_TYPE!  */\n \n static tree\n@@ -1287,7 +1316,12 @@ build_objc_string_object (strings)\n   TREE_SET_CODE (string, STRING_CST);\n   length = TREE_STRING_LENGTH (string) - 1;\n \n-  /* & ((NXConstantString) {0, string, length})  */\n+  /* We could not properly create NXConstantString in synth_module_prologue,\n+     because that's called before debugging is initialized.  Do it now.  */\n+  if (TYPE_FIELDS (constant_string_type) == NULL_TREE)\n+    build_string_class_template ();\n+\n+  /* & ((NXConstantString) { NULL, string, length })  */\n \n   if (flag_next_runtime)\n     {"}]}