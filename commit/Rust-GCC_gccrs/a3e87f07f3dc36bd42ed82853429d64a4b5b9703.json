{"sha": "a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNlODdmMDdmM2RjMzZiZDQyZWQ4Mjg1MzQyOWQ2NGE0YjViOTcwMw==", "commit": {"author": {"name": "Paul Koning", "email": "ni1d@arrl.net", "date": "2018-06-07T17:55:05Z"}, "committer": {"name": "Paul Koning", "email": "pkoning@gcc.gnu.org", "date": "2018-06-07T17:55:05Z"}, "message": "compare-elim.c (try_merge_compare): Don't merge compare if address contains a side effect.\n\n2018-06-07  Paul Koning  <ni1d@arrl.net>\n\ngcc/\n\n\t* compare-elim.c (try_merge_compare): Don't merge compare if\n\taddress contains a side effect.\n\t(try_eliminate_compare): Likewise.\n\ngcc/testsuite/\n\n\t* gcc.c-torture/compile/20180605-1.c: New test.\n\nFrom-SVN: r261287", "tree": {"sha": "2d3ec078e149f926309b09d57d900fb27c257a8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d3ec078e149f926309b09d57d900fb27c257a8d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/comments", "author": null, "committer": null, "parents": [{"sha": "75d1c00452b12b51121236930d09578bc01f6306", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75d1c00452b12b51121236930d09578bc01f6306", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75d1c00452b12b51121236930d09578bc01f6306"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "ee56a211d5906e97fb48feaef5ad33bfc9ed12ee", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "patch": "@@ -1,3 +1,9 @@\n+2018-06-07  Paul Koning  <ni1d@arrl.net>\n+\n+\t* compare-elim.c (try_merge_compare): Don't merge compare if\n+\taddress contains a side effect.\n+\t(try_eliminate_compare): Likewise.\n+\n 2018-06-07  Olga Makhotina  <olga.makhotina@intel.com>\n \n \t* config.gcc: Support \"tremont\"."}, {"sha": "50bbaa84b6dfbbf30e1ba654592e2139f5a249cf", "filename": "gcc/compare-elim.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2Fcompare-elim.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2Fcompare-elim.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcompare-elim.c?ref=a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "patch": "@@ -690,6 +690,13 @@ try_merge_compare (struct comparison *cmp)\n     return false;\n \n   rtx src = SET_SRC (set);\n+\n+  /* If the source uses addressing modes with side effects, we can't\n+     do the merge because we'd end up with a PARALLEL that has two\n+     instances of that side effect in it.  */\n+  if (side_effects_p (src))\n+    return false;\n+\n   rtx flags = maybe_select_cc_mode (cmp, src, CONST0_RTX (GET_MODE (src)));\n   if (!flags)\n     {\n@@ -809,6 +816,12 @@ try_eliminate_compare (struct comparison *cmp)\n   else\n     return false;\n \n+  /* If the source uses addressing modes with side effects, we can't\n+     do the merge because we'd end up with a PARALLEL that has two\n+     instances of that side effect in it.  */\n+  if (side_effects_p (cmp_src))\n+    return false;\n+\n   /* Determine if we ought to use a different CC_MODE here.  */\n   flags = maybe_select_cc_mode (cmp, cmp_src, in_b);\n   if (flags == NULL)"}, {"sha": "272cb03f80c7fe93378c8aa0ef41c531fc92624c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "patch": "@@ -1,3 +1,7 @@\n+2018-06-07  Paul Koning  <ni1d@arrl.net>\n+\n+\t* gcc.c-torture/compile/20180605-1.c: New test.\n+\n 2018-06-07  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/86045"}, {"sha": "915dafddad04fa0277df26da82c0b6ecf34cd6ef", "filename": "gcc/testsuite/gcc.c-torture/compile/20180605-1.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20180605-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3e87f07f3dc36bd42ed82853429d64a4b5b9703/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20180605-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2F20180605-1.c?ref=a3e87f07f3dc36bd42ed82853429d64a4b5b9703", "patch": "@@ -0,0 +1,9 @@\n+void f (int *p, int n)\n+{\n+    int j = 0, k;\n+    \n+    for (int i = 0; i < n; i++)\n+        if ((k = *p++) > 0)\n+            j += k;\n+    return j;\n+}"}]}