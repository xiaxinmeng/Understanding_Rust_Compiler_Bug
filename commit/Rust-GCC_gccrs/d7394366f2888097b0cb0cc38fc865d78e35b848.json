{"sha": "d7394366f2888097b0cb0cc38fc865d78e35b848", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDczOTQzNjZmMjg4ODA5N2IwY2IwY2MzOGZjODY1ZDc4ZTM1Yjg0OA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2003-03-21T22:18:18Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2003-03-21T22:18:18Z"}, "message": "i386.c (ix86_compute_frame_layout): Recompute fast prologues only when amount of saved regs changed.\n\n\t* i386.c (ix86_compute_frame_layout): Recompute fast prologues\n\tonly when amount of saved regs changed.\n\t(ix86_init_machine_status): Initialize use_fast_prologue_epilgoue_nregs.\n\t* i386.h (machine_function): New fields use_fast_prologue_epilgoue_nregs.\n\nFrom-SVN: r64682", "tree": {"sha": "055347473418fd6b6e176a45131ccee31a64b344", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/055347473418fd6b6e176a45131ccee31a64b344"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d7394366f2888097b0cb0cc38fc865d78e35b848", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7394366f2888097b0cb0cc38fc865d78e35b848", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d7394366f2888097b0cb0cc38fc865d78e35b848", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d7394366f2888097b0cb0cc38fc865d78e35b848/comments", "author": null, "committer": null, "parents": [{"sha": "5dc96d60e1bd5a9bb3f4f100c94d2a2db71b915d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5dc96d60e1bd5a9bb3f4f100c94d2a2db71b915d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5dc96d60e1bd5a9bb3f4f100c94d2a2db71b915d"}], "stats": {"total": 23, "additions": 21, "deletions": 2}, "files": [{"sha": "29d1c3c17e01f9ce8cc73cae57d852a0be9ddaea", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7394366f2888097b0cb0cc38fc865d78e35b848/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7394366f2888097b0cb0cc38fc865d78e35b848/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d7394366f2888097b0cb0cc38fc865d78e35b848", "patch": "@@ -1,3 +1,10 @@\n+Fri Mar 21 23:12:33 CET 2003  Jan Hubicka  <jh@suse.cz>\n+\n+\t* i386.c (ix86_compute_frame_layout): Recompute fast prologues\n+\tonly when amount of saved regs changed.\n+\t(ix86_init_machine_status): Initialize use_fast_prologue_epilgoue_nregs.\n+\t* i386.h (machine_function): New fields use_fast_prologue_epilgoue_nregs.\n+\n Fri Mar 21 22:44:33 CET 2003  Jan Hubicka  <jh@suse.cz>\n \n \tPR inline-asm/7916"}, {"sha": "8097c61b6fd294b5f7104bc35ec55e9b22fddd72", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7394366f2888097b0cb0cc38fc865d78e35b848/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7394366f2888097b0cb0cc38fc865d78e35b848/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=d7394366f2888097b0cb0cc38fc865d78e35b848", "patch": "@@ -4914,10 +4914,16 @@ ix86_compute_frame_layout (frame)\n   frame->nregs = ix86_nsaved_regs ();\n   total_size = size;\n \n-  if (!optimize_size && !reload_completed)\n+  /* During reload iteration the amount of registers saved can change.\n+     Recompute the value as needed.  Do not recompute when amount of registers\n+     didn't change as reload does mutiple calls to the function and does not\n+     expect the decision to change within single iteration.  */\n+  if (!optimize_size\n+      && cfun->machine->use_fast_prologue_epilogue_nregs != frame->nregs)\n     {\n       int count = frame->nregs;\n \n+      cfun->machine->use_fast_prologue_epilogue_nregs = count;\n       /* The fast prologue uses move instead of push to save registers.  This\n          is significantly longer, but also executes faster as modern hardware\n          can execute the moves in parallel, but can't do that for push/pop.\n@@ -11784,7 +11790,10 @@ ix86_expand_call (retval, fnaddr, callarg1, callarg2, pop, sibcall)\n static struct machine_function *\n ix86_init_machine_status ()\n {\n-  return ggc_alloc_cleared (sizeof (struct machine_function));\n+  struct machine_function *f;\n+\n+  f = ggc_alloc_cleared (sizeof (struct machine_function));\n+  f->use_fast_prologue_epilogue_nregs = -1;\n }\n \n /* Return a MEM corresponding to a stack slot with mode MODE."}, {"sha": "8677875944b7fe9e8ba161f1a0cd2534e5791425", "filename": "gcc/config/i386/i386.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d7394366f2888097b0cb0cc38fc865d78e35b848/gcc%2Fconfig%2Fi386%2Fi386.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d7394366f2888097b0cb0cc38fc865d78e35b848/gcc%2Fconfig%2Fi386%2Fi386.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.h?ref=d7394366f2888097b0cb0cc38fc865d78e35b848", "patch": "@@ -3223,6 +3223,9 @@ struct machine_function GTY(())\n   /* Set by ix86_compute_frame_layout and used by prologue/epilogue expander to\n      determine the style used.  */\n   int use_fast_prologue_epilogue;\n+  /* Number of saved registers USE_FAST_PROLOGUE_EPILOGUE has been computed\n+     for.  */\n+  int use_fast_prologue_epilogue_nregs;\n };\n \n #define ix86_stack_locals (cfun->machine->stack_locals)"}]}