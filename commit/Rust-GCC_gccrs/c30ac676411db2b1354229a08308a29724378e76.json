{"sha": "c30ac676411db2b1354229a08308a29724378e76", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzMwYWM2NzY0MTFkYjJiMTM1NDIyOWEwODMwOGEyOTcyNDM3OGU3Ng==", "commit": {"author": {"name": "Doug Evans", "email": "dje@gnu.org", "date": "1996-05-16T22:28:47Z"}, "committer": {"name": "Doug Evans", "email": "dje@gnu.org", "date": "1996-05-16T22:28:47Z"}, "message": "varasm.c (function_section): Delete flag_function_sections support.\n\n\t* varasm.c (function_section): Delete flag_function_sections support.\n\t(assemble_start_function): Put it here.  Use UNIQUE_SECTION if defined.\n\nFrom-SVN: r11975", "tree": {"sha": "cefe530e144e2d14089bbf94fe45625b69850193", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cefe530e144e2d14089bbf94fe45625b69850193"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c30ac676411db2b1354229a08308a29724378e76", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c30ac676411db2b1354229a08308a29724378e76", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c30ac676411db2b1354229a08308a29724378e76", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c30ac676411db2b1354229a08308a29724378e76/comments", "author": null, "committer": null, "parents": [{"sha": "4ac14744830df0e672c6b0fbf57823f3b95c0be4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4ac14744830df0e672c6b0fbf57823f3b95c0be4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4ac14744830df0e672c6b0fbf57823f3b95c0be4"}], "stats": {"total": 40, "additions": 17, "deletions": 23}, "files": [{"sha": "11bab798497a9bea630529035a83de7bb02ef64e", "filename": "gcc/varasm.c", "status": "modified", "additions": 17, "deletions": 23, "changes": 40, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c30ac676411db2b1354229a08308a29724378e76/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c30ac676411db2b1354229a08308a29724378e76/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=c30ac676411db2b1354229a08308a29724378e76", "patch": "@@ -352,29 +352,6 @@ void\n function_section (decl)\n      tree decl;\n {\n-\n-#ifdef ASM_OUTPUT_SECTION_NAME\n-  /* If we are placing functions into their own sections, and this\n-     function doesn't already have a section specified, set it now.  */\n-  if (flag_function_sections\n-      && decl != NULL_TREE\n-      && DECL_SECTION_NAME (decl) == NULL_TREE)\n-    {\n-      int len;\n-      char *string;\n-\n-      len = IDENTIFIER_LENGTH (DECL_ASSEMBLER_NAME (decl)) + 1;\n-      string = alloca (len);\n-      strcpy (string, IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl)));\n-\n-      /* Strip off any encoding in fnname.  */\n-      STRIP_NAME_ENCODING (string, string);\n-\n-      /* Set DECL_SECTION_NAME.  */\n-      DECL_SECTION_NAME (decl) = build_string (len, string);\n-    }\n-#endif\n-\n   if (decl != NULL_TREE\n       && DECL_SECTION_NAME (decl) != NULL_TREE)\n     named_section (decl, (char *) 0);\n@@ -916,6 +893,23 @@ assemble_start_function (decl, fnname)\n \n   output_constant_pool (fnname, decl);\n \n+#ifdef ASM_OUTPUT_SECTION_NAME\n+  /* If the function is to be put in its own section and it's not in a section\n+     already, indicate so.  */\n+  if (flag_function_sections\n+      && DECL_SECTION_NAME (decl) == NULL_TREE)\n+    {\n+#ifdef UNIQUE_SECTION\n+      DECL_SECTION_NAME(decl) = UNIQUE_SECTION (decl);\n+#else\n+      char *name = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));\n+      /* Strip off any encoding in name.  */\n+      STRIP_NAME_ENCODING (name, name);\n+      DECL_SECTION_NAME (decl) = build_string (strlen (name), name);\n+#endif\n+    }\n+#endif\n+\n   function_section (decl);\n \n   /* Tell assembler to move to target machine's alignment for functions.  */"}]}