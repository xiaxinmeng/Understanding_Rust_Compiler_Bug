{"sha": "20bd258d0fa09837b3a93478ef92d8789cbcd442", "node_id": "C_kwDOANBUbNoAKDIwYmQyNThkMGZhMDk4MzdiM2E5MzQ3OGVmOTJkODc4OWNiY2Q0NDI", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2023-03-02T19:01:19Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2023-03-02T19:01:19Z"}, "message": "analyzer: fix uninit false +ves reading from DECL_HARD_REGISTER [PR108968]\n\ngcc/analyzer/ChangeLog:\n\tPR analyzer/108968\n\t* region-model.cc (region_model::get_rvalue_1): Handle VAR_DECLs\n\twith a DECL_HARD_REGISTER by returning UNKNOWN.\n\ngcc/testsuite/ChangeLog:\n\tPR analyzer/108968\n\t* gcc.dg/analyzer/uninit-pr108968-register.c: New test.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "170cf236931de8507df9deb10cda64bec0f3b304", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/170cf236931de8507df9deb10cda64bec0f3b304"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/20bd258d0fa09837b3a93478ef92d8789cbcd442", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20bd258d0fa09837b3a93478ef92d8789cbcd442", "html_url": "https://github.com/Rust-GCC/gccrs/commit/20bd258d0fa09837b3a93478ef92d8789cbcd442", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/20bd258d0fa09837b3a93478ef92d8789cbcd442/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4d82022bfd15d36717bf60a11e75e9ea02204269", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d82022bfd15d36717bf60a11e75e9ea02204269", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d82022bfd15d36717bf60a11e75e9ea02204269"}], "stats": {"total": 18, "additions": 17, "deletions": 1}, "files": [{"sha": "bf07cec2884fb2e0f6a63a2909127d84d83224dd", "filename": "gcc/analyzer/region-model.cc", "status": "modified", "additions": 8, "deletions": 1, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20bd258d0fa09837b3a93478ef92d8789cbcd442/gcc%2Fanalyzer%2Fregion-model.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20bd258d0fa09837b3a93478ef92d8789cbcd442/gcc%2Fanalyzer%2Fregion-model.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fanalyzer%2Fregion-model.cc?ref=20bd258d0fa09837b3a93478ef92d8789cbcd442", "patch": "@@ -2203,9 +2203,16 @@ region_model::get_rvalue_1 (path_var pv, region_model_context *ctxt) const\n \treturn get_rvalue_for_bits (TREE_TYPE (expr), reg, bits, ctxt);\n       }\n \n-    case SSA_NAME:\n     case VAR_DECL:\n+      if (DECL_HARD_REGISTER (pv.m_tree))\n+\t{\n+\t  /* If it has a hard register, it doesn't have a memory region\n+\t     and can't be referred to as an lvalue.  */\n+\t  return m_mgr->get_or_create_unknown_svalue (TREE_TYPE (pv.m_tree));\n+\t}\n+      /* Fall through. */\n     case PARM_DECL:\n+    case SSA_NAME:\n     case RESULT_DECL:\n     case ARRAY_REF:\n       {"}, {"sha": "a76c09e7b14c8710d68ca1c4ace0994b53e02b99", "filename": "gcc/testsuite/gcc.dg/analyzer/uninit-pr108968-register.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/20bd258d0fa09837b3a93478ef92d8789cbcd442/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Funinit-pr108968-register.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/20bd258d0fa09837b3a93478ef92d8789cbcd442/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Funinit-pr108968-register.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Funinit-pr108968-register.c?ref=20bd258d0fa09837b3a93478ef92d8789cbcd442", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile { target x86_64-*-* } } */\n+\n+#define STACK_SIZE 4096\n+struct cpu_info {};\n+struct cpu_info *get_cpu_info(void)\n+{\n+  register unsigned long sp asm(\"rsp\");\n+  return (struct cpu_info *)((sp | (STACK_SIZE - 1)) + 1) - 1; /* { dg-bogus \"use of uninitialized value 'sp'\" } */\n+}"}]}