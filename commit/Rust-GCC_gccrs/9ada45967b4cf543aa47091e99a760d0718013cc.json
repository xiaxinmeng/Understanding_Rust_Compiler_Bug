{"sha": "9ada45967b4cf543aa47091e99a760d0718013cc", "node_id": "C_kwDOANBUbNoAKDlhZGE0NTk2N2I0Y2Y1NDNhYTQ3MDkxZTk5YTc2MGQwNzE4MDEzY2M", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-11-22T00:08:17Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2022-11-22T00:08:17Z"}, "message": "analyzer, testsuite: add more examples taken from CWE\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/analyzer/CWE-131-examples.c: New test.\n\t* gcc.dg/analyzer/file-CWE-1341-example.c: New test.\n\t* gcc.dg/analyzer/malloc-CWE-401-example.c: New test.\n\t* gcc.dg/analyzer/malloc-CWE-415-examples.c: New test.\n\t* gcc.dg/analyzer/malloc-CWE-416-examples.c: New test.\n\t* gcc.dg/analyzer/malloc-CWE-590-examples.c: New test.\n\nSigned-off-by: David Malcolm <dmalcolm@redhat.com>", "tree": {"sha": "3d064d1b5a9cdcd63033f6d1541dae02125d2bd8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d064d1b5a9cdcd63033f6d1541dae02125d2bd8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9ada45967b4cf543aa47091e99a760d0718013cc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ada45967b4cf543aa47091e99a760d0718013cc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ada45967b4cf543aa47091e99a760d0718013cc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ada45967b4cf543aa47091e99a760d0718013cc/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6f46d14d4989b2711379807e4565585123c48118", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f46d14d4989b2711379807e4565585123c48118", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f46d14d4989b2711379807e4565585123c48118"}], "stats": {"total": 381, "additions": 381, "deletions": 0}, "files": [{"sha": "3bc898cd0cc29e5d4dfd69b3bdcbdae0bb09d3c9", "filename": "gcc/testsuite/gcc.dg/analyzer/CWE-131-examples.c", "status": "added", "additions": 146, "deletions": 0, "changes": 146, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2FCWE-131-examples.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2FCWE-131-examples.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2FCWE-131-examples.c?ref=9ada45967b4cf543aa47091e99a760d0718013cc", "patch": "@@ -0,0 +1,146 @@\n+/* Examples adapted from https://cwe.mitre.org/data/definitions/131.html\n+   which states \"Copyright \u00a9 2006\u20132022, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.\"\n+   and which has this on:\n+     https://cwe.mitre.org/about/termsofuse.html\n+\n+   Terms of Use\n+\n+   CWE\u2122 is free to use by any organization or individual for any research, development, and/or commercial purposes, per these CWE Terms of Use. The MITRE Corporation (\"MITRE\") has copyrighted the CWE List, Top 25, CWSS, and CWRAF for the benefit of the community in order to ensure each remains a free and open standard, as well as to legally protect the ongoing use of it and any resulting content by government, vendors, and/or users. CWE is a trademark of MITRE. Please contact cwe@mitre.org if you require further clarification on this issue.\n+\n+   LICENSE\n+\n+   CWE Submissions: By submitting materials to The MITRE Corporation\u2019s (\"MITRE\") Common Weakness Enumeration Program (CWE\u2122), you hereby grant to MITRE a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to use, reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute your submitted materials and derivative works. Unless otherwise required by applicable law or agreed to in writing, it is understood that you are providing such materials on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.\n+\n+   CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy.\n+\n+   DISCLAIMERS\n+\n+   ALL DOCUMENTS AND THE INFORMATION CONTAINED IN THE CWE ARE PROVIDED ON AN \"AS IS\" BASIS AND THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES, DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+\n+   IN NO EVENT SHALL THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE CWE.  */\n+\n+#include <stdio.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+/* Support decls for example 1.  */\n+\n+extern unsigned int GetUntrustedSizeValue();\n+extern void ExitError(const char *) __attribute__((noreturn));\n+\n+typedef struct Widget\n+{\n+} Widget;\n+\n+#define MAX_NUM_WIDGETS 100\n+\n+extern Widget *InitializeWidget();\n+extern void showWidgets(Widget **);\n+\n+void example_1 (void)\n+{\n+  int i;\n+  unsigned int numWidgets;\n+  Widget **WidgetList;\n+\n+  numWidgets = GetUntrustedSizeValue();\n+  if ((numWidgets == 0) || (numWidgets > MAX_NUM_WIDGETS)) {\n+    ExitError(\"Incorrect number of widgets requested!\");\n+  }\n+  WidgetList = (Widget **)malloc(numWidgets * sizeof(Widget *));\n+  printf(\"WidgetList ptr=%p\\n\", WidgetList);\n+  for(i=0; i<numWidgets; i++) {\n+    WidgetList[i] = InitializeWidget(); /* { dg-warning \"dereference of possibly-NULL 'WidgetList'\" } */\n+  }\n+  WidgetList[numWidgets] = NULL; /* { dg-warning \"heap-based buffer overflow\" } */\n+  showWidgets(WidgetList);\n+}\n+\n+/* Support decls for example 2.  */\n+\n+typedef struct img_t\n+{\n+  char placeholder[1024];\n+} img_t;\n+\n+extern int get_num_imgs();\n+\n+img_t *example_2 (void)\n+{\n+  img_t *table_ptr; /*struct containing img data, 10kB each*/\n+  int num_imgs;\n+  /* ... */\n+  num_imgs = get_num_imgs();\n+  table_ptr = (img_t*)malloc(sizeof(img_t)*num_imgs); /* TODO: ideally we'd warn about possible overflow here.  */\n+  /* ... */\n+  return table_ptr;\n+}\n+\n+/* Support decls for example 3.  */\n+\n+#define MAX_SIZE 100\n+extern void die(const char *) __attribute__((noreturn));\n+\n+char * example_3 (char *user_supplied_string)\n+{\n+  int i, dst_index;\n+  char *dst_buf = (char*)malloc(4*sizeof(char) * MAX_SIZE);\n+  if ( MAX_SIZE <= strlen(user_supplied_string) ){\n+    die(\"user string too long, die evil hacker!\");\n+  }\n+  dst_index = 0;\n+  for ( i = 0; i < strlen(user_supplied_string); i++ ){\n+    if( '&' == user_supplied_string[i] ){\n+      dst_buf[dst_index++] = '&'; /* { dg-warning \"dereference of possibly-NULL 'dst_buf'\" } */\n+      dst_buf[dst_index++] = 'a';\n+      dst_buf[dst_index++] = 'm';\n+      dst_buf[dst_index++] = 'p';\n+      dst_buf[dst_index++] = ';'; /* TODO: ideally we'd warn about possible out-of-bounds write here.  */\n+    }\n+    else if ('<' == user_supplied_string[i] ){\n+      /* encode to &lt; */\n+    }\n+    else dst_buf[dst_index++] = user_supplied_string[i]; /* { dg-warning \"dereference of possibly-NULL 'dst_buf'\" } */\n+  }\n+  return dst_buf;\n+}\n+\n+/* Support decls for example 4.  */\n+\n+typedef struct DataPacket { int headers; } DataPacket;\n+typedef struct PacketHeader {} PacketHeader;\n+extern int AcceptSocketConnection();\n+extern void ReadPacket(DataPacket *, int);\n+extern void ParsePacketHeaders(DataPacket *, PacketHeader *);\n+\n+void example_4 (DataPacket *packet)\n+{\n+  int sock;\n+\n+  int numHeaders;\n+  PacketHeader *headers;\n+\n+  sock=AcceptSocketConnection();\n+  ReadPacket(packet, sock);\n+  numHeaders =packet->headers;\n+\n+  if (numHeaders > 100) {\n+    ExitError(\"too many headers!\");\n+  }\n+  headers = malloc(numHeaders * sizeof(PacketHeader)); /* TODO: ideally we'd warn about possible overflow here with negative numHeaders.  */\n+  ParsePacketHeaders(packet, headers);\n+}\n+\n+void example_5 (void)\n+{\n+  int *id_sequence;\n+\n+  /* Allocate space for an array of three ids. */\n+  id_sequence = (int*) malloc(3); /* { dg-warning \"allocated buffer size is not a multiple of the pointee's size\" } */\n+  if (id_sequence == NULL) exit(1);\n+\n+  /* Populate the id array. */\n+  id_sequence[0] = 13579; /* { dg-warning \"heap-based buffer overflow\" } */\n+  id_sequence[1] = 24680; /* { dg-warning \"heap-based buffer overflow\" } */\n+  id_sequence[2] = 97531; /* { dg-warning \"heap-based buffer overflow\" } */\n+} /* { dg-warning \"leak of 'id_sequence'\" } */"}, {"sha": "2add3cb109b5d736789b57eea40198c5445e95fa", "filename": "gcc/testsuite/gcc.dg/analyzer/file-CWE-1341-example.c", "status": "added", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ffile-CWE-1341-example.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ffile-CWE-1341-example.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Ffile-CWE-1341-example.c?ref=9ada45967b4cf543aa47091e99a760d0718013cc", "patch": "@@ -0,0 +1,41 @@\n+/* Example adapted from https://cwe.mitre.org/data/definitions/1341.html\n+   which states \"Copyright \u00a9 2006\u20132022, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.\"\n+   and which has this on:\n+     https://cwe.mitre.org/about/termsofuse.html\n+\n+   Terms of Use\n+\n+   CWE\u2122 is free to use by any organization or individual for any research, development, and/or commercial purposes, per these CWE Terms of Use. The MITRE Corporation (\"MITRE\") has copyrighted the CWE List, Top 25, CWSS, and CWRAF for the benefit of the community in order to ensure each remains a free and open standard, as well as to legally protect the ongoing use of it and any resulting content by government, vendors, and/or users. CWE is a trademark of MITRE. Please contact cwe@mitre.org if you require further clarification on this issue.\n+\n+   LICENSE\n+\n+   CWE Submissions: By submitting materials to The MITRE Corporation\u2019s (\"MITRE\") Common Weakness Enumeration Program (CWE\u2122), you hereby grant to MITRE a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to use, reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute your submitted materials and derivative works. Unless otherwise required by applicable law or agreed to in writing, it is understood that you are providing such materials on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.\n+\n+   CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy.\n+\n+   DISCLAIMERS\n+\n+   ALL DOCUMENTS AND THE INFORMATION CONTAINED IN THE CWE ARE PROVIDED ON AN \"AS IS\" BASIS AND THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES, DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+\n+   IN NO EVENT SHALL THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE CWE.  */\n+\n+#include <stdio.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+void example_1 (void)\n+{\n+  char b[2000];\n+  FILE *f = fopen(\"dbl_cls.c\", \"r\"); /* { dg-message \"opened here\" } */\n+  if (f)\n+    {\n+      b[0] = 0;\n+      fread(b, 1, sizeof(b) - 1, f);\n+      printf(\"%s\\n'\", b);\n+      int r1 = fclose(f); /* { dg-message \"first 'fclose' here\" } */\n+      printf(\"\\n-----------------\\n1 close done '%d'\\n\", r1);\n+      \n+      int r2 = fclose(f); /* { dg-warning \"double 'fclose' of FILE 'f'\" } */\n+      printf(\"2 close done '%d'\\n\", r2);\n+    }\n+}"}, {"sha": "cfb5e86260c1ce1ea6857224eb710715fa3a3828", "filename": "gcc/testsuite/gcc.dg/analyzer/malloc-CWE-401-example.c", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-401-example.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-401-example.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-401-example.c?ref=9ada45967b4cf543aa47091e99a760d0718013cc", "patch": "@@ -0,0 +1,37 @@\n+/* Example adapted from https://cwe.mitre.org/data/definitions/401.html\n+   which states \"Copyright \u00a9 2006\u20132022, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.\"\n+   and which has this on:\n+     https://cwe.mitre.org/about/termsofuse.html\n+\n+   Terms of Use\n+\n+   CWE\u2122 is free to use by any organization or individual for any research, development, and/or commercial purposes, per these CWE Terms of Use. The MITRE Corporation (\"MITRE\") has copyrighted the CWE List, Top 25, CWSS, and CWRAF for the benefit of the community in order to ensure each remains a free and open standard, as well as to legally protect the ongoing use of it and any resulting content by government, vendors, and/or users. CWE is a trademark of MITRE. Please contact cwe@mitre.org if you require further clarification on this issue.\n+\n+   LICENSE\n+\n+   CWE Submissions: By submitting materials to The MITRE Corporation\u2019s (\"MITRE\") Common Weakness Enumeration Program (CWE\u2122), you hereby grant to MITRE a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to use, reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute your submitted materials and derivative works. Unless otherwise required by applicable law or agreed to in writing, it is understood that you are providing such materials on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.\n+\n+   CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy.\n+\n+   DISCLAIMERS\n+\n+   ALL DOCUMENTS AND THE INFORMATION CONTAINED IN THE CWE ARE PROVIDED ON AN \"AS IS\" BASIS AND THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES, DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+\n+   IN NO EVENT SHALL THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE CWE.  */\n+\n+#define BLOCK_SIZE 4096\n+\n+#include <stdlib.h>\n+#include <unistd.h>\n+\n+char* getBlock(int fd) {\n+  char* buf = (char*) malloc(BLOCK_SIZE);\n+  if (!buf) {\n+    return NULL;\n+  }\n+  if (read(fd, buf, BLOCK_SIZE) != BLOCK_SIZE) {\n+    \n+    return NULL; /* TODO: should complain that \"buf\" is leaked on this path.  */\n+  }\n+  return buf;\n+}"}, {"sha": "51d878a17c363d894077f4f4895dd75974c99c97", "filename": "gcc/testsuite/gcc.dg/analyzer/malloc-CWE-415-examples.c", "status": "added", "additions": 53, "deletions": 0, "changes": 53, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-415-examples.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-415-examples.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-415-examples.c?ref=9ada45967b4cf543aa47091e99a760d0718013cc", "patch": "@@ -0,0 +1,53 @@\n+/* Example adapted from https://cwe.mitre.org/data/definitions/415.html\n+   which states \"Copyright \u00a9 2006\u20132022, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.\"\n+   and which has this on:\n+     https://cwe.mitre.org/about/termsofuse.html\n+\n+   Terms of Use\n+\n+   CWE\u2122 is free to use by any organization or individual for any research, development, and/or commercial purposes, per these CWE Terms of Use. The MITRE Corporation (\"MITRE\") has copyrighted the CWE List, Top 25, CWSS, and CWRAF for the benefit of the community in order to ensure each remains a free and open standard, as well as to legally protect the ongoing use of it and any resulting content by government, vendors, and/or users. CWE is a trademark of MITRE. Please contact cwe@mitre.org if you require further clarification on this issue.\n+\n+   LICENSE\n+\n+   CWE Submissions: By submitting materials to The MITRE Corporation\u2019s (\"MITRE\") Common Weakness Enumeration Program (CWE\u2122), you hereby grant to MITRE a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to use, reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute your submitted materials and derivative works. Unless otherwise required by applicable law or agreed to in writing, it is understood that you are providing such materials on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.\n+\n+   CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy.\n+\n+   DISCLAIMERS\n+\n+   ALL DOCUMENTS AND THE INFORMATION CONTAINED IN THE CWE ARE PROVIDED ON AN \"AS IS\" BASIS AND THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES, DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+\n+   IN NO EVENT SHALL THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE CWE.  */\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#define SIZE 1024\n+\n+void example_1 (int abrt)\n+{\n+  char* ptr = (char*)malloc (SIZE);\n+  /* ... */\n+  if (abrt) {\n+    free(ptr);\n+  }\n+  /* ... */\n+  free(ptr); /* { dg-warning \"double-'free' of 'ptr'\" } */\n+}\n+\n+#define BUFSIZE1 512\n+#define BUFSIZE2 ((BUFSIZE1/2) - 8)\n+\n+int main(int argc, char **argv) {\n+  char *buf1R1;\n+  char *buf2R1;\n+  char *buf1R2;\n+  buf1R1 = (char *) malloc(BUFSIZE2);\n+  buf2R1 = (char *) malloc(BUFSIZE2);\n+  free(buf1R1);\n+  free(buf2R1);\n+  buf1R2 = (char *) malloc(BUFSIZE1);\n+  strncpy(buf1R2, argv[1], BUFSIZE1-1); /* { dg-warning \"use of possibly-NULL 'buf1R2'\" } */\n+  free(buf2R1); /* { dg-warning \"double-'free' of 'buf2R1'\" } */\n+  free(buf1R2);\n+}"}, {"sha": "3f5e5e2603357d155f58b10fec09a8d8f2ff6011", "filename": "gcc/testsuite/gcc.dg/analyzer/malloc-CWE-416-examples.c", "status": "added", "additions": 60, "deletions": 0, "changes": 60, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-416-examples.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-416-examples.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-416-examples.c?ref=9ada45967b4cf543aa47091e99a760d0718013cc", "patch": "@@ -0,0 +1,60 @@\n+/* Examples adapted from https://cwe.mitre.org/data/definitions/416.html\n+   which states \"Copyright \u00a9 2006\u20132022, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.\"\n+   and which has this on:\n+     https://cwe.mitre.org/about/termsofuse.html\n+\n+   Terms of Use\n+\n+   CWE\u2122 is free to use by any organization or individual for any research, development, and/or commercial purposes, per these CWE Terms of Use. The MITRE Corporation (\"MITRE\") has copyrighted the CWE List, Top 25, CWSS, and CWRAF for the benefit of the community in order to ensure each remains a free and open standard, as well as to legally protect the ongoing use of it and any resulting content by government, vendors, and/or users. CWE is a trademark of MITRE. Please contact cwe@mitre.org if you require further clarification on this issue.\n+\n+   LICENSE\n+\n+   CWE Submissions: By submitting materials to The MITRE Corporation\u2019s (\"MITRE\") Common Weakness Enumeration Program (CWE\u2122), you hereby grant to MITRE a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to use, reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute your submitted materials and derivative works. Unless otherwise required by applicable law or agreed to in writing, it is understood that you are providing such materials on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.\n+\n+   CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy.\n+\n+   DISCLAIMERS\n+\n+   ALL DOCUMENTS AND THE INFORMATION CONTAINED IN THE CWE ARE PROVIDED ON AN \"AS IS\" BASIS AND THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES, DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+\n+   IN NO EVENT SHALL THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE CWE.  */\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#define BUFSIZER1 512\n+#define BUFSIZER2 ((BUFSIZER1/2) - 8)\n+\n+int main(int argc, char **argv) {\n+  char *buf1R1;\n+  char *buf2R1;\n+  char *buf2R2;\n+  char *buf3R2;\n+  buf1R1 = (char *) malloc(BUFSIZER1);\n+  buf2R1 = (char *) malloc(BUFSIZER1);\n+  free(buf2R1);\n+  buf2R2 = (char *) malloc(BUFSIZER2);\n+  buf3R2 = (char *) malloc(BUFSIZER2);\n+  strncpy(buf2R1, argv[1], BUFSIZER1-1); /* TODO: should complain about use-after-free here.  */\n+  free(buf1R1);\n+  free(buf2R2);\n+  free(buf3R2);\n+}\n+\n+#define SIZE 1024\n+extern void logError(const char *, const char *);\n+\n+void example_2 (int err)\n+{\n+  int abrt = 0;\n+\n+  char* ptr = (char*)malloc (SIZE);\n+  if (err) {\n+    abrt = 1;\n+    free(ptr);\n+  }\n+  /* ... */\n+  if (abrt) {\n+    logError(\"operation aborted before commit\", ptr); /* TODO: arguably should complain about use-after-free of ptr here.  */\n+  }\n+} /* { dg-warning \"leak of 'ptr'\" } */"}, {"sha": "036f8889a921650fcdf0b88f356c3273e645172f", "filename": "gcc/testsuite/gcc.dg/analyzer/malloc-CWE-590-examples.c", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-590-examples.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ada45967b4cf543aa47091e99a760d0718013cc/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-590-examples.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fanalyzer%2Fmalloc-CWE-590-examples.c?ref=9ada45967b4cf543aa47091e99a760d0718013cc", "patch": "@@ -0,0 +1,44 @@\n+/* { dg-additional-options \"-Wno-free-nonheap-object\" } */\n+\n+/* Examples adapted from https://cwe.mitre.org/data/definitions/590.html\n+   which states \"Copyright \u00a9 2006\u20132022, The MITRE Corporation. CWE, CWSS, CWRAF, and the CWE logo are trademarks of The MITRE Corporation.\"\n+   and which has this on:\n+     https://cwe.mitre.org/about/termsofuse.html\n+\n+   Terms of Use\n+\n+   CWE\u2122 is free to use by any organization or individual for any research, development, and/or commercial purposes, per these CWE Terms of Use. The MITRE Corporation (\"MITRE\") has copyrighted the CWE List, Top 25, CWSS, and CWRAF for the benefit of the community in order to ensure each remains a free and open standard, as well as to legally protect the ongoing use of it and any resulting content by government, vendors, and/or users. CWE is a trademark of MITRE. Please contact cwe@mitre.org if you require further clarification on this issue.\n+\n+   LICENSE\n+\n+   CWE Submissions: By submitting materials to The MITRE Corporation\u2019s (\"MITRE\") Common Weakness Enumeration Program (CWE\u2122), you hereby grant to MITRE a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to use, reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute your submitted materials and derivative works. Unless otherwise required by applicable law or agreed to in writing, it is understood that you are providing such materials on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied, including, without limitation, any warranties or conditions of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A PARTICULAR PURPOSE.\n+\n+   CWE Usage: MITRE hereby grants you a non-exclusive, royalty-free license to use CWE for research, development, and commercial purposes. Any copy you make for such purposes is authorized on the condition that you reproduce MITRE\u2019s copyright designation and this license in any such copy.\n+\n+   DISCLAIMERS\n+\n+   ALL DOCUMENTS AND THE INFORMATION CONTAINED IN THE CWE ARE PROVIDED ON AN \"AS IS\" BASIS AND THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES, DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n+\n+   IN NO EVENT SHALL THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS OR IS SPONSORED BY (IF ANY), THE MITRE CORPORATION, ITS BOARD OF TRUSTEES, OFFICERS, AGENTS, AND EMPLOYEES BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE CWE.  */\n+\n+#include <stdlib.h>\n+\n+typedef struct record_t { char placeholder[1024]; } record_t;\n+#define MAX_SIZE 100\n+\n+void foo_1(){\n+  record_t bar[MAX_SIZE];\n+\n+  /* do something interesting with bar */\n+\n+  /* ... */\n+  free(bar); /* { dg-warning \"'free' of '&bar' which points to memory on the stack\" } */\n+}\n+\n+record_t bar[MAX_SIZE]; //Global var\n+void foo_2(){\n+\n+  /* do something interesting with bar */\n+  /* ... */\n+  free(bar); /* { dg-warning \"'free' of '&bar' which points to memory not on the heap\" } */\n+}"}]}