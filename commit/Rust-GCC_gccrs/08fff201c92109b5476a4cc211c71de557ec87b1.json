{"sha": "08fff201c92109b5476a4cc211c71de557ec87b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDhmZmYyMDFjOTIxMDliNTQ3NmE0Y2MyMTFjNzFkZTU1N2VjODdiMQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-05-04T07:22:36Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2021-05-04T07:22:36Z"}, "message": "OpenMP/Fortran - fix pasto + testcase in depobj [PR100397]\n\ngcc/fortran/ChangeLog:\n\n\tPR testsuite/100397\n\t* trans-openmp.c (gfc_trans_omp_depobj): Fix pasto in enum values.\n\nlibgomp/ChangeLog:\n\n\tPR testsuite/100397\n\t* testsuite/libgomp.fortran/depobj-1.f90 (dep2, dep3): Move var\n\tdeclaration to scope of non-'depend'-guarded assignment to avoid races.", "tree": {"sha": "9e1049f7324de1c8a71a9737c3de5d2e07630e5a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9e1049f7324de1c8a71a9737c3de5d2e07630e5a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/08fff201c92109b5476a4cc211c71de557ec87b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08fff201c92109b5476a4cc211c71de557ec87b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/08fff201c92109b5476a4cc211c71de557ec87b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/08fff201c92109b5476a4cc211c71de557ec87b1/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "5fbe6a8e73b52c6ebc28b9111456226c1cda6472", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fbe6a8e73b52c6ebc28b9111456226c1cda6472", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5fbe6a8e73b52c6ebc28b9111456226c1cda6472"}], "stats": {"total": 19, "additions": 11, "deletions": 8}, "files": [{"sha": "aa3a82e34896b02a6ac02d6b0e54e7f1eb7b104c", "filename": "gcc/fortran/trans-openmp.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08fff201c92109b5476a4cc211c71de557ec87b1/gcc%2Ffortran%2Ftrans-openmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08fff201c92109b5476a4cc211c71de557ec87b1/gcc%2Ffortran%2Ftrans-openmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-openmp.c?ref=08fff201c92109b5476a4cc211c71de557ec87b1", "patch": "@@ -4964,8 +4964,8 @@ gfc_trans_omp_depobj (gfc_code *code)\n \t    ? code->ext.omp_clauses->depobj_update : n->u.depend_op)\n       {\n       case OMP_DEPEND_IN: k = GOMP_DEPEND_IN; break;\n-      case OMP_DEPEND_OUT: k = GOMP_DEPEND_IN; break;\n-      case OMP_DEPEND_INOUT: k = GOMP_DEPEND_IN; break;\n+      case OMP_DEPEND_OUT: k = GOMP_DEPEND_OUT; break;\n+      case OMP_DEPEND_INOUT: k = GOMP_DEPEND_INOUT; break;\n       case OMP_DEPEND_MUTEXINOUTSET: k = GOMP_DEPEND_MUTEXINOUTSET; break;\n       default: gcc_unreachable ();\n       }"}, {"sha": "273b10c09c54d50b0714b9bdd0a7c1fde7245ad9", "filename": "libgomp/testsuite/libgomp.fortran/depobj-1.f90", "status": "modified", "additions": 9, "deletions": 6, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/08fff201c92109b5476a4cc211c71de557ec87b1/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fdepobj-1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/08fff201c92109b5476a4cc211c71de557ec87b1/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fdepobj-1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.fortran%2Fdepobj-1.f90?ref=08fff201c92109b5476a4cc211c71de557ec87b1", "patch": "@@ -28,20 +28,20 @@ subroutine dep\n   end\n \n   subroutine dep2\n-    integer, pointer :: x\n     integer(omp_depend_kind) :: d1, d2\n     pointer :: d1\n-    allocate(d1, x)\n-    call dep2i(d1, d2, x)\n+    allocate(d1)\n+    call dep2i(d1, d2)\n     deallocate(d1)\n   contains\n-   subroutine dep2i(d1, d2, x)\n+   subroutine dep2i(d1, d2)\n     integer(omp_depend_kind) :: d1\n     integer(omp_depend_kind), optional :: d2\n-    integer, pointer, optional :: x\n     pointer :: d1\n     !$omp parallel\n       !$omp single\n+        block\n+        integer :: x\n         x = 1\n         !$omp depobj (d1) depend(out: x)\n         !$omp depobj (d2) depend (in:x)\n@@ -56,15 +56,17 @@ subroutine dep2i(d1, d2, x)\n         !$omp taskwait\n         !$omp depobj(d1)destroy\n         !$omp depobj(d2) destroy\n+        end block\n      !$omp end single\n    !$omp end parallel\n   end\n   end\n \n   subroutine dep3\n-    integer :: x\n     integer(omp_depend_kind) :: d(2)\n     !$omp parallel\n+      block\n+      integer :: x\n       x = 1\n       !$omp single\n         !$omp depobj(d(1)) depend(out:x)\n@@ -77,6 +79,7 @@ subroutine dep3\n             stop 3\n         !$omp end task\n       !$omp end single\n+      end block\n     !$omp end parallel\n     !$omp depobj(d(1)) destroy\n     !$omp depobj(d(2)) destroy"}]}