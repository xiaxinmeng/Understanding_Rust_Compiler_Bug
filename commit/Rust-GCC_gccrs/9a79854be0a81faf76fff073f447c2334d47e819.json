{"sha": "9a79854be0a81faf76fff073f447c2334d47e819", "node_id": "C_kwDOANBUbNoAKDlhNzk4NTRiZTBhODFmYWY3NmZmZjA3M2Y0NDdjMjMzNGQ0N2U4MTk", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2022-05-13T10:48:49Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2022-05-13T10:48:49Z"}, "message": "Introduce tests for hardbool Machine_Attribute for Ada\n\nTest for the validity checking performed on nonstandard booleans\nannotated with the \"hardbool\" Machine_Attribute pragma.\n\n\nfor  gcc/testsuite/ChangeLog\n\n\t* gnat.dg/hardbool.ads: New.\n\t* gnat.dg/hardbool.adb: New.", "tree": {"sha": "2d0e7bbcd267399280299a393b62b6f57997f1d9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2d0e7bbcd267399280299a393b62b6f57997f1d9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9a79854be0a81faf76fff073f447c2334d47e819", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a79854be0a81faf76fff073f447c2334d47e819", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a79854be0a81faf76fff073f447c2334d47e819", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a79854be0a81faf76fff073f447c2334d47e819/comments", "author": null, "committer": null, "parents": [{"sha": "6a116728e27c4da65d84483c0e75561a7479d4d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a116728e27c4da65d84483c0e75561a7479d4d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a116728e27c4da65d84483c0e75561a7479d4d5"}], "stats": {"total": 68, "additions": 68, "deletions": 0}, "files": [{"sha": "cc38af06a79b7b40add3495520349a68c1b871de", "filename": "gcc/testsuite/gnat.dg/hardbool.adb", "status": "added", "additions": 46, "deletions": 0, "changes": 46, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a79854be0a81faf76fff073f447c2334d47e819/gcc%2Ftestsuite%2Fgnat.dg%2Fhardbool.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a79854be0a81faf76fff073f447c2334d47e819/gcc%2Ftestsuite%2Fgnat.dg%2Fhardbool.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fhardbool.adb?ref=9a79854be0a81faf76fff073f447c2334d47e819", "patch": "@@ -0,0 +1,46 @@\n+-- { dg-do compile }\n+-- { dg-options \"-O -gnatVT -fdump-tree-optimized\" }\n+\n+--  Check that we perform the expected validity checks for\n+--  hardbool-annotated types, even when checking of tests is disabled.\n+\n+package body Hardbool is\n+   function T return Boolean is (Boolean (X) and then Boolean (Y));\n+\n+   procedure P1 is\n+   begin\n+      X := HBool1 (not Y);\n+   end P1;\n+\n+   procedure P2 is\n+   begin\n+      X := HBool1 (if Y then HBool2'(False) else HBool2'(True));\n+   end P2;\n+\n+   procedure P3 is\n+   begin\n+      X := (if Y then HBool1'(False) else HBool1'(True));\n+   end P3;\n+\n+   procedure Q1 is\n+   begin\n+      Y := HBool2 (not X);\n+   end Q1;\n+\n+   procedure Q2 is\n+   begin\n+      Y := HBool2 (if X then HBool1'(False) else HBool1'(True));\n+   end Q2;\n+\n+   procedure Q3 is\n+   begin\n+      Y := (if X then HBool2'(False) else HBool2'(True));\n+   end Q3;\n+\n+end Hardbool;\n+\n+-- One for each type's _rep_to_pos function.\n+-- { dg-final { scan-tree-dump-times \"gnat_rcheck_CE_Invalid_Data ..hardbool.ads\" 2 \"optimized\" } }\n+\n+-- One check for each variable used in T, one use in each P* and in each Q*.\n+-- { dg-final { scan-tree-dump-times \"gnat_rcheck_CE_Invalid_Data ..hardbool.adb\" 8 \"optimized\" } }"}, {"sha": "7181220a6db5d1df88dc334d35850556477f9827", "filename": "gcc/testsuite/gnat.dg/hardbool.ads", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9a79854be0a81faf76fff073f447c2334d47e819/gcc%2Ftestsuite%2Fgnat.dg%2Fhardbool.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9a79854be0a81faf76fff073f447c2334d47e819/gcc%2Ftestsuite%2Fgnat.dg%2Fhardbool.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fhardbool.ads?ref=9a79854be0a81faf76fff073f447c2334d47e819", "patch": "@@ -0,0 +1,22 @@\n+package Hardbool is\n+   type HBool1 is new Boolean;\n+   for HBool1'Size use 8;\n+   for HBool1 use (16#5a#, 16#a5#);\n+   pragma Machine_Attribute (HBool1, \"hardbool\");\n+\n+   type HBool2 is new Boolean;\n+   for HBool2 use (16#0ff0#, 16#f00f#);\n+   for HBool2'Size use 16;\n+   pragma Machine_Attribute (HBool2, \"hardbool\");\n+\n+   X : HBool1 := False;\n+   Y : HBool2 := True;\n+\n+   function T return Boolean;\n+   procedure P1;\n+   procedure P2;\n+   procedure P3;\n+   procedure Q1;\n+   procedure Q2;\n+   procedure Q3;\n+end Hardbool;"}]}