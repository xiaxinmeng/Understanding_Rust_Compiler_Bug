{"sha": "460dcec49f875a83ca9b66d5e45d712f836f681e", "node_id": "C_kwDOANBUbNoAKDQ2MGRjZWM0OWY4NzVhODNjYTliNjZkNWU0NWQ3MTJmODM2ZjY4MWU", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-07-31T21:02:14Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-08-01T06:16:03Z"}, "message": "Make irange dependency explicit for range_of_ssa_name_with_loop_info.\n\nEven though ranger is type agnostic, SCEV seems to only work with\nintegers.  This patch removes some FIXME notes making it explicit that\nbounds_of_var_in_loop only works with iranges.\n\nTested on x86-64 Linux.\n\ngcc/ChangeLog:\n\n\t* gimple-range-fold.cc (fold_using_range::range_of_phi): Only\n\tquery SCEV for integers.\n\t(fold_using_range::range_of_ssa_name_with_loop_info): Remove\n\tirange check.", "tree": {"sha": "3d2bae08d8f77ce79951556dafc58dbf4949539b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3d2bae08d8f77ce79951556dafc58dbf4949539b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/460dcec49f875a83ca9b66d5e45d712f836f681e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/460dcec49f875a83ca9b66d5e45d712f836f681e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/460dcec49f875a83ca9b66d5e45d712f836f681e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/460dcec49f875a83ca9b66d5e45d712f836f681e/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1efeaf99bd8bdfe2a350b8a56b88ed6e00594e54", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1efeaf99bd8bdfe2a350b8a56b88ed6e00594e54", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1efeaf99bd8bdfe2a350b8a56b88ed6e00594e54"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "7665c954f2be10a45683500491eddc8422ff60b7", "filename": "gcc/gimple-range-fold.cc", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/460dcec49f875a83ca9b66d5e45d712f836f681e/gcc%2Fgimple-range-fold.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/460dcec49f875a83ca9b66d5e45d712f836f681e/gcc%2Fgimple-range-fold.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-range-fold.cc?ref=460dcec49f875a83ca9b66d5e45d712f836f681e", "patch": "@@ -853,12 +853,14 @@ fold_using_range::range_of_phi (vrange &r, gphi *phi, fur_source &src)\n       }\n \n   // If SCEV is available, query if this PHI has any knonwn values.\n-  if (scev_initialized_p () && !POINTER_TYPE_P (TREE_TYPE (phi_def)))\n+  if (scev_initialized_p ()\n+      && !POINTER_TYPE_P (TREE_TYPE (phi_def))\n+      && irange::supports_p (TREE_TYPE (phi_def)))\n     {\n-      value_range loop_range;\n       class loop *l = loop_containing_stmt (phi);\n       if (l && loop_outer (l))\n \t{\n+\t  int_range_max loop_range;\n \t  range_of_ssa_name_with_loop_info (loop_range, phi_def, l, phi, src);\n \t  if (!loop_range.varying_p ())\n \t    {\n@@ -1337,9 +1339,7 @@ fold_using_range::range_of_ssa_name_with_loop_info (irange &r, tree name,\n {\n   gcc_checking_assert (TREE_CODE (name) == SSA_NAME);\n   tree min, max, type = TREE_TYPE (name);\n-  // FIXME: Remove the supports_p() once all this can handle floats, etc.\n-  if (irange::supports_p (type)\n-      && bounds_of_var_in_loop (&min, &max, src.query (), l, phi, name))\n+  if (bounds_of_var_in_loop (&min, &max, src.query (), l, phi, name))\n     {\n       if (TREE_CODE (min) != INTEGER_CST)\n \t{"}]}