{"sha": "1d672917b4b324a6aac3743f21b8c58940a0ceb8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MWQ2NzI5MTdiNGIzMjRhNmFhYzM3NDNmMjFiOGM1ODk0MGEwY2ViOA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2019-05-24T08:48:14Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2019-05-24T08:48:14Z"}, "message": "re PR tree-optimization/88440 (size optimization of memcpy-like code)\n\n2019-05-23  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/88440\n\t* opts.c (default_options_table): Enable -ftree-loop-distribute-patterns\n\tat -O[2s]+.\n\t* tree-loop-distribution.c (generate_memset_builtin): Fold the\n\tgenerated call.\n\t(generate_memcpy_builtin): Likewise.\n\t(distribute_loop): Pass in whether to only distribute patterns.\n\t(prepare_perfect_loop_nest): Also allow size optimization.\n\t(pass_loop_distribution::execute): When optimizing a loop\n\tnest for size allow pattern replacement.\n\n\t* gcc.dg/tree-ssa/ldist-37.c: New testcase.\n\t* gcc.dg/tree-ssa/ldist-38.c: Likewise.\n\t* gcc.dg/vect/vect.exp: Add -fno-tree-loop-distribute-patterns.\n\t* gcc.dg/tree-ssa/ldist-37.c: Adjust.\n\t* gcc.dg/tree-ssa/ldist-38.c: Likewise.\n\t* g++.dg/tree-ssa/pr78847.C: Likewise.\n\t* gcc.dg/autopar/pr39500-1.c: Likewise.\n\t* gcc.dg/autopar/reduc-1char.c: Likewise.\n\t* gcc.dg/autopar/reduc-7.c: Likewise.\n\t* gcc.dg/tree-ssa/ivopts-lt-2.c: Likewise.\n\t* gcc.dg/tree-ssa/ivopts-lt.c: Likewise.\n\t* gcc.dg/tree-ssa/predcom-dse-1.c: Likewise.\n\t* gcc.dg/tree-ssa/predcom-dse-2.c: Likewise.\n\t* gcc.dg/tree-ssa/predcom-dse-3.c: Likewise.\n\t* gcc.dg/tree-ssa/predcom-dse-4.c: Likewise.\n\t* gcc.dg/tree-ssa/prefetch-7.c: Likewise.\n\t* gcc.dg/tree-ssa/prefetch-8.c: Likewise.\n\t* gcc.dg/tree-ssa/prefetch-9.c: Likewise.\n\t* gcc.dg/tree-ssa/scev-11.c: Likewise.\n\t* gcc.dg/vect/costmodel/i386/costmodel-vect-31.c: Likewise.\n\t* gcc.dg/vect/costmodel/i386/costmodel-vect-33.c: Likewise.\n\t* gcc.dg/vect/costmodel/x86_64/costmodel-vect-31.c: Likewise.\n\t* gcc.dg/vect/costmodel/x86_64/costmodel-vect-33.c: Likewise.\n\t* gcc.target/i386/pr30970.c: Likewise.\n\t* gcc.target/i386/vect-double-1.c: Likewise.\n\t* gcc.target/i386/vect-double-2.c: Likewise.\n\t* gcc.dg/tree-ssa/gen-vect-2.c: Likewise.\n\t* gcc.dg/tree-ssa/gen-vect-26.c: Likewise.\n\t* gcc.dg/tree-ssa/gen-vect-28.c: Likewise.\n\t* gcc.dg/tree-ssa/gen-vect-32.c: Likewise.\n\t* gfortran.dg/vect/vect-5.f90: Likewise.\n\t* gfortran.dg/vect/vect-8.f90: Likewise.\n\nFrom-SVN: r271595", "tree": {"sha": "fe1da8303e2ebdbe9037d2346b2d417e6d5cd6d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe1da8303e2ebdbe9037d2346b2d417e6d5cd6d3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1d672917b4b324a6aac3743f21b8c58940a0ceb8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d672917b4b324a6aac3743f21b8c58940a0ceb8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d672917b4b324a6aac3743f21b8c58940a0ceb8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d672917b4b324a6aac3743f21b8c58940a0ceb8/comments", "author": null, "committer": null, "parents": [{"sha": "9453b779c41e27be2991860903d4b5f859fde059", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9453b779c41e27be2991860903d4b5f859fde059", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9453b779c41e27be2991860903d4b5f859fde059"}], "stats": {"total": 20, "additions": 20, "deletions": 0}, "files": [{"sha": "9aae432839434503f4d3196b3b7d6ac0fa364e40", "filename": "gcc/testsuite/gcc.dg/tree-ssa/ldist-37.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d672917b4b324a6aac3743f21b8c58940a0ceb8/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fldist-37.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d672917b4b324a6aac3743f21b8c58940a0ceb8/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fldist-37.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fldist-37.c?ref=1d672917b4b324a6aac3743f21b8c58940a0ceb8", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os -fdump-tree-ldist-optimized\" } */\n+\n+void foo(char* restrict dst, const char* buf)\n+{\n+  for (int i=0; i<8; ++i)\n+    *dst++ = *buf++;\n+}\n+\n+/* { dg-final { scan-tree-dump \"split to 0 loops and 1 library calls\" \"ldist\" } } */"}, {"sha": "e296e8295288d8e775c66d9788ca566ec3f2b712", "filename": "gcc/testsuite/gcc.dg/tree-ssa/ldist-38.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1d672917b4b324a6aac3743f21b8c58940a0ceb8/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fldist-38.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1d672917b4b324a6aac3743f21b8c58940a0ceb8/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fldist-38.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fldist-38.c?ref=1d672917b4b324a6aac3743f21b8c58940a0ceb8", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-ldist-optimized\" } */\n+\n+void foo(char* restrict dst, const char* buf)\n+{\n+  for (int i=0; i<8; ++i)\n+    *dst++ = *buf++;\n+}\n+\n+/* { dg-final { scan-tree-dump \"split to 0 loops and 1 library calls\" \"ldist\" } } */"}]}