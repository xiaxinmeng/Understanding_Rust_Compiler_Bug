{"sha": "8b07361ed42c59b4924327db352609df2b3c26d8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGIwNzM2MWVkNDJjNTliNDkyNDMyN2RiMzUyNjA5ZGYyYjNjMjZkOA==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2004-01-23T22:01:55Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2004-01-23T22:01:55Z"}, "message": "alloc-pool.c (align_four): Kill.\n\n\t* alloc-pool.c (align_four): Kill.\n\t(create_alloc_pool): Align size to eight.\n\t(free_alloc_pool, free_pool): Invalidate deallocated data.\n\nFrom-SVN: r76456", "tree": {"sha": "d23a6c8fc97e75845e3593b4ce953b6498443bc3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d23a6c8fc97e75845e3593b4ce953b6498443bc3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8b07361ed42c59b4924327db352609df2b3c26d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b07361ed42c59b4924327db352609df2b3c26d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8b07361ed42c59b4924327db352609df2b3c26d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8b07361ed42c59b4924327db352609df2b3c26d8/comments", "author": null, "committer": null, "parents": [{"sha": "e129d93a7b1eda6ee734fff7aa1f8bc60e5ba7e2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e129d93a7b1eda6ee734fff7aa1f8bc60e5ba7e2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e129d93a7b1eda6ee734fff7aa1f8bc60e5ba7e2"}], "stats": {"total": 14, "additions": 12, "deletions": 2}, "files": [{"sha": "ed7405890b6aece81ff21a52b7c80427a5ad2a5f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b07361ed42c59b4924327db352609df2b3c26d8/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b07361ed42c59b4924327db352609df2b3c26d8/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8b07361ed42c59b4924327db352609df2b3c26d8", "patch": "@@ -1,3 +1,9 @@\n+2004-01-23  Jan Hubicka  <jh@suse.cz>\n+\n+\t* alloc-pool.c (align_four): Kill.\n+\t(create_alloc_pool): Align size to eight.\n+\t(free_alloc_pool, free_pool): Invalidate deallocated data.\n+\n 2004-01-23  Ian Lance Taylor  <ian@wasabisystems.com>\n \n \tPR gcc/1532"}, {"sha": "bdcd42fd139c4e11d5a09fffac7cf0ae9a329732", "filename": "gcc/alloc-pool.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8b07361ed42c59b4924327db352609df2b3c26d8/gcc%2Falloc-pool.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8b07361ed42c59b4924327db352609df2b3c26d8/gcc%2Falloc-pool.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Falloc-pool.c?ref=8b07361ed42c59b4924327db352609df2b3c26d8", "patch": "@@ -34,7 +34,6 @@ extern void fancy_abort (const char *, int, const char *)\n     ATTRIBUTE_NORETURN;\n #define abort() fancy_abort (__FILE__, __LINE__, __FUNCTION__)\n \n-#define align_four(x) (((x+3) >> 2) << 2)\n #define align_eight(x) (((x+7) >> 3) << 3)\n \n /* The internal allocation object.  */\n@@ -90,7 +89,7 @@ create_alloc_pool (const char *name, size_t size, size_t num)\n     size = sizeof (alloc_pool_list);\n \n   /* Now align the size to a multiple of 4.  */\n-  size = align_four (size);\n+  size = align_eight (size);\n \n #ifdef ENABLE_CHECKING\n   /* Add the aligned size of ID.  */\n@@ -154,6 +153,9 @@ free_alloc_pool (alloc_pool pool)\n     }\n   /* Lastly, free the pool and the name.  */\n   free (pool->name);\n+#ifdef ENABLE_CHECKING\n+  memset (pool, 0xaf, sizeof (*pool));\n+#endif\n   free (pool);\n }\n \n@@ -225,6 +227,8 @@ pool_free (alloc_pool pool, void *ptr)\n   if (!ptr)\n     abort ();\n \n+  memset (ptr, 0xaf, pool->elt_size - offsetof (allocation_object, u.data));\n+\n   /* Check whether the PTR was allocated from POOL.  */\n   if (pool->id != ALLOCATION_OBJECT_PTR_FROM_USER_PTR (ptr)->id)\n     abort ();"}]}