{"sha": "40fc375d0af62c9f990bc147f280d6eecdef9d80", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDBmYzM3NWQwYWY2MmM5Zjk5MGJjMTQ3ZjI4MGQ2ZWVjZGVmOWQ4MA==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2000-09-18T16:45:48Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2000-09-18T16:45:48Z"}, "message": "sh.c (sh_expand_prologue): Mark GOTaddr2picreg as MAYBE_DEAD.\n\n* config/sh/sh.c (sh_expand_prologue): Mark GOTaddr2picreg as\nMAYBE_DEAD.\n(sh_expand_epilogue): Take the PIC register into account when\ncomputing the frame size.\n\nFrom-SVN: r36496", "tree": {"sha": "54863b987e32c75da10f41bf7136b114881a6ce0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/54863b987e32c75da10f41bf7136b114881a6ce0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/40fc375d0af62c9f990bc147f280d6eecdef9d80", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40fc375d0af62c9f990bc147f280d6eecdef9d80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40fc375d0af62c9f990bc147f280d6eecdef9d80", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40fc375d0af62c9f990bc147f280d6eecdef9d80/comments", "author": null, "committer": null, "parents": [{"sha": "55eec6605c16043daf8604c66a5a8d5e3e37c720", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/55eec6605c16043daf8604c66a5a8d5e3e37c720", "html_url": "https://github.com/Rust-GCC/gccrs/commit/55eec6605c16043daf8604c66a5a8d5e3e37c720"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "ae8159445177f423dc9db5100b11cd615772cbb5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/40fc375d0af62c9f990bc147f280d6eecdef9d80/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/40fc375d0af62c9f990bc147f280d6eecdef9d80/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=40fc375d0af62c9f990bc147f280d6eecdef9d80", "patch": "@@ -1,5 +1,10 @@\n 2000-09-18  Alexandre Oliva  <aoliva@redhat.com>\n \n+\t* config/sh/sh.c (sh_expand_prologue): Mark GOTaddr2picreg as\n+\tMAYBE_DEAD.\n+\t(sh_expand_epilogue): Take the PIC register into account when\n+\tcomputing the frame size.\n+\n \t* config/sh/sh.c (nonpic_symbol_mentioned_p): Check LABEL_REFs.\n \t* config/sh/sh.md (sym_label2reg, symPLT_label2reg): Protect\n \tLABEL_REFs with a PIC-safe unspec."}, {"sha": "18079162287e78dc1c23003b857ddfacb9116713", "filename": "gcc/config/sh/sh.c", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/40fc375d0af62c9f990bc147f280d6eecdef9d80/gcc%2Fconfig%2Fsh%2Fsh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/40fc375d0af62c9f990bc147f280d6eecdef9d80/gcc%2Fconfig%2Fsh%2Fsh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fsh%2Fsh.c?ref=40fc375d0af62c9f990bc147f280d6eecdef9d80", "patch": "@@ -3950,7 +3950,17 @@ sh_expand_prologue ()\n \n   if (flag_pic && (current_function_uses_pic_offset_table\n \t\t   || regs_ever_live[PIC_OFFSET_TABLE_REGNUM]))\n-    emit_insn (gen_GOTaddr2picreg ());\n+    {\n+      rtx insn = get_last_insn ();\n+      rtx insn_end = emit_insn (gen_GOTaddr2picreg ());\n+      while (insn != insn_end)\n+\t{\n+\t  insn = NEXT_INSN (insn);\n+\t  REG_NOTES (insn) = gen_rtx_EXPR_LIST (REG_MAYBE_DEAD,\n+\t\t\t\t\t\tconst0_rtx,\n+\t\t\t\t\t\tREG_NOTES (insn));\n+\t}\n+    }\n \n   if (target_flags != save_flags)\n     emit_insn (gen_toggle_sz ());\n@@ -3976,6 +3986,14 @@ sh_expand_epilogue ()\n \n   live_regs_mask = calc_live_regs (&d, &live_regs_mask2);\n \n+  if (flag_pic && current_function_uses_pic_offset_table)\n+    {\n+      if ((live_regs_mask & (1 << PIC_OFFSET_TABLE_REGNUM)) != 0)\n+\tabort ();\n+      live_regs_mask |= (1 << PIC_OFFSET_TABLE_REGNUM);\n+      d += UNITS_PER_WORD;\n+    }\n+\n   frame_size = rounded_frame_size (d);\n \n   if (frame_pointer_needed)\n@@ -4003,8 +4021,6 @@ sh_expand_epilogue ()\n \n   if (target_flags != save_flags)\n     emit_insn (gen_toggle_sz ());\n-  if (flag_pic && current_function_uses_pic_offset_table)\n-    live_regs_mask |= (1 << PIC_OFFSET_TABLE_REGNUM);\n   if (live_regs_mask & (1 << PR_REG))\n     pop (PR_REG);\n   for (i = 0; i < FIRST_PSEUDO_REGISTER; i++)"}]}