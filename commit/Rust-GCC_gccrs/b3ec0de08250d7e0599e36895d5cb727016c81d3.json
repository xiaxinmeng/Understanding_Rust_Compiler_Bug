{"sha": "b3ec0de08250d7e0599e36895d5cb727016c81d3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjNlYzBkZTA4MjUwZDdlMDU5OWUzNjg5NWQ1Y2I3MjcwMTZjODFkMw==", "commit": {"author": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2020-10-01T09:07:20Z"}, "committer": {"name": "Tom de Vries", "email": "tdevries@suse.de", "date": "2020-10-01T19:22:16Z"}, "message": "[nvptx] Emit mov.u32 instead of cvt.u32.u32 for truncsiqi2\n\nWhen running:\n...\n$ gcc.sh src/gcc/testsuite/gcc.target/nvptx/abi-complex-arg.c -S -dP\n...\nwe have in abi-complex-arg.s:\n...\n//(insn 3 5 4 2\n//  (set\n//    (reg:QI 23)\n//    (truncate:QI (reg:SI 22))) \"abi-complex-arg.c\":38:1 29 {truncsiqi2}\n//  (nil))\n                cvt.u32.u32     %r23, %r22;     // 3    [c=4]  truncsiqi2/0\n...\n\nThe cvt.u32.u32 can be written shorter and clearer as mov.u32.\n\nFix this in define_insn \"truncsi<QHIM>2\".\n\nTested on nvptx.\n\ngcc/ChangeLog:\n\n2020-10-01  Tom de Vries  <tdevries@suse.de>\n\n\tPR target/80845\n\t* config/nvptx/nvptx.md (define_insn \"truncsi<QHIM>2\"): Emit mov.u32\n\tinstead of cvt.u32.u32.", "tree": {"sha": "a2dd483822dceed49f226da05ab31ab821f3191f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a2dd483822dceed49f226da05ab31ab821f3191f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b3ec0de08250d7e0599e36895d5cb727016c81d3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3ec0de08250d7e0599e36895d5cb727016c81d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3ec0de08250d7e0599e36895d5cb727016c81d3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3ec0de08250d7e0599e36895d5cb727016c81d3/comments", "author": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "committer": {"login": "vries", "id": 4057235, "node_id": "MDQ6VXNlcjQwNTcyMzU=", "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vries", "html_url": "https://github.com/vries", "followers_url": "https://api.github.com/users/vries/followers", "following_url": "https://api.github.com/users/vries/following{/other_user}", "gists_url": "https://api.github.com/users/vries/gists{/gist_id}", "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vries/subscriptions", "organizations_url": "https://api.github.com/users/vries/orgs", "repos_url": "https://api.github.com/users/vries/repos", "events_url": "https://api.github.com/users/vries/events{/privacy}", "received_events_url": "https://api.github.com/users/vries/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c2978b3405884e38429c1937f416753ca88d3cd6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2978b3405884e38429c1937f416753ca88d3cd6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2978b3405884e38429c1937f416753ca88d3cd6"}], "stats": {"total": 10, "additions": 7, "deletions": 3}, "files": [{"sha": "ccbcd096fd1d22ecae53daa6b135dd4e0e615814", "filename": "gcc/config/nvptx/nvptx.md", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b3ec0de08250d7e0599e36895d5cb727016c81d3/gcc%2Fconfig%2Fnvptx%2Fnvptx.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b3ec0de08250d7e0599e36895d5cb727016c81d3/gcc%2Fconfig%2Fnvptx%2Fnvptx.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.md?ref=b3ec0de08250d7e0599e36895d5cb727016c81d3", "patch": "@@ -383,9 +383,13 @@\n   [(set (match_operand:QHIM 0 \"nvptx_nonimmediate_operand\" \"=R,m\")\n \t(truncate:QHIM (match_operand:SI 1 \"nvptx_register_operand\" \"R,R\")))]\n   \"\"\n-  \"@\n-   %.\\\\tcvt%t0.u32\\\\t%0, %1;\n-   %.\\\\tst%A0.u%T0\\\\t%0, %1;\"\n+  {\n+    if (which_alternative == 1)\n+      return \"%.\\\\tst%A0.u%T0\\\\t%0, %1;\";\n+    if (GET_MODE (operands[0]) == QImode)\n+      return \"%.\\\\tmov%t0\\\\t%0, %1;\";\n+    return \"%.\\\\tcvt%t0.u32\\\\t%0, %1;\";\n+  }\n   [(set_attr \"subregs_ok\" \"true\")])\n \n (define_insn \"truncdi<mode>2\""}]}