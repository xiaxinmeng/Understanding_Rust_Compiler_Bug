{"sha": "5ec96609560006b0b7787892766fa1936c30a2b2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWVjOTY2MDk1NjAwMDZiMGI3Nzg3ODkyNzY2ZmExOTM2YzMwYTJiMg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2010-06-21T16:30:43Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2010-06-21T16:30:43Z"}, "message": "dwarf2out.c (add_linkage_name): New function.\n\n\t* dwarf2out.c (add_linkage_name): New function.  Don't add\n\tanything to DW_TAG_member DIEs.\n\t(add_name_and_src_coords_attributes): Use it.\n\t(gen_variable_die): Call it for C++ static data members if\n\tspecification is DW_TAG_member.\n\nFrom-SVN: r161096", "tree": {"sha": "15df36708b64afffb2db6409e329fbcefba00404", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/15df36708b64afffb2db6409e329fbcefba00404"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5ec96609560006b0b7787892766fa1936c30a2b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ec96609560006b0b7787892766fa1936c30a2b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ec96609560006b0b7787892766fa1936c30a2b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ec96609560006b0b7787892766fa1936c30a2b2/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f0057424da31008bc4e1f97802160db6ff5a5e34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0057424da31008bc4e1f97802160db6ff5a5e34", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0057424da31008bc4e1f97802160db6ff5a5e34"}], "stats": {"total": 58, "additions": 38, "deletions": 20}, "files": [{"sha": "f6e1007baabf74897e3f8d9abbcfd39630dab4b7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ec96609560006b0b7787892766fa1936c30a2b2/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ec96609560006b0b7787892766fa1936c30a2b2/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5ec96609560006b0b7787892766fa1936c30a2b2", "patch": "@@ -1,5 +1,11 @@\n 2010-06-21  Jakub Jelinek  <jakub@redhat.com>\n \n+\t* dwarf2out.c (add_linkage_name): New function.  Don't add\n+\tanything to DW_TAG_member DIEs.\n+\t(add_name_and_src_coords_attributes): Use it.\n+\t(gen_variable_die): Call it for C++ static data members if\n+\tspecification is DW_TAG_member.\n+\n \t* dwarf2out.c (base_type_die): Use DW_ATE_UTF for\n \tC++ char16_t and char32_t.\n "}, {"sha": "701d7927a6744ae5434267f3bdc2a4dbabb16d41", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 32, "deletions": 20, "changes": 52, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5ec96609560006b0b7787892766fa1936c30a2b2/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5ec96609560006b0b7787892766fa1936c30a2b2/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=5ec96609560006b0b7787892766fa1936c30a2b2", "patch": "@@ -17330,6 +17330,34 @@ add_src_coords_attributes (dw_die_ref die, tree decl)\n   add_AT_unsigned (die, DW_AT_decl_line, s.line);\n }\n \n+/* Add DW_AT_{,MIPS_}linkage_name attribute for the given decl.  */\n+\n+static void\n+add_linkage_name (dw_die_ref die, tree decl)\n+{\n+  if ((TREE_CODE (decl) == FUNCTION_DECL || TREE_CODE (decl) == VAR_DECL)\n+       && TREE_PUBLIC (decl)\n+       && !DECL_ABSTRACT (decl)\n+       && !(TREE_CODE (decl) == VAR_DECL && DECL_REGISTER (decl))\n+       && die->die_tag != DW_TAG_member)\n+    {\n+      /* Defer until we have an assembler name set.  */\n+      if (!DECL_ASSEMBLER_NAME_SET_P (decl))\n+\t{\n+\t  limbo_die_node *asm_name;\n+\n+\t  asm_name = ggc_alloc_cleared_limbo_die_node ();\n+\t  asm_name->die = die;\n+\t  asm_name->created_for = decl;\n+\t  asm_name->next = deferred_asm_name;\n+\t  deferred_asm_name = asm_name;\n+\t}\n+      else if (DECL_ASSEMBLER_NAME (decl) != DECL_NAME (decl))\n+\tadd_AT_string (die, AT_linkage_name,\n+\t\t       IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl)));\n+    }\n+}\n+\n /* Add a DW_AT_name attribute and source coordinate attribute for the\n    given decl, but only if it actually has a name.  */\n \n@@ -17347,26 +17375,7 @@ add_name_and_src_coords_attributes (dw_die_ref die, tree decl)\n       if (! DECL_ARTIFICIAL (decl))\n \tadd_src_coords_attributes (die, decl);\n \n-      if ((TREE_CODE (decl) == FUNCTION_DECL || TREE_CODE (decl) == VAR_DECL)\n-\t  && TREE_PUBLIC (decl)\n-\t  && !DECL_ABSTRACT (decl)\n-\t  && !(TREE_CODE (decl) == VAR_DECL && DECL_REGISTER (decl)))\n-\t{\n-\t  /* Defer until we have an assembler name set.  */\n-\t  if (!DECL_ASSEMBLER_NAME_SET_P (decl))\n-\t    {\n-\t      limbo_die_node *asm_name;\n-\n-\t      asm_name = ggc_alloc_cleared_limbo_die_node ();\n-\t      asm_name->die = die;\n-\t      asm_name->created_for = decl;\n-\t      asm_name->next = deferred_asm_name;\n-\t      deferred_asm_name = asm_name;\n-\t    }\n-\t  else if (DECL_ASSEMBLER_NAME (decl) != DECL_NAME (decl))\n-\t    add_AT_string (die, AT_linkage_name,\n-\t\t\t   IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl)));\n-\t}\n+      add_linkage_name (die, decl);\n     }\n \n #ifdef VMS_DEBUGGING_INFO\n@@ -18984,6 +18993,9 @@ gen_variable_die (tree decl, tree origin, dw_die_ref context_die)\n \n \t  if (get_AT_unsigned (old_die, DW_AT_decl_line) != (unsigned) s.line)\n \t    add_AT_unsigned (var_die, DW_AT_decl_line, s.line);\n+\n+\t  if (old_die->die_tag == DW_TAG_member)\n+\t    add_linkage_name (var_die, decl);\n \t}\n     }\n   else"}]}