{"sha": "7477de01a8c9c4f496d6f4daea90255ec0aad272", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQ3N2RlMDFhOGM5YzRmNDk2ZDZmNGRhZWE5MDI1NWVjMGFhZDI3Mg==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2015-10-22T08:24:01Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2015-10-22T08:24:01Z"}, "message": "S/390: PR68015 Fix ICE in s390_emit_compare\n\ngcc/ChangeLog:\n\n2015-10-22  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/68015\n\t* config/s390/s390.md (mov<mode>cc): Emit compare only if we don't\n\talready have a comparison result.\n\ngcc/testsuite/ChangeLog:\n\n2015-10-22  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/68015\n\t* gcc.target/s390/pr68015.c: New test.\n\nFrom-SVN: r229163", "tree": {"sha": "95ae2b7b6b9c76277353fb75bf90fdfb702956b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/95ae2b7b6b9c76277353fb75bf90fdfb702956b6"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7477de01a8c9c4f496d6f4daea90255ec0aad272", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7477de01a8c9c4f496d6f4daea90255ec0aad272", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7477de01a8c9c4f496d6f4daea90255ec0aad272", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7477de01a8c9c4f496d6f4daea90255ec0aad272/comments", "author": null, "committer": null, "parents": [{"sha": "597bb9db4ac508410b42b53480451c7b521b8661", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/597bb9db4ac508410b42b53480451c7b521b8661", "html_url": "https://github.com/Rust-GCC/gccrs/commit/597bb9db4ac508410b42b53480451c7b521b8661"}], "stats": {"total": 44, "additions": 42, "deletions": 2}, "files": [{"sha": "7385acdc788b6b524eb171f5ec564b976156df5c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7477de01a8c9c4f496d6f4daea90255ec0aad272", "patch": "@@ -1,3 +1,9 @@\n+2015-10-22  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/68015\n+\t* config/s390/s390.md (mov<mode>cc): Emit compare only if we don't\n+\talready have a comparison result.\n+\n 2015-10-22  Ramana Radhakrishnan  <ramana.radhakrishnan@arm.com>\n \n \tPR target/63304"}, {"sha": "ea65c746fca0f6394cfba6821303fa606d5e1dd9", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=7477de01a8c9c4f496d6f4daea90255ec0aad272", "patch": "@@ -6108,8 +6108,13 @@\n \t\t\t  (match_operand:GPR 2 \"nonimmediate_operand\" \"\")\n \t\t\t  (match_operand:GPR 3 \"nonimmediate_operand\" \"\")))]\n   \"TARGET_Z196\"\n-  \"operands[1] = s390_emit_compare (GET_CODE (operands[1]),\n-                                    XEXP (operands[1], 0), XEXP (operands[1], 1));\")\n+{\n+  /* Emit the comparison insn in case we do not already have a comparison result.  */\n+  if (!s390_comparison (operands[1], VOIDmode))\n+    operands[1] = s390_emit_compare (GET_CODE (operands[1]),\n+\t\t\t\t     XEXP (operands[1], 0),\n+\t\t\t\t     XEXP (operands[1], 1));\n+})\n \n ; locr, loc, stoc, locgr, locg, stocg\n (define_insn_and_split \"*mov<mode>cc\""}, {"sha": "4f54df62c182d60eff61b1b1efc9c880d26a800d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7477de01a8c9c4f496d6f4daea90255ec0aad272", "patch": "@@ -1,3 +1,8 @@\n+2015-10-22  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/68015\n+\t* gcc.target/s390/pr68015.c: New test.\n+\n 2015-10-22  Andre Vieira  <andre.simoesdiasvieira@arm.com>\n \n \tPR testsuite/67948"}, {"sha": "b0d1f35ad1a80431c2ad0cd0b04c30316da7bc26", "filename": "gcc/testsuite/gcc.target/s390/pr68015.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr68015.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7477de01a8c9c4f496d6f4daea90255ec0aad272/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr68015.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpr68015.c?ref=7477de01a8c9c4f496d6f4daea90255ec0aad272", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-compile } */\n+/* { dg-options \"-O2 -march=z196\" } */\n+\n+extern long useme (long, ...);\n+\n+void\n+foo (void)\n+{\n+  long secs = useme (41);\n+  long utc_secs = useme (42);\n+  long h, m;\n+\n+  utc_secs = useme (42);\n+  h = secs / 3600;\n+  m = secs / 60;\n+  if (utc_secs >= 86400)\n+    {\n+      m = 59;\n+      h--;\n+      if (h < 0)\n+\th = 23;\n+    }\n+  useme (h, m);\n+}"}]}