{"sha": "2dfd63ded836e993c3693da957142b0228c61607", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmRmZDYzZGVkODM2ZTk5M2MzNjkzZGE5NTcxNDJiMDIyOGM2MTYwNw==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2019-11-28T15:39:48Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2019-11-28T15:39:48Z"}, "message": "cgraph: ifunc resolvers cannot be made local (PR 92697)\n\n2019-11-28  Martin Jambor  <mjambor@suse.cz>\n\n\tPR ipa/92697\n\t* cgraph.c (cgraph_node_cannot_be_local_p_1): Return true for\n\tifunc_resolvers.\n\t* symtab.c (symtab_node::dump_base): Dump ifunc_resolver flag.\n\tRemoved trailig whitespace.\n\n\ttestsuite/\n\t* g++.dg/ipa/pr92697.C: New.\n\nFrom-SVN: r278812", "tree": {"sha": "cd9141bc7986db875bf61ac841ff0f056253111b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cd9141bc7986db875bf61ac841ff0f056253111b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2dfd63ded836e993c3693da957142b0228c61607", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dfd63ded836e993c3693da957142b0228c61607", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2dfd63ded836e993c3693da957142b0228c61607", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dfd63ded836e993c3693da957142b0228c61607/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e01857197b5fbd660903fe8c0b4c6387780afe10", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e01857197b5fbd660903fe8c0b4c6387780afe10", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e01857197b5fbd660903fe8c0b4c6387780afe10"}], "stats": {"total": 69, "additions": 68, "deletions": 1}, "files": [{"sha": "60863539404a8d3e1a97ac3dfc61b85a6d28fd4c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dfd63ded836e993c3693da957142b0228c61607/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dfd63ded836e993c3693da957142b0228c61607/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2dfd63ded836e993c3693da957142b0228c61607", "patch": "@@ -1,3 +1,11 @@\n+2019-11-28  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/92697\n+\t* cgraph.c (cgraph_node_cannot_be_local_p_1): Return true for\n+\tifunc_resolvers.\n+\t* symtab.c (symtab_node::dump_base): Dump ifunc_resolver flag.\n+\tRemoved trailig whitespace.\n+\n 2019-11-28  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* profile-count.h (profile_count::combine_with_ipa_count_within):"}, {"sha": "dd07516b83e8f7032efd9c5dea56e5fc8142375f", "filename": "gcc/cgraph.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Fcgraph.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Fcgraph.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraph.c?ref=2dfd63ded836e993c3693da957142b0228c61607", "patch": "@@ -2227,6 +2227,7 @@ static bool\n cgraph_node_cannot_be_local_p_1 (cgraph_node *node, void *)\n {\n   return !(!node->force_output\n+\t   && !node->ifunc_resolver\n \t   && ((DECL_COMDAT (node->decl)\n \t\t&& !node->forced_by_abi\n \t\t&& !node->used_from_object_file_p ()"}, {"sha": "5a3122fc8bb9675fe48b9cb08f479cc1cfade759", "filename": "gcc/symtab.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Fsymtab.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Fsymtab.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsymtab.c?ref=2dfd63ded836e993c3693da957142b0228c61607", "patch": "@@ -914,8 +914,10 @@ symtab_node::dump_base (FILE *f)\n       if (DECL_STATIC_DESTRUCTOR (decl))\n \tfprintf (f, \" destructor\");\n     }\n+  if (ifunc_resolver)\n+    fprintf (f, \" ifunc_resolver\");\n   fprintf (f, \"\\n\");\n-  \n+\n   if (same_comdat_group)\n     fprintf (f, \"  Same comdat group as: %s\\n\",\n \t     same_comdat_group->dump_asm_name ());"}, {"sha": "eeb4379b5d066dbfc93924dad53336d6de0ea5c8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2dfd63ded836e993c3693da957142b0228c61607", "patch": "@@ -1,3 +1,8 @@\n+2019-11-28  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/92697\n+\t* g++.dg/ipa/pr92697.C: New.\n+\n 2019-11-28  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/92645"}, {"sha": "8958bd0dcf2451c616aab3c8ca332fa02dbee80c", "filename": "gcc/testsuite/g++.dg/ipa/pr92697.C", "status": "added", "additions": 51, "deletions": 0, "changes": 51, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fpr92697.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2dfd63ded836e993c3693da957142b0228c61607/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fpr92697.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fpr92697.C?ref=2dfd63ded836e993c3693da957142b0228c61607", "patch": "@@ -0,0 +1,51 @@\n+/* { dg-do compile } */\n+/* { dg-require-ifunc \"\" } */\n+/* { dg-options \"-O2 -fdump-ipa-sra\" } */\n+\n+extern int have_avx2;\n+extern int have_ssse3;\n+\n+namespace NTL\n+{\n+\n+  static void randomstream_impl_init_base ()\n+  {\n+    __builtin_printf (\"Frob1\\n\");\n+  }\n+\n+  static void // __attribute__ ((target (\"ssse3\")))\n+    randomstream_impl_init_ssse3 ()\n+  {\n+    __builtin_printf (\"Frob2\\n\");\n+  }\n+\n+  static void\n+    //__attribute__ ((target (\"avx2,fma,avx,pclmul,ssse3\")))\n+    randomstream_impl_init_avx2 ()\n+  {\n+    __builtin_printf (\"Frob3\\n\");\n+  }\n+\n+  extern \"C\"\n+  {\n+    static void (*resolve_randomstream_impl_init (void)) ()\n+    {\n+      if (have_avx2)\n+\treturn &randomstream_impl_init_avx2;\n+      if (have_ssse3)\n+\treturn &randomstream_impl_init_ssse3;\n+      return &randomstream_impl_init_base;\n+    }\n+  }\n+  static void\n+    __attribute__ ((ifunc (\"resolve_\" \"randomstream_impl_init\")))\n+    randomstream_impl_init ();\n+  void foo ()\n+  {\n+    randomstream_impl_init ();\n+  }\n+\n+}\n+\n+\n+/* { dg-final { scan-ipa-dump-not \"Created new node\" \"sra\" } } */"}]}