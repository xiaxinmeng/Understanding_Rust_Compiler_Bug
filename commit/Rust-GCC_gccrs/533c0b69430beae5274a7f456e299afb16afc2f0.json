{"sha": "533c0b69430beae5274a7f456e299afb16afc2f0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTMzYzBiNjk0MzBiZWFlNTI3NGE3ZjQ1NmUyOTlhZmIxNmFmYzJmMA==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2017-03-29T20:53:59Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2017-03-29T20:53:59Z"}, "message": "combine: Fix PR80233\n\nIf combine has added an unconditional trap there will be a new basic\nblock as well.  It will then end up considering the NOTE_INSN_BASIC_BLOCK\nas the last_combined_insn, but then it tries to take the DF_INSN_LUID\nof that and that dereferences a NULL pointer (since such a note is not\nan INSN_P).\n\nThis fixes it by not taking non-insns as last_combined_insn.\n\n\n\tPR rtl-optimization/80233\n\t* combine.c (combine_instructions): Only take NONDEBUG_INSN_P insns\n\tas last_combined_insn.  Do not test for BARRIER_P separately.\n\ngcc/testsuite/\n\tPR rtl-optimization/80233\n\t* gcc.c-torture/compile/pr80233.c: New testcase.\n\nFrom-SVN: r246575", "tree": {"sha": "5b85b3acab57500c6da7fff23473f5f7c7223dc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5b85b3acab57500c6da7fff23473f5f7c7223dc4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/533c0b69430beae5274a7f456e299afb16afc2f0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/533c0b69430beae5274a7f456e299afb16afc2f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/533c0b69430beae5274a7f456e299afb16afc2f0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/533c0b69430beae5274a7f456e299afb16afc2f0/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6f8de3dd3ca509a4fa8544aa3c32501affc88ac4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6f8de3dd3ca509a4fa8544aa3c32501affc88ac4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6f8de3dd3ca509a4fa8544aa3c32501affc88ac4"}], "stats": {"total": 37, "additions": 35, "deletions": 2}, "files": [{"sha": "85b1c37eadd42d3ea981db7ca0973c1fe99114e6", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=533c0b69430beae5274a7f456e299afb16afc2f0", "patch": "@@ -1,3 +1,9 @@\n+2017-03-29  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR rtl-optimization/80233\n+\t* combine.c (combine_instructions): Only take NONDEBUG_INSN_P insns\n+\tas last_combined_insn.  Do not test for BARRIER_P separately.\n+\n 2017-03-29  Andreas Schwab  <schwab@suse.de>\n \n \tPR ada/80146"}, {"sha": "87daa28bc8eff311ffd5228307967ac7debaffed", "filename": "gcc/combine.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=533c0b69430beae5274a7f456e299afb16afc2f0", "patch": "@@ -1250,10 +1250,10 @@ combine_instructions (rtx_insn *f, unsigned int nregs)\n \t    continue;\n \n \t  while (last_combined_insn\n-\t\t && last_combined_insn->deleted ())\n+\t\t && (!NONDEBUG_INSN_P (last_combined_insn)\n+\t\t     || last_combined_insn->deleted ()))\n \t    last_combined_insn = PREV_INSN (last_combined_insn);\n \t  if (last_combined_insn == NULL_RTX\n-\t      || BARRIER_P (last_combined_insn)\n \t      || BLOCK_FOR_INSN (last_combined_insn) != this_basic_block\n \t      || DF_INSN_LUID (last_combined_insn) <= DF_INSN_LUID (insn))\n \t    last_combined_insn = insn;"}, {"sha": "e7f7334f1194ce59604b989e6833d35f70276a25", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=533c0b69430beae5274a7f456e299afb16afc2f0", "patch": "@@ -1,3 +1,8 @@\n+2017-03-29  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR rtl-optimization/80233\n+\t* gcc.c-torture/compile/pr80233.c: New testcase.\n+\n 2017-03-28  Thomas Koenig  <tkoenig@gcc.gnu.org>\n \n \tPR fortran/80254"}, {"sha": "eb9b4a47246d37793edcdd340dfc6da9c61f6d04", "filename": "gcc/testsuite/gcc.c-torture/compile/pr80233.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr80233.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/533c0b69430beae5274a7f456e299afb16afc2f0/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr80233.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fcompile%2Fpr80233.c?ref=533c0b69430beae5274a7f456e299afb16afc2f0", "patch": "@@ -0,0 +1,22 @@\n+/* PR rtl-optimization/80233 */\n+\n+int xg;\n+\n+void\n+t4 (int o9)\n+{\n+  int it;\n+\n+  if (o9 == 0)\n+    {\n+      int fx;\n+\n+      xg *= it;\n+      if (xg == 0)\n+        it /= 0;\n+\n+      fx = (it != 0) ? (xg < 0) : (xg / o9);\n+      if (fx != 0)\n+        xg = 0;\n+    }\n+}"}]}