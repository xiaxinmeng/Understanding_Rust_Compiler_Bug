{"sha": "5c12b59bd81874f851587c08a83dd7932ebf9114", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWMxMmI1OWJkODE4NzRmODUxNTg3YzA4YTgzZGQ3OTMyZWJmOTExNA==", "commit": {"author": {"name": "Andrew Haley", "email": "aph@gcc.gnu.org", "date": "2007-04-26T14:31:29Z"}, "committer": {"name": "Andrew Haley", "email": "aph@gcc.gnu.org", "date": "2007-04-26T14:31:29Z"}, "message": "ObjectStreamClass.java (ensureFieldsSet): New method.\n\n2007-04-25  Andrew Haley  <aph@redhat.com>\n\n\t* java/io/ObjectStreamClass.java (ensureFieldsSet): New method.\n\t(setFields): call ensureFieldsSet.\n\t(fieldsSet): New field.\n\t* java/io/ObjectOutputStream.java (writeFields): Call\n\tosc.ensureFieldsSet().\n\n\t* java/io/ObjectInputStream.java (parseContent): Assign the handle\n\tfor a PROXYCLASSDESC immediately after reading the marker.\n\nFrom-SVN: r124187", "tree": {"sha": "5adf7762dc6581c91705a6569ffe2b0e7aa990f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5adf7762dc6581c91705a6569ffe2b0e7aa990f5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5c12b59bd81874f851587c08a83dd7932ebf9114", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c12b59bd81874f851587c08a83dd7932ebf9114", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5c12b59bd81874f851587c08a83dd7932ebf9114", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5c12b59bd81874f851587c08a83dd7932ebf9114/comments", "author": null, "committer": null, "parents": [{"sha": "02cba8dfe4e337517390a0763b3248ea1216b52b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/02cba8dfe4e337517390a0763b3248ea1216b52b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/02cba8dfe4e337517390a0763b3248ea1216b52b"}], "stats": {"total": 48, "additions": 46, "deletions": 2}, "files": [{"sha": "735d46cd920904f180bfe6f0fd5eb4d12a2acddc", "filename": "libjava/classpath/java/io/ObjectInputStream.java", "status": "modified", "additions": 12, "deletions": 1, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Fjava%2Fio%2FObjectInputStream.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Fjava%2Fio%2FObjectInputStream.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fjava%2Fio%2FObjectInputStream.java?ref=5c12b59bd81874f851587c08a83dd7932ebf9114", "patch": "@@ -223,6 +223,15 @@ private Object parseContent(byte marker)\n        case TC_PROXYCLASSDESC:\n  \t{\n  \t  if(dump) dumpElementln(\"PROXYCLASS\");\n+\n+/* GCJ LOCAL */\n+\t  // The grammar at this point is\n+\t  //   TC_PROXYCLASSDESC newHandle proxyClassDescInfo\n+\t  // i.e. we have to assign the handle immediately after\n+\t  // reading the marker.\n+ \t  int handle = assignNewHandle(\"Dummy proxy\");\n+/* END GCJ LOCAL */\n+\n  \t  int n_intf = this.realInputStream.readInt();\n  \t  String[] intfs = new String[n_intf];\n  \t  for (int i = 0; i < n_intf; i++)\n@@ -250,7 +259,9 @@ private Object parseContent(byte marker)\n                     new InternalError(\"Object ctor missing\").initCause(x);\n                 }\n             }\n- \t  assignNewHandle(osc);\n+/* GCJ LOCAL */\n+\t  rememberHandle(osc,handle);\n+/* END GCJ LOCAL */\n  \t  \n  \t  if (!is_consumed)\n  \t    {"}, {"sha": "316b9070133e2a43dd3c6e4f07613de2df211988", "filename": "libjava/classpath/java/io/ObjectOutputStream.java", "status": "modified", "additions": 7, "deletions": 1, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Fjava%2Fio%2FObjectOutputStream.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Fjava%2Fio%2FObjectOutputStream.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fjava%2Fio%2FObjectOutputStream.java?ref=5c12b59bd81874f851587c08a83dd7932ebf9114", "patch": "@@ -1211,11 +1211,17 @@ private void writeArraySizeAndElements(Object array, Class clazz)\n   }\n \n \n+/* GCJ LOCAL */\n   // writes out FIELDS of OBJECT for the specified ObjectStreamClass.\n-  // FIELDS are already in canonical order.\n+  // FIELDS are already supposed already to be in canonical order, but\n+  // under some circumstances (to do with Proxies) this isn't the\n+  // case, so we call ensureFieldsSet().\n   private void writeFields(Object obj, ObjectStreamClass osc)\n     throws IOException\n   {\n+    osc.ensureFieldsSet(osc.forClass());\n+/* END GCJ LOCAL */\n+\n     ObjectStreamField[] fields = osc.fields;\n     boolean oldmode = setBlockDataMode(false);\n "}, {"sha": "cc3d0a9e31fb1569ec19449f73ced3d8ace021a7", "filename": "libjava/classpath/java/io/ObjectStreamClass.java", "status": "modified", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Fjava%2Fio%2FObjectStreamClass.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Fjava%2Fio%2FObjectStreamClass.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Fjava%2Fio%2FObjectStreamClass.java?ref=5c12b59bd81874f851587c08a83dd7932ebf9114", "patch": "@@ -654,11 +654,29 @@ else if ((java.io.Serializable.class).isAssignableFrom(cl))\n       flags |= ObjectStreamConstants.SC_ENUM;\n   }\n \n+/* GCJ LOCAL */\n+  // FIXME: This is a workaround for a fairly obscure bug that happens\n+  // when reading a Proxy and then writing it back out again.  The\n+  // result is that the ObjectStreamClass doesn't have its fields set,\n+  // generating a NullPointerException.  Rather than this kludge we\n+  // should probably fix the real bug, but it would require a fairly\n+  // radical reorganization to do so.\n+  final void ensureFieldsSet(Class cl)\n+  {\n+    if (! fieldsSet)\n+      setFields(cl);\n+  }\n+/* END GCJ LOCAL */\n+\n \n   // Sets fields to be a sorted array of the serializable fields of\n   // clazz.\n   private void setFields(Class cl)\n   {\n+/* GCJ LOCAL */\n+    fieldsSet = true;\n+/* END GCJ LOCAL */\n+\n     SetAccessibleAction setAccessible = new SetAccessibleAction();\n \n     if (!isSerializable() || isExternalizable() || isEnum())\n@@ -1094,6 +1112,11 @@ public Object run()\n \n   boolean isProxyClass = false;\n \n+/* GCJ LOCAL */\n+  // True after setFields() has been called\n+  private boolean fieldsSet = false;\n+/* END GCJ LOCAL */\n+\n   // This is probably not necessary because this class is special cased already\n   // but it will avoid showing up as a discrepancy when comparing SUIDs.\n   private static final long serialVersionUID = -6120832682080437368L;"}, {"sha": "d800fe4c61d425187a9d1caac2f51477c5d2e81a", "filename": "libjava/classpath/lib/java/io/ObjectInputStream$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%241.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%241.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%241.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "d723177725c828bd873f929073761f53be7bf5c4", "filename": "libjava/classpath/lib/java/io/ObjectInputStream$2.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%242.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%242.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%242.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "e93a33030a2f62eaf462018f4fd5500ea5e6d326", "filename": "libjava/classpath/lib/java/io/ObjectInputStream$GetField.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%24GetField.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%24GetField.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%24GetField.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "06cec269ed18cc18f4b4e3236efc3729ef612db5", "filename": "libjava/classpath/lib/java/io/ObjectInputStream$ValidatorAndPriority.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%24ValidatorAndPriority.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%24ValidatorAndPriority.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream%24ValidatorAndPriority.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "2c61cc687cf63b91fa3fd45084302800fa268f84", "filename": "libjava/classpath/lib/java/io/ObjectInputStream.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectInputStream.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "472096945b063da8c49924abb64228101cc5bc63", "filename": "libjava/classpath/lib/java/io/ObjectOutputStream.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectOutputStream.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectOutputStream.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectOutputStream.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "8b3cbb0f527ff186adc409617f1441e4a9a75e44", "filename": "libjava/classpath/lib/java/io/ObjectStreamClass$1.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%241.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%241.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%241.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "18a1c61b270db176067cc88f7a0805ddc4fbb4fb", "filename": "libjava/classpath/lib/java/io/ObjectStreamClass$2.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%242.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%242.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%242.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "babf58570decf555bc0073e700f8a2098a072af6", "filename": "libjava/classpath/lib/java/io/ObjectStreamClass$InterfaceComparator.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%24InterfaceComparator.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%24InterfaceComparator.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%24InterfaceComparator.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "527fd88ab9f57e8c50d5a7e9e79242bd411e91f1", "filename": "libjava/classpath/lib/java/io/ObjectStreamClass$MemberComparator.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%24MemberComparator.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%24MemberComparator.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass%24MemberComparator.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "da622eb8947befb44488a48fbd237aad79bc2c9f", "filename": "libjava/classpath/lib/java/io/ObjectStreamClass.class", "status": "modified", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass.class", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass.class", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fclasspath%2Flib%2Fjava%2Fio%2FObjectStreamClass.class?ref=5c12b59bd81874f851587c08a83dd7932ebf9114"}, {"sha": "34514534b8d9b28816dba0552b0aa1daa16f2089", "filename": "libjava/java/io/ObjectStreamClass.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fjava%2Fio%2FObjectStreamClass.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5c12b59bd81874f851587c08a83dd7932ebf9114/libjava%2Fjava%2Fio%2FObjectStreamClass.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FObjectStreamClass.h?ref=5c12b59bd81874f851587c08a83dd7932ebf9114", "patch": "@@ -57,6 +57,9 @@ class java::io::ObjectStreamClass : public ::java::lang::Object\n   void cacheMethods();\n   ObjectStreamClass(::java::lang::Class *);\n   void setFlags(::java::lang::Class *);\n+public: // actually package-private\n+  virtual void ensureFieldsSet(::java::lang::Class *);\n+private:\n   void setFields(::java::lang::Class *);\n   jlong getClassUID(::java::lang::Class *);\n public: // actually package-private\n@@ -105,6 +108,7 @@ class java::io::ObjectStreamClass : public ::java::lang::Object\n public: // actually package-private\n   jboolean isProxyClass;\n private:\n+  jboolean fieldsSet;\n   static const jlong serialVersionUID = -6120832682080437368LL;\n public:\n   static ::java::lang::Class class$;"}]}