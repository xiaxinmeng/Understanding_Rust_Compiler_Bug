{"sha": "63abe04999283582b258adf60da6c19d541ebc68", "node_id": "C_kwDOANBUbNoAKDYzYWJlMDQ5OTkyODM1ODJiMjU4YWRmNjBkYTZjMTlkNTQxZWJjNjg", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-01T11:59:32Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-01T13:21:38Z"}, "message": "Avoid unused sbitmap in update_ssa\n\nThe following avoids copying and using blocks_to_update to\nthe interesting_blocks sbitmap when doing update_ssa as it is\nunused besides the redundant query in the domwalk.\n\n\t* tree-into-ssa.cc (rewrite_update_dom_walker::before_dom_children):\n\tDo not look at interesting_blocks which is a copy of\n\tblocks_to_update.\n\t(update_ssa): Do not initialize it.\n\t(pass_build_ssa::execute): Set interesting_blocks to NULL\n\tafter releasing it.", "tree": {"sha": "0eee066ee69e860e9a21c6a0fec675839341b3d2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0eee066ee69e860e9a21c6a0fec675839341b3d2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63abe04999283582b258adf60da6c19d541ebc68", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63abe04999283582b258adf60da6c19d541ebc68", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63abe04999283582b258adf60da6c19d541ebc68", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63abe04999283582b258adf60da6c19d541ebc68/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2b0937946b19f0f4d91e6248a2806b1f98f5244b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b0937946b19f0f4d91e6248a2806b1f98f5244b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b0937946b19f0f4d91e6248a2806b1f98f5244b"}], "stats": {"total": 22, "additions": 6, "deletions": 16}, "files": [{"sha": "c90651c3a8901f5a8cb2de8c8c035ad1e9f18986", "filename": "gcc/tree-into-ssa.cc", "status": "modified", "additions": 6, "deletions": 16, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63abe04999283582b258adf60da6c19d541ebc68/gcc%2Ftree-into-ssa.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63abe04999283582b258adf60da6c19d541ebc68/gcc%2Ftree-into-ssa.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-into-ssa.cc?ref=63abe04999283582b258adf60da6c19d541ebc68", "patch": "@@ -2214,15 +2214,11 @@ rewrite_update_dom_walker::before_dom_children (basic_block bb)\n     }\n \n   /* Step 2.  Rewrite every variable used in each statement in the block.  */\n-  if (bitmap_bit_p (interesting_blocks, bb->index))\n-    {\n-      gcc_checking_assert (bitmap_bit_p (blocks_to_update, bb->index));\n-      for (gimple_stmt_iterator gsi = gsi_start_bb (bb); !gsi_end_p (gsi); )\n-\tif (rewrite_update_stmt (gsi_stmt (gsi), gsi))\n-\t  gsi_remove (&gsi, true);\n-\telse\n-\t  gsi_next (&gsi);\n-    }\n+  for (gimple_stmt_iterator gsi = gsi_start_bb (bb); !gsi_end_p (gsi); )\n+    if (rewrite_update_stmt (gsi_stmt (gsi), gsi))\n+      gsi_remove (&gsi, true);\n+    else\n+      gsi_next (&gsi);\n \n   /* Step 3.  Update PHI nodes.  */\n   rewrite_update_phi_arguments (bb);\n@@ -2460,6 +2456,7 @@ pass_build_ssa::execute (function *fun)\n   free (dfs);\n \n   sbitmap_free (interesting_blocks);\n+  interesting_blocks = NULL;\n \n   fini_ssa_renamer ();\n \n@@ -3503,15 +3500,8 @@ update_ssa (unsigned update_flags)\n     get_var_info (sym)->info.current_def = NULL_TREE;\n \n   /* Now start the renaming process at START_BB.  */\n-  interesting_blocks = sbitmap_alloc (last_basic_block_for_fn (cfun));\n-  bitmap_clear (interesting_blocks);\n-  EXECUTE_IF_SET_IN_BITMAP (blocks_to_update, 0, i, bi)\n-    bitmap_set_bit (interesting_blocks, i);\n-\n   rewrite_blocks (start_bb, REWRITE_UPDATE);\n \n-  sbitmap_free (interesting_blocks);\n-\n   /* Debugging dumps.  */\n   if (dump_file)\n     {"}]}