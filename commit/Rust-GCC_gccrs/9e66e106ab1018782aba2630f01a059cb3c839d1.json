{"sha": "9e66e106ab1018782aba2630f01a059cb3c839d1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWU2NmUxMDZhYjEwMTg3ODJhYmEyNjMwZjAxYTA1OWNiM2M4MzlkMQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2012-02-08T13:27:31Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2012-02-08T13:27:31Z"}, "message": "re PR gcov-profile/52150 (junk at end of line in Firefox PGO build)\n\n\tPR gcov-profile/52150\n\t* coverage.c: Include target.h.\n\t(build_var): Call targetm.strip_name_encoding on the assembler name.\n\tChange one _ into . or $ if the target allows it.\n\t* Makefile.in (coverage.o): Depend on $(TARGET_H).\n\n\t* gcc.dg/tree-prof/pr52150.c: New test.\n\nFrom-SVN: r184006", "tree": {"sha": "555df8dabc4c9d0caf61c53fd5283f58d15974f5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/555df8dabc4c9d0caf61c53fd5283f58d15974f5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e66e106ab1018782aba2630f01a059cb3c839d1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e66e106ab1018782aba2630f01a059cb3c839d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e66e106ab1018782aba2630f01a059cb3c839d1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e66e106ab1018782aba2630f01a059cb3c839d1/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bd73623c908777daae42b70ee841e9c84fa7b9b4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bd73623c908777daae42b70ee841e9c84fa7b9b4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bd73623c908777daae42b70ee841e9c84fa7b9b4"}], "stats": {"total": 50, "additions": 44, "deletions": 6}, "files": [{"sha": "fcea3cfb7fea0f19bc11bd7941c57a264bfbeba3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9e66e106ab1018782aba2630f01a059cb3c839d1", "patch": "@@ -1,5 +1,11 @@\n 2012-02-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR gcov-profile/52150\n+\t* coverage.c: Include target.h.\n+\t(build_var): Call targetm.strip_name_encoding on the assembler name.\n+\tChange one _ into . or $ if the target allows it.\n+\t* Makefile.in (coverage.o): Depend on $(TARGET_H).\n+\n \tPR rtl-optimization/52139\n \t* cfgrtl.c (cfg_layout_merge_blocks): If BB_END\n \tis a BARRIER after emit_insn_after_noloc, move BB_END"}, {"sha": "770925f2b366a00ad26031abb6d262619c077b75", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=9e66e106ab1018782aba2630f01a059cb3c839d1", "patch": "@@ -3002,7 +3002,7 @@ coverage.o : coverage.c $(GCOV_IO_H) $(CONFIG_H) $(SYSTEM_H) coretypes.h \\\n    $(TM_H) $(RTL_H) $(TREE_H) $(FLAGS_H) output.h $(REGS_H) $(EXPR_H) \\\n    $(FUNCTION_H) $(BASIC_BLOCK_H) toplev.h $(DIAGNOSTIC_CORE_H) $(GGC_H) langhooks.h $(COVERAGE_H) \\\n    $(HASHTAB_H) tree-iterator.h $(CGRAPH_H) $(TREE_PASS_H) gcov-io.c $(TM_P_H) \\\n-   $(DIAGNOSTIC_CORE_H) intl.h gt-coverage.h\n+   $(DIAGNOSTIC_CORE_H) intl.h gt-coverage.h $(TARGET_H)\n cselib.o : cselib.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) $(RTL_H) \\\n    $(REGS_H) hard-reg-set.h $(FLAGS_H) insn-config.h $(RECOG_H) \\\n    $(EMIT_RTL_H) $(DIAGNOSTIC_CORE_H) output.h $(FUNCTION_H) $(TREE_PASS_H) \\"}, {"sha": "ce8b175d2f72a23dbf2a66aabb9daca749dffd40", "filename": "gcc/coverage.c", "status": "modified", "additions": 18, "deletions": 5, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2Fcoverage.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2Fcoverage.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcoverage.c?ref=9e66e106ab1018782aba2630f01a059cb3c839d1", "patch": "@@ -1,6 +1,6 @@\n /* Read and write coverage files, and associated functionality.\n    Copyright (C) 1990, 1991, 1992, 1993, 1994, 1996, 1997, 1998, 1999,\n-   2000, 2001, 2003, 2004, 2005, 2007, 2008, 2009, 2010, 2011\n+   2000, 2001, 2003, 2004, 2005, 2007, 2008, 2009, 2010, 2011, 2012\n    Free Software Foundation, Inc.\n    Contributed by James E. Wilson, UC Berkeley/Cygnus Support;\n    based on some ideas from Dain Samples of UC Berkeley.\n@@ -50,6 +50,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"diagnostic-core.h\"\n #include \"intl.h\"\n #include \"filenames.h\"\n+#include \"target.h\"\n \n #include \"gcov-io.h\"\n #include \"gcov-io.c\"\n@@ -656,13 +657,25 @@ static tree\n build_var (tree fn_decl, tree type, int counter)\n {\n   tree var = build_decl (BUILTINS_LOCATION, VAR_DECL, NULL_TREE, type);\n-  tree fn_name = DECL_ASSEMBLER_NAME (fn_decl);\n-  char *buf = (char *)alloca (IDENTIFIER_LENGTH (fn_name) + 10);\n+  const char *fn_name = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (fn_decl));\n+  char *buf;\n+  size_t fn_name_len, len;\n+\n+  fn_name = targetm.strip_name_encoding (fn_name);\n+  fn_name_len = strlen (fn_name);\n+  buf = XALLOCAVEC (char, fn_name_len + 8 + sizeof (int) * 3);\n \n   if (counter < 0)\n-    sprintf (buf, \"__gcov__%s\", IDENTIFIER_POINTER (fn_name));\n+    strcpy (buf, \"__gcov__\");\n   else\n-    sprintf (buf, \"__gcov%u_%s\", counter, IDENTIFIER_POINTER (fn_name));\n+    sprintf (buf, \"__gcov%u_\", counter);\n+  len = strlen (buf);\n+#ifndef NO_DOT_IN_LABEL\n+  buf[len - 1] = '.';\n+#elif !defined NO_DOLLAR_IN_LABEL\n+  buf[len - 1] = '$';\n+#endif\n+  memcpy (buf + len, fn_name, fn_name_len + 1);\n   DECL_NAME (var) = get_identifier (buf);\n   TREE_STATIC (var) = 1;\n   TREE_ADDRESSABLE (var) = 1;"}, {"sha": "6cedc9e1d09885a141637085bbf36f8cf9a69786", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9e66e106ab1018782aba2630f01a059cb3c839d1", "patch": "@@ -1,5 +1,8 @@\n 2012-02-08  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR gcov-profile/52150\n+\t* gcc.dg/tree-prof/pr52150.c: New test.\n+\n \tPR rtl-optimization/52139\n \t* gcc.dg/pr52139.c: New test.\n "}, {"sha": "accdb4a4ce0218315dcbcfaa043cd62c165a910f", "filename": "gcc/testsuite/gcc.dg/tree-prof/pr52150.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fpr52150.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e66e106ab1018782aba2630f01a059cb3c839d1/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fpr52150.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-prof%2Fpr52150.c?ref=9e66e106ab1018782aba2630f01a059cb3c839d1", "patch": "@@ -0,0 +1,16 @@\n+/* PR gcov-profile/52150 */\n+/* { dg-options \"-O0\" } */\n+\n+void foo () __asm__ (\"bar\");\n+\n+void\n+foo ()\n+{\n+}\n+\n+int\n+main ()\n+{\n+  foo ();\n+  return 0;\n+}"}]}