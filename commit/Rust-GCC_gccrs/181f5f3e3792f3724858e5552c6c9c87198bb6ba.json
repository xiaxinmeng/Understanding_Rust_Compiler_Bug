{"sha": "181f5f3e3792f3724858e5552c6c9c87198bb6ba", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTgxZjVmM2UzNzkyZjM3MjQ4NThlNTU1MmM2YzljODcxOThiYjZiYQ==", "commit": {"author": {"name": "Cong Hou", "email": "congh@google.com", "date": "2013-09-17T18:20:08Z"}, "committer": {"name": "Cong Hou", "email": "congh@gcc.gnu.org", "date": "2013-09-17T18:20:08Z"}, "message": "tree-vect-patterns.c (vect_recog_dot_prod_pattern): Fix a bug when checking the dot production pattern.\n\n2013-09-17  Cong Hou  <congh@google.com>\n\n    * tree-vect-patterns.c (vect_recog_dot_prod_pattern): Fix a bug\n      when checking the dot production pattern. The type of rhs operand\n      of multiply is now checked correctly.\n\n    * gcc.dg/vect/vect-reduc-dot-s16c.c: Add a test case with dot product \n      on two arrays with short and int types. This should not be recognized\n      as a dot product pattern.\n\nFrom-SVN: r202663", "tree": {"sha": "75fd528e1e86e10788fa4a4a6e084044adeff15f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/75fd528e1e86e10788fa4a4a6e084044adeff15f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/181f5f3e3792f3724858e5552c6c9c87198bb6ba", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/181f5f3e3792f3724858e5552c6c9c87198bb6ba", "html_url": "https://github.com/Rust-GCC/gccrs/commit/181f5f3e3792f3724858e5552c6c9c87198bb6ba", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/181f5f3e3792f3724858e5552c6c9c87198bb6ba/comments", "author": null, "committer": null, "parents": [{"sha": "783f0cfc8d973c147a5243d7312b85e7ea892e1c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/783f0cfc8d973c147a5243d7312b85e7ea892e1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/783f0cfc8d973c147a5243d7312b85e7ea892e1c"}], "stats": {"total": 87, "additions": 86, "deletions": 1}, "files": [{"sha": "0bb9263d442455e7d64b1aa15b2d4b622d530dad", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=181f5f3e3792f3724858e5552c6c9c87198bb6ba", "patch": "@@ -1,3 +1,9 @@\n+2013-09-17  Cong Hou  <congh@google.com>\n+\n+\t* tree-vect-patterns.c (vect_recog_dot_prod_pattern): Fix a bug\n+\twhen checking the dot production pattern. The type of rhs operand\n+\tof multiply is now checked correctly.\n+\n 2013-09-17  Jeff Law  <law@redhat.com>\n \n \t* tree-ssa-dom.c (cprop_into_successor_phis): Also propagate"}, {"sha": "796e14343c22827ff14dd30a4bb40f70bafc4de8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=181f5f3e3792f3724858e5552c6c9c87198bb6ba", "patch": "@@ -1,3 +1,9 @@\n+2013-09-17  Cong Hou  <congh@google.com>\n+\n+\t* gcc.dg/vect/vect-reduc-dot-s16c.c: Add a test case with dot product \n+\ton two arrays with short and int types. This should not be recognized\n+\tas a dot product pattern.\n+\n 2013-09-17  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/58435"}, {"sha": "8ba823b044c1ba1a1b57ebe0c3e82f0633b21749", "filename": "gcc/testsuite/gcc.dg/vect/vect-reduc-dot-s16c.c", "status": "added", "additions": 73, "deletions": 0, "changes": 73, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-reduc-dot-s16c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-reduc-dot-s16c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fvect-reduc-dot-s16c.c?ref=181f5f3e3792f3724858e5552c6c9c87198bb6ba", "patch": "@@ -0,0 +1,73 @@\n+/* { dg-require-effective-target vect_int } */\n+\n+#include <stdarg.h>\n+#include \"tree-vect.h\"\n+\n+#define N 64\n+#define DOT 43680\n+\n+signed short X[N] __attribute__ ((__aligned__(__BIGGEST_ALIGNMENT__)));\n+signed int   Y[N] __attribute__ ((__aligned__(__BIGGEST_ALIGNMENT__)));\n+\n+/* (short, int)->int->int dot product.\n+   Not detected as a dot-product pattern.  */\n+\n+__attribute__ ((noinline)) int\n+foo (int len)\n+{\n+  int i;\n+  int result = 0;\n+\n+  for (i = 0; i < len; i++)\n+    {\n+      result += (X[i] * Y[i]);\n+    }\n+  return result;\n+}\n+\n+\n+/* (int, short)->int->int dot product.\n+   Not detected as a dot-product pattern.  */\n+\n+__attribute__ ((noinline)) int\n+bar (int len)\n+{\n+  int i;\n+  int result = 0;\n+\n+  for (i = 0; i < len; i++)\n+    {\n+      result += (Y[i] * X[i]);\n+    }\n+  return result;\n+}\n+\n+int\n+main (void)\n+{\n+  int i;\n+  int dot;\n+\n+  check_vect ();\n+\n+  for (i = 0; i < N; i++)\n+    {\n+      X[i] = i;\n+      Y[i] = N - i;\n+      __asm__ volatile (\"\");\n+    }\n+\n+  dot = foo (N);\n+  if (dot != DOT)\n+    abort ();\n+\n+  dot = bar (N);\n+  if (dot != DOT)\n+    abort ();\n+\n+  return 0;\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"vectorized 1 loops\" 2 \"vect\" { target vect_unpack } } } */\n+/* { dg-final { cleanup-tree-dump \"vect\" } } */\n+"}, {"sha": "0a4e812fd823d574d6bc8a760185550cc11b19f9", "filename": "gcc/tree-vect-patterns.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2Ftree-vect-patterns.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/181f5f3e3792f3724858e5552c6c9c87198bb6ba/gcc%2Ftree-vect-patterns.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-patterns.c?ref=181f5f3e3792f3724858e5552c6c9c87198bb6ba", "patch": "@@ -397,7 +397,7 @@ vect_recog_dot_prod_pattern (vec<gimple> *stmts, tree *type_in,\n           || !promotion)\n         return NULL;\n       oprnd00 = gimple_assign_rhs1 (def_stmt);\n-      if (!type_conversion_p (oprnd0, stmt, true, &half_type1, &def_stmt,\n+      if (!type_conversion_p (oprnd1, stmt, true, &half_type1, &def_stmt,\n                                 &promotion)\n           || !promotion)\n         return NULL;"}]}