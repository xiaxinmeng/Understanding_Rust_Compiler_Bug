{"sha": "8f3b032e57ded80f6b773672b36def28b3e7ec50", "node_id": "C_kwDOANBUbNoAKDhmM2IwMzJlNTdkZWQ4MGY2Yjc3MzY3MmIzNmRlZjI4YjNlN2VjNTA", "commit": {"author": {"name": "Xianmiao Qu", "email": "cooper.qu@linux.alibaba.com", "date": "2023-01-10T13:48:15Z"}, "committer": {"name": "Xianmiao Qu", "email": "cooper.qu@linux.alibaba.com", "date": "2023-01-10T11:57:21Z"}, "message": "C-SKY: Fix patterns' condition for ck802 smart mode.\n\nCk802 smart mode should not be treated as ck801.\nIt do only allocate r0-r8 registers like ck801,\nbut support 32-bits intructions.\nThis bug will cause ICE when compiler pr43164.c for ck802 big-endian,\n/src/gcc/gcc/testsuite/gcc.c-torture/compile/pr43164.c:16:1: error: insn does not satisfy its constraints:\n(insn 48 28 30 2 (set (reg:SI 0 a0 [230])\n        (ior:SI (reg:SI 2 a2 [222])\n            (ashift:SI (const_int 1 [0x1])\n                (const_int 24 [0x18])))) \"/src/gcc/gcc/testsuite/gcc.c-torture/compile/pr43164.c\":15:10 224 {smart_bseti}\n     (expr_list:REG_DEAD (reg:SI 2 a2 [222])\n        (nil)))\n\ngcc/\n\t* config/csky/csky.md (smart_bseti): Change condition to CSKY_ISA_FEATURE (E1).\n\t(smart_bclri): Likewise.\n\t(fast_bseti): Change condition to CSKY_ISA_FEATURE (E2).\n\t(fast_bclri): Likewise.\n\t(fast_cmpnesi_i): Likewise.\n\t(*fast_cmpltsi_i): Likewise.\n\t(*fast_cmpgeusi_i): Likewise.", "tree": {"sha": "b791c08c34ef8267bafb0206f4d1c4bf7dadd64a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b791c08c34ef8267bafb0206f4d1c4bf7dadd64a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8f3b032e57ded80f6b773672b36def28b3e7ec50", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f3b032e57ded80f6b773672b36def28b3e7ec50", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f3b032e57ded80f6b773672b36def28b3e7ec50", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f3b032e57ded80f6b773672b36def28b3e7ec50/comments", "author": {"login": "Cooper-Qu", "id": 68842787, "node_id": "MDQ6VXNlcjY4ODQyNzg3", "avatar_url": "https://avatars.githubusercontent.com/u/68842787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cooper-Qu", "html_url": "https://github.com/Cooper-Qu", "followers_url": "https://api.github.com/users/Cooper-Qu/followers", "following_url": "https://api.github.com/users/Cooper-Qu/following{/other_user}", "gists_url": "https://api.github.com/users/Cooper-Qu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cooper-Qu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cooper-Qu/subscriptions", "organizations_url": "https://api.github.com/users/Cooper-Qu/orgs", "repos_url": "https://api.github.com/users/Cooper-Qu/repos", "events_url": "https://api.github.com/users/Cooper-Qu/events{/privacy}", "received_events_url": "https://api.github.com/users/Cooper-Qu/received_events", "type": "User", "site_admin": false}, "committer": {"login": "Cooper-Qu", "id": 68842787, "node_id": "MDQ6VXNlcjY4ODQyNzg3", "avatar_url": "https://avatars.githubusercontent.com/u/68842787?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Cooper-Qu", "html_url": "https://github.com/Cooper-Qu", "followers_url": "https://api.github.com/users/Cooper-Qu/followers", "following_url": "https://api.github.com/users/Cooper-Qu/following{/other_user}", "gists_url": "https://api.github.com/users/Cooper-Qu/gists{/gist_id}", "starred_url": "https://api.github.com/users/Cooper-Qu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Cooper-Qu/subscriptions", "organizations_url": "https://api.github.com/users/Cooper-Qu/orgs", "repos_url": "https://api.github.com/users/Cooper-Qu/repos", "events_url": "https://api.github.com/users/Cooper-Qu/events{/privacy}", "received_events_url": "https://api.github.com/users/Cooper-Qu/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b86703a050c61d0dc81410de707b078a27ce4732", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b86703a050c61d0dc81410de707b078a27ce4732", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b86703a050c61d0dc81410de707b078a27ce4732"}], "stats": {"total": 14, "additions": 7, "deletions": 7}, "files": [{"sha": "8fb832f9e75ee09da44c806697f3e6de34345a5f", "filename": "gcc/config/csky/csky.md", "status": "modified", "additions": 7, "deletions": 7, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8f3b032e57ded80f6b773672b36def28b3e7ec50/gcc%2Fconfig%2Fcsky%2Fcsky.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8f3b032e57ded80f6b773672b36def28b3e7ec50/gcc%2Fconfig%2Fcsky%2Fcsky.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fcsky%2Fcsky.md?ref=8f3b032e57ded80f6b773672b36def28b3e7ec50", "patch": "@@ -573,7 +573,7 @@\n \t(ior:SI (match_operand:SI 1 \"register_operand\"\t\"0\")\n \t\t(ashift:SI (const_int 1)\n \t\t\t   (match_operand:SI 2 \"csky_literal_K_operand\" \"K\"))))]\n-  \"TARGET_MINI_REGISTERS\"\n+  \"CSKY_ISA_FEATURE (E1)\"\n   \"bseti\\t%0, %2\"\n   [(set_attr \"length\" \"2\")])\n \n@@ -582,7 +582,7 @@\n \t(ior:SI (match_operand:SI 1 \"register_operand\"\t\"0,r\")\n \t\t(ashift:SI (const_int 1)\n \t\t\t   (match_operand:SI 2 \"csky_literal_K_operand\" \"K,K\"))))]\n-  \"!TARGET_MINI_REGISTERS\"\n+  \"CSKY_ISA_FEATURE (E2)\"\n   \"bseti\\t%0, %1, %2\"\n   [(set_attr \"length\" \"2,4\")])\n \n@@ -599,7 +599,7 @@\n \t(and:SI (match_operand:SI 1 \"register_operand\"\t\"0\")\n \t\t(not:SI (ashift:SI (const_int 1)\n \t\t\t\t   (match_operand:SI 2 \"csky_literal_K_operand\" \"K\")))))]\n-  \"TARGET_MINI_REGISTERS\"\n+  \"CSKY_ISA_FEATURE (E1)\"\n   \"bclri\\t%0, %2\"\n   [(set_attr \"length\" \"2\")])\n \n@@ -608,7 +608,7 @@\n \t(and:SI (match_operand:SI 1 \"register_operand\"\t\"0,r\")\n \t\t(not:SI (ashift:SI (const_int 1)\n \t\t\t\t   (match_operand:SI 2 \"csky_literal_K_operand\" \"K,K\")))))]\n-  \"!TARGET_MINI_REGISTERS\"\n+  \"CSKY_ISA_FEATURE (E2)\"\n   \"bclri\\t%0, %1, %2\"\n   [(set_attr \"length\" \"2,4\")])\n \n@@ -3014,7 +3014,7 @@\n   [(set (reg:CC CSKY_CC_REGNUM)\n \t(ne:CC (match_operand:SI 0 \"register_operand\"\t    \"r\")\n \t       (match_operand:SI 1 \"csky_literal_I_operand\" \"I\")))]\n-  \"!TARGET_MINI_REGISTERS && CSKY_ISA_FEATURE (E2)\"\n+  \"CSKY_ISA_FEATURE (E2)\"\n   \"cmpnei\\t%0, %1\"\n   [(set_attr \"type\" \"cmp\")]\n )\n@@ -3056,7 +3056,7 @@\n   [(set (reg:CC CSKY_CC_REGNUM)\n \t(lt:CC (match_operand:SI 0 \"register_operand\"\t     \"a,r\")\n \t       (match_operand:SI 1 \"csky_literal_Uk_operand\" \"J,Uk\")))]\n-  \"!TARGET_MINI_REGISTERS && CSKY_ISA_FEATURE (E2)\"\n+  \"CSKY_ISA_FEATURE (E2)\"\n   \"cmplti\\t%0, %1\"\n   [(set_attr \"length\" \"2,4\")\n    (set_attr \"type\" \"cmp\")]\n@@ -3149,7 +3149,7 @@\n   [(set (reg:CC CSKY_CC_REGNUM)\n \t(geu:CC (match_operand:SI 0 \"register_operand\"\t      \"a,r\")\n \t\t(match_operand:SI 1 \"csky_literal_Uk_operand\" \"J,Uk\")))]\n-  \"!TARGET_MINI_REGISTERS && CSKY_ISA_FEATURE (E2)\"\n+  \"CSKY_ISA_FEATURE (E2)\"\n   \"cmphsi\\t%0, %1\"\n   [(set_attr \"length\" \"2,4\")\n    (set_attr \"type\" \"cmp\")]"}]}