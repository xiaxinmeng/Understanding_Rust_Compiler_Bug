{"sha": "3e66d096990519fcf0408a3bfc5b92e7d32b6462", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2U2NmQwOTY5OTA1MTlmY2YwNDA4YTNiZmM1YjkyZTdkMzJiNjQ2Mg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-02-02T12:23:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-02-02T12:23:18Z"}, "message": "re PR c++/30536 (ICE with __thread and register)\n\n\tPR c++/30536\n\t* decl.c (grokdeclarator): If __thread is used together with\n\ta storage class other than extern and static, clear thread_p\n\tafter issuing diagnostics and fall through to checking the\n\tstorage class.\n\n\t* g++.dg/tls/diag-5.C: New test.\n\nFrom-SVN: r121496", "tree": {"sha": "c51466cf854f17a26d8cffbec0e8ce95194d1e31", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c51466cf854f17a26d8cffbec0e8ce95194d1e31"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3e66d096990519fcf0408a3bfc5b92e7d32b6462", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e66d096990519fcf0408a3bfc5b92e7d32b6462", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3e66d096990519fcf0408a3bfc5b92e7d32b6462", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3e66d096990519fcf0408a3bfc5b92e7d32b6462/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6b01cd54dd628d5f5b02c508032113d764759141", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b01cd54dd628d5f5b02c508032113d764759141", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b01cd54dd628d5f5b02c508032113d764759141"}], "stats": {"total": 34, "additions": 25, "deletions": 9}, "files": [{"sha": "47ac05fe867069b1a902d59af56d09b57b753b89", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=3e66d096990519fcf0408a3bfc5b92e7d32b6462", "patch": "@@ -1,3 +1,11 @@\n+2007-02-02  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/30536\n+\t* decl.c (grokdeclarator): If __thread is used together with\n+\ta storage class other than extern and static, clear thread_p\n+\tafter issuing diagnostics and fall through to checking the\n+\tstorage class.\n+\n 2007-01-30  Roger Sayle  <roger@eyesopen.com>\n \n \t* error.c (dump_type_suffix): Avoid use of cp_build_binary_op when"}, {"sha": "a98d902da93bb7db07567ec1af2a08ff33e4180a", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=3e66d096990519fcf0408a3bfc5b92e7d32b6462", "patch": "@@ -7470,20 +7470,20 @@ grokdeclarator (const cp_declarator *declarator,\n \n   /* Warn about storage classes that are invalid for certain\n      kinds of declarations (parameters, typenames, etc.).  */\n+  if (thread_p\n+      && ((storage_class\n+\t   && storage_class != sc_extern\n+\t   && storage_class != sc_static)\n+\t  || declspecs->specs[(int)ds_typedef]))\n+    {\n+      error (\"multiple storage classes in declaration of %qs\", name);\n+      thread_p = false;\n+    }\n   if (declspecs->conflicting_specifiers_p)\n     {\n       error (\"conflicting specifiers in declaration of %qs\", name);\n       storage_class = sc_none;\n     }\n-  else if (thread_p\n-\t   && ((storage_class\n-\t\t&& storage_class != sc_extern\n-\t\t&& storage_class != sc_static)\n-\t       || declspecs->specs[(int)ds_typedef]))\n-    {\n-      error (\"multiple storage classes in declaration of %qs\", name);\n-      thread_p = false;\n-    }\n   else if (decl_context != NORMAL\n \t   && ((storage_class != sc_none\n \t\t&& storage_class != sc_mutable)"}, {"sha": "1a4616814690f20e3cd2c2b6ea79c41e2a51fc90", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3e66d096990519fcf0408a3bfc5b92e7d32b6462", "patch": "@@ -1,5 +1,8 @@\n 2007-02-02  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/30536\n+\t* g++.dg/tls/diag-5.C: New test.\n+\n \tPR middle-end/30473\n \t* gcc.dg/pr30473.c: New test.\n \t* gcc.c-torture/execute/20070201-1.c: New test."}, {"sha": "ca92b3074288ae1ce4a425a0602798e510b74ca3", "filename": "gcc/testsuite/g++.dg/tls/diag-5.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fdiag-5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3e66d096990519fcf0408a3bfc5b92e7d32b6462/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fdiag-5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fdiag-5.C?ref=3e66d096990519fcf0408a3bfc5b92e7d32b6462", "patch": "@@ -0,0 +1,5 @@\n+// PR c++/30536\n+// Invalid __thread specifiers.\n+// { dg-require-effective-target tls }\n+\n+struct A { __thread register int i; }; // { dg-error \"multiple storage classes|storage class specified\" }"}]}