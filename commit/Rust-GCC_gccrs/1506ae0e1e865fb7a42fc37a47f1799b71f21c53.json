{"sha": "1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTUwNmFlMGUxZTg2NWZiN2E0MmZjMzdhNDdmMTc5OWI3MWYyMWM1Mw==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2015-01-23T12:53:55Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2015-01-23T12:53:55Z"}, "message": "Make fopenmp an LTO option\n\n2015-01-23  Tom de Vries  <tom@codesourcery.com>\n\n\tPR libgomp/64707\n\t* lto-opts.c (lto_write_options): Output non-explicit conservative\n\t-fno-openmp.\n\t* lto-wrapper.c (merge_and_complain): Handle merging -fopenmp.\n\t(append_compiler_options): Pass -fopenmp through.\n\n\t* c.opt (fopenmp): Mark as LTO option.\n\n\t* lang.opt (fopenmp): Mark as LTO option.\n\n\t* testsuite/libgomp.c/target-9.c: Add -ftree-parallelize-loops=0 to\n\tdg-options.\n\nFrom-SVN: r220037", "tree": {"sha": "dafdb0033bc707c4c0ea9f0a6378ea8944f76727", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dafdb0033bc707c4c0ea9f0a6378ea8944f76727"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/comments", "author": null, "committer": null, "parents": [{"sha": "10ef8f287e92cad2f6963a9ee25d954c87567629", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/10ef8f287e92cad2f6963a9ee25d954c87567629", "html_url": "https://github.com/Rust-GCC/gccrs/commit/10ef8f287e92cad2f6963a9ee25d954c87567629"}], "stats": {"total": 35, "additions": 32, "deletions": 3}, "files": [{"sha": "418468faf3874f3e16e6194cdffcc38b60e7caf7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -1,3 +1,11 @@\n+2015-01-23  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/64707\n+\t* lto-opts.c (lto_write_options): Output non-explicit conservative\n+\t-fno-openmp.\n+\t* lto-wrapper.c (merge_and_complain): Handle merging -fopenmp.\n+\t(append_compiler_options): Pass -fopenmp through.\n+\n 2015-01-23  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR debug/64511"}, {"sha": "ac72e8681576aeeb71d744b559cdd30e0295ed54", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -1,3 +1,8 @@\n+2015-01-23  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/64707\n+\t* c.opt (fopenmp): Mark as LTO option.\n+\n 2015-01-21  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/63307"}, {"sha": "4b92022187fa0f3b0ebad69e739c5d3945bf1ca6", "filename": "gcc/c-family/c.opt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Fc-family%2Fc.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Fc-family%2Fc.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc.opt?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -1288,7 +1288,7 @@ C ObjC C++ ObjC++ Var(flag_openacc)\n Enable OpenACC\n \n fopenmp\n-C ObjC C++ ObjC++ Var(flag_openmp)\n+C ObjC C++ ObjC++ LTO Var(flag_openmp)\n Enable OpenMP (implies -frecursive in Fortran)\n \n fopenmp-simd"}, {"sha": "5ae81b14a2bf1d4854ea7348a518318be447fffb", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -1,3 +1,7 @@\n+2015-01-23  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/64707\n+\t* lang.opt (fopenmp): Mark as LTO option.\n \n 2015-01-23  Andre Vehreschild  <vehre@gmx.de>\n "}, {"sha": "0360f6c7bad84abc50c8b632930a58a9dd4f0029", "filename": "gcc/fortran/lang.opt", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Ffortran%2Flang.opt", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Ffortran%2Flang.opt", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Flang.opt?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -571,7 +571,7 @@ Fortran\n ; Documented in C\n \n fopenmp\n-Fortran\n+Fortran LTO\n ; Documented in C\n \n fopenmp-simd"}, {"sha": "d44dba03935e39e8659015b2817d52937c3574c7", "filename": "gcc/lto-opts.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Flto-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Flto-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-opts.c?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -166,6 +166,10 @@ lto_write_options (void)\n     append_to_collect_gcc_options (&temporary_obstack, &first_p,\n \t\t\t       \"-fno-strict-overflow\");\n \n+  if (!global_options_set.x_flag_openmp\n+      && !global_options.x_flag_openmp)\n+    append_to_collect_gcc_options (&temporary_obstack, &first_p, \"-fno-openmp\");\n+\n   /* Append options from target hook and store them to offload_lto section.  */\n   if (lto_stream_offload_p)\n     {"}, {"sha": "2d0d451af86eb4cca1be758a49735621627d04e1", "filename": "gcc/lto-wrapper.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Flto-wrapper.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/gcc%2Flto-wrapper.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-wrapper.c?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -271,6 +271,7 @@ merge_and_complain (struct cl_decoded_option **decoded_options,\n \tcase OPT_fsigned_zeros:\n \tcase OPT_ftrapping_math:\n \tcase OPT_fwrapv:\n+\tcase OPT_fopenmp:\n \t  /* For selected options we can merge conservatively.  */\n \t  for (j = 0; j < *decoded_options_count; ++j)\n \t    if ((*decoded_options)[j].opt_index == foption->opt_index)\n@@ -490,6 +491,7 @@ append_compiler_options (obstack *argv_obstack, struct cl_decoded_option *opts,\n \tcase OPT_fsigned_zeros:\n \tcase OPT_ftrapping_math:\n \tcase OPT_fwrapv:\n+\tcase OPT_fopenmp:\n \tcase OPT_ftrapv:\n \tcase OPT_fstrict_overflow:\n \tcase OPT_foffload_abi_:"}, {"sha": "8c722d4e7bb3d846c93d72bc8efaa341ebf22110", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -1,3 +1,9 @@\n+2015-01-23  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR libgomp/64707\n+\t* testsuite/libgomp.c/target-9.c: Add -ftree-parallelize-loops=0 to\n+\tdg-options.\n+\n 2015-01-19  Thomas Schwinge  <thomas@codesourcery.com>\n \n \tPR libgomp/64625"}, {"sha": "4f3c812afd0d785910e4a4cbf644ad3c1f3415ca", "filename": "libgomp/testsuite/libgomp.c/target-9.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/libgomp%2Ftestsuite%2Flibgomp.c%2Ftarget-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1506ae0e1e865fb7a42fc37a47f1799b71f21c53/libgomp%2Ftestsuite%2Flibgomp.c%2Ftarget-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Ftarget-9.c?ref=1506ae0e1e865fb7a42fc37a47f1799b71f21c53", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do run } */\n-/* { dg-options \"-O1\" } */\n+/* { dg-options \"-O1 -ftree-parallelize-loops=0\" } */\n /* { dg-additional-options \"-flto\" { target lto } } */\n \n #include <stdlib.h>"}]}