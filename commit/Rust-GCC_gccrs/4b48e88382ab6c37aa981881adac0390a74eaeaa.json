{"sha": "4b48e88382ab6c37aa981881adac0390a74eaeaa", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGI0OGU4ODM4MmFiNmMzN2FhOTgxODgxYWRhYzAzOTBhNzRlYWVhYQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-03-08T08:35:20Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-03-08T08:35:20Z"}, "message": "re PR target/79904 (ICE in annotate_constant_pool_refs, at config/s390/s390.c:7909)\n\n\tPR sanitizer/79904\n\t* internal-fn.c (expand_vector_ubsan_overflow): If arg0 or arg1\n\tis a uniform vector, use uniform_vector_p return value instead of\n\tbuilding ARRAY_REF on folded VIEW_CONVERT_EXPR to array type.\n\n\t* gcc.dg/ubsan/pr79904.c: New test.\n\nFrom-SVN: r245967", "tree": {"sha": "1684a0b26430d0e91a14dc71ed9c8ca1af76db4e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1684a0b26430d0e91a14dc71ed9c8ca1af76db4e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b48e88382ab6c37aa981881adac0390a74eaeaa", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b48e88382ab6c37aa981881adac0390a74eaeaa", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b48e88382ab6c37aa981881adac0390a74eaeaa", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b48e88382ab6c37aa981881adac0390a74eaeaa/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e90223fe94aee2d3a357f64fcf96f12e10750c03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e90223fe94aee2d3a357f64fcf96f12e10750c03", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e90223fe94aee2d3a357f64fcf96f12e10750c03"}], "stats": {"total": 43, "additions": 37, "deletions": 6}, "files": [{"sha": "fcca6aa4cc3000d7f1c513107746030a484de392", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4b48e88382ab6c37aa981881adac0390a74eaeaa", "patch": "@@ -1,3 +1,10 @@\n+2017-03-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/79904\n+\t* internal-fn.c (expand_vector_ubsan_overflow): If arg0 or arg1\n+\tis a uniform vector, use uniform_vector_p return value instead of\n+\tbuilding ARRAY_REF on folded VIEW_CONVERT_EXPR to array type.\n+\n 2017-03-07  Marek Polacek  <polacek@redhat.com>\n \n \tPR middle-end/79809"}, {"sha": "df7b930e801f1ab63e207f237b3e5851f9a09837", "filename": "gcc/internal-fn.c", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2Finternal-fn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2Finternal-fn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Finternal-fn.c?ref=4b48e88382ab6c37aa981881adac0390a74eaeaa", "patch": "@@ -1869,12 +1869,20 @@ expand_vector_ubsan_overflow (location_t loc, enum tree_code code, tree lhs,\n       if (cnt > 4)\n \t{\n \t  tree atype = build_array_type_nelts (eltype, cnt);\n-\t  op0 = fold_build1_loc (loc, VIEW_CONVERT_EXPR, atype, arg0);\n-\t  op0 = build4_loc (loc, ARRAY_REF, eltype, op0, cntv,\n-\t\t\t    NULL_TREE, NULL_TREE);\n-\t  op1 = fold_build1_loc (loc, VIEW_CONVERT_EXPR, atype, arg1);\n-\t  op1 = build4_loc (loc, ARRAY_REF, eltype, op1, cntv,\n-\t\t\t    NULL_TREE, NULL_TREE);\n+\t  op0 = uniform_vector_p (arg0);\n+\t  if (op0 == NULL_TREE)\n+\t    {\n+\t      op0 = fold_build1_loc (loc, VIEW_CONVERT_EXPR, atype, arg0);\n+\t      op0 = build4_loc (loc, ARRAY_REF, eltype, op0, cntv,\n+\t\t\t\tNULL_TREE, NULL_TREE);\n+\t    }\n+\t  op1 = uniform_vector_p (arg1);\n+\t  if (op1 == NULL_TREE)\n+\t    {\n+\t      op1 = fold_build1_loc (loc, VIEW_CONVERT_EXPR, atype, arg1);\n+\t      op1 = build4_loc (loc, ARRAY_REF, eltype, op1, cntv,\n+\t\t\t\tNULL_TREE, NULL_TREE);\n+\t    }\n \t  if (resv)\n \t    {\n \t      res = fold_build1_loc (loc, VIEW_CONVERT_EXPR, atype, resv);"}, {"sha": "f2fd40e876deedc8475d45e75ebe41000f44b934", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4b48e88382ab6c37aa981881adac0390a74eaeaa", "patch": "@@ -1,3 +1,8 @@\n+2017-03-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/79904\n+\t* gcc.dg/ubsan/pr79904.c: New test.\n+\n 2017-03-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/79834"}, {"sha": "af8166930a923e3b39a22b71c305283c6ed157a6", "filename": "gcc/testsuite/gcc.dg/ubsan/pr79904.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr79904.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b48e88382ab6c37aa981881adac0390a74eaeaa/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr79904.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fubsan%2Fpr79904.c?ref=4b48e88382ab6c37aa981881adac0390a74eaeaa", "patch": "@@ -0,0 +1,11 @@\n+/* PR sanitizer/79904 */\n+/* { dg-do compile } */\n+/* { dg-options \"-fsanitize=signed-integer-overflow -Wno-psabi\" } */\n+\n+typedef signed char V __attribute__((vector_size (8))); \n+\n+void\n+foo (V *a) \n+{ \n+  *a = *a * 3; \n+}"}]}