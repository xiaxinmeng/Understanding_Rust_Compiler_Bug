{"sha": "28aaf32b33ea405541244abc64852be4391648ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjhhYWYzMmIzM2VhNDA1NTQxMjQ0YWJjNjQ4NTJiZTQzOTE2NDhlZA==", "commit": {"author": {"name": "Jason Merrill", "email": "merrill@gnu.org", "date": "1995-02-23T01:23:53Z"}, "committer": {"name": "Jason Merrill", "email": "merrill@gnu.org", "date": "1995-02-23T01:23:53Z"}, "message": "Update SunOS 4 code\n\nFrom-SVN: r9041", "tree": {"sha": "b3bdb1c79bbd8f5a78edf815bd4fba1c59d0531b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b3bdb1c79bbd8f5a78edf815bd4fba1c59d0531b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/28aaf32b33ea405541244abc64852be4391648ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28aaf32b33ea405541244abc64852be4391648ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/28aaf32b33ea405541244abc64852be4391648ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/28aaf32b33ea405541244abc64852be4391648ed/comments", "author": null, "committer": null, "parents": [{"sha": "49be3a59ffe45fc39c93135a7a1473c40130080b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49be3a59ffe45fc39c93135a7a1473c40130080b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49be3a59ffe45fc39c93135a7a1473c40130080b"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "960f969de2c7af570057c358d040c2f9e9028612", "filename": "gcc/collect2.c", "status": "modified", "additions": 43, "deletions": 2, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/28aaf32b33ea405541244abc64852be4391648ed/gcc%2Fcollect2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/28aaf32b33ea405541244abc64852be4391648ed/gcc%2Fcollect2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcollect2.c?ref=28aaf32b33ea405541244abc64852be4391648ed", "patch": "@@ -1839,6 +1839,7 @@ scan_prog_file (prog_name, which_pass)\n #include <sys/mman.h>\n #include <sys/param.h>\n #include <sys/unistd.h>\n+#include <sys/dir.h>\n \n /* pointers to the object file */\n unsigned object;    \t/* address of memory mapped file */\n@@ -1872,6 +1873,43 @@ mapfile (name)\n   close (fp);\n }\n \n+/* Helpers for locatelib.  */\n+\n+static char *libname;\n+\n+static int\n+libselect (d)\n+     struct direct *d;\n+{\n+  return (strncmp (libname, d->d_name, strlen (libname)) == 0);\n+}\n+\n+static int\n+libcompare (d1, d2)\n+     struct direct **d1, **d2;\n+{\n+  int i1, i2 = strlen (libname);\n+  char *e1 = (*d1)->d_name + i2;\n+  char *e2 = (*d2)->d_name + i2;\n+\n+  while (*e1 && *e2)\n+    {\n+      ++e1;\n+      ++e2;\n+      i1 = strtol (e1, &e1, 10);\n+      i2 = strtol (e2, &e2, 10);\n+      if (i1 != i2)\n+\treturn i1 - i2;\n+    }\n+\n+  if (*e1)\n+    return 1;\n+  else if (*e2)\n+    return -1;\n+  else\n+    return 0;\n+}\n+\n /* Given the name NAME of a dynamic dependency, find its pathname and add\n    it to the list of libraries.  */\n \n@@ -1941,11 +1979,14 @@ locatelib (name)\n       *pp++ = \"/usr/local/lib\";\n       *pp = 0;\n     }\n+  libname = name;\n   for (pp = l; *pp != 0 ; pp++)\n     {\n-      sprintf (buf, \"%s/%s\", *pp, name);\n-      if (access (buf, R_OK) == 0)\n+      struct direct **namelist;\n+      int entries;\n+      if ((entries = scandir (*pp, &namelist, libselect, libcompare)) > 0)\n \t{\n+\t  sprintf (buf, \"%s/%s\", *pp, namelist[entries - 1]->d_name);\n \t  add_to_list (&libraries, buf);\n \t  if (debug)\n \t    fprintf (stderr, \"%s\\n\", buf);"}]}