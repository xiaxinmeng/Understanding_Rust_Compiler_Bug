{"sha": "cfedf91bdca924f7ec8a558333d179351a794c2c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2ZlZGY5MWJkY2E5MjRmN2VjOGE1NTgzMzNkMTc5MzUxYTc5NGMyYw==", "commit": {"author": {"name": "Kazu Hirata", "email": "kazu@cs.umass.edu", "date": "2003-01-21T14:31:29Z"}, "committer": {"name": "Kazu Hirata", "email": "kazu@gcc.gnu.org", "date": "2003-01-21T14:31:29Z"}, "message": "h8300.c (output_plussi): Support H8/300.\n\n\t* config/h8300/h8300.c (output_plussi): Support H8/300.\n\t(compute_plussi_length): Likewise.\n\t(compute_plussi_cc): Likewise.\n\t* config/h8300/h8300.md (addsi_h8300): Use output_plussi to\n\toutput assembly instructions.\n\nFrom-SVN: r61546", "tree": {"sha": "0e79e578c5abe4a295d910025d933e510be02e39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e79e578c5abe4a295d910025d933e510be02e39"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cfedf91bdca924f7ec8a558333d179351a794c2c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfedf91bdca924f7ec8a558333d179351a794c2c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cfedf91bdca924f7ec8a558333d179351a794c2c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cfedf91bdca924f7ec8a558333d179351a794c2c/comments", "author": null, "committer": null, "parents": [{"sha": "1f5b3282d93e3c486e1316f76b40110d8dcdd17e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1f5b3282d93e3c486e1316f76b40110d8dcdd17e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1f5b3282d93e3c486e1316f76b40110d8dcdd17e"}], "stats": {"total": 57, "additions": 46, "deletions": 11}, "files": [{"sha": "596a5bacaff924f70fec64f1770dcc9c83647392", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfedf91bdca924f7ec8a558333d179351a794c2c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfedf91bdca924f7ec8a558333d179351a794c2c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=cfedf91bdca924f7ec8a558333d179351a794c2c", "patch": "@@ -1,3 +1,11 @@\n+2003-01-21  Kazu Hirata  <kazu@cs.umass.edu>\n+\n+\t* config/h8300/h8300.c (output_plussi): Support H8/300.\n+\t(compute_plussi_length): Likewise.\n+\t(compute_plussi_cc): Likewise.\n+\t* config/h8300/h8300.md (addsi_h8300): Use output_plussi to\n+\toutput assembly instructions.\n+\n 2003-01-21  Kaveh R. Ghazi  <ghazi@caip.rutgers.edu>\n \n \t* calls.c (fix_unsafe_tree): Prototype."}, {"sha": "ba1db09742378dc10d60c22feaa19e4a7ba65c11", "filename": "gcc/config/h8300/h8300.c", "status": "modified", "additions": 33, "deletions": 6, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfedf91bdca924f7ec8a558333d179351a794c2c/gcc%2Fconfig%2Fh8300%2Fh8300.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfedf91bdca924f7ec8a558333d179351a794c2c/gcc%2Fconfig%2Fh8300%2Fh8300.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fh8300.c?ref=cfedf91bdca924f7ec8a558333d179351a794c2c", "patch": "@@ -1900,8 +1900,22 @@ output_plussi (operands)\n \n   if (TARGET_H8300)\n     {\n-      /* Currently we do not support H8/300 here yet.  */\n-      abort ();\n+      if (GET_CODE (operands[2]) == REG)\n+\treturn \"add.w\\t%f2,%f0\\n\\taddx\\t%y2,%y0\\n\\taddx\\t%z2,%z0\";\n+\n+      if (GET_CODE (operands[2]) == CONST_INT)\n+\t{\n+\t  HOST_WIDE_INT n = INTVAL (operands[2]);\n+\n+\t  if ((n & 0xffffff) == 0)\n+\t    return \"add\\t%z2,%z0\";\n+\t  if ((n & 0xffff) == 0)\n+\t    return \"add\\t%y2,%y0\\n\\taddx\\t%z2,%z0\";\n+\t  if ((n & 0xff) == 0)\n+\t    return \"add\\t%x2,%x0\\n\\taddx\\t%y2,%y0\\n\\taddx\\t%z2,%z0\";\n+\t}\n+\n+      return \"add\\t%w2,%w0\\n\\taddx\\t%x2,%x0\\n\\taddx\\t%y2,%y0\\n\\taddx\\t%z2,%z0\";\n     }\n   else\n     {\n@@ -1960,8 +1974,22 @@ compute_plussi_length (operands)\n \n   if (TARGET_H8300)\n     {\n-      /* Currently we do not support H8/300 here yet.  */\n-      abort ();\n+      if (GET_CODE (operands[2]) == REG)\n+\treturn 6;\n+\n+      if (GET_CODE (operands[2]) == CONST_INT)\n+\t{\n+\t  HOST_WIDE_INT n = INTVAL (operands[2]);\n+\n+\t  if ((n & 0xffffff) == 0)\n+\t    return 2;\n+\t  if ((n & 0xffff) == 0)\n+\t    return 4;\n+\t  if ((n & 0xff) == 0)\n+\t    return 6;\n+\t}\n+\n+      return 8;\n     }\n   else\n     {\n@@ -2015,8 +2043,7 @@ compute_plussi_cc (operands)\n \n   if (TARGET_H8300)\n     {\n-      /* Currently we do not support H8/300 here yet.  */\n-      abort ();\n+      return CC_CLOBBER;\n     }\n   else\n     {"}, {"sha": "2ccbf04be0314b56945e6ee5648369927b88b0e8", "filename": "gcc/config/h8300/h8300.md", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cfedf91bdca924f7ec8a558333d179351a794c2c/gcc%2Fconfig%2Fh8300%2Fh8300.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cfedf91bdca924f7ec8a558333d179351a794c2c/gcc%2Fconfig%2Fh8300%2Fh8300.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fh8300%2Fh8300.md?ref=cfedf91bdca924f7ec8a558333d179351a794c2c", "patch": "@@ -859,11 +859,11 @@\n \t(plus:SI (match_operand:SI 1 \"register_operand\" \"%0,0\")\n \t\t (match_operand:SI 2 \"nonmemory_operand\" \"n,r\")))]\n   \"TARGET_H8300\"\n-  \"@\n-   add\t%w2,%w0\\;addx\t%x2,%x0\\;addx\t%y2,%y0\\;addx\t%z2,%z0\n-   add.w\t%f2,%f0\\;addx\t%y2,%y0\\;addx\t%z2,%z0\"\n-  [(set_attr \"length\" \"8,6\")\n-   (set_attr \"cc\" \"clobber,clobber\")])\n+  \"* return output_plussi (operands);\"\n+  [(set (attr \"length\")\n+\t(symbol_ref \"compute_plussi_length (operands)\"))\n+   (set (attr \"cc\")\n+\t(symbol_ref \"compute_plussi_cc (operands)\"))])\n \n (define_insn \"addsi_h8300h\"\n   [(set (match_operand:SI 0 \"register_operand\" \"=r,r\")"}]}