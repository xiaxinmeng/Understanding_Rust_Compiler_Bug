{"sha": "9e875fd864e1ddf636c015a35985bccf732b645a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWU4NzVmZDg2NGUxZGRmNjM2YzAxNWEzNTk4NWJjY2Y3MzJiNjQ1YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-11-10T10:31:34Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-11-10T10:31:34Z"}, "message": "re PR bootstrap/82916 (gcc miscompiled during stagefeedback (PGO bootstrap))\n\n\tPR bootstrap/82916\n\t* gimple-ssa-store-merging.c\n\t(pass_store_merging::terminate_all_aliasing_chains): For\n\tgimple_store_p stmts also call refs_output_dependent_p.\n\n\t* gcc.dg/store_merging_2.c: Only expect 2 successful mergings instead\n\tof 3.\n\t* gcc.dg/pr82916.c: New test.\n\nFrom-SVN: r254623", "tree": {"sha": "ac79b494ba41511f81d5483931023674f728e156", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ac79b494ba41511f81d5483931023674f728e156"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e875fd864e1ddf636c015a35985bccf732b645a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e875fd864e1ddf636c015a35985bccf732b645a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e875fd864e1ddf636c015a35985bccf732b645a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e875fd864e1ddf636c015a35985bccf732b645a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "db489777bb0185e64cf4b9b8c7afed4dcc6669bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/db489777bb0185e64cf4b9b8c7afed4dcc6669bd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/db489777bb0185e64cf4b9b8c7afed4dcc6669bd"}], "stats": {"total": 68, "additions": 65, "deletions": 3}, "files": [{"sha": "b82ce62fdff9f7a103a00071a499d56a5915deba", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9e875fd864e1ddf636c015a35985bccf732b645a", "patch": "@@ -1,5 +1,10 @@\n 2017-11-10  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR bootstrap/82916\n+\t* gimple-ssa-store-merging.c\n+\t(pass_store_merging::terminate_all_aliasing_chains): For\n+\tgimple_store_p stmts also call refs_output_dependent_p.\n+\n \tPR rtl-optimization/82913\n \t* compare-elim.c (try_merge_compare): Punt if def_insn is not\n \tsingle set."}, {"sha": "a5ee7aa3943c89091ae58feeca3d80034df79583", "filename": "gcc/gimple-ssa-store-merging.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Fgimple-ssa-store-merging.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Fgimple-ssa-store-merging.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-store-merging.c?ref=9e875fd864e1ddf636c015a35985bccf732b645a", "patch": "@@ -947,6 +947,7 @@ pass_store_merging::terminate_all_aliasing_chains (imm_store_chain_info\n   if (!gimple_vuse (stmt))\n     return false;\n \n+  tree store_lhs = gimple_store_p (stmt) ? gimple_get_lhs (stmt) : NULL_TREE;\n   for (imm_store_chain_info *next = m_stores_head, *cur = next; cur; cur = next)\n     {\n       next = cur->next;\n@@ -960,8 +961,10 @@ pass_store_merging::terminate_all_aliasing_chains (imm_store_chain_info\n       unsigned int i;\n       FOR_EACH_VEC_ELT (cur->m_store_info, i, info)\n \t{\n-\t  if (ref_maybe_used_by_stmt_p (stmt, gimple_assign_lhs (info->stmt))\n-\t      || stmt_may_clobber_ref_p (stmt, gimple_assign_lhs (info->stmt)))\n+\t  tree lhs = gimple_assign_lhs (info->stmt);\n+\t  if (ref_maybe_used_by_stmt_p (stmt, lhs)\n+\t      || stmt_may_clobber_ref_p (stmt, lhs)\n+\t      || (store_lhs && refs_output_dependent_p (store_lhs, lhs)))\n \t    {\n \t      if (dump_file && (dump_flags & TDF_DETAILS))\n \t\t{"}, {"sha": "a543e4fa404d6d8f72f23089ac977596748a37f9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9e875fd864e1ddf636c015a35985bccf732b645a", "patch": "@@ -1,3 +1,10 @@\n+2017-11-10  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR bootstrap/82916\n+\t* gcc.dg/store_merging_2.c: Only expect 2 successful mergings instead\n+\tof 3.\n+\t* gcc.dg/pr82916.c: New test.\n+\n 2017-11-10  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \t* lib/scanasm.exp (scan-assembler): Extract filename from testname used"}, {"sha": "50e467f32447f1b71b07d7eff9d62f42dd40a50b", "filename": "gcc/testsuite/gcc.dg/pr82916.c", "status": "added", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr82916.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Ftestsuite%2Fgcc.dg%2Fpr82916.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr82916.c?ref=9e875fd864e1ddf636c015a35985bccf732b645a", "patch": "@@ -0,0 +1,47 @@\n+/* PR bootstrap/82916 */\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -fno-tree-dse\" } */\n+\n+struct A { struct A *next; };\n+struct C\n+{\n+  int *of;\n+  struct C *parent, *prev, *next;\n+  int depth;\n+  int min;\n+  struct C *min_occ;\n+};\n+\n+__attribute__((noipa)) struct C *\n+foo (int *node)\n+{\n+  struct A *p = __builtin_malloc (sizeof (struct C));\n+  if (!p)\n+    return 0;\n+  p->next = 0;\n+  /* Originally placement new.  */\n+  struct C *nw = (struct C *)(void *)p;\n+  nw->of = node;\n+  nw->parent = 0;\n+  nw->prev = 0;\n+  nw->next = 0;\n+  nw->depth = 0;\n+  nw->min_occ = nw;\n+  nw->min = 0;\n+  return nw;\n+}\n+\n+int\n+main ()\n+{\n+  int o;\n+  struct C *p = foo (&o);\n+  if (p)\n+    {\n+      if (p->of != &o || p->parent || p->prev || p->next || p->depth\n+\t  || p->min || p->min_occ != p)\n+\t__builtin_abort ();\n+    }\n+  __builtin_free (p);\n+  return 0;\n+}"}, {"sha": "8cd29f4243c15730224156ca4bb8dc233f615aef", "filename": "gcc/testsuite/gcc.dg/store_merging_2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e875fd864e1ddf636c015a35985bccf732b645a/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fstore_merging_2.c?ref=9e875fd864e1ddf636c015a35985bccf732b645a", "patch": "@@ -77,4 +77,4 @@ main (void)\n   return 0;\n }\n \n-/* { dg-final { scan-tree-dump-times \"Merging successful\" 3 \"store-merging\" } } */\n+/* { dg-final { scan-tree-dump-times \"Merging successful\" 2 \"store-merging\" } } */"}]}