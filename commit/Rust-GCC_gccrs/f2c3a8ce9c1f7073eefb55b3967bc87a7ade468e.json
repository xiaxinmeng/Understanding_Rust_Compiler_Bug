{"sha": "f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjJjM2E4Y2U5YzFmNzA3M2VlZmI1NWIzOTY3YmM4N2E3YWRlNDY4ZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-07-05T18:43:04Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-07-05T18:43:04Z"}, "message": "re PR tree-optimization/49618 (When building uClibc with GCC 4.6.1 old_atexit is miscompiled)\n\n\tPR tree-optimization/49618\n\t* tree-eh.c (tree_could_trap_p) <case CALL_EXPR>: For DECL_WEAK\n\tt recurse on the decl.\n\t<case FUNCTION_DECL, case VAR_DECL>: For DECL_WEAK decls\n\treturn true if expr isn't known to be defined in current\n\tTU or some other LTO partition.\n\nFrom-SVN: r175884", "tree": {"sha": "2eeacbf76ccc11458581ff92eec25941410a3acf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2eeacbf76ccc11458581ff92eec25941410a3acf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "49bf9170ebead1c2575291cd08716ce970e5f35a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49bf9170ebead1c2575291cd08716ce970e5f35a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49bf9170ebead1c2575291cd08716ce970e5f35a"}], "stats": {"total": 45, "additions": 44, "deletions": 1}, "files": [{"sha": "d4d1c48036f17702ea57d5f96ac79a1692ac7179", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e", "patch": "@@ -1,3 +1,12 @@\n+2011-07-05  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR tree-optimization/49618\n+\t* tree-eh.c (tree_could_trap_p) <case CALL_EXPR>: For DECL_WEAK\n+\tt recurse on the decl.\n+\t<case FUNCTION_DECL, case VAR_DECL>: For DECL_WEAK decls\n+\treturn true if expr isn't known to be defined in current\n+\tTU or some other LTO partition.\n+\n 2011-07-05  Michael Meissner  <meissner@linux.vnet.ibm.com>\n \n \t* params.def (PARAM_CASE_VALUES_THRESHOLD): New parameter to"}, {"sha": "f10d72d1d68ae5fb73de5b6322296af840a2dce8", "filename": "gcc/tree-eh.c", "status": "modified", "additions": 35, "deletions": 1, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e/gcc%2Ftree-eh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e/gcc%2Ftree-eh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-eh.c?ref=f2c3a8ce9c1f7073eefb55b3967bc87a7ade468e", "patch": "@@ -2449,8 +2449,42 @@ tree_could_trap_p (tree expr)\n     case CALL_EXPR:\n       t = get_callee_fndecl (expr);\n       /* Assume that calls to weak functions may trap.  */\n-      if (!t || !DECL_P (t) || DECL_WEAK (t))\n+      if (!t || !DECL_P (t))\n \treturn true;\n+      if (DECL_WEAK (t))\n+\treturn tree_could_trap_p (t);\n+      return false;\n+\n+    case FUNCTION_DECL:\n+      /* Assume that accesses to weak functions may trap, unless we know\n+\t they are certainly defined in current TU or in some other\n+\t LTO partition.  */\n+      if (DECL_WEAK (expr))\n+\t{\n+\t  struct cgraph_node *node;\n+\t  if (!DECL_EXTERNAL (expr))\n+\t    return false;\n+\t  node = cgraph_function_node (cgraph_get_node (expr), NULL);\n+\t  if (node && node->in_other_partition)\n+\t    return false;\n+\t  return true;\n+\t}\n+      return false;\n+\n+    case VAR_DECL:\n+      /* Assume that accesses to weak vars may trap, unless we know\n+\t they are certainly defined in current TU or in some other\n+\t LTO partition.  */\n+      if (DECL_WEAK (expr))\n+\t{\n+\t  struct varpool_node *node;\n+\t  if (!DECL_EXTERNAL (expr))\n+\t    return false;\n+\t  node = varpool_variable_node (varpool_get_node (expr), NULL);\n+\t  if (node && node->in_other_partition)\n+\t    return false;\n+\t  return true;\n+\t}\n       return false;\n \n     default:"}]}