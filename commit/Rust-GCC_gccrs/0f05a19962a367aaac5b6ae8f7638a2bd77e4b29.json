{"sha": "0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGYwNWExOTk2MmEzNjdhYWFjNWI2YWU4Zjc2MzhhMmJkNzdlNGIyOQ==", "commit": {"author": {"name": "Max Ostapenko", "email": "m.ostapenko@partner.samsung.com", "date": "2014-07-07T14:31:18Z"}, "committer": {"name": "Maxim Ostapenko", "email": "chefmax@gcc.gnu.org", "date": "2014-07-07T14:31:18Z"}, "message": "Do not instrument first byte in strlen if already instrumented.\n\ngcc/\n\t* asan.c (instrument_strlen_call): Do not instrument first byte in strlen\n\tif already instrumented.\n\ngcc/testsuite/\n\t* c-c++-common/asan/no-redundant-instrumentation-9.c: New test.\n\nFrom-SVN: r212332", "tree": {"sha": "db570b973c519ea2a1d227f61cc00851a179b8e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db570b973c519ea2a1d227f61cc00851a179b8e7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/comments", "author": null, "committer": null, "parents": [{"sha": "625685bebb0c7dd8015ec5ec9cbfdfc857ab2267", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/625685bebb0c7dd8015ec5ec9cbfdfc857ab2267", "html_url": "https://github.com/Rust-GCC/gccrs/commit/625685bebb0c7dd8015ec5ec9cbfdfc857ab2267"}], "stats": {"total": 26, "additions": 25, "deletions": 1}, "files": [{"sha": "69cc4d2f7a14595e4eddc4a1ed2ed02bd9891ff5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "patch": "@@ -1,3 +1,8 @@\n+2014-06-24  Max Ostapenko  <m.ostapenko@partner.samsung.com>\n+\n+\t* asan.c (instrument_strlen_call): Do not instrument first byte in strlen\n+\tif already instrumented.\n+\n 2014-07-07  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n \n \t* config/arm/arm.opt (mwords-little-endian): Delete."}, {"sha": "20d78df5e15705472d1f6499c872b39489de72d5", "filename": "gcc/asan.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2Fasan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2Fasan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fasan.c?ref=0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "patch": "@@ -2026,6 +2026,7 @@ instrument_strlen_call (gimple_stmt_iterator *iter)\n \n   location_t loc = gimple_location (call);\n   tree str_arg = gimple_call_arg (call, 0);\n+  bool start_instrumented = has_mem_ref_been_instrumented (str_arg, 1);\n \n   tree cptr_type = build_pointer_type (char_type_node);\n   gimple str_arg_ssa =\n@@ -2037,7 +2038,8 @@ instrument_strlen_call (gimple_stmt_iterator *iter)\n \n   build_check_stmt (loc, gimple_assign_lhs (str_arg_ssa), NULL_TREE, 1, iter,\n \t\t    /*non_zero_len_p*/true, /*before_p=*/true,\n-\t\t    /*is_store=*/false, /*is_scalar_access*/true, /*align*/0);\n+\t\t    /*is_store=*/false, /*is_scalar_access*/true, /*align*/0,\n+\t\t    start_instrumented, start_instrumented);\n \n   gimple g =\n     gimple_build_assign_with_ops (POINTER_PLUS_EXPR,"}, {"sha": "fae51c2ffbe99de03a28df006334c69630e065da", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "patch": "@@ -1,3 +1,7 @@\n+2014-06-24  Max Ostapenko  <m.ostapenko@partner.samsung.com>\n+\n+\t* c-c++-common/asan/no-redundant-instrumentation-9.c: New test.\n+\n 2014-07-07  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/58898"}, {"sha": "c6575ad0b9495c885eb8dc5f021c54661648f95f", "filename": "gcc/testsuite/c-c++-common/asan/no-redundant-instrumentation-9.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fno-redundant-instrumentation-9.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0f05a19962a367aaac5b6ae8f7638a2bd77e4b29/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fno-redundant-instrumentation-9.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fno-redundant-instrumentation-9.c?ref=0f05a19962a367aaac5b6ae8f7638a2bd77e4b29", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-options \"-fdump-tree-asan0\" } */\n+/* { dg-do compile } */\n+/* { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-O0\" } } */\n+\n+__SIZE_TYPE__\n+f (char *a)\n+{\n+  a[0] = '1';\n+  return  __builtin_strlen (a);\n+}\n+\n+/* { dg-final { scan-tree-dump-times \"__asan_report_load1\" 1 \"asan0\" } } */\n+/* { dg-final { cleanup-tree-dump \"asan0\" } } */"}]}