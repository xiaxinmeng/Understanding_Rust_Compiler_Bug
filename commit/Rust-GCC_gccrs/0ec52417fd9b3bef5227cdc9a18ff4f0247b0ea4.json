{"sha": "0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGVjNTI0MTdmZDliM2JlZjUyMjdjZGM5YTE4ZmY0ZjAyNDdiMGVhNA==", "commit": {"author": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-05-15T14:40:34Z"}, "committer": {"name": "Tobias Burnus", "email": "tobias@codesourcery.com", "date": "2020-05-15T14:40:34Z"}, "message": "[Fortran] OpenMP 5 \u2013 permit more sharing clauses for SIMD (PR94690)\n\ngcc/fortran/\n\tPR fortran/94690\n\t* openmp.c (resolve_omp_do): Permit more clauses for SIMD\n\titeration variables.\n\ngcc/testsuite/\n\tPR fortran/94690\n\t* gfortran.dg/gomp/openmp-simd-4.f90: New test.", "tree": {"sha": "77a2a73d7b426707efb9f5599b33067155ab798a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/77a2a73d7b426707efb9f5599b33067155ab798a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "75514d157e9e28616c6de4e8c2740d8c87b6857d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75514d157e9e28616c6de4e8c2740d8c87b6857d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75514d157e9e28616c6de4e8c2740d8c87b6857d"}], "stats": {"total": 93, "additions": 82, "deletions": 11}, "files": [{"sha": "143402260c2c3b61a0acc11e11a212bc1dce58d8", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "patch": "@@ -1,3 +1,9 @@\n+2020-05-15  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/94690\n+\t* openmp.c (resolve_omp_do): Permit more clauses for SIMD\n+\titeration variables.\n+\n 2020-05-14  Jakub Jelinek  <jakub@redhat.com>\n \n \t* trans-openmp.c: Include function.h."}, {"sha": "b24630827c9e4cca007ba5aa75dca4361f19269a", "filename": "gcc/fortran/openmp.c", "status": "modified", "additions": 6, "deletions": 11, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ffortran%2Fopenmp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ffortran%2Fopenmp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fopenmp.c?ref=0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "patch": "@@ -5847,26 +5847,21 @@ resolve_omp_do (gfc_code *code)\n \t\t   \"at %L\", name, &do_code->loc);\n       if (code->ext.omp_clauses)\n \tfor (list = 0; list < OMP_LIST_NUM; list++)\n-\t  if (!is_simd\n+\t  if (!is_simd || code->ext.omp_clauses->collapse > 1\n \t      ? (list != OMP_LIST_PRIVATE && list != OMP_LIST_LASTPRIVATE)\n-\t      : code->ext.omp_clauses->collapse > 1\n-\t      ? (list != OMP_LIST_LASTPRIVATE)\n-\t      : (list != OMP_LIST_LINEAR))\n+\t      : (list != OMP_LIST_PRIVATE && list != OMP_LIST_LASTPRIVATE\n+\t\t && list != OMP_LIST_LINEAR))\n \t    for (n = code->ext.omp_clauses->lists[list]; n; n = n->next)\n \t      if (dovar == n->sym)\n \t\t{\n-\t\t  if (!is_simd)\n+\t\t  if (!is_simd || code->ext.omp_clauses->collapse > 1)\n \t\t    gfc_error (\"%s iteration variable present on clause \"\n \t\t\t       \"other than PRIVATE or LASTPRIVATE at %L\",\n \t\t\t       name, &do_code->loc);\n-\t\t  else if (code->ext.omp_clauses->collapse > 1)\n-\t\t    gfc_error (\"%s iteration variable present on clause \"\n-\t\t\t       \"other than LASTPRIVATE at %L\",\n-\t\t\t       name, &do_code->loc);\n \t\t  else\n \t\t    gfc_error (\"%s iteration variable present on clause \"\n-\t\t\t       \"other than LINEAR at %L\",\n-\t\t\t       name, &do_code->loc);\n+\t\t\t       \"other than PRIVATE, LASTPRIVATE or \"\n+\t\t\t       \"LINEAR at %L\", name, &do_code->loc);\n \t\t  break;\n \t\t}\n       if (i > 1)"}, {"sha": "61b2f9e71dbab3a6236cffbe5012e6a2c48e2701", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "patch": "@@ -1,3 +1,8 @@\n+2020-05-15  Tobias Burnus  <tobias@codesourcery.com>\n+\n+\tPR fortran/94690\n+\t* gfortran.dg/gomp/openmp-simd-4.f90: New test.\n+\n 2020-05-15  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/95133"}, {"sha": "4a17fb9820e59e13cbbf69151d8e78d5f377f519", "filename": "gcc/testsuite/gfortran.dg/gomp/openmp-simd-4.f90", "status": "added", "additions": 65, "deletions": 0, "changes": 65, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fopenmp-simd-4.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fopenmp-simd-4.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgomp%2Fopenmp-simd-4.f90?ref=0ec52417fd9b3bef5227cdc9a18ff4f0247b0ea4", "patch": "@@ -0,0 +1,65 @@\n+! { dg-do compile }\n+\n+integer :: i, j, k\n+integer :: x(5), y(2,5)\n+\n+!$omp parallel do private(i)\n+do i = 1, 5\n+  x(i) = 42\n+end do\n+\n+!$omp parallel do lastprivate(i)\n+do i = 1, 5\n+  x(i) = 42\n+end do\n+\n+\n+!$omp simd private(i)\n+do i = 1, 5\n+  x(i) = 42\n+end do\n+\n+!$omp simd linear(i)\n+do i = 1, 5\n+  x(i) = 42\n+end do\n+\n+!$omp simd lastprivate(i)\n+do i = 1, 5\n+  x(i) = 42\n+end do\n+\n+\n+!$omp simd private(i) lastprivate(j) collapse(2)\n+do i = 1, 5\n+  do j = 1, 2\n+    y(j, i) = 52\n+  end do\n+end do\n+\n+!$omp simd lastprivate(i) private(j) collapse(2)\n+do i = 1, 5\n+  do j = 1, 2\n+    y(j, i) = 52\n+  end do\n+end do\n+\n+!$omp parallel do firstprivate(i)\n+do i = 1, 5  ! { dg-error \"PARALLEL DO iteration variable present on clause other than PRIVATE or LASTPRIVATE\" }\n+  x(i) = 42\n+end do\n+\n+!$omp parallel do simd firstprivate(i)\n+do i = 1, 5  ! { dg-error \"PARALLEL DO SIMD iteration variable present on clause other than PRIVATE, LASTPRIVATE or LINEAR\" }\n+  x(i) = 42\n+end do\n+\n+!$omp simd linear(i) collapse(2)\n+do i = 1, 5  ! { dg-error \"SIMD iteration variable present on clause other than PRIVATE or LASTPRIVATE\" }\n+  do j = 1, 2\n+    y(j, i) = 52\n+  end do\n+end do\n+\n+\n+end"}]}