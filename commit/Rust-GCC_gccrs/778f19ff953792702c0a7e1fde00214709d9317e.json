{"sha": "778f19ff953792702c0a7e1fde00214709d9317e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzc4ZjE5ZmY5NTM3OTI3MDJjMGE3ZTFmZGUwMDIxNDcwOWQ5MzE3ZQ==", "commit": {"author": {"name": "Sudi Das", "email": "sudi.das@arm.com", "date": "2020-09-18T15:30:11Z"}, "committer": {"name": "Omar Tahir", "email": "omar.tahir@arm.com", "date": "2020-09-18T16:04:37Z"}, "message": "[PATCH 3/5][Arm] New pattern for CSINC instructions\n\nThis patch adds a new pattern, *thumb2_csinc, for generating CSINC\ninstructions. It also modifies an existing pattern, *thumb2_cond_arith, to\noutput CINC when the operation is an addition and TARGET_COND_ARITH is true.\n\ngcc/ChangeLog:\n\n\t* config/arm/thumb2.md (*thumb2_csinc): New.\n\t(*thumb2_cond_arith): Generate CINC where possible.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/arm/csinc-1.c: New test.\n\nCo-authored-by: Omar Tahir <omar.tahir@arm.com>", "tree": {"sha": "c290b5dd4f036105dd3cfe60ea7a61b075af22c7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c290b5dd4f036105dd3cfe60ea7a61b075af22c7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/778f19ff953792702c0a7e1fde00214709d9317e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/778f19ff953792702c0a7e1fde00214709d9317e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/778f19ff953792702c0a7e1fde00214709d9317e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/778f19ff953792702c0a7e1fde00214709d9317e/comments", "author": {"login": "sudakshina-das-arm", "id": 28538945, "node_id": "MDQ6VXNlcjI4NTM4OTQ1", "avatar_url": "https://avatars.githubusercontent.com/u/28538945?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sudakshina-das-arm", "html_url": "https://github.com/sudakshina-das-arm", "followers_url": "https://api.github.com/users/sudakshina-das-arm/followers", "following_url": "https://api.github.com/users/sudakshina-das-arm/following{/other_user}", "gists_url": "https://api.github.com/users/sudakshina-das-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/sudakshina-das-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sudakshina-das-arm/subscriptions", "organizations_url": "https://api.github.com/users/sudakshina-das-arm/orgs", "repos_url": "https://api.github.com/users/sudakshina-das-arm/repos", "events_url": "https://api.github.com/users/sudakshina-das-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/sudakshina-das-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c2bb84be4a6e581bbf45891457ee632a07416982", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c2bb84be4a6e581bbf45891457ee632a07416982", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c2bb84be4a6e581bbf45891457ee632a07416982"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "0ff5a537f8f3bce3120c2598acaf46fd968bfbd2", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/778f19ff953792702c0a7e1fde00214709d9317e/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/778f19ff953792702c0a7e1fde00214709d9317e/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=778f19ff953792702c0a7e1fde00214709d9317e", "patch": "@@ -744,6 +744,10 @@\n       return \\\"%i5\\\\t%0, %1, %2, lsr #31\\\";\n \n     output_asm_insn (\\\"cmp\\\\t%2, %3\\\", operands);\n+\n+    if (GET_CODE (operands[5]) == PLUS && TARGET_COND_ARITH)\n+      return \\\"cinc\\\\t%0, %1, %d4\\\";\n+\n     if (GET_CODE (operands[5]) == AND)\n       {\n \toutput_asm_insn (\\\"ite\\\\t%D4\\\", operands);\n@@ -952,6 +956,21 @@\n    (set_attr \"predicable\" \"no\")]\n )\n \n+(define_insn \"*thumb2_csinc\"\n+  [(set (match_operand:SI 0 \"arm_general_register_operand\" \"=r, r\")\n+        (if_then_else:SI\n+         (match_operand 1 \"arm_comparison_operation\" \"\")\n+         (plus:SI (match_operand:SI 2 \"arm_general_register_operand\" \"r, r\")\n+                  (const_int 1))\n+         (match_operand:SI 3 \"reg_or_zero_operand\" \"r, Pz\")))]\n+  \"TARGET_COND_ARITH\"\n+  \"@\n+   csinc\\\\t%0, %3, %2, %D1\n+   csinc\\\\t%0, zr, %2, %D1\"\n+  [(set_attr \"type\" \"csel\")\n+   (set_attr \"predicable\" \"no\")]\n+)\n+\n (define_insn \"*thumb2_movcond\"\n   [(set (match_operand:SI 0 \"s_register_operand\" \"=Ts,Ts,Ts\")\n \t(if_then_else:SI"}, {"sha": "b9928493862c44d17f058736448d73369f8bf3b2", "filename": "gcc/testsuite/gcc.target/arm/csinc-1.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/778f19ff953792702c0a7e1fde00214709d9317e/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcsinc-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/778f19ff953792702c0a7e1fde00214709d9317e/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcsinc-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcsinc-1.c?ref=778f19ff953792702c0a7e1fde00214709d9317e", "patch": "@@ -0,0 +1,23 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_arch_v8_1m_main_ok } */\n+/* { dg-options \"-O2 -march=armv8.1-m.main\" } */\n+\n+int\n+test_csinc32_condasn1(int w0, int w1, int w2, int w3)\n+{\n+  int w4;\n+\n+  /* { dg-final { scan-assembler \"csinc\\tr\\[0-9\\]*.*ne\" } } */\n+  w4 = (w0 == w1) ? (w2 + 1) : w3;\n+  return w4;\n+}\n+\n+int\n+test_csinc32_condasn2(int w0, int w1, int w2, int w3)\n+{\n+  int w4;\n+\n+  /* { dg-final { scan-assembler \"csinc\\tr\\[0-9\\]*.*eq\" } } */\n+  w4 = (w0 == w1) ? w3 : (w2 + 1);\n+  return w4;\n+}"}]}