{"sha": "c17707f1d1d23a434065e94d44221c44d5faf303", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzE3NzA3ZjFkMWQyM2E0MzQwNjVlOTRkNDQyMjFjNDRkNWZhZjMwMw==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2002-12-01T02:11:05Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2002-12-01T02:11:05Z"}, "message": "re PR c++/8214 (character conversion problem)\n\n\tPR c++/8214\n\t* g++.dg/init/string1.C: New test.\n\n\tPR c++/8214\n\t* typeck.c (convert_for_assignment): Do not use\n\tdecl_constant_value on the operand.\n\nFrom-SVN: r59668", "tree": {"sha": "bc3c86a00bd620357711015c94ea2da7682bb0cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bc3c86a00bd620357711015c94ea2da7682bb0cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c17707f1d1d23a434065e94d44221c44d5faf303", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c17707f1d1d23a434065e94d44221c44d5faf303", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c17707f1d1d23a434065e94d44221c44d5faf303", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c17707f1d1d23a434065e94d44221c44d5faf303/comments", "author": null, "committer": null, "parents": [{"sha": "65f8b0fbafee3584579c96a9a0efc27ff6ea4519", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65f8b0fbafee3584579c96a9a0efc27ff6ea4519", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65f8b0fbafee3584579c96a9a0efc27ff6ea4519"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "87cfabee95d313c72bce6bb2ca32ea797fa4f672", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=c17707f1d1d23a434065e94d44221c44d5faf303", "patch": "@@ -1,3 +1,9 @@\n+2002-11-30  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/8214\n+\t* typeck.c (convert_for_assignment): Do not use\n+\tdecl_constant_value on the operand.\n+\n 2002-11-30  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/8511"}, {"sha": "6a0ec18f0c16aa6e886ab0226750882d1f220589", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=c17707f1d1d23a434065e94d44221c44d5faf303", "patch": "@@ -5859,8 +5859,16 @@ convert_for_assignment (type, rhs, errtype, fndecl, parmnum)\n   /* Simplify the RHS if possible.  */\n   if (TREE_CODE (rhs) == CONST_DECL)\n     rhs = DECL_INITIAL (rhs);\n-  else if (coder != ARRAY_TYPE)\n-    rhs = decl_constant_value (rhs);\n+  \n+  /* We do not use decl_constant_value here because of this case:\n+\n+       const char* const s = \"s\";\n+ \n+     The conversion rules for a string literal are more lax than for a\n+     variable; in particular, a string literal can be converted to a\n+     \"char *\" but the variable \"s\" cannot be converted in the same\n+     way.  If the conversion is allowed, the optimization should be\n+     performed while creating the converted expression.  */\n \n   /* [expr.ass]\n "}, {"sha": "1ac64f5847b83836c4b24c65ddbb41d0c3303979", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c17707f1d1d23a434065e94d44221c44d5faf303", "patch": "@@ -1,3 +1,8 @@\n+2002-11-30  Mark Mitchell  <mark@codesourcery.com>\n+\n+\tPR c++/8214\n+\t* g++.dg/init/string1.C: New test.\n+\n 2002-11-30  Mark Mitchell  <mark@codesourcery.com>\n \n \tPR c++/8511"}, {"sha": "597b8619e723c619da975b8d9926a9e7b43f473e", "filename": "gcc/testsuite/g++.dg/init/string1.C", "status": "added", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fstring1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c17707f1d1d23a434065e94d44221c44d5faf303/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fstring1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fstring1.C?ref=c17707f1d1d23a434065e94d44221c44d5faf303", "patch": "@@ -0,0 +1,8 @@\n+extern void f (char*);\n+\n+extern const char * const target = \"foo\";\n+\n+void g ()\n+{\n+  f (target); // { dg-error \"conversion\" }\n+}"}]}