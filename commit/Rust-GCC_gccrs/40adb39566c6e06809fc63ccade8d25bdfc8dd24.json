{"sha": "40adb39566c6e06809fc63ccade8d25bdfc8dd24", "node_id": "C_kwDOANBUbNoAKDQwYWRiMzk1NjZjNmUwNjgwOWZjNjNjY2FkZThkMjViZGZjOGRkMjQ", "commit": {"author": {"name": "Bj\u00f6rn Sch\u00e4pers", "email": "bjoern@hazardy.de", "date": "2022-11-30T12:04:16Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-12-02T00:17:42Z"}, "message": "libstdc++: Add error handler for <stacktrace>\n\nNot providing an error handler results in a null pointer dereference\nwhen an error occurs.\n\nCo-authored-by: Jonathan Wakely <jwakely@redhat.com>\n\nlibstdc++-v3/ChangeLog:\n\n\t* include/std/stacktrace (stacktrace_entry::_S_err_handler): New\n\tstatic function.\n\t(stacktrace_entry, basic_stacktrace): Pass &_S_err_handler to\n\tall calls to libbacktrace.", "tree": {"sha": "278b79a066864a3dd80caf1ba7e48bf6593321d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/278b79a066864a3dd80caf1ba7e48bf6593321d1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/40adb39566c6e06809fc63ccade8d25bdfc8dd24", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40adb39566c6e06809fc63ccade8d25bdfc8dd24", "html_url": "https://github.com/Rust-GCC/gccrs/commit/40adb39566c6e06809fc63ccade8d25bdfc8dd24", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/40adb39566c6e06809fc63ccade8d25bdfc8dd24/comments", "author": {"login": "HazardyKnusperkeks", "id": 17547773, "node_id": "MDQ6VXNlcjE3NTQ3Nzcz", "avatar_url": "https://avatars.githubusercontent.com/u/17547773?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HazardyKnusperkeks", "html_url": "https://github.com/HazardyKnusperkeks", "followers_url": "https://api.github.com/users/HazardyKnusperkeks/followers", "following_url": "https://api.github.com/users/HazardyKnusperkeks/following{/other_user}", "gists_url": "https://api.github.com/users/HazardyKnusperkeks/gists{/gist_id}", "starred_url": "https://api.github.com/users/HazardyKnusperkeks/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HazardyKnusperkeks/subscriptions", "organizations_url": "https://api.github.com/users/HazardyKnusperkeks/orgs", "repos_url": "https://api.github.com/users/HazardyKnusperkeks/repos", "events_url": "https://api.github.com/users/HazardyKnusperkeks/events{/privacy}", "received_events_url": "https://api.github.com/users/HazardyKnusperkeks/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "de144fdab17dbbb64ccb540056ab78b4ffb3fbbc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de144fdab17dbbb64ccb540056ab78b4ffb3fbbc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de144fdab17dbbb64ccb540056ab78b4ffb3fbbc"}], "stats": {"total": 19, "additions": 12, "deletions": 7}, "files": [{"sha": "ec3335e89d819d0aca1cfee46e67a7bcf7aa9119", "filename": "libstdc++-v3/include/std/stacktrace", "status": "modified", "additions": 12, "deletions": 7, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/40adb39566c6e06809fc63ccade8d25bdfc8dd24/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstacktrace", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/40adb39566c6e06809fc63ccade8d25bdfc8dd24/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstacktrace", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fstacktrace?ref=40adb39566c6e06809fc63ccade8d25bdfc8dd24", "patch": "@@ -155,11 +155,13 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \n     template<typename _Allocator> friend class basic_stacktrace;\n \n+    static void _S_err_handler(void*, const char*, int) { }\n+\n     static __glibcxx_backtrace_state*\n     _S_init()\n     {\n       static __glibcxx_backtrace_state* __state\n-\t= __glibcxx_backtrace_create_state(nullptr, 1, nullptr, nullptr);\n+\t= __glibcxx_backtrace_create_state(nullptr, 1, _S_err_handler, nullptr);\n       return __state;\n     }\n \n@@ -192,7 +194,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  return __function != nullptr;\n       };\n       const auto __state = _S_init();\n-      if (::__glibcxx_backtrace_pcinfo(__state, _M_pc, +__cb, nullptr, &__data))\n+      if (::__glibcxx_backtrace_pcinfo(__state, _M_pc, +__cb, _S_err_handler,\n+\t\t\t\t       &__data))\n \treturn true;\n       if (__desc && __desc->empty())\n \t{\n@@ -201,8 +204,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t      if (__symname)\n \t\t*static_cast<_Data*>(__data)->_M_desc = _S_demangle(__symname);\n \t  };\n-\t  if (::__glibcxx_backtrace_syminfo(__state, _M_pc, +__cb2, nullptr,\n-\t\t\t\t\t    &__data))\n+\t  if (::__glibcxx_backtrace_syminfo(__state, _M_pc, +__cb2,\n+\t\t\t\t\t    _S_err_handler, &__data))\n \t    return true;\n \t}\n       return false;\n@@ -252,7 +255,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \tif (auto __cb = __ret._M_prepare()) [[likely]]\n \t  {\n \t    auto __state = stacktrace_entry::_S_init();\n-\t    if (__glibcxx_backtrace_simple(__state, 1, __cb, nullptr,\n+\t    if (__glibcxx_backtrace_simple(__state, 1, __cb,\n+\t\t\t\t\t   stacktrace_entry::_S_err_handler,\n \t\t\t\t\t   std::__addressof(__ret)))\n \t      __ret._M_clear();\n \t  }\n@@ -270,7 +274,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \tif (auto __cb = __ret._M_prepare()) [[likely]]\n \t  {\n \t    auto __state = stacktrace_entry::_S_init();\n-\t    if (__glibcxx_backtrace_simple(__state, __skip + 1, __cb, nullptr,\n+\t    if (__glibcxx_backtrace_simple(__state, __skip + 1, __cb,\n+\t\t\t\t\t   stacktrace_entry::_S_err_handler,\n \t\t\t\t\t   std::__addressof(__ret)))\n \t      __ret._M_clear();\n \t  }\n@@ -294,7 +299,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t  {\n \t    auto __state = stacktrace_entry::_S_init();\n \t    int __err = __glibcxx_backtrace_simple(__state, __skip + 1, __cb,\n-\t\t\t\t\t\t   nullptr,\n+\t\t\t\t\t\t   stacktrace_entry::_S_err_handler,\n \t\t\t\t\t\t   std::__addressof(__ret));\n \t    if (__err < 0)\n \t      __ret._M_clear();"}]}