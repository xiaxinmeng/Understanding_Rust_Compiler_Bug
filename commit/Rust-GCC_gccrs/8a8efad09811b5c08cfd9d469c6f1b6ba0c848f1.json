{"sha": "8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGE4ZWZhZDA5ODExYjVjMDhjZmQ5ZDQ2OWM2ZjFiNmJhMGM4NDhmMQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-06-30T03:24:17Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-06-30T15:48:36Z"}, "message": "[testsuite] Replace fragile 'scan-assembler' with 'scan-offload-rtl' in 'libgomp.oacc-c-c++-common/pr85381*.c'\n\nThese test cases use directives similar to:\n\n    /* { dg-additional-options \"-save-temps\" } */\n\n    /* { dg-final { scan-assembler-times \"bar.sync\" 2 } } */\n\nThis expects to scan the PTX offloading compilation assembler code (not host\ncode!), expecting that nvptx offloading code assembly is produced after the\nhost code, and thus overwrites the latter file.  (Yes, that's certainly\nugly/fragile...)\n\n..., and this broke with recent commit 1dedc12d186a110854537e1279b4e6c29f2df35a\n\"revamp dump and aux output names\" plus fix-up commit commit\nefc16503ca10bc0e934e0bace5777500e4dc757a \"handle dumpbase in offloading, adjust\ntestsuite\" (short summary: file names changed), so let's finally make that\nrobust.\n\n\tlibgomp/\n\t* testsuite/libgomp.oacc-c-c++-common/pr85381-2.c: Replace fragile\n\t'scan-assembler' with 'scan-offload-rtl'.\n\t* testsuite/libgomp.oacc-c-c++-common/pr85381-3.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/pr85381-4.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/pr85381-5.c: Likewise.\n\t* testsuite/libgomp.oacc-c-c++-common/pr85381.c: Likewise.", "tree": {"sha": "517b43024cb75a1a159c5f20fc179f9099da3c36", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/517b43024cb75a1a159c5f20fc179f9099da3c36"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "aff43ac0aed5185884724adbdfd4dbbabd87637c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aff43ac0aed5185884724adbdfd4dbbabd87637c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aff43ac0aed5185884724adbdfd4dbbabd87637c"}], "stats": {"total": 20, "additions": 10, "deletions": 10}, "files": [{"sha": "84b9c01443e50df451f6dbf50f6a42ae90bfb1cb", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/pr85381-2.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-2.c?ref=8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "patch": "@@ -1,6 +1,6 @@\n-/* { dg-additional-options \"-save-temps\" } */\n /* { dg-do run { target openacc_nvidia_accel_selected } }\n    { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-O2\" } } */\n+/* { dg-additional-options \"-foffload=-fdump-rtl-mach\" } */\n \n int\n main (void)\n@@ -33,4 +33,4 @@ main (void)\n \n    so the loop is not recognized as empty loop (which we detect by seeing if\n    joining immediately follows forked).  */\n-/* { dg-final { scan-assembler-times \"bar.sync\" 2 } } */\n+/* { dg-final { scan-offload-rtl-dump-times \"nvptx_barsync\" 2 \"mach\" } } */"}, {"sha": "cddbf271906754a4944a1718d1fa143bf38c257f", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/pr85381-3.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-3.c?ref=8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "patch": "@@ -1,6 +1,6 @@\n-/* { dg-additional-options \"-save-temps -w\" } */\n /* { dg-do run { target openacc_nvidia_accel_selected } }\n    { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-O2\" } } */\n+/* { dg-additional-options \"-foffload=-fdump-rtl-mach\" } */\n \n int a;\n #pragma acc declare create(a)\n@@ -32,4 +32,4 @@ main (void)\n   return 0;\n }\n \n-/* { dg-final { scan-assembler-not \"bar.sync\" } } */\n+/* { dg-final { scan-offload-rtl-dump-not \"nvptx_barsync\" \"mach\" } } */"}, {"sha": "e1679444172c1343b503329a3eb777d8cb1e1b9f", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/pr85381-4.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-4.c?ref=8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "patch": "@@ -1,6 +1,6 @@\n-/* { dg-additional-options \"-save-temps -w\" } */\n /* { dg-do run { target openacc_nvidia_accel_selected } }\n    { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-O2\" } } */\n+/* { dg-additional-options \"-foffload=-fdump-rtl-mach\" } */\n \n #define n 1024\n \n@@ -24,4 +24,4 @@ main (void)\n /* Atm, %ntid.y is broadcast from one loop to the next, so there are 2 bar.syncs\n    for that (the other two are there for the same reason as in pr85381-2.c).\n    Todo: Recompute %ntid.y instead of broadcasting it. */\n-/* { dg-final { scan-assembler-times \"bar.sync\" 4 } } */\n+/* { dg-final { scan-offload-rtl-dump-times \"nvptx_barsync\" 4 \"mach\" } } */"}, {"sha": "26ca5093c47dd4ee77c3802fdd595761a9e3b2ba", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/pr85381-5.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381-5.c?ref=8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "patch": "@@ -1,6 +1,6 @@\n-/* { dg-additional-options \"-save-temps\" } */\n /* { dg-do run { target openacc_nvidia_accel_selected } }\n    { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-O2\" } } */\n+/* { dg-additional-options \"-foffload=-fdump-rtl-mach\" } */\n \n #define n 1024\n \n@@ -21,4 +21,4 @@ main (void)\n   return 0;\n }\n \n-/* { dg-final { scan-assembler-not \"bar.sync\" } } */\n+/* { dg-final { scan-offload-rtl-dump-not \"nvptx_barsync\" \"mach\" } } */"}, {"sha": "eda87743625b49e67524e164ad128fa7927996bb", "filename": "libgomp/testsuite/libgomp.oacc-c-c++-common/pr85381.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.oacc-c-c%2B%2B-common%2Fpr85381.c?ref=8a8efad09811b5c08cfd9d469c6f1b6ba0c848f1", "patch": "@@ -1,6 +1,6 @@\n-/* { dg-additional-options \"-save-temps\" } */\n /* { dg-do run { target openacc_nvidia_accel_selected } }\n    { dg-skip-if \"\" { *-*-* } { \"*\" } { \"-O2\" } } */\n+/* { dg-additional-options \"-foffload=-fdump-rtl-mach\" } */\n \n int\n main (void)\n@@ -15,4 +15,4 @@ main (void)\n   return 0;\n }\n \n-/* { dg-final { scan-assembler-not \"bar.sync\" } } */\n+/* { dg-final { scan-offload-rtl-dump-not \"nvptx_barsync\" \"mach\" } } */"}]}