{"sha": "96ddb7ec9868ac8367a29b3409816f73a8252e1c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTZkZGI3ZWM5ODY4YWM4MzY3YTI5YjM0MDk4MTZmNzNhODI1MmUxYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2013-12-03T07:44:37Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2013-12-03T07:44:37Z"}, "message": "re PR middle-end/59011 (ICE in make_decl_rtl, at varasm.c:1147)\n\n\tPR middle-end/59011\n\t* gimplify.c (nonlocal_vla_vars): New variable.\n\t(gimplify_var_or_parm_decl): Put VAR_DECLs for VLAs into\n\tnonlocal_vla_vars chain.\n\t(gimplify_body): Call declare_vars on nonlocal_vla_vars chain\n\tif outer_bind has DECL_INITIAL (current_function_decl) block.\n\n\t* gcc.dg/pr59011.c: New test.\n\nFrom-SVN: r205621", "tree": {"sha": "a09632315f458fb9ce1f1a3f3b036c01492b0a6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a09632315f458fb9ce1f1a3f3b036c01492b0a6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/96ddb7ec9868ac8367a29b3409816f73a8252e1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96ddb7ec9868ac8367a29b3409816f73a8252e1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/96ddb7ec9868ac8367a29b3409816f73a8252e1c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/96ddb7ec9868ac8367a29b3409816f73a8252e1c/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7f2f0a01cab6028542bdd57904a4147d17292d74", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f2f0a01cab6028542bdd57904a4147d17292d74", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f2f0a01cab6028542bdd57904a4147d17292d74"}], "stats": {"total": 57, "additions": 53, "deletions": 4}, "files": [{"sha": "1f006954e4febf0d92cb9df1e498cbc1f043f259", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=96ddb7ec9868ac8367a29b3409816f73a8252e1c", "patch": "@@ -1,5 +1,12 @@\n 2013-12-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/59011\n+\t* gimplify.c (nonlocal_vla_vars): New variable.\n+\t(gimplify_var_or_parm_decl): Put VAR_DECLs for VLAs into\n+\tnonlocal_vla_vars chain.\n+\t(gimplify_body): Call declare_vars on nonlocal_vla_vars chain\n+\tif outer_bind has DECL_INITIAL (current_function_decl) block.\n+\n \tPR target/58864\n \t* dojump.c (save_pending_stack_adjust, restore_pending_stack_adjust):\n \tNew functions."}, {"sha": "2e8c657acf767735acce71246d9ae42454294c8a", "filename": "gcc/gimplify.c", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=96ddb7ec9868ac8367a29b3409816f73a8252e1c", "patch": "@@ -1689,6 +1689,9 @@ gimplify_conversion (tree *expr_p)\n /* Nonlocal VLAs seen in the current function.  */\n static struct pointer_set_t *nonlocal_vlas;\n \n+/* The VAR_DECLs created for nonlocal VLAs for debug info purposes.  */\n+static tree nonlocal_vla_vars;\n+\n /* Gimplify a VAR_DECL or PARM_DECL.  Return GS_OK if we expanded a\n    DECL_VALUE_EXPR, and it's worth re-examining things.  */\n \n@@ -1737,14 +1740,13 @@ gimplify_var_or_parm_decl (tree *expr_p)\n \t    ctx = ctx->outer_context;\n \t  if (!ctx && !pointer_set_insert (nonlocal_vlas, decl))\n \t    {\n-\t      tree copy = copy_node (decl), block;\n+\t      tree copy = copy_node (decl);\n \n \t      lang_hooks.dup_lang_specific_decl (copy);\n \t      SET_DECL_RTL (copy, 0);\n \t      TREE_USED (copy) = 1;\n-\t      block = DECL_INITIAL (current_function_decl);\n-\t      DECL_CHAIN (copy) = BLOCK_VARS (block);\n-\t      BLOCK_VARS (block) = copy;\n+\t      DECL_CHAIN (copy) = nonlocal_vla_vars;\n+\t      nonlocal_vla_vars = copy;\n \t      SET_DECL_VALUE_EXPR (copy, unshare_expr (value_expr));\n \t      DECL_HAS_VALUE_EXPR_P (copy) = 1;\n \t    }\n@@ -8562,6 +8564,21 @@ gimplify_body (tree fndecl, bool do_parms)\n \n   if (nonlocal_vlas)\n     {\n+      if (nonlocal_vla_vars)\n+\t{\n+\t  /* tree-nested.c may later on call declare_vars (..., true);\n+\t     which relies on BLOCK_VARS chain to be the tail of the\n+\t     gimple_bind_vars chain.  Ensure we don't violate that\n+\t     assumption.  */\n+\t  if (gimple_bind_block (outer_bind)\n+\t      == DECL_INITIAL (current_function_decl))\n+\t    declare_vars (nonlocal_vla_vars, outer_bind, true);\n+\t  else\n+\t    BLOCK_VARS (DECL_INITIAL (current_function_decl))\n+\t      = chainon (BLOCK_VARS (DECL_INITIAL (current_function_decl)),\n+\t\t\t nonlocal_vla_vars);\n+\t  nonlocal_vla_vars = NULL_TREE;\n+\t}\n       pointer_set_destroy (nonlocal_vlas);\n       nonlocal_vlas = NULL;\n     }"}, {"sha": "fe6f94bade384f8c96551196941936dbfeaf9697", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=96ddb7ec9868ac8367a29b3409816f73a8252e1c", "patch": "@@ -1,5 +1,8 @@\n 2013-12-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/59011\n+\t* gcc.dg/pr59011.c: New test.\n+\n \tPR target/58864\n \t* g++.dg/opt/pr58864.C: New test.\n "}, {"sha": "2fb8187ad55212c0e30559b2a0790b9a6c26abad", "filename": "gcc/testsuite/gcc.dg/pr59011.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2Ftestsuite%2Fgcc.dg%2Fpr59011.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/96ddb7ec9868ac8367a29b3409816f73a8252e1c/gcc%2Ftestsuite%2Fgcc.dg%2Fpr59011.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr59011.c?ref=96ddb7ec9868ac8367a29b3409816f73a8252e1c", "patch": "@@ -0,0 +1,22 @@\n+/* PR middle-end/59011 */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu99\" } */\n+\n+void\n+foo (int m)\n+{\n+  int a[m];\n+  void\n+  bar (void)\n+  {\n+    {\n+      int\n+      baz (void)\n+      {\n+\treturn a[0];\n+      }\n+    }\n+    a[0] = 42;\n+  }\n+  bar ();\n+}"}]}