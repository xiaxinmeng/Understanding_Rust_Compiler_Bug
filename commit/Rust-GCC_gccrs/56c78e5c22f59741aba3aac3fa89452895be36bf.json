{"sha": "56c78e5c22f59741aba3aac3fa89452895be36bf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTZjNzhlNWMyMmY1OTc0MWFiYTNhYWMzZmE4OTQ1Mjg5NWJlMzZiZg==", "commit": {"author": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2014-02-09T19:45:06Z"}, "committer": {"name": "Paul Thomas", "email": "pault@gcc.gnu.org", "date": "2014-02-09T19:45:06Z"}, "message": "re PR fortran/59026 (ELEMENTAL procedure with VALUE arguments emits wrong code)\n\n2014-02-09  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/59026\n\t* trans-expr.c (gfc_conv_procedure_call): Pass the value of the\n\tactual argument to a formal argument with the value attribute\n\tin an elemental procedure.\n\n2014-02-09  Paul Thomas  <pault@gcc.gnu.org>\n\n\tPR fortran/59026\n\t* gfortran.dg/elemental_by_value_1.f90 : New test\n\nFrom-SVN: r207645", "tree": {"sha": "bb0721638c4b44251517f88b2484f1ddd20eda41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bb0721638c4b44251517f88b2484f1ddd20eda41"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/56c78e5c22f59741aba3aac3fa89452895be36bf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56c78e5c22f59741aba3aac3fa89452895be36bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56c78e5c22f59741aba3aac3fa89452895be36bf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56c78e5c22f59741aba3aac3fa89452895be36bf/comments", "author": null, "committer": null, "parents": [{"sha": "5a47e4c519a94e176d66ca803b1ca82e9e8cefc4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a47e4c519a94e176d66ca803b1ca82e9e8cefc4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a47e4c519a94e176d66ca803b1ca82e9e8cefc4"}], "stats": {"total": 40, "additions": 39, "deletions": 1}, "files": [{"sha": "ab2171a811abcf1dd67bc532483ac5a28d0aca57", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=56c78e5c22f59741aba3aac3fa89452895be36bf", "patch": "@@ -1,3 +1,10 @@\n+2014-02-09  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/59026\n+\t* trans-expr.c (gfc_conv_procedure_call): Pass the value of the\n+\tactual argument to a formal argument with the value attribute\n+\tin an elemental procedure.\n+\n 2014-02-08  Janus Weil  <janus@gcc.gnu.org>\n \t    Mikael Morin <mikael.morin@gcc.gnu.org>\n "}, {"sha": "297ff6798836968c6fd8ee2e972f271e30e6b672", "filename": "gcc/fortran/trans-expr.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ffortran%2Ftrans-expr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ffortran%2Ftrans-expr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-expr.c?ref=56c78e5c22f59741aba3aac3fa89452895be36bf", "patch": "@@ -4047,7 +4047,11 @@ gfc_conv_procedure_call (gfc_se * se, gfc_symbol * sym,\n \t  gfc_init_se (&parmse, se);\n \t  parm_kind = ELEMENTAL;\n \n-\t  gfc_conv_expr_reference (&parmse, e);\n+\t  if (fsym && fsym->attr.value)\n+\t    gfc_conv_expr (&parmse, e);\n+\t  else\n+\t    gfc_conv_expr_reference (&parmse, e);\n+\n \t  if (e->ts.type == BT_CHARACTER && !e->rank\n \t      && e->expr_type == EXPR_FUNCTION)\n \t    parmse.expr = build_fold_indirect_ref_loc (input_location,"}, {"sha": "d70b76235cfaf400d4895ff01caf739378b76d47", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=56c78e5c22f59741aba3aac3fa89452895be36bf", "patch": "@@ -1,3 +1,8 @@\n+2014-02-09  Paul Thomas  <pault@gcc.gnu.org>\n+\n+\tPR fortran/59026\n+\t* gfortran.dg/elemental_by_value_1.f90 : New test\n+\n 2014-02-08  Janus Weil  <janus@gcc.gnu.org>\n \n \tPR fortran/58470"}, {"sha": "4fc59471b5b5e0a0950275c4f2b08596fcdf434f", "filename": "gcc/testsuite/gfortran.dg/elemental_by_value_1.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_by_value_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/56c78e5c22f59741aba3aac3fa89452895be36bf/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_by_value_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Felemental_by_value_1.f90?ref=56c78e5c22f59741aba3aac3fa89452895be36bf", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do run }\n+!\n+! PR fortran/59026\n+!\n+! Contributed by F-X Coudert  <fxcoudert@gcc.gnu.org>\n+!\n+! Failed to dereference the argument in scalarized loop.\n+!\n+elemental integer function foo(x)\n+  integer, value :: x\n+  foo = x + 1\n+end function\n+\n+  interface\n+    elemental integer function foo(x)\n+    integer, value :: x\n+    end function\n+  end interface\n+\n+  if (foo(42) .ne. 43) call abort\n+  if (any (foo([0,1]) .ne. [1,2])) call abort\n+end"}]}