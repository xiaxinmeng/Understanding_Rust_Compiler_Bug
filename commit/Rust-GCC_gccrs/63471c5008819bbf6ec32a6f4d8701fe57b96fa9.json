{"sha": "63471c5008819bbf6ec32a6f4d8701fe57b96fa9", "node_id": "C_kwDOANBUbNoAKDYzNDcxYzUwMDg4MTliYmY2ZWMzMmE2ZjRkODcwMWZlNTdiOTZmYTk", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-02-20T09:59:15Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2023-02-20T10:55:55Z"}, "message": "tree-optimization/108816 - vect versioning check split confusion\n\nThe split of the versioning condition assumes the definition is\nin the condition block which is ensured by the versioning code.\nBut that only works when we actually have to insert any statements\nfor the versioning condition.  The following adjusts the guard\naccordingly and asserts this condition.\n\n\tPR tree-optimization/108816\n\t* tree-vect-loop-manip.cc (vect_loop_versioning): Adjust\n\tversioning condition split prerequesite, assert required\n\tinvariant.\n\n\t* gcc.dg/torture/pr108816.c: New testcase.", "tree": {"sha": "259f1b22c3d45829cea1f4913ff4d4340a8ca579", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/259f1b22c3d45829cea1f4913ff4d4340a8ca579"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63471c5008819bbf6ec32a6f4d8701fe57b96fa9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63471c5008819bbf6ec32a6f4d8701fe57b96fa9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63471c5008819bbf6ec32a6f4d8701fe57b96fa9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63471c5008819bbf6ec32a6f4d8701fe57b96fa9/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7b8916a6fd098546e4e53e53b37a5153664ba17f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7b8916a6fd098546e4e53e53b37a5153664ba17f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7b8916a6fd098546e4e53e53b37a5153664ba17f"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "4c24d5584c18130e8278bec0e17d3294edf7bd68", "filename": "gcc/testsuite/gcc.dg/torture/pr108816.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63471c5008819bbf6ec32a6f4d8701fe57b96fa9/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr108816.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63471c5008819bbf6ec32a6f4d8701fe57b96fa9/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr108816.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr108816.c?ref=63471c5008819bbf6ec32a6f4d8701fe57b96fa9", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-fvect-cost-model=dynamic\" } */\n+\n+int m;\n+\n+void\n+foo (int p[][16], unsigned int x)\n+{\n+  while (x < 4)\n+    {\n+      int j;\n+\n+      for (j = x * 4; j < (x + 1) * 4 - 2; j++)\n+        p[0][j] = p[m][j];\n+\n+      ++x;\n+    }\n+}"}, {"sha": "6aa3d2ed0bf87a61815e06c3168bfb0561630b33", "filename": "gcc/tree-vect-loop-manip.cc", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63471c5008819bbf6ec32a6f4d8701fe57b96fa9/gcc%2Ftree-vect-loop-manip.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63471c5008819bbf6ec32a6f4d8701fe57b96fa9/gcc%2Ftree-vect-loop-manip.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop-manip.cc?ref=63471c5008819bbf6ec32a6f4d8701fe57b96fa9", "patch": "@@ -3477,7 +3477,7 @@ vect_loop_versioning (loop_vec_info loop_vinfo,\n   tree cost_name = NULL_TREE;\n   profile_probability prob2 = profile_probability::uninitialized ();\n   if (cond_expr\n-      && !integer_truep (cond_expr)\n+      && EXPR_P (cond_expr)\n       && (version_niter\n \t  || version_align\n \t  || version_alias\n@@ -3711,6 +3711,7 @@ vect_loop_versioning (loop_vec_info loop_vinfo,\n   if (cost_name && TREE_CODE (cost_name) == SSA_NAME)\n     {\n       gimple *def = SSA_NAME_DEF_STMT (cost_name);\n+      gcc_assert (gimple_bb (def) == condition_bb);\n       /* All uses of the cost check are 'true' after the check we\n \t are going to insert.  */\n       replace_uses_by (cost_name, boolean_true_node);"}]}