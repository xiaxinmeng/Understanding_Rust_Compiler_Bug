{"sha": "dbe5b438d26161111824727534ef99f4d41e39c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGJlNWI0MzhkMjYxNjExMTE4MjQ3Mjc1MzRlZjk5ZjRkNDFlMzljNA==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2018-07-16T14:11:58Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-07-16T14:11:58Z"}, "message": "[Ada] Fix Default_Storage_Pool aspect handling in generic instantiations\n\n2018-07-16  Ed Schonberg  <schonberg@adacore.com>\n\ngcc/ada/\n\n\t* sem_ch12.adb (Analyze_Package_Instantiation): Handle properly an\n\tinstance that carries an aspect Default_Storage_Pool that overrides a\n\tdefault storage pool that applies to the generic unit. The aspect in\n\tthe generic unit was removed before copying it in the instance, rather\n\tthan removing it from the copy of the aspects that are appended to the\n\taspects in the instance.\n\nFrom-SVN: r262724", "tree": {"sha": "9c8336eb45a417629b3177ac10df66381924929c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9c8336eb45a417629b3177ac10df66381924929c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dbe5b438d26161111824727534ef99f4d41e39c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbe5b438d26161111824727534ef99f4d41e39c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dbe5b438d26161111824727534ef99f4d41e39c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dbe5b438d26161111824727534ef99f4d41e39c4/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "ccc2a6139062395fb5747d0846a1ed6de25293c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ccc2a6139062395fb5747d0846a1ed6de25293c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ccc2a6139062395fb5747d0846a1ed6de25293c2"}], "stats": {"total": 50, "additions": 33, "deletions": 17}, "files": [{"sha": "3dd8c84d1d5713f0b91c2d5b4b7c45763fa8538e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbe5b438d26161111824727534ef99f4d41e39c4/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbe5b438d26161111824727534ef99f4d41e39c4/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=dbe5b438d26161111824727534ef99f4d41e39c4", "patch": "@@ -1,3 +1,12 @@\n+2018-07-16  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch12.adb (Analyze_Package_Instantiation): Handle properly an\n+\tinstance that carries an aspect Default_Storage_Pool that overrides a\n+\tdefault storage pool that applies to the generic unit. The aspect in\n+\tthe generic unit was removed before copying it in the instance, rather\n+\tthan removing it from the copy of the aspects that are appended to the\n+\taspects in the instance.\n+\n 2018-07-16  Ed Schonberg  <schonberg@adacore.com>\n \n \t* einfo.adb (Set_Is_Uplevel_Referenced_Entity): Flag can appear on"}, {"sha": "a7f9fbd2961ccc898e05588a98f63ac1f8806881", "filename": "gcc/ada/sem_ch12.adb", "status": "modified", "additions": 24, "deletions": 17, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dbe5b438d26161111824727534ef99f4d41e39c4/gcc%2Fada%2Fsem_ch12.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dbe5b438d26161111824727534ef99f4d41e39c4/gcc%2Fada%2Fsem_ch12.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch12.adb?ref=dbe5b438d26161111824727534ef99f4d41e39c4", "patch": "@@ -4217,34 +4217,41 @@ package body Sem_Ch12 is\n             else\n                declare\n                   ASN1, ASN2 : Node_Id;\n+                  Inherited_Aspects : constant List_Id :=\n+                    New_Copy_List_Tree (Aspect_Specifications (Gen_Spec));\n+                  Pool_Present : Boolean := False;\n \n                begin\n                   ASN1 := First (Aspect_Specifications (N));\n                   while Present (ASN1) loop\n                      if Chars (Identifier (ASN1)) = Name_Default_Storage_Pool\n                      then\n-                        --  If generic carries a default storage pool, remove\n-                        --  it in favor of the instance one.\n-\n-                        ASN2 := First (Aspect_Specifications (Gen_Spec));\n-                        while Present (ASN2) loop\n-                           if Chars (Identifier (ASN2)) =\n-                                                    Name_Default_Storage_Pool\n-                           then\n-                              Remove (ASN2);\n-                              exit;\n-                           end if;\n-\n-                           Next (ASN2);\n-                        end loop;\n+                        Pool_Present := True;\n+                        exit;\n                      end if;\n \n                      Next (ASN1);\n                   end loop;\n \n-                  Prepend_List_To (Aspect_Specifications (N),\n-                    (New_Copy_List_Tree\n-                      (Aspect_Specifications (Gen_Spec))));\n+                  if Pool_Present then\n+                     --  If generic carries a default storage pool, remove\n+                     --  it in favor of the instance one.\n+\n+                     ASN2 := First (Inherited_Aspects);\n+                     while Present (ASN2) loop\n+                        if Chars (Identifier (ASN2)) =\n+                                                 Name_Default_Storage_Pool\n+                        then\n+                           Remove (ASN2);\n+                           exit;\n+                        end if;\n+\n+                        Next (ASN2);\n+                     end loop;\n+                  end if;\n+\n+                  Prepend_List_To\n+                    (Aspect_Specifications (N), Inherited_Aspects);\n                end;\n             end if;\n          end if;"}]}