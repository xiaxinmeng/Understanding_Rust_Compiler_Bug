{"sha": "7f87e446691f1debfe2671a40f8738bd5e128832", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y4N2U0NDY2OTFmMWRlYmZlMjY3MWE0MGY4NzM4YmQ1ZTEyODgzMg==", "commit": {"author": {"name": "Jozef Lawrynowicz", "email": "jozef.l@mittosystems.com", "date": "2020-09-07T16:35:04Z"}, "committer": {"name": "Jozef Lawrynowicz", "email": "jozef.l@mittosystems.com", "date": "2020-09-07T16:35:04Z"}, "message": "MSP430: Don't override default ISA when MCU name is unrecognized\n\n430X is the default ISA under normal operation, so even when the MCU name\npassed to -mmcu= is unrecognized, it should not be overriden.\n\ngcc/ChangeLog:\n\n\t* config/msp430/msp430.c (msp430_option_override): Don't set the\n\tISA to 430 when the MCU is unrecognized.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/msp430/430x-default-isa.c: New test.", "tree": {"sha": "7b55127322a9db6b09f7a224a9455f3480343ac4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7b55127322a9db6b09f7a224a9455f3480343ac4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f87e446691f1debfe2671a40f8738bd5e128832", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f87e446691f1debfe2671a40f8738bd5e128832", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f87e446691f1debfe2671a40f8738bd5e128832", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f87e446691f1debfe2671a40f8738bd5e128832/comments", "author": {"login": "jozefl-mitto", "id": 36524004, "node_id": "MDQ6VXNlcjM2NTI0MDA0", "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozefl-mitto", "html_url": "https://github.com/jozefl-mitto", "followers_url": "https://api.github.com/users/jozefl-mitto/followers", "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}", "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions", "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs", "repos_url": "https://api.github.com/users/jozefl-mitto/repos", "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}", "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jozefl-mitto", "id": 36524004, "node_id": "MDQ6VXNlcjM2NTI0MDA0", "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jozefl-mitto", "html_url": "https://github.com/jozefl-mitto", "followers_url": "https://api.github.com/users/jozefl-mitto/followers", "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}", "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}", "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions", "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs", "repos_url": "https://api.github.com/users/jozefl-mitto/repos", "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}", "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "84e9fc470f57c9a53295c3f7ebe805523cdd181c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84e9fc470f57c9a53295c3f7ebe805523cdd181c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84e9fc470f57c9a53295c3f7ebe805523cdd181c"}], "stats": {"total": 21, "additions": 12, "deletions": 9}, "files": [{"sha": "129b916715e1fdc4bcc85996d590bbed6b1754a9", "filename": "gcc/config/msp430/msp430.c", "status": "modified", "additions": 2, "deletions": 9, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f87e446691f1debfe2671a40f8738bd5e128832/gcc%2Fconfig%2Fmsp430%2Fmsp430.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f87e446691f1debfe2671a40f8738bd5e128832/gcc%2Fconfig%2Fmsp430%2Fmsp430.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmsp430%2Fmsp430.c?ref=7f87e446691f1debfe2671a40f8738bd5e128832", "patch": "@@ -223,7 +223,7 @@ msp430_option_override (void)\n \t\t  if (target_cpu == NULL)\n \t\t    warning (0,\n \t\t\t     \"Unrecognized MCU name %qs, assuming that it is \"\n-\t\t\t     \"just a MSP430 with no hardware multiply.\\n\"\n+\t\t\t     \"just a MSP430X with no hardware multiply.\\n\"\n \t\t\t     \"Use the %<-mcpu%> and %<-mhwmult%> options to \"\n \t\t\t     \"set these explicitly.\",\n \t\t\t     target_mcu);\n@@ -242,22 +242,15 @@ msp430_option_override (void)\n \t      if (msp430_warn_mcu)\n \t\twarning (0,\n \t\t\t \"Unrecognized MCU name %qs, assuming that it just \"\n-\t\t\t \"supports the MSP430 ISA.\\nUse the %<-mcpu%> option \"\n+\t\t\t \"supports the MSP430X ISA.\\nUse the %<-mcpu%> option \"\n \t\t\t \"to set the ISA explicitly.\",\n \t\t\t target_mcu);\n-\n-\t      msp430x = false;\n \t    }\n \t  else if (msp430_warn_mcu)\n \t    warning (0, \"Unrecognized MCU name %qs.\", target_mcu);\n \t}\n     }\n \n-  /* The F5 series are all able to support the 430X ISA.  */\n-  if (target_cpu == NULL && target_mcu == NULL\n-      && msp430_hwmult_type == MSP430_HWMULT_F5SERIES)\n-    msp430x = true;\n-\n   if (TARGET_LARGE && !msp430x)\n     error (\"%<-mlarge%> requires a 430X-compatible %<-mmcu=%>\");\n "}, {"sha": "4e8077786b052ed7aa1bc2cb7fe4a5de551f2f7e", "filename": "gcc/testsuite/gcc.target/msp430/430x-default-isa.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f87e446691f1debfe2671a40f8738bd5e128832/gcc%2Ftestsuite%2Fgcc.target%2Fmsp430%2F430x-default-isa.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f87e446691f1debfe2671a40f8738bd5e128832/gcc%2Ftestsuite%2Fgcc.target%2Fmsp430%2F430x-default-isa.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmsp430%2F430x-default-isa.c?ref=7f87e446691f1debfe2671a40f8738bd5e128832", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-skip-if \"\" { *-*-* } { \"-mcpu=*\" \"-mmcu=*\" } } */\n+/* { dg-options \"-mmcu=msp430foobar -mno-warn-mcu -mno-warn-devices-csv\" } */\n+\n+/* Verify that the default ISA is set to 430X when the MCU passed to -mmcu= is\n+   unrecognized.  */\n+\n+#ifndef __MSP430X__\n+#error\n+#endif"}]}