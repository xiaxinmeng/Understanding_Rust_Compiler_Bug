{"sha": "425a39fd4effd9604af9f5f0780d209036d6e886", "node_id": "C_kwDOANBUbNoAKDQyNWEzOWZkNGVmZmQ5NjA0YWY5ZjVmMDc4MGQyMDkwMzZkNmU4ODY", "commit": {"author": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2021-12-04T23:22:07Z"}, "committer": {"name": "Martin Sebor", "email": "msebor@redhat.com", "date": "2021-12-09T16:51:47Z"}, "message": "Use the recursive form of compute_objsize [PR 103143].\n\ngcc/ChangeLog:\n\n\tPR middle-end/103143\n\t* pointer-query.cc (gimple_call_return_array): Call compute_objsize_r.\n\ngcc/testsuite/ChangeLog:\n\tPR middle-end/103143\n\t* gcc.dg/Wstringop-overflow-83.c: New test.", "tree": {"sha": "1a2eb6d8a49afd8a636f5b4b3398ecc1b042e2cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1a2eb6d8a49afd8a636f5b4b3398ecc1b042e2cf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/425a39fd4effd9604af9f5f0780d209036d6e886", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/425a39fd4effd9604af9f5f0780d209036d6e886", "html_url": "https://github.com/Rust-GCC/gccrs/commit/425a39fd4effd9604af9f5f0780d209036d6e886", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/425a39fd4effd9604af9f5f0780d209036d6e886/comments", "author": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "msebor", "id": 381149, "node_id": "MDQ6VXNlcjM4MTE0OQ==", "avatar_url": "https://avatars.githubusercontent.com/u/381149?v=4", "gravatar_id": "", "url": "https://api.github.com/users/msebor", "html_url": "https://github.com/msebor", "followers_url": "https://api.github.com/users/msebor/followers", "following_url": "https://api.github.com/users/msebor/following{/other_user}", "gists_url": "https://api.github.com/users/msebor/gists{/gist_id}", "starred_url": "https://api.github.com/users/msebor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/msebor/subscriptions", "organizations_url": "https://api.github.com/users/msebor/orgs", "repos_url": "https://api.github.com/users/msebor/repos", "events_url": "https://api.github.com/users/msebor/events{/privacy}", "received_events_url": "https://api.github.com/users/msebor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6a071b2d40a1078b4029c2b77ef29ffca4e7050c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a071b2d40a1078b4029c2b77ef29ffca4e7050c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a071b2d40a1078b4029c2b77ef29ffca4e7050c"}], "stats": {"total": 21, "additions": 20, "deletions": 1}, "files": [{"sha": "25ce4303849524eba913a467cd927f4ed84f6043", "filename": "gcc/pointer-query.cc", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/425a39fd4effd9604af9f5f0780d209036d6e886/gcc%2Fpointer-query.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/425a39fd4effd9604af9f5f0780d209036d6e886/gcc%2Fpointer-query.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpointer-query.cc?ref=425a39fd4effd9604af9f5f0780d209036d6e886", "patch": "@@ -199,7 +199,7 @@ gimple_call_return_array (gimple *stmt, offset_int offrng[2], bool *past_end,\n \t       of the source object.  */\n \t    access_ref aref;\n \t    tree src = gimple_call_arg (stmt, 1);\n-\t    if (compute_objsize (src, stmt, 1, &aref, qry)\n+\t    if (compute_objsize_r (src, stmt, 1, &aref, snlim, qry)\n \t\t&& aref.sizrng[1] < offrng[1])\n \t      offrng[1] = aref.sizrng[1];\n \t  }"}, {"sha": "6928ee4d5596a9feb41f85f247a30d63f3694c0c", "filename": "gcc/testsuite/gcc.dg/Wstringop-overflow-83.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/425a39fd4effd9604af9f5f0780d209036d6e886/gcc%2Ftestsuite%2Fgcc.dg%2FWstringop-overflow-83.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/425a39fd4effd9604af9f5f0780d209036d6e886/gcc%2Ftestsuite%2Fgcc.dg%2FWstringop-overflow-83.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWstringop-overflow-83.c?ref=425a39fd4effd9604af9f5f0780d209036d6e886", "patch": "@@ -0,0 +1,19 @@\n+/* PR  middle-end/103143 - ICE due to infinite recursion in pointer-query.cc\n+   { dg-do compile }\n+   { dg-options \"-O2 -Wall\" } */\n+\n+typedef __SIZE_TYPE__ size_t;\n+\n+void foo (size_t x)\n+{\n+  struct T { char buf[64]; char buf2[64]; } t;\n+  char *p = &t.buf[8];\n+  char *r = t.buf2;\n+  size_t i;\n+\n+  for (i = 0; i < x; i++)\n+    {\n+      r = __builtin_mempcpy (r, p, i);\n+      p = r + 1;\n+    }\n+}"}]}