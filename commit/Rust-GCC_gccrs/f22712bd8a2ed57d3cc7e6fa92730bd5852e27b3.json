{"sha": "f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjIyNzEyYmQ4YTJlZDU3ZDNjYzdlNmZhOTI3MzBiZDU4NTJlMjdiMw==", "commit": {"author": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-03-19T16:12:56Z"}, "committer": {"name": "Jan Hubicka", "email": "jh@suse.cz", "date": "2020-03-19T16:12:56Z"}, "message": "Fix inliner ICE on alias with flatten attribute [PR92372]\n\ngcc/ChangeLog:\n\n2020-03-19  Jan Hubicka  <hubicka@ucw.cz>\n\n\tPR ipa/92372\n\t* cgraphunit.c (process_function_and_variable_attributes): warn\n\tfor flatten attribute on alias.\n\t* ipa-inline.c (ipa_inline): Do not ICE on flatten attribute on alias.\n\ngcc/testsuite/ChangeLog:\n\n2020-03-19  Jan Hubicka  <hubicka@ucw.cz>\n\n\tPR ipa/92372\n\t* gcc.c-torture/pr92372.c: New test.\n\t* gcc.dg/attr-flatten-1.c: New test.", "tree": {"sha": "b1cc53660ac9b44ff141b8908117343bba6e1b3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1cc53660ac9b44ff141b8908117343bba6e1b3f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/comments", "author": null, "committer": null, "parents": [{"sha": "c8429c2aba80f845939ffa6b2cfe8a0be1b50078", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8429c2aba80f845939ffa6b2cfe8a0be1b50078", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8429c2aba80f845939ffa6b2cfe8a0be1b50078"}], "stats": {"total": 58, "additions": 58, "deletions": 0}, "files": [{"sha": "e1a778df2022e02feb1fae0566b46ce5668694d2", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "patch": "@@ -1,3 +1,10 @@\n+2020-03-19  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/92372\n+\t* cgraphunit.c (process_function_and_variable_attributes): warn\n+\tfor flatten attribute on alias.\n+\t* ipa-inline.c (ipa_inline): Do not ICE on flatten attribute on alias.\n+\n 2020-03-19  Martin Liska  <mliska@suse.cz>\n \n \t* lto-section-in.c: Add ext_symtab."}, {"sha": "d7ed405bf2c2fa3a7fc02d39c0f0b9db38162d60", "filename": "gcc/cgraphunit.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Fcgraphunit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Fcgraphunit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphunit.c?ref=f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "patch": "@@ -851,6 +851,14 @@ process_function_and_variable_attributes (cgraph_node *first,\n        node = symtab->next_function (node))\n     {\n       tree decl = node->decl;\n+\n+      if (node->alias\n+\t  && lookup_attribute (\"flatten\", DECL_ATTRIBUTES (decl)))\n+\t{\n+\t  warning_at (DECL_SOURCE_LOCATION (node->decl), OPT_Wattributes,\n+\t\t      \"%<flatten%>\"\n+\t\t      \" attribute attribute is ignored on aliases\");\n+\t}\n       if (DECL_PRESERVE_P (decl))\n \tnode->mark_force_output ();\n       else if (lookup_attribute (\"externally_visible\", DECL_ATTRIBUTES (decl)))"}, {"sha": "302ce16a6466acc6f6c706474f73e3f975ffc541", "filename": "gcc/ipa-inline.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Fipa-inline.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Fipa-inline.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-inline.c?ref=f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "patch": "@@ -2634,6 +2634,9 @@ ipa_inline (void)\n     {\n       node = order[i];\n       if (node->definition\n+\t  /* Do not try to flatten aliases.  These may happen for example when\n+\t     creating local aliases.  */\n+\t  && !node->alias\n \t  && lookup_attribute (\"flatten\",\n \t\t\t       DECL_ATTRIBUTES (node->decl)) != NULL)\n \torder[j--] = order[i];"}, {"sha": "cce1603184511177151140f629ee0d3a70facfe6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "patch": "@@ -1,3 +1,9 @@\n+2020-03-19  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/92372\n+\t* gcc.c-torture/pr92372.c: New test.\n+\t* gcc.dg/attr-flatten-1.c: New test.\n+\n 2020-03-19  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR tree-optimization/94211"}, {"sha": "72a13bb16f4710ac99ffc98541ecbc81fda5f47b", "filename": "gcc/testsuite/gcc.c-torture/pr92372.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Ftestsuite%2Fgcc.c-torture%2Fpr92372.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Ftestsuite%2Fgcc.c-torture%2Fpr92372.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fpr92372.c?ref=f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "patch": "@@ -0,0 +1,16 @@\n+int fn2(int);\n+int fn3(int);\n+\n+__attribute__((flatten))\n+int fn1(int p1)\n+{\n+  int a = fn2(p1);\n+  return fn3(a);\n+}\n+__attribute__((flatten))\n+int fn4(int p1)\n+{\n+  int j = fn2(p1);\n+  return fn3(j);\n+}\n+"}, {"sha": "ecb08fcd2adb0b859238239f01c9d6b4fc392f23", "filename": "gcc/testsuite/gcc.dg/attr-flatten-1.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-flatten-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-flatten-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fattr-flatten-1.c?ref=f22712bd8a2ed57d3cc7e6fa92730bd5852e27b3", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-require-alias \"\" } */\n+int fn2(int);\n+int fn3(int);\n+\n+__attribute__((flatten))\n+int fn1(int p1)\n+{\n+  int a = fn2(p1);\n+  return fn3(a);\n+}\n+__attribute__((flatten))\n+__attribute__((alias(\"fn1\")))\n+int fn4(int p1); /* { dg-warning \"ignored\" } */\n+int\n+test ()\n+{\n+  return fn4(1);\n+}"}]}