{"sha": "b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjBhZDM2MzViNjNlNjc4NmE4MjE2YWE4ZWMzZDQ0MzZmYTlhZTlhYw==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo.carlini@oracle.com", "date": "2013-06-21T14:23:15Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-06-21T14:23:15Z"}, "message": "re PR libstdc++/57666 (valarray<T>::operator= in c++11 mode does not adapt to size)\n\n2013-06-21  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR libstdc++/57666\n\t* include/std/valarray (valarray<>::operator=(const _Expr<>&)):\n\tImplement correctly C++11 26.6.2.3/1.\n\t* testsuite/26_numerics/valarray/dr630-3.C: New.\n\nFrom-SVN: r200305", "tree": {"sha": "627954bccc61124f7e77d0b00ca7e0ff1f8b6893", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/627954bccc61124f7e77d0b00ca7e0ff1f8b6893"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/comments", "author": null, "committer": null, "parents": [{"sha": "927f908bf879a79ec26af82671e2a5b93073a8a2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/927f908bf879a79ec26af82671e2a5b93073a8a2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/927f908bf879a79ec26af82671e2a5b93073a8a2"}], "stats": {"total": 61, "additions": 59, "deletions": 2}, "files": [{"sha": "6a92f61c588eeaad2aefe4a4aef4a243ccf4036a", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "patch": "@@ -1,3 +1,10 @@\n+2013-06-21  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR libstdc++/57666\n+\t* include/std/valarray (valarray<>::operator=(const _Expr<>&)):\n+\tImplement correctly C++11 26.6.2.3/1.\n+\t* testsuite/26_numerics/valarray/dr630-3.C: New.\n+\n 2013-06-18  Jonathan Wakely  <jwakely.gcc@gmail.com>\n \n \tPR libstdc++/57641"}, {"sha": "be96af6694eaddeb558fea973f64eafc3c3c5e15", "filename": "libstdc++-v3/include/std/valarray", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvalarray", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvalarray", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvalarray?ref=b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "patch": "@@ -819,8 +819,21 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n     inline valarray<_Tp>&\n     valarray<_Tp>::operator=(const _Expr<_Dom, _Tp>& __e)\n     {\n-      _GLIBCXX_DEBUG_ASSERT(_M_size == __e.size());\n-      std::__valarray_copy(__e, _M_size, _Array<_Tp>(_M_data));\n+      // _GLIBCXX_RESOLVE_LIB_DEFECTS\n+      // 630. arrays of valarray.\n+      if (_M_size == __e.size())\n+\tstd::__valarray_copy(__e, _M_size, _Array<_Tp>(_M_data));\n+      else\n+\t{\n+\t  if (_M_data)\n+\t    {\n+\t      std::__valarray_destroy_elements(_M_data, _M_data + _M_size);\n+\t      std::__valarray_release_memory(_M_data);\n+\t    }\n+\t  _M_size = __e.size();\n+\t  _M_data = __valarray_get_storage<_Tp>(_M_size);\n+\t  std::__valarray_copy_construct(__e, _M_size, _Array<_Tp>(_M_data));\n+\t}\n       return *this;\n     }\n "}, {"sha": "d514635ae13c751070c3aa48256c5128ad092af9", "filename": "libstdc++-v3/testsuite/26_numerics/valarray/dr630-3.C", "status": "added", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/libstdc%2B%2B-v3%2Ftestsuite%2F26_numerics%2Fvalarray%2Fdr630-3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac/libstdc%2B%2B-v3%2Ftestsuite%2F26_numerics%2Fvalarray%2Fdr630-3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F26_numerics%2Fvalarray%2Fdr630-3.C?ref=b0ad3635b63e6786a8216aa8ec3d4436fa9ae9ac", "patch": "@@ -0,0 +1,37 @@\n+// Copyright (C) 2013 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+#include <valarray>\n+#include <testsuite_hooks.h>\n+\n+// libstdc++/57666\n+void test01()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  std::valarray<int> a(3), b(3), d1, d2;\n+  d1 = a;\n+  VERIFY( d1.size() == 3 );\n+  d2 = a + b;\n+  VERIFY( d2.size() == 3 );\n+}\n+\n+int main()\n+{\n+  test01();\n+  return 0;\n+}"}]}