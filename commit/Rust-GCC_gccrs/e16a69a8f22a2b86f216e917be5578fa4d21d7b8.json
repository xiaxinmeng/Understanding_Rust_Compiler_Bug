{"sha": "e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE2YTY5YThmMjJhMmI4NmYyMTZlOTE3YmU1NTc4ZmE0ZDIxZDdiOA==", "commit": {"author": {"name": "Tim Shen", "email": "timshen@google.com", "date": "2014-12-17T09:25:44Z"}, "committer": {"name": "Tim Shen", "email": "timshen@gcc.gnu.org", "date": "2014-12-17T09:25:44Z"}, "message": "re PR libstdc++/64302 (The match_results::cbegin()/cend() return incorrect results)\n\n\tPR libstdc++/64302\n\tPR libstdc++/64303\n\t* include/bits/regex.h (match_results::cbegin, match_results::cend,\n\tregex_token_iterator::regex_token_iterator,\n\tregex_token_iterator::_M_normalize_result): Fix match_results cbegin\n\tand cend and regex_token_iterator::_M_result invariant.\n\t* include/bits/regex.tcc: Fix regex_token_iterator::_M_result invariant.\n\t* testsuite/28_regex/iterators/regex_token_iterator/64303.cc: Testcase.\n\nFrom-SVN: r218810", "tree": {"sha": "6ef899dd807f5a47007dd3bd180074569ad84d15", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6ef899dd807f5a47007dd3bd180074569ad84d15"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/comments", "author": {"login": "timshen91", "id": 1157432, "node_id": "MDQ6VXNlcjExNTc0MzI=", "avatar_url": "https://avatars.githubusercontent.com/u/1157432?v=4", "gravatar_id": "", "url": "https://api.github.com/users/timshen91", "html_url": "https://github.com/timshen91", "followers_url": "https://api.github.com/users/timshen91/followers", "following_url": "https://api.github.com/users/timshen91/following{/other_user}", "gists_url": "https://api.github.com/users/timshen91/gists{/gist_id}", "starred_url": "https://api.github.com/users/timshen91/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/timshen91/subscriptions", "organizations_url": "https://api.github.com/users/timshen91/orgs", "repos_url": "https://api.github.com/users/timshen91/repos", "events_url": "https://api.github.com/users/timshen91/events{/privacy}", "received_events_url": "https://api.github.com/users/timshen91/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b20487079f51742acde405bd968dbb3ba25411c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b20487079f51742acde405bd968dbb3ba25411c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b20487079f51742acde405bd968dbb3ba25411c8"}], "stats": {"total": 90, "additions": 78, "deletions": 12}, "files": [{"sha": "2405bb55908dd50bf8b9e0f4048221f3d621abb7", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "patch": "@@ -1,3 +1,14 @@\n+2014-12-17  Tim Shen  <timshen@google.com>\n+\n+\tPR libstdc++/64302\n+\tPR libstdc++/64303\n+\t* include/bits/regex.h (match_results::cbegin, match_results::cend,\n+\tregex_token_iterator::regex_token_iterator,\n+\tregex_token_iterator::_M_normalize_result): Fix match_results cbegin\n+\tand cend and regex_token_iterator::_M_result invariant.\n+\t* include/bits/regex.tcc: Fix regex_token_iterator::_M_result invariant.\n+\t* testsuite/28_regex/iterators/regex_token_iterator/64303.cc: Testcase.\n+\n 2014-12-16  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config/abi/pre/gnu.ver (CXXABI_1.3.9): Export not just"}, {"sha": "80b1de85a498cfff7cecd95aad4c558cd4063b00", "filename": "libstdc++-v3/include/bits/regex.h", "status": "modified", "additions": 17, "deletions": 9, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.h?ref=e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "patch": "@@ -1756,7 +1756,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n        */\n       const_iterator\n       cbegin() const\n-      { return _Base_type::cbegin() + 2; }\n+      { return this->begin(); }\n \n       /**\n        * @brief Gets an iterator to one-past-the-end of the collection.\n@@ -1770,7 +1770,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n        */\n       const_iterator\n       cend() const\n-      { return _Base_type::cend(); }\n+      { return this->end(); }\n \n       //@}\n \n@@ -2632,7 +2632,7 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n \t\t\t     regex_constants::match_flag_type __m\n \t\t\t     = regex_constants::match_default)\n       : _M_position(__a, __b, __re, __m),\n-      _M_subs(__submatches, *(&__submatches+1)), _M_n(0)\n+      _M_subs(__submatches, __submatches + _Nm), _M_n(0)\n       { _M_init(__a, __b); }\n \n       // _GLIBCXX_RESOLVE_LIB_DEFECTS\n@@ -2660,12 +2660,8 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n        */\n       regex_token_iterator(const regex_token_iterator& __rhs)\n       : _M_position(__rhs._M_position), _M_subs(__rhs._M_subs),\n-      _M_suffix(__rhs._M_suffix), _M_n(__rhs._M_n), _M_result(__rhs._M_result),\n-      _M_has_m1(__rhs._M_has_m1)\n-      {\n-\tif (__rhs._M_result == &__rhs._M_suffix)\n-\t  _M_result = &_M_suffix;\n-      }\n+      _M_suffix(__rhs._M_suffix), _M_n(__rhs._M_n), _M_has_m1(__rhs._M_has_m1)\n+      { _M_normalize_result(); }\n \n       /**\n        * @brief Assigns a %regex_token_iterator to another.\n@@ -2737,6 +2733,18 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       _M_end_of_seq() const\n       { return _M_result == nullptr; }\n \n+      // [28.12.2.2.4]\n+      void\n+      _M_normalize_result()\n+      {\n+\tif (_M_position != _Position())\n+\t  _M_result = &_M_current_match();\n+\telse if (_M_has_m1)\n+\t  _M_result = &_M_suffix;\n+\telse\n+\t  _M_result = nullptr;\n+      }\n+\n       _Position         _M_position;\n       std::vector<int>  _M_subs;\n       value_type        _M_suffix;"}, {"sha": "0206a6cf0e1f13ae2fe4b2de6861e9d6c9c75871", "filename": "libstdc++-v3/include/bits/regex.tcc", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.tcc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.tcc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fbits%2Fregex.tcc?ref=e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "patch": "@@ -607,11 +607,9 @@ _GLIBCXX_BEGIN_NAMESPACE_VERSION\n       _M_position = __rhs._M_position;\n       _M_subs = __rhs._M_subs;\n       _M_n = __rhs._M_n;\n-      _M_result = __rhs._M_result;\n       _M_suffix = __rhs._M_suffix;\n       _M_has_m1 = __rhs._M_has_m1;\n-      if (__rhs._M_result == &__rhs._M_suffix)\n-\t_M_result = &_M_suffix;\n+      _M_normalize_result();\n       return *this;\n     }\n "}, {"sha": "f09bbe1c98b1e386afe60b9c2dfe20aa13a49bfe", "filename": "libstdc++-v3/testsuite/28_regex/iterators/regex_token_iterator/64303.cc", "status": "added", "additions": 49, "deletions": 0, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fiterators%2Fregex_token_iterator%2F64303.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e16a69a8f22a2b86f216e917be5578fa4d21d7b8/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fiterators%2Fregex_token_iterator%2F64303.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F28_regex%2Fiterators%2Fregex_token_iterator%2F64303.cc?ref=e16a69a8f22a2b86f216e917be5578fa4d21d7b8", "patch": "@@ -0,0 +1,49 @@\n+// { dg-do run }\n+// { dg-options \"-std=gnu++11\" }\n+\n+//\n+// Copyright (C) 2014 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+//\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// 28.12.2 Class template regex_token_iterator\n+\n+#include <regex>\n+#include <testsuite_hooks.h>\n+\n+void\n+test01()\n+{\n+  bool test __attribute__((unused)) = true;\n+\n+  const std::string s(\"  111  222  \");\n+  const std::regex re(\"\\\\w+\");\n+\n+  std::sregex_token_iterator it1(s.begin(), s.end(), re), it2(it1), end;\n+\n+  for (; it1 != end; ++it1, ++it2) {\n+    VERIFY(it1 == it2);\n+    VERIFY(*it1 == *it2);\n+  }\n+  VERIFY(it2 == end);\n+}\n+\n+int\n+main()\n+{\n+  test01();\n+  return 0;\n+}"}]}