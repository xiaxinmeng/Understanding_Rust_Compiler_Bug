{"sha": "e6bdd0396c69b8f08da394aca0687fb46c188b4a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTZiZGQwMzk2YzY5YjhmMDhkYTM5NGFjYTA2ODdmYjQ2YzE4OGI0YQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2010-05-30T12:01:55Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2010-05-30T12:01:55Z"}, "message": "decl.c (gnat_to_gnu_entity): Reuse the TYPE_DECL of the equivalent type instead of building a new one.\n\n\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Task_Type>: Reuse the\n\tTYPE_DECL of the equivalent type instead of building a new one.\n\nFrom-SVN: r160049", "tree": {"sha": "5828204a3c6b0360ef04bfe89a699185c8995230", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5828204a3c6b0360ef04bfe89a699185c8995230"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e6bdd0396c69b8f08da394aca0687fb46c188b4a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6bdd0396c69b8f08da394aca0687fb46c188b4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e6bdd0396c69b8f08da394aca0687fb46c188b4a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e6bdd0396c69b8f08da394aca0687fb46c188b4a/comments", "author": null, "committer": null, "parents": [{"sha": "c01fe45120921336cd37363f723fbf04e29b28a7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c01fe45120921336cd37363f723fbf04e29b28a7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c01fe45120921336cd37363f723fbf04e29b28a7"}], "stats": {"total": 88, "additions": 86, "deletions": 2}, "files": [{"sha": "7b909f81f8ad97be908f92f4ece00a7766faaf68", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -1,3 +1,8 @@\n+2010-05-30  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Task_Type>: Reuse the\n+\tTYPE_DECL of the equivalent type instead of building a new one.\n+\n 2010-05-30  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/decl.c (gnat_to_gnu_entity): Adjust warning message."}, {"sha": "0fd7753e1ae7d168f0a1c591d574f5b5c90f882c", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -4382,11 +4382,11 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n     case E_Task_Subtype:\n     case E_Protected_Type:\n     case E_Protected_Subtype:\n+      /* Concurrent types are always transformed into their record type.  */\n       if (type_annotate_only && No (gnat_equiv_type))\n \tgnu_type = void_type_node;\n       else\n-\tgnu_type = gnat_to_gnu_type (gnat_equiv_type);\n-\n+\tgnu_decl = gnat_to_gnu_entity (gnat_equiv_type, NULL_TREE, 0);\n       maybe_present = true;\n       break;\n "}, {"sha": "43f447866946e123ca29704a11f08c800c145e2c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -1,3 +1,9 @@\n+2010-05-30  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/prot2.ad[sb]: New test.\n+\t* gnat.dg/prot2_pkg1.ads: New helper.\n+\t* gnat.dg/prot2_pkg2.ad[sb]: Likewise.\n+\n 2010-05-30  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/array11.adb: Adjust dg-warning directive."}, {"sha": "cc6fcab8fe6ef6ed19e8f476f9ef0723996b460c", "filename": "gcc/testsuite/gnat.dg/prot2.adb", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2.adb?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -0,0 +1,23 @@\n+-- { dg-do compile }\n+\n+with Prot2_Pkg1;\n+with Prot2_Pkg2;\n+\n+package body Prot2 is\n+\n+   type A is array (1 .. Prot2_Pkg1.Num) of Integer;\n+\n+   type E is (One, Two);\n+\n+   type Rec (D : E := One) is record\n+      case D is\n+         when One => L : A;\n+         when Two => null;\n+      end case;\n+   end record;\n+\n+   package My_Pkg2 is new Prot2_Pkg2 (Rec);\n+\n+   procedure Dummy is begin null; end;\n+\n+end Prot2;"}, {"sha": "d388fc7d097b60d73867f77ed6042c65566883d4", "filename": "gcc/testsuite/gnat.dg/prot2.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2.ads?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -0,0 +1,5 @@\n+package Prot2 is\n+\n+   procedure Dummy;\n+\n+end Prot2;"}, {"sha": "2e71aacfcdcd2a123fd911d58f8e27887ec94eb9", "filename": "gcc/testsuite/gnat.dg/prot2_pkg1.ads", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg1.ads?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -0,0 +1,5 @@\n+package Prot2_Pkg1 is\n+\n+   function Num return Natural;\n+\n+end Prot2_Pkg1;"}, {"sha": "503cce73d17c1e7ed965672f7308be15f126ae0b", "filename": "gcc/testsuite/gnat.dg/prot2_pkg2.adb", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg2.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg2.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg2.adb?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -0,0 +1,23 @@\n+with Unchecked_Deallocation;\n+\n+package body Prot2_Pkg2 is\n+\n+   protected type Rec is\n+   private\n+       M : T;\n+   end Rec;\n+\n+   protected body Rec is end;\n+\n+   procedure Create (B : out Id) is\n+   begin\n+       B := new Rec;\n+   end;\n+\n+   procedure Delete (B : in out Id) is\n+      procedure Free is new Unchecked_Deallocation(Object => Rec, Name => Id);\n+   begin\n+      Free (B);\n+   end;\n+\n+end Prot2_Pkg2;"}, {"sha": "cdd436b8afb561d1a9a1f1529bbc680bac1087b0", "filename": "gcc/testsuite/gnat.dg/prot2_pkg2.ads", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e6bdd0396c69b8f08da394aca0687fb46c188b4a/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fprot2_pkg2.ads?ref=e6bdd0396c69b8f08da394aca0687fb46c188b4a", "patch": "@@ -0,0 +1,17 @@\n+generic\n+\n+   type T is private;\n+\n+package Prot2_Pkg2 is\n+\n+   type Id is private;\n+\n+   procedure Create (B : out Id);\n+   procedure Delete (B : in out Id);\n+\n+private\n+\n+   type Rec;\n+   type Id is access Rec;\n+\n+end Prot2_Pkg2;"}]}