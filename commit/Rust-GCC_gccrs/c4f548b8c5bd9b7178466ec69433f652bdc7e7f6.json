{"sha": "c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzRmNTQ4YjhjNWJkOWI3MTc4NDY2ZWM2OTQzM2Y2NTJiZGM3ZTdmNg==", "commit": {"author": {"name": "Diego Novillo", "email": "dnovillo@redhat.com", "date": "2005-08-04T18:16:41Z"}, "committer": {"name": "Diego Novillo", "email": "dnovillo@gcc.gnu.org", "date": "2005-08-04T18:16:41Z"}, "message": "re PR tree-optimization/22037 (internal compiler error: verify_ssa failed)\n\n\n\tPR 22037\n\t* tree-cfg.c (replace_uses_by): Call mark_new_vars_to_rename.\n\t(tree_merge_blocks): Propagate anything allowed by\n\tmay_propagate_copy.\n\tClarify documentation.\n\t* passes.c (execute_todo): If cleanup_tree_cfg invalidated the\n\tSSA form, schedule an update if necessary.\n\ntestsuite/ChangeLog\n\n\tPR 22037\n\t* g++.dg/tree-ssa/pr22037.C:\n\nFrom-SVN: r102740", "tree": {"sha": "14c04ed7180eb69104119cc479397db4833e81aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/14c04ed7180eb69104119cc479397db4833e81aa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/comments", "author": null, "committer": null, "parents": [{"sha": "9ef524bac29974fbed968990aeb8ca887c228f13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ef524bac29974fbed968990aeb8ca887c228f13", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ef524bac29974fbed968990aeb8ca887c228f13"}], "stats": {"total": 50, "additions": 43, "deletions": 7}, "files": [{"sha": "6b62ce56129d182e0d6b81f673ffe67654412f5b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "patch": "@@ -1,3 +1,13 @@\n+2005-08-04  Diego Novillo  <dnovillo@redhat.com>\n+\n+\tPR 22037\n+\t* tree-cfg.c (replace_uses_by): Call mark_new_vars_to_rename.\n+\t(tree_merge_blocks): Propagate anything allowed by\n+\tmay_propagate_copy.\n+\tClarify documentation.\n+\t* passes.c (execute_todo): If cleanup_tree_cfg invalidated the\n+\tSSA form, schedule an update if necessary.\n+\n 2005-08-04  Gerald Pfeifer  <gerald@pfeifer.com>\n \n \t* doc/install.texi (Binaries): Remove broken link to"}, {"sha": "f199989f9862c8a628e9f10282fae252e1a05505", "filename": "gcc/passes.c", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Fpasses.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Fpasses.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpasses.c?ref=c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "patch": "@@ -684,6 +684,15 @@ execute_todo (struct tree_opt_pass *pass, unsigned int flags, bool use_required)\n \tcleanup_tree_cfg_loop ();\n       else\n \tcleanup_tree_cfg ();\n+\n+      /* When cleanup_tree_cfg merges consecutive blocks, it may\n+\t perform some simplistic propagation when removing single\n+\t valued PHI nodes.  This propagation may, in turn, cause the\n+\t SSA form to become out-of-date (see PR 22037).  So, even\n+\t if the parent pass had not scheduled an SSA update, we may\n+\t still need to do one.  */\n+      if (!(flags & TODO_update_ssa_any) && need_ssa_update_p ())\n+\tflags |= TODO_update_ssa;\n     }\n \n   if (flags & TODO_update_ssa_any)"}, {"sha": "cd35f624ce2c2e2f1287c448a64a9de2b7c8057b", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "patch": "@@ -1,3 +1,8 @@\n+2005-08-04  Diego Novillo  <dnovillo@redhat.com>\n+\n+\tPR 22037\n+\t* g++.dg/tree-ssa/pr22037.C:\n+\n 2005-08-04  Richard Henderson  <rth@redhat.com>\n \n \t* gcc.dg/tree-ssa/update-cunroll.c: Fix mistakes in"}, {"sha": "11fc1b0389af527dc224478ca82450e5e8a9c785", "filename": "gcc/testsuite/g++.dg/tree-ssa/pr22037.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr22037.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr22037.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftree-ssa%2Fpr22037.C?ref=c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+extern double sqrt (double) throw (); \n+ \n+void foo(double& d, int n) \n+{ \n+  double e=0; \n+  for(int i=0; i<n; i++); \n+  for(int i=0; i<n; i++) e=1; \n+  d = sqrt(e); \n+ \n+  for(int i=0; i<n; i++); \n+}"}, {"sha": "b5a0696ddecc07d1f8baf00dfc05a6cefad9a68a", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 5, "deletions": 7, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4f548b8c5bd9b7178466ec69433f652bdc7e7f6/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=c4f548b8c5bd9b7178466ec69433f652bdc7e7f6", "patch": "@@ -1273,7 +1273,7 @@ replace_uses_by (tree name, tree val)\n       if (TREE_CODE (rhs) == ADDR_EXPR)\n \trecompute_tree_invarant_for_addr_expr (rhs);\n \n-      update_stmt (stmt);\n+      mark_new_vars_to_rename (stmt);\n     }\n \n   VEC_free (tree, heap, stmts);\n@@ -1304,18 +1304,15 @@ tree_merge_blocks (basic_block a, basic_block b)\n   if (dump_file)\n     fprintf (dump_file, \"Merging blocks %d and %d\\n\", a->index, b->index);\n \n-  /* Remove the phi nodes.  */\n+  /* Remove all single-valued PHI nodes from block B of the form\n+     V_i = PHI <V_j> by propagating V_j to all the uses of V_i.  */\n   bsi = bsi_last (a);\n   for (phi = phi_nodes (b); phi; phi = phi_nodes (b))\n     {\n       tree def = PHI_RESULT (phi), use = PHI_ARG_DEF (phi, 0);\n       tree copy;\n       \n-      if (!may_propagate_copy (def, use)\n-\t  /* Propagating pointers might cause the set of vops for statements\n-\t     to be changed, and thus require ssa form update.  */\n-\t  || (is_gimple_reg (def)\n-\t      && POINTER_TYPE_P (TREE_TYPE (def))))\n+      if (!may_propagate_copy (def, use))\n \t{\n \t  gcc_assert (is_gimple_reg (def));\n \n@@ -1330,6 +1327,7 @@ tree_merge_blocks (basic_block a, basic_block b)\n \t}\n       else\n \treplace_uses_by (def, use);\n+\n       remove_phi_node (phi, NULL);\n     }\n "}]}