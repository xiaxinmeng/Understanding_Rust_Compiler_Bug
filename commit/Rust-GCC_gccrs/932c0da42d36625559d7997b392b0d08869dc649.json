{"sha": "932c0da42d36625559d7997b392b0d08869dc649", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTMyYzBkYTQyZDM2NjI1NTU5ZDc5OTdiMzkyYjBkMDg4NjlkYzY0OQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2016-02-17T22:27:24Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2016-02-17T22:27:24Z"}, "message": "re PR c++/69850 (unnecessary -Wnonnull-compare warning)\n\n\tPR c++/69850\n\t* gimplify.c (gimplify_cond_expr): Call gimple_set_no_warning\n\ton the cond_stmt from TREE_NO_WARNING on COND_EXPR_COND.\n\t* gimple-ssa-nonnull-compare.c (do_warn_nonnull_compare): Don't\n\twarn on gimple_no_warning_p statements.\n\n\t* init.c (build_delete): Set TREE_NO_WARNING on ifexp.\n\n\t* g++.dg/warn/Wnonnull-compare-1.C: New test.\n\nFrom-SVN: r233508", "tree": {"sha": "b906ddcc4aab6686c41e92f405908b6c5569564d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b906ddcc4aab6686c41e92f405908b6c5569564d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/932c0da42d36625559d7997b392b0d08869dc649", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/932c0da42d36625559d7997b392b0d08869dc649", "html_url": "https://github.com/Rust-GCC/gccrs/commit/932c0da42d36625559d7997b392b0d08869dc649", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/932c0da42d36625559d7997b392b0d08869dc649/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0f02dd56f5f50238244a729bde63387d42c36d63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0f02dd56f5f50238244a729bde63387d42c36d63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0f02dd56f5f50238244a729bde63387d42c36d63"}], "stats": {"total": 35, "additions": 34, "deletions": 1}, "files": [{"sha": "6ca3c042e182ee115913a8805bdc700ad2c423f8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -1,3 +1,11 @@\n+2016-02-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/69850\n+\t* gimplify.c (gimplify_cond_expr): Call gimple_set_no_warning\n+\ton the cond_stmt from TREE_NO_WARNING on COND_EXPR_COND.\n+\t* gimple-ssa-nonnull-compare.c (do_warn_nonnull_compare): Don't\n+\twarn on gimple_no_warning_p statements.\n+\n 2016-02-17  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* doc/extend.texi (C++ Attributes): Correct description of"}, {"sha": "ca5d838f2443ef83ab06b5e0f2d085fb69d822f3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -1,3 +1,8 @@\n+2016-02-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/69850\n+\t* init.c (build_delete): Set TREE_NO_WARNING on ifexp.\n+\n 2016-02-17  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/69842"}, {"sha": "68cc1a75cac0b2ec9147efc488c3ba2c7b5a5b47", "filename": "gcc/cp/init.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -4525,6 +4525,10 @@ build_delete (tree otype, tree addr, special_function_kind auto_delete,\n \t\t\t\t\t    complain));\n \t  if (ifexp == error_mark_node)\n \t    return error_mark_node;\n+\t  /* This is a compiler generated comparison, don't emit\n+\t     e.g. -Wnonnull-compare warning for it.  */\n+\t  else if (TREE_CODE (ifexp) == NE_EXPR)\n+\t    TREE_NO_WARNING (ifexp) = 1;\n \t}\n \n       if (ifexp != integer_one_node)"}, {"sha": "8c5546754e62fcb66cd3840d9d9b569d1a96b78c", "filename": "gcc/gimple-ssa-nonnull-compare.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fgimple-ssa-nonnull-compare.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fgimple-ssa-nonnull-compare.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-ssa-nonnull-compare.c?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -96,7 +96,8 @@ do_warn_nonnull_compare (function *fun, tree arg)\n \t  }\n       if (op\n \t  && (POINTER_TYPE_P (TREE_TYPE (arg))\n-\t      ? integer_zerop (op) : integer_minus_onep (op)))\n+\t      ? integer_zerop (op) : integer_minus_onep (op))\n+\t  && !gimple_no_warning_p (stmt))\n \twarning_at (loc, OPT_Wnonnull_compare,\n \t\t    \"nonnull argument %qD compared to NULL\", arg);\n     }"}, {"sha": "7be6bd708f1ebcd4ea3800fe228eb263e81aeb75", "filename": "gcc/gimplify.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fgimplify.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Fgimplify.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimplify.c?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -3219,6 +3219,7 @@ gimplify_cond_expr (tree *expr_p, gimple_seq *pre_p, fallback_t fallback)\n \t\t\t\t &arm2);\n   cond_stmt = gimple_build_cond (pred_code, arm1, arm2, label_true,\n \t\t\t\t label_false);\n+  gimple_set_no_warning (cond_stmt, TREE_NO_WARNING (COND_EXPR_COND (expr)));\n   gimplify_seq_add_stmt (&seq, cond_stmt);\n   gimple_stmt_iterator gsi = gsi_last (seq);\n   maybe_fold_stmt (&gsi);"}, {"sha": "13e33881e3eb92dc415e3e4c83378597581a9266", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -1,3 +1,8 @@\n+2016-02-17  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c++/69850\n+\t* g++.dg/warn/Wnonnull-compare-1.C: New test.\n+\n 2012-02-17  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n \n \t* gcc.target/powerpc/vec-cg.c: New test."}, {"sha": "24a33fc8cc41dcd65d087b9baa95537d9d38531c", "filename": "gcc/testsuite/g++.dg/warn/Wnonnull-compare-1.C", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWnonnull-compare-1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/932c0da42d36625559d7997b392b0d08869dc649/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWnonnull-compare-1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fwarn%2FWnonnull-compare-1.C?ref=932c0da42d36625559d7997b392b0d08869dc649", "patch": "@@ -0,0 +1,9 @@\n+// PR c++/69850\n+// { dg-do compile }\n+// { dg-options \"-Wall\" }\n+\n+struct C\n+{\n+  ~C () { delete this; }\t// { dg-bogus \"nonnull argument\" }\n+};\n+C c;"}]}