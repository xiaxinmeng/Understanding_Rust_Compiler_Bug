{"sha": "030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDMwYmJlY2RiYjM5MzVlYTQ3MjhkYTEzZDQ2ZGMwZjBhOWViZGE0Zg==", "commit": {"author": {"name": "Giovanni Bajo", "email": "giovannibajo@gcc.gnu.org", "date": "2004-07-05T15:56:10Z"}, "committer": {"name": "Giovanni Bajo", "email": "giovannibajo@gcc.gnu.org", "date": "2004-07-05T15:56:10Z"}, "message": "re PR c++/2518 (user-declared operator new hides standard one)\n\n\tPR c++/2518\n\t* call.c (build_operator_new_call): Look only at global scope.\n\n\tPR c++/2518\n\t* g++.dg/lookup/new1.C: New test.\n\nFrom-SVN: r84119", "tree": {"sha": "cda5bfe77686f5e41b27ad2183b3a1b0d3c8a699", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cda5bfe77686f5e41b27ad2183b3a1b0d3c8a699"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/comments", "author": {"login": "rasky", "id": 1014109, "node_id": "MDQ6VXNlcjEwMTQxMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1014109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasky", "html_url": "https://github.com/rasky", "followers_url": "https://api.github.com/users/rasky/followers", "following_url": "https://api.github.com/users/rasky/following{/other_user}", "gists_url": "https://api.github.com/users/rasky/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasky/subscriptions", "organizations_url": "https://api.github.com/users/rasky/orgs", "repos_url": "https://api.github.com/users/rasky/repos", "events_url": "https://api.github.com/users/rasky/events{/privacy}", "received_events_url": "https://api.github.com/users/rasky/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rasky", "id": 1014109, "node_id": "MDQ6VXNlcjEwMTQxMDk=", "avatar_url": "https://avatars.githubusercontent.com/u/1014109?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rasky", "html_url": "https://github.com/rasky", "followers_url": "https://api.github.com/users/rasky/followers", "following_url": "https://api.github.com/users/rasky/following{/other_user}", "gists_url": "https://api.github.com/users/rasky/gists{/gist_id}", "starred_url": "https://api.github.com/users/rasky/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rasky/subscriptions", "organizations_url": "https://api.github.com/users/rasky/orgs", "repos_url": "https://api.github.com/users/rasky/repos", "events_url": "https://api.github.com/users/rasky/events{/privacy}", "received_events_url": "https://api.github.com/users/rasky/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "2709efd88c169398f2d23305813f6c7f3c3b18f0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2709efd88c169398f2d23305813f6c7f3c3b18f0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2709efd88c169398f2d23305813f6c7f3c3b18f0"}], "stats": {"total": 26, "additions": 26, "deletions": 0}, "files": [{"sha": "a760aa96beb6eb737fcf004aa99ebc36f7a35b91", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "patch": "@@ -1,3 +1,8 @@\n+2004-07-05  Giovanni Bajo  <giovannibajo@gcc.gnu.org>\n+\n+\tPR c++/2518\n+\t* call.c (build_operator_new_call): Look only at global scope.\n+\n 2004-07-05  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* call.c (enforce_access): Expect TREE_BINFO."}, {"sha": "b6983868caec2641b7d572969e449f04aacd810f", "filename": "gcc/cp/call.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "patch": "@@ -2812,7 +2812,10 @@ build_operator_new_call (tree fnname, tree args, tree *size, tree *cookie_size)\n   if (args == error_mark_node)\n     return args;\n \n+  /* A global operator new must be looked up only at global scope.  */\n+  push_to_top_level();\n   fns = lookup_function_nonclass (fnname, args);\n+  pop_from_top_level();\n \n   /* Figure out what function is being called.  */\n   cand = perform_overload_resolution (fns, args, &candidates, &any_viable_p);"}, {"sha": "e12cd88c26facdb00f513dbe4b2a5ebb58859226", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "patch": "@@ -1,3 +1,8 @@\n+2004-07-05  Giovanni Bajo  <giovannibajo@gcc.gnu.org>\n+\n+\tPR c++/2518\n+\t* g++.dg/lookup/new1.C: New test.\n+\n 2004-07-05  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n \n \tPR c++/11406"}, {"sha": "a28d3e8968d7a4e7102bca46b9007262ae41cbb9", "filename": "gcc/testsuite/g++.dg/lookup/new1.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fnew1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/030bbecdbb3935ea4728da13d46dc0f0a9ebda4f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fnew1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fnew1.C?ref=030bbecdbb3935ea4728da13d46dc0f0a9ebda4f", "patch": "@@ -0,0 +1,13 @@\n+// { dg-do compile }\n+// Origin: <igodard at rational dot com>\n+// PR c++/2518: operator new must not be looked up in local scope\n+\n+int main() {\n+  int i;\n+  void* operator new(unsigned s, int* p);\n+  int* e = new(&i) int;                    // { dg-error \"no matching function\" }\n+  int* f = new int;\n+  return 0;\n+}\n+\n+// { dg-excess-errors \"operator new\" \"list of candidates\" }"}]}