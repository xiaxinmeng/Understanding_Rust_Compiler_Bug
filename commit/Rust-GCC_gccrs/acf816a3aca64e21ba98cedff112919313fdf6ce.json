{"sha": "acf816a3aca64e21ba98cedff112919313fdf6ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWNmODE2YTNhY2E2NGUyMWJhOThjZWRmZjExMjkxOTMxM2ZkZjZjZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-09-24T09:14:17Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-09-24T09:14:17Z"}, "message": "re PR sanitizer/63316 (False asan positive)\n\n\tPR sanitizer/63316\n\t* asan.c (asan_expand_check_ifn): Fix up align >= 8 optimization.\n\n\t* c-c++-common/asan/pr63316.c: New test.\n\nFrom-SVN: r215547", "tree": {"sha": "746bddba6f5c3ef46034c2673ec3a1f5543519bd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/746bddba6f5c3ef46034c2673ec3a1f5543519bd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/acf816a3aca64e21ba98cedff112919313fdf6ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acf816a3aca64e21ba98cedff112919313fdf6ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acf816a3aca64e21ba98cedff112919313fdf6ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acf816a3aca64e21ba98cedff112919313fdf6ce/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "aa29ea0cd4054b64d9dbc9adba3bfd2db2a86be1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/aa29ea0cd4054b64d9dbc9adba3bfd2db2a86be1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/aa29ea0cd4054b64d9dbc9adba3bfd2db2a86be1"}], "stats": {"total": 61, "additions": 50, "deletions": 11}, "files": [{"sha": "ec34528d69587892f3466786858bb0e056336579", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=acf816a3aca64e21ba98cedff112919313fdf6ce", "patch": "@@ -1,3 +1,8 @@\n+2014-09-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/63316\n+\t* asan.c (asan_expand_check_ifn): Fix up align >= 8 optimization.\n+\n 2014-09-24  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \tPR tree-optimization/63266"}, {"sha": "fef4b733f1582add2785f2240d497c821303fbeb", "filename": "gcc/asan.c", "status": "modified", "additions": 18, "deletions": 11, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2Fasan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2Fasan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fasan.c?ref=acf816a3aca64e21ba98cedff112919313fdf6ce", "patch": "@@ -2585,19 +2585,26 @@ asan_expand_check_ifn (gimple_stmt_iterator *iter, bool use_calls)\n \t  gimple shadow_test = build_assign (NE_EXPR, shadow, 0);\n \t  gimple_seq seq = NULL;\n \t  gimple_seq_add_stmt (&seq, shadow_test);\n-\t  /* Aligned (>= 8 bytes) access do not need & 7.  */\n+\t  /* Aligned (>= 8 bytes) can test just\n+\t     (real_size_in_bytes - 1 >= shadow), as base_addr & 7 is known\n+\t     to be 0.  */\n \t  if (align < 8)\n-\t    gimple_seq_add_stmt (&seq, build_assign (BIT_AND_EXPR,\n-\t\t\t\t\t\t     base_addr, 7));\n-\t  gimple_seq_add_stmt (&seq, build_type_cast (shadow_type,\n-\t\t\t\t\t\t      gimple_seq_last (seq)));\n-\t  if (real_size_in_bytes > 1)\n-\t    gimple_seq_add_stmt (&seq,\n-\t\t\t\t build_assign (PLUS_EXPR, gimple_seq_last (seq),\n-\t\t\t\t\t       real_size_in_bytes - 1));\n-\t  gimple_seq_add_stmt (&seq, build_assign (GE_EXPR,\n+\t    {\n+\t      gimple_seq_add_stmt (&seq, build_assign (BIT_AND_EXPR,\n+\t\t\t\t\t\t       base_addr, 7));\n+\t      gimple_seq_add_stmt (&seq,\n+\t\t\t\t   build_type_cast (shadow_type,\n+\t\t\t\t\t\t    gimple_seq_last (seq)));\n+\t      if (real_size_in_bytes > 1)\n+\t\tgimple_seq_add_stmt (&seq,\n+\t\t\t\t     build_assign (PLUS_EXPR,\n \t\t\t\t\t\t   gimple_seq_last (seq),\n-\t\t\t\t\t\t   shadow));\n+\t\t\t\t\t\t   real_size_in_bytes - 1));\n+\t      t = gimple_assign_lhs (gimple_seq_last_stmt (seq));\n+\t    }\n+\t  else\n+\t    t = build_int_cst (shadow_type, real_size_in_bytes - 1);\n+\t  gimple_seq_add_stmt (&seq, build_assign (GE_EXPR, t, shadow));\n \t  gimple_seq_add_stmt (&seq, build_assign (BIT_AND_EXPR, shadow_test,\n \t\t\t\t\t\t   gimple_seq_last (seq)));\n \t  t = gimple_assign_lhs (gimple_seq_last (seq));"}, {"sha": "357b049574a450abdda11b2b80fda960e5474d8f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=acf816a3aca64e21ba98cedff112919313fdf6ce", "patch": "@@ -1,3 +1,8 @@\n+2014-09-24  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR sanitizer/63316\n+\t* c-c++-common/asan/pr63316.c: New test.\n+\n 2014-09-24  Thomas Preud'homme  <thomas.preudhomme@arm.com>\n \n \tPR tree-optimization/63266"}, {"sha": "d07093ac7f2440241dafce58f14006bfa1c9230c", "filename": "gcc/testsuite/c-c++-common/asan/pr63316.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fpr63316.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf816a3aca64e21ba98cedff112919313fdf6ce/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fpr63316.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fasan%2Fpr63316.c?ref=acf816a3aca64e21ba98cedff112919313fdf6ce", "patch": "@@ -0,0 +1,22 @@\n+/* PR sanitizer/63316 */\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=address -O2\" } */\n+\n+#ifdef __cplusplus\n+extern \"C\" {\n+#endif\n+extern void *malloc (__SIZE_TYPE__);\n+extern void free (void *);\n+#ifdef __cplusplus\n+}\n+#endif\n+\n+int\n+main ()\n+{\n+  int *p = (int *) malloc (sizeof (int));\n+  *p = 3;\n+  asm volatile (\"\" : : \"r\" (p) : \"memory\");\n+  free (p);\n+  return 0;\n+}"}]}