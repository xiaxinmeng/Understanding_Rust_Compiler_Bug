{"sha": "07a737f333f0d4352984664c1ab6d344f6e2c88c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDdhNzM3ZjMzM2YwZDQzNTI5ODQ2NjRjMWFiNmQzNDRmNmUyYzg4Yw==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2015-05-19T07:11:37Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2015-05-19T07:11:37Z"}, "message": "bitmap.c (bitmap_set_range): Handle count==1 specially.\n\ngcc/\n\t* bitmap.c (bitmap_set_range): Handle count==1 specially.\n\t(bitmap_clear_range): Likewise.\n\t* cfgcleanup.c (mark_effect): Use bitmap_clear_range and\n\tbitmap_set_range unconditionally.\n\t* df-problems.c (df_simulate_one_insn_forwards): Likewise.\n\t* df-scan.c (df_mark_reg): Likewise.\n\t* haifa-sched.c (setup_ref_regs): Likewise.\n\t* sched-rgn.c (update_live_1): Likewise.\n\nFrom-SVN: r223344", "tree": {"sha": "eb76c88033453d389b51706d4861488d574dcaf2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eb76c88033453d389b51706d4861488d574dcaf2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/07a737f333f0d4352984664c1ab6d344f6e2c88c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07a737f333f0d4352984664c1ab6d344f6e2c88c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/07a737f333f0d4352984664c1ab6d344f6e2c88c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/07a737f333f0d4352984664c1ab6d344f6e2c88c/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "72d19505eef64d2d9c37d8aabf1fffb3267d5d0e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72d19505eef64d2d9c37d8aabf1fffb3267d5d0e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72d19505eef64d2d9c37d8aabf1fffb3267d5d0e"}], "stats": {"total": 72, "additions": 32, "deletions": 40}, "files": [{"sha": "c87f6453a5f223d3b2e1397330a93fd87ef7b871", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -1,3 +1,14 @@\n+2015-05-19  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* bitmap.c (bitmap_set_range): Handle count==1 specially.\n+\t(bitmap_clear_range): Likewise.\n+\t* cfgcleanup.c (mark_effect): Use bitmap_clear_range and\n+\tbitmap_set_range unconditionally.\n+\t* df-problems.c (df_simulate_one_insn_forwards): Likewise.\n+\t* df-scan.c (df_mark_reg): Likewise.\n+\t* haifa-sched.c (setup_ref_regs): Likewise.\n+\t* sched-rgn.c (update_live_1): Likewise.\n+\n 2015-05-19  Richard Sandiford  <richard.sandiford@arm.com>\n \n \t* regs.h (END_HARD_REGNO): Delete."}, {"sha": "58f443243a2068fc916a5092d4869e8793c8d11e", "filename": "gcc/bitmap.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fbitmap.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fbitmap.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbitmap.c?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -1212,6 +1212,12 @@ bitmap_set_range (bitmap head, unsigned int start, unsigned int count)\n   if (!count)\n     return;\n \n+  if (count == 1)\n+    {\n+      bitmap_set_bit (head, start);\n+      return;\n+    }\n+\n   first_index = start / BITMAP_ELEMENT_ALL_BITS;\n   end_bit_plus1 = start + count;\n   last_index = (end_bit_plus1 - 1) / BITMAP_ELEMENT_ALL_BITS;\n@@ -1311,6 +1317,12 @@ bitmap_clear_range (bitmap head, unsigned int start, unsigned int count)\n   if (!count)\n     return;\n \n+  if (count == 1)\n+    {\n+      bitmap_clear_bit (head, start);\n+      return;\n+    }\n+\n   first_index = start / BITMAP_ELEMENT_ALL_BITS;\n   end_bit_plus1 = start + count;\n   last_index = (end_bit_plus1 - 1) / BITMAP_ELEMENT_ALL_BITS;"}, {"sha": "cd12b504e18f1bfa9fb638fc376c98942f166fdc", "filename": "gcc/cfgcleanup.c", "status": "modified", "additions": 4, "deletions": 15, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fcfgcleanup.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fcfgcleanup.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgcleanup.c?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -222,22 +222,15 @@ try_simplify_condjump (basic_block cbranch_block)\n static bool\n mark_effect (rtx exp, regset nonequal)\n {\n-  int regno;\n   rtx dest;\n   switch (GET_CODE (exp))\n     {\n       /* In case we do clobber the register, mark it as equal, as we know the\n \t value is dead so it don't have to match.  */\n     case CLOBBER:\n-      if (REG_P (XEXP (exp, 0)))\n-\t{\n-\t  dest = XEXP (exp, 0);\n-\t  regno = REGNO (dest);\n-\t  if (HARD_REGISTER_NUM_P (regno))\n-\t    bitmap_clear_range (nonequal, regno, REG_NREGS (dest));\n-\t  else\n-\t    bitmap_clear_bit (nonequal, regno);\n-\t}\n+      dest = XEXP (exp, 0);\n+      if (REG_P (dest))\n+\tbitmap_clear_range (nonequal, REGNO (dest), REG_NREGS (dest));\n       return false;\n \n     case SET:\n@@ -248,11 +241,7 @@ mark_effect (rtx exp, regset nonequal)\n \treturn false;\n       if (!REG_P (dest))\n \treturn true;\n-      regno = REGNO (dest);\n-      if (HARD_REGISTER_NUM_P (regno))\n-\tbitmap_set_range (nonequal, regno, REG_NREGS (dest));\n-      else\n-\tbitmap_set_bit (nonequal, regno);\n+      bitmap_set_range (nonequal, REGNO (dest), REG_NREGS (dest));\n       return false;\n \n     default:"}, {"sha": "25cfe08618e1cbe1a91a4678e9bd1b86388fdf81", "filename": "gcc/df-problems.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fdf-problems.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fdf-problems.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-problems.c?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -3574,11 +3574,7 @@ df_simulate_one_insn_forwards (basic_block bb, rtx_insn *insn, bitmap live)\n \tcase REG_UNUSED:\n \t  {\n \t    rtx reg = XEXP (link, 0);\n-\t    int regno = REGNO (reg);\n-\t    if (HARD_REGISTER_NUM_P (regno))\n-\t      bitmap_clear_range (live, regno, REG_NREGS (reg));\n-\t    else\n-\t      bitmap_clear_bit (live, regno);\n+\t    bitmap_clear_range (live, REGNO (reg), REG_NREGS (reg));\n \t  }\n \t  break;\n \tdefault:"}, {"sha": "c831730bc2143baf4f05def5de001e8b95f48417", "filename": "gcc/df-scan.c", "status": "modified", "additions": 1, "deletions": 9, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fdf-scan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fdf-scan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-scan.c?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -3518,15 +3518,7 @@ df_get_eh_block_artificial_uses (bitmap eh_block_artificial_uses)\n static void\n df_mark_reg (rtx reg, void *vset)\n {\n-  bitmap set = (bitmap) vset;\n-  int regno = REGNO (reg);\n-\n-  gcc_assert (GET_MODE (reg) != BLKmode);\n-\n-  if (regno < FIRST_PSEUDO_REGISTER)\n-    bitmap_set_range (set, regno, REG_NREGS (reg));\n-  else\n-    bitmap_set_bit (set, regno);\n+  bitmap_set_range ((bitmap) vset, REGNO (reg), REG_NREGS (reg));\n }\n \n "}, {"sha": "bf8ce0bb7c42823086dfc52f3259be04bb93dbac", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 2, "deletions": 6, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -1032,17 +1032,13 @@ initiate_reg_pressure_info (bitmap live)\n static void\n setup_ref_regs (rtx x)\n {\n-  int i, j, regno;\n+  int i, j;\n   const RTX_CODE code = GET_CODE (x);\n   const char *fmt;\n \n   if (REG_P (x))\n     {\n-      regno = REGNO (x);\n-      if (HARD_REGISTER_NUM_P (regno))\n-\tbitmap_set_range (region_ref_regs, regno, REG_NREGS (x));\n-      else\n-\tbitmap_set_bit (region_ref_regs, REGNO (x));\n+      bitmap_set_range (region_ref_regs, REGNO (x), REG_NREGS (x));\n       return;\n     }\n   fmt = GET_RTX_FORMAT (code);"}, {"sha": "fd53a3f8621853a2e756c51529ea701f5d0c8e92", "filename": "gcc/sched-rgn.c", "status": "modified", "additions": 1, "deletions": 5, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fsched-rgn.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/07a737f333f0d4352984664c1ab6d344f6e2c88c/gcc%2Fsched-rgn.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsched-rgn.c?ref=07a737f333f0d4352984664c1ab6d344f6e2c88c", "patch": "@@ -1801,11 +1801,7 @@ update_live_1 (int src, rtx x)\n       for (i = 0; i < candidate_table[src].update_bbs.nr_members; i++)\n \t{\n \t  basic_block b = candidate_table[src].update_bbs.first_member[i];\n-\n-\t  if (HARD_REGISTER_NUM_P (regno))\n-\t    bitmap_set_range (df_get_live_in (b), regno, REG_NREGS (reg));\n-\t  else\n-\t    bitmap_set_bit (df_get_live_in (b), regno);\n+\t  bitmap_set_range (df_get_live_in (b), regno, REG_NREGS (reg));\n \t}\n     }\n }"}]}