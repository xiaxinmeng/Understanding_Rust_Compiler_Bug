{"sha": "0df8dc6e188733f28a9c73544d50b7eec96e53bc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGRmOGRjNmUxODg3MzNmMjhhOWM3MzU0NGQ1MGI3ZWVjOTZlNTNiYw==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2018-05-30T16:36:55Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2018-05-30T16:36:55Z"}, "message": "lto-wrapper.c (debug_objcopy): Add rename parameter; pass it down to simple_object_copy_lto_debug_sections.\n\n\n\t* lto-wrapper.c (debug_objcopy): Add rename parameter; pass\n\tit down to simple_object_copy_lto_debug_sections.\n\t(run_gcc): Determine incremental LTO link time and configure\n\tlto1 into non-wpa mode, disable renaming of debug sections.\n\nFrom-SVN: r260961", "tree": {"sha": "216ae6a6db9c629e1b61e5c2bbba94b5f66bf43b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/216ae6a6db9c629e1b61e5c2bbba94b5f66bf43b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0df8dc6e188733f28a9c73544d50b7eec96e53bc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df8dc6e188733f28a9c73544d50b7eec96e53bc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0df8dc6e188733f28a9c73544d50b7eec96e53bc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df8dc6e188733f28a9c73544d50b7eec96e53bc/comments", "author": null, "committer": null, "parents": [{"sha": "de54061dccca2c469bc77502743f8a0e0aa49287", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de54061dccca2c469bc77502743f8a0e0aa49287", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de54061dccca2c469bc77502743f8a0e0aa49287"}], "stats": {"total": 28, "additions": 25, "deletions": 3}, "files": [{"sha": "fc908fe11bbfd89b44e907471dfa7c598e7da21d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df8dc6e188733f28a9c73544d50b7eec96e53bc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df8dc6e188733f28a9c73544d50b7eec96e53bc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0df8dc6e188733f28a9c73544d50b7eec96e53bc", "patch": "@@ -1,3 +1,10 @@\n+2018-05-30  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* lto-wrapper.c (debug_objcopy): Add rename parameter; pass\n+\tit down to simple_object_copy_lto_debug_sections.\n+\t(run_gcc): Determine incremental LTO link time and configure\n+\tlto1 into non-wpa mode, disable renaming of debug sections.\n+\n 2018-05-30  Kelvin Nilsen  <kelvin@gcc.gnu.org>\n \n \t* doc/extend.texi (PowerPC AltiVec Built-in Functions): Remove"}, {"sha": "c3eb00dc0c2dc9e3dadf37569accb1213d1b9a52", "filename": "gcc/lto-wrapper.c", "status": "modified", "additions": 18, "deletions": 3, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0df8dc6e188733f28a9c73544d50b7eec96e53bc/gcc%2Flto-wrapper.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0df8dc6e188733f28a9c73544d50b7eec96e53bc/gcc%2Flto-wrapper.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto-wrapper.c?ref=0df8dc6e188733f28a9c73544d50b7eec96e53bc", "patch": "@@ -966,7 +966,7 @@ find_and_merge_options (int fd, off_t file_offset, const char *prefix,\n    is returned.  Return NULL on error.  */\n \n const char *\n-debug_objcopy (const char *infile)\n+debug_objcopy (const char *infile, bool rename)\n {\n   const char *outfile;\n   const char *errmsg;\n@@ -1008,7 +1008,7 @@ debug_objcopy (const char *infile)\n     }\n \n   outfile = make_temp_file (\"debugobjtem\");\n-  errmsg = simple_object_copy_lto_debug_sections (inobj, outfile, &err);\n+  errmsg = simple_object_copy_lto_debug_sections (inobj, outfile, &err, rename);\n   if (errmsg)\n     {\n       unlink_if_ordinary (outfile);\n@@ -1056,6 +1056,7 @@ run_gcc (unsigned argc, char *argv[])\n   bool have_offload = false;\n   unsigned lto_argc = 0, ltoobj_argc = 0;\n   char **lto_argv, **ltoobj_argv;\n+  bool linker_output_rel = false;\n   bool skip_debug = false;\n   unsigned n_debugobj;\n \n@@ -1108,9 +1109,15 @@ run_gcc (unsigned argc, char *argv[])\n \t  file_offset = (off_t) loffset;\n \t}\n       fd = open (filename, O_RDONLY | O_BINARY);\n+      /* Linker plugin passes -fresolution and -flinker-output options.\n+\t -flinker-output is passed only when user did not specify one and thus\n+\t we do not need to worry about duplicities with the option handling\n+\t below. */\n       if (fd == -1)\n \t{\n \t  lto_argv[lto_argc++] = argv[i];\n+\t  if (strcmp (argv[i], \"-flinker-output=rel\") == 0)\n+\t    linker_output_rel = true;\n \t  continue;\n \t}\n \n@@ -1175,6 +1182,11 @@ run_gcc (unsigned argc, char *argv[])\n \t  lto_mode = LTO_MODE_WHOPR;\n \t  break;\n \n+\tcase OPT_flinker_output_:\n+\t  linker_output_rel = !strcmp (option->arg, \"rel\");\n+\t  break;\n+\n+\n \tdefault:\n \t  break;\n \t}\n@@ -1191,6 +1203,9 @@ run_gcc (unsigned argc, char *argv[])\n       fputc ('\\n', stderr);\n     }\n \n+  if (linker_output_rel)\n+    no_partition = true;\n+\n   if (no_partition)\n     {\n       lto_mode = LTO_MODE_LTO;\n@@ -1435,7 +1450,7 @@ run_gcc (unsigned argc, char *argv[])\n     for (i = 0; i < ltoobj_argc; ++i)\n       {\n \tconst char *tem;\n-\tif ((tem = debug_objcopy (ltoobj_argv[i])))\n+\tif ((tem = debug_objcopy (ltoobj_argv[i], !linker_output_rel)))\n \t  {\n \t    obstack_ptr_grow (&argv_obstack, tem);\n \t    n_debugobj++;"}]}