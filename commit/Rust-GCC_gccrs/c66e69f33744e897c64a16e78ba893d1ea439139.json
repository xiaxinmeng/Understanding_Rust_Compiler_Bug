{"sha": "c66e69f33744e897c64a16e78ba893d1ea439139", "node_id": "C_kwDOANBUbNoAKGM2NmU2OWYzMzc0NGU4OTdjNjRhMTZlNzhiYTg5M2QxZWE0MzkxMzk", "commit": {"author": {"name": "Justin Squirek", "email": "squirek@adacore.com", "date": "2022-08-18T19:48:22Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-09-06T07:14:22Z"}, "message": "[Ada] Handle new At_End expansion during unnesting\n\nThis patch modifies the marking of nested subprograms requiring static links,\nso that the changes made to \"At end\" procedures get handled properly.\n\ngcc/ada/\n\n\t* exp_unst.adb\n\t(Visit_Node): Add N_Block_Statement to the enclosing construct\n\tcase since they can now have \"At end\" procedures. Also, recognize\n\tcalls from \"At end\" procedures when recording subprograms.", "tree": {"sha": "a4e428a3f8d71c30c5913d5c29929f5d94064baf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a4e428a3f8d71c30c5913d5c29929f5d94064baf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c66e69f33744e897c64a16e78ba893d1ea439139", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c66e69f33744e897c64a16e78ba893d1ea439139", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c66e69f33744e897c64a16e78ba893d1ea439139", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c66e69f33744e897c64a16e78ba893d1ea439139/comments", "author": {"login": "AdaDoom3", "id": 3445599, "node_id": "MDQ6VXNlcjM0NDU1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3445599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdaDoom3", "html_url": "https://github.com/AdaDoom3", "followers_url": "https://api.github.com/users/AdaDoom3/followers", "following_url": "https://api.github.com/users/AdaDoom3/following{/other_user}", "gists_url": "https://api.github.com/users/AdaDoom3/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdaDoom3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdaDoom3/subscriptions", "organizations_url": "https://api.github.com/users/AdaDoom3/orgs", "repos_url": "https://api.github.com/users/AdaDoom3/repos", "events_url": "https://api.github.com/users/AdaDoom3/events{/privacy}", "received_events_url": "https://api.github.com/users/AdaDoom3/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "d644c519672601c7a2c1627a875dcd8e16aed9c9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d644c519672601c7a2c1627a875dcd8e16aed9c9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d644c519672601c7a2c1627a875dcd8e16aed9c9"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "1297f289f7809220ca31fb2555cd817e17a530e8", "filename": "gcc/ada/exp_unst.adb", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c66e69f33744e897c64a16e78ba893d1ea439139/gcc%2Fada%2Fexp_unst.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c66e69f33744e897c64a16e78ba893d1ea439139/gcc%2Fada%2Fexp_unst.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_unst.adb?ref=c66e69f33744e897c64a16e78ba893d1ea439139", "patch": "@@ -938,7 +938,7 @@ package body Exp_Unst is\n                --  subprogram. As above, the called entity must be local and\n                --  not imported.\n \n-               when N_Handled_Sequence_Of_Statements =>\n+               when N_Handled_Sequence_Of_Statements | N_Block_Statement =>\n                   if Present (At_End_Proc (N))\n                     and then Scope_Within (Entity (At_End_Proc (N)), Subp)\n                     and then not Is_Imported (Entity (At_End_Proc (N)))\n@@ -1184,6 +1184,15 @@ package body Exp_Unst is\n \n                   Register_Subprogram (Ent, N);\n \n+                  --  Record a call from an At_End_Proc\n+\n+                  if Present (At_End_Proc (N))\n+                    and then Scope_Within (Entity (At_End_Proc (N)), Subp)\n+                    and then not Is_Imported (Entity (At_End_Proc (N)))\n+                  then\n+                     Append_Unique_Call ((N, Ent, Entity (At_End_Proc (N))));\n+                  end if;\n+\n                   --  We make a recursive call to scan the subprogram body, so\n                   --  that we can save and restore Current_Subprogram.\n "}]}