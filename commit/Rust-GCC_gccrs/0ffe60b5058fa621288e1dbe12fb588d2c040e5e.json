{"sha": "0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGZmZTYwYjUwNThmYTYyMTI4OGUxZGJlMTJmYjU4OGQyYzA0MGU1ZQ==", "commit": {"author": {"name": "Bill Schmidt", "email": "wschmidt@linux.vnet.ibm.com", "date": "2017-03-21T13:57:20Z"}, "committer": {"name": "William Schmidt", "email": "wschmidt@gcc.gnu.org", "date": "2017-03-21T13:57:20Z"}, "message": "re PR tree-optimization/79908 (ICE in gimplify_expr (gimplify.c:12155) gimplification failed)\n\n[gcc]\n\n2017-03-21  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n            Richard Biener  <rguenth@suse.com>\n\n\tPR tree-optimization/79908\n\t* tree-stdarg.c (expand_ifn_va_arg_1): For a VA_ARG whose LHS has\n\tbeen cast away, use force_gimple_operand to construct the side\n\teffects.\n\n[gcc/testsuite]\n\n2017-03-21  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n            Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/79908\n\t* gcc.dg/torture/pr79908.c: New file.\n\n\nCo-Authored-By: Richard Biener <rguenth@suse.com>\nCo-Authored-By: Richard Biener <rguenther@suse.de>\n\nFrom-SVN: r246319", "tree": {"sha": "ed8f0b3cc75049f7f39d3a6c9acfa2c85581a7ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ed8f0b3cc75049f7f39d3a6c9acfa2c85581a7ea"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/comments", "author": {"login": "wschmidt-ibm", "id": 5520937, "node_id": "MDQ6VXNlcjU1MjA5Mzc=", "avatar_url": "https://avatars.githubusercontent.com/u/5520937?v=4", "gravatar_id": "", "url": "https://api.github.com/users/wschmidt-ibm", "html_url": "https://github.com/wschmidt-ibm", "followers_url": "https://api.github.com/users/wschmidt-ibm/followers", "following_url": "https://api.github.com/users/wschmidt-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/wschmidt-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/wschmidt-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/wschmidt-ibm/subscriptions", "organizations_url": "https://api.github.com/users/wschmidt-ibm/orgs", "repos_url": "https://api.github.com/users/wschmidt-ibm/repos", "events_url": "https://api.github.com/users/wschmidt-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/wschmidt-ibm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "54eb90fe8a2645ce85266bede939eb0804c1bd80", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/54eb90fe8a2645ce85266bede939eb0804c1bd80", "html_url": "https://github.com/Rust-GCC/gccrs/commit/54eb90fe8a2645ce85266bede939eb0804c1bd80"}], "stats": {"total": 38, "additions": 34, "deletions": 4}, "files": [{"sha": "81a27f9f05175d853837d03f340e4383fcb68fae", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "patch": "@@ -1,3 +1,11 @@\n+2017-03-21  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+            Richard Biener  <rguenth@suse.com>\n+\n+\tPR tree-optimization/79908\n+\t* tree-stdarg.c (expand_ifn_va_arg_1): For a VA_ARG whose LHS has\n+\tbeen cast away, use force_gimple_operand to construct the side\n+\teffects.\n+\n 2017-03-21  Martin Liska  <mliska@suse.cz>\n \n \tPR libfortran/79956"}, {"sha": "c2be77a3b21bbd3017403be8fd73ef0f1ed81ee9", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "patch": "@@ -1,3 +1,9 @@\n+2017-03-21  Bill Schmidt  <wschmidt@linux.vnet.ibm.com>\n+            Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/79908\n+\t* gcc.dg/torture/pr79908.c: New file.\n+\n 2017-03-21  Senthil Kumar Selvaraj  <senthil_kumar.selvaraj@atmel.com>\n \n \t* gcc.dg/tree-ssa/overflow-1.c: Use __UINT32_TYPE__ for targets"}, {"sha": "e2d6920a4cda00d34a56a2acdefbb6398ba8f81b", "filename": "gcc/testsuite/gcc.dg/torture/pr79908.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr79908.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr79908.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr79908.c?ref=0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+\n+/* Used to fail in the stdarg pass before fix for PR79908.  */\n+\n+typedef __builtin_va_list __gnuc_va_list;\n+typedef __gnuc_va_list va_list;\n+\n+void testva (int n, ...)\n+{\n+  va_list ap;\n+  _Complex int i = __builtin_va_arg (ap, _Complex int);\n+}"}, {"sha": "18dd972e3f60ea3cfbe441ec9b84d4394d9b01e9", "filename": "gcc/tree-stdarg.c", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2Ftree-stdarg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0ffe60b5058fa621288e1dbe12fb588d2c040e5e/gcc%2Ftree-stdarg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-stdarg.c?ref=0ffe60b5058fa621288e1dbe12fb588d2c040e5e", "patch": "@@ -33,6 +33,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"gimple-iterator.h\"\n #include \"gimple-walk.h\"\n #include \"gimplify.h\"\n+#include \"gimplify-me.h\"\n #include \"tree-into-ssa.h\"\n #include \"tree-cfg.h\"\n #include \"tree-stdarg.h\"\n@@ -1058,12 +1059,16 @@ expand_ifn_va_arg_1 (function *fun)\n \t    gimplify_assign (lhs, expr, &pre);\n \t  }\n \telse\n-\t  gimplify_expr (&expr, &pre, &post, is_gimple_lvalue, fb_lvalue);\n+\t  {\n+\t    gimple_seq tmp_seq;\n+\t    force_gimple_operand (expr, &tmp_seq, false, NULL_TREE);\n+\t    gimple_seq_add_seq_without_update (&pre, tmp_seq);\n+\t  }\n \n \tinput_location = saved_location;\n \tpop_gimplify_context (NULL);\n \n-\tgimple_seq_add_seq (&pre, post);\n+\tgimple_seq_add_seq_without_update (&pre, post);\n \tupdate_modified_stmts (pre);\n \n \t/* Add the sequence after IFN_VA_ARG.  This splits the bb right\n@@ -1072,11 +1077,10 @@ expand_ifn_va_arg_1 (function *fun)\n \tgimple_find_sub_bbs (pre, &i);\n \n \t/* Remove the IFN_VA_ARG gimple_call.  It's the last stmt in the\n-\t   bb.  */\n+\t   bb if we added any stmts.  */\n \tunlink_stmt_vdef (stmt);\n \trelease_ssa_name_fn (fun, gimple_vdef (stmt));\n \tgsi_remove (&i, true);\n-\tgcc_assert (gsi_end_p (i));\n \n \t/* We're walking here into the bbs which contain the expansion of\n \t   IFN_VA_ARG, and will not contain another IFN_VA_ARG that needs"}]}