{"sha": "a4d031c79e899114f408bfa96ca3e3d934c31a7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTRkMDMxYzc5ZTg5OTExNGY0MDhiZmE5NmNhM2UzZDkzNGMzMWE3Yg==", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2012-02-20T23:43:31Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@gcc.gnu.org", "date": "2012-02-20T23:43:31Z"}, "message": "re PR middle-end/52141 ([trans-mem] ICE due to asm statement in trans-mem.c:expand_block_tm)\n\n        PR middle-end/52141\n        * trans-mem.c (ipa_tm_scan_irr_block): Error out on GIMPLE_ASM's\n        in a transaction safe function.\n\nFrom-SVN: r184417", "tree": {"sha": "ecc42fa4efdac72cf8b9746e66dae3721a9e7497", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ecc42fa4efdac72cf8b9746e66dae3721a9e7497"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a4d031c79e899114f408bfa96ca3e3d934c31a7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4d031c79e899114f408bfa96ca3e3d934c31a7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4d031c79e899114f408bfa96ca3e3d934c31a7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4d031c79e899114f408bfa96ca3e3d934c31a7b/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "6e887223a0bfe4e691107cc2a7d7fc3793cd93fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6e887223a0bfe4e691107cc2a7d7fc3793cd93fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6e887223a0bfe4e691107cc2a7d7fc3793cd93fd"}], "stats": {"total": 37, "additions": 37, "deletions": 0}, "files": [{"sha": "e12e596ed1db9fb8e465f6bf869ed52463fb5503", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4d031c79e899114f408bfa96ca3e3d934c31a7b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4d031c79e899114f408bfa96ca3e3d934c31a7b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a4d031c79e899114f408bfa96ca3e3d934c31a7b", "patch": "@@ -1,3 +1,9 @@\n+2012-02-20  Aldy Hernandez  <aldyh@redhat.com>\n+\n+\tPR middle-end/52141\n+\t* trans-mem.c (ipa_tm_scan_irr_block): Error out on GIMPLE_ASM's\n+\tin a transaction safe function.\n+\n 2012-02-20  Kai Tietz  <ktietz@redhat.com>\n \n \tPR target/52238"}, {"sha": "0dabf76ce6dac69107021903f8277a6e301be631", "filename": "gcc/testsuite/gcc.dg/tm/pr52141.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4d031c79e899114f408bfa96ca3e3d934c31a7b/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr52141.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4d031c79e899114f408bfa96ca3e3d934c31a7b/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr52141.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftm%2Fpr52141.c?ref=a4d031c79e899114f408bfa96ca3e3d934c31a7b", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fgnu-tm -O0 -w\" } */\n+\n+__attribute__((always_inline))\n+static void asmfunc(void)\n+{\n+  __asm__ (\"\"); /* { dg-error \"asm not allowed in .transaction_safe\" } */\n+}\n+\n+__attribute__((transaction_safe))\n+static void f(void)\n+{\n+  asmfunc();\n+}\n+\n+int main()\n+{\n+  __transaction_atomic {\n+    f();\n+  }\n+  return 0;\n+}\n+\n+/* { dg-message \"inlined from \\'f\\'\" \"\" { target *-*-* } 0 } */"}, {"sha": "aa330dd95c4bb8ec9a09300896a1682dff0ae52f", "filename": "gcc/trans-mem.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4d031c79e899114f408bfa96ca3e3d934c31a7b/gcc%2Ftrans-mem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4d031c79e899114f408bfa96ca3e3d934c31a7b/gcc%2Ftrans-mem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftrans-mem.c?ref=a4d031c79e899114f408bfa96ca3e3d934c31a7b", "patch": "@@ -3736,6 +3736,13 @@ ipa_tm_scan_irr_block (basic_block bb)\n \t     assembly statement is not relevant to the transaction\n \t     is to wrap it in a __tm_waiver block.  This is not\n \t     yet implemented, so we can't check for it.  */\n+\t  if (is_tm_safe (current_function_decl))\n+\t    {\n+\t      tree t = build1 (NOP_EXPR, void_type_node, size_zero_node);\n+\t      SET_EXPR_LOCATION (t, gimple_location (stmt));\n+\t      TREE_BLOCK (t) = gimple_block (stmt);\n+\t      error (\"%Kasm not allowed in %<transaction_safe%> function\", t);\n+\t    }\n \t  return true;\n \n \tdefault:"}]}