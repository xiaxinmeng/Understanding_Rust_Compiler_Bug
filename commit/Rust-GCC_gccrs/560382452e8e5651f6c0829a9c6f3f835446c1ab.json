{"sha": "560382452e8e5651f6c0829a9c6f3f835446c1ab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTYwMzgyNDUyZThlNTY1MWY2YzA4MjlhOWM2ZjNmODM1NDQ2YzFhYg==", "commit": {"author": {"name": "Steven Bosscher", "email": "stevenb@suse.de", "date": "2005-12-21T15:28:16Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2005-12-21T15:28:16Z"}, "message": "patch for PR rtl-optimization/25130\n\ngcc/\n        * postreload-gcse.c (record_last_set_info): Notice stack pointer\n        changes in push insns without REG_INC notes.\n\ntestsuite/\n        * gcc.dg/pr25130.c: New test.\n\nFrom-SVN: r108906", "tree": {"sha": "4f288befddb9d14189f3a940fb389582659ff8ec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4f288befddb9d14189f3a940fb389582659ff8ec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/560382452e8e5651f6c0829a9c6f3f835446c1ab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/560382452e8e5651f6c0829a9c6f3f835446c1ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/560382452e8e5651f6c0829a9c6f3f835446c1ab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/560382452e8e5651f6c0829a9c6f3f835446c1ab/comments", "author": null, "committer": null, "parents": [{"sha": "46833406d17c0f2d88dc370118ab0d1fcf6fb2b2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/46833406d17c0f2d88dc370118ab0d1fcf6fb2b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/46833406d17c0f2d88dc370118ab0d1fcf6fb2b2"}], "stats": {"total": 61, "additions": 57, "deletions": 4}, "files": [{"sha": "2db3153e9109dfdb8348542068d4508b7ed9cff1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=560382452e8e5651f6c0829a9c6f3f835446c1ab", "patch": "@@ -1,3 +1,9 @@\n+2005-12-21  Steven Bosscher  <stevenb@suse.de>\n+\n+\tPR rtl-optimization/25130\n+\t* postreload-gcse.c (record_last_set_info): Notice stack pointer\n+\tchanges in push insns without REG_INC notes.\n+\n 2005-12-21  Kazu Hirata  <kazu@codesourcery.com>\n \n \tPR tree-optimization/25382."}, {"sha": "4fc66ec4ee6231bbc16f0397ef7a6f2d63abf7cf", "filename": "gcc/postreload-gcse.c", "status": "modified", "additions": 12, "deletions": 4, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2Fpostreload-gcse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2Fpostreload-gcse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpostreload-gcse.c?ref=560382452e8e5651f6c0829a9c6f3f835446c1ab", "patch": "@@ -671,10 +671,18 @@ record_last_set_info (rtx dest, rtx setter ATTRIBUTE_UNUSED, void *data)\n \n   if (REG_P (dest))\n     record_last_reg_set_info (last_set_insn, REGNO (dest));\n-  else if (MEM_P (dest)\n-\t   /* Ignore pushes, they clobber nothing.  */\n-\t   && ! push_operand (dest, GET_MODE (dest)))\n-    record_last_mem_set_info (last_set_insn);\n+  else if (MEM_P (dest))\n+    {\n+      /* Ignore pushes, they don't clobber memory.  They may still\n+\t clobber the stack pointer though.  Some targets do argument\n+\t pushes without adding REG_INC notes.  See e.g. PR25196,\n+\t where a pushsi2 on i386 doesn't have REG_INC notes.  Note\n+\t such changes here too.  */\n+      if (! push_operand (dest, GET_MODE (dest)))\n+\trecord_last_mem_set_info (last_set_insn);\n+      else\n+\trecord_last_reg_set_info (last_set_insn, STACK_POINTER_REGNUM);\n+    }\n }\n \n "}, {"sha": "fb9dd4898e1c9319f988261d087ec70eb6b7df35", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=560382452e8e5651f6c0829a9c6f3f835446c1ab", "patch": "@@ -1,3 +1,8 @@\n+2005-12-21  Steven Bosscher  <stevenb@suse.de>\n+\n+\tPR rtl-optimization/25130\n+\t* gcc.dg/pr25130.c: New test.\n+\n 2005-12-21  Erik Edelmann  <eedelman@gcc.gnu.org>\n \n \tPR fortran/25423"}, {"sha": "e73faffe7217d137d5036dfc5497cfeb039ef3f4", "filename": "gcc/testsuite/gcc.dg/pr25130.c", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2Ftestsuite%2Fgcc.dg%2Fpr25130.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/560382452e8e5651f6c0829a9c6f3f835446c1ab/gcc%2Ftestsuite%2Fgcc.dg%2Fpr25130.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr25130.c?ref=560382452e8e5651f6c0829a9c6f3f835446c1ab", "patch": "@@ -0,0 +1,34 @@\n+/* { dg-do run { target i?86-*-* x86_64-*-* } } */\n+/* { dg-require-effective-target ilp32 } */\n+/* { dg-options \"-march=i386 -O3 -fomit-frame-pointer\" } */\n+\n+/* For this test case, we used to do an invalid load motion after\n+   reload, because we missed autoincrements of the stack pointer.  */\n+\n+extern void abort (void);\n+\n+static int j;\n+\n+static void __attribute__((noinline))\n+f1 (int a, int b, int c, int d, int e)\n+{\n+  j = a;\n+}\n+\n+int __attribute__((noinline))\n+f2 (int a, int b, int c, int d, int e)\n+{\n+  if ((b & 0x1111) != 1)\n+    f1 (a, b, c, d, e);\n+  return 0;\n+}\n+\n+int\n+main (void)\n+{\n+  f2 (123, 0, 0, 0, 0);\n+  if (j != 123)\n+    abort ();\n+  return 0;\n+}\n+"}]}