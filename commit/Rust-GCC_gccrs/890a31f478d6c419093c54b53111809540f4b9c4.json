{"sha": "890a31f478d6c419093c54b53111809540f4b9c4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODkwYTMxZjQ3OGQ2YzQxOTA5M2M1NGI1MzExMTgwOTU0MGY0YjljNA==", "commit": {"author": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2000-09-04T16:55:48Z"}, "committer": {"name": "Anthony Green", "email": "green@gcc.gnu.org", "date": "2000-09-04T16:55:48Z"}, "message": "File.java (deleteOnExit): New method.\n\n\n        * java/io/File.java (deleteOnExit): New method.\n        * gnu/gcj/runtime/FileDeleter.java: New class.\n        * java/lang/natRuntime.cc (exit): Call\n        FileDeleter.deleteOnExitNow()\n        * Makefile.am: Add FileDeleter.java.\n        * Makefile.in: Rebuilt.\n\nFrom-SVN: r36141", "tree": {"sha": "0e11c3202467de16f9293623c00841fbe6ad2149", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0e11c3202467de16f9293623c00841fbe6ad2149"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/890a31f478d6c419093c54b53111809540f4b9c4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/890a31f478d6c419093c54b53111809540f4b9c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/890a31f478d6c419093c54b53111809540f4b9c4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/890a31f478d6c419093c54b53111809540f4b9c4/comments", "author": null, "committer": null, "parents": [{"sha": "4993ddc14f3be5f5a4c858b16f237602262ba360", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4993ddc14f3be5f5a4c858b16f237602262ba360", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4993ddc14f3be5f5a4c858b16f237602262ba360"}], "stats": {"total": 62, "additions": 60, "deletions": 2}, "files": [{"sha": "db05b63aea227f8810bae9e2403b6e148ed127b3", "filename": "libjava/Makefile.am", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2FMakefile.am", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2FMakefile.am", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.am?ref=890a31f478d6c419093c54b53111809540f4b9c4", "patch": "@@ -733,6 +733,7 @@ gnu/gcj/protocol/http/Connection.java \\\n gnu/gcj/protocol/http/Handler.java \\\n gnu/gcj/protocol/jar/Connection.java \\\n gnu/gcj/protocol/jar/Handler.java \\\n+gnu/gcj/runtime/FileDeleter.java \\\n gnu/gcj/runtime/FirstThread.java \\\n gnu/gcj/runtime/VMClassLoader.java \\\n gnu/gcj/text/BaseBreakIterator.java \\"}, {"sha": "84385b83a8a8c8d53981d3020c7a0d5e4a5dbc89", "filename": "libjava/Makefile.in", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FMakefile.in?ref=890a31f478d6c419093c54b53111809540f4b9c4", "patch": "@@ -521,6 +521,7 @@ gnu/gcj/protocol/http/Connection.java \\\n gnu/gcj/protocol/http/Handler.java \\\n gnu/gcj/protocol/jar/Connection.java \\\n gnu/gcj/protocol/jar/Handler.java \\\n+gnu/gcj/runtime/FileDeleter.java \\\n gnu/gcj/runtime/FirstThread.java \\\n gnu/gcj/runtime/VMClassLoader.java \\\n gnu/gcj/text/BaseBreakIterator.java \\\n@@ -1084,7 +1085,7 @@ DEP_FILES =  .deps/$(srcdir)/$(CONVERT_DIR)/gen-from-JIS.P \\\n .deps/gnu/gcj/protocol/http/Handler.P \\\n .deps/gnu/gcj/protocol/jar/Connection.P \\\n .deps/gnu/gcj/protocol/jar/Handler.P \\\n-.deps/gnu/gcj/runtime/FirstThread.P \\\n+.deps/gnu/gcj/runtime/FileDeleter.P .deps/gnu/gcj/runtime/FirstThread.P \\\n .deps/gnu/gcj/runtime/VMClassLoader.P \\\n .deps/gnu/gcj/text/BaseBreakIterator.P \\\n .deps/gnu/gcj/text/CharacterBreakIterator.P \\"}, {"sha": "cc7aa9d50b7d767919307afbba4b2ef196099765", "filename": "libjava/gnu/gcj/runtime/FileDeleter.java", "status": "added", "additions": 38, "deletions": 0, "changes": 38, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2Fgnu%2Fgcj%2Fruntime%2FFileDeleter.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2Fgnu%2Fgcj%2Fruntime%2FFileDeleter.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fgnu%2Fgcj%2Fruntime%2FFileDeleter.java?ref=890a31f478d6c419093c54b53111809540f4b9c4", "patch": "@@ -0,0 +1,38 @@\n+/* Copyright (C) 2000  Free Software Foundation\n+\n+   This file is part of libgcj.\n+\n+This software is copyrighted work licensed under the terms of the\n+Libgcj License.  Please consult the file \"LIBGCJ_LICENSE\" for\n+details.  */\n+\n+package gnu.gcj.runtime;\n+\n+import java.io.*;\n+import java.util.*;\n+\n+public final class FileDeleter\n+{\n+  public synchronized static void add (File f)\n+  {\n+    if (deleteOnExitStack == null)\n+      deleteOnExitStack = new Stack ();\n+\n+    deleteOnExitStack.push (f);\n+  }\n+\n+  // Helper method called by java.lang.Runtime.exit() to perform\n+  // pending deletions.\n+  public static void deleteOnExitNow ()\n+  {\n+    while (!deleteOnExitStack.empty ())\n+      ((File)(deleteOnExitStack.pop ())).delete ();\n+  }\n+\n+  // A stack of files to delete upon normal termination.\n+  private static Stack deleteOnExitStack;\n+}\n+\n+\n+\n+"}, {"sha": "9043660be382bcb359185c39818a4eb2a4343cfc", "filename": "libjava/java/io/File.java", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2Fjava%2Fio%2FFile.java", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2Fjava%2Fio%2FFile.java", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Fio%2FFile.java?ref=890a31f478d6c419093c54b53111809540f4b9c4", "patch": "@@ -10,6 +10,9 @@\n \n package java.io;\n \n+import java.util.*;\n+import gnu.gcj.runtime.FileDeleter;\n+\n /**\n  * @author Tom Tromey <tromey@cygnus.com>\n  * @date September 24, 1998 \n@@ -42,7 +45,7 @@ public boolean canWrite ()\n     return access (p, WRITE);\n   }\n \n-  private final native boolean performDelete (String canon);\n+  private final native static boolean performDelete (String canon);\n   public boolean delete ()\n   {\n     SecurityManager s = System.getSecurityManager();\n@@ -347,6 +350,17 @@ private final String safeCanonicalPath ()\n     return p;\n   }\n \n+  // Add this File to the set of files to be deleted upon normal\n+  // termination.\n+  public void deleteOnExit ()\n+  {\n+    SecurityManager sm = System.getSecurityManager ();\n+    if (sm != null)\n+      sm.checkDelete (getName ());\n+\n+    FileDeleter.add (this);\n+  }\n+\n   // QUERY arguments to access function.\n   private final static int READ = 0;\n   private final static int WRITE = 1;"}, {"sha": "93771651afeda2a7dcba24cd6ab94e81b4a20726", "filename": "libjava/java/lang/natRuntime.cc", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2Fjava%2Flang%2FnatRuntime.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/890a31f478d6c419093c54b53111809540f4b9c4/libjava%2Fjava%2Flang%2FnatRuntime.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjava%2Flang%2FnatRuntime.cc?ref=890a31f478d6c419093c54b53111809540f4b9c4", "patch": "@@ -17,6 +17,7 @@ details.  */\n #include <java/lang/Runtime.h>\n #include <java/lang/UnknownError.h>\n #include <java/lang/UnsatisfiedLinkError.h>\n+#include <gnu/gcj/runtime/FileDeleter.h>\n \n #include <jni.h>\n \n@@ -85,6 +86,9 @@ java::lang::Runtime::exit (jint status)\n   if (finalize_on_exit)\n     _Jv_RunAllFinalizers ();\n \n+  // Delete all files registered with File.deleteOnExit()\n+  gnu::gcj::runtime::FileDeleter::deleteOnExitNow ();\n+\n   ::exit (status);\n }\n "}]}