{"sha": "d168da7484c329c59021cadbd34c24844c6466ce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDE2OGRhNzQ4NGMzMjljNTkwMjFjYWRiZDM0YzI0ODQ0YzY0NjZjZQ==", "commit": {"author": {"name": "Andreas Tobler", "email": "a.tobler@schweiz.ch", "date": "2004-06-26T03:44:38Z"}, "committer": {"name": "Andreas Tobler", "email": "andreast@gcc.gnu.org", "date": "2004-06-26T03:44:38Z"}, "message": "2004-06-26  Andreas Tobler  <a.tobler@schweiz.ch>\n\n\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.c\n\t(init_dpi_conversion_factor): Check for int_dpi < 0 in case gtk-xft-dpi\n\tcan not calculate the right value.\n\t(dpi_changed_cb): Likewise. Mark *pspec as unused.\n\nFrom-SVN: r83698", "tree": {"sha": "ba85060c1345d035e7dba23afbe33feb8bbaafce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ba85060c1345d035e7dba23afbe33feb8bbaafce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d168da7484c329c59021cadbd34c24844c6466ce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d168da7484c329c59021cadbd34c24844c6466ce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d168da7484c329c59021cadbd34c24844c6466ce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d168da7484c329c59021cadbd34c24844c6466ce/comments", "author": null, "committer": null, "parents": [{"sha": "c520979797bed1c58f0873f11b8ec1105341fec6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c520979797bed1c58f0873f11b8ec1105341fec6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c520979797bed1c58f0873f11b8ec1105341fec6"}], "stats": {"total": 24, "additions": 20, "deletions": 4}, "files": [{"sha": "cf9ae71ee3ed8be42340e9f034bf77e44e67ec5d", "filename": "libjava/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d168da7484c329c59021cadbd34c24844c6466ce/libjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d168da7484c329c59021cadbd34c24844c6466ce/libjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2FChangeLog?ref=d168da7484c329c59021cadbd34c24844c6466ce", "patch": "@@ -1,3 +1,10 @@\n+2004-06-26  Andreas Tobler  <a.tobler@schweiz.ch>\n+\n+\t* jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.c\n+\t(init_dpi_conversion_factor): Check for int_dpi < 0 in case gtk-xft-dpi\n+\tcan not calculate the right value.\n+\t(dpi_changed_cb): Likewise. Mark *pspec as unused.\n+\n 2004-06-24  Bryce McKinlay  <mckinlay@redhat.com>\n \n \t* testsuite/libjava.jacks/jacks.xfail: Remove"}, {"sha": "fdd4253125178576fed14707c9dfe4022bccd3ed", "filename": "libjava/jni/gtk-peer/gnu_java_awt_peer_gtk_GtkMainThread.c", "status": "modified", "additions": 13, "deletions": 4, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d168da7484c329c59021cadbd34c24844c6466ce/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkMainThread.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d168da7484c329c59021cadbd34c24844c6466ce/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkMainThread.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Fjni%2Fgtk-peer%2Fgnu_java_awt_peer_gtk_GtkMainThread.c?ref=d168da7484c329c59021cadbd34c24844c6466ce", "patch": "@@ -231,9 +231,15 @@ init_dpi_conversion_factor ()\n     {\n       int int_dpi;\n       g_object_get (settings, \"gtk-xft-dpi\", &int_dpi, NULL);\n-      dpi_conversion_factor = PANGO_SCALE * 72.0 / (int_dpi / PANGO_SCALE);\n+      /* If int_dpi == -1 gtk-xft-dpi returns the default value. So we\n+\t have to do approximate calculation here.  */\n+      if (int_dpi < 0)\n+\tdpi_conversion_factor = PANGO_SCALE * 72.0 / 96.;\n+      else\n+\tdpi_conversion_factor = PANGO_SCALE * 72.0 / (int_dpi / PANGO_SCALE);\n+\n       g_signal_connect (settings, \"notify::gtk-xft-dpi\",\n-                        G_CALLBACK (dpi_changed_cb), NULL);\n+\t\t\tG_CALLBACK (dpi_changed_cb), NULL);\n     }\n   else\n     /* Approximate. */\n@@ -242,9 +248,12 @@ init_dpi_conversion_factor ()\n \n static void\n dpi_changed_cb (GtkSettings  *settings,\n-                GParamSpec   *pspec)\n+\t\tGParamSpec *pspec __attribute__((unused)))\n {\n   int int_dpi;\n   g_object_get (settings, \"gtk-xft-dpi\", &int_dpi, NULL);\n-  dpi_conversion_factor = PANGO_SCALE * 72.0 / (int_dpi / PANGO_SCALE);\n+  if (int_dpi < 0)\n+    dpi_conversion_factor = PANGO_SCALE * 72.0 / 96.;\n+  else\n+    dpi_conversion_factor = PANGO_SCALE * 72.0 / (int_dpi / PANGO_SCALE);\n }"}]}