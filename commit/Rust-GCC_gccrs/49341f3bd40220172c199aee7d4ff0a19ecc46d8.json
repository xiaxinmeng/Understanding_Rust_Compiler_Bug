{"sha": "49341f3bd40220172c199aee7d4ff0a19ecc46d8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDkzNDFmM2JkNDAyMjAxNzJjMTk5YWVlN2Q0ZmYwYTE5ZWNjNDZkOA==", "commit": {"author": {"name": "Alexandre Oliva", "email": "oliva@adacore.com", "date": "2020-07-24T18:38:42Z"}, "committer": {"name": "Alexandre Oliva", "email": "oliva@gnu.org", "date": "2020-07-24T19:13:53Z"}, "message": "add offload target to testname for pass/fail message\n\nOffload tests that scan dump files may run multiple times, once per\noffload target, but the test result messages do not mention the\noffload target, so we may seem to have repeated results.  Fixed by\nmodifying the test name so that it contains the offload target name.\n\n\nCo-Authored-By: Thomas Schwinge <thomas@codesourcery.com>\nfor  gcc/testsuite/ChangeLog\n\n\t* lib/scanoffload.exp (scoff-testname, scoff-adjust): New.\n\t(scoff): Call them.", "tree": {"sha": "aa0219b966a83a3bab565a3d5d50f73dd92fbf67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aa0219b966a83a3bab565a3d5d50f73dd92fbf67"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/49341f3bd40220172c199aee7d4ff0a19ecc46d8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49341f3bd40220172c199aee7d4ff0a19ecc46d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/49341f3bd40220172c199aee7d4ff0a19ecc46d8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/49341f3bd40220172c199aee7d4ff0a19ecc46d8/comments", "author": null, "committer": null, "parents": [{"sha": "0e3ad7e4d030b5bd3598cd3955947e3130a24339", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e3ad7e4d030b5bd3598cd3955947e3130a24339", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0e3ad7e4d030b5bd3598cd3955947e3130a24339"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "90717698776fb108a603f1ef4f434564a3abb398", "filename": "gcc/testsuite/lib/scanoffload.exp", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/49341f3bd40220172c199aee7d4ff0a19ecc46d8/gcc%2Ftestsuite%2Flib%2Fscanoffload.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/49341f3bd40220172c199aee7d4ff0a19ecc46d8/gcc%2Ftestsuite%2Flib%2Fscanoffload.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fscanoffload.exp?ref=49341f3bd40220172c199aee7d4ff0a19ecc46d8", "patch": "@@ -22,6 +22,19 @@ proc scoff-format { offtgt suffix } {\n     return \".x$offtgt.mkoffload$suffix\"\n }\n \n+# Adjust an offload dump TESTNAME for offload TARGET.\n+proc scoff-testname { target testname } {\n+    return \"$target-$testname\"\n+}\n+\n+# Adjust the arglist ARGS, so that argument IDX gets scoff-formatted,\n+# and argument 0 (the test name) gets scoff-testnamed.\n+proc scoff-adjust { args idx target } {\n+    lset args $idx \"[scoff-format $target [lindex $args $idx]]\"\n+    lset args 0 \"[scoff-testname $target [lindex $args 0]]\"\n+    return $args\n+}\n+\n # Wrapper for scan procs.\n # Argument 0 is the index of the argument to replace when calling\n # argument 1 with the remaining arguments.  Use end-1 or end or so.\n@@ -34,15 +47,15 @@ proc scoff { args } {\n     if [info exists offload_target] {\n \tset target $offload_target\n \tif { \"$target\" != \"disable\" } {\n-\t    eval $prc [lreplace $args $idx $idx \"[scoff-format $target [lindex $args $idx]]\"]\n+\t    eval $prc [scoff-adjust $args $idx $target]\n \t}\n     } else {\n \tglobal offload_targets\n \tforeach target [split $offload_targets \",\"] {\n \t    # HSA offloading is doing things differently, doesn't use 'mkoffload'.\n \t    if { \"$target\" == \"hsa\" } continue\n \n-\t    eval $prc [lreplace $args $idx $idx \"[scoff-format $target [lindex $args $idx]]\"]\n+\t    eval $prc [scoff-adjust $args $idx $target]\n \t}\n     }\n }"}]}