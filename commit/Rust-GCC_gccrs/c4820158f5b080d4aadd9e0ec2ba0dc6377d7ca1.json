{"sha": "c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzQ4MjAxNThmNWIwODBkNGFhZGQ5ZTBlYzJiYTBkYzYzNzdkN2NhMQ==", "commit": {"author": {"name": "Nicolas Setton", "email": "setton@act-europe.fr", "date": "2004-10-27T12:27:53Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2004-10-27T12:27:53Z"}, "message": "mlib-tgt-darwin.adb: New file.\n\n2004-10-26  Nicolas Setton  <setton@act-europe.fr>\n\n\t* mlib-tgt-darwin.adb: New file.\n\n\t* mlib-tgt-tru64.adb, mlib-tgt-aix.adb, mlib-tgt-irix.adb,\n\tmlib-tgt-hpux.adb, mlib-tgt-linux.adb, mlib-tgt-solaris.adb,\n\tmlib-tgt-vms-alpha.adb, mlib-tgt-vms-ia64.adb,\n\tmlib-tgt-mingw.adb, mlib-tgt-vxworks.adb (Archive_Indexer_Options): New\n\tsubprogram body.\n\n\t* Makefile.in: Add support for building shared libraries under Darwin.\n\t(EXTRA_GNATRTL_NONTASKING_OBJS, ppc-vxworks): Add s-vxwexc.o, containing\n\tthe low level EH init subprogram to be called from __gnat_initialize.\n\n\t* mlib-tgt.ads, mlib-tgt.adb (Archive_Indexer_Options): New subprogram,\n\tindicates which options to pass to the archive indexer.\n\n\t* mlib-utl.adb: Add support for calling ranlib with additional\n\toptions. This is needed for instance under Mac OS X.\n\t(Ranlib_Options): New global variable, used to store the potential\n\toptions to pass to ranlib.\n\t(Ar): Use Ranlib_Options when spawning ranlib.\n\t(Initialize): Set the value of ranlib option.\n\nFrom-SVN: r89639", "tree": {"sha": "b10661d75b3825e90616a0f19dcab901c24cc3d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b10661d75b3825e90616a0f19dcab901c24cc3d5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/comments", "author": {"login": "setton", "id": 96973, "node_id": "MDQ6VXNlcjk2OTcz", "avatar_url": "https://avatars.githubusercontent.com/u/96973?v=4", "gravatar_id": "", "url": "https://api.github.com/users/setton", "html_url": "https://github.com/setton", "followers_url": "https://api.github.com/users/setton/followers", "following_url": "https://api.github.com/users/setton/following{/other_user}", "gists_url": "https://api.github.com/users/setton/gists{/gist_id}", "starred_url": "https://api.github.com/users/setton/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/setton/subscriptions", "organizations_url": "https://api.github.com/users/setton/orgs", "repos_url": "https://api.github.com/users/setton/repos", "events_url": "https://api.github.com/users/setton/events{/privacy}", "received_events_url": "https://api.github.com/users/setton/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "41cbab340832a48787eee35753755f2b3f4ec8fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/41cbab340832a48787eee35753755f2b3f4ec8fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/41cbab340832a48787eee35753755f2b3f4ec8fd"}], "stats": {"total": 521, "additions": 511, "deletions": 10}, "files": [{"sha": "45737fa0d0bb26b06d2cd2d7f5913ce87f5b6afb", "filename": "gcc/ada/Makefile.in", "status": "modified", "additions": 31, "deletions": 1, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FMakefile.in?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -559,7 +559,7 @@ ifeq ($(strip $(filter-out powerpc% wrs vxworks,$(targ))),)\n     s-tfsetr.adb<s-tfsetr-vxworks.adb \n   endif\n \n-  EXTRA_GNATRTL_NONTASKING_OBJS=i-vxwork.o i-vxwoio.o\n+  EXTRA_GNATRTL_NONTASKING_OBJS=i-vxwork.o i-vxwoio.o s-vxwexc.o\n   EXTRA_GNATRTL_TASKING_OBJS=s-vxwork.o\n endif\n \n@@ -1403,6 +1403,14 @@ ifeq ($(strip $(filter-out powerpc darwin%,$(arch) $(osys))),)\n   s-tpopsp.adb<s-tpopsp-posix-foreign.adb \\\n   g-soccon.ads<g-soccon-aix.ads \\\n   system.ads<system-darwin-ppc.ads\n+\n+  TOOLS_TARGET_PAIRS =  \\\n+    mlib-tgt.adb<mlib-tgt-darwin.adb\n+\n+  GNATLIB_SHARED = gnatlib-shared-darwin\n+  SO_OPTS = -Wl,-flat_namespace\n+  RANLIB = ranlib -c\n+  LIBRARY_VERSION := $(LIB_VERSION)\n endif\n \n # The runtime library for gnat comprises two directories.  One contains the\n@@ -1874,6 +1882,28 @@ gnatlib-shared-win32:\n \t\t$(SO_OPTS)libgnarl$(hyphen)$(LIBRARY_VERSION)$(soext) \\\n \t\t$(THREADSLIB) -Wl,libgnat$(hyphen)$(LIBRARY_VERSION)$(soext)\n \n+gnatlib-shared-darwin:\n+\t$(MAKE) $(FLAGS_TO_PASS) \\\n+\t     GNATLIBFLAGS=\"$(GNATLIBFLAGS)\" \\\n+\t     GNATLIBCFLAGS=\"$(GNATLIBCFLAGS) $(TARGET_LIBGCC2_CFLAGS)\" \\\n+\t     THREAD_KIND=\"$(THREAD_KIND)\" \\\n+\t     gnatlib\n+\t$(RM) rts/libgnat$(soext) rts/libgnarl$(soext)\n+\tcd rts; ../../xgcc -B../../ -dynamiclib $(TARGET_LIBGCC2_CFLAGS) \\\n+\t\t-o libgnat$(hyphen)$(LIBRARY_VERSION)$(soext) \\\n+\t\t$(GNATRTL_NONTASKING_OBJS) $(LIBGNAT_OBJS) \\\n+\t\t$(SO_OPTS) \\\n+\t\t$(MISCLIB) -lm\n+\tcd rts; ../../xgcc -B../../ -dynamiclib $(TARGET_LIBGCC2_CFLAGS) \\\n+\t\t-o libgnarl$(hyphen)$(LIBRARY_VERSION)$(soext) \\\n+\t\t$(GNATRTL_TASKING_OBJS) \\\n+\t\t$(SO_OPTS) \\\n+\t\t$(THREADSLIB) -Wl,libgnat$(hyphen)$(LIBRARY_VERSION)$(soext)\n+\tcd rts; $(LN_S) libgnat$(hyphen)$(LIBRARY_VERSION)$(soext) \\\n+\t\tlibgnat$(soext)\n+\tcd rts; $(LN_S) libgnarl$(hyphen)$(LIBRARY_VERSION)$(soext) \\\n+\t\tlibgnarl$(soext)\n+\n gnatlib-shared-vms:\n \t$(MAKE) $(FLAGS_TO_PASS) \\\n              GNATLIBFLAGS=\"$(GNATLIBFLAGS)\" \\"}, {"sha": "004cab8b9ade20d393e61d3f7e13fbb9f316001e", "filename": "gcc/ada/mlib-tgt-aix.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-aix.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-aix.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-aix.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -110,6 +110,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "96a41e4d03c8e04710fb6b837ececa2e3cf745ed", "filename": "gcc/ada/mlib-tgt-darwin.adb", "status": "added", "additions": 366, "deletions": 0, "changes": 366, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-darwin.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-darwin.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-darwin.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -0,0 +1,366 @@\n+------------------------------------------------------------------------------\n+--                                                                          --\n+--                         GNAT COMPILER COMPONENTS                         --\n+--                                                                          --\n+--                             M L I B . T G T                              --\n+--                             (Darwin Version)                             --\n+--                                                                          --\n+--                                 B o d y                                  --\n+--                                                                          --\n+--              Copyright (C) 2001-2004, Free Software Foundation, Inc.     --\n+--                                                                          --\n+-- GNAT is free software;  you can  redistribute it  and/or modify it under --\n+-- terms of the  GNU General Public License as published  by the Free Soft- --\n+-- ware  Foundation;  either version 2,  or (at your option) any later ver- --\n+-- sion.  GNAT is distributed in the hope that it will be useful, but WITH- --\n+-- OUT ANY WARRANTY;  without even the  implied warranty of MERCHANTABILITY --\n+-- or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License --\n+-- for  more details.  You should have  received  a copy of the GNU General --\n+-- Public License  distributed with GNAT;  see file COPYING.  If not, write --\n+-- to  the Free Software Foundation,  59 Temple Place - Suite 330,  Boston, --\n+-- MA 02111-1307, USA.                                                      --\n+--                                                                          --\n+-- GNAT was originally developed  by the GNAT team at  New York University. --\n+-- Extensive contributions were provided by Ada Core Technologies Inc.      --\n+--                                                                          --\n+------------------------------------------------------------------------------\n+\n+--  This package provides a set of target dependent routines to build\n+--  static, dynamic and shared libraries.\n+\n+--  This is the Darwin version of the body.\n+\n+with MLib.Fil;\n+with MLib.Utl;\n+with Namet;  use Namet;\n+with Opt;\n+with Output; use Output;\n+with Prj.Com;\n+with System;\n+\n+package body MLib.Tgt is\n+\n+   use GNAT;\n+   use MLib;\n+\n+   No_Arguments        : aliased Argument_List         := (1 .. 0 => null);\n+   Empty_Argument_List : constant Argument_List_Access := No_Arguments'Access;\n+\n+   Wl_Init_String : aliased String         := \"-Wl,-init\";\n+   Wl_Init        : constant String_Access := Wl_Init_String'Access;\n+   Wl_Fini_String : aliased String         := \"-Wl,-fini\";\n+   Wl_Fini        : constant String_Access := Wl_Fini_String'Access;\n+\n+   Init_Fini_List :  constant Argument_List_Access :=\n+                       new Argument_List'(1 => Wl_Init,\n+                                          2 => null,\n+                                          3 => Wl_Fini,\n+                                          4 => null);\n+   --  Used to put switches for automatic elaboration/finalization\n+\n+   ---------------------\n+   -- Archive_Builder --\n+   ---------------------\n+\n+   function Archive_Builder return String is\n+   begin\n+      return \"ar\";\n+   end Archive_Builder;\n+\n+   -----------------------------\n+   -- Archive_Builder_Options --\n+   -----------------------------\n+\n+   function Archive_Builder_Options return String_List_Access is\n+   begin\n+      return new String_List'(1 => new String'(\"cr\"));\n+   end Archive_Builder_Options;\n+\n+   -----------------\n+   -- Archive_Ext --\n+   -----------------\n+\n+   function Archive_Ext return  String is\n+   begin\n+      return \"a\";\n+   end Archive_Ext;\n+\n+   ---------------------\n+   -- Archive_Indexer --\n+   ---------------------\n+\n+   function Archive_Indexer return String is\n+   begin\n+      return \"ranlib\";\n+   end Archive_Indexer;\n+\n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List'(1 => new String'(\"-c\"));\n+   end Archive_Indexer_Options;\n+\n+   ---------------------------\n+   -- Build_Dynamic_Library --\n+   ---------------------------\n+\n+   procedure Build_Dynamic_Library\n+     (Ofiles       : Argument_List;\n+      Foreign      : Argument_List;\n+      Afiles       : Argument_List;\n+      Options      : Argument_List;\n+      Options_2    : Argument_List;\n+      Interfaces   : Argument_List;\n+      Lib_Filename : String;\n+      Lib_Dir      : String;\n+      Symbol_Data  : Symbol_Record;\n+      Driver_Name  : Name_Id := No_Name;\n+      Lib_Version  : String  := \"\";\n+      Auto_Init    : Boolean := False)\n+   is\n+      pragma Unreferenced (Foreign);\n+      pragma Unreferenced (Afiles);\n+      pragma Unreferenced (Interfaces);\n+      pragma Unreferenced (Symbol_Data);\n+\n+      Lib_File : constant String :=\n+                   Lib_Dir & Directory_Separator & \"lib\" &\n+                   Fil.Ext_To (Lib_Filename, DLL_Ext);\n+\n+      Version_Arg          : String_Access;\n+      Symbolic_Link_Needed : Boolean := False;\n+\n+      Init_Fini : Argument_List_Access := Empty_Argument_List;\n+\n+   begin\n+      if Opt.Verbose_Mode then\n+         Write_Str (\"building relocatable shared library \");\n+         Write_Line (Lib_File);\n+      end if;\n+\n+      --  If specified, add automatic elaboration/finalization\n+\n+      if Auto_Init then\n+         Init_Fini := Init_Fini_List;\n+         Init_Fini (2) := new String'(\"-Wl,\" & Lib_Filename & \"init\");\n+         Init_Fini (4) := new String'(\"-Wl,\" & Lib_Filename & \"final\");\n+      end if;\n+\n+      if Lib_Version = \"\" then\n+         Utl.Gcc\n+           (Output_File => Lib_File,\n+            Objects     => Ofiles,\n+            Options     => Options & Init_Fini.all,\n+            Driver_Name => Driver_Name,\n+            Options_2   => Options_2);\n+\n+      else\n+         Version_Arg := new String'(\"-Wl,-flat_namespace\"); -- ???\n+\n+         if Is_Absolute_Path (Lib_Version) then\n+            Utl.Gcc\n+              (Output_File => Lib_Version,\n+               Objects     => Ofiles,\n+               Options     => Options & Version_Arg & Init_Fini.all,\n+               Driver_Name => Driver_Name,\n+               Options_2   => Options_2);\n+            Symbolic_Link_Needed := Lib_Version /= Lib_File;\n+\n+         else\n+            Utl.Gcc\n+              (Output_File => Lib_Dir & Directory_Separator & Lib_Version,\n+               Objects     => Ofiles,\n+               Options     => Options & Version_Arg & Init_Fini.all,\n+               Driver_Name => Driver_Name,\n+               Options_2   => Options_2);\n+            Symbolic_Link_Needed :=\n+              Lib_Dir & Directory_Separator & Lib_Version /= Lib_File;\n+         end if;\n+\n+         if Symbolic_Link_Needed then\n+            declare\n+               Success : Boolean;\n+               Oldpath : String (1 .. Lib_Version'Length + 1);\n+               Newpath : String (1 .. Lib_File'Length + 1);\n+\n+               Result : Integer;\n+               pragma Unreferenced (Result);\n+\n+               function Symlink\n+                 (Oldpath : System.Address;\n+                  Newpath : System.Address) return Integer;\n+               pragma Import (C, Symlink, \"__gnat_symlink\");\n+\n+            begin\n+               Oldpath (1 .. Lib_Version'Length) := Lib_Version;\n+               Oldpath (Oldpath'Last)            := ASCII.NUL;\n+               Newpath (1 .. Lib_File'Length)    := Lib_File;\n+               Newpath (Newpath'Last)            := ASCII.NUL;\n+\n+               Delete_File (Lib_File, Success);\n+\n+               Result := Symlink (Oldpath'Address, Newpath'Address);\n+            end;\n+         end if;\n+      end if;\n+   end Build_Dynamic_Library;\n+\n+   -------------\n+   -- DLL_Ext --\n+   -------------\n+\n+   function DLL_Ext return String is\n+   begin\n+      return \"dylib\";\n+   end DLL_Ext;\n+\n+   --------------------\n+   -- Dynamic_Option --\n+   --------------------\n+\n+   function Dynamic_Option return String is\n+   begin\n+      return \"-dynamiclib\";\n+   end Dynamic_Option;\n+\n+   -------------------\n+   -- Is_Object_Ext --\n+   -------------------\n+\n+   function Is_Object_Ext (Ext : String) return Boolean is\n+   begin\n+      return Ext = \".o\";\n+   end Is_Object_Ext;\n+\n+   --------------\n+   -- Is_C_Ext --\n+   --------------\n+\n+   function Is_C_Ext (Ext : String) return Boolean is\n+   begin\n+      return Ext = \".c\";\n+   end Is_C_Ext;\n+\n+   --------------------\n+   -- Is_Archive_Ext --\n+   --------------------\n+\n+   function Is_Archive_Ext (Ext : String) return Boolean is\n+   begin\n+      return Ext = \".a\" or else Ext = \".dyld\";\n+   end Is_Archive_Ext;\n+\n+   -------------\n+   -- Libgnat --\n+   -------------\n+\n+   function Libgnat return String is\n+   begin\n+      return \"libgnat.a\";\n+   end Libgnat;\n+\n+   ------------------------\n+   -- Library_Exists_For --\n+   ------------------------\n+\n+   function Library_Exists_For (Project : Project_Id) return Boolean is\n+   begin\n+      if not Projects.Table (Project).Library then\n+         Prj.Com.Fail (\"INTERNAL ERROR: Library_Exists_For called \" &\n+                       \"for non library project\");\n+         return False;\n+\n+      else\n+         declare\n+            Lib_Dir : constant String :=\n+              Get_Name_String (Projects.Table (Project).Library_Dir);\n+            Lib_Name : constant String :=\n+              Get_Name_String (Projects.Table (Project).Library_Name);\n+\n+         begin\n+            if Projects.Table (Project).Library_Kind = Static then\n+               return Is_Regular_File\n+                 (Lib_Dir & Directory_Separator & \"lib\" &\n+                  Fil.Ext_To (Lib_Name, Archive_Ext));\n+\n+            else\n+               return Is_Regular_File\n+                 (Lib_Dir & Directory_Separator & \"lib\" &\n+                  Fil.Ext_To (Lib_Name, DLL_Ext));\n+            end if;\n+         end;\n+      end if;\n+   end Library_Exists_For;\n+\n+   ---------------------------\n+   -- Library_File_Name_For --\n+   ---------------------------\n+\n+   function Library_File_Name_For (Project : Project_Id) return Name_Id is\n+   begin\n+      if not Projects.Table (Project).Library then\n+         Prj.Com.Fail (\"INTERNAL ERROR: Library_File_Name_For called \" &\n+                       \"for non library project\");\n+         return No_Name;\n+\n+      else\n+         declare\n+            Lib_Name : constant String :=\n+              Get_Name_String (Projects.Table (Project).Library_Name);\n+\n+         begin\n+            Name_Len := 3;\n+            Name_Buffer (1 .. Name_Len) := \"lib\";\n+\n+            if Projects.Table (Project).Library_Kind = Static then\n+               Add_Str_To_Name_Buffer (Fil.Ext_To (Lib_Name, Archive_Ext));\n+\n+            else\n+               Add_Str_To_Name_Buffer (Fil.Ext_To (Lib_Name, DLL_Ext));\n+            end if;\n+\n+            return Name_Find;\n+         end;\n+      end if;\n+   end Library_File_Name_For;\n+\n+   ----------------\n+   -- Object_Ext --\n+   ----------------\n+\n+   function Object_Ext return String is\n+   begin\n+      return \"o\";\n+   end Object_Ext;\n+\n+   ----------------\n+   -- PIC_Option --\n+   ----------------\n+\n+   function PIC_Option return String is\n+   begin\n+      return \"-fPIC\";\n+   end PIC_Option;\n+\n+   -----------------------------------------------\n+   -- Standalone_Library_Auto_Init_Is_Supported --\n+   -----------------------------------------------\n+\n+   function Standalone_Library_Auto_Init_Is_Supported return Boolean is\n+   begin\n+      return True;\n+   end Standalone_Library_Auto_Init_Is_Supported;\n+\n+   ---------------------------\n+   -- Support_For_Libraries --\n+   ---------------------------\n+\n+   function Support_For_Libraries return Library_Support is\n+   begin\n+      return Full;\n+   end Support_For_Libraries;\n+\n+end MLib.Tgt;"}, {"sha": "d10becf04cb0bdcc84e640e1c1842e0c9c872139", "filename": "gcc/ada/mlib-tgt-hpux.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-hpux.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-hpux.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-hpux.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -90,6 +90,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "eee46a1febae5898f1c71973b318ab447f77f97a", "filename": "gcc/ada/mlib-tgt-irix.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-irix.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-irix.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-irix.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -91,6 +91,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "71584f26a3a2108f4da064801c5ed96712f4d40d", "filename": "gcc/ada/mlib-tgt-linux.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-linux.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-linux.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-linux.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -94,6 +94,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "140bbccff997c1a53191858abe615f8ddc78cc45", "filename": "gcc/ada/mlib-tgt-mingw.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-mingw.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-mingw.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-mingw.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -82,6 +82,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "7f588dd8b6ab97a32330f47e89168f3171bf024b", "filename": "gcc/ada/mlib-tgt-solaris.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-solaris.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-solaris.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-solaris.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -88,6 +88,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "37f961ad4851e7793e8f910ae700d5e6b286d938", "filename": "gcc/ada/mlib-tgt-tru64.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-tru64.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-tru64.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-tru64.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -96,6 +96,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "bf96371c51519e86165631ac2df38245f19de2d1", "filename": "gcc/ada/mlib-tgt-vms-alpha.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-vms-alpha.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-vms-alpha.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-vms-alpha.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -118,6 +118,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "cad8ae1401b4281e8a23ce72bfcaa5fa9e01a8b2", "filename": "gcc/ada/mlib-tgt-vms-ia64.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-vms-ia64.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-vms-ia64.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-vms-ia64.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -118,6 +118,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "51b911afde592efeb17e9342cdc19a3f3ecaf82e", "filename": "gcc/ada/mlib-tgt-vxworks.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-vxworks.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt-vxworks.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt-vxworks.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -81,6 +81,15 @@ package body MLib.Tgt is\n       return \"ranlib\" & Get_Target_Suffix;\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "267177ba91c65b63b712393104708afea490b525", "filename": "gcc/ada/mlib-tgt.adb", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -67,6 +67,15 @@ package body MLib.Tgt is\n       return \"ranlib\";\n    end Archive_Indexer;\n \n+   -----------------------------\n+   -- Archive_Indexer_Options --\n+   -----------------------------\n+\n+   function Archive_Indexer_Options return String_List_Access is\n+   begin\n+      return new String_List (1 .. 0);\n+   end Archive_Indexer_Options;\n+\n    ---------------------------\n    -- Build_Dynamic_Library --\n    ---------------------------"}, {"sha": "4373dee439d649cb1dded285f9350768a42fe1e7", "filename": "gcc/ada/mlib-tgt.ads", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-tgt.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-tgt.ads?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -64,6 +64,9 @@ package MLib.Tgt is\n    --  Returns the name of the program, if any, that generates an index\n    --  to the contents of an archive, usually \"ranlib\".\n \n+   function Archive_Indexer_Options return String_List_Access;\n+   --  A list of options to invoke the Archive_Indexer, usually empty.\n+\n    function Dynamic_Option return String;\n    --  gcc option to create a dynamic library.\n    --  For Unix, returns \"-shared\", for Windows returns \"-mdll\"."}, {"sha": "4d21c2fa8ea738fbadf6e9c0970c94597483f554", "filename": "gcc/ada/mlib-utl.adb", "status": "modified", "additions": 12, "deletions": 9, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-utl.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1/gcc%2Fada%2Fmlib-utl.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmlib-utl.adb?ref=c4820158f5b080d4aadd9e0ec2ba0dc6377d7ca1", "patch": "@@ -36,17 +36,18 @@ with GNAT;     use GNAT;\n \n package body MLib.Utl is\n \n-   Initialized   : Boolean := False;\n+   Initialized : Boolean := False;\n \n-   Gcc_Name      : constant String := \"gcc\";\n-   Gcc_Exec      : OS_Lib.String_Access;\n+   Gcc_Name : constant String := \"gcc\";\n+   Gcc_Exec : OS_Lib.String_Access;\n \n-   Ar_Name       : OS_Lib.String_Access;\n-   Ar_Exec       : OS_Lib.String_Access;\n-   Ar_Options    : OS_Lib.String_List_Access;\n+   Ar_Name    : OS_Lib.String_Access;\n+   Ar_Exec    : OS_Lib.String_Access;\n+   Ar_Options : OS_Lib.String_List_Access;\n \n-   Ranlib_Name   : OS_Lib.String_Access;\n-   Ranlib_Exec   : OS_Lib.String_Access := null;\n+   Ranlib_Name    : OS_Lib.String_Access;\n+   Ranlib_Exec    : OS_Lib.String_Access := null;\n+   Ranlib_Options : OS_Lib.String_List_Access := null;\n \n    procedure Initialize;\n    --  Look for the tools in the path and record the full path for each one\n@@ -116,7 +117,7 @@ package body MLib.Utl is\n \n          OS_Lib.Spawn\n            (Ranlib_Exec.all,\n-            (1 => Arguments (Ar_Options'Length + 1)),\n+            Ranlib_Options.all & (Arguments (Ar_Options'Length + 1)),\n             Success);\n \n          if not Success then\n@@ -284,6 +285,8 @@ package body MLib.Utl is\n                Write_Line (Ranlib_Exec.all);\n             end if;\n          end if;\n+\n+         Ranlib_Options := Archive_Indexer_Options;\n       end if;\n    end Initialize;\n "}]}