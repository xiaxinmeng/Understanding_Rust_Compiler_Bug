{"sha": "c3a34659036b55fa36a5355fdd67133f427eeb2d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzNhMzQ2NTkwMzZiNTVmYTM2YTUzNTVmZGQ2NzEzM2Y0MjdlZWIyZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-04-22T14:44:42Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-04-22T14:44:42Z"}, "message": "calls: Introduce cxx17_empty_base_field_p [PR94383]\n\nAs multiple targets are affected apparently, I believe at least\naarch64, arm, powerpc64le, s390{,x} and ia64,\nI think we should have a middle-end predicate for this, so that if we need\nto tweak it, we can do it in one spot.\n\n2020-04-22  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR target/94383\n\t* calls.h (cxx17_empty_base_field_p): Declare.\n\t* calls.c (cxx17_empty_base_field_p): Define.", "tree": {"sha": "2a42175d9f7f989fa0acc263563ccb13b024e69a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2a42175d9f7f989fa0acc263563ccb13b024e69a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c3a34659036b55fa36a5355fdd67133f427eeb2d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3a34659036b55fa36a5355fdd67133f427eeb2d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c3a34659036b55fa36a5355fdd67133f427eeb2d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c3a34659036b55fa36a5355fdd67133f427eeb2d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e16452e2900fc79b090794e7b7a5727f1136a4a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e16452e2900fc79b090794e7b7a5727f1136a4a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e16452e2900fc79b090794e7b7a5727f1136a4a"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "043ee407e8c1b82479f16cf20ba161e0ffdd228e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3a34659036b55fa36a5355fdd67133f427eeb2d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3a34659036b55fa36a5355fdd67133f427eeb2d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c3a34659036b55fa36a5355fdd67133f427eeb2d", "patch": "@@ -1,3 +1,9 @@\n+2020-04-22  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/94383\n+\t* calls.h (cxx17_empty_base_field_p): Declare.\n+\t* calls.c (cxx17_empty_base_field_p): Define.\n+\n 2020-04-22  Christophe Lyon  <christophe.lyon@linaro.org>\n \n \t* doc/sourcebuild.texi (arm_softfp_ok, arm_hard_ok): Document."}, {"sha": "9ac7f949737db055c34c1e0b9eb25b9f34a3feef", "filename": "gcc/calls.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3a34659036b55fa36a5355fdd67133f427eeb2d/gcc%2Fcalls.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3a34659036b55fa36a5355fdd67133f427eeb2d/gcc%2Fcalls.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.c?ref=c3a34659036b55fa36a5355fdd67133f427eeb2d", "patch": "@@ -6261,5 +6261,23 @@ must_pass_va_arg_in_stack (tree type)\n   return targetm.calls.must_pass_in_stack (arg);\n }\n \n+/* Return true if FIELD is the C++17 empty base field that should\n+   be ignored for ABI calling convention decisions in order to\n+   maintain ABI compatibility between C++14 and earlier, which doesn't\n+   add this FIELD to classes with empty bases, and C++17 and later\n+   which does.  */\n+\n+bool\n+cxx17_empty_base_field_p (const_tree field)\n+{\n+  return (TREE_CODE (field) == FIELD_DECL\n+\t  && DECL_ARTIFICIAL (field)\n+\t  && RECORD_OR_UNION_TYPE_P (TREE_TYPE (field))\n+\t  && DECL_SIZE (field)\n+\t  && integer_zerop (DECL_SIZE (field))\n+\t  && TYPE_SIZE (TREE_TYPE (field))\n+\t  && !integer_zerop (TYPE_SIZE (TREE_TYPE (field))));\n+}\n+\n /* Tell the garbage collector about GTY markers in this source file.  */\n #include \"gt-calls.h\""}, {"sha": "4ee493607774df26d88136272aa25c6e55c717f8", "filename": "gcc/calls.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c3a34659036b55fa36a5355fdd67133f427eeb2d/gcc%2Fcalls.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c3a34659036b55fa36a5355fdd67133f427eeb2d/gcc%2Fcalls.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcalls.h?ref=c3a34659036b55fa36a5355fdd67133f427eeb2d", "patch": "@@ -135,5 +135,6 @@ extern tree get_attr_nonstring_decl (tree, tree * = NULL);\n extern void maybe_warn_nonstring_arg (tree, tree);\n extern bool get_size_range (tree, tree[2], bool = false);\n extern rtx rtx_for_static_chain (const_tree, bool);\n+extern bool cxx17_empty_base_field_p (const_tree);\n \n #endif // GCC_CALLS_H"}]}