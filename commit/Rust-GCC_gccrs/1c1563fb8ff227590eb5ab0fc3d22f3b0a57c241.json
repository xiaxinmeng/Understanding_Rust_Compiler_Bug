{"sha": "1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241", "node_id": "C_kwDOANBUbNoAKDFjMTU2M2ZiOGZmMjI3NTkwZWI1YWIwZmMzZDIyZjNiMGE1N2MyNDE", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-12-06T13:17:10Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-12-08T19:47:17Z"}, "message": "Darwin: Amend pie options when linking mdynamic-no-pic.\n\nOn i686 Darwin from macOS 10.7 onwards the default is to\nlink executables as PIE, which conflicts with code generated\nusing mdynamic-no-pic.  Rather than warn about this and then\nget the user to add -Wl,-no_pie, we can inject this in the\nlink specs.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\ngcc/ChangeLog:\n\n\t* config/darwin.h (DARWIN_PIE_SPEC): Add -no_pie when\n\tlinking mdynamic-no-pic code on macOS > 10.7.", "tree": {"sha": "e755d46bd85d2716f426e83299dd8ba1b5038c40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e755d46bd85d2716f426e83299dd8ba1b5038c40"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "dda85bc274e1148a0c576a8cb085bffadd0e54ab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dda85bc274e1148a0c576a8cb085bffadd0e54ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dda85bc274e1148a0c576a8cb085bffadd0e54ab"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "0ce13207ad644bff394cff192228ea8e72f9f67b", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=1c1563fb8ff227590eb5ab0fc3d22f3b0a57c241", "patch": "@@ -288,13 +288,17 @@ extern GTY(()) int darwin_ms_struct;\n #define DARWIN_RDYNAMIC \"%{rdynamic:%nrdynamic is not supported}\"\n #endif\n \n-/* FIXME: we should check that the linker supports the -pie and -no_pie.\n+/* Code built with mdynamic-no-pic does not support PIE/PIC, so  we disallow\n+   these combinations; we also ensure that the no_pie option is passed to\n+   ld64 on system versions that default to PIE when mdynamic-no-pic is given.\n+   FIXME: we should check that the linker supports the -pie and -no_pie.\n    options.  */\n #define DARWIN_PIE_SPEC \\\n \"%{pie|fpie|fPIE:\\\n    %{mdynamic-no-pic: \\\n      %n'-mdynamic-no-pic' overrides '-pie', '-fpie' or '-fPIE'; \\\n-     :%:version-compare(>= 10.5 mmacosx-version-min= -pie) }} \"\n+     :%:version-compare(>= 10.5 mmacosx-version-min= -pie) }; \\\n+   mdynamic-no-pic:%:version-compare(>= 10.7 mmacosx-version-min= -no_pie) } \"\n \n #define DARWIN_NOPIE_SPEC \\\n \"%{no-pie|fno-pie|fno-PIE: \\"}]}