{"sha": "c9419faef0bfaf31e6a6f744baa064892e0d105c", "node_id": "C_kwDOANBUbNoAKGM5NDE5ZmFlZjBiZmFmMzFlNmE2Zjc0NGJhYTA2NDg5MmUwZDEwNWM", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-12-05T20:15:40Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-12-05T20:22:16Z"}, "message": "Objective-C, NeXT: Reorganise meta-data declarations.\n\nThis moves the GTY declaration of the meta-data indentifier\narray into the header that enumerates these and provides\nshorthand defines for them.  This avoids a problem seen with\na relocatable PCH implementation.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\ngcc/objc/ChangeLog:\n\n\t* objc-next-metadata-tags.h (objc_rt_trees): Declare here.\n\t* objc-next-runtime-abi-01.c: Remove from here.\n\t* objc-next-runtime-abi-02.c: Likewise.\n\t* objc-runtime-shared-support.c: Reorder headers, provide\n\ta GTY declaration the definition of objc_rt_trees.", "tree": {"sha": "208ce1e250cbe345231b63479e3a832152851c67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/208ce1e250cbe345231b63479e3a832152851c67"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c9419faef0bfaf31e6a6f744baa064892e0d105c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9419faef0bfaf31e6a6f744baa064892e0d105c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c9419faef0bfaf31e6a6f744baa064892e0d105c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c9419faef0bfaf31e6a6f744baa064892e0d105c/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "8d4ef2299cbf9517877dab60d48f34835758a6ee", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8d4ef2299cbf9517877dab60d48f34835758a6ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8d4ef2299cbf9517877dab60d48f34835758a6ee"}], "stats": {"total": 29, "additions": 6, "deletions": 23}, "files": [{"sha": "aea14558b5cce6d944f61cb2c2716518237d3a83", "filename": "gcc/objc/objc-next-metadata-tags.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-next-metadata-tags.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-next-metadata-tags.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-next-metadata-tags.h?ref=c9419faef0bfaf31e6a6f744baa064892e0d105c", "patch": "@@ -79,6 +79,8 @@ enum objc_runtime_tree_index\n   OCTI_RT_META_MAX\n };\n \n+extern GTY(()) tree objc_rt_trees[OCTI_RT_META_MAX];\n+\n /* Tags for the META data so that the backend can put them in the correct\n    sections for targets/runtimes (Darwin/NeXT) that require this.\n    This information also survives LTO - which might produce mixed language"}, {"sha": "0f76162c70e77e6efc65173ba2a06ed45e991654", "filename": "gcc/objc/objc-next-runtime-abi-01.c", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-next-runtime-abi-01.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-next-runtime-abi-01.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-next-runtime-abi-01.c?ref=c9419faef0bfaf31e6a6f744baa064892e0d105c", "patch": "@@ -55,6 +55,7 @@ along with GCC; see the file COPYING3.  If not see\n \n #include \"objc-runtime-hooks.h\"\n #include \"objc-runtime-shared-support.h\"\n+#include \"objc-next-metadata-tags.h\"\n #include \"objc-encoding.h\"\n \n /* NeXT ABI 0 and 1 private definitions.  */\n@@ -99,14 +100,6 @@ along with GCC; see the file COPYING3.  If not see\n \n #define CLS_HAS_CXX_STRUCTORS\t\t0x2000L\n \n-/* rt_trees identifiers - shared between NeXT implementations.  These\n-   allow the FE to tag meta-data in a manner that survives LTO and can\n-   be used when the runtime requires that certain meta-data items\n-   appear in particular named sections.  */\n-\n-#include \"objc-next-metadata-tags.h\"\n-extern GTY(()) tree objc_rt_trees[OCTI_RT_META_MAX];\n-\n static void next_runtime_01_initialize (void);\n \n static tree next_runtime_abi_01_super_superclassfield_id (void);"}, {"sha": "913ed643782596f95472f4e185a0487abff6fe40", "filename": "gcc/objc/objc-next-runtime-abi-02.c", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-next-runtime-abi-02.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-next-runtime-abi-02.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-next-runtime-abi-02.c?ref=c9419faef0bfaf31e6a6f744baa064892e0d105c", "patch": "@@ -55,6 +55,7 @@ along with GCC; see the file COPYING3.  If not see\n \n #include \"objc-runtime-hooks.h\"\n #include \"objc-runtime-shared-support.h\"\n+#include \"objc-next-metadata-tags.h\"\n #include \"objc-encoding.h\"\n \n /* ABI 2 Private definitions. */\n@@ -180,14 +181,6 @@ enum objc_v2_tree_index\n #define objc_rethrow_exception_decl \\\n \t\t\t\tobjc_v2_global_trees[OCTI_V2_RETHROW_DECL]\n \n-/* rt_trees identifiers - shared between NeXT implementations.  These allow\n-   the FE to tag meta-data in a manner that survives LTO and can be used when\n-   the  runtime requires that certain meta-data items appear in particular\n-   named sections.  */\n-\n-#include \"objc-next-metadata-tags.h\"\n-extern GTY(()) tree objc_rt_trees[OCTI_RT_META_MAX];\n-\n /* The OCTI_V2_... enumeration itself is in above.  */\n static GTY(()) tree objc_v2_global_trees[OCTI_V2_MAX];\n "}, {"sha": "0d3036f478e30b8b6bf90d515b5d5f827573f330", "filename": "gcc/objc/objc-runtime-shared-support.c", "status": "modified", "additions": 2, "deletions": 7, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-runtime-shared-support.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c9419faef0bfaf31e6a6f744baa064892e0d105c/gcc%2Fobjc%2Fobjc-runtime-shared-support.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fobjc%2Fobjc-runtime-shared-support.c?ref=c9419faef0bfaf31e6a6f744baa064892e0d105c", "patch": "@@ -44,16 +44,11 @@ along with GCC; see the file COPYING3.  If not see\n #include \"objc-runtime-hooks.h\"\n \n #include \"objc-runtime-shared-support.h\"\n-#include \"objc-encoding.h\"\n-\n-/* rt_trees identifiers - shared between NeXT implementations.  These allow\n-   the FE to tag meta-data in a manner that survives LTO and can be used when\n-   the  runtime requires that certain meta-data items appear in particular\n-   named sections.  */\n #include \"objc-next-metadata-tags.h\"\n-extern GTY(()) tree objc_rt_trees[OCTI_RT_META_MAX];\n+#include \"objc-encoding.h\"\n \n /* Rather than repeatedly looking up the identifiers, we save them here.  */\n+extern GTY(()) tree objc_rt_trees[OCTI_RT_META_MAX];\n tree objc_rt_trees[OCTI_RT_META_MAX];\n \n /* For building an objc struct.  These might not be used when this file"}]}