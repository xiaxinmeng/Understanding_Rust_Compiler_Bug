{"sha": "4d6d3bc532e4b1b43f2a57aff835c416b462200d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGQ2ZDNiYzUzMmU0YjFiNDNmMmE1N2FmZjgzNWM0MTZiNDYyMjAwZA==", "commit": {"author": {"name": "Walter Lee", "email": "walt@tilera.com", "date": "2014-01-25T20:34:42Z"}, "committer": {"name": "Walter Lee", "email": "walt@gcc.gnu.org", "date": "2014-01-25T20:34:42Z"}, "message": "atomic.c (BIT_OFFSET): Define.\n\n2014-01-25  Walter Lee  <walt@tilera.com>\n\n            * config/tilepro/atomic.c (BIT_OFFSET): Define.\n            (__atomic_subword_cmpxchg): Use BIT_OFFSET.\n            (__atomic_subword): Ditto.\n\nFrom-SVN: r207086", "tree": {"sha": "bba32f344440956223bb4a7466b46da1d1dc6adf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bba32f344440956223bb4a7466b46da1d1dc6adf"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4d6d3bc532e4b1b43f2a57aff835c416b462200d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d6d3bc532e4b1b43f2a57aff835c416b462200d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4d6d3bc532e4b1b43f2a57aff835c416b462200d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4d6d3bc532e4b1b43f2a57aff835c416b462200d/comments", "author": {"login": "walt-tilera", "id": 6602917, "node_id": "MDQ6VXNlcjY2MDI5MTc=", "avatar_url": "https://avatars.githubusercontent.com/u/6602917?v=4", "gravatar_id": "", "url": "https://api.github.com/users/walt-tilera", "html_url": "https://github.com/walt-tilera", "followers_url": "https://api.github.com/users/walt-tilera/followers", "following_url": "https://api.github.com/users/walt-tilera/following{/other_user}", "gists_url": "https://api.github.com/users/walt-tilera/gists{/gist_id}", "starred_url": "https://api.github.com/users/walt-tilera/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/walt-tilera/subscriptions", "organizations_url": "https://api.github.com/users/walt-tilera/orgs", "repos_url": "https://api.github.com/users/walt-tilera/repos", "events_url": "https://api.github.com/users/walt-tilera/events{/privacy}", "received_events_url": "https://api.github.com/users/walt-tilera/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cbd9890e93bc95ef213702cb65c65836dfea2381", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cbd9890e93bc95ef213702cb65c65836dfea2381", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cbd9890e93bc95ef213702cb65c65836dfea2381"}], "stats": {"total": 16, "additions": 14, "deletions": 2}, "files": [{"sha": "e01d2fbd5ee23eb6ecaf7e5d5be3cf7352c8f2e0", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d6d3bc532e4b1b43f2a57aff835c416b462200d/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d6d3bc532e4b1b43f2a57aff835c416b462200d/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=4d6d3bc532e4b1b43f2a57aff835c416b462200d", "patch": "@@ -1,3 +1,9 @@\n+2014-01-25  Walter Lee  <walt@tilera.com>\n+\n+\t* config/tilepro/atomic.c (BIT_OFFSET): Define.\n+\t(__atomic_subword_cmpxchg): Use BIT_OFFSET.\n+\t(__atomic_subword): Ditto.\n+\n 2014-01-25  Walter Lee  <walt@tilera.com>\n \n \t* config/tilepro/atomic.c (__atomic_do_and_fetch): Add"}, {"sha": "2ad114a06d586e5af77fe788a2f9a1d6a637bcc6", "filename": "libgcc/config/tilepro/atomic.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4d6d3bc532e4b1b43f2a57aff835c416b462200d/libgcc%2Fconfig%2Ftilepro%2Fatomic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4d6d3bc532e4b1b43f2a57aff835c416b462200d/libgcc%2Fconfig%2Ftilepro%2Fatomic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Ftilepro%2Fatomic.c?ref=4d6d3bc532e4b1b43f2a57aff835c416b462200d", "patch": "@@ -135,6 +135,12 @@ __atomic_exchange_##size(volatile type* ptr, type val, int model)\t\\\n __atomic_exchange_methods (int, 4)\n __atomic_exchange_methods (long long, 8)\n \n+#ifdef __LITTLE_ENDIAN__\n+#define BIT_OFFSET(n, type) ((n) * 8)\n+#else\n+#define BIT_OFFSET(n, type) ((4 - sizeof(type) - (n)) * 8)\n+#endif\n+\n /* Subword methods require the same approach for both TILEPro and\n    TILE-Gx.  We load the background data for the word, insert the\n    desired subword piece, then compare-and-exchange it into place.  */\n@@ -150,7 +156,7 @@ __atomic_compare_exchange_##size(volatile type* ptr, type* guess,\t\\\n {\t\t\t\t\t\t\t\t\t\\\n   pre_atomic_barrier(models);\t\t\t\t\t\t\\\n   unsigned int *p = (unsigned int *)((unsigned long)ptr & ~3UL);\t\\\n-  const int shift = ((unsigned long)ptr & 3UL) * 8;\t\t\t\\\n+  const int shift = BIT_OFFSET((unsigned long)ptr & 3UL, type);\t\t\\\n   const unsigned int valmask = (1 << (sizeof(type) * 8)) - 1;\t\t\\\n   const unsigned int bgmask = ~(valmask << shift);\t\t\t\\\n   unsigned int oldword = *p;\t\t\t\t\t\t\\\n@@ -177,7 +183,7 @@ proto\t\t\t\t\t\t\t\t\t\\\n {\t\t\t\t\t\t\t\t\t\\\n   top\t\t\t\t\t\t\t\t\t\\\n   unsigned int *p = (unsigned int *)((unsigned long)ptr & ~3UL);\t\\\n-  const int shift = ((unsigned long)ptr & 3UL) * 8;\t\t\t\\\n+  const int shift = BIT_OFFSET((unsigned long)ptr & 3UL, type);\t\t\\\n   const unsigned int valmask = (1 << (sizeof(type) * 8)) - 1;\t\t\\\n   const unsigned int bgmask = ~(valmask << shift);\t\t\t\\\n   unsigned int oldword, xword = *p;\t\t\t\t\t\\"}]}