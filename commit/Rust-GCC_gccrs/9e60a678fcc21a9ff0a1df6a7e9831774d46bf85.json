{"sha": "9e60a678fcc21a9ff0a1df6a7e9831774d46bf85", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWU2MGE2NzhmY2MyMWE5ZmYwYTFkZjZhN2U5ODMxNzc0ZDQ2YmY4NQ==", "commit": {"author": {"name": "Nathanael Nerode", "email": "neroden@gcc.gnu.org", "date": "2002-09-29T16:11:24Z"}, "committer": {"name": "Nathanael Nerode", "email": "neroden@gcc.gnu.org", "date": "2002-09-29T16:11:24Z"}, "message": "configure: Revert accidentally applied changes.\n\n2002-09-29  Nathanael Nerode  <neroden@gcc.gnu.org>\n\n\t* configure: Revert accidentally applied changes.\n\nFrom-SVN: r57626", "tree": {"sha": "a94853f776bb00b0144acd0547de6d8d0d8ee1dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a94853f776bb00b0144acd0547de6d8d0d8ee1dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85/comments", "author": null, "committer": null, "parents": [{"sha": "dd30b57d9dbe6b6b2f55b92faf7cff6542e47130", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dd30b57d9dbe6b6b2f55b92faf7cff6542e47130", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dd30b57d9dbe6b6b2f55b92faf7cff6542e47130"}], "stats": {"total": 150, "additions": 101, "deletions": 49}, "files": [{"sha": "dbb6539d31895d7bbc3e3060737f51529d6a09ea", "filename": "ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=9e60a678fcc21a9ff0a1df6a7e9831774d46bf85", "patch": "@@ -1,5 +1,7 @@\n 2002-09-29  Nathanael Nerode  <neroden@gcc.gnu.org>\n \n+\t* configure: Revert accidentally applied changes.\n+\n \t* Makefile.tpl: Make more autoconf-friendly.\n \t* Makefile.in: Regenerate.\n \t* configure: Make substitution more autoconf-like."}, {"sha": "d055bd8c18fc53d676a00fa1c30bdffe81e40414", "filename": "configure", "status": "modified", "additions": 99, "deletions": 49, "changes": 148, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e60a678fcc21a9ff0a1df6a7e9831774d46bf85/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=9e60a678fcc21a9ff0a1df6a7e9831774d46bf85", "patch": "@@ -85,10 +85,11 @@ site_makefile_frag=\n site_option=\n srcdir=\n srctrigger=\n+subdirs=\n target_alias=NOTARGET\n target_makefile_frag=\n undefs=NOUNDEFS\n-version=\"$Revision: 1.47 $\"\n+version=\"$Revision: 1.48 $\"\n x11=default\n bindir='${exec_prefix}/bin'\n sbindir='${exec_prefix}/sbin'\n@@ -1077,17 +1078,56 @@ then\n   all_build_modules='$(ALL_BUILD_MODULES_LIST)'\n fi\n \n+for subdir in . ${subdirs} ; do\n+\n+    # ${subdir} is relative path from . to the directory we're currently\n+    # configuring.\n+    # ${invsubdir} is inverse of ${subdir), *with* trailing /, if needed.\n+    invsubdir=`echo ${subdir}/ | sed -e 's|\\./||g' -e 's|[^/]*/|../|g'`\n+\n+    ### figure out what to do with srcdir\n+    case \"${srcdir}\" in\n+        \".\")  # no -srcdir option.  We're building in place.\n+                makesrcdir=. ;;\n+        /* | [A-Za-z]:[\\\\/]* ) # absolute path\n+                makesrcdir=`echo ${srcdir}/${subdir} | sed -e 's|/\\.$||'`\n+                ;;\n+        *) # otherwise relative\n+                case \"${subdir}\" in\n+                .) makesrcdir=${srcdir} ;;\n+                *) makesrcdir=${invsubdir}${srcdir}/${subdir} ;;\n+                esac\n+                ;;\n+    esac\n+\n+    if [ \"${subdir}/\" != \"./\" ] ; then\n+        Makefile=${subdir}/Makefile\n+    fi\n+\n+    if [ ! -d ${subdir} ] ; then\n+        if mkdir ${subdir} ; then\n+                true\n+        else\n+                echo '***' \"${progname}: could not make ${PWD=`${PWDCMD-pwd}`}/${subdir}\" 1>&2\n+                exit 1\n+        fi\n+    fi\n+\n     case \"${removing}\" in\n     \"\")\n+        case \"${subdir}\" in\n+        .) ;;\n+        *) eval echo Building in ${subdir} ${redirect} ;;\n+        esac\n \n         # FIXME Should this be done recursively ??? (Useful for e.g. gdbtest)\n         # Set up the list of links to be made.\n         # ${links} is the list of link names, and ${files} is the list of names to link to.\n \n         # Make the links.\n         configlinks=\"${links}\"\n-        if [ -r ./config.status ] ; then\n-                mv -f ./config.status ./config.back\n+        if [ -r ${subdir}/config.status ] ; then\n+                mv -f ${subdir}/config.status ${subdir}/config.back\n         fi\n         while [ -n \"${files}\" ] ; do\n                 # set file to car of files, files to cdr of files\n@@ -1128,14 +1168,14 @@ fi\n         # Create a .gdbinit file which runs the one in srcdir\n         # and tells GDB to look there for source files.\n \n-        if [ -r ${srcdir}/.gdbinit ] ; then\n+        if [ -r ${srcdir}/${subdir}/.gdbinit ] ; then\n                 case ${srcdir} in\n                 .) ;;\n-                *) cat > ./.gdbinit <<EOF\n+                *) cat > ${subdir}/.gdbinit <<EOF\n # ${NO_EDIT}\n-dir ${srcdir}\n+dir ${makesrcdir}\n dir .\n-source ${srcdir}/.gdbinit\n+source ${makesrcdir}/.gdbinit\n EOF\n                         ;;\n                 esac\n@@ -1153,103 +1193,103 @@ EOF\n         # the five makefile fragments MUST end up in the resulting Makefile in this order: \n         # package macros, target, host, site, and package rules.\n \n-        if [ -f ${srcdir}/${Makefile_in} ] ; then\n+        if [ -f ${srcdir}/${subdir}/${Makefile_in} ] ; then\n \n             # Conditionalize the makefile for this package from \"Makefile.in\" (or whatever it's called) into Makefile.tem.\n-            rm -f ./${Makefile}.tem\n+            rm -f ${subdir}/${Makefile}.tem\n             case \"${package_makefile_rules_frag}\" in\n-              \"\") cp ${srcdir}/${Makefile_in} ./Makefile.tem ;;\n+              \"\") cp ${srcdir}/${subdir}/${Makefile_in} ${subdir}/Makefile.tem ;;\n               *)\n                       if [ ! -f ${package_makefile_rules_frag} ] ; then\n                               package_makefile_rules_frag=${srcdir}/${package_makefile_rules_frag}\n                       fi\n                       if [ -f ${package_makefile_rules_frag} ] ; then\n-                              sed -e \"/^####/  r ${package_makefile_rules_frag}\" ${srcdir}/${Makefile_in} > ${Makefile}.tem\n+                              sed -e \"/^####/  r ${package_makefile_rules_frag}\" ${srcdir}/${subdir}/${Makefile_in} > ${Makefile}.tem\n                       else\n                               echo '***' Expected package makefile rules fragment \\\"${package_makefile_rules_frag}\\\" 1>&2\n                               echo '***' is missing in ${PWD=`${PWDCMD-pwd}`}. 1>&2\n-                              cp ${srcdir}/${Makefile_in} ./Makefile.tem\n+                              cp ${srcdir}/${subdir}/${Makefile_in} ${subdir}/Makefile.tem\n                       fi\n             esac\n             # working copy now in ${Makefile}.tem\n \n             # Conditionalize for this site.\n             rm -f ${Makefile}\n               case \"${site}\" in\n-              \"\") mv ./Makefile.tem ${Makefile} ;;\n+              \"\") mv ${subdir}/Makefile.tem ${Makefile} ;;\n               *)\n                       site_makefile_frag=${srcdir}/config/ms-${site}\n \n                       if [ -f ${site_makefile_frag} ] ; then\n-                              sed -e \"/^####/  r ${site_makefile_frag}\" ./Makefile.tem \\\n+                              sed -e \"/^####/  r ${site_makefile_frag}\" ${subdir}/Makefile.tem \\\n                                       > ${Makefile}\n                       else\n-                              mv ./Makefile.tem ${Makefile}\n+                              mv ${subdir}/Makefile.tem ${Makefile}\n                               site_makefile_frag=\n                       fi\n                       ;;\n             esac\n             # working copy now in ${Makefile}\n \n             # Conditionalize the makefile for this host.\n-            rm -f ./Makefile.tem\n+            rm -f ${subdir}/Makefile.tem\n             case \"${host_makefile_frag}\" in\n-              \"\") mv ${Makefile} ./Makefile.tem ;;\n+              \"\") mv ${Makefile} ${subdir}/Makefile.tem ;;\n               *)\n                       if [ ! -f ${host_makefile_frag} ] ; then\n                               host_makefile_frag=${srcdir}/${host_makefile_frag}\n                       fi\n                       if [ -f ${host_makefile_frag} ] ; then\n-                              sed -e \"/^####/  r ${host_makefile_frag}\" ${Makefile} > ./Makefile.tem\n+                              sed -e \"/^####/  r ${host_makefile_frag}\" ${Makefile} > ${subdir}/Makefile.tem\n                       else\n                               echo '***' Expected host makefile fragment \\\"${host_makefile_frag}\\\" 1>&2\n                               echo '***' is missing in ${PWD=`${PWDCMD-pwd}`}. 1>&2\n-                              mv ${Makefile} ./Makefile.tem\n+                              mv ${Makefile} ${subdir}/Makefile.tem\n                       fi\n             esac\n-            # working copy now in ./Makefile.tem\n+            # working copy now in ${subdir)/Makefile.tem\n \n             # Conditionalize the makefile for this target.\n             rm -f ${Makefile}\n             case \"${target_makefile_frag}\" in\n-              \"\") mv ./Makefile.tem ${Makefile} ;;\n+              \"\") mv ${subdir}/Makefile.tem ${Makefile} ;;\n               *)\n                       if [ ! -f ${target_makefile_frag} ] ; then\n                               target_makefile_frag=${srcdir}/${target_makefile_frag}\n                       fi\n                       if [ -f ${target_makefile_frag} ] ; then\n-                              sed -e \"/^####/  r ${target_makefile_frag}\" ./Makefile.tem > ${Makefile}\n+                              sed -e \"/^####/  r ${target_makefile_frag}\" ${subdir}/Makefile.tem > ${Makefile}\n                       else\n-                              mv ./Makefile.tem ${Makefile}\n+                              mv ${subdir}/Makefile.tem ${Makefile}\n                               target_makefile_frag=\n                       fi\n                       ;;\n             esac\n             # working copy now in ${Makefile}\n \n             # Emit the default values of this package's macros.\n-            rm -f ./Makefile.tem\n+            rm -f ${subdir}/Makefile.tem\n             case \"${package_makefile_frag}\" in\n-              \"\") mv ${Makefile} ./Makefile.tem ;;\n+              \"\") mv ${Makefile} ${subdir}/Makefile.tem ;;\n               *)\n                       if [ ! -f ${package_makefile_frag} ] ; then\n                               package_makefile_frag=${srcdir}/${package_makefile_frag}\n                       fi\n                       if [ -f ${package_makefile_frag} ] ; then\n-                              sed -e \"/^####/  r ${package_makefile_frag}\" ${Makefile} > ./Makefile.tem\n+                              sed -e \"/^####/  r ${package_makefile_frag}\" ${Makefile} > ${subdir}/Makefile.tem\n                       else\n                               echo '***' Expected package makefile fragment \\\"${package_makefile_rules_frag}\\\" 1>&2\n                               echo '***' is missing in ${PWD=`${PWDCMD-pwd}`}. 1>&2\n-                              mv ${Makefile} ./Makefile.tem\n+                              mv ${Makefile} ${subdir}/Makefile.tem\n                       fi\n             esac\n-            # real copy now in ./Makefile.tem\n+            # real copy now in ${subdir}/Makefile.tem\n \n             # prepend warning about editing, and a bunch of variables.\n             rm -f ${Makefile}\n             cat > ${Makefile} <<EOF\n # ${NO_EDIT}\n-VPATH = ${srcdir}\n+VPATH = ${makesrcdir}\n links = ${configlinks}\n host_alias = ${host_alias}\n host_cpu = ${host_cpu}\n@@ -1276,23 +1316,23 @@ EOF\n             case \"${package_makefile_frag}\" in\n               \"\") ;;\n               /* | [A-Za-z]:[\\\\/]* ) echo package_makefile_frag = ${package_makefile_frag} >>${Makefile} ;;\n-              *)  echo package_makefile_frag = ${package_makefile_frag} >>${Makefile} ;;\n+              *)  echo package_makefile_frag = ${invsubdir}${package_makefile_frag} >>${Makefile} ;;\n             esac\n \n             case \"${target_makefile_frag}\" in\n               \"\") ;;\n               /* | [A-Za-z]:[\\\\/]* ) echo target_makefile_frag = ${target_makefile_frag} >>${Makefile} ;;\n-              *)  echo target_makefile_frag = ${target_makefile_frag} >>${Makefile} ;;\n+              *)  echo target_makefile_frag = ${invsubdir}${target_makefile_frag} >>${Makefile} ;;\n             esac\n \n             case \"${host_makefile_frag}\" in\n               \"\") ;;\n               /* | [A-Za-z]:[\\\\/]* ) echo host_makefile_frag = ${host_makefile_frag} >>${Makefile} ;;\n-              *)  echo host_makefile_frag = ${host_makefile_frag} >>${Makefile} ;;\n+              *)  echo host_makefile_frag = ${invsubdir}${host_makefile_frag} >>${Makefile} ;;\n             esac\n \n             if [ \"${site_makefile_frag}\" != \"\" ] ; then\n-                echo site_makefile_frag = ${site_makefile_frag} >>${Makefile}\n+                echo site_makefile_frag = ${invsubdir}${site_makefile_frag} >>${Makefile}\n             fi \n \n \t    echo enable_shared = ${enable_shared} >> ${Makefile}\n@@ -1312,17 +1352,17 @@ EOF\n \n             # reset prefix, exec_prefix, srcdir, SUBDIRS, NONSUBDIRS,\n             # remove any form feeds.\n-            if [ -z \"\" ]; then\n-                rm -f ./Makefile.tm2\n+            if [ -z \"${subdirs}\" ]; then\n+                rm -f ${subdir}/Makefile.tm2\n                 sedtemp=sed.$$\n                 cat >$sedtemp <<EOF\n s:@configdirs@:${configdirs}:\n EOF\n                 sed -f $sedtemp \\\n-                    ./Makefile.tem > ./Makefile.tm2\n+                    ${subdir}/Makefile.tem > ${subdir}/Makefile.tm2\n                 rm -f $sedtemp\n-                rm -f ./Makefile.tem\n-                mv ./Makefile.tm2 ./Makefile.tem\n+                rm -f ${subdir}/Makefile.tem\n+                mv ${subdir}/Makefile.tm2 ${subdir}/Makefile.tem\n \t    fi\n \t    sed     -e \"s|@prefix@|${prefix}|\" \\\n                     -e \"s|@exec_prefix@|${exec_prefix}|\" \\\n@@ -1368,15 +1408,15 @@ EOF\n \t\t\ts%^CXXFLAGS[ \t]*=.*$%CXXFLAGS = ${CXXFLAGS}%\n \t\t\t}\" \\\n \t\t    -e \"s|@config_shell@|${config_shell}|\" \\\n-                    -e \"s|@srcdir@|${srcdir}|\" \\\n+                    -e \"s|@srcdir@|${makesrcdir}|\" \\\n                     -e \"s/\f//\" \\\n                     -e \"s:@program_transform_name@:${program_transform_name}:\" \\\n                     -e \"s|@tooldir@|${tooldir}|\" \\\n                     -e \"s|@build_tooldir@|${tooldir}|\" \\\n \t\t    -e \"s:@DEFAULT_YACC@:${DEFAULT_YACC}:\" \\\n \t\t    -e \"s:@DEFAULT_LEX@:${DEFAULT_LEX}:\" \\\n \t\t    -e \"s:@DEFAULT_M4@:${DEFAULT_M4}:\" \\\n-                    ./Makefile.tem >> ${Makefile}\n+                    ${subdir}/Makefile.tem >> ${Makefile}\n   \n \t    sed -e \"s:@GDB_TK@:${GDB_TK}:\" ${Makefile} >${Makefile}.tem\n \t    mv -f ${Makefile}.tem ${Makefile}\n@@ -1400,10 +1440,10 @@ EOF\n             # final copy now in ${Makefile}\n \n         else\n-           echo \"No Makefile.in found in ${srcdir}, unable to configure\" 1>&2\n+           echo \"No Makefile.in found in ${srcdir}/${subdir}, unable to configure\" 1>&2\n         fi\n \n-        rm -f ./Makefile.tem\n+        rm -f ${subdir}/Makefile.tem\n \n         case \"${host_makefile_frag}\" in\n         \"\") using= ;;\n@@ -1436,20 +1476,30 @@ EOF\n         *) ;;\n         esac\n \n-        echo \"#!/bin/sh\n+        if [ ${subdir} = . ] ; then\n+            echo \"#!/bin/sh\n+# ${NO_EDIT}\n+# This directory was configured as follows:\n+${progname}\" ${arguments}  \"\n+# ${using}\" > ${subdir}/config.new\n+        else\n+            echo \"#!/bin/sh\n # ${NO_EDIT}\n # This directory was configured as follows:\n+cd ${invsubdir}\n ${progname}\" ${arguments}  \"\n-# ${using}\" > ./config.new\n-        chmod a+x ./config.new\n-        if [ -r ./config.back ] ; then\n-                mv -f ./config.back ./config.status\n+# ${using}\" > ${subdir}/config.new\n         fi\n-\t${config_shell} ${moveifchange} ./config.new ./config.status\n+        chmod a+x ${subdir}/config.new\n+        if [ -r ${subdir}/config.back ] ; then\n+                mv -f ${subdir}/config.back ${subdir}/config.status\n+        fi\n+\t${config_shell} ${moveifchange} ${subdir}/config.new ${subdir}/config.status\n         ;;\n \n-    *)  rm -f ${Makefile} ./config.status ${links} ;;\n+    *)  rm -f ${Makefile} ${subdir}/config.status ${links} ;;\n     esac\n+done\n \n # If there are subdirectories, then recur.\n if [ -z \"${norecursion}\" ] && [ -n \"${configdirs}\" ] ; then "}]}