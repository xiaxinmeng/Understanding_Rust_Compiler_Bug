{"sha": "8011fbba7baa46947341ca8069b5a327163a68d5", "node_id": "C_kwDOANBUbNoAKDgwMTFmYmJhN2JhYTQ2OTQ3MzQxY2E4MDY5YjVhMzI3MTYzYTY4ZDU", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2023-01-29T04:00:34Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2023-01-29T19:10:06Z"}, "message": "ICE in gfc_free_namespace. ice-on-invalid.\n\n\tPR fortran/103506\n\ngcc/fortran/ChangeLog:\n\n\t* parse.cc (parse_module): Remove use of a bool error value\n\tthat prevented proper setting of the namespace pointer.\n\ngcc/testsuite/ChangeLog:\n\n\t* gfortran.dg/pr103506_1.f90: New test.", "tree": {"sha": "4ce180e3310e4e2fd283dea79dc5c637aa76bcf9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4ce180e3310e4e2fd283dea79dc5c637aa76bcf9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8011fbba7baa46947341ca8069b5a327163a68d5", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8011fbba7baa46947341ca8069b5a327163a68d5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8011fbba7baa46947341ca8069b5a327163a68d5", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8011fbba7baa46947341ca8069b5a327163a68d5/comments", "author": null, "committer": null, "parents": [{"sha": "da3aca031be736fe4fa8daa57c7efa69dc767160", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da3aca031be736fe4fa8daa57c7efa69dc767160", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da3aca031be736fe4fa8daa57c7efa69dc767160"}], "stats": {"total": 18, "additions": 10, "deletions": 8}, "files": [{"sha": "039e7e7da5314b40e7ee8bed08e025e1b3a5899d", "filename": "gcc/fortran/parse.cc", "status": "modified", "additions": 1, "deletions": 8, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8011fbba7baa46947341ca8069b5a327163a68d5/gcc%2Ffortran%2Fparse.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8011fbba7baa46947341ca8069b5a327163a68d5/gcc%2Ffortran%2Fparse.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fparse.cc?ref=8011fbba7baa46947341ca8069b5a327163a68d5", "patch": "@@ -6502,7 +6502,6 @@ parse_module (void)\n {\n   gfc_statement st;\n   gfc_gsymbol *s;\n-  bool error;\n \n   s = gfc_get_gsymbol (gfc_new_block->name, false);\n   if (s->defined || (s->type != GSYM_UNKNOWN && s->type != GSYM_MODULE))\n@@ -6525,7 +6524,6 @@ parse_module (void)\n \n   st = parse_spec (ST_NONE);\n \n-  error = false;\n loop:\n   switch (st)\n     {\n@@ -6544,16 +6542,11 @@ parse_module (void)\n     default:\n       gfc_error (\"Unexpected %s statement in MODULE at %C\",\n \t\t gfc_ascii_statement (st));\n-\n-      error = true;\n       reject_statement ();\n       st = next_statement ();\n       goto loop;\n     }\n-\n-  /* Make sure not to free the namespace twice on error.  */\n-  if (!error)\n-    s->ns = gfc_current_ns;\n+  s->ns = gfc_current_ns;\n }\n \n "}, {"sha": "3f57809e0999581c5bb4ea46f7836e5fafa4d58e", "filename": "gcc/testsuite/gfortran.dg/pr103506_1.f90", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8011fbba7baa46947341ca8069b5a327163a68d5/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr103506_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8011fbba7baa46947341ca8069b5a327163a68d5/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr103506_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpr103506_1.f90?ref=8011fbba7baa46947341ca8069b5a327163a68d5", "patch": "@@ -0,0 +1,9 @@\n+! { dg-do compile }\n+! PR103506 ICE in gfc_free_namespace. ice-on-invalid\n+! Test case from the PR.\n+module m ! { dg-error \"is already being used as a MODULE\" }\n+stop ! { dg-error \"Unexpected STOP statement in MODULE\" }\n+end\n+program p\n+call m ! { dg-error \"is already being used as a MODULE\" }\n+end"}]}