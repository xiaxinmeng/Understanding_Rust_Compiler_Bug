{"sha": "333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzMzYjY3YTlmMTYyMDg0ODVjMGY3NmVkZWEwYjRlY2FkZGQwYzhlNg==", "commit": {"author": {"name": "Wei Guozhi", "email": "carrot@google.com", "date": "2010-05-10T07:26:04Z"}, "committer": {"name": "Wei Guozhi", "email": "carrot@gcc.gnu.org", "date": "2010-05-10T07:26:04Z"}, "message": "thumb2.md (thumb2_tlobits_cbranch): New insn pattern.\n\n\t* config/arm/thumb2.md (thumb2_tlobits_cbranch): New insn pattern.\n\n\t* gcc.target/arm/pr42879.c: New testcase.\n\nFrom-SVN: r159212", "tree": {"sha": "7a6ad5a80b4bd6bc27c3ac904a1b2fe1a259dc03", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a6ad5a80b4bd6bc27c3ac904a1b2fe1a259dc03"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/comments", "author": {"login": "weiguozhi", "id": 57237827, "node_id": "MDQ6VXNlcjU3MjM3ODI3", "avatar_url": "https://avatars.githubusercontent.com/u/57237827?v=4", "gravatar_id": "", "url": "https://api.github.com/users/weiguozhi", "html_url": "https://github.com/weiguozhi", "followers_url": "https://api.github.com/users/weiguozhi/followers", "following_url": "https://api.github.com/users/weiguozhi/following{/other_user}", "gists_url": "https://api.github.com/users/weiguozhi/gists{/gist_id}", "starred_url": "https://api.github.com/users/weiguozhi/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/weiguozhi/subscriptions", "organizations_url": "https://api.github.com/users/weiguozhi/orgs", "repos_url": "https://api.github.com/users/weiguozhi/repos", "events_url": "https://api.github.com/users/weiguozhi/events{/privacy}", "received_events_url": "https://api.github.com/users/weiguozhi/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4af3ff4194e5dc832c7c5b1a352eb9beff23e60a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4af3ff4194e5dc832c7c5b1a352eb9beff23e60a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4af3ff4194e5dc832c7c5b1a352eb9beff23e60a"}], "stats": {"total": 99, "additions": 99, "deletions": 0}, "files": [{"sha": "76e6ea6931e262c2c7cf387ecf28a159916547a5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "patch": "@@ -1,3 +1,8 @@\n+2010-05-10  Wei Guozhi  <carrot@google.com>\n+\n+\tPR target/42879\n+\t* config/arm/thumb2.md (thumb2_tlobits_cbranch): New insn pattern.\n+\n 2010-05-09  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR c/10676"}, {"sha": "9b8075296d540021b1d8fc0ba2a0a842ac4725d5", "filename": "gcc/config/arm/thumb2.md", "status": "modified", "additions": 74, "deletions": 0, "changes": 74, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2Fconfig%2Farm%2Fthumb2.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2Fconfig%2Farm%2Fthumb2.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Fthumb2.md?ref=333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "patch": "@@ -1442,3 +1442,77 @@\n   [(set_attr \"length\" \"4,4,16\")\n    (set_attr \"predicable\" \"yes\")]\n )\n+\n+(define_insn \"*thumb2_tlobits_cbranch\"\n+  [(set (pc)\n+\t(if_then_else\n+\t (match_operator 0 \"equality_operator\"\n+\t  [(zero_extract:SI (match_operand:SI 1 \"s_register_operand\" \"l,?h\")\n+\t\t\t    (match_operand:SI 2 \"const_int_operand\" \"i,i\")\n+\t\t\t    (const_int 0))\n+\t   (const_int 0)])\n+\t (label_ref (match_operand 3 \"\" \"\"))\n+\t (pc)))\n+   (clobber (match_scratch:SI 4 \"=l,X\"))]\n+  \"TARGET_THUMB2\"\n+  \"*\n+  {\n+  if (which_alternative == 0)\n+    {\n+      rtx op[3];\n+      op[0] = operands[4];\n+      op[1] = operands[1];\n+      op[2] = GEN_INT (32 - INTVAL (operands[2]));\n+\n+      output_asm_insn (\\\"lsls\\\\t%0, %1, %2\\\", op);\n+      switch (get_attr_length (insn))\n+\t{\n+\t  case 4:  return \\\"b%d0\\\\t%l3\\\";\n+\t  case 6:  return \\\"b%D0\\\\t.LCB%=\\;b\\\\t%l3\\\\t%@long jump\\\\n.LCB%=:\\\";\n+\t  default: return \\\"b%D0\\\\t.LCB%=\\;bl\\\\t%l3\\\\t%@far jump\\\\n.LCB%=:\\\";\n+\t}\n+    }\n+  else\n+    {\n+      rtx op[2];\n+      op[0] = operands[1];\n+      op[1] = GEN_INT ((1 << INTVAL (operands[2])) - 1);\n+\n+      output_asm_insn (\\\"tst\\\\t%0, %1\\\", op);\n+      switch (get_attr_length (insn))\n+\t{\n+\t  case 6:  return \\\"b%d0\\\\t%l3\\\";\n+\t  case 8:  return \\\"b%D0\\\\t.LCB%=\\;b\\\\t%l3\\\\t%@long jump\\\\n.LCB%=:\\\";\n+\t  default: return \\\"b%D0\\\\t.LCB%=\\;bl\\\\t%l3\\\\t%@far jump\\\\n.LCB%=:\\\";\n+\t}\n+    }\n+  }\"\n+  [(set (attr \"far_jump\")\n+\t(if_then_else\n+\t    (and (ge (minus (match_dup 3) (pc)) (const_int -2040))\n+\t\t (le (minus (match_dup 3) (pc)) (const_int 2048)))\n+\t    (const_string \"no\")\n+\t    (const_string \"yes\")))\n+   (set (attr \"length\")\n+\t(if_then_else\n+\t  (eq (symbol_ref (\"which_alternative\"))\n+\t\t\t  (const_int 0))\n+\t  (if_then_else\n+\t    (and (ge (minus (match_dup 3) (pc)) (const_int -250))\n+\t\t (le (minus (match_dup 3) (pc)) (const_int 256)))\n+\t    (const_int 4)\n+\t    (if_then_else\n+\t\t(and (ge (minus (match_dup 3) (pc)) (const_int -2040))\n+\t\t     (le (minus (match_dup 3) (pc)) (const_int 2048)))\n+\t\t(const_int 6)\n+\t\t(const_int 8)))\n+\t  (if_then_else\n+\t    (and (ge (minus (match_dup 3) (pc)) (const_int -250))\n+\t\t (le (minus (match_dup 3) (pc)) (const_int 256)))\n+\t    (const_int 6)\n+\t    (if_then_else\n+\t\t(and (ge (minus (match_dup 3) (pc)) (const_int -2040))\n+\t\t     (le (minus (match_dup 3) (pc)) (const_int 2048)))\n+\t\t(const_int 8)\n+\t\t(const_int 10)))))]\n+)"}, {"sha": "5ee636f4b6ec8a0863605b97c7f1039069551cc4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "patch": "@@ -1,3 +1,8 @@\n+2010-05-10  Wei Guozhi  <carrot@google.com>\n+\n+\tPR target/42879\n+\t* gcc.target/arm/pr42879.c: New testcase.\n+\n 2010-05-09  Joseph Myers  <joseph@codesourcery.com>\n \n \tPR c/44051"}, {"sha": "02af72c18cc0d2798ba21e6adbc27be6601a6718", "filename": "gcc/testsuite/gcc.target/arm/pr42879.c", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr42879.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/333b67a9f16208485c0f76edea0b4ecaddd0c8e6/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr42879.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fpr42879.c?ref=333b67a9f16208485c0f76edea0b4ecaddd0c8e6", "patch": "@@ -0,0 +1,15 @@\n+/* { dg-options \"-march=armv7-a -mthumb -Os\" }  */\n+/* { dg-final { scan-assembler \"lsls\" } } */\n+\n+struct A\n+{\n+  int v:1;\n+};\n+\n+int bar();\n+int foo(struct A* p)\n+{\n+  if (p->v)\n+    return 1;\n+  return bar();\n+}"}]}