{"sha": "0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGQ1M2QzNmI2ZTI1ZmIyYzMwNmRjM2Q1YTc2Yjc4ZTU5Njc5NWI2ZQ==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-01T15:54:39Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2011-08-01T15:54:39Z"}, "message": "[multiple changes]\n\n2011-08-01  Yannick Moy  <moy@adacore.com>\n\n\t* sem_util.adb (Enter_Name): issue error in formal mode on declaration\n\tof homonym, unless the homonym is one of the cases allowed in SPARK\n\t* par-ch5.adb (Parse_Decls_Begin_End): issue error in SPARK mode for\n\tpackage declaration occurring after a body.\n\n2011-08-01  Robert Dewar  <dewar@adacore.com>\n\n\t* checks.adb, exp_ch4.adb: Minor reformatting.\n\n2011-08-01  Javier Miranda  <miranda@adacore.com>\n\n\t* einfo.ads (Access_Disp_Table): Fix documentation.\n\t(Dispatch_Table_Wrappers): Fix documentation.\n\n2011-08-01  Pascal Obry  <obry@adacore.com>\n\n\t* prj-env.adb, prj-env.ads: Minor reformatting.\n\nFrom-SVN: r177053", "tree": {"sha": "3c38c0199334e35cf3e0d160332ebaf82e8c988d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3c38c0199334e35cf3e0d160332ebaf82e8c988d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/comments", "author": null, "committer": null, "parents": [{"sha": "8ed68165ed9a61e0e0a0d3de377d37718ee24b61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8ed68165ed9a61e0e0a0d3de377d37718ee24b61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8ed68165ed9a61e0e0a0d3de377d37718ee24b61"}], "stats": {"total": 119, "additions": 92, "deletions": 27}, "files": [{"sha": "e69a94cc5c5cdbdabca7d448a87bd7c10b73e959", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -1,3 +1,23 @@\n+2011-08-01  Yannick Moy  <moy@adacore.com>\n+\n+\t* sem_util.adb (Enter_Name): issue error in formal mode on declaration\n+\tof homonym, unless the homonym is one of the cases allowed in SPARK\n+\t* par-ch5.adb (Parse_Decls_Begin_End): issue error in SPARK mode for\n+\tpackage declaration occurring after a body.\n+\n+2011-08-01  Robert Dewar  <dewar@adacore.com>\n+\n+\t* checks.adb, exp_ch4.adb: Minor reformatting.\n+\n+2011-08-01  Javier Miranda  <miranda@adacore.com>\n+\n+\t* einfo.ads (Access_Disp_Table): Fix documentation.\n+\t(Dispatch_Table_Wrappers): Fix documentation.\n+\n+2011-08-01  Pascal Obry  <obry@adacore.com>\n+\n+\t* prj-env.adb, prj-env.ads: Minor reformatting.\n+\n 2011-08-01  Yannick Moy  <moy@adacore.com>\n \n \t* sem_util.ads, sem_util.adb, par.adb, par_util.adb"}, {"sha": "a1a91b6d7a3645bb141c5ca4a3aa8affbc24844a", "filename": "gcc/ada/checks.adb", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fchecks.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fchecks.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fchecks.adb?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -4565,8 +4565,10 @@ package body Checks is\n       ----------------------\n \n       function Entity_Of_Prefix return Entity_Id is\n-         P : Node_Id := Prefix (N);\n+         P : Node_Id;\n+\n       begin\n+         P := Prefix (N);\n          while not Is_Entity_Name (P) loop\n             if not Nkind_In (P, N_Selected_Component,\n                                 N_Indexed_Component)\n@@ -4596,7 +4598,7 @@ package body Checks is\n \n       if not Is_Array_Type (Etype (A))\n         or else (Present (A_Ent)\n-                   and then Index_Checks_Suppressed (A_Ent))\n+                  and then Index_Checks_Suppressed (A_Ent))\n         or else Index_Checks_Suppressed (Etype (A))\n       then\n          return;"}, {"sha": "4495f582680e941a37c72711b5047d64fe36b995", "filename": "gcc/ada/einfo.ads", "status": "modified", "additions": 17, "deletions": 16, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Feinfo.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Feinfo.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Feinfo.ads?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -338,18 +338,18 @@ package Einfo is\n --       statements referencing the same entry.\n \n --    Access_Disp_Table (Elist16) [implementation base type only]\n---       Present in record types and subtypes. Set in tagged types to point to\n---       the dispatch tables associated with the tagged type. The first two\n---       entities correspond with the primary dispatch table: 1) primary\n---       dispatch table with user-defined primitives, 2) primary dispatch table\n---       with predefined primitives. For each interface type covered by the\n---       tagged type we also have: 3) secondary dispatch table with thunks of\n---       primitives covering user-defined interface primitives, 4) secondary\n---       dispatch table with thunks of predefined primitives, 5) secondary\n---       dispatch table with user-defined primitives, and 6) secondary dispatch\n---       table with predefined primitives. The last entity of this list is an\n---       access type declaration used to expand dispatching calls through the\n---       primary dispatch table. For a non-tagged record, contains No_Elist.\n+--       Present in E_Record_Type and E_Record_Subtype entities. Set in tagged\n+--       types to point to their dispatch tables. The first two entities are\n+--       associated with the primary dispatch table: 1) primary dispatch table\n+--       with user-defined primitives 2) primary dispatch table with predefined\n+--       primitives. For each interface type covered by the tagged type we also\n+--       have: 3) secondary dispatch table with thunks of primitives covering\n+--       user-defined interface primitives, 4) secondary dispatch table with\n+--       thunks of predefined primitives, 5) secondary dispatch table with user\n+--       defined primitives, and 6) secondary dispatch table with predefined\n+--       primitives. The last entity of this list is an access type declaration\n+--       used to expand dispatching calls through the primary dispatch table.\n+--       For a non-tagged record, contains No_Elist.\n \n --    Actual_Subtype (Node17)\n --       Present in variables, constants, and formal parameters. This is the\n@@ -855,10 +855,11 @@ package Einfo is\n --       index starting at 1 and ranging up to number of discriminants.\n \n --    Dispatch_Table_Wrappers (Elist26) [implementation base type only]\n---       Present in record types and subtypes. Set in library level tagged type\n---       entities if we are generating statically allocated dispatch tables.\n---       Points to the list of dispatch table wrappers associated with the\n---       tagged type. For a non-tagged record, contains No_Elist.\n+--       Present in E_Record_Type and E_Record_Subtype entities. Set in library\n+--       level tagged type entities if we are generating statically allocated\n+--       dispatch tables. Points to the list of dispatch table wrappers\n+--       associated with the tagged type. For a non-tagged record, contains\n+--       No_Elist.\n \n --    DTC_Entity (Node16)\n --       Present in function and procedure entities. Set to Empty unless"}, {"sha": "5615ac912ddafea800a62798471aac53e9199819", "filename": "gcc/ada/exp_ch4.adb", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fexp_ch4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fexp_ch4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch4.adb?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -876,7 +876,6 @@ package body Exp_Ch4 is\n          if Present (TagT) then\n             declare\n                Full_T : constant Entity_Id := Underlying_Type (TagT);\n-\n             begin\n                Tag_Assign :=\n                  Make_Assignment_Statement (Loc,"}, {"sha": "9a390ab03a0f2a9d1ef3c184d0926696f4ad3cd1", "filename": "gcc/ada/par-ch5.adb", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fpar-ch5.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fpar-ch5.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fpar-ch5.adb?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -2114,6 +2114,8 @@ package body Ch5 is\n       --  The same is true for the SPARK mode: although SPARK 95 removes\n       --  the distinction between initial and later declarative items,\n       --  the distinction remains in the Examiner. (JB01-005)\n+      --  Note that the Examiner does not count package declarations in later\n+      --  declarative items.\n \n       if Ada_Version = Ada_83 or else SPARK_Mode then\n          Decl := First (Decls);\n@@ -2135,7 +2137,9 @@ package body Ch5 is\n                Body_Sloc := Sloc (Decl);\n \n                Inner : while Present (Decl) loop\n-                  if Nkind (Decl) not in N_Later_Decl_Item\n+                  if (Nkind (Decl) not in N_Later_Decl_Item\n+                      or else (SPARK_Mode\n+                               and then Nkind (Decl) = N_Package_Declaration))\n                     and then Nkind (Decl) /= N_Pragma\n                   then\n                      if Ada_Version = Ada_83 then"}, {"sha": "2e0cb8a915d43fd872c24fe551b3e5e338c56326", "filename": "gcc/ada/prj-env.adb", "status": "modified", "additions": 6, "deletions": 6, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fprj-env.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fprj-env.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.adb?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -2013,9 +2013,9 @@ package body Prj.Env is\n       -------------------\n \n       function Try_Path_Name (Path : String) return String_Access is\n-         First    : Natural;\n-         Last     : Natural;\n-         Result   : String_Access := null;\n+         First  : Natural;\n+         Last   : Natural;\n+         Result : String_Access := null;\n \n       begin\n          if Current_Verbosity = High then\n@@ -2080,9 +2080,9 @@ package body Prj.Env is\n \n       --  Local Declarations\n \n-      Result    : String_Access;\n-      Has_Dot   : Boolean := False;\n-      Key       : Name_Id;\n+      Result  : String_Access;\n+      Has_Dot : Boolean := False;\n+      Key     : Name_Id;\n \n    --  Start of processing for Find_Project\n "}, {"sha": "cd6145dcfde5373bf0dc4137e5ef9b1f5ed6d40a", "filename": "gcc/ada/prj-env.ads", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fprj-env.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fprj-env.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-env.ads?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -75,7 +75,7 @@ package Prj.Env is\n      (In_Tree   : Project_Tree_Ref;\n       Path_FD   : out File_Descriptor;\n       Path_Name : out Path_Name_Type);\n-   --  Create a new temporary path file. Get the file name in Path_Name.\n+   --  Create a new temporary path file. Get the file name in Path_Name\n \n    function Ada_Include_Path\n      (Project   : Project_Id;"}, {"sha": "1096208cdf995fa8995b36564cc08ea2068dea5a", "filename": "gcc/ada/sem_util.adb", "status": "modified", "additions": 39, "deletions": 0, "changes": 39, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fsem_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0d53d36b6e25fb2c306dc3d5a76b78e596795b6e/gcc%2Fada%2Fsem_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_util.adb?ref=0d53d36b6e25fb2c306dc3d5a76b78e596795b6e", "patch": "@@ -3200,6 +3200,45 @@ package body Sem_Util is\n       Append_Entity     (Def_Id, S);\n       Set_Public_Status (Def_Id);\n \n+      --  Declaring an homonym is not allowed in SPARK or ALFA...\n+\n+      if Formal_Verification_Mode and then Present (C)\n+\n+        --  ...unless the new declaration is in a subprogram, and the visible\n+        --  declaration is a variable declaration or a parameter specification\n+        --  outside that subprogram;\n+\n+        and then not\n+          (Nkind_In (Parent (Parent (Def_Id)),\n+                     N_Subprogram_Body,\n+                     N_Function_Specification,\n+                     N_Procedure_Specification)\n+           and then\n+             Nkind_In (Parent (C),\n+                       N_Object_Declaration,\n+                       N_Parameter_Specification))\n+\n+        --  ...or the new declaration is in a package, and the visible\n+        --  declaration occurs outside that package;\n+\n+        and then not Nkind_In (Parent (Parent (Def_Id)),\n+                               N_Package_Specification,\n+                               N_Package_Body)\n+\n+        --  ...or the new declaration is a component declaration in a record\n+        --  type definition.\n+\n+        and then Nkind (Parent (Def_Id)) /= N_Component_Declaration\n+\n+        --  Don't issue error for non-source entities\n+\n+        and then Comes_From_Source (Def_Id)\n+        and then Comes_From_Source (C)\n+      then\n+         Error_Msg_Sloc := Sloc (C);\n+         Formal_Error_Msg_N (\"redeclaration of identifier &#\", Def_Id);\n+      end if;\n+\n       --  Warn if new entity hides an old one\n \n       if Warn_On_Hiding and then Present (C)"}]}