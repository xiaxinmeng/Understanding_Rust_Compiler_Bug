{"sha": "4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGY5Y2EwNjdhMWIwZjNkY2I5ZDE4MTg3NzI2ZmM3YmVhYzc5MWIxOA==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@cygnus.com", "date": "1997-11-05T19:29:37Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1997-11-05T19:29:37Z"}, "message": "Fix i386-linux build failure.\n\n\t* i386.c (load_pic_register): Call prologue_get_pc_and_set_got.\n\t* i386.md (prologue_set_got, prologue_get_pc): Add UNSPEC_VOLATILE\n\tto pattern.\n\t(prologue_get_pc_and_set_got): New pattern.\n\nFrom-SVN: r16342", "tree": {"sha": "2166745d91bfdd6a2826552a04c4191fcb9cf87a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2166745d91bfdd6a2826552a04c4191fcb9cf87a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/comments", "author": null, "committer": null, "parents": [{"sha": "5b8f8eeb20f2f5582b9393f36a9b0e148f264316", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b8f8eeb20f2f5582b9393f36a9b0e148f264316", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b8f8eeb20f2f5582b9393f36a9b0e148f264316"}], "stats": {"total": 40, "additions": 30, "deletions": 10}, "files": [{"sha": "2801ba2280dee66ff32f840128b2aa6113500f55", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "patch": "@@ -1,3 +1,10 @@\n+Wed Nov  5 11:27:14 1997  Jim Wilson  <wilson@cygnus.com>\n+\n+\t* i386.c (load_pic_register): Call prologue_get_pc_and_set_got.\n+\t* i386.md (prologue_set_got, prologue_get_pc): Add UNSPEC_VOLATILE\n+\tto pattern.\n+\t(prologue_get_pc_and_set_got): New pattern.\n+\n Tue Nov  4 20:36:50 1997  Richard Henderson  (rth@cygnus.com)\n \n \t* alpha.c (summarize_insn): Handle ASM_OPERANDS.  Don't recurse"}, {"sha": "f411aaaa55b5ccdc5b127cbb7141e674db1e6adb", "filename": "gcc/config/i386/i386.c", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/gcc%2Fconfig%2Fi386%2Fi386.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/gcc%2Fconfig%2Fi386%2Fi386.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.c?ref=4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "patch": "@@ -1973,12 +1973,10 @@ load_pic_register (do_rtl)\n  \n       if (do_rtl)\n \t{\n-\t  emit_insn (gen_prologue_get_pc (xops[0], xops[1]));\n-\t  emit_insn (gen_pop (xops[0]));\n-\t  emit_insn (gen_prologue_set_got\n-\t\t     (xops[0],\n-\t\t      gen_rtx (SYMBOL_REF, Pmode, \"$_GLOBAL_OFFSET_TABLE_\"), \n-\t\t      xops[1]));\n+\t  /* We can't put a raw CODE_LABEL into the RTL, and we can't emit\n+\t     a new CODE_LABEL after reload, so we need a single pattern to\n+\t     emit the 3 necessary instructions.  */\n+\t  emit_insn (gen_prologue_get_pc_and_set_got (xops[0]));\n \t}\n       else\n \t{"}, {"sha": "ea72a98a65e4e3686bc4c318ace93fb1e0256b65", "filename": "gcc/config/i386/i386.md", "status": "modified", "additions": 19, "deletions": 4, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/gcc%2Fconfig%2Fi386%2Fi386.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4f9ca067a1b0f3dcb9d18187726fc7beac791b18/gcc%2Fconfig%2Fi386%2Fi386.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386.md?ref=4f9ca067a1b0f3dcb9d18187726fc7beac791b18", "patch": "@@ -6515,9 +6515,10 @@ byte_xor_operation:\n \n (define_insn \"prologue_set_got\"\n   [(set (match_operand:SI 0 \"\" \"\")\n-    (plus:SI (match_dup 0)\n-     (plus:SI (match_operand:SI 1 \"symbolic_operand\" \"\")\n-      (minus:SI (pc) (match_operand 2 \"\" \"\")))))]\n+\t(unspec_volatile\n+\t [(plus:SI (match_dup 0)\n+\t\t   (plus:SI (match_operand:SI 1 \"symbolic_operand\" \"\")\n+\t\t\t    (minus:SI (pc) (match_operand 2 \"\" \"\"))))] 1))]\n   \"\"\n   \"*\n {\n@@ -6538,7 +6539,7 @@ byte_xor_operation:\n \n (define_insn \"prologue_get_pc\"\n   [(set (match_operand:SI 0 \"\" \"\")\n-    (plus:SI (pc) (match_operand 1 \"\" \"\")))]\n+    (unspec_volatile [(plus:SI (pc) (match_operand 1 \"\" \"\"))] 2))]\n   \"\"\n   \"*\n {\n@@ -6552,6 +6553,20 @@ byte_xor_operation:\n   RET;\n }\")\n \n+(define_insn \"prologue_get_pc_and_set_got\"\n+  [(unspec_volatile [(match_operand:SI 0 \"\" \"\")] 3)]\n+  \"\"\n+  \"*\n+{\n+  operands[1] = gen_label_rtx ();\n+  output_asm_insn (AS1 (call,%P1), operands);\n+  ASM_OUTPUT_INTERNAL_LABEL (asm_out_file, \\\"L\\\",\n+\t\t\t     CODE_LABEL_NUMBER (operands[1]));\n+  output_asm_insn (AS1 (pop%L0,%0), operands);\n+  output_asm_insn (\\\"addl $_GLOBAL_OFFSET_TABLE_+[.-%P1],%0\\\", operands);\n+  RET;\n+}\")\n+\n (define_expand \"epilogue\"\n   [(const_int 1)]\n   \"\""}]}