{"sha": "d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDVhYjU2NzUwODY0ZmE4OWMwNmEzM2QyZjJkOGU1MzJkOGI2Yjc2YQ==", "commit": {"author": {"name": "Zdenek Dvorak", "email": "dvorakz@suse.cz", "date": "2005-06-05T18:07:43Z"}, "committer": {"name": "Zdenek Dvorak", "email": "rakdver@gcc.gnu.org", "date": "2005-06-05T18:07:43Z"}, "message": "re PR middle-end/21846 (segfault in fold_binary compiling vpr with -O2 -funroll-loops)\n\n\tPR tree-optimization/21846\n\t* tree-cfg.c (replace_uses_by): Update information stored at loops.\n\t* tree-flow.h (substitute_in_loop_info): Declare.\n\t* tree-scalar-evolution.c (initialize_scalar_evolutions_analyzer):\n\tEnsure that chrec_dont_know and chrec_known have a type.\n\t* tree-ssa-loop-niter.c (substitute_in_loop_info): New function.\n\nFrom-SVN: r100631", "tree": {"sha": "cfeafcc33d51ab68e1c5e4385dfbe70b56fbca72", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cfeafcc33d51ab68e1c5e4385dfbe70b56fbca72"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/comments", "author": null, "committer": null, "parents": [{"sha": "86403f0f329ea996b6323d4011d5da0111ab80d8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86403f0f329ea996b6323d4011d5da0111ab80d8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86403f0f329ea996b6323d4011d5da0111ab80d8"}], "stats": {"total": 45, "additions": 43, "deletions": 2}, "files": [{"sha": "50916eebdf77060fa0b738f4924d438495d6b86e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "patch": "@@ -1,3 +1,12 @@\n+2005-06-05  Zdenek Dvorak  <dvorakz@suse.cz>\n+\n+\tPR tree-optimization/21846\n+\t* tree-cfg.c (replace_uses_by): Update information stored at loops.\n+\t* tree-flow.h (substitute_in_loop_info): Declare.\n+\t* tree-scalar-evolution.c (initialize_scalar_evolutions_analyzer):\n+\tEnsure that chrec_dont_know and chrec_known have a type.\n+\t* tree-ssa-loop-niter.c (substitute_in_loop_info): New function.\n+\n 2005-06-05  Steven Bosscher  <stevenb@suse.de>\n \n \t* config/i386/i386.c (x86_use_loop): Remove."}, {"sha": "6108dd87622ba0cfc4cadee6b5b312f45b80e4ef", "filename": "gcc/tree-cfg.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-cfg.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-cfg.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-cfg.c?ref=d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "patch": "@@ -1264,6 +1264,19 @@ replace_uses_by (tree name, tree val)\n     }\n \n   VEC_free (tree, heap, stmts);\n+\n+  /* Also update the trees stored in loop structures.  */\n+  if (current_loops)\n+    {\n+      struct loop *loop;\n+\n+      for (i = 0; i < current_loops->num; i++)\n+\t{\n+\t  loop = current_loops->parray[i];\n+\t  if (loop)\n+\t    substitute_in_loop_info (loop, name, val);\n+\t}\n+    }\n }\n \n /* Merge block B into block A.  */"}, {"sha": "51a2051947db96facc4ac2d62334eb0e0523f854", "filename": "gcc/tree-flow.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-flow.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-flow.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-flow.h?ref=d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "patch": "@@ -679,6 +679,7 @@ bool tree_duplicate_loop_to_header_edge (struct loop *, edge, struct loops *,\n struct loop *tree_ssa_loop_version (struct loops *, struct loop *, tree,\n \t\t\t\t    basic_block *);\n tree expand_simple_operations (tree);\n+void substitute_in_loop_info (struct loop *, tree, tree);\n \n /* In tree-ssa-loop-im.c  */\n /* The possibilities of statement movement.  */"}, {"sha": "27531864c3c39263ea02b41b2a2d9bb8667c974b", "filename": "gcc/tree-scalar-evolution.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-scalar-evolution.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-scalar-evolution.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-scalar-evolution.c?ref=d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "patch": "@@ -2503,8 +2503,8 @@ initialize_scalar_evolutions_analyzer (void)\n       chrec_not_analyzed_yet = NULL_TREE;\n       chrec_dont_know = make_node (SCEV_NOT_KNOWN);\n       chrec_known = make_node (SCEV_KNOWN);\n-      TREE_TYPE (chrec_dont_know) = NULL_TREE;\n-      TREE_TYPE (chrec_known) = NULL_TREE;\n+      TREE_TYPE (chrec_dont_know) = void_type_node;\n+      TREE_TYPE (chrec_known) = void_type_node;\n     }\n }\n "}, {"sha": "78f14e9accf3dc3363012fff1b2463f634dbd2d0", "filename": "gcc/tree-ssa-loop-niter.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-ssa-loop-niter.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d5ab56750864fa89c06a33d2f2d8e532d8b6b76a/gcc%2Ftree-ssa-loop-niter.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-niter.c?ref=d5ab56750864fa89c06a33d2f2d8e532d8b6b76a", "patch": "@@ -1600,3 +1600,21 @@ free_numbers_of_iterations_estimates (struct loops *loops)\n \tfree_numbers_of_iterations_estimates_loop (loop);\n     }\n }\n+\n+/* Substitute value VAL for ssa name NAME inside expressions held\n+   at LOOP.  */\n+\n+void\n+substitute_in_loop_info (struct loop *loop, tree name, tree val)\n+{\n+  struct nb_iter_bound *bound;\n+\n+  loop->nb_iterations = simplify_replace_tree (loop->nb_iterations, name, val);\n+  loop->estimated_nb_iterations\n+\t  = simplify_replace_tree (loop->estimated_nb_iterations, name, val);\n+  for (bound = loop->bounds; bound; bound = bound->next)\n+    {\n+      bound->bound = simplify_replace_tree (bound->bound, name, val);\n+      bound->additional = simplify_replace_tree (bound->additional, name, val);\n+    }\n+}"}]}