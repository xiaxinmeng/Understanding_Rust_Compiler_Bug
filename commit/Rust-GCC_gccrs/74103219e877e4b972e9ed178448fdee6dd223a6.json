{"sha": "74103219e877e4b972e9ed178448fdee6dd223a6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzQxMDMyMTllODc3ZTRiOTcyZTllZDE3ODQ0OGZkZWU2ZGQyMjNhNg==", "commit": {"author": {"name": "Jan Kratochvil", "email": "jan.kratochvil@redhat.com", "date": "2015-06-08T13:35:51Z"}, "committer": {"name": "Jan Kratochvil", "email": "jkratoch@gcc.gnu.org", "date": "2015-06-08T13:35:51Z"}, "message": "re PR other/65366 (gdbhooks.py is incompatible with Python3)\n\n\tPR other/65366\n\t* gdbhooks.py: Import sys.\n\t(intptr): New function.  Replace int(...) by intptr(...).\n\nFrom-SVN: r224223", "tree": {"sha": "f7d753caed622f75c3f09b147cd40a323ce3bb64", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f7d753caed622f75c3f09b147cd40a323ce3bb64"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/74103219e877e4b972e9ed178448fdee6dd223a6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74103219e877e4b972e9ed178448fdee6dd223a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/74103219e877e4b972e9ed178448fdee6dd223a6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/74103219e877e4b972e9ed178448fdee6dd223a6/comments", "author": {"login": "jankratochvil", "id": 1223939, "node_id": "MDQ6VXNlcjEyMjM5Mzk=", "avatar_url": "https://avatars.githubusercontent.com/u/1223939?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jankratochvil", "html_url": "https://github.com/jankratochvil", "followers_url": "https://api.github.com/users/jankratochvil/followers", "following_url": "https://api.github.com/users/jankratochvil/following{/other_user}", "gists_url": "https://api.github.com/users/jankratochvil/gists{/gist_id}", "starred_url": "https://api.github.com/users/jankratochvil/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jankratochvil/subscriptions", "organizations_url": "https://api.github.com/users/jankratochvil/orgs", "repos_url": "https://api.github.com/users/jankratochvil/repos", "events_url": "https://api.github.com/users/jankratochvil/events{/privacy}", "received_events_url": "https://api.github.com/users/jankratochvil/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "c00f4f5fb3f0b482cc50d459b0f89af4ddb0ec1a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c00f4f5fb3f0b482cc50d459b0f89af4ddb0ec1a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c00f4f5fb3f0b482cc50d459b0f89af4ddb0ec1a"}], "stats": {"total": 73, "additions": 43, "deletions": 30}, "files": [{"sha": "664dc37a5e82370b37f6d9de69a0d74add9259f7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74103219e877e4b972e9ed178448fdee6dd223a6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74103219e877e4b972e9ed178448fdee6dd223a6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=74103219e877e4b972e9ed178448fdee6dd223a6", "patch": "@@ -1,3 +1,9 @@\n+2015-06-08  Jan Kratochvil  <jan.kratochvil@redhat.com>\n+\n+\tPR other/65366\n+\t* gdbhooks.py: Import sys.\n+\t(intptr): New function.  Replace int(...) by intptr(...).\n+\n 2015-06-08  Richard Biener  <rguenther@suse.de>\n \n \t* tree-vect-stmts.c (vectorizable_load): Compute the pointer"}, {"sha": "3a62a2d8acbe01179d3852837449d0cd714f2bb2", "filename": "gcc/gdbhooks.py", "status": "modified", "additions": 37, "deletions": 30, "changes": 67, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/74103219e877e4b972e9ed178448fdee6dd223a6/gcc%2Fgdbhooks.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/74103219e877e4b972e9ed178448fdee6dd223a6/gcc%2Fgdbhooks.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgdbhooks.py?ref=74103219e877e4b972e9ed178448fdee6dd223a6", "patch": "@@ -132,6 +132,7 @@\n \"\"\"\n import os.path\n import re\n+import sys\n \n import gdb\n import gdb.printing\n@@ -149,6 +150,12 @@\n tcc_type = tree_code_class_dict['tcc_type']\n tcc_declaration = tree_code_class_dict['tcc_declaration']\n \n+# Python3 has int() with arbitrary precision (bignum).  Python2 int() is 32-bit\n+# on 32-bit hosts but remote targets may have 64-bit pointers there; Python2\n+# long() is always 64-bit but Python3 no longer has anything named long.\n+def intptr(gdbval):\n+    return long(gdbval) if sys.version_info.major == 2 else int(gdbval)\n+\n class Tree:\n     \"\"\"\n     Wrapper around a gdb.Value for a tree, with various methods\n@@ -158,7 +165,7 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def is_nonnull(self):\n-        return int(self.gdbval)\n+        return intptr(self.gdbval)\n \n     def TREE_CODE(self):\n         \"\"\"\n@@ -197,7 +204,7 @@ def to_string (self):\n         # like gcc/print-tree.c:print_node_brief\n         # #define TREE_CODE(NODE) ((enum tree_code) (NODE)->base.code)\n         # tree_code_name[(int) TREE_CODE (node)])\n-        if int(self.gdbval) == 0:\n+        if intptr(self.gdbval) == 0:\n             return '<tree 0x0>'\n \n         val_TREE_CODE = self.node.TREE_CODE()\n@@ -209,17 +216,17 @@ def to_string (self):\n         val_tclass = val_tree_code_type[val_TREE_CODE]\n \n         val_tree_code_name = gdb.parse_and_eval('tree_code_name')\n-        val_code_name = val_tree_code_name[int(val_TREE_CODE)]\n+        val_code_name = val_tree_code_name[intptr(val_TREE_CODE)]\n         #print(val_code_name.string())\n \n-        result = '<%s 0x%x' % (val_code_name.string(), int(self.gdbval))\n-        if int(val_tclass) == tcc_declaration:\n+        result = '<%s 0x%x' % (val_code_name.string(), intptr(self.gdbval))\n+        if intptr(val_tclass) == tcc_declaration:\n             tree_DECL_NAME = self.node.DECL_NAME()\n             if tree_DECL_NAME.is_nonnull():\n                  result += ' %s' % tree_DECL_NAME.IDENTIFIER_POINTER()\n             else:\n                 pass # TODO: labels etc\n-        elif int(val_tclass) == tcc_type:\n+        elif intptr(val_tclass) == tcc_type:\n             tree_TYPE_NAME = Tree(self.gdbval['type_common']['name'])\n             if tree_TYPE_NAME.is_nonnull():\n                 if tree_TYPE_NAME.TREE_CODE() == IDENTIFIER_NODE:\n@@ -242,8 +249,8 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def to_string (self):\n-        result = '<cgraph_node* 0x%x' % int(self.gdbval)\n-        if int(self.gdbval):\n+        result = '<cgraph_node* 0x%x' % intptr(self.gdbval)\n+        if intptr(self.gdbval):\n             # symtab_node::name calls lang_hooks.decl_printable_name\n             # default implementation (lhd_decl_printable_name) is:\n             #    return IDENTIFIER_POINTER (DECL_NAME (decl));\n@@ -261,12 +268,12 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def to_string (self):\n-        if int(self.gdbval) == 0:\n+        if intptr(self.gdbval) == 0:\n             return '<dw_die_ref 0x0>'\n-        result = '<dw_die_ref 0x%x' % int(self.gdbval)\n+        result = '<dw_die_ref 0x%x' % intptr(self.gdbval)\n         result += ' %s' % self.gdbval['die_tag']\n-        if int(self.gdbval['die_parent']) != 0:\n-            result += ' <parent=0x%x %s>' % (int(self.gdbval['die_parent']),\n+        if intptr(self.gdbval['die_parent']) != 0:\n+            result += ' <parent=0x%x %s>' % (intptr(self.gdbval['die_parent']),\n                                              self.gdbval['die_parent']['die_tag'])\n                                              \n         result += '>'\n@@ -279,13 +286,13 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def to_string (self):\n-        if int(self.gdbval) == 0:\n+        if intptr(self.gdbval) == 0:\n             return '<gimple 0x0>'\n         val_gimple_code = self.gdbval['code']\n         val_gimple_code_name = gdb.parse_and_eval('gimple_code_name')\n-        val_code_name = val_gimple_code_name[int(val_gimple_code)]\n+        val_code_name = val_gimple_code_name[intptr(val_gimple_code)]\n         result = '<%s 0x%x' % (val_code_name.string(),\n-                               int(self.gdbval))\n+                               intptr(self.gdbval))\n         result += '>'\n         return result\n \n@@ -306,9 +313,9 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def to_string (self):\n-        result = '<basic_block 0x%x' % int(self.gdbval)\n-        if int(self.gdbval):\n-            result += ' (%s)' % bb_index_to_str(int(self.gdbval['index']))\n+        result = '<basic_block 0x%x' % intptr(self.gdbval)\n+        if intptr(self.gdbval):\n+            result += ' (%s)' % bb_index_to_str(intptr(self.gdbval['index']))\n         result += '>'\n         return result\n \n@@ -317,10 +324,10 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def to_string (self):\n-        result = '<edge 0x%x' % int(self.gdbval)\n-        if int(self.gdbval):\n-            src = bb_index_to_str(int(self.gdbval['src']['index']))\n-            dest = bb_index_to_str(int(self.gdbval['dest']['index']))\n+        result = '<edge 0x%x' % intptr(self.gdbval)\n+        if intptr(self.gdbval):\n+            src = bb_index_to_str(intptr(self.gdbval['src']['index']))\n+            dest = bb_index_to_str(intptr(self.gdbval['dest']['index']))\n             result += ' (%s -> %s)' % (src, dest)\n         result += '>'\n         return result\n@@ -336,7 +343,7 @@ def GET_CODE(self):\n \n def GET_RTX_LENGTH(code):\n     val_rtx_length = gdb.parse_and_eval('rtx_length')\n-    return int(val_rtx_length[code])\n+    return intptr(val_rtx_length[code])\n \n def GET_RTX_NAME(code):\n     val_rtx_name = gdb.parse_and_eval('rtx_name')\n@@ -359,12 +366,12 @@ def to_string (self):\n         \"\"\"\n         # We use print_inline_rtx to avoid a trailing newline\n         gdb.execute('call print_inline_rtx (stderr, (const_rtx) %s, 0)'\n-                    % int(self.gdbval))\n+                    % intptr(self.gdbval))\n         return ''\n \n         # or by hand; based on gcc/print-rtl.c:print_rtx\n         result = ('<rtx_def 0x%x'\n-                  % (int(self.gdbval)))\n+                  % (intptr(self.gdbval)))\n         code = self.rtx.GET_CODE()\n         result += ' (%s' % GET_RTX_NAME(code)\n         format_ = GET_RTX_FORMAT(code)\n@@ -380,11 +387,11 @@ def __init__(self, gdbval):\n         self.gdbval = gdbval\n \n     def to_string (self):\n-        result = '<opt_pass* 0x%x' % int(self.gdbval)\n-        if int(self.gdbval):\n+        result = '<opt_pass* 0x%x' % intptr(self.gdbval)\n+        if intptr(self.gdbval):\n             result += (' \"%s\"(%i)'\n                        % (self.gdbval['name'].string(),\n-                          int(self.gdbval['static_pass_number'])))\n+                          intptr(self.gdbval['static_pass_number'])))\n         result += '>'\n         return result\n \n@@ -401,10 +408,10 @@ def display_hint (self):\n     def to_string (self):\n         # A trivial implementation; prettyprinting the contents is done\n         # by gdb calling the \"children\" method below.\n-        return '0x%x' % int(self.gdbval)\n+        return '0x%x' % intptr(self.gdbval)\n \n     def children (self):\n-        if int(self.gdbval) == 0:\n+        if intptr(self.gdbval) == 0:\n             return\n         m_vecpfx = self.gdbval['m_vecpfx']\n         m_num = m_vecpfx['m_num']"}]}