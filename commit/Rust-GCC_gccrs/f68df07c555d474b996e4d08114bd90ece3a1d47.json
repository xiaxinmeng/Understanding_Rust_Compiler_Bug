{"sha": "f68df07c555d474b996e4d08114bd90ece3a1d47", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjY4ZGYwN2M1NTVkNDc0Yjk5NmU0ZDA4MTE0YmQ5MGVjZTNhMWQ0Nw==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2010-02-11T12:23:08Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2010-02-11T12:23:08Z"}, "message": "re PR driver/43021 (Driver no longer handles fancy names)\n\n2010-02-11  Richard Guenther  <rguenther@suse.de>\n\n\tPR driver/43021\n\t* gcc.c (process_command): Handle LTO file@offset case more\n\tappropriately.\n\n\tlto/\n\t* lto-elf.c (lto_elf_file_open): Handle file@offset case more\n\tappropriately.\n\nFrom-SVN: r156695", "tree": {"sha": "b5c6ba211c6d44152757721aa56c71c41a65aff2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b5c6ba211c6d44152757721aa56c71c41a65aff2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f68df07c555d474b996e4d08114bd90ece3a1d47", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f68df07c555d474b996e4d08114bd90ece3a1d47", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f68df07c555d474b996e4d08114bd90ece3a1d47", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f68df07c555d474b996e4d08114bd90ece3a1d47/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8f6aedbafe717b329098a6846167a1bee2821507", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8f6aedbafe717b329098a6846167a1bee2821507", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8f6aedbafe717b329098a6846167a1bee2821507"}], "stats": {"total": 71, "additions": 48, "deletions": 23}, "files": [{"sha": "1952f78c3b9256af0b2114cfe2980894f70d75ad", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f68df07c555d474b996e4d08114bd90ece3a1d47", "patch": "@@ -1,3 +1,9 @@\n+2010-02-11  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR driver/43021\n+\t* gcc.c (process_command): Handle LTO file@offset case more\n+\tappropriately.\n+\n 2010-02-11  Jakub Jelinek  <jakub@redhat.com>\n \n \t* reload1.c (eliminate_regs_1): If insn is DEBUG_INSN, avoid any"}, {"sha": "31e4ab37513ebd1508b2889383c00287a6b20465", "filename": "gcc/gcc.c", "status": "modified", "additions": 22, "deletions": 7, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=f68df07c555d474b996e4d08114bd90ece3a1d47", "patch": "@@ -4575,20 +4575,35 @@ process_command (int argc, const char **argv)\n \t}\n       else\n \t{\n-          const char *p = strchr (argv[i], '@');\n+          const char *p = strrchr (argv[i], '@');\n           char *fname;\n+\t  long offset;\n+\t  int consumed;\n #ifdef HAVE_TARGET_OBJECT_SUFFIX\n \t  argv[i] = convert_filename (argv[i], 0, access (argv[i], F_OK));\n #endif\n-          if (!p)\n-            fname = xstrdup (argv[i]);\n-          else\n-            {\n+\t  /* For LTO static archive support we handle input file\n+\t     specifications that are composed of a filename and\n+\t     an offset like FNAME@OFFSET.  */\n+\t  if (p\n+\t      && p != argv[i]\n+\t      && sscanf (p, \"@%li%n\", &offset, &consumed) >= 1\n+\t      && strlen (p) == (unsigned int)consumed)\n+\t    {\n               fname = (char *)xmalloc (p - argv[i] + 1);\n               memcpy (fname, argv[i], p - argv[i]);\n               fname[p - argv[i]] = '\\0';\n-            }\n-\n+\t      /* Only accept non-stdin and existing FNAME parts, otherwise\n+\t\t try with the full name.  */\n+\t      if (strcmp (fname, \"-\") == 0 || access (fname, F_OK) < 0)\n+\t\t{\n+\t\t  free (fname);\n+\t\t  fname = xstrdup (argv[i]);\n+\t\t}\n+\t    }\n+\t  else\n+\t    fname = xstrdup (argv[i]);\n+ \n           if (strcmp (fname, \"-\") != 0 && access (fname, F_OK) < 0)\n             {\n               perror_with_name (fname);"}, {"sha": "58e51231bf104d884c5548555aefee54f1ef9643", "filename": "gcc/lto/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2Flto%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2Flto%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2FChangeLog?ref=f68df07c555d474b996e4d08114bd90ece3a1d47", "patch": "@@ -1,3 +1,9 @@\n+2010-02-11  Richard Guenther  <rguenther@suse.de>\n+\n+\tPR driver/43021\n+\t* lto-elf.c (lto_elf_file_open): Handle file@offset case more\n+\tappropriately.\n+\n 2010-01-11  Andy Hutchinson  <hutchinsonandy@gcc.gnu.org>\n \n \t* lto.c (O_BINARY): Define."}, {"sha": "356e513953667465dba03f219241d83929a2e26c", "filename": "gcc/lto/lto-elf.c", "status": "modified", "additions": 14, "deletions": 16, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2Flto%2Flto-elf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f68df07c555d474b996e4d08114bd90ece3a1d47/gcc%2Flto%2Flto-elf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flto%2Flto-elf.c?ref=f68df07c555d474b996e4d08114bd90ece3a1d47", "patch": "@@ -550,35 +550,33 @@ lto_elf_file_open (const char *filename, bool writable)\n   lto_elf_file *elf_file;\n   lto_file *result = NULL;\n   off_t offset;\n+  long loffset;\n   off_t header_offset;\n   const char *offset_p;\n   char *fname;\n+  int consumed;\n \n-  offset_p = strchr (filename, '@');\n-  if (!offset_p)\n+  offset_p = strrchr (filename, '@');\n+  if (offset_p\n+      && offset_p != filename\n+      && sscanf (offset_p, \"@%li%n\", &loffset, &consumed) >= 1\n+      && strlen (offset_p) == (unsigned int)consumed)\n     {\n-      fname = xstrdup (filename);\n-      offset = 0;\n-      header_offset = 0;\n-    }\n-  else\n-    {\n-      /* The file started with '@' is a file containing command line\n-\t options.  Stop if it doesn't exist.  */\n-      if (offset_p == filename)\n-\tfatal_error (\"command line option file '%s' does not exist\",\n-\t\t     filename);\n-\n       fname = (char *) xmalloc (offset_p - filename + 1);\n       memcpy (fname, filename, offset_p - filename);\n       fname[offset_p - filename] = '\\0';\n-      offset_p += 3; /* skip the @0x */\n-      offset = lto_parse_hex (offset_p);\n+      offset = (off_t)loffset;\n       /* elf_rand expects the offset to point to the ar header, not the\n          object itself. Subtract the size of the ar header (60 bytes).\n          We don't uses sizeof (struct ar_hd) to avoid including ar.h */\n       header_offset = offset - 60;\n     }\n+  else\n+    {\n+      fname = xstrdup (filename);\n+      offset = 0;\n+      header_offset = 0;\n+    }\n \n   /* Set up.  */\n   elf_file = XCNEW (lto_elf_file);"}]}