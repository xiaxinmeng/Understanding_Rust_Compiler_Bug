{"sha": "5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWI3NjdiOWQwYzJjMmIyNjQ2YWVhZGZhMmM4MTU2ZGRlN2EwODVmYw==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2007-12-11T08:22:10Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2007-12-11T08:22:10Z"}, "message": "re PR c++/34238 (\"static data member used, but not defined\" error on member definition)\n\n\tPR c++/34238\n\t* decl2.c (cp_write_global_declarations): Revert 2007-11-22 change.\n\n\t* g++.dg/ext/visibility/anon7.C: Add xfail.\n\t* g++.dg/ext/visibility/anon9.C: New test.\n\t* g++.dg/ext/visibility/anon10.C: New test.\n\nFrom-SVN: r130771", "tree": {"sha": "78ec16b06acbfa9666452cfa650bb987f92c4688", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/78ec16b06acbfa9666452cfa650bb987f92c4688"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "61a861e6868242b07f7a06f5981681061093a69f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61a861e6868242b07f7a06f5981681061093a69f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61a861e6868242b07f7a06f5981681061093a69f"}], "stats": {"total": 81, "additions": 65, "deletions": 16}, "files": [{"sha": "f8df2b23919eff084b52d48edbbe1dc244afedfd", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "patch": "@@ -1,5 +1,8 @@\n 2007-12-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/34238\n+\t* decl2.c (cp_write_global_declarations): Revert 2007-11-22 change.\n+\n \tPR c++/34364\n \t* rtti.c (build_dynamic_cast): Call convert_from_reference even for\n \tdynamic_cast in a template."}, {"sha": "97b3ee0f3f25adf6e607c04ba35d402b49f258d1", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 1, "deletions": 15, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "patch": "@@ -3366,21 +3366,7 @@ cp_write_global_declarations (void)\n \t  /* If this static data member is needed, provide it to the\n \t     back end.  */\n \t  if (DECL_NOT_REALLY_EXTERN (decl) && decl_needed_p (decl))\n-\t    {\n-\t      /* Error on\n-\t\t namespace { struct A { static int i; }; }\n-\t\t int foo () { return A::i; }\n-\t\t without A::i definition (which can't be defined in\n-\t\t a different CU because of the anonymous namespace).\n-\t\t Don't do this if DECL_INITIAL is set, because for\n-\t\t namespace { struct A { static const int i = 4; } };\n-\t\t decl_needed_p won't reliably detect whether it was\n-\t\t really needed.  */\n-\t      if (DECL_IN_AGGR_P (decl) && DECL_INITIAL (decl) == NULL_TREE)\n-\t\terror (\"%Jstatic data member %qD used, but not defined\",\n-\t\t       decl, decl);\n-\t      DECL_EXTERNAL (decl) = 0;\n-\t    }\n+\t    DECL_EXTERNAL (decl) = 0;\n \t}\n       if (VEC_length (tree, pending_statics) != 0\n \t  && wrapup_global_declarations (VEC_address (tree, pending_statics),"}, {"sha": "e6c5b41ba9ad9e27968d40be74890541a5868b49", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "patch": "@@ -1,5 +1,10 @@\n 2007-12-11  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/34238\n+\t* g++.dg/ext/visibility/anon7.C: Add xfail.\n+\t* g++.dg/ext/visibility/anon9.C: New test.\n+\t* g++.dg/ext/visibility/anon10.C: New test.\n+\n \tPR c++/34364\n \t* g++.dg/rtti/dyncast2.C: New test.\n "}, {"sha": "8c79631b0a99fdf54d67f84e6d0d3a389e542809", "filename": "gcc/testsuite/g++.dg/ext/visibility/anon10.C", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon10.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon10.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon10.C?ref=5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "patch": "@@ -0,0 +1,44 @@\n+// http://bugzilla.redhat.com/411871\n+// { dg-do compile }\n+\n+extern \"C\" int printf (const char *, ...);\n+\n+struct E\n+{\n+  template <typename T> E (const volatile T&);\n+  template <typename T> E (T&);\n+  char x[64];\n+};\n+\n+template<typename T> struct D\n+{\n+  static E foo (E, ...);\n+  static int foo (T, int);\n+};\n+\n+template<typename T, typename U> struct C\n+{\n+  static T ca;\n+  static const int value = sizeof (D<U>::foo (ca, 0)) == sizeof (int);\n+};\n+\n+struct A\n+{\n+  int a;\n+};\n+\n+namespace\n+{\n+  struct B\n+  {\n+    int a;\n+  };\n+}\n+\n+int bar (void)\n+{\n+  C<A, int> a;\n+  C<B, int> b;\n+\n+  return a.value + b.value;\n+}"}, {"sha": "0c42ea866f9bcc09ceecb5d25a9ac60dcd505bc6", "filename": "gcc/testsuite/g++.dg/ext/visibility/anon7.C", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon7.C?ref=5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "patch": "@@ -5,7 +5,7 @@ namespace\n {\n   struct A {\n     static int bar ();\n-    static int i;\t\t// { dg-error \"used, but not defined\" }\n+    static int i;\t\t// { dg-error \"used, but not defined\" \"\" { xfail *-*-* } }\n     static int j;\n     static int k;\n     static int l;"}, {"sha": "bb752253b680b447164b3f2bdb66fe47371e401a", "filename": "gcc/testsuite/g++.dg/ext/visibility/anon9.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fvisibility%2Fanon9.C?ref=5b767b9d0c2c2b2646aeadfa2c8156dde7a085fc", "patch": "@@ -0,0 +1,11 @@\n+// PR c++/34238\n+// { dg-do compile }\n+\n+namespace\n+{\n+  template <typename T = int> struct A\n+  {\n+    static const bool a = true;\n+  };\n+}\n+struct A<> a;"}]}