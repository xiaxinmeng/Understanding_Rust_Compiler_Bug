{"sha": "ae578943c00e669b6b18ce2588a29efcfb74ae19", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWU1Nzg5NDNjMDBlNjY5YjZiMThjZTI1ODhhMjllZmNmYjc0YWUxOQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2016-05-20T19:52:50Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2016-05-20T19:52:50Z"}, "message": "nptx.c (nvptx_option_override): Only set flag_toplevel_reorder, if not explicitly specified.\n\n\t* config/nvptx/nptx.c (nvptx_option_override): Only set\n\tflag_toplevel_reorder, if not explicitly specified.  Set\n\tflag_no_common, unless explicitly specified.\n\n\ttestsuite/\n\t* gcc.target/nvptx/uninit-decl.c: Force common storage,  add\n\tnon-common cases.\n\t* gcc.dg/tree-ssa/ssa-store-ccp-2.c: Add -fcommon.\n\nFrom-SVN: r236532", "tree": {"sha": "fa0da02b164cdefd6cd94eb6b8a95b1b946db452", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fa0da02b164cdefd6cd94eb6b8a95b1b946db452"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ae578943c00e669b6b18ce2588a29efcfb74ae19", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae578943c00e669b6b18ce2588a29efcfb74ae19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ae578943c00e669b6b18ce2588a29efcfb74ae19", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ae578943c00e669b6b18ce2588a29efcfb74ae19/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "15c671a79ca66df5b1de70dd1a0b78414fe003ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15c671a79ca66df5b1de70dd1a0b78414fe003ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15c671a79ca66df5b1de70dd1a0b78414fe003ef"}], "stats": {"total": 41, "additions": 36, "deletions": 5}, "files": [{"sha": "3f65d05f699ec5c50123fca7a0d18b0b4c347461", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ae578943c00e669b6b18ce2588a29efcfb74ae19", "patch": "@@ -1,3 +1,9 @@\n+2016-05-20  Nathan Sidwell  <nathan@acm.org>\n+\n+\t* config/nvptx/nptx.c (nvptx_option_override): Only set\n+\tflag_toplevel_reorder, if not explicitly specified.  Set\n+\tflag_no_common, unless explicitly specified.\n+\n 2016-05-20  David Malcolm  <dmalcolm@redhat.com>\n \n \t* calls.c (can_implement_as_sibling_call_p): Mark param"}, {"sha": "1bd1871024519744c07a66de27379bcfbeb1b8bf", "filename": "gcc/config/nvptx/nvptx.c", "status": "modified", "additions": 13, "deletions": 2, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2Fconfig%2Fnvptx%2Fnvptx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fnvptx%2Fnvptx.c?ref=ae578943c00e669b6b18ce2588a29efcfb74ae19", "patch": "@@ -155,8 +155,19 @@ static void\n nvptx_option_override (void)\n {\n   init_machine_status = nvptx_init_machine_status;\n-  /* Gives us a predictable order, which we need especially for variables.  */\n-  flag_toplevel_reorder = 1;\n+\n+  /* Set toplevel_reorder, unless explicitly disabled.  We need\n+     reordering so that we emit necessary assembler decls of\n+     undeclared variables. */\n+  if (!global_options_set.x_flag_toplevel_reorder)\n+    flag_toplevel_reorder = 1;\n+\n+  /* Set flag_no_common, unless explicitly disabled.  We fake common\n+     using .weak, and that's not entirely accurate, so avoid it\n+     unless forced.  */\n+  if (!global_options_set.x_flag_no_common)\n+    flag_no_common = 1;\n+\n   /* Assumes that it will see only hard registers.  */\n   flag_var_tracking = 0;\n "}, {"sha": "51fc1b3d2613d6d3172d5fd9b5117d931309b7dc", "filename": "gcc/testsuite/gcc.dg/tree-ssa/ssa-store-ccp-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-store-ccp-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-store-ccp-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fssa-store-ccp-2.c?ref=ae578943c00e669b6b18ce2588a29efcfb74ae19", "patch": "@@ -1,5 +1,5 @@\n /* { dg-do compile } */\n-/* { dg-options \"-O2 -fdump-tree-optimized\" } */\n+/* { dg-options \"-O2 -fdump-tree-optimized -fcommon\" } */\n \n const int conststaticvariable;\n "}, {"sha": "115d7036fb658d8994dc36902afe59a2a52a298d", "filename": "gcc/testsuite/gcc.target/nvptx/uninit-decl.c", "status": "modified", "additions": 16, "deletions": 2, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Funinit-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ae578943c00e669b6b18ce2588a29efcfb74ae19/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Funinit-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fnvptx%2Funinit-decl.c?ref=ae578943c00e669b6b18ce2588a29efcfb74ae19", "patch": "@@ -1,7 +1,21 @@\n /* { dg-do compile } */\n \n-int __attribute__ ((used)) common;\n-static int __attribute__ ((used)) local;\n+int __attribute__ ((common)) common;\n+static int local;\n+extern int external_decl;\n+int external_defn;\n+\n+int foo ()\n+{\n+  return common +  local + external_decl + external_defn;\n+}\n+\n+void bar (int i)\n+{\n+  common = local = external_decl = external_defn = i;\n+}\n \n /* { dg-final { scan-assembler \"\\[\\n\\r\\]\\[\\t \\]*.weak .global\\[^,\\n\\r\\]*common\" } } */\n /* { dg-final { scan-assembler \"\\[\\n\\r\\]\\[\\t \\]*.global\\[^,\\n\\r\\]*local\" } } */\n+/* { dg-final { scan-assembler \"\\[\\n\\r\\]\\[\\t \\]*.extern .global\\[^,\\n\\r\\]*external_decl\" } } */\n+/* { dg-final { scan-assembler \"\\[\\n\\r\\]\\[\\t \\]*.visible .global\\[^,\\n\\r\\]*external_defn\" } } */"}]}