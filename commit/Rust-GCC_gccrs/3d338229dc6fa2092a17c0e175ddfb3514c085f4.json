{"sha": "3d338229dc6fa2092a17c0e175ddfb3514c085f4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2QzMzgyMjlkYzZmYTIwOTJhMTdjMGUxNzVkZGZiMzUxNGMwODVmNA==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-01-22T00:06:44Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2019-01-22T00:06:44Z"}, "message": "re PR go/88927 (Bootstrap failure on arm in libgo starting with r268084)\n\n\tPR go/88927\n    runtime, internal/cpu: fix build for ARM GNU/Linux\n    \n    Was failing with\n    \n    ../../../libgo/go/internal/cpu/cpu.go:138:2: error: reference to undefined name 'doinit'\n      138 |  doinit()\n          |  ^\n    \n    Fix it by adding in Go 1.12 internal/cpu/cpu_arm.go, and the code in\n    runtime that initializes the values.\n    \n    Fixes https://gcc.gnu.org/PR88927.\n    \n    Reviewed-on: https://go-review.googlesource.com/c/158717\n\nFrom-SVN: r268131", "tree": {"sha": "96dcda6cedb3e21eac2ce461a7b129b86f83feef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/96dcda6cedb3e21eac2ce461a7b129b86f83feef"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3d338229dc6fa2092a17c0e175ddfb3514c085f4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d338229dc6fa2092a17c0e175ddfb3514c085f4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3d338229dc6fa2092a17c0e175ddfb3514c085f4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3d338229dc6fa2092a17c0e175ddfb3514c085f4/comments", "author": null, "committer": null, "parents": [{"sha": "ea31c98daba7d3459dc5500049876fe0a71a89d3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea31c98daba7d3459dc5500049876fe0a71a89d3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea31c98daba7d3459dc5500049876fe0a71a89d3"}], "stats": {"total": 41, "additions": 40, "deletions": 1}, "files": [{"sha": "90a03eeaa5a556574849e862c843c8a927384464", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d338229dc6fa2092a17c0e175ddfb3514c085f4/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d338229dc6fa2092a17c0e175ddfb3514c085f4/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=3d338229dc6fa2092a17c0e175ddfb3514c085f4", "patch": "@@ -1,4 +1,4 @@\n-0c870ba6b3b43e0e56231f40c56b58dad0e36d9e\n+fb44f62e7c01ebc987dad78875f593da18100007\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "a1d5a7ba2555c9ead7e22549228131cc37286135", "filename": "libgo/go/internal/cpu/cpu_arm.go", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d338229dc6fa2092a17c0e175ddfb3514c085f4/libgo%2Fgo%2Finternal%2Fcpu%2Fcpu_arm.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d338229dc6fa2092a17c0e175ddfb3514c085f4/libgo%2Fgo%2Finternal%2Fcpu%2Fcpu_arm.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Finternal%2Fcpu%2Fcpu_arm.go?ref=3d338229dc6fa2092a17c0e175ddfb3514c085f4", "patch": "@@ -0,0 +1,33 @@\n+// Copyright 2017 The Go Authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style\n+// license that can be found in the LICENSE file.\n+\n+package cpu\n+\n+// arm doesn't have a 'cpuid' equivalent, so we rely on HWCAP/HWCAP2.\n+// These are linknamed in runtime/os_(linux|freebsd)_arm.go and are\n+// initialized by archauxv().\n+// These should not be changed after they are initialized.\n+var HWCap uint\n+var HWCap2 uint\n+\n+// HWCAP/HWCAP2 bits. These are exposed by Linux and FreeBSD.\n+const (\n+\thwcap_VFPv4 = 1 << 16\n+\thwcap_IDIVA = 1 << 17\n+)\n+\n+func doinit() {\n+\toptions = []option{\n+\t\t{Name: \"vfpv4\", Feature: &ARM.HasVFPv4},\n+\t\t{Name: \"idiva\", Feature: &ARM.HasIDIVA},\n+\t}\n+\n+\t// HWCAP feature bits\n+\tARM.HasVFPv4 = isSet(HWCap, hwcap_VFPv4)\n+\tARM.HasIDIVA = isSet(HWCap, hwcap_IDIVA)\n+}\n+\n+func isSet(hwc uint, value uint) bool {\n+\treturn hwc&value != 0\n+}"}, {"sha": "8de9d1109341f1c3cb94fac662c400263206db46", "filename": "libgo/go/runtime/os_linux_arm.go", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3d338229dc6fa2092a17c0e175ddfb3514c085f4/libgo%2Fgo%2Fruntime%2Fos_linux_arm.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3d338229dc6fa2092a17c0e175ddfb3514c085f4/libgo%2Fgo%2Fruntime%2Fos_linux_arm.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fruntime%2Fos_linux_arm.go?ref=3d338229dc6fa2092a17c0e175ddfb3514c085f4", "patch": "@@ -4,6 +4,8 @@\n \n package runtime\n \n+import \"internal/cpu\"\n+\n var randomNumber uint32\n \n func archauxv(tag, val uintptr) {\n@@ -14,5 +16,9 @@ func archauxv(tag, val uintptr) {\n \t\t// it as a byte array.\n \t\trandomNumber = uint32(startupRandomData[4]) | uint32(startupRandomData[5])<<8 |\n \t\t\tuint32(startupRandomData[6])<<16 | uint32(startupRandomData[7])<<24\n+\tcase _AT_HWCAP:\n+\t\tcpu.HWCap = uint(val)\n+\tcase _AT_HWCAP2:\n+\t\tcpu.HWCap2 = uint(val)\n \t}\n }"}]}