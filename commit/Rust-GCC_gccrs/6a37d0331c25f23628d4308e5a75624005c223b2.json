{"sha": "6a37d0331c25f23628d4308e5a75624005c223b2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmEzN2QwMzMxYzI1ZjIzNjI4ZDQzMDhlNWE3NTYyNDAwNWMyMjNiMg==", "commit": {"author": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2021-07-27T14:44:57Z"}, "committer": {"name": "Richard Earnshaw", "email": "rearnsha@arm.com", "date": "2021-08-05T11:51:14Z"}, "message": "arm: Don't reconfigure globals in arm_configure_build_target\n\narm_configure_build_target is usually used to reconfigure the\narm_active_target structure, which is then used to reconfigure a\nnumber of other global variables describing the current target.\nOccasionally, however, we need to use arm_configure_build_target to\nconstruct a temporary target structure and in that case it is wrong to\ntry to reconfigure the global variables (although probably harmless,\nsince arm_option_reconfigure_globals() only looks at\narm_active_target).  At the very least, however, this is wasted work,\nso it is best not to do it unless needed.  What's more, several\ncallers of arm_configure_build target call\narm_option_reconfigure_globals themselves within a few lines, making\nthe call from within arm_configure_build_target completely redundant.\n\nSo this patch moves the responsibility of calling of\narm_configure_build_target to its callers (only two places needed\nupdating).\n\ngcc:\n\t* config/arm/arm.c (arm_configure_build_target): Don't call\n\tarm_option_reconfigure_globals.\n\t(arm_option_restore): Call arm_option_reconfigure_globals after\n\treconfiguring the target.\n\t* config/arm/arm-c.c (arm_pragma_target_parse): Likewise.", "tree": {"sha": "2cf9714b4f3abe458468fa94c1807cf610d1906f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2cf9714b4f3abe458468fa94c1807cf610d1906f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6a37d0331c25f23628d4308e5a75624005c223b2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a37d0331c25f23628d4308e5a75624005c223b2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6a37d0331c25f23628d4308e5a75624005c223b2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6a37d0331c25f23628d4308e5a75624005c223b2/comments", "author": null, "committer": null, "parents": [{"sha": "62e66c6a6cc52dc0e014141d369cff52757cd7ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/62e66c6a6cc52dc0e014141d369cff52757cd7ae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/62e66c6a6cc52dc0e014141d369cff52757cd7ae"}], "stats": {"total": 3, "additions": 2, "deletions": 1}, "files": [{"sha": "cc7901bca8dc9c5c27ed6afc5bc26afd42689e6d", "filename": "gcc/config/arm/arm-c.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a37d0331c25f23628d4308e5a75624005c223b2/gcc%2Fconfig%2Farm%2Farm-c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a37d0331c25f23628d4308e5a75624005c223b2/gcc%2Fconfig%2Farm%2Farm-c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm-c.c?ref=6a37d0331c25f23628d4308e5a75624005c223b2", "patch": "@@ -409,6 +409,7 @@ arm_pragma_target_parse (tree args, tree pop_target)\n       target_option_current_node = cur_tree;\n       arm_configure_build_target (&arm_active_target,\n \t\t\t\t  TREE_TARGET_OPTION (cur_tree), false);\n+      arm_option_reconfigure_globals ();\n     }\n \n   /* Update macros if target_node changes. The global state will be restored"}, {"sha": "273202ac2fdf7b6ce00223361257012a9fa561c1", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6a37d0331c25f23628d4308e5a75624005c223b2/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6a37d0331c25f23628d4308e5a75624005c223b2/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=6a37d0331c25f23628d4308e5a75624005c223b2", "patch": "@@ -3058,6 +3058,7 @@ arm_option_restore (struct gcc_options */* opts */,\n \t\t    struct cl_target_option *ptr)\n {\n   arm_configure_build_target (&arm_active_target, ptr, false);\n+  arm_option_reconfigure_globals ();\n }\n \n /* Reset options between modes that the user has specified.  */\n@@ -3441,7 +3442,6 @@ arm_configure_build_target (struct arm_build_target *target,\n   target->tune_flags = tune_data->tune_flags;\n   target->tune = tune_data->tune;\n   target->tune_core = tune_data->scheduler;\n-  arm_option_reconfigure_globals ();\n }\n \n /* Fix up any incompatible options that the user has specified.  */"}]}