{"sha": "996d027a36c646fbb0098e96c83dbb4c0ea5133d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTk2ZDAyN2EzNmM2NDZmYmIwMDk4ZTk2YzgzZGJiNGMwZWE1MTMzZA==", "commit": {"author": {"name": "Alessandro Fanfarillo", "email": "fanfarillo.gcc@gmail.com", "date": "2015-07-17T12:18:44Z"}, "committer": {"name": "Mikael Morin", "email": "mikael@gcc.gnu.org", "date": "2015-07-17T12:18:44Z"}, "message": "Fix fortran double address operator with co_reduce\n\ngcc/fortran/\n2015-07-17  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n\n\t* trans-intrinsic.c (conv_co_collective): Remove redundant address\n\toperator in the generated code.\n\ngcc/testsuite/\n2015-07-17  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n\n\t* gfortran.dg/co_reduce_1.f90: New file.\n\nFrom-SVN: r225930", "tree": {"sha": "203dea28d80d730acea563713ae5db2464853755", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/203dea28d80d730acea563713ae5db2464853755"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/996d027a36c646fbb0098e96c83dbb4c0ea5133d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/996d027a36c646fbb0098e96c83dbb4c0ea5133d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/996d027a36c646fbb0098e96c83dbb4c0ea5133d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/996d027a36c646fbb0098e96c83dbb4c0ea5133d/comments", "author": null, "committer": null, "parents": [{"sha": "c92f5b137e967a3ffd1ad0ce80a74c5a12e97fe3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c92f5b137e967a3ffd1ad0ce80a74c5a12e97fe3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c92f5b137e967a3ffd1ad0ce80a74c5a12e97fe3"}], "stats": {"total": 44, "additions": 43, "deletions": 1}, "files": [{"sha": "d082f0bd5b6c103962b5df49911a2728c8116ba3", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=996d027a36c646fbb0098e96c83dbb4c0ea5133d", "patch": "@@ -1,3 +1,8 @@\n+2015-07-17  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n+\n+\t* trans-intrinsic.c (conv_co_collective): Remove redundant address\n+\toperator in the generated code.\n+\n 2015-07-17  Andre Vehreschild  <vehre@gcc.gnu.org>\n \n \tPR fortran/66035"}, {"sha": "967a74169c8aa94591e7956ab703430a92826a2f", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=996d027a36c646fbb0098e96c83dbb4c0ea5133d", "patch": "@@ -8804,7 +8804,7 @@ conv_co_collective (gfc_code *code)\n \t}\n       opr_flags = build_int_cst (integer_type_node, opr_flag_int);\n       gfc_conv_expr (&argse, opr_expr);\n-      opr = gfc_build_addr_expr (NULL_TREE, argse.expr);\n+      opr = argse.expr;\n       fndecl = build_call_expr_loc (input_location, fndecl, 8, array, opr, opr_flags,\n \t\t\t\t    image_index, stat, errmsg, strlen, errmsg_len);\n     }"}, {"sha": "5462c1fd02036491b15784c56b127f075524700e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=996d027a36c646fbb0098e96c83dbb4c0ea5133d", "patch": "@@ -1,3 +1,7 @@\n+2015-07-17  Alessandro Fanfarillo  <fanfarillo.gcc@gmail.com>\n+\n+\t* gfortran.dg/co_reduce_1.f90: New file.\n+\n 2015-07-17  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR target/66824"}, {"sha": "1d3e89f65cce374c4ef3229d175a4b1b54ec1f2e", "filename": "gcc/testsuite/gfortran.dg/co_reduce_1.f90", "status": "added", "additions": 33, "deletions": 0, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ftestsuite%2Fgfortran.dg%2Fco_reduce_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/996d027a36c646fbb0098e96c83dbb4c0ea5133d/gcc%2Ftestsuite%2Fgfortran.dg%2Fco_reduce_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fco_reduce_1.f90?ref=996d027a36c646fbb0098e96c83dbb4c0ea5133d", "patch": "@@ -0,0 +1,33 @@\n+! { dg-do compile }\n+! { dg-additional-options \"-fdump-tree-original -fcoarray=lib\" }\n+!\n+! Check that we don't take twice the address of procedure simple_reduction\n+! in the generated code.\n+!\n+! Contributed by Alessandro Fanfarillo <fanfarillo.gcc@gmail.com>\n+\n+program simple_reduce\n+  implicit none\n+\n+  integer :: me\n+\n+  me = this_image()\n+\n+  sync all\n+\n+  call co_reduce(me,simple_reduction)\n+\n+  write(*,*) this_image(),me\n+\n+contains\n+  \n+  pure function simple_reduction(a,b)\n+    integer,intent(in) :: a,b\n+    integer :: simple_reduction\n+\n+    simple_reduction = a * b\n+  end function simple_reduction\n+\n+end program simple_reduce\n+\n+! { dg-final { scan-tree-dump \"_gfortran_caf_co_reduce \\\\(&desc\\\\.\\\\d+,\\\\s*simple_reduction,\" \"original\" } }"}]}