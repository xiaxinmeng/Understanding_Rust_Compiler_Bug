{"sha": "7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e", "node_id": "C_kwDOANBUbNoAKDdmMDU2ZDVmNGEwYjllMjk1NjFkMDM3NWQ1YjRhZDQyYzlmM2Y2MWU", "commit": {"author": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2023-04-05T19:59:38Z"}, "committer": {"name": "Andrew MacLeod", "email": "amacleod@redhat.com", "date": "2023-04-06T12:32:04Z"}, "message": "Check if dependency is valid before using in may_recompute_p.\n\nWhen the IL is rewritten after a statement has been processed and\ndependencies cached, its possible that an ssa-name in the dependency\ncache is no longer in the IL.  Check this before trying to recompute.\n\n\tPR tree-optimization/109417\n\tgcc/\n\t* gimple-range-gori.cc (gori_compute::may_recompute_p): Check if\n\tdependency is in SSA_NAME_FREE_LIST.\n\n\tgcc/testsuite/\n\t* gcc.dg/pr109417.c: New.", "tree": {"sha": "ecae54d1ba39aa1892e835c9a0d59014cacc5adc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ecae54d1ba39aa1892e835c9a0d59014cacc5adc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e/comments", "author": null, "committer": null, "parents": [{"sha": "d2a499a9881c7c079d2a722b57c7fcf022a864dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2a499a9881c7c079d2a722b57c7fcf022a864dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2a499a9881c7c079d2a722b57c7fcf022a864dd"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "d77e1f51ac20a5347e70b92b632fa1847b2cc483", "filename": "gcc/gimple-range-gori.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e/gcc%2Fgimple-range-gori.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e/gcc%2Fgimple-range-gori.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-range-gori.cc?ref=7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e", "patch": "@@ -1314,7 +1314,9 @@ gori_compute::may_recompute_p (tree name, basic_block bb, int depth)\n   tree dep2 = depend2 (name);\n \n   // If the first dependency is not set, there is no recomputation.\n-  if (!dep1)\n+  // Dependencies reflect original IL, not current state.   Check if the\n+  // SSA_NAME is still valid as well.\n+  if (!dep1 || SSA_NAME_IN_FREE_LIST (dep1))\n     return false;\n \n   // Don't recalculate PHIs or statements with side_effects."}, {"sha": "15711dbbafe82d61b0c5c10989613358fe26db97", "filename": "gcc/testsuite/gcc.dg/pr109417.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr109417.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e/gcc%2Ftestsuite%2Fgcc.dg%2Fpr109417.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr109417.c?ref=7f056d5f4a0b9e29561d0375d5b4ad42c9f3f61e", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3\" } */\n+\n+int printf(const char *, ...);\n+int c, d, *e, f[1][2], g;\n+int main() {\n+  int h = 0, *a = &h, **b[1] = {&a};\n+  while (e)\n+    while (g) {\n+    L:\n+      for (h = 0; h < 2; h++) {\n+        while (d)\n+          for (*e = 0; *e < 1;)\n+            printf(\"0\");\n+        while (c)\n+          ;\n+        f[g][h] = 0;\n+      }\n+    }\n+  if (h)\n+    goto L;\n+  return 0;\n+}\n+"}]}