{"sha": "d36475161db73e68889937a5304b1ed13e8603e9", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDM2NDc1MTYxZGI3M2U2ODg4OTkzN2E1MzA0YjFlZDEzZTg2MDNlOQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-10-23T23:33:58Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-10-23T23:33:58Z"}, "message": "PR ipa/pr67600\n\n\n\tPR ipa/pr67600\n\t* ipa-polymorphic-call.c\n\t(ipa_polymorphic_call_context::get_dynamic_type): Do not confuse\n\tinstance offset with offset of outer type.\n\t* g++.dg/torture/pr67600.C: New testcase.\n\nFrom-SVN: r229279", "tree": {"sha": "545a2facccda5811f1da92bc222edfa3b0c0864a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/545a2facccda5811f1da92bc222edfa3b0c0864a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d36475161db73e68889937a5304b1ed13e8603e9", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d36475161db73e68889937a5304b1ed13e8603e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d36475161db73e68889937a5304b1ed13e8603e9", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d36475161db73e68889937a5304b1ed13e8603e9/comments", "author": null, "committer": null, "parents": [{"sha": "3c7a8ece3e130a713f6ec6a900cadfbe50583d91", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3c7a8ece3e130a713f6ec6a900cadfbe50583d91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3c7a8ece3e130a713f6ec6a900cadfbe50583d91"}], "stats": {"total": 27937, "additions": 27931, "deletions": 6}, "files": [{"sha": "4494d624f322475fbb433c3e3e86ccc0598ec1ea", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d36475161db73e68889937a5304b1ed13e8603e9", "patch": "@@ -1,3 +1,11 @@\n+2015-10-23  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/pr67600\n+\t* ipa-polymorphic-call.c\n+\t(ipa_polymorphic_call_context::get_dynamic_type): Do not confuse\n+\tinstance offset with offset of outer type.\n+\t* g++.dg/torture/pr67600.C: New testcase.\n+\n 2015-10-23  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* fold-const.c (operand_equal_p): Handle VIEW_CONVERT_EXPR."}, {"sha": "9cf09b821da24a4688ff3f869d3feb32a48ea45f", "filename": "gcc/ipa-polymorphic-call.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2Fipa-polymorphic-call.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2Fipa-polymorphic-call.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-polymorphic-call.c?ref=d36475161db73e68889937a5304b1ed13e8603e9", "patch": "@@ -1512,6 +1512,7 @@ ipa_polymorphic_call_context::get_dynamic_type (tree instance,\n   /* Remember OFFSET before it is modified by restrict_to_inner_class.\n      This is because we do not update INSTANCE when walking inwards.  */\n   HOST_WIDE_INT instance_offset = offset;\n+  tree instance_outer_type = outer_type;\n \n   if (otr_type)\n     otr_type = TYPE_MAIN_VARIANT (otr_type);\n@@ -1599,7 +1600,7 @@ ipa_polymorphic_call_context::get_dynamic_type (tree instance,\n \t}\n     }\n  \n-  /* If we failed to look up the refernece in code, build our own.  */\n+  /* If we failed to look up the reference in code, build our own.  */\n   if (!instance_ref)\n     {\n       /* If the statement in question does not use memory, we can't tell\n@@ -1637,13 +1638,13 @@ ipa_polymorphic_call_context::get_dynamic_type (tree instance,\n       print_generic_expr (dump_file, otr_object, TDF_SLIM);\n       fprintf (dump_file, \"  Outer instance pointer: \");\n       print_generic_expr (dump_file, instance, TDF_SLIM);\n-      fprintf (dump_file, \" offset: %i (bits)\", (int)offset);\n+      fprintf (dump_file, \" offset: %i (bits)\", (int)instance_offset);\n       fprintf (dump_file, \" vtbl reference: \");\n       print_generic_expr (dump_file, instance_ref, TDF_SLIM);\n       fprintf (dump_file, \"\\n\");\n     }\n \n-  tci.offset = offset;\n+  tci.offset = instance_offset;\n   tci.instance = instance;\n   tci.vtbl_ptr_ref = instance_ref;\n   gcc_assert (TREE_CODE (instance) != MEM_REF);\n@@ -1709,9 +1710,12 @@ ipa_polymorphic_call_context::get_dynamic_type (tree instance,\n \t  && !dynamic\n \t  && !tci.seen_unanalyzed_store\n \t  && !tci.multiple_types_encountered\n-\t  && offset == tci.offset\n-\t  && types_same_for_odr (tci.known_current_type,\n-\t\t\t\t outer_type)))\n+\t  && ((offset == tci.offset\n+\t       && types_same_for_odr (tci.known_current_type,\n+\t\t\t\t      outer_type))\n+\t       || (instance_offset == offset\n+\t\t   && types_same_for_odr (tci.known_current_type,\n+\t\t\t\t\t  instance_outer_type)))))\n     {\n       if (!outer_type || tci.seen_unanalyzed_store)\n \treturn false;"}, {"sha": "bd0281a02432871876b817c9234114efb4eddb18", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d36475161db73e68889937a5304b1ed13e8603e9", "patch": "@@ -1,3 +1,8 @@\n+2015-10-23  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\tPR ipa/pr67600\n+\t* g++.dg/torture/pr67600.C: New testcase.\n+\n 2015-10-23  Ilya Enkovich  <enkovich.gnu@gmail.com>\n \n \t* g++.dg/pr68062.C: New test."}, {"sha": "5775d3619ba6d067994b41585e1f7cdd04e638ec", "filename": "gcc/testsuite/g++.dg/torture/pr67600.C", "status": "added", "additions": 27908, "deletions": 0, "changes": 27908, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr67600.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d36475161db73e68889937a5304b1ed13e8603e9/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr67600.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr67600.C?ref=d36475161db73e68889937a5304b1ed13e8603e9"}]}