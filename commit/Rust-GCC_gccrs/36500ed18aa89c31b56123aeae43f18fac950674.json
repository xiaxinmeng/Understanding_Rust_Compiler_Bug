{"sha": "36500ed18aa89c31b56123aeae43f18fac950674", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzY1MDBlZDE4YWE4OWMzMWI1NjEyM2FlYWU0M2YxOGZhYzk1MDY3NA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-10-09T06:56:21Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-10-09T06:59:15Z"}, "message": "fix ICE with BB vectorization of PHIs\n\nThis fixes a vector CTOR insertion issue when we try to insert after\na PHI node.\n\n2020-10-09  Richard Biener  <rguenther@suse.de>\n\n\t* tree-vect-slp.c (vect_create_constant_vectors): Properly insert\n\tafter PHIs.\n\n\t* gcc.dg/vect/bb-slp-phis-1.c: New testcase.", "tree": {"sha": "5faf694eac07536d34d8d74a95b6667ee6d7df0c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5faf694eac07536d34d8d74a95b6667ee6d7df0c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/36500ed18aa89c31b56123aeae43f18fac950674", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36500ed18aa89c31b56123aeae43f18fac950674", "html_url": "https://github.com/Rust-GCC/gccrs/commit/36500ed18aa89c31b56123aeae43f18fac950674", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/36500ed18aa89c31b56123aeae43f18fac950674/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "da9df699753d126e64d72c7ac0d0c0a552417b22", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da9df699753d126e64d72c7ac0d0c0a552417b22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da9df699753d126e64d72c7ac0d0c0a552417b22"}], "stats": {"total": 24, "additions": 23, "deletions": 1}, "files": [{"sha": "014c13b85064ed9a20b708d35188cc693da7e1f5", "filename": "gcc/testsuite/gcc.dg/vect/bb-slp-phis-1.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36500ed18aa89c31b56123aeae43f18fac950674/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fbb-slp-phis-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36500ed18aa89c31b56123aeae43f18fac950674/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fbb-slp-phis-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvect%2Fbb-slp-phis-1.c?ref=36500ed18aa89c31b56123aeae43f18fac950674", "patch": "@@ -0,0 +1,20 @@\n+/* From gcc.c-torture/execute/loop-13.c  */\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-march=cascadelake\" { target x86_64-*-* i?86-*-* } } */\n+#define TYPE long\n+\n+void\n+scale (TYPE *alpha, TYPE *x, int n)\n+{\n+  int i, ix;\n+\n+  if (*alpha != 1)\n+    for (i = 0, ix = 0; i < n; i++, ix += 2)\n+      {\n+\tTYPE tmpr, tmpi;\n+\ttmpr = *alpha * x[ix];\n+\ttmpi = *alpha * x[ix + 1];\n+\tx[ix] = tmpr;\n+\tx[ix + 1] = tmpi;\n+      }\n+}"}, {"sha": "dbe76ac72514d58a2ca5671b9221afa3a3f4f11c", "filename": "gcc/tree-vect-slp.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/36500ed18aa89c31b56123aeae43f18fac950674/gcc%2Ftree-vect-slp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/36500ed18aa89c31b56123aeae43f18fac950674/gcc%2Ftree-vect-slp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-slp.c?ref=36500ed18aa89c31b56123aeae43f18fac950674", "patch": "@@ -4144,7 +4144,9 @@ vect_create_constant_vectors (vec_info *vinfo, slp_tree op_node)\n \t\t  if (insert_after)\n \t\t    {\n \t\t      gimple_stmt_iterator gsi;\n-\t\t      if (!stmt_ends_bb_p (insert_after->stmt))\n+\t\t      if (gimple_code (insert_after->stmt) == GIMPLE_PHI)\n+\t\t\tgsi = gsi_after_labels (gimple_bb (insert_after->stmt));\n+\t\t      else if (!stmt_ends_bb_p (insert_after->stmt))\n \t\t\tgsi = gsi_for_stmt (insert_after->stmt);\n \t\t      else\n \t\t\t{"}]}