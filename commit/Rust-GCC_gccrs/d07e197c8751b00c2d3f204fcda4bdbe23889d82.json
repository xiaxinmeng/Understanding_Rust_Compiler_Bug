{"sha": "d07e197c8751b00c2d3f204fcda4bdbe23889d82", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDA3ZTE5N2M4NzUxYjAwYzJkM2YyMDRmY2RhNGJkYmUyMzg4OWQ4Mg==", "commit": {"author": {"name": "Javier Miranda", "email": "miranda@adacore.com", "date": "2007-12-13T10:25:35Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-12-13T10:25:35Z"}, "message": "exp_ch7.adb (Expand_N_Package_Body): Replace occurrence of attribute Is_Complation_Unit by Is_Library_Level_Entity...\n\n2007-12-06  Javier Miranda  <miranda@adacore.com>\n\t    Ed Schonberg  <schonberg@adacore.com>\n\n\t* exp_ch7.adb (Expand_N_Package_Body): Replace occurrence of attribute\n\tIs_Complation_Unit by Is_Library_Level_Entity in the code\n\tthat decides if the static dispatch tables need to be built.\n\t(Wrap_Transient_Declaration): Do not generate a finalization call if\n\tthis is a renaming declaration and the renamed object is a component\n\tof a controlled type.\n\nFrom-SVN: r130832", "tree": {"sha": "be6b4a9e0d87bf7ed141b1199fc9fce521cf022d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be6b4a9e0d87bf7ed141b1199fc9fce521cf022d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d07e197c8751b00c2d3f204fcda4bdbe23889d82", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d07e197c8751b00c2d3f204fcda4bdbe23889d82", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d07e197c8751b00c2d3f204fcda4bdbe23889d82", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d07e197c8751b00c2d3f204fcda4bdbe23889d82/comments", "author": {"login": "miranda-adacore", "id": 54413934, "node_id": "MDQ6VXNlcjU0NDEzOTM0", "avatar_url": "https://avatars.githubusercontent.com/u/54413934?v=4", "gravatar_id": "", "url": "https://api.github.com/users/miranda-adacore", "html_url": "https://github.com/miranda-adacore", "followers_url": "https://api.github.com/users/miranda-adacore/followers", "following_url": "https://api.github.com/users/miranda-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/miranda-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/miranda-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/miranda-adacore/subscriptions", "organizations_url": "https://api.github.com/users/miranda-adacore/orgs", "repos_url": "https://api.github.com/users/miranda-adacore/repos", "events_url": "https://api.github.com/users/miranda-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/miranda-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "303b4d58d7c0c36982e852981ac245bce6030e2c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/303b4d58d7c0c36982e852981ac245bce6030e2c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/303b4d58d7c0c36982e852981ac245bce6030e2c"}], "stats": {"total": 44, "additions": 27, "deletions": 17}, "files": [{"sha": "82d80bb9501cbb2f847680fd4ca77581ec978efa", "filename": "gcc/ada/exp_ch7.adb", "status": "modified", "additions": 27, "deletions": 17, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d07e197c8751b00c2d3f204fcda4bdbe23889d82/gcc%2Fada%2Fexp_ch7.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d07e197c8751b00c2d3f204fcda4bdbe23889d82/gcc%2Fada%2Fexp_ch7.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_ch7.adb?ref=d07e197c8751b00c2d3f204fcda4bdbe23889d82", "patch": "@@ -990,9 +990,7 @@ package body Exp_Ch7 is\n \n       Ftyp := Etype (Fent);\n \n-      if Nkind (Arg) = N_Type_Conversion\n-        or else Nkind (Arg) = N_Unchecked_Type_Conversion\n-      then\n+      if Nkind_In (Arg, N_Type_Conversion, N_Unchecked_Type_Conversion) then\n          Atyp := Entity (Subtype_Mark (Arg));\n       else\n          Atyp := Etype (Arg);\n@@ -1015,8 +1013,7 @@ package body Exp_Ch7 is\n       --  Make_Init_Call, set the target type to the type of the formal\n       --  directly, to avoid spurious typing problems.\n \n-      elsif (Nkind (Arg) = N_Unchecked_Type_Conversion\n-              or else Nkind (Arg) = N_Type_Conversion)\n+      elsif Nkind_In (Arg, N_Unchecked_Type_Conversion, N_Type_Conversion)\n         and then not Is_Class_Wide_Type (Atyp)\n       then\n          Set_Subtype_Mark (Arg, New_Occurrence_Of (Ftyp, Sloc (Arg)));\n@@ -1582,7 +1579,7 @@ package body Exp_Ch7 is\n \n          --  Build dispatch tables of library level tagged types\n \n-         if Is_Compilation_Unit (Ent) then\n+         if Is_Library_Level_Entity (Ent) then\n             Build_Static_Dispatch_Tables (N);\n          end if;\n \n@@ -1851,12 +1848,9 @@ package body Exp_Ch7 is\n             when N_Entry_Call_Statement     |\n                  N_Procedure_Call_Statement =>\n                if Nkind (Parent (The_Parent)) = N_Entry_Call_Alternative\n-                 and then\n-                   (Nkind (Parent (Parent (The_Parent)))\n-                     = N_Timed_Entry_Call\n-                   or else\n-                     Nkind (Parent (Parent (The_Parent)))\n-                       = N_Conditional_Entry_Call)\n+                 and then Nkind_In (Parent (Parent (The_Parent)),\n+                                    N_Timed_Entry_Call,\n+                                    N_Conditional_Entry_Call)\n                then\n                   return Parent (Parent (The_Parent));\n                else\n@@ -3393,19 +3387,35 @@ package body Exp_Ch7 is\n          --  exit but it doesn't matter. It cannot be done when the\n          --  call initializes a renaming object though because in this\n          --  case, the object becomes a pointer to the temporary and thus\n-         --  increases its life span.\n+         --  increases its life span. Ditto if this is a renaming of a\n+         --  component of an expression (such as a function call). .\n+         --  Note that there is a problem if an actual in the call needs\n+         --  finalization, because in that case the call itself is the master,\n+         --  and the actual should be finalized on return from the call ???\n \n          if Nkind (N) = N_Object_Renaming_Declaration\n            and then Controlled_Type (Etype (Defining_Identifier (N)))\n          then\n             null;\n \n+         elsif Nkind (N) = N_Object_Renaming_Declaration\n+           and then\n+             Nkind_In (Renamed_Object (Defining_Identifier (N)),\n+                       N_Selected_Component,\n+                       N_Indexed_Component)\n+           and then\n+             Controlled_Type\n+               (Etype (Prefix (Renamed_Object (Defining_Identifier (N)))))\n+         then\n+            null;\n+\n          else\n             Nodes :=\n-              Make_Final_Call (\n-                   Ref         => New_Reference_To (LC, Loc),\n-                   Typ         => Etype (LC),\n-                   With_Detach => New_Reference_To (Standard_False, Loc));\n+              Make_Final_Call\n+                (Ref         => New_Reference_To (LC, Loc),\n+                 Typ         => Etype (LC),\n+                 With_Detach => New_Reference_To (Standard_False, Loc));\n+\n             if Present (Next_N) then\n                Insert_List_Before_And_Analyze (Next_N, Nodes);\n             else"}]}