{"sha": "4b5726fda653d11f882fb9a112e4cffa12f7ed61", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGI1NzI2ZmRhNjUzZDExZjg4MmZiOWExMTJlNGNmZmExMmY3ZWQ2MQ==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-11-27T10:54:50Z"}, "committer": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2020-11-27T13:38:15Z"}, "message": "In 'gcc/omp-oacc-kernels-decompose.cc:flatten_binds', don't choke on empty GIMPLE sequence\n\nAlso, instead of just examining the first statement of inner 'GIMPLE_BIND' (via\n'inner_sequence' being a 'typedef gimple *gimple_seq'), in fact examine all\nstatements contained therein, which I suppose must've been the intention here.\n\nThis \"fixes\" the testcase 'c-c++-common/goacc/kernels-decompose-ice-2.c' (which\nnow runs into the same ICE as 'c-c++-common/goacc/kernels-decompose-ice-1.c',\netc.).\n\n\tgcc/\n\t* omp-oacc-kernels-decompose.cc (flatten_binds): Don't choke on\n\tempty GIMPLE sequence, and examine all statements contained in\n\tinner 'GIMPLE_BIND'.\n\tgcc/testsuite/\n\t* c-c++-common/goacc/kernels-decompose-ice-1.c: Adjust.\n\t* c-c++-common/goacc/kernels-decompose-ice-2.c: Likewise.", "tree": {"sha": "552e90940bde5f9f48f1a2ac848ae66abe13b242", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/552e90940bde5f9f48f1a2ac848ae66abe13b242"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4b5726fda653d11f882fb9a112e4cffa12f7ed61", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b5726fda653d11f882fb9a112e4cffa12f7ed61", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4b5726fda653d11f882fb9a112e4cffa12f7ed61", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4b5726fda653d11f882fb9a112e4cffa12f7ed61/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4a7c7999086756b9d630ed6036eb7fdce69bb5cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a7c7999086756b9d630ed6036eb7fdce69bb5cd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a7c7999086756b9d630ed6036eb7fdce69bb5cd"}], "stats": {"total": 16, "additions": 13, "deletions": 3}, "files": [{"sha": "c46168e063aba14abec7a5ebc994345d9a349d8c", "filename": "gcc/omp-oacc-kernels-decompose.cc", "status": "modified", "additions": 11, "deletions": 2, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b5726fda653d11f882fb9a112e4cffa12f7ed61/gcc%2Fomp-oacc-kernels-decompose.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b5726fda653d11f882fb9a112e4cffa12f7ed61/gcc%2Fomp-oacc-kernels-decompose.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-oacc-kernels-decompose.cc?ref=4b5726fda653d11f882fb9a112e4cffa12f7ed61", "patch": "@@ -740,8 +740,17 @@ flatten_binds (gbind *bind, bool include_toplevel_vars = false)\n \t  /* Flatten recursively, and collect all variables.  */\n \t  tree inner_vars = flatten_binds (inner_bind, true);\n \t  gimple_seq inner_sequence = gimple_bind_body (inner_bind);\n-\t  gcc_assert (gimple_code (inner_sequence) != GIMPLE_BIND\n-\t\t      || top_level_omp_for_in_stmt (inner_sequence));\n+\t  if (flag_checking)\n+\t    {\n+\t      for (gimple_stmt_iterator inner_gsi = gsi_start (inner_sequence);\n+\t\t   !gsi_end_p (inner_gsi);\n+\t\t   gsi_next (&inner_gsi))\n+\t\t{\n+\t\t  gimple *inner_stmt = gsi_stmt (inner_gsi);\n+\t\t  gcc_assert (gimple_code (inner_stmt) != GIMPLE_BIND\n+\t\t\t      || top_level_omp_for_in_stmt (inner_stmt));\n+\t\t}\n+\t    }\n \t  gimple_seq_add_seq (&new_body, inner_sequence);\n \t  /* Find the last variable; we will append others to it.  */\n \t  while (last_var != NULL && TREE_CHAIN (last_var) != NULL)"}, {"sha": "82e7bd1495b33f18124851d576ab5b36b05b60c8", "filename": "gcc/testsuite/c-c++-common/goacc/kernels-decompose-ice-1.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b5726fda653d11f882fb9a112e4cffa12f7ed61/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fkernels-decompose-ice-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b5726fda653d11f882fb9a112e4cffa12f7ed61/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fkernels-decompose-ice-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fkernels-decompose-ice-1.c?ref=4b5726fda653d11f882fb9a112e4cffa12f7ed61", "patch": "@@ -7,6 +7,7 @@\n \n /* Reduced from 'kernels-decompose-2.c'.\n    (Hopefully) similar instances:\n+     - 'kernels-decompose-ice-2.c'\n      - 'libgomp.oacc-c-c++-common/declare-vla-kernels-decompose-ice-1.c'\n      - 'libgomp.oacc-c-c++-common/kernels-decompose-1.c'\n */"}, {"sha": "569f87a59c97365ae0493abe8be8eb3bcbbbd427", "filename": "gcc/testsuite/c-c++-common/goacc/kernels-decompose-ice-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4b5726fda653d11f882fb9a112e4cffa12f7ed61/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fkernels-decompose-ice-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4b5726fda653d11f882fb9a112e4cffa12f7ed61/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fkernels-decompose-ice-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Fkernels-decompose-ice-2.c?ref=4b5726fda653d11f882fb9a112e4cffa12f7ed61", "patch": "@@ -2,7 +2,7 @@\n \n /* { dg-additional-options \"-fopenacc-kernels=decompose\" } */\n /* { dg-ice \"TODO\" }\n-   { dg-prune-output \"during GIMPLE pass: omp_oacc_kernels_decompose\" } */\n+   { dg-prune-output \"during GIMPLE pass: omplower\" } */\n \n /* Reduced from 'kernels-decompose-ice-1.c'.  */\n "}]}