{"sha": "d6da226a1e2931d818dc70602715c8bce7dddb01", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZkYTIyNmExZTI5MzFkODE4ZGM3MDYwMjcxNWM4YmNlN2RkZGIwMQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2016-09-22T14:34:09Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2016-09-22T14:34:09Z"}, "message": "* regcprop.c (copyprop_hardreg_forward_1): Remove noop moves.\n\nFrom-SVN: r240365", "tree": {"sha": "4057da0f7154824f3602ba3c5932548352a4f529", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4057da0f7154824f3602ba3c5932548352a4f529"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6da226a1e2931d818dc70602715c8bce7dddb01", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6da226a1e2931d818dc70602715c8bce7dddb01", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6da226a1e2931d818dc70602715c8bce7dddb01", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6da226a1e2931d818dc70602715c8bce7dddb01/comments", "author": null, "committer": null, "parents": [{"sha": "2dbe56bdfbf6c570cf23073f0c596da6bd1531c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2dbe56bdfbf6c570cf23073f0c596da6bd1531c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2dbe56bdfbf6c570cf23073f0c596da6bd1531c8"}], "stats": {"total": 28, "additions": 27, "deletions": 1}, "files": [{"sha": "21284824048ac4bd7ed1d331aeaeb2263770a15d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6da226a1e2931d818dc70602715c8bce7dddb01/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6da226a1e2931d818dc70602715c8bce7dddb01/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d6da226a1e2931d818dc70602715c8bce7dddb01", "patch": "@@ -1,3 +1,7 @@\n+2016-09-22  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* regcprop.c (copyprop_hardreg_forward_1): Remove noop moves.\n+\n 2016-09-22  Trevor Saunders  <tbsaunde+gcc@tbsaunde.org>\n \n \t* emit-rtl.c (next_cc0_user): Make argument type rtx_insn *."}, {"sha": "d1c1f8bdb11f3c3f444e6595ebe9eaf92c119b59", "filename": "gcc/regcprop.c", "status": "modified", "additions": 23, "deletions": 1, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6da226a1e2931d818dc70602715c8bce7dddb01/gcc%2Fregcprop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6da226a1e2931d818dc70602715c8bce7dddb01/gcc%2Fregcprop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fregcprop.c?ref=d6da226a1e2931d818dc70602715c8bce7dddb01", "patch": "@@ -771,6 +771,26 @@ copyprop_hardreg_forward_1 (basic_block bb, struct value_data *vd)\n \t}\n \n       set = single_set (insn);\n+\n+      /* Detect noop sets and remove them before processing side effects.  */\n+      if (set && REG_P (SET_DEST (set)) && REG_P (SET_SRC (set)))\n+\t{\n+\t  unsigned int regno = REGNO (SET_SRC (set));\n+\t  rtx r1 = find_oldest_value_reg (REGNO_REG_CLASS (regno),\n+\t\t\t\t\t  SET_DEST (set), vd);\n+\t  rtx r2 = find_oldest_value_reg (REGNO_REG_CLASS (regno),\n+\t\t\t\t\t  SET_SRC (set), vd);\n+\t  if (rtx_equal_p (r1 ? r1 : SET_DEST (set), r2 ? r2 : SET_SRC (set)))\n+\t    {\n+\t      bool last = insn == BB_END (bb);\n+\t      fprintf (stderr, \"Bingo\\n\");\n+\t      delete_insn (insn);\n+\t      if (last)\n+\t\tbreak;\n+\t      continue;\n+\t    }\n+\t}\n+\n       extract_constrain_insn (insn);\n       preprocess_constraints (insn);\n       const operand_alternative *op_alt = which_op_alt ();\n@@ -860,7 +880,9 @@ copyprop_hardreg_forward_1 (basic_block bb, struct value_data *vd)\n \t     register in the same class.  */\n \t  if (REG_P (SET_DEST (set)))\n \t    {\n-\t      new_rtx = find_oldest_value_reg (REGNO_REG_CLASS (regno), src, vd);\n+\t      new_rtx = find_oldest_value_reg (REGNO_REG_CLASS (regno),\n+\t\t\t\t\t       src, vd);\n+\n \t      if (new_rtx && validate_change (insn, &SET_SRC (set), new_rtx, 0))\n \t\t{\n \t\t  if (dump_file)"}]}