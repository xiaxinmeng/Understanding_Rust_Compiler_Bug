{"sha": "b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjU0MTVhOWViY2MwNmMxOGJkYTI3OWMyODRkOThlOWI4ZmY4YWYyMg==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2015-09-17T07:48:09Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2015-09-17T07:48:09Z"}, "message": "cp-tree.h (note_decl_for_pch): Remove.\n\n2015-09-17  Richard Biener  <rguenther@suse.de>\n\n\t* cp-tree.h (note_decl_for_pch): Remove.\n\t* class.c (build_clone): Do not call note_decl_for_pch.\n\t* semantics.c (finish_member_declaration): Likewise.\n\t(note_decl_for_pch): Remove.\n\t* decl2.c (c_parse_final_cleanups): Mangle all globals before\n\twriting the PCH.\n\nFrom-SVN: r227846", "tree": {"sha": "a47e69f9f988fa1978fb63d2deaa5b3c69e957aa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a47e69f9f988fa1978fb63d2deaa5b3c69e957aa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8c464611a3d61ad24af1f3461de8ed283aed3aa4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c464611a3d61ad24af1f3461de8ed283aed3aa4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c464611a3d61ad24af1f3461de8ed283aed3aa4"}], "stats": {"total": 39, "additions": 15, "deletions": 24}, "files": [{"sha": "b9aad337fece0082761a7ee5e922184c8d526f53", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "patch": "@@ -1,3 +1,12 @@\n+2015-09-17  Richard Biener  <rguenther@suse.de>\n+\n+\t* cp-tree.h (note_decl_for_pch): Remove.\n+\t* class.c (build_clone): Do not call note_decl_for_pch.\n+\t* semantics.c (finish_member_declaration): Likewise.\n+\t(note_decl_for_pch): Remove.\n+\t* decl2.c (c_parse_final_cleanups): Mangle all globals before\n+\twriting the PCH.\n+\n 2015-09-14  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/44282"}, {"sha": "9611dec3435bbf2f998223a8f45bd5bf11160f0a", "filename": "gcc/cp/class.c", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "patch": "@@ -4691,9 +4691,6 @@ build_clone (tree fn, tree name)\n   SET_DECL_RTL (clone, NULL);\n   rest_of_decl_compilation (clone, /*top_level=*/1, at_eof);\n \n-  if (pch_file)\n-    note_decl_for_pch (clone);\n-\n   return clone;\n }\n "}, {"sha": "8643e089d03d448fa9d77f189fd65465d7c734a5", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "patch": "@@ -6253,7 +6253,6 @@ extern tree finish_qualified_id_expr\t\t(tree, tree, bool, bool,\n \t\t\t\t\t\t bool, bool, tsubst_flags_t);\n extern void simplify_aggr_init_expr\t\t(tree *);\n extern void finalize_nrv\t\t\t(tree *, tree, tree);\n-extern void note_decl_for_pch\t\t\t(tree);\n extern tree omp_reduction_id\t\t\t(enum tree_code, tree, tree);\n extern tree cp_remove_omp_priv_cleanup_stmt\t(tree *, int *, void *);\n extern void cp_check_omp_declare_reduction\t(tree);"}, {"sha": "a5b44e02c141a66d6e319028fc4de004043743eb", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "patch": "@@ -4511,6 +4511,12 @@ c_parse_final_cleanups (void)\n      In that case we do not want to do anything else.  */\n   if (pch_file)\n     {\n+      /* Mangle all symbols at PCH creation time.  */\n+      symtab_node *node;\n+      FOR_EACH_SYMBOL (node)\n+\tif (! is_a <varpool_node *> (node)\n+\t    || ! DECL_HARD_REGISTER (node->decl))\n+\t  DECL_ASSEMBLER_NAME (node->decl);\n       c_common_write_pch ();\n       dump_tu ();\n       return;"}, {"sha": "7215dc672b6e06f7a7dd7a4c2dceb66b93c9dc2c", "filename": "gcc/cp/semantics.c", "status": "modified", "additions": 0, "deletions": 20, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fsemantics.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5415a9ebcc06c18bda279c284d98e9b8ff8af22/gcc%2Fcp%2Fsemantics.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fsemantics.c?ref=b5415a9ebcc06c18bda279c284d98e9b8ff8af22", "patch": "@@ -2951,26 +2951,6 @@ finish_member_declaration (tree decl)\n       maybe_add_class_template_decl_list (current_class_type, decl,\n \t\t\t\t\t  /*friend_p=*/0);\n     }\n-\n-  if (pch_file)\n-    note_decl_for_pch (decl);\n-}\n-\n-/* DECL has been declared while we are building a PCH file.  Perform\n-   actions that we might normally undertake lazily, but which can be\n-   performed now so that they do not have to be performed in\n-   translation units which include the PCH file.  */\n-\n-void\n-note_decl_for_pch (tree decl)\n-{\n-  gcc_assert (pch_file);\n-\n-  /* There's a good chance that we'll have to mangle names at some\n-     point, even if only for emission in debugging information.  */\n-  if (VAR_OR_FUNCTION_DECL_P (decl)\n-      && !processing_template_decl)\n-    mangle_decl (decl);\n }\n \n /* Finish processing a complete template declaration.  The PARMS are"}]}