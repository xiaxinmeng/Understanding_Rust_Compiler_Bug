{"sha": "f22cfd73cd9eece5e426ddfe745f998ffc665945", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjIyY2ZkNzNjZDllZWNlNWU0MjZkZGZlNzQ1Zjk5OGZmYzY2NTk0NQ==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2012-02-07T17:21:36Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2012-02-07T17:21:36Z"}, "message": "re PR middle-end/51994 (git-1.7.8.3 miscompiled due to negative bitpos from get_inner_reference)\n\n\tPR middle-end/51994\n\t* expr.c (get_inner_reference): If there is an offset, add a negative\n\tbit position to it (if any).\n\nFrom-SVN: r183974", "tree": {"sha": "051e03d16190d715181a74c0cea2613985c0cdd3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/051e03d16190d715181a74c0cea2613985c0cdd3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f22cfd73cd9eece5e426ddfe745f998ffc665945", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f22cfd73cd9eece5e426ddfe745f998ffc665945", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f22cfd73cd9eece5e426ddfe745f998ffc665945", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f22cfd73cd9eece5e426ddfe745f998ffc665945/comments", "author": null, "committer": null, "parents": [{"sha": "13a72c0ba3e023f0f585654ed389c76efd4c1590", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/13a72c0ba3e023f0f585654ed389c76efd4c1590", "html_url": "https://github.com/Rust-GCC/gccrs/commit/13a72c0ba3e023f0f585654ed389c76efd4c1590"}], "stats": {"total": 55, "additions": 55, "deletions": 0}, "files": [{"sha": "3d6fe256e934cad67008aa686a2047af4c253dd0", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=f22cfd73cd9eece5e426ddfe745f998ffc665945", "patch": "@@ -1,3 +1,9 @@\n+2012-02-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\tPR middle-end/51994\n+\t* expr.c (get_inner_reference): If there is an offset, add a negative\n+\tbit position to it (if any).\n+\n 2012-02-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/52060"}, {"sha": "e63ed3b71f5c99911439d6b6edb2f9c2907230bb", "filename": "gcc/expr.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=f22cfd73cd9eece5e426ddfe745f998ffc665945", "patch": "@@ -6716,6 +6716,24 @@ get_inner_reference (tree exp, HOST_WIDE_INT *pbitsize,\n   /* Otherwise, split it up.  */\n   if (offset)\n     {\n+      /* Avoid returning a negative bitpos as this may wreak havoc later.  */\n+      if (double_int_negative_p (bit_offset))\n+        {\n+\t  double_int mask\n+\t    = double_int_mask (BITS_PER_UNIT == 8\n+\t\t\t       ? 3 : exact_log2 (BITS_PER_UNIT));\n+\t  double_int tem = double_int_and_not (bit_offset, mask);\n+\t  /* TEM is the bitpos rounded to BITS_PER_UNIT towards -Inf.\n+\t     Subtract it to BIT_OFFSET and add it (scaled) to OFFSET.  */\n+\t  bit_offset = double_int_sub (bit_offset, tem);\n+\t  tem = double_int_rshift (tem,\n+\t\t\t\t   BITS_PER_UNIT == 8\n+\t\t\t\t   ? 3 : exact_log2 (BITS_PER_UNIT),\n+\t\t\t\t   HOST_BITS_PER_DOUBLE_INT, true);\n+\t  offset = size_binop (PLUS_EXPR, offset,\n+\t\t\t       double_int_to_tree (sizetype, tem));\n+\t}\n+\n       *pbitpos = double_int_to_shwi (bit_offset);\n       *poffset = offset;\n     }"}, {"sha": "a433613b0c735c2b8fe06518f634f435d2737a14", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f22cfd73cd9eece5e426ddfe745f998ffc665945", "patch": "@@ -1,3 +1,7 @@\n+2012-02-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc.c-torture/execute/20120207-1.c: New test.\n+\n 2012-02-07  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/52060"}, {"sha": "c4716aecad80737fd3a1b1f7916ae2777af51909", "filename": "gcc/testsuite/gcc.c-torture/execute/20120207-1.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20120207-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f22cfd73cd9eece5e426ddfe745f998ffc665945/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20120207-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20120207-1.c?ref=f22cfd73cd9eece5e426ddfe745f998ffc665945", "patch": "@@ -0,0 +1,27 @@\n+/* PR middle-end/51994 */\n+/* Testcase by Uros Bizjak <ubizjak@gmail.com> */\n+\n+extern char *strcpy (char *, const char *);\n+extern void abort (void);\n+\n+char __attribute__((noinline))\n+test (int a)\n+{\n+  char buf[16];\n+  char *output = buf;\n+\n+  strcpy (&buf[0], \"0123456789\");\n+\n+  output += a;\n+  output -= 1;\n+\n+  return output[0];\n+}\n+\n+int main ()\n+{\n+  if (test (2) != '1')\n+    abort ();\n+\n+  return 0;\n+}"}]}