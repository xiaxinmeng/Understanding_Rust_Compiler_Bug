{"sha": "0a71c876a1ed4331002cdd3c09d09252de4d5d89", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGE3MWM4NzZhMWVkNDMzMTAwMmNkZDNjMDlkMDkyNTJkZTRkNWQ4OQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2017-05-29T07:31:11Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2017-05-29T07:31:11Z"}, "message": "check_GNU_style_lib.py: Fix trailing whitespace check\n\n2017-05-29  Tom de Vries  <tom@codesourcery.com>\n\n\t* check_GNU_style_lib.py (TrailingWhitespaceCheck.check): Assert no\n\ttrailing eol.\n\t(TrailingWhitespaceTest): New unit test.\n\t(check_GNU_style_file): Remove eol before checking.\n\nFrom-SVN: r248556", "tree": {"sha": "cbec4ccd47a9fc11d0ffafac77fa0638c1564680", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/cbec4ccd47a9fc11d0ffafac77fa0638c1564680"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0a71c876a1ed4331002cdd3c09d09252de4d5d89", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a71c876a1ed4331002cdd3c09d09252de4d5d89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0a71c876a1ed4331002cdd3c09d09252de4d5d89", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0a71c876a1ed4331002cdd3c09d09252de4d5d89/comments", "author": null, "committer": null, "parents": [{"sha": "75017bb9750fdbed1ab51c99a7306976a9fa83c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75017bb9750fdbed1ab51c99a7306976a9fa83c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75017bb9750fdbed1ab51c99a7306976a9fa83c2"}], "stats": {"total": 23, "additions": 22, "deletions": 1}, "files": [{"sha": "f23b37a14c0af931286b6dfa52b983198a862994", "filename": "contrib/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a71c876a1ed4331002cdd3c09d09252de4d5d89/contrib%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a71c876a1ed4331002cdd3c09d09252de4d5d89/contrib%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2FChangeLog?ref=0a71c876a1ed4331002cdd3c09d09252de4d5d89", "patch": "@@ -1,3 +1,10 @@\n+2017-05-29  Tom de Vries  <tom@codesourcery.com>\n+\n+\t* check_GNU_style_lib.py (TrailingWhitespaceCheck.check): Assert no\n+\ttrailing eol.\n+\t(TrailingWhitespaceTest): New unit test.\n+\t(check_GNU_style_file): Remove eol before checking.\n+\n 2017-05-29  Tom de Vries  <tom@codesourcery.com>\n \n \t* check_GNU_style_lib.py (check_GNU_style_file): Treat file argument as"}, {"sha": "63d0538aa572c4ac946fd47eaa7d1a704a97c718", "filename": "contrib/check_GNU_style_lib.py", "status": "modified", "additions": 15, "deletions": 1, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0a71c876a1ed4331002cdd3c09d09252de4d5d89/contrib%2Fcheck_GNU_style_lib.py", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0a71c876a1ed4331002cdd3c09d09252de4d5d89/contrib%2Fcheck_GNU_style_lib.py", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fcheck_GNU_style_lib.py?ref=0a71c876a1ed4331002cdd3c09d09252de4d5d89", "patch": "@@ -104,6 +104,7 @@ def __init__(self):\n         self.re = re.compile('(\\s+)$')\n \n     def check(self, filename, lineno, line):\n+        assert(len(line) == 0 or line[-1] != '\\n')\n         m = self.re.search(line)\n         if m != None:\n             return CheckError(filename, lineno,\n@@ -223,6 +224,18 @@ def test_line_length_check_basic(self):\n         self.assertEqual(r.console_error,\n             self.check.limit * 'a' + error_string(' = 123;'))\n \n+class TrailingWhitespaceTest(unittest.TestCase):\n+    def setUp(self):\n+        self.check = TrailingWhitespaceCheck()\n+\n+    def test_trailing_whitespace_check_basic(self):\n+        r = self.check.check('foo', 123, 'a = 123;')\n+        self.assertIsNone(r)\n+        r = self.check.check('foo', 123, 'a = 123; ')\n+        self.assertIsNotNone(r)\n+        r = self.check.check('foo', 123, 'a = 123;\\t')\n+        self.assertIsNotNone(r)\n+\n def check_GNU_style_file(file, file_encoding, format):\n     checks = [LineLengthCheck(), SpacesCheck(), TrailingWhitespaceCheck(),\n         SentenceSeparatorCheck(), SentenceEndOfCommentCheck(),\n@@ -244,7 +257,8 @@ def check_GNU_style_file(file, file_encoding, format):\n             for line in hunk:\n                 if line.is_added and line.target_line_no != None:\n                     for check in checks:\n-                        e = check.check(t, line.target_line_no, line.value)\n+                        line_chomp = line.value.replace('\\n', '')\n+                        e = check.check(t, line.target_line_no, line_chomp)\n                         if e != None:\n                             errors.append(e)\n "}]}