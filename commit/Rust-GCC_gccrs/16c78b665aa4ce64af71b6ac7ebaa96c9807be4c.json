{"sha": "16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTZjNzhiNjY1YWE0Y2U2NGFmNzFiNmFjN2ViYWE5NmM5ODA3YmU0Yw==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@linaro.org", "date": "2018-01-03T21:39:33Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2018-01-03T21:39:33Z"}, "message": "Directly operate on CONST_VECTOR encoding\n\nThis patch makes some pieces of code operate directly on the new\nCONST_VECTOR encoding.\n\n2018-01-03  Richard Sandiford  <richard.sandiford@linaro.org>\n\ngcc/\n\t* cse.c (hash_rtx_cb): Hash only the encoded elements.\n\t* cselib.c (cselib_hash_rtx): Likewise.\n\t* expmed.c (make_tree): Build VECTOR_CSTs directly from the\n\tCONST_VECTOR encoding.\n\nFrom-SVN: r256192", "tree": {"sha": "24617e60f1700c494a8be6af770f30443951f7f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/24617e60f1700c494a8be6af770f30443951f7f7"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/comments", "author": null, "committer": null, "parents": [{"sha": "4bfb8e1143f4626e12df348a1bde34030c0fb2e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4bfb8e1143f4626e12df348a1bde34030c0fb2e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4bfb8e1143f4626e12df348a1bde34030c0fb2e7"}], "stats": {"total": 24, "additions": 16, "deletions": 8}, "files": [{"sha": "0ce136fc7a1a132ecb36309b3585555362e8f44f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "patch": "@@ -1,3 +1,10 @@\n+2018-01-03  Richard Sandiford  <richard.sandiford@linaro.org>\n+\n+\t* cse.c (hash_rtx_cb): Hash only the encoded elements.\n+\t* cselib.c (cselib_hash_rtx): Likewise.\n+\t* expmed.c (make_tree): Build VECTOR_CSTs directly from the\n+\tCONST_VECTOR encoding.\n+\n 2017-01-03  Jakub Jelinek  <jakub@redhat.com>\n \t    Jeff Law  <law@redhat.com>\n "}, {"sha": "fcfbba092834414bc2b3948d059547d085d7f8db", "filename": "gcc/cse.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2Fcse.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2Fcse.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcse.c?ref=16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "patch": "@@ -2353,11 +2353,11 @@ hash_rtx_cb (const_rtx x, machine_mode mode,\n \tint units;\n \trtx elt;\n \n-\tunits = CONST_VECTOR_NUNITS (x);\n+\tunits = const_vector_encoded_nelts (x);\n \n \tfor (i = 0; i < units; ++i)\n \t  {\n-\t    elt = CONST_VECTOR_ELT (x, i);\n+\t    elt = CONST_VECTOR_ENCODED_ELT (x, i);\n \t    hash += hash_rtx_cb (elt, GET_MODE (elt),\n                                  do_not_record_p, hash_arg_in_memory_p,\n                                  have_reg_qty, cb);"}, {"sha": "ca4a53a87337093daa61ec8b20b69d4c94b7d1de", "filename": "gcc/cselib.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2Fcselib.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2Fcselib.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcselib.c?ref=16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "patch": "@@ -1163,11 +1163,11 @@ cselib_hash_rtx (rtx x, int create, machine_mode memmode)\n \tint units;\n \trtx elt;\n \n-\tunits = CONST_VECTOR_NUNITS (x);\n+\tunits = const_vector_encoded_nelts (x);\n \n \tfor (i = 0; i < units; ++i)\n \t  {\n-\t    elt = CONST_VECTOR_ELT (x, i);\n+\t    elt = CONST_VECTOR_ENCODED_ELT (x, i);\n \t    hash += cselib_hash_rtx (elt, 0, memmode);\n \t  }\n "}, {"sha": "be6a13854e62aaac3be3c41597fa887917cf8fc4", "filename": "gcc/expmed.c", "status": "modified", "additions": 5, "deletions": 4, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2Fexpmed.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/16c78b665aa4ce64af71b6ac7ebaa96c9807be4c/gcc%2Fexpmed.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpmed.c?ref=16c78b665aa4ce64af71b6ac7ebaa96c9807be4c", "patch": "@@ -5273,13 +5273,14 @@ make_tree (tree type, rtx x)\n \n     case CONST_VECTOR:\n       {\n-\tint units = CONST_VECTOR_NUNITS (x);\n+\tunsigned int npatterns = CONST_VECTOR_NPATTERNS (x);\n+\tunsigned int nelts_per_pattern = CONST_VECTOR_NELTS_PER_PATTERN (x);\n \ttree itype = TREE_TYPE (type);\n-\tint i;\n \n \t/* Build a tree with vector elements.  */\n-\ttree_vector_builder elts (type, units, 1);\n-\tfor (i = 0; i < units; ++i)\n+\ttree_vector_builder elts (type, npatterns, nelts_per_pattern);\n+\tunsigned int count = elts.encoded_nelts ();\n+\tfor (unsigned int i = 0; i < count; ++i)\n \t  {\n \t    rtx elt = CONST_VECTOR_ELT (x, i);\n \t    elts.quick_push (make_tree (itype, elt));"}]}