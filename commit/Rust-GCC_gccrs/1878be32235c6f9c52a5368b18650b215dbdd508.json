{"sha": "1878be32235c6f9c52a5368b18650b215dbdd508", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTg3OGJlMzIyMzVjNmY5YzUyYTUzNjhiMTg2NTBiMjE1ZGJkZDUwOA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2016-03-07T08:08:27Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2016-03-07T08:08:27Z"}, "message": "decl.c (gnat_to_gnu_entity): Always mark the expression of a renaming manually in case #3.\n\n\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Variable>: Always mark\n\tthe expression of a renaming manually in case #3.\n\nFrom-SVN: r234018", "tree": {"sha": "2113fdf3d1c062b5b541d1e6edecc119214043c0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2113fdf3d1c062b5b541d1e6edecc119214043c0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1878be32235c6f9c52a5368b18650b215dbdd508", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1878be32235c6f9c52a5368b18650b215dbdd508", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1878be32235c6f9c52a5368b18650b215dbdd508", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1878be32235c6f9c52a5368b18650b215dbdd508/comments", "author": null, "committer": null, "parents": [{"sha": "51b3616138665bd00e16a197326ddacb2050c5b0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51b3616138665bd00e16a197326ddacb2050c5b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51b3616138665bd00e16a197326ddacb2050c5b0"}], "stats": {"total": 47, "additions": 41, "deletions": 6}, "files": [{"sha": "0573865b1f92a0c57bd9a80c548fc50d8711492e", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=1878be32235c6f9c52a5368b18650b215dbdd508", "patch": "@@ -1,3 +1,8 @@\n+2016-03-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/decl.c (gnat_to_gnu_entity) <E_Variable>: Always mark\n+\tthe expression of a renaming manually in case #3.\n+\n 2016-03-02  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n \n \t* system-linux-s390.adsx: Enable Stack_Check_Probes."}, {"sha": "4b0ce2824c457dff6c4f3cdedc8e7bb6c182a1d3", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=1878be32235c6f9c52a5368b18650b215dbdd508", "patch": "@@ -1058,12 +1058,10 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \t\t  = elaborate_reference (gnu_expr, gnat_entity, definition,\n \t\t\t\t\t &init);\n \n-\t\t/* If we are not defining the entity, the expression will not\n-\t\t   be attached through DECL_INITIAL so it needs to be marked\n-\t\t   manually because it will likely be shared.  Likewise for a\n-\t\t   dereference as it will be folded by the ADDR_EXPR below.  */\n-\t\tif ((!definition || TREE_CODE (renamed_obj) == INDIRECT_REF)\n-\t\t    && global_bindings_p ())\n+\t\t/* The expression needs to be marked manually because it will\n+\t\t   likely be shared, even for a definition since the ADDR_EXPR\n+\t\t   built below can cause the first few nodes to be folded.  */\n+\t\tif (global_bindings_p ())\n \t\t  MARK_VISITED (renamed_obj);\n \n \t\tif (type_annotate_only"}, {"sha": "182e917ad0eabd9dec15d2de898cf359467accf5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=1878be32235c6f9c52a5368b18650b215dbdd508", "patch": "@@ -1,3 +1,7 @@\n+2016-03-07  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/renaming9.ad[sb]: New testcase.\n+\n 2016-03-05  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/70084"}, {"sha": "c50243efdd68b5e16402b554373ab0b151f94914", "filename": "gcc/testsuite/gnat.dg/renaming9.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming9.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming9.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming9.adb?ref=1878be32235c6f9c52a5368b18650b215dbdd508", "patch": "@@ -0,0 +1,12 @@\n+-- { dg-do compile }\n+\n+package body Renaming9 is\n+\n+  procedure Proc is\n+  begin\n+    Obj.I := 0;\n+  end;\n+\n+begin\n+  Obj.I := 0;\n+end Renaming9;"}, {"sha": "ce6b4ed09247d87a3fa01f4f1f32e624f2dac3f8", "filename": "gcc/testsuite/gnat.dg/renaming9.ads", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming9.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1878be32235c6f9c52a5368b18650b215dbdd508/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming9.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Frenaming9.ads?ref=1878be32235c6f9c52a5368b18650b215dbdd508", "patch": "@@ -0,0 +1,16 @@\n+package Renaming9 is\n+\n+  pragma Elaborate_Body;\n+\n+  type Object is tagged null record;\n+\n+  type Pointer is access all Object'Class;\n+\n+  type Derived is new Object with record\n+     I : Integer;\n+  end record;\n+\n+  Ptr : Pointer := new Derived;\n+  Obj : Derived renames Derived (Ptr.all);\n+\n+end Renaming9;"}]}