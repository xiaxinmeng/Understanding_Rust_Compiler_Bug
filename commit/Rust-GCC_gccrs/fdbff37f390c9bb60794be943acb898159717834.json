{"sha": "fdbff37f390c9bb60794be943acb898159717834", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmRiZmYzN2YzOTBjOWJiNjA3OTRiZTk0M2FjYjg5ODE1OTcxNzgzNA==", "commit": {"author": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-01-09T14:43:50Z"}, "committer": {"name": "Paolo Carlini", "email": "paolo@gcc.gnu.org", "date": "2013-01-09T14:43:50Z"}, "message": "re PR c++/55801 (ICE with thread_local after ill-formed declaration)\n\n/cp\n2013-01-09  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/55801\n\t* decl2.c (var_needs_tls_wrapper): Return false when error_operand_p\n\tof the argument is true.\n\n/testsuite\n2013-01-09  Paolo Carlini  <paolo.carlini@oracle.com>\n\n\tPR c++/55801\n\t* g++.dg/tls/thread_local-ice.C: New.\n\nFrom-SVN: r195050", "tree": {"sha": "7ee3571a404ca61b085d951e2c2b45b35989eb13", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7ee3571a404ca61b085d951e2c2b45b35989eb13"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fdbff37f390c9bb60794be943acb898159717834", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fdbff37f390c9bb60794be943acb898159717834", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fdbff37f390c9bb60794be943acb898159717834", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fdbff37f390c9bb60794be943acb898159717834/comments", "author": null, "committer": null, "parents": [{"sha": "f0d5414883f580b91d88025c4c8c8863321048f7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f0d5414883f580b91d88025c4c8c8863321048f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f0d5414883f580b91d88025c4c8c8863321048f7"}], "stats": {"total": 26, "additions": 22, "deletions": 4}, "files": [{"sha": "46583530161ca576b2e3cb73201bf0a706eb7d7b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fdbff37f390c9bb60794be943acb898159717834/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fdbff37f390c9bb60794be943acb898159717834/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=fdbff37f390c9bb60794be943acb898159717834", "patch": "@@ -1,3 +1,9 @@\n+2013-01-09  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/55801\n+\t* decl2.c (var_needs_tls_wrapper): Return false when error_operand_p\n+\tof the argument is true.\n+\n 2013-01-08  Joel Brobecker  <brobecker@adacore.com>\n \n \t* parser.c (cp_parser_initializer_list): Move declaration"}, {"sha": "074cf375019484dc0f2af1f93fda2403922922e2", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fdbff37f390c9bb60794be943acb898159717834/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fdbff37f390c9bb60794be943acb898159717834/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=fdbff37f390c9bb60794be943acb898159717834", "patch": "@@ -1,7 +1,7 @@\n /* Process declarations and variables for C++ compiler.\n    Copyright (C) 1988, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2007, 2008, 2009, 2010,\n-   2011, 2012 Free Software Foundation, Inc.\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2007-2013\n+   Free Software Foundation, Inc.\n    Hacked by Michael Tiemann (tiemann@cygnus.com)\n \n This file is part of GCC.\n@@ -2807,7 +2807,8 @@ var_defined_without_dynamic_init (tree var)\n static bool\n var_needs_tls_wrapper (tree var)\n {\n-  return (DECL_THREAD_LOCAL_P (var)\n+  return (!error_operand_p (var)\n+\t  && DECL_THREAD_LOCAL_P (var)\n \t  && !DECL_GNU_TLS_P (var)\n \t  && !DECL_FUNCTION_SCOPE_P (var)\n \t  && !var_defined_without_dynamic_init (var));"}, {"sha": "f300905689b4cfca1368924c9dd389d586695bde", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fdbff37f390c9bb60794be943acb898159717834/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fdbff37f390c9bb60794be943acb898159717834/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=fdbff37f390c9bb60794be943acb898159717834", "patch": "@@ -1,3 +1,8 @@\n+2013-01-09  Paolo Carlini  <paolo.carlini@oracle.com>\n+\n+\tPR c++/55801\n+\t* g++.dg/tls/thread_local-ice.C: New.\n+\n 2013-01-09  Andreas Schwab  <schwab@suse.de>\n \n \t* gcc.dg/guality/pr54693.c: Null-terminate arr.\n@@ -20,7 +25,7 @@\n \n 2013-01-08  Tejas Belagod  <tejas.belagod@arm.com>\n \n-\t* gcc.target/aarch64/vect-mull-compile.c: Explicitly scan for \n+\t* gcc.target/aarch64/vect-mull-compile.c: Explicitly scan for\n \tinstructions generated instead of number of occurances.\n \n 2013-01-08  James Greenhalgh  <james.greenhalgh@arm.com>"}, {"sha": "174aac42adb9cd49edb522ae5bf2cc9b8362b558", "filename": "gcc/testsuite/g++.dg/tls/thread_local-ice.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fdbff37f390c9bb60794be943acb898159717834/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fthread_local-ice.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fdbff37f390c9bb60794be943acb898159717834/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fthread_local-ice.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftls%2Fthread_local-ice.C?ref=fdbff37f390c9bb60794be943acb898159717834", "patch": "@@ -0,0 +1,6 @@\n+// PR c++/55801\n+// { dg-options \"-std=c++11\" }\n+// { dg-require-effective-target tls }\n+\n+class C;\n+thread_local C O, O2 = O;   // { dg-error \"incomplete\" }"}]}