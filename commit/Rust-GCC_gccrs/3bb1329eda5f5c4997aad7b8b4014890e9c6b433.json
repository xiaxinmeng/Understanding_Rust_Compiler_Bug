{"sha": "3bb1329eda5f5c4997aad7b8b4014890e9c6b433", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2JiMTMyOWVkYTVmNWM0OTk3YWFkN2I4YjQwMTQ4OTBlOWM2YjQzMw==", "commit": {"author": {"name": "Brendan Kehoe", "email": "brendan@gcc.gnu.org", "date": "1997-07-28T19:49:08Z"}, "committer": {"name": "Brendan Kehoe", "email": "brendan@gcc.gnu.org", "date": "1997-07-28T19:49:08Z"}, "message": "integrate.c (expand_inline_function): Use xmalloc instead of alloca for the LABEL_MAP.\n\n\t* integrate.c (expand_inline_function): Use xmalloc instead of\n\talloca for the LABEL_MAP.\n\nFrom-SVN: r14545", "tree": {"sha": "9adc8541ca9e0f9c1137931a1a64098af019fea3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9adc8541ca9e0f9c1137931a1a64098af019fea3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3bb1329eda5f5c4997aad7b8b4014890e9c6b433", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bb1329eda5f5c4997aad7b8b4014890e9c6b433", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3bb1329eda5f5c4997aad7b8b4014890e9c6b433", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bb1329eda5f5c4997aad7b8b4014890e9c6b433/comments", "author": null, "committer": null, "parents": [{"sha": "2f8844a8b6bc71fb4d7e67cdd60517336fb9682f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2f8844a8b6bc71fb4d7e67cdd60517336fb9682f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2f8844a8b6bc71fb4d7e67cdd60517336fb9682f"}], "stats": {"total": 17, "additions": 15, "deletions": 2}, "files": [{"sha": "467bfb609a7d842f50b3663814a9c816f0861157", "filename": "gcc/integrate.c", "status": "modified", "additions": 15, "deletions": 2, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3bb1329eda5f5c4997aad7b8b4014890e9c6b433/gcc%2Fintegrate.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3bb1329eda5f5c4997aad7b8b4014890e9c6b433/gcc%2Fintegrate.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fintegrate.c?ref=3bb1329eda5f5c4997aad7b8b4014890e9c6b433", "patch": "@@ -1239,6 +1239,10 @@ expand_inline_function (fndecl, parms, target, ignore, type,\n   rtvec arg_vector = ORIGINAL_ARG_VECTOR (header);\n   rtx static_chain_value = 0;\n \n+  /* The pointer used to track the true location of the memory used\n+     for MAP->LABEL_MAP.  */\n+  rtx *real_label_map = NULL_PTR;\n+\n   /* Allow for equivalences of the pseudos we make for virtual fp and ap.  */\n   max_regno = MAX_REGNUM (header) + 3;\n   if (max_regno < FIRST_PSEUDO_REGISTER)\n@@ -1379,8 +1383,12 @@ expand_inline_function (fndecl, parms, target, ignore, type,\n   map->reg_map = (rtx *) alloca (max_regno * sizeof (rtx));\n   bzero ((char *) map->reg_map, max_regno * sizeof (rtx));\n \n-  map->label_map = (rtx *)alloca ((max_labelno - min_labelno) * sizeof (rtx));\n-  map->label_map -= min_labelno;\n+  /* We used to use alloca here, but the size of what it would try to\n+     allocate would occasionally cause it to exceed the stack limit and\n+     cause unpredictable core dumps.  */\n+  real_label_map\n+    = (rtx *) xmalloc ((max_labelno - min_labelno) * sizeof (rtx));\n+  map->label_map = real_label_map - min_labelno;\n \n   map->insn_map = (rtx *) alloca (INSN_UID (header) * sizeof (rtx));\n   bzero ((char *) map->insn_map, INSN_UID (header) * sizeof (rtx));\n@@ -2019,6 +2027,11 @@ expand_inline_function (fndecl, parms, target, ignore, type,\n \t\t\tmemory_address (TYPE_MODE (type), structure_value_addr));\n       MEM_IN_STRUCT_P (target) = 1;\n     }\n+\n+  /* Make sure we free the things we explicitly allocated with xmalloc.  */\n+  if (real_label_map)\n+    free (real_label_map);\n+\n   return target;\n }\n \f"}]}