{"sha": "7f6055d052b5e8407b136322af334a62b2f2719d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Y2MDU1ZDA1MmI1ZTg0MDdiMTM2MzIyYWYzMzRhNjJiMmYyNzE5ZA==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2007-05-12T18:12:54Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2007-05-12T18:12:54Z"}, "message": "re PR rtl-optimization/31848 (Invalid loop optimization causes bootstrap failure in genautomata)\n\n\tPR rtl-optimization/31848\n\t* loop-invariant.c (move_invariant_reg): If we move an insn\n\twith a REG_EQUAL note, and that insn is not always executed,\n\tremove the REG_EQUAL note.\n\nFrom-SVN: r124639", "tree": {"sha": "1115b283c5b1e47c20dfa757f86f592908a44f18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1115b283c5b1e47c20dfa757f86f592908a44f18"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7f6055d052b5e8407b136322af334a62b2f2719d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f6055d052b5e8407b136322af334a62b2f2719d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7f6055d052b5e8407b136322af334a62b2f2719d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7f6055d052b5e8407b136322af334a62b2f2719d/comments", "author": null, "committer": null, "parents": [{"sha": "8c0dbf3490bd297d601118bc95a2a8640aa73a39", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8c0dbf3490bd297d601118bc95a2a8640aa73a39", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8c0dbf3490bd297d601118bc95a2a8640aa73a39"}], "stats": {"total": 19, "additions": 19, "deletions": 0}, "files": [{"sha": "32fa23943de5074d5730eac5237c4be193b8d8ba", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f6055d052b5e8407b136322af334a62b2f2719d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f6055d052b5e8407b136322af334a62b2f2719d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7f6055d052b5e8407b136322af334a62b2f2719d", "patch": "@@ -1,3 +1,10 @@\n+2007-05-12  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\tPR rtl-optimization/31848\n+\t* loop-invariant.c (move_invariant_reg): If we move an insn\n+\twith a REG_EQUAL note, and that insn is not always executed,\n+\tremove the REG_EQUAL note.\n+\n 2007-05-12  Richard Guenther  <rguenther@suse.de>\n \n \tPR tree-optimization/31797"}, {"sha": "613bfb11e2f8a3428fe83ac311694bbcb3072db0", "filename": "gcc/loop-invariant.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7f6055d052b5e8407b136322af334a62b2f2719d/gcc%2Floop-invariant.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7f6055d052b5e8407b136322af334a62b2f2719d/gcc%2Floop-invariant.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Floop-invariant.c?ref=7f6055d052b5e8407b136322af334a62b2f2719d", "patch": "@@ -1156,9 +1156,21 @@ move_invariant_reg (struct loop *loop, unsigned invno)\n \t to let emit_move_insn produce a valid instruction stream.  */\n       if (REG_P (dest) && !HARD_REGISTER_P (dest))\n \t{\n+\t  rtx note;\n+\n \t  emit_insn_after (gen_move_insn (dest, reg), inv->insn);\n \t  SET_DEST (set) = reg;\n \t  reorder_insns (inv->insn, inv->insn, BB_END (preheader));\n+\n+\t  /* If there is a REG_EQUAL note on the insn we just moved, and\n+\t     insn is in a basic block that is not always executed, the note\n+\t     may no longer be valid after we move the insn.\n+\t     Note that uses in REG_EQUAL notes are taken into account in\n+\t     the computation of invariants.  Hence it is safe to retain the\n+\t     note even if the note contains register references.  */\n+\t  if (! inv->always_executed\n+\t      && (note = find_reg_note (inv->insn, REG_EQUAL, NULL_RTX)))\n+\t    remove_note (inv->insn, note);\n \t}\n       else\n \t{"}]}