{"sha": "eebeecacfb9c097f7b3766bcb96097a86d0860b7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWViZWVjYWNmYjljMDk3ZjdiMzc2NmJjYjk2MDk3YTg2ZDA4NjBiNw==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@libertysurf.fr", "date": "2005-01-14T08:03:20Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2005-01-14T08:03:20Z"}, "message": "re PR middle-end/18820 (ACATS c95300[123] and c980002 fail at runtime)\n\n\tPR middle-end/18820\n\t* varasm.c (initializer_constant_valid_p) <ADDR_EXPR>: Return\n\tzero for nested functions needing a static chain or functions\n\twith a non-constant address.\n\nFrom-SVN: r93633", "tree": {"sha": "e6852849268e281a533559c3020d30399dfee543", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e6852849268e281a533559c3020d30399dfee543"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eebeecacfb9c097f7b3766bcb96097a86d0860b7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eebeecacfb9c097f7b3766bcb96097a86d0860b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eebeecacfb9c097f7b3766bcb96097a86d0860b7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eebeecacfb9c097f7b3766bcb96097a86d0860b7/comments", "author": {"login": "ebotcazou", "id": 48091907, "node_id": "MDQ6VXNlcjQ4MDkxOTA3", "avatar_url": "https://avatars.githubusercontent.com/u/48091907?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ebotcazou", "html_url": "https://github.com/ebotcazou", "followers_url": "https://api.github.com/users/ebotcazou/followers", "following_url": "https://api.github.com/users/ebotcazou/following{/other_user}", "gists_url": "https://api.github.com/users/ebotcazou/gists{/gist_id}", "starred_url": "https://api.github.com/users/ebotcazou/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ebotcazou/subscriptions", "organizations_url": "https://api.github.com/users/ebotcazou/orgs", "repos_url": "https://api.github.com/users/ebotcazou/repos", "events_url": "https://api.github.com/users/ebotcazou/events{/privacy}", "received_events_url": "https://api.github.com/users/ebotcazou/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "84973b27e8283fa75075f124ad4e6e14dc7726a4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/84973b27e8283fa75075f124ad4e6e14dc7726a4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/84973b27e8283fa75075f124ad4e6e14dc7726a4"}], "stats": {"total": 48, "additions": 46, "deletions": 2}, "files": [{"sha": "9e733219cb9cd5364d30e810a8e958ccfa557dbb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=eebeecacfb9c097f7b3766bcb96097a86d0860b7", "patch": "@@ -1,3 +1,10 @@\n+2005-01-14  Eric Botcazou  <ebotcazou@libertysurf.fr>\n+\n+\tPR middle-end/18820\n+\t* varasm.c (initializer_constant_valid_p) <ADDR_EXPR>: Return\n+\tzero for nested functions needing a static chain or functions\n+\twith a non-constant address.\n+\n 2005-01-13  Roger Sayle  <roger@eyesopen.com>\n \n \t* simplify-rtx.c (simplify_binary_operation) <AND>: Optimize"}, {"sha": "62cda60e35a75bcb7fa6f924c71bedc843caf099", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=eebeecacfb9c097f7b3766bcb96097a86d0860b7", "patch": "@@ -1,3 +1,8 @@\n+2005-01-14  Eric Botcazou  <ebotcazou@libertysurf.fr>\n+\n+\t* gcc.dg/nested-func-2.c: New test.\n+\t* ada/acats/norun.lst: Remove c953002.\n+\n 2005-01-12  Ulrich Weigand  <uweigand@de.ibm.com>\n \n \t* gcc.dg/ftrapv-2.c (labsv): Call labs instead of abs."}, {"sha": "049965b9986b17a1eec48457af8a5fa87e88f704", "filename": "gcc/testsuite/ada/acats/norun.lst", "status": "modified", "additions": 0, "deletions": 2, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Ftestsuite%2Fada%2Facats%2Fnorun.lst", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Ftestsuite%2Fada%2Facats%2Fnorun.lst", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fada%2Facats%2Fnorun.lst?ref=eebeecacfb9c097f7b3766bcb96097a86d0860b7", "patch": "@@ -1,8 +1,6 @@\n c380004\n-c953002\n cdd2a03\n templat\n # Tests must be sorted in alphabetical order\n # c380004: should be front-end compile time error, PR ada/18817\n-# c953002: often hanging, PR ada/18820\n # cdd2a03: new Ada ruling not supported yet, PR ada/19323"}, {"sha": "14f14c67e85045114fa16adf00e65fa0560ac7f0", "filename": "gcc/testsuite/gcc.dg/nested-func-2.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Ftestsuite%2Fgcc.dg%2Fnested-func-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Ftestsuite%2Fgcc.dg%2Fnested-func-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fnested-func-2.c?ref=eebeecacfb9c097f7b3766bcb96097a86d0860b7", "patch": "@@ -0,0 +1,28 @@\n+/* PR middle-end/18820 */\n+/* Check that we reject nested functions as initializers\n+   of static variables.  */\n+\n+/* { dg-do compile } */\n+/* { dg-options \"\" } */\n+\n+struct S {\n+  void (*f)(int);\n+};\n+\n+extern void baz(struct S *);\n+extern void p(int);\n+\n+void foo(void)\n+{\n+  int u;\n+\n+  void bar(int val)\n+    {\n+      u = val;\n+    }\n+\n+  static struct S s = { bar }; /* { dg-error \"(is not constant)|(near initialization)\" } */\n+\n+  baz(&s);\n+  p(u);\n+}"}, {"sha": "8252f0e123f2181b48f111e9c67c5dbb21291ccf", "filename": "gcc/varasm.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eebeecacfb9c097f7b3766bcb96097a86d0860b7/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=eebeecacfb9c097f7b3766bcb96097a86d0860b7", "patch": "@@ -3501,6 +3501,12 @@ initializer_constant_valid_p (tree value, tree endtype)\n \t  && TREE_CODE (value) == INDIRECT_REF\n \t  && TREE_CONSTANT (TREE_OPERAND (value, 0)))\n \treturn null_pointer_node;\n+      /* Taking the address of a nested function involves a trampoline.  */\n+      if (value\n+\t  && TREE_CODE (value) == FUNCTION_DECL\n+\t  && ((decl_function_context (value) && !DECL_NO_STATIC_CHAIN (value))\n+\t      || DECL_NON_ADDR_CONST_P (value)))\n+\treturn NULL_TREE;\n       return value;\n \n     case VIEW_CONVERT_EXPR:"}]}