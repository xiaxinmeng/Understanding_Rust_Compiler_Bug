{"sha": "f5c28a158bb972bef91b18028e1965722b5cff69", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjVjMjhhMTU4YmI5NzJiZWY5MWIxODAyOGUxOTY1NzIyYjVjZmY2OQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2003-12-15T14:19:10Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2003-12-15T14:19:10Z"}, "message": "class.c (add_method): Disallow destructor for java classes.\n\ncp:\n\t* class.c (add_method): Disallow destructor for java classes.\n\t* decl.c (xref_basetypes): Check java class inheritance.\n\t* decl2.c (check_java_method): Skip artificial params.\ntestsuite:\n\t* g++.dg/other/java1.C: New test.\n\nFrom-SVN: r74629", "tree": {"sha": "3c9cdd851e654dd096ba9dadc263e8e0fd0f80fb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3c9cdd851e654dd096ba9dadc263e8e0fd0f80fb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f5c28a158bb972bef91b18028e1965722b5cff69", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5c28a158bb972bef91b18028e1965722b5cff69", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5c28a158bb972bef91b18028e1965722b5cff69", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5c28a158bb972bef91b18028e1965722b5cff69/comments", "author": null, "committer": null, "parents": [{"sha": "5fd80fbc3ba36fba8c0ec6c0f8509ff44e0a9fdd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5fd80fbc3ba36fba8c0ec6c0f8509ff44e0a9fdd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5fd80fbc3ba36fba8c0ec6c0f8509ff44e0a9fdd"}], "stats": {"total": 52, "additions": 51, "deletions": 1}, "files": [{"sha": "93a37190a0a4d2d9d9034b104c54e4c1e1949c9e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=f5c28a158bb972bef91b18028e1965722b5cff69", "patch": "@@ -1,5 +1,9 @@\n 2003-12-15  Nathan Sidwell  <nathan@codesourcery.com>\n \n+\t* class.c (add_method): Disallow destructor for java classes.\n+\t* decl.c (xref_basetypes): Check java class inheritance.\n+\t* decl2.c (check_java_method): Skip artificial params.\n+\n  \tPR c++/13241\n \tC++ ABI change. Mangling of symbols in expressions.\n \t* mangle.c (write_mangled_name): Add top_level flag. Rework for"}, {"sha": "55e9797e3e8be1463fdc9ee732aca24247c351ea", "filename": "gcc/cp/class.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2Fclass.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2Fclass.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fclass.c?ref=f5c28a158bb972bef91b18028e1965722b5cff69", "patch": "@@ -755,6 +755,12 @@ add_method (tree type, tree method, int error_p)\n     {\n       slot = CLASSTYPE_DESTRUCTOR_SLOT;\n       TYPE_HAS_DESTRUCTOR (type) = 1;\n+      \n+      if (TYPE_FOR_JAVA (type))\n+\terror (DECL_ARTIFICIAL (method)\n+\t       ? \"Java class '%T' cannot have an implicit non-trivial destructor\"\n+\t       : \"Java class '%T' cannot have a destructor\",\n+\t       DECL_CONTEXT (method));\n     }\n   else\n     {"}, {"sha": "1eafe2eb2dedb06c7fcba81beaeeca19cbb186d9", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 9, "deletions": 1, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=f5c28a158bb972bef91b18028e1965722b5cff69", "patch": "@@ -9625,7 +9625,15 @@ xref_basetypes (tree ref, tree base_list)\n      inheritance order chain.  */\n   copy_base_binfos (TYPE_BINFO (ref), ref, NULL_TREE);\n   CLASSTYPE_VBASECLASSES (ref) = nreverse (CLASSTYPE_VBASECLASSES (ref));\n-  \n+\n+  if (TYPE_FOR_JAVA (ref))\n+    {\n+      if (TYPE_USES_MULTIPLE_INHERITANCE (ref))\n+\terror (\"Java class '%T' cannot have multiple bases\", ref);\n+      if (CLASSTYPE_VBASECLASSES (ref))\n+\terror (\"Java class '%T' cannot have virtual bases\", ref);\n+    }\n+\n   /* Unmark all the types.  */\n   while (i--)\n     {"}, {"sha": "14814b532dd561e5540655e0382661e4a83ac0eb", "filename": "gcc/cp/decl2.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2Fdecl2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Fcp%2Fdecl2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl2.c?ref=f5c28a158bb972bef91b18028e1965722b5cff69", "patch": "@@ -622,12 +622,20 @@ check_java_method (tree method)\n   bool jerr = false;\n   tree arg_types = TYPE_ARG_TYPES (TREE_TYPE (method));\n   tree ret_type = TREE_TYPE (TREE_TYPE (method));\n+\n   if (!acceptable_java_type (ret_type))\n     {\n       error (\"Java method '%D' has non-Java return type `%T'\",\n \t\tmethod, ret_type);\n       jerr = true;\n     }\n+\n+  arg_types = TREE_CHAIN (arg_types);\n+  if (DECL_HAS_IN_CHARGE_PARM_P (method))\n+    arg_types = TREE_CHAIN (arg_types);\n+  if (DECL_HAS_VTT_PARM_P (method))\n+    arg_types = TREE_CHAIN (arg_types);\n+  \n   for (; arg_types != NULL_TREE; arg_types = TREE_CHAIN (arg_types))\n     {\n       tree type = TREE_VALUE (arg_types);"}, {"sha": "675122eac52d8f1b7e5e753cf8040e15f6f5b925", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=f5c28a158bb972bef91b18028e1965722b5cff69", "patch": "@@ -1,5 +1,7 @@\n 2003-12-15  Nathan Sidwell  <nathan@codesourcery.com>\n \n+\t* g++.dg/other/java1.C: New test.\n+\n \tPR c++/13241\n \t* g++.dg/abi/mangle18-1.C: New test.\n \t* g++.dg/abi/mangle18-2.C: New test."}, {"sha": "38b5e0c3070111a08438605c2960cd62f9801584", "filename": "gcc/testsuite/g++.dg/other/java1.C", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fjava1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f5c28a158bb972bef91b18028e1965722b5cff69/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fjava1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fother%2Fjava1.C?ref=f5c28a158bb972bef91b18028e1965722b5cff69", "patch": "@@ -0,0 +1,22 @@\n+// { dg-options \"-w -ansi -pedantic\" }\n+\n+// Copyright (C) 2003 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 23 Oct 2003 <nathan@codesourcery.com>\n+\n+extern \"Java\" {\n+  class One \n+  {\n+    ~One (); // { dg-error \"cannot have a destructor\" \"\" }\n+    One ();\n+  };\n+\n+  class Two {};\n+\n+  class Three : One {}; // { dg-error \"cannot have an implicit\" \"\" }\n+\n+  class Four : Two {};\n+\n+  class Five : Two, Four {}; //  { dg-error \"cannot have multiple bases\" \"\" }\n+\n+  class Six : virtual Two {}; // { dg-error \"cannot have virtual base\" \"\" }\n+}"}]}