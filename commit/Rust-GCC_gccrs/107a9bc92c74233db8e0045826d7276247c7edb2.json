{"sha": "107a9bc92c74233db8e0045826d7276247c7edb2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTA3YTliYzkyYzc0MjMzZGI4ZTAwNDU4MjZkNzI3NjI0N2M3ZWRiMg==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-11-14T08:15:09Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-11-14T08:15:09Z"}, "message": "re PR fortran/51073 (_gfortran_caf_register incorrectly assumes malloc(0) returns non-NULL)\n\n2011-11-14  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/51073\n        * trans-decl.c (generate_coarray_sym_init): Handle zero-sized\n        * arrays.\n\nFrom-SVN: r181348", "tree": {"sha": "be9093ceed196f867cb8d6ced83b29a0ecd8cd34", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be9093ceed196f867cb8d6ced83b29a0ecd8cd34"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/107a9bc92c74233db8e0045826d7276247c7edb2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/107a9bc92c74233db8e0045826d7276247c7edb2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/107a9bc92c74233db8e0045826d7276247c7edb2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/107a9bc92c74233db8e0045826d7276247c7edb2/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "df11cc78c2800961ac3086d978ded2704c9f7d1d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df11cc78c2800961ac3086d978ded2704c9f7d1d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df11cc78c2800961ac3086d978ded2704c9f7d1d"}], "stats": {"total": 13, "additions": 11, "deletions": 2}, "files": [{"sha": "01abd74f890e721981194e3a5211ad9e15aae665", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/107a9bc92c74233db8e0045826d7276247c7edb2/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/107a9bc92c74233db8e0045826d7276247c7edb2/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=107a9bc92c74233db8e0045826d7276247c7edb2", "patch": "@@ -1,3 +1,8 @@\n+2011-11-14  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/51073\n+\t* trans-decl.c (generate_coarray_sym_init): Handle zero-sized arrays.\n+\n 2011-11-09  Tobias Burnus  <burnus@net-b.de>\n \n \t* symbol.c (clear_sym_mark, traverse_ns): Remove functions."}, {"sha": "80e4f555d1c90c7fc773316aad5f4b7b546be3fb", "filename": "gcc/fortran/trans-decl.c", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/107a9bc92c74233db8e0045826d7276247c7edb2/gcc%2Ffortran%2Ftrans-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/107a9bc92c74233db8e0045826d7276247c7edb2/gcc%2Ffortran%2Ftrans-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-decl.c?ref=107a9bc92c74233db8e0045826d7276247c7edb2", "patch": "@@ -4234,12 +4234,16 @@ generate_coarray_sym_init (gfc_symbol *sym)\n \n   size = TYPE_SIZE_UNIT (gfc_get_element_type (TREE_TYPE (decl)));\n \n+  /* Ensure that we do not have size=0 for zero-sized arrays.  */ \n+  size = fold_build2_loc (input_location, MAX_EXPR, size_type_node,\n+\t\t\t  fold_convert (size_type_node, size),\n+\t\t\t  build_int_cst (size_type_node, 1));\n+\n   if (GFC_TYPE_ARRAY_RANK (TREE_TYPE (decl)))\n     {\n       tmp = GFC_TYPE_ARRAY_SIZE (TREE_TYPE (decl));\n       size = fold_build2_loc (input_location, MULT_EXPR, size_type_node,\n-\t\t\t      fold_convert (size_type_node, tmp),\n-\t\t\t      fold_convert (size_type_node, size));\n+\t\t\t      fold_convert (size_type_node, tmp), size);\n     }\n \n   gcc_assert (GFC_TYPE_ARRAY_CAF_TOKEN (TREE_TYPE (decl)) != NULL_TREE);"}]}