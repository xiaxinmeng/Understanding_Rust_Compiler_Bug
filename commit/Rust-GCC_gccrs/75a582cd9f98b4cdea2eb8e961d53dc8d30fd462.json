{"sha": "75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzVhNTgyY2Q5Zjk4YjRjZGVhMmViOGU5NjFkNTNkYzhkMzBmZDQ2Mg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2019-10-11T09:09:40Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2019-10-11T09:09:40Z"}, "message": "decl.c (gnat_to_gnu_field): Adjust again the packing for a field without strict alignment and with an...\n\n\t* gcc-interface/decl.c (gnat_to_gnu_field): Adjust again the packing\n\tfor a field without strict alignment and with an oversized clause.\n\nFrom-SVN: r276873", "tree": {"sha": "0652b424a034b022a2124d283bc526b85c44ee01", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0652b424a034b022a2124d283bc526b85c44ee01"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "html_url": "https://github.com/Rust-GCC/gccrs/commit/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/comments", "author": null, "committer": null, "parents": [{"sha": "76dcb70dab490c5dbabaf1b982a1650da2a341cf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/76dcb70dab490c5dbabaf1b982a1650da2a341cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/76dcb70dab490c5dbabaf1b982a1650da2a341cf"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "ae9fd4c2b6ab68a77635e0b4583d8ba70f1f3291", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "patch": "@@ -1,3 +1,8 @@\n+2019-10-11  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/decl.c (gnat_to_gnu_field): Adjust again the packing\n+\tfor a field without strict alignment and with an oversized clause.\n+\n 2019-10-11  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/decl.c (annotate_value) <INTEGER_CST>: Really test the"}, {"sha": "b3f8d589682cf4b00af7cc0f611fd97dfcea8635", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "patch": "@@ -7229,10 +7229,17 @@ gnat_to_gnu_field (Entity_Id gnat_field, tree gnu_record_type, int packed,\n \t  && INTEGRAL_TYPE_P (TREE_TYPE (TYPE_FIELDS (gnu_field_type))))\n \tgnu_field_type = TREE_TYPE (TYPE_FIELDS (gnu_field_type));\n \n+      orig_field_type = gnu_field_type;\n       gnu_field_type\n \t= make_type_from_size (gnu_field_type, gnu_size,\n \t\t\t       Has_Biased_Representation (gnat_field));\n \n+      /* If the type has been extended, we may need to cap the alignment.  */\n+      if (!needs_strict_alignment\n+\t  && gnu_field_type != orig_field_type\n+\t  && tree_int_cst_lt (TYPE_SIZE (orig_field_type), gnu_size))\n+\tpacked = adjust_packed (gnu_field_type, gnu_record_type, packed);\n+\n       orig_field_type = gnu_field_type;\n       gnu_field_type = maybe_pad_type (gnu_field_type, gnu_size, 0, gnat_field,\n \t\t\t\t       false, false, definition, true);"}, {"sha": "07dc579c7b501b4d078b73cd9e93c8cdff3112d5", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "patch": "@@ -1,3 +1,7 @@\n+2019-10-11  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/specs/size_clause4.ads: New test.\n+\n 2019-10-11  Ilya Leoshkevich  <iii@linux.ibm.com>\n \n \tPR target/77918"}, {"sha": "4aa8c8fca78e89ab9f0964c60deeade63c60f0ed", "filename": "gcc/testsuite/gnat.dg/specs/size_clause4.ads", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fsize_clause4.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/75a582cd9f98b4cdea2eb8e961d53dc8d30fd462/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fsize_clause4.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Fsize_clause4.ads?ref=75a582cd9f98b4cdea2eb8e961d53dc8d30fd462", "patch": "@@ -0,0 +1,20 @@\n+-- { dg-do compile }\n+\n+with System;\n+\n+package Size_Clause4 is\n+\n+  type Rec is record\n+    A1 : System.Address;  \n+    A2 : System.Address;  \n+    I  : aliased Integer; \n+  end record;\n+       \n+  for Rec use record\n+    A1 at 0  range 0 .. 63; \n+    A2 at 8  range 0 .. 63;\n+    I  at 16 range 0 .. 31;  \n+  end record;\n+  for Rec'Size use 160;\n+\n+end Size_Clause4;"}]}