{"sha": "204b61b906f2f806eec2f7bb72d4dd79c88d688a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjA0YjYxYjkwNmYyZjgwNmVlYzJmN2JiNzJkNGRkNzljODhkNjg4YQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-11-23T15:34:17Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2020-11-23T15:37:42Z"}, "message": "Diagnostic for module importation\n\nThis tweaks the 'included from ...' printing to deal with imports in\nthe 'include' path.  One new thing is that there can now be two\n'include' names on a single line.  For example 'in module X, included\nat Y'.  This reads better than placing them on different lines.\n\n\tgcc/\n\t* diagnostic.c (diagnostic_report_current_module): Adjust for C++\n\tmodule importation.", "tree": {"sha": "9cb01aa480ffc7396b5095b14e4919461ded0ac9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9cb01aa480ffc7396b5095b14e4919461ded0ac9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/204b61b906f2f806eec2f7bb72d4dd79c88d688a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/204b61b906f2f806eec2f7bb72d4dd79c88d688a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/204b61b906f2f806eec2f7bb72d4dd79c88d688a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/204b61b906f2f806eec2f7bb72d4dd79c88d688a/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff1c10c1c5a617f99ea737185aed2c52277c0cab", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff1c10c1c5a617f99ea737185aed2c52277c0cab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff1c10c1c5a617f99ea737185aed2c52277c0cab"}], "stats": {"total": 21, "additions": 16, "deletions": 5}, "files": [{"sha": "fe509d88e6d8fa1eb22724137a5729d10b2a7da3", "filename": "gcc/diagnostic.c", "status": "modified", "additions": 16, "deletions": 5, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/204b61b906f2f806eec2f7bb72d4dd79c88d688a/gcc%2Fdiagnostic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/204b61b906f2f806eec2f7bb72d4dd79c88d688a/gcc%2Fdiagnostic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic.c?ref=204b61b906f2f806eec2f7bb72d4dd79c88d688a", "patch": "@@ -689,12 +689,13 @@ diagnostic_report_current_module (diagnostic_context *context, location_t where)\n       set_last_module (context, map);\n       if (! MAIN_FILE_P (map))\n \t{\n-\t  bool first = true;\n+\t  bool first = true, need_inc = true, was_module = MAP_MODULE_P (map);\n \t  expanded_location s = {};\n \t  do\n \t    {\n \t      where = linemap_included_from (map);\n \t      map = linemap_included_from_linemap (line_table, map);\n+\t      bool is_module = MAP_MODULE_P (map);\n \t      s.file = LINEMAP_FILE (map);\n \t      s.line = SOURCE_LINE (map, where);\n \t      int col = -1;\n@@ -706,14 +707,24 @@ diagnostic_report_current_module (diagnostic_context *context, location_t where)\n \t      const char *line_col = maybe_line_and_column (s.line, col);\n \t      static const char *const msgs[] =\n \t\t{\n-\t\t N_(\"In file included from\"),\n+\t\t NULL,\n \t\t N_(\"                 from\"),\n+\t\t N_(\"In file included from\"),\t/* 2 */\n+\t\t N_(\"        included from\"),\n+\t\t N_(\"In module\"),\t\t/* 4 */\n+\t\t N_(\"of module\"),\n+\t\t N_(\"In module imported at\"),\t/* 6 */\n+\t\t N_(\"imported at\"),\n \t\t};\n-\t      unsigned index = !first;\n+\n+\t      unsigned index = (was_module ? 6 : is_module ? 4\n+\t\t\t\t: need_inc ? 2 : 0) + !first;\n+\n \t      pp_verbatim (context->printer, \"%s%s %r%s%s%R\",\n-\t\t\t   first ? \"\" : \",\\n\", _(msgs[index]),\n+\t\t\t   first ? \"\" : was_module ? \", \" : \",\\n\",\n+\t\t\t   _(msgs[index]),\n \t\t\t   \"locus\", s.file, line_col);\n-\t      first = false;\n+\t      first = false, need_inc = was_module, was_module = is_module;\n \t    }\n \t  while (! MAIN_FILE_P (map));\n \t  pp_verbatim (context->printer, \":\");"}]}