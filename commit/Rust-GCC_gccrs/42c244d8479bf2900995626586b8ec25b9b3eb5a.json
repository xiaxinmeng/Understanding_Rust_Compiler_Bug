{"sha": "42c244d8479bf2900995626586b8ec25b9b3eb5a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDJjMjQ0ZDg0NzliZjI5MDA5OTU2MjY1ODZiOGVjMjViOWIzZWI1YQ==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2004-08-27T21:48:12Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2004-08-27T21:48:12Z"}, "message": "cp-tree.def (OFFSETOF_EXPR): New.\n\n        * cp-tree.def (OFFSETOF_EXPR): New.\n        * parser.c (cp_parser_builtin_offsetof): Either built an\n        OFFSETOF_EXPR, or call fold_offsetof immediately.\n        * pt.c (tsubst_expr): Handle OFFSETOF_EXPR.\n\nFrom-SVN: r86679", "tree": {"sha": "f506b144421d7b9eb085b0ca871f275af2238424", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f506b144421d7b9eb085b0ca871f275af2238424"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/42c244d8479bf2900995626586b8ec25b9b3eb5a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42c244d8479bf2900995626586b8ec25b9b3eb5a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/42c244d8479bf2900995626586b8ec25b9b3eb5a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/42c244d8479bf2900995626586b8ec25b9b3eb5a/comments", "author": null, "committer": null, "parents": [{"sha": "a2fddff9be09cf004aa687e489d7ae04f237a901", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a2fddff9be09cf004aa687e489d7ae04f237a901", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a2fddff9be09cf004aa687e489d7ae04f237a901"}], "stats": {"total": 33, "additions": 21, "deletions": 12}, "files": [{"sha": "afd820fb222444e670cf93a18f474dcd40db5452", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=42c244d8479bf2900995626586b8ec25b9b3eb5a", "patch": "@@ -1,3 +1,10 @@\n+2004-08-27  Richard Henderson  <rth@redhat.com>\n+\n+\t* cp-tree.def (OFFSETOF_EXPR): New.\n+\t* parser.c (cp_parser_builtin_offsetof): Either built an\n+\tOFFSETOF_EXPR, or call fold_offsetof immediately.\n+\t* pt.c (tsubst_expr): Handle OFFSETOF_EXPR.\n+\n 2004-08-27  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* call.c (validate_conversion_obstack): Replace"}, {"sha": "02afea97a50245e9669eeb50e2fe19f5abeef0ff", "filename": "gcc/cp/cp-tree.def", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2Fcp-tree.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2Fcp-tree.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.def?ref=42c244d8479bf2900995626586b8ec25b9b3eb5a", "patch": "@@ -282,6 +282,9 @@ DEFTREECODE (TAG_DEFN, \"tag_defn\", 'e', 0)\n \n DEFTREECODE (TINST_LEVEL, \"TINST_LEVEL\", 'x', 0)\n \n+/* Represents an 'offsetof' expression during template expansion.  */\n+DEFTREECODE (OFFSETOF_EXPR, \"offsetof_expr\", 'e', 1)\n+\n /*\n Local variables:\n mode:c"}, {"sha": "c0d5227a7a163baef243ca4781e4835c175c8219", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 6, "deletions": 12, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=42c244d8479bf2900995626586b8ec25b9b3eb5a", "patch": "@@ -5876,18 +5876,12 @@ cp_parser_builtin_offsetof (cp_parser *parser)\n     }\n \n  success:\n-  /* We've finished the parsing, now finish with the semantics.  At present\n-     we're just mirroring the traditional macro implementation.  Better\n-     would be to do the lowering of the ADDR_EXPR to flat pointer arithmetic\n-     here rather than in build_x_unary_op.  */\n-  \n-  expr = (build_reinterpret_cast \n-\t  (build_reference_type (cp_build_qualified_type \n-\t\t\t\t (char_type_node, \n-\t\t\t\t  TYPE_QUAL_CONST | TYPE_QUAL_VOLATILE)), \n-\t   expr));\n-  expr = build_x_unary_op (ADDR_EXPR, expr);\n-  expr = build_reinterpret_cast (size_type_node, expr);\n+  /* If we're processing a template, we can't finish the semantics yet.\n+     Otherwise we can fold the entire expression now.  */\n+  if (processing_template_decl)\n+    expr = build1 (OFFSETOF_EXPR, size_type_node, expr);\n+  else\n+    expr = fold_offsetof (expr);\n \n  failure:\n   parser->integral_constant_expression_p = save_ice_p;"}, {"sha": "a979e83896f27846183aa3529c53228f7569b979", "filename": "gcc/cp/pt.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2Fpt.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/42c244d8479bf2900995626586b8ec25b9b3eb5a/gcc%2Fcp%2Fpt.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fpt.c?ref=42c244d8479bf2900995626586b8ec25b9b3eb5a", "patch": "@@ -8092,6 +8092,11 @@ tsubst_expr (tree t, tree args, tsubst_flags_t complain, tree in_decl)\n       tsubst (TREE_TYPE (t), args, complain, NULL_TREE);\n       break;\n \n+    case OFFSETOF_EXPR:\n+      t = tsubst_copy_and_build (TREE_OPERAND (t, 0), args, complain,\n+\t\t\t\t in_decl, false);\n+      return fold_offsetof (t);\n+\n     default:\n       if (!STATEMENT_CODE_P (TREE_CODE (t)))\n \treturn tsubst_copy_and_build (t, args, complain, in_decl,"}]}