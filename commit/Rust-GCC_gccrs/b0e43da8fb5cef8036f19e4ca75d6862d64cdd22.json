{"sha": "b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjBlNDNkYThmYjVjZWY4MDM2ZjE5ZTRjYTc1ZDY4NjJkNjRjZGQyMg==", "commit": {"author": {"name": "Chung-Lin Tang", "email": "cltang@codesourcery.com", "date": "2011-07-20T06:21:36Z"}, "committer": {"name": "Chung-Lin Tang", "email": "cltang@gcc.gnu.org", "date": "2011-07-20T06:21:36Z"}, "message": "arm.c (arm_canonicalize_comparison): Add case to canonicalize left operand from ZERO_EXTEND to AND.\n\n2011-07-20  Chung-Lin Tang  <cltang@codesourcery.com>\n\n\t* config/arm/arm.c (arm_canonicalize_comparison): Add case to\n\tcanonicalize left operand from ZERO_EXTEND to AND.\n\n\ttestsuite/\n\t* gcc.target/arm/combine-movs.c: New.\n\t* gcc.target/arm/unsigned-extend-2.c: New.\n\nFrom-SVN: r176495", "tree": {"sha": "acc93519250b72c3add8ae44a0372b25488e9b29", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/acc93519250b72c3add8ae44a0372b25488e9b29"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/comments", "author": {"login": "cltang", "id": 4055966, "node_id": "MDQ6VXNlcjQwNTU5NjY=", "avatar_url": "https://avatars.githubusercontent.com/u/4055966?v=4", "gravatar_id": "", "url": "https://api.github.com/users/cltang", "html_url": "https://github.com/cltang", "followers_url": "https://api.github.com/users/cltang/followers", "following_url": "https://api.github.com/users/cltang/following{/other_user}", "gists_url": "https://api.github.com/users/cltang/gists{/gist_id}", "starred_url": "https://api.github.com/users/cltang/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/cltang/subscriptions", "organizations_url": "https://api.github.com/users/cltang/orgs", "repos_url": "https://api.github.com/users/cltang/repos", "events_url": "https://api.github.com/users/cltang/events{/privacy}", "received_events_url": "https://api.github.com/users/cltang/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "e7b6c2cb752ee6f52152e97f9e6e5213efb60edf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e7b6c2cb752ee6f52152e97f9e6e5213efb60edf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e7b6c2cb752ee6f52152e97f9e6e5213efb60edf"}], "stats": {"total": 53, "additions": 53, "deletions": 0}, "files": [{"sha": "605729cc946ed96482d6c4e356c329d8aa41f433", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "patch": "@@ -1,3 +1,8 @@\n+2011-07-20  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* config/arm/arm.c (arm_canonicalize_comparison): Add case to\n+\tcanonicalize left operand from ZERO_EXTEND to AND.\n+\n 2011-07-20  Anatoly Sokolov  <aesok@post.ru>\n \n \t* target.def (class_max_nregs): New hook."}, {"sha": "6e2b799fe57aeefba33d7e87289540c4e8282d0c", "filename": "gcc/config/arm/arm.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Fconfig%2Farm%2Farm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Fconfig%2Farm%2Farm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Farm%2Farm.c?ref=b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "patch": "@@ -3172,6 +3172,19 @@ arm_canonicalize_comparison (enum rtx_code code, rtx *op0, rtx *op1)\n       return code;\n     }\n \n+  /* If *op0 is (zero_extend:SI (subreg:QI (reg:SI) 0)) and comparing\n+     with const0_rtx, change it to (and:SI (reg:SI) (const_int 255)),\n+     to facilitate possible combining with a cmp into 'ands'.  */\n+  if (mode == SImode\n+      && GET_CODE (*op0) == ZERO_EXTEND\n+      && GET_CODE (XEXP (*op0, 0)) == SUBREG\n+      && GET_MODE (XEXP (*op0, 0)) == QImode\n+      && GET_MODE (SUBREG_REG (XEXP (*op0, 0))) == SImode\n+      && subreg_lowpart_p (XEXP (*op0, 0))\n+      && *op1 == const0_rtx)\n+    *op0 = gen_rtx_AND (SImode, SUBREG_REG (XEXP (*op0, 0)),\n+\t\t\tGEN_INT (255));\n+\n   /* Comparisons smaller than DImode.  Only adjust comparisons against\n      an out-of-range constant.  */\n   if (GET_CODE (*op1) != CONST_INT"}, {"sha": "9138237f036dab1a05d11661eff85071b27e9e96", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "patch": "@@ -1,3 +1,8 @@\n+2011-07-20  Chung-Lin Tang  <cltang@codesourcery.com>\n+\n+\t* gcc.target/arm/combine-movs.c: New.\n+\t* gcc.target/arm/unsigned-extend-2.c: New.\n+\n 2011-07-19  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/49785"}, {"sha": "4209a33142712676b7b1965c6fc375ca8cf9c013", "filename": "gcc/testsuite/gcc.target/arm/combine-movs.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcombine-movs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcombine-movs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Fcombine-movs.c?ref=b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "patch": "@@ -0,0 +1,12 @@\n+/* { dg-do compile } */\n+/* { dg-skip-if \"\" { arm_thumb1 } } */\n+/* { dg-options \"-O\" }  */\n+\n+void foo (unsigned long r[], unsigned int d)\n+{\n+  int i, n = d / 32;\n+  for (i = 0; i < n; ++i)\n+    r[i] = 0;\n+}\n+\n+/* { dg-final { scan-assembler \"movs\\tr\\[0-9\\]\" } } */"}, {"sha": "b610b73617dc6e6a5428c966380516007a02acba", "filename": "gcc/testsuite/gcc.target/arm/unsigned-extend-2.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Funsigned-extend-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b0e43da8fb5cef8036f19e4ca75d6862d64cdd22/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Funsigned-extend-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Farm%2Funsigned-extend-2.c?ref=b0e43da8fb5cef8036f19e4ca75d6862d64cdd22", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target arm_thumb2_ok } */\n+/* { dg-options \"-O\" } */\n+\n+unsigned short foo (unsigned short x)\n+{\n+  unsigned char i = 0;\n+  for (i = 0; i < 8; i++)\n+    {\n+      x >>= 1;\n+      x &= 0x7fff;\n+    }\n+  return x;\n+}\n+\n+/* { dg-final { scan-assembler \"ands\" } } */\n+/* { dg-final { scan-assembler-not \"uxtb\" } } */\n+/* { dg-final { scan-assembler-not \"cmp\" } } */"}]}