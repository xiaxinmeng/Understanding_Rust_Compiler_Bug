{"sha": "3396aba5384e904199530f8efea4c1eaaab51605", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzM5NmFiYTUzODRlOTA0MTk5NTMwZjhlZmVhNGMxZWFhYWI1MTYwNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2014-01-09T20:12:36Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2014-01-09T20:12:36Z"}, "message": "re PR middle-end/47735 (Unnecessary adjustments to stack pointer)\n\n\tPR middle-end/47735\n\t* cfgexpand.c (expand_one_var): For SSA_NAMEs, if the underlying\n\tvar satisfies use_register_for_decl, just take into account type\n\talignment, rather than decl alignment.\n\n\t* gcc.target/i386/pr47735.c: New test.\n\nFrom-SVN: r206493", "tree": {"sha": "8aa86e6cd0afa95c4caa85d417ffe6d223a72f61", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8aa86e6cd0afa95c4caa85d417ffe6d223a72f61"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3396aba5384e904199530f8efea4c1eaaab51605", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3396aba5384e904199530f8efea4c1eaaab51605", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3396aba5384e904199530f8efea4c1eaaab51605", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3396aba5384e904199530f8efea4c1eaaab51605/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a70e9985fdc020e89eace3d72108606c47150fc5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a70e9985fdc020e89eace3d72108606c47150fc5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a70e9985fdc020e89eace3d72108606c47150fc5"}], "stats": {"total": 31, "additions": 29, "deletions": 2}, "files": [{"sha": "c87697ff17a6b1d10304244fb26bf8db6fd24cb1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3396aba5384e904199530f8efea4c1eaaab51605", "patch": "@@ -1,5 +1,10 @@\n 2014-01-09  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/47735\n+\t* cfgexpand.c (expand_one_var): For SSA_NAMEs, if the underlying\n+\tvar satisfies use_register_for_decl, just take into account type\n+\talignment, rather than decl alignment.\n+\n \tPR tree-optimization/59622\n \t* gimple-fold.c (gimple_fold_call): Fix a typo in message.  For\n \t__builtin_unreachable replace the OBJ_TYPE_REF call with a call to"}, {"sha": "c0cbeb3c0220e3b69392717b9fc453d2927e4546", "filename": "gcc/cfgexpand.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2Fcfgexpand.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2Fcfgexpand.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgexpand.c?ref=3396aba5384e904199530f8efea4c1eaaab51605", "patch": "@@ -1215,8 +1215,11 @@ expand_one_var (tree var, bool toplevel, bool really_expand)\n \t we conservatively assume it will be on stack even if VAR is\n \t eventually put into register after RA pass.  For non-automatic\n \t variables, which won't be on stack, we collect alignment of\n-\t type and ignore user specified alignment.  */\n-      if (TREE_STATIC (var) || DECL_EXTERNAL (var))\n+\t type and ignore user specified alignment.  Similarly for\n+\t SSA_NAMEs for which use_register_for_decl returns true.  */\n+      if (TREE_STATIC (var)\n+\t  || DECL_EXTERNAL (var)\n+\t  || (TREE_CODE (origvar) == SSA_NAME && use_register_for_decl (var)))\n \talign = MINIMUM_ALIGNMENT (TREE_TYPE (var),\n \t\t\t\t   TYPE_MODE (TREE_TYPE (var)),\n \t\t\t\t   TYPE_ALIGN (TREE_TYPE (var)));"}, {"sha": "0957d841140971311446c3d6252c97ac0dc477b4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3396aba5384e904199530f8efea4c1eaaab51605", "patch": "@@ -1,5 +1,8 @@\n 2014-01-09  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR middle-end/47735\n+\t* gcc.target/i386/pr47735.c: New test.\n+\n \tPR tree-optimization/59622\n \t* g++.dg/opt/pr59622-2.C: New test.\n \t* g++.dg/opt/pr59622-3.C: New test."}, {"sha": "0d44df4d5c9e8b2a63b41ea200d15d5043d28e31", "filename": "gcc/testsuite/gcc.target/i386/pr47735.c", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr47735.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3396aba5384e904199530f8efea4c1eaaab51605/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr47735.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr47735.c?ref=3396aba5384e904199530f8efea4c1eaaab51605", "patch": "@@ -0,0 +1,16 @@\n+/* PR middle-end/47735 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fomit-frame-pointer\" } */\n+\n+unsigned\n+mulh (unsigned a, unsigned b)\n+{\n+  unsigned long long l __attribute__ ((aligned (32)))\n+    = ((unsigned long long) a * (unsigned long long) b) >> 32;\n+  return l;\n+}\n+\n+/* No need to dynamically realign the stack here.  */\n+/* { dg-final { scan-assembler-not \"and\\[^\\n\\r]*%\\[re\\]sp\" } } */\n+/* Nor use a frame pointer.  */\n+/* { dg-final { scan-assembler-not \"%\\[re\\]bp\" } } */"}]}