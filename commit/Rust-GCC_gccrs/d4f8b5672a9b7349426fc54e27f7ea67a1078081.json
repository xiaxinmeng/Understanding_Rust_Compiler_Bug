{"sha": "d4f8b5672a9b7349426fc54e27f7ea67a1078081", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDRmOGI1NjcyYTliNzM0OTQyNmZjNTRlMjdmN2VhNjdhMTA3ODA4MQ==", "commit": {"author": {"name": "Roger Sayle", "email": "roger@eyesopen.com", "date": "2007-02-02T03:58:58Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2007-02-02T03:58:58Z"}, "message": "dependency.c (gfc_check_dependency): Implement dependency checking for array constructors.\n\n\n\t* dependency.c (gfc_check_dependency) <EXPR_ARRAY>: Implement\n\tdependency checking for array constructors.\n\n\t* gfortran.dg/dependency_20.f90: New test case.\n\nFrom-SVN: r121490", "tree": {"sha": "0376647112160df823b457ae54a0a1c271ff2287", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0376647112160df823b457ae54a0a1c271ff2287"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d4f8b5672a9b7349426fc54e27f7ea67a1078081", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4f8b5672a9b7349426fc54e27f7ea67a1078081", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4f8b5672a9b7349426fc54e27f7ea67a1078081", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4f8b5672a9b7349426fc54e27f7ea67a1078081/comments", "author": null, "committer": null, "parents": [{"sha": "2ad62c9b343185a73761936204f5a261c8fbad07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2ad62c9b343185a73761936204f5a261c8fbad07", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2ad62c9b343185a73761936204f5a261c8fbad07"}], "stats": {"total": 37, "additions": 34, "deletions": 3}, "files": [{"sha": "f794e51f803552313c3fad90f054443a63b42277", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=d4f8b5672a9b7349426fc54e27f7ea67a1078081", "patch": "@@ -1,3 +1,8 @@\n+2007-02-01  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* dependency.c (gfc_check_dependency) <EXPR_ARRAY>: Implement\n+\tdependency checking for array constructors.\n+\n 2007-02-01  Roger Sayle  <roger@eyesopen.com>\n \n \t* trans-stmt.c (compute_overall_iter_number): Document function"}, {"sha": "b79f222983594ce12edbefb9d86c32f455570d9b", "filename": "gcc/fortran/dependency.c", "status": "modified", "additions": 15, "deletions": 3, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ffortran%2Fdependency.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ffortran%2Fdependency.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdependency.c?ref=d4f8b5672a9b7349426fc54e27f7ea67a1078081", "patch": "@@ -599,9 +599,10 @@ gfc_are_equivalenced_arrays (gfc_expr *e1, gfc_expr *e2)\n int\n gfc_check_dependency (gfc_expr *expr1, gfc_expr *expr2, bool identical)\n {\n+  gfc_actual_arglist *actual;\n+  gfc_constructor *c;\n   gfc_ref *ref;\n   int n;\n-  gfc_actual_arglist *actual;\n \n   gcc_assert (expr1->expr_type == EXPR_VARIABLE);\n \n@@ -685,8 +686,19 @@ gfc_check_dependency (gfc_expr *expr1, gfc_expr *expr2, bool identical)\n       return 0;\n \n     case EXPR_ARRAY:\n-      /* Probably ok in the majority of (constant) cases.  */\n-      return 1;\n+      /* Loop through the array constructor's elements.  */\n+      for (c = expr2->value.constructor; c; c = c->next)\n+\t{\n+\t  /* If this is an iterator, assume the worst.  */\n+\t  if (c->iterator)\n+\t    return 1;\n+\t  /* Avoid recursion in the common case.  */\n+\t  if (c->expr->expr_type == EXPR_CONSTANT)\n+\t    continue;\n+\t  if (gfc_check_dependency (expr1, c->expr, 1))\n+\t    return 1;\n+\t}\n+      return 0;\n \n     default:\n       return 1;"}, {"sha": "31d23b734af1e06c0b70970dc4257434ff012c89", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d4f8b5672a9b7349426fc54e27f7ea67a1078081", "patch": "@@ -1,3 +1,7 @@\n+2007-02-01  Roger Sayle  <roger@eyesopen.com>\n+\n+\t* gfortran.dg/dependency_20.f90: New test case.\n+\n 2007-01-31  Ian Lance Taylor  <iant@google.com>\n \n \t* gcc.dg/lower-subreg-1.c (test): New test."}, {"sha": "ed8fa14a112d0cff0821396e0fbb48a34a26540e", "filename": "gcc/testsuite/gfortran.dg/dependency_20.f90", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_20.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d4f8b5672a9b7349426fc54e27f7ea67a1078081/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_20.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_20.f90?ref=d4f8b5672a9b7349426fc54e27f7ea67a1078081", "patch": "@@ -0,0 +1,10 @@\n+! { dg-do compile }\n+! { dg-options \"-O2 -fdump-tree-original\" }\n+  integer :: a(4)\n+\n+  where (a(:) .ne. 0)\n+    a(:) = (/ 1, 2, 3, 4 /)\n+  endwhere\n+end\n+! { dg-final { scan-tree-dump-times \"temp\" 0 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }"}]}