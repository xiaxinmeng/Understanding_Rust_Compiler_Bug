{"sha": "faddc0d7c2d9647a4e2fa897743442dd71180d88", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZmFkZGMwZDdjMmQ5NjQ3YTRlMmZhODk3NzQzNDQyZGQ3MTE4MGQ4OA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2012-09-05T04:17:12Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2012-09-05T04:17:12Z"}, "message": "re PR c++/54441 (Infinite loop with brace initializer on zero-length array)\n\n\tPR c++/54441\n\t* decl.c (reshape_init_class): Handle invalid initializer for\n\t0-length array member.\n\n\t* error.c (dump_type_suffix): Correct handling of 0-length arrays.\n\nFrom-SVN: r190962", "tree": {"sha": "36dc2af022600dcf76a8c66d9d71bf136af723ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36dc2af022600dcf76a8c66d9d71bf136af723ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/faddc0d7c2d9647a4e2fa897743442dd71180d88", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faddc0d7c2d9647a4e2fa897743442dd71180d88", "html_url": "https://github.com/Rust-GCC/gccrs/commit/faddc0d7c2d9647a4e2fa897743442dd71180d88", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/faddc0d7c2d9647a4e2fa897743442dd71180d88/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5a706c322d07f1c834b4120fd98d943b806b4228", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5a706c322d07f1c834b4120fd98d943b806b4228", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5a706c322d07f1c834b4120fd98d943b806b4228"}], "stats": {"total": 33, "additions": 32, "deletions": 1}, "files": [{"sha": "629ab57b0e2eb877b38ff77fff2ec741e632d06a", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=faddc0d7c2d9647a4e2fa897743442dd71180d88", "patch": "@@ -1,5 +1,11 @@\n 2012-09-04  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/54441\n+\t* decl.c (reshape_init_class): Handle invalid initializer for\n+\t0-length array member.\n+\n+\t* error.c (dump_type_suffix): Correct handling of 0-length arrays.\n+\n \tPR c++/54420\n \t* cp-tree.h (LAMBDANAME_P): Remove.\n \t(LAMBDA_TYPE_P): Check CLASSTYPE_LAMBDA_EXPR instead."}, {"sha": "b665fe8ca1951c66c70316cdc890f046ecb1ef13", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=faddc0d7c2d9647a4e2fa897743442dd71180d88", "patch": "@@ -5094,6 +5094,7 @@ reshape_init_class (tree type, reshape_iter *d, bool first_initializer_p,\n   while (d->cur != d->end)\n     {\n       tree field_init;\n+      constructor_elt *old_cur = d->cur;\n \n       /* Handle designated initializers, as an extension.  */\n       if (d->cur->index)\n@@ -5130,6 +5131,15 @@ reshape_init_class (tree type, reshape_iter *d, bool first_initializer_p,\n       if (field_init == error_mark_node)\n \treturn error_mark_node;\n \n+      if (d->cur->index && d->cur == old_cur)\n+\t{\n+\t  /* This can happen with an invalid initializer for a flexible\n+\t     array member (c++/54441).  */\n+\t  if (complain & tf_error)\n+\t    error (\"invalid initializer for %q#D\", field);\n+\t  return error_mark_node;\n+\t}\n+\n       CONSTRUCTOR_APPEND_ELT (CONSTRUCTOR_ELTS (new_init), field, field_init);\n \n       /* [dcl.init.aggr]"}, {"sha": "1872d01a249401121e81ab4e5e3838ef557ae45f", "filename": "gcc/cp/error.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Fcp%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Fcp%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ferror.c?ref=faddc0d7c2d9647a4e2fa897743442dd71180d88", "patch": "@@ -846,7 +846,9 @@ dump_type_suffix (tree t, int flags)\n \t{\n \t  tree dtype = TYPE_DOMAIN (t);\n \t  tree max = TYPE_MAX_VALUE (dtype);\n-\t  if (host_integerp (max, 0))\n+\t  if (integer_all_onesp (max))\n+\t    pp_character (cxx_pp, '0');\n+\t  else if (host_integerp (max, 0))\n \t    pp_wide_integer (cxx_pp, tree_low_cst (max, 0) + 1);\n \t  else if (TREE_CODE (max) == MINUS_EXPR)\n \t    dump_expr (TREE_OPERAND (max, 0),"}, {"sha": "62dfe13afc3d4c9938a88b7bcd1edda3f554e313", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=faddc0d7c2d9647a4e2fa897743442dd71180d88", "patch": "@@ -1,5 +1,8 @@\n 2012-09-04  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/54441\n+\t* g++.dg/ext/flexary3.C: New.\n+\n \tPR c++/54420\n \t* g++.dg/cpp0x/lambda/lambda-intname.C: New.\n "}, {"sha": "906877b11b780e88ee88b4c48e18876e7ca02996", "filename": "gcc/testsuite/g++.dg/ext/flexary3.C", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fflexary3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/faddc0d7c2d9647a4e2fa897743442dd71180d88/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fflexary3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fflexary3.C?ref=faddc0d7c2d9647a4e2fa897743442dd71180d88", "patch": "@@ -0,0 +1,10 @@\n+// PR c++/54441\n+// { dg-options \"\" }\n+\n+struct s { char c[]; };\n+\n+int main()\n+{\n+    struct s s = { .c = 0 };\t// { dg-error \"initializer\" }\n+    return 0;\n+}"}]}