{"sha": "6d3c634c8baebd9ff12c39d61947752486758bd3", "node_id": "C_kwDOANBUbNoAKDZkM2M2MzRjOGJhZWJkOWZmMTJjMzlkNjE5NDc3NTI0ODY3NThiZDM", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-11-27T19:30:14Z"}, "committer": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2022-12-02T15:38:32Z"}, "message": "driver: fix validate_switches logic\n\nUnder the old logic for validate_switches, once suffix or starred got set,\nthey stayed set for all later switches found in the spec.  So for e.g.\n\n%{g*:%{%:debug-level-gt(0):\n\nOnce we see g*, starred is set.  Then we see %:, and it sees that as a\nzero-length switch, which because starred is still set, matches any and all\ncommand-line options.  So targets that use such a spec accept all options in\nthe driver, while ones that don't reject some, such as the recent\n-nostdlib++.\n\nThis patch fixes the inconsistency, so all targets would complain about\n-nostdlib++, and then sets SKIPOPT for it so they don't.\n\ngcc/ChangeLog:\n\n\t* gcc.cc (validate_switches): Reset suffix/starred on loop.\n\ngcc/cp/ChangeLog:\n\n\t* g++spec.cc (lang_specific_driver): Set SKIPOPT for nostdlib++.", "tree": {"sha": "9831db43bb8060835be83e840e7adc83c20fd0ae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9831db43bb8060835be83e840e7adc83c20fd0ae"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6d3c634c8baebd9ff12c39d61947752486758bd3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d3c634c8baebd9ff12c39d61947752486758bd3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d3c634c8baebd9ff12c39d61947752486758bd3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d3c634c8baebd9ff12c39d61947752486758bd3/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "70596a0fb2a2ec072e1e97e37616e05041dfa4e5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70596a0fb2a2ec072e1e97e37616e05041dfa4e5", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70596a0fb2a2ec072e1e97e37616e05041dfa4e5"}], "stats": {"total": 11, "additions": 8, "deletions": 3}, "files": [{"sha": "3d3b042dd563e592e82ef3a0230c89b90839f9a0", "filename": "gcc/cp/g++spec.cc", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d3c634c8baebd9ff12c39d61947752486758bd3/gcc%2Fcp%2Fg%2B%2Bspec.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d3c634c8baebd9ff12c39d61947752486758bd3/gcc%2Fcp%2Fg%2B%2Bspec.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fg%2B%2Bspec.cc?ref=6d3c634c8baebd9ff12c39d61947752486758bd3", "patch": "@@ -167,8 +167,10 @@ lang_specific_driver (struct cl_decoded_option **in_decoded_options,\n \t  need_experimental = true;\n \t  break;\n \n-\tcase OPT_nostdlib:\n \tcase OPT_nostdlib__:\n+\t  args[i] |= SKIPOPT;\n+\t  /* FALLTHRU */\n+\tcase OPT_nostdlib:\n \tcase OPT_nodefaultlibs:\n \t  library = -1;\n \t  break;"}, {"sha": "2278e2b6bb15ba7fdade9a784f8935951e6f3f9a", "filename": "gcc/gcc.cc", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6d3c634c8baebd9ff12c39d61947752486758bd3/gcc%2Fgcc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6d3c634c8baebd9ff12c39d61947752486758bd3/gcc%2Fgcc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.cc?ref=6d3c634c8baebd9ff12c39d61947752486758bd3", "patch": "@@ -9299,12 +9299,15 @@ validate_switches (const char *start, bool user_spec, bool braced)\n   const char *atom;\n   size_t len;\n   int i;\n-  bool suffix = false;\n-  bool starred = false;\n+  bool suffix;\n+  bool starred;\n \n #define SKIP_WHITE() do { while (*p == ' ' || *p == '\\t') p++; } while (0)\n \n next_member:\n+  suffix = false;\n+  starred = false;\n+\n   SKIP_WHITE ();\n \n   if (*p == '!')"}]}