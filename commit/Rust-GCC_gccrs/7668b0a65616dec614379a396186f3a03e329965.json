{"sha": "7668b0a65616dec614379a396186f3a03e329965", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzY2OGIwYTY1NjE2ZGVjNjE0Mzc5YTM5NjE4NmYzYTAzZTMyOTk2NQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-10-09T13:50:10Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-10-09T13:50:10Z"}, "message": "re PR tree-optimization/82449 (code-gen error in get_rename_from_scev)\n\n2017-10-09  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/82449\n\t* sese.c (scev_analyzable_p): Check whether the SCEV is linear.\n\t* tree-chrec.h (evolution_function_is_constant_p): Adjust to\n\tallow constant addresses.\n\t* tree-chrec.c (scev_is_linear_expression): Constant evolutions\n\tare linear.\n\n\t* gfortran.dg/graphite/pr82449.f: New testcase.\n\nFrom-SVN: r253546", "tree": {"sha": "b0e28952a26e671e7b03d21e4f1a5d6f733c76ce", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b0e28952a26e671e7b03d21e4f1a5d6f733c76ce"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7668b0a65616dec614379a396186f3a03e329965", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7668b0a65616dec614379a396186f3a03e329965", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7668b0a65616dec614379a396186f3a03e329965", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7668b0a65616dec614379a396186f3a03e329965/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "14108eda7ee4aaaa4840be8728b3161f8c7bd364", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/14108eda7ee4aaaa4840be8728b3161f8c7bd364", "html_url": "https://github.com/Rust-GCC/gccrs/commit/14108eda7ee4aaaa4840be8728b3161f8c7bd364"}], "stats": {"total": 55, "additions": 38, "deletions": 17}, "files": [{"sha": "44ca159117a1c402ef96468f96fbdb11229dc36a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7668b0a65616dec614379a396186f3a03e329965/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7668b0a65616dec614379a396186f3a03e329965/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7668b0a65616dec614379a396186f3a03e329965", "patch": "@@ -1,3 +1,12 @@\n+2017-10-09  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/82449\n+\t* sese.c (scev_analyzable_p): Check whether the SCEV is linear.\n+\t* tree-chrec.h (evolution_function_is_constant_p): Adjust to\n+\tallow constant addresses.\n+\t* tree-chrec.c (scev_is_linear_expression): Constant evolutions\n+\tare linear.\n+\n 2017-10-09  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \t* config/s390/s390-builtins.def (vec_nabs, vec_vfi): Fix builtin"}, {"sha": "d6702ada5f4ac2f1a2294bfe9df7489489623f53", "filename": "gcc/sese.c", "status": "modified", "additions": 7, "deletions": 8, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7668b0a65616dec614379a396186f3a03e329965/gcc%2Fsese.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7668b0a65616dec614379a396186f3a03e329965/gcc%2Fsese.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsese.c?ref=7668b0a65616dec614379a396186f3a03e329965", "patch": "@@ -444,14 +444,13 @@ scev_analyzable_p (tree def, sese_l &region)\n   loop = loop_containing_stmt (SSA_NAME_DEF_STMT (def));\n   scev = scalar_evolution_in_region (region, loop, def);\n \n-  return !chrec_contains_undetermined (scev)\n-    && (TREE_CODE (scev) != SSA_NAME\n-\t|| !defined_in_sese_p (scev, region))\n-    && (tree_does_not_contain_chrecs (scev)\n-\t|| evolution_function_is_affine_p (scev))\n-    && (! loop\n-\t|| ! loop_in_sese_p (loop, region)\n-\t|| ! chrec_contains_symbols_defined_in_loop (scev, loop->num));\n+  return (!chrec_contains_undetermined (scev)\n+\t  && (TREE_CODE (scev) != SSA_NAME\n+\t      || !defined_in_sese_p (scev, region))\n+\t  && scev_is_linear_expression (scev)\n+\t  && (! loop\n+\t      || ! loop_in_sese_p (loop, region)\n+\t      || ! chrec_contains_symbols_defined_in_loop (scev, loop->num)));\n }\n \n /* Returns the scalar evolution of T in REGION.  Every variable that"}, {"sha": "5768f4260eaf8f59c6fddb8faf4518b23691c073", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7668b0a65616dec614379a396186f3a03e329965", "patch": "@@ -1,3 +1,8 @@\n+2017-10-09  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/82449\n+\t* gfortran.dg/graphite/pr82449.f: New testcase.\n+\n 2017-10-09  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \tPR target/82463"}, {"sha": "974ea206d411c5e8bc3cfb70b294f9ed1c7c5212", "filename": "gcc/testsuite/gfortran.dg/graphite/pr82449.f", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftestsuite%2Fgfortran.dg%2Fgraphite%2Fpr82449.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftestsuite%2Fgfortran.dg%2Fgraphite%2Fpr82449.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgraphite%2Fpr82449.f?ref=7668b0a65616dec614379a396186f3a03e329965", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! { dg-options \"-O2 -floop-nest-optimize\" }\n+\n+      SUBROUTINE JDFIDX(MKL,KGSH)\n+      DIMENSION MKL(6,6)\n+      NKL=0\n+  400 DO 40 KG = 1,KGSH\n+      DO 40 LG = 1,KG\n+      NKL = NKL + 1\n+   40 MKL(LG,KG) = NKL\n+      END"}, {"sha": "3867072566e84e1cd0f644fae7f00cae35d826fd", "filename": "gcc/tree-chrec.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftree-chrec.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftree-chrec.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-chrec.c?ref=7668b0a65616dec614379a396186f3a03e329965", "patch": "@@ -1610,6 +1610,9 @@ operator_is_linear (tree scev)\n bool\n scev_is_linear_expression (tree scev)\n {\n+  if (evolution_function_is_constant_p (scev))\n+    return true;\n+\n   if (scev == NULL\n       || !operator_is_linear (scev))\n     return false;"}, {"sha": "4a8a3734d7952534192217c21b34d50340e8c53c", "filename": "gcc/tree-chrec.h", "status": "modified", "additions": 3, "deletions": 9, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftree-chrec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7668b0a65616dec614379a396186f3a03e329965/gcc%2Ftree-chrec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-chrec.h?ref=7668b0a65616dec614379a396186f3a03e329965", "patch": "@@ -169,15 +169,9 @@ evolution_function_is_constant_p (const_tree chrec)\n   if (chrec == NULL_TREE)\n     return false;\n \n-  switch (TREE_CODE (chrec))\n-    {\n-    case INTEGER_CST:\n-    case REAL_CST:\n-      return true;\n-\n-    default:\n-      return false;\n-    }\n+  if (CONSTANT_CLASS_P (chrec))\n+    return true;\n+  return is_gimple_min_invariant (chrec);\n }\n \n /* Determine whether CHREC is an affine evolution function in LOOPNUM.  */"}]}