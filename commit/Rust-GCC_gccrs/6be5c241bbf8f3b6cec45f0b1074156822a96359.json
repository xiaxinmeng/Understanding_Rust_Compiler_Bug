{"sha": "6be5c241bbf8f3b6cec45f0b1074156822a96359", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmJlNWMyNDFiYmY4ZjNiNmNlYzQ1ZjBiMTA3NDE1NjgyMmE5NjM1OQ==", "commit": {"author": {"name": "Tom de Vries", "email": "tom@codesourcery.com", "date": "2015-08-24T13:14:17Z"}, "committer": {"name": "Tom de Vries", "email": "vries@gcc.gnu.org", "date": "2015-08-24T13:14:17Z"}, "message": "Optimize expand_omp_for_static_chunk for chunk_size one\n\n2015-08-24  Tom de Vries  <tom@codesourcery.com>\n\n\tPR tree-optimization/65468\n\t* omp-low.c (expand_omp_for_static_chunk): Remove inner loop if\n\tchunk_size is one.\n\n\t* gcc.dg/gomp/static-chunk-size-one.c: New test.\n\n\t* testsuite/libgomp.c/static-chunk-size-one.c: New test.\n\nFrom-SVN: r227124", "tree": {"sha": "e8ba4654c7ecc7f4b815ad5cbf25b654f1dd4526", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e8ba4654c7ecc7f4b815ad5cbf25b654f1dd4526"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6be5c241bbf8f3b6cec45f0b1074156822a96359", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6be5c241bbf8f3b6cec45f0b1074156822a96359", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6be5c241bbf8f3b6cec45f0b1074156822a96359", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6be5c241bbf8f3b6cec45f0b1074156822a96359/comments", "author": null, "committer": null, "parents": [{"sha": "7373d132e1f364cb3ee2a045b6319a866f1e7d86", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7373d132e1f364cb3ee2a045b6319a866f1e7d86", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7373d132e1f364cb3ee2a045b6319a866f1e7d86"}], "stats": {"total": 68, "additions": 65, "deletions": 3}, "files": [{"sha": "d1a9e3a5b13c9e5f47ec26bda3d81f41b59bd18c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6be5c241bbf8f3b6cec45f0b1074156822a96359", "patch": "@@ -1,3 +1,9 @@\n+2015-08-24  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR tree-optimization/65468\n+\t* omp-low.c (expand_omp_for_static_chunk): Remove inner loop if\n+\tchunk_size is one.\n+\n 2015-08-24  Nathan Sidwell  <nathan@acm.org>\n \n \t* config/nvptx/nvptx.c (walk_args_for_param): Revert previous"}, {"sha": "19f34ec4f07e0991cfe82b17fb0593506834ffba", "filename": "gcc/omp-low.c", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2Fomp-low.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2Fomp-low.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fomp-low.c?ref=6be5c241bbf8f3b6cec45f0b1074156822a96359", "patch": "@@ -7204,9 +7204,14 @@ expand_omp_for_static_chunk (struct omp_region *region,\n \t  assign_stmt = gimple_build_assign (vback, t);\n \t  gsi_insert_before (&gsi, assign_stmt, GSI_SAME_STMT);\n \n-\t  t = build2 (fd->loop.cond_code, boolean_type_node,\n-\t\t      DECL_P (vback) && TREE_ADDRESSABLE (vback)\n-\t\t      ? t : vback, e);\n+\t  if (tree_int_cst_equal (fd->chunk_size, integer_one_node))\n+\t    t = build2 (EQ_EXPR, boolean_type_node,\n+\t\t\tbuild_int_cst (itype, 0),\n+\t\t\tbuild_int_cst (itype, 1));\n+\t  else\n+\t    t = build2 (fd->loop.cond_code, boolean_type_node,\n+\t\t\tDECL_P (vback) && TREE_ADDRESSABLE (vback)\n+\t\t\t? t : vback, e);\n \t  gsi_insert_before (&gsi, gimple_build_cond_empty (t), GSI_SAME_STMT);\n \t}\n "}, {"sha": "36fc88ffa9a00399da40b8b42019b561127d6ff1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=6be5c241bbf8f3b6cec45f0b1074156822a96359", "patch": "@@ -1,3 +1,8 @@\n+2015-08-24  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR tree-optimization/65468\n+\t* gcc.dg/gomp/static-chunk-size-one.c: New test.\n+\n 2015-08-23  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR libfortran/54572"}, {"sha": "e82de772deb2693d4e09fd87fae91ea88bd87f5e", "filename": "gcc/testsuite/gcc.dg/gomp/static-chunk-size-one.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fstatic-chunk-size-one.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6be5c241bbf8f3b6cec45f0b1074156822a96359/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fstatic-chunk-size-one.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fgomp%2Fstatic-chunk-size-one.c?ref=6be5c241bbf8f3b6cec45f0b1074156822a96359", "patch": "@@ -0,0 +1,18 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fopenmp -O2 -fdump-tree-optimized -fno-tree-pre\" } */\n+\n+int\n+bar ()\n+{\n+  int a = 0, i;\n+\n+#pragma omp parallel for num_threads (3) reduction (+:a) schedule(static, 1)\n+  for (i = 0; i < 10; i++)\n+    a += i;\n+\n+  return a;\n+}\n+\n+/* Two phis for reduction, one in loop header, one in loop exit.  One phi for iv\n+   in loop header.  */\n+/* { dg-final { scan-tree-dump-times \"PHI\" 3 \"optimized\" } } */"}, {"sha": "43aaa524c2aaaddaae21063215c7b9b8ce9919c3", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6be5c241bbf8f3b6cec45f0b1074156822a96359/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6be5c241bbf8f3b6cec45f0b1074156822a96359/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=6be5c241bbf8f3b6cec45f0b1074156822a96359", "patch": "@@ -1,3 +1,8 @@\n+2015-08-24  Tom de Vries  <tom@codesourcery.com>\n+\n+\tPR tree-optimization/65468\n+\t* testsuite/libgomp.c/static-chunk-size-one.c: New test.\n+\n 2015-08-24  Joost VandeVondele  <vondele@gnu.gcc.org>\n \n \tPR libgomp/66761"}, {"sha": "9ed7b83625a51b5a3e4969ee0add9350442ed721", "filename": "libgomp/testsuite/libgomp.c/static-chunk-size-one.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6be5c241bbf8f3b6cec45f0b1074156822a96359/libgomp%2Ftestsuite%2Flibgomp.c%2Fstatic-chunk-size-one.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6be5c241bbf8f3b6cec45f0b1074156822a96359/libgomp%2Ftestsuite%2Flibgomp.c%2Fstatic-chunk-size-one.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fstatic-chunk-size-one.c?ref=6be5c241bbf8f3b6cec45f0b1074156822a96359", "patch": "@@ -0,0 +1,23 @@\n+extern void abort ();\n+\n+int\n+bar ()\n+{\n+  int a = 0, i;\n+\n+#pragma omp parallel for num_threads (3) reduction (+:a) schedule(static, 1)\n+  for (i = 0; i < 10; i++)\n+    a += i;\n+\n+  return a;\n+}\n+\n+int\n+main (void)\n+{\n+  int res;\n+  res = bar ();\n+  if (res != 45)\n+    abort ();\n+  return 0;\n+}"}]}