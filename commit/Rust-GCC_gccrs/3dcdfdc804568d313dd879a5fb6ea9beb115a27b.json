{"sha": "3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2RjZGZkYzgwNDU2OGQzMTNkZDg3OWE1ZmI2ZWE5YmViMTE1YTI3Yg==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2012-09-06T07:03:42Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2012-09-06T07:03:42Z"}, "message": "2012-09-06  Tobias Burnus\n\n        PR fortran/54463\n        * trans-intrinsic.c (gfc_conv_intrinsic_funcall): Fix matmul\n        call to BLAS if the default-kind has been promoted.\n\n2012-09-06  Tobias Burnus\n\n        PR fortran/54463\n        * gfortran.dg/promotion_2.f90: New.\n\nFrom-SVN: r191012", "tree": {"sha": "87ac2bee1b2f37f96da086a564cd75c146efa19d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/87ac2bee1b2f37f96da086a564cd75c146efa19d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/comments", "author": null, "committer": null, "parents": [{"sha": "a85cfff41dad8c074b624c6249ae7c2655033dca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a85cfff41dad8c074b624c6249ae7c2655033dca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a85cfff41dad8c074b624c6249ae7c2655033dca"}], "stats": {"total": 34, "additions": 30, "deletions": 4}, "files": [{"sha": "9b616c2af3a6025ed89e32bdba8ed272cc496aac", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "patch": "@@ -1,3 +1,9 @@\n+2012-09-06  Tobias Burnus\n+\n+\tPR fortran/54463\n+\t* trans-intrinsic.c (gfc_conv_intrinsic_funcall): Fix matmul\n+\tcall to BLAS if the default-kind has been promoted.\n+\n 2012-09-05  Tobias Burnus  <burnus@net-b.de>\n \n \tPR fortran/54462"}, {"sha": "4b268b34ba7aef26ab87137335fad15ed540b5bb", "filename": "gcc/fortran/trans-intrinsic.c", "status": "modified", "additions": 3, "deletions": 4, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ffortran%2Ftrans-intrinsic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ffortran%2Ftrans-intrinsic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-intrinsic.c?ref=3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "patch": "@@ -2362,21 +2362,20 @@ gfc_conv_intrinsic_funcall (gfc_se * se, gfc_expr * expr)\n \n       if (gfc_option.flag_external_blas\n \t  && (sym->ts.type == BT_REAL || sym->ts.type == BT_COMPLEX)\n-\t  && (sym->ts.kind == gfc_default_real_kind\n-\t      || sym->ts.kind == gfc_default_double_kind))\n+\t  && (sym->ts.kind == 4 || sym->ts.kind == 8))\n \t{\n \t  tree gemm_fndecl;\n \n \t  if (sym->ts.type == BT_REAL)\n \t    {\n-\t      if (sym->ts.kind == gfc_default_real_kind)\n+\t      if (sym->ts.kind == 4)\n \t\tgemm_fndecl = gfor_fndecl_sgemm;\n \t      else\n \t\tgemm_fndecl = gfor_fndecl_dgemm;\n \t    }\n \t  else\n \t    {\n-\t      if (sym->ts.kind == gfc_default_real_kind)\n+\t      if (sym->ts.kind == 4)\n \t\tgemm_fndecl = gfor_fndecl_cgemm;\n \t      else\n \t\tgemm_fndecl = gfor_fndecl_zgemm;"}, {"sha": "7089b59b1efefa70fea462b7b46356507701ed29", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "patch": "@@ -1,3 +1,8 @@\n+2012-09-06  Tobias Burnus\n+\n+\tPR fortran/54463\n+\t* gfortran.dg/promotion_2.f90: New.\n+\n 2012-09-05  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/54486"}, {"sha": "3acf249705c021d8a31e176b435a139ecb782f75", "filename": "gcc/testsuite/gfortran.dg/promotion_2.f90", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ftestsuite%2Fgfortran.dg%2Fpromotion_2.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3dcdfdc804568d313dd879a5fb6ea9beb115a27b/gcc%2Ftestsuite%2Fgfortran.dg%2Fpromotion_2.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fpromotion_2.f90?ref=3dcdfdc804568d313dd879a5fb6ea9beb115a27b", "patch": "@@ -0,0 +1,16 @@\n+! { dg-do compile }\n+! { dg-options \"-fdefault-real-8 -fexternal-blas -fdump-tree-original\" }\n+!\n+! PR fortran/54463\n+!\n+! Contributed by Simon Reinhardt\n+!\n+program test\n+  implicit none\n+  real, dimension(3,3) :: A\n+  A = matmul(A,A)\n+end program test\n+\n+! { dg-final { scan-tree-dump-times \"sgemm_\" 0 \"original\" } }\n+! { dg-final { scan-tree-dump-times \"dgemm_\" 1 \"original\" } }\n+! { dg-final { cleanup-tree-dump \"original\" } }"}]}