{"sha": "7c0de7535345f7d271c89d5121c7edfabd1e79f7", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2MwZGU3NTM1MzQ1ZjdkMjcxYzg5ZDUxMjFjN2VkZmFiZDFlNzlmNw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2012-09-29T17:38:46Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2012-09-29T17:38:46Z"}, "message": "re PR fortran/52724 (Internal read with character(kind=4) data)\n\n2012-09-29  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/52724\n\t* list_read.c (next_char):  Handle kind=4 characters.\n\t* unix.c (open_internal4):  Correct lenth of internal file.\n\n2012-09-29  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/52724\n\t* gfortran.dg/internal_readwrite_3.f90:  New test.\n\nFrom-SVN: r191854", "tree": {"sha": "ee47c83148e108305938eb2264d383e28dae885d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee47c83148e108305938eb2264d383e28dae885d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7c0de7535345f7d271c89d5121c7edfabd1e79f7", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0de7535345f7d271c89d5121c7edfabd1e79f7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c0de7535345f7d271c89d5121c7edfabd1e79f7", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c0de7535345f7d271c89d5121c7edfabd1e79f7/comments", "author": null, "committer": null, "parents": [{"sha": "df98376a391d42fa570b557391199b041abaeb42", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/df98376a391d42fa570b557391199b041abaeb42", "html_url": "https://github.com/Rust-GCC/gccrs/commit/df98376a391d42fa570b557391199b041abaeb42"}], "stats": {"total": 37, "additions": 33, "deletions": 4}, "files": [{"sha": "502ffdc511e584eb32022c3edc49ee65332d37ee", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de7535345f7d271c89d5121c7edfabd1e79f7/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de7535345f7d271c89d5121c7edfabd1e79f7/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7c0de7535345f7d271c89d5121c7edfabd1e79f7", "patch": "@@ -1,3 +1,8 @@\n+2012-09-29  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/52724\n+\t* gfortran.dg/internal_readwrite_3.f90:  New test.\n+\n 2012-09-28  Dodji Seketeli  <dodji@redhat.com>\n \n \t* g++.dg/warn/Wunused-local-typedefs-3.C: Move the c++-only test"}, {"sha": "279fac5a6d8429c6ab32e93bedccd60e02e839df", "filename": "gcc/testsuite/gfortran.dg/internal_readwrite_3.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de7535345f7d271c89d5121c7edfabd1e79f7/gcc%2Ftestsuite%2Fgfortran.dg%2Finternal_readwrite_3.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de7535345f7d271c89d5121c7edfabd1e79f7/gcc%2Ftestsuite%2Fgfortran.dg%2Finternal_readwrite_3.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finternal_readwrite_3.f90?ref=7c0de7535345f7d271c89d5121c7edfabd1e79f7", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do run }\n+! PR 52724 - this used to generate a \"Bad integer\" error.\n+program main\n+  implicit none\n+  integer :: i\n+  character(len=100,kind=4) :: buffer, a\n+  buffer = 4_\"123\"\n+  read(buffer,*) i \n+  write (a,'(I3)') i\n+  if (a /= 4_\"123\") call abort\n+end program main"}, {"sha": "feeb10a41462f5fd068e16a87a096de59f619fce", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de7535345f7d271c89d5121c7edfabd1e79f7/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de7535345f7d271c89d5121c7edfabd1e79f7/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=7c0de7535345f7d271c89d5121c7edfabd1e79f7", "patch": "@@ -1,3 +1,9 @@\n+2012-09-29  Thomas K\u00f6nig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/52724\n+\t* list_read.c (next_char):  Handle kind=4 characters.\n+\t* unix.c (open_internal4):  Correct lenth of internal file.\n+\n 2012-09-14  David Edelsohn  <dje.gcc@gmail.com>\n \n \t* configure: Regenerated."}, {"sha": "403e7190a1234ed5f010c534f0258821cd0a9e55", "filename": "libgfortran/io/list_read.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de7535345f7d271c89d5121c7edfabd1e79f7/libgfortran%2Fio%2Flist_read.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de7535345f7d271c89d5121c7edfabd1e79f7/libgfortran%2Fio%2Flist_read.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Flist_read.c?ref=7c0de7535345f7d271c89d5121c7edfabd1e79f7", "patch": "@@ -199,9 +199,16 @@ next_char (st_parameter_dt *dtp)\n \n   if (is_internal_unit (dtp))\n     {\n-      char cc;\n-      length = sread (dtp->u.p.current_unit->s, &cc, 1);\n-      c = cc;\n+      /* Check for kind=4 internal unit.  */\n+      if (dtp->common.unit)\n+       length = sread (dtp->u.p.current_unit->s, &c, sizeof (gfc_char4_t));\n+      else\n+       {\n+         char cc;\n+         length = sread (dtp->u.p.current_unit->s, &cc, 1);\n+         c = cc;\n+       }\n+\n       if (length < 0)\n \t{\n \t  generate_error (&dtp->common, LIBERROR_OS, NULL);"}, {"sha": "805d4bbd205f906825e9ceb83d2b6374bc855636", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c0de7535345f7d271c89d5121c7edfabd1e79f7/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c0de7535345f7d271c89d5121c7edfabd1e79f7/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=7c0de7535345f7d271c89d5121c7edfabd1e79f7", "patch": "@@ -959,7 +959,7 @@ open_internal4 (char *base, int length, gfc_offset offset)\n   s->buffer = base;\n   s->buffer_offset = offset;\n \n-  s->active = s->file_length = length;\n+  s->active = s->file_length = length * sizeof (gfc_char4_t);\n \n   s->st.vptr = &mem4_vtable;\n "}]}