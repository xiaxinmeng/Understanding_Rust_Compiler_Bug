{"sha": "a4166fe55334f1d4e1c2615792fca5b5ebc23eee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTQxNjZmZTU1MzM0ZjFkNGUxYzI2MTU3OTJmY2E1YjVlYmMyM2VlZQ==", "commit": {"author": {"name": "Toma Tabacu", "email": "toma.tabacu@imgtec.com", "date": "2017-02-07T10:34:47Z"}, "committer": {"name": "Toma Tabacu", "email": "tomtab@gcc.gnu.org", "date": "2017-02-07T10:34:47Z"}, "message": "MIPS: Fix mode mismatch error between Loongson builtin arguments and insn\noperands.\n\ngcc/\n\n\t* config/mips/mips.c (mips_expand_builtin_insn): Convert the QImode\n\targument of the pshufh, psllh, psllw, psrah, psraw, psrlh, psrlw\n\tbuiltins to SImode and emit a zero-extend, if necessary.\n\nFrom-SVN: r245243", "tree": {"sha": "e7dda8125e655d4fbed0778af7368dbd690e6bfe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e7dda8125e655d4fbed0778af7368dbd690e6bfe"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a4166fe55334f1d4e1c2615792fca5b5ebc23eee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4166fe55334f1d4e1c2615792fca5b5ebc23eee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a4166fe55334f1d4e1c2615792fca5b5ebc23eee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a4166fe55334f1d4e1c2615792fca5b5ebc23eee/comments", "author": null, "committer": null, "parents": [{"sha": "d95c2fc7b304314a03409f6e7cb7f7dd534b10a8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d95c2fc7b304314a03409f6e7cb7f7dd534b10a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d95c2fc7b304314a03409f6e7cb7f7dd534b10a8"}], "stats": {"total": 24, "additions": 24, "deletions": 0}, "files": [{"sha": "8affcaba43008db0b5edbeb74e647c874b954b7f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4166fe55334f1d4e1c2615792fca5b5ebc23eee/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4166fe55334f1d4e1c2615792fca5b5ebc23eee/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a4166fe55334f1d4e1c2615792fca5b5ebc23eee", "patch": "@@ -1,3 +1,9 @@\n+2017-02-07  Toma Tabacu  <toma.tabacu@imgtec.com>\n+\n+\t* config/mips/mips.c (mips_expand_builtin_insn): Convert the QImode\n+\targument of the pshufh, psllh, psllw, psrah, psraw, psrlh, psrlw\n+\tbuiltins to SImode and emit a zero-extend, if necessary.\n+\n 2017-02-06  Palmer Dabbelt  <palmer@dabbelt.com>\n \n \t* docs/invoke.texi (RISC-V Options): Alphabetize."}, {"sha": "7974a16541d50261e3a38e73ba299f0feb9201f4", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a4166fe55334f1d4e1c2615792fca5b5ebc23eee/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a4166fe55334f1d4e1c2615792fca5b5ebc23eee/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=a4166fe55334f1d4e1c2615792fca5b5ebc23eee", "patch": "@@ -16571,9 +16571,27 @@ mips_expand_builtin_insn (enum insn_code icode, unsigned int nops,\n {\n   machine_mode imode;\n   int rangelo = 0, rangehi = 0, error_opno = 0;\n+  rtx sireg;\n \n   switch (icode)\n     {\n+    /* The third operand of these instructions is in SImode, so we need to\n+       bring the corresponding builtin argument from QImode into SImode.  */\n+    case CODE_FOR_loongson_pshufh:\n+    case CODE_FOR_loongson_psllh:\n+    case CODE_FOR_loongson_psllw:\n+    case CODE_FOR_loongson_psrah:\n+    case CODE_FOR_loongson_psraw:\n+    case CODE_FOR_loongson_psrlh:\n+    case CODE_FOR_loongson_psrlw:\n+      gcc_assert (has_target_p && nops == 3 && ops[2].mode == QImode);\n+      sireg = gen_reg_rtx (SImode);\n+      emit_insn (gen_zero_extendqisi2 (sireg,\n+\t\t\t\t       force_reg (QImode, ops[2].value)));\n+      ops[2].value = sireg;\n+      ops[2].mode = SImode;\n+      break;\n+\n     case CODE_FOR_msa_addvi_b:\n     case CODE_FOR_msa_addvi_h:\n     case CODE_FOR_msa_addvi_w:"}]}