{"sha": "a9c283a506663a1bb97330a609a3c443043424b1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTljMjgzYTUwNjY2M2ExYmI5NzMzMGE2MDlhM2M0NDMwNDM0MjRiMQ==", "commit": {"author": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-08-18T13:44:00Z"}, "committer": {"name": "Steven Bosscher", "email": "steven@gcc.gnu.org", "date": "2012-08-18T13:44:00Z"}, "message": "sparseset.c (sparseset_alloc): Use non-clearing allocation.\n\n\t* sparseset.c (sparseset_alloc): Use non-clearing allocation.  Tell\n\tvalgrind not to worry about reading from unitialized memory.\n\nFrom-SVN: r190503", "tree": {"sha": "980b6b631fae3d1c10abb0b3a6d5cc8cc56d40b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/980b6b631fae3d1c10abb0b3a6d5cc8cc56d40b1"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a9c283a506663a1bb97330a609a3c443043424b1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9c283a506663a1bb97330a609a3c443043424b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a9c283a506663a1bb97330a609a3c443043424b1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a9c283a506663a1bb97330a609a3c443043424b1/comments", "author": null, "committer": null, "parents": [{"sha": "e0de76d8ada17851ca194da894f15f6f61cfd662", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0de76d8ada17851ca194da894f15f6f61cfd662", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0de76d8ada17851ca194da894f15f6f61cfd662"}], "stats": {"total": 15, "additions": 11, "deletions": 4}, "files": [{"sha": "2282536c1ab64d3f9890826ccb01371f060fcea7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9c283a506663a1bb97330a609a3c443043424b1/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9c283a506663a1bb97330a609a3c443043424b1/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a9c283a506663a1bb97330a609a3c443043424b1", "patch": "@@ -1,3 +1,8 @@\n+2012-08-18  Steven Bosscher  <steven@gcc.gnu.org>\n+\n+\t* sparseset.c (sparseset_alloc): Use non-clearing allocation.  Tell\n+\tvalgrind not to worry about reading from unitialized memory.\n+\n 2012-08-18  Steven Bosscher  <steven@gcc.gnu.org>\n \n \tPR middle-end/54313"}, {"sha": "35a2c3e1a3495a7e38641f6ede8aa8d0679858b8", "filename": "gcc/sparseset.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a9c283a506663a1bb97330a609a3c443043424b1/gcc%2Fsparseset.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a9c283a506663a1bb97330a609a3c443043424b1/gcc%2Fsparseset.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsparseset.c?ref=a9c283a506663a1bb97330a609a3c443043424b1", "patch": "@@ -30,12 +30,14 @@ sparseset_alloc (SPARSESET_ELT_TYPE n_elms)\n   unsigned int n_bytes = sizeof (struct sparseset_def)\n \t\t\t + ((n_elms - 1) * 2 * sizeof (SPARSESET_ELT_TYPE));\n \n-  /* We use xcalloc rather than xmalloc to silence some valgrind uninitialized\n+  sparseset set = XNEWVAR(struct sparseset_def, n_bytes);\n+\n+  /* Mark the sparseset as defined to silence some valgrind uninitialized\n      read errors when accessing set->sparse[n] when \"n\" is not, and never has\n      been, in the set.  These uninitialized reads are expected, by design and\n-     harmless.  If this turns into a performance problem due to some future\n-     additional users of sparseset, we can revisit this decision.  */\n-  sparseset set = (sparseset) xcalloc (1, n_bytes);\n+     harmless.  */\n+  VALGRIND_DISCARD (VALGRIND_MAKE_MEM_DEFINED (set, n_bytes));\n+\n   set->dense = &(set->elms[0]);\n   set->sparse = &(set->elms[n_elms]);\n   set->size = n_elms;"}]}