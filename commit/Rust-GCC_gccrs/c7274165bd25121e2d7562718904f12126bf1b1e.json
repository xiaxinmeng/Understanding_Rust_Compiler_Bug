{"sha": "c7274165bd25121e2d7562718904f12126bf1b1e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzcyNzQxNjViZDI1MTIxZTJkNzU2MjcxODkwNGYxMjEyNmJmMWIxZQ==", "commit": {"author": {"name": "Marek Polacek", "email": "polacek@redhat.com", "date": "2014-11-14T11:57:05Z"}, "committer": {"name": "Marek Polacek", "email": "mpolacek@gcc.gnu.org", "date": "2014-11-14T11:57:05Z"}, "message": "fold-const.c (fold_negate_expr): Don't fold INTEGER_CST if that overflows when SANITIZE_SI_OVERFLOW is on.\n\n\t* fold-const.c (fold_negate_expr): Don't fold INTEGER_CST if\n\tthat overflows when SANITIZE_SI_OVERFLOW is on.  Guard -(-A)\n\tfolding with TYPE_OVERFLOW_SANITIZED.\n\n\t* c-c++-common/ubsan/overflow-negate-3.c: New test.\n\nFrom-SVN: r217556", "tree": {"sha": "e658bdd67d7d906e29048429d363eaa3f48eaab0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e658bdd67d7d906e29048429d363eaa3f48eaab0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c7274165bd25121e2d7562718904f12126bf1b1e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7274165bd25121e2d7562718904f12126bf1b1e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c7274165bd25121e2d7562718904f12126bf1b1e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c7274165bd25121e2d7562718904f12126bf1b1e/comments", "author": {"login": "mpolacek", "id": 10496300, "node_id": "MDQ6VXNlcjEwNDk2MzAw", "avatar_url": "https://avatars.githubusercontent.com/u/10496300?v=4", "gravatar_id": "", "url": "https://api.github.com/users/mpolacek", "html_url": "https://github.com/mpolacek", "followers_url": "https://api.github.com/users/mpolacek/followers", "following_url": "https://api.github.com/users/mpolacek/following{/other_user}", "gists_url": "https://api.github.com/users/mpolacek/gists{/gist_id}", "starred_url": "https://api.github.com/users/mpolacek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/mpolacek/subscriptions", "organizations_url": "https://api.github.com/users/mpolacek/orgs", "repos_url": "https://api.github.com/users/mpolacek/repos", "events_url": "https://api.github.com/users/mpolacek/events{/privacy}", "received_events_url": "https://api.github.com/users/mpolacek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4088b790cc40b0fbcf12bafd1e3ef822c976a702", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4088b790cc40b0fbcf12bafd1e3ef822c976a702", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4088b790cc40b0fbcf12bafd1e3ef822c976a702"}], "stats": {"total": 38, "additions": 36, "deletions": 2}, "files": [{"sha": "976dd3bf51dabe3434d54fcbf82853b4310849e8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c7274165bd25121e2d7562718904f12126bf1b1e", "patch": "@@ -1,3 +1,9 @@\n+2014-11-14  Marek Polacek  <polacek@redhat.com>\n+\n+\t* fold-const.c (fold_negate_expr): Don't fold INTEGER_CST if\n+\tthat overflows when SANITIZE_SI_OVERFLOW is on.  Guard -(-A)\n+\tfolding with TYPE_OVERFLOW_SANITIZED.\n+\n 2014-11-14  Marek Polacek  <polacek@redhat.com>\n \n \tPR sanitizer/63839"}, {"sha": "7dbbadd859b30daa2ea910eedbad47fc7fd3ae8d", "filename": "gcc/fold-const.c", "status": "modified", "additions": 5, "deletions": 2, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=c7274165bd25121e2d7562718904f12126bf1b1e", "patch": "@@ -554,7 +554,8 @@ fold_negate_expr (location_t loc, tree t)\n     case INTEGER_CST:\n       tem = fold_negate_const (t, type);\n       if (TREE_OVERFLOW (tem) == TREE_OVERFLOW (t)\n-\t  || !TYPE_OVERFLOW_TRAPS (type))\n+\t  || (!TYPE_OVERFLOW_TRAPS (type)\n+\t      && (flag_sanitize & SANITIZE_SI_OVERFLOW) == 0))\n \treturn tem;\n       break;\n \n@@ -611,7 +612,9 @@ fold_negate_expr (location_t loc, tree t)\n       break;\n \n     case NEGATE_EXPR:\n-      return TREE_OPERAND (t, 0);\n+      if (!TYPE_OVERFLOW_SANITIZED (type))\n+\treturn TREE_OPERAND (t, 0);\n+      break;\n \n     case PLUS_EXPR:\n       if (!HONOR_SIGN_DEPENDENT_ROUNDING (TYPE_MODE (type))"}, {"sha": "b6a07d3fb1297d437b9ffce715f52107c9fe330c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c7274165bd25121e2d7562718904f12126bf1b1e", "patch": "@@ -1,3 +1,7 @@\n+2014-11-14  Marek Polacek  <polacek@redhat.com>\n+\n+\t* c-c++-common/ubsan/overflow-negate-3.c: New test.\n+\n 2014-11-14  Marek Polacek  <polacek@redhat.com>\n \n \tPR sanitizer/63839"}, {"sha": "e6db394a4f5d0cae0a7b867fae9ecd815b939ccd", "filename": "gcc/testsuite/c-c++-common/ubsan/overflow-negate-3.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Foverflow-negate-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c7274165bd25121e2d7562718904f12126bf1b1e/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Foverflow-negate-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fubsan%2Foverflow-negate-3.c?ref=c7274165bd25121e2d7562718904f12126bf1b1e", "patch": "@@ -0,0 +1,21 @@\n+/* { dg-do run } */\n+/* { dg-options \"-fsanitize=signed-integer-overflow\" } */\n+\n+#define INT_MIN (-__INT_MAX__ - 1)\n+\n+int\n+main ()\n+{\n+  int x = INT_MIN;\n+  int y;\n+  asm (\"\" : \"+g\" (x));\n+  y = -(-x);\n+  asm (\"\" : \"+g\" (y));\n+  y = -(-INT_MIN);\n+  asm (\"\" : \"+g\" (y));\n+}\n+\n+/* { dg-output \"negation of -2147483648 cannot be represented in type 'int'\\[^\\n\\r]*; cast to an unsigned type to negate this value to itself\\[^\\n\\r]*(\\n|\\r\\n|\\r)\" } */\n+/* { dg-output \"\\[^\\n\\r]*negation of -2147483648 cannot be represented in type 'int'\\[^\\n\\r]*; cast to an unsigned type to negate this value to itself\\[^\\n\\r]*(\\n|\\r\\n|\\r)\" } */\n+/* { dg-output \"\\[^\\n\\r]*negation of -2147483648 cannot be represented in type 'int'\\[^\\n\\r]*; cast to an unsigned type to negate this value to itself\\[^\\n\\r]*(\\n|\\r\\n|\\r)\" } */\n+/* { dg-output \"\\[^\\n\\r]*negation of -2147483648 cannot be represented in type 'int'\\[^\\n\\r]*; cast to an unsigned type to negate this value to itself\\[^\\n\\r]*(\\n|\\r\\n|\\r)\" } */"}]}