{"sha": "a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA4MmZjN2FmYzBlZWI2YWFmMzBmZmRjMWJiZjM2ZDQ4NTM4MTRhZA==", "commit": {"author": {"name": "Frank Ch. Eigler", "email": "fche@redhat.com", "date": "2004-07-20T20:00:56Z"}, "committer": {"name": "Frank Ch. Eigler", "email": "fche@gcc.gnu.org", "date": "2004-07-20T20:00:56Z"}, "message": "mf-impl.h (__mf_options): Add ignore_reads and timestamps fields.\n\n2004-07-20  Frank Ch. Eigler  <fche@redhat.com>\n\n\t* mf-impl.h (__mf_options): Add ignore_reads and timestamps fields.\n\t* mf-runtime.c (options): Give them a name.\n\t(__mf_set_default_options): Set them.\n\t(__mf_insert_new_object, __mfu_unregister): Optionalize timestamps.\n\t(__mf_violation): Warning cleanup.\n\t* mf-impl.h (MF_VALIDATE_EXTENT): Support ignore_reads option.\n\t* splay-tree.c (splay_tree_delete_helper): Remove obsolete decl.\n\nFrom-SVN: r84971", "tree": {"sha": "df6d56c256a656100ff79a37c174b4b0ce4893cc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/df6d56c256a656100ff79a37c174b4b0ce4893cc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/comments", "author": {"login": "fche", "id": 588885, "node_id": "MDQ6VXNlcjU4ODg4NQ==", "avatar_url": "https://avatars.githubusercontent.com/u/588885?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fche", "html_url": "https://github.com/fche", "followers_url": "https://api.github.com/users/fche/followers", "following_url": "https://api.github.com/users/fche/following{/other_user}", "gists_url": "https://api.github.com/users/fche/gists{/gist_id}", "starred_url": "https://api.github.com/users/fche/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fche/subscriptions", "organizations_url": "https://api.github.com/users/fche/orgs", "repos_url": "https://api.github.com/users/fche/repos", "events_url": "https://api.github.com/users/fche/events{/privacy}", "received_events_url": "https://api.github.com/users/fche/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9a55eab313314c6004a3833cd20df6e7f77d59ea", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a55eab313314c6004a3833cd20df6e7f77d59ea", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a55eab313314c6004a3833cd20df6e7f77d59ea"}], "stats": {"total": 39, "additions": 29, "deletions": 10}, "files": [{"sha": "5a6f2d2ba9d92c02e073725f1be4cd8d6efed79c", "filename": "libmudflap/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2FChangeLog?ref=a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "patch": "@@ -1,3 +1,13 @@\n+2004-07-20  Frank Ch. Eigler  <fche@redhat.com>\n+\n+\t* mf-impl.h (__mf_options): Add ignore_reads and timestamps fields.\n+\t* mf-runtime.c (options): Give them a name.\n+\t(__mf_set_default_options): Set them.\n+\t(__mf_insert_new_object, __mfu_unregister): Optionalize timestamps.\n+\t(__mf_violation): Warning cleanup.\n+\t* mf-impl.h (MF_VALIDATE_EXTENT): Support ignore_reads option.\n+\t* splay-tree.c (splay_tree_delete_helper): Remove obsolete decl.\n+\n 2004-07-15  Frank Ch. Eigler  <fche@redhat.com>\n \n \tg++/15861"}, {"sha": "55706c13dba7e70fdbb793f00ffaf247518ed707", "filename": "libmudflap/mf-impl.h", "status": "modified", "additions": 7, "deletions": 6, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2Fmf-impl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2Fmf-impl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Fmf-impl.h?ref=a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "patch": "@@ -133,9 +133,6 @@ struct __mf_options\n   /* Emit internal tracing message. */\n   unsigned verbose_trace;\n \n-  /* Support multiple threads.  XXX: not yet implemented. */\n-  /* unsigned multi_threaded; */\n-\n   /* Wipe stack/heap objects upon unwind.  */\n   unsigned wipe_stack;\n   unsigned wipe_heap;\n@@ -153,6 +150,12 @@ struct __mf_options\n   /* Maintain this many stack frames for contexts. */\n   unsigned backtrace;\n \n+  /* Ignore read operations even if mode_check is in effect.  */\n+  unsigned ignore_reads;\n+\n+  /* Collect register/unregister timestamps.  */\n+  unsigned timestamps;\n+\n #ifdef LIBMUDFLAPTH\n   /* Thread stack size.  */\n   unsigned thread_stack;\n@@ -168,9 +171,7 @@ struct __mf_options\n   }\n   mudflap_mode;\n \n-\n   /* How to handle a violation. */\n-\n   enum\n   {\n     viol_nop,        /* Return control to application. */ \n@@ -240,7 +241,6 @@ extern enum __mf_state_enum *__mf_state_perthread ();\n extern enum __mf_state_enum __mf_state;\n #endif\n extern int __mf_starting_p;\n-\n extern struct __mf_options __mf_opts;\n \n /* ------------------------------------------------------------------------ */\n@@ -355,6 +355,7 @@ ret __mfwrap_ ## fname (__VA_ARGS__)\n #define MF_VALIDATE_EXTENT(value,size,acc,context) \\\n  do { \\\n   if (UNLIKELY (size > 0 && __MF_CACHE_MISS_P (value, size))) \\\n+    if (acc == __MF_CHECK_WRITE || ! __mf_opts.ignore_reads) \\\n     __mf_check ((void *) (value), (size), acc, \"(\" context \")\"); \\\n  } while (0)\n #define BEGIN_PROTECT(fname, ...)       \\"}, {"sha": "486880cf3ce6d0b093eda21ce8c2651c8d7d85b2", "filename": "libmudflap/mf-runtime.c", "status": "modified", "additions": 12, "deletions": 3, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2Fmf-runtime.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2Fmf-runtime.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Fmf-runtime.c?ref=a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "patch": "@@ -237,6 +237,7 @@ __mf_set_default_options ()\n   __mf_opts.persistent_count = 100;\n   __mf_opts.crumple_zone = 32;\n   __mf_opts.backtrace = 4;\n+  __mf_opts.timestamps = 1;\n   __mf_opts.mudflap_mode = mode_check;\n   __mf_opts.violation_mode = viol_nop;\n   __mf_opts.heur_std_data = 1;\n@@ -313,6 +314,12 @@ options [] =\n     {\"abbreviate\", \n      \"abbreviate repetitive listings\",\n      set_option, 1, &__mf_opts.abbreviate},\n+    {\"timestamps\", \n+     \"track object lifetime timestamps\",\n+     set_option, 1, &__mf_opts.timestamps},\n+    {\"ignore-reads\", \n+     \"ignore read accesses - assume okay\",\n+     set_option, 1, &__mf_opts.ignore_reads},\n     {\"wipe-stack\",\n      \"wipe stack objects at unwind\",\n      set_option, 1, &__mf_opts.wipe_stack},\n@@ -917,7 +924,8 @@ __mf_insert_new_object (uintptr_t low, uintptr_t high, int type,\n   new_obj->name = name;\n   new_obj->alloc_pc = pc;\n #if HAVE_GETTIMEOFDAY\n-  gettimeofday (& new_obj->alloc_time, NULL);\n+  if (__mf_opts.timestamps)\n+    gettimeofday (& new_obj->alloc_time, NULL);\n #endif\n #if LIBMUDFLAPTH\n   new_obj->alloc_thread = pthread_self ();\n@@ -1157,7 +1165,8 @@ __mfu_unregister (void *ptr, size_t sz, int type)\n             old_obj->deallocated_p = 1;\n             old_obj->dealloc_pc = (uintptr_t) __builtin_return_address (0);\n #if HAVE_GETTIMEOFDAY\n-            gettimeofday (& old_obj->dealloc_time, NULL);\n+            if (__mf_opts.timestamps)\n+              gettimeofday (& old_obj->dealloc_time, NULL);\n #endif\n #ifdef LIBMUDFLAPTH\n             old_obj->dealloc_thread = pthread_self ();\n@@ -1843,7 +1852,7 @@ __mf_violation (void *ptr, size_t sz, uintptr_t pc,\n   {\n     unsigned dead_p;\n     unsigned num_helpful = 0;\n-    struct timeval now;\n+    struct timeval now = { 0, 0 };\n #if HAVE_GETTIMEOFDAY\n     gettimeofday (& now, NULL);\n #endif"}, {"sha": "cbd4bfb0cf38c88d3b1421b36e62ab099b7547af", "filename": "libmudflap/splay-tree.c", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2Fsplay-tree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad/libmudflap%2Fsplay-tree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libmudflap%2Fsplay-tree.c?ref=a082fc7afc0eeb6aaf30ffdc1bbf36d4853814ad", "patch": "@@ -39,7 +39,6 @@ Boston, MA 02111-1307, USA.  */\n #include \"splay-tree.h\"\n \n \n-static void splay_tree_delete_helper (splay_tree, splay_tree_node);\n static void splay_tree_splay (splay_tree, splay_tree_key);\n static splay_tree_node splay_tree_splay_helper (splay_tree,\n                                                 splay_tree_key,"}]}