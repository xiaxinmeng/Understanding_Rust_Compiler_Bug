{"sha": "154c16575f0f10392d3798f6470eb0951084ea6c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTU0YzE2NTc1ZjBmMTAzOTJkMzc5OGY2NDcwZWIwOTUxMDg0ZWE2Yw==", "commit": {"author": {"name": "Hristian Kirtchev", "email": "kirtchev@adacore.com", "date": "2007-08-14T08:47:45Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2007-08-14T08:47:45Z"}, "message": "g-catiio.adb (Image): For the case of %s...\n\n2007-08-14  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* g-catiio.adb (Image): For the case of %s, use Ada.Calendar.Time\n\tvalues to compute the number of seconds since the Unix Epoc in order to\n\taccount for Daylight Savings Time. Perform special processing for dates\n\tthat are earlier than the Unix Epoc to obtain a negative number.\n\nFrom-SVN: r127450", "tree": {"sha": "a400013a9a93fbd7182e987420beb5dc83c31ca0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a400013a9a93fbd7182e987420beb5dc83c31ca0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/154c16575f0f10392d3798f6470eb0951084ea6c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/154c16575f0f10392d3798f6470eb0951084ea6c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/154c16575f0f10392d3798f6470eb0951084ea6c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/154c16575f0f10392d3798f6470eb0951084ea6c/comments", "author": {"login": "kirtchev-adacore", "id": 60669983, "node_id": "MDQ6VXNlcjYwNjY5OTgz", "avatar_url": "https://avatars.githubusercontent.com/u/60669983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/kirtchev-adacore", "html_url": "https://github.com/kirtchev-adacore", "followers_url": "https://api.github.com/users/kirtchev-adacore/followers", "following_url": "https://api.github.com/users/kirtchev-adacore/following{/other_user}", "gists_url": "https://api.github.com/users/kirtchev-adacore/gists{/gist_id}", "starred_url": "https://api.github.com/users/kirtchev-adacore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/kirtchev-adacore/subscriptions", "organizations_url": "https://api.github.com/users/kirtchev-adacore/orgs", "repos_url": "https://api.github.com/users/kirtchev-adacore/repos", "events_url": "https://api.github.com/users/kirtchev-adacore/events{/privacy}", "received_events_url": "https://api.github.com/users/kirtchev-adacore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "bfc2cdb1e73647b7f9a53649a63623f91b2c3207", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bfc2cdb1e73647b7f9a53649a63623f91b2c3207", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bfc2cdb1e73647b7f9a53649a63623f91b2c3207"}], "stats": {"total": 32, "additions": 25, "deletions": 7}, "files": [{"sha": "5286ef034d1855a17eb434d96ea0c301e2df49ed", "filename": "gcc/ada/g-catiio.adb", "status": "modified", "additions": 25, "deletions": 7, "changes": 32, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/154c16575f0f10392d3798f6470eb0951084ea6c/gcc%2Fada%2Fg-catiio.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/154c16575f0f10392d3798f6470eb0951084ea6c/gcc%2Fada%2Fg-catiio.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fg-catiio.adb?ref=154c16575f0f10392d3798f6470eb0951084ea6c", "patch": "@@ -306,15 +306,33 @@ package body GNAT.Calendar.Time_IO is\n \n                when 's' =>\n                   declare\n-                     Sec : constant Sec_Number :=\n-                             Sec_Number (Julian_Day (Year, Month, Day)\n-                                          - Julian_Day (1970, 1, 1)) * 86_400\n-                                          + Sec_Number (Hour) * 3_600\n-                                          + Sec_Number (Minute) * 60\n-                                          + Sec_Number (Second);\n+                     --  Compute the number of seconds using Ada.Calendar.Time\n+                     --  values rather than Julian days to account for Daylight\n+                     --  Savings Time.\n+\n+                     Neg : Boolean  := False;\n+                     Sec : Duration := Date - Time_Of (1970, 1, 1, 0.0);\n \n                   begin\n-                     Result := Result & Image (Sec, None);\n+                     --  Avoid rounding errors and perform special processing\n+                     --  for dates earlier than the Unix Epoc.\n+\n+                     if Sec > 0.0 then\n+                        Sec := Sec - 0.5;\n+                     elsif Sec < 0.0 then\n+                        Neg := True;\n+                        Sec := abs (Sec + 0.5);\n+                     end if;\n+\n+                     --  Prepend a minus sign to the result since Sec_Number\n+                     --  cannot handle negative numbers.\n+\n+                     if Neg then\n+                        Result :=\n+                          Result & \"-\" & Image (Sec_Number (Sec), None);\n+                     else\n+                        Result := Result & Image (Sec_Number (Sec), None);\n+                     end if;\n                   end;\n \n                --  Second (00..59)"}]}