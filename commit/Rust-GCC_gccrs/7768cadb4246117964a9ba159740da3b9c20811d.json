{"sha": "7768cadb4246117964a9ba159740da3b9c20811d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzc2OGNhZGI0MjQ2MTE3OTY0YTliYTE1OTc0MGRhM2I5YzIwODExZA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-02-17T14:03:25Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2021-02-17T14:03:25Z"}, "message": "c++: Fix up build_zero_init_1 once more [PR99106]\n\nMy earlier build_zero_init_1 patch for flexible array members created\nan empty CONSTRUCTOR.  As the following testcase shows, that doesn't work\nvery well because the middle-end doesn't expect CONSTRUCTOR elements with\nincomplete type (that the empty CONSTRUCTOR at the end of outer CONSTRUCTOR\nhad).\n\nThe following patch just doesn't add any CONSTRUCTOR for the flexible array\nmembers, it doesn't seem to be needed.\n\n2021-02-17  Jakub Jelinek  <jakub@redhat.com>\n\n\tPR sanitizer/99106\n\t* init.c (build_zero_init_1): For flexible array members just return\n\tNULL_TREE instead of returning empty CONSTRUCTOR with non-complete\n\tARRAY_TYPE.\n\n\t* g++.dg/ubsan/pr99106.C: New test.", "tree": {"sha": "a5ef82c8b672c78519d208ad9fe4e17c3d7539e0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a5ef82c8b672c78519d208ad9fe4e17c3d7539e0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7768cadb4246117964a9ba159740da3b9c20811d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7768cadb4246117964a9ba159740da3b9c20811d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7768cadb4246117964a9ba159740da3b9c20811d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7768cadb4246117964a9ba159740da3b9c20811d/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "24bf79f1798ad1d64812709001d2d11cd3e6849f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/24bf79f1798ad1d64812709001d2d11cd3e6849f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/24bf79f1798ad1d64812709001d2d11cd3e6849f"}], "stats": {"total": 7, "additions": 6, "deletions": 1}, "files": [{"sha": "7d598f6196de0c98304f1a831224993119424615", "filename": "gcc/cp/init.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7768cadb4246117964a9ba159740da3b9c20811d/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7768cadb4246117964a9ba159740da3b9c20811d/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=7768cadb4246117964a9ba159740da3b9c20811d", "patch": "@@ -252,7 +252,7 @@ build_zero_init_1 (tree type, tree nelts, bool static_storage_p,\n \t\t\t\t     build_one_cst (TREE_TYPE (nelts)));\n       /* Treat flexible array members like [0] arrays.  */\n       else if (TYPE_DOMAIN (type) == NULL_TREE)\n-\tmax_index = build_minus_one_cst (sizetype);\n+\treturn NULL_TREE;\n       else\n \tmax_index = array_type_nelts (type);\n "}, {"sha": "ccb48a96f4b173baeaf328f84fa320aaeb9c4368", "filename": "gcc/testsuite/g++.dg/ubsan/pr99106.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7768cadb4246117964a9ba159740da3b9c20811d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr99106.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7768cadb4246117964a9ba159740da3b9c20811d/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr99106.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fubsan%2Fpr99106.C?ref=7768cadb4246117964a9ba159740da3b9c20811d", "patch": "@@ -0,0 +1,5 @@\n+// PR sanitizer/99106\n+// { dg-do compile }\n+// { dg-options \"-fsanitize=undefined\" }\n+\n+#include \"../ext/flexary38.C\""}]}