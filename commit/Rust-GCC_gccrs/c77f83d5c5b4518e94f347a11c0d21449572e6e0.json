{"sha": "c77f83d5c5b4518e94f347a11c0d21449572e6e0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Yzc3ZjgzZDVjNWI0NTE4ZTk0ZjM0N2ExMWMwZDIxNDQ5NTcyZTZlMA==", "commit": {"author": {"name": "Edgar E. Iglesias", "email": "edgar.iglesias@gmail.com", "date": "2013-02-19T23:10:29Z"}, "committer": {"name": "Michael Eager", "email": "eager@gcc.gnu.org", "date": "2013-02-19T23:10:29Z"}, "message": "Add support for the CLZ insn\n\nAdd support for the CLZ insn\n* config/microblaze/microblaze.c: microblaze_has_clz = 0\nAdd version check for v8.10.a to enable microblaze_has_clz\n* config/microblaze/microblaze.h: Add TARGET_HAS_CLZ as\ncombined version and TARGET_PATTERN_COMPARE check\n* config/microblaze/microblaze.md: New clzsi2 instruction\n\nFrom-SVN: r196158", "tree": {"sha": "d01e4f8df96134d3deb0ab4146fe10868c34ce6a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d01e4f8df96134d3deb0ab4146fe10868c34ce6a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c77f83d5c5b4518e94f347a11c0d21449572e6e0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c77f83d5c5b4518e94f347a11c0d21449572e6e0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c77f83d5c5b4518e94f347a11c0d21449572e6e0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c77f83d5c5b4518e94f347a11c0d21449572e6e0/comments", "author": {"login": "edgarigl", "id": 86901, "node_id": "MDQ6VXNlcjg2OTAx", "avatar_url": "https://avatars.githubusercontent.com/u/86901?v=4", "gravatar_id": "", "url": "https://api.github.com/users/edgarigl", "html_url": "https://github.com/edgarigl", "followers_url": "https://api.github.com/users/edgarigl/followers", "following_url": "https://api.github.com/users/edgarigl/following{/other_user}", "gists_url": "https://api.github.com/users/edgarigl/gists{/gist_id}", "starred_url": "https://api.github.com/users/edgarigl/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/edgarigl/subscriptions", "organizations_url": "https://api.github.com/users/edgarigl/orgs", "repos_url": "https://api.github.com/users/edgarigl/repos", "events_url": "https://api.github.com/users/edgarigl/events{/privacy}", "received_events_url": "https://api.github.com/users/edgarigl/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "959434e6ba489bceb258ae02936e789be894d0e7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/959434e6ba489bceb258ae02936e789be894d0e7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/959434e6ba489bceb258ae02936e789be894d0e7"}], "stats": {"total": 32, "additions": 32, "deletions": 0}, "files": [{"sha": "f6d5312fbcfd267bb19a302654c056cc151701bb", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=c77f83d5c5b4518e94f347a11c0d21449572e6e0", "patch": "@@ -1,3 +1,10 @@\n+2012-02-19  Edgar E. Iglesias <edgar.iglesias@gmail.com>\n+\t* config/microblaze/microblaze.c: microblaze_has_clz = 0\n+\tAdd version check for v8.10.a to enable microblaze_has_clz\n+\t* config/microblaze/microblaze.h: Add TARGET_HAS_CLZ as combined \n+\tversion and TARGET_PATTERN_COMPARE check\n+\t* config/microblaze/microblaze.md: New clzsi2 instruction\n+\t\n 2012-02-19  Edgar E. Iglesias <edgar.iglesias@gmail.com>\n \n \t*  config/microblaze/microblaze.md (call_value_intern): Check symbol is "}, {"sha": "fc0296e2c15fccf39e3b3a7eca74f73604d9e989", "filename": "gcc/config/microblaze/microblaze.c", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.c?ref=c77f83d5c5b4518e94f347a11c0d21449572e6e0", "patch": "@@ -143,6 +143,9 @@ int microblaze_section_threshold = -1;\n    delay slots.  -mcpu=v3.00.a or v4.00.a turns this on.  */\n int microblaze_no_unsafe_delay;\n \n+/* Set to one if the targeted core has the CLZ insn.  */\n+int microblaze_has_clz = 0;\n+\n /* Which CPU pipeline do we use. We haven't really standardized on a CPU \n    version having only a particular type of pipeline. There can still be \n    options on the CPU to scale pipeline features up or down. :( \n@@ -1369,6 +1372,14 @@ microblaze_option_override (void)\n \t\t \"-mxl-multiply-high can be used only with -mcpu=v6.00.a or greater\");\n     }\n \n+  ver = MICROBLAZE_VERSION_COMPARE (microblaze_select_cpu, \"v8.10.a\");\n+  microblaze_has_clz = 1;\n+  if (ver < 0)\n+    {\n+        /* MicroBlaze prior to 8.10.a didn't have clz.  */\n+        microblaze_has_clz = 0;\n+    }\n+\n   if (TARGET_MULTIPLY_HIGH && TARGET_SOFT_MUL)\n     error (\"-mxl-multiply-high requires -mno-xl-soft-mul\");\n "}, {"sha": "a188a2eb1137c97d1c0aad30429c56cc69b3265b", "filename": "gcc/config/microblaze/microblaze.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.h?ref=c77f83d5c5b4518e94f347a11c0d21449572e6e0", "patch": "@@ -42,6 +42,7 @@ extern int microblaze_section_threshold;\n extern int microblaze_dbx_regno[];\n \n extern int microblaze_no_unsafe_delay;\n+extern int microblaze_has_clz;\n extern enum pipeline_type microblaze_pipe;\n \n #define OBJECT_FORMAT_ELF\n@@ -58,6 +59,9 @@ extern enum pipeline_type microblaze_pipe;\n #define TARGET_DEFAULT      (MASK_SOFT_MUL | MASK_SOFT_DIV | MASK_SOFT_FLOAT \\\n                              | TARGET_ENDIAN_DEFAULT)\n \n+/* Do we have CLZ?  */\n+#define TARGET_HAS_CLZ      (TARGET_PATTERN_COMPARE && microblaze_has_clz)\n+\n /* The default is to support PIC.  */\n #define TARGET_SUPPORTS_PIC 1\n "}, {"sha": "1b4200307cb6b7474126affa778eba6881ee88f7", "filename": "gcc/config/microblaze/microblaze.md", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c77f83d5c5b4518e94f347a11c0d21449572e6e0/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmicroblaze%2Fmicroblaze.md?ref=c77f83d5c5b4518e94f347a11c0d21449572e6e0", "patch": "@@ -2200,3 +2200,13 @@\n   [(set_attr \"type\" \"multi\")\n    (set_attr \"length\" \"12\")])\n \n+;; This insn gives the count of leading number of zeros for the second\n+;; operand and stores the result in first operand.\n+(define_insn \"clzsi2\"\n+  [(set (match_operand:SI 0 \"register_operand\" \"=r\")\n+        (clz:SI (match_operand:SI 1 \"register_operand\" \"r\")))]\n+  \"TARGET_HAS_CLZ\"\n+  \"clz\\t%0,%1\"\n+  [(set_attr \"type\"     \"arith\")\n+  (set_attr \"mode\"      \"SI\")\n+  (set_attr \"length\"    \"4\")])"}]}