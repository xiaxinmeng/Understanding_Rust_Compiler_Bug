{"sha": "368877a11b789a74b1ae5b878e3bd30039118c30", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzY4ODc3YTExYjc4OWE3NGIxYWU1Yjg3OGUzYmQzMDAzOTExOGMzMA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2019-12-11T19:06:39Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2019-12-11T19:06:39Z"}, "message": "Introduce pretty_printer::clone vfunc\n\nThis patch provides a way to clone a pretty_printer.\n\nThis is needed so that we can capture text in a label_text and make\nlayout decisions based on it, using the policy of global_dc's printer,\nwhilst within a call to diagnostic_show_locus.  We can't print with\nthe pretty_printer itself within a call to diagnostic_show_locus since\nit has partly-buffered content.\n\ngcc/c-family/ChangeLog:\n\t* c-pretty-print.c (c_pretty_printer::clone): New vfunc\n\timplementation.\n\t* c-pretty-print.h (c_pretty_printer::clone): New vfunc decl.\n\ngcc/cp/ChangeLog:\n\t* cxx-pretty-print.c (cxx_pretty_printer::clone): New vfunc\n\timplementation.\n\t* cxx-pretty-print.h (cxx_pretty_printer::clone): New vfunc decl.\n\t* error.c (cxx_format_postprocessor::clone): New vfunc.\n\ngcc/ChangeLog:\n\t* pretty-print.c (pretty_printer::pretty_printer): New copy-ctor.\n\t(pretty_printer::clone): New vfunc implementation.\n\t* pretty-print.h (format_postprocessor::clone): New pure vfunc\n\tdecl.\n\t(pretty_printer::pretty_printer): New copy-ctor decl.\n\t(pretty_printer::clone): New vfunc decl.\n\nFrom-SVN: r279244", "tree": {"sha": "616fe464613c54fdd3f9145a99dc1e15724d8745", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/616fe464613c54fdd3f9145a99dc1e15724d8745"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/368877a11b789a74b1ae5b878e3bd30039118c30", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/368877a11b789a74b1ae5b878e3bd30039118c30", "html_url": "https://github.com/Rust-GCC/gccrs/commit/368877a11b789a74b1ae5b878e3bd30039118c30", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/368877a11b789a74b1ae5b878e3bd30039118c30/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "34a53788fec49e0a85bd32b51b057cfaae0200c8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/34a53788fec49e0a85bd32b51b057cfaae0200c8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/34a53788fec49e0a85bd32b51b057cfaae0200c8"}], "stats": {"total": 83, "additions": 83, "deletions": 0}, "files": [{"sha": "747b04dd5f2ec13614031971002cdb4473d151e5", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -1,3 +1,12 @@\n+2019-12-11  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* pretty-print.c (pretty_printer::pretty_printer): New copy-ctor.\n+\t(pretty_printer::clone): New vfunc implementation.\n+\t* pretty-print.h (format_postprocessor::clone): New pure vfunc\n+\tdecl.\n+\t(pretty_printer::pretty_printer): New copy-ctor decl.\n+\t(pretty_printer::clone): New vfunc decl.\n+\n 2019-12-11  David Malcolm  <dmalcolm@redhat.com>\n \n \t* function-tests.c (selftest::make_fndecl): Make non-static."}, {"sha": "b264c38177f9a974cd899583bb1944344e316e8d", "filename": "gcc/c-family/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fc-family%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fc-family%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2FChangeLog?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -1,3 +1,9 @@\n+2019-12-11  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* c-pretty-print.c (c_pretty_printer::clone): New vfunc\n+\timplementation.\n+\t* c-pretty-print.h (c_pretty_printer::clone): New vfunc decl.\n+\n 2019-12-09  David Malcolm  <dmalcolm@redhat.com>\n \n \t* c-format.c (range_label_for_format_type_mismatch::get_text):"}, {"sha": "e5e898a6253c103b1f0f78c292c553757b02f7cd", "filename": "gcc/c-family/c-pretty-print.c", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fc-family%2Fc-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fc-family%2Fc-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-pretty-print.c?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -2372,6 +2372,13 @@ c_pretty_printer::c_pretty_printer ()\n   parameter_list            = pp_c_parameter_type_list;\n }\n \n+/* c_pretty_printer's implementation of pretty_printer::clone vfunc.  */\n+\n+pretty_printer *\n+c_pretty_printer::clone () const\n+{\n+  return new c_pretty_printer (*this);\n+}\n \n /* Print the tree T in full, on file FILE.  */\n "}, {"sha": "df21e212734b3b7360e6d78c15c5b411d9c87566", "filename": "gcc/c-family/c-pretty-print.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fc-family%2Fc-pretty-print.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fc-family%2Fc-pretty-print.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-family%2Fc-pretty-print.h?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -51,6 +51,7 @@ class c_pretty_printer : public pretty_printer\n {\n public:\n   c_pretty_printer ();\n+  pretty_printer *clone () const OVERRIDE;\n \n   // Format string, possibly translated.\n   void translate_string (const char *);"}, {"sha": "202bb6cd0b1d721831a9e3415e3e09758ed7291b", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -1,3 +1,10 @@\n+2019-12-11  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* cxx-pretty-print.c (cxx_pretty_printer::clone): New vfunc\n+\timplementation.\n+\t* cxx-pretty-print.h (cxx_pretty_printer::clone): New vfunc decl.\n+\t* error.c (cxx_format_postprocessor::clone): New vfunc.\n+\n 2019-12-11  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/92869"}, {"sha": "b14aa9640df22bcb1e6c2a71096ba2502f02196e", "filename": "gcc/cp/cxx-pretty-print.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2Fcxx-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2Fcxx-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcxx-pretty-print.c?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -2968,3 +2968,11 @@ cxx_pretty_printer::cxx_pretty_printer ()\n   type_specifier_seq = (pp_fun) pp_cxx_type_specifier_seq;\n   parameter_list = (pp_fun) pp_cxx_parameter_declaration_clause;\n }\n+\n+/* cxx_pretty_printer's implementation of pretty_printer::clone vfunc.  */\n+\n+pretty_printer *\n+cxx_pretty_printer::clone () const\n+{\n+  return new cxx_pretty_printer (*this);\n+}"}, {"sha": "dd96226ae0bc2609ef07d91246474db6da382092", "filename": "gcc/cp/cxx-pretty-print.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2Fcxx-pretty-print.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2Fcxx-pretty-print.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcxx-pretty-print.h?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -34,6 +34,8 @@ class cxx_pretty_printer : public c_pretty_printer\n public:\n   cxx_pretty_printer ();\n \n+  pretty_printer *clone () const OVERRIDE;\n+\n   void constant (tree);\n   void id_expression (tree);\n   void primary_expression (tree);"}, {"sha": "298030baf2164fb9e82b29fb9936a10474e47166", "filename": "gcc/cp/error.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2Ferror.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fcp%2Ferror.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ferror.c?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -143,6 +143,11 @@ class cxx_format_postprocessor : public format_postprocessor\n   : m_type_a (), m_type_b ()\n   {}\n \n+  format_postprocessor *clone() const FINAL OVERRIDE\n+  {\n+    return new cxx_format_postprocessor ();\n+  }\n+\n   void handle (pretty_printer *pp) FINAL OVERRIDE;\n \n   deferred_printed_type m_type_a;"}, {"sha": "084e03c73c781ce2b1e93efa3c5b487524b547b3", "filename": "gcc/pretty-print.c", "status": "modified", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fpretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fpretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpretty-print.c?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -1590,6 +1590,32 @@ pretty_printer::pretty_printer (int maximum_length)\n   pp_set_prefix (this, NULL);\n }\n \n+/* Copy constructor for pretty_printer.  */\n+\n+pretty_printer::pretty_printer (const pretty_printer &other)\n+: buffer (new (XCNEW (output_buffer)) output_buffer ()),\n+  prefix (),\n+  padding (other.padding),\n+  maximum_length (other.maximum_length),\n+  indent_skip (other.indent_skip),\n+  wrapping (other.wrapping),\n+  format_decoder (other.format_decoder),\n+  m_format_postprocessor (NULL),\n+  emitted_prefix (other.emitted_prefix),\n+  need_newline (other.need_newline),\n+  translate_identifiers (other.translate_identifiers),\n+  show_color (other.show_color),\n+  show_urls (other.show_urls)\n+{\n+  pp_line_cutoff (this) = maximum_length;\n+  /* By default, we emit prefixes once per message.  */\n+  pp_prefixing_rule (this) = pp_prefixing_rule (&other);\n+  pp_set_prefix (this, NULL);\n+\n+  if (other.m_format_postprocessor)\n+    m_format_postprocessor = other.m_format_postprocessor->clone ();\n+}\n+\n pretty_printer::~pretty_printer ()\n {\n   if (m_format_postprocessor)\n@@ -1599,6 +1625,14 @@ pretty_printer::~pretty_printer ()\n   free (prefix);\n }\n \n+/* Base class implementation of pretty_printer::clone vfunc.  */\n+\n+pretty_printer *\n+pretty_printer::clone () const\n+{\n+  return new pretty_printer (*this);\n+}\n+\n /* Append a string delimited by START and END to the output area of\n    PRETTY-PRINTER.  No line wrapping is done.  However, if beginning a\n    new line then emit PRETTY-PRINTER's prefix and skip any leading"}, {"sha": "493507d41419e9065afb8d4fbe04f4e976da67a1", "filename": "gcc/pretty-print.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fpretty-print.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/368877a11b789a74b1ae5b878e3bd30039118c30/gcc%2Fpretty-print.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fpretty-print.h?ref=368877a11b789a74b1ae5b878e3bd30039118c30", "patch": "@@ -192,6 +192,7 @@ class format_postprocessor\n {\n  public:\n   virtual ~format_postprocessor () {}\n+  virtual format_postprocessor *clone() const = 0;\n   virtual void handle (pretty_printer *) = 0;\n };\n \n@@ -221,9 +222,12 @@ class pretty_printer\n   /* Default construct a pretty printer with specified\n      maximum line length cut off limit.  */\n   explicit pretty_printer (int = 0);\n+  explicit pretty_printer (const pretty_printer &other);\n \n   virtual ~pretty_printer ();\n \n+  virtual pretty_printer *clone () const;\n+\n   /* Where we print external representation of ENTITY.  */\n   output_buffer *buffer;\n "}]}