{"sha": "eccc7c8cbfda3d8b6210543127b000d028631b6b", "node_id": "C_kwDOANBUbNoAKGVjY2M3YzhjYmZkYTNkOGI2MjEwNTQzMTI3YjAwMGQwMjg2MzFiNmI", "commit": {"author": {"name": "Richard Kenner", "email": "kenner@adacore.com", "date": "2021-11-22T22:38:50Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "derodat@adacore.com", "date": "2021-12-02T16:26:23Z"}, "message": "[Ada] Don't allow entry in implicit with chain to be ghost\n\ngcc/ada/\n\n\t* rtsfind.adb (Maybe_Add_With): Ensure that the added \"with\" is\n\tnever marked as ignored ghost code.", "tree": {"sha": "1b0f72b906c94ee360b74a3b57d3b140284a756c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1b0f72b906c94ee360b74a3b57d3b140284a756c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/eccc7c8cbfda3d8b6210543127b000d028631b6b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eccc7c8cbfda3d8b6210543127b000d028631b6b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/eccc7c8cbfda3d8b6210543127b000d028631b6b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/eccc7c8cbfda3d8b6210543127b000d028631b6b/comments", "author": {"login": "richardkenner", "id": 56170968, "node_id": "MDQ6VXNlcjU2MTcwOTY4", "avatar_url": "https://avatars.githubusercontent.com/u/56170968?v=4", "gravatar_id": "", "url": "https://api.github.com/users/richardkenner", "html_url": "https://github.com/richardkenner", "followers_url": "https://api.github.com/users/richardkenner/followers", "following_url": "https://api.github.com/users/richardkenner/following{/other_user}", "gists_url": "https://api.github.com/users/richardkenner/gists{/gist_id}", "starred_url": "https://api.github.com/users/richardkenner/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/richardkenner/subscriptions", "organizations_url": "https://api.github.com/users/richardkenner/orgs", "repos_url": "https://api.github.com/users/richardkenner/repos", "events_url": "https://api.github.com/users/richardkenner/events{/privacy}", "received_events_url": "https://api.github.com/users/richardkenner/received_events", "type": "User", "site_admin": false}, "committer": {"login": "pmderodat", "id": 758452, "node_id": "MDQ6VXNlcjc1ODQ1Mg==", "avatar_url": "https://avatars.githubusercontent.com/u/758452?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pmderodat", "html_url": "https://github.com/pmderodat", "followers_url": "https://api.github.com/users/pmderodat/followers", "following_url": "https://api.github.com/users/pmderodat/following{/other_user}", "gists_url": "https://api.github.com/users/pmderodat/gists{/gist_id}", "starred_url": "https://api.github.com/users/pmderodat/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pmderodat/subscriptions", "organizations_url": "https://api.github.com/users/pmderodat/orgs", "repos_url": "https://api.github.com/users/pmderodat/repos", "events_url": "https://api.github.com/users/pmderodat/events{/privacy}", "received_events_url": "https://api.github.com/users/pmderodat/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ea7f9e0530251152b5e6a99f36515032f318c4d1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ea7f9e0530251152b5e6a99f36515032f318c4d1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ea7f9e0530251152b5e6a99f36515032f318c4d1"}], "stats": {"total": 14, "additions": 11, "deletions": 3}, "files": [{"sha": "0c3a04369f4052902b1c4877986f82bc9cf6a32e", "filename": "gcc/ada/rtsfind.adb", "status": "modified", "additions": 11, "deletions": 3, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/eccc7c8cbfda3d8b6210543127b000d028631b6b/gcc%2Fada%2Frtsfind.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/eccc7c8cbfda3d8b6210543127b000d028631b6b/gcc%2Fada%2Frtsfind.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Frtsfind.adb?ref=eccc7c8cbfda3d8b6210543127b000d028631b6b", "patch": "@@ -1248,9 +1248,10 @@ package body Rtsfind is\n       --  for this unit to the current compilation unit.\n \n       declare\n-         LibUnit : constant Node_Id := Unit (Cunit (U.Unum));\n-         Clause  : Node_Id;\n-         Withn   : Node_Id;\n+         LibUnit  : constant Node_Id         := Unit (Cunit (U.Unum));\n+         Saved_GM : constant Ghost_Mode_Type := Ghost_Mode;\n+         Clause   : Node_Id;\n+         Withn    : Node_Id;\n \n       begin\n          Clause := U.First_Implicit_With;\n@@ -1262,11 +1263,18 @@ package body Rtsfind is\n             Clause := Next_Implicit_With (Clause);\n          end loop;\n \n+         --  We want to make sure that the \"with\" we create below isn't\n+         --  marked as ignored ghost code because this list may be walked\n+         --  later, after ignored ghost code is converted to a null\n+         --  statement.\n+\n+         Ghost_Mode := None;\n          Withn :=\n            Make_With_Clause (Standard_Location,\n              Name =>\n                Make_Unit_Name\n                  (U, Defining_Unit_Name (Specification (LibUnit))));\n+         Ghost_Mode := Saved_GM;\n \n          Set_Corresponding_Spec  (Withn, U.Entity);\n          Set_First_Name          (Withn);"}]}