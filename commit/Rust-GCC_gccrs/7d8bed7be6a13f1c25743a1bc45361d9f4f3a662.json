{"sha": "7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2Q4YmVkN2JlNmExM2YxYzI1NzQzYTFiYzQ1MzYxZDlmNGYzYTY2Mg==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard@codesourcery.com", "date": "2007-09-10T14:51:48Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2007-09-10T14:51:48Z"}, "message": "mips.h (MIPS_ARCH_FLOAT_SPEC): New macro.\n\ngcc/\n\t* config/mips/mips.h (MIPS_ARCH_FLOAT_SPEC): New macro.\n\t* config/mips/mips.c (mips_cpu_info_table): Mention it in the\n\tthe introductory comment.\n\t(MIPS_MARCH_CONTROLS_SOFT_FLOAT): Delete.\n\t(override_options): Don't test for it.\n\t* config/mips/sde.h (MIPS_MARCH_CONTROLS_SOFT_FLOAT): Delete.\n\t(DRIVER_SELF_SPECS): Add MIPS_ARCH_FLOAT_SPEC.\n\t* config/mips/vr.h: As for config/mips/sde.h.\n\nFrom-SVN: r128346", "tree": {"sha": "88992e8920e23fa7c52aa92c76a3834463e74984", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88992e8920e23fa7c52aa92c76a3834463e74984"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/comments", "author": null, "committer": null, "parents": [{"sha": "b3a06f593c5e947e2ec92da37878d423ce6f021e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b3a06f593c5e947e2ec92da37878d423ce6f021e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b3a06f593c5e947e2ec92da37878d423ce6f021e"}], "stats": {"total": 64, "additions": 31, "deletions": 33}, "files": [{"sha": "4a5dc46600939efed5f8c278bb22b2ca55fc5995", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "patch": "@@ -1,3 +1,14 @@\n+2007-09-10  Richard Sandiford  <richard@codesourcery.com>\n+\n+\t* config/mips/mips.h (MIPS_ARCH_FLOAT_SPEC): New macro.\n+\t* config/mips/mips.c (mips_cpu_info_table): Mention it in the\n+\tthe introductory comment.\n+\t(MIPS_MARCH_CONTROLS_SOFT_FLOAT): Delete.\n+\t(override_options): Don't test for it.\n+\t* config/mips/sde.h (MIPS_MARCH_CONTROLS_SOFT_FLOAT): Delete.\n+\t(DRIVER_SELF_SPECS): Add MIPS_ARCH_FLOAT_SPEC.\n+\t* config/mips/vr.h: As for config/mips/sde.h.\n+\n 2007-09-10  Trevor Smigiel  <trevor_smigiel@playstation.sony.com>\n \t    Revital Eres  <eres@il.ibm.com>\n "}, {"sha": "5ff9073cf7fde49cfcb2893c07f1a7df10b0de34", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 4, "deletions": 29, "changes": 33, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "patch": "@@ -740,9 +740,10 @@ const struct attribute_spec mips_attribute_table[] =\n    matched in the order listed.  The first mention of an ISA level is\n    taken as the canonical name for that ISA.\n \n-   To ease comparison, please keep this table in the same order as\n-   gas's mips_cpu_info_table[].  Please also make sure that\n-   MIPS_ISA_LEVEL_SPEC handles all -march options correctly.  */\n+   To ease comparison, please keep this table in the same order\n+   as gas's mips_cpu_info_table[].  Please also make sure that\n+   MIPS_ISA_LEVEL_SPEC and MIPS_ARCH_FLOAT_SPEC handle all -march\n+   options correctly.  */\n const struct mips_cpu_info mips_cpu_info_table[] = {\n   /* Entries for generic ISAs */\n   { \"mips1\", PROCESSOR_R3000, 1 },\n@@ -1216,12 +1217,6 @@ static const unsigned char mips16e_save_restore_regs[] = {\n   31, 30, 23, 22, 21, 20, 19, 18, 17, 16, 7, 6, 5, 4\n };\n \f\n-/* Nonzero if -march should decide the default value of\n-   MASK_SOFT_FLOAT_ABI.  */\n-#ifndef MIPS_MARCH_CONTROLS_SOFT_FLOAT\n-#define MIPS_MARCH_CONTROLS_SOFT_FLOAT 0\n-#endif\n-\f\n /* Initialize the GCC target structure.  */\n #undef TARGET_ASM_ALIGNED_HI_OP\n #define TARGET_ASM_ALIGNED_HI_OP \"\\t.half\\t\"\n@@ -5517,26 +5512,6 @@ override_options (void)\n \ttarget_flags &= ~MASK_LONG64;\n     }\n \n-  if (MIPS_MARCH_CONTROLS_SOFT_FLOAT\n-      && (target_flags_explicit & MASK_SOFT_FLOAT_ABI) == 0)\n-    {\n-      /* For some configurations, it is useful to have -march control\n-\t the default setting of MASK_SOFT_FLOAT_ABI.  */\n-      switch ((int) mips_arch)\n-\t{\n-\tcase PROCESSOR_R4100:\n-\tcase PROCESSOR_R4111:\n-\tcase PROCESSOR_R4120:\n-\tcase PROCESSOR_R4130:\n-\t  target_flags |= MASK_SOFT_FLOAT_ABI;\n-\t  break;\n-\n-\tdefault:\n-\t  target_flags &= ~MASK_SOFT_FLOAT_ABI;\n-\t  break;\n-\t}\n-    }\n-\n   if (!TARGET_OLDABI)\n     flag_pcc_struct_return = 0;\n "}, {"sha": "9fe11d0dce8fac98b2f77982539a1c087739267e", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "patch": "@@ -658,6 +658,16 @@ extern enum mips_code_readable_setting mips_code_readable;\n      %{march=mips64|march=5k*|march=20k*|march=sb1*|march=sr71000: -mips64} \\\n      %{!march=*: -\" MULTILIB_ISA_DEFAULT \"}}\"\n \n+/* A spec that infers a -mhard-float or -msoft-float setting from an\n+   -march argument.  Note that soft-float and hard-float code are not\n+   link-compatible.  */\n+\n+#define MIPS_ARCH_FLOAT_SPEC \\\n+  \"%{mhard-float|msoft-float|march=mips*:; \\\n+     march=vr41*|march=m4k|march=4k*|march=24kc|march=24kec \\\n+     |march=34kc|march=74kc|march=5kc: -msoft-float; \\\n+     march=*: -mhard-float}\"\n+\n /* A spec condition that matches 32-bit options.  It only works if\n    MIPS_ISA_LEVEL_SPEC has been applied.  */\n "}, {"sha": "7573bd62b46ea23515459f4dc8344e20e6cf7801", "filename": "gcc/config/mips/sde.h", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fsde.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fsde.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fsde.h?ref=7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "patch": "@@ -20,15 +20,15 @@ along with GCC; see the file COPYING.  If not, write to\n the Free Software Foundation, 59 Temple Place - Suite 330,\n Boston, MA 02111-1307, USA.  */\n \n-/* Let the -march option set soft-float.  */\n-#define MIPS_MARCH_CONTROLS_SOFT_FLOAT 1\n-\n #define DRIVER_SELF_SPECS\t\t\t\t\t\t\\\n   /* Make sure a -mips option is present.  This helps us to pick\t\\\n      the right multilib, and also makes the later specs easier\t\t\\\n      to write.  */\t\t\t\t\t\t\t\\\n   MIPS_ISA_LEVEL_SPEC,\t\t\t\t\t\t\t\\\n \t\t\t\t\t\t\t\t\t\\\n+  /* Infer the default float setting from -march.  */\t\t\t\\\n+  MIPS_ARCH_FLOAT_SPEC,\t\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n   /* If no ABI option is specified, infer one from the ISA level\t\\\n      or -mgp setting.  */\t\t\t\t\t\t\\\n   \"%{!mabi=*: %{\" MIPS_32BIT_OPTION_SPEC \": -mabi=32;: -mabi=n32}}\",\t\\"}, {"sha": "9492cac759df795fc0f7007657fd6a4d74e3b7ee", "filename": "gcc/config/mips/vr.h", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fvr.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7d8bed7be6a13f1c25743a1bc45361d9f4f3a662/gcc%2Fconfig%2Fmips%2Fvr.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fvr.h?ref=7d8bed7be6a13f1c25743a1bc45361d9f4f3a662", "patch": "@@ -21,7 +21,6 @@ along with GCC; see the file COPYING3.  If not see\n \n #define DEFAULT_VR_ARCH \"mfix-vr4130\"\n #define MIPS_ABI_DEFAULT ABI_EABI\n-#define MIPS_MARCH_CONTROLS_SOFT_FLOAT 1\n #define MULTILIB_DEFAULTS \\\n \t{ MULTILIB_ENDIAN_DEFAULT,\t\t\\\n \t  MULTILIB_ABI_DEFAULT,\t\t\t\\\n@@ -41,6 +40,9 @@ along with GCC; see the file COPYING3.  If not see\n \t/* Same idea for -mfix-vr4130.  */\t\t\t\t\\\n \t\"%{mfix-vr4130:%{!march=*:-march=vr4130}}\",\t\t\t\\\n \t\t\t\t\t\t\t\t\t\\\n+\t/* Infer the default float setting from -march.  */\t\t\\\n+\tMIPS_ARCH_FLOAT_SPEC,\t\t\t\t\t\t\\\n+\t\t\t\t\t\t\t\t\t\\\n \t/* Make -mabi=eabi -mlong32 the default.  */\t\t\t\\\n \t\"%{!mabi=*:-mabi=eabi %{!mlong*:-mlong32}}\",\t\t\t\\\n \t\t\t\t\t\t\t\t\t\\"}]}