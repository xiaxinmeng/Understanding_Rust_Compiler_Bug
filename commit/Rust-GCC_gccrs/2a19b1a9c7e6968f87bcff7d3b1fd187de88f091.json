{"sha": "2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmExOWIxYTljN2U2OTY4Zjg3YmNmZjdkM2IxZmQxODdkZTg4ZjA5MQ==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2007-10-15T05:21:37Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2007-10-15T05:21:37Z"}, "message": "tree-eh.c (optimize_double_finally): Don't assume that the cleanup we're duplicating is only one statement.\n\n        * tree-eh.c (optimize_double_finally): Don't assume that the\n        cleanup we're duplicating is only one statement.\n\nFrom-SVN: r129311", "tree": {"sha": "1790aa29b83df4a200b6f43e36baf83dc6d873d5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1790aa29b83df4a200b6f43e36baf83dc6d873d5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5012f3e3c7edc51900339aa25057dd7c483e7447", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5012f3e3c7edc51900339aa25057dd7c483e7447", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5012f3e3c7edc51900339aa25057dd7c483e7447"}], "stats": {"total": 59, "additions": 51, "deletions": 8}, "files": [{"sha": "e45535d349a56990e4a2fecfd53e1ef8ebb38268", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "patch": "@@ -1,3 +1,8 @@\n+2007-10-14  Jason Merrill  <jason@redhat.com>\n+\n+\t* tree-eh.c (optimize_double_finally): Don't assume that the\n+\tcleanup we're duplicating is only one statement.\n+\n 2007-10-14  Kazu Hirata  <kazu@codesourcery.com>\n \n \t* config/fixed-bit.c, config/i386/cpuid.h, config/i386/i386.c,"}, {"sha": "163d76e814f0ff9ac91712c03b76c060d032649e", "filename": "gcc/testsuite/g++.dg/eh/ehopt1.C", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fehopt1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fehopt1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Feh%2Fehopt1.C?ref=2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "patch": "@@ -0,0 +1,44 @@\n+// ehopt was only copying one statement from the cleanup of the B temporary\n+// into the following try block, so we lost its destructor call.\n+\n+// { dg-do run }\n+\n+template <class T, class U>\n+class A;\n+\n+bool b;\n+int count;\n+\n+template <>\n+class A<int, int>\n+{\n+public:\n+  A(int) { ++count; if (b) throw 1; }\n+  A(const A&) { ++count; if (b) throw 1; }\n+  ~A() { --count; if (b) throw 1; }\n+};\n+\n+typedef A<int, int> B;\n+\n+template <>\n+class A<void *, void *>\n+{\n+public:\n+  A() { if (b) throw 1; }\n+  A(const B&) { if (b) throw 1; }\n+  ~A() { if (b) throw 1; }\n+};\n+\n+typedef A<void *, void *> C;\n+\n+void f() { if (b) throw 1; }\n+\n+int\n+main (void)\n+{\n+  {\n+    C a(1);\n+    f();\n+  }\n+  return count;\n+}"}, {"sha": "71d3d941b79184d9bd04ad0f4d688ceee8d50075", "filename": "gcc/tree-eh.c", "status": "modified", "additions": 2, "deletions": 8, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/gcc%2Ftree-eh.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a19b1a9c7e6968f87bcff7d3b1fd187de88f091/gcc%2Ftree-eh.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-eh.c?ref=2a19b1a9c7e6968f87bcff7d3b1fd187de88f091", "patch": "@@ -2157,18 +2157,12 @@ optimize_double_finally (tree one, tree two)\n \n   if (same_handler_p (TREE_OPERAND (oneh, 1), TREE_OPERAND (two, 1)))\n     {\n-      tree twoh;\n-\n       tree b = TREE_OPERAND (oneh, 0);\n       TREE_OPERAND (one, 1) = b;\n       TREE_SET_CODE (one, TRY_CATCH_EXPR);\n \n-      b = tsi_stmt (tsi_start (b));\n-      twoh = TREE_OPERAND (two, 0);\n-      /* same_handler_p only handles single-statement handlers,\n-\t so there must only be one statement.  */\n-      i = tsi_start (twoh);\n-      tsi_link_before (&i, unshare_expr (b), TSI_SAME_STMT);\n+      i = tsi_start (TREE_OPERAND (two, 0));\n+      tsi_link_before (&i, unsave_expr_now (b), TSI_SAME_STMT);\n     }\n }\n "}]}