{"sha": "bb3a37acf0479f9d12c64852163b02cb63fef69e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YmIzYTM3YWNmMDQ3OWY5ZDEyYzY0ODUyMTYzYjAyY2I2M2ZlZjY5ZQ==", "commit": {"author": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2004-03-23T14:26:43Z"}, "committer": {"name": "Roger Sayle", "email": "sayle@gcc.gnu.org", "date": "2004-03-23T14:26:43Z"}, "message": "re PR rtl-optimization/14669 (Wrong code with -O for enum values expression E4 <= t && t <= E6)\n\n2004-03-23  Kazu Hirata  <kazu@cs.umass.edu>\n\n\tPR optimization/14669\n\t* fold-const.c (fold): Only unwiden integer comparisons for equality\n\tor inequality operators, or when the signedness is the same.\n\n\t* g++.dg/opt/fold2.C: New test case.\n\nFrom-SVN: r79859", "tree": {"sha": "5d31569a0dac072a9ef9e7c480f9f8ab8d3fe778", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5d31569a0dac072a9ef9e7c480f9f8ab8d3fe778"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/bb3a37acf0479f9d12c64852163b02cb63fef69e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb3a37acf0479f9d12c64852163b02cb63fef69e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/bb3a37acf0479f9d12c64852163b02cb63fef69e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/bb3a37acf0479f9d12c64852163b02cb63fef69e/comments", "author": null, "committer": null, "parents": [{"sha": "f2c79f80f2c92c9fca4632598e019c09903075ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f2c79f80f2c92c9fca4632598e019c09903075ca", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f2c79f80f2c92c9fca4632598e019c09903075ca"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "5343f2cce94f2e5c5ca731929a52b1a41c7d5398", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=bb3a37acf0479f9d12c64852163b02cb63fef69e", "patch": "@@ -1,3 +1,9 @@\n+2004-03-23  Kazu Hirata  <kazu@cs.umass.edu>\n+\n+\tPR optimization/14669\n+\t* fold-const.c (fold): Only unwiden integer comparisons for equality\n+\tand inequality operators, or when the signedness doesn't change.\n+\n 2004-03-23  Jakub Jelinek  <jakub@redhat.com>\n \n \t* config.gcc (sparc-*-linux*): Add sparc/t-linux to tmake_file."}, {"sha": "ab43be8d880a52797c3def2ae35ca062933a3afb", "filename": "gcc/fold-const.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=bb3a37acf0479f9d12c64852163b02cb63fef69e", "patch": "@@ -7535,6 +7535,9 @@ fold (tree expr)\n       else if (TREE_CODE (TREE_TYPE (arg0)) == INTEGER_TYPE\n \t       && TREE_CODE (arg0) == NOP_EXPR\n \t       && (tem = get_unwidened (arg0, NULL_TREE)) != arg0\n+\t       && (code == EQ_EXPR || code == NE_EXPR\n+\t\t   || TREE_UNSIGNED (TREE_TYPE (arg0))\n+\t\t      == TREE_UNSIGNED (TREE_TYPE (tem)))\n \t       && (t1 = get_unwidened (arg1, TREE_TYPE (tem))) != 0\n \t       && (TREE_TYPE (t1) == TREE_TYPE (tem)\n \t\t   || (TREE_CODE (t1) == INTEGER_CST"}, {"sha": "c111369c3e378ed4d8b7061eab894cbe2e2273ca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=bb3a37acf0479f9d12c64852163b02cb63fef69e", "patch": "@@ -1,3 +1,8 @@\n+2004-03-23  Roger Sayle  <roger@eyesopen.com>\n+\n+\tPR optimization/14669\n+\t* g++.dg/opt/fold2.C: New test case.\n+\n 2004-03-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c/14069"}, {"sha": "95063d7ab0b171882432ab5801a1bd52c1b3b736", "filename": "gcc/testsuite/g++.dg/opt/fold2.C", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Ffold2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/bb3a37acf0479f9d12c64852163b02cb63fef69e/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Ffold2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Ffold2.C?ref=bb3a37acf0479f9d12c64852163b02cb63fef69e", "patch": "@@ -0,0 +1,19 @@\n+// PR optimization/14669\n+// { dg-do run }\n+// { dg-options \"-O2\" }\n+\n+extern \"C\" void abort (void);\n+extern \"C\" void exit (int);\n+\n+enum ActionType { EE=-1, E0=0, E1, E2 };\n+\n+int main(void)\n+{\n+  ActionType t = E0;\n+\n+  if (E1 <= t && t <= E2)\n+    abort ();\n+\n+  exit (0);\n+}\n+"}]}