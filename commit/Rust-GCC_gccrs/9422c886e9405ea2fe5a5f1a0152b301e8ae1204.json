{"sha": "9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTQyMmM4ODZlOTQwNWVhMmZlNWE1ZjFhMDE1MmIzMDFlOGFlMTIwNA==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2012-05-06T11:13:32Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2012-05-06T11:13:32Z"}, "message": "decl.c (gnat_to_gnu_entity): In the renaming case...\n\n\t* gcc-interface/decl.c (gnat_to_gnu_entity) <object>: In the renaming\n\tcase, use the padded type if the renamed object has an unconstrained\n\ttype with default discriminant.\n\nFrom-SVN: r187209", "tree": {"sha": "d3f9fbbe4ae9a17c6fc5fd48ac3f5c9719ddcc4f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d3f9fbbe4ae9a17c6fc5fd48ac3f5c9719ddcc4f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/comments", "author": null, "committer": null, "parents": [{"sha": "80096613015952f3090df0821a8a7d18be93f8ac", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80096613015952f3090df0821a8a7d18be93f8ac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80096613015952f3090df0821a8a7d18be93f8ac"}], "stats": {"total": 144, "additions": 137, "deletions": 7}, "files": [{"sha": "856d100e8b0bf9794a12097924063ddba5a580e9", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -1,9 +1,15 @@\n+2012-05-06  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/decl.c (gnat_to_gnu_entity) <object>: In the renaming\n+\tcase, use the padded type if the renamed object has an unconstrained\n+\ttype with default discriminant.\n+\n 2012-05-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/trans.c (Loop_Statement_to_gnu): Also handle invariant\n \tconditions with only one bound.\n-\t(Raise_Error_to_gnu): Likewise. \ufffdNew function extracted from...\n-\t(gnat_to_gnu) <N_Raise_Constraint_Error>: ...here. \ufffdCall above function\n+\t(Raise_Error_to_gnu): Likewise.  New function extracted from...\n+\t(gnat_to_gnu) <N_Raise_Constraint_Error>: ...here.  Call above function\n \tin regular mode only.\n \n 2012-05-06  Eric Botcazou  <ebotcazou@adacore.com>"}, {"sha": "97ade5e6159028e987cb90f6f966182af76dc5dd", "filename": "gcc/ada/gcc-interface/decl.c", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Fada%2Fgcc-interface%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Fdecl.c?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -938,6 +938,14 @@ gnat_to_gnu_entity (Entity_Id gnat_entity, tree gnu_expr, int definition)\n \t\tgnu_type = TREE_TYPE (gnu_expr);\n \t      }\n \n+\t    /* Or else, if the renamed object has an unconstrained type with\n+\t       default discriminant, use the padded type.  */\n+\t    else if (TYPE_IS_PADDING_P (TREE_TYPE (gnu_expr))\n+\t\t     && TREE_TYPE (TYPE_FIELDS (TREE_TYPE (gnu_expr)))\n+\t\t\t== gnu_type\n+\t\t     && CONTAINS_PLACEHOLDER_P (TYPE_SIZE (gnu_type)))\n+\t      gnu_type = TREE_TYPE (gnu_expr);\n+\n \t    /* Case 1: If this is a constant renaming stemming from a function\n \t       call, treat it as a normal object whose initial value is what\n \t       is being renamed.  RM 3.3 says that the result of evaluating a"}, {"sha": "20133aa4cbd472fee2204fc0ae38e1dea4113e54", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 13, "deletions": 3, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -1,7 +1,17 @@\n-2012-05-04  Eric Botcazou  <ebotcazou@adacore.com>\n+2012-05-06  Eric Botcazou  <ebotcazou@adacore.com>\n \n-\t* gcc.target/ia64/pr48496.c: New test.\n-\t* gcc.target/ia64/pr52657.c: Likewise.\n+\t* gnat.dg/specs/renamings.ads: Rename to...\n+\t* gnat.dg/specs/renaming1.ads: ...this.\n+\t* gnat.dg/specs/renaming2.ads: New test.\n+\t* gnat.dg/specs/renaming2_pkg1.ads: New helper.\n+\t* gnat.dg/specs/renaming2_pkg2.ads: Likewise.\n+\t* gnat.dg/specs/renaming2_pkg3.ads: Likewise.\n+\t* gnat.dg/specs/renaming2_pkg4.ad[sb]: Likewise.\n+\n+2012-05-06  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/discr36.ad[sb]: New test.\n+\t* gnat.dg/discr36_pkg.ad[sb]: New helper.\n \n 2012-05-05  Manuel L\u00f3pez-Ib\u00e1\u00f1ez  <manu@gcc.gnu.org>\n "}, {"sha": "b97605aa7d25e639686eebe64003a3c9479f63e6", "filename": "gcc/testsuite/gnat.dg/specs/renaming1.ads", "status": "renamed", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming1.ads?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -1,4 +1,6 @@\n-package Renamings is\n+-- { dg-do compile }\n+\n+package Renaming1 is\n \n    package Inner is\n       procedure PI (X : Integer);\n@@ -11,4 +13,4 @@ package Renamings is\n    procedure Q (X : Float);\n    procedure Q (X : Integer) renames Inner.PI;\n    pragma Convention (C, Q); -- { dg-error \"non-local entity\" }\n-end Renamings;\n+end Renaming1;", "previous_filename": "gcc/testsuite/gnat.dg/specs/renamings.ads"}, {"sha": "5f199c61345137492ea842cd42e209e31a19fff4", "filename": "gcc/testsuite/gnat.dg/specs/renaming2.ads", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2.ads?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -0,0 +1,11 @@\n+-- { dg-do compile }\n+\n+with Renaming2_Pkg1;\n+\n+package Renaming2 is\n+\n+  type T is null record;\n+\n+  package Iter is new Renaming2_Pkg1.GP.Inner (T);\n+\n+end Renaming2;"}, {"sha": "45d5436ffc80e3d92b7804e86bd12d71c2a9beb6", "filename": "gcc/testsuite/gnat.dg/specs/renaming2_pkg1.ads", "status": "added", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg1.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg1.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg1.ads?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -0,0 +1,17 @@\n+-- { dg-excess-errors \"no code generated\" }\n+\n+with Renaming2_Pkg2;\n+with Renaming2_Pkg3;\n+with Renaming2_Pkg4;\n+\n+package Renaming2_Pkg1 is\n+\n+  package Impl is new\n+    Renaming2_Pkg3 (Base_Index_T => Positive, Value_T => Renaming2_Pkg2.Root);\n+\n+  use Impl;\n+\n+  package GP is new\n+    Renaming2_Pkg4 (Length_T => Impl.Length_T, Value_T => Renaming2_Pkg2.Root);\n+\n+end Renaming2_Pkg1;"}, {"sha": "38e01898d51be7962983b2f9a33fc9e3ce1e49fa", "filename": "gcc/testsuite/gnat.dg/specs/renaming2_pkg2.ads", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg2.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg2.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg2.ads?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -0,0 +1,14 @@\n+package Renaming2_Pkg2 is\n+\n+  type Root is private;\n+\n+private\n+\n+  type Root (D : Boolean := False) is record\n+    case D is\n+      when True => N : Natural;\n+      when False => null;\n+    end case;\n+  end record;\n+\n+end Renaming2_Pkg2;"}, {"sha": "93ec0dfcf374c55067bd88b4edc5b13b608301e8", "filename": "gcc/testsuite/gnat.dg/specs/renaming2_pkg3.ads", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg3.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg3.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg3.ads?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -0,0 +1,25 @@\n+-- { dg-excess-errors \"no code generated\" }\n+\n+generic\n+\n+  type Base_Index_T is range <>;\n+\n+  type Value_T is private;\n+\n+package Renaming2_Pkg3 is\n+\n+  type T is private;\n+\n+  subtype Length_T is Base_Index_T range 0 .. Base_Index_T'Last;\n+\n+  function Value (L : Length_T) return Value_T;\n+\n+  function Next return Length_T;\n+\n+private\n+\n+  type Obj_T is null record;\n+\n+  type T is access Obj_T;\n+\n+end Renaming2_Pkg3;"}, {"sha": "50dd536477287e52b7efaf7eb974ed6977d46234", "filename": "gcc/testsuite/gnat.dg/specs/renaming2_pkg4.adb", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg4.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg4.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg4.adb?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -0,0 +1,12 @@\n+package body Renaming2_Pkg4 is\n+\n+  package body Inner is\n+\n+      function Next_Value return Value_T is\n+        Next_Value : Value_T renames Value (Next);\n+      begin\n+        return Next_Value;\n+      end Next_Value;\n+\n+  end Inner;\n+end Renaming2_Pkg4;"}, {"sha": "abeffcc7da8c67b406013ed1f60f165b4127271d", "filename": "gcc/testsuite/gnat.dg/specs/renaming2_pkg4.ads", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg4.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9422c886e9405ea2fe5a5f1a0152b301e8ae1204/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg4.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Fspecs%2Frenaming2_pkg4.ads?ref=9422c886e9405ea2fe5a5f1a0152b301e8ae1204", "patch": "@@ -0,0 +1,25 @@\n+-- { dg-excess-errors \"no code generated\" }\n+\n+generic\n+\n+  type Length_T is range <>;\n+\n+  with function Next return Length_T is <>;\n+\n+  type Value_T is private;\n+\n+  with function Value (L : Length_T) return Value_T is <>;\n+\n+package Renaming2_Pkg4 is\n+\n+  generic\n+    type T is private;\n+  package Inner is\n+\n+    type Slave_T is tagged null record;\n+\n+    function Next_Value return Value_T;\n+\n+  end Inner;\n+\n+end Renaming2_Pkg4;"}]}