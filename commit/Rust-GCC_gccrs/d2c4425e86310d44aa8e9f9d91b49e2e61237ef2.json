{"sha": "d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDJjNDQyNWU4NjMxMGQ0NGFhOGU5ZjlkOTFiNDllMmU2MTIzN2VmMg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2016-10-14T17:16:55Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2016-10-14T17:16:55Z"}, "message": "debug/elf: add sparc64 relocations\n    \n    This is a backport of https://go-review.googlesource.com/30870.\n    \n    Reviewed-on: https://go-review.googlesource.com/30916\n\nFrom-SVN: r241171", "tree": {"sha": "453f6adb592dfcdb6119716338e2e00793019f19", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/453f6adb592dfcdb6119716338e2e00793019f19"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/comments", "author": null, "committer": null, "parents": [{"sha": "d4919e65cae926b962425ff3d8c71a668f63c209", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4919e65cae926b962425ff3d8c71a668f63c209", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4919e65cae926b962425ff3d8c71a668f63c209"}], "stats": {"total": 68, "additions": 67, "deletions": 1}, "files": [{"sha": "cadd8ec1b310f7b3c07be6d7e4d48560f4a80e50", "filename": "gcc/go/gofrontend/MERGE", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/gcc%2Fgo%2Fgofrontend%2FMERGE", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/gcc%2Fgo%2Fgofrontend%2FMERGE", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgo%2Fgofrontend%2FMERGE?ref=d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "patch": "@@ -1,4 +1,4 @@\n-5f043fc2bf0f92a84a1f7da57acd79a61c9d2592\n+911fceabd4c955b2f29f6b532f241a002ca7ad4f\n \n The first line of this file holds the git revision number of the last\n merge done from the gofrontend repository."}, {"sha": "c1cbfa6225415ec0d2ce988025e1ba62c8c9b7fc", "filename": "libgo/go/debug/elf/file.go", "status": "modified", "additions": 47, "deletions": 0, "changes": 47, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/libgo%2Fgo%2Fdebug%2Felf%2Ffile.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/libgo%2Fgo%2Fdebug%2Felf%2Ffile.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fdebug%2Felf%2Ffile.go?ref=d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "patch": "@@ -598,6 +598,8 @@ func (f *File) applyRelocations(dst []byte, rels []byte) error {\n \t\treturn f.applyRelocationsMIPS64(dst, rels)\n \tcase f.Class == ELFCLASS64 && f.Machine == EM_S390:\n \t\treturn f.applyRelocationss390x(dst, rels)\n+\tcase f.Class == ELFCLASS64 && f.Machine == EM_SPARCV9:\n+\t\treturn f.applyRelocationsSPARC64(dst, rels)\n \tdefault:\n \t\treturn errors.New(\"applyRelocations: not implemented\")\n \t}\n@@ -962,6 +964,51 @@ func (f *File) applyRelocationss390x(dst []byte, rels []byte) error {\n \treturn nil\n }\n \n+func (f *File) applyRelocationsSPARC64(dst []byte, rels []byte) error {\n+\t// 24 is the size of Rela64.\n+\tif len(rels)%24 != 0 {\n+\t\treturn errors.New(\"length of relocation section is not a multiple of 24\")\n+\t}\n+\n+\tsymbols, _, err := f.getSymbols(SHT_SYMTAB)\n+\tif err != nil {\n+\t\treturn err\n+\t}\n+\n+\tb := bytes.NewReader(rels)\n+\tvar rela Rela64\n+\n+\tfor b.Len() > 0 {\n+\t\tbinary.Read(b, f.ByteOrder, &rela)\n+\t\tsymNo := rela.Info >> 32\n+\t\tt := R_SPARC(rela.Info & 0xffff)\n+\n+\t\tif symNo == 0 || symNo > uint64(len(symbols)) {\n+\t\t\tcontinue\n+\t\t}\n+\t\tsym := &symbols[symNo-1]\n+\t\tif SymType(sym.Info&0xf) != STT_SECTION {\n+\t\t\t// We don't handle non-section relocations for now.\n+\t\t\tcontinue\n+\t\t}\n+\n+\t\tswitch t {\n+\t\tcase R_SPARC_64, R_SPARC_UA64:\n+\t\t\tif rela.Off+8 >= uint64(len(dst)) || rela.Addend < 0 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tf.ByteOrder.PutUint64(dst[rela.Off:rela.Off+8], uint64(rela.Addend))\n+\t\tcase R_SPARC_32, R_SPARC_UA32:\n+\t\t\tif rela.Off+4 >= uint64(len(dst)) || rela.Addend < 0 {\n+\t\t\t\tcontinue\n+\t\t\t}\n+\t\t\tf.ByteOrder.PutUint32(dst[rela.Off:rela.Off+4], uint32(rela.Addend))\n+\t\t}\n+\t}\n+\n+\treturn nil\n+}\n+\n func (f *File) DWARF() (*dwarf.Data, error) {\n \t// sectionData gets the data for s, checks its size, and\n \t// applies any applicable relations."}, {"sha": "f1e28a067159c772cf0249e48520c7f498aec41c", "filename": "libgo/go/debug/elf/file_test.go", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/libgo%2Fgo%2Fdebug%2Felf%2Ffile_test.go", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/libgo%2Fgo%2Fdebug%2Felf%2Ffile_test.go", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fdebug%2Felf%2Ffile_test.go?ref=d2c4425e86310d44aa8e9f9d91b49e2e61237ef2", "patch": "@@ -491,6 +491,25 @@ var relocationTests = []relocationTest{\n \t\t\t}},\n \t\t},\n \t},\n+\t{\n+\t\t\"testdata/go-relocation-test-gcc620-sparc64.obj\",\n+\t\t[]relocationTestEntry{\n+\t\t\t{0, &dwarf.Entry{\n+\t\t\t\tOffset:   0xb,\n+\t\t\t\tTag:      dwarf.TagCompileUnit,\n+\t\t\t\tChildren: true,\n+\t\t\t\tField: []dwarf.Field{\n+\t\t\t\t\t{Attr: dwarf.AttrProducer, Val: \"GNU C11 6.2.0 20160914 -mcpu=v9 -g -fstack-protector-strong\", Class: dwarf.ClassString},\n+\t\t\t\t\t{Attr: dwarf.AttrLanguage, Val: int64(12), Class: dwarf.ClassConstant},\n+\t\t\t\t\t{Attr: dwarf.AttrName, Val: \"hello.c\", Class: dwarf.ClassString},\n+\t\t\t\t\t{Attr: dwarf.AttrCompDir, Val: \"/tmp\", Class: dwarf.ClassString},\n+\t\t\t\t\t{Attr: dwarf.AttrLowpc, Val: uint64(0x0), Class: dwarf.ClassAddress},\n+\t\t\t\t\t{Attr: dwarf.AttrHighpc, Val: int64(0x2c), Class: dwarf.ClassConstant},\n+\t\t\t\t\t{Attr: dwarf.AttrStmtList, Val: int64(0), Class: dwarf.ClassLinePtr},\n+\t\t\t\t},\n+\t\t\t}},\n+\t\t},\n+\t},\n \t{\n \t\t\"testdata/go-relocation-test-gcc493-mips64le.obj\",\n \t\t[]relocationTestEntry{"}, {"sha": "d65c23e1cbeaad5acc30d7d256931443ac8aea2a", "filename": "libgo/go/debug/elf/testdata/go-relocation-test-gcc620-sparc64.obj", "status": "added", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/libgo%2Fgo%2Fdebug%2Felf%2Ftestdata%2Fgo-relocation-test-gcc620-sparc64.obj", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d2c4425e86310d44aa8e9f9d91b49e2e61237ef2/libgo%2Fgo%2Fdebug%2Felf%2Ftestdata%2Fgo-relocation-test-gcc620-sparc64.obj", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgo%2Fgo%2Fdebug%2Felf%2Ftestdata%2Fgo-relocation-test-gcc620-sparc64.obj?ref=d2c4425e86310d44aa8e9f9d91b49e2e61237ef2"}]}