{"sha": "2a38995899548c685e8bd794f79c5aad80fc6ef0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmEzODk5NTg5OTU0OGM2ODVlOGJkNzk0Zjc5YzVhYWQ4MGZjNmVmMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2017-09-29T07:35:37Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2017-09-29T07:35:37Z"}, "message": "re PR c/82340 (volatile ignored in compound literal)\n\n\tPR c/82340\n\t* c-decl.c (build_compound_literal): Use c_apply_type_quals_to_decl\n\tinstead of trying to set just TREE_READONLY manually.\n\n\t* gcc.dg/tree-ssa/pr82340.c: New test.\n\nFrom-SVN: r253280", "tree": {"sha": "b1e36017321030a3f615e14cf3f81963936cc82f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b1e36017321030a3f615e14cf3f81963936cc82f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2a38995899548c685e8bd794f79c5aad80fc6ef0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a38995899548c685e8bd794f79c5aad80fc6ef0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2a38995899548c685e8bd794f79c5aad80fc6ef0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2a38995899548c685e8bd794f79c5aad80fc6ef0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2891beff1aa8e627ba27b35d28d6a8e6198a0625", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2891beff1aa8e627ba27b35d28d6a8e6198a0625", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2891beff1aa8e627ba27b35d28d6a8e6198a0625"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "496b767cb51471bd022a97a0bdb7120acad9f4c2", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=2a38995899548c685e8bd794f79c5aad80fc6ef0", "patch": "@@ -1,3 +1,9 @@\n+2017-09-29  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR c/82340\n+\t* c-decl.c (build_compound_literal): Use c_apply_type_quals_to_decl\n+\tinstead of trying to set just TREE_READONLY manually.\n+\n 2017-09-16  Tom de Vries  <tom@codesourcery.com>\n \n \tPR c/81875"}, {"sha": "080a2e9c0bd7a8918a9421a3f194326e65738814", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 1, "deletions": 3, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=2a38995899548c685e8bd794f79c5aad80fc6ef0", "patch": "@@ -5247,9 +5247,7 @@ build_compound_literal (location_t loc, tree type, tree init, bool non_const)\n   DECL_ARTIFICIAL (decl) = 1;\n   DECL_IGNORED_P (decl) = 1;\n   TREE_TYPE (decl) = type;\n-  TREE_READONLY (decl) = (TYPE_READONLY (type)\n-\t\t\t  || (TREE_CODE (type) == ARRAY_TYPE\n-\t\t\t      && TYPE_READONLY (TREE_TYPE (type))));\n+  c_apply_type_quals_to_decl (TYPE_QUALS (strip_array_types (type)), decl);\n   store_init_value (loc, decl, init, NULL_TREE);\n \n   if (TREE_CODE (type) == ARRAY_TYPE && !COMPLETE_TYPE_P (type))"}, {"sha": "e0eade336b3a4d0f5ca70d0e7b7f0f208023b974", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2a38995899548c685e8bd794f79c5aad80fc6ef0", "patch": "@@ -1,5 +1,8 @@\n 2017-09-29  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c/82340\n+\t* gcc.dg/tree-ssa/pr82340.c: New test.\n+\n \t* g++.dg/eh/uncaught3.C: Add -Wno-deprecated for c++17.\n \n 2017-09-28  Paolo Carlini  <paolo.carlini@oracle.com>"}, {"sha": "ad9f1cfcee16b1037e2b7e34a0a8af40c9d89d85", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr82340.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr82340.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2a38995899548c685e8bd794f79c5aad80fc6ef0/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr82340.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr82340.c?ref=2a38995899548c685e8bd794f79c5aad80fc6ef0", "patch": "@@ -0,0 +1,14 @@\n+/* PR c/82340 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fdump-tree-ssa\" } */\n+/* { dg-final { scan-tree-dump \"D.\\[0-9]*\\\\\\[0\\\\\\] ={v} 77;\" \"ssa\" } } */\n+\n+int\n+foo (void)\n+{\n+  int i;\n+  volatile char *p = (volatile char[1]) { 77 };\n+  for (i = 1; i < 10; i++)\n+    *p = 4;\n+  return *p;\n+}"}]}