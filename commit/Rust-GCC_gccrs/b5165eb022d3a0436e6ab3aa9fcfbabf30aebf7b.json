{"sha": "b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjUxNjVlYjAyMmQzYTA0MzZlNmFiM2FhOWZjZmJhYmYzMGFlYmY3Yg==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2014-03-25T18:22:41Z"}, "committer": {"name": "Martin Jambor", "email": "jamborm@gcc.gnu.org", "date": "2014-03-25T18:22:41Z"}, "message": "re PR ipa/60600 (ICE in ipa_get_indirect_edge_target_1)\n\n2014-03-25  Martin Jambor  <mjambor@suse.cz>\n\n\tPR ipa/60600\n\t* ipa-cp.c (ipa_get_indirect_edge_target_1): Redirect type\n\tinconsistent devirtualizations to __builtin_unreachable.\n\ntestsuite/\n\t* g++.dg/ipa/pr60600.C: New test.\n\nFrom-SVN: r208818", "tree": {"sha": "a145c18206b495d88a65796a9838661c0082b789", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a145c18206b495d88a65796a9838661c0082b789"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1cbba79d074af647f641e9b684b8bba242421241", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1cbba79d074af647f641e9b684b8bba242421241", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1cbba79d074af647f641e9b684b8bba242421241"}], "stats": {"total": 62, "additions": 57, "deletions": 5}, "files": [{"sha": "d3dfb305aa6631feffeaad822c47e1026849aba9", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "patch": "@@ -1,3 +1,9 @@\n+2014-03-25  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/60600\n+\t* ipa-cp.c (ipa_get_indirect_edge_target_1): Redirect type\n+\tinconsistent devirtualizations to __builtin_unreachable.\n+\n 2014-03-25  Marek Polacek  <polacek@redhat.com>\n \n \tPR c/35449"}, {"sha": "74042adb5a1deab24341a9b29593897f4a4ac689", "filename": "gcc/ipa-cp.c", "status": "modified", "additions": 12, "deletions": 5, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2Fipa-cp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2Fipa-cp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-cp.c?ref=b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "patch": "@@ -1639,11 +1639,18 @@ ipa_get_indirect_edge_target_1 (struct cgraph_edge *ie,\n \treturn NULL_TREE;\n       target = gimple_get_virt_method_for_binfo (token, binfo);\n     }\n-#ifdef ENABLE_CHECKING\n-  if (target)\n-    gcc_assert (possible_polymorphic_call_target_p\n-\t\t (ie, cgraph_get_node (target)));\n-#endif\n+\n+  if (target && !possible_polymorphic_call_target_p (ie,\n+\t\t\t\t\t\t     cgraph_get_node (target)))\n+    {\n+      if (dump_file)\n+\tfprintf (dump_file,\n+\t\t \"Type inconsident devirtualization: %s/%i->%s\\n\",\n+\t\t ie->caller->name (), ie->caller->order,\n+\t\t IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (target)));\n+      target = builtin_decl_implicit (BUILT_IN_UNREACHABLE);\n+      cgraph_get_create_node (target);\n+    }\n \n   return target;\n }"}, {"sha": "da8d6437047238271a1474596dbfab32304f286d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "patch": "@@ -1,3 +1,8 @@\n+2014-03-25  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR ipa/60600\n+\t* g++.dg/ipa/pr60600.C: New test.\n+\n 2014-03-25  John David Anglin  <danglin@gcc.gnu.org>\n \n \tPR testsuite/58013"}, {"sha": "00c368e6329d6a5a69d7400713ccbf141c221ad1", "filename": "gcc/testsuite/g++.dg/ipa/pr60600.C", "status": "added", "additions": 34, "deletions": 0, "changes": 34, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fpr60600.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fpr60600.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fipa%2Fpr60600.C?ref=b5165eb022d3a0436e6ab3aa9fcfbabf30aebf7b", "patch": "@@ -0,0 +1,34 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O3 -fdump-ipa-cp\" } */\n+\n+struct data {\n+    data(int);\n+};\n+\n+struct top {\n+    virtual int topf();\n+};\n+\n+struct intermediate: top {\n+    int topf() /* override */ { return 0; }\n+};\n+\n+struct child1: top {\n+    void childf()\n+    {\n+        data d(topf());\n+    }\n+};\n+\n+struct child2: intermediate {};\n+\n+void test(top& t)\n+{\n+    child1& c = static_cast<child1&>(t);\n+    c.childf();\n+    child2 d;\n+    test(d);\n+}\n+\n+/* { dg-final { scan-ipa-dump \"Type inconsident devirtualization\" \"cp\" } } */\n+/* { dg-final { cleanup-ipa-dump \"cp\" } } */"}]}