{"sha": "70caf430fe8b94a213f60ef7798766990da1b311", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzBjYWY0MzBmZThiOTRhMjEzZjYwZWY3Nzk4NzY2OTkwZGExYjMxMQ==", "commit": {"author": {"name": "Volker Reichelt", "email": "v.reichelt@netcologne.de", "date": "2017-04-25T16:12:58Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2017-04-25T16:12:58Z"}, "message": "parser.c (cp_parser_elaborated_type_specifier): Add fix-it to diagnostic of invalid class/struct keyword after enum.\n\n        * parser.c (cp_parser_elaborated_type_specifier): Add fix-it to\n        diagnostic of invalid class/struct keyword after enum.\n\n        * g++.dg/cpp0x/enum34.C: New test.\n\nFrom-SVN: r247254", "tree": {"sha": "eff0df2600a421b2da84eeb658fc088080bdf317", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/eff0df2600a421b2da84eeb658fc088080bdf317"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/70caf430fe8b94a213f60ef7798766990da1b311", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70caf430fe8b94a213f60ef7798766990da1b311", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70caf430fe8b94a213f60ef7798766990da1b311", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70caf430fe8b94a213f60ef7798766990da1b311/comments", "author": {"login": "VReichelt", "id": 85767072, "node_id": "MDQ6VXNlcjg1NzY3MDcy", "avatar_url": "https://avatars.githubusercontent.com/u/85767072?v=4", "gravatar_id": "", "url": "https://api.github.com/users/VReichelt", "html_url": "https://github.com/VReichelt", "followers_url": "https://api.github.com/users/VReichelt/followers", "following_url": "https://api.github.com/users/VReichelt/following{/other_user}", "gists_url": "https://api.github.com/users/VReichelt/gists{/gist_id}", "starred_url": "https://api.github.com/users/VReichelt/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/VReichelt/subscriptions", "organizations_url": "https://api.github.com/users/VReichelt/orgs", "repos_url": "https://api.github.com/users/VReichelt/repos", "events_url": "https://api.github.com/users/VReichelt/events{/privacy}", "received_events_url": "https://api.github.com/users/VReichelt/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "9c533e7dfb45334395ad4aeefdfa5b4740d5c1dc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c533e7dfb45334395ad4aeefdfa5b4740d5c1dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c533e7dfb45334395ad4aeefdfa5b4740d5c1dc"}], "stats": {"total": 34, "additions": 29, "deletions": 5}, "files": [{"sha": "1a9ca1942b885ed27867ce867cb316a42ad2aa6e", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=70caf430fe8b94a213f60ef7798766990da1b311", "patch": "@@ -1,3 +1,8 @@\n+2017-04-25  Volker Reichelt  <v.reichelt@netcologne.de>\n+\n+\t* parser.c (cp_parser_elaborated_type_specifier): Add fix-it to\n+\tdiagnostic of invalid class/struct keyword after enum.\n+\n 2017-04-25  David Malcolm  <dmalcolm@redhat.com>\n \n \t* parser.c (cp_parser_member_declaration): Add fix-it hint"}, {"sha": "4714bc6cd8958512dcb00a80fce1d92237dd7c7e", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 9, "deletions": 5, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=70caf430fe8b94a213f60ef7798766990da1b311", "patch": "@@ -17270,12 +17270,16 @@ cp_parser_elaborated_type_specifier (cp_parser* parser,\n       tag_type = enum_type;\n       /* Issue a warning if the `struct' or `class' key (for C++0x scoped\n \t enums) is used here.  */\n-      if (cp_lexer_next_token_is_keyword (parser->lexer, RID_CLASS)\n-\t  || cp_lexer_next_token_is_keyword (parser->lexer, RID_STRUCT))\n+      cp_token *token = cp_lexer_peek_token (parser->lexer);\n+      if (cp_parser_is_keyword (token, RID_CLASS)\n+\t  || cp_parser_is_keyword (token, RID_STRUCT))\n \t{\n-\t    pedwarn (input_location, 0, \"elaborated-type-specifier \"\n-\t\t      \"for a scoped enum must not use the %qD keyword\",\n-\t\t      cp_lexer_peek_token (parser->lexer)->u.value);\n+\t  gcc_rich_location richloc (token->location);\n+\t  richloc.add_range (input_location, false);\n+\t  richloc.add_fixit_remove ();\n+\t  pedwarn_at_rich_loc (&richloc, 0, \"elaborated-type-specifier for \"\n+\t\t\t       \"a scoped enum must not use the %qD keyword\",\n+\t\t\t       token->u.value);\n \t  /* Consume the `struct' or `class' and parse it anyway.  */\n \t  cp_lexer_consume_token (parser->lexer);\n \t}"}, {"sha": "6b1feffebe83e062720b4be8ccc9a9579d3c4aca", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=70caf430fe8b94a213f60ef7798766990da1b311", "patch": "@@ -1,3 +1,7 @@\n+2017-04-25  Volker Reichelt  <v.reichelt@netcologne.de>\n+\n+\t* g++.dg/cpp0x/enum34.C: New test.\n+\n 2017-04-25  Tom de Vries  <tom@codesourcery.com>\n \n \t* lib/gcc-dg.exp (cleanup-after-saved-dg-test): Cleanup line number"}, {"sha": "6bc72de8f984023448678e62ec7a57ca01553329", "filename": "gcc/testsuite/g++.dg/cpp0x/enum34.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fenum34.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70caf430fe8b94a213f60ef7798766990da1b311/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fenum34.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fenum34.C?ref=70caf430fe8b94a213f60ef7798766990da1b311", "patch": "@@ -0,0 +1,11 @@\n+// { dg-options \"-fdiagnostics-show-caret\" }\n+// { dg-do compile { target c++11 } }\n+\n+enum class E;\n+\n+enum class E e;  /* { dg-warning \"scoped enum must not use\" }\n+  { dg-begin-multiline-output \"\" }\n+ enum class E e;\n+ ~~~~ ^~~~~\n+      -----\n+  { dg-end-multiline-output \"\" } */"}]}