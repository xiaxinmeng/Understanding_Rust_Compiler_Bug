{"sha": "61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjFlMGIyMzM1M2YyNWQxMmZkMTkyNWNjZDJhYWFmMTlmNTZkZGJjYg==", "commit": {"author": {"name": "Eric Botcazou", "email": "ebotcazou@adacore.com", "date": "2015-03-16T09:59:01Z"}, "committer": {"name": "Eric Botcazou", "email": "ebotcazou@gcc.gnu.org", "date": "2015-03-16T09:59:01Z"}, "message": "utils2.c (gnat_invariant_expr): Return null if the type of the expression ends up being composite.\n\n\t* gcc-interface/utils2.c (gnat_invariant_expr): Return null if the type\n\tof the expression ends up being composite.\n\nFrom-SVN: r221449", "tree": {"sha": "7c70e180d4bfd57e81574e83006ce113fff743ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7c70e180d4bfd57e81574e83006ce113fff743ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/comments", "author": null, "committer": null, "parents": [{"sha": "261cb0d3eb5e8160b88d729a2be684110ff48831", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/261cb0d3eb5e8160b88d729a2be684110ff48831", "html_url": "https://github.com/Rust-GCC/gccrs/commit/261cb0d3eb5e8160b88d729a2be684110ff48831"}], "stats": {"total": 54, "additions": 54, "deletions": 0}, "files": [{"sha": "e81f0150e9a732c6bd3f236204930cc13798913c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "patch": "@@ -1,3 +1,8 @@\n+2015-03-16  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gcc-interface/utils2.c (gnat_invariant_expr): Return null if the type\n+\tof the expression ends up being composite.\n+\n 2015-03-16  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/decl.c (is_from_limited_with_of_main): New predicate."}, {"sha": "e25b815a5dd14dfc1debeadc91ac6a26b18794c1", "filename": "gcc/ada/gcc-interface/utils2.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Fada%2Fgcc-interface%2Futils2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Fada%2Fgcc-interface%2Futils2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils2.c?ref=61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "patch": "@@ -2805,6 +2805,12 @@ gnat_invariant_expr (tree expr)\n       expr = remove_conversions (expr, false);\n     }\n \n+  /* We are only interested in scalar types at the moment and, even if we may\n+     have gone through padding types in the above loop, we must be back to a\n+     scalar value at this point.  */\n+  if (AGGREGATE_TYPE_P (TREE_TYPE (expr)))\n+    return NULL_TREE;\n+\n   if (TREE_CONSTANT (expr))\n     return fold_convert (type, expr);\n "}, {"sha": "d68e7a02f979d29f4887df770b2773fabbc4cc3c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "patch": "@@ -1,3 +1,8 @@\n+2015-03-16  Eric Botcazou  <ebotcazou@adacore.com>\n+\n+\t* gnat.dg/loop_optimization18.ad[sb]: New test.\n+\t* gnat.dg/loop_optimization18_pkg.ads: New helper.\n+\n 2015-03-16  Alan Modra  <amodra@gmail.com>\n \n \t* gcc.target/powerpc/pr53199.c: Add extra functions.  Revert"}, {"sha": "eb4eeca32e28474ea54d49e460d425afb0401e2b", "filename": "gcc/testsuite/gnat.dg/loop_optimization18.adb", "status": "added", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18.adb?ref=61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "patch": "@@ -0,0 +1,16 @@\n+-- { dg-do compile }\n+-- { dg-options \"-O3\" }\n+\n+package body Loop_Optimization18 is\n+\n+   procedure Proc (Message : Byte_Array_Type) is\n+\n+      R : Rec (Conv (Message));\n+\n+   begin\n+      for Division in 1 .. R.UB loop\n+         R.L (Division) := 0;\n+      end loop;\n+  end;\n+\n+end Loop_Optimization18;"}, {"sha": "c9f3e2a1eb99a7361bee53d0b5e0ffbc94486b8a", "filename": "gcc/testsuite/gnat.dg/loop_optimization18.ads", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18.ads?ref=61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "patch": "@@ -0,0 +1,7 @@\n+with Loop_Optimization18_Pkg; use Loop_Optimization18_Pkg;\n+\n+package Loop_Optimization18 is\n+\n+   procedure Proc (Message : Byte_Array_Type);\n+\n+end Loop_Optimization18;"}, {"sha": "9fb3311ca031e7583f2fc426bbfa35aaf50ed58b", "filename": "gcc/testsuite/gnat.dg/loop_optimization18_pkg.ads", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18_pkg.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18_pkg.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Floop_optimization18_pkg.ads?ref=61e0b23353f25d12fd1925ccd2aaaf19f56ddbcb", "patch": "@@ -0,0 +1,15 @@\n+with Unchecked_Conversion;\n+\n+package Loop_Optimization18_Pkg is\n+\n+   type Arr is array (Integer range <>) of Natural;\n+\n+   type Rec (UB : Integer) is record\n+      L : Arr (1 .. UB);\n+   end record;\n+\n+   type Byte_Array_Type is new String (1..4);\n+\n+   function Conv is new Unchecked_Conversion (Byte_Array_Type, Integer);\n+\n+end Loop_Optimization18_Pkg;"}]}