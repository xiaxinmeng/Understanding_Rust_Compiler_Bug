{"sha": "9c250803adc9d4223e85a8d6018dde659d9b15cf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWMyNTA4MDNhZGM5ZDQyMjNlODVhOGQ2MDE4ZGRlNjU5ZDliMTVjZg==", "commit": {"author": {"name": "James Clarke", "email": "jrtc27@jrtc27.com", "date": "2014-09-14T08:05:43Z"}, "committer": {"name": "Fran\u00e7ois-Xavier Coudert", "email": "fxcoudert@gcc.gnu.org", "date": "2014-09-14T08:05:43Z"}, "message": "re PR target/61407 (Build errors on latest OS X 10.10 Yosemite with Xcode 6 on GCC 4.8.3)\n\n\tPR target/61407\n\n\t* config/darwin-c.c (version_as_macro): Added extra 0 for OS X 10.10\n\tand above.\n\t* config/darwin-driver.c (darwin_find_version_from_kernel): Removed\n\tkernel version check to avoid incrementing it after every major OS X\n\trelease.\n\t(darwin_default_min_version): Avoid static memory buffer.\n\n\t* gcc.dg/darwin-minversion-1.c: Fixed formatting\n\t* gcc.dg/darwin-minversion-2.c: Fixed formatting\n\t* gcc.dg/darwin-minversion-3.c: Fixed formatting\n\t* gcc.dg/darwin-minversion-4.c: Added test for OS X 10.10\n\nCo-Authored-By: Francois-Xavier Coudert <fxcoudert@gcc.gnu.org>\n\nFrom-SVN: r215251", "tree": {"sha": "069dab1e3c9363a471236a95152a5f4b55550d53", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/069dab1e3c9363a471236a95152a5f4b55550d53"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9c250803adc9d4223e85a8d6018dde659d9b15cf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c250803adc9d4223e85a8d6018dde659d9b15cf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9c250803adc9d4223e85a8d6018dde659d9b15cf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9c250803adc9d4223e85a8d6018dde659d9b15cf/comments", "author": {"login": "jrtc27", "id": 816232, "node_id": "MDQ6VXNlcjgxNjIzMg==", "avatar_url": "https://avatars.githubusercontent.com/u/816232?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jrtc27", "html_url": "https://github.com/jrtc27", "followers_url": "https://api.github.com/users/jrtc27/followers", "following_url": "https://api.github.com/users/jrtc27/following{/other_user}", "gists_url": "https://api.github.com/users/jrtc27/gists{/gist_id}", "starred_url": "https://api.github.com/users/jrtc27/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jrtc27/subscriptions", "organizations_url": "https://api.github.com/users/jrtc27/orgs", "repos_url": "https://api.github.com/users/jrtc27/repos", "events_url": "https://api.github.com/users/jrtc27/events{/privacy}", "received_events_url": "https://api.github.com/users/jrtc27/received_events", "type": "User", "site_admin": false}, "committer": {"login": "fxcoudert", "id": 1980544, "node_id": "MDQ6VXNlcjE5ODA1NDQ=", "avatar_url": "https://avatars.githubusercontent.com/u/1980544?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fxcoudert", "html_url": "https://github.com/fxcoudert", "followers_url": "https://api.github.com/users/fxcoudert/followers", "following_url": "https://api.github.com/users/fxcoudert/following{/other_user}", "gists_url": "https://api.github.com/users/fxcoudert/gists{/gist_id}", "starred_url": "https://api.github.com/users/fxcoudert/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fxcoudert/subscriptions", "organizations_url": "https://api.github.com/users/fxcoudert/orgs", "repos_url": "https://api.github.com/users/fxcoudert/repos", "events_url": "https://api.github.com/users/fxcoudert/events{/privacy}", "received_events_url": "https://api.github.com/users/fxcoudert/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a09cece359e3f0723a843f257fdb0544c825735", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a09cece359e3f0723a843f257fdb0544c825735", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a09cece359e3f0723a843f257fdb0544c825735"}], "stats": {"total": 101, "additions": 73, "deletions": 28}, "files": [{"sha": "416f3c2b088b438926525372bf810190e6fd3c92", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -1,3 +1,14 @@\n+2014-09-14  James Clarke  <jrtc27@jrtc27.com>\n+\t    Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n+\n+\tPR target/61407\n+\t* config/darwin-c.c (version_as_macro): Added extra 0 for OS X 10.10\n+\tand above.\n+\t* config/darwin-driver.c (darwin_find_version_from_kernel): Removed\n+\tkernel version check to avoid incrementing it after every major OS X\n+\trelease.\n+\t(darwin_default_min_version): Avoid static memory buffer.\n+\n 2014-09-13  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* tree.c (need_assembler_name_p): Store C++ type mangling only\n@@ -79,6 +90,7 @@\n \t(pdp11_scalar_mode_supported_p): New function.\n \t* config/rl78/rl78.h (LIBGCC2_HAS_DF_MODE): Remove.\n \t* config/rx/rx.h (LIBGCC2_HAS_DF_MODE): Remove.\n+\n 2014-09-12  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/63237"}, {"sha": "f3d7aa521de8e6fc51cd499cd8b4f3e74fceb77c", "filename": "gcc/config/darwin-c.c", "status": "modified", "additions": 19, "deletions": 6, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Fconfig%2Fdarwin-c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Fconfig%2Fdarwin-c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-c.c?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -571,21 +571,34 @@ find_subframework_header (cpp_reader *pfile, const char *header, cpp_dir **dirp)\n }\n \n /* Return the value of darwin_macosx_version_min suitable for the\n-   __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ macro,\n-   so '10.4.2' becomes 1040.  The lowest digit is always zero.\n+   __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ macro, so '10.4.2'\n+   becomes 1040 and '10.10.0' becomes 101000.  The lowest digit is\n+   always zero, as is the second lowest for '10.10.x' and above.\n    Print a warning if the version number can't be understood.  */\n static const char *\n version_as_macro (void)\n {\n-  static char result[] = \"1000\";\n+  static char result[7] = \"1000\";\n+  int minorDigitIdx;\n \n   if (strncmp (darwin_macosx_version_min, \"10.\", 3) != 0)\n     goto fail;\n   if (! ISDIGIT (darwin_macosx_version_min[3]))\n     goto fail;\n-  result[2] = darwin_macosx_version_min[3];\n-  if (darwin_macosx_version_min[4] != '\\0'\n-      && darwin_macosx_version_min[4] != '.')\n+\n+  minorDigitIdx = 3;\n+  result[2] = darwin_macosx_version_min[minorDigitIdx++];\n+  if (ISDIGIT (darwin_macosx_version_min[minorDigitIdx]))\n+  {\n+    /* Starting with OS X 10.10, the macro ends '00' rather than '0',\n+       i.e. 10.10.x becomes 101000 rather than 10100.  */\n+    result[3] = darwin_macosx_version_min[minorDigitIdx++];\n+    result[4] = '0';\n+    result[5] = '0';\n+    result[6] = '\\0';\n+  }\n+  if (darwin_macosx_version_min[minorDigitIdx] != '\\0'\n+      && darwin_macosx_version_min[minorDigitIdx] != '.')\n     goto fail;\n \n   return result;"}, {"sha": "541e10bc098b49bf97aa74db262a6a79c952c994", "filename": "gcc/config/darwin-driver.c", "status": "modified", "additions": 16, "deletions": 19, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Fconfig%2Fdarwin-driver.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Fconfig%2Fdarwin-driver.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-driver.c?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -29,8 +29,8 @@ along with GCC; see the file COPYING3.  If not see\n #include <sys/sysctl.h>\n #include \"xregex.h\"\n \n-static bool\n-darwin_find_version_from_kernel (char *new_flag)\n+static char *\n+darwin_find_version_from_kernel (void)\n {\n   char osversion[32];\n   size_t osversion_len = sizeof (osversion) - 1;\n@@ -39,14 +39,15 @@ darwin_find_version_from_kernel (char *new_flag)\n   char minor_vers[6];\n   char * version_p;\n   char * version_pend;\n+  char * new_flag;\n \n   /* Determine the version of the running OS.  If we can't, warn user,\n      and do nothing.  */\n   if (sysctl (osversion_name, ARRAY_SIZE (osversion_name), osversion,\n \t      &osversion_len, NULL, 0) == -1)\n     {\n       warning (0, \"sysctl for kern.osversion failed: %m\");\n-      return false;\n+      return NULL;\n     }\n \n   /* Try to parse the first two parts of the OS version number.  Warn\n@@ -57,8 +58,6 @@ darwin_find_version_from_kernel (char *new_flag)\n   version_p = osversion + 1;\n   if (ISDIGIT (*version_p))\n     major_vers = major_vers * 10 + (*version_p++ - '0');\n-  if (major_vers > 4 + 9)\n-    goto parse_failed;\n   if (*version_p++ != '.')\n     goto parse_failed;\n   version_pend = strchr(version_p, '.');\n@@ -74,17 +73,16 @@ darwin_find_version_from_kernel (char *new_flag)\n   if (major_vers - 4 <= 4)\n     /* On 10.4 and earlier, the old linker is used which does not\n        support three-component system versions.  */\n-    sprintf (new_flag, \"10.%d\", major_vers - 4);\n+    asprintf (&new_flag, \"10.%d\", major_vers - 4);\n   else\n-    sprintf (new_flag, \"10.%d.%s\", major_vers - 4,\n-\t     minor_vers);\n+    asprintf (&new_flag, \"10.%d.%s\", major_vers - 4, minor_vers);\n \n-  return true;\n+  return new_flag;\n \n  parse_failed:\n   warning (0, \"couldn%'t understand kern.osversion %q.*s\",\n \t   (int) osversion_len, osversion);\n-  return false;\n+  return NULL;\n }\n \n #endif\n@@ -105,7 +103,7 @@ darwin_default_min_version (unsigned int *decoded_options_count,\n   const unsigned int argc = *decoded_options_count;\n   struct cl_decoded_option *const argv = *decoded_options;\n   unsigned int i;\n-  static char new_flag[sizeof (\"10.0.0\") + 6];\n+  const char *new_flag;\n \n   /* If the command-line is empty, just return.  */\n   if (argc <= 1)\n@@ -142,16 +140,16 @@ darwin_default_min_version (unsigned int *decoded_options_count,\n \n #ifndef CROSS_DIRECTORY_STRUCTURE\n \n- /* Try to find the version from the kernel, if we fail - we print a message \n-    and give up.  */\n- if (!darwin_find_version_from_kernel (new_flag))\n-   return;\n+  /* Try to find the version from the kernel, if we fail - we print a message \n+     and give up.  */\n+  new_flag = darwin_find_version_from_kernel ();\n+  if (!new_flag)\n+    return;\n \n #else\n \n- /* For cross-compilers, default to the target OS version. */\n-\n- strncpy (new_flag, DEF_MIN_OSX_VERSION, sizeof (new_flag));\n+  /* For cross-compilers, default to the target OS version. */\n+  new_flag = DEF_MIN_OSX_VERSION;\n \n #endif /* CROSS_DIRECTORY_STRUCTURE */\n \n@@ -165,7 +163,6 @@ darwin_default_min_version (unsigned int *decoded_options_count,\n   memcpy (*decoded_options + 2, argv + 1,\n \t  (argc - 1) * sizeof (struct cl_decoded_option));\n   return;\n-  \n }\n \n /* Translate -filelist and -framework options in *DECODED_OPTIONS"}, {"sha": "1e9aefb54ee651b2a6c1efafb9a3ba12d7e63aa0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -1,3 +1,11 @@\n+2014-09-14  James Clarke  <jrtc27@jrtc27.com>\n+\n+\tPR target/61407\n+\t* gcc.dg/darwin-minversion-1.c: Fixed formatting\n+\t* gcc.dg/darwin-minversion-2.c: Fixed formatting\n+\t* gcc.dg/darwin-minversion-3.c: Fixed formatting\n+\t* gcc.dg/darwin-minversion-4.c: Added test for OS X 10.10\n+\n 2014-09-13  Marek Polacek  <polacek@redhat.com>\n \n \tPR c++/60862"}, {"sha": "6221d617b2e5d8d80eeaa7a743a320d0d3061509", "filename": "gcc/testsuite/gcc.dg/darwin-minversion-1.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-1.c?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -2,7 +2,8 @@\n /* { dg-options \"-mmacosx-version-min=10.1\" } */\n /* { dg-do run { target *-*-darwin* } } */\n \n-int main(void)\n+int\n+main ()\n {\n #if __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ != 1010\n   fail me;"}, {"sha": "8e18d5273a6b539e035929507846c3f293ae9c1f", "filename": "gcc/testsuite/gcc.dg/darwin-minversion-2.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-2.c?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -2,7 +2,8 @@\n /* { dg-options \"-mmacosx-version-min=10.1 -mmacosx-version-min=10.3\" } */\n /* { dg-do run { target *-*-darwin* } } */\n \n-int main(void)\n+int\n+main ()\n {\n #if __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ != 1030\n   fail me;"}, {"sha": "4fcb9693cd4888a4e0795ce1506c45659c47cd15", "filename": "gcc/testsuite/gcc.dg/darwin-minversion-3.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-3.c?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -2,7 +2,8 @@\n /* { dg-options \"-mmacosx-version-min=10.4.10\" } */\n /* { dg-do compile { target *-*-darwin* } } */\n \n-int main(void)\n+int\n+main ()\n {\n #if __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ != 1040\n   fail me;"}, {"sha": "1cb42ebe3e9eb8692cc326d120405d159d387082", "filename": "gcc/testsuite/gcc.dg/darwin-minversion-4.c", "status": "added", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-4.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9c250803adc9d4223e85a8d6018dde659d9b15cf/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-4.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fdarwin-minversion-4.c?ref=9c250803adc9d4223e85a8d6018dde659d9b15cf", "patch": "@@ -0,0 +1,12 @@\n+/* Test that major versions greater than 9 work and have the additional 0.  */\n+/* { dg-options \"-mmacosx-version-min=10.10.0\" } */\n+/* { dg-do compile { target *-*-darwin* } } */\n+\n+int\n+main ()\n+{\n+#if __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ != 101000\n+  fail me;\n+#endif\n+  return 0;\n+}"}]}