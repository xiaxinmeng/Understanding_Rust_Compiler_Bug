{"sha": "8bc243943765f969c0d4625721a9944e9516d013", "node_id": "C_kwDOANBUbNoAKDhiYzI0Mzk0Mzc2NWY5NjljMGQ0NjI1NzIxYTk5NDRlOTUxNmQwMTM", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-07T08:46:01Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2022-07-07T10:03:45Z"}, "message": "target/106219 - proprly mark builtins pure via ix86_add_new_builtins\n\nThe target optimize pragma path to initialize extra target specific\nbuiltins missed handling of the pure_p flag which in turn causes\nextra clobber side-effects of gather builtins leading to unexpected\nissues downhill.\n\n\tPR target/106219\n\t* config/i386/i386-builtins.cc (ix86_add_new_builtins): Properly\n\tset DECL_PURE_P.\n\n\t* g++.dg/pr106219.C: New testcase.", "tree": {"sha": "8b5330844f9861efada959656ceb6e369b397c59", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8b5330844f9861efada959656ceb6e369b397c59"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8bc243943765f969c0d4625721a9944e9516d013", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bc243943765f969c0d4625721a9944e9516d013", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8bc243943765f969c0d4625721a9944e9516d013", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bc243943765f969c0d4625721a9944e9516d013/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c1b1c4e58bda152ae932b45396ab67b07dd8c3fe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c1b1c4e58bda152ae932b45396ab67b07dd8c3fe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c1b1c4e58bda152ae932b45396ab67b07dd8c3fe"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "fe7243c3837514156b6dcc8016e60d2cd54ae77e", "filename": "gcc/config/i386/i386-builtins.cc", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bc243943765f969c0d4625721a9944e9516d013/gcc%2Fconfig%2Fi386%2Fi386-builtins.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bc243943765f969c0d4625721a9944e9516d013/gcc%2Fconfig%2Fi386%2Fi386-builtins.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fi386%2Fi386-builtins.cc?ref=8bc243943765f969c0d4625721a9944e9516d013", "patch": "@@ -385,6 +385,8 @@ ix86_add_new_builtins (HOST_WIDE_INT isa, HOST_WIDE_INT isa2)\n \t  ix86_builtins[i] = decl;\n \t  if (ix86_builtins_isa[i].const_p)\n \t    TREE_READONLY (decl) = 1;\n+\t  if (ix86_builtins_isa[i].pure_p)\n+\t    DECL_PURE_P (decl) = 1;\n \t}\n     }\n "}, {"sha": "3cad1507d5f6ab8bd13a4a4e5007bcae308988f6", "filename": "gcc/testsuite/g++.dg/pr106219.C", "status": "added", "additions": 31, "deletions": 0, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bc243943765f969c0d4625721a9944e9516d013/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr106219.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bc243943765f969c0d4625721a9944e9516d013/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr106219.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fpr106219.C?ref=8bc243943765f969c0d4625721a9944e9516d013", "patch": "@@ -0,0 +1,31 @@\n+// { dg-do compile }\n+// { dg-options \"-O3\" }\n+// { dg-additional-options \"-march=bdver2\" { target x86_64-*-* } }\n+\n+int max(int __b) {\n+  if (0 < __b)\n+    return __b;\n+  return 0;\n+}\n+struct Plane {\n+  Plane(int, int);\n+  int *Row();\n+};\n+#ifdef __x86_64__\n+#pragma GCC target \"sse2,ssse3,avx,avx2\"\n+#endif\n+float *ConvolveXSampleAndTranspose_rowp;\n+int ConvolveXSampleAndTranspose_res, ConvolveXSampleAndTranspose_r;\n+void ConvolveXSampleAndTranspose() {\n+  Plane out(0, ConvolveXSampleAndTranspose_res);\n+  for (int y;;) {\n+    float sum;\n+    for (int i = ConvolveXSampleAndTranspose_r; i; ++i)\n+      sum += i;\n+    for (; ConvolveXSampleAndTranspose_r; ++ConvolveXSampleAndTranspose_r)\n+      sum +=\n+          ConvolveXSampleAndTranspose_rowp[max(ConvolveXSampleAndTranspose_r)] *\n+          ConvolveXSampleAndTranspose_r;\n+    out.Row()[y] = sum;\n+  }\n+}"}]}