{"sha": "e8bd800e45b432c80294945265888aac20add1ff", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZThiZDgwMGU0NWI0MzJjODAyOTQ5NDUyNjU4ODhhYWMyMGFkZDFmZg==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@markmitchell.com", "date": "1998-08-27T00:14:27Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "1998-08-27T00:14:27Z"}, "message": "decl.c (build_enumerator): Set DECL_CONTEXT for the CONST_DECLs.\n\n\t* decl.c (build_enumerator): Set DECL_CONTEXT for the\n\tCONST_DECLs.\n\nFrom-SVN: r22014", "tree": {"sha": "e41ca766518f71e3d817f12f88938631eb0a2efa", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e41ca766518f71e3d817f12f88938631eb0a2efa"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e8bd800e45b432c80294945265888aac20add1ff", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e8bd800e45b432c80294945265888aac20add1ff", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e8bd800e45b432c80294945265888aac20add1ff", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e8bd800e45b432c80294945265888aac20add1ff/comments", "author": null, "committer": null, "parents": [{"sha": "563f648be5df0a2c3cd0a490ce3f4e72c54f32f6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/563f648be5df0a2c3cd0a490ce3f4e72c54f32f6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/563f648be5df0a2c3cd0a490ce3f4e72c54f32f6"}], "stats": {"total": 68, "additions": 44, "deletions": 24}, "files": [{"sha": "636fc12c76c81e8758d87a1041ec2733c63264c8", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8bd800e45b432c80294945265888aac20add1ff/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8bd800e45b432c80294945265888aac20add1ff/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e8bd800e45b432c80294945265888aac20add1ff", "patch": "@@ -1,3 +1,8 @@\n+1998-08-27  Mark Mitchell  <mark@markmitchell.com>\n+\n+\t* decl.c (build_enumerator): Set DECL_CONTEXT for the\n+\tCONST_DECLs. \n+\n 1998-08-26  Mark Mitchell  <mark@markmitchell.com>\n \n \t* cp-tree.h (finish_enum): Change prototype."}, {"sha": "ad52979fb8e28e5beac5955410bb7e95c6f292ba", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 26, "deletions": 24, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8bd800e45b432c80294945265888aac20add1ff/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8bd800e45b432c80294945265888aac20add1ff/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=e8bd800e45b432c80294945265888aac20add1ff", "patch": "@@ -11994,6 +11994,7 @@ build_enumerator (name, value)\n      tree name, value;\n {\n   tree decl, result;\n+  tree context;\n \n   /* Remove no-op casts from the value.  */\n   if (value)\n@@ -12042,30 +12043,31 @@ build_enumerator (name, value)\n    value = copy_node (value);\n \n   /* C++ associates enums with global, function, or class declarations.  */\n-\n-  decl = current_scope ();\n-  if (decl && decl == current_class_type)\n-    {\n-      /* This enum declaration is local to the class, so we must put\n-\t it in that class's list of decls.  */\n-      decl = build_lang_field_decl (CONST_DECL, name, integer_type_node);\n-      DECL_INITIAL (decl) = value;\n-      TREE_READONLY (decl) = 1;\n-      pushdecl_class_level (decl);\n-      TREE_CHAIN (decl) = current_local_enum;\n-      current_local_enum = decl;\n-    }\n-  else\n-    {\n-      /* It's a global enum, or it's local to a function.  (Note local to\n-\t a function could mean local to a class method.  */\n-      decl = build_decl (CONST_DECL, name, integer_type_node);\n-      DECL_INITIAL (decl) = value;\n-      TREE_READONLY (decl) = 1;\n-\n-      pushdecl (decl);\n-      GNU_xref_decl (current_function_decl, decl);\n-    }\n+ \n+ context = current_scope ();\n+ if (context && context == current_class_type)\n+   /* This enum declaration is local to the class.  */\n+   decl = build_lang_field_decl (CONST_DECL, name, integer_type_node);\n+ else\n+   /* It's a global enum, or it's local to a function.  (Note local to\n+      a function could mean local to a class method.  */\n+   decl = build_decl (CONST_DECL, name, integer_type_node);\n+\n+ DECL_CONTEXT (decl) = FROB_CONTEXT (context);\n+ DECL_INITIAL (decl) = value;\n+ TREE_READONLY (decl) = 1;\n+\n+ if (context && context == current_class_type)\n+   {\n+     pushdecl_class_level (decl);\n+     TREE_CHAIN (decl) = current_local_enum;\n+     current_local_enum = decl;\n+   }\n+ else\n+   {\n+     pushdecl (decl);\n+     GNU_xref_decl (current_function_decl, decl);\n+   }\n \n  if (! processing_template_decl)\n    {"}, {"sha": "96aeaa689cc4ff139ab276a1a56d5f55771dc944", "filename": "gcc/testsuite/g++.old-deja/g++.pt/enum9.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e8bd800e45b432c80294945265888aac20add1ff/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fenum9.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e8bd800e45b432c80294945265888aac20add1ff/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fenum9.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.pt%2Fenum9.C?ref=e8bd800e45b432c80294945265888aac20add1ff", "patch": "@@ -0,0 +1,13 @@\n+// Build don't link:\n+\n+template <typename _CharT>\n+class _Format_cache\n+{\n+public:  \n+  enum {   \n+    _S_digits,   _S_digits_end = _S_digits+10,\n+    _S_xdigits = _S_digits_end,\n+  };\n+};\n+\n+template class _Format_cache<int>;"}]}