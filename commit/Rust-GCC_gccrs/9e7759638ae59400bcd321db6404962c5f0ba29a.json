{"sha": "9e7759638ae59400bcd321db6404962c5f0ba29a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWU3NzU5NjM4YWU1OTQwMGJjZDMyMWRiNjQwNDk2MmM1ZjBiYTI5YQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-03-18T09:54:21Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-03-18T09:54:21Z"}, "message": "re PR libgomp/35625 (schedule(guided) loops forever if ((end - start) % incr) != 0)\n\n\tPR libgomp/35625\n\t* iter.c (gomp_iter_guided_next_locked): If q > n, set end to ws->end.\n\t(gomp_iter_guided_next): Likewise.\n\t* testsuite/libgomp.c/pr35625.c: New test.\n\nFrom-SVN: r133306", "tree": {"sha": "d01dbe463d0b40bd2cac5bd2b07a86da47384d6c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d01dbe463d0b40bd2cac5bd2b07a86da47384d6c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9e7759638ae59400bcd321db6404962c5f0ba29a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e7759638ae59400bcd321db6404962c5f0ba29a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9e7759638ae59400bcd321db6404962c5f0ba29a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9e7759638ae59400bcd321db6404962c5f0ba29a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "483d8a4ab5b42d38d24deb698f7ac74780e953b6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/483d8a4ab5b42d38d24deb698f7ac74780e953b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/483d8a4ab5b42d38d24deb698f7ac74780e953b6"}], "stats": {"total": 47, "additions": 36, "deletions": 11}, "files": [{"sha": "5c548844a7a1bc99432567265e905e65e92401d0", "filename": "libgomp/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e7759638ae59400bcd321db6404962c5f0ba29a/libgomp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e7759638ae59400bcd321db6404962c5f0ba29a/libgomp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2FChangeLog?ref=9e7759638ae59400bcd321db6404962c5f0ba29a", "patch": "@@ -1,3 +1,10 @@\n+2008-03-18  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR libgomp/35625\n+\t* iter.c (gomp_iter_guided_next_locked): If q > n, set end to ws->end.\n+\t(gomp_iter_guided_next): Likewise.\n+\t* testsuite/libgomp.c/pr35625.c: New test.\n+\n 2008-03-16  Ralf Wildenhues  <Ralf.Wildenhues@gmx.de>\n \n \t* aclocal.m4: Regenerate."}, {"sha": "2d5dd2edd5a74f97343981b3be8f5a07d4c9f225", "filename": "libgomp/iter.c", "status": "modified", "additions": 11, "deletions": 11, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e7759638ae59400bcd321db6404962c5f0ba29a/libgomp%2Fiter.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e7759638ae59400bcd321db6404962c5f0ba29a/libgomp%2Fiter.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Fiter.c?ref=9e7759638ae59400bcd321db6404962c5f0ba29a", "patch": "@@ -242,16 +242,16 @@ gomp_iter_guided_next_locked (long *pstart, long *pend)\n   if (ws->next == ws->end)\n     return false;\n \n-  n = (ws->end - ws->next) / ws->incr;\n+  start = ws->next;\n+  n = (ws->end - start) / ws->incr;\n   q = (n + nthreads - 1) / nthreads;\n \n   if (q < ws->chunk_size)\n     q = ws->chunk_size;\n-  if (q > n)\n-    q = n;\n-\n-  start = ws->next;\n-  end = start + q * ws->incr;\n+  if (q <= n)\n+    end = start + q * ws->incr;\n+  else\n+    end = ws->end;\n \n   ws->next = end;\n   *pstart = start;\n@@ -286,15 +286,15 @@ gomp_iter_guided_next (long *pstart, long *pend)\n       if (start == end)\n \treturn false;\n \n-      n = (end - start) / ws->incr;\n+      n = (end - start) / incr;\n       q = (n + nthreads - 1) / nthreads;\n \n       if (q < chunk_size)\n \tq = chunk_size;\n-      if (q > n)\n-\tq = n;\n-\n-      nend = start + q * incr;\n+      if (__builtin_expect (q <= n, 1))\n+\tnend = start + q * incr;\n+      else\n+\tnend = end;\n \n       tmp = __sync_val_compare_and_swap (&ws->next, start, nend);\n       if (__builtin_expect (tmp == start, 1))"}, {"sha": "f2978f91164caeaae638dabd15fc7a1259ab181b", "filename": "libgomp/testsuite/libgomp.c/pr35625.c", "status": "added", "additions": 18, "deletions": 0, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9e7759638ae59400bcd321db6404962c5f0ba29a/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr35625.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9e7759638ae59400bcd321db6404962c5f0ba29a/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr35625.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgomp%2Ftestsuite%2Flibgomp.c%2Fpr35625.c?ref=9e7759638ae59400bcd321db6404962c5f0ba29a", "patch": "@@ -0,0 +1,18 @@\n+/* PR libgomp/35625 */\n+/* { dg-do run } */\n+/* { dg-options \"-std=c99\" } */\n+\n+int\n+main (void)\n+{\n+#pragma omp parallel\n+  {\n+    #pragma omp for schedule (guided, 10)\n+      for (int i = 0; i < 1826; i += 10)\n+\t;\n+    #pragma omp for schedule (guided, 10)\n+      for (int i = 0; i > -1826; i -= 10)\n+\t;\n+  }\n+  return 0;\n+}"}]}