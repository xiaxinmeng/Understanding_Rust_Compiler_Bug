{"sha": "acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWNmNmI3YWIzMGRjZWI5NjliZjMwYWI5NjZlYTIyYWNkZDA2YWNhNg==", "commit": {"author": {"name": "Samuel Tardieu", "email": "sam@rfc1149.net", "date": "2008-02-27T12:12:14Z"}, "committer": {"name": "Samuel Tardieu", "email": "sam@gcc.gnu.org", "date": "2008-02-27T12:12:14Z"}, "message": "re PR ada/22255 (Reset on shared file causes Use_Error.)\n\n    gcc/ada/\n\tPR ada/22255\n\t* s-fileio.adb (Reset): Do not raise Use_Error if mode isn't changed.\n\n    gcc/testsuite/\n\tPR ada/22255\n\t* gnat.dg/test_direct_io.adb: New file.\n\nFrom-SVN: r132708", "tree": {"sha": "dea6ecdd948269cf4c4c4ca2fd972c247c37c153", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/dea6ecdd948269cf4c4c4ca2fd972c247c37c153"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/comments", "author": {"login": "samueltardieu", "id": 44656, "node_id": "MDQ6VXNlcjQ0NjU2", "avatar_url": "https://avatars.githubusercontent.com/u/44656?v=4", "gravatar_id": "", "url": "https://api.github.com/users/samueltardieu", "html_url": "https://github.com/samueltardieu", "followers_url": "https://api.github.com/users/samueltardieu/followers", "following_url": "https://api.github.com/users/samueltardieu/following{/other_user}", "gists_url": "https://api.github.com/users/samueltardieu/gists{/gist_id}", "starred_url": "https://api.github.com/users/samueltardieu/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/samueltardieu/subscriptions", "organizations_url": "https://api.github.com/users/samueltardieu/orgs", "repos_url": "https://api.github.com/users/samueltardieu/repos", "events_url": "https://api.github.com/users/samueltardieu/events{/privacy}", "received_events_url": "https://api.github.com/users/samueltardieu/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f5c064ab04a306a571f36b1d59db2c0337433f3e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f5c064ab04a306a571f36b1d59db2c0337433f3e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f5c064ab04a306a571f36b1d59db2c0337433f3e"}], "stats": {"total": 41, "additions": 34, "deletions": 7}, "files": [{"sha": "d86bfeb22eb3a8c18158f8565022e2c53a7bd241", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "patch": "@@ -1,3 +1,8 @@\n+2008-02-27  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/22255\n+\t* s-fileio.adb (Reset): Do not raise Use_Error if mode isn't changed.\n+\n 2008-02-27  Samuel Tardieu  <sam@rfc1149.net>\n \n \tPR ada/34799"}, {"sha": "4a8393c00cbf5a0452f0ccbea02c823ad23a4e5b", "filename": "gcc/ada/s-fileio.adb", "status": "modified", "additions": 9, "deletions": 7, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Fada%2Fs-fileio.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Fada%2Fs-fileio.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fs-fileio.adb?ref=acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "patch": "@@ -1074,13 +1074,15 @@ package body System.File_IO is\n    begin\n       Check_File_Open (File);\n \n-      --  Change of mode not allowed for shared file or file with no name\n-      --  or file that is not a regular file, or for a system file.\n-\n-      if File.Shared_Status = Yes\n-        or else File.Name'Length <= 1\n-        or else File.Is_System_File\n-        or else not File.Is_Regular_File\n+      --  Change of mode not allowed for shared file or file with no name or\n+      --  file that is not a regular file, or for a system file. Note that we\n+      --  allow the \"change\" of mode if it is not in fact doing a change.\n+\n+      if Mode /= File.Mode\n+        and then (File.Shared_Status = Yes\n+                    or else File.Name'Length <= 1\n+                    or else File.Is_System_File\n+                    or else not File.Is_Regular_File)\n       then\n          raise Use_Error;\n "}, {"sha": "8d5fff7cf2bfee588e13b051ec34d64b06b7be00", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "patch": "@@ -1,3 +1,8 @@\n+2008-02-27  Samuel Tardieu  <sam@rfc1149.net>\n+\n+\tPR ada/22255\n+\t* gnat.dg/test_direct_io.adb: New file.\n+\n 2008-02-27  Samuel Tardieu  <sam@rfc1149.net>\n \n \tPR ada/34799"}, {"sha": "0eb8aa20808e0b9cf714378ff2e37ca1977918cc", "filename": "gcc/testsuite/gnat.dg/test_direct_io.adb", "status": "added", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Ftestsuite%2Fgnat.dg%2Ftest_direct_io.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/acf6b7ab30dceb969bf30ab966ea22acdd06aca6/gcc%2Ftestsuite%2Fgnat.dg%2Ftest_direct_io.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgnat.dg%2Ftest_direct_io.adb?ref=acf6b7ab30dceb969bf30ab966ea22acdd06aca6", "patch": "@@ -0,0 +1,15 @@\n+-- { dg-do run }\n+with Ada.Direct_IO;\n+\n+procedure Test_Direct_IO is\n+\n+   package BDIO is new Ada.Direct_IO (Boolean);\n+   use BDIO;\n+\n+   FD : File_Type;\n+\n+begin\n+   Create (FD, Form => \"shared=yes\");\n+   Reset (FD);\n+   Close (FD);\n+end Test_Direct_IO;"}]}