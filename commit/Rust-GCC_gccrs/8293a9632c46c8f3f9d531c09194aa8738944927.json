{"sha": "8293a9632c46c8f3f9d531c09194aa8738944927", "node_id": "C_kwDOANBUbNoAKDgyOTNhOTYzMmM0NmM4ZjNmOWQ1MzFjMDkxOTRhYTg3Mzg5NDQ5Mjc", "commit": {"author": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-09-04T06:00:02Z"}, "committer": {"name": "Aldy Hernandez", "email": "aldyh@redhat.com", "date": "2022-09-04T12:44:10Z"}, "message": "Do not clobber signbit when unioning a NAN.\n\nWhen unioning a known NAN and something else, we're dropping the\nproperties of the NAN, particularly the sign.  This fixes the\noversight.\n\nWith this patch, we should be keeping the sign bit up to date, even in\nthe presence of NANs.\n\ngcc/ChangeLog:\n\n\t* value-range.cc (frange::union_): Do not drop properties when\n\tunioning a NAN with something else.\n\t(range_tests_signed_zeros): Add tests.", "tree": {"sha": "030846febc01c08166501311e33357d2b8a75e5b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/030846febc01c08166501311e33357d2b8a75e5b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8293a9632c46c8f3f9d531c09194aa8738944927", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8293a9632c46c8f3f9d531c09194aa8738944927", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8293a9632c46c8f3f9d531c09194aa8738944927", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8293a9632c46c8f3f9d531c09194aa8738944927/comments", "author": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "committer": {"login": "aldyh", "id": 12937877, "node_id": "MDQ6VXNlcjEyOTM3ODc3", "avatar_url": "https://avatars.githubusercontent.com/u/12937877?v=4", "gravatar_id": "", "url": "https://api.github.com/users/aldyh", "html_url": "https://github.com/aldyh", "followers_url": "https://api.github.com/users/aldyh/followers", "following_url": "https://api.github.com/users/aldyh/following{/other_user}", "gists_url": "https://api.github.com/users/aldyh/gists{/gist_id}", "starred_url": "https://api.github.com/users/aldyh/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/aldyh/subscriptions", "organizations_url": "https://api.github.com/users/aldyh/orgs", "repos_url": "https://api.github.com/users/aldyh/repos", "events_url": "https://api.github.com/users/aldyh/events{/privacy}", "received_events_url": "https://api.github.com/users/aldyh/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6832dd39d7b5ede0122a27633ef1859ce3d893a6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6832dd39d7b5ede0122a27633ef1859ce3d893a6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6832dd39d7b5ede0122a27633ef1859ce3d893a6"}], "stats": {"total": 25, "additions": 21, "deletions": 4}, "files": [{"sha": "c9f42fe272c2f228967058cc534a16148dbe5c4e", "filename": "gcc/value-range.cc", "status": "modified", "additions": 21, "deletions": 4, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8293a9632c46c8f3f9d531c09194aa8738944927/gcc%2Fvalue-range.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8293a9632c46c8f3f9d531c09194aa8738944927/gcc%2Fvalue-range.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvalue-range.cc?ref=8293a9632c46c8f3f9d531c09194aa8738944927", "patch": "@@ -475,19 +475,25 @@ frange::union_ (const vrange &v)\n       return true;\n     }\n \n-  // If one side has a NAN, the union is just the other side plus the\n-  // NAN bit.\n+  // If one side has a NAN, the union is the other side, plus the union\n+  // of the properties and the possibility of a NAN.\n   if (get_nan ().yes_p ())\n     {\n+      frange_props save = m_props;\n       *this = r;\n-      // NOP if NAN already set.\n+      m_props = save;\n+      m_props.union_ (r.m_props);\n       set_nan (fp_prop::VARYING);\n+      if (flag_checking)\n+\tverify_range ();\n       return true;\n     }\n   if (r.get_nan ().yes_p ())\n     {\n-      // NOP if NAN already set.\n+      m_props.union_ (r.m_props);\n       set_nan (fp_prop::VARYING);\n+      if (flag_checking)\n+\tverify_range ();\n       return true;\n     }\n \n@@ -3676,6 +3682,7 @@ range_tests_signed_zeros ()\n {\n   tree zero = build_zero_cst (float_type_node);\n   tree neg_zero = fold_build1 (NEGATE_EXPR, float_type_node, zero);\n+  REAL_VALUE_TYPE q, r;\n   frange r0, r1;\n \n   // Since -0.0 == +0.0, a range of [-0.0, -0.0] should contain +0.0\n@@ -3711,6 +3718,16 @@ range_tests_signed_zeros ()\n   r1.set_signbit (fp_prop::YES);\n   r0.union_ (r1);\n   ASSERT_TRUE (r0.zero_p () && r0.get_signbit ().varying_p ());\n+\n+  // NAN U [5,6] should be [5,6] with no sign info.\n+  r0 = frange_nan (float_type_node);\n+  r1 = frange_float (\"5\", \"6\");\n+  r0.union_ (r1);\n+  real_from_string (&q, \"5\");\n+  real_from_string (&r, \"6\");\n+  ASSERT_TRUE (real_identical (&q, &r0.lower_bound ()));\n+  ASSERT_TRUE (real_identical (&r, &r0.upper_bound ()));\n+  ASSERT_TRUE (r0.get_signbit ().varying_p ());\n }\n \n static void"}]}