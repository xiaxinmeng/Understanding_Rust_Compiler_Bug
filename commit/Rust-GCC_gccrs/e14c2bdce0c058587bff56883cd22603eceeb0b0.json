{"sha": "e14c2bdce0c058587bff56883cd22603eceeb0b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTE0YzJiZGNlMGMwNTg1ODdiZmY1Njg4M2NkMjI2MDNlY2VlYjBiMA==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-10-22T10:44:27Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2020-10-22T10:44:27Z"}, "message": "ipa-modref-tree.c: fix selftest leaks\n\n\"make selftest-valgrind\" was reporting:\n\n40 bytes in 1 blocks are definitely lost in loss record 25 of 735\n   at 0x483AE7D: operator new(unsigned long) (vg_replace_malloc.c:344)\n   by 0xFA0CEA: selftest::test_insert_search_collapse() (ipa-modref-tree.c:40)\n   by 0xFA2F9B: selftest::ipa_modref_tree_c_tests() (ipa-modref-tree.c:164)\n   by 0x256E3AB: selftest::run_tests() (selftest-run-tests.c:93)\n   by 0x1366A8B: toplev::run_self_tests() (toplev.c:2385)\n   by 0x1366C47: toplev::main(int, char**) (toplev.c:2467)\n   by 0x263203F: main (main.c:39)\n\n40 bytes in 1 blocks are definitely lost in loss record 26 of 735\n   at 0x483AE7D: operator new(unsigned long) (vg_replace_malloc.c:344)\n   by 0xFA264A: selftest::test_merge() (ipa-modref-tree.c:123)\n   by 0xFA2FA0: selftest::ipa_modref_tree_c_tests() (ipa-modref-tree.c:165)\n   by 0x256E3AB: selftest::run_tests() (selftest-run-tests.c:93)\n   by 0x1366A8B: toplev::run_self_tests() (toplev.c:2385)\n   by 0x1366C47: toplev::main(int, char**) (toplev.c:2467)\n   by 0x263203F: main (main.c:39)\n\n40 bytes in 1 blocks are definitely lost in loss record 27 of 735\n   at 0x483AE7D: operator new(unsigned long) (vg_replace_malloc.c:344)\n   by 0xFA279E: selftest::test_merge() (ipa-modref-tree.c:130)\n   by 0xFA2FA0: selftest::ipa_modref_tree_c_tests() (ipa-modref-tree.c:165)\n   by 0x256E3AB: selftest::run_tests() (selftest-run-tests.c:93)\n   by 0x1366A8B: toplev::run_self_tests() (toplev.c:2385)\n   by 0x1366C47: toplev::main(int, char**) (toplev.c:2467)\n   by 0x263203F: main (main.c:39)\n\nWith this patch, the output is clean.\n\ngcc/ChangeLog:\n\t* ipa-modref-tree.c (selftest::test_insert_search_collapse): Fix\n\tleak.\n\t(selftest::test_merge): Fix leaks.", "tree": {"sha": "de86b71ccb99aa5d71f6bffe907fd5d1e0b3652e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de86b71ccb99aa5d71f6bffe907fd5d1e0b3652e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e14c2bdce0c058587bff56883cd22603eceeb0b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e14c2bdce0c058587bff56883cd22603eceeb0b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e14c2bdce0c058587bff56883cd22603eceeb0b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e14c2bdce0c058587bff56883cd22603eceeb0b0/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "f3cf5174b19a89aeed5aa2ba82a373ded35a4a96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f3cf5174b19a89aeed5aa2ba82a373ded35a4a96", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f3cf5174b19a89aeed5aa2ba82a373ded35a4a96"}], "stats": {"total": 5, "additions": 5, "deletions": 0}, "files": [{"sha": "94c68cc4969dca07e1d7679ae3a3e72ae6f6f55a", "filename": "gcc/ipa-modref-tree.c", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e14c2bdce0c058587bff56883cd22603eceeb0b0/gcc%2Fipa-modref-tree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e14c2bdce0c058587bff56883cd22603eceeb0b0/gcc%2Fipa-modref-tree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-modref-tree.c?ref=e14c2bdce0c058587bff56883cd22603eceeb0b0", "patch": "@@ -111,6 +111,8 @@ test_insert_search_collapse ()\n   ASSERT_TRUE (t->every_base);\n   ASSERT_EQ (t->bases, NULL);\n   ASSERT_EQ (t->search (1), NULL);\n+\n+  delete t;\n }\n \n static void\n@@ -155,6 +157,9 @@ test_merge ()\n   base_node = t1->search (3);\n   ASSERT_EQ (base_node->refs, NULL);\n   ASSERT_TRUE (base_node->every_ref);\n+\n+  delete t1;\n+  delete t2;\n }\n \n "}]}