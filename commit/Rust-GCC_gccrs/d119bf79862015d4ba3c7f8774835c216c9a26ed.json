{"sha": "d119bf79862015d4ba3c7f8774835c216c9a26ed", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDExOWJmNzk4NjIwMTVkNGJhM2M3Zjg3NzQ4MzVjMjE2YzlhMjZlZA==", "commit": {"author": {"name": "Richard Sandiford", "email": "richard.sandiford@arm.com", "date": "2019-07-18T08:22:50Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2019-07-18T08:22:50Z"}, "message": "Fix -Wreturn-type for static naked functions in C\n\nThis patch extends the fix for PR53633 to include static functions,\nwhich were giving a bogus -Wreturn-type warning for C but not for C++.\n\n2019-07-18  Richard Sandiford  <richard.sandiford@arm.com>\n\ngcc/c/\n\tPR c/53633\n\t* c-decl.c (finish_function): Check targetm.warn_func_return\n\tbefore issuing a -Wreturn-type warning.\n\ngcc/testsuite/\n\t* c-c++-common/pr53633-2.c: New test.\n\nFrom-SVN: r273568", "tree": {"sha": "db4fe14a0e4fcf55af28f562d8bf0dc1ed398f2e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/db4fe14a0e4fcf55af28f562d8bf0dc1ed398f2e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d119bf79862015d4ba3c7f8774835c216c9a26ed", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d119bf79862015d4ba3c7f8774835c216c9a26ed", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d119bf79862015d4ba3c7f8774835c216c9a26ed", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d119bf79862015d4ba3c7f8774835c216c9a26ed/comments", "author": {"login": "rsandifo-arm", "id": 28043039, "node_id": "MDQ6VXNlcjI4MDQzMDM5", "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo-arm", "html_url": "https://github.com/rsandifo-arm", "followers_url": "https://api.github.com/users/rsandifo-arm/followers", "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs", "repos_url": "https://api.github.com/users/rsandifo-arm/repos", "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d1f2e4c1027b826cf3ba353e86c37589f63f8efe", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d1f2e4c1027b826cf3ba353e86c37589f63f8efe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d1f2e4c1027b826cf3ba353e86c37589f63f8efe"}], "stats": {"total": 30, "additions": 30, "deletions": 0}, "files": [{"sha": "ee0c55970a2ae9ea53bdac0d94b763cf1654584c", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=d119bf79862015d4ba3c7f8774835c216c9a26ed", "patch": "@@ -1,3 +1,9 @@\n+2019-07-18  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\tPR c/53633\n+\t* c-decl.c (finish_function): Check targetm.warn_func_return\n+\tbefore issuing a -Wreturn-type warning.\n+\n 2019-07-12  Alexandre Oliva <oliva@adacore.com>\n \n \t* gimple-parser.c (c_parser_gimple_try_stmt): New."}, {"sha": "0d107adf85f6e2729de6db60702cf34df63cab12", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=d119bf79862015d4ba3c7f8774835c216c9a26ed", "patch": "@@ -9687,6 +9687,7 @@ finish_function (void)\n       /* Normally, with -Wreturn-type, flow will complain, but we might\n          optimize out static functions.  */\n       && !TREE_PUBLIC (fndecl)\n+      && targetm.warn_func_return (fndecl)\n       && warning (OPT_Wreturn_type,\n \t\t  \"no return statement in function returning non-void\"))\n     TREE_NO_WARNING (fndecl) = 1;"}, {"sha": "f9f17893295d26ebdbfa7f368dcb2e78b66576c0", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d119bf79862015d4ba3c7f8774835c216c9a26ed", "patch": "@@ -1,3 +1,7 @@\n+2019-07-18  Richard Sandiford  <richard.sandiford@arm.com>\n+\n+\t* c-c++-common/pr53633-2.c: New test.\n+\n 2019-07-17  Alexandre Oliva <oliva@adacore.com>\n \n \tPR middle-end/81824"}, {"sha": "c26cb10cc838fb02554361e55d09ced167400501", "filename": "gcc/testsuite/c-c++-common/pr53633-2.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr53633-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d119bf79862015d4ba3c7f8774835c216c9a26ed/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr53633-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fpr53633-2.c?ref=d119bf79862015d4ba3c7f8774835c216c9a26ed", "patch": "@@ -0,0 +1,19 @@\n+/* { dg-do compile } */\n+/* { dg-require-effective-target naked_functions } */\n+/* { dg-options \"-O2 -Wall\" } */\n+/* Check that we do not get warnings about missing return statements\n+   or bogus looking noreturn functions.  */\n+static int __attribute__((naked))\n+foo (void)\n+{\n+  __asm__ (\"\");\n+}\n+\n+static int __attribute__((naked,noreturn))\n+bar (void)\n+{\n+  __asm__ (\"\");\n+}\n+\n+int foo_caller (void) { return foo (); }\n+int bar_caller (void) { return bar (); }"}]}