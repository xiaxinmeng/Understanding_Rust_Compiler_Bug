{"sha": "b90e4a97419ce91fd7c1628b5912e8f54bee3441", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjkwZTRhOTc0MTljZTkxZmQ3YzE2MjhiNTkxMmU4ZjU0YmVlMzQ0MQ==", "commit": {"author": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2021-01-15T21:48:42Z"}, "committer": {"name": "Jerry DeLisle", "email": "jvdelisle@gcc.gnu.org", "date": "2021-01-15T21:48:42Z"}, "message": "fortran: Fixes a bug in ISO_Fortran_binding.c.\n\nlibgfortran/ChangeLog:\n\n\t* runtime/ISO_Fortran_binding.c (CFI_establish): Fixed signed\n\t  char arrays. Signed char or uint8_t arrays would cause\n\t  crashes unless an element size is specified.\n\ngcc/testsuite/ChangeLog:\n\n\t* gfortran.dg/iso_fortran_binding_uint8_array.f90: New test.\n\t* gfortran.dg/iso_fortran_binding_uint8_array_driver.c: New test.", "tree": {"sha": "1807faef01186a476a9229245048bc0af4454eeb", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1807faef01186a476a9229245048bc0af4454eeb"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b90e4a97419ce91fd7c1628b5912e8f54bee3441", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b90e4a97419ce91fd7c1628b5912e8f54bee3441", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b90e4a97419ce91fd7c1628b5912e8f54bee3441", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b90e4a97419ce91fd7c1628b5912e8f54bee3441/comments", "author": null, "committer": null, "parents": [{"sha": "9beb6d88effdab4209beb8bc5e4b8773317f1d33", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9beb6d88effdab4209beb8bc5e4b8773317f1d33", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9beb6d88effdab4209beb8bc5e4b8773317f1d33"}], "stats": {"total": 39, "additions": 37, "deletions": 2}, "files": [{"sha": "b28bfa7593b43d5cd32f2bfd613fc5ed1fbf78b7", "filename": "gcc/testsuite/gfortran.dg/iso_fortran_binding_uint8_array.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b90e4a97419ce91fd7c1628b5912e8f54bee3441/gcc%2Ftestsuite%2Fgfortran.dg%2Fiso_fortran_binding_uint8_array.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b90e4a97419ce91fd7c1628b5912e8f54bee3441/gcc%2Ftestsuite%2Fgfortran.dg%2Fiso_fortran_binding_uint8_array.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fiso_fortran_binding_uint8_array.f90?ref=b90e4a97419ce91fd7c1628b5912e8f54bee3441", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do run }\n+! { dg-additional-sources iso_fortran_binding_uint8_array_driver.c }\n+\n+module m\n+   use iso_c_binding\n+contains\n+   subroutine fsub( x ) bind(C, name=\"fsub\")\n+      integer(c_int8_t), intent(inout) :: x(:)\n+      x = x+1\n+   end subroutine\n+end module"}, {"sha": "bfd567bba95fa3c1f1ee8f89cf78bd8abb057ccc", "filename": "gcc/testsuite/gfortran.dg/iso_fortran_binding_uint8_array_driver.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b90e4a97419ce91fd7c1628b5912e8f54bee3441/gcc%2Ftestsuite%2Fgfortran.dg%2Fiso_fortran_binding_uint8_array_driver.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b90e4a97419ce91fd7c1628b5912e8f54bee3441/gcc%2Ftestsuite%2Fgfortran.dg%2Fiso_fortran_binding_uint8_array_driver.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fiso_fortran_binding_uint8_array_driver.c?ref=b90e4a97419ce91fd7c1628b5912e8f54bee3441", "patch": "@@ -0,0 +1,25 @@\n+#include <stdlib.h>\n+#include <stdio.h>\n+#include <inttypes.h>\n+#include \"ISO_Fortran_binding.h\"\n+\n+extern void fsub(CFI_cdesc_t *);\n+\n+int main(void)\n+{\n+   int8_t x[] = {1,2,3,4};\n+   int N = sizeof(x)/sizeof(x[0]);\n+\n+   CFI_CDESC_T(1) dat;\n+   CFI_index_t ext[1];\n+   ext[0] = (CFI_index_t)N;\n+   int rc = CFI_establish((CFI_cdesc_t *)&dat, &x, CFI_attribute_other,\n+                      CFI_type_int8_t, 0, (CFI_rank_t)1, ext);\n+   printf(\"CFI_establish call returned: %d\\n\", rc);\n+\n+   fsub((CFI_cdesc_t *)&dat );\n+\n+   for (int i=0; i<N; i++)\n+       printf(\"%\"PRId8\"\\n\", x[i]);\n+   return 0;\n+}"}, {"sha": "3746ec1c681eeb957783f196297a2649eea40d10", "filename": "libgfortran/runtime/ISO_Fortran_binding.c", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b90e4a97419ce91fd7c1628b5912e8f54bee3441/libgfortran%2Fruntime%2FISO_Fortran_binding.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b90e4a97419ce91fd7c1628b5912e8f54bee3441/libgfortran%2Fruntime%2FISO_Fortran_binding.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fruntime%2FISO_Fortran_binding.c?ref=b90e4a97419ce91fd7c1628b5912e8f54bee3441", "patch": "@@ -345,8 +345,7 @@ int CFI_establish (CFI_cdesc_t *dv, void *base_addr, CFI_attribute_t attribute,\n   dv->base_addr = base_addr;\n \n   if (type == CFI_type_char || type == CFI_type_ucs4_char ||\n-      type == CFI_type_signed_char || type == CFI_type_struct ||\n-      type == CFI_type_other)\n+      type == CFI_type_struct || type == CFI_type_other)\n     dv->elem_len = elem_len;\n   else\n     {"}]}