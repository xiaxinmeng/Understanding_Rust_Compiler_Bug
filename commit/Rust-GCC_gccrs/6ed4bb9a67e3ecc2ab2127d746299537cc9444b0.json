{"sha": "6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NmVkNGJiOWE2N2UzZWNjMmFiMjEyN2Q3NDYyOTk1MzdjYzk0NDRiMA==", "commit": {"author": {"name": "Michael Meissner", "email": "meissner@cygnus.com", "date": "1998-03-27T14:20:40Z"}, "committer": {"name": "Michael Meissner", "email": "meissner@gcc.gnu.org", "date": "1998-03-27T14:20:40Z"}, "message": "Make GCC_EXEC_PREFIX work again\n\nFrom-SVN: r18856", "tree": {"sha": "f06b6290931d772238b161a0ba2613657a9e454e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f06b6290931d772238b161a0ba2613657a9e454e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/comments", "author": null, "committer": null, "parents": [{"sha": "7fe6899fb7d5a9651177de41dd92032a6b5f7f63", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7fe6899fb7d5a9651177de41dd92032a6b5f7f63", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7fe6899fb7d5a9651177de41dd92032a6b5f7f63"}], "stats": {"total": 55, "additions": 49, "deletions": 6}, "files": [{"sha": "e5059598bd757f49eec15e10fc45b317cae247b1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "patch": "@@ -1,3 +1,16 @@\n+Fri Mar 27 16:04:49 1998  Michael Meissner  <meissner@cygnus.com>\n+\n+\t* gcc.c (set_std_prefix): Add declaration.\n+\t(process_command): If GCC_EXEC_PREFIX is set, remove /lib/gcc-lib/\n+\tsuffix, and update the standard prefix prefix.c uses.\n+\n+\t* prefix.c (std_prefix): New global to hold default prefix value.\n+\t(get_key_value): Change to use std_prefix instead of PREFIX.\n+\t(translate_name): Ditto.\n+\t(update_path): Ditto.\n+\t(get_key_value): Release allocated scratch storage.\n+\t(set_std_prefix): New function to reset the standard prefix.\n+\n Fri Mar 27 18:08:21 1998  J\"orn Rennecke <amylaar@cygnus.co.uk>\n \n \t* sh.c (find_barrier): Fix calculations for alignment increase."}, {"sha": "d68f404b273fd735f738fb265bf7a6fc188bd3dc", "filename": "gcc/gcc.c", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/gcc%2Fgcc.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/gcc%2Fgcc.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgcc.c?ref=6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "patch": "@@ -51,6 +51,7 @@ extern int pexecute PROTO ((const char *, char * const *, const char *,\n \t\t\t    const char *, char **, char **, int));\n extern int pwait PROTO ((int, int *, int));\n extern char *update_path PROTO((char *, char *));\n+extern void set_std_prefix PROTO((char *, int));\n /* Flag arguments to pexecute.  */\n #define PEXECUTE_FIRST   1\n #define PEXECUTE_LAST    2\n@@ -2378,6 +2379,20 @@ process_command (argc, argv)\n \n   if (gcc_exec_prefix)\n     {\n+      int len = strlen (gcc_exec_prefix);\n+      if (len > sizeof (\"/lib/gcc-lib/\")-1\n+\t  && (gcc_exec_prefix[len-1] == '/'\n+\t      || gcc_exec_prefix[len-1] == DIR_SEPARATOR))\n+\t{\n+\t  temp = gcc_exec_prefix + len - sizeof (\"/lib/gcc-lib/\") + 1;\n+\t  if ((*temp == '/' || *temp == DIR_SEPARATOR)\n+\t      && strncmp (temp+1, \"lib\", 3) == 0\n+\t      && (temp[4] == '/' || temp[4] == DIR_SEPARATOR)\n+\t      && strncmp (temp+5, \"gcc-lib\", 7) == 0)\n+\t    len -= sizeof (\"/lib/gcc-lib/\") - 1;\n+\t}\n+\n+      set_std_prefix (gcc_exec_prefix, len);\n       add_prefix (&exec_prefixes, gcc_exec_prefix, \"GCC\", 0, 0, NULL_PTR);\n       add_prefix (&startfile_prefixes, gcc_exec_prefix, \"GCC\", 0, 0, NULL_PTR);\n     }"}, {"sha": "c07944764d42fa790200cfe95a7dfbd98cef5f76", "filename": "gcc/prefix.c", "status": "modified", "additions": 21, "deletions": 6, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/gcc%2Fprefix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/6ed4bb9a67e3ecc2ab2127d746299537cc9444b0/gcc%2Fprefix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fprefix.c?ref=6ed4bb9a67e3ecc2ab2127d746299537cc9444b0", "patch": "@@ -1,5 +1,5 @@\n /* Utility to update paths from internal to external forms.\n-   Copyright (C) 1997 Free Software Foundation, Inc.\n+   Copyright (C) 1997, 1998 Free Software Foundation, Inc.\n \n This file is part of GNU CC.\n \n@@ -76,6 +76,8 @@ Boston, MA 02111-1307, USA.  */\n \n #include \"gansidecl.h\"\n \n+static char *std_prefix = PREFIX;\n+\n static char *get_key_value\tPROTO((char *));\n static char *translate_name\tPROTO((char *));\n static char *concat\t\tPVPROTO((char *, ...));\n@@ -93,16 +95,20 @@ get_key_value (key)\n      char *key;\n {\n   char *prefix = 0;\n+  char *temp = 0;\n \n #ifdef _WIN32\n   prefix = lookup_key (key);\n #endif\n \n   if (prefix == 0)\n-    prefix = getenv (concat (key, \"_ROOT\", NULL_PTR));\n+    prefix = getenv (temp = concat (key, \"_ROOT\", NULL_PTR));\n \n   if (prefix == 0)\n-    prefix = PREFIX;\n+    prefix = std_prefix;\n+\n+  if (temp)\n+    free (temp);\n \n   return prefix;\n }\n@@ -259,7 +265,7 @@ translate_name (name)\n     {\n       prefix = get_key_value (key);\n       if (prefix == 0)\n-\tprefix = PREFIX;\n+\tprefix = std_prefix;\n     }\n   else\n     {\n@@ -289,12 +295,12 @@ update_path (path, key)\n      char *path;\n      char *key;\n {\n-  if (! strncmp (path, PREFIX, strlen (PREFIX)) && key != 0)\n+  if (! strncmp (path, std_prefix, strlen (std_prefix)) && key != 0)\n     {\n       if (key[0] != '$')\n \tkey = concat (\"@\", key, NULL_PTR);\n \n-      path = concat (key, &path[strlen (PREFIX)], NULL_PTR);\n+      path = concat (key, &path[strlen (std_prefix)], NULL_PTR);\n \n       while (path[0] == '@' || path[0] == '$')\n \tpath = translate_name (path);\n@@ -315,3 +321,12 @@ update_path (path, key)\n \n   return path;\n }\n+\n+/* Reset the standard prefix */\n+void\n+set_std_prefix (prefix, len)\n+     char *prefix;\n+     int len;\n+{\n+  std_prefix = save_string (prefix, len);\n+}"}]}