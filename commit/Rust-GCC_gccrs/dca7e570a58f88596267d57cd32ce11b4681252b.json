{"sha": "dca7e570a58f88596267d57cd32ce11b4681252b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGNhN2U1NzBhNThmODg1OTYyNjdkNTdjZDMyY2UxMWI0NjgxMjUyYg==", "commit": {"author": {"name": "Jim Wilson", "email": "jimw@sifive.com", "date": "2020-01-09T01:04:45Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "2020-01-09T01:04:45Z"}, "message": "RISC-V: Disable use of TLS copy relocs.\n\nMusl and lld don't support TLS copy relocs, and don't want to add support\nfor this feature which is unique to RISC-V.  Only GNU ld and glibc support\nthem.  In the pasbi discussion, people have pointed out various problems\nwith using them, so we are deprecating them.  There doesn't seem to be an\nABI break from dropping them so this patch modifies gcc to stop creating\nthem.  I'm using an ifdef for now in case a problem turns up and the code\nhas to be re-enabled.  The plan is to add an initial to local exec\nrelaxation as a replacement, though this has not been defined or\nimplemented yet.\n\n\tgcc/\n\t* config/riscv/riscv.c (riscv_legitimize_tls_address): Ifdef out\n\tuse of TLS_MODEL_LOCAL_EXEC when not pic.\n\nFrom-SVN: r280025", "tree": {"sha": "5893e414d6081eb3c56a50aab359ba236799aea5", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5893e414d6081eb3c56a50aab359ba236799aea5"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dca7e570a58f88596267d57cd32ce11b4681252b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dca7e570a58f88596267d57cd32ce11b4681252b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dca7e570a58f88596267d57cd32ce11b4681252b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dca7e570a58f88596267d57cd32ce11b4681252b/comments", "author": null, "committer": null, "parents": [{"sha": "199caa70eaad2e31566613bf03aae35a2bf6126d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/199caa70eaad2e31566613bf03aae35a2bf6126d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/199caa70eaad2e31566613bf03aae35a2bf6126d"}], "stats": {"total": 8, "additions": 8, "deletions": 0}, "files": [{"sha": "4587da982b45ca3fd441b1f779fd6f4a1fdd12c3", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dca7e570a58f88596267d57cd32ce11b4681252b/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dca7e570a58f88596267d57cd32ce11b4681252b/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dca7e570a58f88596267d57cd32ce11b4681252b", "patch": "@@ -1,3 +1,8 @@\n+2020-01-08  Jim Wilson  <jimw@sifive.com>\n+\n+\t* config/riscv/riscv.c (riscv_legitimize_tls_address): Ifdef out\n+\tuse of TLS_MODEL_LOCAL_EXEC when not pic.\n+\n 2020-01-08  David Malcolm  <dmalcolm@redhat.com>\n \n \t* hash-map-tests.c (selftest::test_map_of_strings_to_int): Fix"}, {"sha": "4ba811126feb866f39ab4cf0a26bf4cb550d3ed3", "filename": "gcc/config/riscv/riscv.c", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dca7e570a58f88596267d57cd32ce11b4681252b/gcc%2Fconfig%2Friscv%2Friscv.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dca7e570a58f88596267d57cd32ce11b4681252b/gcc%2Fconfig%2Friscv%2Friscv.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Friscv%2Friscv.c?ref=dca7e570a58f88596267d57cd32ce11b4681252b", "patch": "@@ -1257,9 +1257,12 @@ riscv_legitimize_tls_address (rtx loc)\n   rtx dest, tp, tmp;\n   enum tls_model model = SYMBOL_REF_TLS_MODEL (loc);\n \n+#if 0\n+  /* TLS copy relocs are now deprecated and should not be used.  */\n   /* Since we support TLS copy relocs, non-PIC TLS accesses may all use LE.  */\n   if (!flag_pic)\n     model = TLS_MODEL_LOCAL_EXEC;\n+#endif\n \n   switch (model)\n     {"}]}