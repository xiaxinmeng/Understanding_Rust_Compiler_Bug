{"sha": "17365662e484b762af97f4b25f483411ebec3fb0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTczNjU2NjJlNDg0Yjc2MmFmOTdmNGIyNWY0ODM0MTFlYmVjM2ZiMA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2013-04-25T16:24:42Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2013-04-25T16:24:42Z"}, "message": "re PR c++/56859 (alignas() fails in template)\n\n\tPR c++/56859\n\t* typeck.c (cxx_alignas_expr): Handle value-dependence properly.\n\nFrom-SVN: r198310", "tree": {"sha": "1eabc21918d0b63cac9450ae396c4bdf69c80c37", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/1eabc21918d0b63cac9450ae396c4bdf69c80c37"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/17365662e484b762af97f4b25f483411ebec3fb0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17365662e484b762af97f4b25f483411ebec3fb0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/17365662e484b762af97f4b25f483411ebec3fb0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/17365662e484b762af97f4b25f483411ebec3fb0/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "4794d4b5fe27bd40d4fa11ce8319143cf4d259c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4794d4b5fe27bd40d4fa11ce8319143cf4d259c2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4794d4b5fe27bd40d4fa11ce8319143cf4d259c2"}], "stats": {"total": 38, "additions": 24, "deletions": 14}, "files": [{"sha": "33fc34a1444314222d1cfa198ea0c78096380824", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17365662e484b762af97f4b25f483411ebec3fb0/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17365662e484b762af97f4b25f483411ebec3fb0/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=17365662e484b762af97f4b25f483411ebec3fb0", "patch": "@@ -1,5 +1,8 @@\n 2013-04-25  Jason Merrill  <jason@redhat.com>\n \n+\tPR c++/56859\n+\t* typeck.c (cxx_alignas_expr): Handle value-dependence properly.\n+\n \tPR c++/50261\n \t* init.c (perform_member_init): Call reshape_init.\n "}, {"sha": "b761dd5bd0e5e4dce67a4732794f027dd747015e", "filename": "gcc/cp/typeck.c", "status": "modified", "additions": 7, "deletions": 14, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17365662e484b762af97f4b25f483411ebec3fb0/gcc%2Fcp%2Ftypeck.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17365662e484b762af97f4b25f483411ebec3fb0/gcc%2Fcp%2Ftypeck.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck.c?ref=17365662e484b762af97f4b25f483411ebec3fb0", "patch": "@@ -1725,34 +1725,27 @@ cxx_alignas_expr (tree e)\n        \n \t   When the alignment-specifier is of the form\n \t   alignas(type-id ), it shall have the same effect as\n-\t   alignas( alignof(type-id )).  */\n+\t   alignas(alignof(type-id )).  */\n \n     return cxx_sizeof_or_alignof_type (e, ALIGNOF_EXPR, false);\n   \n-\n   /* If we reach this point, it means the alignas expression if of\n      the form \"alignas(assignment-expression)\", so we should follow\n      what is stated by [dcl.align]/2.  */\n \n+  if (value_dependent_expression_p (e))\n+    /* Leave value-dependent expression alone for now. */\n+    return e;\n+\n+  e = fold_non_dependent_expr (e);\n   e = mark_rvalue_use (e);\n \n   /* [dcl.align]/2 says:\n \n          the assignment-expression shall be an integral constant\n \t expression.  */\n   \n-  e = fold_non_dependent_expr (e);\n-  if (value_dependent_expression_p (e))\n-    /* Leave value-dependent expression alone for now. */;\n-  else\n-    e = cxx_constant_value (e);\n-\n-  if (e == NULL_TREE\n-      || e == error_mark_node\n-      || TREE_CODE (e) != INTEGER_CST)\n-    return error_mark_node;\n-\n-  return e;\n+  return cxx_constant_value (e);\n }\n \n \f"}, {"sha": "45aa8e4758f7b0e93ee1cbbd1ea0ca03c5fe9f7c", "filename": "gcc/testsuite/g++.dg/cpp0x/gen-attrs-54.C", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/17365662e484b762af97f4b25f483411ebec3fb0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fgen-attrs-54.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/17365662e484b762af97f4b25f483411ebec3fb0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fgen-attrs-54.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fcpp0x%2Fgen-attrs-54.C?ref=17365662e484b762af97f4b25f483411ebec3fb0", "patch": "@@ -0,0 +1,14 @@\n+// PR c++/56859\n+// { dg-require-effective-target c++11 }\n+\n+template<unsigned size, unsigned alignment>\n+struct aligned_storage\n+{\n+  using type = struct { alignas(alignment) unsigned char data[size]; };\n+};\n+\n+#define SA(X) static_assert((X),#X)\n+SA(alignof(aligned_storage<8,1>::type) == 1);\n+SA(alignof(aligned_storage<8,2>::type) == 2);\n+SA(alignof(aligned_storage<8,4>::type) == 4);\n+SA(alignof(aligned_storage<8,8>::type) == 8);"}]}