{"sha": "a3a343c8853cb0967b21e8da23a829665208b25d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTNhMzQzYzg4NTNjYjA5NjdiMjFlOGRhMjNhODI5NjY1MjA4YjI1ZA==", "commit": {"author": {"name": "Philip Herron", "email": "philip.herron@embecosm.com", "date": "2021-02-10T11:03:29Z"}, "committer": {"name": "Philip Herron", "email": "herron.philip@googlemail.com", "date": "2021-02-10T18:10:57Z"}, "message": "Give ParseRestriction option to allow for null parse_expr.\n\nThe null_denotion function expects to find the beginning of an expression\nbut breaks can be empty and the parser will fail with unexpected ';'.\n\nFixes #225", "tree": {"sha": "f7b1c76a4f7c2fd230b731c7cef8ecffd18beb0f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f7b1c76a4f7c2fd230b731c7cef8ecffd18beb0f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a3a343c8853cb0967b21e8da23a829665208b25d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3a343c8853cb0967b21e8da23a829665208b25d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3a343c8853cb0967b21e8da23a829665208b25d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3a343c8853cb0967b21e8da23a829665208b25d/comments", "author": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "committer": {"login": "philberty", "id": 84585, "node_id": "MDQ6VXNlcjg0NTg1", "avatar_url": "https://avatars.githubusercontent.com/u/84585?v=4", "gravatar_id": "", "url": "https://api.github.com/users/philberty", "html_url": "https://github.com/philberty", "followers_url": "https://api.github.com/users/philberty/followers", "following_url": "https://api.github.com/users/philberty/following{/other_user}", "gists_url": "https://api.github.com/users/philberty/gists{/gist_id}", "starred_url": "https://api.github.com/users/philberty/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/philberty/subscriptions", "organizations_url": "https://api.github.com/users/philberty/orgs", "repos_url": "https://api.github.com/users/philberty/repos", "events_url": "https://api.github.com/users/philberty/events{/privacy}", "received_events_url": "https://api.github.com/users/philberty/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1a2c0911f0e818328a8909b1f5ba0685b6eca351", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1a2c0911f0e818328a8909b1f5ba0685b6eca351", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1a2c0911f0e818328a8909b1f5ba0685b6eca351"}], "stats": {"total": 13, "additions": 9, "deletions": 4}, "files": [{"sha": "18e6983ce107d9d4f35ff28ce6594e3368f32dcd", "filename": "gcc/rust/parse/rust-parse-impl.h", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3a343c8853cb0967b21e8da23a829665208b25d/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3a343c8853cb0967b21e8da23a829665208b25d/gcc%2Frust%2Fparse%2Frust-parse-impl.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fparse%2Frust-parse-impl.h?ref=a3a343c8853cb0967b21e8da23a829665208b25d", "patch": "@@ -7437,7 +7437,10 @@ Parser<ManagedTokenSource>::parse_break_expr (\n     }\n \n   // parse break return expression if it exists\n-  std::unique_ptr<AST::Expr> return_expr = parse_expr ();\n+  ParseRestrictions restrictions;\n+  restrictions.expr_can_be_null = true;\n+  std::unique_ptr<AST::Expr> return_expr\n+    = parse_expr (std::vector<AST::Attribute> (), restrictions);\n \n   return std::unique_ptr<AST::BreakExpr> (\n     new AST::BreakExpr (locus, std::move (label), std::move (return_expr),\n@@ -12461,9 +12464,10 @@ Parser<ManagedTokenSource>::null_denotation (\n       // array definition expr (not indexing)\n       return parse_array_expr (std::move (outer_attrs), true);\n     default:\n-      rust_error_at (tok->get_locus (),\n-\t\t     \"found unexpected token %qs in null denotation\",\n-\t\t     tok->get_token_description ());\n+      if (!restrictions.expr_can_be_null)\n+\trust_error_at (tok->get_locus (),\n+\t\t       \"found unexpected token %qs in null denotation\",\n+\t\t       tok->get_token_description ());\n       return nullptr;\n     }\n }"}, {"sha": "e691c9e24f3f6e07614a5ef43bbff75088b1604b", "filename": "gcc/rust/parse/rust-parse.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a3a343c8853cb0967b21e8da23a829665208b25d/gcc%2Frust%2Fparse%2Frust-parse.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a3a343c8853cb0967b21e8da23a829665208b25d/gcc%2Frust%2Fparse%2Frust-parse.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Fparse%2Frust-parse.h?ref=a3a343c8853cb0967b21e8da23a829665208b25d", "patch": "@@ -82,6 +82,7 @@ struct ParseRestrictions\n   /* Whether the expression was entered from a unary expression - prevents stuff\n    * like struct exprs being parsed from a dereference. */\n   bool entered_from_unary = false;\n+  bool expr_can_be_null = false;\n };\n \n // Parser implementation for gccrs."}]}