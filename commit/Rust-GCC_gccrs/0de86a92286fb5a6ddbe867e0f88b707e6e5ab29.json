{"sha": "0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MGRlODZhOTIyODZmYjVhNmRkYmU4NjdlMGY4OGI3MDdlNmU1YWIyOQ==", "commit": {"author": {"name": "J\u00fcrgen Urban", "email": "JuergenUrban@gmx.de", "date": "2013-06-16T19:31:24Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2013-06-16T19:31:24Z"}, "message": "mips.h (ISA_HAS_MUL3): Include TARGET_MIPS5900.\n\ngcc/\n2013-06-16  J\u00fcrgen Urban  <JuergenUrban@gmx.de>\n\n\t* config/mips/mips.h (ISA_HAS_MUL3): Include TARGET_MIPS5900.\n\t(ISA_HAS_MULT, ISA_HAS_DMULT, ISA_HAS_DIV, ISA_HAS_DDIV): New macros.\n\t* config/mips/mips.md (mul<mode>3, mul<mode>3_internal)\n\t(mul<mode>3_r4000): Require ISA_HAS_<D>MULT.\n\t(mul<mode>3_mul3): Handle TARGET_MIPS5900.\n\t(mulsidi3_64bit_dmul): Remove redundant TARGET_64BIT test.\n\t(<su>muldi3_highpart, <su>muldi3_highpart_internal, <u>mulditi3)\n\t(<u>mulditi3_internal, <u>mulditi3_r4000): Require ISA_HAS_DMULT\n\tinstead of TARGET_64BIT.\n\t(divmod<mode>4, udivmod<mode>4, <u>divmod<GPR:mode>4_hilo_<HILO:mode>):\n\tRequire ISA_HAS_<D>DIV.\n\nlibgcc/\n2013-06-16  J\u00fcrgen Urban  <JuergenUrban@gmx.de>\n\n\t* config/mips/lib2funcs.c: New file.\n\t* config/mips/t-mips (LIB2ADD_ST): Add it.\n\nFrom-SVN: r200140", "tree": {"sha": "ee7f1194b7f5598ef001128986e4cfd5415d0f3b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/ee7f1194b7f5598ef001128986e4cfd5415d0f3b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/comments", "author": {"login": "jur", "id": 1646215, "node_id": "MDQ6VXNlcjE2NDYyMTU=", "avatar_url": "https://avatars.githubusercontent.com/u/1646215?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jur", "html_url": "https://github.com/jur", "followers_url": "https://api.github.com/users/jur/followers", "following_url": "https://api.github.com/users/jur/following{/other_user}", "gists_url": "https://api.github.com/users/jur/gists{/gist_id}", "starred_url": "https://api.github.com/users/jur/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jur/subscriptions", "organizations_url": "https://api.github.com/users/jur/orgs", "repos_url": "https://api.github.com/users/jur/repos", "events_url": "https://api.github.com/users/jur/events{/privacy}", "received_events_url": "https://api.github.com/users/jur/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7424041386a03f1cfcc2c58ba750251db2df99b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7424041386a03f1cfcc2c58ba750251db2df99b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7424041386a03f1cfcc2c58ba750251db2df99b1"}], "stats": {"total": 108, "additions": 95, "deletions": 13}, "files": [{"sha": "7e28ee0b20ae07978bed1ee5490506b0d88c7c2d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "patch": "@@ -1,3 +1,17 @@\n+2013-06-16  J\u00fcrgen Urban  <JuergenUrban@gmx.de>\n+\n+\t* config/mips/mips.h (ISA_HAS_MUL3): Include TARGET_MIPS5900.\n+\t(ISA_HAS_MULT, ISA_HAS_DMULT, ISA_HAS_DIV, ISA_HAS_DDIV): New macros.\n+\t* config/mips/mips.md (mul<mode>3, mul<mode>3_internal)\n+\t(mul<mode>3_r4000): Require ISA_HAS_<D>MULT.\n+\t(mul<mode>3_mul3): Handle TARGET_MIPS5900.\n+\t(mulsidi3_64bit_dmul): Remove redundant TARGET_64BIT test.\n+\t(<su>muldi3_highpart, <su>muldi3_highpart_internal, <u>mulditi3)\n+\t(<u>mulditi3_internal, <u>mulditi3_r4000): Require ISA_HAS_DMULT\n+\tinstead of TARGET_64BIT.\n+\t(divmod<mode>4, udivmod<mode>4, <u>divmod<GPR:mode>4_hilo_<HILO:mode>):\n+\tRequire ISA_HAS_<D>DIV.\n+\n 2013-06-16  Richard Sandiford  <rdsandiford@googlemail.com>\n \n \t* config.gcc (mips*-mti-linux*, mips64*-*-linux*, mipsisa64*-*-linux*)"}, {"sha": "ff631c1a30b665f2ef75a21f46affc74c84c2f41", "filename": "gcc/config/mips/mips.h", "status": "modified", "additions": 17, "deletions": 0, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/gcc%2Fconfig%2Fmips%2Fmips.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/gcc%2Fconfig%2Fmips%2Fmips.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.h?ref=0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "patch": "@@ -807,6 +807,7 @@ struct mips_cpu_info {\n #define ISA_HAS_MUL3\t\t((TARGET_MIPS3900                       \\\n \t\t\t\t  || TARGET_MIPS5400\t\t\t\\\n \t\t\t\t  || TARGET_MIPS5500\t\t\t\\\n+\t\t\t\t  || TARGET_MIPS5900\t\t\t\\\n \t\t\t\t  || TARGET_MIPS7000\t\t\t\\\n \t\t\t\t  || TARGET_MIPS9000\t\t\t\\\n \t\t\t\t  || TARGET_MAD\t\t\t\t\\\n@@ -821,6 +822,22 @@ struct mips_cpu_info {\n \t\t\t\t && TARGET_OCTEON\t\t\t\\\n \t\t\t\t && !TARGET_MIPS16)\n \n+/* ISA supports instructions DMULT and DMULTU. */\n+#define ISA_HAS_DMULT\t\t(TARGET_64BIT && !TARGET_MIPS5900)\n+\n+/* ISA supports instructions MULT and MULTU.\n+   This is always true, but the macro is needed for ISA_HAS_<D>MULT\n+   in mips.md.  */\n+#define ISA_HAS_MULT\t\t(1)\n+\n+/* ISA supports instructions DDIV and DDIVU. */\n+#define ISA_HAS_DDIV\t\t(TARGET_64BIT && !TARGET_MIPS5900)\n+\n+/* ISA supports instructions DIV and DIVU.\n+   This is always true, but the macro is needed for ISA_HAS_<D>DIV\n+   in mips.md.  */\n+#define ISA_HAS_DIV\t\t(1)\n+\n #define ISA_HAS_DIV3\t\t((TARGET_LOONGSON_2EF\t\t\t\\\n \t\t\t\t  || TARGET_LOONGSON_3A)\t\t\\\n \t\t\t\t && !TARGET_MIPS16)"}, {"sha": "ce322d8bc360d8278dcbdbbe81d3bd661b816406", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 13, "deletions": 13, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "patch": "@@ -1468,7 +1468,7 @@\n   [(set (match_operand:GPR 0 \"register_operand\")\n \t(mult:GPR (match_operand:GPR 1 \"register_operand\")\n \t\t  (match_operand:GPR 2 \"register_operand\")))]\n-  \"\"\n+  \"ISA_HAS_<D>MULT\"\n {\n   rtx lo;\n \n@@ -1514,7 +1514,7 @@\n {\n   if (which_alternative == 1)\n     return \"<d>mult\\t%1,%2\";\n-  if (<MODE>mode == SImode && TARGET_MIPS3900)\n+  if (<MODE>mode == SImode && (TARGET_MIPS3900 || TARGET_MIPS5900))\n     return \"mult\\t%0,%1,%2\";\n   return \"<d>mul\\t%0,%1,%2\";\n }\n@@ -1548,7 +1548,7 @@\n   [(set (match_operand:GPR 0 \"muldiv_target_operand\" \"=l\")\n \t(mult:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t  (match_operand:GPR 2 \"register_operand\" \"d\")))]\n-  \"!TARGET_FIX_R4000\"\n+  \"ISA_HAS_<D>MULT && !TARGET_FIX_R4000\"\n   \"<d>mult\\t%1,%2\"\n   [(set_attr \"type\" \"imul\")\n    (set_attr \"mode\" \"<MODE>\")])\n@@ -1558,7 +1558,7 @@\n \t(mult:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t  (match_operand:GPR 2 \"register_operand\" \"d\")))\n    (clobber (match_scratch:GPR 3 \"=l\"))]\n-  \"TARGET_FIX_R4000\"\n+  \"ISA_HAS_<D>MULT && TARGET_FIX_R4000\"\n   \"<d>mult\\t%1,%2\\;mflo\\t%0\"\n   [(set_attr \"type\" \"imul\")\n    (set_attr \"mode\" \"<MODE>\")\n@@ -2025,7 +2025,7 @@\n \t(mult:DI (sign_extend:DI (match_operand:SI 1 \"register_operand\" \"d\"))\n \t\t (sign_extend:DI (match_operand:SI 2 \"register_operand\" \"d\"))))\n    (clobber (match_scratch:DI 3 \"=l\"))]\n-  \"TARGET_64BIT && ISA_HAS_DMUL3\"\n+  \"ISA_HAS_DMUL3\"\n   \"dmul\\t%0,%1,%2\"\n   [(set_attr \"type\" \"imul3\")\n    (set_attr \"mode\" \"DI\")])\n@@ -2179,7 +2179,7 @@\n \t  (mult:TI (any_extend:TI (match_operand:DI 1 \"register_operand\"))\n \t\t   (any_extend:TI (match_operand:DI 2 \"register_operand\")))\n \t  (const_int 64))))]\n-  \"TARGET_64BIT && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n+  \"ISA_HAS_DMULT && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n {\n   if (TARGET_MIPS16)\n     emit_insn (gen_<su>muldi3_highpart_split (operands[0], operands[1],\n@@ -2198,7 +2198,7 @@\n \t\t   (any_extend:TI (match_operand:DI 2 \"register_operand\" \"d\")))\n \t  (const_int 64))))\n    (clobber (match_scratch:DI 3 \"=l\"))]\n-  \"TARGET_64BIT\n+  \"ISA_HAS_DMULT\n    && !TARGET_MIPS16\n    && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n   { return TARGET_FIX_R4000 ? \"dmult<u>\\t%1,%2\\n\\tmfhi\\t%0\" : \"#\"; }\n@@ -2234,7 +2234,7 @@\n   [(set (match_operand:TI 0 \"register_operand\")\n \t(mult:TI (any_extend:TI (match_operand:DI 1 \"register_operand\"))\n \t\t (any_extend:TI (match_operand:DI 2 \"register_operand\"))))]\n-  \"TARGET_64BIT && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n+  \"ISA_HAS_DMULT && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n {\n   rtx hilo;\n \n@@ -2256,7 +2256,7 @@\n   [(set (match_operand:TI 0 \"muldiv_target_operand\" \"=x\")\n \t(mult:TI (any_extend:TI (match_operand:DI 1 \"register_operand\" \"d\"))\n \t\t (any_extend:TI (match_operand:DI 2 \"register_operand\" \"d\"))))]\n-  \"TARGET_64BIT\n+  \"ISA_HAS_DMULT\n    && !TARGET_FIX_R4000\n    && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n   \"dmult<u>\\t%1,%2\"\n@@ -2268,7 +2268,7 @@\n \t(mult:TI (any_extend:TI (match_operand:DI 1 \"register_operand\" \"d\"))\n \t\t (any_extend:TI (match_operand:DI 2 \"register_operand\" \"d\"))))\n    (clobber (match_scratch:TI 3 \"=x\"))]\n-  \"TARGET_64BIT\n+  \"ISA_HAS_DMULT\n    && TARGET_FIX_R4000\n    && !(<CODE> == ZERO_EXTEND && TARGET_FIX_VR4120)\"\n   \"dmult<u>\\t%1,%2\\;mflo\\t%L0\\;mfhi\\t%M0\"\n@@ -2564,7 +2564,7 @@\n    (set (match_operand:GPR 3 \"register_operand\" \"=d\")\n \t(mod:GPR (match_dup 1)\n \t\t (match_dup 2)))]\n-  \"!TARGET_FIX_VR4120\"\n+  \"ISA_HAS_<D>DIV && !TARGET_FIX_VR4120\"\n   \"#\"\n   \"&& ((TARGET_MIPS16 && cse_not_expected) || reload_completed)\"\n   [(const_int 0)]\n@@ -2587,7 +2587,7 @@\n    (set (match_operand:GPR 3 \"register_operand\" \"=d\")\n \t(umod:GPR (match_dup 1)\n \t\t  (match_dup 2)))]\n-  \"\"\n+  \"ISA_HAS_<D>DIV\"\n   \"#\"\n   \"(TARGET_MIPS16 && cse_not_expected) || reload_completed\"\n   [(const_int 0)]\n@@ -2633,7 +2633,7 @@\n \t  [(any_div:GPR (match_operand:GPR 1 \"register_operand\" \"d\")\n \t\t\t(match_operand:GPR 2 \"register_operand\" \"d\"))]\n \t  UNSPEC_SET_HILO))]\n-  \"\"\n+  \"ISA_HAS_<GPR:D>DIV\"\n   { return mips_output_division (\"<GPR:d>div<u>\\t%.,%1,%2\", operands); }\n   [(set_attr \"type\" \"idiv\")\n    (set_attr \"mode\" \"<GPR:MODE>\")])"}, {"sha": "56b3463923789a3b626c349ea38a52e8adc7b275", "filename": "libgcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/libgcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/libgcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2FChangeLog?ref=0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "patch": "@@ -1,3 +1,8 @@\n+2013-06-16  J\u00fcrgen Urban  <JuergenUrban@gmx.de>\n+\n+\t* config/mips/lib2funcs.c: New file.\n+\t* config/mips/t-mips (LIB2ADD_ST): Add it.\n+\n 2013-06-09  Oleg Endo  <olegendo@gcc.gnu.org>\n \n \tPR target/6526"}, {"sha": "85d9f17a4cdf45797d57e9c1f008fd7a3bae097e", "filename": "libgcc/config/mips/lib2funcs.c", "status": "added", "additions": 44, "deletions": 0, "changes": 44, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/libgcc%2Fconfig%2Fmips%2Flib2funcs.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/libgcc%2Fconfig%2Fmips%2Flib2funcs.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fmips%2Flib2funcs.c?ref=0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "patch": "@@ -0,0 +1,44 @@\n+/* libgcc routines for MIPS\n+   Copyright (C) 2013 Free Software Foundation, Inc.\n+   DMULT/DDIV replacement support by Juergen Urban, JuergenUrban@gmx.de.\n+\n+This file is part of GCC.\n+\n+GCC is free software; you can redistribute it and/or modify it under\n+the terms of the GNU General Public License as published by the Free\n+Software Foundation; either version 3, or (at your option) any later\n+version.\n+\n+GCC is distributed in the hope that it will be useful, but WITHOUT ANY\n+WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License\n+for more details.\n+\n+Under Section 7 of GPL version 3, you are granted additional\n+permissions described in the GCC Runtime Library Exception, version\n+3.1, as published by the Free Software Foundation.\n+\n+You should have received a copy of the GNU General Public License and\n+a copy of the GCC Runtime Library Exception along with this program;\n+see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n+<http://www.gnu.org/licenses/>.  */\n+\n+#if defined(__mips64) && defined(_MIPS_ARCH_R5900)\n+\n+/* Build DI version of libgcc functions. */\n+#define LIBGCC2_UNITS_PER_WORD 4\n+\n+/* The following function is needed when !ISA_HAS_DMULT. */\n+#define L_muldi3\n+\n+/* The following functions are needed when !ISA_HAS_DDIV. */\n+#define L_divdi3\n+#define L_moddi3\n+#define L_udivdi3\n+#define L_umoddi3\n+#define L_udivmoddi4\n+\n+/* Use generic definition of functions. */\n+#include \"libgcc2.c\"\n+\n+#endif"}, {"sha": "ed5550e704823abdefc00b4c997c4527f7d8f8b8", "filename": "libgcc/config/mips/t-mips", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/libgcc%2Fconfig%2Fmips%2Ft-mips", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/0de86a92286fb5a6ddbe867e0f88b707e6e5ab29/libgcc%2Fconfig%2Fmips%2Ft-mips", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgcc%2Fconfig%2Fmips%2Ft-mips?ref=0de86a92286fb5a6ddbe867e0f88b707e6e5ab29", "patch": "@@ -4,3 +4,5 @@ FPBIT = true\n FPBIT_CFLAGS = -DQUIET_NAN_NEGATED\n DPBIT = true\n DPBIT_CFLAGS = -DQUIET_NAN_NEGATED\n+\n+LIB2ADD_ST += $(srcdir)/config/mips/lib2funcs.c"}]}