{"sha": "3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6M2I4ZjliNDY0OWU3MWJkZjVlOGUzYTI3ODVlMDJmNGZhZTVjN2YwYw==", "commit": {"author": {"name": "Richard Henderson", "email": "rth@redhat.com", "date": "2011-04-04T22:13:54Z"}, "committer": {"name": "Richard Henderson", "email": "rth@gcc.gnu.org", "date": "2011-04-04T22:13:54Z"}, "message": "re PR bootstrap/48400 (powerpc-apple-darwin9 fails to bootstrap at revision 171824)\n\nPR 48400\n* dwarf2out.c (output_line_info): Always emit line info from\nat least one section.\n(dwarf2out_init): Create text_section_line_info here ...\n(set_cur_line_info_table): ... not here.\n\nFrom-SVN: r171955", "tree": {"sha": "183518fd01a28905fc28d516d5eb38fe7fcf4272", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/183518fd01a28905fc28d516d5eb38fe7fcf4272"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c/comments", "author": null, "committer": null, "parents": [{"sha": "0bcd8186d956af873100b2e7698312e3bd8d5e8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0bcd8186d956af873100b2e7698312e3bd8d5e8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0bcd8186d956af873100b2e7698312e3bd8d5e8f"}], "stats": {"total": 45, "additions": 31, "deletions": 14}, "files": [{"sha": "d6ed96ff9c5ead046ef1d619adc349554b78a13e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c", "patch": "@@ -1,3 +1,11 @@\n+2011-04-04  Richard Henderson  <rth@redhat.com>\n+\n+\tPR 48400\n+\t* dwarf2out.c (output_line_info): Always emit line info from\n+\tat least one section.\n+\t(dwarf2out_init): Create text_section_line_info here ...\n+\t(set_cur_line_info_table): ... not here.\n+\n 2011-04-01  Vladimir Makarov  <vmakarov@redhat.com>\n \n \tPR target/48380"}, {"sha": "847e8efff062b5893d37c3c4e5aa6a69eb4449d1", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 23, "deletions": 14, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=3b8f9b4649e71bdf5e8e3a2785e02f4fae5c7f0c", "patch": "@@ -12420,6 +12420,7 @@ output_line_info (void)\n {\n   char l1[20], l2[20], p1[20], p2[20];\n   int ver = dwarf_version;\n+  bool saw_one = false;\n   int opc;\n \n   ASM_GENERATE_INTERNAL_LABEL (l1, LINE_NUMBER_BEGIN_LABEL, 0);\n@@ -12486,21 +12487,32 @@ output_line_info (void)\n   output_file_names ();\n   ASM_OUTPUT_LABEL (asm_out_file, p2);\n \n-  if (text_section_line_info && text_section_line_info->in_use)\n-    output_one_line_info_table (text_section_line_info);\n-  if (cold_text_section_line_info && cold_text_section_line_info->in_use)\n-    output_one_line_info_table (cold_text_section_line_info);\n-\n   if (separate_line_info)\n     {\n       dw_line_info_table *table;\n       size_t i;\n \n       FOR_EACH_VEC_ELT (dw_line_info_table_p, separate_line_info, i, table)\n \tif (table->in_use)\n-\t  output_one_line_info_table (table);\n+\t  {\n+\t    output_one_line_info_table (table);\n+\t    saw_one = true;\n+\t  }\n+    }\n+  if (cold_text_section_line_info && cold_text_section_line_info->in_use)\n+    {\n+      output_one_line_info_table (cold_text_section_line_info);\n+      saw_one = true;\n     }\n \n+  /* ??? Some Darwin linkers crash on a .debug_line section with no\n+     sequences.  Further, merely a DW_LNE_end_sequence entry is not\n+     sufficient -- the address column must also be initialized.\n+     Make sure to output at least one set_address/end_sequence pair,\n+     choosing .text since that section is always present.  */\n+  if (text_section_line_info->in_use || !saw_one)\n+    output_one_line_info_table (text_section_line_info);\n+\n   /* Output the marker for the end of the line number info.  */\n   ASM_OUTPUT_LABEL (asm_out_file, l2);\n }\n@@ -22071,14 +22083,7 @@ set_cur_line_info_table (section *sec)\n   dw_line_info_table *table;\n \n   if (sec == text_section)\n-    {\n-      table = text_section_line_info;\n-      if (!table)\n-\t{\n-\t  text_section_line_info = table = new_line_info_table ();\n-\t  table->end_label = text_end_label;\n-\t}\n-    }\n+    table = text_section_line_info;\n   else if (sec == cold_text_section)\n     {\n       table = cold_text_section_line_info;\n@@ -22451,6 +22456,10 @@ dwarf2out_init (const char *filename ATTRIBUTE_UNUSED)\n \n   switch_to_section (text_section);\n   ASM_OUTPUT_LABEL (asm_out_file, text_section_label);\n+\n+  /* Make sure the line number table for .text always exists.  */\n+  text_section_line_info = new_line_info_table ();\n+  text_section_line_info->end_label = text_end_label;\n }\n \n /* Called before cgraph_optimize starts outputtting functions, variables"}]}