{"sha": "1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTQzNmVmMmE1N2U3OWI2YjhjZTViMDNlMzJhMzhkZDY0ZjQ2Yzk3Yw==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-11-05T08:27:28Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-11-05T09:20:30Z"}, "message": "debug/97718 - fix abstract origin references after last change\n\nThe change to clear the external_die_map slot after creating\nthe concrete instance DIE broke abstract origin processing which\ntried to make sure to have those point to the early abstract instance\nand not the concrete instance.  The following restores this by\neventually following the abstract origin link in the concrete instance.\n\n2020-11-05  Richard Biener  <rguenther@suse.de>\n\n\tPR debug/97718\n\t* dwarf2out.c (add_abstract_origin_attribute): Make sure to\n\tpoint to the abstract instance.", "tree": {"sha": "de4c842f80b554d93c1dbc6398c471c577d4f245", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/de4c842f80b554d93c1dbc6398c471c577d4f245"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e3587a2d8b005d72f882a21864fb132f8a966366", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3587a2d8b005d72f882a21864fb132f8a966366", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3587a2d8b005d72f882a21864fb132f8a966366"}], "stats": {"total": 11, "additions": 10, "deletions": 1}, "files": [{"sha": "81cb7341a7e4e5b9b95424990ca07b6e4a6c7b8c", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 10, "deletions": 1, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=1436ef2a57e79b6b8ce5b03e32a38dd64f46c97c", "patch": "@@ -21293,7 +21293,16 @@ add_abstract_origin_attribute (dw_die_ref die, tree origin)\n      here.  */\n \n   if (origin_die)\n-    add_AT_die_ref (die, DW_AT_abstract_origin, origin_die);\n+    {\n+      dw_attr_node *a;\n+      /* Like above, if we already created a concrete instance DIE\n+\t do not use that for the abstract origin but the early DIE\n+\t if present.  */\n+      if (in_lto_p\n+\t  && (a = get_AT (origin_die, DW_AT_abstract_origin)))\n+\torigin_die = AT_ref (a);\n+      add_AT_die_ref (die, DW_AT_abstract_origin, origin_die);\n+    }\n }\n \n /* We do not currently support the pure_virtual attribute.  */"}]}