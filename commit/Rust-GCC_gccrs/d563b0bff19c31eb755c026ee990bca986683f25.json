{"sha": "d563b0bff19c31eb755c026ee990bca986683f25", "node_id": "C_kwDOANBUbNoAKGQ1NjNiMGJmZjE5YzMxZWI3NTVjMDI2ZWU5OTBiY2E5ODY2ODNmMjU", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-03-09T14:53:52Z"}, "committer": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2022-03-10T11:48:59Z"}, "message": "contrib: Fix non-portable shell commands in gcc-git-customization.sh [PR102664]\n\nUse printf instead of echo -n. Use Basic Regular Expressions instead of\nsed -r. Check for error from ancient Git versions that don't support the\n--git-path option for git-rev-parse. Remove -c flag from install\ncommand, as it's ignored by GNU and BSD install, but means something\ndifferent for Solaris and AIX.\n\ncontrib/ChangeLog:\n\n\tPR other/102664\n\t* gcc-git-customization.sh: Fix non-portable commands.", "tree": {"sha": "3e96e55d55d90e595491164634172b776418b8fc", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3e96e55d55d90e595491164634172b776418b8fc"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d563b0bff19c31eb755c026ee990bca986683f25", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d563b0bff19c31eb755c026ee990bca986683f25", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d563b0bff19c31eb755c026ee990bca986683f25", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d563b0bff19c31eb755c026ee990bca986683f25/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3357878ef56d1e47666fc697cfd7cb5cd9c1dfc9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3357878ef56d1e47666fc697cfd7cb5cd9c1dfc9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3357878ef56d1e47666fc697cfd7cb5cd9c1dfc9"}], "stats": {"total": 22, "additions": 13, "deletions": 9}, "files": [{"sha": "914d868f7bdb9bfb7bd1a8f0da3a0de530da1317", "filename": "contrib/gcc-git-customization.sh", "status": "modified", "additions": 13, "deletions": 9, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d563b0bff19c31eb755c026ee990bca986683f25/contrib%2Fgcc-git-customization.sh", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d563b0bff19c31eb755c026ee990bca986683f25/contrib%2Fgcc-git-customization.sh", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/contrib%2Fgcc-git-customization.sh?ref=d563b0bff19c31eb755c026ee990bca986683f25", "patch": "@@ -7,7 +7,7 @@ ask () {\n     question=$1\n     default=$2\n     var=$3\n-    echo -n $question \"[\"$default\"]? \"\n+    printf \"%s [%s]? \" \"$question\" \"$default\"\n     read answer\n     if [ \"x$answer\" = \"x\" ]\n     then\n@@ -110,15 +110,15 @@ then\n \t# This is a pure guess, but for many people it might be OK.\n \tremote_id=$(whoami)\n     else\n-\tremote_id=$(echo $url | sed -r \"s|^.*ssh://(.+)@gcc.gnu.org.*$|\\1|\")\n+\tremote_id=$(echo $url | sed 's|^.*ssh://\\(..*\\)@gcc.gnu.org.*$|\\1|')\n \tif [ x$remote_id = x$url ]\n \tthen\n \t    remote_id=$(whoami)\n \tfi\n     fi\n fi\n \n-ask \"Account name on gcc.gnu.org (for your personal branches area)\" $remote_id remote_id\n+ask \"Account name on gcc.gnu.org (for your personal branches area)\" \"$remote_id\" remote_id\n git config \"gcc-config.user\" \"$remote_id\"\n \n old_pfx=$(git config --get \"gcc-config.userpfx\")\n@@ -135,16 +135,20 @@ git config \"gcc-config.userpfx\" \"$new_pfx\"\n echo\n ask \"Install prepare-commit-msg git hook for 'git commit-mklog' alias\" yes dohook\n if [ \"x$dohook\" = xyes ]; then\n-    hookdir=`git rev-parse --git-path hooks`\n-    if [ -f \"$hookdir/prepare-commit-msg\" ]; then\n-\techo \" Moving existing prepare-commit-msg hook to prepare-commit-msg.bak\"\n-\tmv \"$hookdir/prepare-commit-msg\" \"$hookdir/prepare-commit-msg.bak\"\n+    hookdir=`git rev-parse --git-path hooks 2>/dev/null`\n+    if [ $? -eq 0 ]; then\n+\tif [ -f \"$hookdir/prepare-commit-msg\" ]; then\n+\t    echo \" Moving existing prepare-commit-msg hook to prepare-commit-msg.bak\"\n+\t    mv \"$hookdir/prepare-commit-msg\" \"$hookdir/prepare-commit-msg.bak\"\n+\tfi\n+\tinstall -c \"`git rev-parse --show-toplevel`/contrib/prepare-commit-msg\" \"$hookdir\"\n+    else\n+\techo \" `git --version` is too old, cannot find hooks dir\"\n     fi\n-    install -c \"`git rev-parse --show-toplevel`/contrib/prepare-commit-msg\" \"$hookdir\"\n fi\n \n # Scan the existing settings to see if there are any we need to rewrite.\n-vendors=$(git config --get-all \"remote.${upstream}.fetch\" \"refs/vendors/\" | sed -r \"s:.*refs/vendors/([^/]+)/.*:\\1:\" | sort | uniq)\n+vendors=$(git config --get-all \"remote.${upstream}.fetch\" \"refs/vendors/\" | sed 's:.*refs/vendors/\\([^/][^/]*\\)/.*:\\1:' | sort | uniq)\n url=$(git config --get \"remote.${upstream}.url\")\n pushurl=$(git config --get \"remote.${upstream}.pushurl\")\n for v in $vendors"}]}