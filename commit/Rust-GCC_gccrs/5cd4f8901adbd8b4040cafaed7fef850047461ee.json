{"sha": "5cd4f8901adbd8b4040cafaed7fef850047461ee", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWNkNGY4OTAxYWRiZDhiNDA0MGNhZmFlZDdmZWY4NTAwNDc0NjFlZQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-11-13T22:27:23Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2020-11-13T22:27:23Z"}, "message": "testsuite: guality/redeclaration1.C test workaround\n\nApparently older GDB versions didn't handle this test right and so while\nit has been properly printing 42 on line 14 (e.g. on x86_64), it issued\na weird error on line 17 (and because it didn't print any value, guality\ntestsuite wasn't marking it as FAIL).\nThat has been apparently fixed in GDB 10, where it now (on x86_64) prints\nproperly.\nUnfortunately that revealed that the test can suffer from instruction\nscheduling, where e.g. on i686 (but various other arches) the very first\ninsn of the function (or whatever b 14 is on) happens to be load of the\nS::i variable from memory and that insn has the inner lexical scope, so\nGDB 10 prints there 24 instead of 42.  The following insn is then\nthe first store to l and there the automatic i is in scope and prints as 42\nand then the second store to l where the inner lexical scope is current\nand prints 24 again.\nThe test wasn't meant about insn scheduling but about whether we emit the\nDIEs properly, so this hack attempts to prevent the undesirable scheduling.\n\n2020-11-13  Jakub Jelinek  <jakub@redhat.com>\n\n\t* g++.dg/guality/redeclaration1.C (p): New variable.\n\t(S::f): Increment what p points to before storing S::i into l.  Adjust\n\tgdb-test line numbers.\n\t(main): Initialize p to address of an automatic variable.", "tree": {"sha": "e67fc541da3102dd14da9589154fd16e5dbe4714", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e67fc541da3102dd14da9589154fd16e5dbe4714"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5cd4f8901adbd8b4040cafaed7fef850047461ee", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd4f8901adbd8b4040cafaed7fef850047461ee", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5cd4f8901adbd8b4040cafaed7fef850047461ee", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5cd4f8901adbd8b4040cafaed7fef850047461ee/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "1d9a8675d379f02f5e39639f469ae8dfcf33fea9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1d9a8675d379f02f5e39639f469ae8dfcf33fea9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1d9a8675d379f02f5e39639f469ae8dfcf33fea9"}], "stats": {"total": 8, "additions": 6, "deletions": 2}, "files": [{"sha": "bd0209f8adb7b2933772ec3368bb15e44efca18c", "filename": "gcc/testsuite/g++.dg/guality/redeclaration1.C", "status": "modified", "additions": 6, "deletions": 2, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5cd4f8901adbd8b4040cafaed7fef850047461ee/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fguality%2Fredeclaration1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5cd4f8901adbd8b4040cafaed7fef850047461ee/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fguality%2Fredeclaration1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fguality%2Fredeclaration1.C?ref=5cd4f8901adbd8b4040cafaed7fef850047461ee", "patch": "@@ -3,6 +3,7 @@\n // { dg-skip-if \"\" { *-*-* } { \"-flto\" } { \"\" } }\n \n volatile int l;\n+int *volatile p;\n \n namespace S\n {\n@@ -11,17 +12,20 @@ namespace S\n   f()\n   {\n     int i = 42;\n-    l = i;\t\t// { dg-final { gdb-test 14 \"i\" \"42\" } }\n+    l = i;\t\t// { dg-final { gdb-test 15 \"i\" \"42\" } }\n     {\n       extern int i;\n-      l = i;\t\t// { dg-final { gdb-test 17 \"i\" \"24\" } }\n+      p[0]++;\n+      l = i;\t\t// { dg-final { gdb-test 19 \"i\" \"24\" } }\n     }\n   }\n }\n \n int\n main (void)\n {\n+  int x = 0;\n+  p = &x;\n   S::f ();\n   return 0;\n }"}]}