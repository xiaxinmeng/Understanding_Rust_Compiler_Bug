{"sha": "ec47ccca041a0d14973c5151914ce0930d55ff1c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZWM0N2NjY2EwNDFhMGQxNDk3M2M1MTUxOTE0Y2UwOTMwZDU1ZmYxYw==", "commit": {"author": {"name": "Mark Mitchell", "email": "mark@codesourcery.com", "date": "2000-03-21T20:13:06Z"}, "committer": {"name": "Mark Mitchell", "email": "mmitchel@gcc.gnu.org", "date": "2000-03-21T20:13:06Z"}, "message": "tree.c (mark_local_for_remap_p): Mark variables declared in TARGET_EXPRs as well.\n\n\t* tree.c (mark_local_for_remap_p): Mark variables declared in\n\tTARGET_EXPRs as well.\n\nFrom-SVN: r32675", "tree": {"sha": "8ada21a8d059e7bf3064be40e7948e7c9d9bcada", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/8ada21a8d059e7bf3064be40e7948e7c9d9bcada"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ec47ccca041a0d14973c5151914ce0930d55ff1c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec47ccca041a0d14973c5151914ce0930d55ff1c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ec47ccca041a0d14973c5151914ce0930d55ff1c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ec47ccca041a0d14973c5151914ce0930d55ff1c/comments", "author": null, "committer": null, "parents": [{"sha": "b8de2d021a0d6798e4b611078c667a6ac7f81a67", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8de2d021a0d6798e4b611078c667a6ac7f81a67", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8de2d021a0d6798e4b611078c667a6ac7f81a67"}], "stats": {"total": 71, "additions": 62, "deletions": 9}, "files": [{"sha": "ed2316479b03e677c7a2a778083fe8d5f1de9bd3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec47ccca041a0d14973c5151914ce0930d55ff1c/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec47ccca041a0d14973c5151914ce0930d55ff1c/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=ec47ccca041a0d14973c5151914ce0930d55ff1c", "patch": "@@ -1,3 +1,8 @@\n+2000-03-21  Mark Mitchell  <mark@codesourcery.com>\n+\n+\t* tree.c (mark_local_for_remap_p): Mark variables declared in\n+\tTARGET_EXPRs as well.\n+\n 2000-03-21  Nathan Sidwell  <nathan@codesourcery.com>\n \n \t* typeck.c (require_complete_type, complete_type,"}, {"sha": "1409020e8714850690dee5d9d548c8fc0bcf2618", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 15, "deletions": 9, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec47ccca041a0d14973c5151914ce0930d55ff1c/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec47ccca041a0d14973c5151914ce0930d55ff1c/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=ec47ccca041a0d14973c5151914ce0930d55ff1c", "patch": "@@ -2317,18 +2317,24 @@ mark_local_for_remap_r (tp, walk_subtrees, data)\n {\n   tree t = *tp;\n   splay_tree st = (splay_tree) data;\n+  tree decl;\n \n-  if ((TREE_CODE (t) == DECL_STMT\n-       && nonstatic_local_decl_p (DECL_STMT_DECL (t)))\n-      || TREE_CODE (t) == LABEL_STMT)\n+  \n+  if (TREE_CODE (t) == DECL_STMT\n+      && nonstatic_local_decl_p (DECL_STMT_DECL (t)))\n+    decl = DECL_STMT_DECL (t);\n+  else if (TREE_CODE (t) == LABEL_STMT)\n+    decl = LABEL_STMT_LABEL (t);\n+  else if (TREE_CODE (t) == TARGET_EXPR\n+\t   && nonstatic_local_decl_p (TREE_OPERAND (t, 0)))\n+    decl = TREE_OPERAND (t, 0);\n+  else\n+    decl = NULL_TREE;\n+\n+  if (decl)\n     {\n-      tree decl;\n       tree copy;\n \n-      /* Figure out what's being declared.  */\n-      decl = (TREE_CODE (t) == DECL_STMT\n-\t      ? DECL_STMT_DECL (t) : LABEL_STMT_LABEL (t));\n-      \n       /* Make a copy.  */\n       copy = copy_decl_for_inlining (decl, \n \t\t\t\t     DECL_CONTEXT (decl), \n@@ -2344,7 +2350,7 @@ mark_local_for_remap_r (tp, walk_subtrees, data)\n }\n \n /* Called via walk_tree when an expression is unsaved.  Using the\n-   splay_tree pointed to by ST (which is really a `splay_tree *'),\n+   splay_tree pointed to by ST (which is really a `splay_tree'),\n    remaps all local declarations to appropriate replacements.  */\n \n static tree"}, {"sha": "f1148afdd065dafcecaa7918da1157c3a3ef2385", "filename": "gcc/testsuite/g++.old-deja/g++.other/dtor7.C", "status": "added", "additions": 42, "deletions": 0, "changes": 42, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ec47ccca041a0d14973c5151914ce0930d55ff1c/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdtor7.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ec47ccca041a0d14973c5151914ce0930d55ff1c/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdtor7.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fdtor7.C?ref=ec47ccca041a0d14973c5151914ce0930d55ff1c", "patch": "@@ -0,0 +1,42 @@\n+// Origin: Mark Mitchell <mitchell@codesourcery.com>\n+// Special g++ Options: -O2\n+\n+int i;\n+int j;\n+\n+struct A\n+{\n+  A ();\n+  A (const A&);\n+  ~A ();\n+};\n+\n+A::A ()\n+{\n+  ++i;\n+}\n+\n+A::A (const A&)\n+{\n+  ++i;\n+}\n+\n+A::~A () \n+{\n+  --i;\n+}\n+\n+A f () \n+{\n+  return A ();\n+}\n+\n+void g (const A&)\n+{\n+}\n+\n+int main ()\n+{\n+  g (f ());\n+  return i;\n+}"}]}