{"sha": "797d88589e5ccb5bf5c1143aa728e517387fa87a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Nzk3ZDg4NTg5ZTVjY2I1YmY1YzExNDNhYTcyOGU1MTczODdmYTg3YQ==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2014-12-01T19:07:37Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2014-12-01T19:07:37Z"}, "message": "re PR middle-end/64017 (Support ISL 0.14.0 (to fix ICE with gfortran.dg/graphite/pr42393.f90))\n\n2014-12-01  Tobias Burnus  <burnus@net-b.de>\n            Jack Howarth  <howarth@bromo.med.uc.edu>\n\n        PR middle-end/64017\n        * configure.ac\n        * (ac_has_isl_schedule_constraints_compute_schedule):\n        New check.\n        * doc/install.texi (ISL): Permit ISL 0.14.\n        * graphite-optimize-isl.c (getScheduleForBandList,\n        * optimize_isl):\n        Conditionally use ISL 0.13+ functions.\n        * graphite-interchange.c: Make 'extern \"C\"' conditional.\n        * graphite-isl-ast-to-gimple.c: Ditto.\n        * graphite-poly.c: Ditto.\n        * graphite-sese-to-poly.c: Ditto.\n        * config.in: Regenerate.\n        * gcc/configure: Regenerate.\n\n\nCo-Authored-By: Jack Howarth <howarth@bromo.med.uc.edu>\n\nFrom-SVN: r218247", "tree": {"sha": "be3a2b7a117e5b375f803f3e1ae52c2afe3068f4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/be3a2b7a117e5b375f803f3e1ae52c2afe3068f4"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/797d88589e5ccb5bf5c1143aa728e517387fa87a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/797d88589e5ccb5bf5c1143aa728e517387fa87a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/797d88589e5ccb5bf5c1143aa728e517387fa87a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/797d88589e5ccb5bf5c1143aa728e517387fa87a/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "81ba15f10524cc46bf2afbe4fc07f783315c6d94", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/81ba15f10524cc46bf2afbe4fc07f783315c6d94", "html_url": "https://github.com/Rust-GCC/gccrs/commit/81ba15f10524cc46bf2afbe4fc07f783315c6d94"}], "stats": {"total": 143, "additions": 130, "deletions": 13}, "files": [{"sha": "88cfeef98b2e454518c5bd3d366dd6dd1811464a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 16, "deletions": 0, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -1,3 +1,19 @@\n+2014-12-01  Tobias Burnus  <burnus@net-b.de>\n+\t    Jack Howarth  <howarth@bromo.med.uc.edu>\n+\n+\tPR middle-end/64017\n+\t* configure.ac (ac_has_isl_schedule_constraints_compute_schedule):\n+\tNew check.\n+\t* doc/install.texi (ISL): Permit ISL 0.14.\n+\t* graphite-optimize-isl.c (getScheduleForBandList, optimize_isl):\n+\tConditionally use ISL 0.13+ functions.\n+\t* graphite-interchange.c: Make 'extern \"C\"' conditional.\n+\t* graphite-isl-ast-to-gimple.c: Ditto.\n+\t* graphite-poly.c: Ditto.\n+\t* graphite-sese-to-poly.c: Ditto.\n+\t* config.in: Regenerate.\n+\t* gcc/configure: Regenerate.\n+\n 2014-12-01  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* combine.c (distribute_links): Handle multiple SETs."}, {"sha": "65d5e421a9038a027eb140208e10060d9ed1dc41", "filename": "gcc/config.in", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fconfig.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fconfig.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig.in?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -1295,6 +1295,12 @@\n #endif\n \n \n+/* Define if isl_schedule_constraints_compute_schedule exists. */\n+#ifndef USED_FOR_TARGET\n+#undef HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE\n+#endif\n+\n+\n /* Define to 1 if you have the `kill' function. */\n #ifndef USED_FOR_TARGET\n #undef HAVE_KILL"}, {"sha": "6b46bbb9e4e48e756f0198bebe6f0e6751f30b10", "filename": "gcc/configure", "status": "modified", "additions": 41, "deletions": 0, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -28057,6 +28057,47 @@ $as_echo \"#define HAVE_isl 1\" >>confdefs.h\n \n fi\n \n+# Check whether isl_schedule_constraints_compute_schedule is available;\n+# it's new in ISL-0.13.\n+if test \"x${ISLLIBS}\" != \"x\" ; then\n+  saved_CFLAGS=\"$CFLAGS\"\n+  CFLAGS=\"$CFLAGS $ISLINC\"\n+  saved_LIBS=\"$LIBS\"\n+  LIBS=\"$LIBS $ISLLIBS $GMPLIBS\"\n+\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking Checking for isl_schedule_constraints_compute_schedule\" >&5\n+$as_echo_n \"checking Checking for isl_schedule_constraints_compute_schedule... \" >&6; }\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+#include <isl/schedule.h>\n+int\n+main ()\n+{\n+isl_schedule_constraints_compute_schedule (NULL);\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+  ac_has_isl_schedule_constraints_compute_schedule=yes\n+else\n+  ac_has_isl_schedule_constraints_compute_schedule=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_has_isl_schedule_constraints_compute_schedule\" >&5\n+$as_echo \"$ac_has_isl_schedule_constraints_compute_schedule\" >&6; }\n+\n+  LIBS=\"$saved_LIBS\"\n+  CFLAGS=\"$saved_CFLAGS\"\n+\n+  if test x\"$ac_has_isl_schedule_constraints_compute_schedule\" = x\"yes\"; then\n+\n+$as_echo \"#define HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE 1\" >>confdefs.h\n+\n+  fi\n+fi\n+\n # Check for plugin support\n    # Check whether --enable-plugin was given.\n if test \"${enable_plugin+set}\" = set; then :"}, {"sha": "48c8000b24973635bebac852a20390c95058baea", "filename": "gcc/configure.ac", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -5601,6 +5601,30 @@ if test \"x${ISLLIBS}\" != \"x\" ; then\n    AC_DEFINE(HAVE_isl, 1, [Define if isl is in use.])\n fi\n \n+# Check whether isl_schedule_constraints_compute_schedule is available;\n+# it's new in ISL-0.13.\n+if test \"x${ISLLIBS}\" != \"x\" ; then\n+  saved_CFLAGS=\"$CFLAGS\"\n+  CFLAGS=\"$CFLAGS $ISLINC\"\n+  saved_LIBS=\"$LIBS\"\n+  LIBS=\"$LIBS $ISLLIBS $GMPLIBS\"\n+\n+  AC_MSG_CHECKING([Checking for isl_schedule_constraints_compute_schedule])\n+  AC_TRY_LINK([#include <isl/schedule.h>],\n+              [isl_schedule_constraints_compute_schedule (NULL);],\n+              [ac_has_isl_schedule_constraints_compute_schedule=yes],\n+              [ac_has_isl_schedule_constraints_compute_schedule=no])\n+  AC_MSG_RESULT($ac_has_isl_schedule_constraints_compute_schedule)\n+\n+  LIBS=\"$saved_LIBS\"\n+  CFLAGS=\"$saved_CFLAGS\"\n+\n+  if test x\"$ac_has_isl_schedule_constraints_compute_schedule\" = x\"yes\"; then\n+     AC_DEFINE(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE, 1,\n+               [Define if isl_schedule_constraints_compute_schedule exists.])\n+  fi\n+fi\n+\n GCC_ENABLE_PLUGINS\n AC_SUBST(pluginlibs)\n AC_SUBST(enable_plugin)"}, {"sha": "1fbef63d0e3c9960f9f8380af45ac1493a9dfe07", "filename": "gcc/doc/install.texi", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fdoc%2Finstall.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fdoc%2Finstall.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finstall.texi?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -383,7 +383,7 @@ installed but it is not in your default library search path, the\n @option{--with-mpc} configure option should be used.  See also\n @option{--with-mpc-lib} and @option{--with-mpc-include}.\n \n-@item ISL Library version 0.12.2\n+@item ISL Library version 0.14 (or 0.12.2)\n \n Necessary to build GCC with the Graphite loop optimizations.\n It can be downloaded from @uref{ftp://gcc.gnu.org/pub/gcc/infrastructure/}"}, {"sha": "9f30d2420c3e0ee878cbbb9b77b48da2fe0f62e1", "filename": "gcc/graphite-interchange.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-interchange.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-interchange.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-interchange.c?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -30,11 +30,13 @@ along with GCC; see the file COPYING3.  If not see\n #include <isl/union_map.h>\n #include <isl/ilp.h>\n #include <isl/val.h>\n-#if defined(__cplusplus)\n+\n+/* Since ISL-0.13, the extern is in val_gmp.h.  */\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n extern \"C\" {\n #endif\n #include <isl/val_gmp.h>\n-#if defined(__cplusplus)\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n }\n #endif\n #endif"}, {"sha": "456b24e76511e8ea9b4ff57ea512a2a49a4e9865", "filename": "gcc/graphite-isl-ast-to-gimple.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-isl-ast-to-gimple.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-isl-ast-to-gimple.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-isl-ast-to-gimple.c?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -25,11 +25,13 @@ along with GCC; see the file COPYING3.  If not see\n #include <isl/map.h>\n #include <isl/union_map.h>\n #include <isl/ast_build.h>\n-#if defined(__cplusplus)\n+\n+/* Since ISL-0.13, the extern is in val_gmp.h.  */\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n extern \"C\" {\n #endif\n #include <isl/val_gmp.h>\n-#if defined(__cplusplus)\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n }\n #endif\n #endif"}, {"sha": "4cce70093f10082712083c22a7ca2441581ace93", "filename": "gcc/graphite-optimize-isl.c", "status": "modified", "additions": 26, "deletions": 0, "changes": 26, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-optimize-isl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-optimize-isl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-optimize-isl.c?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -460,7 +460,11 @@ getScheduleForBandList (isl_band_list *BandList, isl_union_map **map_sepcl)\n \t      if (flag_loop_unroll_jam && (i != (ScheduleDimensions - depth)))\n \t\tcontinue;\n \n+#ifdef HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE\n+\t      if (isl_band_member_is_coincident (Band, i))\n+#else\n \t      if (isl_band_member_is_zero_distance (Band, i))\n+#endif\n \t\t{\n \t\t  isl_map *TileMap;\n \t\t  isl_union_map *TileUMap;\n@@ -564,6 +568,9 @@ optimize_isl (scop_p scop)\n {\n \n   isl_schedule *schedule;\n+#ifdef HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE\n+  isl_schedule_constraints *schedule_constraints;\n+#endif\n   isl_union_set *domain;\n   isl_union_map *validity, *proximity, *dependences;\n   isl_union_map *schedule_map;\n@@ -579,11 +586,30 @@ optimize_isl (scop_p scop)\n \n   proximity = isl_union_map_copy (validity);\n \n+#ifdef HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE\n+  schedule_constraints = isl_schedule_constraints_on_domain (domain);\n+  schedule_constraints\n+\t= isl_schedule_constraints_set_proximity (schedule_constraints,\n+\t\t\t\t\t\t  proximity);\n+  schedule_constraints\n+\t= isl_schedule_constraints_set_validity (schedule_constraints,\n+\t\t\t\t\t\t isl_union_map_copy (validity));\n+  schedule_constraints\n+\t= isl_schedule_constraints_set_coincidence (schedule_constraints,\n+\t\t\t\t\t\t    validity);\n+#endif\n+\n   isl_options_set_schedule_max_constant_term (scop->ctx, CONSTANT_BOUND);\n   isl_options_set_schedule_maximize_band_depth (scop->ctx, 1);\n   isl_options_set_schedule_fuse (scop->ctx, ISL_SCHEDULE_FUSE_MIN);\n   isl_options_set_on_error (scop->ctx, ISL_ON_ERROR_CONTINUE);\n+\n+#ifdef HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE\n+  schedule = isl_schedule_constraints_compute_schedule(schedule_constraints);\n+#else\n   schedule = isl_union_set_compute_schedule (domain, validity, proximity);\n+#endif\n+\n   isl_options_set_on_error (scop->ctx, ISL_ON_ERROR_ABORT);\n \n   if (!schedule)"}, {"sha": "fa313df42a842cde6e4b697335977b19ea359d7c", "filename": "gcc/graphite-poly.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-poly.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-poly.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-poly.c?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -29,11 +29,13 @@ along with GCC; see the file COPYING3.  If not see\n #include <isl/ilp.h>\n #include <isl/aff.h>\n #include <isl/val.h>\n-#if defined(__cplusplus)\n+\n+/* Since ISL-0.13, the extern is in val_gmp.h.  */\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n extern \"C\" {\n #endif\n #include <isl/val_gmp.h>\n-#if defined(__cplusplus)\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n }\n #endif\n #endif"}, {"sha": "9136d6350f999d1b67f622518c023e208dca00aa", "filename": "gcc/graphite-sese-to-poly.c", "status": "modified", "additions": 4, "deletions": 6, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-sese-to-poly.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/797d88589e5ccb5bf5c1143aa728e517387fa87a/gcc%2Fgraphite-sese-to-poly.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgraphite-sese-to-poly.c?ref=797d88589e5ccb5bf5c1143aa728e517387fa87a", "patch": "@@ -27,15 +27,13 @@ along with GCC; see the file COPYING3.  If not see\n #include <isl/constraint.h>\n #include <isl/aff.h>\n #include <isl/val.h>\n-/* For C++ linkage of C functions.\n-   Missing from  isl/val_gmp.h in isl 0.12 versions.\n-   Appearing in isl/val_gmp.h in isl 0.13.\n-   To be removed when passing to isl 0.13. */\n-#if defined(__cplusplus)\n+\n+/* Since ISL-0.13, the extern is in val_gmp.h.  */\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n extern \"C\" {\n #endif\n #include <isl/val_gmp.h>\n-#if defined(__cplusplus)\n+#if !defined(HAVE_ISL_SCHED_CONSTRAINTS_COMPUTE_SCHEDULE) && defined(__cplusplus)\n }\n #endif\n #endif"}]}