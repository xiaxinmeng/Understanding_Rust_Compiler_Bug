{"sha": "af344a30f80436c7ad88034221f55070b9ae1325", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWYzNDRhMzBmODA0MzZjN2FkODgwMzQyMjFmNTUwNzBiOWFlMTMyNQ==", "commit": {"author": {"name": "Dominik Vogt", "email": "vogt@linux.vnet.ibm.com", "date": "2015-11-20T07:36:07Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2015-11-20T07:36:07Z"}, "message": "S/390: Clobber r1 in patterns resulting in pfpo instruction.\n\ngcc/ChangeLog\n\n\t* config/s390/s390.md (GPR1_REGNUM): New constant.\n\t(\"*trunc<BFP:mode><DFP_ALL:mode>2\")\n\t(\"*trunc<DFP_ALL:mode><BFP:mode>2\")\n\t(\"trunc<BFP:mode><DFP_ALL:mode>2\")\n\t(\"trunc<DFP_ALL:mode><BFP:mode>2\")\n\t(\"*extend<BFP:mode><DFP_ALL:mode>2\")\n\t(\"*extend<DFP_ALL:mode><BFP:mode>2\")\n\t(\"extend<BFP:mode><DFP_ALL:mode>2\")\n\t(\"extend<DFP_ALL:mode><BFP:mode>2\"): Clobber r1.\n\ngcc/testsuite/ChangeLog\n\n\t* gcc.target/s390/pfpo.c: New test.\n\nFrom-SVN: r230642", "tree": {"sha": "15eae77bb1d9aa92aedf7f1b6c942a3a9f95b69f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/15eae77bb1d9aa92aedf7f1b6c942a3a9f95b69f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/af344a30f80436c7ad88034221f55070b9ae1325", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af344a30f80436c7ad88034221f55070b9ae1325", "html_url": "https://github.com/Rust-GCC/gccrs/commit/af344a30f80436c7ad88034221f55070b9ae1325", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/af344a30f80436c7ad88034221f55070b9ae1325/comments", "author": {"login": "vogtd", "id": 9690100, "node_id": "MDQ6VXNlcjk2OTAxMDA=", "avatar_url": "https://avatars.githubusercontent.com/u/9690100?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vogtd", "html_url": "https://github.com/vogtd", "followers_url": "https://api.github.com/users/vogtd/followers", "following_url": "https://api.github.com/users/vogtd/following{/other_user}", "gists_url": "https://api.github.com/users/vogtd/gists{/gist_id}", "starred_url": "https://api.github.com/users/vogtd/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vogtd/subscriptions", "organizations_url": "https://api.github.com/users/vogtd/orgs", "repos_url": "https://api.github.com/users/vogtd/repos", "events_url": "https://api.github.com/users/vogtd/events{/privacy}", "received_events_url": "https://api.github.com/users/vogtd/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "cf0347ae4c15e3435225e3285bfcb6ed3bf044b1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cf0347ae4c15e3435225e3285bfcb6ed3bf044b1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cf0347ae4c15e3435225e3285bfcb6ed3bf044b1"}], "stats": {"total": 62, "additions": 54, "deletions": 8}, "files": [{"sha": "0a04eaa2d583efd5ebad2a020ce36406cb6da51a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=af344a30f80436c7ad88034221f55070b9ae1325", "patch": "@@ -1,3 +1,15 @@\n+2015-11-20  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\t* config/s390/s390.md (GPR1_REGNUM): New constant.\n+\t(\"*trunc<BFP:mode><DFP_ALL:mode>2\")\n+\t(\"*trunc<DFP_ALL:mode><BFP:mode>2\")\n+\t(\"trunc<BFP:mode><DFP_ALL:mode>2\")\n+\t(\"trunc<DFP_ALL:mode><BFP:mode>2\")\n+\t(\"*extend<BFP:mode><DFP_ALL:mode>2\")\n+\t(\"*extend<DFP_ALL:mode><BFP:mode>2\")\n+\t(\"extend<BFP:mode><DFP_ALL:mode>2\")\n+\t(\"extend<DFP_ALL:mode><BFP:mode>2\"): Clobber r1.\n+\n 2015-11-19  Aditya Kumar  <aditya.k7@samsung.com>\n \t    Sebastian Pop  <s.pop@samsung.com>\n "}, {"sha": "f2bb24c24318b521612ab3db9a1c10aa4f17bc05", "filename": "gcc/config/s390/s390.md", "status": "modified", "additions": 17, "deletions": 8, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2Fconfig%2Fs390%2Fs390.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2Fconfig%2Fs390%2Fs390.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.md?ref=af344a30f80436c7ad88034221f55070b9ae1325", "patch": "@@ -301,6 +301,7 @@\n   [\n    ; General purpose registers\n    (GPR0_REGNUM                  0)\n+   (GPR1_REGNUM                  1)\n    ; Floating point registers.\n    (FPR0_REGNUM                 16)\n    (FPR1_REGNUM                 20)\n@@ -4895,15 +4896,17 @@\n   [(set (reg:DFP_ALL FPR0_REGNUM)\n         (float_truncate:DFP_ALL (reg:BFP FPR4_REGNUM)))\n    (use (reg:SI GPR0_REGNUM))\n-   (clobber (reg:CC CC_REGNUM))]\n+   (clobber (reg:CC CC_REGNUM))\n+   (clobber (reg:SI GPR1_REGNUM))]\n   \"TARGET_HARD_DFP\"\n   \"pfpo\")\n \n (define_insn \"*trunc<DFP_ALL:mode><BFP:mode>2\"\n   [(set (reg:BFP FPR0_REGNUM)\n         (float_truncate:BFP (reg:DFP_ALL FPR4_REGNUM)))\n    (use (reg:SI GPR0_REGNUM))\n-   (clobber (reg:CC CC_REGNUM))]\n+   (clobber (reg:CC CC_REGNUM))\n+   (clobber (reg:SI GPR1_REGNUM))]\n   \"TARGET_HARD_DFP\"\n   \"pfpo\")\n \n@@ -4914,7 +4917,8 @@\n     [(set (reg:DFP_ALL FPR0_REGNUM)\n           (float_truncate:DFP_ALL (reg:BFP FPR4_REGNUM)))\n      (use (reg:SI GPR0_REGNUM))\n-     (clobber (reg:CC CC_REGNUM))])\n+     (clobber (reg:CC CC_REGNUM))\n+     (clobber (reg:SI GPR1_REGNUM))])\n    (set (match_operand:DFP_ALL 0 \"nonimmediate_operand\" \"\")\n         (reg:DFP_ALL FPR0_REGNUM))]\n   \"TARGET_HARD_DFP\n@@ -4936,7 +4940,8 @@\n    (parallel\n     [(set (reg:BFP FPR0_REGNUM) (float_truncate:BFP (reg:DFP_ALL FPR4_REGNUM)))\n      (use (reg:SI GPR0_REGNUM))\n-     (clobber (reg:CC CC_REGNUM))])\n+     (clobber (reg:CC CC_REGNUM))\n+     (clobber (reg:SI GPR1_REGNUM))])\n    (set (match_operand:BFP 0 \"nonimmediate_operand\" \"\") (reg:BFP FPR0_REGNUM))]\n   \"TARGET_HARD_DFP\n    && GET_MODE_SIZE (<DFP_ALL:MODE>mode) >= GET_MODE_SIZE (<BFP:MODE>mode)\"\n@@ -4957,14 +4962,16 @@\n (define_insn \"*extend<BFP:mode><DFP_ALL:mode>2\"\n   [(set (reg:DFP_ALL FPR0_REGNUM) (float_extend:DFP_ALL (reg:BFP FPR4_REGNUM)))\n    (use (reg:SI GPR0_REGNUM))\n-   (clobber (reg:CC CC_REGNUM))]\n+   (clobber (reg:CC CC_REGNUM))\n+   (clobber (reg:SI GPR1_REGNUM))]\n   \"TARGET_HARD_DFP\"\n   \"pfpo\")\n \n (define_insn \"*extend<DFP_ALL:mode><BFP:mode>2\"\n   [(set (reg:BFP FPR0_REGNUM) (float_extend:BFP (reg:DFP_ALL FPR4_REGNUM)))\n    (use (reg:SI GPR0_REGNUM))\n-   (clobber (reg:CC CC_REGNUM))]\n+   (clobber (reg:CC CC_REGNUM))\n+   (clobber (reg:SI GPR1_REGNUM))]\n   \"TARGET_HARD_DFP\"\n   \"pfpo\")\n \n@@ -4975,7 +4982,8 @@\n     [(set (reg:DFP_ALL FPR0_REGNUM)\n           (float_extend:DFP_ALL (reg:BFP FPR4_REGNUM)))\n      (use (reg:SI GPR0_REGNUM))\n-     (clobber (reg:CC CC_REGNUM))])\n+     (clobber (reg:CC CC_REGNUM))\n+     (clobber (reg:SI GPR1_REGNUM))])\n    (set (match_operand:DFP_ALL 0 \"nonimmediate_operand\" \"\")\n         (reg:DFP_ALL FPR0_REGNUM))]\n   \"TARGET_HARD_DFP\n@@ -4997,7 +5005,8 @@\n    (parallel\n     [(set (reg:BFP FPR0_REGNUM) (float_extend:BFP (reg:DFP_ALL FPR4_REGNUM)))\n      (use (reg:SI GPR0_REGNUM))\n-     (clobber (reg:CC CC_REGNUM))])\n+     (clobber (reg:CC CC_REGNUM))\n+     (clobber (reg:SI GPR1_REGNUM))])\n    (set (match_operand:BFP 0 \"nonimmediate_operand\" \"\") (reg:BFP FPR0_REGNUM))]\n   \"TARGET_HARD_DFP\n    && GET_MODE_SIZE (<DFP_ALL:MODE>mode) < GET_MODE_SIZE (<BFP:MODE>mode)\""}, {"sha": "247aa3accf141048df0c295b20fafd2646356e5f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=af344a30f80436c7ad88034221f55070b9ae1325", "patch": "@@ -1,3 +1,7 @@\n+2015-11-20  Dominik Vogt  <vogt@linux.vnet.ibm.com>\n+\n+\t* gcc.target/s390/pfpo.c: New test.\n+\n 2015-11-20  Kirill Yukhin  <kirill.yukhin@intel.com>\n \n \t* c-c++-common/attr-simd-3.c: Put xfail (PR68158) on dg-error."}, {"sha": "32725c991a62f935c9357c002d089509eaf73251", "filename": "gcc/testsuite/gcc.target/s390/pfpo.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpfpo.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/af344a30f80436c7ad88034221f55070b9ae1325/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpfpo.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fpfpo.c?ref=af344a30f80436c7ad88034221f55070b9ae1325", "patch": "@@ -0,0 +1,21 @@\n+/* The pfpo instruction generated by this code clobbers the r1 register while\n+   it was still in use.  */\n+\n+/* { dg-do run } */\n+/* { dg-options \"-O0 -march=z10 -mzarch\" } */\n+\n+int foo(int x)\n+{\n+  return x;\n+}\n+\n+int bar(int i, float f)\n+{\n+  return i;\n+}\n+\n+int main()\n+{\n+  _Decimal32 d = 7;\n+  return bar(foo(0x10203040), (float)d) == 0x10203040 ? 0 : 1;\n+}"}]}