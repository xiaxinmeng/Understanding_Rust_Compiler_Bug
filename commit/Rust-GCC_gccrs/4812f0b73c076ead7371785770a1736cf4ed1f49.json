{"sha": "4812f0b73c076ead7371785770a1736cf4ed1f49", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDgxMmYwYjczYzA3NmVhZDczNzE3ODU3NzBhMTczNmNmNGVkMWY0OQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2017-06-30T08:08:33Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2017-06-30T08:08:33Z"}, "message": "re PR tree-optimization/81249 (ICE: error: incompatible types in PHI argument 0)\n\n2017-06-30  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/81249\n\t* tree-vect-loop.c (vect_create_epilog_for_reduction): Convert\n\tcondition reduction result to original scalar type.\n\n\t* g++.dg/torture/pr81249.C: New testcase.\n\nFrom-SVN: r249831", "tree": {"sha": "d9d3ce92557a66fe1c5d1bfe7920384473f8ed14", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d9d3ce92557a66fe1c5d1bfe7920384473f8ed14"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4812f0b73c076ead7371785770a1736cf4ed1f49", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4812f0b73c076ead7371785770a1736cf4ed1f49", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4812f0b73c076ead7371785770a1736cf4ed1f49", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4812f0b73c076ead7371785770a1736cf4ed1f49/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5ef4d61d2b24760fe5f7dad84f8201e094bacad9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ef4d61d2b24760fe5f7dad84f8201e094bacad9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ef4d61d2b24760fe5f7dad84f8201e094bacad9"}], "stats": {"total": 50, "additions": 44, "deletions": 6}, "files": [{"sha": "eab752a5e13121eb443a2248dbf5e59d3d691613", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4812f0b73c076ead7371785770a1736cf4ed1f49", "patch": "@@ -1,3 +1,9 @@\n+2017-06-30  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/81249\n+\t* tree-vect-loop.c (vect_create_epilog_for_reduction): Convert\n+\tcondition reduction result to original scalar type.\n+\n 2017-06-30  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n \n \t* profile-count.h (enum profile_quality): Fix typos and whitespace"}, {"sha": "9b92e447724d406ac235f2abff05788af2d44d53", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=4812f0b73c076ead7371785770a1736cf4ed1f49", "patch": "@@ -1,3 +1,8 @@\n+2017-06-30  Richard Biener  <rguenther@suse.de>\n+\n+\tPR tree-optimization/81249\n+\t* g++.dg/torture/pr81249.C: New testcase.\n+\n 2017-06-29  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \t* g++.dg/cpp0x/inh-ctor3.C: Adjust for dg-message vs dg-error."}, {"sha": "7bf617b0421869eb5d5c9053e40748ee216762f5", "filename": "gcc/testsuite/g++.dg/torture/pr81249.C", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr81249.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr81249.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftorture%2Fpr81249.C?ref=4812f0b73c076ead7371785770a1736cf4ed1f49", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do compile } */\n+/* { dg-additional-options \"-mavx2 -mprefer-avx128\" { target x86_64-*-* i?86-*-* } } */\n+\n+typedef struct rtx_def *rtx;\n+union rtunion {\n+    rtx rt_rtx;\n+};\n+struct rtx_def {\n+    struct {\n+\trtunion fld[0];\n+    } u;\n+    rtx elem[];\n+} a;\n+int b, c, d;\n+rtx e;\n+int main() {\n+    for (;;) {\n+\td = 0;\n+\tfor (; d < b; d++)\n+\t  if (a.elem[d])\n+\t    e = a.elem[d]->u.fld[1].rt_rtx;\n+\tif (e)\n+\t  c = 0;\n+    }\n+}"}, {"sha": "bab0cdd3f5145f45e0089582a6beefec05f8c550", "filename": "gcc/tree-vect-loop.c", "status": "modified", "additions": 8, "deletions": 6, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2Ftree-vect-loop.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4812f0b73c076ead7371785770a1736cf4ed1f49/gcc%2Ftree-vect-loop.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-loop.c?ref=4812f0b73c076ead7371785770a1736cf4ed1f49", "patch": "@@ -4835,12 +4835,9 @@ vect_create_epilog_for_reduction (vec<tree> vect_defs, gimple *stmt,\n \n       /* Convert the reduced value back to the result type and set as the\n \t result.  */\n-      tree data_reduc_cast = build1 (VIEW_CONVERT_EXPR, scalar_type,\n-\t\t\t\t     data_reduc);\n-      epilog_stmt = gimple_build_assign (new_scalar_dest, data_reduc_cast);\n-      new_temp = make_ssa_name (new_scalar_dest, epilog_stmt);\n-      gimple_assign_set_lhs (epilog_stmt, new_temp);\n-      gsi_insert_before (&exit_gsi, epilog_stmt, GSI_SAME_STMT);\n+      gimple_seq stmts = NULL;\n+      new_temp = gimple_convert (&stmts, scalar_type, data_reduc);\n+      gsi_insert_seq_before (&exit_gsi, stmts, GSI_SAME_STMT);\n       scalar_results.safe_push (new_temp);\n     }\n   else if (STMT_VINFO_VEC_REDUCTION_TYPE (stmt_info) == COND_REDUCTION\n@@ -4905,6 +4902,11 @@ vect_create_epilog_for_reduction (vec<tree> vect_defs, gimple *stmt,\n \t      val = new_val;\n \t    }\n \t}\n+      /* Convert the reduced value back to the result type and set as the\n+\t result.  */\n+      gimple_seq stmts = NULL;\n+      val = gimple_convert (&stmts, scalar_type, val);\n+      gsi_insert_seq_before (&exit_gsi, stmts, GSI_SAME_STMT);\n       scalar_results.safe_push (val);\n     }\n "}]}