{"sha": "fc32180d704e59553584ae2a814089c2af1bce09", "node_id": "C_kwDOANBUbNoAKGZjMzIxODBkNzA0ZTU5NTUzNTg0YWUyYTgxNDA4OWMyYWYxYmNlMDk", "commit": {"author": {"name": "Bob Duff", "email": "duff@adacore.com", "date": "2022-07-20T21:37:51Z"}, "committer": {"name": "Marc Poulhi\u00e8s", "email": "poulhies@adacore.com", "date": "2022-09-05T07:21:03Z"}, "message": "[Ada] Suppress warnings in trivial subprograms with finalization\n\nThere are heuristics for suppressing warnings about unused objects in\ntrivial cases. In particular, we try to suppress warnings here:\n\n   function F (A : Integer) return Some_Type;\n      X : Some_Type;\n   begin\n      raise Not_Yet_Implemented;\n      return X;\n   end F;\n\nBut it doesn't work if Some_Type is controlled. This patch fixes that\nbug.\n\ngcc/ada/\n\n\t* sem_ch6.adb\n\t(Analyze_Subprogram_Body_Helper): Use First_Real_Statement to deal\n\twith this case. Note that First_Real_Statement is likely to be\n\tremoved as part of this ticket, so this is a temporary fix.", "tree": {"sha": "d3ef834afc1a3407debaef5c747d9477dfda0560", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d3ef834afc1a3407debaef5c747d9477dfda0560"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/fc32180d704e59553584ae2a814089c2af1bce09", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc32180d704e59553584ae2a814089c2af1bce09", "html_url": "https://github.com/Rust-GCC/gccrs/commit/fc32180d704e59553584ae2a814089c2af1bce09", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/fc32180d704e59553584ae2a814089c2af1bce09/comments", "author": {"login": "bobduff", "id": 29099567, "node_id": "MDQ6VXNlcjI5MDk5NTY3", "avatar_url": "https://avatars.githubusercontent.com/u/29099567?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bobduff", "html_url": "https://github.com/bobduff", "followers_url": "https://api.github.com/users/bobduff/followers", "following_url": "https://api.github.com/users/bobduff/following{/other_user}", "gists_url": "https://api.github.com/users/bobduff/gists{/gist_id}", "starred_url": "https://api.github.com/users/bobduff/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bobduff/subscriptions", "organizations_url": "https://api.github.com/users/bobduff/orgs", "repos_url": "https://api.github.com/users/bobduff/repos", "events_url": "https://api.github.com/users/bobduff/events{/privacy}", "received_events_url": "https://api.github.com/users/bobduff/received_events", "type": "User", "site_admin": false}, "committer": {"login": "dkm", "id": 87603, "node_id": "MDQ6VXNlcjg3NjAz", "avatar_url": "https://avatars.githubusercontent.com/u/87603?v=4", "gravatar_id": "", "url": "https://api.github.com/users/dkm", "html_url": "https://github.com/dkm", "followers_url": "https://api.github.com/users/dkm/followers", "following_url": "https://api.github.com/users/dkm/following{/other_user}", "gists_url": "https://api.github.com/users/dkm/gists{/gist_id}", "starred_url": "https://api.github.com/users/dkm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/dkm/subscriptions", "organizations_url": "https://api.github.com/users/dkm/orgs", "repos_url": "https://api.github.com/users/dkm/repos", "events_url": "https://api.github.com/users/dkm/events{/privacy}", "received_events_url": "https://api.github.com/users/dkm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "7449db0bf4a2c920538a7f947ccec2831802ded4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7449db0bf4a2c920538a7f947ccec2831802ded4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7449db0bf4a2c920538a7f947ccec2831802ded4"}], "stats": {"total": 12, "additions": 9, "deletions": 3}, "files": [{"sha": "724012980608d8bfa33a9f6bfadd601a2e81dba4", "filename": "gcc/ada/sem_ch6.adb", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/fc32180d704e59553584ae2a814089c2af1bce09/gcc%2Fada%2Fsem_ch6.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/fc32180d704e59553584ae2a814089c2af1bce09/gcc%2Fada%2Fsem_ch6.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch6.adb?ref=fc32180d704e59553584ae2a814089c2af1bce09", "patch": "@@ -5409,14 +5409,20 @@ package body Sem_Ch6 is\n       --  we have a special test to set X as apparently assigned to suppress\n       --  the warning.\n \n-      declare\n-         Stm : Node_Id;\n+      --  If X above is controlled, we need to use First_Real_Statement to skip\n+      --  generated finalization-related code. Otherwise (First_Real_Statement\n+      --  is Empty), we just get the first statement.\n \n+      declare\n+         Stm : Node_Id := First_Real_Statement (HSS);\n       begin\n+         if No (Stm) then\n+            Stm := First (Statements (HSS));\n+         end if;\n+\n          --  Skip call markers installed by the ABE mechanism, labels, and\n          --  Push_xxx_Error_Label to find the first real statement.\n \n-         Stm := First (Statements (HSS));\n          while Nkind (Stm) in N_Call_Marker | N_Label | N_Push_xxx_Label loop\n             Next (Stm);\n          end loop;"}]}