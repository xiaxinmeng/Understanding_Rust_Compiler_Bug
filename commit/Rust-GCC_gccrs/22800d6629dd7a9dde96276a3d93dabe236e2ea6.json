{"sha": "22800d6629dd7a9dde96276a3d93dabe236e2ea6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjI4MDBkNjYyOWRkN2E5ZGRlOTYyNzZhM2Q5M2RhYmUyMzZlMmVhNg==", "commit": {"author": {"name": "Robin Dapp", "email": "rdapp@linux.ibm.com", "date": "2018-07-17T12:05:07Z"}, "committer": {"name": "Robin Dapp", "email": "rdapp@gcc.gnu.org", "date": "2018-07-17T12:05:07Z"}, "message": "S/390: Set default function alignment to 16.\n\ngcc/ChangeLog:\n\n2018-07-17  Robin Dapp  <rdapp@linux.ibm.com>\n\n\t* config/s390/s390.c (s390_default_align): Set default function\n\talignment to 16.\n\t(s390_override_options_after_change): Call s390_default align.\n\t(s390_option_override_internal): Call s390_default_align.\n\t(TARGET_OVERRIDE_OPTIONS_AFTER_CHANGE): Define.\n\ngcc/testsuite/ChangeLog:\n\n2018-07-17  Robin Dapp  <rdapp@linux.ibm.com>\n\n\t* gcc.target/s390/function-align1.c: New test.\n\t* gcc.target/s390/function-align2.c: New test.\n\t* gcc.target/s390/function-align3.c: New test.\n\nFrom-SVN: r262817", "tree": {"sha": "53cb086a3bea2fa755e0ca8f167c0d4c0c6dcc57", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/53cb086a3bea2fa755e0ca8f167c0d4c0c6dcc57"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/22800d6629dd7a9dde96276a3d93dabe236e2ea6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22800d6629dd7a9dde96276a3d93dabe236e2ea6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/22800d6629dd7a9dde96276a3d93dabe236e2ea6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/22800d6629dd7a9dde96276a3d93dabe236e2ea6/comments", "author": {"login": "rdapp-ibm", "id": 80318053, "node_id": "MDQ6VXNlcjgwMzE4MDUz", "avatar_url": "https://avatars.githubusercontent.com/u/80318053?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rdapp-ibm", "html_url": "https://github.com/rdapp-ibm", "followers_url": "https://api.github.com/users/rdapp-ibm/followers", "following_url": "https://api.github.com/users/rdapp-ibm/following{/other_user}", "gists_url": "https://api.github.com/users/rdapp-ibm/gists{/gist_id}", "starred_url": "https://api.github.com/users/rdapp-ibm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rdapp-ibm/subscriptions", "organizations_url": "https://api.github.com/users/rdapp-ibm/orgs", "repos_url": "https://api.github.com/users/rdapp-ibm/repos", "events_url": "https://api.github.com/users/rdapp-ibm/events{/privacy}", "received_events_url": "https://api.github.com/users/rdapp-ibm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a3bccfa17c34a937d0222ec084fe9ca97d88a01f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3bccfa17c34a937d0222ec084fe9ca97d88a01f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3bccfa17c34a937d0222ec084fe9ca97d88a01f"}], "stats": {"total": 95, "additions": 95, "deletions": 0}, "files": [{"sha": "2e04a56a342a0e35292633efb2789a4bd6d28e5b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=22800d6629dd7a9dde96276a3d93dabe236e2ea6", "patch": "@@ -1,3 +1,11 @@\n+2018-07-17  Robin Dapp  <rdapp@linux.ibm.com>\n+\n+\t* config/s390/s390.c (s390_default_align): Set default function\n+\talignment to 16.\n+\t(s390_override_options_after_change): Call s390_default align.\n+\t(s390_option_override_internal): Call s390_default_align.\n+\t(TARGET_OVERRIDE_OPTIONS_AFTER_CHANGE): Define.\n+\n 2018-07-17  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR middle-end/86542"}, {"sha": "81f1fbaf894f4b427341dc62e142bbb41f257749", "filename": "gcc/config/s390/s390.c", "status": "modified", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Fconfig%2Fs390%2Fs390.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Fconfig%2Fs390%2Fs390.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390.c?ref=22800d6629dd7a9dde96276a3d93dabe236e2ea6", "patch": "@@ -15396,6 +15396,22 @@ s390_function_specific_restore (struct gcc_options *opts,\n   opts->x_s390_cost_pointer = (long)processor_table[opts->x_s390_tune].cost;\n }\n \n+static void\n+s390_default_align (struct gcc_options *opts)\n+{\n+  /* Set the default function alignment to 16 in order to get rid of\n+     some unwanted performance effects. */\n+  if (opts->x_flag_align_functions && !opts->x_str_align_functions\n+      && opts->x_s390_tune >= PROCESSOR_2964_Z13)\n+    opts->x_str_align_functions = \"16\";\n+}\n+\n+static void\n+s390_override_options_after_change (void)\n+{\n+  s390_default_align (&global_options);\n+}\n+\n static void\n s390_option_override_internal (bool main_args_p,\n \t\t\t       struct gcc_options *opts,\n@@ -15633,6 +15649,9 @@ s390_option_override_internal (bool main_args_p,\n \t\t\t opts->x_param_values,\n \t\t\t opts_set->x_param_values);\n \n+  /* Set the default alignment.  */\n+  s390_default_align (opts);\n+\n   /* Call target specific restore function to do post-init work.  At the moment,\n      this just sets opts->x_s390_cost_pointer.  */\n   s390_function_specific_restore (opts, NULL);\n@@ -16831,6 +16850,9 @@ s390_case_values_threshold (void)\n #undef TARGET_PASS_BY_REFERENCE\n #define TARGET_PASS_BY_REFERENCE s390_pass_by_reference\n \n+#undef  TARGET_OVERRIDE_OPTIONS_AFTER_CHANGE\n+#define TARGET_OVERRIDE_OPTIONS_AFTER_CHANGE s390_override_options_after_change\n+\n #undef TARGET_FUNCTION_OK_FOR_SIBCALL\n #define TARGET_FUNCTION_OK_FOR_SIBCALL s390_function_ok_for_sibcall\n #undef TARGET_FUNCTION_ARG"}, {"sha": "addeb046696405345c44d28edd8bd3bf512025be", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=22800d6629dd7a9dde96276a3d93dabe236e2ea6", "patch": "@@ -1,3 +1,9 @@\n+2018-07-17  Robin Dapp  <rdapp@linux.ibm.com>\n+\n+\t* gcc.target/s390/function-align1.c: New test.\n+\t* gcc.target/s390/function-align2.c: New test.\n+\t* gcc.target/s390/function-align3.c: New test.\n+\n 2018-07-17  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gnat.dg/discr55.adb: New test."}, {"sha": "78fa563098e95dd96392c4f27bd88513bd358376", "filename": "gcc/testsuite/gcc.target/s390/function-align1.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align1.c?ref=22800d6629dd7a9dde96276a3d93dabe236e2ea6", "patch": "@@ -0,0 +1,24 @@\n+/* { dg-do run } */\n+/* { dg-options \"-O2 -march=z13\"  } */\n+\n+#include <assert.h>\n+#include <stdint.h>\n+\n+__attribute__((noinline))\n+void foo1 () {}\n+\n+__attribute__((noinline))\n+__attribute__((optimize(\"align-functions=32\")))\n+void foo2 () {}\n+\n+int main ()\n+{\n+  foo1 ();\n+  foo2 ();\n+\n+  void *f = &foo1;\n+  void *g = &foo2;\n+\n+  assert (((uintptr_t)f % 16) == 0);\n+  assert (((uintptr_t)g % 32) == 0);\n+}"}, {"sha": "0d8e1ff225158abe360c6d040f18dea0bc398f6f", "filename": "gcc/testsuite/gcc.target/s390/function-align2.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align2.c?ref=22800d6629dd7a9dde96276a3d93dabe236e2ea6", "patch": "@@ -0,0 +1,13 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Os -march=z13\"  } */\n+\n+void bar ()\n+{\n+  /* { dg-final { scan-assembler-times \".align\\t8\" 2 } } */\n+}\n+\n+__attribute__((optimize(\"O2\")))\n+void baz ()\n+{\n+  /* { dg-final { scan-assembler-times \".align\\t16\" 1 } } */\n+}"}, {"sha": "adb79763d4ae440804ec4f35a995e1978ba4f18d", "filename": "gcc/testsuite/gcc.target/s390/function-align3.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/22800d6629dd7a9dde96276a3d93dabe236e2ea6/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Ffunction-align3.c?ref=22800d6629dd7a9dde96276a3d93dabe236e2ea6", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do run } */\n+/* { dg-options \"-Os -march=z13\"  } */\n+\n+#include <assert.h>\n+#include <stdint.h>\n+\n+__attribute__((noinline))\n+void bar () {}\n+\n+__attribute__((noinline))\n+__attribute__((optimize(\"O2\")))\n+void baf () {}\n+\n+int main ()\n+{\n+  bar ();\n+  baf ();\n+\n+  void *g = &baf;\n+\n+  assert ( ((uintptr_t)g % 16) == 0);\n+}"}]}