{"sha": "de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGUzYjUzMWM5YWE5MzU5MmY5OGViZDk5YzZiMzViZTYzMmUzYzFiMw==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2017-04-27T09:44:28Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2017-04-27T09:44:28Z"}, "message": "PR demangler/80513 check for overflows and invalid characters in thunks\n\n\tPR demangler/80513\n\t* cp-demangle.c (d_number): Check for overflow.\n\t* cplus-dem.c (consume_count): Fix overflow check.\n\t(gnu_special): Check for underscore after thunk delta.\n\t* testsuite/demangle-expected: Add tests for overflows and invalid\n\tcharacters in thunks.\n\nFrom-SVN: r247300", "tree": {"sha": "663a245b3b7b8a12f360f4e61851e6af2521dfde", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/663a245b3b7b8a12f360f4e61851e6af2521dfde"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "e77e24291b85bcb1ae1c7c48d8194a66ba642974", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e77e24291b85bcb1ae1c7c48d8194a66ba642974", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e77e24291b85bcb1ae1c7c48d8194a66ba642974"}], "stats": {"total": 42, "additions": 33, "deletions": 9}, "files": [{"sha": "1e7a6c6daca332f4db8c7a2c2b182e3155422901", "filename": "libiberty/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2FChangeLog?ref=de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "patch": "@@ -1,3 +1,12 @@\n+2017-04-27  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR demangler/80513\n+\t* cp-demangle.c (d_number): Check for overflow.\n+\t* cplus-dem.c (consume_count): Fix overflow check.\n+\t(gnu_special): Check for underscore after thunk delta.\n+\t* testsuite/demangle-expected: Add tests for overflows and invalid\n+\tcharacters in thunks.\n+\n 2017-04-21  Mark Wielaard  <mark@klomp.org>\n \n \t* cp-demangle.c (MAX_RECURSION_COUNT): New constant."}, {"sha": "7b8d0b4cbaa699544f11e5cc78f081053e4c9dc8", "filename": "libiberty/cp-demangle.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2Fcp-demangle.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2Fcp-demangle.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcp-demangle.c?ref=de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "patch": "@@ -1692,6 +1692,8 @@ d_number (struct d_info *di)\n \t    ret = - ret;\n \t  return ret;\n \t}\n+      if (ret > ((INT_MAX - (peek - '0')) / 10))\n+        return -1;\n       ret = ret * 10 + peek - '0';\n       d_advance (di, 1);\n       peek = d_peek_char (di);"}, {"sha": "81c17a3207d8d69e7d3c34e5f7f53fbb54876ddc", "filename": "libiberty/cplus-dem.c", "status": "modified", "additions": 7, "deletions": 9, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2Fcplus-dem.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2Fcplus-dem.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Fcplus-dem.c?ref=de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "patch": "@@ -520,21 +520,17 @@ consume_count (const char **type)\n \n   while (ISDIGIT ((unsigned char)**type))\n     {\n-      count *= 10;\n-\n-      /* Check for overflow.\n-\t We assume that count is represented using two's-complement;\n-\t no power of two is divisible by ten, so if an overflow occurs\n-\t when multiplying by ten, the result will not be a multiple of\n-\t ten.  */\n-      if ((count % 10) != 0)\n+      const int digit = **type - '0';\n+      /* Check for overflow.  */\n+      if (count > ((INT_MAX - digit) / 10))\n \t{\n \t  while (ISDIGIT ((unsigned char) **type))\n \t    (*type)++;\n \t  return -1;\n \t}\n \n-      count += **type - '0';\n+      count *= 10;\n+      count += digit;\n       (*type)++;\n     }\n \n@@ -3173,6 +3169,8 @@ gnu_special (struct work_stuff *work, const char **mangled, string *declp)\n       delta = consume_count (mangled);\n       if (delta == -1)\n \tsuccess = 0;\n+      else if (**mangled != '_')\n+        success = 0;\n       else\n \t{\n \t  char *method = internal_cplus_demangle (work, ++*mangled);"}, {"sha": "f2a12b9a7d1fd6a2678bc700ff5805d3b588edc4", "filename": "libiberty/testsuite/demangle-expected", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2Ftestsuite%2Fdemangle-expected", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de3b531c9aa93592f98ebd99c6b35be632e3c1b3/libiberty%2Ftestsuite%2Fdemangle-expected", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libiberty%2Ftestsuite%2Fdemangle-expected?ref=de3b531c9aa93592f98ebd99c6b35be632e3c1b3", "patch": "@@ -4720,3 +4720,18 @@ _ZdvMMMMMMMMMMMMMrrrrA_DTdvfp_fp_Eededilfdfdfdfd\n \n _Z1MA_aMMMMA_MMA_MMMMMMMMSt1MS_o11T0000000000t2M0oooozoooo\n _Z1MA_aMMMMA_MMA_MMMMMMMMSt1MS_o11T0000000000t2M0oooozoooo\n+\n+#\n+# demangler/80513 Test for overflow in d_number\n+_Z4294967297x\n+_Z4294967297x\n+\n+#\n+# demangler/80513 Test for bogus characters after __thunk_\n+__thunk_16a_$_1x\n+__thunk_16a_$_1x\n+\n+#\n+# demangler/80513 Test for overflow in consume_count\n+__thunk_4294967297__$_1x\n+__thunk_4294967297__$_1x"}]}