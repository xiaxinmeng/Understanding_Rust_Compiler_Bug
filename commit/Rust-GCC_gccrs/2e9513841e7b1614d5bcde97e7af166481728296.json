{"sha": "2e9513841e7b1614d5bcde97e7af166481728296", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmU5NTEzODQxZTdiMTYxNGQ1YmNkZTk3ZTdhZjE2NjQ4MTcyODI5Ng==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2002-01-07T21:13:25Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2002-01-07T21:13:25Z"}, "message": "simplify-rtx.c (simplify_plus_minus): Bump n_ops for NOT.\n\n\t* simplify-rtx.c (simplify_plus_minus): Bump n_ops for NOT.\n\tDon't allow -1 - x -> ~x simplifications in the first pass.\n\n\t* gcc.c-torture/execute/20020107-1.c: New test.\n\nFrom-SVN: r48614", "tree": {"sha": "aa99d84096fc4acf3768871bf9b897031e77910b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/aa99d84096fc4acf3768871bf9b897031e77910b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2e9513841e7b1614d5bcde97e7af166481728296", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e9513841e7b1614d5bcde97e7af166481728296", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2e9513841e7b1614d5bcde97e7af166481728296", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2e9513841e7b1614d5bcde97e7af166481728296/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "15eb1e433c13bfce36e4b8ad4a4a51c9ba24d4f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15eb1e433c13bfce36e4b8ad4a4a51c9ba24d4f9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15eb1e433c13bfce36e4b8ad4a4a51c9ba24d4f9"}], "stats": {"total": 47, "additions": 45, "deletions": 2}, "files": [{"sha": "bac2003e3ea51f789d860b856588ae7d9bfb2f9c", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2e9513841e7b1614d5bcde97e7af166481728296", "patch": "@@ -1,3 +1,8 @@\n+2002-01-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* simplify-rtx.c (simplify_plus_minus): Bump n_ops for NOT.\n+\tDon't allow -1 - x -> ~x simplifications in the first pass.\n+\n 2002-01-07  Aldy Hernandez  <aldyh@redhat.com>\n \n         * rs6000.c (altivec_expand_ternop_builtin): Don't die on invalid"}, {"sha": "84a9ce95ffa3fcf543ed4856a2a57e25f02945b9", "filename": "gcc/simplify-rtx.c", "status": "modified", "additions": 8, "deletions": 2, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2Fsimplify-rtx.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2Fsimplify-rtx.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsimplify-rtx.c?ref=2e9513841e7b1614d5bcde97e7af166481728296", "patch": "@@ -1800,7 +1800,7 @@ simplify_plus_minus (code, mode, op0, op1)\n \t      if (n_ops != 7)\n \t\t{\n \t\t  ops[n_ops].op = constm1_rtx;\n-\t\t  ops[n_ops].neg = this_neg;\n+\t\t  ops[n_ops++].neg = this_neg;\n \t\t  ops[i].op = XEXP (this_op, 0);\n \t\t  ops[i].neg = !this_neg;\n \t\t  changed = 1;\n@@ -1865,7 +1865,13 @@ simplify_plus_minus (code, mode, op0, op1)\n \t\t    && ! (GET_CODE (tem) == CONST\n \t\t\t  && GET_CODE (XEXP (tem, 0)) == ncode\n \t\t\t  && XEXP (XEXP (tem, 0), 0) == lhs\n-\t\t\t  && XEXP (XEXP (tem, 0), 1) == rhs))\n+\t\t\t  && XEXP (XEXP (tem, 0), 1) == rhs)\n+\t\t    /* Don't allow -x + -1 -> ~x simplifications in the\n+\t\t       first pass.  This allows us the chance to combine\n+\t\t       the -1 with other constants.  */\n+\t\t    && ! (first\n+\t\t\t  && GET_CODE (tem) == NOT\n+\t\t\t  && XEXP (tem, 0) == rhs))\n \t\t  {\n \t\t    lneg &= rneg;\n \t\t    if (GET_CODE (tem) == NEG)"}, {"sha": "d6de456f99187e70966db5555dbcca619a4af235", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2e9513841e7b1614d5bcde97e7af166481728296", "patch": "@@ -1,3 +1,7 @@\n+2002-01-07  Jakub Jelinek  <jakub@redhat.com>\n+\n+\t* gcc.c-torture/execute/20020107-1.c: New test.\n+\n 2002-01-06  Craig Rodrigues  <rodrigc@gcc.gnu.org>\n \n \tPR c/5279"}, {"sha": "d5bbcc413243999c00faca3bbfd4cea0cf00488e", "filename": "gcc/testsuite/gcc.c-torture/execute/20020107-1.c", "status": "added", "additions": 28, "deletions": 0, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20020107-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2e9513841e7b1614d5bcde97e7af166481728296/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20020107-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.c-torture%2Fexecute%2F20020107-1.c?ref=2e9513841e7b1614d5bcde97e7af166481728296", "patch": "@@ -0,0 +1,28 @@\n+/* This testcase failed because - 1 - buf was simplified into ~buf and when\n+   later expanding it back into - buf + -1, -1 got lost.  */\n+\n+extern void abort (void);\n+extern void exit (int);\n+\n+static void\n+bar (int x)\n+{\n+  if (!x)\n+    abort ();\n+}\n+\n+char buf[10];\n+\n+inline char *\n+foo (char *tmp)\n+{\n+  asm (\"\" : \"=r\" (tmp) : \"0\" (tmp));\n+  return tmp + 2;\n+}\n+\n+int\n+main (void)\n+{\n+  bar ((foo (buf) - 1 - buf) == 1);\n+  exit (0);\n+}"}]}