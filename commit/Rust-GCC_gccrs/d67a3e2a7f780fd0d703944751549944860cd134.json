{"sha": "d67a3e2a7f780fd0d703944751549944860cd134", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDY3YTNlMmE3Zjc4MGZkMGQ3MDM5NDQ3NTE1NDk5NDQ4NjBjZDEzNA==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@gmail.com", "date": "2009-01-10T11:48:06Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2009-01-10T11:48:06Z"}, "message": "re PR c++/36695 (Value-initialization of reference type is allowed.)\n\n\tPR c++/36695\n\t* typeck2.c (build_functional_cast): Check for reference type and NULL\n\tPARMS.\n                                                                                                                                         \n\t* g++.dg/ext/complex4.C: New test.\n\t* g++.dg/ext/complex5.C: New test.\n\t* g++.dg/init/reference1.C: New test.\n\t* g++.dg/init/reference2.C: New test.\n\t* g++.dg/init/reference3.C: New test.\n\nFrom-SVN: r143244", "tree": {"sha": "36e36922fadb2cd823757e519e2f624ab5b76c8c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/36e36922fadb2cd823757e519e2f624ab5b76c8c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d67a3e2a7f780fd0d703944751549944860cd134", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d67a3e2a7f780fd0d703944751549944860cd134", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d67a3e2a7f780fd0d703944751549944860cd134", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d67a3e2a7f780fd0d703944751549944860cd134/comments", "author": {"login": "pinskia", "id": 8496799, "node_id": "MDQ6VXNlcjg0OTY3OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/8496799?v=4", "gravatar_id": "", "url": "https://api.github.com/users/pinskia", "html_url": "https://github.com/pinskia", "followers_url": "https://api.github.com/users/pinskia/followers", "following_url": "https://api.github.com/users/pinskia/following{/other_user}", "gists_url": "https://api.github.com/users/pinskia/gists{/gist_id}", "starred_url": "https://api.github.com/users/pinskia/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/pinskia/subscriptions", "organizations_url": "https://api.github.com/users/pinskia/orgs", "repos_url": "https://api.github.com/users/pinskia/repos", "events_url": "https://api.github.com/users/pinskia/events{/privacy}", "received_events_url": "https://api.github.com/users/pinskia/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "56dbbf5621c48453f57e457c289ebefdaa1e0ee2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56dbbf5621c48453f57e457c289ebefdaa1e0ee2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56dbbf5621c48453f57e457c289ebefdaa1e0ee2"}], "stats": {"total": 69, "additions": 69, "deletions": 0}, "files": [{"sha": "ad9b8581cce0d278f936cc63fa0eb41cb6e398e9", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -1,3 +1,9 @@\n+2009-01-10  Andrew Pinski  <pinskia@gmail.com>\n+\n+\tPR c++/36695\n+\t* typeck2.c (build_functional_cast): Check for reference type and NULL\n+\tPARMS.\n+\n 2009-01-09  Steve Ellcey  <sje@cup.hp.com>\n \n \t* typeck.c (cp_build_unary_op): Check for ERROR_MARK."}, {"sha": "a19a99920b63131a9d90562945428b1c72950426", "filename": "gcc/cp/typeck2.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Fcp%2Ftypeck2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Fcp%2Ftypeck2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftypeck2.c?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -1445,6 +1445,12 @@ build_functional_cast (tree exp, tree parms, tsubst_flags_t complain)\n   else\n     type = exp;\n \n+  if (TREE_CODE (type) == REFERENCE_TYPE && !parms)\n+    {\n+      error (\"invalid value-initialization of reference types\");\n+      return error_mark_node;\n+    }\n+\n   if (processing_template_decl)\n     {\n       tree t = build_min (CAST_EXPR, type, parms);"}, {"sha": "2180b46a6b1a9446d10d011b226edf2dce5f431d", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -1,3 +1,12 @@\n+2009-01-10  Andrew Pinski  <pinskia@gmail.com>\n+\n+\tPR c++/36695\n+\t* g++.dg/ext/complex4.C: New test.\n+\t* g++.dg/ext/complex5.C: New test.\n+\t* g++.dg/init/reference1.C: New test.\n+\t* g++.dg/init/reference2.C: New test.\n+\t* g++.dg/init/reference3.C: New test.\n+\n 2009-01-10  Paul Thomas  <pault@gcc.gnu.org>\n \n \tPR fortran/38763"}, {"sha": "78b9356702e3c51242550d6eecdb897d60d8d479", "filename": "gcc/testsuite/g++.dg/ext/complex4.C", "status": "added", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplex4.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplex4.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplex4.C?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -0,0 +1,5 @@\n+// { dg-do compile }\n+// This code used to be rejected as there was no conversion from int to float __complex__\n+ #include <vector>\n+ typedef float __complex__ fcomplex;\n+ std::vector<fcomplex> vfc(10);"}, {"sha": "4a29960f528514dabd1ce02551daef576bd4902e", "filename": "gcc/testsuite/g++.dg/ext/complex5.C", "status": "added", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplex5.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplex5.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fcomplex5.C?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -0,0 +1,6 @@\n+/* PR c++/21210 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2\" } */\n+\n+typedef float __complex__ fcomplex;\n+fcomplex cplx = fcomplex(0);"}, {"sha": "7ce5f90fb4cf2f667f84b4ae59909aeab037a703", "filename": "gcc/testsuite/g++.dg/init/reference1.C", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference1.C?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -0,0 +1,11 @@\n+// { dg-do compile }\n+// This code used to be accepted but it is invalid as there is no\n+// value initialization of a reference type.\n+// PR c++/36695\n+\n+int main()\n+{\n+  typedef int& T;\n+  T a = T();  // { dg-error \"value-initialization of reference\" }\n+}\n+"}, {"sha": "42f5374268581809da17be7d252db3adfbdf2a86", "filename": "gcc/testsuite/g++.dg/init/reference2.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference2.C?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -0,0 +1,13 @@\n+// { dg-do compile }\n+// This code used to be accepted but it is invalid as there is no\n+// value initialization of a reference type.\n+// PR c++/36695\n+\n+// We should we able to diagnostic this without instantiating the template\n+template <int a1>\n+int f()\n+{\n+  typedef int& T;\n+  T a = T();  // { dg-error \"value-initialization of reference\" }\n+}\n+"}, {"sha": "344e94e101e624654602aa8ffa475e2e45123689", "filename": "gcc/testsuite/g++.dg/init/reference3.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference3.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d67a3e2a7f780fd0d703944751549944860cd134/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference3.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Freference3.C?ref=d67a3e2a7f780fd0d703944751549944860cd134", "patch": "@@ -0,0 +1,13 @@\n+// { dg-do compile }\n+// This code used to be accepted but it is invalid as there is no\n+// value initialization of a reference type.\n+// PR c++/36695\n+\n+template <typename T>\n+T f()\n+{\n+  T a = T();  // { dg-error \"value-initialization of reference\" }\n+}\n+\n+int &a = f<int&>(); // { dg-message \"instantiated from here\" }\n+"}]}