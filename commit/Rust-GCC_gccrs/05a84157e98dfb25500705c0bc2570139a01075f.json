{"sha": "05a84157e98dfb25500705c0bc2570139a01075f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDVhODQxNTdlOThkZmIyNTUwMDcwNWMwYmMyNTcwMTM5YTAxMDc1Zg==", "commit": {"author": {"name": "Justin Squirek", "email": "squirek@adacore.com", "date": "2018-09-26T09:16:59Z"}, "committer": {"name": "Pierre-Marie de Rodat", "email": "pmderodat@gcc.gnu.org", "date": "2018-09-26T09:16:59Z"}, "message": "[Ada] Regression in partial compilation of RCI units\n\nThis patch fixes an issue whereby the compilation of partial sources\n(packages without bodies that require them) would not occur when said\nsources were remote call interfaces. This is required because such\ninterfaces may have bodies that only exist on the server side or vice\nversa\n\n2018-09-26  Justin Squirek  <squirek@adacore.com>\n\ngcc/ada/\n\n\t* lib-writ.adb, lib-writ.ads (Write_With_Lines): Add\n\tdocumentation and an extra conditional check for RCI units so\n\tthat generated ali files will list the spec only instead of a\n\tbody when a body is not found.\n\nFrom-SVN: r264608", "tree": {"sha": "fe7a4be7651eb66ca19924080fef985322cfbc30", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fe7a4be7651eb66ca19924080fef985322cfbc30"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/05a84157e98dfb25500705c0bc2570139a01075f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05a84157e98dfb25500705c0bc2570139a01075f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/05a84157e98dfb25500705c0bc2570139a01075f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/05a84157e98dfb25500705c0bc2570139a01075f/comments", "author": {"login": "AdaDoom3", "id": 3445599, "node_id": "MDQ6VXNlcjM0NDU1OTk=", "avatar_url": "https://avatars.githubusercontent.com/u/3445599?v=4", "gravatar_id": "", "url": "https://api.github.com/users/AdaDoom3", "html_url": "https://github.com/AdaDoom3", "followers_url": "https://api.github.com/users/AdaDoom3/followers", "following_url": "https://api.github.com/users/AdaDoom3/following{/other_user}", "gists_url": "https://api.github.com/users/AdaDoom3/gists{/gist_id}", "starred_url": "https://api.github.com/users/AdaDoom3/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/AdaDoom3/subscriptions", "organizations_url": "https://api.github.com/users/AdaDoom3/orgs", "repos_url": "https://api.github.com/users/AdaDoom3/repos", "events_url": "https://api.github.com/users/AdaDoom3/events{/privacy}", "received_events_url": "https://api.github.com/users/AdaDoom3/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "738b83cd32bc4ebf651ef517cd880f04500d07af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/738b83cd32bc4ebf651ef517cd880f04500d07af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/738b83cd32bc4ebf651ef517cd880f04500d07af"}], "stats": {"total": 35, "additions": 24, "deletions": 11}, "files": [{"sha": "e139e2d2c5dbff74f7333443bf5befc750c3238c", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05a84157e98dfb25500705c0bc2570139a01075f/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05a84157e98dfb25500705c0bc2570139a01075f/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=05a84157e98dfb25500705c0bc2570139a01075f", "patch": "@@ -1,3 +1,10 @@\n+2018-09-26  Justin Squirek  <squirek@adacore.com>\n+\n+\t* lib-writ.adb, lib-writ.ads (Write_With_Lines): Add\n+\tdocumentation and an extra conditional check for RCI units so\n+\tthat generated ali files will list the spec only instead of a\n+\tbody when a body is not found.\n+\n 2018-09-26  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* gcc-interface/gigi.h (error_gnat_node): Delete."}, {"sha": "f035b45e913315d76b2588a3f801b1a1bfaa7512", "filename": "gcc/ada/lib-writ.adb", "status": "modified", "additions": 8, "deletions": 3, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05a84157e98dfb25500705c0bc2570139a01075f/gcc%2Fada%2Flib-writ.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05a84157e98dfb25500705c0bc2570139a01075f/gcc%2Fada%2Flib-writ.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-writ.adb?ref=05a84157e98dfb25500705c0bc2570139a01075f", "patch": "@@ -960,9 +960,14 @@ package body Lib.Writ is\n \n                   --  In GNATprove mode we must write the spec of a unit which\n                   --  requires a body if that body is not found. This will\n-                  --  allow partial analysis on incomplete sources.\n-\n-                  if GNATprove_Mode then\n+                  --  allow partial analysis on incomplete sources. Also, in\n+                  --  the case of a unit that is a remote call interface, the\n+                  --  bodies of packages may not exist but still may form a\n+                  --  valid program - so we handle that here as well.\n+\n+                  if GNATprove_Mode\n+                    or else Is_Remote_Call_Interface (Cunit_Entity (Unum))\n+                  then\n                      Body_Fname :=\n                        Get_File_Name\n                          (Uname    => Get_Body_Name (Uname),"}, {"sha": "9c7c270d1093a3502edf96d41fd8a6da9b18cd09", "filename": "gcc/ada/lib-writ.ads", "status": "modified", "additions": 9, "deletions": 8, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/05a84157e98dfb25500705c0bc2570139a01075f/gcc%2Fada%2Flib-writ.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/05a84157e98dfb25500705c0bc2570139a01075f/gcc%2Fada%2Flib-writ.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Flib-writ.ads?ref=05a84157e98dfb25500705c0bc2570139a01075f", "patch": "@@ -624,18 +624,19 @@ package Lib.Writ is\n    --    Z unit-name [source-name lib-name] [E] [EA] [ED] [AD]\n \n    --      One W line is present for each unit that is mentioned in an explicit\n-   --      non-limited with clause by the current unit. One Y line is present\n+   --      nonlimited with clause by the current unit. One Y line is present\n    --      for each unit that is mentioned in an explicit limited with clause\n    --      by the current unit. One Z line is present for each unit that is\n    --      only implicitly withed by the current unit. The first parameter is\n    --      the unit name in internal format. The second parameter is the file\n-   --      name of the body unit on which the current compliation depends -\n-   --      except when in GNATprove mode. In GNATprove mode, when packages\n-   --      which require a body have no associated source file, the file name\n-   --      of the spec is used instead to allow partial analysis of incomplete\n-   --      sources. The third parameter is the file name of the library\n-   --      information file that contains the results of compiling this unit.\n-   --      The optional modifiers are used as follows:\n+   --      name of the body unit on which the current compilation unit depends,\n+   --      except when in GNATprove mode or when the unit is a remote call\n+   --      interface. In these cases, when packages that require a body have\n+   --      no associated source file, the file name of the spec is used instead\n+   --      to allow partial analysis of incomplete sources. The third parameter\n+   --      is the file name of the library information file that contains the\n+   --      results of compiling this unit. The optional modifiers are used as\n+   --      follows:\n \n    --        E   pragma Elaborate applies to this unit\n "}]}