{"sha": "01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDFmNGZmZjE4YmQzZDcyOTAzYWM2YjBkOWEzZDliMGJkOWQzMTQ5Mg==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2007-11-17T18:19:16Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2007-11-17T18:19:16Z"}, "message": "re PR fortran/34133 (Bind(c,name=\"\") should be rejected for dummies; F2008: allow bind(c) for internal procs)\n\n2007-11-17  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/34133\n        * decl.c (gfc_match_suffix,gfc_match_subroutine): Disallow\n        bind(c) attribute for internal procedures.\n\n2007-11-17  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/34133\n        * gfortran.dg/bind_c_usage_9.f03: New.\n        * gfortran.dg/interface_abstract_1.f90: Fix testcase.\n\nFrom-SVN: r130260", "tree": {"sha": "a31122645d538de788892e8d1b76e2eb19f2c44f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a31122645d538de788892e8d1b76e2eb19f2c44f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "html_url": "https://github.com/Rust-GCC/gccrs/commit/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "2b77e908124cefa480e1e3143c57b4fc3e353da0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2b77e908124cefa480e1e3143c57b4fc3e353da0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2b77e908124cefa480e1e3143c57b4fc3e353da0"}], "stats": {"total": 84, "additions": 79, "deletions": 5}, "files": [{"sha": "b12355c729e5900e4d5ad034d7d59b046eb30375", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "patch": "@@ -1,3 +1,9 @@\n+2007-11-17  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/34133\n+\t* decl.c (gfc_match_suffix,gfc_match_subroutine): Disallow\n+\tbind(c) attribute for internal procedures.\n+\n 2007-11-17  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/25252"}, {"sha": "8217c06399f257fca917eeed22afdcd7f1d19a9e", "filename": "gcc/fortran/decl.c", "status": "modified", "additions": 19, "deletions": 3, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ffortran%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ffortran%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdecl.c?ref=01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "patch": "@@ -3895,9 +3895,18 @@ gfc_match_suffix (gfc_symbol *sym, gfc_symbol **result)\n     }\n \n   if (is_bind_c == MATCH_YES)\n-    if (gfc_add_is_bind_c (&(sym->attr), sym->name, &gfc_current_locus, 1)\n-        == FAILURE)\n-      return MATCH_ERROR;\n+    {\n+      if (gfc_current_state () == COMP_CONTAINS\n+\t  && sym->ns->proc_name->attr.flavor != FL_MODULE)\n+\t{\n+          gfc_error (\"BIND(C) attribute at %L may not be specified for an \"\n+\t\t     \"internal procedure\", &gfc_current_locus);\n+\t  return MATCH_ERROR;\n+\t}\n+      if (gfc_add_is_bind_c (&(sym->attr), sym->name, &gfc_current_locus, 1)\n+\t  == FAILURE)\n+     \treturn MATCH_ERROR;\n+    }\n   \n   return found_match;\n }\n@@ -4553,6 +4562,13 @@ gfc_match_subroutine (void)\n \n   if (is_bind_c == MATCH_YES)\n     {\n+      if (gfc_current_state () == COMP_CONTAINS\n+\t  && sym->ns->proc_name->attr.flavor != FL_MODULE)\n+\t{\n+          gfc_error (\"BIND(C) attribute at %L may not be specified for an \"\n+\t\t     \"internal procedure\", &gfc_current_locus);\n+\t  return MATCH_ERROR;\n+\t}\n       if (peek_char != '(')\n         {\n           gfc_error (\"Missing required parentheses before BIND(C) at %C\");"}, {"sha": "fcf6395b4b98477b82eeac188d1304590defe9a2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "patch": "@@ -1,3 +1,9 @@\n+2007-11-17  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/34133\n+\t* gfortran.dg/bind_c_usage_9.f03: New.\n+\t* gfortran.dg/interface_abstract_1.f90: Fix testcase.\n+\n 2007-11-17  Francois-Xavier Coudert  <fxcoudert@gcc.gnu.org>\n \n \tPR fortran/25252"}, {"sha": "f8682e8841cf5875ab78f8980266e24cc6987db4", "filename": "gcc/testsuite/gfortran.dg/bind_c_usage_9.f03", "status": "added", "additions": 45, "deletions": 0, "changes": 45, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_9.f03", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_9.f03", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fbind_c_usage_9.f03?ref=01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "patch": "@@ -0,0 +1,45 @@\n+! { dg-do compile }\n+! PR fortran/34133\n+!\n+! The compiler should reject internal procedures with BIND(c) attribute.\n+!\n+subroutine foo() bind(c)\n+contains\n+  subroutine bar() bind (c) ! { dg-error \"may not be specified for an internal\" }\n+  end subroutine bar ! { dg-error \"Expected label\" }\n+end subroutine foo ! { dg-warning \"Extension: CONTAINS statement\" }\n+\n+subroutine foo2() bind(c)\n+  use iso_c_binding\n+contains\n+  integer(c_int) function barbar() bind (c) ! { dg-error \"may not be specified for an internal\" }\n+  end function barbar ! { dg-error \"Expecting END SUBROUTINE\" }\n+end subroutine foo2 ! { dg-warning \"Extension: CONTAINS statement\" }\n+\n+function one() bind(c)\n+  use iso_c_binding\n+  integer(c_int) :: one\n+  one = 1\n+contains\n+  integer(c_int) function two() bind (c) ! { dg-error \"may not be specified for an internal\" }\n+  end function two ! { dg-error \"Expected label\" }\n+end function one ! { dg-warning \"Extension: CONTAINS statement\" }\n+\n+function one2() bind(c)\n+  use iso_c_binding\n+  integer(c_int) :: one2\n+  one2 = 1\n+contains\n+  subroutine three() bind (c) ! { dg-error \"may not be specified for an internal\" }\n+  end function three ! { dg-error \"Expected label\" }\n+end function one2 ! { dg-warning \"Extension: CONTAINS statement\" }\n+\n+program main\n+  use iso_c_binding\n+  implicit none\n+contains\n+  subroutine test() bind(c) ! { dg-error \"may not be specified for an internal\" }\n+  end subroutine test ! { dg-error \"Expecting END PROGRAM\" }\n+  function test2() bind (c) ! { dg-error \"may not be specified for an internal\" }\n+  end function test2  ! { dg-error \"Expecting END PROGRAM\" }\n+end program main ! { dg-warning \"Extension: CONTAINS statement\" }"}, {"sha": "3b2934fd1cfe6bdfb3fca5cd2e492c6271cc927c", "filename": "gcc/testsuite/gfortran.dg/interface_abstract_1.f90", "status": "modified", "additions": 3, "deletions": 2, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_abstract_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_abstract_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Finterface_abstract_1.f90?ref=01f4fff18bd3d72903ac6b0d9a3d9b0bd9d31492", "patch": "@@ -1,8 +1,9 @@\n ! { dg-do compile }\n !\n+module mod_interf_abstract\n implicit none\n abstract interface :: one ! { dg-error \"Syntax error in ABSTRACT INTERFACE statement\" }\n-end interface ! { dg-error \"Expecting END PROGRAM statement\" }\n+end interface ! { dg-error \"Expecting END MODULE statement\" }\n \n abstract interface\n   subroutine two() bind(C)\n@@ -18,4 +19,4 @@ end subroutine real\n   subroutine sub() bind(C,name=\"subC\")\n   end subroutine\n \n-end\n+end module mod_interf_abstract"}]}