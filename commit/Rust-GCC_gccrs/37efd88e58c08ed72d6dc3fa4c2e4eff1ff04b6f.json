{"sha": "37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzdlZmQ4OGU1OGMwOGVkNzJkNmRjM2ZhNGMyZTRlZmYxZmYwNGI2Zg==", "commit": {"author": {"name": "Jose Ruiz", "email": "ruiz@adacore.com", "date": "2008-08-05T09:27:49Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2008-08-05T09:27:49Z"}, "message": "init.c (__gnat_install_handler for linux): If we are building the Xenomai run time then we need to do two additional things...\n\n2008-08-05  Jose Ruiz  <ruiz@adacore.com>\n\n\t* init.c (__gnat_install_handler for linux): If we are building the\n\tXenomai run time then we need to do two additional things: avoid\n\tmemory swapping and transform the Linux environment task into a native\n\tXenomai task.\n\n\t* gcc-interface/Makefile.in (LIBGNAT_TARGET_PAIRS for xenomai run\n\ttime): Use interface to Xenomai native skin and avoid linux-specific\n\tway of setting CPU affinity.\n\t(EH_MECHANISM for the xenomai run time): Use sjlj exception mechanism.\n\nFrom-SVN: r138684", "tree": {"sha": "81bb965c6ca4189ce06b8011f1ff175bd802e906", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/81bb965c6ca4189ce06b8011f1ff175bd802e906"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f/comments", "author": {"login": "JoseRuizAdaCore", "id": 22770339, "node_id": "MDQ6VXNlcjIyNzcwMzM5", "avatar_url": "https://avatars.githubusercontent.com/u/22770339?v=4", "gravatar_id": "", "url": "https://api.github.com/users/JoseRuizAdaCore", "html_url": "https://github.com/JoseRuizAdaCore", "followers_url": "https://api.github.com/users/JoseRuizAdaCore/followers", "following_url": "https://api.github.com/users/JoseRuizAdaCore/following{/other_user}", "gists_url": "https://api.github.com/users/JoseRuizAdaCore/gists{/gist_id}", "starred_url": "https://api.github.com/users/JoseRuizAdaCore/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/JoseRuizAdaCore/subscriptions", "organizations_url": "https://api.github.com/users/JoseRuizAdaCore/orgs", "repos_url": "https://api.github.com/users/JoseRuizAdaCore/repos", "events_url": "https://api.github.com/users/JoseRuizAdaCore/events{/privacy}", "received_events_url": "https://api.github.com/users/JoseRuizAdaCore/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "0df218a9a7fd4756b2ac9f49f27740cf4c92894d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0df218a9a7fd4756b2ac9f49f27740cf4c92894d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0df218a9a7fd4756b2ac9f49f27740cf4c92894d"}], "stats": {"total": 47, "additions": 41, "deletions": 6}, "files": [{"sha": "058094c71727c451c0d0150cbc6a493c1922542d", "filename": "gcc/ada/gcc-interface/Makefile.in", "status": "modified", "additions": 17, "deletions": 6, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f/gcc%2Fada%2Fgcc-interface%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f/gcc%2Fada%2Fgcc-interface%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2FMakefile.in?ref=37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f", "patch": "@@ -850,13 +850,24 @@ ifeq ($(strip $(filter-out %86 linux%,$(arch) $(osys))),)\n     LIBGNAT_TARGET_PAIRS += \\\n     g-soccon.ads<g-soccon-linux-x86.ads \\\n     s-linux.ads<s-linux.ads \\\n-    s-osinte.adb<s-osinte-posix.adb \\\n-    s-osinte.ads<s-osinte-linux.ads \\\n-    s-tasinf.ads<s-tasinf-linux.ads \\\n-    s-tasinf.adb<s-tasinf-linux.adb \\\n-    s-taprop.adb<s-taprop-linux.adb\n+    s-osinte.adb<s-osinte-posix.adb\n+\n+    ifeq ($(strip $(filter-out xenomai,$(THREAD_KIND))),)\n+      LIBGNAT_TARGET_PAIRS += \\\n+      s-osinte.ads<s-osinte-linux-xenomai.ads \\\n+      s-taprop.adb<s-taprop-linux-xenomai.adb\n+\n+      EH_MECHANISM=\n+    else\n+      LIBGNAT_TARGET_PAIRS += \\\n+      s-osinte.ads<s-osinte-linux.ads \\\n+      s-taprop.adb<s-taprop-linux.adb \\\n+      s-tasinf.ads<s-tasinf-linux.ads \\\n+      s-tasinf.adb<s-tasinf-linux.adb\n+\n+      EH_MECHANISM=-gcc\n+    endif\n \n-    EH_MECHANISM=-gcc\n     THREADSLIB = -lpthread\n     EXTRA_GNATRTL_TASKING_OBJS=s-linux.o\n   endif"}, {"sha": "d2c22ea49d3ab481d0c29c0ae435f82b536a424e", "filename": "gcc/ada/init.c", "status": "modified", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f/gcc%2Fada%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f/gcc%2Fada%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Finit.c?ref=37efd88e58c08ed72d6dc3fa4c2e4eff1ff04b6f", "patch": "@@ -746,11 +746,35 @@ __gnat_error_handler (int sig,\n char __gnat_alternate_stack[16 * 1024]; /* 2 * SIGSTKSZ */\n #endif\n \n+#ifdef __XENO__\n+#include <sys/mman.h>\n+#include <native/task.h>\n+\n+RT_TASK main_task;\n+#endif\n+\n void\n __gnat_install_handler (void)\n {\n   struct sigaction act;\n \n+#ifdef __XENO__\n+  int prio;\n+\n+  if (__gl_main_priority == -1)\n+    prio = 49;\n+  else\n+    prio = __gl_main_priority;\n+\n+  /* Avoid memory swapping for this program */\n+\n+  mlockall (MCL_CURRENT|MCL_FUTURE);\n+\n+  /* Turn the current Linux task into a native Xenomai task */\n+\n+  rt_task_shadow(&main_task, \"environment_task\", prio, T_FPU);\n+#endif\n+\n   /* Set up signal handler to map synchronous signals to appropriate\n      exceptions.  Make sure that the handler isn't interrupted by another\n      signal that might cause a scheduling event!  Also setup an alternate"}]}