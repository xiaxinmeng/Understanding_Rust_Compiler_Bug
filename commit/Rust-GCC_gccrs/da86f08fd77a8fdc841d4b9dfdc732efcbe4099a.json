{"sha": "da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGE4NmYwOGZkNzdhOGZkYzg0MWQ0YjlkZmRjNzMyZWZjYmU0MDk5YQ==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2001-09-04T12:21:33Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2001-09-04T12:21:33Z"}, "message": "re PR c++/4203 (empty base class optimization zeroes first byte of other base class when using multiple inheritance)\n\ncp:\n\tPR c++/4203\n\t* call.c (build_over_call): Do not optimize any empty base\n\tconstruction.\ntestsuite:\n\tPR c++/4203\n\t* g++.old-deja/g++.other/empty1.C: XFAIL. See PR c++/4222\n\t* g++.dg/init/empty1.C: New test.\n\nFrom-SVN: r45374", "tree": {"sha": "d3159834db6bf3e5d1d3890dd1e04ff5b26af491", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d3159834db6bf3e5d1d3890dd1e04ff5b26af491"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/comments", "author": null, "committer": null, "parents": [{"sha": "223671612fba9ad84298792fa5dcfe1675be9084", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/223671612fba9ad84298792fa5dcfe1675be9084", "html_url": "https://github.com/Rust-GCC/gccrs/commit/223671612fba9ad84298792fa5dcfe1675be9084"}], "stats": {"total": 54, "additions": 51, "deletions": 3}, "files": [{"sha": "28ef9f7ee6b88193a240d4b4a55e895b87c1e081", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "patch": "@@ -1,3 +1,9 @@\n+2001-09-04  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/4203\n+\t* call.c (build_over_call): Do not optimize any empty base\n+\tconstruction.\n+\n 2001-08-31  Kriang Lerdsuwanakij  <lerdsuwa@users.sourceforge.net>\n \n \t* error.c (dump_template_decl): Output template parameters"}, {"sha": "9caae4bf00831370307a025695c4539938695d55", "filename": "gcc/cp/call.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Fcp%2Fcall.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Fcp%2Fcall.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcall.c?ref=da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "patch": "@@ -4258,14 +4258,14 @@ build_over_call (cand, args, flags)\n \t  else if (TYPE_HAS_TRIVIAL_INIT_REF (DECL_CONTEXT (fn)))\n \t    return build_target_expr_with_type (arg, DECL_CONTEXT (fn));\n \t}\n-      else if (! real_lvalue_p (arg)\n+      else if ((!real_lvalue_p (arg)\n+\t\t|| TYPE_HAS_TRIVIAL_INIT_REF (DECL_CONTEXT (fn)))\n \t       /* Empty classes have padding which can be hidden\n \t          inside an (empty) base of the class. This must not\n \t          be touched as it might overlay things. When the\n \t          gcc core learns about empty classes, we can treat it\n \t          like other classes. */\n-\t       || (!is_empty_class (DECL_CONTEXT (fn))\n-\t\t   && TYPE_HAS_TRIVIAL_INIT_REF (DECL_CONTEXT (fn))))\n+\t       && !is_empty_class (DECL_CONTEXT (fn)))\n \t{\n \t  tree address;\n \t  tree to = stabilize_reference"}, {"sha": "927522a2ce968c51075a7cac38d160b8bed8cfd8", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "patch": "@@ -1,3 +1,9 @@\n+2001-09-04  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\tPR c++/4203\n+\t* g++.old-deja/g++.other/empty1.C: XFAIL. See PR c++/4222\n+\t* g++.dg/init/empty1.C: New test.\n+\n 2001-09-03  Jakub Jelinek  <jakub@redhat.com>\n \n \t* gcc.c-torture/compile/20010903-1.c: New test."}, {"sha": "bba179f987b3227142d148b0e2abaa1f1d7aca3c", "filename": "gcc/testsuite/g++.dg/init/empty1.C", "status": "added", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fempty1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fempty1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Finit%2Fempty1.C?ref=da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "patch": "@@ -0,0 +1,30 @@\n+// { dg-do run }\n+\n+// Copyright (C) 2001 Free Software Foundation, Inc.\n+// Contributed by Nathan Sidwell 3 Sept 2001 <nathan@codesourcery.com>\n+\n+// Bug 4203. We were bit copying empty bases including the\n+// padding. Which clobbers whatever they overlay.\n+\n+class EmptyBase0 {};\n+class EmptyBase1 : public EmptyBase0 {};\n+class Base1\n+{\n+public:\n+unsigned int t_;\n+Base1(unsigned int t) : t_(t) {}\n+};\n+\n+class PEPE : public Base1, public EmptyBase1\n+{\n+public:\n+PEPE(unsigned int t)\n+  : Base1(t), EmptyBase1(EmptyBase1()) {}\n+};\n+\n+int main()\n+{\n+  PEPE pepe(0xff);\n+  \n+  return pepe.t_ != 255;\n+}"}, {"sha": "a876ce84a9f14389ed3eb588b4625d30e751f426", "filename": "gcc/testsuite/g++.old-deja/g++.other/empty1.C", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fempty1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/da86f08fd77a8fdc841d4b9dfdc732efcbe4099a/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fempty1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.old-deja%2Fg%2B%2B.other%2Fempty1.C?ref=da86f08fd77a8fdc841d4b9dfdc732efcbe4099a", "patch": "@@ -1,4 +1,10 @@\n // Origin: Mark Mitchell <mark@codesourcery.com>\n+// This test case checks that the return value optimization works for\n+// empty classes.\n+\n+// xfailed because empty classes clobbering what they overlay as the\n+// backend treats them as single byte objects. See bug 4222\n+// execution test - XFAIL *-*-*\n \n extern \"C\" void abort();\n extern \"C\" int printf (const char *, ...);"}]}