{"sha": "d3ff9ee4686ea27a0df76224c790c67284889f57", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDNmZjllZTQ2ODZlYTI3YTBkZjc2MjI0Yzc5MGM2NzI4NDg4OWY1Nw==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2011-06-18T07:53:09Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2011-06-18T07:53:09Z"}, "message": "PR 49296 List directed read of string ending in EOF.\n\nlibgfortran ChangeLog entry:\n\n2011-06-18  Janne Blomqvist  <jb@gcc.gnu.org>\n\n        PR libfortran/49296\n        * io/list_read.c (read_character): Accept EOF as a separator when\n        reading string.\n\n\ntestsuite ChangeLog entry:\n\n2011-06-18  Janne Blomqvist  <jb@gcc.gnu.org>\n\n        PR libfortran/48296\n\t* gfortran.dg/read_list_eof_1.f90: New test.\n\nFrom-SVN: r175166", "tree": {"sha": "46d30eee1cd090769d6139829ec4dc3264ec1a2f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/46d30eee1cd090769d6139829ec4dc3264ec1a2f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d3ff9ee4686ea27a0df76224c790c67284889f57", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3ff9ee4686ea27a0df76224c790c67284889f57", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3ff9ee4686ea27a0df76224c790c67284889f57", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3ff9ee4686ea27a0df76224c790c67284889f57/comments", "author": null, "committer": null, "parents": [{"sha": "c96b410243a383fb39a9c92f0632df9e60bb75c4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c96b410243a383fb39a9c92f0632df9e60bb75c4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c96b410243a383fb39a9c92f0632df9e60bb75c4"}], "stats": {"total": 51, "additions": 42, "deletions": 9}, "files": [{"sha": "d1469b6d4e161a04b254eb7519aa0d750aaf4f76", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3ff9ee4686ea27a0df76224c790c67284889f57/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3ff9ee4686ea27a0df76224c790c67284889f57/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d3ff9ee4686ea27a0df76224c790c67284889f57", "patch": "@@ -1,3 +1,8 @@\n+2011-06-18  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\tPR libfortran/48296\n+\t* gfortran.dg/read_list_eof_1.f90: New test.\n+\n 2011-06-18  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR target/49411"}, {"sha": "775346e4a758863e0f541117bfab6099d2d50deb", "filename": "gcc/testsuite/gfortran.dg/read_list_eof_1.f90", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3ff9ee4686ea27a0df76224c790c67284889f57/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_list_eof_1.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3ff9ee4686ea27a0df76224c790c67284889f57/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_list_eof_1.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_list_eof_1.f90?ref=d3ff9ee4686ea27a0df76224c790c67284889f57", "patch": "@@ -0,0 +1,22 @@\n+! { dg-do run }\n+! PR 49296 List formatted read of file without EOR marker (\\n).\n+program read_list_eof_1\n+  implicit none\n+  character(len=100) :: s\n+  call genfil ()\n+  open (unit=20, file='read.dat', form='FORMATTED', action='READ', &\n+       status='OLD')\n+  read (20, fmt=*) s\n+  close (20, status='delete')\n+  if (trim(s) /= \"a\") then\n+     call abort ()\n+  end if\n+\n+contains\n+  subroutine genfil\n+    open(10, file='read.dat', form='unformatted', action='write', &\n+         status='replace', access='stream')\n+    write(10) 'a'\n+    close(10)\n+  end subroutine genfil\n+end program read_list_eof_1"}, {"sha": "b0f0666a3b5eacb3bbf181550cd8fbdb8f0aca29", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3ff9ee4686ea27a0df76224c790c67284889f57/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3ff9ee4686ea27a0df76224c790c67284889f57/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=d3ff9ee4686ea27a0df76224c790c67284889f57", "patch": "@@ -1,3 +1,9 @@\n+2011-06-18  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+        PR libfortran/49296\n+        * io/list_read.c (read_character): Accept EOF as a separator when\n+        reading string.\n+\n 2011-06-17  Daniel Carrera  <dcarrera@gmail.com>\n \n \t* caf/single.c (_gfortran_caf_register): Store the address"}, {"sha": "baf2f54041a7b5b23eeba8fd5b9c63d61bbd1bd2", "filename": "libgfortran/io/list_read.c", "status": "modified", "additions": 9, "deletions": 9, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d3ff9ee4686ea27a0df76224c790c67284889f57/libgfortran%2Fio%2Flist_read.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d3ff9ee4686ea27a0df76224c790c67284889f57/libgfortran%2Fio%2Flist_read.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Flist_read.c?ref=d3ff9ee4686ea27a0df76224c790c67284889f57", "patch": "@@ -1022,7 +1022,7 @@ read_character (st_parameter_dt *dtp, int length __attribute__ ((unused)))\n   for (;;)\n     {\n       if ((c = next_char (dtp)) == EOF)\n-\tgoto eof;\n+\tgoto done_eof;\n       switch (c)\n \t{\n \tcase '\"':\n@@ -1068,26 +1068,26 @@ read_character (st_parameter_dt *dtp, int length __attribute__ ((unused)))\n      invalid.  */\n  done:\n   c = next_char (dtp);\n- eof:\n-  if (is_separator (c) || c == '!')\n+ done_eof:\n+  if (is_separator (c) || c == '!' || c == EOF)\n     {\n       unget_char (dtp, c);\n       eat_separator (dtp);\n       dtp->u.p.saved_type = BT_CHARACTER;\n       free_line (dtp);\n     }\n-  else\n+  else \n     {\n       free_saved (dtp);\n-      if (c == EOF)\n-\t{\n-\t  hit_eof (dtp);\n-\t  return;\n-\t}\n       snprintf (message, MSGLEN, \"Invalid string input in item %d\",\n \t\t  dtp->u.p.item_count);\n       generate_error (&dtp->common, LIBERROR_READ_VALUE, message);\n     }\n+  return;\n+\n+ eof:\n+  free_saved (dtp);\n+  hit_eof (dtp);\n }\n \n "}]}