{"sha": "4a01617886c1833f456948048e5167dac784ef19", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NGEwMTYxNzg4NmMxODMzZjQ1Njk0ODA0OGU1MTY3ZGFjNzg0ZWYxOQ==", "commit": {"author": {"name": "Segher Boessenkool", "email": "segher@kernel.crashing.org", "date": "2017-11-29T22:42:37Z"}, "committer": {"name": "Segher Boessenkool", "email": "segher@gcc.gnu.org", "date": "2017-11-29T22:42:37Z"}, "message": "combine: Do not throw away unneeded arms of parallels (PR83156)\n\nThe fix for PR82621 makes us not split an I2 if one of the results of\nthose SETs is unused, since combine does not handle that properly.  But\nthis results in degradation for i386 (or more in general, for any\ntarget that does not have patterns for parallels with an unused result\nas a CLOBBER instead of a SET for that result).\n\nThis patch instead makes us not split only if one of the results is set\nagain before I3.  That fixes PR83156 and also fixes PR82621.\n\nUnfortunately it undoes the nice optimisations that the previous patch\ndid on powerpc.\n\n\n\tPR rtl-optimization/83156\n\tPR rtl-optimization/82621\n\t* combine.c (try_combine): Don't split an I2 if one of the dests is\n\tset again before I3.  Allow unused dests.\n\nFrom-SVN: r255260", "tree": {"sha": "84cbcb2424e0e5745b60c58f0ffc57a5dfe877f9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/84cbcb2424e0e5745b60c58f0ffc57a5dfe877f9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4a01617886c1833f456948048e5167dac784ef19", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a01617886c1833f456948048e5167dac784ef19", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4a01617886c1833f456948048e5167dac784ef19", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4a01617886c1833f456948048e5167dac784ef19/comments", "author": {"login": "segher", "id": 417629, "node_id": "MDQ6VXNlcjQxNzYyOQ==", "avatar_url": "https://avatars.githubusercontent.com/u/417629?v=4", "gravatar_id": "", "url": "https://api.github.com/users/segher", "html_url": "https://github.com/segher", "followers_url": "https://api.github.com/users/segher/followers", "following_url": "https://api.github.com/users/segher/following{/other_user}", "gists_url": "https://api.github.com/users/segher/gists{/gist_id}", "starred_url": "https://api.github.com/users/segher/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/segher/subscriptions", "organizations_url": "https://api.github.com/users/segher/orgs", "repos_url": "https://api.github.com/users/segher/repos", "events_url": "https://api.github.com/users/segher/events{/privacy}", "received_events_url": "https://api.github.com/users/segher/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "18b776e936e15310907e014e4e460d45d148bbf6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/18b776e936e15310907e014e4e460d45d148bbf6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/18b776e936e15310907e014e4e460d45d148bbf6"}], "stats": {"total": 10, "additions": 9, "deletions": 1}, "files": [{"sha": "c13f67e76a6e724773144d69d41c673861832b73", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a01617886c1833f456948048e5167dac784ef19/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a01617886c1833f456948048e5167dac784ef19/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=4a01617886c1833f456948048e5167dac784ef19", "patch": "@@ -1,3 +1,10 @@\n+2017-11-29  Segher Boessenkool  <segher@kernel.crashing.org>\n+\n+\tPR rtl-optimization/83156\n+\tPR rtl-optimization/82621\n+\t* combine.c (try_combine): Don't split an I2 if one of the dests is\n+\tset again before I3.  Allow unused dests.\n+\n 2017-11-29  Segher Boessenkool  <segher@kernel.crashing.org>\n \n \t* config/rs6000/rs6000.md (*add<mode>3_carry_in_internal2): New."}, {"sha": "cfe24f42633840957f46c57d063b7723f63b721e", "filename": "gcc/combine.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4a01617886c1833f456948048e5167dac784ef19/gcc%2Fcombine.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4a01617886c1833f456948048e5167dac784ef19/gcc%2Fcombine.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcombine.c?ref=4a01617886c1833f456948048e5167dac784ef19", "patch": "@@ -3016,7 +3016,8 @@ try_combine (rtx_insn *i3, rtx_insn *i2, rtx_insn *i1, rtx_insn *i0,\n       && can_split_parallel_of_n_reg_sets (i2, 2)\n       && !reg_used_between_p (SET_DEST (XVECEXP (PATTERN (i2), 0, 0)), i2, i3)\n       && !reg_used_between_p (SET_DEST (XVECEXP (PATTERN (i2), 0, 1)), i2, i3)\n-      && !find_reg_note (i2, REG_UNUSED, 0))\n+      && !reg_set_between_p  (SET_DEST (XVECEXP (PATTERN (i2), 0, 0)), i2, i3)\n+      && !reg_set_between_p  (SET_DEST (XVECEXP (PATTERN (i2), 0, 1)), i2, i3))\n     {\n       /* If there is no I1, there is no I0 either.  */\n       i0 = i1;"}]}