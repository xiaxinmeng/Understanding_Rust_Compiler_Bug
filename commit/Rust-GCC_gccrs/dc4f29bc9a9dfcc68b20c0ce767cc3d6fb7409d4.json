{"sha": "dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM0ZjI5YmM5YTlkZmNjNjhiMjBjMGNlNzY3Y2MzZDZmYjc0MDlkNA==", "commit": {"author": {"name": "Andreas Krebbel", "email": "krebbel@linux.vnet.ibm.com", "date": "2017-03-24T13:51:32Z"}, "committer": {"name": "Andreas Krebbel", "email": "krebbel@gcc.gnu.org", "date": "2017-03-24T13:51:32Z"}, "message": "S/390: PR79893: Add diagnostics vec_load_bndry builtin.\n\nThe boundary argument of the vec_load_bndry builtin needs to be\nrewritten.  At that point it must be constant already.  The current\ndiagnostics in s390_expand_builtins is too late for this.  The patch\nadds an additional check for that builtin which will be triggered\nalready during preprocessing.\n\nRegression tested on s390x.\n\ngcc/testsuite/ChangeLog:\n\n2017-03-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/79893\n\t* gcc.target/s390/zvector/pr79893.c: New test.\n\ngcc/ChangeLog:\n\n2017-03-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n\n\tPR target/79893\n\t* config/s390/s390-c.c (s390_adjust_builtin_arglist): Issue an\n\terror if the boundary argument is not constant.\n\nFrom-SVN: r246442", "tree": {"sha": "a8f580507132e9c6e96b398f2eb9e19b19cb2378", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a8f580507132e9c6e96b398f2eb9e19b19cb2378"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/comments", "author": null, "committer": null, "parents": [{"sha": "56010684160c394a1824909e2ac450a6da41db40", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/56010684160c394a1824909e2ac450a6da41db40", "html_url": "https://github.com/Rust-GCC/gccrs/commit/56010684160c394a1824909e2ac450a6da41db40"}], "stats": {"total": 32, "additions": 30, "deletions": 2}, "files": [{"sha": "e3fcfbe0a4fe391d1183ccae1c1f6609f3216866", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "patch": "@@ -1,3 +1,9 @@\n+2017-03-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/79893\n+\t* config/s390/s390-c.c (s390_adjust_builtin_arglist): Issue an\n+\terror if the boundary argument is not constant.\n+\n 2017-03-24  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/80112"}, {"sha": "0521e1eeb55ede4099f2c8d36299b3da8aeab447", "filename": "gcc/config/s390/s390-c.c", "status": "modified", "additions": 10, "deletions": 2, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2Fconfig%2Fs390%2Fs390-c.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2Fconfig%2Fs390%2Fs390-c.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fs390%2Fs390-c.c?ref=dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "patch": "@@ -673,10 +673,18 @@ s390_adjust_builtin_arglist (unsigned int ob_fcode, tree decl,\n \tcase S390_OVERLOADED_BUILTIN_s390_vec_load_bndry:\n \t  {\n \t    int code;\n-\n \t    if (dest_arg_index == 1)\n \t      {\n-\t\tswitch (tree_to_uhwi ((**arglist)[src_arg_index]))\n+\t\ttree arg = (**arglist)[src_arg_index];\n+\n+\t\tif (TREE_CODE (arg) != INTEGER_CST)\n+\t\t  {\n+\t\t    error (\"constant value required for builtin %qF argument %d\",\n+\t\t\t   decl, src_arg_index + 1);\n+\t\t    return;\n+\t\t  }\n+\n+\t\tswitch (tree_to_uhwi (arg))\n \t\t  {\n \t\t  case 64: code = 0; break;\n \t\t  case 128: code = 1; break;"}, {"sha": "96eedbd2cee5e2234cc8450628558b769d60fd97", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "patch": "@@ -1,3 +1,8 @@\n+2017-03-24  Andreas Krebbel  <krebbel@linux.vnet.ibm.com>\n+\n+\tPR target/79893\n+\t* gcc.target/s390/zvector/pr79893.c: New test.\n+\n 2017-03-24  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR rtl-optimization/80112"}, {"sha": "ad6ca309ae868373767f616618ab11892aa0d6b0", "filename": "gcc/testsuite/gcc.target/s390/zvector/pr79893.c", "status": "added", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fzvector%2Fpr79893.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fzvector%2Fpr79893.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fs390%2Fzvector%2Fpr79893.c?ref=dc4f29bc9a9dfcc68b20c0ce767cc3d6fb7409d4", "patch": "@@ -0,0 +1,9 @@\n+/* { dg-do compile { target { s390*-*-* } } } */\n+/* { dg-options \"-march=z13 -mzarch -mzvector\" } */\n+\n+#include <vecintrin.h>\n+\n+void\n+foo(signed char *p, int i) {\n+  vec_load_bndry(p, i); /* { dg-error \"constant value required for builtin.*2\" } */\n+}"}]}