{"sha": "43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NDNmZjVjN2EyZGQ1OTEyYTNiZjkwYmQwZjljYzU5OWFjM2EzYWNjZQ==", "commit": {"author": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2015-09-03T21:18:56Z"}, "committer": {"name": "Janne Blomqvist", "email": "jb@gcc.gnu.org", "date": "2015-09-03T21:18:56Z"}, "message": "libgfortran: Use remove(3) instead of unlink(2) when deleting files.\n\ntestsuite:\n\n2015-09-04  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\t* gfortran.dg/read_dir.f90: Delete empty directory when closing\n\trather than calling rmdir, cleanup if open fails.\n\n\nlibgfortran:\n\n2015-09-04  Janne Blomqvist  <jb@gcc.gnu.org>\n\n\t* io/unix.h (delete_file): Remove prototype.\n\t* io/unix.c (delete_file): Remove function.\n\t* io/close.c (st_close): Replace delete_file and unlink with\n\tremove.\n\t* io/open.c (already_open): Replace unlink with remove.\n\nFrom-SVN: r227472", "tree": {"sha": "593d7f86e1d9512136f291a704411e7af2722593", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/593d7f86e1d9512136f291a704411e7af2722593"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "html_url": "https://github.com/Rust-GCC/gccrs/commit/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/comments", "author": null, "committer": null, "parents": [{"sha": "c8c030589bd61290418753e766f26d8f99e8b074", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c8c030589bd61290418753e766f26d8f99e8b074", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c8c030589bd61290418753e766f26d8f99e8b074"}], "stats": {"total": 43, "additions": 22, "deletions": 21}, "files": [{"sha": "e2c55bae8e8f70c4853ce67d72c5dd5ba749e4e2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -1,3 +1,8 @@\n+2015-09-04  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\t* gfortran.dg/read_dir.f90: Delete empty directory when closing\n+\trather than calling rmdir, cleanup if open fails.\n+\n 2015-09-03  Bill Schmidt  <wschmidt@vnet.linux.ibm.com>\n \n \t* gcc.target/powerpc/vec-mult-char-1.c: New test."}, {"sha": "4009ed69e6383bc32e98f2883d771870f07ec623", "filename": "gcc/testsuite/gfortran.dg/read_dir.f90", "status": "modified", "additions": 6, "deletions": 5, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_dir.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_dir.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fread_dir.f90?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -7,13 +7,14 @@ program bug\n    integer ios\n    call system('[ -d junko.dir ] || mkdir junko.dir')\n    open(unit=10, file='junko.dir',iostat=ios,action='read',access='stream')\n-   if (ios.ne.0) call abort\n+   if (ios.ne.0) then\n+      call system('rmdir junko.dir')\n+      call abort\n+   end if\n    read(10, iostat=ios) c\n    if (ios.ne.21) then \n-      close(10)\n-      call system('rmdir junko.dir')\n+      close(10, status='delete')\n       call abort\n    end if\n-   close(10)\n-   call system('rmdir junko.dir')\n+   close(10, status='delete')\n end program bug"}, {"sha": "5da6ea32fd61a4a9e861e2d27b27dd7aec0c47c1", "filename": "libgfortran/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2FChangeLog?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -1,3 +1,11 @@\n+2015-09-04  Janne Blomqvist  <jb@gcc.gnu.org>\n+\n+\t* io/unix.h (delete_file): Remove prototype.\n+\t* io/unix.c (delete_file): Remove function.\n+\t* io/close.c (st_close): Replace delete_file and unlink with\n+\tremove.\n+\t* io/open.c (already_open): Replace unlink with remove.\n+\n 2015-09-02  Janne Blomqvist  <jb@gcc.gnu.org>\n \n \tPR libfortran/67414"}, {"sha": "1e109933397d93807cf49cbaf01427bc9456f0ce", "filename": "libgfortran/io/close.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Fclose.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Fclose.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fclose.c?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -80,7 +80,7 @@ st_close (st_parameter_close *clp)\n \t  if (status == CLOSE_DELETE)\n             {\n #if HAVE_UNLINK_OPEN_FILE\n-\t      delete_file (u);\n+\t      remove (u->filename);\n #else\n \t      path = strdup (u->filename);\n #endif\n@@ -92,7 +92,7 @@ st_close (st_parameter_close *clp)\n #if !HAVE_UNLINK_OPEN_FILE\n       if (path != NULL)\n \t{\n-\t  unlink (path);\n+\t  remove (path);\n \t  free (path);\n \t}\n #endif"}, {"sha": "630bca6f8d0359ad7cd9a0f4eeab74d5de91becf", "filename": "libgfortran/io/open.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Fopen.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Fopen.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Fopen.c?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -664,7 +664,7 @@ already_open (st_parameter_open *opp, gfc_unit * u, unit_flags * flags)\n  \n #if !HAVE_UNLINK_OPEN_FILE\n       if (u->filename && u->flags.status == STATUS_SCRATCH)\n-\tunlink (u->filename);\n+\tremove (u->filename);\n #endif\n      free (u->filename);\n      u->filename = NULL;"}, {"sha": "5385d8b770006000a99866f720321eb37ea36a3f", "filename": "libgfortran/io/unix.c", "status": "modified", "additions": 0, "deletions": 10, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Funix.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Funix.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.c?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -1716,16 +1716,6 @@ flush_all_units (void)\n }\n \n \n-/* delete_file()-- Given a unit structure, delete the file associated\n- * with the unit.  Returns nonzero if something went wrong. */\n-\n-int\n-delete_file (gfc_unit * u)\n-{\n-  return unlink (u->filename);\n-}\n-\n-\n /* file_exists()-- Returns nonzero if the current filename exists on\n  * the system */\n "}, {"sha": "d1aa75dbf4ec91788487353e6c43f4bee5f74a48", "filename": "libgfortran/io/unix.h", "status": "modified", "additions": 0, "deletions": 3, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Funix.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce/libgfortran%2Fio%2Funix.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libgfortran%2Fio%2Funix.h?ref=43ff5c7a2dd5912a3bf90bd0f9cc599ac3a3acce", "patch": "@@ -141,9 +141,6 @@ internal_proto(compare_file_filename);\n extern gfc_unit *find_file (const char *file, gfc_charlen_type file_len);\n internal_proto(find_file);\n \n-extern int delete_file (gfc_unit *);\n-internal_proto(delete_file);\n-\n extern int file_exists (const char *file, gfc_charlen_type file_len);\n internal_proto(file_exists);\n "}]}