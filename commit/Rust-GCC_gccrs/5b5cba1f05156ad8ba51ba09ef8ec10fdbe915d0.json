{"sha": "5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NWI1Y2JhMWYwNTE1NmFkOGJhNTFiYTA5ZWY4ZWMxMGZkYmU5MTVkMA==", "commit": {"author": {"name": "Jason Merrill", "email": "jason@redhat.com", "date": "2006-03-22T04:20:52Z"}, "committer": {"name": "Jason Merrill", "email": "jason@gcc.gnu.org", "date": "2006-03-22T04:20:52Z"}, "message": "re PR middle-end/20297 (#pragma GCC visibility isn't properly handled for builtin functions)\n\n        PR middle-end/20297\n        * expr.c (init_block_move_fn): Force default visibility.\n        (init_block_clear_fn): Likewise.\n        * builtins.c (expand_builtin_fork_or_exec): Likewise.\n        * targhooks.c (default_external_stack_protect_fail): Likewise.\n\nFrom-SVN: r112270", "tree": {"sha": "bea9fcaacdabc909ee70a71492432316d8610e1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bea9fcaacdabc909ee70a71492432316d8610e1f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/comments", "author": {"login": "jicama", "id": 266146, "node_id": "MDQ6VXNlcjI2NjE0Ng==", "avatar_url": "https://avatars.githubusercontent.com/u/266146?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jicama", "html_url": "https://github.com/jicama", "followers_url": "https://api.github.com/users/jicama/followers", "following_url": "https://api.github.com/users/jicama/following{/other_user}", "gists_url": "https://api.github.com/users/jicama/gists{/gist_id}", "starred_url": "https://api.github.com/users/jicama/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jicama/subscriptions", "organizations_url": "https://api.github.com/users/jicama/orgs", "repos_url": "https://api.github.com/users/jicama/repos", "events_url": "https://api.github.com/users/jicama/events{/privacy}", "received_events_url": "https://api.github.com/users/jicama/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "1dc11afe862edceccc0bead5d086509f181fc67a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1dc11afe862edceccc0bead5d086509f181fc67a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1dc11afe862edceccc0bead5d086509f181fc67a"}], "stats": {"total": 40, "additions": 40, "deletions": 0}, "files": [{"sha": "b9b9eae926a2aecdb948c26f287347dc37f6554d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "patch": "@@ -1,3 +1,11 @@\n+2006-03-21  Jason Merrill  <jason@redhat.com>\n+\n+\tPR middle-end/20297\n+\t* expr.c (init_block_move_fn): Force default visibility.\n+\t(init_block_clear_fn): Likewise.\n+\t* builtins.c (expand_builtin_fork_or_exec): Likewise.\n+\t* targhooks.c (default_external_stack_protect_fail): Likewise.\n+\n 2006-03-21  Richard Sandiford  <richard@codesourcery.com>\n \n \t* config/mips/predicates.md (const_call_insn_operand): Allow direct"}, {"sha": "ebdbb69529663d847f121f92e8cb3a9b7fb5e9b1", "filename": "gcc/builtins.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "patch": "@@ -5381,6 +5381,8 @@ expand_builtin_fork_or_exec (tree fn, tree arglist, rtx target, int ignore)\n   TREE_PUBLIC (decl) = 1;\n   DECL_ARTIFICIAL (decl) = 1;\n   TREE_NOTHROW (decl) = 1;\n+  DECL_VISIBILITY (fn) = VISIBILITY_DEFAULT;\n+  DECL_VISIBILITY_SPECIFIED (fn) = 1;\n   call = build_function_call_expr (decl, arglist);\n \n   return expand_call (call, target, ignore);"}, {"sha": "2d5c359e13926cdcfaf714af8e0ec780c1976730", "filename": "gcc/expr.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "patch": "@@ -1409,6 +1409,8 @@ init_block_move_fn (const char *asmspec)\n       TREE_PUBLIC (fn) = 1;\n       DECL_ARTIFICIAL (fn) = 1;\n       TREE_NOTHROW (fn) = 1;\n+      DECL_VISIBILITY (fn) = VISIBILITY_DEFAULT;\n+      DECL_VISIBILITY_SPECIFIED (fn) = 1;\n \n       block_move_fn = fn;\n     }\n@@ -2556,6 +2558,8 @@ init_block_clear_fn (const char *asmspec)\n       TREE_PUBLIC (fn) = 1;\n       DECL_ARTIFICIAL (fn) = 1;\n       TREE_NOTHROW (fn) = 1;\n+      DECL_VISIBILITY (fn) = VISIBILITY_DEFAULT;\n+      DECL_VISIBILITY_SPECIFIED (fn) = 1;\n \n       block_clear_fn = fn;\n     }"}, {"sha": "45942a27a220d28bf5b155905706dd3afa968b02", "filename": "gcc/targhooks.c", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Ftarghooks.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Ftarghooks.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftarghooks.c?ref=5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "patch": "@@ -398,6 +398,8 @@ default_external_stack_protect_fail (void)\n       TREE_NOTHROW (t) = 1;\n       DECL_ARTIFICIAL (t) = 1;\n       DECL_IGNORED_P (t) = 1;\n+      DECL_VISIBILITY (t) = VISIBILITY_DEFAULT;\n+      DECL_VISIBILITY_SPECIFIED (t) = 1;\n \n       stack_chk_fail_decl = t;\n     }"}, {"sha": "e5995827b79e25e09b00fb4498ae28776759c210", "filename": "gcc/testsuite/gcc.dg/visibility-11.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-11.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-11.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-11.c?ref=5b5cba1f05156ad8ba51ba09ef8ec10fdbe915d0", "patch": "@@ -0,0 +1,24 @@\n+/* PR middle-end/20297 */\n+/* The memcpy FUNCTION_DECL built in the middle-end for block moves got\n+   hidden visibility from the first push, so the call didn't use the PLT.  */\n+\n+/* { dg-do compile { target i?86-*-* x86_64-*-* } } */\n+/* { dg-require-visibility \"\" } */\n+/* { dg-options \"-Os -fpic\" } */\n+/* { dg-final { scan-assembler \"memcpy@PLT\" } } */\n+\n+#pragma GCC visibility push(hidden)\n+#pragma GCC visibility push(default)\n+extern void* memcpy (void *, const void *, __SIZE_TYPE__);\n+#pragma GCC visibility pop\n+\n+struct a { int a[10]; };\n+\n+extern void *bar (struct a *, struct a *, int);\n+\n+void *\n+foo (struct a *a, struct a *b, int c)\n+{\n+  struct a cc = *b;\n+  return bar (a, &cc, 4 * c);\n+}"}]}