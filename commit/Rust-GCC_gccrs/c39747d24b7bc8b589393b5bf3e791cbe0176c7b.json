{"sha": "c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzM5NzQ3ZDI0YjdiYzhiNTg5MzkzYjViZjNlNzkxY2JlMDE3NmM3Yg==", "commit": {"author": {"name": "Fritz Reese", "email": "fritzoreese@gmail.com", "date": "2016-09-30T11:42:31Z"}, "committer": {"name": "Fritz Reese", "email": "foreese@gcc.gnu.org", "date": "2016-09-30T11:42:31Z"}, "message": "Fix ICE for maps with zero components.\n\n2016-09-30  Fritz Reese  <fritzoreese@gmail.com>\n\nFix ICE for maps with zero components.\n\n\tPR fortran/77764\n\t* gcc/fortran/interface.c (gfc_compare_union_types): Null-guard map\n\tcomponents.\n\n\tPR fortran/77764\n\t* gcc/testsuite/gfortran.dg/dec_union_8.f90: New testcase.\n\nFrom-SVN: r240652", "tree": {"sha": "d0d437c53defc235cbbb78ba79cff3acd78a352b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/d0d437c53defc235cbbb78ba79cff3acd78a352b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/comments", "author": {"login": "fritzr", "id": 2230564, "node_id": "MDQ6VXNlcjIyMzA1NjQ=", "avatar_url": "https://avatars.githubusercontent.com/u/2230564?v=4", "gravatar_id": "", "url": "https://api.github.com/users/fritzr", "html_url": "https://github.com/fritzr", "followers_url": "https://api.github.com/users/fritzr/followers", "following_url": "https://api.github.com/users/fritzr/following{/other_user}", "gists_url": "https://api.github.com/users/fritzr/gists{/gist_id}", "starred_url": "https://api.github.com/users/fritzr/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/fritzr/subscriptions", "organizations_url": "https://api.github.com/users/fritzr/orgs", "repos_url": "https://api.github.com/users/fritzr/repos", "events_url": "https://api.github.com/users/fritzr/events{/privacy}", "received_events_url": "https://api.github.com/users/fritzr/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "00074dd8e31adf8bd445e4af7ed27dda77985ab4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/00074dd8e31adf8bd445e4af7ed27dda77985ab4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/00074dd8e31adf8bd445e4af7ed27dda77985ab4"}], "stats": {"total": 50, "additions": 46, "deletions": 4}, "files": [{"sha": "19349a1a82b27901b08b82ed419fd06978dd355b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "patch": "@@ -1,3 +1,8 @@\n+2016-09-30  Fritz Reese  <fritzoreese@gmail.com>\n+\n+\tPR fortran/77764\n+\t* interface.c (gfc_compare_union_types): Null-guard map components.\n+\n 2016-09-30  Fritz Reese  <fritzoreese@gmail.com>\n \n \tPR fortran/77782"}, {"sha": "04ad0e295f7687013d1a5a9e37c22f81b0b8c8dd", "filename": "gcc/fortran/interface.c", "status": "modified", "additions": 15, "deletions": 4, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ffortran%2Finterface.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ffortran%2Finterface.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Finterface.c?ref=c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "patch": "@@ -526,6 +526,7 @@ int\n gfc_compare_union_types (gfc_symbol *un1, gfc_symbol *un2)\n {\n   gfc_component *map1, *map2, *cmp1, *cmp2;\n+  gfc_symbol *map1_t, *map2_t;\n \n   if (un1->attr.flavor != FL_UNION || un2->attr.flavor != FL_UNION)\n     return 0;\n@@ -541,16 +542,26 @@ gfc_compare_union_types (gfc_symbol *un1, gfc_symbol *un2)\n      we compare the maps sequentially. */\n   for (;;)\n   {\n-    cmp1 = map1->ts.u.derived->components;\n-    cmp2 = map2->ts.u.derived->components;\n+    map1_t = map1->ts.u.derived;\n+    map2_t = map2->ts.u.derived;\n+\n+    cmp1 = map1_t->components;\n+    cmp2 = map2_t->components;\n+\n+    /* Protect against null components.  */\n+    if (map1_t->attr.zero_comp != map2_t->attr.zero_comp)\n+      return 0;\n+\n+    if (map1_t->attr.zero_comp)\n+      return 1;\n+\n     for (;;)\n     {\n       /* No two fields will ever point to the same map type unless they are\n          the same component, because one map field is created with its type\n          declaration. Therefore don't worry about recursion here. */\n       /* TODO: worry about recursion into parent types of the unions? */\n-      if (compare_components (cmp1, cmp2,\n-            map1->ts.u.derived, map2->ts.u.derived) == 0)\n+      if (compare_components (cmp1, cmp2, map1_t, map2_t) == 0)\n         return 0;\n \n       cmp1 = cmp1->next;"}, {"sha": "3a359ba53aca55bb7b309277325ba74bb00ec2f7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "patch": "@@ -1,3 +1,8 @@\n+2016-09-30  Fritz Reese  <fritzoreese@gmail.com>\n+\n+\tPR fortran/77764\n+\t* gfortran.dg/dec_union_8.f90: New testcase.\n+\n 2016-09-30  Fritz Reese  <fritzoreese@gmail.com>\n \n \tPR fortran/77782"}, {"sha": "2d856fc44efa4ab45380656f13c53c323c53beec", "filename": "gcc/testsuite/gfortran.dg/dec_union_8.f90", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_8.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c39747d24b7bc8b589393b5bf3e791cbe0176c7b/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_8.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdec_union_8.f90?ref=c39747d24b7bc8b589393b5bf3e791cbe0176c7b", "patch": "@@ -0,0 +1,21 @@\n+! { dg-do compile }\n+! { dg-options \"-fdec-structure\" }\n+!\n+! PR fortran/77764\n+!\n+! Test an ICE due to a map with zero components.\n+!\n+\n+program p\n+\n+structure /s1/\n+  union\n+    map\n+    end map\n+    map\n+      real :: a = 2.0\n+    end map\n+  end union\n+end structure\n+\n+end"}]}