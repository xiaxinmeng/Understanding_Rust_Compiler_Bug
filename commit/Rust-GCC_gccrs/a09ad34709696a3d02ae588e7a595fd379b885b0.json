{"sha": "a09ad34709696a3d02ae588e7a595fd379b885b0", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA5YWQzNDcwOTY5NmEzZDAyYWU1ODhlN2E1OTVmZDM3OWI4ODViMA==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-11-16T16:43:49Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-11-16T16:43:49Z"}, "message": "re PR rtl-optimization/87475 (ICE in patch_jump_insn, at cfgrtl.c:1275)\n\n\tPR rtl-optimization/87475\n\t* cfgrtl.c (patch_jump_insn): Allow redirection failure for\n\tCROSSING_JUMP_P insns.\n\t(cfg_layout_redirect_edge_and_branch): Don't ICE if ret is NULL.\n\n\t* g++.dg/opt/pr87475.C: New test.\n\nFrom-SVN: r266219", "tree": {"sha": "6dc7bca638b39ef4d7674face7c249f65785cde0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6dc7bca638b39ef4d7674face7c249f65785cde0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a09ad34709696a3d02ae588e7a595fd379b885b0", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a09ad34709696a3d02ae588e7a595fd379b885b0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a09ad34709696a3d02ae588e7a595fd379b885b0", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a09ad34709696a3d02ae588e7a595fd379b885b0/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "b41835733bc337580a0de6b8ba5de4b00d391fc6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b41835733bc337580a0de6b8ba5de4b00d391fc6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b41835733bc337580a0de6b8ba5de4b00d391fc6"}], "stats": {"total": 28, "additions": 26, "deletions": 2}, "files": [{"sha": "984826d6c47f865bc29a4a65d2ad5ef904cc8719", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=a09ad34709696a3d02ae588e7a595fd379b885b0", "patch": "@@ -1,3 +1,10 @@\n+2018-11-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/87475\n+\t* cfgrtl.c (patch_jump_insn): Allow redirection failure for\n+\tCROSSING_JUMP_P insns.\n+\t(cfg_layout_redirect_edge_and_branch): Don't ICE if ret is NULL.\n+\n 2018-11-16  Uros Bizjak  <ubizjak@gmail.com>\n \n \tPR target/88051"}, {"sha": "411a0245f5456616e4e78b60ea74a980a30b90b6", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=a09ad34709696a3d02ae588e7a595fd379b885b0", "patch": "@@ -1268,11 +1268,13 @@ patch_jump_insn (rtx_insn *insn, rtx_insn *old_label, basic_block new_bb)\n \n \t  /* If the substitution doesn't succeed, die.  This can happen\n \t     if the back end emitted unrecognizable instructions or if\n-\t     target is exit block on some arches.  */\n+\t     target is exit block on some arches.  Or for crossing\n+\t     jumps.  */\n \t  if (!redirect_jump (as_a <rtx_jump_insn *> (insn),\n \t\t\t      block_label (new_bb), 0))\n \t    {\n-\t      gcc_assert (new_bb == EXIT_BLOCK_PTR_FOR_FN (cfun));\n+\t      gcc_assert (new_bb == EXIT_BLOCK_PTR_FOR_FN (cfun)\n+\t\t\t  || CROSSING_JUMP_P (insn));\n \t      return false;\n \t    }\n \t}\n@@ -4460,6 +4462,9 @@ cfg_layout_redirect_edge_and_branch (edge e, basic_block dest)\n   else\n     ret = redirect_branch_edge (e, dest);\n \n+  if (!ret)\n+    return NULL;\n+\n   fixup_partition_crossing (ret);\n   /* We don't want simplejumps in the insn stream during cfglayout.  */\n   gcc_assert (!simplejump_p (BB_END (src)) || CROSSING_JUMP_P (BB_END (src)));"}, {"sha": "e3856f48282e791f2cff67ea86b91964721b99a7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a09ad34709696a3d02ae588e7a595fd379b885b0", "patch": "@@ -1,3 +1,8 @@\n+2018-11-16  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR rtl-optimization/87475\n+\t* g++.dg/opt/pr87475.C: New test.\n+\n 2018-11-16  Matthew Malcomson  <matthew.malcomson@arm.com>\n \n \t* gcc.c-torture/execute/printf-2.c: Skip on wrapped boards."}, {"sha": "5ed25b45246bd318ae374cb8b27adde485c5697b", "filename": "gcc/testsuite/g++.dg/opt/pr87475.C", "status": "added", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr87475.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a09ad34709696a3d02ae588e7a595fd379b885b0/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr87475.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fopt%2Fpr87475.C?ref=a09ad34709696a3d02ae588e7a595fd379b885b0", "patch": "@@ -0,0 +1,7 @@\n+// PR rtl-optimization/87475\n+// { dg-do compile { target freorder } }\n+// { dg-options \"-O2 -freorder-blocks-and-partition -fmodulo-sched\" }\n+\n+struct A { A (); ~A (); };\n+int foo (A, A);\n+void bar (bool x) { x ? foo (A (), A ()) : 0; }"}]}