{"sha": "946c8b23ddf4ab7cc6af92c5a58b36814af3ecac", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTQ2YzhiMjNkZGY0YWI3Y2M2YWY5MmM1YTU4YjM2ODE0YWYzZWNhYw==", "commit": {"author": {"name": "Georg-Johann Lay", "email": "avr@gjlay.de", "date": "2011-06-29T07:57:25Z"}, "committer": {"name": "Georg-Johann Lay", "email": "gjl@gcc.gnu.org", "date": "2011-06-29T07:57:25Z"}, "message": "re PR target/34734 ([avr] attribute((progmem)) not handled properly in C++)\n\n\tPR target/34734\n\t* config/avr/avr.c (avr_handle_progmem_attribute): Move warning \n\tabout uninitialized data attributed 'progmem' from here...\n\t(avr_encode_section_info): ...to this new function.\n\t(TARGET_ENCODE_SECTION_INFO): New define.\n\t(avr_section_type_flags): For data in \".progmem.data\", remove\n\tsection flag SECTION_WRITE.\n\nFrom-SVN: r175621", "tree": {"sha": "51d6e45470246d7525f6abd38e9cc6a4d020bfb0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/51d6e45470246d7525f6abd38e9cc6a4d020bfb0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac", "html_url": "https://github.com/Rust-GCC/gccrs/commit/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac/comments", "author": null, "committer": {"login": "sprintersb", "id": 8905355, "node_id": "MDQ6VXNlcjg5MDUzNTU=", "avatar_url": "https://avatars.githubusercontent.com/u/8905355?v=4", "gravatar_id": "", "url": "https://api.github.com/users/sprintersb", "html_url": "https://github.com/sprintersb", "followers_url": "https://api.github.com/users/sprintersb/followers", "following_url": "https://api.github.com/users/sprintersb/following{/other_user}", "gists_url": "https://api.github.com/users/sprintersb/gists{/gist_id}", "starred_url": "https://api.github.com/users/sprintersb/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/sprintersb/subscriptions", "organizations_url": "https://api.github.com/users/sprintersb/orgs", "repos_url": "https://api.github.com/users/sprintersb/repos", "events_url": "https://api.github.com/users/sprintersb/events{/privacy}", "received_events_url": "https://api.github.com/users/sprintersb/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9a63dee43dc3415c872f8087c9ef4ea7cb68208b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9a63dee43dc3415c872f8087c9ef4ea7cb68208b"}], "stats": {"total": 45, "additions": 39, "deletions": 6}, "files": [{"sha": "323c17954b193c544815e3cb180b6335dd6f570a", "filename": "gcc/ChangeLog", "status": "modified", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=946c8b23ddf4ab7cc6af92c5a58b36814af3ecac", "patch": "@@ -1,3 +1,13 @@\n+2011-06-29  Georg-Johann Lay  <avr@gjlay.de>\n+\t\n+\tPR target/34734\n+\t* config/avr/avr.c (avr_handle_progmem_attribute): Move warning \n+\tabout uninitialized data attributed 'progmem' from here...\n+\t(avr_encode_section_info): ...to this new function.\n+\t(TARGET_ENCODE_SECTION_INFO): New define.\n+\t(avr_section_type_flags): For data in \".progmem.data\", remove\n+\tsection flag SECTION_WRITE.\n+\n 2011-06-29  Georg-Johann Lay  <avr@gjlay.de>\n \t\n \t* config/avr/t-avr (LIB1ASMFUNCS): Add _mulhisi3, _umulhisi3,"}, {"sha": "5e665e5e13ea9c7d0deeadf504981325050b07c1", "filename": "gcc/config/avr/avr.c", "status": "modified", "additions": 29, "deletions": 6, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac/gcc%2Fconfig%2Favr%2Favr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/946c8b23ddf4ab7cc6af92c5a58b36814af3ecac/gcc%2Fconfig%2Favr%2Favr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Favr%2Favr.c?ref=946c8b23ddf4ab7cc6af92c5a58b36814af3ecac", "patch": "@@ -108,6 +108,7 @@ static void avr_function_arg_advance (cumulative_args_t, enum machine_mode,\n \t\t\t\t      const_tree, bool);\n static bool avr_function_ok_for_sibcall (tree, tree);\n static void avr_asm_named_section (const char *name, unsigned int flags, tree decl);\n+static void avr_encode_section_info (tree, rtx, int);\n \n /* Allocate registers from r25 to r8 for parameters for function calls.  */\n #define FIRST_CUM_REG 26\n@@ -197,6 +198,8 @@ static const struct attribute_spec avr_attribute_table[] =\n \n #undef TARGET_ASM_INIT_SECTIONS\n #define TARGET_ASM_INIT_SECTIONS avr_asm_init_sections\n+#undef TARGET_ENCODE_SECTION_INFO\n+#define TARGET_ENCODE_SECTION_INFO avr_encode_section_info\n \n #undef TARGET_REGISTER_MOVE_COST\n #define TARGET_REGISTER_MOVE_COST avr_register_move_cost\n@@ -4941,12 +4944,7 @@ avr_handle_progmem_attribute (tree *node, tree name,\n \t}\n       else if (TREE_STATIC (*node) || DECL_EXTERNAL (*node))\n \t{\n-\t  if (DECL_INITIAL (*node) == NULL_TREE && !DECL_EXTERNAL (*node))\n-\t    {\n-\t      warning (0, \"only initialized variables can be placed into \"\n-\t\t       \"program memory area\");\n-\t      *no_add_attrs = true;\n-\t    }\n+          *no_add_attrs = false;\n \t}\n       else\n \t{\n@@ -5153,10 +5151,35 @@ avr_section_type_flags (tree decl, const char *name, int reloc)\n \t\t \".noinit section\");\n     }\n \n+  if (0 == strncmp (name, \".progmem.data\", strlen (\".progmem.data\")))\n+    flags &= ~SECTION_WRITE;\n+  \n   return flags;\n }\n \n \n+/* Implement `TARGET_ENCODE_SECTION_INFO'.  */\n+\n+static void\n+avr_encode_section_info (tree decl, rtx rtl ATTRIBUTE_UNUSED,\n+                         int new_decl_p)\n+{\n+  /* In avr_handle_progmem_attribute, DECL_INITIAL is not yet\n+     readily available, see PR34734.  So we postpone the warning\n+     about uninitialized data in program memory section until here.  */\n+   \n+  if (new_decl_p\n+      && decl && DECL_P (decl)\n+      && NULL_TREE == DECL_INITIAL (decl)\n+      && avr_progmem_p (decl, DECL_ATTRIBUTES (decl)))\n+    {\n+      warning (OPT_Wuninitialized,\n+               \"uninitialized variable %q+D put into \"\n+               \"program memory area\", decl);\n+    }\n+}\n+\n+\n /* Implement `TARGET_ASM_FILE_START'.  */\n /* Outputs some appropriate text to go at the start of an assembler\n    file.  */"}]}