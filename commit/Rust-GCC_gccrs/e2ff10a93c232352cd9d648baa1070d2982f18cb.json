{"sha": "e2ff10a93c232352cd9d648baa1070d2982f18cb", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTJmZjEwYTkzYzIzMjM1MmNkOWQ2NDhiYWExMDcwZDI5ODJmMThjYg==", "commit": {"author": {"name": "Richard Sandiford", "email": "rdsandiford@googlemail.com", "date": "2008-06-26T21:28:30Z"}, "committer": {"name": "Richard Sandiford", "email": "rsandifo@gcc.gnu.org", "date": "2008-06-26T21:28:30Z"}, "message": "libfuncs.h (LTI_synchronize): New libfunc_index.\n\ngcc/\n\t* libfuncs.h (LTI_synchronize): New libfunc_index.\n\t(synchronize_libfunc): Declare.\n\t* builtins.c (expand_builtin_synchronize): Consider using\n\tsynchronize_libfunc before falling back on an asm blockage.\n\t* config/mips/mips.c: Include libfuncs.h\n\t(mips_init_libfuncs): Initialize synchronize_libfunc for TARGET_MIPS16.\n\nFrom-SVN: r137162", "tree": {"sha": "b243da2903826b74d9af4b244282d7635346588d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b243da2903826b74d9af4b244282d7635346588d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e2ff10a93c232352cd9d648baa1070d2982f18cb", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2ff10a93c232352cd9d648baa1070d2982f18cb", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e2ff10a93c232352cd9d648baa1070d2982f18cb", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e2ff10a93c232352cd9d648baa1070d2982f18cb/comments", "author": {"login": "rsandifo", "id": 4235983, "node_id": "MDQ6VXNlcjQyMzU5ODM=", "avatar_url": "https://avatars.githubusercontent.com/u/4235983?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rsandifo", "html_url": "https://github.com/rsandifo", "followers_url": "https://api.github.com/users/rsandifo/followers", "following_url": "https://api.github.com/users/rsandifo/following{/other_user}", "gists_url": "https://api.github.com/users/rsandifo/gists{/gist_id}", "starred_url": "https://api.github.com/users/rsandifo/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rsandifo/subscriptions", "organizations_url": "https://api.github.com/users/rsandifo/orgs", "repos_url": "https://api.github.com/users/rsandifo/repos", "events_url": "https://api.github.com/users/rsandifo/events{/privacy}", "received_events_url": "https://api.github.com/users/rsandifo/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "f78c3290cdcd5328d1924935806f8ef24d7f7788", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f78c3290cdcd5328d1924935806f8ef24d7f7788", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f78c3290cdcd5328d1924935806f8ef24d7f7788"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "3f2a1bd83731e73ed82925801db2d76cf3cee911", "filename": "gcc/ChangeLog", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e2ff10a93c232352cd9d648baa1070d2982f18cb", "patch": "@@ -1,3 +1,12 @@\n+2008-06-26  Richard Sandiford  <rdsandiford@googlemail.com>\n+\n+\t* libfuncs.h (LTI_synchronize): New libfunc_index.\n+\t(synchronize_libfunc): Declare.\n+\t* builtins.c (expand_builtin_synchronize): Consider using\n+\tsynchronize_libfunc before falling back on an asm blockage.\n+\t* config/mips/mips.c: Include libfuncs.h\n+\t(mips_init_libfuncs): Initialize synchronize_libfunc for TARGET_MIPS16.\n+\n 2008-06-26  Nathan Froyd  <froydnj@codesourcery.com>\n \n \t* config/rs6000/rs6000.c (emit_allocate_stack): Add copy_r11"}, {"sha": "10af34254aad7fed970de1bb616033c51f85e5d5", "filename": "gcc/builtins.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2Fbuiltins.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2Fbuiltins.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fbuiltins.c?ref=e2ff10a93c232352cd9d648baa1070d2982f18cb", "patch": "@@ -5999,6 +5999,12 @@ expand_builtin_synchronize (void)\n     }\n #endif\n \n+  if (synchronize_libfunc != NULL_RTX)\n+    {\n+      emit_library_call (synchronize_libfunc, LCT_NORMAL, VOIDmode, 0);\n+      return;\n+    }\n+\n   /* If no explicit memory barrier instruction is available, create an\n      empty asm stmt with a memory clobber.  */\n   x = build4 (ASM_EXPR, void_type_node, build_string (0, \"\"), NULL, NULL,"}, {"sha": "e8b384e1db255304437a930ba0171fc139b7baec", "filename": "gcc/config/mips/mips.c", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2Fconfig%2Fmips%2Fmips.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2Fconfig%2Fmips%2Fmips.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.c?ref=e2ff10a93c232352cd9d648baa1070d2982f18cb", "patch": "@@ -42,6 +42,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"function.h\"\n #include \"expr.h\"\n #include \"optabs.h\"\n+#include \"libfuncs.h\"\n #include \"flags.h\"\n #include \"reload.h\"\n #include \"tm_p.h\"\n@@ -9424,6 +9425,11 @@ mips_init_libfuncs (void)\n   else\n     /* Register the gofast functions if selected using --enable-gofast.  */\n     gofast_maybe_init_libfuncs ();\n+\n+  /* The MIPS16 ISA does not have an encoding for \"sync\", so we rely\n+     on an external non-MIPS16 routine to implement __sync_synchronize.  */\n+  if (TARGET_MIPS16)\n+    synchronize_libfunc = init_one_libfunc (\"__sync_synchronize\");\n }\n \n /* Return the length of INSN.  LENGTH is the initial length computed by"}, {"sha": "ef636da36bbc1e467f9a4f431bc04826909e5017", "filename": "gcc/libfuncs.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2Flibfuncs.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e2ff10a93c232352cd9d648baa1070d2982f18cb/gcc%2Flibfuncs.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Flibfuncs.h?ref=e2ff10a93c232352cd9d648baa1070d2982f18cb", "patch": "@@ -40,6 +40,8 @@ enum libfunc_index\n   LTI_profile_function_entry,\n   LTI_profile_function_exit,\n \n+  LTI_synchronize,\n+\n   LTI_gcov_flush,\n \n   LTI_MAX\n@@ -69,6 +71,8 @@ extern GTY(()) rtx libfunc_table[LTI_MAX];\n #define profile_function_entry_libfunc\t(libfunc_table[LTI_profile_function_entry])\n #define profile_function_exit_libfunc\t(libfunc_table[LTI_profile_function_exit])\n \n+#define synchronize_libfunc\t(libfunc_table[LTI_synchronize])\n+\n #define gcov_flush_libfunc\t(libfunc_table[LTI_gcov_flush])\n \n #endif /* GCC_LIBFUNCS_H */"}]}