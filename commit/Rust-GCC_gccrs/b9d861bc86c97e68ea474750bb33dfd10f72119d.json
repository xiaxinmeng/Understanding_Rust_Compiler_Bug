{"sha": "b9d861bc86c97e68ea474750bb33dfd10f72119d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YjlkODYxYmM4NmM5N2U2OGVhNDc0NzUwYmIzM2RmZDEwZjcyMTE5ZA==", "commit": {"author": {"name": "Bryce McKinlay", "email": "mckinlay@redhat.com", "date": "2004-05-26T18:45:26Z"}, "committer": {"name": "Bryce McKinlay", "email": "bryce@gcc.gnu.org", "date": "2004-05-26T18:45:26Z"}, "message": "lex.c (java_new_lexer): Set 'encoding'.\n\n\t* lex.c (java_new_lexer): Set 'encoding'.\n\t(java_read_char): Improve error message for unrecognized characters.\n\t* lex.h (struct java_lexer): New field 'encoding'.\n\nFrom-SVN: r82292", "tree": {"sha": "83551097f3288d4fd1d2fd84346837d37b4dd7ba", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/83551097f3288d4fd1d2fd84346837d37b4dd7ba"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b9d861bc86c97e68ea474750bb33dfd10f72119d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9d861bc86c97e68ea474750bb33dfd10f72119d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b9d861bc86c97e68ea474750bb33dfd10f72119d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b9d861bc86c97e68ea474750bb33dfd10f72119d/comments", "author": null, "committer": null, "parents": [{"sha": "e0885edbf5c198f300fec204b3688ecf5e6839ef", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e0885edbf5c198f300fec204b3688ecf5e6839ef", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e0885edbf5c198f300fec204b3688ecf5e6839ef"}], "stats": {"total": 22, "additions": 19, "deletions": 3}, "files": [{"sha": "a51d4a175174f7fecb7be459da68ebc41b319cc0", "filename": "gcc/java/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9d861bc86c97e68ea474750bb33dfd10f72119d/gcc%2Fjava%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9d861bc86c97e68ea474750bb33dfd10f72119d/gcc%2Fjava%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2FChangeLog?ref=b9d861bc86c97e68ea474750bb33dfd10f72119d", "patch": "@@ -1,3 +1,9 @@\n+2004-05-26  Bryce McKinlay  <mckinlay@redhat.com>\n+\n+\t* lex.c (java_new_lexer): Set 'encoding'.\n+\t(java_read_char): Improve error message for unrecognized characters.\n+\t* lex.h (struct java_lexer): New field 'encoding'.\n+\n 2004-05-23  Paolo Bonzini  <bonzini@gnu.org>\n \n \t* Make-lang.in: Link in $(LIBCPP) instead of mkdeps.o."}, {"sha": "de9b2222e0b5282709b3e57c461b18fa560ee54e", "filename": "gcc/java/lex.c", "status": "modified", "additions": 10, "deletions": 3, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9d861bc86c97e68ea474750bb33dfd10f72119d/gcc%2Fjava%2Flex.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9d861bc86c97e68ea474750bb33dfd10f72119d/gcc%2Fjava%2Flex.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Flex.c?ref=b9d861bc86c97e68ea474750bb33dfd10f72119d", "patch": "@@ -228,6 +228,7 @@ java_new_lexer (FILE *finput, const char *encoding)\n   lex->bs_count = 0;\n   lex->unget_value = 0;\n   lex->hit_eof = 0;\n+  lex->encoding = encoding;\n \n #ifdef HAVE_ICONV\n   lex->handle = iconv_open (\"UCS-2\", encoding);\n@@ -295,7 +296,10 @@ java_new_lexer (FILE *finput, const char *encoding)\n \tenc_error = 1;\n #ifdef HAVE_ICONV\n       else\n-\tlex->use_fallback = 1;\n+        {\n+\t  lex->use_fallback = 1;\n+\t  lex->encoding = \"UTF-8\";\n+\t}\n #endif /* HAVE_ICONV */\n     }\n \n@@ -430,8 +434,11 @@ java_read_char (java_lexer *lex)\n \t\t  else\n \t\t    {\n \t\t      /* A more serious error.  */\n-\t\t      java_lex_error (\"unrecognized character in input stream\",\n-\t\t\t\t      0);\n+\t\t      char buffer[128];\n+\t\t      sprintf (buffer,\n+\t\t\t       \"Unrecognized character for encoding '%s'\", \n+\t\t               lex->encoding);\n+\t\t      java_lex_error (buffer, 0);\n \t\t      return UEOF;\n \t\t    }\n \t\t}"}, {"sha": "213a80f3c5dfe2ed9a3dec4bc9d5bce8205f5bfe", "filename": "gcc/java/lex.h", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b9d861bc86c97e68ea474750bb33dfd10f72119d/gcc%2Fjava%2Flex.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b9d861bc86c97e68ea474750bb33dfd10f72119d/gcc%2Fjava%2Flex.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fjava%2Flex.h?ref=b9d861bc86c97e68ea474750bb33dfd10f72119d", "patch": "@@ -116,6 +116,9 @@ struct java_lexer\n \n   /* If nonzero, we've hit EOF.  Used only by java_get_unicode().  */\n   int hit_eof : 1;\n+  \n+  /* Name of the character encoding we're using.  */\n+  const char *encoding;\n \n #ifdef HAVE_ICONV\n   /* Nonzero if we've read any bytes.  We only recognize the"}]}