{"sha": "e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTVlMzkxZDYzMDQ3NmIwZWEyZmYyZGMwMWRiN2Y4ZGZjYjAzNzk3NA==", "commit": {"author": {"name": "Maxim Ostapenko", "email": "m.ostapenko@samsung.com", "date": "2017-01-25T07:45:40Z"}, "committer": {"name": "Maxim Ostapenko", "email": "chefmax@gcc.gnu.org", "date": "2017-01-25T07:45:40Z"}, "message": "re PR lto/79061 ([LTO][ASAN] LTO plus ASAN fails with \"AddressSanitizer: initialization-order-fiasco\")\n\nPR lto/79061\n\ngcc/\n\n\t* asan.c (get_translation_unit_decl): New function.\n\t(asan_add_global): Extract modules file name from globals\n\tTRANSLATION_UNIT_DECL name.\n\ngcc/fortran/\n\n\t* f95-lang.c (gfc_create_decls): Include stringpool.h.\n\tPass main_input_filename to build_translation_unit_decl.\n\ngcc/ada/\n\n\t* gcc-interface/utils.c (get_global_context): Pass main_input_filename\n\tto build_translation_unit_decl.\n\ngcc/c/\n\n\t* c-decl.c (pop_scope): Pass main_input_filename to\n\tbuild_translation_unit_decl.\n\ngcc/cp/\n\n\t* decl.c (cxx_init_decl_processing): Pass main_input_filename\n\tto build_translation_unit_decl.\n\nFrom-SVN: r244890", "tree": {"sha": "7dea5db302e97ca5ad9684bbe3f3cfc517681e41", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7dea5db302e97ca5ad9684bbe3f3cfc517681e41"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/comments", "author": null, "committer": null, "parents": [{"sha": "98e20758464f5cbfc60bd61a0cadd66ebb900d96", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/98e20758464f5cbfc60bd61a0cadd66ebb900d96", "html_url": "https://github.com/Rust-GCC/gccrs/commit/98e20758464f5cbfc60bd61a0cadd66ebb900d96"}], "stats": {"total": 69, "additions": 64, "deletions": 5}, "files": [{"sha": "6c41705f50c7cbccf90562deb2e0e3e5e677d335", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -1,3 +1,10 @@\n+2017-01-25  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR lto/79061\n+\t* asan.c (get_translation_unit_decl): New function.\n+\t(asan_add_global): Extract modules file name from globals\n+\tTRANSLATION_UNIT_DECL name.\n+\n 2017-01-24  Eric Botcazou  <ebotcazou@adacore.com>\n \n \tPR target/77439"}, {"sha": "8f394b03ca902448f575c263ab924b5d38e7c9c2", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -1,3 +1,9 @@\n+2017-01-25  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR lto/79061\n+\t* gcc-interface/utils.c (get_global_context): Pass main_input_filename\n+\tto build_translation_unit_decl.\n+\n 2017-01-23  Javier Miranda  <miranda@adacore.com>\n \n \t* sem_util.adb (New_Copy_Tree): Code cleanup:"}, {"sha": "3cda63196e7e4a2a56a82c5b8c89f3ed14fe7754", "filename": "gcc/ada/gcc-interface/utils.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fada%2Fgcc-interface%2Futils.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fada%2Fgcc-interface%2Futils.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fgcc-interface%2Futils.c?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -666,7 +666,8 @@ get_global_context (void)\n {\n   if (!global_context)\n     {\n-      global_context = build_translation_unit_decl (NULL_TREE);\n+      global_context\n+\t= build_translation_unit_decl (get_identifier (main_input_filename));\n       debug_hooks->register_main_translation_unit (global_context);\n     }\n "}, {"sha": "9098121be8bcaaa197ce778d227ca646c09568b1", "filename": "gcc/asan.c", "status": "modified", "additions": 24, "deletions": 1, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fasan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fasan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fasan.c?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -2373,6 +2373,22 @@ asan_needs_odr_indicator_p (tree decl)\n \t  && TREE_PUBLIC (decl));\n }\n \n+/* For given DECL return its corresponding TRANSLATION_UNIT_DECL.  */\n+\n+static const_tree\n+get_translation_unit_decl (tree decl)\n+{\n+  const_tree context = decl;\n+  while (context && TREE_CODE (context) != TRANSLATION_UNIT_DECL)\n+    {\n+      if (TREE_CODE (context) == BLOCK)\n+\tcontext = BLOCK_SUPERCONTEXT (context);\n+      else\n+\tcontext = get_containing_scope (context);\n+    }\n+  return context;\n+}\n+\n /* Append description of a single global DECL into vector V.\n    TYPE is __asan_global struct type as returned by asan_global_struct.  */\n \n@@ -2392,7 +2408,14 @@ asan_add_global (tree decl, tree type, vec<constructor_elt, va_gc> *v)\n     pp_string (&asan_pp, \"<unknown>\");\n   str_cst = asan_pp_string (&asan_pp);\n \n-  pp_string (&module_name_pp, main_input_filename);\n+  const char *filename = main_input_filename;\n+  if (in_lto_p)\n+    {\n+      const_tree translation_unit_decl = get_translation_unit_decl (decl);\n+      if (translation_unit_decl && DECL_NAME (translation_unit_decl) != NULL)\n+\tfilename = IDENTIFIER_POINTER (DECL_NAME (translation_unit_decl));\n+    }\n+  pp_string (&module_name_pp, filename);\n   module_name_cst = asan_pp_string (&module_name_pp);\n \n   if (asan_needs_local_alias (decl))"}, {"sha": "16fb6f8a9f98c51dcbc68618b89be03500dd951c", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -1,3 +1,9 @@\n+2017-01-25  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR lto/79061\n+\t* c-decl.c (pop_scope): Pass main_input_filename to\n+\tbuild_translation_unit_decl.\n+\n 2017-01-24  David Malcolm  <dmalcolm@redhat.com>\n \n \t* c-parser.c: Include \"read-rtl-function.h\" and"}, {"sha": "32edaccb51bfc26dc009da7956ba18fea85de3d3", "filename": "gcc/c/c-decl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-decl.c?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -1177,7 +1177,8 @@ pop_scope (void)\n     context = current_function_decl;\n   else if (scope == file_scope)\n     {\n-      tree file_decl = build_translation_unit_decl (NULL_TREE);\n+      tree file_decl\n+\t= build_translation_unit_decl (get_identifier (main_input_filename));\n       context = file_decl;\n       debug_hooks->register_main_translation_unit (file_decl);\n     }"}, {"sha": "47eaa55032fb0d155a8b193fbaf6441071a828e3", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -1,3 +1,9 @@\n+2017-01-25  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR lto/79061\n+\t* decl.c (cxx_init_decl_processing): Pass main_input_filename\n+\tto build_translation_unit_decl.\n+\n 2017-01-24  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/79205"}, {"sha": "af74dcdb7059ee48f5ee8a1a4f5a2cf0a347f21e", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -4071,7 +4071,8 @@ cxx_init_decl_processing (void)\n   gcc_assert (global_namespace == NULL_TREE);\n   global_namespace = build_lang_decl (NAMESPACE_DECL, global_scope_name,\n \t\t\t\t      void_type_node);\n-  DECL_CONTEXT (global_namespace) = build_translation_unit_decl (NULL_TREE);\n+  DECL_CONTEXT (global_namespace)\n+    = build_translation_unit_decl (get_identifier (main_input_filename));\n   debug_hooks->register_main_translation_unit\n     (DECL_CONTEXT (global_namespace));\n   TREE_PUBLIC (global_namespace) = 1;"}, {"sha": "ff47dc4d1bad479a38106e46acd11fa4dbd37a13", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -1,3 +1,9 @@\n+2017-01-25  Maxim Ostapenko  <m.ostapenko@samsung.com>\n+\n+\tPR lto/79061\n+\t* f95-lang.c (gfc_create_decls): Include stringpool.h.\n+\tPass main_input_filename to build_translation_unit_decl.\n+\n 2017-01-23  Thomas Koenig  <tkoenig@netcologne.de>\n \n \t* arith.c (arith_power):  If simplifying integer power expression"}, {"sha": "44bd8dcc2ad028a8e1ec1cd477d9e8dc1790fb57", "filename": "gcc/fortran/f95-lang.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Ffortran%2Ff95-lang.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e5e391d630476b0ea2ff2dc01db7f8dfcb037974/gcc%2Ffortran%2Ff95-lang.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ff95-lang.c?ref=e5e391d630476b0ea2ff2dc01db7f8dfcb037974", "patch": "@@ -30,6 +30,7 @@ along with GCC; see the file COPYING3.  If not see\n #include \"tree.h\"\n #include \"gfortran.h\"\n #include \"trans.h\"\n+#include \"stringpool.h\"\n #include \"diagnostic.h\" /* For errorcount/warningcount */\n #include \"langhooks.h\"\n #include \"langhooks-def.h\"\n@@ -190,7 +191,8 @@ gfc_create_decls (void)\n   gfc_init_constants ();\n \n   /* Build our translation-unit decl.  */\n-  current_translation_unit = build_translation_unit_decl (NULL_TREE);\n+  current_translation_unit\n+    = build_translation_unit_decl (get_identifier (main_input_filename));\n   debug_hooks->register_main_translation_unit (current_translation_unit);\n }\n "}]}