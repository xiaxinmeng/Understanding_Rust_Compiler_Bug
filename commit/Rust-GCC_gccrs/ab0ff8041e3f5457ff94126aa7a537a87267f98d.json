{"sha": "ab0ff8041e3f5457ff94126aa7a537a87267f98d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWIwZmY4MDQxZTNmNTQ1N2ZmOTQxMjZhYTdhNTM3YTg3MjY3Zjk4ZA==", "commit": {"author": {"name": "Andrew Pinski", "email": "pinskia@physics.uc.edu", "date": "2006-03-01T19:12:22Z"}, "committer": {"name": "Andrew Pinski", "email": "pinskia@gcc.gnu.org", "date": "2006-03-01T19:12:22Z"}, "message": "re PR target/26389 (Darwin does not support -fsection-anchors)\n\n2006-03-01  Andrew Pinski  <pinskia@physics.uc.edu>\n\n        PR target/26389\n        * config/darwin-protos.h (darwin_asm_output_anchor):\n        Declare.\n        * config/darwin-sections.def (cstring_section):\n        Add SECTION_MERGE to the flags.\n        (literal4_section): Likewise.\n        (literal8_section): Likewise.\n        (objc_selector_refs_section): Likewise.\n        (objc_cls_refs_section): Likewise.\n        * config/darwin.c (darwin_asm_output_anchor): New\n        function.\n        * config/darwin.h (TARGET_ASM_OUTPUT_ANCHOR): Define.\n\nFrom-SVN: r111609", "tree": {"sha": "2dea0dfdc85e799468484651f4d9f1fb96a915dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/2dea0dfdc85e799468484651f4d9f1fb96a915dd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ab0ff8041e3f5457ff94126aa7a537a87267f98d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab0ff8041e3f5457ff94126aa7a537a87267f98d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab0ff8041e3f5457ff94126aa7a537a87267f98d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab0ff8041e3f5457ff94126aa7a537a87267f98d/comments", "author": null, "committer": null, "parents": [{"sha": "607f460c8b9e032b3fec25313b032bf07788b354", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/607f460c8b9e032b3fec25313b032bf07788b354", "html_url": "https://github.com/Rust-GCC/gccrs/commit/607f460c8b9e032b3fec25313b032bf07788b354"}], "stats": {"total": 41, "additions": 36, "deletions": 5}, "files": [{"sha": "74d6719b80dbccc8ef6dfc57e23cf00fe1e15977", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ab0ff8041e3f5457ff94126aa7a537a87267f98d", "patch": "@@ -1,3 +1,18 @@\n+2006-03-01  Andrew Pinski  <pinskia@physics.uc.edu>\n+\n+\tPR target/26389\n+\t* config/darwin-protos.h (darwin_asm_output_anchor):\n+\tDeclare.\n+\t* config/darwin-sections.def (cstring_section):\n+\tAdd SECTION_MERGE to the flags.\n+\t(literal4_section): Likewise.\n+\t(literal8_section): Likewise.\n+\t(objc_selector_refs_section): Likewise.\n+\t(objc_cls_refs_section): Likewise.\n+\t* config/darwin.c (darwin_asm_output_anchor): New\n+\tfunction.\n+\t* config/darwin.h (TARGET_ASM_OUTPUT_ANCHOR): Define.\n+\n 2006-03-01  Daniel Berlin  <dberlin@dberlin.org>\n  \n \tFix PR tree-optimization/26443"}, {"sha": "75308fb6f481b137866757ae7d59c5e0bcf5fe06", "filename": "gcc/config/darwin-protos.h", "status": "modified", "additions": 1, "deletions": 0, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin-protos.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin-protos.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-protos.h?ref=ab0ff8041e3f5457ff94126aa7a537a87267f98d", "patch": "@@ -80,3 +80,4 @@ extern void darwin_asm_output_dwarf_delta (FILE *, int, const char *,\n \t\t\t\t\t   const char *);\n extern bool darwin_binds_local_p (tree);\n extern void darwin_cpp_builtins (struct cpp_reader *);\n+extern void darwin_asm_output_anchor (rtx symbol);"}, {"sha": "89d6371ea6bc8b0e9738aa7f910c830ace41ad49", "filename": "gcc/config/darwin-sections.def", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin-sections.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin-sections.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin-sections.def?ref=ab0ff8041e3f5457ff94126aa7a537a87267f98d", "patch": "@@ -11,9 +11,9 @@ DEF_SECTION (const_data_coal_section, 0,\n \t     \".section __DATA,__const_coal,coalesced\", 0)\n DEF_SECTION (data_coal_section, SECTION_WRITE,\n \t     \".section __DATA,__datacoal_nt,coalesced\", 0)\n-DEF_SECTION (cstring_section, 0, \".cstring\", 0)\n-DEF_SECTION (literal4_section, 0, \".literal4\", 0)\n-DEF_SECTION (literal8_section, 0, \".literal8\", 0)\n+DEF_SECTION (cstring_section, SECTION_MERGE, \".cstring\", 0)\n+DEF_SECTION (literal4_section, SECTION_MERGE, \".literal4\", 0)\n+DEF_SECTION (literal8_section, SECTION_MERGE, \".literal8\", 0)\n DEF_SECTION (constructor_section, 0, \".constructor\", 0)\n DEF_SECTION (mod_init_section, 0, \".mod_init_func\", 0)\n DEF_SECTION (mod_term_section, 0, \".mod_term_func\", 0)\n@@ -27,7 +27,7 @@ DEF_SECTION (objc_cls_meth_section, 0, \".objc_cls_meth\", 1)\n DEF_SECTION (objc_inst_meth_section, 0, \".objc_inst_meth\", 1)\n DEF_SECTION (objc_cat_cls_meth_section, 0, \".objc_cat_cls_meth\", 1)\n DEF_SECTION (objc_cat_inst_meth_section, 0, \".objc_cat_inst_meth\", 1)\n-DEF_SECTION (objc_selector_refs_section, 0, \".objc_message_refs\", 1)\n+DEF_SECTION (objc_selector_refs_section, SECTION_MERGE, \".objc_message_refs\", 1)\n DEF_SECTION (objc_selector_fixup_section, 0,\n \t    \".section __OBJC, __sel_fixup, regular, no_dead_strip\", 1)\n DEF_SECTION (objc_symbols_section, 0, \".objc_symbols\", 1)\n@@ -43,7 +43,7 @@ DEF_SECTION (objc_image_info_section, 0,\n DEF_SECTION (objc_class_names_section, 0, \".objc_class_names\", 1)\n DEF_SECTION (objc_meth_var_names_section, 0, \".objc_meth_var_names\", 1)\n DEF_SECTION (objc_meth_var_types_section, 0, \".objc_meth_var_types\", 1)\n-DEF_SECTION (objc_cls_refs_section, 0, \".objc_cls_refs\", 1)\n+DEF_SECTION (objc_cls_refs_section, SECTION_MERGE, \".objc_cls_refs\", 1)\n \n DEF_SECTION (machopic_lazy_symbol_ptr_section, 0, \".lazy_symbol_pointer\", 0)\n DEF_SECTION (machopic_nl_symbol_ptr_section, 0, \".non_lazy_symbol_pointer\", 0)"}, {"sha": "2ae24a9661fdbc9776650075c57e761f0b7d2cb6", "filename": "gcc/config/darwin.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.c?ref=ab0ff8041e3f5457ff94126aa7a537a87267f98d", "patch": "@@ -1479,4 +1479,17 @@ darwin_binds_local_p (tree decl)\n   return default_binds_local_p_1 (decl, 0);\n }\n \n+/* The Darwin's implementation of TARGET_ASM_OUTPUT_ANCHOR.  Define the\n+   anchor relative to \".\", the current section position.  We cannot use\n+   the default one because ASM_OUTPUT_DEF is wrong for Darwin.  */\n+\n+void\n+darwin_asm_output_anchor (rtx symbol)\n+{\n+  fprintf (asm_out_file, \"\\t.set\\t\");\n+  assemble_name (asm_out_file, XSTR (symbol, 0));\n+  fprintf (asm_out_file, \", . + \" HOST_WIDE_INT_PRINT_DEC \"\\n\",\n+\t   SYMBOL_REF_BLOCK_OFFSET (symbol));\n+}\n+\n #include \"gt-darwin.h\""}, {"sha": "495178c1e6ee9694ad670d57d6007707e2976d9d", "filename": "gcc/config/darwin.h", "status": "modified", "additions": 2, "deletions": 0, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab0ff8041e3f5457ff94126aa7a537a87267f98d/gcc%2Fconfig%2Fdarwin.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fdarwin.h?ref=ab0ff8041e3f5457ff94126aa7a537a87267f98d", "patch": "@@ -793,6 +793,8 @@ enum machopic_addr_class {\n \tgoto DONE;\t\t\t\t\t\t\t\t\t\\\n       }\n \n+#define TARGET_ASM_OUTPUT_ANCHOR darwin_asm_output_anchor\n+\n /* Experimentally, putting jump tables in text is faster on SPEC.\n    Also this is needed for correctness for coalesced functions.  */\n "}]}