{"sha": "51faf07cef9293af544bfacc7d0b320ab90d7d60", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTFmYWYwN2NlZjkyOTNhZjU0NGJmYWNjN2QwYjMyMGFiOTBkN2Q2MA==", "commit": {"author": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2020-02-19T10:13:52Z"}, "committer": {"name": "Martin Jambor", "email": "mjambor@suse.cz", "date": "2020-02-19T10:15:30Z"}, "message": "sra: Do not create zero sized accesses  (PR 93776)\n\nSRA can get a bit confused with zero-sized accesses like the one in\nthe testcase.  Since there is nothing in the access, nothing is\nscalarized, but we can get order of the structures wrong, which the\nverifier is not happy about.\n\nFixed by simply ignoring such accesses.\n\n2020-02-19  Martin Jambor  <mjambor@suse.cz>\n\n\tPR tree-optimization/93776\n\t* tree-sra.c (create_access): Do not create zero size accesses.\n\t(get_access_for_expr): Do not search for zero sized accesses.\n\n\ttestsuite/\n\t* gcc.dg/tree-ssa/pr93776.c: New test.", "tree": {"sha": "533e82edecf8fb0aaf3972966db494361c113dec", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/533e82edecf8fb0aaf3972966db494361c113dec"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/51faf07cef9293af544bfacc7d0b320ab90d7d60", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51faf07cef9293af544bfacc7d0b320ab90d7d60", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51faf07cef9293af544bfacc7d0b320ab90d7d60", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51faf07cef9293af544bfacc7d0b320ab90d7d60/comments", "author": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jamborm", "id": 2180070, "node_id": "MDQ6VXNlcjIxODAwNzA=", "avatar_url": "https://avatars.githubusercontent.com/u/2180070?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jamborm", "html_url": "https://github.com/jamborm", "followers_url": "https://api.github.com/users/jamborm/followers", "following_url": "https://api.github.com/users/jamborm/following{/other_user}", "gists_url": "https://api.github.com/users/jamborm/gists{/gist_id}", "starred_url": "https://api.github.com/users/jamborm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jamborm/subscriptions", "organizations_url": "https://api.github.com/users/jamborm/orgs", "repos_url": "https://api.github.com/users/jamborm/repos", "events_url": "https://api.github.com/users/jamborm/events{/privacy}", "received_events_url": "https://api.github.com/users/jamborm/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "665c5bad168ab63629b29ed2ce08ed042c088dc2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/665c5bad168ab63629b29ed2ce08ed042c088dc2", "html_url": "https://github.com/Rust-GCC/gccrs/commit/665c5bad168ab63629b29ed2ce08ed042c088dc2"}], "stats": {"total": 43, "additions": 42, "deletions": 1}, "files": [{"sha": "7ebeaed89e04ab91af4ed5ad607c9046250656c1", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=51faf07cef9293af544bfacc7d0b320ab90d7d60", "patch": "@@ -1,3 +1,9 @@\n+2020-02-19  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/93776\n+\t* tree-sra.c (create_access): Do not create zero size accesses.\n+\t(get_access_for_expr): Do not search for zero sized accesses.\n+\n 2020-02-19  Martin Jambor  <mjambor@suse.cz>\n \n \tPR tree-optimization/93667"}, {"sha": "df79951b6cc2aaad90268df0e1a1b553dceb03f6", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=51faf07cef9293af544bfacc7d0b320ab90d7d60", "patch": "@@ -1,3 +1,8 @@\n+2020-02-19  Martin Jambor  <mjambor@suse.cz>\n+\n+\tPR tree-optimization/93776\n+\t* gcc.dg/tree-ssa/pr93776.c: New test.\n+\n 2020-02-19  Martin Jambor  <mjambor@suse.cz>\n \n \tPR tree-optimization/93667"}, {"sha": "c407a627718ea31e8f86b77ef6fc21886082cebe", "filename": "gcc/testsuite/gcc.dg/tree-ssa/pr93776.c", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr93776.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr93776.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fpr93776.c?ref=51faf07cef9293af544bfacc7d0b320ab90d7d60", "patch": "@@ -0,0 +1,27 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-O1\" } */\n+\n+struct empty {};\n+struct s { int i; };\n+struct z\n+{\n+  int j;\n+  struct empty e;\n+  struct s s;\n+  int k;\n+};\n+\n+void bar (struct z);\n+void baz (int);\n+\n+void foo (void)\n+{\n+  struct z z, z2;\n+\n+  z.k = 8;\n+  z2.s.i = 1;\n+  z = z2;\n+  bar (z);\n+  z.e = (struct empty) {};\n+  baz (z.k);\n+}"}, {"sha": "49f9001f7fb9bd63a4c8be40aaf0f29206bd86e9", "filename": "gcc/tree-sra.c", "status": "modified", "additions": 4, "deletions": 1, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2Ftree-sra.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/51faf07cef9293af544bfacc7d0b320ab90d7d60/gcc%2Ftree-sra.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-sra.c?ref=51faf07cef9293af544bfacc7d0b320ab90d7d60", "patch": "@@ -926,6 +926,8 @@ create_access (tree expr, gimple *stmt, bool write)\n       size = max_size;\n       unscalarizable_region = true;\n     }\n+  if (size == 0)\n+    return NULL;\n   if (size < 0)\n     {\n       disqualify_candidate (base, \"Encountered an unconstrained access.\");\n@@ -3643,7 +3645,8 @@ get_access_for_expr (tree expr)\n \treturn NULL;\n     }\n \n-  if (!bitmap_bit_p (candidate_bitmap, DECL_UID (base)))\n+  if (max_size == 0\n+      || !bitmap_bit_p (candidate_bitmap, DECL_UID (base)))\n     return NULL;\n \n   return get_var_base_offset_size_access (base, offset, max_size);"}]}