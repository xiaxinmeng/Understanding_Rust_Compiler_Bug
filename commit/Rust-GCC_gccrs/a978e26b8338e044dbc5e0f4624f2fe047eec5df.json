{"sha": "a978e26b8338e044dbc5e0f4624f2fe047eec5df", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTk3OGUyNmI4MzM4ZTA0NGRiYzVlMGY0NjI0ZjJmZTA0N2VlYzVkZg==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2017-10-05T16:39:38Z"}, "committer": {"name": "Ian Lance Taylor", "email": "ian@gcc.gnu.org", "date": "2017-10-05T16:39:38Z"}, "message": "elf.c (elf_zlib_fetch): Change pval argument to uint64_t *.\n\n\t* elf.c (elf_zlib_fetch): Change pval argument to uint64_t *.\n\tRead a four byte integer.\n\t(elf_zlib_inflate): Change val to uint64_t.  Align pin to a 32-bit\n\tboundary before ever calling elf_zlib_fetch.\n\t* ztest.c (test_large): Simplify print statements a bit.\n\nFrom-SVN: r253456", "tree": {"sha": "f5418e0ea84da3f0e1ffe0072c8d249b9d0180b3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f5418e0ea84da3f0e1ffe0072c8d249b9d0180b3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a978e26b8338e044dbc5e0f4624f2fe047eec5df", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a978e26b8338e044dbc5e0f4624f2fe047eec5df", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a978e26b8338e044dbc5e0f4624f2fe047eec5df", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a978e26b8338e044dbc5e0f4624f2fe047eec5df/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "8e473f4f441b026599af595bc28125db87410873", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8e473f4f441b026599af595bc28125db87410873", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8e473f4f441b026599af595bc28125db87410873"}], "stats": {"total": 63, "additions": 47, "deletions": 16}, "files": [{"sha": "7aadc7353ef267f70a38912060834da2147217a8", "filename": "libbacktrace/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a978e26b8338e044dbc5e0f4624f2fe047eec5df/libbacktrace%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a978e26b8338e044dbc5e0f4624f2fe047eec5df/libbacktrace%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2FChangeLog?ref=a978e26b8338e044dbc5e0f4624f2fe047eec5df", "patch": "@@ -1,3 +1,11 @@\n+2017-10-05  Ian Lance Taylor  <iant@golang.org>\n+\n+\t* elf.c (elf_zlib_fetch): Change pval argument to uint64_t *.\n+\tRead a four byte integer.\n+\t(elf_zlib_inflate): Change val to uint64_t.  Align pin to a 32-bit\n+\tboundary before ever calling elf_zlib_fetch.\n+\t* ztest.c (test_large): Simplify print statements a bit.\n+\n 2017-10-02  Ian Lance Taylor  <iant@golang.org>\n \n \t* ztest.c: #include <errno.h>."}, {"sha": "06823fcf59b6804961c4d2e64b2e472d693d954b", "filename": "libbacktrace/elf.c", "status": "modified", "additions": 36, "deletions": 13, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a978e26b8338e044dbc5e0f4624f2fe047eec5df/libbacktrace%2Felf.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a978e26b8338e044dbc5e0f4624f2fe047eec5df/libbacktrace%2Felf.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Felf.c?ref=a978e26b8338e044dbc5e0f4624f2fe047eec5df", "patch": "@@ -1031,32 +1031,38 @@ elf_zlib_failed(void)\n \n static int\n elf_zlib_fetch (const unsigned char **ppin, const unsigned char *pinend,\n-\t\tuint32_t *pval, unsigned int *pbits)\n+\t\tuint64_t *pval, unsigned int *pbits)\n {\n   unsigned int bits;\n   const unsigned char *pin;\n-  uint32_t val;\n+  uint64_t val;\n+  uint32_t next;\n \n   bits = *pbits;\n   if (bits >= 15)\n     return 1;\n   pin = *ppin;\n   val = *pval;\n \n-  if (unlikely (pinend - pin < 2))\n+  if (unlikely (pinend - pin < 4))\n     {\n       elf_zlib_failed ();\n       return 0;\n     }\n-  val |= pin[0] << bits;\n-  val |= pin[1] << (bits + 8);\n-  bits += 16;\n-  pin += 2;\n \n-  /* We will need the next two bytes soon.  We ask for high temporal\n-     locality because we will need the whole cache line soon.  */\n-  __builtin_prefetch (pin, 0, 3);\n-  __builtin_prefetch (pin + 1, 0, 3);\n+  /* We've ensured that PIN is aligned.  */\n+  next = *(const uint32_t *)pin;\n+\n+#if __BYTE_ORDER == __ORDER_BIG_ENDIAN\n+  next = __builtin_bswap32 (next);\n+#endif\n+\n+  val |= (uint64_t)next << bits;\n+  bits += 32;\n+  pin += 4;\n+\n+  /* We will need the next four bytes soon.  */\n+  __builtin_prefetch (pin, 0, 0);\n \n   *ppin = pin;\n   *pval = val;\n@@ -1566,7 +1572,7 @@ elf_zlib_inflate (const unsigned char *pin, size_t sin, uint16_t *zdebug_table,\n   poutend = pout + sout;\n   while ((pinend - pin) > 4)\n     {\n-      uint32_t val;\n+      uint64_t val;\n       unsigned int bits;\n       int last;\n \n@@ -1601,10 +1607,19 @@ elf_zlib_inflate (const unsigned char *pin, size_t sin, uint16_t *zdebug_table,\n \t}\n       pin += 2;\n \n-      /* Read blocks until one is marked last.  */\n+      /* Align PIN to a 32-bit boundary.  */\n \n       val = 0;\n       bits = 0;\n+      while ((((uintptr_t) pin) & 3) != 0)\n+\t{\n+\t  val |= (uint64_t)*pin << bits;\n+\t  bits += 8;\n+\t  ++pin;\n+\t}\n+\n+      /* Read blocks until one is marked last.  */\n+\n       last = 0;\n \n       while (!last)\n@@ -1671,6 +1686,14 @@ elf_zlib_inflate (const unsigned char *pin, size_t sin, uint16_t *zdebug_table,\n \t      pout += len;\n \t      pin += len;\n \n+\t      /* Align PIN.  */\n+\t      while ((((uintptr_t) pin) & 3) != 0)\n+\t\t{\n+\t\t  val |= (uint64_t)*pin << bits;\n+\t\t  bits += 8;\n+\t\t  ++pin;\n+\t\t}\n+\n \t      /* Go around to read the next block.  */\n \t      continue;\n \t    }"}, {"sha": "7226d6a0a36ccd812a8e43f6ed9a1ecab99222e0", "filename": "libbacktrace/ztest.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a978e26b8338e044dbc5e0f4624f2fe047eec5df/libbacktrace%2Fztest.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a978e26b8338e044dbc5e0f4624f2fe047eec5df/libbacktrace%2Fztest.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fztest.c?ref=a978e26b8338e044dbc5e0f4624f2fe047eec5df", "patch": "@@ -432,9 +432,9 @@ test_large (struct backtrace_state *state)\n   ctime = average_time (ctimes, trials);\n   ztime = average_time (ztimes, trials);\n \n-  printf (\"backtrace time: %zu ns\\n\", ctime);\n-  printf (\"zlib time:    : %zu ns\\n\", ztime);\n-  printf (\"percentage    : %g\\n\", (double) ztime / (double) ctime);\n+  printf (\"backtrace: %zu ns\\n\", ctime);\n+  printf (\"zlib     : %zu ns\\n\", ztime);\n+  printf (\"ratio    : %g\\n\", (double) ztime / (double) ctime);\n \n   return;\n "}]}