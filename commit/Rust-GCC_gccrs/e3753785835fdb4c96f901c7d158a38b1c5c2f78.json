{"sha": "e3753785835fdb4c96f901c7d158a38b1c5c2f78", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTM3NTM3ODU4MzVmZGI0Yzk2ZjkwMWM3ZDE1OGEzOGIxYzVjMmY3OA==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2013-05-16T10:29:42Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2013-05-16T10:29:42Z"}, "message": "varasm.c (default_use_anchors_for_symbol_p): Use decl_replaceable_p.\n\n\tgcc/\n\t* varasm.c (default_use_anchors_for_symbol_p): Use decl_replaceable_p.\n\n\tgcc/testsuite/\n\t* gcc.dg/visibility-21.c: New.\n\nFrom-SVN: r198965", "tree": {"sha": "99797a98eef64aa5f2258997fd4fc31a3d8d6c1f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/99797a98eef64aa5f2258997fd4fc31a3d8d6c1f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e3753785835fdb4c96f901c7d158a38b1c5c2f78", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3753785835fdb4c96f901c7d158a38b1c5c2f78", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e3753785835fdb4c96f901c7d158a38b1c5c2f78", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e3753785835fdb4c96f901c7d158a38b1c5c2f78/comments", "author": null, "committer": null, "parents": [{"sha": "43bb4dd14d015211a19ccd8c1802cc7e1361d8b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/43bb4dd14d015211a19ccd8c1802cc7e1361d8b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/43bb4dd14d015211a19ccd8c1802cc7e1361d8b7"}], "stats": {"total": 27, "additions": 24, "deletions": 3}, "files": [{"sha": "d6f6e5a23e00cba5c766060950fca3adec3a2754", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e3753785835fdb4c96f901c7d158a38b1c5c2f78", "patch": "@@ -1,3 +1,7 @@\n+2013-05-16  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* varasm.c (default_use_anchors_for_symbol_p): Use decl_replaceable_p.\n+\n 2013-05-16  Marc Glisse  <marc.glisse@inria.fr>\n \n \tPR middle-end/57286"}, {"sha": "7bacbb58eea42f1384e17f06374febd69218fdd4", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e3753785835fdb4c96f901c7d158a38b1c5c2f78", "patch": "@@ -1,3 +1,7 @@\n+2013-05-16  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* gcc.dg/visibility-21.c: New.\n+\n 2013-05-16  Marc Glisse  <marc.glisse@inria.fr>\n \n \tPR middle-end/57286"}, {"sha": "264204e848e445164042952574401f8ac2d7c01c", "filename": "gcc/testsuite/gcc.dg/visibility-21.c", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-21.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-21.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fvisibility-21.c?ref=e3753785835fdb4c96f901c7d158a38b1c5c2f78", "patch": "@@ -0,0 +1,13 @@\n+/* Test visibility attribute on function definition. */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -fsection-anchors\" } */\n+/* { dg-require-visibility \"\" } */\n+/* { dg-require-weak \"\" } */\n+/* { dg-final { scan-assembler-not \"ANCHOR\" } } */\n+\n+int __attribute__((weak, visibility(\"hidden\"))) weak_hidden[3];\n+\n+int *f_weak_hidden ()\n+{\n+  return weak_hidden;\n+}"}, {"sha": "5f62677b2cc79dc8705d0b20eb8be1d2b50a878a", "filename": "gcc/varasm.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2Fvarasm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e3753785835fdb4c96f901c7d158a38b1c5c2f78/gcc%2Fvarasm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvarasm.c?ref=e3753785835fdb4c96f901c7d158a38b1c5c2f78", "patch": "@@ -6580,9 +6580,9 @@ default_use_anchors_for_symbol_p (const_rtx symbol)\n   decl = SYMBOL_REF_DECL (symbol);\n   if (decl && DECL_P (decl))\n     {\n-      /* Don't use section anchors for decls that might be defined by\n-\t other modules.  */\n-      if (!targetm.binds_local_p (decl))\n+      /* Don't use section anchors for decls that might be defined or\n+\t usurped by other modules.  */\n+      if (TREE_PUBLIC (decl) && !decl_binds_to_current_def_p (decl))\n \treturn false;\n \n       /* Don't use section anchors for decls that will be placed in a"}]}