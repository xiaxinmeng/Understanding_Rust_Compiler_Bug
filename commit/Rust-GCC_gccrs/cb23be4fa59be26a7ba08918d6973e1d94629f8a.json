{"sha": "cb23be4fa59be26a7ba08918d6973e1d94629f8a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2IyM2JlNGZhNTliZTI2YTdiYTA4OTE4ZDY5NzNlMWQ5NDYyOWY4YQ==", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-08-13T19:25:59Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2021-08-19T08:38:23Z"}, "message": "testsuite, JIT, Darwin: Adjust asm tests for Mach-O.\n\nThis provides adjusted assembler fragments that are suitable\nfor x86_64 Mach-O.\n\nSigned-off-by: Iain Sandoe <iain@sandoe.co.uk>\n\ngcc/testsuite/ChangeLog:\n\n\t* jit.dg/test-asm.c: Provide Mach-O fragment.\n\t* jit.dg/test-asm.cc: Likewise.", "tree": {"sha": "5db2321d6b41454c56e54ba0e9f01a11950adc16", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5db2321d6b41454c56e54ba0e9f01a11950adc16"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cb23be4fa59be26a7ba08918d6973e1d94629f8a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb23be4fa59be26a7ba08918d6973e1d94629f8a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cb23be4fa59be26a7ba08918d6973e1d94629f8a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cb23be4fa59be26a7ba08918d6973e1d94629f8a/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "4e6a5fa403782590088b2796261b023963f912af", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4e6a5fa403782590088b2796261b023963f912af", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4e6a5fa403782590088b2796261b023963f912af"}], "stats": {"total": 25, "additions": 25, "deletions": 0}, "files": [{"sha": "43255dc75618a1e6c9c9b0666cf0343d9ed2d162", "filename": "gcc/testsuite/jit.dg/test-asm.c", "status": "modified", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb23be4fa59be26a7ba08918d6973e1d94629f8a/gcc%2Ftestsuite%2Fjit.dg%2Ftest-asm.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb23be4fa59be26a7ba08918d6973e1d94629f8a/gcc%2Ftestsuite%2Fjit.dg%2Ftest-asm.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Ftest-asm.c?ref=cb23be4fa59be26a7ba08918d6973e1d94629f8a", "patch": "@@ -438,6 +438,18 @@ verify_code_4 (gcc_jit_context *ctxt, gcc_jit_result *result)\n static void\n create_test_i386_basic_asm_5 (gcc_jit_context *ctxt)\n {\n+#if __APPLE__\n+  /* Darwin's assemblers do not support push/pop section, do not use .type\n+     and external symbols should use __USER_LABEL_PREFIX__.  */\n+  gcc_jit_context_add_top_level_asm (ctxt, NULL,\n+                                     \"\\t.text\\n\"\n+                                     \"\\t.globl _add_asm\\n\"\n+                                     \"_add_asm:\\n\"\n+                                     \"\\tmovq %rdi, %rax\\n\"\n+                                     \"\\tadd %rsi, %rax\\n\"\n+                                     \"\\tret\\n\"\n+                                     \"\\t# some asm here\\n\");\n+#else\n   /* Quote from here in docs/topics/asm.rst: example 5: jit.  */\n   gcc_jit_context_add_top_level_asm (ctxt, NULL,\n                                      \"\\t.pushsection .text\\n\"\n@@ -450,6 +462,7 @@ create_test_i386_basic_asm_5 (gcc_jit_context *ctxt)\n                                      \"\\t# some asm here\\n\"\n                                      \"\\t.popsection\\n\");\n   /* Quote up to here in docs/topics/asm.rst: example 5: jit.  */\n+#endif\n }\n \n static void"}, {"sha": "a3b45dacf07fda8970f09268dc2c5ab81cb16bb2", "filename": "gcc/testsuite/jit.dg/test-asm.cc", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cb23be4fa59be26a7ba08918d6973e1d94629f8a/gcc%2Ftestsuite%2Fjit.dg%2Ftest-asm.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cb23be4fa59be26a7ba08918d6973e1d94629f8a/gcc%2Ftestsuite%2Fjit.dg%2Ftest-asm.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fjit.dg%2Ftest-asm.cc?ref=cb23be4fa59be26a7ba08918d6973e1d94629f8a", "patch": "@@ -400,6 +400,17 @@ static void\n create_test_i386_basic_asm_5 (gcc_jit_context *c_ctxt)\n {\n   gccjit::context ctxt (c_ctxt);\n+#if __APPLE__\n+  /* Darwin's assemblers do not support push/pop section, do not use .type\n+     and external symbols should use __USER_LABEL_PREFIX__.  */\n+  ctxt.add_top_level_asm (\"\\t.text\\n\"\n+                          \"\\t.globl _add_asm\\n\"\n+                          \"_add_asm:\\n\"\n+                          \"\\tmovq %rdi, %rax\\n\"\n+                          \"\\tadd %rsi, %rax\\n\"\n+                          \"\\tret\\n\"\n+                          \"\\t# some asm here\\n\");\n+#else\n   /* Quote from here in docs/cp/topics/asm.rst: example 5: jit.  */\n   ctxt.add_top_level_asm (\"\\t.pushsection .text\\n\"\n                           \"\\t.globl add_asm\\n\"\n@@ -411,6 +422,7 @@ create_test_i386_basic_asm_5 (gcc_jit_context *c_ctxt)\n                           \"\\t# some asm here\\n\"\n                           \"\\t.popsection\\n\");\n   /* Quote up to here in docs/cp/topics/asm.rst: example 5: jit.  */\n+#endif\n }\n \n static void"}]}