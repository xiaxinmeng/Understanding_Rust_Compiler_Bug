{"sha": "dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZGM4Yzc5NzhlMGNhYjQ4MGRlM2Y5MzJkMWNiNzZkN2JmNWU3MjgxNg==", "commit": {"author": {"name": "Tobias Burnus", "email": "burnus@net-b.de", "date": "2011-08-30T22:09:49Z"}, "committer": {"name": "Tobias Burnus", "email": "burnus@gcc.gnu.org", "date": "2011-08-30T22:09:49Z"}, "message": "re PR fortran/45044 (Different named COMMON block size: No warning)\n\n2011-08-30  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/45044\n        * trans-common.c (build_common_decl): Warn if named common\n        block's size is not everywhere the same.\n\n2011-08-30  Tobias Burnus  <burnus@net-b.de>\n\n        PR fortran/45044\n        * gfortran.dg/common_14.f90: New.\n        * gfortran.dg/common_resize_1.f: Add two dg-warning.\n\nFrom-SVN: r178344", "tree": {"sha": "3e7fe5122b787633b75f5d77bf9700191e3e9c7e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3e7fe5122b787633b75f5d77bf9700191e3e9c7e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "html_url": "https://github.com/Rust-GCC/gccrs/commit/dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/comments", "author": {"login": "tob2", "id": 264461, "node_id": "MDQ6VXNlcjI2NDQ2MQ==", "avatar_url": "https://avatars.githubusercontent.com/u/264461?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tob2", "html_url": "https://github.com/tob2", "followers_url": "https://api.github.com/users/tob2/followers", "following_url": "https://api.github.com/users/tob2/following{/other_user}", "gists_url": "https://api.github.com/users/tob2/gists{/gist_id}", "starred_url": "https://api.github.com/users/tob2/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tob2/subscriptions", "organizations_url": "https://api.github.com/users/tob2/orgs", "repos_url": "https://api.github.com/users/tob2/repos", "events_url": "https://api.github.com/users/tob2/events{/privacy}", "received_events_url": "https://api.github.com/users/tob2/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d9cdfea55f31e461e54db7039fbc2281824ef527", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9cdfea55f31e461e54db7039fbc2281824ef527", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9cdfea55f31e461e54db7039fbc2281824ef527"}], "stats": {"total": 63, "additions": 54, "deletions": 9}, "files": [{"sha": "397aa7710402a266f5885f61655a87057ce6077f", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "patch": "@@ -1,3 +1,9 @@\n+2011-08-30  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/45044\n+\t* trans-common.c (build_common_decl): Warn if named common\n+\tblock's size is not everywhere the same.\n+\n 2011-08-30  Steven G. Kargl  <kargl@gcc.gnu.org>\n \n \tPR fortran/45170"}, {"sha": "21237c8d8eca0fbd86b64ea51845ee54bcd09c77", "filename": "gcc/fortran/trans-common.c", "status": "modified", "additions": 13, "deletions": 7, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ffortran%2Ftrans-common.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ffortran%2Ftrans-common.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Ftrans-common.c?ref=dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "patch": "@@ -390,14 +390,20 @@ build_common_decl (gfc_common_head *com, tree union_type, bool is_init)\n   if (decl != NULL_TREE)\n     {\n       tree size = TYPE_SIZE_UNIT (union_type);\n+\n+      /* Named common blocks of the same name shall be of the same size\n+\t in all scoping units of a program in which they appear, but\n+\t blank common blocks may be of different sizes.  */\n+      if (!tree_int_cst_equal (DECL_SIZE_UNIT (decl), size)\n+\t  && strcmp (com->name, BLANK_COMMON_NAME))\n+\tgfc_warning (\"Named COMMON block '%s' at %L shall be of the \"\n+\t\t     \"same size as elsewhere (%lu vs %lu bytes)\", com->name,\n+\t\t     &com->where,\n+\t\t     (unsigned long) TREE_INT_CST_LOW (size),\n+\t\t     (unsigned long) TREE_INT_CST_LOW (DECL_SIZE_UNIT (decl)));\n+\n       if (tree_int_cst_lt (DECL_SIZE_UNIT (decl), size))\n-        {\n-\t  /* Named common blocks of the same name shall be of the same size\n-\t     in all scoping units of a program in which they appear, but\n-\t     blank common blocks may be of different sizes.  */\n-\t  if (strcmp (com->name, BLANK_COMMON_NAME))\n-\t    gfc_warning (\"Named COMMON block '%s' at %L shall be of the \"\n-\t\t\t \"same size\", com->name, &com->where);\n+\t{\n \t  DECL_SIZE (decl) = TYPE_SIZE (union_type);\n \t  DECL_SIZE_UNIT (decl) = size;\n \t  DECL_MODE (decl) = TYPE_MODE (union_type);"}, {"sha": "0c70003705d4250502e9fed2de019c32291231f7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "patch": "@@ -1,3 +1,9 @@\n+2011-08-30  Tobias Burnus  <burnus@net-b.de>\n+\n+\tPR fortran/45044\n+\t* gfortran.dg/common_14.f90: New.\n+\t* gfortran.dg/common_resize_1.f: Add two dg-warning.\n+\n 2011-08-30  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/50084"}, {"sha": "aced168c6550bf632e50264dbf6c487ea5023c19", "filename": "gcc/testsuite/gfortran.dg/common_14.f90", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ftestsuite%2Fgfortran.dg%2Fcommon_14.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ftestsuite%2Fgfortran.dg%2Fcommon_14.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcommon_14.f90?ref=dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "patch": "@@ -0,0 +1,27 @@\n+! { dg-do compile }\n+!\n+! PR fortran/45044\n+!\n+! Named common blocks need to be all of the same size\n+! check that the compiler warns for those.\n+\n+module m\n+  common /xx/ a\n+end module m\n+\n+subroutine two()\n+integer :: a, b, c\n+real(8) :: y\n+common /xx/ a, b, c, y ! { dg-warning \"Named COMMON block 'xx' at \\\\(1\\\\) shall be of the same size as elsewhere \\\\(24 vs 4 bytes\" }\n+end\n+\n+\n+subroutine one()\n+integer :: a, b\n+common /xx/ a, b ! { dg-warning \"Named COMMON block 'xx' at \\\\(1\\\\) shall be of the same size as elsewhere \\\\(8 vs 24 bytes\" }\n+end\n+\n+call two()\n+end\n+\n+! { dg-final { cleanup-modules \"m\" } }"}, {"sha": "ecf692d2d48103a13d6964821b97b2e6161b89c5", "filename": "gcc/testsuite/gfortran.dg/common_resize_1.f", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ftestsuite%2Fgfortran.dg%2Fcommon_resize_1.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/dc8c7978e0cab480de3f932d1cb76d7bf5e72816/gcc%2Ftestsuite%2Fgfortran.dg%2Fcommon_resize_1.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fcommon_resize_1.f?ref=dc8c7978e0cab480de3f932d1cb76d7bf5e72816", "patch": "@@ -13,13 +13,13 @@ subroutine unpki(ixp,nwcon,nmel)\n c\r\n c     unpack connection data\r\n c\r\n-      common/aux32/kka(lnv),kkb(lnv),kkc(lnv),\r\n+      common/aux32/kka(lnv),kkb(lnv),kkc(lnv), ! { dg-warning \"shall be of the same size as elsewhere\" }\r\n      1 kk1(lnv),kk2(lnv),kk3(lnv),dxy(lnv),\r\n      2 dyx(lnv),dyz(lnv),dzy(lnv),dzx(lnv),\r\n      3 dxz(lnv),vx17(lnv),vx28(lnv),vx35(lnv),\r\n      4 vx46(lnv),vy17(lnv),vy28(lnv),\r\n      5 vy35(lnv),vy46(lnv),vz17(lnv),vz28(lnv),vz35(lnv),vz46(lnv)\r\n-      common/aux33/ix1(lnv),ix2(lnv),ix3(lnv),ix4(lnv),ix5(lnv),\r\n+      common/aux33/ix1(lnv),ix2(lnv),ix3(lnv),ix4(lnv),ix5(lnv), ! { dg-warning \"shall be of the same size as elsewhere\" }\r\n      1             ix6(lnv),ix7(lnv),ix8(lnv),mxt(lnv)\r\n       dimension ixp(nwcon,*)\r\n c\r"}]}