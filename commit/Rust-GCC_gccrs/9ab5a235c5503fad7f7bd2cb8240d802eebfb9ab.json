{"sha": "9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWFiNWEyMzVjNTUwM2ZhZDdmN2JkMmNiODI0MGQ4MDJlZWJmYjlhYg==", "commit": {"author": {"name": "Martin Liska", "email": "mliska@suse.cz", "date": "2017-06-13T08:59:28Z"}, "committer": {"name": "Martin Liska", "email": "marxin@gcc.gnu.org", "date": "2017-06-13T08:59:28Z"}, "message": "Enhance dump_probability function.\n\n2017-06-13  Martin Liska  <mliska@suse.cz>\n\n\t* gimple-pretty-print.c (dump_probability): Add new argument.\n\t(dump_edge_probability): Dump both probability and count.\n\t(dump_gimple_label): Likewise.\n\t(dump_gimple_bb_header): Likewise.\n2017-06-13  Martin Liska  <mliska@suse.cz>\n\n\t* gcc.dg/tree-ssa/builtin-sprintf-2.c: Adjust scanned pattern.\n\t* gcc.dg/tree-ssa/dump-2.c: Likewise.\n\t* gcc.dg/tree-ssa/vrp101.c: Likewise.\n\nFrom-SVN: r249147", "tree": {"sha": "e7d1f273e41a5e1a0e04de65ad25463ec9da9c12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e7d1f273e41a5e1a0e04de65ad25463ec9da9c12"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/comments", "author": {"login": "marxin", "id": 2658545, "node_id": "MDQ6VXNlcjI2NTg1NDU=", "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4", "gravatar_id": "", "url": "https://api.github.com/users/marxin", "html_url": "https://github.com/marxin", "followers_url": "https://api.github.com/users/marxin/followers", "following_url": "https://api.github.com/users/marxin/following{/other_user}", "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}", "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/marxin/subscriptions", "organizations_url": "https://api.github.com/users/marxin/orgs", "repos_url": "https://api.github.com/users/marxin/repos", "events_url": "https://api.github.com/users/marxin/events{/privacy}", "received_events_url": "https://api.github.com/users/marxin/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "da8b0b2b258bfc278508dd107daf20c484ade28f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/da8b0b2b258bfc278508dd107daf20c484ade28f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/da8b0b2b258bfc278508dd107daf20c484ade28f"}], "stats": {"total": 43, "additions": 31, "deletions": 12}, "files": [{"sha": "344e5fa43b34a97fc6d160f8fd64e9bb18bf8486", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "patch": "@@ -1,3 +1,10 @@\n+2017-06-13  Martin Liska  <mliska@suse.cz>\n+\n+\t* gimple-pretty-print.c (dump_probability): Add new argument.\n+\t(dump_edge_probability): Dump both probability and count.\n+\t(dump_gimple_label): Likewise.\n+\t(dump_gimple_bb_header): Likewise.\n+\n 2017-06-13  Georg-Johann Lay  <avr@gjlay.de>\n \n \tPR target/81072"}, {"sha": "447921be036f3190a36e6de26540b42bdf2b9d48", "filename": "gcc/gimple-pretty-print.c", "status": "modified", "additions": 14, "deletions": 8, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Fgimple-pretty-print.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Fgimple-pretty-print.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-pretty-print.c?ref=9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "patch": "@@ -80,17 +80,22 @@ debug_gimple_stmt (gimple *gs)\n    by xstrdup_for_dump.  */\n \n static const char *\n-dump_probability (int value)\n+dump_probability (int frequency, profile_count &count)\n {\n   float minimum = 0.01f;\n \n-  gcc_assert (0 <= value && value <= REG_BR_PROB_BASE);\n-  float fvalue = value * 100.0f / REG_BR_PROB_BASE;\n-  if (fvalue < minimum && value > 0)\n+  gcc_assert (0 <= frequency && frequency <= REG_BR_PROB_BASE);\n+  float fvalue = frequency * 100.0f / REG_BR_PROB_BASE;\n+  if (fvalue < minimum && frequency > 0)\n     return \"[0.01%]\";\n \n   char *buf;\n-  asprintf (&buf, \"[%.2f%%]\", fvalue);\n+  if (count.initialized_p ())\n+    asprintf (&buf, \"[%.2f%%] [count: %\" PRId64 \"]\", fvalue,\n+\t      count.to_gcov_type ());\n+  else\n+    asprintf (&buf, \"[%.2f%%] [count: INV]\", fvalue);\n+\n   const char *ret = xstrdup_for_dump (buf);\n   free (buf);\n \n@@ -102,7 +107,7 @@ dump_probability (int value)\n static void\n dump_edge_probability (pretty_printer *buffer, edge e)\n {\n-  pp_scalar (buffer, \" %s\", dump_probability (e->probability));\n+  pp_scalar (buffer, \" %s\", dump_probability (e->probability, e->count));\n }\n \n /* Print GIMPLE statement G to FILE using SPC indentation spaces and\n@@ -1085,7 +1090,7 @@ dump_gimple_label (pretty_printer *buffer, glabel *gs, int spc,\n       dump_generic_node (buffer, label, spc, flags, false);\n       basic_block bb = gimple_bb (gs);\n       if (bb && !(flags & TDF_GIMPLE))\n-\tpp_scalar (buffer, \" %s\", dump_probability (bb->frequency));\n+\tpp_scalar (buffer, \" %s\", dump_probability (bb->frequency, bb->count));\n       pp_colon (buffer);\n     }\n   if (flags & TDF_GIMPLE)\n@@ -2665,7 +2670,8 @@ dump_gimple_bb_header (FILE *outf, basic_block bb, int indent,\n \t    fprintf (outf, \"%*sbb_%d:\\n\", indent, \"\", bb->index);\n \t  else\n \t    fprintf (outf, \"%*s<bb %d> %s:\\n\",\n-\t\t     indent, \"\", bb->index, dump_probability (bb->frequency));\n+\t\t     indent, \"\", bb->index, dump_probability (bb->frequency,\n+\t\t\t\t\t\t\t      bb->count));\n \t}\n     }\n }"}, {"sha": "37ea126831294f0d5b797550828775b5300bc01e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "patch": "@@ -1,3 +1,9 @@\n+2017-06-13  Martin Liska  <mliska@suse.cz>\n+\n+\t* gcc.dg/tree-ssa/builtin-sprintf-2.c: Adjust scanned pattern.\n+\t* gcc.dg/tree-ssa/dump-2.c: Likewise.\n+\t* gcc.dg/tree-ssa/vrp101.c: Likewise.\n+\n 2017-06-13  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/81065"}, {"sha": "e15d88b7341df201e8b80f8a6c0251a5d021c035", "filename": "gcc/testsuite/gcc.dg/tree-ssa/builtin-sprintf-2.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fbuiltin-sprintf-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fbuiltin-sprintf-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fbuiltin-sprintf-2.c?ref=9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "patch": "@@ -290,7 +290,7 @@ RNG (0,  6,   8, \"%s%ls\", \"1\", L\"2\");\n \n /*  Only conditional calls to must_not_eliminate must be made (with\n     any probability):\n-    { dg-final { scan-tree-dump-times \"> \\\\\\[\\[0-9.\\]+%\\\\\\]:\\n *must_not_eliminate\" 127 \"optimized\" { target { ilp32 || lp64 } } } }\n-    { dg-final { scan-tree-dump-times \"> \\\\\\[\\[0-9.\\]+%\\\\\\]:\\n *must_not_eliminate\" 96 \"optimized\" { target { { ! ilp32 } && { ! lp64 } } } } }\n+    { dg-final { scan-tree-dump-times \"> \\\\\\[\\[0-9.\\]+%\\\\\\]\\\\ \\\\\\[count:\\\\[^:\\\\]*\\\\\\]:\\n *must_not_eliminate\" 127 \"optimized\" { target { ilp32 || lp64 } } } }\n+    { dg-final { scan-tree-dump-times \"> \\\\\\[\\[0-9.\\]+%\\\\\\]\\\\ \\\\\\[count:\\\\[^:\\\\]*\\\\\\]:\\n *must_not_eliminate\" 96 \"optimized\" { target { { ! ilp32 } && { ! lp64 } } } } }\n     No unconditional calls to abort should be made:\n     { dg-final { scan-tree-dump-not \";\\n *must_not_eliminate\" \"optimized\" } } */"}, {"sha": "6ae2ef5bf3950b7b233314b7fa7dc33adb25396c", "filename": "gcc/testsuite/gcc.dg/tree-ssa/dump-2.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fdump-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fdump-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fdump-2.c?ref=9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "patch": "@@ -6,4 +6,4 @@ int f(void)\n   return 0;\n }\n \n-/* { dg-final { scan-tree-dump \"<bb \\[0-9\\]> \\\\\\[100\\\\\\.00%\\\\\\]:\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump \"<bb \\[0-9\\]> \\\\\\[100\\\\\\.00%\\\\\\] \\\\\\[count: INV\\\\\\]:\" \"optimized\" } } */"}, {"sha": "e7cad2897632b6a9cc2446f01b985dd09ee83360", "filename": "gcc/testsuite/gcc.dg/tree-ssa/vrp101.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fvrp101.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fvrp101.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fvrp101.c?ref=9ab5a235c5503fad7f7bd2cb8240d802eebfb9ab", "patch": "@@ -10,4 +10,4 @@ int main ()\n   return 0;\n }\n \n-/* { dg-final { scan-tree-dump \"<bb 2> \\\\\\[\\[0-9.\\]+%\\\\\\]:\\[\\n\\r \\]*return 0;\" \"optimized\" } } */\n+/* { dg-final { scan-tree-dump \"<bb 2> \\\\\\[\\[0-9.\\]+%\\\\\\] \\\\\\[count: \\\\[^:\\\\]*\\\\\\]:\\[\\n\\r \\]*return 0;\" \"optimized\" } } */"}]}