{"sha": "88de755d13ad0360efb041a1ddbefdde04f2b6a8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODhkZTc1NWQxM2FkMDM2MGVmYjA0MWExZGRiZWZkZGUwNGYyYjZhOA==", "commit": {"author": {"name": "Vincent Celier", "email": "celier@adacore.com", "date": "2014-01-29T15:35:09Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2014-01-29T15:35:09Z"}, "message": "prj-part.adb (Check_Import_Aggregate): New procedure to check if an imported project is an aggregate project.\n\n2014-01-29  Vincent Celier  <celier@adacore.com>\n\n\t* prj-part.adb (Check_Import_Aggregate): New procedure\n\tto check if an imported project is an aggregate project.\n\t(Parse_Single_Project): Call Check_Import_Aggregate\n\t* projects.texi: Document that aggregate projects cannot be\n\textended or imported.\n\nFrom-SVN: r207254", "tree": {"sha": "74e4a73f9c34be5b1b48b310b2273390b65b3d2c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74e4a73f9c34be5b1b48b310b2273390b65b3d2c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/88de755d13ad0360efb041a1ddbefdde04f2b6a8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88de755d13ad0360efb041a1ddbefdde04f2b6a8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/88de755d13ad0360efb041a1ddbefdde04f2b6a8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/88de755d13ad0360efb041a1ddbefdde04f2b6a8/comments", "author": {"login": "vcelier", "id": 8888056, "node_id": "MDQ6VXNlcjg4ODgwNTY=", "avatar_url": "https://avatars.githubusercontent.com/u/8888056?v=4", "gravatar_id": "", "url": "https://api.github.com/users/vcelier", "html_url": "https://github.com/vcelier", "followers_url": "https://api.github.com/users/vcelier/followers", "following_url": "https://api.github.com/users/vcelier/following{/other_user}", "gists_url": "https://api.github.com/users/vcelier/gists{/gist_id}", "starred_url": "https://api.github.com/users/vcelier/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/vcelier/subscriptions", "organizations_url": "https://api.github.com/users/vcelier/orgs", "repos_url": "https://api.github.com/users/vcelier/repos", "events_url": "https://api.github.com/users/vcelier/events{/privacy}", "received_events_url": "https://api.github.com/users/vcelier/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d0e6940256a41b142fc109acebeb3dd6284a700c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d0e6940256a41b142fc109acebeb3dd6284a700c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d0e6940256a41b142fc109acebeb3dd6284a700c"}], "stats": {"total": 72, "additions": 61, "deletions": 11}, "files": [{"sha": "24d4801f8568a8886c177015901dfefdb0c33415", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88de755d13ad0360efb041a1ddbefdde04f2b6a8/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88de755d13ad0360efb041a1ddbefdde04f2b6a8/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=88de755d13ad0360efb041a1ddbefdde04f2b6a8", "patch": "@@ -1,3 +1,11 @@\n+2014-01-29  Vincent Celier  <celier@adacore.com>\n+\n+\t* prj-part.adb (Check_Import_Aggregate): New procedure\n+\tto check if an imported project is an aggregate project.\n+\t(Parse_Single_Project): Call Check_Import_Aggregate\n+\t* projects.texi: Document that aggregate projects cannot be\n+\textended or imported.\n+\n 2014-01-29  Robert Dewar  <dewar@adacore.com>\n \n \t* exp_ch9.adb, sem_ch7.ads, s-regexp.adb, sem_ch13.adb: Minor"}, {"sha": "53847350ed193a0defe718596289279b9499579d", "filename": "gcc/ada/prj-part.adb", "status": "modified", "additions": 37, "deletions": 0, "changes": 37, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88de755d13ad0360efb041a1ddbefdde04f2b6a8/gcc%2Fada%2Fprj-part.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88de755d13ad0360efb041a1ddbefdde04f2b6a8/gcc%2Fada%2Fprj-part.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprj-part.adb?ref=88de755d13ad0360efb041a1ddbefdde04f2b6a8", "patch": "@@ -151,6 +151,13 @@ package body Prj.Part is\n       Project : Project_Node_Id);\n    --  Check that an aggregate project only imports abstract projects\n \n+   procedure Check_Import_Aggregate\n+     (Flags   : Processing_Flags;\n+      In_Tree : Project_Node_Tree_Ref;\n+      Project : Project_Node_Id);\n+   --  Check that a non aggregate project does not import any aggregate\n+   --  project.\n+\n    procedure Create_Virtual_Extending_Project\n      (For_Project     : Project_Node_Id;\n       Main_Project    : Project_Node_Id;\n@@ -1100,6 +1107,35 @@ package body Prj.Part is\n       end if;\n    end Check_Aggregate_Imports;\n \n+   ----------------------------\n+   -- Check_Import_Aggregate --\n+   ----------------------------\n+\n+   procedure Check_Import_Aggregate\n+     (Flags   : Processing_Flags;\n+      In_Tree : Project_Node_Tree_Ref;\n+      Project : Project_Node_Id)\n+   is\n+      With_Clause, Imported : Project_Node_Id;\n+   begin\n+      if Project_Qualifier_Of (Project, In_Tree) /= Aggregate then\n+         With_Clause := First_With_Clause_Of (Project, In_Tree);\n+\n+         while Present (With_Clause) loop\n+            Imported := Project_Node_Of (With_Clause, In_Tree);\n+\n+            if Project_Qualifier_Of (Imported, In_Tree) = Aggregate then\n+               Error_Msg_Name_1 := Name_Id (Path_Name_Of (Imported, In_Tree));\n+               Error_Msg (Flags, \"cannot import aggregate project %%\",\n+                          Token_Ptr);\n+               exit;\n+            end if;\n+\n+            With_Clause := Next_With_Clause_Of (With_Clause, In_Tree);\n+         end loop;\n+      end if;\n+   end Check_Import_Aggregate;\n+\n    ----------------------------\n    -- Read_Project_Qualifier --\n    ----------------------------\n@@ -1767,6 +1803,7 @@ package body Prj.Part is\n \n       Check_Extending_All_Imports (Env.Flags, In_Tree, Project);\n       Check_Aggregate_Imports (Env.Flags, In_Tree, Project);\n+      Check_Import_Aggregate (Env.Flags, In_Tree, Project);\n \n       --  Check that a project with a name including a dot either imports\n       --  or extends the project whose name precedes the last dot."}, {"sha": "e0ef989590413cc9240ce598508de83e7a7194b2", "filename": "gcc/ada/projects.texi", "status": "modified", "additions": 16, "deletions": 11, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/88de755d13ad0360efb041a1ddbefdde04f2b6a8/gcc%2Fada%2Fprojects.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/88de755d13ad0360efb041a1ddbefdde04f2b6a8/gcc%2Fada%2Fprojects.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fprojects.texi?ref=88de755d13ad0360efb041a1ddbefdde04f2b6a8", "patch": "@@ -2474,8 +2474,8 @@ so that all files are searched for only once on the disk\n (thus reducing the number of system calls and contributing to faster\n compilation times especially on systems with sources on remote\n servers). As part of the loading, @command{gprbuild}\n-computes how and where a source file should be compiled, and even if it is found\n-several times in the aggregated projects it will be compiled only\n+computes how and where a source file should be compiled, and even if it is\n+found several times in the aggregated projects it will be compiled only\n once.\n \n Since there is no ambiguity as to which switches should be used, files\n@@ -2494,9 +2494,10 @@ recommended extension is still @file{.gpr}. However, a special\n @code{project}.\n \n An aggregate project cannot @code{with} any other project (standard or\n-aggregate), except an abstract project which can be used to share\n-attribute values. Building other aggregate projects from an aggregate\n-project is done through the Project_Files attribute (see below).\n+aggregate), except an abstract project which can be used to share attribute\n+values. Also, aggregate projects cannot be extended or imported though a\n+@code{with} clause by any other project. Building other aggregate projects from\n+an aggregate project is done through the Project_Files attribute (see below).\n \n An aggregate project does not have any source files directly (only\n through other standard projects). Therefore a number of the standard\n@@ -2548,11 +2549,13 @@ attribute nor the @code{Library_*} attributes, and the result will be to\n build all their source files (not just the ones needed by other\n projects).\n \n-The file can include paths (absolute or relative). Paths are\n-relative to the location of the aggregate project file itself (if\n-you use a base name, we expect to find the .gpr file in the same\n-directory as the aggregate project file). The extension @file{.gpr} is\n-mandatory, since this attribute contains file names, not project names.\n+The file can include paths (absolute or relative). Paths are relative to\n+the location of the aggregate project file itself (if you use a base name,\n+we expect to find the .gpr file in the same directory as the aggregate\n+project file). The environment variables @code{ADA_PROJECT_PATH},\n+@code{GPR_PROJECT_PATH} and @code{GPR_PROJECT_PATH_FILE} are not used to find\n+the project files. The extension @file{.gpr} is mandatory, since this attribute\n+contains file names, not project names.\n \n Paths can also include the @code{\"*\"} and @code{\"**\"} globbing patterns. The\n latter indicates that any subdirectory (recursively) will be\n@@ -2936,7 +2939,9 @@ The only package that is authorized (albeit optional) is Builder.\n \n The Project_Files attribute (See @pxref{Aggregate Projects}) is used to\n described the aggregated projects whose object files have to be\n-included into the aggregate library.\n+included into the aggregate library. The environment variables\n+@code{ADA_PROJECT_PATH}, @code{GPR_PROJECT_PATH} and\n+@code{GPR_PROJECT_PATH_FILE} are not used to find the project files.\n \n @c ---------------------------------------------\n @node Project File Reference"}]}