{"sha": "8bf872f9e802229ec2def801b4b1d53ffc149c35", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OGJmODcyZjllODAyMjI5ZWMyZGVmODAxYjRiMWQ1M2ZmYzE0OWMzNQ==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2011-03-18T23:26:16Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2011-03-18T23:26:16Z"}, "message": "c-decl.c (diagnose_mismatched_decls): Give an error for redefining a typedef with variably modified type.\n\n\t* c-decl.c (diagnose_mismatched_decls): Give an error for\n\tredefining a typedef with variably modified type.\n\ntestsuite:\n\t* gcc.dg/c1x-typedef-1.c: Expect errors for redefinitions of\n\tvariably modified typedefs.\n\t* gcc.dg/c1x-typedef-2.c: Remove.\n\nFrom-SVN: r171172", "tree": {"sha": "4c5bb74e8984d1dc6006840491fe25e44dbdb0e8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/4c5bb74e8984d1dc6006840491fe25e44dbdb0e8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/8bf872f9e802229ec2def801b4b1d53ffc149c35", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bf872f9e802229ec2def801b4b1d53ffc149c35", "html_url": "https://github.com/Rust-GCC/gccrs/commit/8bf872f9e802229ec2def801b4b1d53ffc149c35", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/8bf872f9e802229ec2def801b4b1d53ffc149c35/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "ff8e21599213bbea6ccacecf2522ad19836c8fd1", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ff8e21599213bbea6ccacecf2522ad19836c8fd1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ff8e21599213bbea6ccacecf2522ad19836c8fd1"}], "stats": {"total": 55, "additions": 23, "deletions": 32}, "files": [{"sha": "7c2b4d73711ada60d7b8ab885da8f45e725f693f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=8bf872f9e802229ec2def801b4b1d53ffc149c35", "patch": "@@ -1,3 +1,8 @@\n+2011-03-18  Joseph Myers  <joseph@codesourcery.com>\n+\n+\t* c-decl.c (diagnose_mismatched_decls): Give an error for\n+\tredefining a typedef with variably modified type.\n+\n 2011-03-18  Joseph Myers  <joseph@codesourcery.com>\n \n \t* c-decl.c (grokfield): Don't allow typedefs for structures or"}, {"sha": "4e82f2844a8155c39cea36321510e54e06cf042f", "filename": "gcc/c-decl.c", "status": "modified", "additions": 6, "deletions": 10, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=8bf872f9e802229ec2def801b4b1d53ffc149c35", "patch": "@@ -1813,20 +1813,16 @@ diagnose_mismatched_decls (tree newdecl, tree olddecl,\n \t  || TREE_NO_WARNING (olddecl))\n \treturn true;  /* Allow OLDDECL to continue in use.  */\n \n-      if (pedantic && !flag_isoc1x)\n+      if (variably_modified_type_p (newtype, NULL))\n \t{\n-\t  pedwarn (input_location, OPT_pedantic,\n-\t\t   \"redefinition of typedef %q+D\", newdecl);\n+\t  error (\"redefinition of typedef %q+D with variably modified type\",\n+\t\t newdecl);\n \t  locate_old_decl (olddecl);\n \t}\n-      else if (variably_modified_type_p (newtype, NULL))\n+      else if (pedantic && !flag_isoc1x)\n \t{\n-\t  /* Whether there is a constraint violation for the types not\n-\t     being the same cannot be determined at compile time; a\n-\t     warning that there may be one at runtime is considered\n-\t     appropriate (WG14 reflector message 11743, 8 May 2009).  */\n-\t  warning (0, \"redefinition of typedef %q+D may be a constraint \"\n-\t\t   \"violation at runtime\", newdecl);\n+\t  pedwarn (input_location, OPT_pedantic,\n+\t\t   \"redefinition of typedef %q+D\", newdecl);\n \t  locate_old_decl (olddecl);\n \t}\n "}, {"sha": "1a30a107a745d30d9f7ddc9687347e659be663b1", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=8bf872f9e802229ec2def801b4b1d53ffc149c35", "patch": "@@ -1,3 +1,9 @@\n+2011-03-18  Joseph Myers  <joseph@codesourcery.com>\n+\n+\t* gcc.dg/c1x-typedef-1.c: Expect errors for redefinitions of\n+\tvariably modified typedefs.\n+\t* gcc.dg/c1x-typedef-2.c: Remove.\n+\n 2011-03-18  Joseph Myers  <joseph@codesourcery.com>\n \n \t* gcc.dg/c1x-anon-struct-1.c: Don't test use of typedefs."}, {"sha": "a68b23ff5e6c4347cc5d7257d9747f2bb6ac4f5b", "filename": "gcc/testsuite/gcc.dg/c1x-typedef-1.c", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2Ftestsuite%2Fgcc.dg%2Fc1x-typedef-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/8bf872f9e802229ec2def801b4b1d53ffc149c35/gcc%2Ftestsuite%2Fgcc.dg%2Fc1x-typedef-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc1x-typedef-1.c?ref=8bf872f9e802229ec2def801b4b1d53ffc149c35", "patch": "@@ -3,7 +3,8 @@\n /* { dg-options \"-std=c1x -pedantic-errors\" } */\n \n /* C1X permits typedefs to be redeclared to the same type, but not to\n-   different-but-compatible types.  */\n+   different-but-compatible types, and not when the type is variably\n+   modified.  */\n \n #include <limits.h>\n \n@@ -60,9 +61,10 @@ f (void)\n   typedef void FN2(int (*p)[*]); /* { dg-message \"previous declaration\" } */\n   typedef void FN2(int (*p)[]); /* { dg-error \"with different type\" } */\n   typedef int AV[a]; /* { dg-message \"previous declaration\" } */\n-  typedef int AV[b-1]; /* { dg-warning \"may be a constraint violation at runtime\" } */\n-  typedef int AAa[a];\n+  typedef int AV[b-1]; /* { dg-error \"redefinition\" } */\n+  typedef int AAa[a]; /* { dg-message \"previous declaration\" } */\n   typedef int AAb[b-1];\n   typedef AAa *VF(void); /* { dg-message \"previous declaration\" } */\n-  typedef AAb *VF(void); /* { dg-warning \"may be a constraint violation at runtime\" } */\n+  typedef AAb *VF(void); /* { dg-error \"redefinition\" } */\n+  typedef AAa AAa; /* { dg-error \"redefinition\" } */\n }"}, {"sha": "fb5d918a5d38ba8d38e8e5966dd44360acfed35e", "filename": "gcc/testsuite/gcc.dg/c1x-typedef-2.c", "status": "removed", "additions": 0, "deletions": 18, "changes": 18, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ff8e21599213bbea6ccacecf2522ad19836c8fd1/gcc%2Ftestsuite%2Fgcc.dg%2Fc1x-typedef-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ff8e21599213bbea6ccacecf2522ad19836c8fd1/gcc%2Ftestsuite%2Fgcc.dg%2Fc1x-typedef-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fc1x-typedef-2.c?ref=ff8e21599213bbea6ccacecf2522ad19836c8fd1", "patch": "@@ -1,18 +0,0 @@\n-/* Test typedef redeclaration in C1X.  Side effects from duplicate\n-   declarations still apply.  */\n-/* { dg-do run } */\n-/* { dg-options \"-std=c1x -pedantic-errors\" } */\n-\n-extern void exit (int);\n-extern void abort (void);\n-\n-int\n-main (void)\n-{\n-  int a = 1, b = 1;\n-  typedef int T[++a]; /* { dg-message \"previous declaration\" } */\n-  typedef int T[++b]; /* { dg-warning \"may be a constraint violation at runtime\" } */\n-  if (a != 2 || b != 2)\n-    abort ();\n-  exit (0);\n-}"}]}