{"sha": "d6cf3187658e1ba6db2a2502e8715dfbbf93d40b", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDZjZjMxODc2NThlMWJhNmRiMmEyNTAyZTg3MTVkZmJiZjkzZDQwYg==", "commit": {"author": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-07-26T20:58:04Z"}, "committer": {"name": "Richard Stallman", "email": "rms@gnu.org", "date": "1993-07-26T20:58:04Z"}, "message": "(NAME__MAIN, SYMBOL__MAIN): Add default definitions.\n\n(write_c_file, scan_prog_file(OSF/ROSE)): Use them instead of explicit\n__main.\n\nFrom-SVN: r4990", "tree": {"sha": "9dfa6d4dde8dcabcf8674f565db8213a6cc62f66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9dfa6d4dde8dcabcf8674f565db8213a6cc62f66"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d6cf3187658e1ba6db2a2502e8715dfbbf93d40b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6cf3187658e1ba6db2a2502e8715dfbbf93d40b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6cf3187658e1ba6db2a2502e8715dfbbf93d40b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6cf3187658e1ba6db2a2502e8715dfbbf93d40b/comments", "author": null, "committer": null, "parents": [{"sha": "d3984356259c6f6cf2f590da378b0d227cfcf29a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d3984356259c6f6cf2f590da378b0d227cfcf29a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d3984356259c6f6cf2f590da378b0d227cfcf29a"}], "stats": {"total": 24, "additions": 18, "deletions": 6}, "files": [{"sha": "83821dc2915b6132a42dc476cf47c80f65e6d967", "filename": "gcc/collect2.c", "status": "modified", "additions": 18, "deletions": 6, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d6cf3187658e1ba6db2a2502e8715dfbbf93d40b/gcc%2Fcollect2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d6cf3187658e1ba6db2a2502e8715dfbbf93d40b/gcc%2Fcollect2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcollect2.c?ref=d6cf3187658e1ba6db2a2502e8715dfbbf93d40b", "patch": "@@ -149,6 +149,16 @@ extern int errno;\n #endif\n \n #endif /* OBJECT_FORMAT_NONE */\n+\n+/* Some systems use __main in a way incompatible with its use in gcc, in these\n+   cases use the macros NAME__MAIN to give a quoted symbol and SYMBOL__MAIN to\n+   give the same symbol without quotes for an alternative entry point.  You\n+   must define both, or niether. */\n+#ifndef NAME__MAIN\n+#define NAME__MAIN \"__main\"\n+#define SYMBOL__MAIN __main\n+#endif\n+\n \f\n /* Linked lists of constructor and destructor names. */\n \n@@ -1297,8 +1307,8 @@ write_c_file (stream, name)\n   write_list (stream, \"\\t\", destructors.first);\n   fprintf (stream, \"\\t0\\n};\\n\\n\");\n \n-  fprintf (stream, \"extern entry_pt __main;\\n\");\n-  fprintf (stream, \"entry_pt *__main_reference = __main;\\n\\n\");\n+  fprintf (stream, \"extern entry_pt %s;\\n\", NAME__MAIN);\n+  fprintf (stream, \"entry_pt *__main_reference = %s;\\n\\n\", NAME__MAIN);\n }\n \n \f\n@@ -1790,11 +1800,13 @@ scan_prog_file (prog_name, which_pass)\n \n \t      if (rw)\n \t\t{\n-\t\t  char *n = name;\n-\t\t  while (*n == '_')\n-\t\t    ++n;\n-\t\t  if (*n != 'm' || (n - name) < 2 || strcmp (n, \"main\"))\n+\t\t  char *n = name + strlen (name) - strlen (NAME__MAIN);\n+\n+\t\t  if ((n - name) < 0 || strcmp (n, NAME__MAIN))\n \t\t    continue;\n+\t\t  while (n != name)\n+\t\t    if (*--n != '_')\n+\t\t      continue;\n \n \t\t  main_sym = sym;\n \t\t}"}]}