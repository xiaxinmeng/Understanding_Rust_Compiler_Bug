{"sha": "4413365616e8c6024d1ff4e23309e5012ee33b9f", "node_id": "C_kwDOANBUbNoAKDQ0MTMzNjU2MTZlOGM2MDI0ZDFmZjRlMjMzMDllNTAxMmVlMzNiOWY", "commit": {"author": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2023-01-04T21:03:24Z"}, "committer": {"name": "Iain Sandoe", "email": "iain@sandoe.co.uk", "date": "2023-01-05T16:55:30Z"}, "message": "modula-2: Remove uses of scalb*() and significand*() [PR107631]\n\nThe scalb*() functions are obsolete in Posix from 2004 and removed in\n2008.\n\nThe significand*() functions are glibc-only and considered there to be\nobsolescent (not supported for types such as _Float128).\n\nWe can remove them from Modula-2 since they are not required for ISO\nsupport, but we need to provide an implementation of significand* for\nthe \"fraction()\" functions.\n\n\tPR modula2/107631\n\ngcc/m2/ChangeLog:\n\n\t* gm2-gcc/m2builtins.cc: Remove scalb, scalbf, scalbl,\n\tsignificand, significandf, significandl.\n\t* gm2-libs/Builtins.def (significand): Likewise.\n\t* gm2-libs/Builtins.mod: Likewise.\n\t* target-independent/Builtins.texi: Likewise.\n\t* gm2-libs-iso/LowLong.mod: Implement fraction with scalbn*() and\n\tilogb*().\n\t* gm2-libs-iso/LowReal.mod: Likewise.\n\t* gm2-libs-iso/LowShort.mod: Likewise.", "tree": {"sha": "7a78aa715239f0da417222414d4c2238553e9980", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7a78aa715239f0da417222414d4c2238553e9980"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/4413365616e8c6024d1ff4e23309e5012ee33b9f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4413365616e8c6024d1ff4e23309e5012ee33b9f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/4413365616e8c6024d1ff4e23309e5012ee33b9f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/4413365616e8c6024d1ff4e23309e5012ee33b9f/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "80ff207da6d8784e227eb93f75c4ac5a300c8420", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/80ff207da6d8784e227eb93f75c4ac5a300c8420", "html_url": "https://github.com/Rust-GCC/gccrs/commit/80ff207da6d8784e227eb93f75c4ac5a300c8420"}], "stats": {"total": 77, "additions": 6, "deletions": 71}, "files": [{"sha": "35901a200037f3b9874bdad591e502aca823e3cc", "filename": "gcc/m2/gm2-gcc/m2builtins.cc", "status": "modified", "additions": 0, "deletions": 12, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-gcc%2Fm2builtins.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-gcc%2Fm2builtins.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-gcc%2Fm2builtins.cc?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -192,12 +192,6 @@ static struct builtin_function_entry list_of_builtins[] = {\n     \"signbitf\", NULL, NULL },\n   { \"__builtin_signbitl\", BT_FN_INT_LONG_DOUBLE, BUILT_IN_SIGNBITL,\n     BUILT_IN_NORMAL, \"signbitl\", NULL, NULL },\n-  { \"__builtin_significand\", BT_FN_DOUBLE_DOUBLE, BUILT_IN_SIGNIFICAND,\n-    BUILT_IN_NORMAL, \"significand\", NULL, NULL },\n-  { \"__builtin_significandf\", BT_FN_FLOAT_FLOAT, BUILT_IN_SIGNIFICANDF,\n-    BUILT_IN_NORMAL, \"significandf\", NULL, NULL },\n-  { \"__builtin_significandl\", BT_FN_LONG_DOUBLE_LONG_DOUBLE,\n-    BUILT_IN_SIGNIFICANDL, BUILT_IN_NORMAL, \"significandl\", NULL, NULL },\n   { \"__builtin_modf\", BT_FN_DOUBLE_DOUBLE_DOUBLEPTR, BUILT_IN_MODF,\n     BUILT_IN_NORMAL, \"modf\", NULL, NULL },\n   { \"__builtin_modff\", BT_FN_FLOAT_FLOAT_FLOATPTR, BUILT_IN_MODFF,\n@@ -216,12 +210,6 @@ static struct builtin_function_entry list_of_builtins[] = {\n     BUILT_IN_NEXTTOWARDF, BUILT_IN_NORMAL, \"nexttowardf\", NULL, NULL },\n   { \"__builtin_nexttowardl\", BT_FN_LONG_DOUBLE_LONG_DOUBLE_LONG_DOUBLE,\n     BUILT_IN_NEXTTOWARDL, BUILT_IN_NORMAL, \"nexttowardl\", NULL, NULL },\n-  { \"__builtin_scalb\", BT_FN_DOUBLE_DOUBLE_DOUBLE, BUILT_IN_SCALB,\n-    BUILT_IN_NORMAL, \"scalb\", NULL, NULL },\n-  { \"__builtin_scalbf\", BT_FN_FLOAT_FLOAT_FLOAT, BUILT_IN_SCALBF,\n-    BUILT_IN_NORMAL, \"scalbf\", NULL, NULL },\n-  { \"__builtin_scalbl\", BT_FN_LONG_DOUBLE_LONG_DOUBLE_LONG_DOUBLE,\n-    BUILT_IN_SCALBL, BUILT_IN_NORMAL, \"scalbl\", NULL, NULL },\n   { \"__builtin_scalbln\", BT_FN_DOUBLE_DOUBLE_LONG, BUILT_IN_SCALBLN,\n     BUILT_IN_NORMAL, \"scalbln\", NULL, NULL },\n   { \"__builtin_scalblnf\", BT_FN_FLOAT_FLOAT_LONG, BUILT_IN_SCALBLNF,"}, {"sha": "9842679d1eda8d053682eea2472a26d37af0fbee", "filename": "gcc/m2/gm2-libs-iso/LowLong.mod", "status": "modified", "additions": 2, "deletions": 3, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs-iso%2FLowLong.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs-iso%2FLowLong.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs-iso%2FLowLong.mod?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -27,7 +27,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n IMPLEMENTATION MODULE LowLong ;\n \n FROM SYSTEM IMPORT ADDRESS ;\n-FROM Builtins IMPORT ilogbl, significandl, modfl, signbitl, scalbnl, huge_vall, nextafterl ;\n+FROM Builtins IMPORT ilogbl, modfl, signbitl, scalbnl, huge_vall, nextafterl ;\n FROM dtoa IMPORT Mode, strtod, dtoa ;\n FROM libc IMPORT free ;\n FROM RealMath IMPORT power ;\n@@ -64,10 +64,9 @@ END exponent ;\n \n PROCEDURE fraction (x: LONGREAL) : LONGREAL ;\n BEGIN\n-   RETURN significandl(x)\n+   RETURN scalbnl(x, -ilogbl (x))\n END fraction ;\n \n-\n (*\n    sign - returns the signum of x.  sign(x) = 1.0  for all x>0.0\n           sign(x) = -1.0  for all x<0.0."}, {"sha": "7db6ff0472aaceeb7217e1ed0ffaf6fa5c26a9f8", "filename": "gcc/m2/gm2-libs-iso/LowReal.mod", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs-iso%2FLowReal.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs-iso%2FLowReal.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs-iso%2FLowReal.mod?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -27,7 +27,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n IMPLEMENTATION MODULE LowReal ;\n \n FROM SYSTEM IMPORT ADDRESS ;\n-FROM Builtins IMPORT ilogb, significand, modf, signbit, scalbn, huge_val, nextafter ;\n+FROM Builtins IMPORT ilogb, modf, signbit, scalbn, huge_val, nextafter ;\n FROM dtoa IMPORT Mode, strtod, dtoa ;\n FROM libc IMPORT free ;\n FROM RealMath IMPORT power ;\n@@ -64,7 +64,7 @@ END exponent ;\n \n PROCEDURE fraction (x: REAL) : REAL ;\n BEGIN\n-   RETURN significand(x)\n+   RETURN scalbn (x, -ilogb (x))\n END fraction ;\n \n "}, {"sha": "e8207112256b662185cecf3386ac1a8bf2a6232e", "filename": "gcc/m2/gm2-libs-iso/LowShort.mod", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs-iso%2FLowShort.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs-iso%2FLowShort.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs-iso%2FLowShort.mod?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -27,7 +27,7 @@ see the files COPYING3 and COPYING.RUNTIME respectively.  If not, see\n IMPLEMENTATION MODULE LowShort ;\n \n FROM SYSTEM IMPORT ADDRESS ;\n-FROM Builtins IMPORT ilogbf, significandf, modff, signbitf, scalbnf, huge_valf, nextafterf ;\n+FROM Builtins IMPORT ilogbf, modff, signbitf, scalbnf, huge_valf, nextafterf ;\n FROM dtoa IMPORT Mode, strtod, dtoa ;\n FROM libc IMPORT free ;\n FROM RealMath IMPORT power ;\n@@ -64,7 +64,7 @@ END exponent ;\n \n PROCEDURE fraction (x: SHORTREAL) : SHORTREAL ;\n BEGIN\n-   RETURN significandf(x)\n+   RETURN scalbnf (x, -ilogbf (x))\n END fraction ;\n \n "}, {"sha": "8d849be46d81f28aa7251d7ab575819eda429349", "filename": "gcc/m2/gm2-libs/Builtins.def", "status": "modified", "additions": 0, "deletions": 8, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs%2FBuiltins.def", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs%2FBuiltins.def", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs%2FBuiltins.def?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -78,10 +78,6 @@ PROCEDURE __BUILTIN__ huge_val () : REAL ;\n PROCEDURE __BUILTIN__ huge_valf () : SHORTREAL ;\n PROCEDURE __BUILTIN__ huge_vall () : LONGREAL ;\n \n-PROCEDURE __BUILTIN__ significand (r: REAL) : REAL ;\n-PROCEDURE __BUILTIN__ significandf (s: SHORTREAL) : SHORTREAL ;\n-PROCEDURE __BUILTIN__ significandl (l: LONGREAL) : LONGREAL ;\n-\n PROCEDURE __BUILTIN__ modf (x: REAL; VAR y: REAL) : REAL ;\n PROCEDURE __BUILTIN__ modff (x: SHORTREAL;\n                              VAR y: SHORTREAL) : SHORTREAL ;\n@@ -99,10 +95,6 @@ PROCEDURE __BUILTIN__ nexttoward (x, y: REAL) : LONGREAL ;\n PROCEDURE __BUILTIN__ nexttowardf (x, y: SHORTREAL) : LONGREAL ;\n PROCEDURE __BUILTIN__ nexttowardl (x, y: LONGREAL) : LONGREAL ;\n \n-PROCEDURE __BUILTIN__ scalb (x, n: REAL) : REAL ;\n-PROCEDURE __BUILTIN__ scalbf (x, n: SHORTREAL) : SHORTREAL ;\n-PROCEDURE __BUILTIN__ scalbl (x, n: LONGREAL) : LONGREAL ;\n-\n PROCEDURE __BUILTIN__ scalbln (x: REAL; n: LONGINT) : REAL ;\n PROCEDURE __BUILTIN__ scalblnf (x: SHORTREAL; n: LONGINT) : SHORTREAL ;\n PROCEDURE __BUILTIN__ scalblnl (x: LONGREAL; n: LONGINT) : LONGREAL ;"}, {"sha": "a5d99392a4939399840b550f6b8c8ccd4a4c2713", "filename": "gcc/m2/gm2-libs/Builtins.mod", "status": "modified", "additions": 0, "deletions": 30, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs%2FBuiltins.mod", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Fgm2-libs%2FBuiltins.mod", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Fgm2-libs%2FBuiltins.mod?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -222,21 +222,6 @@ BEGIN\n    RETURN cbuiltin.ilogbl (x)\n END ilogbl ;\n \n-PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_significand)) significand (r: REAL) : REAL ;\n-BEGIN\n-   RETURN cbuiltin.significand (r)\n-END significand ;\n-\n-PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_significandf)) significandf (s: SHORTREAL) : SHORTREAL ;\n-BEGIN\n-   RETURN cbuiltin.significandf (s)\n-END significandf ;\n-\n-PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_significandl)) significandl (l: LONGREAL) : LONGREAL ;\n-BEGIN\n-   RETURN cbuiltin.significandl (l)\n-END significandl ;\n-\n PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_modf)) modf (x: REAL; VAR y: REAL) : REAL ;\n BEGIN\n    RETURN cbuiltin.modf (x, y)\n@@ -297,21 +282,6 @@ BEGIN\n    RETURN cbuiltin.nexttowardl (x, y)\n END nexttowardl ;\n \n-PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_scalb)) scalb (x, n: REAL) : REAL ;\n-BEGIN\n-   RETURN cbuiltin.scalb (x, n)\n-END scalb ;\n-\n-PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_scalbf)) scalbf (x, n: SHORTREAL) : SHORTREAL ;\n-BEGIN\n-   RETURN cbuiltin.scalbf (x, n)\n-END scalbf ;\n-\n-PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_scalbl)) scalbl (x, n: LONGREAL) : LONGREAL ;\n-BEGIN\n-   RETURN cbuiltin.scalbl (x, n)\n-END scalbl ;\n-\n PROCEDURE __ATTRIBUTE__  __BUILTIN__ ((__builtin_scalbln)) scalbln (x: REAL; n: LONGINT) : REAL ;\n BEGIN\n    RETURN cbuiltin.scalbln (x, n)"}, {"sha": "bf0afe1b8a4526f1722adf1e752d66679ba68099", "filename": "gcc/m2/target-independent/Builtins.texi", "status": "modified", "additions": 0, "deletions": 14, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Ftarget-independent%2FBuiltins.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/4413365616e8c6024d1ff4e23309e5012ee33b9f/gcc%2Fm2%2Ftarget-independent%2FBuiltins.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fm2%2Ftarget-independent%2FBuiltins.texi?ref=4413365616e8c6024d1ff4e23309e5012ee33b9f", "patch": "@@ -90,13 +90,6 @@ PROCEDURE __BUILTIN__ huge_valf () : SHORTREAL ;\n @findex huge_vall\n PROCEDURE __BUILTIN__ huge_vall () : LONGREAL ;\n \n-@findex significand\n-PROCEDURE __BUILTIN__ significand (r: REAL) : REAL ;\n-@findex significandf\n-PROCEDURE __BUILTIN__ significandf (s: SHORTREAL) : SHORTREAL ;\n-@findex significandl\n-PROCEDURE __BUILTIN__ significandl (l: LONGREAL) : LONGREAL ;\n-\n @findex modf\n PROCEDURE __BUILTIN__ modf (x: REAL; VAR y: REAL) : REAL ;\n @findex modff\n@@ -126,13 +119,6 @@ PROCEDURE __BUILTIN__ nexttowardf (x, y: SHORTREAL) : LONGREAL ;\n @findex nexttowardl\n PROCEDURE __BUILTIN__ nexttowardl (x, y: LONGREAL) : LONGREAL ;\n \n-@findex scalb\n-PROCEDURE __BUILTIN__ scalb (x, n: REAL) : REAL ;\n-@findex scalbf\n-PROCEDURE __BUILTIN__ scalbf (x, n: SHORTREAL) : SHORTREAL ;\n-@findex scalbl\n-PROCEDURE __BUILTIN__ scalbl (x, n: LONGREAL) : LONGREAL ;\n-\n @findex scalbln\n PROCEDURE __BUILTIN__ scalbln (x: REAL; n: LONGINT) : REAL ;\n @findex scalblnf"}]}