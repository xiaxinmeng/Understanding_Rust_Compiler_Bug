{"sha": "d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDhlZDE0Y2U0ZWNiOTJjNzI4ZGNhNjJhMDIwOTBkNWNmNmYxMGZjZg==", "commit": {"author": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2010-11-04T10:43:47Z"}, "committer": {"name": "Iain Sandoe", "email": "iains@gcc.gnu.org", "date": "2010-11-04T10:43:47Z"}, "message": "enable mdynamic-no-pic bootstrap for x86 Darwin\n\n\t* configure.ac (*-*-darwin*): Use mh-darwin for all Darwin variants.\n\t* configure: Regenerate.\n\t* config/mh-ppc-darwin: Rename to mh-darwin.\n\ngcc:\n\n\t* gcc/configure.ac: Filter -mdynamic-no-pic from CFLAGS when testing for\n\tplugin capabilities.\n\t* gcc/configure: Regenerate.\n\ngcc/testsuite:\n\n\t* lib/plugin-support.exp (plugin-test-execute): Filter -mdynamic-no-pic from\n\tplugin build flags on Darwin targets.\n\nFrom-SVN: r166302", "tree": {"sha": "01087337e00efbd28d652e41b8b6ad30963b110e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/01087337e00efbd28d652e41b8b6ad30963b110e"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/comments", "author": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "committer": {"login": "iains", "id": 4039407, "node_id": "MDQ6VXNlcjQwMzk0MDc=", "avatar_url": "https://avatars.githubusercontent.com/u/4039407?v=4", "gravatar_id": "", "url": "https://api.github.com/users/iains", "html_url": "https://github.com/iains", "followers_url": "https://api.github.com/users/iains/followers", "following_url": "https://api.github.com/users/iains/following{/other_user}", "gists_url": "https://api.github.com/users/iains/gists{/gist_id}", "starred_url": "https://api.github.com/users/iains/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/iains/subscriptions", "organizations_url": "https://api.github.com/users/iains/orgs", "repos_url": "https://api.github.com/users/iains/repos", "events_url": "https://api.github.com/users/iains/events{/privacy}", "received_events_url": "https://api.github.com/users/iains/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "0e6ac87ebaf95910b2a816aaddc80ed9f0d00fb4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0e6ac87ebaf95910b2a816aaddc80ed9f0d00fb4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0e6ac87ebaf95910b2a816aaddc80ed9f0d00fb4"}], "stats": {"total": 61, "additions": 51, "deletions": 10}, "files": [{"sha": "0812e34054d696260bad44d7b23d64783b92dbf2", "filename": "ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/ChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/ChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/ChangeLog?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -1,3 +1,9 @@\n+2010-11-04  Iain Sandoe  <iains@gcc.gnu.org>\n+\n+\t* configure.ac (*-*-darwin*): Use mh-darwin for all Darwin variants.\n+\t* configure: Regenerate.\n+\t* config/mh-ppc-darwin: Rename to mh-darwin.\n+\n 2010-11-03  Ian Lance Taylor  <iant@google.com>\n \t    Dave Korn  <dave.korn.cygwin@gmail.com>\n "}, {"sha": "66f68b664a9572306dc8cb7a3d56781160d01c91", "filename": "config/mh-darwin", "status": "renamed", "additions": 0, "deletions": 0, "changes": 0, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/config%2Fmh-darwin", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/config%2Fmh-darwin", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/config%2Fmh-darwin?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "previous_filename": "config/mh-ppc-darwin"}, {"sha": "7c313e28c4c77da6e4752bc8376e95b3f4458c39", "filename": "configure", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/configure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/configure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -3698,8 +3698,8 @@ fi\n     tentative_cc=\"/usr/cygnus/progressive/bin/gcc\"\n     host_makefile_frag=\"config/mh-lynxrs6k\"\n     ;;\n-  powerpc-*-darwin*)\n-    host_makefile_frag=\"config/mh-ppc-darwin\"\n+  *-*-darwin*)\n+    host_makefile_frag=\"config/mh-darwin\"\n     ;;\n   powerpc-*-aix*)\n     host_makefile_frag=\"config/mh-ppc-aix\""}, {"sha": "9b55f4e296c7146a605a94643bf8526de90a4f18", "filename": "configure.ac", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/configure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/configure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/configure.ac?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -1157,8 +1157,8 @@ case \"${host}\" in\n     tentative_cc=\"/usr/cygnus/progressive/bin/gcc\"\n     host_makefile_frag=\"config/mh-lynxrs6k\"\n     ;;\n-  powerpc-*-darwin*)\n-    host_makefile_frag=\"config/mh-ppc-darwin\"\n+  *-*-darwin*)\n+    host_makefile_frag=\"config/mh-darwin\"\n     ;;\n   powerpc-*-aix*)\n     host_makefile_frag=\"config/mh-ppc-aix\""}, {"sha": "712366c8846d0256feb94c30aba9ec606975454d", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -1,3 +1,9 @@\n+2010-11-04  Iain Sandoe  <iains@gcc.gnu.org>\n+\n+\t* gcc/configure.ac: Filter -mdynamic-no-pic from CFLAGS when testing for\n+\tplugin capabilities.\n+\t* gcc/configure: Regenerate.\n+\n 2010-11-03  Xinliang David Li  <davidxl@google.com>\n \n        PR target/46200"}, {"sha": "e39b946811d72691c9539a8c64c4b40772464a0a", "filename": "gcc/configure", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Fconfigure", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Fconfigure", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -25956,11 +25956,15 @@ fi\n \n   # Check that we can build shared objects with -fPIC -shared\n   saved_LDFLAGS=\"$LDFLAGS\"\n+  saved_CFLAGS=\"$CFLAGS\"\n   case \"${host}\" in\n     *-*-darwin*)\n-      LDFLAGS=\"$LDFLAGS -fPIC -shared -undefined dynamic_lookup\"\n+      CFLAGS=`echo $CFLAGS | sed s/-mdynamic-no-pic//g`\n+      CFLAGS=\"$CFLAGS -fPIC\"\n+      LDFLAGS=\"$LDFLAGS -shared -undefined dynamic_lookup\"\n     ;;\n     *)\n+      CFLAGS=\"$CFLAGS -fPIC\"\n       LDFLAGS=\"$LDFLAGS -fPIC -shared\"\n     ;;\n   esac\n@@ -25991,6 +25995,7 @@ rm -f core conftest.err conftest.$ac_objext \\\n     enable_plugin=no\n   fi\n   LDFLAGS=\"$saved_LDFLAGS\"\n+  CFLAGS=\"$saved_CFLAGS\"\n \n   # If plugin support had been requested but not available, fail.\n   if test x\"$enable_plugin\" = x\"no\" ; then"}, {"sha": "cc400425c273915357e6d4f3d3255fe82ef21c54", "filename": "gcc/configure.ac", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Fconfigure.ac", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Fconfigure.ac", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfigure.ac?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -4694,11 +4694,15 @@ if test x\"$enable_plugin\" = x\"yes\"; then\n \n   # Check that we can build shared objects with -fPIC -shared\n   saved_LDFLAGS=\"$LDFLAGS\"\n+  saved_CFLAGS=\"$CFLAGS\"\n   case \"${host}\" in\n     *-*-darwin*)\n-      LDFLAGS=\"$LDFLAGS -fPIC -shared -undefined dynamic_lookup\"\n+      CFLAGS=`echo $CFLAGS | sed s/-mdynamic-no-pic//g`\n+      CFLAGS=\"$CFLAGS -fPIC\"\n+      LDFLAGS=\"$LDFLAGS -shared -undefined dynamic_lookup\"\n     ;;\n     *)\n+      CFLAGS=\"$CFLAGS -fPIC\"\n       LDFLAGS=\"$LDFLAGS -fPIC -shared\"\n     ;;\n   esac\n@@ -4712,6 +4716,7 @@ if test x\"$enable_plugin\" = x\"yes\"; then\n     enable_plugin=no\n   fi\n   LDFLAGS=\"$saved_LDFLAGS\"\n+  CFLAGS=\"$saved_CFLAGS\"\n \n   # If plugin support had been requested but not available, fail.\n   if test x\"$enable_plugin\" = x\"no\" ; then"}, {"sha": "bbcf32deb2885b4fba37c654b4cdca201503db1e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -1,3 +1,8 @@\n+2010-11-04  Iain Sandoe  <iains@gcc.gnu.org>\n+\n+\t* lib/plugin-support.exp (plugin-test-execute): Filter -mdynamic-no-pic from\n+\tplugin build flags on Darwin targets.\n+\n 2010-11-03  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* gcc.target/i386/pr46285.c: Require split_stack target."}, {"sha": "2e689a68921c921d53b57b758780402e7c7f2c7b", "filename": "gcc/testsuite/lib/plugin-support.exp", "status": "modified", "additions": 18, "deletions": 4, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Ftestsuite%2Flib%2Fplugin-support.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf/gcc%2Ftestsuite%2Flib%2Fplugin-support.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Flib%2Fplugin-support.exp?ref=d8ed14ce4ecb92c728dca62a02090d5cf6f10fcf", "patch": "@@ -86,15 +86,29 @@ proc plugin-test-execute { plugin_src plugin_tests } {\n                   -I${gcc_srcdir}/include -I${gcc_srcdir}/libcpp/include \\\n                   $GMPINC -I${gcc_objdir}/intl\"\n \n-    set optstr \"$includes $extra_flags -DIN_GCC -fPIC -shared\"\n-\n     if { [ ishost *-*-darwin* ] } {\n-        set optstr [concat $optstr \"-undefined dynamic_lookup\"]\n+\t# -mdynamic-no-pic is incompatible with -fPIC.\n+\tset plug_cflags \"\" \n+\tforeach op $PLUGINCFLAGS {\n+\t    if { [string compare \"-mdynamic-no-pic\" $op] } {\n+\t\tset plug_cflags [concat $plug_cflags \" $op\"]\n+\t    }\n+\t}\n+\tset optstr \"$includes\"\n+\tforeach op $extra_flags {\n+\t    if { [string compare \"-mdynamic-no-pic\" $op] } {\n+\t\tset optstr [concat $optstr \" $op\"]\n+\t    }\n+\t}\n+\tset optstr [concat $optstr \"-DIN_GCC -fPIC -shared -undefined dynamic_lookup\"]\n+    } else {\n+\tset plug_cflags $PLUGINCFLAGS \n+\tset optstr \"$includes $extra_flags -DIN_GCC -fPIC -shared\"\n     }\n \n     # Temporarily switch to the environment for the plugin compiler.\n     restore_ld_library_path_env_vars\n-    set status [remote_exec build \"$PLUGINCC $PLUGINCFLAGS $plugin_src $optstr -o $plugin_lib\"]\n+    set status [remote_exec build \"$PLUGINCC $plug_cflags $plugin_src $optstr -o $plugin_lib\"]\n     set status [lindex $status 0]\n     set_ld_library_path_env_vars\n "}]}