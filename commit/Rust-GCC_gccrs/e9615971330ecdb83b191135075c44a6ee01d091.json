{"sha": "e9615971330ecdb83b191135075c44a6ee01d091", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTk2MTU5NzEzMzBlY2RiODNiMTkxMTM1MDc1YzQ0YTZlZTAxZDA5MQ==", "commit": {"author": {"name": "Richard Guenther", "email": "rguenther@suse.de", "date": "2010-11-22T13:18:48Z"}, "committer": {"name": "Richard Biener", "email": "rguenth@gcc.gnu.org", "date": "2010-11-22T13:18:48Z"}, "message": "gimple-fold.c (maybe_fold_reference): When canonicalizing MEM_REFs, preserve volatileness.\n\n2010-11-22  Richard Guenther  <rguenther@suse.de>\n\n\t* gimple-fold.c (maybe_fold_reference): When canonicalizing\n\tMEM_REFs, preserve volatileness.\n\t* cgraphbuild.c (mark_address): Properly check for FUNCTION_DECL\n\taddresses.\n\nFrom-SVN: r167030", "tree": {"sha": "9955bf63053ef899a56cecced5b989e2239a8063", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9955bf63053ef899a56cecced5b989e2239a8063"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e9615971330ecdb83b191135075c44a6ee01d091", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9615971330ecdb83b191135075c44a6ee01d091", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9615971330ecdb83b191135075c44a6ee01d091", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9615971330ecdb83b191135075c44a6ee01d091/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "993466f3d18992422941c1a57b53cff04acffce6", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/993466f3d18992422941c1a57b53cff04acffce6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/993466f3d18992422941c1a57b53cff04acffce6"}], "stats": {"total": 42, "additions": 23, "deletions": 19}, "files": [{"sha": "87f56b7973b5a144b0a6895d148603ad0208ecd7", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9615971330ecdb83b191135075c44a6ee01d091/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9615971330ecdb83b191135075c44a6ee01d091/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=e9615971330ecdb83b191135075c44a6ee01d091", "patch": "@@ -1,3 +1,10 @@\n+2010-11-22  Richard Guenther  <rguenther@suse.de>\n+\n+\t* gimple-fold.c (maybe_fold_reference): When canonicalizing\n+\tMEM_REFs, preserve volatileness.\n+\t* cgraphbuild.c (mark_address): Properly check for FUNCTION_DECL\n+\taddresses.\n+\n 2010-11-22  Richard Guenther  <rguenther@suse.de>\n \n \t* tree-ssa-ccp.c (get_base_constructor): Remove superfluous breaks."}, {"sha": "d8d196fd0da24d162f1f3378bedc3f63efffba16", "filename": "gcc/cgraphbuild.c", "status": "modified", "additions": 13, "deletions": 16, "changes": 29, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9615971330ecdb83b191135075c44a6ee01d091/gcc%2Fcgraphbuild.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9615971330ecdb83b191135075c44a6ee01d091/gcc%2Fcgraphbuild.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcgraphbuild.c?ref=e9615971330ecdb83b191135075c44a6ee01d091", "patch": "@@ -237,6 +237,7 @@ static bool\n mark_address (gimple stmt ATTRIBUTE_UNUSED, tree addr,\n \t      void *data ATTRIBUTE_UNUSED)\n {\n+  addr = get_base_address (addr);\n   if (TREE_CODE (addr) == FUNCTION_DECL)\n     {\n       struct cgraph_node *node = cgraph_node (addr);\n@@ -245,24 +246,20 @@ mark_address (gimple stmt ATTRIBUTE_UNUSED, tree addr,\n \t\t\t    node, NULL,\n \t\t\t    IPA_REF_ADDR, stmt);\n     }\n-  else\n+  else if (addr && TREE_CODE (addr) == VAR_DECL\n+\t   && (TREE_STATIC (addr) || DECL_EXTERNAL (addr)))\n     {\n-      addr = get_base_address (addr);\n-      if (addr && TREE_CODE (addr) == VAR_DECL\n-\t  && (TREE_STATIC (addr) || DECL_EXTERNAL (addr)))\n-\t{\n-\t  struct varpool_node *vnode = varpool_node (addr);\n-\t  int walk_subtrees;\n+      struct varpool_node *vnode = varpool_node (addr);\n+      int walk_subtrees;\n \n-\t  if (lang_hooks.callgraph.analyze_expr)\n-\t    lang_hooks.callgraph.analyze_expr (&addr, &walk_subtrees);\n-\t  varpool_mark_needed_node (vnode);\n-\t  if (vnode->alias && vnode->extra_name)\n-\t    vnode = vnode->extra_name;\n-\t  ipa_record_reference ((struct cgraph_node *)data, NULL,\n-\t\t\t\tNULL, vnode,\n-\t\t\t\tIPA_REF_ADDR, stmt);\n-\t}\n+      if (lang_hooks.callgraph.analyze_expr)\n+\tlang_hooks.callgraph.analyze_expr (&addr, &walk_subtrees);\n+      varpool_mark_needed_node (vnode);\n+      if (vnode->alias && vnode->extra_name)\n+\tvnode = vnode->extra_name;\n+      ipa_record_reference ((struct cgraph_node *)data, NULL,\n+\t\t\t    NULL, vnode,\n+\t\t\t    IPA_REF_ADDR, stmt);\n     }\n \n   return false;"}, {"sha": "8d0157bd426bf3c93a97fc154a7235d67b6fdbf2", "filename": "gcc/gimple-fold.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9615971330ecdb83b191135075c44a6ee01d091/gcc%2Fgimple-fold.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9615971330ecdb83b191135075c44a6ee01d091/gcc%2Fgimple-fold.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fgimple-fold.c?ref=e9615971330ecdb83b191135075c44a6ee01d091", "patch": "@@ -600,15 +600,15 @@ maybe_fold_reference (tree expr, bool is_lhs)\n     }\n   /* Canonicalize MEM_REFs invariant address operand.  */\n   else if (TREE_CODE (*t) == MEM_REF\n-\t   && TREE_CODE (TREE_OPERAND (*t, 0)) == ADDR_EXPR\n-\t   && !DECL_P (TREE_OPERAND (TREE_OPERAND (*t, 0), 0))\n-\t   && !CONSTANT_CLASS_P (TREE_OPERAND (TREE_OPERAND (*t, 0), 0)))\n+\t   && !is_gimple_mem_ref_addr (TREE_OPERAND (*t, 0)))\n     {\n+      bool volatile_p = TREE_THIS_VOLATILE (*t);\n       tree tem = fold_binary (MEM_REF, TREE_TYPE (*t),\n \t\t\t      TREE_OPERAND (*t, 0),\n \t\t\t      TREE_OPERAND (*t, 1));\n       if (tem)\n \t{\n+\t  TREE_THIS_VOLATILE (tem) = volatile_p;\n \t  *t = tem;\n \t  tem = maybe_fold_reference (expr, is_lhs);\n \t  if (tem)"}]}