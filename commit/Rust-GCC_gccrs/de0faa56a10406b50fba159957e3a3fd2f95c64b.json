{"sha": "de0faa56a10406b50fba159957e3a3fd2f95c64b", "node_id": "C_kwDOANBUbNoAKGRlMGZhYTU2YTEwNDA2YjUwZmJhMTU5OTU3ZTNhM2ZkMmY5NWM2NGI", "commit": {"author": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2022-01-10T19:39:35Z"}, "committer": {"name": "Uros Bizjak", "email": "ubizjak@gmail.com", "date": "2022-01-10T19:40:22Z"}, "message": "tree-optimization/103948 - detect vector vec_cmp in expand_vector_condition\n\nCurrently, expand_vector_condition detects only vcondMN and vconduMN\nnamed RTX patterns.  Teach it to also consider vec_cmpMN and vec_cmpuMN\nRTX patterns when all ones vector is returned for true and all zeros vector\nis returned for false.\n\n2022-01-10  Richard Biener  <rguenther@suse.de>\n\ngcc/ChangeLog:\n\n\tPR tree-optimization/103948\n\t* tree-vect-generic.c (expand_vector_condition): Return true if\n\tall ones vector is returned for true, all zeros vector for false\n\tand the target defines corresponding vec_cmp{,u}MN named RTX pattern.", "tree": {"sha": "7581c1c8014e6653ed5cc27610112cffd2b1ddc0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7581c1c8014e6653ed5cc27610112cffd2b1ddc0"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/de0faa56a10406b50fba159957e3a3fd2f95c64b", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de0faa56a10406b50fba159957e3a3fd2f95c64b", "html_url": "https://github.com/Rust-GCC/gccrs/commit/de0faa56a10406b50fba159957e3a3fd2f95c64b", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/de0faa56a10406b50fba159957e3a3fd2f95c64b/comments", "author": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ubizjak", "id": 55479990, "node_id": "MDQ6VXNlcjU1NDc5OTkw", "avatar_url": "https://avatars.githubusercontent.com/u/55479990?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ubizjak", "html_url": "https://github.com/ubizjak", "followers_url": "https://api.github.com/users/ubizjak/followers", "following_url": "https://api.github.com/users/ubizjak/following{/other_user}", "gists_url": "https://api.github.com/users/ubizjak/gists{/gist_id}", "starred_url": "https://api.github.com/users/ubizjak/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ubizjak/subscriptions", "organizations_url": "https://api.github.com/users/ubizjak/orgs", "repos_url": "https://api.github.com/users/ubizjak/repos", "events_url": "https://api.github.com/users/ubizjak/events{/privacy}", "received_events_url": "https://api.github.com/users/ubizjak/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "c173d880d651b9754f82af079e8d694418838a12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c173d880d651b9754f82af079e8d694418838a12", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c173d880d651b9754f82af079e8d694418838a12"}], "stats": {"total": 4, "additions": 3, "deletions": 1}, "files": [{"sha": "5814a71a5bb650e88f6ae635af6940f23cbaf39a", "filename": "gcc/tree-vect-generic.c", "status": "modified", "additions": 3, "deletions": 1, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/de0faa56a10406b50fba159957e3a3fd2f95c64b/gcc%2Ftree-vect-generic.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/de0faa56a10406b50fba159957e3a3fd2f95c64b/gcc%2Ftree-vect-generic.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-generic.c?ref=de0faa56a10406b50fba159957e3a3fd2f95c64b", "patch": "@@ -1052,7 +1052,9 @@ expand_vector_condition (gimple_stmt_iterator *gsi, bitmap dce_ssa_names)\n \t}\n     }\n \n-  if (expand_vec_cond_expr_p (type, TREE_TYPE (a1), code))\n+  if (expand_vec_cond_expr_p (type, TREE_TYPE (a1), code)\n+      || (integer_all_onesp (b) && integer_zerop (c)\n+\t  && expand_vec_cmp_expr_p (type, TREE_TYPE (a1), code)))\n     {\n       gcc_assert (TREE_CODE (a) == SSA_NAME || TREE_CODE (a) == VECTOR_CST);\n       return true;"}]}