{"sha": "d41e76cf758505ba1bc22ca88cf6d1f626298def", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDQxZTc2Y2Y3NTg1MDViYTFiYzIyY2E4OGNmNmQxZjYyNjI5OGRlZg==", "commit": {"author": {"name": "David Malcolm", "email": "dmalcolm@redhat.com", "date": "2016-08-26T17:59:08Z"}, "committer": {"name": "David Malcolm", "email": "dmalcolm@gcc.gnu.org", "date": "2016-08-26T17:59:08Z"}, "message": "Tweak to colors of fix-it hints\n\nPrevious, fix-it hints were printed using the color of the severity\nof the diagnostic (magenta for warnings, red for errors, cyan for\nnotes).\n\nThis patch updates fix-it hints so that replacement text is printed in\ngreen, to better distinguish the suggested improvement from\nthe current code.  For example:\n\nspellcheck-fields.cc:52:13: error: 'struct s' has no member named 'colour'; did you mean 'color'?\n   return ptr->colour;  <<< RED\n               ^~~~~~   <<< RED\n               color    <<< GREEN\n\nIt makes sense for the underlinings that indicate deletions to\nbe printed in red, so the patch changes that also.  For example:\n\ndiagnostic-test-show-locus-color.c:179:9: warning: example of a removal hint\n   int a;;  <<< MAGENTA\n         ^  <<< MAGENTA\n         -  <<< RED\n\ngcc/ChangeLog:\n\t* diagnostic-color.c (color_dict): Add \"fixit-insert\" and\n\t\"fixit-delete\".\n\t(parse_gcc_colors): Update description of default GCC_COLORS.\n\t* diagnostic-show-locus.c (colorizer::set_fixit_hint): Delete.\n\t(colorizer::set_fixit_insert): New method.\n\t(colorizer::set_fixit_delete): New method.\n\t(colorizer::get_color_by_name): New method.\n\t(colorizer::STATE_FIXIT_INSERT): New constant.\n\t(colorizer::STATE_FIXIT_DELETE): New constant.\n\t(class colorizer): Drop \"_cs\" suffix from fields.  Delete \"_ce\"\n\tfields in favor of new field \"m_stop_color\".  Add fields\n\t\"m_fixit_insert\" and \"m_fixit_delete\".\n\t(colorizer::colorizer): Update for above changes.  Replace\n\tcolorize_start calls with calls to get_color_by_name.\n\t(colorizer::begin_state): Handle STATE_FIXIT_INSERT and\n\tSTATE_FIXIT_DELETE.  Update for field renamings.\n\t(colorizer::finish_state): Simplify by using m_stop_color,\n\trather than multiple identical \"*_ce\" fields.\n\t(colorizer::get_color_by_name): New method.\n\t(layout::print_any_fixits): Print insertions and replacements\n\tusing the \"fixit-insert\" color, and deletions using the\n\t\"fixit-delete\" color.\n\t* doc/invoke.texi (-fdiagnostics-color): Update description of\n\tdefault GCC_COLORS, and of the supported capabilities.\n\ngcc/testsuite/ChangeLog:\n\t* gcc.dg/plugin/diagnostic-test-show-locus-color.c\n\t(test_fixit_insert): Update expected output.\n\t(test_fixit_remove): Likewise.\n\t(test_fixit_replace): Likewise.\n\nFrom-SVN: r239787", "tree": {"sha": "02630a9ec5362c89f24cf23ab93aa7cc50a1f297", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/02630a9ec5362c89f24cf23ab93aa7cc50a1f297"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d41e76cf758505ba1bc22ca88cf6d1f626298def", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d41e76cf758505ba1bc22ca88cf6d1f626298def", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d41e76cf758505ba1bc22ca88cf6d1f626298def", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d41e76cf758505ba1bc22ca88cf6d1f626298def/comments", "author": {"login": "davidmalcolm", "id": 1553248, "node_id": "MDQ6VXNlcjE1NTMyNDg=", "avatar_url": "https://avatars.githubusercontent.com/u/1553248?v=4", "gravatar_id": "", "url": "https://api.github.com/users/davidmalcolm", "html_url": "https://github.com/davidmalcolm", "followers_url": "https://api.github.com/users/davidmalcolm/followers", "following_url": "https://api.github.com/users/davidmalcolm/following{/other_user}", "gists_url": "https://api.github.com/users/davidmalcolm/gists{/gist_id}", "starred_url": "https://api.github.com/users/davidmalcolm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/davidmalcolm/subscriptions", "organizations_url": "https://api.github.com/users/davidmalcolm/orgs", "repos_url": "https://api.github.com/users/davidmalcolm/repos", "events_url": "https://api.github.com/users/davidmalcolm/events{/privacy}", "received_events_url": "https://api.github.com/users/davidmalcolm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "524a4c966c0e8f719887e7b84b5e1c7686e8872d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/524a4c966c0e8f719887e7b84b5e1c7686e8872d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/524a4c966c0e8f719887e7b84b5e1c7686e8872d"}], "stats": {"total": 140, "additions": 101, "deletions": 39}, "files": [{"sha": "e719a87b5ef7966dc7f962f018de41ba197e0a8f", "filename": "gcc/ChangeLog", "status": "modified", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d41e76cf758505ba1bc22ca88cf6d1f626298def", "patch": "@@ -1,3 +1,30 @@\n+2016-08-26  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* diagnostic-color.c (color_dict): Add \"fixit-insert\" and\n+\t\"fixit-delete\".\n+\t(parse_gcc_colors): Update description of default GCC_COLORS.\n+\t* diagnostic-show-locus.c (colorizer::set_fixit_hint): Delete.\n+\t(colorizer::set_fixit_insert): New method.\n+\t(colorizer::set_fixit_delete): New method.\n+\t(colorizer::get_color_by_name): New method.\n+\t(colorizer::STATE_FIXIT_INSERT): New constant.\n+\t(colorizer::STATE_FIXIT_DELETE): New constant.\n+\t(class colorizer): Drop \"_cs\" suffix from fields.  Delete \"_ce\"\n+\tfields in favor of new field \"m_stop_color\".  Add fields\n+\t\"m_fixit_insert\" and \"m_fixit_delete\".\n+\t(colorizer::colorizer): Update for above changes.  Replace\n+\tcolorize_start calls with calls to get_color_by_name.\n+\t(colorizer::begin_state): Handle STATE_FIXIT_INSERT and\n+\tSTATE_FIXIT_DELETE.  Update for field renamings.\n+\t(colorizer::finish_state): Simplify by using m_stop_color,\n+\trather than multiple identical \"*_ce\" fields.\n+\t(colorizer::get_color_by_name): New method.\n+\t(layout::print_any_fixits): Print insertions and replacements\n+\tusing the \"fixit-insert\" color, and deletions using the\n+\t\"fixit-delete\" color.\n+\t* doc/invoke.texi (-fdiagnostics-color): Update description of\n+\tdefault GCC_COLORS, and of the supported capabilities.\n+\n 2016-08-26  Max Filippov  <jcmvbkbc@gmail.com>\n \n \t* config/xtensa/xtensa.c (xtensa_expand_prologue): Update"}, {"sha": "42aa1b6022623122483cc5bedbcf00c2cf1b8a5f", "filename": "gcc/diagnostic-color.c", "status": "modified", "additions": 5, "deletions": 1, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Fdiagnostic-color.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Fdiagnostic-color.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic-color.c?ref=d41e76cf758505ba1bc22ca88cf6d1f626298def", "patch": "@@ -168,6 +168,8 @@ static struct color_cap color_dict[] =\n   { \"range2\", SGR_SEQ (COLOR_FG_BLUE), 6, false },\n   { \"locus\", SGR_SEQ (COLOR_BOLD), 5, false },\n   { \"quote\", SGR_SEQ (COLOR_BOLD), 5, false },\n+  { \"fixit-insert\", SGR_SEQ (COLOR_FG_GREEN), 12, false },\n+  { \"fixit-delete\", SGR_SEQ (COLOR_FG_RED), 12, false },\n   { NULL, NULL, 0, false }\n };\n \n@@ -196,7 +198,9 @@ colorize_stop (bool show_color)\n }\n \n /* Parse GCC_COLORS.  The default would look like:\n-   GCC_COLORS='error=01;31:warning=01;35:note=01;36:range1=32:range2=34;locus=01:quote=01'\n+   GCC_COLORS='error=01;31:warning=01;35:note=01;36:\\\n+   range1=32:range2=34:locus=01:quote=01:\\\n+   fixit-insert=32:fixit-delete=31'\n    No character escaping is needed or supported.  */\n static bool\n parse_gcc_colors (void)"}, {"sha": "94b7349e7a9ef75e0df0d72146833e7d432d95aa", "filename": "gcc/diagnostic-show-locus.c", "status": "modified", "additions": 38, "deletions": 28, "changes": 66, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Fdiagnostic-show-locus.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Fdiagnostic-show-locus.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdiagnostic-show-locus.c?ref=d41e76cf758505ba1bc22ca88cf6d1f626298def", "patch": "@@ -79,24 +79,29 @@ class colorizer\n \n   void set_range (int range_idx) { set_state (range_idx); }\n   void set_normal_text () { set_state (STATE_NORMAL_TEXT); }\n-  void set_fixit_hint () { set_state (0); }\n+  void set_fixit_insert () { set_state (STATE_FIXIT_INSERT); }\n+  void set_fixit_delete () { set_state (STATE_FIXIT_DELETE); }\n \n  private:\n   void set_state (int state);\n   void begin_state (int state);\n   void finish_state (int state);\n+  const char *get_color_by_name (const char *);\n \n  private:\n   static const int STATE_NORMAL_TEXT = -1;\n+  static const int STATE_FIXIT_INSERT  = -2;\n+  static const int STATE_FIXIT_DELETE  = -3;\n \n   diagnostic_context *m_context;\n   diagnostic_t m_diagnostic_kind;\n   int m_current_state;\n-  const char *m_caret_cs;\n-  const char *m_caret_ce;\n-  const char *m_range1_cs;\n-  const char *m_range2_cs;\n-  const char *m_range_ce;\n+  const char *m_caret;\n+  const char *m_range1;\n+  const char *m_range2;\n+  const char *m_fixit_insert;\n+  const char *m_fixit_delete;\n+  const char *m_stop_color;\n };\n \n /* A point within a layout_range; similar to an expanded_location,\n@@ -247,10 +252,11 @@ colorizer::colorizer (diagnostic_context *context,\n   m_diagnostic_kind (diagnostic_kind),\n   m_current_state (STATE_NORMAL_TEXT)\n {\n-  m_caret_ce = colorize_stop (pp_show_color (context->printer));\n-  m_range1_cs = colorize_start (pp_show_color (context->printer), \"range1\");\n-  m_range2_cs = colorize_start (pp_show_color (context->printer), \"range2\");\n-  m_range_ce = colorize_stop (pp_show_color (context->printer));\n+  m_range1 = get_color_by_name (\"range1\");\n+  m_range2 = get_color_by_name (\"range2\");\n+  m_fixit_insert = get_color_by_name (\"fixit-insert\");\n+  m_fixit_delete = get_color_by_name (\"fixit-delete\");\n+  m_stop_color = colorize_stop (pp_show_color (context->printer));\n }\n \n /* The destructor for \"colorize\".  If colorization is on, print a code to\n@@ -285,6 +291,14 @@ colorizer::begin_state (int state)\n     case STATE_NORMAL_TEXT:\n       break;\n \n+    case STATE_FIXIT_INSERT:\n+      pp_string (m_context->printer, m_fixit_insert);\n+      break;\n+\n+    case STATE_FIXIT_DELETE:\n+      pp_string (m_context->printer, m_fixit_delete);\n+      break;\n+\n     case 0:\n       /* Make range 0 be the same color as the \"kind\" text\n \t (error vs warning vs note).  */\n@@ -295,11 +309,11 @@ colorizer::begin_state (int state)\n       break;\n \n     case 1:\n-      pp_string (m_context->printer, m_range1_cs);\n+      pp_string (m_context->printer, m_range1);\n       break;\n \n     case 2:\n-      pp_string (m_context->printer, m_range2_cs);\n+      pp_string (m_context->printer, m_range2);\n       break;\n \n     default:\n@@ -314,21 +328,17 @@ colorizer::begin_state (int state)\n void\n colorizer::finish_state (int state)\n {\n-  switch (state)\n-    {\n-    case STATE_NORMAL_TEXT:\n-      break;\n+  if (state != STATE_NORMAL_TEXT)\n+    pp_string (m_context->printer, m_stop_color);\n+}\n \n-    case 0:\n-      pp_string (m_context->printer, m_caret_ce);\n-      break;\n+/* Get the color code for NAME (or the empty string if\n+   colorization is disabled).  */\n \n-    default:\n-      /* Within a range.  */\n-      gcc_assert (state > 0);\n-      pp_string (m_context->printer, m_range_ce);\n-      break;\n-    }\n+const char *\n+colorizer::get_color_by_name (const char *name)\n+{\n+  return colorize_start (pp_show_color (m_context->printer), name);\n }\n \n /* Implementation of class layout_range.  */\n@@ -1098,7 +1108,7 @@ layout::print_any_fixits (int row, const rich_location *richloc)\n \t\tint start_column\n \t\t  = LOCATION_COLUMN (insert->get_location ());\n \t\tmove_to_column (&column, start_column);\n-\t\tm_colorizer.set_fixit_hint ();\n+\t\tm_colorizer.set_fixit_insert ();\n \t\tpp_string (m_pp, insert->get_string ());\n \t\tm_colorizer.set_normal_text ();\n \t\tcolumn += insert->get_length ();\n@@ -1122,7 +1132,7 @@ layout::print_any_fixits (int row, const rich_location *richloc)\n \t\t    || replace->get_length () == 0)\n \t\t  {\n \t\t    move_to_column (&column, start_column);\n-\t\t    m_colorizer.set_fixit_hint ();\n+\t\t    m_colorizer.set_fixit_delete ();\n \t\t    for (; column <= finish_column; column++)\n \t\t      pp_character (m_pp, '-');\n \t\t    m_colorizer.set_normal_text ();\n@@ -1133,7 +1143,7 @@ layout::print_any_fixits (int row, const rich_location *richloc)\n \t\tif (replace->get_length () > 0)\n \t\t  {\n \t\t    move_to_column (&column, start_column);\n-\t\t    m_colorizer.set_fixit_hint ();\n+\t\t    m_colorizer.set_fixit_insert ();\n \t\t    pp_string (m_pp, replace->get_string ());\n \t\t    m_colorizer.set_normal_text ();\n \t\t    column += replace->get_length ();"}, {"sha": "87da1f1c12b718fa63c9b89fdd8f85fbc6b54cb0", "filename": "gcc/doc/invoke.texi", "status": "modified", "additions": 21, "deletions": 7, "changes": 28, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Fdoc%2Finvoke.texi", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Fdoc%2Finvoke.texi", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdoc%2Finvoke.texi?ref=d41e76cf758505ba1bc22ca88cf6d1f626298def", "patch": "@@ -3343,13 +3343,13 @@ for 88-color and 256-color modes background colors.\n \n The default @env{GCC_COLORS} is\n @smallexample\n-error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01\n+error=01;31:warning=01;35:note=01;36:range1=32:range2=34:locus=01:quote=01:fixit-insert=32:fixit-delete=31\n @end smallexample\n @noindent\n where @samp{01;31} is bold red, @samp{01;35} is bold magenta,\n-@samp{01;36} is bold cyan, @samp{01;32} is bold green and\n-@samp{01} is bold. Setting @env{GCC_COLORS} to the empty\n-string disables colors.\n+@samp{01;36} is bold cyan, @samp{32} is green, @samp{34} is blue,\n+@samp{01} is bold, and @samp{31} is red.\n+Setting @env{GCC_COLORS} to the empty string disables colors.\n Supported capabilities are as follows.\n \n @table @code\n@@ -3365,9 +3365,13 @@ SGR substring for warning: markers.\n @vindex note GCC_COLORS @r{capability}\n SGR substring for note: markers.\n \n-@item caret=\n-@vindex caret GCC_COLORS @r{capability}\n-SGR substring for caret line.\n+@item range1=\n+@vindex range1 GCC_COLORS @r{capability}\n+SGR substring for first additional range.\n+\n+@item range2=\n+@vindex range2 GCC_COLORS @r{capability}\n+SGR substring for second additional range.\n \n @item locus=\n @vindex locus GCC_COLORS @r{capability}\n@@ -3377,6 +3381,16 @@ SGR substring for location information, @samp{file:line} or\n @item quote=\n @vindex quote GCC_COLORS @r{capability}\n SGR substring for information printed within quotes.\n+\n+@item fixit-insert=\n+@vindex fixit-insert GCC_COLORS @r{capability}\n+SGR substring for fix-it hints suggesting text to\n+be inserted or replaced.\n+\n+@item fixit-delete=\n+@vindex fixit-delete GCC_COLORS @r{capability}\n+SGR substring for fix-it hints suggesting text to\n+be deleted.\n @end table\n \n @item -fno-diagnostics-show-option"}, {"sha": "352769a4e5143f5371a79fa7f19233349467ce67", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=d41e76cf758505ba1bc22ca88cf6d1f626298def", "patch": "@@ -1,3 +1,10 @@\n+2016-08-26  David Malcolm  <dmalcolm@redhat.com>\n+\n+\t* gcc.dg/plugin/diagnostic-test-show-locus-color.c\n+\t(test_fixit_insert): Update expected output.\n+\t(test_fixit_remove): Likewise.\n+\t(test_fixit_replace): Likewise.\n+\n 2016-08-26  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* gcc.dg/ipa/propbits-2.c: Add -fdump-tree-optimized to dg-options."}, {"sha": "712375e0b192792dd8c5e49eddc715e074aa4dd2", "filename": "gcc/testsuite/gcc.dg/plugin/diagnostic-test-show-locus-color.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fdiagnostic-test-show-locus-color.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d41e76cf758505ba1bc22ca88cf6d1f626298def/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fdiagnostic-test-show-locus-color.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fplugin%2Fdiagnostic-test-show-locus-color.c?ref=d41e76cf758505ba1bc22ca88cf6d1f626298def", "patch": "@@ -161,7 +161,7 @@ void test_fixit_insert (void)\n /* { dg-begin-multiline-output \"\" }\n     int a[2][2] = { \u001b[01;35m\u001b[K0, 1\u001b[m\u001b[K , 2, 3 };\n                     \u001b[01;35m\u001b[K^~~~\u001b[m\u001b[K\n-                    \u001b[01;35m\u001b[K{\u001b[m\u001b[K   \u001b[01;35m\u001b[K}\u001b[m\u001b[K\n+                    \u001b[32m\u001b[K{\u001b[m\u001b[K   \u001b[32m\u001b[K}\u001b[m\u001b[K\n    { dg-end-multiline-output \"\" } */\n #endif\n }\n@@ -175,7 +175,7 @@ void test_fixit_remove (void)\n /* { dg-begin-multiline-output \"\" }\n    int a;\u001b[01;35m\u001b[K;\u001b[m\u001b[K\n          \u001b[01;35m\u001b[K^\u001b[m\u001b[K\n-         \u001b[01;35m\u001b[K-\u001b[m\u001b[K\n+         \u001b[31m\u001b[K-\u001b[m\u001b[K\n    { dg-end-multiline-output \"\" } */\n #endif\n }\n@@ -189,7 +189,7 @@ void test_fixit_replace (void)\n /* { dg-begin-multiline-output \"\" }\n    \u001b[01;35m\u001b[Kgtk_widget_showall\u001b[m\u001b[K (dlg);\n    \u001b[01;35m\u001b[K^~~~~~~~~~~~~~~~~~\u001b[m\u001b[K\n-   \u001b[01;35m\u001b[Kgtk_widget_show_all\u001b[m\u001b[K\n+   \u001b[32m\u001b[Kgtk_widget_show_all\u001b[m\u001b[K\n    { dg-end-multiline-output \"\" } */\n #endif\n }"}]}