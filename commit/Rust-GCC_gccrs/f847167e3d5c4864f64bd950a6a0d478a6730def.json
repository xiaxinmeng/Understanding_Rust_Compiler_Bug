{"sha": "f847167e3d5c4864f64bd950a6a0d478a6730def", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Zjg0NzE2N2UzZDVjNDg2NGY2NGJkOTUwYTZhMGQ0NzhhNjczMGRlZg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@codesourcery.com", "date": "2001-04-12T07:47:34Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2001-04-12T07:47:34Z"}, "message": "eh_alloc.cc (__cxa_allocate_exception): Don't terminate holding the mutex.\n\n\t* libsupc++/eh_alloc.cc (__cxa_allocate_exception): Don't\n\tterminate holding the mutex. Make sure size fits in EMERGENCY_OBJ_SIZE.\n\nFrom-SVN: r41296", "tree": {"sha": "61705408bb09241d14f3b569651666fefb360e9b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/61705408bb09241d14f3b569651666fefb360e9b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f847167e3d5c4864f64bd950a6a0d478a6730def", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f847167e3d5c4864f64bd950a6a0d478a6730def", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f847167e3d5c4864f64bd950a6a0d478a6730def", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f847167e3d5c4864f64bd950a6a0d478a6730def/comments", "author": null, "committer": null, "parents": [{"sha": "0fb3018cd802d7aae15888ba68f51ad9a83cb71d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/0fb3018cd802d7aae15888ba68f51ad9a83cb71d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/0fb3018cd802d7aae15888ba68f51ad9a83cb71d"}], "stats": {"total": 12, "additions": 11, "deletions": 1}, "files": [{"sha": "50cf9ecb3b255de28c2a341da95a623895f9834d", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f847167e3d5c4864f64bd950a6a0d478a6730def/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f847167e3d5c4864f64bd950a6a0d478a6730def/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=f847167e3d5c4864f64bd950a6a0d478a6730def", "patch": "@@ -1,3 +1,8 @@\n+2001-04-12  Nathan Sidwell  <nathan@codesourcery.com>\n+\n+\t* libsupc++/eh_alloc.cc (__cxa_allocate_exception): Don't\n+\tterminate holding the mutex. Make sure size fits in EMERGENCY_OBJ_SIZE.\n+\n 2001-04-12  Gabriel Dos Reis  <gdr@codesourcery.com>\n \n \t* testsuite/README: Add DejaGnu specific documentation."}, {"sha": "bbaa6f694a0cbfadbe07a9862d797908a6e478c9", "filename": "libstdc++-v3/libsupc++/eh_alloc.cc", "status": "modified", "additions": 6, "deletions": 1, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f847167e3d5c4864f64bd950a6a0d478a6730def/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_alloc.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f847167e3d5c4864f64bd950a6a0d478a6730def/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_alloc.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Flibsupc%2B%2B%2Feh_alloc.cc?ref=f847167e3d5c4864f64bd950a6a0d478a6730def", "patch": "@@ -113,19 +113,24 @@ __cxa_allocate_exception(std::size_t thrown_size)\n       bitmask_type used = emergency_used;\n       unsigned int which = 0;\n \n+      if (thrown_size > EMERGENCY_OBJ_SIZE)\n+\tgoto failed;\n       while (used & 1)\n \t{\n \t  used >>= 1;\n \t  if (++which >= EMERGENCY_OBJ_COUNT)\n-\t    std::terminate ();\n+\t    goto failed;\n \t}\n \n       emergency_used |= (bitmask_type)1 << which;\n       ret = &emergency_buffer[which][0];\n \n+    failed:;\n #ifdef __GTHREADS\n       __gthread_mutex_unlock (&emergency_mutex);\n #endif\n+      if (!ret)\n+\tstd::terminate ();\n     }\n \n   memset (ret, 0, sizeof (__cxa_exception));"}]}