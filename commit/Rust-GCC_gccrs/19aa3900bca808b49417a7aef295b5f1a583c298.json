{"sha": "19aa3900bca808b49417a7aef295b5f1a583c298", "node_id": "C_kwDOANBUbNoAKDE5YWEzOTAwYmNhODA4YjQ5NDE3YTdhZWYyOTViNWYxYTU4M2MyOTg", "commit": {"author": {"name": "Junxian Zhu", "email": "zhujunxian@oss.cipunited.com", "date": "2023-02-17T08:35:56Z"}, "committer": {"name": "YunQiang Su", "email": "yunqiang.su@cipunited.com", "date": "2023-02-24T03:25:32Z"}, "message": "MIPS: Add pattern for clo\n\ngcc/ChangeLog:\n\n\t* config/mips/mips.md (*clo<mode>2): New pattern.\n\ngcc/testsuite/ChangeLog:\n\n\t* gcc.target/mips/clz.c: New test.\n\t* gcc.target/mips/clo.c: New test.\n\t* gcc.target/mips/mips.exp: New option HAS_CLZ.\n\nSigned-off-by: Junxian Zhu <zhujunxian@oss.cipunited.com>", "tree": {"sha": "c2016bbc6be9bc4c614b0fc4d9e40f731b0fd352", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c2016bbc6be9bc4c614b0fc4d9e40f731b0fd352"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/19aa3900bca808b49417a7aef295b5f1a583c298", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19aa3900bca808b49417a7aef295b5f1a583c298", "html_url": "https://github.com/Rust-GCC/gccrs/commit/19aa3900bca808b49417a7aef295b5f1a583c298", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/19aa3900bca808b49417a7aef295b5f1a583c298/comments", "author": {"login": "HeliC829", "id": 16401013, "node_id": "MDQ6VXNlcjE2NDAxMDEz", "avatar_url": "https://avatars.githubusercontent.com/u/16401013?v=4", "gravatar_id": "", "url": "https://api.github.com/users/HeliC829", "html_url": "https://github.com/HeliC829", "followers_url": "https://api.github.com/users/HeliC829/followers", "following_url": "https://api.github.com/users/HeliC829/following{/other_user}", "gists_url": "https://api.github.com/users/HeliC829/gists{/gist_id}", "starred_url": "https://api.github.com/users/HeliC829/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/HeliC829/subscriptions", "organizations_url": "https://api.github.com/users/HeliC829/orgs", "repos_url": "https://api.github.com/users/HeliC829/repos", "events_url": "https://api.github.com/users/HeliC829/events{/privacy}", "received_events_url": "https://api.github.com/users/HeliC829/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a3a45f0b145ae9381ce3daa75db17c43a76ec7fd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a3a45f0b145ae9381ce3daa75db17c43a76ec7fd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a3a45f0b145ae9381ce3daa75db17c43a76ec7fd"}], "stats": {"total": 33, "additions": 33, "deletions": 0}, "files": [{"sha": "ac1d77afc7d126d43634a177ea57d75b35c2bd31", "filename": "gcc/config/mips/mips.md", "status": "modified", "additions": 9, "deletions": 0, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Fconfig%2Fmips%2Fmips.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Fconfig%2Fmips%2Fmips.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fmips%2Fmips.md?ref=19aa3900bca808b49417a7aef295b5f1a583c298", "patch": "@@ -3166,6 +3166,15 @@\n   [(set_attr \"type\" \"clz\")\n    (set_attr \"mode\" \"<MODE>\")])\n \n+\n+(define_insn \"*clo<mode>2\"\n+  [(set (match_operand:GPR 0 \"register_operand\" \"=d\")\n+\t(clz:GPR (not:GPR (match_operand:GPR 1 \"register_operand\" \"d\"))))]\n+  \"ISA_HAS_CLZ_CLO\"\n+  \"<d>clo\\t%0,%1\"\n+  [(set_attr \"type\" \"clz\")\n+   (set_attr \"mode\" \"<MODE>\")])\n+\n ;;\n ;;  ...................\n ;;"}, {"sha": "91f29a1322a5063ce39cdc1ee992610524411400", "filename": "gcc/testsuite/gcc.target/mips/clo.c", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fclo.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fclo.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fclo.c?ref=19aa3900bca808b49417a7aef295b5f1a583c298", "patch": "@@ -0,0 +1,11 @@\n+/* { dg-do compile } */\n+/* { dg-options \"(HAS_CLZ)\" } */\n+/* { dg-skip-if \"code quality test\" { *-*-* } { \"-O0\" } { \"\" } } */\n+\n+NOMIPS16 unsigned int foo(unsigned int x)\n+{\n+  return  __builtin_clz (~x);\n+}\n+\n+/* { dg-final { scan-assembler-not \"\\tclz\\t\" } } */\n+/* { dg-final { scan-assembler \"\\tclo\\t\" } } */"}, {"sha": "74e6edb90aa01fec9acd55c1e4df04a7fd98ccbf", "filename": "gcc/testsuite/gcc.target/mips/clz.c", "status": "added", "additions": 10, "deletions": 0, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fclz.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fclz.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fclz.c?ref=19aa3900bca808b49417a7aef295b5f1a583c298", "patch": "@@ -0,0 +1,10 @@\n+/* { dg-do compile } */\n+/* { dg-options \"(HAS_CLZ)\" } */\n+/* { dg-skip-if \"code quality test\" { *-*-* } { \"-O0\" } { \"\" } } */\n+\n+NOMIPS16 unsigned int foo(unsigned int x)\n+{\n+  return  __builtin_clz (x);\n+}\n+\n+/* { dg-final { scan-assembler \"\\tclz\\t\" } } */"}, {"sha": "ac3ab12954175a0d096757e6b213ea2ec544a732", "filename": "gcc/testsuite/gcc.target/mips/mips.exp", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/19aa3900bca808b49417a7aef295b5f1a583c298/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fmips%2Fmips.exp?ref=19aa3900bca808b49417a7aef295b5f1a583c298", "patch": "@@ -252,6 +252,7 @@ set mips_option_groups {\n     warnings \"-w\"\n     dump \"-fdump-.*\"\n     ins \"HAS_INS\"\n+\tclz \"HAS_CLZ\"\n     dmul \"NOT_HAS_DMUL\"\n     ldc \"HAS_LDC\"\n     movn \"HAS_MOVN\"\n@@ -1198,11 +1199,13 @@ proc mips-dg-options { args } {\n \t#\n         #   - paired-single instructions(*)\n         #   - odd numbered single precision registers\n+\t\t#   - clz clo instructions\n         #\n \t# (*) Note that we don't support MIPS V at the moment.\n \t} elseif { $isa_rev < 1\n \t\t   && ([mips_have_test_option_p options \"-mpaired-single\"]\n \t\t       || ([mips_have_test_option_p options \"-modd-spreg\"]\n+\t\t\t   || [mips_have_test_option_p options \"HAS_CLZ\"]\n \t\t\t   && ![mips_have_test_option_p options \"-mfp64\"]))} {\n \t    if { $gp_size == 32 } {\n \t\tmips_make_test_option options \"-mips32\""}]}