{"sha": "15317f8925397dd1fa38293d98464c34b8915207", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTUzMTdmODkyNTM5N2RkMWZhMzgyOTNkOTg0NjRjMzRiODkxNTIwNw==", "commit": {"author": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-11-28T23:03:16Z"}, "committer": {"name": "Jim Wilson", "email": "wilson@gcc.gnu.org", "date": "1994-11-28T23:03:16Z"}, "message": "(finish_decl): Use DECL_CONTEXT instead of\ncurrent_binding_level to identify file-scope variables.\n\nFrom-SVN: r8565", "tree": {"sha": "c7f84cb7fb58b5b8722bca33b954106dca9bebe3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c7f84cb7fb58b5b8722bca33b954106dca9bebe3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/15317f8925397dd1fa38293d98464c34b8915207", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15317f8925397dd1fa38293d98464c34b8915207", "html_url": "https://github.com/Rust-GCC/gccrs/commit/15317f8925397dd1fa38293d98464c34b8915207", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/15317f8925397dd1fa38293d98464c34b8915207/comments", "author": null, "committer": null, "parents": [{"sha": "ad6267596c510660a93889a53319e9f051cab39a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ad6267596c510660a93889a53319e9f051cab39a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ad6267596c510660a93889a53319e9f051cab39a"}], "stats": {"total": 17, "additions": 8, "deletions": 9}, "files": [{"sha": "0f477776d3c514b37f420eacaddd185841b7c306", "filename": "gcc/c-decl.c", "status": "modified", "additions": 8, "deletions": 9, "changes": 17, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/15317f8925397dd1fa38293d98464c34b8915207/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/15317f8925397dd1fa38293d98464c34b8915207/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=15317f8925397dd1fa38293d98464c34b8915207", "patch": "@@ -3586,8 +3586,10 @@ finish_decl (decl, init, asmspec_tree)\n \t\t   Also if it is not file scope.\n \t\t   Otherwise, let it through, but if it is not `extern'\n \t\t   then it may cause an error message later.  */\n-\t\t(DECL_INITIAL (decl) != 0\n-\t\t || current_binding_level != global_binding_level)\n+\t      /* We must use DECL_CONTEXT instead of current_binding_level,\n+\t\t because a duplicate_decls call could have changed the binding\n+\t\t level of this decl.  */\n+\t\t(DECL_INITIAL (decl) != 0 || DECL_CONTEXT (decl) != 0)\n \t      :\n \t\t/* An automatic variable with an incomplete type\n \t\t   is an error.  */\n@@ -3629,20 +3631,18 @@ finish_decl (decl, init, asmspec_tree)\n \t  end_temporary_allocation ();\n \t  /* This is a no-op in c-lang.c or something real in objc-actions.c.  */\n \t  maybe_objc_check_decl (decl);\n-\t  rest_of_decl_compilation (decl, asmspec,\n-\t\t\t\t    current_binding_level == global_binding_level,\n+\t  rest_of_decl_compilation (decl, asmspec, DECL_CONTEXT (decl) == 0,\n \t\t\t\t    0);\n \t  pop_obstacks ();\n \t}\n       else\n \t{\n \t  /* This is a no-op in c-lang.c or something real in objc-actions.c.  */\n \t  maybe_objc_check_decl (decl);\n-\t  rest_of_decl_compilation (decl, asmspec,\n-\t\t\t\t    current_binding_level == global_binding_level,\n+\t  rest_of_decl_compilation (decl, asmspec, DECL_CONTEXT (decl) == 0,\n \t\t\t\t    0);\n \t}\n-      if (current_binding_level != global_binding_level)\n+      if (DECL_CONTEXT (decl) != 0)\n \t{\n \t  /* Recompute the RTL of a local array now\n \t     if it used to be an incomplete type.  */\n@@ -3666,8 +3666,7 @@ finish_decl (decl, init, asmspec_tree)\n     {\n       /* This is a no-op in c-lang.c or something real in objc-actions.c.  */\n       maybe_objc_check_decl (decl);\n-      rest_of_decl_compilation (decl, NULL_PTR,\n-\t\t\t\tcurrent_binding_level == global_binding_level,\n+      rest_of_decl_compilation (decl, NULL_PTR, DECL_CONTEXT (decl) == 0,\n \t\t\t\t0);\n     }\n "}]}