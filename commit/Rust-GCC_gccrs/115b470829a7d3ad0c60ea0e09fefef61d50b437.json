{"sha": "115b470829a7d3ad0c60ea0e09fefef61d50b437", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MTE1YjQ3MDgyOWE3ZDNhZDBjNjBlYTBlMDlmZWZlZjYxZDUwYjQzNw==", "commit": {"author": {"name": "Kyrylo Tkachov", "email": "kyrylo.tkachov@arm.com", "date": "2018-09-14T13:13:14Z"}, "committer": {"name": "Kyrylo Tkachov", "email": "ktkachov@gcc.gnu.org", "date": "2018-09-14T13:13:14Z"}, "message": "[tree-ssa-mathopts] PR tree-optimization/87259: Call execute_cse_reciprocals_1 before trying optimize_recip_sqrt\n\n\tPR tree-optimization/87259\n\tPR lto/87283\n\t(pass_cse_reciprocals::execute): Run optimize_recip_sqrt after\n\texecute_cse_reciprocals_1 has tried transforming.\n\n\tPR tree-optimization/87259\n\t* gcc.dg/pr87259.c: New test.\n\nFrom-SVN: r264312", "tree": {"sha": "9263b042d8a51e68a058597e8972bae8b64c3ca8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9263b042d8a51e68a058597e8972bae8b64c3ca8"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/115b470829a7d3ad0c60ea0e09fefef61d50b437", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/115b470829a7d3ad0c60ea0e09fefef61d50b437", "html_url": "https://github.com/Rust-GCC/gccrs/commit/115b470829a7d3ad0c60ea0e09fefef61d50b437", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/115b470829a7d3ad0c60ea0e09fefef61d50b437/comments", "author": {"login": "ktkachov-arm", "id": 74917949, "node_id": "MDQ6VXNlcjc0OTE3OTQ5", "avatar_url": "https://avatars.githubusercontent.com/u/74917949?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ktkachov-arm", "html_url": "https://github.com/ktkachov-arm", "followers_url": "https://api.github.com/users/ktkachov-arm/followers", "following_url": "https://api.github.com/users/ktkachov-arm/following{/other_user}", "gists_url": "https://api.github.com/users/ktkachov-arm/gists{/gist_id}", "starred_url": "https://api.github.com/users/ktkachov-arm/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ktkachov-arm/subscriptions", "organizations_url": "https://api.github.com/users/ktkachov-arm/orgs", "repos_url": "https://api.github.com/users/ktkachov-arm/repos", "events_url": "https://api.github.com/users/ktkachov-arm/events{/privacy}", "received_events_url": "https://api.github.com/users/ktkachov-arm/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "310ee703a20393d2278ff4c08e6f97bd16198564", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/310ee703a20393d2278ff4c08e6f97bd16198564", "html_url": "https://github.com/Rust-GCC/gccrs/commit/310ee703a20393d2278ff4c08e6f97bd16198564"}], "stats": {"total": 32, "additions": 29, "deletions": 3}, "files": [{"sha": "a9d008dea01ac9bba5fcfa823cc681ebcf5d06ab", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=115b470829a7d3ad0c60ea0e09fefef61d50b437", "patch": "@@ -1,3 +1,10 @@\n+2018-09-14  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR tree-optimization/87259\n+\tPR lto/87283\n+\t(pass_cse_reciprocals::execute): Run optimize_recip_sqrt after\n+\texecute_cse_reciprocals_1 has tried transforming.\n+\n 2018-09-14  Aldy Hernandez  <aldyh@redhat.com>\n \n \t* tree-vrp.c (extract_range_from_binary_expr_1): Normalize"}, {"sha": "f6ac25f483cd30b5abda61b96ed6d13c0e3bd60f", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=115b470829a7d3ad0c60ea0e09fefef61d50b437", "patch": "@@ -1,3 +1,8 @@\n+2018-09-14  Kyrylo Tkachov  <kyrylo.tkachov@arm.com>\n+\n+\tPR tree-optimization/87259\n+\t* gcc.dg/pr87259.c: New test.\n+\n 2018-09-13  Martin Sebor  <msebor@redhat.com>\n \t    Jeff Law  <law@redhat.com>\n "}, {"sha": "527a60a37adb520591ff40a52a12706aa1582068", "filename": "gcc/testsuite/gcc.dg/pr87259.c", "status": "added", "additions": 14, "deletions": 0, "changes": 14, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2Ftestsuite%2Fgcc.dg%2Fpr87259.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2Ftestsuite%2Fgcc.dg%2Fpr87259.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Fpr87259.c?ref=115b470829a7d3ad0c60ea0e09fefef61d50b437", "patch": "@@ -0,0 +1,14 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-Ofast\" } */\n+\n+int a, b, c;\n+int *e;\n+float f;\n+void h() {\n+  for (int g;;) {\n+    float d = b, i = 0 / f, j = a / (f * f), k, l = 0 / d;\n+    c = i + j;\n+    g = l;\n+    e[g] = c / d * k / d;\n+  }\n+}"}, {"sha": "e5aa5310e585e4d3f7e9e74299b10c0c7849f7ce", "filename": "gcc/tree-ssa-math-opts.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2Ftree-ssa-math-opts.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/115b470829a7d3ad0c60ea0e09fefef61d50b437/gcc%2Ftree-ssa-math-opts.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-math-opts.c?ref=115b470829a7d3ad0c60ea0e09fefef61d50b437", "patch": "@@ -547,7 +547,7 @@ free_bb (struct occurrence *occ)\n    depending on the uses of x, r1, r2.  This removes one multiplication and\n    allows the sqrt and division operations to execute in parallel.\n    DEF_GSI is the gsi of the initial division by sqrt that defines\n-   DEF (x in the example abovs).  */\n+   DEF (x in the example above).  */\n \n static void\n optimize_recip_sqrt (gimple_stmt_iterator *def_gsi, tree def)\n@@ -947,13 +947,13 @@ pass_cse_reciprocals::execute (function *fun)\n \t      && FLOAT_TYPE_P (TREE_TYPE (def))\n \t      && TREE_CODE (def) == SSA_NAME)\n \t    {\n+\t      execute_cse_reciprocals_1 (&gsi, def);\n+\t      stmt = gsi_stmt (gsi);\n \t      if (flag_unsafe_math_optimizations\n \t\t  && is_gimple_assign (stmt)\n \t\t  && !stmt_can_throw_internal (stmt)\n \t\t  && gimple_assign_rhs_code (stmt) == RDIV_EXPR)\n \t\toptimize_recip_sqrt (&gsi, def);\n-\t      else\n-\t\texecute_cse_reciprocals_1 (&gsi, def);\n \t    }\n \t}\n "}]}