{"sha": "95d81ba561d69d63c65ac00c059555ce33d6e77a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OTVkODFiYTU2MWQ2OWQ2M2M2NWFjMDBjMDU5NTU1Y2UzM2Q2ZTc3YQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-04-13T14:13:06Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-04-13T14:13:06Z"}, "message": "ipa-profie.c (ipa_profile): Check number of parameters and possible polymorphic call targets before...\n\n\t* ipa-profie.c (ipa_profile): Check number of parameters\n\tand possible polymorphic call targets before\n\tdevirtualizing.\n\nFrom-SVN: r222053", "tree": {"sha": "74982fec36d08d32de9a64445a9832adb8ee9bf9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/74982fec36d08d32de9a64445a9832adb8ee9bf9"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/95d81ba561d69d63c65ac00c059555ce33d6e77a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95d81ba561d69d63c65ac00c059555ce33d6e77a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/95d81ba561d69d63c65ac00c059555ce33d6e77a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/95d81ba561d69d63c65ac00c059555ce33d6e77a/comments", "author": null, "committer": null, "parents": [{"sha": "9586973b6089e2a7782b83bd7457170ed7082ad4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9586973b6089e2a7782b83bd7457170ed7082ad4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9586973b6089e2a7782b83bd7457170ed7082ad4"}], "stats": {"total": 36, "additions": 36, "deletions": 0}, "files": [{"sha": "9dcdea6989a673434d8c76ab5717a80056fd2aa8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95d81ba561d69d63c65ac00c059555ce33d6e77a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95d81ba561d69d63c65ac00c059555ce33d6e77a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=95d81ba561d69d63c65ac00c059555ce33d6e77a", "patch": "@@ -1,3 +1,9 @@\n+2015-04-12  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* ipa-profie.c (ipa_profile): Check number of parameters\n+\tand possible polymorphic call targets before\n+\tdevirtualizing.\n+\n 2015-04-13  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* config/i386/i386.md (*bmi2_umul<mode><dwi>3_1): Merge from"}, {"sha": "e9f937fdf3bc2c80ccd56fd2abb8ea73db0d415c", "filename": "gcc/ipa-profile.c", "status": "modified", "additions": 30, "deletions": 0, "changes": 30, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/95d81ba561d69d63c65ac00c059555ce33d6e77a/gcc%2Fipa-profile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/95d81ba561d69d63c65ac00c059555ce33d6e77a/gcc%2Fipa-profile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fipa-profile.c?ref=95d81ba561d69d63c65ac00c059555ce33d6e77a", "patch": "@@ -524,6 +524,7 @@ ipa_profile (void)\n   gcov_type overall_time = 0, cutoff = 0, cumulated = 0, overall_size = 0;\n   struct cgraph_node *n,*n2;\n   int nindirect = 0, ncommon = 0, nunknown = 0, nuseless = 0, nconverted = 0;\n+  int nmismatch = 0, nimpossible = 0;\n   bool node_map_initialized = false;\n \n   if (dump_file)\n@@ -651,6 +652,31 @@ ipa_profile (void)\n \t\t\t\t \"Not speculating: target is overwritable \"\n \t\t\t\t \"and can be discarded.\\n\");\n \t\t    }\n+\t\t  else if (ipa_node_params_sum && ipa_edge_args_vector\n+\t\t\t   && !IPA_NODE_REF (n2)->descriptors.is_empty ()\n+\t\t\t   && ipa_get_param_count (IPA_NODE_REF (n2))\n+\t\t\t      != ipa_get_cs_argument_count (IPA_EDGE_REF (e))\n+\t\t\t    && (ipa_get_param_count (IPA_NODE_REF (n2))\n+\t\t\t\t>= ipa_get_cs_argument_count (IPA_EDGE_REF (e))\n+\t\t\t\t|| !stdarg_p (TREE_TYPE (n2->decl))))\n+\t\t    {\n+\t\t      nmismatch++;\n+\t\t      if (dump_file)\n+\t\t\tfprintf (dump_file,\n+\t\t\t\t \"Not speculating: \"\n+\t\t\t\t \"parameter count mistmatch\\n\");\n+\t\t    }\n+\t\t  else if (e->indirect_info->polymorphic\n+\t\t\t   && !opt_for_fn (n->decl, flag_devirtualize)\n+\t\t\t   && !possible_polymorphic_call_target_p (e, n2))\n+\t\t    {\n+\t\t      nimpossible++;\n+\t\t      if (dump_file)\n+\t\t\tfprintf (dump_file,\n+\t\t\t\t \"Not speculating: \"\n+\t\t\t\t \"function is not in the polymorphic \"\n+\t\t\t\t \"call target list\\n\");\n+\t\t    }\n \t\t  else\n \t\t    {\n \t\t      /* Target may be overwritable, but profile says that\n@@ -693,11 +719,15 @@ ipa_profile (void)\n \t     \"%i indirect calls trained.\\n\"\n \t     \"%i (%3.2f%%) have common target.\\n\"\n \t     \"%i (%3.2f%%) targets was not found.\\n\"\n+\t     \"%i (%3.2f%%) targets had parameter count mismatch.\\n\"\n+\t     \"%i (%3.2f%%) targets was not in polymorphic call target list.\\n\"\n \t     \"%i (%3.2f%%) speculations seems useless.\\n\"\n \t     \"%i (%3.2f%%) speculations produced.\\n\",\n \t     nindirect,\n \t     ncommon, ncommon * 100.0 / nindirect,\n \t     nunknown, nunknown * 100.0 / nindirect,\n+\t     nmismatch, nmismatch * 100.0 / nindirect,\n+\t     nimpossible, nimpossible * 100.0 / nindirect,\n \t     nuseless, nuseless * 100.0 / nindirect,\n \t     nconverted, nconverted * 100.0 / nindirect);\n "}]}