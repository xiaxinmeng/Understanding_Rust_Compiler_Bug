{"sha": "72267417bd5d1072812339dee3bf426b686f81b6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzIyNjc0MTdiZDVkMTA3MjgxMjMzOWRlZTNiZjQyNmI2ODZmODFiNg==", "commit": {"author": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-04-23T09:48:55Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-04-23T09:48:55Z"}, "message": "[multiple changes]\n\n2013-04-23  Robert Dewar  <dewar@adacore.com>\n\n\t* xoscons.adb: Minor reformatting.\n\n2013-04-23  Hristian Kirtchev  <kirtchev@adacore.com>\n\n\t* sem_prag.adb (Check_Mode): Ensure that a\n\tself-referential output appears in both input and output lists of\n\tthe subprogram as categorized by aspect Global.\n\t(Check_Usage): Rename formal parameters to better illustrate their\n\tfunction. Update all uses of the said formals.\n\n2013-04-23  Thomas Quinot  <quinot@adacore.com>\n\n\t* exp_util.adb, exp_util.ads (Fully_Qualified_Name_String): New\n\tparameter Append_NUL to make NUL-termination optional.\n\t* exp_dist.adb: Consistently use the above throughout instead of\n\tGet_Library_Unit_Name_String.\n\nFrom-SVN: r198183", "tree": {"sha": "3f9d224166c814f6fb0ac816eb4db4091da87f3d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3f9d224166c814f6fb0ac816eb4db4091da87f3d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72267417bd5d1072812339dee3bf426b686f81b6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72267417bd5d1072812339dee3bf426b686f81b6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72267417bd5d1072812339dee3bf426b686f81b6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72267417bd5d1072812339dee3bf426b686f81b6/comments", "author": null, "committer": null, "parents": [{"sha": "2fabf41e29b234852ef2d099977c27af9a24ec3f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2fabf41e29b234852ef2d099977c27af9a24ec3f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2fabf41e29b234852ef2d099977c27af9a24ec3f"}], "stats": {"total": 109, "additions": 65, "deletions": 44}, "files": [{"sha": "c6d114da28b8ec80399753825fd35b5a104ad059", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=72267417bd5d1072812339dee3bf426b686f81b6", "patch": "@@ -1,3 +1,22 @@\n+2013-04-23  Robert Dewar  <dewar@adacore.com>\n+\n+\t* xoscons.adb: Minor reformatting.\n+\n+2013-04-23  Hristian Kirtchev  <kirtchev@adacore.com>\n+\n+\t* sem_prag.adb (Check_Mode): Ensure that a\n+\tself-referential output appears in both input and output lists of\n+\tthe subprogram as categorized by aspect Global.\n+\t(Check_Usage): Rename formal parameters to better illustrate their\n+\tfunction. Update all uses of the said formals.\n+\n+2013-04-23  Thomas Quinot  <quinot@adacore.com>\n+\n+\t* exp_util.adb, exp_util.ads (Fully_Qualified_Name_String): New\n+\tparameter Append_NUL to make NUL-termination optional.\n+\t* exp_dist.adb: Consistently use the above throughout instead of\n+\tGet_Library_Unit_Name_String.\n+\n 2013-04-23  Robert Dewar  <dewar@adacore.com>\n \n \t* sem_util.adb, sem_res.adb, prj-tree.adb, prj-tree.ads: Minor"}, {"sha": "364330339fe09ce84833e90ab27a8f4cdd354b9d", "filename": "gcc/ada/exp_dist.adb", "status": "modified", "additions": 21, "deletions": 28, "changes": 49, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fexp_dist.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fexp_dist.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_dist.adb?ref=72267417bd5d1072812339dee3bf426b686f81b6", "patch": "@@ -2318,7 +2318,7 @@ package body Exp_Dist is\n \n    procedure Build_Passive_Partition_Stub (U : Node_Id) is\n       Pkg_Spec : Node_Id;\n-      Pkg_Name : String_Id;\n+      Pkg_Ent  : Entity_Id;\n       L        : List_Id;\n       Reg      : Node_Id;\n       Loc      : constant Source_Ptr := Sloc (U);\n@@ -2343,18 +2343,17 @@ package body Exp_Dist is\n          Pkg_Spec := Parent (Corresponding_Spec (U));\n          L := Declarations (U);\n       end if;\n+      Pkg_Ent := Defining_Entity (Pkg_Spec);\n \n-      Get_Library_Unit_Name_String (Pkg_Spec);\n-      Pkg_Name := String_From_Name_Buffer;\n       Reg :=\n         Make_Procedure_Call_Statement (Loc,\n           Name                   =>\n             New_Occurrence_Of (RTE (RE_Register_Passive_Package), Loc),\n           Parameter_Associations => New_List (\n-            Make_String_Literal (Loc, Pkg_Name),\n+            Make_String_Literal (Loc,\n+              Fully_Qualified_Name_String (Pkg_Ent, Append_NUL => False)),\n             Make_Attribute_Reference (Loc,\n-              Prefix         =>\n-                New_Occurrence_Of (Defining_Entity (Pkg_Spec), Loc),\n+              Prefix         => New_Occurrence_Of (Pkg_Ent, Loc),\n               Attribute_Name => Name_Version)));\n       Append_To (L, Reg);\n       Analyze (Reg);\n@@ -4111,13 +4110,13 @@ package body Exp_Dist is\n          Append_To (Decls, Pkg_RPC_Receiver_Body);\n          Analyze (Last (Decls));\n \n-         Get_Library_Unit_Name_String (Pkg_Spec);\n-\n          --  Name\n \n          Append_To (Register_Pkg_Actuals,\n            Make_String_Literal (Loc,\n-             Strval => String_From_Name_Buffer));\n+             Strval =>\n+               Fully_Qualified_Name_String\n+                 (Defining_Entity (Pkg_Spec), Append_NUL => False)));\n \n          --  Receiver\n \n@@ -5591,7 +5590,7 @@ package body Exp_Dist is\n                --  Name\n \n                 Make_String_Literal (Loc,\n-                  Fully_Qualified_Name_String (Desig)),\n+                  Fully_Qualified_Name_String (Desig, Append_NUL => False)),\n \n                --  Handler\n \n@@ -5938,7 +5937,8 @@ package body Exp_Dist is\n                      New_Occurrence_Of (RACW_Parameter, Loc)),\n                    Make_String_Literal (Loc,\n                      Strval => Fully_Qualified_Name_String\n-                                 (Etype (Designated_Type (RACW_Type)))),\n+                                 (Etype (Designated_Type (RACW_Type)),\n+                                  Append_NUL => False)),\n                    Build_Stub_Tag (Loc, RACW_Type),\n                    New_Occurrence_Of (Boolean_Literals (Is_RAS), Loc),\n                    Make_Attribute_Reference (Loc,\n@@ -6134,7 +6134,8 @@ package body Exp_Dist is\n                    Unchecked_Convert_To (RTE (RE_Address), Object),\n                   Make_String_Literal (Loc,\n                     Strval => Fully_Qualified_Name_String\n-                                (Etype (Designated_Type (RACW_Type)))),\n+                                (Etype (Designated_Type (RACW_Type)),\n+                                 Append_NUL => False)),\n                   Build_Stub_Tag (Loc, RACW_Type),\n                   New_Occurrence_Of (Boolean_Literals (Is_RAS), Loc),\n                   Make_Attribute_Reference (Loc,\n@@ -7069,13 +7070,13 @@ package body Exp_Dist is\n          Append_To (Decls, Pkg_RPC_Receiver_Object);\n          Analyze (Last (Decls));\n \n-         Get_Library_Unit_Name_String (Pkg_Spec);\n-\n          --  Name\n \n          Append_To (Register_Pkg_Actuals,\n            Make_String_Literal (Loc,\n-             Strval => String_From_Name_Buffer));\n+             Strval =>\n+               Fully_Qualified_Name_String\n+                 (Defining_Entity (Pkg_Spec), Append_NUL => False)));\n \n          --  Version\n \n@@ -9210,20 +9211,12 @@ package body Exp_Dist is\n             Repo_Id_Str : out String_Id)\n          is\n          begin\n+            Name_Str := Fully_Qualified_Name_String (E, Append_NUL => False);\n             Start_String;\n             Store_String_Chars (\"DSA:\");\n-            Get_Library_Unit_Name_String (Scope (E));\n-            Store_String_Chars\n-              (Name_Buffer (Name_Buffer'First ..\n-               Name_Buffer'First + Name_Len - 1));\n-            Store_String_Char ('.');\n-            Get_Name_String (Chars (E));\n-            Store_String_Chars\n-              (Name_Buffer (Name_Buffer'First ..\n-               Name_Buffer'First + Name_Len - 1));\n+            Store_String_Chars (Name_Str);\n             Store_String_Chars (\":1.0\");\n             Repo_Id_Str := End_String;\n-            Name_Str    := String_From_Name_Buffer;\n          end Build_Name_And_Repository_Id;\n \n          -----------------------\n@@ -11134,11 +11127,11 @@ package body Exp_Dist is\n       Package_Spec : Node_Id) return Node_Id\n    is\n       Inst     : Node_Id;\n-      Pkg_Name : String_Id;\n+      Pkg_Name : constant String_Id :=\n+        Fully_Qualified_Name_String\n+          (Defining_Entity (Package_Spec), Append_NUL => False);\n \n    begin\n-      Get_Library_Unit_Name_String (Package_Spec);\n-      Pkg_Name := String_From_Name_Buffer;\n       Inst :=\n         Make_Package_Instantiation (Loc,\n           Defining_Unit_Name   => Make_Temporary (Loc, 'R'),"}, {"sha": "c38b02317b439435ceb96f6cab832c4823124a6e", "filename": "gcc/ada/exp_util.adb", "status": "modified", "additions": 7, "deletions": 2, "changes": 9, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fexp_util.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fexp_util.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.adb?ref=72267417bd5d1072812339dee3bf426b686f81b6", "patch": "@@ -2535,7 +2535,10 @@ package body Exp_Util is\n    -- Fully_Qualified_Name_String --\n    ---------------------------------\n \n-   function Fully_Qualified_Name_String (E : Entity_Id) return String_Id is\n+   function Fully_Qualified_Name_String\n+     (E          : Entity_Id;\n+      Append_NUL : Boolean := True) return String_Id\n+   is\n       procedure Internal_Full_Qualified_Name (E : Entity_Id);\n       --  Compute recursively the qualified name without NUL at the end, adding\n       --  it to the currently started string being generated\n@@ -2583,7 +2586,9 @@ package body Exp_Util is\n    begin\n       Start_String;\n       Internal_Full_Qualified_Name (E);\n-      Store_String_Char (Get_Char_Code (ASCII.NUL));\n+      if Append_NUL then\n+         Store_String_Char (Get_Char_Code (ASCII.NUL));\n+      end if;\n       return End_String;\n    end Fully_Qualified_Name_String;\n "}, {"sha": "f83aebe101576f06a3c960d6f1ef82753b6a6fed", "filename": "gcc/ada/exp_util.ads", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fexp_util.ads", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fexp_util.ads", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fexp_util.ads?ref=72267417bd5d1072812339dee3bf426b686f81b6", "patch": "@@ -442,10 +442,12 @@ package Exp_Util is\n    --  Force_Evaluation further guarantees that all evaluations will yield\n    --  the same result.\n \n-   function Fully_Qualified_Name_String (E : Entity_Id) return String_Id;\n+   function Fully_Qualified_Name_String\n+     (E          : Entity_Id;\n+      Append_NUL : Boolean := True) return String_Id;\n    --  Generates the string literal corresponding to the fully qualified name\n    --  of entity E, in all upper case, with an ASCII.NUL appended at the end\n-   --  of the name.\n+   --  of the name if Append_NUL is True.\n \n    procedure Generate_Poll_Call (N : Node_Id);\n    --  If polling is active, then a call to the Poll routine is built,"}, {"sha": "373828e491e94f07b3f9827796eea24020e9aa30", "filename": "gcc/ada/sem_prag.adb", "status": "modified", "additions": 14, "deletions": 11, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fsem_prag.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fsem_prag.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_prag.adb?ref=72267417bd5d1072812339dee3bf426b686f81b6", "patch": "@@ -9365,10 +9365,10 @@ package body Sem_Prag is\n             --  dependency clause has operator \"+\".\n \n             procedure Check_Usage\n-              (Subp_List : Elist_Id;\n-               Item_List : Elist_Id;\n-               Is_Input  : Boolean);\n-            --  Verify that all items from list Subp_List appear in Item_List.\n+              (Subp_Items : Elist_Id;\n+               Used_Items : Elist_Id;\n+               Is_Input   : Boolean);\n+            --  Verify that all items from Subp_Items appear in Used_Items.\n             --  Emit an error if this is not the case.\n \n             procedure Collect_Subprogram_Inputs_Outputs;\n@@ -9765,7 +9765,10 @@ package body Sem_Prag is\n \n                   if Ekind_In (Item_Id, E_Abstract_State, E_Variable) then\n                      if Global_Seen\n-                       and then not Appears_In (Subp_Inputs, Item_Id)\n+                       and then not\n+                         (Appears_In (Subp_Inputs, Item_Id)\n+                            and then\n+                          Appears_In (Subp_Outputs, Item_Id))\n                      then\n                         Error_Msg_NE\n                           (\"item & must have mode in out\", Item, Item_Id);\n@@ -9795,9 +9798,9 @@ package body Sem_Prag is\n             -----------------\n \n             procedure Check_Usage\n-              (Subp_List : Elist_Id;\n-               Item_List : Elist_Id;\n-               Is_Input  : Boolean)\n+              (Subp_Items : Elist_Id;\n+               Used_Items : Elist_Id;\n+               Is_Input   : Boolean)\n             is\n                procedure Usage_Error (Item : Node_Id; Item_Id : Entity_Id);\n                --  Emit an error concerning the erroneous usage of an item\n@@ -9828,14 +9831,14 @@ package body Sem_Prag is\n             --  Start of processing for Check_Usage\n \n             begin\n-               if No (Subp_List) then\n+               if No (Subp_Items) then\n                   return;\n                end if;\n \n                --  Each input or output of the subprogram must appear in a\n                --  dependency relation.\n \n-               Elmt := First_Elmt (Subp_List);\n+               Elmt := First_Elmt (Subp_Items);\n                while Present (Elmt) loop\n                   Item := Node (Elmt);\n \n@@ -9847,7 +9850,7 @@ package body Sem_Prag is\n \n                   --  The item does not appear in a dependency\n \n-                  if not Contains (Item_List, Item_Id) then\n+                  if not Contains (Used_Items, Item_Id) then\n                      if Is_Formal (Item_Id) then\n                         Usage_Error (Item, Item_Id);\n "}, {"sha": "095101f52dc17de5d39bd16f4621360be28fe08d", "filename": "gcc/ada/xoscons.adb", "status": "modified", "additions": 0, "deletions": 1, "changes": 1, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fxoscons.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72267417bd5d1072812339dee3bf426b686f81b6/gcc%2Fada%2Fxoscons.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fxoscons.adb?ref=72267417bd5d1072812339dee3bf426b686f81b6", "patch": "@@ -441,7 +441,6 @@ procedure XOSCons is\n       Ada_Ofile, C_Ofile : Sfile;\n       Current_Line       : in out Integer)\n    is\n-\n       function Get_Value (Name : String) return Int_Value_Type;\n       --  Returns the value of the variable Name\n "}]}