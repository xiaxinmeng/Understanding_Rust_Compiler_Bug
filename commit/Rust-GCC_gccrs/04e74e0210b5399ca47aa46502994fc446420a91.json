{"sha": "04e74e0210b5399ca47aa46502994fc446420a91", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MDRlNzRlMDIxMGI1Mzk5Y2E0N2FhNDY1MDI5OTRmYzQ0NjQyMGE5MQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-08-29T18:45:25Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-08-29T18:45:25Z"}, "message": "re PR fortran/23057 (Fortran common blocks are not described with DW_TAG_common_block)\n\n\tPR fortran/23057\n\t* dwarf2out.c (gen_variable_die): Represent Fortran COMMON vars\n\tas DW_TAG_variable children of DW_TAG_common_block rather than\n\tDW_TAG_member children.  Put DW_AT_external to individual\n\tDW_TAG_variable DIEs, not to DW_TAG_common_block.\n\n\t* gfortran.dg/debug/pr35154-dwarf2.f: Adjust for replacement\n\tof DW_TAG_member with DW_TAG_variable.\n\nFrom-SVN: r139775", "tree": {"sha": "9b29f1b010a25fbdc1725b231713e161b6939314", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9b29f1b010a25fbdc1725b231713e161b6939314"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/04e74e0210b5399ca47aa46502994fc446420a91", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04e74e0210b5399ca47aa46502994fc446420a91", "html_url": "https://github.com/Rust-GCC/gccrs/commit/04e74e0210b5399ca47aa46502994fc446420a91", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/04e74e0210b5399ca47aa46502994fc446420a91/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "25c29c56e24dd8f455b01907005fbdf613ea8aa8", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/25c29c56e24dd8f455b01907005fbdf613ea8aa8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/25c29c56e24dd8f455b01907005fbdf613ea8aa8"}], "stats": {"total": 71, "additions": 53, "deletions": 18}, "files": [{"sha": "9fa3c46f2523d93a2f54404bf052c2d7af6c4132", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=04e74e0210b5399ca47aa46502994fc446420a91", "patch": "@@ -1,5 +1,11 @@\n 2008-08-29  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR fortran/23057\n+\t* dwarf2out.c (gen_variable_die): Represent Fortran COMMON vars\n+\tas DW_TAG_variable children of DW_TAG_common_block rather than\n+\tDW_TAG_member children.  Put DW_AT_external to individual\n+\tDW_TAG_variable DIEs, not to DW_TAG_common_block.\n+\n \t* dwarf2out.c (add_bound_info): If lookup_decl_die failed, try\n \tloc_descriptor_from_tree_1.\n "}, {"sha": "ab9d0dc51d75086fcae0181762ad56db55cf1147", "filename": "gcc/dwarf2out.c", "status": "modified", "additions": 39, "deletions": 16, "changes": 55, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2Fdwarf2out.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2Fdwarf2out.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdwarf2out.c?ref=04e74e0210b5399ca47aa46502994fc446420a91", "patch": "@@ -13531,43 +13531,66 @@ gen_variable_die (tree decl, dw_die_ref context_die)\n     {\n       tree field;\n       dw_die_ref com_die;\n+      dw_loc_descr_ref loc;\n \n-      if (lookup_decl_die (decl))\n-\treturn;\n+      com_die = lookup_decl_die (decl);\n+      if (com_die)\n+\t{\n+\t  if (get_AT (com_die, DW_AT_location) == NULL)\n+\t    {\n+\t      loc = loc_descriptor_from_tree (com_decl);\n+\t      if (loc)\n+\t\t{\n+\t\t  if (off)\n+\t\t    add_loc_descr (&loc, new_loc_descr (DW_OP_plus_uconst,\n+\t\t\t\t\t\t\toff, 0));\n+\t\t  add_AT_loc (com_die, DW_AT_location, loc);\n+\t\t  remove_AT (com_die, DW_AT_declaration);\n+\t\t}\n+\t    }\n+\t  return;\n+\t}\n       field = TREE_OPERAND (DECL_VALUE_EXPR (decl), 0);\n       var_die = lookup_decl_die (com_decl);\n+      loc = loc_descriptor_from_tree (com_decl);\n       if (var_die == NULL)\n \t{\n \t  const char *cnam\n \t    = IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (com_decl));\n-\t  dw_loc_descr_ref loc = loc_descriptor_from_tree (com_decl);\n \n \t  var_die = new_die (DW_TAG_common_block, context_die, decl);\n \t  add_name_and_src_coords_attributes (var_die, com_decl);\n-\t  add_AT_flag (var_die, DW_AT_external, 1);\n \t  if (loc)\n-\t    add_AT_loc (var_die, DW_AT_location, loc);\n+\t    {\n+\t      add_AT_loc (var_die, DW_AT_location, loc);\n+\t      /* Avoid sharing the same loc descriptor between\n+\t\t DW_TAG_common_block and DW_TAG_variable.  */\n+\t      loc = loc_descriptor_from_tree (com_decl);\n+\t    }\n           else if (DECL_EXTERNAL (decl))\n \t    add_AT_flag (var_die, DW_AT_declaration, 1);\n \t  add_pubname_string (cnam, var_die); /* ??? needed? */\n \t  equate_decl_number_to_die (com_decl, var_die);\n \t}\n-      else if (get_AT (var_die, DW_AT_location) == NULL)\n+      else if (get_AT (var_die, DW_AT_location) == NULL && loc)\n \t{\n-\t  dw_loc_descr_ref loc = loc_descriptor_from_tree (com_decl);\n-\n-\t  if (loc)\n-\t    {\n-\t      add_AT_loc (var_die, DW_AT_location, loc);\n-\t      remove_AT (var_die, DW_AT_declaration);\n-\t    }\n+\t  add_AT_loc (var_die, DW_AT_location, loc);\n+\t  loc = loc_descriptor_from_tree (com_decl);\n+\t  remove_AT (var_die, DW_AT_declaration);\n \t}\n-      com_die = new_die (DW_TAG_member, var_die, decl);\n+      com_die = new_die (DW_TAG_variable, var_die, decl);\n       add_name_and_src_coords_attributes (com_die, decl);\n       add_type_attribute (com_die, TREE_TYPE (decl), TREE_READONLY (decl),\n \t\t\t  TREE_THIS_VOLATILE (decl), context_die);\n-      add_AT_loc (com_die, DW_AT_data_member_location,\n-\t\t  int_loc_descriptor (off));\n+      add_AT_flag (com_die, DW_AT_external, 1);\n+      if (loc)\n+\t{\n+\t  if (off)\n+\t    add_loc_descr (&loc, new_loc_descr (DW_OP_plus_uconst, off, 0));\n+\t  add_AT_loc (com_die, DW_AT_location, loc);\n+\t}\n+      else if (DECL_EXTERNAL (decl))\n+\tadd_AT_flag (com_die, DW_AT_declaration, 1);\n       equate_decl_number_to_die (decl, com_die);\n       return;\n     }"}, {"sha": "5f0d09e62d1d41e0fd2e19862831b5297800370c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=04e74e0210b5399ca47aa46502994fc446420a91", "patch": "@@ -1,3 +1,9 @@\n+2008-08-22  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR fortran/23057\n+\t* gfortran.dg/debug/pr35154-dwarf2.f: Adjust for replacement\n+\tof DW_TAG_member with DW_TAG_variable.\n+\n 2008-08-29  Jan Hubicka  <jh@suse.cz>\n \n \t* gcc.dg/ipa/modif-1.c: Update template."}, {"sha": "d5003a3fc36187154aec4de3bce907cea018031c", "filename": "gcc/testsuite/gfortran.dg/debug/pr35154-dwarf2.f", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2Ftestsuite%2Fgfortran.dg%2Fdebug%2Fpr35154-dwarf2.f", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/04e74e0210b5399ca47aa46502994fc446420a91/gcc%2Ftestsuite%2Fgfortran.dg%2Fdebug%2Fpr35154-dwarf2.f", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdebug%2Fpr35154-dwarf2.f?ref=04e74e0210b5399ca47aa46502994fc446420a91", "patch": "@@ -27,11 +27,11 @@ subroutine sub\n \n C { dg-final { scan-assembler \"(DIE.*DW_TAG_common_block)\" } }\n C { dg-final { scan-assembler \"DW_AT_name: \\\"__BLNK__\\\"\" } }\n-C { dg-final { scan-assembler \"(DIE.*DW_TAG_member)\" } }\n+C { dg-final { scan-assembler \"(DIE.*DW_TAG_variable)\" } }\n C { dg-final { scan-assembler \"\\\"i.*\\\".*DW_AT_name\" } }\n C { dg-final { scan-assembler \"\\\"j.*\\\".*DW_AT_name\" } }\n C { dg-final { scan-assembler \"(DIE.*DW_TAG_common_block)\" } }\n C { dg-final { scan-assembler \"DW_AT_name: \\\"label\\\"\" } }\n-C { dg-final { scan-assembler \"(DIE.*DW_TAG_member)\" } }\n+C { dg-final { scan-assembler \"(DIE.*DW_TAG_variable)\" } }\n C { dg-final { scan-assembler \"\\\"l.*\\\".*DW_AT_name\" } }\n C { dg-final { scan-assembler \"\\\"m.*\\\".*DW_AT_name\" } }"}]}