{"sha": "7c47d6e984423f92f6f7d40e37026ae9402d579a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6N2M0N2Q2ZTk4NDQyM2Y5MmY2ZjdkNDBlMzcwMjZhZTk0MDJkNTc5YQ==", "commit": {"author": {"name": "Joseph Myers", "email": "joseph@codesourcery.com", "date": "2005-07-29T23:58:37Z"}, "committer": {"name": "Joseph Myers", "email": "jsm28@gcc.gnu.org", "date": "2005-07-29T23:58:37Z"}, "message": "re PR c/529 (-Wshadow warns on function prototypes vs. global vars)\n\n\tPR c/529\n\t* c-decl.c (warn_if_shadowing): Don't check for PARM_DECL in\n\tnested function declarators.\n\t(pushdecl): Don't call warn_if_shadowing for PARM_DECL.\n\t(grokparms): Call warn_if_shadowing for parameters used within the\n\tparameter list.\n\t(store_parm_decls_newstyle): Call warn_if_shadowing for parameters\n\tnot used within the parameter list.\n\t(store_parm_decls_oldstyle): Call warn_if_shadowing for parameters.\n\ntestsuite:\n\t* gcc.dg/Wshadow-3.c: New test.\n\nFrom-SVN: r102571", "tree": {"sha": "3ad218f5e1b3a354c3a0ba4c3d6b6756f4ca0a8d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/3ad218f5e1b3a354c3a0ba4c3d6b6756f4ca0a8d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/7c47d6e984423f92f6f7d40e37026ae9402d579a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c47d6e984423f92f6f7d40e37026ae9402d579a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7c47d6e984423f92f6f7d40e37026ae9402d579a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7c47d6e984423f92f6f7d40e37026ae9402d579a/comments", "author": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jsm28", "id": 10537793, "node_id": "MDQ6VXNlcjEwNTM3Nzkz", "avatar_url": "https://avatars.githubusercontent.com/u/10537793?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jsm28", "html_url": "https://github.com/jsm28", "followers_url": "https://api.github.com/users/jsm28/followers", "following_url": "https://api.github.com/users/jsm28/following{/other_user}", "gists_url": "https://api.github.com/users/jsm28/gists{/gist_id}", "starred_url": "https://api.github.com/users/jsm28/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jsm28/subscriptions", "organizations_url": "https://api.github.com/users/jsm28/orgs", "repos_url": "https://api.github.com/users/jsm28/repos", "events_url": "https://api.github.com/users/jsm28/events{/privacy}", "received_events_url": "https://api.github.com/users/jsm28/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3bc751bdfeb8cdd76c9a0214f0f9da6b440b590c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3bc751bdfeb8cdd76c9a0214f0f9da6b440b590c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3bc751bdfeb8cdd76c9a0214f0f9da6b440b590c"}], "stats": {"total": 62, "additions": 52, "deletions": 10}, "files": [{"sha": "c9437b82aa766d5311532875acfe9ec77c376601", "filename": "gcc/ChangeLog", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=7c47d6e984423f92f6f7d40e37026ae9402d579a", "patch": "@@ -1,3 +1,15 @@\n+2005-07-29  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/529\n+\t* c-decl.c (warn_if_shadowing): Don't check for PARM_DECL in\n+\tnested function declarators.\n+\t(pushdecl): Don't call warn_if_shadowing for PARM_DECL.\n+\t(grokparms): Call warn_if_shadowing for parameters used within the\n+\tparameter list.\n+\t(store_parm_decls_newstyle): Call warn_if_shadowing for parameters\n+\tnot used within the parameter list.\n+\t(store_parm_decls_oldstyle): Call warn_if_shadowing for parameters.\n+\n 2005-07-30  Jan Hubicka  <jh@suse.cz>\n \n \t* expr.c (expand_expr_real_1): Do not load mem targets into register."}, {"sha": "09c2755b768e10abd800d991f95a802c45ae9c36", "filename": "gcc/c-decl.c", "status": "modified", "additions": 14, "deletions": 10, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2Fc-decl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2Fc-decl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc-decl.c?ref=7c47d6e984423f92f6f7d40e37026ae9402d579a", "patch": "@@ -1891,13 +1891,7 @@ warn_if_shadowing (tree new_decl)\n       /* No shadow warnings for internally generated vars.  */\n       || DECL_IS_BUILTIN (new_decl)\n       /* No shadow warnings for vars made for inlining.  */\n-      || DECL_FROM_INLINE (new_decl)\n-      /* Don't warn about the parm names in function declarator\n-\t within a function declarator.  It would be nice to avoid\n-\t warning in any function declarator in a declaration, as\n-\t opposed to a definition, but there is no way to tell\n-\t it's not a definition at this point.  */\n-      || (TREE_CODE (new_decl) == PARM_DECL && current_scope->outer->parm_flag))\n+      || DECL_FROM_INLINE (new_decl))\n     return;\n \n   /* Is anything being shadowed?  Invisible decls do not count.  */\n@@ -2221,7 +2215,8 @@ pushdecl (tree x)\n \t}\n     }\n \n-  warn_if_shadowing (x);\n+  if (TREE_CODE (x) != PARM_DECL)\n+    warn_if_shadowing (x);\n \n  skip_external_and_shadow_checks:\n   if (TREE_CODE (x) == TYPE_DECL)\n@@ -4836,6 +4831,9 @@ grokparms (struct c_arg_info *arg_info, bool funcdef_flag)\n \t\t\t     parm, parmno);\n \t\t}\n \t    }\n+\n+\t  if (DECL_NAME (parm) && TREE_USED (parm))\n+\t    warn_if_shadowing (parm);\n \t}\n       return arg_types;\n     }\n@@ -6106,8 +6104,12 @@ store_parm_decls_newstyle (tree fndecl, const struct c_arg_info *arg_info)\n     {\n       DECL_CONTEXT (decl) = current_function_decl;\n       if (DECL_NAME (decl))\n-\tbind (DECL_NAME (decl), decl, current_scope,\n-\t      /*invisible=*/false, /*nested=*/false);\n+\t{\n+\t  bind (DECL_NAME (decl), decl, current_scope,\n+\t\t/*invisible=*/false, /*nested=*/false);\n+\t  if (!TREE_USED (decl))\n+\t    warn_if_shadowing (decl);\n+\t}\n       else\n \terror (\"%Jparameter name omitted\", decl);\n     }\n@@ -6181,6 +6183,7 @@ store_parm_decls_oldstyle (tree fndecl, const struct c_arg_info *arg_info)\n \t      DECL_ARG_TYPE (decl) = integer_type_node;\n \t      layout_decl (decl, 0);\n \t    }\n+\t  warn_if_shadowing (decl);\n \t}\n       /* If no declaration found, default to int.  */\n       else\n@@ -6189,6 +6192,7 @@ store_parm_decls_oldstyle (tree fndecl, const struct c_arg_info *arg_info)\n \t  DECL_ARG_TYPE (decl) = TREE_TYPE (decl);\n \t  DECL_SOURCE_LOCATION (decl) = DECL_SOURCE_LOCATION (fndecl);\n \t  pushdecl (decl);\n+\t  warn_if_shadowing (decl);\n \n \t  if (flag_isoc99)\n \t    pedwarn (\"type of %q+D defaults to %<int%>\", decl);"}, {"sha": "6e1004c67ef4985e5264a862dacae1a6c68fdfa2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=7c47d6e984423f92f6f7d40e37026ae9402d579a", "patch": "@@ -1,3 +1,8 @@\n+2005-07-29  Joseph S. Myers  <joseph@codesourcery.com>\n+\n+\tPR c/529\n+\t* gcc.dg/Wshadow-3.c: New test.\n+\n 2005-07-29  Thomas Koenig  <Thomas.Koenig@online.de>\n \n \t* gfortran.dg/matmul_1.f90:  Correct LHS of matmul test (it"}, {"sha": "4d1924a2b977646d65e939827cf8371dbf529390", "filename": "gcc/testsuite/gcc.dg/Wshadow-3.c", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-3.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/7c47d6e984423f92f6f7d40e37026ae9402d579a/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-3.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2FWshadow-3.c?ref=7c47d6e984423f92f6f7d40e37026ae9402d579a", "patch": "@@ -0,0 +1,21 @@\n+/* Test warnings for shadowing in function prototype scope: generally\n+   useless but of use if the parameter is used within the scope.  Bug\n+   529.  */\n+/* Origin: Joseph Myers <joseph@codesourcery.com> */\n+/* { dg-do compile } */\n+/* { dg-options \"-std=gnu89 -Wshadow\" } */\n+\n+int v; /* { dg-warning \"shadowed declaration\" } */\n+int f1(int v);\n+int f2(int v, int x[v]); /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f3(int v, int y[sizeof(v)]); /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f4(int v) { return 0; } /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f5(int v, int x[v]) { return 0; } /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f6(int x) { return 0; }\n+int f7(v) int v; { return 0; } /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f8(v, w) int v; int w[v]; { return 0; } /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f9(x) int x; { return 0; }\n+int f10(v) { return 0; } /* { dg-warning \"warning: declaration of 'v' shadows a global declaration\" } */\n+int f11(int a, int b(int a));\n+int f12(int a, int b(int a, int x[a])); /* { dg-warning \"warning: declaration of 'a' shadows a parameter\" } */\n+/* { dg-warning \"shadowed declaration\" \"outer parm\" { target *-*-* } 20 } */"}]}