{"sha": "57e617640d6ae8f197501345f07a49a376d28a48", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NTdlNjE3NjQwZDZhZThmMTk3NTAxMzQ1ZjA3YTQ5YTM3NmQyOGE0OA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2019-04-26T16:33:02Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2019-04-26T16:33:02Z"}, "message": "PR c++/90243 - orphaned note in uninstantiated constexpr function\n\ngcc/cp:\n\n\tPR c++/90243 - orphaned note in uninstantiated constexpr function\n\t* decl.c (check_for_uninitialized_const_var): Suppress notes if no\n\terror was shown.\n\ngcc/testsuite:\n\n\tPR c++/90243\n\t* g++.dg/diagnostic/pr90243.C: New test.\n\nFrom-SVN: r270610", "tree": {"sha": "88503845acf8055975cee2c6ce98374afaa7a15a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/88503845acf8055975cee2c6ce98374afaa7a15a"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/57e617640d6ae8f197501345f07a49a376d28a48", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57e617640d6ae8f197501345f07a49a376d28a48", "html_url": "https://github.com/Rust-GCC/gccrs/commit/57e617640d6ae8f197501345f07a49a376d28a48", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/57e617640d6ae8f197501345f07a49a376d28a48/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "700e6332a7fed75fca4515e24263492ff7a83344", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/700e6332a7fed75fca4515e24263492ff7a83344", "html_url": "https://github.com/Rust-GCC/gccrs/commit/700e6332a7fed75fca4515e24263492ff7a83344"}], "stats": {"total": 34, "additions": 31, "deletions": 3}, "files": [{"sha": "e0a7fb9d5beb703073f4a267efbf7988b6ef4405", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=57e617640d6ae8f197501345f07a49a376d28a48", "patch": "@@ -1,3 +1,9 @@\n+2019-04-26  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/90243 - orphaned note in uninstantiated constexpr function\n+\t* decl.c (check_for_uninitialized_const_var): Suppress notes if no\n+\terror was shown.\n+\n 2019-04-26  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/90173"}, {"sha": "20a6e2e5b5c19afa36b152923e9c215c3bc5fac3", "filename": "gcc/cp/decl.c", "status": "modified", "additions": 7, "deletions": 3, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Fcp%2Fdecl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Fcp%2Fdecl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fdecl.c?ref=57e617640d6ae8f197501345f07a49a376d28a48", "patch": "@@ -5691,13 +5691,15 @@ check_for_uninitialized_const_var (tree decl, bool constexpr_context_p,\n       if (!field)\n \treturn true;\n \n+      bool show_notes = true;\n+\n       if (!constexpr_context_p)\n \t{\n \t  if (CP_TYPE_CONST_P (type))\n \t    {\n \t      if (complain & tf_error)\n-\t\tpermerror (DECL_SOURCE_LOCATION (decl),\n-\t\t\t   \"uninitialized const %qD\", decl);\n+\t\tshow_notes = permerror (DECL_SOURCE_LOCATION (decl),\n+\t\t\t\t        \"uninitialized const %qD\", decl);\n \t    }\n \t  else\n \t    {\n@@ -5706,6 +5708,8 @@ check_for_uninitialized_const_var (tree decl, bool constexpr_context_p,\n \t\terror_at (DECL_SOURCE_LOCATION (decl),\n \t\t\t  \"uninitialized variable %qD in %<constexpr%> \"\n \t\t\t  \"function\", decl);\n+\t      else\n+\t\tshow_notes = false;\n \t      cp_function_chain->invalid_constexpr = true;\n \t    }\n \t}\n@@ -5714,7 +5718,7 @@ check_for_uninitialized_const_var (tree decl, bool constexpr_context_p,\n \t\t  \"uninitialized variable %qD in %<constexpr%> context\",\n \t\t  decl);\n \n-      if (CLASS_TYPE_P (type) && (complain & tf_error))\n+      if (show_notes && CLASS_TYPE_P (type) && (complain & tf_error))\n \t{\n \t  tree defaulted_ctor;\n "}, {"sha": "9322205f0f51a33292e5c91380c2894a91f3c487", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=57e617640d6ae8f197501345f07a49a376d28a48", "patch": "@@ -1,3 +1,8 @@\n+2019-04-26  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR c++/90243\n+\t* g++.dg/diagnostic/pr90243.C: New test.\n+\n 2019-04-26  Paolo Carlini  <paolo.carlini@oracle.com>\n \n \tPR c++/90173"}, {"sha": "3f5d915affc9bd59e673e9d82c4b36370135d67d", "filename": "gcc/testsuite/g++.dg/diagnostic/pr90243.C", "status": "added", "additions": 13, "deletions": 0, "changes": 13, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr90243.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/57e617640d6ae8f197501345f07a49a376d28a48/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr90243.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fdiagnostic%2Fpr90243.C?ref=57e617640d6ae8f197501345f07a49a376d28a48", "patch": "@@ -0,0 +1,13 @@\n+// { dg-do compile { target c++14 } }\n+struct Z { // { dg-bogus \"default constructor\" }\n+  int y;   // { dg-bogus \"initialize\" }\n+};\n+\n+template <class T>\n+constexpr Z f(const T *data) {\n+  Z z;\n+  __builtin_memcpy(&z, data, sizeof(z));\n+  return z;\n+}\n+\n+constexpr Z g(const char *data) { return f(data); }"}]}