{"sha": "f56f1a5a755e4f2080ff709ad7bf4088b84faefe", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZjU2ZjFhNWE3NTVlNGYyMDgwZmY3MDlhZDdiZjQwODhiODRmYWVmZQ==", "commit": {"author": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-09-09T02:21:54Z"}, "committer": {"name": "Ian Lance Taylor", "email": "iant@golang.org", "date": "2020-09-09T02:21:54Z"}, "message": "libbacktrace: don't strip leading underscore on 64-bit PE\n\n\t* pecoff.c (coff_initialize_syminfo): Add is_64 parameter.\n\t(coff_add): Determine and pass is_64.", "tree": {"sha": "c1800123a8d10d3c1e0c28ed17f6b70ae59f6917", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c1800123a8d10d3c1e0c28ed17f6b70ae59f6917"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/f56f1a5a755e4f2080ff709ad7bf4088b84faefe", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f56f1a5a755e4f2080ff709ad7bf4088b84faefe", "html_url": "https://github.com/Rust-GCC/gccrs/commit/f56f1a5a755e4f2080ff709ad7bf4088b84faefe", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/f56f1a5a755e4f2080ff709ad7bf4088b84faefe/comments", "author": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "committer": {"login": "ianlancetaylor", "id": 3194333, "node_id": "MDQ6VXNlcjMxOTQzMzM=", "avatar_url": "https://avatars.githubusercontent.com/u/3194333?v=4", "gravatar_id": "", "url": "https://api.github.com/users/ianlancetaylor", "html_url": "https://github.com/ianlancetaylor", "followers_url": "https://api.github.com/users/ianlancetaylor/followers", "following_url": "https://api.github.com/users/ianlancetaylor/following{/other_user}", "gists_url": "https://api.github.com/users/ianlancetaylor/gists{/gist_id}", "starred_url": "https://api.github.com/users/ianlancetaylor/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/ianlancetaylor/subscriptions", "organizations_url": "https://api.github.com/users/ianlancetaylor/orgs", "repos_url": "https://api.github.com/users/ianlancetaylor/repos", "events_url": "https://api.github.com/users/ianlancetaylor/events{/privacy}", "received_events_url": "https://api.github.com/users/ianlancetaylor/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "181f877b6c0e365c940b117c306e7309e19ffd89", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/181f877b6c0e365c940b117c306e7309e19ffd89", "html_url": "https://github.com/Rust-GCC/gccrs/commit/181f877b6c0e365c940b117c306e7309e19ffd89"}], "stats": {"total": 20, "additions": 14, "deletions": 6}, "files": [{"sha": "49e5c3d868c145d31d54c284798a7eaa882ba418", "filename": "libbacktrace/pecoff.c", "status": "modified", "additions": 14, "deletions": 6, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/f56f1a5a755e4f2080ff709ad7bf4088b84faefe/libbacktrace%2Fpecoff.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/f56f1a5a755e4f2080ff709ad7bf4088b84faefe/libbacktrace%2Fpecoff.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libbacktrace%2Fpecoff.c?ref=f56f1a5a755e4f2080ff709ad7bf4088b84faefe", "patch": "@@ -330,7 +330,7 @@ coff_is_function_symbol (const b_coff_internal_symbol *isym)\n \n static int\n coff_initialize_syminfo (struct backtrace_state *state,\n-\t\t\t uintptr_t base_address,\n+\t\t\t uintptr_t base_address, int is_64,\n \t\t\t const b_coff_section_header *sects, size_t sects_num,\n \t\t\t const b_coff_external_symbol *syms, size_t syms_size,\n \t\t\t const unsigned char *strtab, size_t strtab_size,\n@@ -426,9 +426,12 @@ coff_initialize_syminfo (struct backtrace_state *state,\n \t  else\n \t    name = isym.name;\n \n-\t  /* Strip leading '_'.  */\n-\t  if (name[0] == '_')\n-\t    name++;\n+\t  if (!is_64)\n+\t    {\n+\t      /* Strip leading '_'.  */\n+\t      if (name[0] == '_')\n+\t\tname++;\n+\t    }\n \n \t  /* Symbol value is section relative, so we need to read the address\n \t     of its section.  */\n@@ -605,6 +608,7 @@ coff_add (struct backtrace_state *state, int descriptor,\n   off_t max_offset;\n   struct backtrace_view debug_view;\n   int debug_view_valid;\n+  int is_64;\n   uintptr_t image_base;\n   struct dwarf_sections dwarf_sections;\n \n@@ -680,12 +684,16 @@ coff_add (struct backtrace_state *state, int descriptor,\n   sects = (const b_coff_section_header *)\n     (sects_view.data + fhdr.size_of_optional_header);\n \n+  is_64 = 0;\n   if (fhdr.size_of_optional_header > sizeof (*opt_hdr))\n     {\n       if (opt_hdr->magic == PE_MAGIC)\n \timage_base = opt_hdr->u.pe.image_base;\n       else if (opt_hdr->magic == PEP_MAGIC)\n-\timage_base = opt_hdr->u.pep.image_base;\n+\t{\n+\t  image_base = opt_hdr->u.pep.image_base;\n+\t  is_64 = 1;\n+\t}\n       else\n \t{\n \t  error_callback (data, \"bad magic in PE optional header\", 0);\n@@ -778,7 +786,7 @@ coff_add (struct backtrace_state *state, int descriptor,\n       if (sdata == NULL)\n \tgoto fail;\n \n-      if (!coff_initialize_syminfo (state, image_base,\n+      if (!coff_initialize_syminfo (state, image_base, is_64,\n \t\t\t\t    sects, sects_num,\n \t\t\t\t    syms_view.data, syms_size,\n \t\t\t\t    str_view.data, str_size,"}]}