{"sha": "255ef0345c9976d876677058f9beec62eb56aa28", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MjU1ZWYwMzQ1Yzk5NzZkODc2Njc3MDU4ZjliZWVjNjJlYjU2YWEyOA==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2008-01-22T17:54:59Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2008-01-22T17:54:59Z"}, "message": "re PR c++/34829 (placement new with primitive Java types rejected)\n\ngcc/testsuite\n\tPR c++/34829:\n\t* g++.dg/ext/pr34829.C: New file.\ngcc/cp\n\tPR c++/34829:\n\t* init.c (build_new_1): Only disallow Java aggregates.\n\nFrom-SVN: r131732", "tree": {"sha": "712fa41a541c2fbde6cf1800ce291dd53cfea890", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/712fa41a541c2fbde6cf1800ce291dd53cfea890"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/255ef0345c9976d876677058f9beec62eb56aa28", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/255ef0345c9976d876677058f9beec62eb56aa28", "html_url": "https://github.com/Rust-GCC/gccrs/commit/255ef0345c9976d876677058f9beec62eb56aa28", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/255ef0345c9976d876677058f9beec62eb56aa28/comments", "author": null, "committer": null, "parents": [{"sha": "c316155b7f51a0301e0989ae744bdf7a0569519d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c316155b7f51a0301e0989ae744bdf7a0569519d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c316155b7f51a0301e0989ae744bdf7a0569519d"}], "stats": {"total": 34, "additions": 32, "deletions": 2}, "files": [{"sha": "235f7cb4b25c38eeced6c75d9313507568c650f0", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=255ef0345c9976d876677058f9beec62eb56aa28", "patch": "@@ -1,3 +1,8 @@\n+2008-01-22  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR c++/34829:\n+\t* init.c (build_new_1): Only disallow Java aggregates.\n+\n 2008-01-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/34607"}, {"sha": "a6da19f193304b2636d1f02360cd39b95062bae5", "filename": "gcc/cp/init.c", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Fcp%2Finit.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Fcp%2Finit.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Finit.c?ref=255ef0345c9976d876677058f9beec62eb56aa28", "patch": "@@ -1,6 +1,6 @@\n /* Handle initialization things in C++.\n    Copyright (C) 1987, 1989, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n    Free Software Foundation, Inc.\n    Contributed by Michael Tiemann (tiemann@cygnus.com)\n \n@@ -1786,7 +1786,7 @@ build_new_1 (tree placement, tree type, tree nelts, tree init,\n \t\t    (alloc_fn,\n \t\t     build_tree_list (NULL_TREE, class_addr)));\n     }\n-  else if (TYPE_FOR_JAVA (elt_type))\n+  else if (TYPE_FOR_JAVA (elt_type) && IS_AGGR_TYPE (elt_type))\n     {\n       error (\"Java class %q#T object allocated using placement new\", elt_type);\n       return error_mark_node;"}, {"sha": "ffb8e1caa59acdaea900b4617b8f6ca9a942235c", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=255ef0345c9976d876677058f9beec62eb56aa28", "patch": "@@ -1,3 +1,8 @@\n+2008-01-22  Tom Tromey  <tromey@redhat.com>\n+\n+\tPR c++/34829:\n+\t* g++.dg/ext/pr34829.C: New file.\n+\n 2008-01-22  Jakub Jelinek  <jakub@redhat.com>\n \n \tPR c++/34607"}, {"sha": "ea4b39591959bad62e6d2851b0653c3c5d57f86d", "filename": "gcc/testsuite/g++.dg/ext/pr34829.C", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpr34829.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/255ef0345c9976d876677058f9beec62eb56aa28/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpr34829.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fext%2Fpr34829.C?ref=255ef0345c9976d876677058f9beec62eb56aa28", "patch": "@@ -0,0 +1,20 @@\n+// Test for PR c++/34829\n+// Placement new should be ok for non-aggregate Java types.\n+\n+// { dg-do compile }\n+// { dg-options \"\" }\n+\n+extern \"Java\"\n+{\n+  typedef __java_byte jbyte;\n+}\n+\n+void *operator new (unsigned int s, void *m)\n+{\n+  return m;\n+}\n+\n+jbyte *f(void *memory)\n+{\n+  return new (memory) jbyte;\n+}"}]}