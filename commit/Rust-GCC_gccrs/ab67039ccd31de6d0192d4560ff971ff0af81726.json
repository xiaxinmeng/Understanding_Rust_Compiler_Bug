{"sha": "ab67039ccd31de6d0192d4560ff971ff0af81726", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YWI2NzAzOWNjZDMxZGU2ZDAxOTJkNDU2MGZmOTcxZmYwYWY4MTcyNg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2018-02-16T09:05:35Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2018-02-16T09:05:35Z"}, "message": "re PR bootstrap/84405 (Fails to bootstrap with GCC 4.1.2, GCC 4.2.4)\n\n\tPR bootstrap/84405\n\t* system.h (BROKEN_VALUE_INITIALIZATION): Define for GCC < 4.3.\n\t* vec.h (vec_default_construct): Use memset instead of placement new\n\tif BROKEN_VALUE_INITIALIZATION is defined.\n\t* hash-table.h (hash_table<Descriptor, Allocator>::empty_slow): Use\n\tmemset instead of value initialization if BROKEN_VALUE_INITIALIZATION\n\tis defined.\n\nFrom-SVN: r257726", "tree": {"sha": "0263d95f48f4201cf663f022f24d2e4e85fd6d6d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/0263d95f48f4201cf663f022f24d2e4e85fd6d6d"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/ab67039ccd31de6d0192d4560ff971ff0af81726", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab67039ccd31de6d0192d4560ff971ff0af81726", "html_url": "https://github.com/Rust-GCC/gccrs/commit/ab67039ccd31de6d0192d4560ff971ff0af81726", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/ab67039ccd31de6d0192d4560ff971ff0af81726/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "33006d53fd3adf2baae85b625e3ec99908b7a31c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33006d53fd3adf2baae85b625e3ec99908b7a31c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33006d53fd3adf2baae85b625e3ec99908b7a31c"}], "stats": {"total": 22, "additions": 22, "deletions": 0}, "files": [{"sha": "85c7880e237064cad571f23b0c6a3c7e133256b8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=ab67039ccd31de6d0192d4560ff971ff0af81726", "patch": "@@ -1,5 +1,13 @@\n 2018-02-16  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR bootstrap/84405\n+\t* system.h (BROKEN_VALUE_INITIALIZATION): Define for GCC < 4.3.\n+\t* vec.h (vec_default_construct): Use memset instead of placement new\n+\tif BROKEN_VALUE_INITIALIZATION is defined.\n+\t* hash-table.h (hash_table<Descriptor, Allocator>::empty_slow): Use\n+\tmemset instead of value initialization if BROKEN_VALUE_INITIALIZATION\n+\tis defined.\n+\n \tPR rtl-optimization/83723\n \t* lra-int.h (lra_substitute_pseudo): Add DEBUG_P argument.\n \t* lra.c (lra_substitute_pseudo): Likewise.  If true, use"}, {"sha": "706b2370e2343abad8041dcbbc8051591c78577f", "filename": "gcc/hash-table.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2Fhash-table.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2Fhash-table.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhash-table.h?ref=ab67039ccd31de6d0192d4560ff971ff0af81726", "patch": "@@ -804,8 +804,12 @@ hash_table<Descriptor, Allocator>::empty_slow ()\n     }\n   else\n     {\n+#ifndef BROKEN_VALUE_INITIALIZATION\n       for ( ; size; ++entries, --size)\n \t*entries = value_type ();\n+#else\n+      memset (entries, 0, size * sizeof (value_type));\n+#endif\n     }\n   m_n_deleted = 0;\n   m_n_elements = 0;"}, {"sha": "4abc321c71dc1c785e5cde2dc0028520b422e645", "filename": "gcc/system.h", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2Fsystem.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2Fsystem.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fsystem.h?ref=ab67039ccd31de6d0192d4560ff971ff0af81726", "patch": "@@ -824,6 +824,12 @@ extern void fancy_abort (const char *, int, const char *)\n /* Some compilers do not allow the use of unsigned char in bitfields.  */\n #define BOOL_BITFIELD unsigned int\n \n+/* GCC older than 4.4 have broken C++ value initialization handling, see\n+   PR11309, PR30111, PR33916, PR82939 and PR84405 for more details.  */\n+#if GCC_VERSION > 0 && GCC_VERSION < 4004 && !defined(__clang__)\n+# define BROKEN_VALUE_INITIALIZATION\n+#endif\n+\n /* As the last action in this file, we poison the identifiers that\n    shouldn't be used.  Note, luckily gcc-3.0's token-based integrated\n    preprocessor won't trip on poisoned identifiers that arrive from"}, {"sha": "c707bccf51c5583c525dfe6bbcb69b7ed8f59640", "filename": "gcc/vec.h", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2Fvec.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/ab67039ccd31de6d0192d4560ff971ff0af81726/gcc%2Fvec.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fvec.h?ref=ab67039ccd31de6d0192d4560ff971ff0af81726", "patch": "@@ -490,8 +490,12 @@ template <typename T>\n inline void\n vec_default_construct (T *dst, unsigned n)\n {\n+#ifndef BROKEN_VALUE_INITIALIZATION\n   for ( ; n; ++dst, --n)\n     ::new (static_cast<void*>(dst)) T ();\n+#else\n+  memset (dst, '\\0', sizeof (T) * n);\n+#endif\n }\n \n /* Copy-construct N elements in DST from *SRC.  */"}]}