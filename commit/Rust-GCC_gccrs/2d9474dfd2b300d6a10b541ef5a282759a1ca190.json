{"sha": "2d9474dfd2b300d6a10b541ef5a282759a1ca190", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MmQ5NDc0ZGZkMmIzMDBkNmExMGI1NDFlZjVhMjgyNzU5YTFjYTE5MA==", "commit": {"author": {"name": "James A. Morrison", "email": "phython@gcc.gnu.org", "date": "2005-06-18T19:57:12Z"}, "committer": {"name": "James A. Morrison", "email": "phython@gcc.gnu.org", "date": "2005-06-18T19:57:12Z"}, "message": "fold_const (fold_binary): Fold X % (2**N) to X & (2**N - 1) for nonnegative values of X.\n\n2005-06-18  James A. Morrison  <phython@gcc.gnu.org>\n\n        * fold_const (fold_binary): Fold X % (2**N) to X & (2**N - 1) for\n        nonnegative values of X.\n\nFrom-SVN: r101163", "tree": {"sha": "9030eac2ba4b6f77300c26c535cf1365cacfaf7f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/9030eac2ba4b6f77300c26c535cf1365cacfaf7f"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/2d9474dfd2b300d6a10b541ef5a282759a1ca190", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d9474dfd2b300d6a10b541ef5a282759a1ca190", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d9474dfd2b300d6a10b541ef5a282759a1ca190", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d9474dfd2b300d6a10b541ef5a282759a1ca190/comments", "author": null, "committer": null, "parents": [{"sha": "5190a458bbace7bd99887361bc7e9f05112908dd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5190a458bbace7bd99887361bc7e9f05112908dd", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5190a458bbace7bd99887361bc7e9f05112908dd"}], "stats": {"total": 44, "additions": 39, "deletions": 5}, "files": [{"sha": "52c3a968689773defc505eae281e1c4dc1603e03", "filename": "gcc/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=2d9474dfd2b300d6a10b541ef5a282759a1ca190", "patch": "@@ -1,3 +1,8 @@\n+2005-06-18  James A. Morrison  <phython@gcc.gnu.org>\n+\n+\t* fold_const (fold_binary): Fold X % (2**N) to X & (2**N - 1) for\n+\tnonnegative values of X.\n+\n 2005-06-18  Uros Bizjak  <uros@kss-loka.si>\n \n \t* doc/md.texi (Standard Names): Change insn pattern name"}, {"sha": "335e556f5e9e3553de31c5f8bf088cc027714cda", "filename": "gcc/fold-const.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2Ffold-const.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2Ffold-const.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffold-const.c?ref=2d9474dfd2b300d6a10b541ef5a282759a1ca190", "patch": "@@ -8337,11 +8337,11 @@ fold_binary (enum tree_code code, tree type, tree op0, tree op1)\n \t  && TREE_INT_CST_HIGH (arg1) == -1)\n \treturn omit_one_operand (type, integer_zero_node, arg0);\n \n-      /* Optimize unsigned TRUNC_MOD_EXPR by a power of two into a\n-\t BIT_AND_EXPR, i.e. \"X % C\" into \"X & C2\".  */\n-      if (code == TRUNC_MOD_EXPR\n-\t  && TYPE_UNSIGNED (type)\n-\t  && integer_pow2p (arg1))\n+      /* Optimize TRUNC_MOD_EXPR by a power of two into a BIT_AND_EXPR,\n+         i.e. \"X % C\" into \"X & C2\", if X and C are positive.  */\n+      if ((code == TRUNC_MOD_EXPR || code == FLOOR_MOD_EXPR)\n+\t  && (TYPE_UNSIGNED (type) || tree_expr_nonnegative_p (arg0))\n+\t  && integer_pow2p (arg1) && tree_int_cst_sgn (arg1) >= 0)\n \t{\n \t  unsigned HOST_WIDE_INT high, low;\n \t  tree mask;"}, {"sha": "31c4c10b26210cae5debedf8dfd56cf9237654d2", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=2d9474dfd2b300d6a10b541ef5a282759a1ca190", "patch": "@@ -1,3 +1,7 @@\n+2005-06-18  James A Morrison  <phython@gcc.gnu.org>\n+\n+\t* gcc.dg/fold-mod-1.c: New test.\n+\n 2005-06-18  Steven G. Kargl  <kargls@comcast.net>\n \n \tPR fortran/19926"}, {"sha": "1b312ea8c272748cebd2adb4211bb9cdaede63d2", "filename": "gcc/testsuite/gcc.dg/fold-mod-1.c", "status": "added", "additions": 25, "deletions": 0, "changes": 25, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2Ftestsuite%2Fgcc.dg%2Ffold-mod-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/2d9474dfd2b300d6a10b541ef5a282759a1ca190/gcc%2Ftestsuite%2Fgcc.dg%2Ffold-mod-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ffold-mod-1.c?ref=2d9474dfd2b300d6a10b541ef5a282759a1ca190", "patch": "@@ -0,0 +1,25 @@\n+/* { dg-do compile } */\n+/* { dg-options \"-fdump-tree-gimple\" } */\n+\n+#define ABS(x) (x > 0 ? x : -x)\n+\n+unsigned int f (unsigned int a) {\n+\t/* (unsigned)-8 is not a power of 2.  */\n+\treturn a % -8;\n+}\n+\n+int g (int b) {\n+\treturn ABS (b) % -8;\n+}\n+\n+int h (int c) {\n+\treturn ABS (c) % 8;\n+}\n+\n+unsigned int k (unsigned int d) {\n+\treturn d % 8;\n+}\n+\n+/* { dg-final { scan-tree-dump \"a % 4294967288\" \"gimple\" } } */\n+/* { dg-final { scan-tree-dump-times \" & 7\" 3 \"gimple\" } } */\n+/* { dg-final { cleanup-tree-dump \"gimple\" } } */"}]}