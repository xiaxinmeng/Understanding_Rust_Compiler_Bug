{"sha": "d876184c095d6ac41e64eaf4e2c78864d2d935c1", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDg3NjE4NGMwOTVkNmFjNDFlNjRlYWY0ZTJjNzg4NjRkMmQ5MzVjMQ==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-09-15T14:12:53Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-09-15T14:59:09Z"}, "message": "make swap argument of vect_get_and_check_slp_defs readonly\n\nSince some time we're only using this argument to communicate from\nvect_build_slp_tree_1 to vect_get_and_check_slp_defs.  This makes\nthe direction of information flow clear.\n\n2020-09-15  Richard Biener  <rguenther@suse.de>\n\n\t* tree-vect-slp.c (vect_get_and_check_slp_defs): Make swap\n\targument by-value and do not change it.\n\t(vect_build_slp_tree_2): Adjust, set swap to NULL after last\n\tuse.", "tree": {"sha": "b9495a64cd86e35fd68b745183f4c9f006bff90c", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b9495a64cd86e35fd68b745183f4c9f006bff90c"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d876184c095d6ac41e64eaf4e2c78864d2d935c1", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d876184c095d6ac41e64eaf4e2c78864d2d935c1", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d876184c095d6ac41e64eaf4e2c78864d2d935c1", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d876184c095d6ac41e64eaf4e2c78864d2d935c1/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "3304888c252f079a04ff2be95672d8c1d9a7d34f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3304888c252f079a04ff2be95672d8c1d9a7d34f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3304888c252f079a04ff2be95672d8c1d9a7d34f"}], "stats": {"total": 10, "additions": 5, "deletions": 5}, "files": [{"sha": "f9f4d706f0abd3a82dbf6e345c090ac829a79ae3", "filename": "gcc/tree-vect-slp.c", "status": "modified", "additions": 5, "deletions": 5, "changes": 10, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d876184c095d6ac41e64eaf4e2c78864d2d935c1/gcc%2Ftree-vect-slp.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d876184c095d6ac41e64eaf4e2c78864d2d935c1/gcc%2Ftree-vect-slp.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-vect-slp.c?ref=d876184c095d6ac41e64eaf4e2c78864d2d935c1", "patch": "@@ -391,7 +391,7 @@ can_duplicate_and_interleave_p (vec_info *vinfo, unsigned int count,\n    swapping operands of father node of this one, return 1; if everything is\n    ok return 0.  */\n static int\n-vect_get_and_check_slp_defs (vec_info *vinfo, unsigned char *swap,\n+vect_get_and_check_slp_defs (vec_info *vinfo, unsigned char swap,\n \t\t\t     vec<stmt_vec_info> stmts, unsigned stmt_num,\n \t\t\t     vec<slp_oprnd_info> *oprnds_info)\n {\n@@ -441,7 +441,7 @@ vect_get_and_check_slp_defs (vec_info *vinfo, unsigned char *swap,\n   else\n     return -1;\n \n-  bool swapped = (*swap != 0);\n+  bool swapped = (swap != 0);\n   gcc_assert (!swapped || first_op_cond);\n   for (i = 0; i < number_of_oprnds; i++)\n     {\n@@ -450,7 +450,7 @@ vect_get_and_check_slp_defs (vec_info *vinfo, unsigned char *swap,\n \t{\n \t  /* Map indicating how operands of cond_expr should be swapped.  */\n \t  int maps[3][4] = {{0, 1, 2, 3}, {1, 0, 2, 3}, {0, 1, 3, 2}};\n-\t  int *map = maps[*swap];\n+\t  int *map = maps[swap];\n \n \t  if (i < 2)\n \t    oprnd = TREE_OPERAND (gimple_op (stmt_info->stmt,\n@@ -607,7 +607,6 @@ vect_get_and_check_slp_defs (vec_info *vinfo, unsigned char *swap,\n \t\t\t stmt_info->stmt);\n     }\n \n-  *swap = swapped;\n   return 0;\n }\n \n@@ -1391,7 +1390,7 @@ vect_build_slp_tree_2 (vec_info *vinfo,\n   slp_oprnd_info oprnd_info;\n   FOR_EACH_VEC_ELT (stmts, i, stmt_info)\n     {\n-      int res = vect_get_and_check_slp_defs (vinfo, &swap[i],\n+      int res = vect_get_and_check_slp_defs (vinfo, swap[i],\n \t\t\t\t\t     stmts, i, &oprnds_info);\n       if (res != 0)\n \tmatches[(res == -1) ? 0 : i] = false;\n@@ -1404,6 +1403,7 @@ vect_build_slp_tree_2 (vec_info *vinfo,\n \tvect_free_oprnd_info (oprnds_info);\n \treturn NULL;\n       }\n+  swap = NULL;\n \n   auto_vec<slp_tree, 4> children;\n "}]}