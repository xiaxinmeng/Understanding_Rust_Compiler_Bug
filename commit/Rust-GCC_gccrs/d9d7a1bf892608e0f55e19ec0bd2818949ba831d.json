{"sha": "d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDlkN2ExYmY4OTI2MDhlMGY1NWUxOWVjMGJkMjgxODk0OWJhODMxZA==", "commit": {"author": {"name": "Alan Modra", "email": "amodra@gmail.com", "date": "2010-06-03T02:47:11Z"}, "committer": {"name": "Alan Modra", "email": "amodra@gcc.gnu.org", "date": "2010-06-03T02:47:11Z"}, "message": "re PR rtl-optimization/44169 (Wrong code while generating TLS offsets)\n\n\tPR target/44169\n\t* config/rs6000/rs6000.md (load_toc_v4_PIC_1b): Add label operand.\n\t* config/rs6000/rs6000.c (rs6000_legitimize_tls_address): Pass label\n\trtx to gen_load_toc_v4_PIC_1b.  Tidy.\n\t(rs6000_emit_load_toc_table): Likewise.\n\nFrom-SVN: r160206", "tree": {"sha": "b47138a4c8c7818b25b37c8b5565d612488b72e3", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b47138a4c8c7818b25b37c8b5565d612488b72e3"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/comments", "author": {"login": "amodra", "id": 6006325, "node_id": "MDQ6VXNlcjYwMDYzMjU=", "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4", "gravatar_id": "", "url": "https://api.github.com/users/amodra", "html_url": "https://github.com/amodra", "followers_url": "https://api.github.com/users/amodra/followers", "following_url": "https://api.github.com/users/amodra/following{/other_user}", "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}", "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/amodra/subscriptions", "organizations_url": "https://api.github.com/users/amodra/orgs", "repos_url": "https://api.github.com/users/amodra/repos", "events_url": "https://api.github.com/users/amodra/events{/privacy}", "received_events_url": "https://api.github.com/users/amodra/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "514f01ad19d2c0864b761a1ee259dcc6eafdcdf4", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/514f01ad19d2c0864b761a1ee259dcc6eafdcdf4", "html_url": "https://github.com/Rust-GCC/gccrs/commit/514f01ad19d2c0864b761a1ee259dcc6eafdcdf4"}], "stats": {"total": 38, "additions": 22, "deletions": 16}, "files": [{"sha": "c8ff7cf64f968be04ae48145daee12c608e53c1b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "patch": "@@ -1,3 +1,11 @@\n+2010-06-03  Alan Modra  <amodra@gmail.com>\n+\n+\tPR target/44169\n+\t* config/rs6000/rs6000.md (load_toc_v4_PIC_1b): Add label operand.\n+\t* config/rs6000/rs6000.c (rs6000_legitimize_tls_address): Pass label\n+\trtx to gen_load_toc_v4_PIC_1b.  Tidy.\n+\t(rs6000_emit_load_toc_table): Likewise.\n+\n 2010-06-02  Jan Hubicka  <jh@suse.cz>\n \n \t* passes.c (init_optimization_passes): Put ipa reference"}, {"sha": "9e31a22e5f8425193cc1fe3845ce619bbd1676c2", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 9, "deletions": 13, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "patch": "@@ -5714,20 +5714,16 @@ rs6000_legitimize_tls_address (rtx addr, enum tls_model model)\n \t\trs6000_emit_move (got, gsym, Pmode);\n \t      else\n \t\t{\n-\t\t  rtx tmp3, mem;\n-\t\t  rtx last;\n+\t\t  rtx mem, lab, last;\n \n \t\t  tmp1 = gen_reg_rtx (Pmode);\n \t\t  tmp2 = gen_reg_rtx (Pmode);\n-\t\t  tmp3 = gen_reg_rtx (Pmode);\n \t\t  mem = gen_const_mem (Pmode, tmp1);\n-\n-\t\t  emit_insn (gen_load_toc_v4_PIC_1b (gsym));\n-\t\t  emit_move_insn (tmp1,\n-\t\t\t\t  gen_rtx_REG (Pmode, LR_REGNO));\n+\t\t  lab = gen_label_rtx ();\n+\t\t  emit_insn (gen_load_toc_v4_PIC_1b (gsym, lab));\n+\t\t  emit_move_insn (tmp1, gen_rtx_REG (Pmode, LR_REGNO));\n \t\t  emit_move_insn (tmp2, mem);\n-\t\t  emit_insn (gen_addsi3 (tmp3, tmp1, tmp2));\n-\t\t  last = emit_move_insn (got, tmp3);\n+\t\t  last = emit_insn (gen_addsi3 (got, tmp1, tmp2));\n \t\t  set_unique_reg_note (last, REG_EQUAL, gsym);\n \t\t}\n \t    }\n@@ -18145,12 +18141,12 @@ rs6000_emit_load_toc_table (int fromprolog)\n \t}\n       else\n \t{\n-\t  rtx tocsym;\n+\t  rtx tocsym, lab;\n \n \t  tocsym = gen_rtx_SYMBOL_REF (Pmode, toc_label_name);\n-\t  emit_insn (gen_load_toc_v4_PIC_1b (tocsym));\n-\t  emit_move_insn (dest,\n-\t\t\t  gen_rtx_REG (Pmode, LR_REGNO));\n+\t  lab = gen_label_rtx ();\n+\t  emit_insn (gen_load_toc_v4_PIC_1b (tocsym, lab));\n+\t  emit_move_insn (dest, gen_rtx_REG (Pmode, LR_REGNO));\n \t  emit_move_insn (temp0, gen_rtx_MEM (Pmode, dest));\n \t}\n       emit_insn (gen_addsi3 (dest, temp0, dest));"}, {"sha": "3106648c81c756b4af203d8305d1e6d2bf7a5a7f", "filename": "gcc/config/rs6000/rs6000.md", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/gcc%2Fconfig%2Frs6000%2Frs6000.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d9d7a1bf892608e0f55e19ec0bd2818949ba831d/gcc%2Fconfig%2Frs6000%2Frs6000.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.md?ref=d9d7a1bf892608e0f55e19ec0bd2818949ba831d", "patch": "@@ -11459,10 +11459,12 @@\n \n (define_insn \"load_toc_v4_PIC_1b\"\n   [(set (reg:SI LR_REGNO)\n-\t(unspec:SI [(match_operand:SI 0 \"immediate_operand\" \"s\")]\n-\t\tUNSPEC_TOCPTR))]\n+\t(unspec:SI [(match_operand:SI 0 \"immediate_operand\" \"s\")\n+\t\t    (label_ref (match_operand 1 \"\" \"\"))]\n+\t\tUNSPEC_TOCPTR))\n+   (match_dup 1)]\n   \"TARGET_ELF && DEFAULT_ABI != ABI_AIX && flag_pic == 2\"\n-  \"bcl 20,31,$+8\\\\n\\\\t.long %0-$\"\n+  \"bcl 20,31,$+8\\;.long %0-$\"\n   [(set_attr \"type\" \"branch\")\n    (set_attr \"length\" \"8\")])\n "}]}