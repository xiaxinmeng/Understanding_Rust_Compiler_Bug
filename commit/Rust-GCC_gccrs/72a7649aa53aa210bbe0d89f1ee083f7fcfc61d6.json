{"sha": "72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzJhNzY0OWFhNTNhYTIxMGJiZTBkODlmMWVlMDgzZjdmY2ZjNjFkNg==", "commit": {"author": {"name": "Nathan Sidwell", "email": "nathan@acm.org", "date": "2018-11-07T16:28:46Z"}, "committer": {"name": "Nathan Sidwell", "email": "nathan@gcc.gnu.org", "date": "2018-11-07T16:28:46Z"}, "message": "[PR C++/87904] lookup ICE\n\nhttps://gcc.gnu.org/ml/gcc-patches/2018-11/msg00468.html\n\tPR c++/87904\n\t* cp-tree.h (struct tree_overload): Fix comment.\n\t* tree.c (ovl_iterator::reveal_node): Propagate OVL_DEDUP_P.\n\n\tPR c++/87904\n\t* g++.dg/lookup/pr87904.C: New.\n\nFrom-SVN: r265879", "tree": {"sha": "6e9f9f904042185d9fb6a040f4afb19406cf0e66", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/6e9f9f904042185d9fb6a040f4afb19406cf0e66"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/comments", "author": {"login": "urnathan", "id": 13103001, "node_id": "MDQ6VXNlcjEzMTAzMDAx", "avatar_url": "https://avatars.githubusercontent.com/u/13103001?v=4", "gravatar_id": "", "url": "https://api.github.com/users/urnathan", "html_url": "https://github.com/urnathan", "followers_url": "https://api.github.com/users/urnathan/followers", "following_url": "https://api.github.com/users/urnathan/following{/other_user}", "gists_url": "https://api.github.com/users/urnathan/gists{/gist_id}", "starred_url": "https://api.github.com/users/urnathan/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/urnathan/subscriptions", "organizations_url": "https://api.github.com/users/urnathan/orgs", "repos_url": "https://api.github.com/users/urnathan/repos", "events_url": "https://api.github.com/users/urnathan/events{/privacy}", "received_events_url": "https://api.github.com/users/urnathan/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "38f54eec0becb68f4d7924327a9c368d9d27cd8f", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38f54eec0becb68f4d7924327a9c368d9d27cd8f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38f54eec0becb68f4d7924327a9c368d9d27cd8f"}], "stats": {"total": 51, "additions": 43, "deletions": 8}, "files": [{"sha": "79cc67326c4b267c157f574d832d4b84ba50ea29", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "patch": "@@ -1,3 +1,9 @@\n+2018-11-07  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/87904\n+\t* cp-tree.h (struct tree_overload): Fix comment.\n+\t* tree.c (ovl_iterator::reveal_node): Propagate OVL_DEDUP_P.\n+\n 2018-11-04  Jason Merrill  <jason@redhat.com>\n \n \tImplement UDL changes from P0732R2."}, {"sha": "91f5755a18700730bc0bdf6152d722b7a2fea212", "filename": "gcc/cp/cp-tree.h", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Fcp%2Fcp-tree.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Fcp%2Fcp-tree.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fcp-tree.h?ref=72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "patch": "@@ -723,8 +723,7 @@ typedef struct ptrmem_cst * ptrmem_cst_t;\n #define OVL_SINGLE_P(NODE) \\\n   (TREE_CODE (NODE) != OVERLOAD || !OVL_CHAIN (NODE))\n \n-/* OVL_HIDDEN_P nodes come first, then OVL_USING_P nodes, then regular\n-   fns.  */\n+/* OVL_HIDDEN_P nodes come before other nodes.  */\n \n struct GTY(()) tree_overload {\n   struct tree_common common;"}, {"sha": "5e21fce54a8cef6c4eec8246214389863d1afc5f", "filename": "gcc/cp/tree.c", "status": "modified", "additions": 10, "deletions": 6, "changes": 16, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Fcp%2Ftree.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Fcp%2Ftree.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Ftree.c?ref=72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "patch": "@@ -2261,13 +2261,17 @@ ovl_iterator::reveal_node (tree overload, tree node)\n \n   OVL_HIDDEN_P (node) = false;\n   if (tree chain = OVL_CHAIN (node))\n-    if (TREE_CODE (chain) == OVERLOAD\n-\t&& (OVL_USING_P (chain) || OVL_HIDDEN_P (chain)))\n+    if (TREE_CODE (chain) == OVERLOAD)\n       {\n-\t/* The node needs moving, and the simplest way is to remove it\n-\t   and reinsert.  */\n-\toverload = remove_node (overload, node);\n-\toverload = ovl_insert (OVL_FUNCTION (node), overload);\n+\tif (OVL_HIDDEN_P (chain))\n+\t  {\n+\t    /* The node needs moving, and the simplest way is to remove it\n+\t       and reinsert.  */\n+\t    overload = remove_node (overload, node);\n+\t    overload = ovl_insert (OVL_FUNCTION (node), overload);\n+\t  }\n+\telse if (OVL_DEDUP_P (chain))\n+\t  OVL_DEDUP_P (node) = true;\n       }\n   return overload;\n }"}, {"sha": "9bb807e7141125a15f4ee2f1abb03731a3220614", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "patch": "@@ -1,3 +1,8 @@\n+2018-11-07  Nathan Sidwell  <nathan@acm.org>\n+\n+\tPR c++/87904\n+\t* g++.dg/lookup/pr87904.C: New.\n+\n 2018-11-07  Uros Bizjak  <ubizjak@gmail.com>\n \n \t* gcc.dg/pr87874.c: Compile only for int128 effective target."}, {"sha": "a40b32c85dcf32ef24bfea783ba15b96f89433d6", "filename": "gcc/testsuite/g++.dg/lookup/pr87904.C", "status": "added", "additions": 21, "deletions": 0, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fpr87904.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fpr87904.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Flookup%2Fpr87904.C?ref=72a7649aa53aa210bbe0d89f1ee083f7fcfc61d6", "patch": "@@ -0,0 +1,21 @@\n+// PR c++ 87904 ICE failing to initiate deduping\n+\n+namespace X {\n+  void Foo (char);\n+}\n+\n+struct B {\n+  friend void Foo (int);\n+};\n+\n+using X::Foo;\n+\n+void Foo (float);\n+void Foo(int);\n+\n+void frob ()\n+{\n+  using namespace X;\n+\n+  Foo (1);\n+}"}]}