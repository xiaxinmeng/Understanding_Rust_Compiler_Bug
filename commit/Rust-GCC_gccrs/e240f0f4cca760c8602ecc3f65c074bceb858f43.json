{"sha": "e240f0f4cca760c8602ecc3f65c074bceb858f43", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTI0MGYwZjRjY2E3NjBjODYwMmVjYzNmNjVjMDc0YmNlYjg1OGY0Mw==", "commit": {"author": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2010-08-27T12:08:47Z"}, "committer": {"name": "Thomas Koenig", "email": "tkoenig@gcc.gnu.org", "date": "2010-08-27T12:08:47Z"}, "message": "re PR fortran/45159 (Unnecessary temporaries)\n\n2010-08-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/45159\n\t* dependency.c (check_section_vs_section):  Single test for\n\tidentical strides which takes into account that only one\n\tof the strides may be NULL.\n\n2010-08-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n\n\tPR fortran/45159\n\t* gfortran.dg/dependency_33.f90:  New test.\n\nFrom-SVN: r163584", "tree": {"sha": "fa5f87e42396f0c207f585f44deca18f326f388b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/fa5f87e42396f0c207f585f44deca18f326f388b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e240f0f4cca760c8602ecc3f65c074bceb858f43", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e240f0f4cca760c8602ecc3f65c074bceb858f43", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e240f0f4cca760c8602ecc3f65c074bceb858f43", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e240f0f4cca760c8602ecc3f65c074bceb858f43/comments", "author": null, "committer": null, "parents": [{"sha": "6d446ecf6053a32a25ceab6bc0e19569ead2124e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6d446ecf6053a32a25ceab6bc0e19569ead2124e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6d446ecf6053a32a25ceab6bc0e19569ead2124e"}], "stats": {"total": 59, "additions": 44, "deletions": 15}, "files": [{"sha": "9bd81c388b8333daa195b0a5cb161d80fca1351b", "filename": "gcc/fortran/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ffortran%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ffortran%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2FChangeLog?ref=e240f0f4cca760c8602ecc3f65c074bceb858f43", "patch": "@@ -1,3 +1,10 @@\n+2010-08-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/45159\n+\t* dependency.c (check_section_vs_section):  Single test for\n+\tidentical strides which takes into account that only one\n+\tof the strides may be NULL.\n+\n 2010-08-27  Jerry DeLisle  <jvdelisle@gcc.gnu.org>\n \n \tPR fortran/43217"}, {"sha": "ab75bdee54ad9cfb95af32f130018ae3f6af3b5c", "filename": "gcc/fortran/dependency.c", "status": "modified", "additions": 21, "deletions": 15, "changes": 36, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ffortran%2Fdependency.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ffortran%2Fdependency.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ffortran%2Fdependency.c?ref=e240f0f4cca760c8602ecc3f65c074bceb858f43", "patch": "@@ -1023,6 +1023,7 @@ check_section_vs_section (gfc_array_ref *l_ar, gfc_array_ref *r_ar, int n)\n   gfc_expr *r_lower;\n   gfc_expr *r_upper;\n   int r_dir;\n+  bool identical_strides;\n \n   /* If they are the same range, return without more ado.  */\n   if (gfc_is_same_range (l_ar, r_ar, n, 0))\n@@ -1076,6 +1077,23 @@ check_section_vs_section (gfc_array_ref *l_ar, gfc_array_ref *r_ar, int n)\n   if (l_dir == 0 || r_dir == 0)\n     return GFC_DEP_OVERLAP;\n \n+  /* Determine if the strides are equal.  */\n+\n+  if (l_stride)\n+    {\n+      if (r_stride)\n+\tidentical_strides = gfc_dep_compare_expr (l_stride, r_stride) == 0;\n+      else\n+\tidentical_strides = gfc_expr_is_one (l_stride, 0) == 1;\n+    }\n+  else\n+    {\n+      if (r_stride)\n+\tidentical_strides = gfc_expr_is_one (r_stride, 0) == 1;\n+      else\n+\tidentical_strides = true;\n+    }\n+\n   /* Determine LHS upper and lower bounds.  */\n   if (l_dir == 1)\n     {\n@@ -1175,11 +1193,7 @@ check_section_vs_section (gfc_array_ref *l_ar, gfc_array_ref *r_ar, int n)\n       && l_start && r_start && gfc_dep_compare_expr (l_start, r_start) == -1\n       && l_end && r_end && gfc_dep_compare_expr (l_end, r_end) == -1)\n     {\n-      /* Check that the strides are the same.  */\n-      if (!l_stride && !r_stride)\n-\treturn GFC_DEP_FORWARD;\n-      if (l_stride && r_stride\n-\t  && gfc_dep_compare_expr (l_stride, r_stride) == 0)\n+      if (identical_strides)\n \treturn GFC_DEP_FORWARD;\n     }\n \n@@ -1188,20 +1202,12 @@ check_section_vs_section (gfc_array_ref *l_ar, gfc_array_ref *r_ar, int n)\n       && l_start && r_start && gfc_dep_compare_expr (l_start, r_start) == 1\n       && l_end && r_end && gfc_dep_compare_expr (l_end, r_end) == 1)\n     {\n-      /* Check that the strides are the same.  */\n-      if (!l_stride && !r_stride)\n-\treturn GFC_DEP_FORWARD;\n-      if (l_stride && r_stride\n-\t  && gfc_dep_compare_expr (l_stride, r_stride) == 0)\n+      if (identical_strides)\n \treturn GFC_DEP_FORWARD;\n     }\n \n \n-  /*  Are the strides the same?  */\n-  if ((!l_stride && !r_stride)\n-\t||\n-      (l_stride && r_stride\n-\t&& gfc_dep_compare_expr (l_stride, r_stride) == 0))\n+  if (identical_strides)\n     {\n \n       if (l_start && IS_ARRAY_EXPLICIT (l_ar->as))"}, {"sha": "1c1dc43e6380f6466295c688ca77ea623d0aef74", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=e240f0f4cca760c8602ecc3f65c074bceb858f43", "patch": "@@ -1,3 +1,8 @@\n+2010-08-27  Thomas Koenig  <tkoenig@gcc.gnu.org>\n+\n+\tPR fortran/45159\n+\t* gfortran.dg/dependency_33.f90:  New test.\n+\n 2010-08-27  Richard Guenther  <rguenther@suse.de>\n \n \t* gcc.dg/graphite/scop-1.c: Fix out-of-bound array accesses."}, {"sha": "cf6f175d4a8cac5805dc5f1828bdcfc492b29202", "filename": "gcc/testsuite/gfortran.dg/dependency_33.f90", "status": "added", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_33.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e240f0f4cca760c8602ecc3f65c074bceb858f43/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_33.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fdependency_33.f90?ref=e240f0f4cca760c8602ecc3f65c074bceb858f43", "patch": "@@ -0,0 +1,11 @@\n+! { dg-do compile }\n+! { dg-options \"-Warray-temporaries\" }\n+! No temporary should be created for this, as a missing stride and\n+! a stride equal to one should be equal.\n+program main\n+  integer a(100)\n+  a(10:16) = a(11:17)\n+  a(10:16) = a(11:17:1)\n+  a(10:16:1) = a(11:17)\n+  a(10:16:1) = a(11:17:1)\n+end program main"}]}