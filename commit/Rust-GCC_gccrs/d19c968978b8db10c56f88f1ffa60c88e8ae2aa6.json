{"sha": "d19c968978b8db10c56f88f1ffa60c88e8ae2aa6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZDE5Yzk2ODk3OGI4ZGIxMGM1NmY4OGYxZmZhNjBjODhlOGFlMmFhNg==", "commit": {"author": {"name": "Tom Tromey", "email": "tromey@redhat.com", "date": "2001-03-16T20:54:45Z"}, "committer": {"name": "Tom Tromey", "email": "tromey@gcc.gnu.org", "date": "2001-03-16T20:54:45Z"}, "message": "libjava.exp (libjava_arguments): Rewrote computation of LD_LIBRARY_PATH.\n\n\t* lib/libjava.exp (libjava_arguments): Rewrote computation of\n\tLD_LIBRARY_PATH.  Add gcc build directory if it contains\n\tlibgcc_s.so.\n\nFrom-SVN: r40564", "tree": {"sha": "5e25eb5e82415bf2b8d8bb2666d3b443886ec001", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/5e25eb5e82415bf2b8d8bb2666d3b443886ec001"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6/comments", "author": null, "committer": null, "parents": [{"sha": "2d6eb5bf63bab4c99bc257b3d61aed5244033e12", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/2d6eb5bf63bab4c99bc257b3d61aed5244033e12", "html_url": "https://github.com/Rust-GCC/gccrs/commit/2d6eb5bf63bab4c99bc257b3d61aed5244033e12"}], "stats": {"total": 37, "additions": 27, "deletions": 10}, "files": [{"sha": "fc6036be62f3eed5ec86e6e7258f0550144b9ae4", "filename": "libjava/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6/libjava%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6/libjava%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2FChangeLog?ref=d19c968978b8db10c56f88f1ffa60c88e8ae2aa6", "patch": "@@ -1,3 +1,9 @@\n+2001-03-16  Tom Tromey  <tromey@redhat.com>\n+\n+\t* lib/libjava.exp (libjava_arguments): Rewrote computation of\n+\tLD_LIBRARY_PATH.  Add gcc build directory if it contains\n+\tlibgcc_s.so.\n+\n 2001-03-14  Tom Tromey  <tromey@redhat.com>\n \n \t* libjava.compile/assignment.xfail: Removed."}, {"sha": "14be474994604d057a5f7233815ff1b193def15c", "filename": "libjava/testsuite/lib/libjava.exp", "status": "modified", "additions": 21, "deletions": 10, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6/libjava%2Ftestsuite%2Flib%2Flibjava.exp", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/d19c968978b8db10c56f88f1ffa60c88e8ae2aa6/libjava%2Ftestsuite%2Flib%2Flibjava.exp", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libjava%2Ftestsuite%2Flib%2Flibjava.exp?ref=d19c968978b8db10c56f88f1ffa60c88e8ae2aa6", "patch": "@@ -1,4 +1,4 @@\n-# Copyright (C) 1998, 1999, 2000 Free Software Foundation\n+# Copyright (C) 1998, 1999, 2000, 2001 Free Software Foundation\n \n load_lib \"libgloss.exp\"\n \n@@ -192,6 +192,7 @@ proc libjava_arguments {{mode compile}} {\n     global tmpdir\n     global runtests\n     global env\n+    global tool_root_dir\n \n     if [info exists LIBJAVA] {\n \tset libjava $LIBJAVA;\n@@ -230,17 +231,25 @@ proc libjava_arguments {{mode compile}} {\n     # Basically we want to build up a colon separated path list from\n     # the value of $libjava.\n \n-    # First strip away any -L arguments.\n-    regsub -all -- \"-L\" $libjava \"\" ld_library_path\n-\n-    # Then remove any -lgcj argument.\n-    regsub -all -- \" -lgcj.*\" $ld_library_path \"\" ld_library_path\n+    set lpath {}\n+    foreach dir [list $libjava $libgc $libz] {\n+\tforeach item [split $dir \" \"] {\n+\t    switch -glob -- $item {\n+\t\t\"-L*\" {\n+\t\t    lappend lpath [string range $item 2 end]\n+\t\t}\n+\t    }\n+\t}\n+    }\n \n-    # First strip away any -L arguments.\n-    regsub -all -- \"-L\" $libgc $ld_library_path ld_library_path\n+    # Finally, add the gcc build directory so that we can find the\n+    # shared libgcc.  This, like much of dejagnu, is hideous.\n+    set gccdir [lookfor_file $tool_root_dir gcc/libgcc_s.so]\n+    if {$gccdir != \"\"} {\n+\tlappend lpath [file dirname $gccdir]\n+    }\n \n-    # Then remove any -lgcjgc argument.\n-    regsub -all -- \" -lgcjgc.*\" $ld_library_path \"\" ld_library_path\n+    set ld_library_path [join $lpath :]\n \n     # That's enough to make things work for the normal case.\n     # If we wanted to handle an arbitrary value of libjava,\n@@ -251,6 +260,8 @@ proc libjava_arguments {{mode compile}} {\n     setenv LD_LIBRARY_PATH \"$ld_library_path:$original_ld_library_path\"\n     setenv SHLIB_PATH \"$ld_library_path:$original_ld_library_path\"\n \n+    verbose \"LD_LIBRARY_PATH = $env(LD_LIBRARY_PATH)\"\n+\n     # Set the CLASSPATH environment variable\n     verbose \"CLASSPATH is .:$srcdir/$subdir:$objdir:$objdir/../libgcj.jar\"\n     global env"}]}