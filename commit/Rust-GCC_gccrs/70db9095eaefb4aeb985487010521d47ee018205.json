{"sha": "70db9095eaefb4aeb985487010521d47ee018205", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NzBkYjkwOTVlYWVmYjRhZWI5ODU0ODcwMTA1MjFkNDdlZTAxODIwNQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-07-08T20:09:58Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-07-08T20:09:58Z"}, "message": "re PR target/49621 (ICE in trunc_int_for_mode, at explow.c:57)\n\n\tPR target/49621\n\t* config/rs6000/rs6000.c (rs6000_emit_vector_cond_expr): Use\n\tCONST0_RTX (dest_mode) instead of const0_rtx as second operand\n\tof NE.\n\t* config/rs6000/vector.md (vector_select_<mode>,\n\tvector_select_<mode>_uns): Change second operand of NE to\n\tCONST0_RTX (<MODE>mode) instead of const0_rtx.\n\t* config/rs6000/altivec.md (*altivec_vsel<mode>,\n\t*altivec_vsel<mode>_uns): Expect second operand of NE to be\n\tzero_constant of the corresponding vector mode.\n\t* config/rs6000/vsx.md (*vsx_xxsel<mode>, *vsx_xxsel<mode>_uns):\n\tLikewise.\n\n\t* gcc.target/powerpc/altivec-34.c: New test.\n\nFrom-SVN: r176063", "tree": {"sha": "7bcf9c5b838741b00716f92f5cbc84858505c0ca", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/7bcf9c5b838741b00716f92f5cbc84858505c0ca"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/70db9095eaefb4aeb985487010521d47ee018205", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70db9095eaefb4aeb985487010521d47ee018205", "html_url": "https://github.com/Rust-GCC/gccrs/commit/70db9095eaefb4aeb985487010521d47ee018205", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/70db9095eaefb4aeb985487010521d47ee018205/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d6919c1f42428a468242b8d6c824361d18bc19b7", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d6919c1f42428a468242b8d6c824361d18bc19b7", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d6919c1f42428a468242b8d6c824361d18bc19b7"}], "stats": {"total": 62, "additions": 53, "deletions": 9}, "files": [{"sha": "8ad805822fe32d96f49b0eb91094bccc76b10f43", "filename": "gcc/ChangeLog", "status": "modified", "additions": 15, "deletions": 0, "changes": 15, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -1,3 +1,18 @@\n+2011-07-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/49621\n+\t* config/rs6000/rs6000.c (rs6000_emit_vector_cond_expr): Use\n+\tCONST0_RTX (dest_mode) instead of const0_rtx as second operand\n+\tof NE.\n+\t* config/rs6000/vector.md (vector_select_<mode>,\n+\tvector_select_<mode>_uns): Change second operand of NE to\n+\tCONST0_RTX (<MODE>mode) instead of const0_rtx.\n+\t* config/rs6000/altivec.md (*altivec_vsel<mode>,\n+\t*altivec_vsel<mode>_uns): Expect second operand of NE to be\n+\tzero_constant of the corresponding vector mode.\n+\t* config/rs6000/vsx.md (*vsx_xxsel<mode>, *vsx_xxsel<mode>_uns):\n+\tLikewise.\n+\n 2011-07-08  Sebastian Pop  <sebastian.pop@amd.com>\n \n \t* graphite-dependences.c (build_alias_set_powerset): Remove"}, {"sha": "9e7437ed0fe995dbc1a118e766d0e10d1a058788", "filename": "gcc/config/rs6000/altivec.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Faltivec.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Faltivec.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Faltivec.md?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -487,7 +487,7 @@\n   [(set (match_operand:VM 0 \"altivec_register_operand\" \"=v\")\n \t(if_then_else:VM\n \t (ne:CC (match_operand:VM 1 \"altivec_register_operand\" \"v\")\n-\t\t(const_int 0))\n+\t\t(match_operand:VM 4 \"zero_constant\" \"\"))\n \t (match_operand:VM 2 \"altivec_register_operand\" \"v\")\n \t (match_operand:VM 3 \"altivec_register_operand\" \"v\")))]\n   \"VECTOR_MEM_ALTIVEC_P (<MODE>mode)\"\n@@ -498,7 +498,7 @@\n   [(set (match_operand:VM 0 \"altivec_register_operand\" \"=v\")\n \t(if_then_else:VM\n \t (ne:CCUNS (match_operand:VM 1 \"altivec_register_operand\" \"v\")\n-\t\t   (const_int 0))\n+\t\t   (match_operand:VM 4 \"zero_constant\" \"\"))\n \t (match_operand:VM 2 \"altivec_register_operand\" \"v\")\n \t (match_operand:VM 3 \"altivec_register_operand\" \"v\")))]\n   \"VECTOR_MEM_ALTIVEC_P (<MODE>mode)\""}, {"sha": "475c10485f8c1226dd50e47f4aca0865037714b3", "filename": "gcc/config/rs6000/rs6000.c", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Frs6000.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Frs6000.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Frs6000.c?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -16888,7 +16888,7 @@ rs6000_emit_vector_cond_expr (rtx dest, rtx op_true, rtx op_false,\n       op_false = tmp;\n     }\n \n-  cond2 = gen_rtx_fmt_ee (NE, cc_mode, mask, const0_rtx);\n+  cond2 = gen_rtx_fmt_ee (NE, cc_mode, mask, CONST0_RTX (dest_mode));\n   emit_insn (gen_rtx_SET (VOIDmode,\n \t\t\t  dest,\n \t\t\t  gen_rtx_IF_THEN_ELSE (dest_mode,"}, {"sha": "4799ff29e0a099040f79c238c4f87f21133f58ca", "filename": "gcc/config/rs6000/vector.md", "status": "modified", "additions": 4, "deletions": 4, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Fvector.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Fvector.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fvector.md?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -465,21 +465,21 @@\n   [(set (match_operand:VEC_L 0 \"vlogical_operand\" \"\")\n \t(if_then_else:VEC_L\n \t (ne:CC (match_operand:VEC_L 3 \"vlogical_operand\" \"\")\n-\t\t(const_int 0))\n+\t\t(match_dup 4))\n \t (match_operand:VEC_L 2 \"vlogical_operand\" \"\")\n \t (match_operand:VEC_L 1 \"vlogical_operand\" \"\")))]\n   \"VECTOR_UNIT_ALTIVEC_OR_VSX_P (<MODE>mode)\"\n-  \"\")\n+  \"operands[4] = CONST0_RTX (<MODE>mode);\")\n \n (define_expand \"vector_select_<mode>_uns\"\n   [(set (match_operand:VEC_L 0 \"vlogical_operand\" \"\")\n \t(if_then_else:VEC_L\n \t (ne:CCUNS (match_operand:VEC_L 3 \"vlogical_operand\" \"\")\n-\t\t   (const_int 0))\n+\t\t   (match_dup 4))\n \t (match_operand:VEC_L 2 \"vlogical_operand\" \"\")\n \t (match_operand:VEC_L 1 \"vlogical_operand\" \"\")))]\n   \"VECTOR_UNIT_ALTIVEC_OR_VSX_P (<MODE>mode)\"\n-  \"\")\n+  \"operands[4] = CONST0_RTX (<MODE>mode);\")\n \n ;; Expansions that compare vectors producing a vector result and a predicate,\n ;; setting CR6 to indicate a combined status"}, {"sha": "b4d1e8b750991a359c1c3b7b3ff8c0daaab9e6f2", "filename": "gcc/config/rs6000/vsx.md", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Fvsx.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Fconfig%2Frs6000%2Fvsx.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Frs6000%2Fvsx.md?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -674,7 +674,7 @@\n   [(set (match_operand:VSX_L 0 \"vsx_register_operand\" \"=<VSr>,?wa\")\n \t(if_then_else:VSX_L\n \t (ne:CC (match_operand:VSX_L 1 \"vsx_register_operand\" \"<VSr>,wa\")\n-\t\t(const_int 0))\n+\t\t(match_operand:VSX_L 4 \"zero_constant\" \"\"))\n \t (match_operand:VSX_L 2 \"vsx_register_operand\" \"<VSr>,wa\")\n \t (match_operand:VSX_L 3 \"vsx_register_operand\" \"<VSr>,wa\")))]\n   \"VECTOR_MEM_VSX_P (<MODE>mode)\"\n@@ -685,7 +685,7 @@\n   [(set (match_operand:VSX_L 0 \"vsx_register_operand\" \"=<VSr>,?wa\")\n \t(if_then_else:VSX_L\n \t (ne:CCUNS (match_operand:VSX_L 1 \"vsx_register_operand\" \"<VSr>,wa\")\n-\t\t   (const_int 0))\n+\t\t   (match_operand:VSX_L 4 \"zero_constant\" \"\"))\n \t (match_operand:VSX_L 2 \"vsx_register_operand\" \"<VSr>,wa\")\n \t (match_operand:VSX_L 3 \"vsx_register_operand\" \"<VSr>,wa\")))]\n   \"VECTOR_MEM_VSX_P (<MODE>mode)\""}, {"sha": "fc6931a24d22897a7a534b45b84a6c4f1bc4184a", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -1,3 +1,8 @@\n+2011-07-08  Jakub Jelinek  <jakub@redhat.com>\n+\n+\tPR target/49621\n+\t* gcc.target/powerpc/altivec-34.c: New test.\n+\n 2011-07-08  Jason Merrill  <jason@redhat.com>\n \n \tPR c++/45603"}, {"sha": "8e6372bfb43dea93a50592c433aa6a6d11766256", "filename": "gcc/testsuite/gcc.target/powerpc/altivec-34.c", "status": "added", "additions": 24, "deletions": 0, "changes": 24, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Faltivec-34.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/70db9095eaefb4aeb985487010521d47ee018205/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Faltivec-34.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fpowerpc%2Faltivec-34.c?ref=70db9095eaefb4aeb985487010521d47ee018205", "patch": "@@ -0,0 +1,24 @@\n+/* PR target/49621 */\n+/* { dg-do compile } */\n+/* { dg-options \"-O2 -maltivec\" } */\n+\n+#include <altivec.h>\n+\n+int\n+foo (void)\n+{\n+  vector unsigned a, b, c;\n+  unsigned k = 1;\n+\n+  a = (vector unsigned) { 0, 0, 0, 1 };\n+  b = c = (vector unsigned) { 0, 0, 0, 0 };\n+\n+  a = vec_add (a, vec_splats (k));\n+  b = vec_add (b, a);\n+  c = vec_sel (c, a, b);\n+\n+  if (vec_any_eq (b, c))\n+    return 1;\n+\n+  return 0;\n+}"}]}