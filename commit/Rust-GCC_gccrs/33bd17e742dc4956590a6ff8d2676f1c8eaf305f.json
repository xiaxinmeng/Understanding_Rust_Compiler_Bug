{"sha": "33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6MzNiZDE3ZTc0MmRjNDk1NjU5MGE2ZmY4ZDI2NzZmMWM4ZWFmMzA1Zg==", "commit": {"author": {"name": "Ed Schonberg", "email": "schonberg@adacore.com", "date": "2013-01-04T09:21:55Z"}, "committer": {"name": "Arnaud Charlet", "email": "charlet@gcc.gnu.org", "date": "2013-01-04T09:21:55Z"}, "message": "sem_ch3.adb (Build_Private_Derived_Type): Set Has_Private_Ancestor on type derived from an untagged private type whose...\n\n2013-01-04  Ed Schonberg  <schonberg@adacore.com>\n\n\t* sem_ch3.adb (Build_Private_Derived_Type): Set\n\tHas_Private_Ancestor on type derived from an untagged private\n\ttype whose full view has discriminants\n\t* sem_aggr.adb (Resolve_Record_Aggregate): Reject non-extension\n\taggregate for untagged record type with private ancestor.\n\nFrom-SVN: r194892", "tree": {"sha": "29f6c9ea9bb03ebae458ad5bad97ea6dc9873839", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/29f6c9ea9bb03ebae458ad5bad97ea6dc9873839"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/comments", "author": {"login": "Edschonberg", "id": 6352375, "node_id": "MDQ6VXNlcjYzNTIzNzU=", "avatar_url": "https://avatars.githubusercontent.com/u/6352375?v=4", "gravatar_id": "", "url": "https://api.github.com/users/Edschonberg", "html_url": "https://github.com/Edschonberg", "followers_url": "https://api.github.com/users/Edschonberg/followers", "following_url": "https://api.github.com/users/Edschonberg/following{/other_user}", "gists_url": "https://api.github.com/users/Edschonberg/gists{/gist_id}", "starred_url": "https://api.github.com/users/Edschonberg/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/Edschonberg/subscriptions", "organizations_url": "https://api.github.com/users/Edschonberg/orgs", "repos_url": "https://api.github.com/users/Edschonberg/repos", "events_url": "https://api.github.com/users/Edschonberg/events{/privacy}", "received_events_url": "https://api.github.com/users/Edschonberg/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "5ee96c9da4b521cd593ef2db444bb0337802c184", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/5ee96c9da4b521cd593ef2db444bb0337802c184", "html_url": "https://github.com/Rust-GCC/gccrs/commit/5ee96c9da4b521cd593ef2db444bb0337802c184"}], "stats": {"total": 39, "additions": 35, "deletions": 4}, "files": [{"sha": "fe3d35100e9897b449c79f1aa804f69a7ae6f49b", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 8, "deletions": 0, "changes": 8, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "patch": "@@ -1,3 +1,11 @@\n+2013-01-04  Ed Schonberg  <schonberg@adacore.com>\n+\n+\t* sem_ch3.adb (Build_Private_Derived_Type): Set\n+\tHas_Private_Ancestor on type derived from an untagged private\n+\ttype whose full view has discriminants\n+\t* sem_aggr.adb (Resolve_Record_Aggregate): Reject non-extension\n+\taggregate for untagged record type with private ancestor.\n+\n 2013-01-04  Thomas Quinot  <quinot@adacore.com>\n \n \t* sem_elab.adb, sem_ch3.adb: Minor reformatting."}, {"sha": "5e3278a6f87e5f1b3ced40196abd56b109bb2862", "filename": "gcc/ada/sem_aggr.adb", "status": "modified", "additions": 18, "deletions": 1, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/gcc%2Fada%2Fsem_aggr.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/gcc%2Fada%2Fsem_aggr.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_aggr.adb?ref=33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "patch": "@@ -3560,7 +3560,7 @@ package body Sem_Aggr is\n          end if;\n \n          --  AI05-0115: if the ancestor part is a subtype mark, the ancestor\n-         --  must npt have unknown discriminants.\n+         --  must not have unknown discriminants.\n \n          if Is_Derived_Type (Typ)\n            and then Has_Unknown_Discriminants (Root_Type (Typ))\n@@ -3886,7 +3886,24 @@ package body Sem_Aggr is\n                Next_Elmt (Parent_Elmt);\n             end loop;\n \n+         --  Typ is not a derived tagged type\n+\n          else\n+            --  A type derived from an untagged private type whose full view\n+            --  has discriminants is constructed as a record type but there\n+            --  are no legal aggregates for it.\n+\n+            if Is_Derived_Type (Typ)\n+              and then Has_Private_Ancestor (Typ)\n+              and then Nkind (N) /= N_Extension_Aggregate\n+            then\n+               Error_Msg_Node_2 := Base_Type (Etype (Typ));\n+               Error_Msg_NE\n+                 (\"no aggregate available for type& derived from \"\n+                  & \"private type&\", N, Typ);\n+               return;\n+            end if;\n+\n             Record_Def := Type_Definition (Parent (Base_Type (Typ)));\n \n             if Null_Present (Record_Def) then"}, {"sha": "ccbd5117d933817dfdef991551e458517b7259e8", "filename": "gcc/ada/sem_ch3.adb", "status": "modified", "additions": 9, "deletions": 3, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/gcc%2Fada%2Fsem_ch3.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/33bd17e742dc4956590a6ff8d2676f1c8eaf305f/gcc%2Fada%2Fsem_ch3.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fsem_ch3.adb?ref=33bd17e742dc4956590a6ff8d2676f1c8eaf305f", "patch": "@@ -6417,8 +6417,9 @@ package body Sem_Ch3 is\n            and then (In_Open_Scopes (Scope (Parent_Type)))\n          then\n             Full_Der :=\n-              Make_Defining_Identifier\n-                (Sloc (Derived_Type), Chars (Derived_Type));\n+              Make_Defining_Identifier (Sloc (Derived_Type),\n+                Chars => Chars (Derived_Type));\n+\n             Set_Is_Itype (Full_Der);\n             Set_Has_Private_Declaration (Full_Der);\n             Set_Has_Private_Declaration (Derived_Type);\n@@ -6434,7 +6435,12 @@ package body Sem_Ch3 is\n          else\n             Build_Derived_Record_Type\n               (N, Full_View (Parent_Type), Derived_Type,\n-                Derive_Subps => False);\n+               Derive_Subps => False);\n+\n+            --  Except in the context of the full view of the parent, there\n+            --  are no non-extension aggregates for the derived type.\n+\n+            Set_Has_Private_Ancestor (Derived_Type);\n          end if;\n \n          --  In any case, the primitive operations are inherited from the"}]}