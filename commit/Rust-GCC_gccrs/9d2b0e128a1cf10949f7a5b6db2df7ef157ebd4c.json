{"sha": "9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6OWQyYjBlMTI4YTFjZjEwOTQ5ZjdhNWI2ZGIyZGY3ZWYxNTdlYmQ0Yw==", "commit": {"author": {"name": "Volker Reichelt", "email": "reichelt@igpm.rwth-aachen.de", "date": "2005-08-03T14:18:56Z"}, "committer": {"name": "Volker Reichelt", "email": "reichelt@gcc.gnu.org", "date": "2005-08-03T14:18:56Z"}, "message": "re PR tree-optimization/19899 (ICE: tree check: expected real_cst, have integer_cst in const_binop, at fold-const.c:1490 with -ftree-vectorize -msse2)\n\n\tPR tree-optimization/19899\n\t* Makefile.in (tree-scalar-evolution.o): Add real.h.\n\t* tree-scalar-evolution.c: Include real.h.\n\t(add_to_evolution): Build constant -1 of correct type.\n\n\t* gcc.dg/tree-ssa/scev-1.c: New test.\n\t* gcc.dg/tree-ssa/scev-2.c: New test.\n\nFrom-SVN: r102695", "tree": {"sha": "bac0d1350104882338d136860782796fa710de2b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/bac0d1350104882338d136860782796fa710de2b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "html_url": "https://github.com/Rust-GCC/gccrs/commit/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/comments", "author": null, "committer": null, "parents": [{"sha": "3ed831a4a786bb5357035449cc0e9bec967a7ad0", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/3ed831a4a786bb5357035449cc0e9bec967a7ad0", "html_url": "https://github.com/Rust-GCC/gccrs/commit/3ed831a4a786bb5357035449cc0e9bec967a7ad0"}], "stats": {"total": 60, "additions": 57, "deletions": 3}, "files": [{"sha": "c5893c967c788de5046f8dba6fbab7b798dab7b8", "filename": "gcc/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "patch": "@@ -1,3 +1,10 @@\n+2005-08-03  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR tree-optimization/19899\n+\t* Makefile.in (tree-scalar-evolution.o): Add real.h.\n+\t* tree-scalar-evolution.c: Include real.h.\n+\t(add_to_evolution): Build constant -1 of correct type.\n+\n 2005-08-03  Jan Hubicka  <jh@suse.cz>\n \n \t* cfgloop.h (DLTHE_FLAG_COMPLETTE_PEEL): New flag."}, {"sha": "e45a03c8dca858be6dc6d20532bb543e6b91f6c6", "filename": "gcc/Makefile.in", "status": "modified", "additions": 1, "deletions": 1, "changes": 2, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2FMakefile.in", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2FMakefile.in", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FMakefile.in?ref=9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "patch": "@@ -1945,7 +1945,7 @@ tree-chrec.o: tree-chrec.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\\n    $(GGC_H) $(TREE_H) tree-chrec.h tree-pass.h $(PARAMS_H) \\\n    $(DIAGNOSTIC_H) $(VARRAY_H) $(CFGLOOP_H) $(TREE_FLOW_H)\n tree-scalar-evolution.o: tree-scalar-evolution.c $(CONFIG_H) $(SYSTEM_H) \\\n-   coretypes.h $(TM_H) $(GGC_H) $(TREE_H) $(RTL_H) \\\n+   coretypes.h $(TM_H) $(GGC_H) $(TREE_H) real.h $(RTL_H) \\\n    $(BASIC_BLOCK_H) $(DIAGNOSTIC_H) $(TREE_FLOW_H) $(TREE_DUMP_H) \\\n    $(TIMEVAR_H) $(CFGLOOP_H) $(SCEV_H) tree-pass.h $(FLAGS_H) tree-chrec.h\n tree-data-ref.o: tree-data-ref.c $(CONFIG_H) $(SYSTEM_H) coretypes.h $(TM_H) \\"}, {"sha": "dbafe3aed8d3b598938962f192f40e4a02faa4cc", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "patch": "@@ -1,3 +1,9 @@\n+2005-08-03  Volker Reichelt  <reichelt@igpm.rwth-aachen.de>\n+\n+\tPR tree-optimization/19899\n+\t* gcc.dg/tree-ssa/scev-1.c: New test.\n+\t* gcc.dg/tree-ssa/scev-2.c: New test.\n+\n 2005-08-03  Richard Sandiford  <richard@codesourcery.com>\n \n \tPR target/18582"}, {"sha": "b959fa17b2c3f2a76942192fb31d71a42e6a2ad8", "filename": "gcc/testsuite/gcc.dg/tree-ssa/scev-1.c", "status": "added", "additions": 19, "deletions": 0, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fscev-1.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fscev-1.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fscev-1.c?ref=9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "patch": "@@ -0,0 +1,19 @@\n+/* PR tree-optimization/19899 */\n+/* Decrementing a floating-point variable in a loop caused an ICE.  */\n+\n+/* { dg-do run } */\n+/* { dg-options \"-O -ftree-vectorize\" } */\n+\n+extern void abort (void);\n+\n+int main()\n+{\n+  float i=1;\n+\n+  while (i>=0)\n+    --i;\n+\n+  if (i != -1)\n+    abort();\n+  return 0;\n+}"}, {"sha": "0cac994757641af43d3d98e1437d78dff876c814", "filename": "gcc/testsuite/gcc.dg/tree-ssa/scev-2.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fscev-2.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fscev-2.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftree-ssa%2Fscev-2.c?ref=9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "patch": "@@ -0,0 +1,20 @@\n+/* PR tree-optimization/19899 */\n+/* Decrementing a floating-point variable in a loop caused an ICE.  */\n+\n+/* { dg-do run } */\n+/* { dg-options \"-O -ftree-vectorize\" } */\n+\n+extern void abort (void);\n+\n+int main()\n+{\n+  double a = 20;\n+  int i;\n+\n+  for (i = 0; i < 10; ++i)\n+    a -= 2;\n+\n+  if (a)\n+    abort();\n+  return 0;\n+}"}, {"sha": "507e3e919473dd9f118a0cee21c2e45d52b29ff8", "filename": "gcc/tree-scalar-evolution.c", "status": "modified", "additions": 4, "deletions": 2, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftree-scalar-evolution.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c/gcc%2Ftree-scalar-evolution.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-scalar-evolution.c?ref=9d2b0e128a1cf10949f7a5b6db2df7ef157ebd4c", "patch": "@@ -237,6 +237,7 @@ Software Foundation, 51 Franklin Street, Fifth Floor, Boston, MA\n #include \"tm.h\"\n #include \"ggc.h\"\n #include \"tree.h\"\n+#include \"real.h\"\n \n /* These RTL headers are needed for basic-block.h.  */\n #include \"rtl.h\"\n@@ -866,8 +867,9 @@ add_to_evolution (unsigned loop_nb,\n     }\n \n   if (code == MINUS_EXPR)\n-    to_add = chrec_fold_multiply (type, to_add, \n-\t\t\t\t  build_int_cst_type (type, -1));\n+    to_add = chrec_fold_multiply (type, to_add, SCALAR_FLOAT_TYPE_P (type)\n+\t\t\t\t  ? build_real (type, dconstm1)\n+\t\t\t\t  : build_int_cst_type (type, -1));\n \n   res = add_to_evolution_1 (loop_nb, chrec_before, to_add);\n "}]}