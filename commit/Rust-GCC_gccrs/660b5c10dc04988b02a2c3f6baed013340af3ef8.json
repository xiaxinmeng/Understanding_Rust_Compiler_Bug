{"sha": "660b5c10dc04988b02a2c3f6baed013340af3ef8", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjYwYjVjMTBkYzA0OTg4YjAyYTJjM2Y2YmFlZDAxMzM0MGFmM2VmOA==", "commit": {"author": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-08-25T08:59:24Z"}, "committer": {"name": "Richard Biener", "email": "rguenther@suse.de", "date": "2020-08-25T12:11:49Z"}, "message": "tree-optimization/96548 - fix failure to recompute RPO after CFG change\n\nThis recomputes RPO after store-motion changes the CFG.\n\n2020-08-25  Richard Biener  <rguenther@suse.de>\n\n\tPR tree-optimization/96548\n\tPR tree-optimization/96760\n\t* tree-ssa-loop-im.c (tree_ssa_lim): Recompute RPO after\n\tstore-motion.\n\n\t* gcc.dg/torture/pr96548.c: New testcase.\n\t* gcc.dg/torture/pr96760.c: Likewise.", "tree": {"sha": "87ad77984f83a57eefbe2972c05f3f65932bc719", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/87ad77984f83a57eefbe2972c05f3f65932bc719"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/660b5c10dc04988b02a2c3f6baed013340af3ef8", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/660b5c10dc04988b02a2c3f6baed013340af3ef8", "html_url": "https://github.com/Rust-GCC/gccrs/commit/660b5c10dc04988b02a2c3f6baed013340af3ef8", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/660b5c10dc04988b02a2c3f6baed013340af3ef8/comments", "author": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "committer": {"login": "rguenth", "id": 2046526, "node_id": "MDQ6VXNlcjIwNDY1MjY=", "avatar_url": "https://avatars.githubusercontent.com/u/2046526?v=4", "gravatar_id": "", "url": "https://api.github.com/users/rguenth", "html_url": "https://github.com/rguenth", "followers_url": "https://api.github.com/users/rguenth/followers", "following_url": "https://api.github.com/users/rguenth/following{/other_user}", "gists_url": "https://api.github.com/users/rguenth/gists{/gist_id}", "starred_url": "https://api.github.com/users/rguenth/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/rguenth/subscriptions", "organizations_url": "https://api.github.com/users/rguenth/orgs", "repos_url": "https://api.github.com/users/rguenth/repos", "events_url": "https://api.github.com/users/rguenth/events{/privacy}", "received_events_url": "https://api.github.com/users/rguenth/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "a5b15fcb954ba63d58f0daa700281aba33b5f24a", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a5b15fcb954ba63d58f0daa700281aba33b5f24a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a5b15fcb954ba63d58f0daa700281aba33b5f24a"}], "stats": {"total": 46, "additions": 46, "deletions": 0}, "files": [{"sha": "a0547427d29cd15cfa6246ca36acee35c922f68b", "filename": "gcc/testsuite/gcc.dg/torture/pr96548.c", "status": "added", "additions": 20, "deletions": 0, "changes": 20, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/660b5c10dc04988b02a2c3f6baed013340af3ef8/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr96548.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/660b5c10dc04988b02a2c3f6baed013340af3ef8/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr96548.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr96548.c?ref=660b5c10dc04988b02a2c3f6baed013340af3ef8", "patch": "@@ -0,0 +1,20 @@\n+/* { dg-do compile } */\n+\n+int c9, d3;\n+\n+void\n+sg (int *rs, int f2)\n+{\n+  for (;;)\n+    {\n+      if (*rs < 1)\n+        __builtin_unreachable ();\n+\n+      for (c9 = 0; c9 < 1; ++c9)\n+        while (f2 < 1)\n+          ++c9;\n+\n+      if (d3)\n+        c9 += !!f2 ? 0 : d3;\n+    }\n+}"}, {"sha": "4f6bbe96faf2dda9d21243f49a752283af1c6432", "filename": "gcc/testsuite/gcc.dg/torture/pr96760.c", "status": "added", "additions": 22, "deletions": 0, "changes": 22, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/660b5c10dc04988b02a2c3f6baed013340af3ef8/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr96760.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/660b5c10dc04988b02a2c3f6baed013340af3ef8/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr96760.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.dg%2Ftorture%2Fpr96760.c?ref=660b5c10dc04988b02a2c3f6baed013340af3ef8", "patch": "@@ -0,0 +1,22 @@\n+/* { dg-do run } */\n+\n+char a = 0, f = 0, c = 5;\n+unsigned long d = 0;\n+int g = 0;\n+int *e = &g;\n+\n+int main() {\n+  char  b = 0;\n+  for (;;) {\n+    for (a = 0; a < 2; a++) { // no UB I believe\n+      if (c) {\n+        if (d != 0)\n+          __builtin_abort ();\n+        return 0;\n+      }\n+    }\n+    f = (d++, *e);\n+  }\n+\n+  return 1;\n+}"}, {"sha": "f87c287d74210711ccc0fc8bb19b508824cc2ce8", "filename": "gcc/tree-ssa-loop-im.c", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/660b5c10dc04988b02a2c3f6baed013340af3ef8/gcc%2Ftree-ssa-loop-im.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/660b5c10dc04988b02a2c3f6baed013340af3ef8/gcc%2Ftree-ssa-loop-im.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-ssa-loop-im.c?ref=660b5c10dc04988b02a2c3f6baed013340af3ef8", "patch": "@@ -3115,6 +3115,10 @@ tree_ssa_lim (function *fun)\n      out of the loops as well.  */\n   do_store_motion ();\n \n+  free (rpo);\n+  rpo = XNEWVEC (int, last_basic_block_for_fn (fun));\n+  n = pre_and_rev_post_order_compute_fn (fun, NULL, rpo, false);\n+\n   /* Move the expressions that are expensive enough.  */\n   for (int i = 0; i < n; ++i)\n     todo |= move_computations_worker (BASIC_BLOCK_FOR_FN (fun, rpo[i]));"}]}