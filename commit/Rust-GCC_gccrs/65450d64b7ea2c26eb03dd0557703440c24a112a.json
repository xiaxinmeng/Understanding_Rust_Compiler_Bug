{"sha": "65450d64b7ea2c26eb03dd0557703440c24a112a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjU0NTBkNjRiN2VhMmMyNmViMDNkZDA1NTc3MDM0NDBjMjRhMTEyYQ==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2011-02-03T10:53:19Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2011-02-03T10:53:19Z"}, "message": "re PR target/47312 (ICE: in expand_ternary_op, at optabs.c:656 with -flto -mno-sse -mxop and __builtin_fmaf())\n\n\tPR target/47312\n\t* expr.c (expand_expr_real_2) <case FMA_EXPR>: If target doesn't expand\n\tfma, expand FMA_EXPR as fma{,f,l} call.\n\n\t* gcc.target/i386/pr47312.c: New test.\n\nFrom-SVN: r169786", "tree": {"sha": "608a89bf42a4bf13b9acfbca446f944b6a895d4b", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/608a89bf42a4bf13b9acfbca446f944b6a895d4b"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/65450d64b7ea2c26eb03dd0557703440c24a112a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65450d64b7ea2c26eb03dd0557703440c24a112a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/65450d64b7ea2c26eb03dd0557703440c24a112a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/65450d64b7ea2c26eb03dd0557703440c24a112a/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7d58701c40deacbfe57540f7e96ef2a60334880d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7d58701c40deacbfe57540f7e96ef2a60334880d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7d58701c40deacbfe57540f7e96ef2a60334880d"}], "stats": {"total": 42, "additions": 42, "deletions": 0}, "files": [{"sha": "1588c6f00d7211ff6a996e1509010bf8a6cbf69b", "filename": "gcc/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=65450d64b7ea2c26eb03dd0557703440c24a112a", "patch": "@@ -1,5 +1,9 @@\n 2011-02-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/47312\n+\t* expr.c (expand_expr_real_2) <case FMA_EXPR>: If target doesn't expand\n+\tfma, expand FMA_EXPR as fma{,f,l} call.\n+\n \tPR lto/47274\n \t* lto-streamer-out.c (write_symbol): When writing kind and visibility,\n \tcopy them into a unsigned char variable and pass address of it to"}, {"sha": "df15c928bee800edbd0c126c4cda5025f68c80f8", "filename": "gcc/expr.c", "status": "modified", "additions": 12, "deletions": 0, "changes": 12, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2Fexpr.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2Fexpr.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fexpr.c?ref=65450d64b7ea2c26eb03dd0557703440c24a112a", "patch": "@@ -7695,6 +7695,18 @@ expand_expr_real_2 (sepops ops, rtx target, enum machine_mode tmode,\n \toptab opt = fma_optab;\n \tgimple def0, def2;\n \n+\t/* If there is no insn for FMA, emit it as __builtin_fma{,f,l}\n+\t   call.  */\n+\tif (optab_handler (fma_optab, mode) == CODE_FOR_nothing)\n+\t  {\n+\t    tree fn = mathfn_built_in (TREE_TYPE (treeop0), BUILT_IN_FMA);\n+\t    tree call_expr;\n+\n+\t    gcc_assert (fn != NULL_TREE);\n+\t    call_expr = build_call_expr (fn, 3, treeop0, treeop1, treeop2);\n+\t    return expand_builtin (call_expr, target, subtarget, mode, false);\n+\t  }\n+\n \tdef0 = get_def_for_expr (treeop0, NEGATE_EXPR);\n \tdef2 = get_def_for_expr (treeop2, NEGATE_EXPR);\n "}, {"sha": "3ea0a1b585f51f58137e76764698f10911297d12", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=65450d64b7ea2c26eb03dd0557703440c24a112a", "patch": "@@ -1,5 +1,8 @@\n 2011-02-03  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR target/47312\n+\t* gcc.target/i386/pr47312.c: New test.\n+\n \tPR target/47564\n \t* gcc.target/i386/pr47564.c: New test.\n "}, {"sha": "a63089d422a2d40dfdbe0904135cd44e9084aa4e", "filename": "gcc/testsuite/gcc.target/i386/pr47312.c", "status": "added", "additions": 23, "deletions": 0, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr47312.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/65450d64b7ea2c26eb03dd0557703440c24a112a/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr47312.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgcc.target%2Fi386%2Fpr47312.c?ref=65450d64b7ea2c26eb03dd0557703440c24a112a", "patch": "@@ -0,0 +1,23 @@\n+/* PR target/47312 */\n+/* { dg-do link } */\n+/* { dg-require-effective-target lto } */\n+/* { dg-require-effective-target xop } */\n+/* { dg-options \"-O -flto -mno-sse3 -mxop\" } */\n+\n+extern double fma (double, double, double);\n+extern float fmaf (float, float, float);\n+extern long double fmal (long double, long double, long double);\n+\n+volatile float f;\n+volatile double d;\n+volatile long double ld;\n+\n+int\n+main ()\n+{\n+  f = fmaf (f, f, f);\n+  d = fma (d, d, d);\n+  ld = fmal (ld, ld, ld);\n+  asm volatile (\"\" : : \"r\" (&f), \"r\" (&d), \"r\" (&ld) : \"memory\");\n+  return 0;\n+}"}]}