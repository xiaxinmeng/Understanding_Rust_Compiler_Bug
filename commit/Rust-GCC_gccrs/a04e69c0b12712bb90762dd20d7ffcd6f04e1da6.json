{"sha": "a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YTA0ZTY5YzBiMTI3MTJiYjkwNzYyZGQyMGQ3ZmZjZDZmMDRlMWRhNg==", "commit": {"author": {"name": "Thomas Schwinge", "email": "thomas@codesourcery.com", "date": "2016-05-24T14:00:39Z"}, "committer": {"name": "Thomas Schwinge", "email": "tschwinge@gcc.gnu.org", "date": "2016-05-24T14:00:39Z"}, "message": "Tighten syntax checking for OpenACC routine construct in C\n\n\tgcc/c/\n\t* c-parser.c (c_parser_oacc_routine): Tighten syntax checks.\n\tgcc/testsuite/\n\t* c-c++-common/goacc/routine-5.c: Add tests.\n\t* g++.dg/goacc/routine-2.C: Remove duplicate tests.\n\t* gfortran.dg/goacc/routine-6.f90: Add tests.\n\nFrom-SVN: r236639", "tree": {"sha": "b2e6b36f6d180f94e905249d21e046a58742d204", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b2e6b36f6d180f94e905249d21e046a58742d204"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/comments", "author": {"login": "tschwinge", "id": 21753, "node_id": "MDQ6VXNlcjIxNzUz", "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4", "gravatar_id": "", "url": "https://api.github.com/users/tschwinge", "html_url": "https://github.com/tschwinge", "followers_url": "https://api.github.com/users/tschwinge/followers", "following_url": "https://api.github.com/users/tschwinge/following{/other_user}", "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}", "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions", "organizations_url": "https://api.github.com/users/tschwinge/orgs", "repos_url": "https://api.github.com/users/tschwinge/repos", "events_url": "https://api.github.com/users/tschwinge/events{/privacy}", "received_events_url": "https://api.github.com/users/tschwinge/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "d4b5c77d36f4a0957fa6053eaa0cb42a8af650e9", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/d4b5c77d36f4a0957fa6053eaa0cb42a8af650e9", "html_url": "https://github.com/Rust-GCC/gccrs/commit/d4b5c77d36f4a0957fa6053eaa0cb42a8af650e9"}], "stats": {"total": 63, "additions": 43, "deletions": 20}, "files": [{"sha": "3d69cd5794966f6bebad08b1760f47e00b1d2d35", "filename": "gcc/c/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Fc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Fc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2FChangeLog?ref=a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "patch": "@@ -1,3 +1,7 @@\n+2016-05-24  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\t* c-parser.c (c_parser_oacc_routine): Tighten syntax checks.\n+\n 2016-05-24  Richard Biener  <rguenther@suse.de>\n \n \tPR middle-end/70434"}, {"sha": "1bc5eed7f55cb7e5928a3583ca47def96b330cfd", "filename": "gcc/c/c-parser.c", "status": "modified", "additions": 9, "deletions": 10, "changes": 19, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Fc%2Fc-parser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Fc%2Fc-parser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fc%2Fc-parser.c?ref=a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "patch": "@@ -13983,25 +13983,24 @@ c_parser_oacc_routine (c_parser *parser, enum pragma_context context)\n       c_parser_consume_token (parser);\n \n       c_token *token = c_parser_peek_token (parser);\n-\n       if (token->type == CPP_NAME && (token->id_kind == C_ID_ID\n \t\t\t\t      || token->id_kind == C_ID_TYPENAME))\n \t{\n \t  decl = lookup_name (token->value);\n \t  if (!decl)\n-\t    {\n-\t      error_at (token->location, \"%qE has not been declared\",\n-\t\t\ttoken->value);\n-\t      decl = error_mark_node;\n-\t    }\n+\t    error_at (token->location, \"%qE has not been declared\",\n+\t\t      token->value);\n+\t  c_parser_consume_token (parser);\n \t}\n       else\n \tc_parser_error (parser, \"expected function name\");\n \n-      if (token->type != CPP_CLOSE_PAREN)\n-\tc_parser_consume_token (parser);\n-\n-      c_parser_skip_until_found (parser, CPP_CLOSE_PAREN, 0);\n+      if (!decl\n+\t  || !c_parser_require (parser, CPP_CLOSE_PAREN, \"expected %<)%>\"))\n+\t{\n+\t  c_parser_skip_to_pragma_eol (parser, false);\n+\t  return;\n+\t}\n     }\n \n   /* Build a chain of clauses.  */"}, {"sha": "361fbbdedbae71bd486e7a97811599c04a7fb85e", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "patch": "@@ -1,3 +1,9 @@\n+2016-05-24  Thomas Schwinge  <thomas@codesourcery.com>\n+\n+\t* c-c++-common/goacc/routine-5.c: Add tests.\n+\t* g++.dg/goacc/routine-2.C: Remove duplicate tests.\n+\t* gfortran.dg/goacc/routine-6.f90: Add tests.\n+\n 2016-05-24  Richard Biener  <rguenther@suse.de>\n \n \tPR tree-optimization/71253"}, {"sha": "1efd154f8e6e55ed7531e1b8fb3db20b89f12ed3", "filename": "gcc/testsuite/c-c++-common/goacc/routine-5.c", "status": "modified", "additions": 17, "deletions": 4, "changes": 21, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Froutine-5.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Froutine-5.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fc-c%2B%2B-common%2Fgoacc%2Froutine-5.c?ref=a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "patch": "@@ -38,13 +38,26 @@ namespace g {}\n #pragma acc routine /* { dg-error \"not followed by\" \"\" { target c++ } } */\n using namespace g;\n \n-#pragma acc routine (g) /* { dg-error \"does not refer to\" \"\" { target c++ } } */\n+#pragma acc routine (g) /* { dg-error \"does not refer to a function\" \"\" { target c++ } } */\n \n-#endif\n+#endif /* __cplusplus */\n \n-#pragma acc routine (a) /* { dg-error \"does not refer to\" } */\n+#pragma acc routine (a) /* { dg-error \"does not refer to a function\" } */\n   \n-#pragma acc routine (c) /* { dg-error \"does not refer to\" } */\n+#pragma acc routine (c) /* { dg-error \"does not refer to a function\" } */\n+\n+\n+#pragma acc routine () vector /* { dg-error \"expected (function name|unqualified-id) before .\\\\). token\" } */\n+\n+#pragma acc routine (+) /* { dg-error \"expected (function name|unqualified-id) before .\\\\+. token\" } */\n+\n+\n+extern void R1(void);\n+extern void R2(void);\n+#pragma acc routine (R1, R2, R3) worker /* { dg-error \"expected .\\\\). before .,. token\" } */\n+#pragma acc routine (R1 R2 R3) worker /* { dg-error \"expected .\\\\). before .R2.\" } */\n+#pragma acc routine (R1) worker\n+#pragma acc routine (R2) worker\n \n \n void Bar ();"}, {"sha": "ea7c9bf73939f44ef2d4bbf2f6d48d37121e8bff", "filename": "gcc/testsuite/g++.dg/goacc/routine-2.C", "status": "modified", "additions": 0, "deletions": 6, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgoacc%2Froutine-2.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgoacc%2Froutine-2.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Fgoacc%2Froutine-2.C?ref=a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "patch": "@@ -14,15 +14,9 @@ one()\n \n int incr (int);\n float incr (float);\n-int inc;\n \n #pragma acc routine (incr) /* { dg-error \"names a set of overloads\" } */\n \n-#pragma acc routine (increment) /* { dg-error \"has not been declared\" } */\n-\n-#pragma acc routine (inc) /* { dg-error \"does not refer to a function\" } */\n-\n-#pragma acc routine (+) /* { dg-error \"expected unqualified-id before '.' token\" } */\n \n int sum (int, int);\n "}, {"sha": "10943cff3045c1bb6421626f96e5191c9fc22631", "filename": "gcc/testsuite/gfortran.dg/goacc/routine-6.f90", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Froutine-6.f90", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/a04e69c0b12712bb90762dd20d7ffcd6f04e1da6/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Froutine-6.f90", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fgfortran.dg%2Fgoacc%2Froutine-6.f90?ref=a04e69c0b12712bb90762dd20d7ffcd6f04e1da6", "patch": "@@ -29,6 +29,13 @@ end function subr6\n   !$acc routine (subr1) ! { dg-error \"invalid function name\" }\n   external :: subr2\n   !$acc routine (subr2)\n+\n+  external :: R1, R2\n+  !$acc routine (R1 R2 R3) ! { dg-error \"Syntax error in \\\\!\\\\\\$ACC ROUTINE \\\\( NAME \\\\) at \\\\(1\\\\), expecting .\\\\). after NAME\" }\n+  !$acc routine (R1, R2, R3) ! { dg-error \"Syntax error in \\\\!\\\\\\$ACC ROUTINE \\\\( NAME \\\\) at \\\\(1\\\\), expecting .\\\\). after NAME\" }\n+  !$acc routine (R1)\n+  !$acc routine (R2)\n+\n   !$acc parallel\n   !$acc loop\n   do i = 1, n"}]}