{"sha": "b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "node_id": "C_kwDOANBUbNoAKGI4Y2UxOWJiMWEwNTkyMDUxZThmOWE0YzMyNTJkMTJhZTYwNWIyNTY", "commit": {"author": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2021-11-17T05:55:01Z"}, "committer": {"name": "Kewen Lin", "email": "linkw@linux.ibm.com", "date": "2021-11-17T05:55:01Z"}, "message": "visium: Fix non-robust split condition in define_insn_and_split\n\nThis patch is to fix some non-robust split conditions in some\ndefine_insn_and_splits, to make each of them applied on top of\nthe corresponding condition for define_insn part, otherwise the\nsplitting could perform unexpectedly.\n\ngcc/ChangeLog:\n\n\t* config/visium/visium.md (*add<mode>3_insn, *addsi3_insn, *addi3_insn,\n\t*sub<mode>3_insn, *subsi3_insn, *subdi3_insn, *neg<mode>2_insn,\n\t*negdi2_insn, *and<mode>3_insn, *ior<mode>3_insn, *xor<mode>3_insn,\n\t*one_cmpl<mode>2_insn, *ashl<mode>3_insn, *ashr<mode>3_insn,\n\t*lshr<mode>3_insn, *trunchiqi2_insn, *truncsihi2_insn,\n\t*truncdisi2_insn, *extendqihi2_insn, *extendqisi2_insn,\n\t*extendhisi2_insn, *extendsidi2_insn, *zero_extendqihi2_insn,\n\t*zero_extendqisi2_insn, *zero_extendsidi2_insn): Fix split condition.", "tree": {"sha": "78c2cbdfb6ccc0c4f02d80aee57392b7d6b3cb07", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/78c2cbdfb6ccc0c4f02d80aee57392b7d6b3cb07"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b8ce19bb1a0592051e8f9a4c3252d12ae605b256/comments", "author": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jedilyn", "id": 38515402, "node_id": "MDQ6VXNlcjM4NTE1NDAy", "avatar_url": "https://avatars.githubusercontent.com/u/38515402?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jedilyn", "html_url": "https://github.com/jedilyn", "followers_url": "https://api.github.com/users/jedilyn/followers", "following_url": "https://api.github.com/users/jedilyn/following{/other_user}", "gists_url": "https://api.github.com/users/jedilyn/gists{/gist_id}", "starred_url": "https://api.github.com/users/jedilyn/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jedilyn/subscriptions", "organizations_url": "https://api.github.com/users/jedilyn/orgs", "repos_url": "https://api.github.com/users/jedilyn/repos", "events_url": "https://api.github.com/users/jedilyn/events{/privacy}", "received_events_url": "https://api.github.com/users/jedilyn/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "51c500269bf53749b107807d84271385fad35628", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/51c500269bf53749b107807d84271385fad35628", "html_url": "https://github.com/Rust-GCC/gccrs/commit/51c500269bf53749b107807d84271385fad35628"}], "stats": {"total": 50, "additions": 25, "deletions": 25}, "files": [{"sha": "ca2234bf253289b84dd39e620d15930269c056ea", "filename": "gcc/config/visium/visium.md", "status": "modified", "additions": 25, "deletions": 25, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/b8ce19bb1a0592051e8f9a4c3252d12ae605b256/gcc%2Fconfig%2Fvisium%2Fvisium.md", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/b8ce19bb1a0592051e8f9a4c3252d12ae605b256/gcc%2Fconfig%2Fvisium%2Fvisium.md", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fconfig%2Fvisium%2Fvisium.md?ref=b8ce19bb1a0592051e8f9a4c3252d12ae605b256", "patch": "@@ -792,7 +792,7 @@\n \t\t  (match_operand:QHI 2 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (plus:QHI (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -850,7 +850,7 @@\n \t\t (match_operand:SI 2 \"add_operand\"      \" L,r,J\")))]\n   \"ok_for_simple_arith_logic_operands (operands, SImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (plus:SI (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -912,7 +912,7 @@\n \t\t (match_operand:DI 2 \"add_operand\"      \" L,J, r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, DImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(const_int 0)]\n {\n   visium_split_double_add (PLUS, operands[0], operands[1], operands[2]);\n@@ -1007,7 +1007,7 @@\n \t\t   (match_operand:QHI 2 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (minus:QHI (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1064,7 +1064,7 @@\n \t\t  (match_operand:SI 2 \"add_operand\"      \" L,r, J\")))]\n   \"ok_for_simple_arith_logic_operands (operands, SImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (minus:SI (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1125,7 +1125,7 @@\n \t\t  (match_operand:DI 2 \"add_operand\"      \" L,J, r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, DImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(const_int 0)]\n {\n   visium_split_double_add (MINUS, operands[0], operands[1], operands[2]);\n@@ -1209,7 +1209,7 @@\n \t(neg:I (match_operand:I 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (neg:I (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1253,7 +1253,7 @@\n \t(neg:DI (match_operand:DI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, DImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(const_int 0)]\n {\n   visium_split_double_add (MINUS, operands[0], const0_rtx, operands[1]);\n@@ -1415,7 +1415,7 @@\n \t       (match_operand:I 2 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (and:I (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1453,7 +1453,7 @@\n \t       (match_operand:I 2 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ior:I (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1491,7 +1491,7 @@\n \t       (match_operand:I 2 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (xor:I (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1527,7 +1527,7 @@\n \t(not:I (match_operand:I 1 \"reg_or_0_operand\" \"rO\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (not:I (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1563,7 +1563,7 @@\n \t\t  (match_operand:QI 2 \"reg_or_shift_operand\" \"r,K\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashift:I (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1622,7 +1622,7 @@\n \t\t    (match_operand:QI 2 \"reg_or_shift_operand\" \"r,K\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashiftrt:I (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1683,7 +1683,7 @@\n \t\t    (match_operand:QI 2 \"reg_or_shift_operand\" \"r,K\")))]\n   \"ok_for_simple_arith_logic_operands (operands, <MODE>mode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (lshiftrt:I (match_dup 1) (match_dup 2)))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1740,7 +1740,7 @@\n \t(truncate:QI (match_operand:HI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, QImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (truncate:QI (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1764,7 +1764,7 @@\n \t(truncate:HI (match_operand:SI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, HImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (truncate:HI (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1788,7 +1788,7 @@\n \t(truncate:SI (match_operand:DI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, SImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (truncate:SI (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1822,7 +1822,7 @@\n \t(sign_extend:HI (match_operand:QI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, HImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (sign_extend:HI (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1846,7 +1846,7 @@\n \t(sign_extend:SI (match_operand:QI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, SImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0) (sign_extend:SI (match_dup 1)))\n \t      (clobber (reg:CC R_FLAGS))])]\n   \"\"\n@@ -1870,7 +1870,7 @@\n \t(sign_extend:SI (match_operand:HI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, SImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_operand:SI 0 \"register_operand\" \"\")\n \t\t   (sign_extend:SI (match_operand:HI 1 \"register_operand\" \"\")))\n \t      (clobber (reg:CC R_FLAGS))])]\n@@ -1895,7 +1895,7 @@\n         (sign_extend:DI (match_operand:SI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, DImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 3) (match_dup 1))\n \t      (clobber (reg:CC R_FLAGS))])\n    (parallel [(set (match_dup 2)\n@@ -1931,7 +1931,7 @@\n         (zero_extend:HI (match_operand:QI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, HImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashift:HI (match_dup 2) (const_int 8)))\n \t      (clobber (reg:CC R_FLAGS))])\n@@ -1953,7 +1953,7 @@\n         (zero_extend:SI (match_operand:QI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, SImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 0)\n \t\t   (ashift:SI (match_dup 2) (const_int 24)))\n \t      (clobber (reg:CC R_FLAGS))])\n@@ -1982,7 +1982,7 @@\n         (zero_extend:DI (match_operand:SI 1 \"register_operand\" \"r\")))]\n   \"ok_for_simple_arith_logic_operands (operands, DImode)\"\n   \"#\"\n-  \"reload_completed\"\n+  \"&& reload_completed\"\n   [(parallel [(set (match_dup 3) (match_dup 1))\n \t      (clobber (reg:CC R_FLAGS))])\n    (set (match_dup 2) (const_int 0))]"}]}