{"sha": "e9491f468a64fdf55d07e66f87f00734c64edb7a", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ZTk0OTFmNDY4YTY0ZmRmNTVkMDdlNjZmODdmMDA3MzRjNjRlZGI3YQ==", "commit": {"author": {"name": "Laurent GUERBY", "email": "laurent@guerby.net", "date": "2009-09-07T09:00:51Z"}, "committer": {"name": "Laurent Guerby", "email": "guerby@gcc.gnu.org", "date": "2009-09-07T09:00:51Z"}, "message": "make.adb: Add missing documentation for multilib handling.\n\n2009-09-07  Laurent GUERBY  <laurent@guerby.net>\n\n        * make.adb: Add missing documentation for multilib handling.\n\nFrom-SVN: r151473", "tree": {"sha": "e5a8d6a2f5fb450b8f58fec44c5449fbd9b134cd", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/e5a8d6a2f5fb450b8f58fec44c5449fbd9b134cd"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/e9491f468a64fdf55d07e66f87f00734c64edb7a", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9491f468a64fdf55d07e66f87f00734c64edb7a", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e9491f468a64fdf55d07e66f87f00734c64edb7a", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e9491f468a64fdf55d07e66f87f00734c64edb7a/comments", "author": {"login": "guerby", "id": 6659329, "node_id": "MDQ6VXNlcjY2NTkzMjk=", "avatar_url": "https://avatars.githubusercontent.com/u/6659329?v=4", "gravatar_id": "", "url": "https://api.github.com/users/guerby", "html_url": "https://github.com/guerby", "followers_url": "https://api.github.com/users/guerby/followers", "following_url": "https://api.github.com/users/guerby/following{/other_user}", "gists_url": "https://api.github.com/users/guerby/gists{/gist_id}", "starred_url": "https://api.github.com/users/guerby/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/guerby/subscriptions", "organizations_url": "https://api.github.com/users/guerby/orgs", "repos_url": "https://api.github.com/users/guerby/repos", "events_url": "https://api.github.com/users/guerby/events{/privacy}", "received_events_url": "https://api.github.com/users/guerby/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "7717df30b15f2aeb1e3f69350bf5d296dfc57680", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/7717df30b15f2aeb1e3f69350bf5d296dfc57680", "html_url": "https://github.com/Rust-GCC/gccrs/commit/7717df30b15f2aeb1e3f69350bf5d296dfc57680"}], "stats": {"total": 27, "additions": 25, "deletions": 2}, "files": [{"sha": "14291ba2fd6817c801ca2e494a0c60afbd043a07", "filename": "gcc/ada/ChangeLog", "status": "modified", "additions": 4, "deletions": 0, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9491f468a64fdf55d07e66f87f00734c64edb7a/gcc%2Fada%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9491f468a64fdf55d07e66f87f00734c64edb7a/gcc%2Fada%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2FChangeLog?ref=e9491f468a64fdf55d07e66f87f00734c64edb7a", "patch": "@@ -1,3 +1,7 @@\n+2009-09-07  Laurent GUERBY  <laurent@guerby.net>\n+\n+        * make.adb: Add missing documentation for multilib handling.\n+\t\n 2009-09-03  Diego Novillo  <dnovillo@google.com>\n \n \t* gcc-interface/misc.c (lang_hooks): Remove const qualifier."}, {"sha": "b19aa22da71b0d98ad9a2ffab3605aad2534c41c", "filename": "gcc/ada/make.adb", "status": "modified", "additions": 21, "deletions": 2, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/e9491f468a64fdf55d07e66f87f00734c64edb7a/gcc%2Fada%2Fmake.adb", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/e9491f468a64fdf55d07e66f87f00734c64edb7a/gcc%2Fada%2Fmake.adb", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fada%2Fmake.adb?ref=e9491f468a64fdf55d07e66f87f00734c64edb7a", "patch": "@@ -7296,8 +7296,14 @@ package body Make is\n    begin\n       pragma Assert (N_M_Switch > 0 and RTS_Specified = null);\n \n-      --  This loop needs commenting ??? In fact this entire body is\n-      --  under-commented ??? And the spec is not much help :-(\n+      --  In case we detected a multilib switch and the user has not\n+      --  manually specified a specific RTS we emulate the following command:\n+      --  gnatmake $FLAGS --RTS=$(gcc -print-multi-directory $FLAGS)\n+\n+      --  First select the flags which might have an impact on multilib\n+      --  processing. Note that this is an heuristic selection and it\n+      --  will need to be maintained over time. The condition has to\n+      --  be kept synchronized with N_M_Switch counting in Scan_Make_Arg.\n \n       for Next_Arg in 1 .. Argument_Count loop\n          declare\n@@ -7322,6 +7328,10 @@ package body Make is\n \n       Args (Args'Last) := new String'(\"-print-multi-directory\");\n \n+      --  Call the GCC driver with the collected flags and save its\n+      --  output. Alternate design would be to link in gnatmake the\n+      --  relevant part of the GCC driver.\n+\n       if Saved_Gcc /= null then\n          Multilib_Gcc := Saved_Gcc;\n       else\n@@ -7344,6 +7354,8 @@ package body Make is\n          return;\n       end if;\n \n+      --  Parse the GCC driver output which is a single line, removing CR/LF\n+\n       Output_FD := Open_Read (Output_Name.all, Binary);\n \n       if Output_FD = Invalid_FD then\n@@ -7362,10 +7374,14 @@ package body Make is\n          end if;\n       end loop;\n \n+      --  In case the standard RTS is selected do nothing\n+\n       if N_Read = 0 or else Line (1 .. N_Read) = \".\" then\n          return;\n       end if;\n \n+      --  Otherwise add -margs --RTS=output\n+\n       Scan_Make_Arg (\"-margs\", And_Save => True);\n       Scan_Make_Arg (\"--RTS=\" & Line (1 .. N_Read), And_Save => True);\n    end Process_Multilib;\n@@ -7845,6 +7861,9 @@ package body Make is\n             Add_Switch (Argv, Compiler, And_Save => And_Save);\n             Add_Switch (Argv, Linker, And_Save => And_Save);\n \n+            --  The following condition has to be kept synchronized with\n+            --  the Process_Multilib one.\n+\n             if Argv (2) = 'm'\n               and then Argv /= \"-mieee\"\n             then"}]}