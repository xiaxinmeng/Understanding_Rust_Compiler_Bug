{"sha": "cc81fd182879509b81a950dd586f8269c970502f", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6Y2M4MWZkMTgyODc5NTA5YjgxYTk1MGRkNTg2ZjgyNjljOTcwNTAyZg==", "commit": {"author": {"name": "Jakub Jelinek", "email": "jakub@redhat.com", "date": "2008-12-31T11:46:18Z"}, "committer": {"name": "Jakub Jelinek", "email": "jakub@gcc.gnu.org", "date": "2008-12-31T11:46:18Z"}, "message": "re PR c++/38647 (ICE using __FUNCTION__ as template parameter)\n\n\tPR c++/38647\n\t* parser.c (cp_parser_primary_expression) <case RID_FUNCTION_NAME>:\n\tReturn error_mark_node if cp_parser_non_integral_constant_expression\n\treturns true.\n\n\t* g++.dg/template/function1.C: New test.\n\nFrom-SVN: r142978", "tree": {"sha": "c51d8d1cc8c676c3d17bb9a2e900b434bb415c18", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c51d8d1cc8c676c3d17bb9a2e900b434bb415c18"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/cc81fd182879509b81a950dd586f8269c970502f", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc81fd182879509b81a950dd586f8269c970502f", "html_url": "https://github.com/Rust-GCC/gccrs/commit/cc81fd182879509b81a950dd586f8269c970502f", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/cc81fd182879509b81a950dd586f8269c970502f/comments", "author": {"login": "jakubjelinek", "id": 9370665, "node_id": "MDQ6VXNlcjkzNzA2NjU=", "avatar_url": "https://avatars.githubusercontent.com/u/9370665?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jakubjelinek", "html_url": "https://github.com/jakubjelinek", "followers_url": "https://api.github.com/users/jakubjelinek/followers", "following_url": "https://api.github.com/users/jakubjelinek/following{/other_user}", "gists_url": "https://api.github.com/users/jakubjelinek/gists{/gist_id}", "starred_url": "https://api.github.com/users/jakubjelinek/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jakubjelinek/subscriptions", "organizations_url": "https://api.github.com/users/jakubjelinek/orgs", "repos_url": "https://api.github.com/users/jakubjelinek/repos", "events_url": "https://api.github.com/users/jakubjelinek/events{/privacy}", "received_events_url": "https://api.github.com/users/jakubjelinek/received_events", "type": "User", "site_admin": false}, "committer": null, "parents": [{"sha": "a67d93194a23a00de6c09821fe8fd6c31ac2fd9e", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/a67d93194a23a00de6c09821fe8fd6c31ac2fd9e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/a67d93194a23a00de6c09821fe8fd6c31ac2fd9e"}], "stats": {"total": 76, "additions": 67, "deletions": 9}, "files": [{"sha": "e6cb2891a6e3a6bc26a0c6b3da594ba4788e8e70", "filename": "gcc/cp/ChangeLog", "status": "modified", "additions": 5, "deletions": 0, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Fcp%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Fcp%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2FChangeLog?ref=cc81fd182879509b81a950dd586f8269c970502f", "patch": "@@ -1,5 +1,10 @@\n 2008-12-31  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/38647\n+\t* parser.c (cp_parser_primary_expression) <case RID_FUNCTION_NAME>:\n+\tReturn error_mark_node if cp_parser_non_integral_constant_expression\n+\treturns true.\n+\n \tPR c++/38640\n \t* semantics.c (finish_decltype_type): Handle TEMPLATE_PARM_INDEX.\n "}, {"sha": "545d3ddb3879916a97a6de612a23f446fcc2f53f", "filename": "gcc/cp/parser.c", "status": "modified", "additions": 32, "deletions": 9, "changes": 41, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Fcp%2Fparser.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Fcp%2Fparser.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcp%2Fparser.c?ref=cc81fd182879509b81a950dd586f8269c970502f", "patch": "@@ -3308,16 +3308,39 @@ cp_parser_primary_expression (cp_parser *parser,\n \tcase RID_FUNCTION_NAME:\n \tcase RID_PRETTY_FUNCTION_NAME:\n \tcase RID_C99_FUNCTION_NAME:\n-\t  /* The symbols __FUNCTION__, __PRETTY_FUNCTION__, and\n-\t     __func__ are the names of variables -- but they are\n-\t     treated specially.  Therefore, they are handled here,\n-\t     rather than relying on the generic id-expression logic\n-\t     below.  Grammatically, these names are id-expressions.\n+\t  {\n+\t    const char *name;\n \n-\t     Consume the token.  */\n-\t  token = cp_lexer_consume_token (parser->lexer);\n-\t  /* Look up the name.  */\n-\t  return finish_fname (token->u.value);\n+\t    /* The symbols __FUNCTION__, __PRETTY_FUNCTION__, and\n+\t       __func__ are the names of variables -- but they are\n+\t       treated specially.  Therefore, they are handled here,\n+\t       rather than relying on the generic id-expression logic\n+\t       below.  Grammatically, these names are id-expressions.\n+\n+\t       Consume the token.  */\n+\t    token = cp_lexer_consume_token (parser->lexer);\n+\n+\t    switch (token->keyword)\n+\t      {\n+\t      case RID_FUNCTION_NAME:\n+\t\tname = \"%<__FUNCTION__%>\";\n+\t\tbreak;\n+\t      case RID_PRETTY_FUNCTION_NAME:\n+\t\tname = \"%<__PRETTY_FUNCTION__%>\";\n+\t\tbreak;\n+\t      case RID_C99_FUNCTION_NAME:\n+\t\tname = \"%<__func__%>\";\n+\t\tbreak;\n+\t      default:\n+\t\tgcc_unreachable ();\n+\t      }\n+\n+\t    if (cp_parser_non_integral_constant_expression (parser, name))\n+\t      return error_mark_node;\n+\n+\t    /* Look up the name.  */\n+\t    return finish_fname (token->u.value);\n+\t  }\n \n \tcase RID_VA_ARG:\n \t  {"}, {"sha": "9a8aaa14e2c14b10b8080444b0b6ca5280c784a7", "filename": "gcc/testsuite/ChangeLog", "status": "modified", "additions": 3, "deletions": 0, "changes": 3, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Ftestsuite%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Ftestsuite%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2FChangeLog?ref=cc81fd182879509b81a950dd586f8269c970502f", "patch": "@@ -1,5 +1,8 @@\n 2008-12-31  Jakub Jelinek  <jakub@redhat.com>\n \n+\tPR c++/38647\n+\t* g++.dg/template/function1.C: New test.\n+\n \tPR c++/38640\n \t* g++.dg/cpp0x/decltype15.C: New test.\n "}, {"sha": "1097c5bf9c2de1360e03c14cb3d7e5103a7038a0", "filename": "gcc/testsuite/g++.dg/template/function1.C", "status": "added", "additions": 27, "deletions": 0, "changes": 27, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffunction1.C", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/cc81fd182879509b81a950dd586f8269c970502f/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffunction1.C", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftestsuite%2Fg%2B%2B.dg%2Ftemplate%2Ffunction1.C?ref=cc81fd182879509b81a950dd586f8269c970502f", "patch": "@@ -0,0 +1,27 @@\n+// PR c++/38647\n+// { dg-do compile }\n+\n+template<const char *, int> struct A {};\n+const char func[] = \"abc\";\n+template<int N> struct A<func, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+\n+char a1[1];\n+A<a1, 0> a;\n+\n+template<const char *, int> struct B {};\n+template<int N> struct B<__FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+\n+char b1[1];\n+B<b1, 0> b;\n+\n+template<const char *, int> struct C {};\n+template<int N> struct C<__PRETTY_FUNCTION__, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+\n+char c1[1];\n+C<c1, 0> c;\n+\n+template<const char *, int> struct D {};\n+template<int N> struct D<__func__, N> {};\t// { dg-error \"cannot appear|is invalid\" }\n+\n+char d1[1];\n+D<d1, 0> d;"}]}