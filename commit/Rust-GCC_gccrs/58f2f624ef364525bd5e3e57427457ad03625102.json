{"sha": "58f2f624ef364525bd5e3e57427457ad03625102", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NThmMmY2MjRlZjM2NDUyNWJkNWUzZTU3NDI3NDU3YWQwMzYyNTEwMg==", "commit": {"author": {"name": "bors[bot]", "email": "26634292+bors[bot]@users.noreply.github.com", "date": "2021-08-27T15:26:06Z"}, "committer": {"name": "GitHub", "email": "noreply@github.com", "date": "2021-08-27T15:26:06Z"}, "message": "Merge #650\n\n650: Stop shadowing of hir mappings with substitution mappings r=philberty a=philberty\n\nThere was a hidden segv nullptr in the check for unconstrained\r\ntype parameters. Since the util mappings class name is being shadowed\r\nby the substitution mappings we never actually hit the segv. As part\r\nof my work in traits and qualified paths we need access to the hir mappings\r\nclass which was shadowed. This removes shadowing and fixes the segv\r\nfor unconstrained type parameters.\n\nCo-authored-by: Philip Herron <philip.herron@embecosm.com>", "tree": {"sha": "f8347335eef7a33e15de18afc2d223566784a9c2", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/f8347335eef7a33e15de18afc2d223566784a9c2"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/58f2f624ef364525bd5e3e57427457ad03625102", "comment_count": 0, "verification": {"verified": true, "reason": "valid", "signature": "-----BEGIN PGP SIGNATURE-----\n\nwsBcBAABCAAQBQJhKQQOCRBK7hj4Ov3rIwAASzEIAKXY/mZXxYAk2Qb4qZoUkPtL\nD2laISHq3ircdp5GkmDhS9Osrr/0A15XKmlBej0wfKrodHv8iZ8LJH+Fg8f3c2ET\n2FM2x0l24TwODgzSZ3QHCvzhNSLfQup+Gtos0yWg9j+/rivZiLw8jbs4zKQHCwgV\nn5kgtOaPc+hb9YnY1foZtGrHqstDyulppTfwYDvx6qKpkeT5ZW3Zgaq/jixBfmde\n/JI2aCZ2qkCVEVbVuueOYz9VRqHHYF+EK5fCYUKLgCwlxGKPyglAsiZzdTmpRW3+\nALkULT4fR2FwqZbCbULaFlL6Eff+FTQ6rJ3MtG/PcJtLJzKSSndoTB8eVAlxORM=\n=hiGg\n-----END PGP SIGNATURE-----\n", "payload": "tree f8347335eef7a33e15de18afc2d223566784a9c2\nparent 6b42381685595c34f21d5ce9ef1c31ceac76720d\nparent 1fc2a7fe7e2351e560e75a0a17960816728aa419\nauthor bors[bot] <26634292+bors[bot]@users.noreply.github.com> 1630077966 +0000\ncommitter GitHub <noreply@github.com> 1630077966 +0000\n\nMerge #650\n\n650: Stop shadowing of hir mappings with substitution mappings r=philberty a=philberty\n\nThere was a hidden segv nullptr in the check for unconstrained\r\ntype parameters. Since the util mappings class name is being shadowed\r\nby the substitution mappings we never actually hit the segv. As part\r\nof my work in traits and qualified paths we need access to the hir mappings\r\nclass which was shadowed. This removes shadowing and fixes the segv\r\nfor unconstrained type parameters.\n\nCo-authored-by: Philip Herron <philip.herron@embecosm.com>\n"}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58f2f624ef364525bd5e3e57427457ad03625102", "html_url": "https://github.com/Rust-GCC/gccrs/commit/58f2f624ef364525bd5e3e57427457ad03625102", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/58f2f624ef364525bd5e3e57427457ad03625102/comments", "author": {"login": "bors[bot]", "id": 26634292, "node_id": "MDM6Qm90MjY2MzQyOTI=", "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4", "gravatar_id": "", "url": "https://api.github.com/users/bors%5Bbot%5D", "html_url": "https://github.com/apps/bors", "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers", "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}", "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}", "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions", "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs", "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos", "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}", "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events", "type": "Bot", "site_admin": false}, "committer": {"login": "web-flow", "id": 19864447, "node_id": "MDQ6VXNlcjE5ODY0NDQ3", "avatar_url": "https://avatars.githubusercontent.com/u/19864447?v=4", "gravatar_id": "", "url": "https://api.github.com/users/web-flow", "html_url": "https://github.com/web-flow", "followers_url": "https://api.github.com/users/web-flow/followers", "following_url": "https://api.github.com/users/web-flow/following{/other_user}", "gists_url": "https://api.github.com/users/web-flow/gists{/gist_id}", "starred_url": "https://api.github.com/users/web-flow/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/web-flow/subscriptions", "organizations_url": "https://api.github.com/users/web-flow/orgs", "repos_url": "https://api.github.com/users/web-flow/repos", "events_url": "https://api.github.com/users/web-flow/events{/privacy}", "received_events_url": "https://api.github.com/users/web-flow/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "6b42381685595c34f21d5ce9ef1c31ceac76720d", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/6b42381685595c34f21d5ce9ef1c31ceac76720d", "html_url": "https://github.com/Rust-GCC/gccrs/commit/6b42381685595c34f21d5ce9ef1c31ceac76720d"}, {"sha": "1fc2a7fe7e2351e560e75a0a17960816728aa419", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/1fc2a7fe7e2351e560e75a0a17960816728aa419", "html_url": "https://github.com/Rust-GCC/gccrs/commit/1fc2a7fe7e2351e560e75a0a17960816728aa419"}], "stats": {"total": 23, "additions": 14, "deletions": 9}, "files": [{"sha": "15eab25f153ac05084d7fa55fba1ef173b54c1f9", "filename": "gcc/rust/typecheck/rust-hir-type-check-type.h", "status": "modified", "additions": 14, "deletions": 9, "changes": 23, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/58f2f624ef364525bd5e3e57427457ad03625102/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-type.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/58f2f624ef364525bd5e3e57427457ad03625102/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-type.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Frust%2Ftypecheck%2Frust-hir-type-check-type.h?ref=58f2f624ef364525bd5e3e57427457ad03625102", "patch": "@@ -60,9 +60,10 @@ class TypeCheckType : public TypeCheckBase\n public:\n   static TyTy::BaseType *\n   Resolve (HIR::Type *type,\n-\t   std::vector<TyTy::SubstitutionParamMapping> *mappings = nullptr)\n+\t   std::vector<TyTy::SubstitutionParamMapping> *subst_mappings\n+\t   = nullptr)\n   {\n-    TypeCheckType resolver (mappings);\n+    TypeCheckType resolver (subst_mappings);\n     type->accept_vis (resolver);\n \n     if (resolver.translated == nullptr)\n@@ -210,20 +211,24 @@ class TypeCheckType : public TypeCheckBase\n   }\n \n private:\n-  TypeCheckType (std::vector<TyTy::SubstitutionParamMapping> *mappings)\n-    : TypeCheckBase (), mappings (mappings), translated (nullptr)\n+  TypeCheckType (std::vector<TyTy::SubstitutionParamMapping> *subst_mappings)\n+    : TypeCheckBase (), subst_mappings (subst_mappings), translated (nullptr)\n   {}\n \n   void\n   check_for_unconstrained (std::vector<std::unique_ptr<HIR::Type>> &type_args)\n   {\n     std::map<std::string, Location> param_location_map;\n     std::set<std::string> param_tys;\n-    for (auto &mapping : *mappings)\n+\n+    if (subst_mappings != nullptr)\n       {\n-\tstd::string sym = mapping.get_param_ty ()->get_symbol ();\n-\tparam_tys.insert (sym);\n-\tparam_location_map[sym] = mapping.get_generic_param ().get_locus ();\n+\tfor (auto &mapping : *subst_mappings)\n+\t  {\n+\t    std::string sym = mapping.get_param_ty ()->get_symbol ();\n+\t    param_tys.insert (sym);\n+\t    param_location_map[sym] = mapping.get_generic_param ().get_locus ();\n+\t  }\n       }\n \n     std::set<std::string> args;\n@@ -241,7 +246,7 @@ class TypeCheckType : public TypeCheckBase\n       }\n   }\n \n-  std::vector<TyTy::SubstitutionParamMapping> *mappings;\n+  std::vector<TyTy::SubstitutionParamMapping> *subst_mappings;\n   TyTy::BaseType *translated;\n };\n "}]}