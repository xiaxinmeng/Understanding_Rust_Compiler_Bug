{"sha": "c73847e77b379bc6f51f5cda2649fff5ae5b9130", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6YzczODQ3ZTc3YjM3OWJjNmY1MWY1Y2RhMjY0OWZmZjVhZTViOTEzMA==", "commit": {"author": {"name": "Jonathan Wakely", "email": "jwakely@redhat.com", "date": "2018-04-03T23:03:07Z"}, "committer": {"name": "Jonathan Wakely", "email": "redi@gcc.gnu.org", "date": "2018-04-03T23:03:07Z"}, "message": "PR libstdc++/85183 fix std::variant move-assignment\n\n\tPR libstdc++/85183\n\t* include/std/variant (_Move_assign_base::operator=): Fix incorrect\n\tvalue categories.\n\t* testsuite/20_util/variant/85183.cc: New.\n\nFrom-SVN: r259059", "tree": {"sha": "c349cae67afef3d85178a55083da0f8d3a33a680", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/c349cae67afef3d85178a55083da0f8d3a33a680"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/c73847e77b379bc6f51f5cda2649fff5ae5b9130", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c73847e77b379bc6f51f5cda2649fff5ae5b9130", "html_url": "https://github.com/Rust-GCC/gccrs/commit/c73847e77b379bc6f51f5cda2649fff5ae5b9130", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/c73847e77b379bc6f51f5cda2649fff5ae5b9130/comments", "author": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "committer": {"login": "jwakely", "id": 1254480, "node_id": "MDQ6VXNlcjEyNTQ0ODA=", "avatar_url": "https://avatars.githubusercontent.com/u/1254480?v=4", "gravatar_id": "", "url": "https://api.github.com/users/jwakely", "html_url": "https://github.com/jwakely", "followers_url": "https://api.github.com/users/jwakely/followers", "following_url": "https://api.github.com/users/jwakely/following{/other_user}", "gists_url": "https://api.github.com/users/jwakely/gists{/gist_id}", "starred_url": "https://api.github.com/users/jwakely/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/jwakely/subscriptions", "organizations_url": "https://api.github.com/users/jwakely/orgs", "repos_url": "https://api.github.com/users/jwakely/repos", "events_url": "https://api.github.com/users/jwakely/events{/privacy}", "received_events_url": "https://api.github.com/users/jwakely/received_events", "type": "User", "site_admin": false}, "parents": [{"sha": "b6a7a294ce823917dd08e8d5923137ff75b09fae", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/b6a7a294ce823917dd08e8d5923137ff75b09fae", "html_url": "https://github.com/Rust-GCC/gccrs/commit/b6a7a294ce823917dd08e8d5923137ff75b09fae"}], "stats": {"total": 49, "additions": 46, "deletions": 3}, "files": [{"sha": "df667c1398dbaee0f3363be46156aa8e85fd8c8f", "filename": "libstdc++-v3/ChangeLog", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c73847e77b379bc6f51f5cda2649fff5ae5b9130/libstdc%2B%2B-v3%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c73847e77b379bc6f51f5cda2649fff5ae5b9130/libstdc%2B%2B-v3%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2FChangeLog?ref=c73847e77b379bc6f51f5cda2649fff5ae5b9130", "patch": "@@ -1,3 +1,10 @@\n+2018-04-03  Jonathan Wakely  <jwakely@redhat.com>\n+\n+\tPR libstdc++/85183\n+\t* include/std/variant (_Move_assign_base::operator=): Fix incorrect\n+\tvalue categories.\n+\t* testsuite/20_util/variant/85183.cc: New.\n+\n 2018-03-26  Jonathan Wakely  <jwakely@redhat.com>\n \n \t* include/std/variant (__get): Qualify calls to avoid ADL."}, {"sha": "028d306427275cba9bcd5cc0e793294ea8308181", "filename": "libstdc++-v3/include/std/variant", "status": "modified", "additions": 4, "deletions": 3, "changes": 7, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c73847e77b379bc6f51f5cda2649fff5ae5b9130/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c73847e77b379bc6f51f5cda2649fff5ae5b9130/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Finclude%2Fstd%2Fvariant?ref=c73847e77b379bc6f51f5cda2649fff5ae5b9130", "patch": "@@ -605,13 +605,14 @@ namespace __variant\n \t    if (__rhs._M_valid())\n \t      {\n \t\tstatic constexpr void (*_S_vtable[])(void*, void*) =\n-\t\t  { &__erased_assign<_Types&, const _Types&>... };\n-\t\t_S_vtable[__rhs._M_index](this->_M_storage(), __rhs._M_storage());\n+\t\t  { &__erased_assign<_Types&, _Types&&>... };\n+\t\t_S_vtable[__rhs._M_index]\n+\t\t  (this->_M_storage(), __rhs._M_storage());\n \t      }\n \t  }\n \telse\n \t  {\n-\t    _Move_assign_base __tmp(__rhs);\n+\t    _Move_assign_base __tmp(std::move(__rhs));\n \t    this->~_Move_assign_base();\n \t    __try\n \t      {"}, {"sha": "b122c6357ad3b9a8331536ead0be9af85ea5c67a", "filename": "libstdc++-v3/testsuite/20_util/variant/85183.cc", "status": "added", "additions": 35, "deletions": 0, "changes": 35, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/c73847e77b379bc6f51f5cda2649fff5ae5b9130/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fvariant%2F85183.cc", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/c73847e77b379bc6f51f5cda2649fff5ae5b9130/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fvariant%2F85183.cc", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/libstdc%2B%2B-v3%2Ftestsuite%2F20_util%2Fvariant%2F85183.cc?ref=c73847e77b379bc6f51f5cda2649fff5ae5b9130", "patch": "@@ -0,0 +1,35 @@\n+// Copyright (C) 2018 Free Software Foundation, Inc.\n+//\n+// This file is part of the GNU ISO C++ Library.  This library is free\n+// software; you can redistribute it and/or modify it under the\n+// terms of the GNU General Public License as published by the\n+// Free Software Foundation; either version 3, or (at your option)\n+// any later version.\n+\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+// GNU General Public License for more details.\n+\n+// You should have received a copy of the GNU General Public License along\n+// with this library; see the file COPYING3.  If not see\n+// <http://www.gnu.org/licenses/>.\n+\n+// { dg-options \"-std=gnu++17\" }\n+// { dg-do compile { target c++17 } }\n+\n+#include <variant>\n+\n+struct moveonly {\n+  moveonly() noexcept { }\n+  moveonly(moveonly&&) noexcept { }\n+  moveonly& operator=(moveonly&&) noexcept { return *this; }\n+  ~moveonly() { }\n+};\n+\n+void\n+test01()\n+{\n+  std::variant<moveonly> v1, v2;\n+  v1 = std::move(v2); // PR libstdc++/85183\n+}"}]}