{"sha": "63642d5a8dae511ccd320c89580c359a09b713dc", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6NjM2NDJkNWE4ZGFlNTExY2NkMzIwYzg5NTgwYzM1OWEwOWI3MTNkYw==", "commit": {"author": {"name": "Alexandre Oliva", "email": "aoliva@redhat.com", "date": "2008-03-01T03:36:43Z"}, "committer": {"name": "Alexandre Oliva", "email": "aoliva@gcc.gnu.org", "date": "2008-03-01T03:36:43Z"}, "message": "df-scan.c (df_ref_chain_change_bb): Simplify.\n\n* df-scan.c (df_ref_chain_change_bb): Simplify.\n(df_insn_change_bb): Add new_bb argument.  Simplify.  Call\nset_block_for_insn if there's any change.\n* df.h ((df_insn_change_bb): Fix prototype.\n* cfgrtl.c (update_bb_for_insn_chain): Pass bb to\ndf_insn_change_bb, don't call set_block_for_insn.\n* emit-rtl.c (reorder_insns): Likewise.\n* haifa-sched.c (move_insn): Likewise.\n\nFrom-SVN: r132795", "tree": {"sha": "b81fab7b64f19da71fa7bc7fb05aa9bf93363c02", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/b81fab7b64f19da71fa7bc7fb05aa9bf93363c02"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/63642d5a8dae511ccd320c89580c359a09b713dc", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63642d5a8dae511ccd320c89580c359a09b713dc", "html_url": "https://github.com/Rust-GCC/gccrs/commit/63642d5a8dae511ccd320c89580c359a09b713dc", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/63642d5a8dae511ccd320c89580c359a09b713dc/comments", "author": null, "committer": null, "parents": [{"sha": "e065105898e9374964c728fdc3065bb9cc807560", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/e065105898e9374964c728fdc3065bb9cc807560", "html_url": "https://github.com/Rust-GCC/gccrs/commit/e065105898e9374964c728fdc3065bb9cc807560"}], "stats": {"total": 87, "additions": 37, "deletions": 50}, "files": [{"sha": "96a538c48f81885e088abb363656baeea347a760", "filename": "gcc/ChangeLog", "status": "modified", "additions": 11, "deletions": 0, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=63642d5a8dae511ccd320c89580c359a09b713dc", "patch": "@@ -1,3 +1,14 @@\n+2008-03-01  Alexandre Oliva  <aoliva@redhat.com>\n+\n+\t* df-scan.c (df_ref_chain_change_bb): Simplify.\n+\t(df_insn_change_bb): Add new_bb argument.  Simplify.  Call\n+\tset_block_for_insn if there's any change.\n+\t* df.h ((df_insn_change_bb): Fix prototype.\n+\t* cfgrtl.c (update_bb_for_insn_chain): Pass bb to\n+\tdf_insn_change_bb, don't call set_block_for_insn.\n+\t* emit-rtl.c (reorder_insns): Likewise.\n+\t* haifa-sched.c (move_insn): Likewise.\n+\n 2008-03-01  Alexandre Oliva  <aoliva@redhat.com>\n \n \t* rtlanal.c (loc_mentioned_in_p): Test XVECEXPs correctly."}, {"sha": "c157e08d84b18fac54d73f8237b3dfc04effd5ff", "filename": "gcc/cfgrtl.c", "status": "modified", "additions": 3, "deletions": 8, "changes": 11, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fcfgrtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fcfgrtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fcfgrtl.c?ref=63642d5a8dae511ccd320c89580c359a09b713dc", "patch": "@@ -1,6 +1,6 @@\n /* Control flow graph manipulation code for GNU compiler.\n    Copyright (C) 1987, 1988, 1992, 1993, 1994, 1995, 1996, 1997, 1998,\n-   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007\n+   1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n    Free Software Foundation, Inc.\n \n This file is part of GCC.\n@@ -477,13 +477,8 @@ update_bb_for_insn_chain (rtx begin, rtx end, basic_block bb)\n \n   end = NEXT_INSN (end);\n   for (insn = begin; insn != end; insn = NEXT_INSN (insn))\n-    {\n-      if (!BARRIER_P (insn))\n-\t{\n-\t  set_block_for_insn (insn, bb);\n-\t  df_insn_change_bb (insn);\n-\t}\n-    }\n+    if (!BARRIER_P (insn))\n+      df_insn_change_bb (insn, bb);\n }\n \n /* Update BLOCK_FOR_INSN of insns in BB to BB,"}, {"sha": "3dc759cedb3622709095d96239bb2772e748cf5a", "filename": "gcc/df-scan.c", "status": "modified", "additions": 17, "deletions": 33, "changes": 50, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fdf-scan.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fdf-scan.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf-scan.c?ref=63642d5a8dae511ccd320c89580c359a09b713dc", "patch": "@@ -1,6 +1,6 @@\n /* Scanning of rtl for dataflow analysis.\n-   Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007\n-   Free Software Foundation, Inc.\n+   Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007,\n+   2008  Free Software Foundation, Inc.\n    Originally contributed by Michael P. Hayes \n              (m.hayes@elec.canterbury.ac.nz, mhayes@redhat.com)\n    Major rewrite contributed by Danny Berlin (dberlin@dberlin.org)\n@@ -1753,14 +1753,10 @@ df_maybe_reorganize_def_refs (enum df_ref_order order)\n }\n \n \n-/* Change the BB of all refs in the ref chain to NEW_BB.\n-   Assumes that all refs in the chain have the same BB.\n-   If changed, return the original bb the chain belonged to\n-   (or .\n-   If no change, return NEW_BB. \n-   If something's wrong, it will return NULL. */\n+/* Change the BB of all refs in the ref chain from OLD_BB to NEW_BB.\n+   Assumes that all refs in the chain have the same BB.  */\n \n-static basic_block\n+static void\n df_ref_chain_change_bb (struct df_ref **ref_rec, \n                         basic_block old_bb,\n                         basic_block new_bb)\n@@ -1769,18 +1765,10 @@ df_ref_chain_change_bb (struct df_ref **ref_rec,\n     {\n       struct df_ref *ref = *ref_rec;\n \n-      if (DF_REF_BB (ref) == new_bb)\n-\treturn new_bb;\n-      else\n-\t{\n-\t  gcc_assert (old_bb == NULL || DF_REF_BB (ref) == old_bb);\n-\t  old_bb = DF_REF_BB (ref);\n-\t  DF_REF_BB (ref) = new_bb;\n-\t}\n+      gcc_assert (DF_REF_BB (ref) == old_bb);\n+      DF_REF_BB (ref) = new_bb;\n       ref_rec++;\n     }\n-\n-  return old_bb;\n }\n \n \n@@ -1789,13 +1777,17 @@ df_ref_chain_change_bb (struct df_ref **ref_rec,\n    instructions from one block to another.  */  \n \n void\n-df_insn_change_bb (rtx insn)\n+df_insn_change_bb (rtx insn, basic_block new_bb)\n {\n-  basic_block new_bb = BLOCK_FOR_INSN (insn);\n-  basic_block old_bb = NULL;\n+  basic_block old_bb = BLOCK_FOR_INSN (insn);\n   struct df_insn_info *insn_info;\n   unsigned int uid = INSN_UID (insn);\n \n+  if (old_bb == new_bb)\n+    return;\n+\n+  set_block_for_insn (insn, new_bb);\n+\n   if (!df)\n     return;\n \n@@ -1814,17 +1806,9 @@ df_insn_change_bb (rtx insn)\n   if (!INSN_P (insn))\n     return;\n \n-  old_bb = df_ref_chain_change_bb (insn_info->defs, old_bb, new_bb);\n-  if (old_bb == new_bb) \n-    return;\n-\n-  old_bb = df_ref_chain_change_bb (insn_info->uses, old_bb, new_bb);\n-  if (old_bb == new_bb) \n-    return;\n-\n-  old_bb = df_ref_chain_change_bb (insn_info->eq_uses, old_bb, new_bb);\n-  if (old_bb == new_bb) \n-    return;\n+  df_ref_chain_change_bb (insn_info->defs, old_bb, new_bb);\n+  df_ref_chain_change_bb (insn_info->uses, old_bb, new_bb);\n+  df_ref_chain_change_bb (insn_info->eq_uses, old_bb, new_bb);\n \n   df_set_bb_dirty (new_bb);\n   if (old_bb)"}, {"sha": "7c14f163dc02d7db34e609cb37fdeff250b7bc16", "filename": "gcc/df.h", "status": "modified", "additions": 2, "deletions": 2, "changes": 4, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fdf.h", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fdf.h", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fdf.h?ref=63642d5a8dae511ccd320c89580c359a09b713dc", "patch": "@@ -1,6 +1,6 @@\n /* Form lists of pseudo register references for autoinc optimization\n    for GNU compiler.  This is part of flow optimization.\n-   Copyright (C) 1999, 2000, 2001, 2003, 2004, 2005, 2006, 2007\n+   Copyright (C) 1999, 2000, 2001, 2003, 2004, 2005, 2006, 2007, 2008\n    Free Software Foundation, Inc.\n    Originally contributed by Michael P. Hayes \n              (m.hayes@elec.canterbury.ac.nz, mhayes@redhat.com)\n@@ -871,7 +871,7 @@ extern bool df_insn_rescan (rtx);\n extern void df_insn_rescan_all (void);\n extern void df_process_deferred_rescans (void);\n extern void df_recompute_luids (basic_block);\n-extern void df_insn_change_bb (rtx);\n+extern void df_insn_change_bb (rtx, basic_block);\n extern void df_maybe_reorganize_use_refs (enum df_ref_order);\n extern void df_maybe_reorganize_def_refs (enum df_ref_order);\n extern void df_ref_change_reg_with_loc (int, int, rtx);"}, {"sha": "8628d5238de4c79533fb32d11ffddadd29ab153d", "filename": "gcc/emit-rtl.c", "status": "modified", "additions": 1, "deletions": 4, "changes": 5, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Femit-rtl.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Femit-rtl.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Femit-rtl.c?ref=63642d5a8dae511ccd320c89580c359a09b713dc", "patch": "@@ -3737,10 +3737,7 @@ reorder_insns (rtx from, rtx to, rtx after)\n \n       for (x = from; x != NEXT_INSN (to); x = NEXT_INSN (x))\n \tif (!BARRIER_P (x))\n-\t  {\n-\t    set_block_for_insn (x, bb);\n-\t    df_insn_change_bb (x);\n-\t  }\n+\t  df_insn_change_bb (x, bb);\n     }\n }\n "}, {"sha": "0f12cd04dfa3da7fd1e834cbbe957a560c934d01", "filename": "gcc/haifa-sched.c", "status": "modified", "additions": 3, "deletions": 3, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fhaifa-sched.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/63642d5a8dae511ccd320c89580c359a09b713dc/gcc%2Fhaifa-sched.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Fhaifa-sched.c?ref=63642d5a8dae511ccd320c89580c359a09b713dc", "patch": "@@ -1,6 +1,7 @@\n /* Instruction scheduling pass.\n    Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,\n-   2001, 2002, 2003, 2004, 2005, 2006, 2007 Free Software Foundation, Inc.\n+   2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008\n+   Free Software Foundation, Inc.\n    Contributed by Michael Tiemann (tiemann@cygnus.com) Enhanced by,\n    and currently maintained by, Jim Wilson (wilson@cygnus.com)\n \n@@ -1835,8 +1836,7 @@ move_insn (rtx insn)\n \t  gcc_assert (BB_END (bb) == last);\n \t}\n \n-      set_block_for_insn (insn, bb);    \n-      df_insn_change_bb (insn);\n+      df_insn_change_bb (insn, bb);\n   \n       /* Update BB_END, if needed.  */\n       if (BB_END (bb) == last)"}]}