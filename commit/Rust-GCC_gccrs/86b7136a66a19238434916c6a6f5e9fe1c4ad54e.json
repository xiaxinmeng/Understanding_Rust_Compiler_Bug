{"sha": "86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "node_id": "MDY6Q29tbWl0MTM2NTMxMDA6ODZiNzEzNmE2NmExOTIzODQzNDkxNmM2YTZmNWU5ZmUxYzRhZDU0ZQ==", "commit": {"author": {"name": "Jan Hubicka", "email": "hubicka@ucw.cz", "date": "2015-10-12T06:01:37Z"}, "committer": {"name": "Jan Hubicka", "email": "hubicka@gcc.gnu.org", "date": "2015-10-12T06:01:37Z"}, "message": "tree-profile.c (tree_profiling): Do not clear pure/const when not instrumenting.\n\n\n\t* tree-profile.c (tree_profiling): Do not clear\n\tpure/const when not instrumenting.\n\t(pass tree_profile): Add dump of symtab.\n\nFrom-SVN: r228702", "tree": {"sha": "a5b3c3834396fa658594fafb09a7a37b30a7b896", "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/trees/a5b3c3834396fa658594fafb09a7a37b30a7b896"}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/git/commits/86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "comment_count": 0, "verification": {"verified": false, "reason": "unsigned", "signature": null, "payload": null}}, "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "html_url": "https://github.com/Rust-GCC/gccrs/commit/86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "comments_url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/86b7136a66a19238434916c6a6f5e9fe1c4ad54e/comments", "author": null, "committer": null, "parents": [{"sha": "38e9e539bc63af71d76c3d5292fb08bb8262a5bf", "url": "https://api.github.com/repos/Rust-GCC/gccrs/commits/38e9e539bc63af71d76c3d5292fb08bb8262a5bf", "html_url": "https://github.com/Rust-GCC/gccrs/commit/38e9e539bc63af71d76c3d5292fb08bb8262a5bf"}], "stats": {"total": 37, "additions": 22, "deletions": 15}, "files": [{"sha": "931dedeec604e40e4eeff7c671ab3e113fd4fa5e", "filename": "gcc/ChangeLog", "status": "modified", "additions": 6, "deletions": 0, "changes": 6, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86b7136a66a19238434916c6a6f5e9fe1c4ad54e/gcc%2FChangeLog", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86b7136a66a19238434916c6a6f5e9fe1c4ad54e/gcc%2FChangeLog", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2FChangeLog?ref=86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "patch": "@@ -1,3 +1,9 @@\n+2015-10-11  Jan Hubicka  <hubicka@ucw.cz>\n+\n+\t* tree-profile.c (tree_profiling): Do not clear\n+\tpure/const when not instrumenting.\n+\t(pass tree_profile): Add dump of symtab.\n+\n 2015-10-11  Jan Hubicka  <hubicka@ucw.cz>\n \n \t* fold-const.c (fold_comparsion): Pass OEP_ADDRESS_OF when comparing"}, {"sha": "2b115544b55790cd967c014fcd55afdaa6d73424", "filename": "gcc/tree-profile.c", "status": "modified", "additions": 16, "deletions": 15, "changes": 31, "blob_url": "https://github.com/Rust-GCC/gccrs/blob/86b7136a66a19238434916c6a6f5e9fe1c4ad54e/gcc%2Ftree-profile.c", "raw_url": "https://github.com/Rust-GCC/gccrs/raw/86b7136a66a19238434916c6a6f5e9fe1c4ad54e/gcc%2Ftree-profile.c", "contents_url": "https://api.github.com/repos/Rust-GCC/gccrs/contents/gcc%2Ftree-profile.c?ref=86b7136a66a19238434916c6a6f5e9fe1c4ad54e", "patch": "@@ -564,20 +564,21 @@ tree_profiling (void)\n     }\n \n   /* Drop pure/const flags from instrumented functions.  */\n-  FOR_EACH_DEFINED_FUNCTION (node)\n-    {\n-      if (!gimple_has_body_p (node->decl)\n-\t  || !(!node->clone_of\n-\t  || node->decl != node->clone_of->decl))\n-\tcontinue;\n-\n-      /* Don't profile functions produced for builtin stuff.  */\n-      if (DECL_SOURCE_LOCATION (node->decl) == BUILTINS_LOCATION)\n-\tcontinue;\n-\n-      node->set_const_flag (false, false);\n-      node->set_pure_flag (false, false);\n-    }\n+  if (profile_arc_flag || flag_test_coverage)\n+    FOR_EACH_DEFINED_FUNCTION (node)\n+      {\n+\tif (!gimple_has_body_p (node->decl)\n+\t    || !(!node->clone_of\n+\t    || node->decl != node->clone_of->decl))\n+\t  continue;\n+\n+\t/* Don't profile functions produced for builtin stuff.  */\n+\tif (DECL_SOURCE_LOCATION (node->decl) == BUILTINS_LOCATION)\n+\t  continue;\n+\n+\tnode->set_const_flag (false, false);\n+\tnode->set_pure_flag (false, false);\n+      }\n \n   /* Update call statements and rebuild the cgraph.  */\n   FOR_EACH_DEFINED_FUNCTION (node)\n@@ -633,7 +634,7 @@ const pass_data pass_data_ipa_tree_profile =\n   0, /* properties_provided */\n   0, /* properties_destroyed */\n   0, /* todo_flags_start */\n-  0, /* todo_flags_finish */\n+  TODO_dump_symtab, /* todo_flags_finish */\n };\n \n class pass_ipa_tree_profile : public simple_ipa_opt_pass"}]}